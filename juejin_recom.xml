<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[JavaScript的数据类型 —— Undefined类型]]></title>    <link>https://juejin.cn/post/7599852579067281423</link>    <guid>https://juejin.cn/post/7599852579067281423</guid>    <pubDate>2026-01-27T09:24:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852579067281423" data-draft-id="7599852579067084815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript的数据类型 —— Undefined类型"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-27T09:24:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橘朵"/> <meta itemprop="url" content="https://juejin.cn/user/1099989273025416"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript的数据类型 —— Undefined类型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099989273025416/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橘朵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:24:39.000Z" title="Tue Jan 27 2026 09:24:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 JavaScript 中，<code>Undefined</code>类型是一个特殊且基础的数据类型，它表示一个变量最原始的自然状态——"未定义"。</p>
<p>Undefined类型只有一个值，就是 <code>undefined</code>。</p>
<p>当使用<code>var</code>或<code>let</code>声明了变量但没有初始化时，就相当于给变量赋予了<code>undefined</code>值。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> message;  
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message == <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// true </span>
<span class="hljs-comment">//等于</span>
<span class="hljs-keyword">let</span> message = <span class="hljs-literal">undefined</span> ; <span class="hljs-comment">//默认情况下，任何未经初始化的变量都会取得undefined值，因此，不必显式的初始化为undefined。</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message == <span class="hljs-literal">undefined</span>); <span class="hljs-comment">// true </span>
</code></pre>
<p>可以通过 typeof操作符来确认一个变量是否为 Undefined类型。无论是声明还是未声明，<code>typeof</code>返回的都是字符串"<code>undefined</code>"。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 变量被声明了，但未初始化，值为 undefined </span>
<span class="hljs-keyword">let</span> message; 

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message); <span class="hljs-comment">// "undefined"  </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(age); <span class="hljs-comment">// 没有声明变量,报错</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> message); <span class="hljs-comment">// "undefined" </span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> age); <span class="hljs-comment">// "undefined"</span>

<span class="hljs-comment">//访问对象不存在的属性</span>
<span class="hljs-keyword">let</span> obj = {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">name</span>); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">//函数没有返回值</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {} 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">foo</span>()); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">//函数参数未传递</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params">param</span>) { 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(param); 
} 
<span class="hljs-title function_">bar</span>(); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">//使用 void 操作符</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">void</span>(<span class="hljs-number">0</span>)); <span class="hljs-comment">// undefined</span>
</code></pre>
<p>使用严格相等进行检查：使用 <code>===</code>来严格判断一个值是否为 <code>undefined</code>，避免使用 <code>==</code>（因为 <code>undefined == null</code>为 <code>true</code>）。</p>
<pre><code class="hljs language-ini" lang="ini">if (<span class="hljs-attr">myVar</span> === undefined) { /* 处理 undefined */ }
</code></pre>
<p>安全地访问对象属性（可选链操作符 ?.）：当访问一个可能不存在的深层嵌套属性时，可选链操作符可以避免抛出错误。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">city</span> = user?.address?.city<span class="hljs-comment">; // 如果 address 不存在，则 city 为 undefined，而非报错。</span>
</code></pre>
<p>提供默认值（空值合并运算符 ??）：当变量为 <code>undefined</code>或 <code>null</code>时，空值合并运算符可以提供一个默认值。它与 <code>||</code>不同，不会过滤掉其他假值（如 <code>0</code>, <code>""</code>）。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">displayName</span> = username ?? <span class="hljs-string">"匿名用户"</span><span class="hljs-comment">; // 仅在 username 是 null 或 undefined 时使用默认值。</span>
</code></pre>
<p>安全的类型检查：如果要检查一个可能未声明的变量（直接使用会报引用错误），使用 <code>typeof</code>是最安全的方式。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> someUndeclaredVar === <span class="hljs-string">'undefined'</span>) {
  <span class="hljs-comment">// 不会报错，即使 someUndeclaredVar 从未被声明。</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“使用AI服务”到“拥有AI助手”：Clawdbot，你的个人AI基础设施]]></title>    <link>https://juejin.cn/post/7599630795804622894</link>    <guid>https://juejin.cn/post/7599630795804622894</guid>    <pubDate>2026-01-27T07:41:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795804622894" data-draft-id="7599850148055072777" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“使用AI服务”到“拥有AI助手”：Clawdbot，你的个人AI基础设施"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-01-27T07:41:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大厂技术总监下海"/> <meta itemprop="url" content="https://juejin.cn/user/4091714106833577"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“使用AI服务”到“拥有AI助手”：Clawdbot，你的个人AI基础设施
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4091714106833577/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大厂技术总监下海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:41:04.000Z" title="Tue Jan 27 2026 07:41:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Clawdbot 深度技术解析：构建去中心化的个人 AI 网关</h2>
<h3 data-id="heading-1">1. 整体介绍</h3>
<h4 data-id="heading-2">1.1 项目概览与定位</h4>
<p>Clawdbot 是一个开源项目，其核心是一个<strong>本地优先、自托管的 AI 助手网关系统</strong>。项目代码库位于 <code>clawdbot/clawdbot</code>，通过分析 <code>package.json</code> 和源码结构可知，这是一个使用 TypeScript 构建的 Node.js 应用程序，采用现代 JavaScript 工具链（pnpm、TypeScript、Vitest）。项目设计理念鲜明：将 AI 助手的能力从云端中心化服务中剥离，下沉到用户个人可控的设备上运行，实现数据主权、隐私保护和低延迟响应。</p>
<h4 data-id="heading-3">1.2 核心功能与解决方案</h4>
<p><strong>核心价值主张</strong>：解决用户对云端 AI 服务的三大顾虑——数据隐私、服务依赖性与交互割裂。</p>
<p><strong>面临的问题与目标人群</strong>：</p>
<ul>
<li><strong>问题</strong>：
<ol>
<li><strong>隐私泄露风险</strong>：敏感对话数据上传至第三方服务器。</li>
<li><strong>服务不可控</strong>：受限于服务商的策略、定价与可用性。</li>
<li><strong>交互碎片化</strong>：AI 助手能力分散在各个独立的 App 或网页中，无法统一管理。</li>
</ol>
</li>
<li><strong>目标人群</strong>：注重隐私的技术爱好者、开发者、希望将 AI 深度集成到个性化工作流中的进阶用户。</li>
</ul>
<p><strong>传统的解决方式与 Clawdbot 的创新</strong>：</p>
<ul>
<li><strong>传统方式</strong>：用户依赖 ChatGPT、Claude 等服务的 Web 界面或官方 API，数据流经服务商，且交互环境受限。</li>
<li><strong>Clawdbot 方式</strong>：
<ul>
<li><strong>本地网关</strong>：核心逻辑 (<code>Gateway</code>) 在用户设备（PC、服务器、Raspberry Pi）上运行，构成“控制平面”。所有消息路由、工具调用、会话管理首先发生在本地。</li>
<li><strong>协议适配器</strong>：为 WhatsApp (<code>@whiskeysockets/baileys</code>)、Telegram (<code>grammy</code>)、Slack (<code>@slack/bolt</code>)、Discord 等平台编写适配层，将不同协议统一为内部事件。</li>
<li><strong>统一智能体接口</strong>：无论来自哪个平台的消息，最终都路由到统一的 AI 智能体 (<code>Agent</code>) 处理，智能体可以调用本地工具、访问网络或使用配置的云模型（如 OpenAI, Anthropic）。</li>
<li><strong>优点</strong>：
<ol>
<li><strong>数据可控</strong>：对话上下文、个人配置、访问令牌等存储于本地。</li>
<li><strong>服务稳定</strong>：网关服务不受服务商界面变动影响，可配置多个模型后备。</li>
<li><strong>体验统一</strong>：一个 AI 助手分身可同时服务多个通讯平台。</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>商业价值预估逻辑</strong>：</p>
<ul>
<li><strong>代码与工程成本</strong>：项目结构复杂，涉及多协议适配、事件驱动架构、插件系统、移动端集成等。若从零开发，一个成熟团队需要至少 12-18 人月的密集投入。估算开发成本约为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>300</mn><mo separator="true">,</mo><mn>000</mn><mo>−</mo></mrow><annotation encoding="application/x-tex">300,000 - </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"/><span class="mord">300</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">000</span><span class="mord">−</span></span></span></span></span>500,000。</li>
<li><strong>覆盖问题空间效益</strong>：它解决的是一个<strong>集成与自动化</strong>问题，而非创造新的 AI 能力。其价值在于将已有的 AI 模型能力（OpenAI/Anthropic）与用户已有的通讯工具（WhatsApp/Slack）无缝连接，创造了“1+1&gt;2”的效用。对于个体用户，价值在于隐私和定制化；对于企业，可作为内部知识助手的安全部署方案原型。市场规模属于“开发者工具”与“效率工具”的交集，潜在用户量在数百万级别。</li>
</ul>
<h3 data-id="heading-4">2. 详细功能拆解</h3>
<h4 data-id="heading-5">2.1 核心功能模块</h4>
<p>从 <code>package.json</code> 的 <code>files</code> 字段和源码目录可清晰划分模块：</p>
<ol>
<li><strong>网关核心 (<code>src/gateway/</code>)</strong>：消息路由、连接管理、状态维护的枢纽。</li>
<li><strong>渠道适配层 (<code>src/whatsapp/</code>, <code>src/telegram/</code>等)</strong>：将各平台 SDK 封装成统一的 <code>Channel</code> 接口。</li>
<li><strong>智能体引擎 (<code>src/agents/</code>)</strong>：AI 交互的核心，处理提示词、调用模型、管理会话上下文和工具执行。</li>
<li><strong>工具系统 (<code>src/tools/</code>)</strong>：提供 AI 可调用的函数，如浏览器、Canvas、Cron 等，是扩展能力的基石。</li>
<li><strong>会话与状态管理 (<code>src/sessions/</code>)</strong>：管理用户对话的持久化状态，支持多智能体路由。</li>
<li><strong>插件 SDK (<code>dist/plugin-sdk/</code>)</strong>：定义标准接口，允许第三方扩展认证提供商、工具或渠道。</li>
<li><strong>配置与向导 (<code>src/config/</code>, <code>src/wizard/</code>)</strong>：提供 <code>clawdbot onboard</code> 等 CLI 向导，简化复杂的配置过程。</li>
<li><strong>配套应用 (<code>apps/macos/</code>, <code>apps/ios/</code>)</strong>：提供系统托盘应用和移动端节点，扩展交互场景。</li>
</ol>
<h4 data-id="heading-6">2.2 产品-技术联动视角</h4>
<ul>
<li><strong>“多智能体”功能</strong>：技术上通过 <code>src/sessions/session-store.ts</code> 中的 <code>SessionEntry</code> 和路由逻辑实现。每个会话 (<code>sessionKey</code>) 可以绑定到不同的 <code>agentId</code>，从而关联不同的工作空间 (<code>workspaceDir</code>) 和模型配置，实现角色隔离。</li>
<li><strong>“配对”安全策略</strong>：在 <code>src/sessions/</code> 中实现配对码生成与验证逻辑，只有经本地确认的会话才能被智能体处理。这解决了自托管机器人可能被任意用户滥用的安全问题。</li>
<li><strong>“模型后备”机制</strong>：由 <code>src/agents/model-fallback.js</code> 和 <code>agentCommand</code> 函数中的 <code>runWithModelFallback</code> 逻辑实现。当主模型认证失败或不可用时，自动切换到备选模型，提升了系统鲁棒性。</li>
</ul>
<h3 data-id="heading-7">3. 技术难点挖掘</h3>
<ol>
<li><strong>异构协议的统一抽象</strong>：不同 IM 协议（XMPP、MTProto、自定义）在连接、认证、消息格式上差异巨大。难点在于设计一个足够通用的内部 <code>Message</code> 和 <code>Channel</code> 接口，并稳定处理各 SDK 的回调与事件流。</li>
<li><strong>长上下文会话状态管理</strong>：AI 对话需要维护可能长达数万 token 的上下文。难点在于高效地存储、检索、截断和在不同会话间隔离这些状态，同时支持随模型切换而调整上下文窗口大小（参考 <code>src/sessions/session-store.ts</code> 中的 <code>contextTokens</code> 处理）。</li>
<li><strong>工具调用的安全沙盒</strong>：允许 AI 执行代码（如 Python 脚本）、访问文件系统或网络是强大但危险的功能。难点在于实现安全的执行隔离、资源限制和权限控制。项目通过明确的工具定义和参数校验（如 <code>src/tools/tool.ts</code> 中的 <code>ZalouserToolSchema</code>）来部分缓解。</li>
<li><strong>分布式节点协调</strong>：在 macOS、iOS 多设备间同步状态、转发语音或画布数据，涉及网络发现、低延迟通信和冲突解决，是一个分布式系统问题。</li>
<li><strong>OAuth 等复杂认证流程的本地化处理</strong>：例如 Gemini CLI 的 OAuth 流程 (<code>src/gateway/oauth.js</code>)，需要在本地服务器处理回调，并在无浏览器环境的 CLI 中引导用户授权。</li>
</ol>
<h3 data-id="heading-8">4. 详细设计图</h3>
<h4 data-id="heading-9">4.1 系统架构图 (C4 Model - Container Diagram)</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753eb183a6f84cb2961edfb8d3993465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5Y6C5oqA5pyv5oC755uR5LiL5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104463&amp;x-signature=Y6tGC2d%2BtxhUJNfn4rix3FGdf3o%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-10">4.2 核心消息处理序列图</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant C as Channel (e.g., WhatsApp)
    participant G as Gateway Core
    participant R as Router
    participant S as Session Manager
    participant A as Agent Engine
    participant T as Tool
    participant M as AI Model (Cloud)

    C-&gt;&gt;G: 收到新消息 (原始协议格式)
    G-&gt;&gt;G: 解码，标准化为内部 Message 事件
    G-&gt;&gt;R: 路由消息 (基于 to/sessionKey/agentId)
    R-&gt;&gt;S: 获取或创建 SessionEntry
    S-&gt;&gt;A: 交付消息及完整会话上下文
    A-&gt;&gt;A: 构建提示词， 决定是否思考/调用工具
    alt 需要调用工具
        A-&gt;&gt;T: executeTool(toolCallId, params)
        T-&gt;&gt;T: 执行（如查询、API调用）
        T--&gt;&gt;A: 返回工具执行结果
    end
    A-&gt;&gt;M: 调用模型 API (携带最终提示)
    M--&gt;&gt;A: 返回模型响应
    A-&gt;&gt;S: 更新会话历史与用量
    S-&gt;&gt;G: 提交回复消息
    G-&gt;&gt;C: 编码为协议格式并发送
</code></pre>
<h4 data-id="heading-11">4.3 核心类关系图 (简化的领域模型)</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcd437152a854879b6f9fbabd8a83d73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5Y6C5oqA5pyv5oC755uR5LiL5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104463&amp;x-signature=eVn%2BCIRtQAw5PBVrZ5gkUFtd4ko%3D" alt="deepseek_mermaid_20260127_b3e5ca.png" loading="lazy"/></p>
<h3 data-id="heading-12">5. 核心函数解析</h3>
<h4 data-id="heading-13">5.1 智能体命令入口：<code>agentCommand</code></h4>
<p>这是整个系统最核心的流程控制函数，位于 <code>src/agents/agent.ts</code>。它协调了从接收消息到交付响应的完整生命周期。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 代码基于 src/agents/agent.ts 简化与注释</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">agentCommand</span>(<span class="hljs-params">
  opts: AgentCommandOpts, <span class="hljs-comment">// 包含消息、接收者、会话ID、模型参数等</span>
  runtime: RuntimeEnv = defaultRuntime,
  deps: CliDeps = createDefaultDeps(),
</span>) {
  <span class="hljs-comment">// 1. 输入验证与基础准备</span>
  <span class="hljs-keyword">const</span> body = (opts.<span class="hljs-property">message</span> ?? <span class="hljs-string">""</span>).<span class="hljs-title function_">trim</span>();
  <span class="hljs-keyword">if</span> (!body) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Message (--message) is required"</span>);
  <span class="hljs-comment">// ... 验证 to, sessionId, agentId 至少有一个</span>

  <span class="hljs-keyword">const</span> cfg = <span class="hljs-title function_">loadConfig</span>(); <span class="hljs-comment">// 加载用户配置</span>
  <span class="hljs-keyword">const</span> sessionResolution = <span class="hljs-title function_">resolveSession</span>({ cfg, ...opts }); <span class="hljs-comment">// 关键：解析出当前会话</span>

  <span class="hljs-keyword">const</span> {
    sessionId,
    sessionKey,
    sessionEntry,
    sessionStore,
    storePath,
    isNewSession,
  } = sessionResolution;

  <span class="hljs-keyword">const</span> runId = opts.<span class="hljs-property">runId</span>?.<span class="hljs-title function_">trim</span>() || sessionId; <span class="hljs-comment">// 用于跟踪本次运行的唯一ID</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 2. 检查发送策略（如DM配对是否通过）</span>
    <span class="hljs-keyword">if</span> (opts.<span class="hljs-property">deliver</span> === <span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">const</span> sendPolicy = <span class="hljs-title function_">resolveSendPolicy</span>({ cfg, <span class="hljs-attr">entry</span>: sessionEntry, sessionKey, ... });
      <span class="hljs-keyword">if</span> (sendPolicy === <span class="hljs-string">"deny"</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"send blocked by session policy"</span>);
    }

    <span class="hljs-comment">// 3. 确定思考层级和详细级别（用户输入 &gt; 会话存储 &gt; 全局默认）</span>
    <span class="hljs-keyword">let</span> resolvedThinkLevel = <span class="hljs-comment">/* 计算逻辑 */</span>;
    <span class="hljs-keyword">const</span> resolvedVerboseLevel = <span class="hljs-comment">/* 计算逻辑 */</span>;

    <span class="hljs-comment">// 4. 注册运行时上下文，用于事件发射和日志关联</span>
    <span class="hljs-keyword">if</span> (sessionKey) {
      <span class="hljs-title function_">registerAgentRunContext</span>(runId, { sessionKey, <span class="hljs-attr">verboseLevel</span>: resolvedVerboseLevel });
    }

    <span class="hljs-comment">// 5. 构建或获取技能快照（用于给AI提供上下文）</span>
    <span class="hljs-keyword">const</span> skillsSnapshot = isNewSession || !sessionEntry?.<span class="hljs-property">skillsSnapshot</span>
      ? <span class="hljs-title function_">buildWorkspaceSkillSnapshot</span>(workspaceDir, ...)
      : sessionEntry?.<span class="hljs-property">skillsSnapshot</span>;

    <span class="hljs-comment">// 6. 模型选择与后备逻辑</span>
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">provider</span>: defaultProvider, <span class="hljs-attr">model</span>: defaultModel } = <span class="hljs-title function_">resolveConfiguredModelRef</span>({ cfg });
    <span class="hljs-keyword">let</span> provider = defaultProvider;
    <span class="hljs-keyword">let</span> model = defaultModel;
    <span class="hljs-comment">// 处理会话级别的模型覆盖 (sessionEntry.modelOverride)</span>
    <span class="hljs-comment">// 处理模型允许列表 (cfg.agents.defaults.models)</span>
    <span class="hljs-comment">// 加载模型目录以验证可用性</span>

    <span class="hljs-comment">// 7. 核心执行：运行嵌入式PI智能体或CLI智能体</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runWithModelFallback</span>({
      cfg,
      provider,
      model,
      <span class="hljs-attr">run</span>: <span class="hljs-keyword">async</span> (providerOverride, modelOverride) =&gt; {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCliProvider</span>(providerOverride, cfg)) {
          <span class="hljs-comment">// 模式：调用本地命令行AI工具（如`llm`命令）</span>
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">runCliAgent</span>({ sessionId, <span class="hljs-attr">prompt</span>: body, <span class="hljs-attr">provider</span>: providerOverride, ... });
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 模式：调用云API或本地模型库（主要路径）</span>
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">runEmbeddedPiAgent</span>({
            sessionId,
            sessionKey,
            <span class="hljs-attr">prompt</span>: body,
            <span class="hljs-attr">provider</span>: providerOverride,
            <span class="hljs-attr">model</span>: modelOverride,
            <span class="hljs-attr">thinkLevel</span>: resolvedThinkLevel, <span class="hljs-comment">// 控制AI的“思考”深度</span>
            skillsSnapshot, <span class="hljs-comment">// 注入可用技能信息</span>
            <span class="hljs-attr">streamParams</span>: opts.<span class="hljs-property">streamParams</span>, <span class="hljs-comment">// 支持流式响应</span>
            <span class="hljs-attr">onAgentEvent</span>: <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> { <span class="hljs-comment">/* 发射生命周期事件 */</span> },
          });
        }
      },
    });

    <span class="hljs-comment">// 8. 更新会话存储（记录使用的模型、token消耗等）</span>
    <span class="hljs-keyword">if</span> (sessionStore &amp;&amp; sessionKey) {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">updateSessionStoreAfterAgentRun</span>({
        cfg,
        sessionId,
        sessionKey,
        storePath,
        sessionStore,
        <span class="hljs-attr">defaultProvider</span>: provider,
        <span class="hljs-attr">defaultModel</span>: model,
        result, <span class="hljs-comment">// 包含用量元数据</span>
      });
    }

    <span class="hljs-comment">// 9. 交付结果（根据opts.deliver决定是打印到CLI还是发送回消息渠道）</span>
    <span class="hljs-keyword">const</span> payloads = result.<span class="hljs-property">payloads</span> ?? [];
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">deliverAgentCommandResult</span>({ cfg, deps, runtime, opts, sessionEntry, result, payloads });

  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 10. 清理运行时上下文</span>
    <span class="hljs-title function_">clearAgentRunContext</span>(runId);
  }
}
</code></pre>
<p><strong>关键设计解析</strong>：</p>
<ul>
<li><strong>依赖注入</strong>：函数接收 <code>runtime</code> 和 <code>deps</code> 参数，便于测试和环境隔离。</li>
<li><strong>统一的会话抽象</strong>：<code>resolveSession</code> 函数将 <code>to</code> (E.164号码)、<code>sessionId</code>、<code>sessionKey</code>、<code>agentId</code> 等多种标识符统一解析为内部的 <code>sessionKey</code> 和 <code>SessionEntry</code>，这是实现多平台路由的基础。</li>
<li><strong>模型后备机制</strong>：<code>runWithModelFallback</code> 封装了重试逻辑，是系统可靠性的关键。</li>
<li><strong>事件驱动架构</strong>：通过 <code>onAgentEvent</code> 回调发射细粒度事件（思考开始、工具调用、流式输出块），使得外部（如UI、日志）可以实时观察智能体运行状态。</li>
<li><strong>资源生命周期管理</strong>：使用 <code>try...finally</code> 确保 <code>runContext</code> 被清理，避免内存泄漏。</li>
</ul>
<h4 data-id="heading-14">5.2 工具执行示例：<code>executeZalouserTool</code></h4>
<p>展示了如何将外部命令行工具（<code>zca</code>，一个 Zalo 客户端）安全地封装成 AI 可调用的函数。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 代码基于 src/tools/tool.ts 简化</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executeZalouserTool</span>(<span class="hljs-params">_toolCallId: <span class="hljs-built_in">string</span>, params: ToolParams</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ToolResult</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">switch</span> (params.<span class="hljs-property">action</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">"send"</span>: {
        <span class="hljs-comment">// 1. 参数校验</span>
        <span class="hljs-keyword">if</span> (!params.<span class="hljs-property">threadId</span> || !params.<span class="hljs-property">message</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"threadId and message required for send action"</span>);
        }
        <span class="hljs-comment">// 2. 构造安全的命令行参数</span>
        <span class="hljs-keyword">const</span> args = [<span class="hljs-string">"msg"</span>, <span class="hljs-string">"send"</span>, params.<span class="hljs-property">threadId</span>, params.<span class="hljs-property">message</span>];
        <span class="hljs-keyword">if</span> (params.<span class="hljs-property">isGroup</span>) args.<span class="hljs-title function_">push</span>(<span class="hljs-string">"-g"</span>);
        <span class="hljs-comment">// 3. 调用外部二进制，不直接拼接字符串，避免注入</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">runZca</span>(args, { <span class="hljs-attr">profile</span>: params.<span class="hljs-property">profile</span> });
        <span class="hljs-comment">// 4. 处理结果，统一格式返回</span>
        <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">ok</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(result.<span class="hljs-property">stderr</span> || <span class="hljs-string">"Failed to send message"</span>);
        }
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">text</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">output</span>: result.<span class="hljs-property">stdout</span> }, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) }],
          <span class="hljs-attr">details</span>: { <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">output</span>: result.<span class="hljs-property">stdout</span> }
        };
      }
      <span class="hljs-comment">// ... 处理其他 action (image, link, friends...)</span>
    }
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// 5. 统一的错误处理，将异常转化为AI可理解的格式</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [{ <span class="hljs-attr">type</span>: <span class="hljs-string">"text"</span>, <span class="hljs-attr">text</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> }, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) }],
      <span class="hljs-attr">details</span>: { <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> }
    };
  }
}
</code></pre>
<h3 data-id="heading-15">6. 同类技术对比与总结</h3>
<p><strong>与云端助手（ChatGPT/Claude）对比</strong>：</p>
<ul>
<li><strong>优势</strong>：数据本地化、多平台统一入口、可深度定制和扩展、运行成本可控（仅支付模型API费用）。</li>
<li><strong>劣势</strong>：用户需自行维护服务器、配置复杂度高、初始设置有技术门槛。</li>
</ul>
<p><strong>与单一平台机器人框架（如Botpress、GrammY）对比</strong>：</p>
<ul>
<li><strong>优势</strong>：真正的<strong>跨平台</strong>统一架构，一个智能体实例服务所有渠道；<strong>本地优先</strong>的设计哲学更注重隐私和控制权。</li>
<li><strong>劣势</strong>：项目更年轻，社区和插件生态可能不如成熟框架丰富。</li>
</ul>
<p><strong>技术选型与架构评价</strong>：
Clawdbot 选择 TypeScript/Node.js 生态，利用了其强大的异步I/O处理能力和丰富的 npm 包（各类 IM SDK），适合事件驱动、高I/O的网关类应用。其架构清晰，模块化程度高，通过 Plugin SDK 预留了良好的扩展性。然而，将复杂状态管理于文件系统和内存中，在向多实例、高可用性部署演进时可能面临挑战。</p>
<p><strong>结论</strong>：
Clawdbot 代表了一种重要的技术方向：将大型AI模型的“智能”与个人计算设备的“控制”相结合。它不是一个面向普通用户的“产品”，而是一个面向开发者和技术爱好者的“强大平台”。其代码体现了对复杂性问题（多协议、状态管理、扩展性）的深刻思考与工程化解法，为构建隐私友好、用户可控的下一代个人AI基础设施提供了极具价值的参考实现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[错的"优化目标"：从扫地机器人到毁掉一切的算法]]></title>    <link>https://juejin.cn/post/7599847938537406473</link>    <guid>https://juejin.cn/post/7599847938537406473</guid>    <pubDate>2026-01-27T08:02:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599847938537406473" data-draft-id="7599630795804786734" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="错的&quot;优化目标&quot;：从扫地机器人到毁掉一切的算法"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:02:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="深度涌现"/> <meta itemprop="url" content="https://juejin.cn/user/2524932621734990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            错的"优化目标"：从扫地机器人到毁掉一切的算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524932621734990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    深度涌现
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:02:01.000Z" title="Tue Jan 27 2026 08:02:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>清扫整个 Albert Heijn 超市的地面。听起来很简单。而且原本也应该很简单。</p>
<p>但我是一名计算机科学专业的学生，我遇到了一个问题：我总是忍不住去优化一些（可能）不需要优化的东西。</p>
<p>所以，我没有只是做好我的工作，比如扫地，而是做了任何一个“理智的”人都会做的事：我把超市的平面图转换成了网格图，构建了一个可视化编辑器，并使用模拟退火算法编写了一个 C++ 路径优化器。</p>
<p>但在我们深入探讨这件事是如何彻底出错，以及这件事如何让我意识到这会让每个人都痛苦之前，我需要你回答一个问题：</p>
<p>如果你要替我工作一天，并且需要打扫整个 Albert Heijn 超市的楼层，你会选择 A 路线还是 B 路线？
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/bdc47e6c-cc83-4a27-87bd-102e3d3c0516_1150x1500_c35cf38c.png" alt="img" loading="lazy"/>
路径 A（上）和路径 B（下）。</p>
<p>说真的，看看它们。哪个看起来更适合清扫超市地面？</p>
<p>如果你选择了A选项：恭喜你，你的思维方式像算法一样，很可能就是个机器人。</p>
<p>但从技术上讲，你的说法没错。路径 A 的距离更短。然而，它完全没用。</p>
<p>看看那些弯道。你不妨想象一下，如果你走路时也这样弯，你会看起来像个疯子，就像一台抽搐的扫地机器人。</p>
<p>路径 A 是你优化了错误的东西而导致的结果。</p>
<p>剧透一下，这正是这个故事的重点。不过我们稍后再谈，先让我解释一下事情的来龙去脉：</p>
<h2 data-id="heading-0">第一步：将现实转化为过于简单的模型</h2>
<p>首先，我把 Albert Heijn 的平面图转换成了网格。每个方格要么是空的（应该打扫），要么是障碍物（墙壁、收银台、有人扔在地上的酸奶包装）。</p>
<p>我在<a href="https://link.juejin.cn?target=https%3A%2F%2Fprocessing.org%2F" target="_blank" title="https://processing.org/" ref="nofollow noopener noreferrer">Processing</a>中构建了一个可视化编辑器，这样我就可以轻松地绘制商店地图并导出生成的图表。</p>
<p>因此，将平面图转换为网格结构非常容易。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/20260127133430350_e273c43d.png" alt="img" loading="lazy"/>
Albert Heijn 超市的网格平面图。</p>
<p>实际地面的瓷砖铺设有助于将该区域细分为易于管理的小块区域。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/d0ea4a82-edf2-4aa8-9a45-348731666114_1150x750_f9f84176.png" alt="img" loading="lazy"/>
采用瓷砖结构的细分式平面图。</p>
<p>然后，通过将每个图块解释为一个节点，然后将它们连接到相邻的图块，就可以很容易地将其转换为网络结构（也称为图）。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/846289b8-6269-46d5-a7ee-ea375325651e_1150x750_1ad8642d.png" alt="img" loading="lazy"/>
将每个图块解释为图中的一个节点。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/085819a8-9e57-4bad-902b-75823cb7ca34_1150x750_5b065217.png" alt="img" loading="lazy"/>
生成的瓦片网络。</p>
<p>如你所见，我允许水平和垂直移动，以及对角线移动（只要你不穿墙）。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/716121fe-3f08-4c7e-894d-082f673ca1f0_1150x750_e6014d03.png" alt="img" loading="lazy"/>
Albert Heijn 的最终图表。</p>
<p>接下来唯一要做的就是找到一条贯穿这个网络的路径，同时确保访问所有节点（图块）。这样就能解决我的扫描问题。</p>
<p><em>（这个问题也称为<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FTravelling_salesman_problem" target="_blank" title="https://en.wikipedia.org/wiki/Travelling_salesman_problem" ref="nofollow noopener noreferrer">旅行商问题</a>，详情请参阅相关文章，了解它为何如此难以“解决”。）</em></p>
<h2 data-id="heading-1">第二步：编写优化器</h2>
<p>由于在如此规模的图中，计算上不可能找到最优路径，我们只能求助于启发式算法。启发式算法本质上是在短时间内找到一个<strong>非常好的</strong>解，而不是试图找到<strong>完美的</strong>解（这几乎是不可能的）。</p>
<p>所以我用 C++ 实现了路径优化器。</p>
<p>底层启发式算法：<strong>模拟退火</strong>。</p>
<p>如果你还不熟悉，模拟退火本质上就是尝试一系列微小的变化（也称为局部移动）。</p>
<p>一开始，你接受每一个小小的改变（即使它让路径变得更糟），但随着算法的进行，你会逐渐变得更加挑剔，最终只允许那些严格意义上改善路径的改变。</p>
<p>这个想法源于金属冷却的过程。首先，金属在高温下运行（尝试不同的运动方式）进行充分的探索，然后逐渐冷却，最终稳定在低能量状态（接近最佳状态）。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/c80c76a3-0921-4b5e-89cf-dc254b81a0e9_1150x750_fc6adf39.gif" alt="img" loading="lazy"/>
模拟退火算法通过多次迭代逐步改进路径。</p>
<p>看看这个动图。看到了吗？它一开始很混乱，然后逐渐变得稳定下来。这就是模拟退火算法的工作原理。</p>
<p>对于局部移动，我使用了 2-opt 移动。具体来说，就是移除路径中的两条边，然后用不同的方式重新连接它们。如果这种微小的改动使路径变得更好，就保留它。否则，要么保留它（如果温度仍然很高），要么舍弃它。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/0d414694-060b-4126-82c6-093acf5c0ebc_1956x876_f8c0b43b.png" alt="img" loading="lazy"/>
2-opt 移动可视化。</p>
<p>那就这么做十亿次。或者，让你的电脑这么做十亿次。</p>
<h2 data-id="heading-2">第三步：搞砸</h2>
<p>运行一段时间后，我得到了第一条“优化”路径。以下是优化结果：
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/fcb8b22f-3afc-406a-adff-455aa0dd32ee_1150x750_921cb651.gif" alt="img" loading="lazy"/>
第一条“优化”路径。</p>
<p>瞧瞧这路！弯道比克里斯托弗·诺兰的电影还多。谁会傻到真的这么扫地啊？扫完估计都想吐。</p>
<p>从技术上讲，它覆盖了整个地面。从技术上讲，它（几乎）是最小的清扫路径。从技术上讲，它是完美的。</p>
<p>它有一些优点，但实际上，它完全没用。</p>
<p>算法完全按照我的要求执行了。</p>
<p>我问错问题了。</p>
<h2 data-id="heading-3">第四步：根据实际情况进行优化</h2>
<p>我很快意识到我优化的方向错了。距离并非一切。</p>
<p>转弯很重要。动量很重要。看起来不像个故障的机器人也很重要。</p>
<p>所以我给成本函数增加了一个“转弯惩罚”，并要求它最小化这个惩罚。基本上就是告诉算法：“转弯90度会扣分。转弯180度？你疯了吧。”</p>
<p>这样一来，路线就更加顺畅了，即使距离略微延长了一些。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/2809e59e-bfab-4ced-8f23-a8625bce71e4_1150x750_f58bf32e.gif" alt="img" loading="lazy"/>
更平坦、更适合步行的道路。</p>
<p>你看，这其实……挺好走的。你把这条路交给一个真正的人，他也不会立刻放弃。</p>
<p>我们不再追求距离上的最优解，而是追求与现实的契合度。</p>
<h2 data-id="heading-4">第五步：打破它</h2>
<p>接下来才是精彩的部分。</p>
<p>您可以调整急转弯的惩罚。这相当于一个滑块，可以在“纯粹的效率”和“实际用途”之间切换。
<img src="https://pic-1251484506.cos.ap-guangzhou.myqcloud.com/imgs/a3392aaf-223d-475c-9acb-a947eedefaa0_2300x2250_6c44f82c.png" alt="img" loading="lazy"/>
从低角度罚分（1）到高角度罚分（6）。</p>
<p>你可以清楚地看到其中的权衡。增加惩罚，路径会更平滑，但会稍长一些。减少惩罚，效率会提高，但会造成混乱。</p>
<p>选择哪条路完全取决于你自己。这取决于很多因素，比如你转身是否方便，总距离是否是首要考虑因素，以及你能忍受多大的眩晕。</p>
<h2 data-id="heading-5">第六步：意识到生活其实并没有那么美好</h2>
<p>但这不仅仅是扫地那么简单。</p>
<p>这关乎一切。</p>
<p>社交媒体算法以提升用户参与度为目标，而且它们在这方面做得非常出色。问题出在哪里呢？</p>
<p>参与度≠幸福。参与度≠真相。参与度=点击量、屏幕使用时长、愤怒情绪和负面反应。</p>
<p>后果？愤怒、错误信息、负面新闻刷屏、焦虑。</p>
<p>算法运行完美，完全按照设计预期执行。问题出在成本函数上。（Instagram 可能不这么认为。）</p>
<p>推荐算法会优化观看时长和点击率。你奶奶正在YouTube上连续看6个小时的阴谋论视频。</p>
<p>算法彻底毁了她。她感觉糟透了。</p>
<p>这并不令人意外。</p>
<p>即使是像 ChatGPT 这样的大型语言模型，它们的优化方向也错了。它们优化的是听起来自信，听起来好像知道答案。</p>
<p>不是因为他正确，也不是因为他诚实。</p>
<p>他们接受的训练是完成既定模式，而不是说“我不知道”。所以他们只能靠猜测。而且毫无羞耻心，语法也完美无瑕。</p>
<p>这一点甚至适用于科技以外的领域。</p>
<p>想想企业。它们大多以盈利为目标。地球、环境、道德或伦理呢？这些都没有纳入成本函数，因此也不会被优化。</p>
<p>我在实际工作中是否使用了这条优化路径？</p>
<p>不，显然不是。我只是像正常人一样扫了地而已。</p>
<p>但构建这个项目教会了我一个我一直在思考的道理：如果你解决的是错误的问题，那么技术上的正确性就毫无意义。</p>
<p>你可以写出完美的代码，你可以构建完美无瑕的系统，你可以把成本函数优化到极致，但最终结果仍然可能很糟糕。</p>
<p>重要的不是优化算法本身，而是首先要弄清楚你究竟应该优化什么。</p>
<p>大多数时候，我们甚至都不会问这个问题。我们只是优化那些容易衡量的指标，然后祈祷结果会好起来。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftiespetersen.substack.com%2Fp%2Fi-got-paid-minimum-wage-to-solve" target="_blank" title="https://tiespetersen.substack.com/p/i-got-paid-minimum-wage-to-solve" ref="nofollow noopener noreferrer">tiespetersen.substack.com/p/i-got-pai…</a></p>
<p>笔者公众号「深度涌现」</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript事件循环与异步执行全解析]]></title>    <link>https://juejin.cn/post/7599860946836652095</link>    <guid>https://juejin.cn/post/7599860946836652095</guid>    <pubDate>2026-01-27T09:26:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599860946836652095" data-draft-id="7599843186202378282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript事件循环与异步执行全解析"/> <meta itemprop="keywords" content="JavaScript,面试,前端"/> <meta itemprop="datePublished" content="2026-01-27T09:26:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雪中何以赠君别"/> <meta itemprop="url" content="https://juejin.cn/user/3186831013974270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript事件循环与异步执行全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3186831013974270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雪中何以赠君别
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:26:33.000Z" title="Tue Jan 27 2026 09:26:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><hr/>
<h2 data-id="heading-0">📝 代码示例一：Promise与setTimeout混合</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"set!"</span>);
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-title function_">resolve</span>();
  }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-title function_">resolve</span>();
    }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"then4"</span>);
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"then2"</span>);
  });
});

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"pr1"</span>);
  <span class="hljs-title function_">resolve</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"then1"</span>);
});

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"set2"</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);

<span class="hljs-title function_">queueMicrotask</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"microtask"</span>);
});

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-title function_">resolve</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"then3"</span>);
});
</code></pre>
<p><strong>🎯 输出顺序：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">pr1
<span class="hljs-number">2</span>
then1
microtask
then3
set!
then2
then4
set2
</code></pre>
<h2 data-id="heading-1">📝 代码示例二：async/await与Promise混合</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async1</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"async1 start"</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">async2</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"async1 end"</span>);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">async2</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"async2"</span>);
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"script start"</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"setTimeout"</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title function_">async1</span>();

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"promise1"</span>);
  <span class="hljs-title function_">resolve</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"promise2"</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"script end"</span>);
</code></pre>
<p><strong>🎯 输出顺序：</strong></p>
<pre><code class="hljs language-sql" lang="sql">script <span class="hljs-keyword">start</span>
async1 <span class="hljs-keyword">start</span>
async2
promise1
script <span class="hljs-keyword">end</span>
async1 <span class="hljs-keyword">end</span>
promise2
setTimeout
</code></pre>
<h2 data-id="heading-2">🔍 事件循环核心概念</h2>
<h3 data-id="heading-3">任务队列分类</h3>
<h4 data-id="heading-4">宏任务 (Macrotask)</h4>
<ul>
<li><code>setTimeout</code> / <code>setInterval</code></li>
<li>I/O 操作</li>
<li>UI 渲染</li>
<li><code>setImmediate</code> (Node.js)</li>
<li>脚本整体代码</li>
</ul>
<h4 data-id="heading-5">微任务 (Microtask)</h4>
<ul>
<li><code>Promise.then</code> / <code>.catch</code> / <code>.finally</code></li>
<li><code>queueMicrotask</code></li>
<li><code>MutationObserver</code></li>
<li><code>async/await</code> 后的代码</li>
</ul>
<h3 data-id="heading-6">⚡ 执行规则（黄金法则）</h3>
<ol>
<li><strong>同步代码立即执行</strong>：所有非异步代码立即执行</li>
<li><strong>微任务优先</strong>：当前宏任务结束后，立即执行所有微任务</li>
<li><strong>微任务队列必须完全清空</strong>：包括执行过程中新加入的微任务</li>
<li><strong>按序执行宏任务</strong>：微任务清空后才执行下一个宏任务</li>
</ol>
<h2 data-id="heading-7">🚀 详细执行机制解析</h2>
<h3 data-id="heading-8">第一阶段：同步代码执行（立即执行）</h3>
<p>在示例一中：</p>
<ol>
<li><code>setTimeout1</code> 回调加入宏任务队列</li>
<li><code>Promise</code> 构造函数同步执行，输出 <code>pr1</code>，<code>then1</code> 加入微任务队列</li>
<li><code>setTimeout2</code> 回调加入宏任务队列</li>
<li><code>console.log(2)</code> 输出 <code>2</code></li>
<li><code>queueMicrotask</code> 回调加入微任务队列</li>
<li>第二个 <code>Promise</code> 的 <code>then3</code> 加入微任务队列</li>
</ol>
<p>在示例二中：</p>
<ol>
<li><code>console.log("script start")</code> 输出</li>
<li><code>setTimeout</code> 加入宏任务队列</li>
<li>执行 <code>async1()</code>：
<ul>
<li>输出 <code>async1 start</code></li>
<li>执行 <code>async2()</code>，输出 <code>async2</code></li>
<li><code>await</code> 后的代码转为微任务</li>
</ul>
</li>
<li><code>new Promise</code> 构造函数同步执行，输出 <code>promise1</code></li>
<li><code>console.log("script end")</code> 输出</li>
</ol>
<h3 data-id="heading-9">第二阶段：微任务执行（同步代码完成后）</h3>
<p><strong>关键特性</strong>：微任务执行期间产生的新微任务会加入当前队列并继续执行</p>
<p>示例一微任务顺序：</p>
<ol>
<li><code>then1</code> → 输出 <code>then1</code></li>
<li><code>microtask</code> → 输出 <code>microtask</code></li>
<li><code>then3</code> → 输出 <code>then3</code></li>
</ol>
<p>示例二微任务顺序：</p>
<ol>
<li><code>async1 end</code> → 输出 <code>async1 end</code></li>
<li><code>promise2</code> → 输出 <code>promise2</code></li>
</ol>
<h3 data-id="heading-10">第三阶段：宏任务执行（微任务清空后）</h3>
<p>按加入队列的顺序执行宏任务：</p>
<p>示例一：</p>
<ol>
<li>第一个 <code>setTimeout</code> 回调：
<ul>
<li>输出 <code>set!</code></li>
<li>执行 <code>Promise.then</code>，输出 <code>then2</code></li>
<li>内部 <code>Promise.then</code> 加入微任务队列</li>
<li>清空新产生的微任务，输出 <code>then4</code></li>
</ul>
</li>
<li>第二个 <code>setTimeout</code> 回调：输出 <code>set2</code></li>
</ol>
<p>示例二：</p>
<ol>
<li><code>setTimeout</code> 回调：输出 <code>setTimeout</code></li>
</ol>
<h2 data-id="heading-11">💡 关键技术点详解</h2>
<h3 data-id="heading-12">1. Promise执行机制</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"构造函数内 - 同步执行"</span>);  <span class="hljs-comment">// 同步代码</span>
  <span class="hljs-title function_">resolve</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"then回调 - 微任务"</span>);      <span class="hljs-comment">// 微任务</span>
});
</code></pre>
<h3 data-id="heading-13">2. async/await本质</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// async/await 写法</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"A"</span>);          <span class="hljs-comment">// 同步执行</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">someFunction</span>();      <span class="hljs-comment">// 同步执行someFunction，后面的代码转为微任务</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"B"</span>);          <span class="hljs-comment">// 微任务</span>
}

<span class="hljs-comment">// 等价 Promise 写法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"A"</span>);          <span class="hljs-comment">// 同步执行</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">someFunction</span>()).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"B"</span>);        <span class="hljs-comment">// 微任务</span>
  });
}
</code></pre>
<h3 data-id="heading-14">3. 微任务嵌套执行</h3>
<p>微任务执行期间产生的新的微任务，会在当前事件循环中被执行，不会延迟到下一轮：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"微任务1"</span>);
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"嵌套微任务"</span>);  <span class="hljs-comment">// 会在当前微任务循环中执行</span>
  });
});
</code></pre>
<h2 data-id="heading-15">🎓 记忆口诀</h2>
<pre><code class="hljs language-csharp" lang="csharp">同步先行微随后，
宏任务在最后头。
<span class="hljs-keyword">await</span>前是同步走，
<span class="hljs-keyword">await</span>后微任务留。
微任务清空才宏任务，
新微任务，继续跟。
</code></pre>
<h2 data-id="heading-16">📊 事件循环流程图</h2>
<pre><code class="hljs language-javascript" lang="javascript">┌─────────────────────────┐
│     同步代码执行栈        │ ← 立即执行
└─────────────────────────┘
           ↓
┌─────────────────────────┐
│       微任务队列          │ ← 完全清空（包括嵌套）
│   • <span class="hljs-title class_">Promise</span>.<span class="hljs-property">then</span>        │
│   • <span class="hljs-keyword">await</span>后的代码        │
│   • queueMicrotask      │
└─────────────────────────┘
           ↓
┌─────────────────────────┐
│       宏任务队列          │ ← 按序执行
│   • <span class="hljs-built_in">setTimeout</span>/<span class="hljs-built_in">setInterval</span>│
│   • I/O回调              │
│   • <span class="hljs-variable constant_">UI</span>渲染              │
└─────────────────────────┘
           ↓
        循环执行
</code></pre>
<h2 data-id="heading-17">🏆 面试要点总结</h2>
<ol>
<li><strong>同步代码永远最先执行</strong></li>
<li><strong>微任务在同步代码之后、宏任务之前执行</strong></li>
<li><strong>async函数中，await前的代码同步执行</strong></li>
<li><strong>await后的代码作为微任务执行</strong></li>
<li><strong>Promise构造函数是同步的，只有.then()才是微任务</strong></li>
<li><strong>微任务队列必须完全清空后才执行宏任务</strong></li>
<li><strong>微任务执行期间产生的新微任务会立即加入当前队列</strong></li>
<li><strong>多个微任务按入队顺序执行</strong></li>
<li><strong>宏任务按事件循环顺序执行</strong></li>
</ol>
<h2 data-id="heading-18">📚 扩展知识</h2>
<h3 data-id="heading-19">复杂场景分析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">nestedAsync</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"A"</span>);              <span class="hljs-comment">// 同步</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"B"</span>);              <span class="hljs-comment">// 微任务1</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"C"</span>);              <span class="hljs-comment">// 微任务2（在微任务1中产生）</span>
}
<span class="hljs-comment">// 输出: A → B → C（每个await后都是新的微任务）</span>
</code></pre>
<h3 data-id="heading-20">浏览器与Node.js差异</h3>
<ul>
<li>Node.js中有<code>process.nextTick</code>，优先级高于Promise微任务</li>
<li>Node.js的<code>setImmediate</code>和<code>setTimeout</code>执行时机有所不同</li>
</ul>
<h3 data-id="heading-21">性能考虑</h3>
<ul>
<li>避免在微任务中执行耗时操作，会阻塞UI渲染</li>
<li>合理拆分任务，避免长时间占用事件循环</li>
</ul>
<p>掌握这些核心概念，你就能准确预测任何JavaScript异步代码的执行顺序，这是前端面试中的高频考点，也是编写可靠异步代码的基础！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[社区共创｜TRAE 一周年许愿地图开发细节全揭秘]]></title>    <link>https://juejin.cn/post/7599634796583829510</link>    <guid>https://juejin.cn/post/7599634796583829510</guid>    <pubDate>2026-01-27T09:26:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599634796583829510" data-draft-id="7599579865609388074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="社区共创｜TRAE 一周年许愿地图开发细节全揭秘"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-27T09:26:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            社区共创｜TRAE 一周年许愿地图开发细节全揭秘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:26:04.000Z" title="Tue Jan 27 2026 09:26:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69dae43525764e128cc72604d2c4e5cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=Xprrsu13vvRX65%2F7qnA84nCll8o%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>作者：茉卷，TRAE 开发者用户</p>
</blockquote>
<p><strong>一群社区伙伴</strong>，如何从零到一，为 TRAE 开发一个线上周年庆项目？当你要同时扮演产品经理、设计师和开发者的角色，如何保证项目不失控？</p>
<p>本文记录了社区伙伴们使用 TRAE ，将“周年庆活动”这个想法，一步步变为高质量交付的线上产品的全过程。你将看到一个可复制的实践路径：从需求分析、技术选型，到文档生成、编码实现，再到社区协作与迭代。</p>
<p>这不仅是一份个人项目交付指南，也是一次关于“社区共创”的生动诠释。</p>
<blockquote>
<p>点击链接即可进入网页：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftraebirth.kingzeus.space%2F" target="_blank" title="https://traebirth.kingzeus.space/" ref="nofollow noopener noreferrer">traebirth.kingzeus.space/</a></p>
</blockquote>
<h2 data-id="heading-0"><strong>一切始于一个社区想法</strong></h2>
<p>一切始于 TRAE 周年庆前夕的一次社区征集。当“设计一个活动页面”的想法最终要落地为“周年庆正式项目”时，挑战随之而来。</p>
<p>为把这份“来自社区的生日礼物”按期交付，我和几位社区伙伴一起共创。我在项目中同时承担项目经理、UI 设计、前端开发、联调测试等角色，并用 TRAE 贯穿全过程：从文档生成、任务拆解，到基线代码生成、多人协作、缺陷定位与修复。</p>
<p><strong>全程开发使用的是 TRAE国际版 IDE 和 SOLO 模式，主力模型为 GPT-5.2 和 Gemini-3-Pro，从想法到最终网页上线，用时一周，成品如下图：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc75bd3d8454dbca12db4973a422842~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=qjmHuR5SywhokvDz%2B%2Fk8gdGyvYU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0743fab371cf40aab53234aaab17d801~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=%2FQHFzLgApoZriZagzHqIanL21k0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>第一步：从想法，到清晰需求</strong></h2>
<p>周年庆的目标是“做一个能让用户参与、愿意分享的小项目”。</p>
<p>我首先将这个笼统的目标拆解为三个需要具体解决的问题：</p>
<ul>
<li>
<p><strong>参与路径问题：</strong> 周年节点需要一个统一入口，让用户“看见就能参与”，路径越短越好。</p>
</li>
<li>
<p><strong>氛围与仪式感问题：</strong> 只有列表会很平淡，地图能天然制造“点亮世界”的仪式感与参与反馈（每一条心愿都对应一个地点被点亮，越多人参与越直观）。</p>
</li>
<li>
<p><strong>互动与传播问题：</strong> 用户希望自己的内容被看见、被回应；活动需要自然传播抓手，例如点赞和分享链接。</p>
</li>
</ul>
<p>为了系统性地梳理需求，我习惯于在项目开始时强制自己回答“灵魂 4 问”，并把这一步交给 TRAE 做第一轮头脑风暴，然后由我进行裁剪与定稿：</p>
<blockquote>
<ol>
<li>系统要解决什么问题？</li>
<li>包含哪些核心功能？</li>
<li>输入输出是什么？</li>
<li>依赖哪些组件与数据？</li>
</ol>
</blockquote>
<p>我向 TRAE 的自定义智能体“创意引导师”下达指令，让它围绕这四个问题进行分析。下图是 TRAE 生成的部分初步构想：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0420617cc3b94b3e91184d2f272ca35f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=iOEeLrImdu3KGZBm7jj7bJ2tZmA%3D" alt="截屏2026-01-27 16.41.11.png" loading="lazy"/></p>
<p>经过多轮讨论和我的裁剪，最终得出以下结论：</p>
<h3 data-id="heading-2"><strong>价值主张</strong></h3>
<ul>
<li>
<p>把分散的“周年祝福”聚合成一个可视化的共同记忆（地图点亮 + 热力聚合）。</p>
</li>
<li>
<p>让用户在短路径内完成参与，并获得即时反馈（提交成功动效、实时弹幕、点赞增长）。</p>
</li>
<li>
<p>让内容具备可传播性（分享链接可打开特定心愿）。</p>
</li>
</ul>
<h3 data-id="heading-3"><strong>业务边界</strong></h3>
<ul>
<li>
<p>心愿提交依赖浏览器定位：用户授权后提交，经纬度写入数据库，省份由坐标推断。</p>
</li>
<li>
<p>心愿提交需要向用户申请位置信息，用户同意后才能提交愿望</p>
</li>
<li>
<p>点赞有防重复：前端本地去重 + 后端/数据库指纹去重，重复点赞返回错误。</p>
</li>
<li>
<p>点亮计数按 IP 限制：同一 IP 只能“点亮”一次。</p>
</li>
</ul>
<h3 data-id="heading-4"><strong>附灵魂 4 问</strong></h3>
<h4 data-id="heading-5"><strong>1. 系统要解决什么问题？</strong></h4>
<ul>
<li>
<p><strong>参与路径问题：</strong> 需要一个统一入口，让用户“快速参与”。</p>
</li>
<li>
<p><strong>可视化与氛围问题：</strong> 需要UI组件（地图 + 点亮 + 弹幕）来放大参与感。</p>
</li>
<li>
<p><strong>互动与传播问题：</strong> 用户希望自己的内容被看见、被反馈；活动需要自然传播抓手（点赞、分享链接）。</p>
</li>
<li>
<p><strong>治理与可控问题：</strong> 匿名参与不可避免带来内容风险，因此必须具备审核与快速处置能力。</p>
</li>
</ul>
<h4 data-id="heading-6"><strong>2. 包含哪些核心功能？</strong></h4>
<p><strong>用户侧</strong></p>
<p><strong>沉浸式开场：</strong> 现有一个动画，之后进入主界面</p>
<p><strong>地图交互与展示：</strong></p>
<ul>
<li>MapLibre 地图（暗色风格）呈现；</li>
<li>心愿点位渲染、聚合与热力图层；</li>
<li>点击点位打开心愿详情</li>
</ul>
<p><strong>提交心愿：</strong></p>
<ul>
<li>用户可以输入内容与署名，选择本地头像；</li>
<li>提交前要求同意“定位使用说明”并开启定位权限；</li>
<li>由定位获得经纬度，并写入数据库</li>
</ul>
<p><strong>实时氛围：</strong></p>
<ul>
<li>弹幕展示最新心愿</li>
</ul>
<p><strong>点赞互动：</strong></p>
<ul>
<li>后端数据库 按照IP设置点赞</li>
</ul>
<p><strong>分享：</strong></p>
<ul>
<li>为单条心愿生成 可传播链接；</li>
<li>分享页打开后可直接点赞</li>
</ul>
<p><strong>心愿榜：</strong> 按地区聚合，展示总点赞/心愿数排行</p>
<h4 data-id="heading-7"><strong>3. 输入输出是什么？</strong></h4>
<p><strong>核心输入（用户侧）</strong></p>
<ul>
<li>
<p><strong>内容输入：</strong> 心愿内容 <code>content</code>、署名 <code>author</code>、头像引用 <code>avatar_url</code>。</p>
</li>
<li>
<p><strong>定位输入：</strong> 浏览器  返回 <code>latitude</code> / <code>longitude</code>。</p>
</li>
<li>
<p><strong>互动输入：</strong> 点赞（wishId）、分享（wishId）。</p>
</li>
<li>
<p><strong>隐私/授权输入：</strong> 是否同意定位说明 + 是否授予定位权限。</p>
</li>
</ul>
<p><strong>核心输出（用户侧）</strong></p>
<ul>
<li>
<p><strong>地图层：</strong> 点位、聚合、热力层；可从列表/弹窗聚焦到某个点位。</p>
</li>
<li>
<p><strong>心愿卡片/详情：</strong> 作者、头像、内容、点赞数、时间等。</p>
</li>
<li>
<p><strong>实时氛围：</strong> 弹幕。</p>
</li>
<li>
<p><strong>分享链接：</strong> 可打开指定心愿。</p>
</li>
<li>
<p><strong>点亮编号：</strong> 提交成功后返回全站点亮计数。</p>
</li>
</ul>
<p><strong>API 输入输出（面向系统）</strong></p>
<p>主要接口：</p>
<ul>
<li>
<p><em><strong>POST /wishes</strong></em>：提交心愿（含经纬度、province_id 等）</p>
</li>
<li>
<p>**<em>GET /wishes?limit=...</em> **：拉取已审核心愿</p>
</li>
<li>
<p><em><strong>POST /wishes/{id}/like</strong></em>：点赞（返回最新 likes）</p>
</li>
<li>
<p><em><strong>GET /leaderboard</strong></em>：省份榜</p>
</li>
<li>
<p><em><strong>GET /counter</strong></em>、<em><strong>POST /counter/increment</strong></em>、<em><strong>GET /counter/check-ip</strong></em>：点亮计数 + IP 限制</p>
</li>
<li>
<p><em><strong>POST /shares</strong></em>、**<em>GET /shares/{token}</em> **：分享 token 生成与解析</p>
</li>
<li>
<p>**<em>GET /sse/wishes：</em> **SSE 实时推送</p>
</li>
</ul>
<p><strong>数据库输入输出（核心数据模型）</strong></p>
<p>主表为 <em><strong>public.users</strong></em>（语义上承载“心愿”记录）：</p>
<ul>
<li>
<p><em><strong>id（uuid）</strong></em></p>
</li>
<li>
<p><em><strong>content</strong></em></p>
</li>
<li>
<p><em><strong>author</strong></em></p>
</li>
<li>
<p><em><strong>avatar_url</strong></em></p>
</li>
<li>
<p><em><strong>province_id</strong></em></p>
</li>
<li>
<p><em><strong>location</strong></em></p>
</li>
<li>
<p><em><strong>likes</strong></em></p>
</li>
<li>
<p><em><strong>status</strong></em></p>
</li>
<li>
<p><em><strong>created_at</strong></em></p>
</li>
</ul>
<h4 data-id="heading-8"><strong>4. 依赖哪些组件与数据？</strong></h4>
<p>我在选型时关注的是“快速落地 + 生态成熟 + 可控成本”。</p>
<p><strong>地图：MapLibre GL JS</strong></p>
<ul>
<li>原因：API 成熟、渲染能力强、社区资源多；对“点位 + 聚合 + 交互”非常贴合。</li>
</ul>
<p><strong>前端框架：React + TypeScript</strong></p>
<ul>
<li>原因：页面型项目交付速度快；路由与 API Routes 方便快速搭建接口层。</li>
</ul>
<p><strong>数据库：Supabase</strong></p>
<ul>
<li>原因：TRAE SOLO 可以直接连接，开发非常方便。</li>
</ul>
<p><strong>部署：Vercel</strong></p>
<ul>
<li>原因：TRAE SOLO 一键部署，方便快速展示成果。</li>
</ul>
<blockquote>
<p><strong>实践总结：用 TRAE 加速需求探索</strong></p>
<p>将行业通用的分析框架（如“灵魂四问”）作为 Prompt 的一部分，让 TRAE 扮演“需求分析师”的角色，可以快速产出结构化的思考框架，帮助你理清思路，为后续的设计与开发奠定坚实基础。</p>
<ul>
<li><strong>TRAE 使用细节：</strong> TRAE 国际版 IDE模式，自定义智能体 +GPT-5.2 模型</li>
<li>附头脑风暴自定义智能体分享链接，大家可导入使用：我用 TRAE 做了一个有意思的Agent 「创意引导师」。 点击 <a href="https://link.juejin.cn?target=https%3A%2F%2Fs.trae.ai%2Fa%2F835bc7%3Fregion%3Dsg" target="_blank" title="https://s.trae.ai/a/835bc7?region=sg" ref="nofollow noopener noreferrer">s.trae.ai/a/835bc7?re…</a> 立即复刻，一起来玩吧！</li>
</ul>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f244d09738d41d1b25259409643c4fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=1YQRLfUkdgWDV8wjMbmuCb8Y%2FNk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>第二步：从需求，到可执行的技术方案</strong></h2>
<p>有了清晰的需求，下一步是将其转化为结构化的技术文档。在过去，这通常需要耗费大量时间编写 PRD 和技术设计文档。但借助 TRAE ，这个过程可以被极大地加速。</p>
<p>我为 TRAE 准备了三个核心的 Prompt，分别用于生成<strong>需求文档（PRD）</strong> 、技术文档和任务列表。这些 Prompt 不仅仅是简单的指令，更是一套标准化的“模板”，规定了文档的结构、编写规范和技术栈要求等。</p>
<p><strong>生成项目需求提示词</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">请为 [项目名称] 生成一份完整的需求文档，遵循以下规范：

<span class="hljs-strong">**文档结构要求：**</span>
<span class="hljs-bullet">1.</span> Introduction - 项目概述和背景
<span class="hljs-bullet">2.</span> Glossary - 定义所有关键术语和系统名称
<span class="hljs-bullet">3.</span> Requirements - 详细的需求列表

<span class="hljs-strong">**需求编写规范：**</span>
<span class="hljs-bullet">-</span> 每个需求必须包含 User Story（用户故事）
<span class="hljs-bullet">-</span> 每个需求必须包含 Acceptance Criteria（验收标准）
<span class="hljs-bullet">-</span> 所有验收标准必须使用 EARS 模式之一：
<span class="hljs-bullet">  *</span> Ubiquitous: THE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span></span> SHALL <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span></span>
<span class="hljs-bullet">  *</span> Event-driven: WHEN <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">trigger</span>&gt;</span></span>, THE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span></span> SHALL <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span></span>
<span class="hljs-bullet">  *</span> State-driven: WHILE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">condition</span>&gt;</span></span>, THE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span></span> SHALL <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span></span>
<span class="hljs-bullet">  *</span> Unwanted event: IF <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">condition</span>&gt;</span></span>, THEN THE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span></span> SHALL <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span></span>
<span class="hljs-bullet">  *</span> Optional feature: WHERE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span></span>, THE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span></span> SHALL <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span></span>
<span class="hljs-bullet">  *</span> Complex: [WHERE] [WHILE] [WHEN/IF] THE <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">system</span>&gt;</span></span> SHALL <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">response</span>&gt;</span></span>

<span class="hljs-strong">**质量标准：**</span>
<span class="hljs-bullet">-</span> 使用主动语态，明确说明谁做什么
<span class="hljs-bullet">-</span> 避免模糊术语（如"快速"、"合理"、"用户友好"）
<span class="hljs-bullet">-</span> 不使用代词，使用 Glossary 中定义的具体术语
<span class="hljs-bullet">-</span> 每个标准必须可测试和可验证
<span class="hljs-bullet">-</span> 使用正面陈述（说明系统应该做什么，而非不应该做什么）
<span class="hljs-bullet">-</span> 避免逃避条款（如"在可能的情况下"、"如果可行"）

<span class="hljs-strong">**项目背景：**</span>
[在此描述你的项目想法、目标用户、核心功能等]

请生成符合上述规范的需求文档。
</code></pre>
<p><strong>生写项目技术文档提示词</strong></p>
<p><strong>上下滑动查看完整内容</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">请基于以下需求文档为 [项目名称] 生成一份完整的技术设计文档：

<span class="hljs-strong">**需求文档路径：**</span> [需求文档的路径或内容]

<span class="hljs-strong">**文档结构要求：**</span>
<span class="hljs-bullet">1.</span> Overview - 系统概述、核心功能、技术栈选择
<span class="hljs-bullet">2.</span> Architecture - 系统架构图（使用 Mermaid）、请求流程图
<span class="hljs-bullet">3.</span> Components and Interfaces - 各组件的职责、接口定义、实现要点
<span class="hljs-bullet">4.</span> Data Models - 数据库 Schema、Pydantic/数据模型定义
<span class="hljs-bullet">5.</span> Correctness Properties - 可测试的正确性属性
<span class="hljs-bullet">6.</span> Error Handling - 错误处理策略、错误码定义、日志策略
<span class="hljs-bullet">7.</span> Testing Strategy - 单元测试和属性测试策略

<span class="hljs-strong">**技术栈要求：**</span>
<span class="hljs-bullet">-</span> 编程语言：[指定语言，如 Python/TypeScript/Java]
<span class="hljs-bullet">-</span> Web 框架：[如 FastAPI/Express/Spring Boot]
<span class="hljs-bullet">-</span> 数据库：[如 PostgreSQL/MongoDB/MySQL]
<span class="hljs-bullet">-</span> 缓存/队列：[如 Redis/RabbitMQ]
<span class="hljs-bullet">-</span> 其他技术：[根据需求指定]

<span class="hljs-strong">**Correctness Properties 要求：**</span>
<span class="hljs-bullet">-</span> 在编写 Correctness Properties 之前，必须先完成 prework 分析
<span class="hljs-bullet">-</span> 每个属性必须以 "For any" 或 "For all" 开头（通用量化）
<span class="hljs-bullet">-</span> 每个属性必须标注验证的需求编号： <span class="hljs-strong">**Validates: Requirements X.Y**</span>
<span class="hljs-bullet">-</span> 属性应覆盖所有可测试的验收标准
<span class="hljs-bullet">-</span> 消除冗余属性，确保每个属性提供独特的验证价值

<span class="hljs-strong">**测试策略要求：**</span>
<span class="hljs-bullet">-</span> 明确单元测试和属性测试的互补关系
<span class="hljs-bullet">-</span> 指定属性测试库（如 Hypothesis/fast-check/QuickCheck）
<span class="hljs-bullet">-</span> 每个属性测试至少运行 100 次迭代
<span class="hljs-bullet">-</span> 每个测试必须标注对应的设计属性编号

请生成符合上述规范的技术设计文档。
</code></pre>
<p><strong>生成项目任务列表提示词</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">请基于以下需求文档和设计文档为 [项目名称] 生成一份完整的实现任务列表：

<span class="hljs-strong">**需求文档路径：**</span> [需求文档的路径]
<span class="hljs-strong">**设计文档路径：**</span> [设计文档的路径]

<span class="hljs-strong">**实现语言：**</span> [Python/TypeScript/Java 等]

<span class="hljs-strong">**任务列表要求：**</span>
<span class="hljs-bullet">1.</span> 将设计转换为离散的编码步骤
<span class="hljs-bullet">2.</span> 每个任务必须是可由代码生成 LLM 执行的具体编码任务
<span class="hljs-bullet">3.</span> 任务必须增量构建，每个任务基于前一个任务
<span class="hljs-bullet">4.</span> 最多两层层级（主任务和子任务）
<span class="hljs-bullet">5.</span> 使用复选框格式：<span class="hljs-code">`- [ ] 任务描述`</span>
<span class="hljs-bullet">6.</span> 子任务使用小数编号：<span class="hljs-code">`- [ ] 1.1 子任务描述`</span>

<span class="hljs-strong">**任务内容要求：**</span>
<span class="hljs-bullet">-</span> 每个任务必须引用具体的需求编号： <span class="hljs-emphasis">_需求: X.Y, X.Z_</span>
<span class="hljs-bullet">-</span> 包含属性测试子任务，标注属性编号和验证的需求
<span class="hljs-bullet">-</span> 测试相关子任务标记为可选（后缀 <span class="hljs-code">`*`</span>）：<span class="hljs-code">`- [ ]* 1.2 编写单元测试`</span>
<span class="hljs-bullet">-</span> 在合理的断点添加检查点任务

<span class="hljs-strong">**禁止的任务类型：**</span>
<span class="hljs-bullet">-</span> 用户验收测试或用户反馈收集
<span class="hljs-bullet">-</span> 部署到生产或预发布环境
<span class="hljs-bullet">-</span> 性能指标收集或分析
<span class="hljs-bullet">-</span> 运行应用进行端到端测试（应使用自动化测试）
<span class="hljs-bullet">-</span> 用户培训或文档创建
<span class="hljs-bullet">-</span> 业务流程或组织变更

<span class="hljs-strong">**任务示例格式：**</span>
<span class="hljs-code">```markdown
- [ ] 1. 实现核心功能
  - [ ] 1.1 实现组件 A
    - 编写核心逻辑实现
    - _需求: X.Y, X.Z_
  - [ ]* 1.2 编写属性测试
    - **Property N: [属性标题]**
    - **Validates: Requirements X.Y**
  - [ ] 1.3 实现组件 B
    - 编写支持逻辑
    - _需求: X.Z_

- [ ] 2. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户。
请生成符合上述规范的实现任务列表。
</span></code></pre>
<h3 data-id="heading-10"><strong>2.1  生成项目文档</strong></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/019a5df69a8647048992ba57c3f094fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=ynOYAALbgSkAuXH9YgqeXDeYl1Q%3D" alt="" loading="lazy"/></p>
<p>参考上面的提示词，可以给出  1周年项目文档、 1周年项目技术文档、1周年项目任务列表。</p>
<p>我们需要仔细检查这些文档，然后进行优化和裁剪。</p>
<h4 data-id="heading-11"><strong>1周年项目需求文档举例</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/384138f9d3f247e7bd2039a17c36ca9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=X%2BN%2B0swF%2Bwitr8b%2Fe4oFb78z4Ug%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a37f713875d143078ba22c2017a45efa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=9A2o2S2cDs9sf0g%2B%2Fj1WIQ2M%2Buw%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12"><strong>1周年项目技术文档举例</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95f05f78763e41fa922a8de1f372e347~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=6uFUGWmWzUI%2FB0ZZh0KZxcdTFfY%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/836a0dd9fe224326a06958d1931d4dcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=UxjFlzICiuIfWyplIrLTzbuAmis%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-13"><strong>1周年项目任务列表举例</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f4fd1d138ff44eda0a4c7dfc704e557~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=11ylNbxPtuCymZ8sgcG1ElMGNHI%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6252084ccf0482683c66814a880afbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=7v2CrfqARdzsk4F7%2FANCtZwixHE%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>实践总结：通过 TRAE 将繁琐的文档工作半自动化：</strong></p>
<ul>
<li><strong>保证规范性：</strong> 通过 Prompt 预设模板，确保每份文档都遵循统一的、业界认可的最佳实践</li>
<li><strong>提升效率：</strong> AI 可以快速完成文档的框架搭建和细节填充，将我从重复的写作中解放出来，专注于关键决策的思考和评审</li>
<li><strong>确保一致性：</strong> 从需求、设计到最终的任务拆解，所有文档都基于同一份输入，保证了信息在传递过程中不失真、不遗漏</li>
<li><strong>TRAE 使用细节：</strong> TRAE 国际版 IDE模式+GPT-5.2 模型</li>
</ul>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b203237a8d54018811c4b73631d9ac3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=dbZdTnhWnhD9jKJ5%2FCrKQqYtZro%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14"><strong>第三步：用 TRAE 编码、协作与迭代（社区共创实践）</strong></h2>
<p>文档就位后，开发工作正式开始。这个过程同样深度融合了社区共创与 TRAE 辅助。</p>
<h3 data-id="heading-15"><strong>3.1 基线代码生成：用 TRAE 搭出第一个可用版本</strong></h3>
<p>为了快速验证核心方案，我需要先创建一个能够展示主页功能的地图页面。我向 TRAE 提供了此前生成的全部文档，并给出了具体指令：</p>
<pre><code class="hljs language-markdown" lang="markdown">TRAE 马上迎来 1 周年，我们想在这个节点做一个比较有参与感的小项目：TRAE 一周年许愿地图。
设想是做一个前端页面，用户可以选择自己的省份（中国地图）留下愿望，也可以点开查看其他人的留言，并进行点赞互动。

你是资深前端工程师（TypeScript + React/Next.js）。请严格引用并对齐以下三份文档中的要求，生成一个“带地图的最小展示页面（MVP）”，用于演示地图浏览与点选查看心愿信息。输出必须是可直接落地的代码（文件结构 + 每个文件完整内容），不要输出解释性文字，不要添加任何注释。

引用来源（必须在实现中体现）
1) 任务列表：1周年项目任务列表.md
<span class="hljs-bullet"> -</span> 对齐任务：12.1/12.2/12.3/12.4（地图容器、聚合阈值切换、点选信息展示、移动端适配）

2) 需求文档：1周年项目需求文档.md
<span class="hljs-bullet"> -</span> R-02 地图浏览与交互：地图可交互；zoom 阈值以下显示聚合 markers；阈值以上显示单点；点选展示关联心愿信息
<span class="hljs-bullet"> -</span> R-23 性能要求：低 zoom 使用聚合/聚类（本 MVP 用阈值切换模拟即可）
<span class="hljs-bullet"> -</span> R-24 兼容性与可访问性：移动端布局；键盘可达（至少关闭详情面板可用键盘操作）
3) 技术文档：1周年项目技术文档.md
<span class="hljs-bullet"> -</span> 地图使用 MapLibre GL JS
<span class="hljs-bullet"> -</span> 与“/api/map/points?bbox=&amp;zoom=”接口契约保持一致

MVP 范围（最小可展示）
<span class="hljs-bullet">-</span> 单个页面：MapPage（Next.js 页面或 React 路由页均可，但默认按 Next.js 实现）
<span class="hljs-bullet">-</span> 地图能加载并可缩放/拖拽
<span class="hljs-bullet">-</span> 可访问性：
<span class="hljs-bullet">-</span> 详情面板有“关闭”按钮，支持 Enter/Space 触发；按 Escape 关闭
<span class="hljs-bullet">-</span> 移动端：
<span class="hljs-bullet">-</span> 页面高度自适应；详情面板在窄屏改为底部抽屉（或全屏 modal）


输出要求
1) 先输出文件结构清单（相对路径）
2) 再逐个文件输出完整代码（包含 package.json、next.config.<span class="hljs-emphasis">*、pages 或 app 路由文件、地图页组件、最小数据层、样式文件）
3) 代码必须可运行：给出 npm scripts：dev/build/start
4) 不要写任何“如何运行”的说明文字（只通过 package.json scripts 体现即可）
</span></code></pre>
<p><strong>简单迭代之后，第一个地图版本形成了</strong>，但我注意到提示词中缺少对页面风格的约束和创意，于是我使用 Gemini 3 Pro 200K, 补充了新的指令，让 TRAE 参考 国际版官方风格，同时上传了一张 TRAE 官网截图作为参考，让它基于现有代码修改。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85495ddee53f4a5fbb41d92ada2939dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=OXi95AmyXt%2FZxtvl4CGKCcRz1aM%3D" alt="" loading="lazy"/></p>
<p>经过多轮迭代优化，一个功能完整、风格统一的地图页面便完成了。</p>
<p>前端直接与 Supase 数据库直连，用户可以添加消息到数据库，地图上可以显示用户的留言。</p>
<p>使用 SOLO 中的  Supabae （数据库） 和  Vercel 部署</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6888575d3664e6bae9b8135dfd26f69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=kyGxnyzvvZs1SZ6T3H2cUGSDgWs%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>实践总结：</strong></p>
<p>让 TRAE 生成代码时，务必提供完整的上下文，包括需求文档、技术设计和任务列表。信息越完备，生成的基线代码质量越高，越接近最终目标。</p>
</blockquote>
<h3 data-id="heading-16"><strong>3.2 社区共创：从“使用者”到“共创者”</strong></h3>
<h4 data-id="heading-17"><strong>3.2.1 社区需求收集、任务分配</strong></h4>
<p>基线版本得到了 TRAE 官方同学的认可。于是，我们以此为基础，开始聚集社区里感兴趣的小伙伴进行功能扩展。大家通过线上讨论提出了很多优化方案，我负责收集、确认需求，并分配给参与项目的同学。</p>
<p>期间，通过私聊、多人线上讨论等方式，将需求落地。（部分需求举例）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/226a220e4e284d6687840f403caa9551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=HAqHjKAenFo9tS1174mIVEwD1d0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18"><strong>3.2.2  社区开源项目多人协作模式</strong></h4>
<p>大家通过 Fork 在各自仓库里独立开发，完成后向主仓库发起 PR。我在 PR 中做简单的代码审查，并要求通过基础检查后再合并。这样既能让多人并行开发，也能保证主干分支始终保持可用、稳定的版本。</p>
<blockquote>
<p><strong>所有人 Fork 主仓库独立开发：</strong> 避免互相阻塞，减少冲突。</p>
<p><strong>通过 PR 合并回主干：</strong> 每个 PR 都必须能跑通基础检查，主干始终保持可用。</p>
</blockquote>
<p>在这个过程中，大家也使用 TRAE 来辅助提交代码，自动生成规范的 Commit Message。</p>
<p><strong>通过 TRAE 提交代码</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/068638e53a5c46969f132c861bb8b91f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=cPNvLpo544pG8dBljPimExW1SLc%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3394118135fa49908bf7905219abc4bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=3OCiPYYj9Vmyhj1CjKpHWw8B2wY%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea17bc97b32b4cffb4835d2cf0d60a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=DDhh0h4A6u2D0nUZwfn6Sckn2Yk%3D" alt="" loading="lazy"/></p>
<p><strong>通过PR合并代码到主干</strong></p>
<p>社区伙伴们各自开发，然后通过PR合并到开发主干。（部分PR举例）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cba2df74bbbb499d8717f1988b2a3139~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=FfuZJsBkhDKmLPIv8AG45qZynxk%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>实践总结：</strong></p>
<p>在社区协作中，标准化的流程（如 Fork &amp; PR）和工具（如 TRAE 辅助代码提交）是保持高效和高质量的关键。它能让每个人的贡献都清晰、可追溯。</p>
</blockquote>
<h3 data-id="heading-19"><strong>3.3 增量开发与迭代：让文档和代码形成闭环</strong></h3>
<p>在增加新功能时，我们依然遵循“文档先行”的原则，并利用 TRAE 让文档与代码保持同步。例如，当需要增加新需求时，我们会：</p>
<ol>
<li>
<p>让 TRAE 阅读现有代码和新需求，生成一份实现方案文档。</p>
</li>
<li>
<p>团队评审并确定最优方案。</p>
</li>
<li>
<p>让 TRAE 根据最终方案生成代码。</p>
</li>
<li>
<p>代码实现后，再由 TRAE 提交，完成闭环。</p>
</li>
</ol>
<p>我们可以让TRAE先根据需求，阅读代码，然后生成一个实现文档</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b4b3c1597c64aeea003bd7567a1d03b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=KbwkCfepw9f5yi0ZLBx7%2Fdo9x0k%3D" alt="" loading="lazy"/></p>
<p>TRAE 生成的任务文档</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b40404e3430644f9a9015827787cabc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=Vc10HjjV2cWWnsLYlWs%2FYaoSW18%3D" alt="" loading="lazy"/></p>
<p>仔细阅读上面的文档，然后选择一个最优的方案让TRAE实现</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55c39c527daa436e84ca38b608e7a86d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=yxX9A0lOFdM6yN2HIkyfpFnnUFY%3D" alt="" loading="lazy"/></p>
<p>需求实现之后，让 TRAE提交代码。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d68fd0a792045529c31f9f9ee445f41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=r1gEr%2BoQRam6rWHpYSqYBqCZnwI%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3324e4dd23c440b9b417ce07eacd41a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=K%2BcX%2F1DPIVnCTJRYOBwsOqvHgjc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-20"><strong>3.4 用 TRAE 解决BUG</strong></h3>
<p>项目中，会遇到各种问题，推荐的解决步骤：</p>
<ol>
<li>
<p>让 TRAE 先分析问题，给出一个问题分析文档和推荐的修改方案。</p>
</li>
<li>
<p>我们review 问题的 Root Cause 和 修改建议。</p>
</li>
<li>
<p>确认方案后，让 TRAE 基于分析文档修改代码。</p>
</li>
</ol>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2c482b5a4484a51a72d013fe5fdff84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=Rr4OzuJlzWHiQ8GZf4S1S1htZLA%3D" alt="" loading="lazy"/>图：TRAE 生成的问题分析文档节选</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee7375bb17154c52b2b381cf6e2bdf85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110764&amp;x-signature=eJvU4SigPAIBXRKAGq0rmCxvUkM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-21"><strong>写在最后</strong></h2>
<p>从一个模糊的想法，到最终上线的一份完整作品：这次经历不仅是技术上的实践，更是一次身份的转变——从产品的使用者，到价值的共创者。</p>
<p>在需要频繁切换视角、同时推进多项工作的情况下，<strong>TRAE 更像一个稳定可靠的搭档</strong>：帮我理清需求、输出文档、快速推进实现，也在反复调试和修改中节省了大量时间，让整个共创过程始终保持在可控的节奏里。</p>
<p>这次实践也证明了，在开放的社区中，每一位成员都有机会发起、组织并交付一个有价值的项目。如果你也有好的想法，不妨现在就开始，<strong>借助 TRAE 将创意快速变为现实。</strong></p>
<p>期待在社区里，看到更多伙伴发起和完成属于自己的共创项目。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Skills 实战】AI 编程的下半场：别让 AI 写的代码只活在 localhost 里]]></title>    <link>https://juejin.cn/post/7599630795805016110</link>    <guid>https://juejin.cn/post/7599630795805016110</guid>    <pubDate>2026-01-27T08:45:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795805016110" data-draft-id="7599850148055662601" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Skills 实战】AI 编程的下半场：别让 AI 写的代码只活在 localhost 里"/> <meta itemprop="keywords" content="Agent,Claude,AIGC"/> <meta itemprop="datePublished" content="2026-01-27T08:45:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="binggg"/> <meta itemprop="url" content="https://juejin.cn/user/1609340751972270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Skills 实战】AI 编程的下半场：别让 AI 写的代码只活在 localhost 里
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1609340751972270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    binggg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:45:55.000Z" title="Tue Jan 27 2026 08:45:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d823bb5661e41c08da23e1e7174a837~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=2y4n1f88GO6Zp3aRNlvZh5stVes%3D" alt="企业微信20260127-164344@2x.png" loading="lazy"/></p>
<h2 data-id="heading-0">AI 编程的下半场：别让 AI 写的代码只活在 localhost 里</h2>
<blockquote>
<p>如何把 8 年云端经验装进你的 AI 开发工具，让AI从"实习生"变成"持证上岗的专家"。分享如何用 Agent Skill 解决 AI Coding 领域的痛点问题，也分享如何解决 AI 不调用 Skill 等实践技巧</p>
</blockquote>
<p><strong>【推荐语】</strong></p>
<p>最近我们在折腾 Agent Skills，想把云开发（CloudBase）这些年攒下的经验打包给 AI。实战下来发现，最折磨人的不是 AI 不会写代码，而是它写的代码**“只能活在本地”<strong>，以及它</strong>“总是不听规矩”**。</p>
<p>这篇文章主要分享两点实操复盘，希望能帮大家少走点弯路：</p>
<ol>
<li><strong>让 AI 生成的代码能直接上线</strong>：大家可能都遇到过，AI 写的代码 Demo 感十足，但一上线就全是安全隐患。我们尝试给 AI 注入底座感知，让它学会用底座原生认证代替脆弱的传参，用安全规则代替接口“裸奔”，解决代码“死在本地”的尴尬。</li>
<li><strong>解决“AI 有 Skill 却不爱用”的毛病</strong>：最让人头疼的是，明明配好了 Skills，AI 却视而不见，非要凭直觉盲干。我们会分享如何通过“总纲+插件”的结构，配合简单的工程拦截，把 AI 的技能激活率从 20% 硬拉到 84%。</li>
</ol>
<p>希望能给同样在研究 Skills 和 AI 开发的朋友一点参考，让 AI 交付的代码不再只是“看着挺美”，而是真正稳健。</p>
<hr/>
<h3 data-id="heading-1">现状：Vibe Coding 的 "本地舒适区"</h3>
<p>最近，开发者都在享受 <strong>Vibe Coding</strong> 的快感。在用户本地的 <code>localhost</code> 一顿操作，UI 漂亮得像成品，但魔法往往在“上线”瞬间戛然而止。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/853f8904b7b3487382597a1990a36e96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=q8%2BRiwkok98n08T3sC6hzPhtvnc%3D" alt="" loading="lazy"/></p>
<p>AI 的代码逻辑还不错，但它无法感知真实的后端底座，导致生成的“局部最优解”难以落地，无法简单的生成生产级可用的应用。</p>
<p><strong>世界上最遥远的距离，是从 <code>localhost</code> 到真实访问的距离。</strong> AI 填补了代码量的空白，却填补不了工程底座的断层。</p>
<p>有什么办法可以解决这个问题吗？这里就需要提到 Skills。</p>
<h3 data-id="heading-2">什么是 Skills</h3>
<p>Skills 最早是 Anthropic 在 2025 年 10 月给 Claude Code 加的一个功能，它是一套包含指令、脚本和资源的能力包。<strong>把专业知识、步骤、代码打包成“技能包”</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1ac18a4908c4ece94e592f7e8804dcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=J7stDAtx12bESSt7d7OM83vUDrk%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>Agent Skills 是一种轻量级、开放式的格式，用于通过专业知识和工作流扩展 AI Agent 的能力。</strong></p>
</blockquote>
<p>从本质上讲，一个 Skill 就是一个包含 <code>SKILL.md</code> 文件的文件夹。该文件包含元数据（至少包括 <code>name</code> 和 <code>description</code>）以及告诉 Agent 如何执行特定任务的指令。Skills 还可以捆绑脚本、模板和参考材料。</p>
<pre><code class="hljs language-directory" lang="directory">my-skill/
├── SKILL.md          # 核心：指令 + 元数据
├── scripts/          # 可选：可执行代码
├── references/       # 可选：参考文档
└── assets/           # 可选：模板、资源

</code></pre>
<p>如果把 AI 比作高材生，Skills 就是他的 <strong>“岗位操作手册”。它不改变 AI 的智商，但它通过注入程序性知识</strong>（Procedural Knowledge），让 AI 知道在你的特定环境下，“正确且高效”的操作标准是什么。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a2a07285bb744a39610e4963f0485f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=bLxfK7Oxc2V%2BTSrNls0dKmSfwcg%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.io%2F" title="https://agentskills.io/" target="_blank" ref="nofollow noopener noreferrer">Agent Skill </a>在 2025 年 12 月正式成为开放规范，目前已有包括 Claude、Cursor、VS Code、GitHub Copilot、OpenCode等主流AI开发工具宣布兼容支持。</p>
<h4 data-id="heading-3">Skills 的工作原理：渐进式加载（Progressive Disclosure）</h4>
<p>Skills 通过<strong>渐进式加载</strong>来高效管理上下文（Context），确保 Agent 在拥有强大能力的同时不会因信息过载而变得迟钝：</p>
<ol>
<li><strong>Discovery（发现）</strong>：启动时，Agent 仅加载每个 Skill 的<strong>名称和描述</strong>。这足以让它在处理请求时，判断哪些 Skill 可能与当前任务相关，而不会耗尽上下文窗口。</li>
<li><strong>Activation（激活）</strong>：当任务与某个 Skill 的描述匹配时，Agent 才会按需将该 Skill 的完整 <code>SKILL.md</code> 指令读入当前上下文。</li>
<li><strong>Execution（执行）</strong>：Agent 遵循指令执行任务，并根据需要动态加载引用文件或运行捆绑的脚本代码。</li>
</ol>
<p>这种方法让 Agent 保持极高的响应速度，同时能够像“随身携带百科全书”一样，在需要时立即获取深度专业知识。</p>
<p><strong>行业大佬们已经在行动：</strong></p>
<p><strong>Vercel</strong> 发布了<a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fintroducing-react-best-practices" title="https://vercel.com/blog/introducing-react-best-practices" target="_blank" ref="nofollow noopener noreferrer"> <code>react-best-practices</code></a>，解决 AI 乱写 React 导致的性能问题，将 React 专家十余年经验你浓缩为最佳实践。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a29b31a4b66f42b6b3115039d1122888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=tuQpQYy7%2F8uVAD3gCmTwEh3MNXE%3D" alt="" loading="lazy"/></p>
<p><strong>Remotion</strong> 推出<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FRemotion%2Fstatus%2F2013626968386765291" title="https://x.com/Remotion/status/2013626968386765291" target="_blank" ref="nofollow noopener noreferrer">视频制作 Skill</a>，让 AI 学会用代码"剪辑"视频</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228ec50192de475ebe7b34fa9c2b4f46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=KBRzu70A38Ld6l6lex%2BPC5VZD7s%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F" title="https://skills.sh/" target="_blank" ref="nofollow noopener noreferrer">Vercel 推出了 skills 命令</a>来快速安装 Skills 到各个工具中，这是当前热门的 skills 列表。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db3d6862e16f4aa1bda5dee2695ed3ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=uAD3FMjHDCLkFzWmvQ9uD7HKSBU%3D" alt="" loading="lazy"/></p>
<p>这些 Skills 解决的核心问题是：<strong>让 AI 拥有特定领域的"工程直觉"。</strong></p>
<p>那么，当你的应用需要落地到云端时，谁来给 AI 注入"后端直觉"？</p>
<hr/>
<h3 data-id="heading-4">CloudBase Skills：把 8 年云端经验打包给 AI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb7d1e78f1704d4d9137a45b4f174336~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=OJ5nD6Neu8gF%2ByDY2c7yRyucbIs%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftcb.cloud.tencent.com%2F" title="https://tcb.cloud.tencent.com/" target="_blank" ref="nofollow noopener noreferrer">云开发 CloudBase</a> 作为自 2018 年起就推出 Serverless 服务的团队，也推出<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentCloudBase%2FSkills" title="https://github.com/TencentCloudBase/Skills" target="_blank" ref="nofollow noopener noreferrer">CloudBase Skills</a>。</p>
<p><strong>Skills 是软件层面的“岗位手册”，而 CloudBase 则是承载代码落地的“全栈底座”。</strong></p>
<p>许多 AI 生成的代码之所以“死在本地”，是因为 AI 往往只负责写逻辑，却不知道如何对接复杂的生产环境。CloudBase 为 AI 提供了一套高度抽象的基础设施，让 AI 写出的逻辑能无缝运行在公网：</p>
<ul>
<li><strong>全栈托管与部署能力</strong>：支持前端静态网页与后端逻辑的快速部署，让项目从 <code>localhost</code> 真正变成可访问的在线 URL。</li>
<li><strong>多端原生身份认证</strong>：打通了 Web、小程序等多种身份源。AI 无需手写复杂的登录逻辑，通过 Skills 直接调用底座的认证能力，实现秒级接入。</li>
<li><strong>数据库底座</strong>：同时提供文档型（NoSQL）与 SQL 型数据库能力。更重要的是，底座原生集成了面向 C 端的权限控制机制，确保 AI 生成的每一行查询都运行在物理隔离的安全沙箱中，从根源规避越权风险。</li>
</ul>
<p>它将 CloudBase 支撑<strong>日均 10 亿次 API 调用</strong>、服务<strong>超过 330 万开发者</strong>的真实经验，翻译成了 AI 听得懂的指令。</p>
<p>举一些 CloudBase Skills 如何为 AI 注入生产级标准的场景：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/779765422f7540bc8d5d9eadbc9795e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=RzsaARUvHU%2FSvJocxFfKrizVBkg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">场景一：身份认证——拒绝“相信前端输入”</h3>
<h4 data-id="heading-6">错误做法</h4>
<p>习惯于让前端通过 <code>userId</code> 传参给后端。</p>
<ul>
<li><strong>风险</strong>：这是典型的“防君子不防小人”。攻击者只需拦截请求并修改参数，即可实现<strong>横向越权</strong>，访问任何人的私密数据。</li>
</ul>
<h4 data-id="heading-7">正确做法</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1922ca87eaf941d0b3e187f6cd2c50bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=sxJ%2B3Km0mOaBqkcx5BceLwL3PsU%3D" alt="" loading="lazy"/></p>
<p>加载 <code>auth-wechat</code> Skill 后，AI 会被强制要求放弃前端传参，转而利用云底座的<strong>原生链路</strong>。</p>
<ul>
<li><strong>Before (脆弱逻辑)</strong>:</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 实习生 AI：相信用户传来的 ID</span>
<span class="hljs-keyword">const</span> { openid } = event.<span class="hljs-property">params</span>; 
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>).<span class="hljs-title function_">doc</span>(openid).<span class="hljs-title function_">get</span>();

</code></pre>
<ul>
<li><strong>After (生产级标准)</strong>:</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 专家 AI：利用底座原生上下文，不可伪造</span>
<span class="hljs-keyword">const</span> { <span class="hljs-variable constant_">OPENID</span> } = cloud.<span class="hljs-title function_">getWXContext</span>(); 
<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>).<span class="hljs-title function_">doc</span>(<span class="hljs-variable constant_">OPENID</span>).<span class="hljs-title function_">get</span>();

</code></pre>
<blockquote>
<p><strong>工程准则</strong>：安全性应由底座的<strong>原生互信</strong>保证，而非依赖前端输入的自觉。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">场景二：数据安全——从“接口裸奔”到“行权限”</h3>
<h4 data-id="heading-9">错误做法</h4>
<p>倾向于直接暴露数据库接口。如果你的 API 逻辑稍有疏忽，数据库对攻击者几乎是“裸奔”状态。</p>
<h4 data-id="heading-10">正确做法</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89f2a551bb0b46ed9d35aaee0157d65a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=VczPHljIah5FRPAguryqJCM%2Beyo%3D" alt="" loading="lazy"/></p>
<p>Skill 会引导 AI 将权限校验 <strong>下沉到数据库入口</strong>，直接驱动底座的 <strong>安全规则（Security Rules）</strong>。</p>
<ul>
<li><strong>实现改变</strong>：不再单纯写查询逻辑，而是为集合定义 <code>auth.uid == doc._openid</code> 规则。</li>
<li><strong>价值</strong>：<strong>防御性编程的闭环。</strong> 即使业务逻辑代码出现 Bug，底座依然能从物理层面拦截任何非本人数据的越权修改。</li>
</ul>
<hr/>
<h3 data-id="heading-11">场景三：AI 集成——消灭 Hardcoded，三行代码闭环</h3>
<p>接入大模型是当前最热的需求，但 AI 往往给出的是“Demo 级”的代码，完全忽略了生产环境的安全与高可用要求。</p>
<h4 data-id="heading-12">错误做法</h4>
<p>将 API Key 硬编码在前端，写出一坨混乱的逻辑来处理流式输出（Streaming），既不安全也不稳定。</p>
<h4 data-id="heading-13">正确做法</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00a0d8fb2ff748bca652b150a38dd4c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=hNTZLry1SKwA5irTwTWVvj46f1Y%3D" alt="" loading="lazy"/></p>
<p>Skill 注入了生产级 AI 接入规范，将复杂的封装逻辑简化为底层 SDK 的原生调用。</p>
<ul>
<li><strong>安全加固</strong>：Key 自动托管在云端环境变量，前端实现 <strong>“零泄露”</strong>。</li>
<li><strong>几行代码调用 AI 大模型</strong> ，自动处理流式响应。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// CloudBase Skills 实现的生产级 AI 调用</span>
<span class="hljs-keyword">const</span> model = wx.<span class="hljs-property">cloud</span>.<span class="hljs-property">extend</span>.<span class="hljs-property">AI</span>.<span class="hljs-title function_">createModel</span>(<span class="hljs-string">"hunyuan-exp"</span>);

<span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> model.<span class="hljs-title function_">streamText</span>({
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">model</span>: <span class="hljs-string">"hunyuan-turbos-latest"</span>,
    <span class="hljs-attr">messages</span>: [{ <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"介绍一下李白"</span> }],
  }
});

<span class="hljs-comment">// 使用 textStream 获取增量文本</span>
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> text <span class="hljs-keyword">of</span> res.<span class="hljs-property">textStream</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"文本片段:"</span>, text);
}

</code></pre>
<h3 data-id="heading-14">核心价值</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c2acfb57a904ebfb574ef6483a9b252~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=Qv48qwXlaGtB0cGjmdNM%2FjEti9k%3D" alt="" loading="lazy"/></p>
<p><strong>“AI 提供了逻辑的上限，而 CloudBase Skills 守住了工程的下限。”</strong></p>
<hr/>
<h3 data-id="heading-15">安装 CloudBase Skills</h3>
<p>在你的终端输入以下命令，为你的 AI 助手注入“生产级直觉”：</p>
<pre><code class="hljs language-bash" lang="bash">npx skills add tencentcloudbase/skills
</code></pre>
<p>即可安装我们提供的多个 Skills 到你的开发工具中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6e2adedcbf141db956be0b7186e8bea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=u0gd0LQVLIELAEtFYvaT0U3n5jk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">CloudBase Skills 完整列表</h4>
<p>我们将 Skills 按照实际开发中的职能进行了归类，确保 AI 在不同环境下调用正确的 SDK 和工具。</p>
<p>这种分类不仅是为了方便开发者查阅，更是为了在 Discovery（发现阶段）降低 AI 的认知负荷，实现精准的按需挂载。</p>
<h5 data-id="heading-17">核心理念：环境即边界（Environment as Boundary）</h5>
<p>在展开列表前，我们需要阐述这套架构的底层设计：总纲路由，三端隔离。</p>
<ul>
<li><strong>物理隔离</strong>：Web、小程序、Node.js 的同名方法逻辑各异。我们将它们拆分为独立插件，从物理层面杜绝 AI 在小程序里写出 Web SDK 语法的语义污染。</li>
<li><strong>总纲引导</strong>：cloudbase-guidelines 是所有任务的默认入口。它像一个语义路由器，先判定项目环境，再指引 AI 激活对应的子 Skill。</li>
</ul>
<h4 data-id="heading-18">完整技能矩阵</h4>
















































































<table><thead><tr><th>分类</th><th>核心 Skills</th><th>核心职能与实战要点</th></tr></thead><tbody><tr><td><strong>必读总纲</strong></td><td>cloudbase-guidelines</td><td>全局入口。判定 Web/小程序/后端环境，负责架构导航与全局防错规矩。</td></tr><tr><td><strong>AI 扩展</strong></td><td>ai-model-nodejs</td><td>服务端专用。支持文本、流式及图像生成。唯一支持 Node SDK 3.16.0+ 图像能力的 Skill。</td></tr><tr><td/><td>ai-model-web / -wechat</td><td>前端专用。分别适配浏览器与小程序环境。注意小程序端 API 不同，且不支持图像生成。</td></tr><tr><td><strong>身份鉴权</strong></td><td>auth-nodejs / -web / -wechat</td><td>三端隔离。解决 Web 端的登录、小程序原生身份以及服务端的自定义 Ticket 逻辑。</td></tr><tr><td/><td>auth-tool</td><td>MCP 专用。通过 callCloudApi 直接配置短信、匿名、第三方登录等后台开关。</td></tr><tr><td><strong>数据库</strong></td><td>no-sql-web-sdk / -wx-mp-sdk</td><td>文档数据库。适配 Web 与小程序 SDK 的查询、创建、更新、删除及地理位置查询。</td></tr><tr><td/><td>relational-database-tool</td><td>关系型数据库。AI 专用 SQL 执行工具，内置生产数据保护机制，严禁裸写 SQL。</td></tr><tr><td/><td>relational-database-web</td><td>SQL-on-Web。前端通过 SDK 访问关系型数据库的标准初始化与查询模式。</td></tr><tr><td><strong>计算与存储</strong></td><td>cloud-functions</td><td>Serverless 核心。涵盖运行时选择、部署、日志、异步调用与 HTTP 访问配置。</td></tr><tr><td/><td>cloudrun-development</td><td>容器化模式。针对长连接、多语言或 AI Agent 需要的容器云环境开发规范。</td></tr><tr><td/><td>cloud-storage-web</td><td>文件管理。Web 环境下的上传、下载、临时链接生成及文件管理最佳实践。</td></tr><tr><td><strong>研发流与 UI</strong></td><td>spec-workflow</td><td>工程标准化。从需求分析到技术设计的标准 SOP，提升复杂项目的确定性。</td></tr><tr><td/><td>ui-design</td><td>审美基准。提供生产级的组件设计建议与 UI 规范，确保前端界面具备专业视觉品质。</td></tr><tr><td/><td>web / miniprogram</td><td>平台规则。针对 Web 静态托管或小程序开发（含企业微信、wx.cloud 模式）的专项规则。</td></tr></tbody></table>
<h3 data-id="heading-19">MCP vs Skills</h3>
<p>在构建 AI 原生开发生态的道路上，我们始终坚持“先打通，再优化”的逻辑。</p>
<h4 data-id="heading-20">CloudBase MCP：早已就绪的“工程双手”</h4>
<p>事实上，云开发 CloudBase 在 2025 年上半年的时候就推出了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentCloudBase%2FCloudBase-MCP" title="https://github.com/TencentCloudBase/CloudBase-MCP" target="_blank" ref="nofollow noopener noreferrer">CloudBase MCP</a>。作为 Anthropic 推出的行业标准协议，MCP 解决的是“连接”问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1479cd10e2a40179aa28d0e30942773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=2QFKcj4Itp550nUiN3D6meYcF6g%3D" alt="" loading="lazy"/></p>
<p>通过 MCP，我们让 AI 助手真正拥有了操作腾讯云底座的<strong>结构化权限</strong>。它不再只是在对话框里写代码，而是能直接查询云端状态、创建资源、拉取日志。目前，CloudBase MCP 已经支持了包括 Cursor、Claude Desktop、VS Code 在内的多种主流工具，帮助大量开发者实现了 AI 与云端的物理连接，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2Fai%2Fcloudbase-ai-toolkit%2F" title="https://docs.cloudbase.net/ai/cloudbase-ai-toolkit/" target="_blank" ref="nofollow noopener noreferrer">查看具体使用指引</a>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/033989932fb84891841ba5b33d8d7c2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=k0%2Bfiggvdz1G2qHMdUymdpBlMfg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-21">CloudBase Skills：后发制人的“岗位手册”</h4>
<p>既然有了 MCP 这双强有力的“手”，为什么我们还要推出 Skills？</p>
<p><strong>如果说 MCP 是让 AI “有权限”干活，那么 Skills 就是让 AI “懂规矩”干活。</strong></p>
<p>在我们的规划中，Skills 是更上层的能力封装：</p>
<ul>
<li><strong>不仅仅是脚本</strong>：虽然 Skills 规范支持包含脚本（Scripts），但我们现阶段更侧重于**“程序性知识（Procedural Knowledge）”的注入**。</li>
<li><strong>更安全、更通用的专家直觉</strong>：正如前文提到的，AI 有了 MCP 虽然能执行脚本，但在云端生产环境，盲目执行脚本不仅不安全，也不符合工程规范。Skills 则是把我们 8 年的云端填坑经验（如行权限隔离、原生上下文认证）变成 AI 的<strong>直觉</strong>。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21dae09e367943b1bfde600d9d38e65b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=tM%2BS1bgIVDBg%2FjIyE9jHqVZQh6w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-22">为什么它们是黄金组合？</h4>
<p>你可以单独使用其中之一，但组合使用才是 AI 编程的“终极形态”：</p>
<p><strong>“MCP 提供了标准化的安全连接，而 Skills 提供了生产级的工程直觉。”</strong></p>
<p>两者搭配，让 AI 从一个 <strong>“力气大但鲁莽的实习生”</strong> ，真正进化为一个**“懂规矩、有权限”** 的资深云开发专家。</p>
<h3 data-id="heading-23">实战案例</h3>
<p>CodeBuddy IDE 中已经内置了 CloudBase MCP 和 Skills，在连接 CloudBase 之后会自动下载 Skills 到你项目中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/085a8c2399ed4502bacecbcad43ee99b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=emVgrCMHvOL0VpZhYStG48zvg6s%3D" alt="" loading="lazy"/></p>
<p>这里有一篇教程教你用免费云开发资源与混元Token，手把手教你用 AI 来开发一个 AI 小程序。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/885dddcaa88041979d659c29c01e48fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=m0NF9dQcHryx%2B%2FzHeLmznKGCctM%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FeB0x7Jc1lKP13dBMY9wsgw" target="_blank" title="https://mp.weixin.qq.com/s/eB0x7Jc1lKP13dBMY9wsgw" ref="nofollow noopener noreferrer">查看完整教程</a></p>
<p>还可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cloudbase.net%2Fai%2Fcloudbase-ai-toolkit%2Ftutorials" title="https://docs.cloudbase.net/ai/cloudbase-ai-toolkit/tutorials" target="_blank" ref="nofollow noopener noreferrer">查看更多入门视频教程和文章</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/332df213e5074eaa8022117f5adb8870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYmluZ2dn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110127&amp;x-signature=fCfLaVG9qSIEB9Pd%2FANKZH8XtXw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-24">终章：Skills 落地踩坑与实战复盘</h3>
<p>在做这套 Skills 的过程中，我们最大的感触是：<strong>现在的 AI 编程，其实处于一个“高智商、低纪律”的阶段。</strong> 别看各大工具都号称支持 Skills，真用起来全是坑。</p>
<p>以下是几个我们里跟 AI “斗智斗勇”换来的经验教训：</p>
<h4 data-id="heading-25">1. 现状：AI 为什么会“装死”？</h4>
<p>明明配了 Skill，AI 还是视而不见。这背后的原因其实涉及大模型的两个底层逻辑：</p>
<ul>
<li><strong>注意力权重（Attention Bias）</strong>：在大模型的 Transformer 架构中，它会根据你的 Prompt 实时计算每个词的权重。当你聊得越深，你提的业务需求权重就会越高，而作为背景板的外部 Skills 权重就会被“稀释”。</li>
<li><strong>决策惰性（Inference Laziness）</strong>：调用 Skill 本质上是一次 <strong>Tool Use（工具调用）</strong>。模型在推理时会进行“路径评估”：如果它觉得自己脑子里的预训练数据（通常是 Localhost 模式）就能生成一段“看起来正确”的代码，它就会为了节省推理资源而跳过外部工具调用。</li>
<li><strong>激活率落差</strong>：在我们的回归测试中，如果不加干预，AI 的主动调用率只有 <strong>20%</strong> 左右。它宁愿“盲目裸奔”，也不愿意翻书。</li>
</ul>
<h4 data-id="heading-26">2. “驯服” AI 的三套硬核解法</h4>
<p>既然 AI 会产生决策惰性，我们就得用工程手段拉高它的“警觉性”。</p>
<h5 data-id="heading-27">方案 A：最土但最稳的“首行注入”</h5>
<p>如果你的项目不容许犯错，就在提问的最开头带上这句“咒语”：</p>
<blockquote>
<p><strong>You MUST read the cloudbase-guidelines skill FIRST when working with CloudBase projects.</strong></p>
</blockquote>
<ul>
<li><strong>原理</strong>：利用 <strong>首因效应（Primacy Effect）</strong>。模型对输入序列最前端的信息具有天然的高关注度。通过这种强行注入，能把 Skill 的激活率拉升。</li>
</ul>
<p>强烈建议大家在试用过程中也带上这句 Prompt，或者按照方案 B 来执行。</p>
<h5 data-id="heading-28">方案 B：项目级的“家法” (System Rules)</h5>
<p>在项目根目录创建 <code>CLAUDE.md</code> 或 <code>AGENT.md</code>，增加项目级别的约束规则。这样就不用每次都在 prompt 中 携带上面的咒语，不过这个方法也存在一定的缺陷，相比每次都首行注入，随着对话的上下文越来越长，也会存在 AI 不遵循的情况，接下来就可以看看方案 3 的解法。</p>
<pre><code class="hljs language-markdown" lang="markdown">

<span class="hljs-section"># CloudBase Workflow</span>

<span class="hljs-bullet">0.</span> You MUST read the cloudbase-guidelines skill FIRST when working with CloudBase projects.
<span class="hljs-bullet">1.</span> 评估：写代码前，必须显式评估可用 Skills 列表。
<span class="hljs-bullet">2.</span> 承诺：必须在输出中陈述“我需要调用某个 Skill”的理由。
<span class="hljs-bullet">3.</span> 执行：禁止跳过规矩直接写代码。

</code></pre>
<h4 data-id="heading-29">方案 3：自动化“强制拦截” (Forced Eval Hook)</h4>
<p>如果说前两个方案是靠“嘴”叮嘱 AI，那方案 3 就是靠**“物理拦截”**</p>
<p>技术专家 Scott Spence 在他的实测中发现，最有效的方式是利用编辑器的 <strong>Hook（钩子）机制</strong>。</p>
<ul>
<li><strong>它的本质是“中间件”</strong>：这不再是你手动输入的 Prompt。通过配置（如 <code>.claude/settings.json</code>），脚本会在你按下回车的那一刻，自动拦截并“魔改”你的问题。</li>
<li><strong>强制“表态”才能“干活”</strong>：这个钩子会强制 AI 在输出任何代码前，必须先生成一段 <strong>评估报告</strong>。AI 必须逐一陈述：<em>“当前有哪些 Skill 可用？针对这个需求，我需不需要调用它们？理由是什么？”</em></li>
<li><strong>消除“决策惰性”</strong>：AI 有个毛病，只要它觉得脑子里的旧数据能糊弄过去，它就不会翻书。但这种 Hook 强迫 AI 必须白纸黑字写下“我要用这个工具”，一旦它在开头表了态，后面的代码生成就会严格遵守这个承诺。</li>
<li><strong>激活率的质变</strong>：根据 Scott 的数据，这种“拦截+评估”的手段能将激活率从 <strong>20% 暴力拉升到 84%</strong></li>
</ul>
<p>延伸阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Fscottspence.com%2Fposts%2Fhow-to-make-claude-code-skills-activate-reliably" title="https://scottspence.com/posts/how-to-make-claude-code-skills-activate-reliably" target="_blank" ref="nofollow noopener noreferrer">How to Make Claude Code Skills Activate Reliably</a></p>
<h4 data-id="heading-30">3. 架构复盘：为什么必须是“总纲 + 独立插件”？</h4>
<p>在开发过程中，我们发现 AI 最大的毛病是**“端不分”**。它分不清小程序、Web 和 Node.js 的环境边界。我们没有搞一个“全家桶” Skill，而是采用了 <strong>“1 个总纲 (Guidelines) Skill + 21 个独立 Skill”</strong> 的分布式架构。这背后有三个核心逻辑：</p>
<h5 data-id="heading-31">A. 解决“语义污染”与环境误判</h5>
<p>Web、小程序、Node.js 的 SDK 方法名极其相似（如都有 <code>init</code>, <code>callFunction</code>）。</p>
<ul>
<li><strong>痛点</strong>：如果全塞进一个 Skill，AI 经常在写小程序逻辑时，顺手掏出 Web 端的语法。这种<strong>语义污染</strong>是造成代码无法上线的元凶。</li>
<li><strong>解法</strong>：我们将 Skill 按端进行物理拆分。配合 <code>cloudbase-guidelines</code> 这种 <strong>“入口点” (Entry Point)</strong> ，先指挥 AI 判定项目环境（如：识别到 <code>app.json</code> 即为小程序）。</li>
<li><strong>收益</strong>：环境判定后，AI 只会加载相关的子 Skill。这把干扰项直接屏蔽掉，<strong>搜索空间缩小了 90%，推理精度自然大幅提升。</strong></li>
</ul>
<h5 data-id="heading-32">B. 开发者可以“精准点菜”</h5>
<ul>
<li><strong>痛点</strong>：全能包（单体架构）太重。当你想让 AI 专门解决“微信支付”或“安全规则”这种特定问题时，AI 的注意力会被庞大的全量手册稀释。</li>
<li><strong>解法</strong>：独立插件支持<strong>局部强化</strong>。你可以直接下令：<em>“调用 <code>auth-web</code> 检查实现手机号登录”</em>。</li>
<li><strong>收益</strong>：这种设计允许开发者直接干预 AI 的决策路径。在 AI 逻辑混乱时，通过唤起特定子 Skill 强行把它的思维拉回到正确的窄道上。</li>
</ul>
<h3 data-id="heading-33">未来规划</h3>
<p>我们将持续推出：</p>
<ul>
<li>小程序集成微信支付集成技能</li>
<li>小程序集成虚拟支付技能</li>
<li>小游戏集成云开发技能</li>
<li>云函数部署全栈后端应用技能</li>
<li>更多全栈应用开发模板和技能等</li>
</ul>
<p>欢迎访问</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentCloudBase%2FSkills" title="https://github.com/TencentCloudBase/Skills" target="_blank" ref="nofollow noopener noreferrer">CloudBase Skills GitHub 仓库</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencentCloudBase%2FCloudBase-MCP" title="https://github.com/TencentCloudBase/CloudBase-MCP" target="_blank" ref="nofollow noopener noreferrer">CloudBase MCP GitHub 仓库</a></p>
<p>了解更多详情！</p>
<h3 data-id="heading-34">写在最后：从“代码生成”到“生产级交付”的跨越</h3>
<p>折腾了这么多 Skills 之后，我们最大的感触是：<strong>AI 编程的生产力，不取决于模型能写出多么精妙的逻辑，而取决于你对它生成的代码具备多少“工程约束力”。</strong></p>
<h4 data-id="heading-35">1. 核心本质：将“隐性经验”转化为“程序性知识”</h4>
<p>目前的 Agent 依然处于“高智商、零经验”的状态，它们是博学的“实习生”，却对真实的物理底座缺乏敬畏。
<strong>CloudBase Skills 的本质，是给 AI 注入一套工程化的“肌肉记忆”。</strong> 通过 <code>guidelines</code> 的语义导航和原子 Skill 的强约束，我们将云开发八年来沉淀的填坑经验（如行权限隔离、多端原生上下文、高并发限流）转化为了 AI 的<strong>前置判定条件</strong>。这种**程序性知识（Procedural Knowledge）**的注入，让 AI 真正理解了“正确且安全”的交付标准。</p>
<h4 data-id="heading-36">2. 范式转换：Agent 必须具备“环境感知力”</h4>
<p>Agent 进化的下一站，不仅仅是 Reasoning（推理）的增强，更是对 <strong>Infrastructure（基础设施）感知力</strong>的补齐。</p>
<ul>
<li><strong>Skills 守住工程下限</strong>：它是一套“防呆协议”。通过场景化工作流和报错锚点，强制 AI 在编写阶段就化解鉴权漏洞和多端环境差异，彻底终结“代码只活在 <code>localhost</code>”的幻觉。</li>
<li><strong>CloudBase 承载逻辑上限</strong>：作为全栈底座，它让 AI 的逻辑输出不再是网页里的文本，而是能直接部署、调通、并产生真实业务价值的生产级资源。</li>
</ul>
<h4 data-id="heading-37">3. 确定性是 AI 开发的唯一度量衡</h4>
<p>我们不应该期待 AI 自动变得“完美”，而应该通过工程手段让它变得“稳定”。
<strong>AI 提供逻辑的上限，Skills 守住工程的下限，而 CloudBase 则是承载这一切的物理底座。</strong></p>
<p>我们正处于从“氛围感编程 (Vibe Coding)”向“生产级交付”跨越的节点。如果你也厌倦了在对话框里修 Bug，欢迎安装 CloudBase Skills。给你的 AI 立个规矩，让它真正从一个“聊天搭子”进化为能帮你上线产品的“资深合伙人”。</p>
<hr/>
<p>如有问题或建议，欢迎在评论区交流</p>
<h3 data-id="heading-38">名词解释</h3>
<ul>
<li><strong>Vibe Coding</strong>：一种依赖 AI 直觉、快速生成原型但缺乏工程严谨性的编程方式。</li>
<li><strong>Procedural Knowledge</strong>：程序性知识。指关于“如何操作”的知识，让 AI 掌握特定场景下的标准作业流程（SOP）。</li>
<li><strong>MCP</strong>：模型上下文协议。AI 的**“连接器”**，让其能直接操作数据库、文件系统或云资源。</li>
<li><strong>Agent Skills</strong>：能力插件包。AI 的**“专家手册”**，注入特定领域的最佳实践和工程规范。</li>
<li><strong>横向越权</strong>：安全漏洞。指攻击者通过篡改 ID 等参数，非法访问到同级别其他用户的数据。</li>
<li><strong>安全规则</strong>：底座级权限控制。在数据库入口处强制执行访问校验，是防御越权的核心手段。</li>
</ul>
<h3 data-id="heading-39">立即开始</h3>
<p>在你的终端输入以下命令，为你的 AI 助手注入“生产级直觉”：</p>
<pre><code class="hljs language-bash" lang="bash">npx skills add tencentcloudbase/skills
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[containerd2.x接入Harbor仓库方法]]></title>    <link>https://juejin.cn/post/7599765329410146344</link>    <guid>https://juejin.cn/post/7599765329410146344</guid>    <pubDate>2026-01-27T07:49:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599765329410146344" data-draft-id="7599852579066707983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="containerd2.x接入Harbor仓库方法"/> <meta itemprop="keywords" content="数据库,开源"/> <meta itemprop="datePublished" content="2026-01-27T07:49:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smoothcloud_润云"/> <meta itemprop="url" content="https://juejin.cn/user/2948233128844891"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            containerd2.x接入Harbor仓库方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2948233128844891/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smoothcloud_润云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:49:05.000Z" title="Tue Jan 27 2026 07:49:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心配置结构说明</h2>
<p>containerd 2.x 对镜像仓库配置进行了结构化优化，所有相关配置均集中在 <code>/etc/containerd/certs.d/</code> 目录下，遵循 "一仓库一目录" 的配置原则：</p>
<ul>
<li>每个镜像仓库（registry）对应一个独立目录，目录名需与仓库域名（或 IP 地址）完全一致</li>
<li>每个目录下必须包含一个 <code>hosts.toml</code> 文件，用于定义仓库连接参数</li>
<li><code>hosts.toml</code> 核心配置项：仓库服务地址（server）、操作权限（capabilities）、认证信息（auth）、证书验证开关（skip_verify）</li>
</ul>
<h2 data-id="heading-1">二、分步配置实战</h2>
<h3 data-id="heading-2">1. 版本确认</h3>
<p>首先通过以下命令验证 containerd 版本是否为 2.x 系列：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">root@k8s-master ~</span>]<span class="hljs-meta"># containerd --version</span>
containerd containerd.io v2<span class="hljs-number">.2</span><span class="hljs-number">.0</span> <span class="hljs-number">1</span>c4457e00facac03ce1d75f7b6777a7a851e5c41
</code></pre>
<h3 data-id="heading-3">2. 创建配置目录</h3>
<p>根据 Harbor 仓库地址创建对应的配置目录，目录名需与仓库域名（或 IP）严格匹配（示例中 Harbor 仓库地址为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fharbor.liyb.com" target="_blank" title="https://harbor.liyb.com" ref="nofollow noopener noreferrer">harbor.liyb.com</a>）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /etc/containerd/certs.d/harbor.liyb.com
</code></pre>
<blockquote>
<p>注意：若仓库未使用域名（直接通过 IP 访问），可直接以 IP 地址作为目录名（如 <code>/etc/containerd/certs.d/192.168.1.100</code>）</p>
</blockquote>
<h3 data-id="heading-4">3. 编写 hosts.toml 配置文件</h3>
<p>创建并编辑 <code>hosts.toml</code> 文件，配置仓库连接参数：</p>
<pre><code class="hljs language-bash" lang="bash">vi /etc/containerd/certs.d/harbor.liyb.com/hosts.toml
</code></pre>
<p>添加如下配置内容：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">server</span> = <span class="hljs-string">"https://harbor.liyb.com"</span>

<span class="hljs-section">[host."https://harbor.liyb.com"]</span>
<span class="hljs-attr">capabilities</span> = [<span class="hljs-string">"pull"</span>, <span class="hljs-string">"resolve"</span>, <span class="hljs-string">"push"</span>]  <span class="hljs-comment"># 支持的操作：拉取、解析、推送</span>
<span class="hljs-attr">skip_verify</span> = <span class="hljs-literal">true</span>  <span class="hljs-comment"># 自签名证书时启用（跳过证书验证）</span>
<span class="hljs-section">[host."https://harbor.liyb.com".auth]</span>
<span class="hljs-attr">username</span> = <span class="hljs-string">"admin"</span>  <span class="hljs-comment"># Harbor 登录用户名</span>
<span class="hljs-attr">password</span> = <span class="hljs-string">"Harbor12345"</span>  <span class="hljs-comment"># Harbor 登录密码</span>
</code></pre>
<blockquote>
<p>配置说明：</p>
<ul>
<li>若使用企业级可信证书，无需设置 <code>skip_verify = true</code>，只需将 CA 证书文件放置到对应配置目录（如 <code>/etc/containerd/certs.d/harbor.liyb.com/</code>）即可</li>
<li>权限配置可根据实际需求调整，例如仅需拉取镜像时可改为 <code>capabilities = ["pull", "resolve"]</code></li>
</ul>
</blockquote>
<h3 data-id="heading-5">4. 确认主配置文件路径</h3>
<p>检查 containerd 主配置文件 <code>/etc/containerd/config.toml</code> 中是否正确指定了仓库配置路径，确保以下配置项存在且无误：</p>
<p>toml</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># /etc/containerd/config.toml</span>
<span class="hljs-section">[plugins."io.containerd.grpc.v1.cri".registry]</span>
<span class="hljs-attr">config_path</span> = <span class="hljs-string">"/etc/containerd/certs.d"</span>  <span class="hljs-comment"># 仓库配置目录路径（默认已启用）</span>
</code></pre>
<blockquote>
<p>注意：containerd 2.x 默认启用该配置，但生产环境部署时务必手动校验，避免路径配置错误导致配置失效</p>
</blockquote>
<h2 data-id="heading-6">三、配置验证方法</h2>
<h3 data-id="heading-7">1. 使用 nerdctl 验证（推荐）</h3>
<p>通过 nerdctl 工具拉取 Harbor 仓库镜像，验证配置是否生效：</p>
<pre><code class="hljs language-bash" lang="bash">nerdctl pull harbor.liyb.com/prod/nginx:1.27
</code></pre>
<p>成功输出示例：</p>
<p>plaintext</p>
<pre><code class="hljs language-bash" lang="bash">harbor.liyb.com/prod/nginx:1.27: manifest-sha256:114dff0fc8ee3d0200c3a12c60e3e2b79d0920dd953175ecb78a0b157425b25e: <span class="hljs-keyword">done</span>
config-sha256:1e5f3c5b981a9f91ca91cf13ce87c2eedfc7a083f4f279552084dd08fc477512: <span class="hljs-keyword">done</span>
elapsed: 0.1 s
total: 0.0 B (0.0 B/s)
</code></pre>
<h3 data-id="heading-8">2. Kubernetes 节点验证</h3>
<p>在 Kubernetes 节点上通过 crictl 工具拉取镜像（适用于 K8s 集群环境）：</p>
<pre><code class="hljs language-bash" lang="bash">crictl pull harbor.liyb.com/prod/nginx:1.27
</code></pre>
<blockquote>
<p>关键注意点：镜像名称必须显式包含 Harbor 仓库地址（完整格式：仓库地址 / 项目名 / 镜像名：标签），否则会导致 K8s Pod 拉取镜像失败</p>
</blockquote>
<h2 data-id="heading-9">四、高频踩坑与解决方案</h2>






























<table><thead><tr><th align="center">常见问题</th><th align="center">排查方向</th><th align="center">解决方案</th></tr></thead><tbody><tr><td align="center">hosts.toml 配置不生效</td><td align="center">配置目录名与仓库域名 / 端口不一致</td><td align="center">确保目录名与镜像中使用的 registry 地址完全匹配（含端口，如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fharbor.liyb.com%3A8080" target="_blank" title="https://harbor.liyb.com:8080" ref="nofollow noopener noreferrer">harbor.liyb.com:8080</a> 需对应创建 <a href="https://link.juejin.cn?target=https%3A%2F%2Fharbor.liyb.com%3A8080" target="_blank" title="https://harbor.liyb.com:8080" ref="nofollow noopener noreferrer">harbor.liyb.com:8080</a> 目录）</td></tr><tr><td align="center">HTTP 仓库镜像拉取失败</td><td align="center">配置文件中未指定 http 协议</td><td align="center">将 server 地址改为 <code>http://</code> 开头（如 <code>server = "http://harbor.liyb.com:80"</code>）</td></tr><tr><td align="center">K8s Pod 无法拉取镜像</td><td align="center">镜像名称未包含仓库地址</td><td align="center">Pod 配置中 image 字段需填写完整路径（如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fharbor.liyb.com%2Fprod%2Fnginx%3A1.27" target="_blank" title="https://harbor.liyb.com/prod/nginx:1.27" ref="nofollow noopener noreferrer">harbor.liyb.com/prod/nginx:…</a>），不可省略仓库地址</td></tr><tr><td align="center">配置后仍无法连接仓库</td><td align="center">误沿用 Docker 的 daemon.json 配置</td><td align="center">containerd 2.x 不读取 Docker 的 daemon.json 配置，需按本文方法在 certs.d 目录下配置</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[promise-logic --v2.6.1更新内容]]></title>    <link>https://juejin.cn/post/7599798118460932105</link>    <guid>https://juejin.cn/post/7599798118460932105</guid>    <pubDate>2026-01-27T08:54:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599798118460932105" data-draft-id="7599847938537783305" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="promise-logic --v2.6.1更新内容"/> <meta itemprop="keywords" content="JavaScript,NPM"/> <meta itemprop="datePublished" content="2026-01-27T08:54:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xier123456"/> <meta itemprop="url" content="https://juejin.cn/user/546930955651113"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            promise-logic --v2.6.1更新内容
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/546930955651113/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xier123456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:54:49.000Z" title="Tue Jan 27 2026 08:54:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>安装：<code>npm i promise-logic</code></p>
<h2 data-id="heading-0">一、主要问题</h2>
<p>在本次项目维护中，我们遇到并解决了以下问题：</p>
<h3 data-id="heading-1">1. <code>maxTimer</code> 链式超时控制</h3>
<p><strong>难点分析</strong>：</p>
<ul>
<li>需要为所有 Promise 操作添加超时控制</li>
<li>需要保持向后兼容性，不影响现有代码</li>
<li>需要确保超时功能能够正确处理各种异步场景</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>实现 <code>PromiseWithTimer</code> 包装类，为 Promise 添加 <code>maxTimer</code> 方法</li>
<li>使用 <code>Promise.race</code> 实现超时逻辑，在指定时间后返回超时错误</li>
<li>修改所有逻辑门方法，使其返回 <code>PromiseWithTimer</code> 实例</li>
</ul>
<p><strong>核心代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PromiseWithTimer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">promise</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">promise</span> = promise;
  }

  <span class="hljs-comment">//  maxTimer 方法</span>
  <span class="hljs-title function_">maxTimer</span>(<span class="hljs-params">ms</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">promise</span>,
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Promise timed out after <span class="hljs-subst">${ms}</span>ms`</span>));
        }, ms)

        <span class="hljs-keyword">return</span><span class="hljs-function">()=&gt;</span>{
          <span class="hljs-built_in">clearTimeout</span>(timer)
        }
      })
    ]);
  }

  <span class="hljs-comment">//  then 方法</span>
  <span class="hljs-title function_">then</span>(<span class="hljs-params">onfulfilled, onrejected</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PromiseWithTimer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">promise</span>.<span class="hljs-title function_">then</span>(onfulfilled, onrejected));
  }

<span class="hljs-comment">//...</span>

</code></pre>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromiseLogic</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'promise-logic'</span>;

<span class="hljs-comment">// 执行带超时的操作</span>
<span class="hljs-title class_">PromiseLogic</span>.<span class="hljs-title function_">and</span>([
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>)), <span class="hljs-comment">// 1秒操作</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>)
])
.<span class="hljs-title function_">maxTimer</span>(<span class="hljs-number">2000</span>) <span class="hljs-comment">// 2秒超时</span>
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'操作在超时时间内完成:'</span>, result);
})
.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'操作超时或失败:'</span>, error.<span class="hljs-property">message</span>);
});
</code></pre>
<h3 data-id="heading-2">2. majority 方法的自定义</h3>
<p><strong>难点分析</strong>：</p>
<ul>
<li>需要为 <code>majority</code> 方法添加自定义阈值</li>
<li>需要确保默认行为与之前保持一致</li>
<li>需要处理不同场景下的阈值计算</li>
</ul>
<p><strong>解决方案</strong>：</p>
<ul>
<li>为 <code>majority</code> 方法添加 <code>options</code> 参数，其中 <code>max</code> 属性可自定义阈值</li>
<li>设置默认值为 0.5，确保向后兼容性</li>
<li>使用动态计算 <code>fulfilledCount &gt; total - fulfilledCount</code> 实现多数逻辑</li>
</ul>
<p><strong>核心代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-keyword">static</span> <span class="hljs-title function_">majority</span>(<span class="hljs-params">iterable, options = { max: <span class="hljs-number">0.5</span> }</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PromiseWithTimer</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>(iterable).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">results</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> fulfilled = results.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result.<span class="hljs-property">status</span> === <span class="hljs-string">'fulfilled'</span>);
      <span class="hljs-keyword">const</span> fulfilledCount = fulfilled.<span class="hljs-property">length</span>;
      <span class="hljs-keyword">const</span> total = results.<span class="hljs-property">length</span>;
      
      <span class="hljs-comment">//多数逻辑：成功数 &gt; 失败数</span>
      <span class="hljs-keyword">if</span> (fulfilledCount &gt; total * options.<span class="hljs-property">max</span>) {
        <span class="hljs-comment">// 超过半数成功，返回成功的值数组</span>
        <span class="hljs-keyword">return</span> fulfilled.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result.<span class="hljs-property">value</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 未达到多数，抛出MAJORITY_ERROR</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-title function_">createLogicError</span>(<span class="hljs-string">'MAJORITY_ERROR'</span>, fulfilledCount, total, results);
      }
    }));
  }
</code></pre>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PromiseLogic</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'promise-logic'</span>;

<span class="hljs-keyword">const</span> services = [
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'service1'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'service2'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'service3'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'service4'</span>)
];

<span class="hljs-comment">// 默认阈值（0.5）：需要至少3个成功</span>
<span class="hljs-comment">// 自定义阈值（0.4）：需要至少2个成功</span>
<span class="hljs-title class_">PromiseLogic</span>.<span class="hljs-title function_">majority</span>(services, { <span class="hljs-attr">max</span>: <span class="hljs-number">0.4</span> })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'达到自定义阈值，成功结果:'</span>, results); <span class="hljs-comment">// ['service1', 'service2']</span>
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'未达到自定义阈值:'</span>, error);
  });
</code></pre>
<h2 data-id="heading-3">二、项目更新内容</h2>
<p>本次更新主要包括以下内容：</p>
<ol>
<li>
<p><strong>添加超时控制功能</strong>：</p>
<ul>
<li>实现 <code>PromiseWithTimer</code> 类</li>
<li>添加 <code>maxTimer</code> 方法，支持为任何 Promise 操作设置超时时间</li>
</ul>
</li>
<li>
<p><strong>添加扩展操作</strong>：</p>
<ul>
<li>添加 <code>allFulfilled</code> 方法，返回所有成功结果</li>
<li>添加 <code>allRejected</code> 方法，返回所有失败结果</li>
<li>添加 <code>allSettled</code> 方法，返回所有结果（包括成功和失败）</li>
</ul>
</li>
<li>
<p><strong>增强现有功能</strong>：</p>
<ul>
<li>为 <code>majority</code> 方法添加 <code>options</code> 参数，支持自定义阈值</li>
<li>修复函数工厂存在的 bug</li>
</ul>
</li>
</ol>
<h2 data-id="heading-4">三、版本更新说明</h2>
<p>本次更新版本号为 <code>v2.6.1</code>，更新说明如下：</p>
<ul>
<li><strong>英文</strong>：<code>v2.6.1_Add timeout control and extended operations, enhance majority method with customizable threshold, fix bugs in function factory, fix test file path reference errors</code></li>
<li><strong>中文</strong>：<code>v2.6.1_添加超时控制和扩展操作，增强 majority 方法支持自定义阈值，更新了函数工厂存在的bug，更新测试文件路径引用错误问题</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在vite@5中配置tailwindcss@4]]></title>    <link>https://juejin.cn/post/7599847938537390089</link>    <guid>https://juejin.cn/post/7599847938537390089</guid>    <pubDate>2026-01-27T07:57:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599847938537390089" data-draft-id="7599604510367219750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在vite@5中配置tailwindcss@4"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-27T07:57:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="远之喵"/> <meta itemprop="url" content="https://juejin.cn/user/888852236483800"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在vite@5中配置tailwindcss@4
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888852236483800/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    远之喵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:57:51.000Z" title="Tue Jan 27 2026 07:57:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">一 安装依赖</h2>
<p><code>npm install tailwindcss @tailwindcss/vite</code></p>
<h2 data-id="heading-1">二 配置vite.config.js</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">'@tailwindcss/vite'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">createVuePlugin</span>(), 
        <span class="hljs-title function_">tailwindcss</span>(),
        <span class="hljs-title class_">Components</span>({<span class="hljs-attr">resolvers</span>:[<span class="hljs-title class_">ElementUiResolver</span>()]}), <span class="hljs-comment">// 按需加载组件库</span>
        <span class="hljs-title function_">commonjs</span>(),
        <span class="hljs-title function_">compression</span>({
            <span class="hljs-comment">// 压缩算法，可选 'gzip' | 'brotliCompress' | 'deflate' | 'deflateRaw'</span>
            <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'gzip'</span>,
            <span class="hljs-comment">// 需要压缩的文件后缀</span>
            <span class="hljs-attr">ext</span>: <span class="hljs-string">'.gz'</span>,
            <span class="hljs-comment">// 仅压缩大于此大小的文件（单位：字节）</span>
            <span class="hljs-attr">threshold</span>: <span class="hljs-number">10240</span>, <span class="hljs-comment">// 10KB 以上才压缩</span>
            <span class="hljs-comment">// 是否删除原始文件（建议保留，服务器可根据请求头自动选择）</span>
            <span class="hljs-attr">deleteOriginFile</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-comment">// 压缩率（0-9），越高压缩率越好但耗时越长</span>
            <span class="hljs-attr">compressionOptions</span>: { <span class="hljs-attr">level</span>: <span class="hljs-number">6</span> },
            <span class="hljs-attr">filter</span>: <span class="hljs-regexp">/^\.(js|css|json|html|ico|svg)(\?.*)?$/i</span>, <span class="hljs-comment">// 过滤文件类型</span>
        })
    ],
    <span class="hljs-attr">build</span>: {
        <span class="hljs-attr">commonjsOptions</span>: {
            <span class="hljs-attr">transformMixedEsModules</span>: <span class="hljs-literal">true</span>
        },
        <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>
    },
    <span class="hljs-attr">resolve</span>: {
        <span class="hljs-attr">alias</span>: {
            <span class="hljs-string">'@'</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
        }
    },
    <span class="hljs-attr">css</span>: {
        <span class="hljs-attr">preprocessorOptions</span>:{
            <span class="hljs-attr">less</span>: {
                <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">additionalData</span>: <span class="hljs-string">`@primary-color: green;
                @import "<span class="hljs-subst">${resolve(__dirname, <span class="hljs-string">'src/global.less'</span>)}</span>";`</span>
            }
        }
    }
})
</code></pre>
<h2 data-id="heading-2">三 创建taildwind.css文件</h2>
<p>在src目录下创建styles目录 src/style/tailwind.css文件</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;
<span class="hljs-keyword">@tailwind</span> base;    <span class="hljs-comment">/* 引入 Tailwind 基础样式（重置默认样式） */</span>
<span class="hljs-keyword">@tailwind</span> components; <span class="hljs-comment">/* 引入组件类（如 btn、card） */</span>
<span class="hljs-keyword">@tailwind</span> utilities; 
</code></pre>
<p>在 main.js中引入该文件</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-string">'@/styles/tailwind.css'</span>
</code></pre>
<h2 data-id="heading-3">四 效果</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a88a4b3f8d3a45069517a5662ed868cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-c5LmL5Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105680&amp;x-signature=ceF%2BdqZFbno7f66EQBW0PWUoEtI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46a71f17ea994afebdffb053a90b669d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-c5LmL5Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105680&amp;x-signature=vsnznq1ZvpRDv%2Bbkj8kl5xDVaKc%3D" alt="image.png" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c6d872ee84143cd9326f2495f02658c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-c5LmL5Za1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105680&amp;x-signature=R%2BkbNpMlLXbcVI0mHKxZTA5mBdU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[oauth2资源服务器如何保护资源的]]></title>    <link>https://juejin.cn/post/7599708108621332531</link>    <guid>https://juejin.cn/post/7599708108621332531</guid>    <pubDate>2026-01-27T09:25:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599708108621332531" data-draft-id="7599614131423215625" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="oauth2资源服务器如何保护资源的"/> <meta itemprop="keywords" content="微服务,Java,Spring Cloud"/> <meta itemprop="datePublished" content="2026-01-27T09:25:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MrSYJ"/> <meta itemprop="url" content="https://juejin.cn/user/2752832848799726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            oauth2资源服务器如何保护资源的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2752832848799726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MrSYJ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:25:09.000Z" title="Tue Jan 27 2026 09:25:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在配置资源服务器的时候，经常最简化的配置就是:</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">http</span><span class="hljs-selector-class">.oauth2ResourceServer</span>(oauth -&gt; oauth.<span class="hljs-built_in">jwt</span>(Customizer.<span class="hljs-built_in">withDefaults</span>()))
</code></pre>
<p>这行代码底层主要配置了<strong>两大核心支柱</strong>：一个负责拦截，一个负责拆弹（解析 JWT）</p>
<h2 data-id="heading-0">1.BearerTokenAuthenticationFilter 负责拦截</h2>
<p>在 OAuth2 资源服务器模式下，Spring Security 会在过滤器链中加入一个核心拦截器：<code>BearerTokenAuthenticationFilter</code>。</p>
<ul>
<li>
<p><strong>它的位置</strong>：通常在过滤器链的中后部。</p>
</li>
<li>
<p><strong>它的职责</strong>：</p>
<ol>
<li>扫描每个请求的 <strong>Header</strong>。</li>
<li>寻找 <code>Authorization: Bearer &lt;TOKEN&gt;</code> 格式的头。</li>
<li>如果找到了，就把这一串长长的字符串（Token）提取出来，封装成一个 <code>BearerTokenAuthenticationToken</code> 对象，交给后续处理。</li>
</ol>
</li>
</ul>
<p>BearerTokenAuthenticationFilter拦截逻辑如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/496fdc6e2c3c4eb8bfcdae65b31e4e95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=%2F4SV3vZq2d%2F9KnqoIyotOrqEIkQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2.JwtAuthenticationProvider 负责拆弹（解析 JWT）</h2>
<p>上图封装的BearerTokenAuthenticationToken要交给AuthenticationManager进行认证，AuthenticationManager使用AuthenticationProvider来完成校验，JwtAuthenticationProvider就是AuthenticationProvider接口的实现类，用来解析token</p>
<p>JwtAuthenticationProvider的源码如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b74e97181b8436dbd7d6571e0287f28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=jfskXxJ5u43Zwkv9IUbXAhklSGU%3D" alt="image.png" loading="lazy"/></p>
<p>getJwt 就是利用jwtDecoder来完成对token的解析，生成Jwt对象</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b5a4b5b8a8a4acb8a944dfaffe589f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=OrsP%2FDdSSZBe4BrtCJkw4V8AhfE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d77d3b7df1347f281a5f8c40990e1a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=fRDknhZ6rSJEZNElQhXG9dq9hiw%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e0c171a41ab4a148f988f81dda5079c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=Bn2Is59rGo5zWjSkpN8PNmdveAM%3D" alt="image.png" loading="lazy"/></p>
<p>利用JwtAuthenticationConverter,将Jwt对象转成最终的JwtAuthenticationToken</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1eadbcba3260427abaff9b8197bd96e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=mVVWKjKV%2F%2FHEBiyHWDdzyQhv8uc%3D" alt="image.png" loading="lazy"/></p>
<p>在这个过程中，底层还配置了一个<strong>权限转换器</strong>：<code>JwtGrantedAuthoritiesConverter</code>。</p>
<ul>
<li><strong>默认逻辑</strong>：它会去找 JWT Payload 里的 <code>scp</code> 或 <code>scope</code> 字段。</li>
<li><strong>结果</strong>：如果你的 JWT 里有 <code>"scope": "read"</code>，那么在 Spring Security 内部，你的权限就会被自动转换成 <code>SCOPE_read</code>。</li>
</ul>
<h2 data-id="heading-2">如果不带token访问一个受保护的api会发生什么？</h2>
<p>当你不带 Token 访问一个受保护的 API（如 <code>/api/data</code>）时，请求会流经过滤器链。</p>
<ul>
<li><strong>过滤器</strong>：<code>BearerTokenAuthenticationFilter</code></li>
<li><strong>动作</strong>：它尝试从请求头 <code>Authorization</code> 中提取 Token。</li>
<li><strong>结果</strong>：它发现 Header 是空的。此时它<strong>什么都不做</strong>只是简单地把请求传给下一个过滤器。因为它的职责只是“提取”，没有 Token 意味着“当前用户依然是匿名状态”。</li>
</ul>
<p>请求继续往后走，直到遇见 <strong><code>AuthorizationFilter</code></strong>（这是过滤器链的最后一关，负责最终权限判定）。</p>
<ul>
<li><strong>逻辑</strong>：它发现你访问的是受保护资源，但目前的身份是 <code>Anonymous</code>（匿名）。</li>
<li><strong>动作</strong>：抛出一个 <strong><code>AccessDeniedException</code></strong>（拒绝访问异常）。</li>
</ul>
<p>这个访问异常会被**<code>ExceptionTranslationFilter</code>** 这个过滤器处理</p>
<p>这个过滤器内部持有一个关键组件：<strong><code>AuthenticationEntryPoint</code></strong>。 对于 OAuth2，它的默认实现类是：<strong><code>BearerTokenAuthenticationEntryPoint</code></strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b5e8e393b1c487fac8c5999f0018cba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=auvEh7PApDr3nc%2F1UszFnoRxe3Q%3D" alt="image.png" loading="lazy"/></p>
<p><code>AuthenticationEntryPoint</code>见名知意引导用户去认证的入口，<strong>用户尝试访问一个受保护的资源但尚未认证（即未登录）时，决定如何“开始”认证流程。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5dcbfbc47c94cd4bc24472e408065bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=byPKYgMVQh4qhAuUqXXGCc9GSmA%3D" alt="image.png" loading="lazy"/></p>
<p>而<code>BearerTokenAuthenticationEntryPoint</code> 专门用于 <strong>基于 Bearer Token（如 JWT）的无状态 REST API 认证场景</strong></p>
<p>它的默认行为是：</p>
<blockquote>
<p><strong>返回 HTTP 状态码 <code>401 Unauthorized</code>，并在响应头中添加 <code>WWW-Authenticate: Bearer</code>。</strong></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a31d9e2601e34fa79044bf5aedb85f1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJTWUo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770110708&amp;x-signature=CzIrlM%2F28v67DcgUwXjGoSEtuZw%3D" alt="image.png" loading="lazy"/></p>
<p>为什么会有 WWW-Authenticate: Bearer？</p>
<p>这是 RFC 6750 标准（OAuth 2.0 承载令牌）的规定。</p>
<p>• 含义：它在告诉客户端（比如你的前端 Vue 应用或 Postman）：“这个资源是受保护的，你需要使用 Bearer Token 方案进行认证才能访问。”</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[godot-rust（gdext）你的第一个2D游戏 - 1]]></title>    <link>https://juejin.cn/post/7599852579066740751</link>    <guid>https://juejin.cn/post/7599852579066740751</guid>    <pubDate>2026-01-27T07:47:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852579066740751" data-draft-id="7599586891084840994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="godot-rust（gdext）你的第一个2D游戏 - 1"/> <meta itemprop="keywords" content="游戏"/> <meta itemprop="datePublished" content="2026-01-27T07:47:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="柚要做甚码"/> <meta itemprop="url" content="https://juejin.cn/user/2200546203156138"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            godot-rust（gdext）你的第一个2D游戏 - 1
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2200546203156138/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    柚要做甚码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:47:45.000Z" title="Tue Jan 27 2026 07:47:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">简介</h2>
<p>本文以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Fgetting_started%2Ffirst_2d_game%2Findex.html" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/getting_started/first_2d_game/index.html" ref="nofollow noopener noreferrer">你的第一个 2D 游戏 — Godot Engine (4.5) 简体中文文档</a>为蓝本撰写，godot-rust提供了该教程的一个rust的实现<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodot-rust%2Fdemo-projects%2Ftree%2Fmaster%2Fdodge-the-creeps" target="_blank" title="https://github.com/godot-rust/demo-projects/tree/master/dodge-the-creeps" ref="nofollow noopener noreferrer">dodge-the-creeps</a>，与本文方法会稍有不同。如果你对rust、godot等内容比较生疏或感到疑惑，可以先阅读<a href="https://link.juejin.cn/?target=https%3A%2F%2Fcolinwttt.github.io%2Fgodot-rust-book-chinese%2Fintro%2Findex.html" title="https://link.juejin.cn/?target=https%3A%2F%2Fcolinwttt.github.io%2Fgodot-rust-book-chinese%2Fintro%2Findex.html" target="_blank">godot-rust入门文档</a>。</p>
<p>本文搭建在<a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目</a>的基础之上，如果你对该部分内容感到生疏，可以先阅读这部分内容，为接下来的操作做好准备。</p>
<p><strong>注意，本文使用的godot版本为4.5.1，godot版本的变化可能会导致一些内容失效</strong>。</p>
<p>本文操作均在Windows上执行。</p>
<h2 data-id="heading-1">正文</h2>
<blockquote>
<p>在这个循序渐进的教程系列中，你将使用 Godot 创建你的第一个完整的 2D 游戏。在系列结束时，你将拥有一个简单而完整的游戏，如下图所示。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53d7ce7fbf0b4dfabf9c46cf3f45af4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104889&amp;x-signature=dS0cI0KsY7%2FUeecvRR4WBBZOocQ%3D" alt="dodge_preview.webp" loading="lazy"/></p>
<p>这个游戏叫“Dodge the Creeps!”，游戏开始后，移动你的角色来躲避从屏幕周边生成的Creeps，</p>
<h3 data-id="heading-2">创建游戏项目</h3>
<p>按照<a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目</a>流程搭建好项目，此时项目结构看上去应该像这样：</p>
<pre><code class="hljs">📂 dodge-the-creeps-2d
│
├—— 📂 godot
│
├—— 📂 rust
</code></pre>
<p>制作游戏需要素材，比如声音、图片等，原教程中提供了素材包，点击  <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodotengine%2Fgodot-docs-project-starters%2Freleases%2Fdownload%2Flatest-4.x%2Fdodge_the_creeps_2d_assets.zip" target="_blank" title="https://github.com/godotengine/godot-docs-project-starters/releases/download/latest-4.x/dodge_the_creeps_2d_assets.zip" ref="nofollow noopener noreferrer">dodge_the_creeps_2d_assets.zip</a><br/>
下载它们。</p>
<p>解压后，将文件夹art和forts拷贝到godot文件夹下，此时你的godot编辑器的<strong>文件系统</strong>中看起来应该像这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c9b80c0fe154e9483503a19eca55bd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104889&amp;x-signature=gSJAlyf%2FCMcIezHrXZLGSDb7f5E%3D" alt="godot导入游戏素材" loading="lazy"/></p>
<h3 data-id="heading-3">设置游戏项目</h3>
<p>从前面的示意图可知游戏设计为竖屏模式，因此需要调整游戏窗口大小，在编辑器的左上角点击<strong>项目</strong>-&gt;<strong>项目设置</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9eaaf9eb1a5c482aaf8d1c4e68bcb29c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104889&amp;x-signature=wys4C9R45G1uP1DXp500IC4Nqzg%3D" alt="项目设置" loading="lazy"/></p>
<p>在项目设置窗口中选择<strong>常规</strong>-&gt;<strong>显示</strong>-&gt;<strong>窗口</strong>-&gt;<strong>大小</strong>，修改<strong>视口宽度</strong>为<code>480</code>，修改<strong>视口高度</strong>为<code>720</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/341fee33923548689f1431eae7bdf671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104889&amp;x-signature=DTzvTqjlNUs1LNloNWUp6dDycH0%3D" alt="调整窗口大小" loading="lazy"/></p>
<p>向下滚动右侧设置区域，找到拉伸，设置<strong>模式</strong>为<code>canvas_items</code>、<strong>比例</strong>为<code>keep</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/316d61dfbf06456fa46f802480744c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104889&amp;x-signature=vpyDP8a8sPtixE357feZQhn6psA%3D" alt="微信图片_20260127152052_30_27.jpg" loading="lazy"/></p>
<blockquote>
<p>这样就可以保证在不同大小的屏幕上，游戏都能够进行一致的比例缩放。</p>
</blockquote>
<p>切换到2D编辑场景，你可以看到由几条不同颜色组成的区域，这个区域表示你刚刚设置的窗口。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9db7b7a8b8e04695b10a3ac7116bd0c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-a6KaB5YGa55Sa56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104889&amp;x-signature=HjMKIuQXQDyOmHFtUnPCDLV76M0%3D" alt="查看游戏场景" loading="lazy"/></p>
<h2 data-id="heading-4">参考</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.godotengine.org%2Fzh-cn%2F4.5%2Fgetting_started%2Ffirst_2d_game%2Findex.html" target="_blank" title="https://docs.godotengine.org/zh-cn/4.5/getting_started/first_2d_game/index.html" ref="nofollow noopener noreferrer">你的第一个 2D 游戏 — Godot Engine (4.5) 简体中文文档</a></li>
<li><a href="https://juejin.cn/post/7599566082212986932" target="_blank" title="https://juejin.cn/post/7599566082212986932">godot-rust（gdext）创建项目 - 掘金</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.rs%2Fgodot%2F0.4.5%2Fgodot%2F" target="_blank" title="https://docs.rs/godot/0.4.5/godot/" ref="nofollow noopener noreferrer">godot - Rust</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgodot-rust%2Fdemo-projects%2Ftree%2Fmaster%2Fdodge-the-creeps" target="_blank" title="https://github.com/godot-rust/demo-projects/tree/master/dodge-the-creeps" ref="nofollow noopener noreferrer">demo-projects/dodge-the-creeps at master · godot-rust/demo-projects · GitHub</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS -实战技巧：彻底搞定单行、多行文本溢出省略号显示]]></title>    <link>https://juejin.cn/post/7599835610405748782</link>    <guid>https://juejin.cn/post/7599835610405748782</guid>    <pubDate>2026-01-27T09:32:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599835610405748782" data-draft-id="7599640782570438683" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS -实战技巧：彻底搞定单行、多行文本溢出省略号显示"/> <meta itemprop="keywords" content="前端,面试,CSS"/> <meta itemprop="datePublished" content="2026-01-27T09:32:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS -实战技巧：彻底搞定单行、多行文本溢出省略号显示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:32:42.000Z" title="Tue Jan 27 2026 09:32:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在 UI 布局中，为了保证页面的整洁，我们经常需要对超出容器范围的文本进行截断并显示省略号（...）。针对不同的布局需求和浏览器兼容性，通常有三种主要的实现方案。</p>
<h2 data-id="heading-1">一、 单行文本溢出省略</h2>
<p>这是最常用、兼容性最好的方案，适用于标题、标签等场景。</p>
<p><strong>核心代码：</strong></p>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-selector-class">.overflow-text</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;           <span class="hljs-comment">/* 必须设置宽度 */</span>
  <span class="hljs-attribute">white-space</span>: nowrap;    <span class="hljs-comment">/* 1. 强制文字不换行 */</span>
  <span class="hljs-attribute">overflow</span>: hidden;       <span class="hljs-comment">/* 2. 隐藏超出部分 */</span>
  <span class="hljs-attribute">text-overflow</span>: ellipsis; <span class="hljs-comment">/* 3. 使用省略号代替被截断文字 */</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-2">二、 多行文本溢出省略（WebKit 内核方案）</h2>
<p>这是目前移动端和现代浏览器（Chrome, Safari, Edge）最常用的方案。它利用了 WebKit 的私有属性，实现简单且效果精准。</p>
<p><strong>核心代码：</strong></p>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-selector-class">.multi-overflow</span> {
  <span class="hljs-attribute">display</span>: -webkit-box;           <span class="hljs-comment">/* 1. 必须结合 box 模型使用 */</span>
  -webkit-box-orient: vertical;   <span class="hljs-comment">/* 2. 设置伸缩盒子的子元素排列方式 */</span>
  -webkit-line-clamp: <span class="hljs-number">2</span>;          <span class="hljs-comment">/* 3. 限制显示的行数 */</span>
  <span class="hljs-attribute">overflow</span>: hidden;               <span class="hljs-comment">/* 4. 隐藏超出范围的内容 */</span>
}
</code></pre>
<blockquote>
<p><strong>注意</strong>：该属性虽然是 WebKit 私有，但目前主流浏览器支持度已经非常高，是实际开发的首选。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">三、 自定义多行省略（伪元素方案）</h2>
<p>如果你需要兼容一些不支持 <code>line-clamp</code> 的旧版浏览器，或者需要更灵活的自定义样式，可以使用伪元素模拟。</p>
<p><strong>核心代码：</strong></p>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-selector-class">.demo</span> {
  <span class="hljs-attribute">position</span>: relative;     <span class="hljs-comment">/* 为伪元素提供定位参照 */</span>
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">20px</span>;      <span class="hljs-comment">/* 行高 */</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;           <span class="hljs-comment">/* 高度必须是行高的整数倍（此处为2行） */</span>
  <span class="hljs-attribute">overflow</span>: hidden;       <span class="hljs-comment">/* 隐藏多余内容 */</span>
  <span class="hljs-attribute">word-break</span>: break-all;
}

<span class="hljs-selector-class">.demo</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"..."</span>;         <span class="hljs-comment">/* 插入省略号 */</span>
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">background</span>: white;      <span class="hljs-comment">/* 关键：背景色需与容器背景一致，遮盖末尾文字 */</span>
}
</code></pre>
<p><strong>方案优缺点：</strong></p>
<ul>
<li><strong>优点</strong>：兼容性极佳。</li>
<li><strong>缺点</strong>：即使文字没超出行数，省略号也会一直显示（可通过 JS 判断高度动态添加类名来解决）。</li>
</ul>
<hr/>
<h2 data-id="heading-4">四、 总结与最佳实践</h2>

























<table><thead><tr><th><strong>需求场景</strong></th><th><strong>推荐方案</strong></th><th><strong>关键词</strong></th></tr></thead><tbody><tr><td><strong>单行文本</strong></td><td>标准 CSS 方案</td><td><code>nowrap</code> + <code>ellipsis</code></td></tr><tr><td><strong>移动端/现代浏览器</strong></td><td>WebKit 方案</td><td><code>-webkit-line-clamp</code></td></tr><tr><td><strong>极端兼容性要求</strong></td><td>伪元素方案</td><td><code>::after</code> + 绝对定位</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 深度解析：JS 数组的性能黑洞与 V8 引擎的“潜规则”]]></title>    <link>https://juejin.cn/post/7599828354515402792</link>    <guid>https://juejin.cn/post/7599828354515402792</guid>    <pubDate>2026-01-27T09:35:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599828354515402792" data-draft-id="7599852579067330575" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 深度解析：JS 数组的性能黑洞与 V8 引擎的“潜规则”"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-27T09:35:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDao技术魔方"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 深度解析：JS 数组的性能黑洞与 V8 引擎的“潜规则”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDao技术魔方
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:35:55.000Z" title="Tue Jan 27 2026 09:35:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、那个让服务器 CPU 飙升 100% 的“...”</h2>
<p>上周五下午 4:50，正当我准备收工去吃火锅时，告警群突然炸了。某核心微服务的 CPU 占用率瞬间从 15% 飙升到 100%，内存也在疯狂抖动。</p>
<p>定位代码后，我发现了一行看起来人畜无害的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 为了合并三个从数据库查出来的结果集（每个约 5 万条数据）</span>
<span class="hljs-keyword">const</span> combinedData = [...largeArray1, ...largeArray2, ...largeArray3];
</code></pre>
<p>在开发环境下一切正常，但在高并发、大数据量的生产场景下，这一行代码直接成了“性能杀手”。</p>
<p><strong>为什么？</strong> 很多人觉得 ES6 的扩展运算符（Spread Operator）只是 <code>Array.prototype.concat</code> 的语法糖，但实际上，V8 对它们的处理逻辑有着天壤之别。</p>
<hr/>
<h2 data-id="heading-1">二、V8 引擎的“潜规则”：数组的几种形态</h2>
<p>在 V8 引擎内部，数组并不是简单的线性表。为了极致的性能，V8 会根据数组存储的内容动态切换存储模式。如果你不了解这些，你的代码可能正在悄悄拖慢整个系统的速度。</p>
<h3 data-id="heading-2">1. Packed vs Holey (连续 vs 有洞)</h3>
<p>这是数组性能的分水岭。</p>
<ul>
<li><strong>Packed (连续数组)</strong>：数组中所有的索引都有值。V8 可以直接计算偏移量，性能接近 C++ 数组。</li>
<li><strong>Holey (有洞数组)</strong>：数组中存在缺失的索引（例如 <code>const arr = [1, , 3]</code>）。一旦数组变“洞”，V8 就必须在原型链上进行查找，甚至退化到“字典模式”，性能骤降。</li>
</ul>
<p><strong>避坑案例</strong>：千万不要用 <code>delete arr[0]</code> 来删除元素，这会产生一个永久的“洞”。请务必使用 <code>splice</code>。</p>
<h3 data-id="heading-3">2. Smi -&gt; Double -&gt; Elements (类型演化)</h3>
<ul>
<li><strong>Smi (Small Integer)</strong>：存储的是小整数，这是最快的一种模式。</li>
<li><strong>Double</strong>：一旦你往数组推入一个浮点数，数组就会演变为 Double 模式，涉及到“装箱/拆箱”开销。</li>
<li><strong>Elements</strong>：一旦推入对象或混合类型，性能最慢。</li>
</ul>
<p><strong>重点</strong>：这种演化是不可逆的。即使你把对象删掉，数组依然会保留在 Elements 模式。</p>
<hr/>
<h2 data-id="heading-4">三、性能大 PK：ES5 方法 vs ES6 新特性</h2>
<h3 data-id="heading-5">1. 扩展运算符 (...) vs Array.concat</h3>
<p>回到开头的事故案例。为什么 <code>[...a, ...b]</code> 慢？</p>
<ul>
<li><strong>扩展运算符 (...)</strong>：它本质上是调用数组的<strong>迭代器（Iterator）</strong>。V8 必须逐个遍历元素并推入新数组，这涉及到大量的函数调用和迭代开销。</li>
<li><strong>Array.prototype.concat</strong>：它是高度优化的内置方法。V8 内部可以直接进行<strong>内存块拷贝 (Memcpy)</strong>，完全不经过 JavaScript 层的迭代。</li>
</ul>
<p><strong>实测数据</strong>：在处理 10 万级数据合并时，<code>concat</code> 比 <code>spread</code> 快了近 3 倍，且内存峰值更低。</p>
<h3 data-id="heading-6">2. for vs forEach vs for...of</h3>
<ul>
<li><strong>for 循环</strong>：永远的王者，没有任何额外开销。</li>
<li><strong>forEach (ES5)</strong>：带回调函数。早期由于闭包和函数调用开销确实慢，但现代 V8 通过 <strong>Inlining (内联优化)</strong>，在大多数场景下已经能和 <code>for</code> 循环平起平坐。</li>
<li><strong>for...of (ES6)</strong>：基于迭代器。虽然语法优美，但在极高性能要求的循环中，迭代器的创建和 <code>next()</code> 调用依然存在细微开销。</li>
</ul>
<h3 data-id="heading-7">3. find (ES6) vs filter (ES5)</h3>
<p>如果你只需要找一个元素，永远不要用 <code>filter().length</code>：</p>
<ul>
<li><code>find()</code> 是<strong>短路操作</strong>，找到即停。</li>
<li><code>filter()</code> 会完整遍历数组并创建一个<strong>中间数组</strong>，浪费 CPU 和内存。</li>
</ul>
<hr/>
<h2 data-id="heading-8">四、如何编写“高性能”的数组代码？</h2>
<p>作为一名资深工程师，建议你在核心链路遵循以下原则：</p>
<h3 data-id="heading-9">1. 预分配数组空间</h3>
<p>如果你预先知道数组的大小，直接 <code>new Array(size)</code> 比不断 <code>push</code> 要快。不断 <code>push</code> 会触发 V8 的动态扩容逻辑，导致内存重新分配和数据迁移。</p>
<h3 data-id="heading-10">2. 保持数组的“纯净度”</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// Smi 模式，极速</span>
arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">4.5</span>);         <span class="hljs-comment">// 退化为 Double 模式</span>
arr.<span class="hljs-title function_">push</span>(<span class="hljs-string">'oops'</span>);      <span class="hljs-comment">// 退化为 Elements 模式，性能滑坡</span>
</code></pre>
<p>尽量让数组内部存储同类型的数据，尤其是避免在高性能循环中混合数字和对象。</p>
<h3 data-id="heading-11">3. 大数据合并禁用 Spread</h3>
<p>在 React/Redux 的 reducer 中，我们习惯了 <code>return [...state, newItem]</code>。如果 state 只有几十个元素没问题，但如果是上万条记录的列表，请改用 <code>concat</code> 或先 <code>push</code> 再返回。</p>
<hr/>
<h2 data-id="heading-12">五、总结</h2>
<p>性能优化不是为了“卷”语法，而是为了理解底层逻辑。</p>
<ol>
<li><strong>小规模数据</strong>：语义清晰最重要，大方使用 ES6 扩展符和 <code>for...of</code>。</li>
<li><strong>大规模数据 (万级以上)</strong>：回归 <code>for</code> 循环与 <code>concat</code>，警惕迭代器开销。</li>
<li><strong>核心库开发</strong>：必须关注 Packed/Holey 状态，确保数组在 V8 内部保持最快路径。</li>
</ol>
<p>那天凌晨三点，当我把 <code>spread</code> 改回 <code>concat</code> 后，CPU 监控曲线瞬间恢复了平滑，我也终于赶上了那顿火锅。</p>
<hr/>
<p><em>「iDao 技术魔方」—— 聚焦 AI、前端、全栈矩阵，让技术落地更有深度。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Logrotate实践指南]]></title>    <link>https://juejin.cn/post/7599828354515435560</link>    <guid>https://juejin.cn/post/7599828354515435560</guid>    <pubDate>2026-01-27T09:38:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599828354515435560" data-draft-id="7599873006257405986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Logrotate实践指南"/> <meta itemprop="keywords" content="运维,自动化运维"/> <meta itemprop="datePublished" content="2026-01-27T09:38:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lihouyi"/> <meta itemprop="url" content="https://juejin.cn/user/4365493763322599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Logrotate实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4365493763322599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lihouyi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:38:56.000Z" title="Tue Jan 27 2026 09:38:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Logrotate实践指南</h2>
<p>在 Linux 长期运行的服务器中，日志文件就像一条贪吃蛇</p>
<p>很多新人运维/开发的习惯是写个 Crontab 脚本 <code>rm -rf *.log</code>，或者手动删除大文件。结果往往是：<strong>文件没了，磁盘空间依然被占用</strong></p>
<blockquote>
<p><strong>💡 根本原因</strong>：Linux 文件系统通过 <strong>Inode</strong> 管理文件。如果一个进程（如 Java/Nginx）打开了日志文件，它就持有该 Inode 的句柄。你删除了文件名，只是删除了目录项，只要进程不释放句柄，磁盘块就永远不会标记为“空闲”。</p>
</blockquote>
<p>我们需要的是 <strong>Logrotate</strong> —— Linux 的御用“垃圾分类回收工”</p>
<h3 data-id="heading-1">核心原理</h3>
<p>Logrotate 是 Linux 系统中最标准的日志管理工具，主要用于防止日志文件无限增长导致磁盘空间耗尽，同时支持日志归档与轮转，便于后续查询和管理</p>
<h4 data-id="heading-2">触发机制</h4>
<p>很多人误以为 Logrotate 是守护进程，其实它只是一个由 <code>cron</code> 或 <code>systemd</code> 唤醒的普通 CLI 工具。具体触发方式因发行版和配置而异，主要有以下两种：</p>
<ul>
<li>通过 systemd 定时器</li>
</ul>
<p>某些系统使用 <code>logrotate.timer</code> 来定期触发 <code>logrotate.service</code></p>
<pre><code class="hljs language-bash" lang="bash">systemctl status logrotate.timer
</code></pre>
<ul>
<li>通过传统 cron 任务</li>
</ul>
<p>在其他系统中，logrotate 通常由 cron 或 anacron 调度，其脚本位于 <code>/etc/cron.daily/logrotate</code>，由 crond 服务每日执行一次</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> /etc/cron.daily/logrotate    <span class="hljs-comment"># 查看脚本是否存在</span>
systemctl status crond          <span class="hljs-comment"># 检查 cron 服务是否运行</span>
</code></pre>
<blockquote>
<p>无论采用哪种方式，<code>logrotate</code> 都是“按需运行”，执行完毕即退出，不会长期驻留内存</p>
</blockquote>
<h4 data-id="heading-3">模式A：Create + Signal</h4>
<p><strong>适用</strong>：Nginx, Apache, PHP-FPM 等支持重载信号（Reload）的服务</p>
<blockquote>
<p><strong>原理</strong>：利用 Linux <code>mv</code> (rename) 的原子性。重命名文件不改变 Inode，进程继续写“旧”文件，直到收到信号切换到新文件</p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Logrotate
    participant FileSystem
    participant Nginx
    
    Note over Nginx: 正在写入 access.log (Inode: 101)
    Logrotate-&gt;&gt;FileSystem: mv access.log access.log.1
    Note over FileSystem: Inode 101 没变&lt;br/&gt;Nginx 仍在写 access.log.1
    Logrotate-&gt;&gt;FileSystem: create new access.log (Inode: 102)
    Logrotate-&gt;&gt;Nginx: 发送 kill -USR1 信号
    Nginx-&gt;&gt;Nginx: 收到信号，重新打开日志句柄
    Note over Nginx: 切换写入 access.log (Inode: 102)
    Note over FileSystem: 此时 Logrotate 可安全压缩 access.log.1
</code></pre>
<h4 data-id="heading-4">模式B：Copytruncate</h4>
<p><strong>适用</strong>：Java (Spring Boot)，Python, Go 等将日志重定向到文件且无法响应重载信号的应用</p>
<blockquote>
<p><strong>原理</strong>：先把内容拷出来，再把原文件“清零”</p>
<p><strong>⚠️风险</strong>：在“复制完”到“清空”的几毫秒时间窗口内，如果应用写入新数据，这些数据会<strong>永久丢失</strong>！</p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[应用持续写入 log] --&gt; B{Logrotate 介入}
    B -- Step 1: cp log log.1 --&gt; C[生成归档]
    B -- Step 2: truncate -s 0 log --&gt; D[原文件大小归零]
    D -- 句柄不变 --&gt; A
    style B fill:#f9f,stroke:#333
    style D fill:#ff5555,stroke:#333
</code></pre>
<h4 data-id="heading-5">两种模式对比</h4>
<p>理解这两种模式的区别是避免“日志丢失”和“进程写错文件”的关键</p>













































<table><thead><tr><th>维度</th><th>Create + Signal（推荐）</th><th>Copytruncate</th></tr></thead><tbody><tr><td>定位</td><td>标准原子级方案</td><td>仅作为兜底方案</td></tr><tr><td>适用对象</td><td>支持重载信号的服务（Nginx、Apache、PHP、Rsyslog）</td><td>无法重载/感知信号的进程（Java、Python、Go 重定向日志）</td></tr><tr><td>底层原理</td><td><strong>Inode 机制</strong>：重命名文件不改变 Inode，进程持有的句柄依然有效，数据持续写入旧文件直到被信号中断</td><td><strong>I/O 读写</strong>：将日志内容物理复制一份，然后利用系统调用将原文件大小强行归零</td></tr><tr><td>执行步骤</td><td>1. 重命名日志<br/>2. 创建新的空白日志文件<br/>3. 发送信号通知应用（kill -USR1）应用切换到新句柄</td><td>1. 将当前日志内容复制出来（cp access.log access.log.1）<br/>2. 瞬间清空原日志文件（truncate -s 0 access.log）</td></tr><tr><td>数据完整性</td><td><strong>安全 (0丢失)</strong>：全过程无时间窗口，原子操作</td><td><strong>有风险 (存在丢失窗口)</strong>：在“复制完”到“清空”的几毫秒内，如果应用写入新数据，这些数据会随清空动作彻底丢失</td></tr><tr><td>性能损耗</td><td><strong>极低</strong>：重命名只是元数据修改，瞬间完成</td><td><strong>较高</strong>：若日志文件高达数GB，复制过程会产生显著磁盘 I/O 峰值</td></tr><tr><td>配置关键字</td><td>create 0640 user group<br/>postrotate (发送信号)</td><td>copytruncate<br/>无需 create 或 postrotate</td></tr></tbody></table>
<h3 data-id="heading-6">配置文件</h3>
<p>不要直接改 <code>/etc/logrotate.conf</code>，请在 <code>/etc/logrotate.d/</code> 下创建独立文件！</p>
<h4 data-id="heading-7">全参数详解</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局或指定日志文件的通用配置块</span>
/var/log/application/*.<span class="hljs-built_in">log</span> {

    <span class="hljs-comment"># 周期与触发条件</span>
    daily                     <span class="hljs-comment"># [推荐] 按天轮替 (最常用)</span>
    <span class="hljs-comment"># weekly                  # [可选] 按周轮替</span>
    <span class="hljs-comment"># monthly                 # [可选] 按月轮替</span>
    <span class="hljs-comment"># hourly                  # [特殊] 按小时 (需系统 cron.hourly 支持或配合 Systemd Timer)</span>
    
    maxsize 100M              <span class="hljs-comment"># [推荐] 优先满足周期，但若文件超过 100M 则提前切分</span>
    <span class="hljs-comment"># size 100M               # [可选] 忽略周期限制，只要超过 100M 立即切分</span>
    <span class="hljs-comment"># minsize 10M             # [可选] 周期到了后，必须同时满足大于 10M 才切分</span>


    <span class="hljs-comment"># 保留与清理</span>
    rotate 30                 <span class="hljs-comment"># [必选] 保留最近 30 份归档日志</span>
    maxage 90                 <span class="hljs-comment"># [可选] 清理超过 90 天的旧归档 (兜底策略，清理 rotate 漏掉的)</span>
    <span class="hljs-comment"># mail admin@example.com  # [可选] 轮替时将日志发送邮件 (现代运维较少使用)</span>


    <span class="hljs-comment"># 压缩策略</span>
    compress                  <span class="hljs-comment"># [推荐] 开启 gzip 压缩 (access.log-20230101.gz)</span>
    <span class="hljs-comment"># nocompress              # [可选] 不压缩</span>

    delaycompress             <span class="hljs-comment"># [核心] 延迟一天压缩。切分出的最新归档暂时保持明文</span>
                              <span class="hljs-comment"># 作用：防止应用在切分后还有极短时间在写旧文件，避免数据写入损坏的压缩包</span>
    
    <span class="hljs-comment"># 文件名与格式</span>
    dateext                   <span class="hljs-comment"># [推荐] 使用日期作为后缀 (如 access.log-20231001)</span>
    <span class="hljs-comment"># nodateext               # [可选] 使用数字递增后缀 (如 access.log.1, access.log.2)</span>
    
    dateformat -%Y-%m-%d      <span class="hljs-comment"># [可选] 自定义日期格式</span>
    <span class="hljs-comment"># dateyesterday           # [技巧] 在后缀中使用昨天的日期 (便于 T+1 日志分析)</span>


    <span class="hljs-comment"># 容错与权限</span>
    missingok                 <span class="hljs-comment"># [推荐] 日志源文件不存在时不报错</span>
    <span class="hljs-comment"># nomissingok             # [默认] 文件不存在则报错中断</span>
    
    notifempty                <span class="hljs-comment"># [推荐] 如果日志为空 (0KB)，不进行轮替</span>
    <span class="hljs-comment"># ifempty                 # [默认] 即使是空文件也强制轮替</span>


    <span class="hljs-comment"># 核心运作模式 (二选一，切勿同时开启)</span>
    <span class="hljs-comment"># --- 模式 A：Create + Signal (推荐：Nginx, Apache) ---</span>
    <span class="hljs-comment"># create 0640 nginx root  # 切分后立即创建新文件，并赋予指定权限</span>
    <span class="hljs-comment"># sharedscripts           # 多个日志文件只执行一次 postrotate 脚本</span>
    <span class="hljs-comment"># postrotate              # 脚本：通知应用重新打开日志句柄</span>
    <span class="hljs-comment">#     /bin/kill -USR1 `cat /var/run/nginx.pid`</span>
    <span class="hljs-comment"># endscript</span>

    <span class="hljs-comment"># --- 模式 B：Copytruncate (妥协：Java, Python Stdout) ---</span>
    copytruncate              <span class="hljs-comment"># 复制内容到归档后，直接清空原文件 (不推荐但实用)</span>
    <span class="hljs-comment"># nocopytruncate          # [默认] 不使用此模式</span>
    
    <span class="hljs-comment"># --- 权限修正 (特殊场景) ---</span>
    <span class="hljs-comment"># su appuser appgroup     # [特殊] 如果日志目录属于非 root 用户，必须显式指定切换用户</span>
}
</code></pre>
<h4 data-id="heading-8">生产环境配置模板</h4>
<ul>
<li>场景一：Nginx（Signal 重载模式），路径 <code>/etc/logrotate.d/nginx-custom</code></li>
</ul>
<pre><code class="hljs language-bash" lang="bash">/var/log/nginx/*.<span class="hljs-built_in">log</span> {
    daily                       <span class="hljs-comment"># 每天切割</span>
    dateext                     <span class="hljs-comment"># 使用日期作为后缀</span>
    dateformat -%Y-%m-%d        <span class="hljs-comment"># 显式指定日期格式</span>
    rotate 30                   <span class="hljs-comment"># 保留30天</span>
    compress                    <span class="hljs-comment"># 开启压缩</span>
    delaycompress               <span class="hljs-comment"># 延迟一天压缩，给Nginx缓冲时间</span>
    missingok
    notifempty
    create 0640 nginx root      <span class="hljs-comment"># 切割后创建新文件的权限</span>
    sharedscripts               <span class="hljs-comment"># 切割所有log后只 reload 一次 nginx</span>
    
    postrotate
        <span class="hljs-keyword">if</span> [ -f /var/run/nginx.pid ]; <span class="hljs-keyword">then</span>
            <span class="hljs-built_in">kill</span> -USR1 `<span class="hljs-built_in">cat</span> /var/run/nginx.pid`
        <span class="hljs-keyword">fi</span>
    endscript
}
</code></pre>
<ul>
<li>场景二：Java 应用（Copytruncate 模式），路径 <code>/etc/logrotate.d/app-java</code></li>
</ul>
<p>对于 <code>java -jar app.jar &gt; app.log &amp;</code> 这种无法接收信号的应用，我们只能妥协，但要做足安全措施</p>
<pre><code class="hljs language-bash" lang="bash">/home/app/logs/app.log {
    daily
    dateext
    rotate 60
    missingok
    compress
    delaycompress
    notifempty
    copytruncate        <span class="hljs-comment"># 关键！复制并清空，应用不需要重启</span>
    
    <span class="hljs-comment"># 强制风控：防止单日日志也撑爆磁盘</span>
    <span class="hljs-comment"># 即使 crontab 是每天一次，加上这个size参数可以在手工执行时优先生效</span>
    maxsize 500M 
    
    <span class="hljs-comment"># 权限修复：解决“父目录权限不足”问题</span>
    su appuser appgroup
}
</code></pre>
<h4 data-id="heading-9">进阶：如何处理 TB 级流量</h4>
<blockquote>
<p>默认的 daily 无法满足 TB 级流量需求，我们需要 Logrotate 每小时执行。同时，为了防止某一时段流量极小产生大量空日志，或者流量极大撑爆磁盘，我们需要结合 crond 和 size 策略</p>
</blockquote>
<ul>
<li>自定义 Logrotate 配置文件</li>
</ul>
<p>不要放在 <code>/etc/logrotate.d/</code>（系统默认的 daily 任务)，而是创建一个独立目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /etc/logrotate.hourly.d/

vi /etc/logrotate.hourly.d/fast-app
</code></pre>
<p>配置中必须包含 <code>size</code> 或 <code>maxsize</code> 来确保未满大小时不误切（虽然设为 hourly，但双重保险更好）：</p>
<pre><code class="hljs language-bash" lang="bash">/var/log/fast-app.log {
    rotate 24                   <span class="hljs-comment"># 保留24小时</span>
    maxsize 100M                <span class="hljs-comment"># 双重保险：超100M也切</span>
    missingok
    notifempty
    compress
    delaycompress
    create 0644 root root
    
    dateext
    <span class="hljs-comment"># 必须精确到小时，否则第二次切割会失败</span>
    dateformat -%Y%m%d-%H 
    
    postrotate
        /bin/kill -USR1 `<span class="hljs-built_in">cat</span> /var/run/nginx.pid 2&gt;/dev/null` 2&gt; /dev/null || <span class="hljs-literal">true</span>
    endscript
}
</code></pre>
<ul>
<li>由于这不是标准的系统任务，我们需要手动在 crontab 中指定调度，<code>crontab -e</code></li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 每小时的第59分钟，调用 logrotate 读取刚才的独立配置</span>
<span class="hljs-comment"># 解释：这里不需要加 -f (强制)，因为我们在配置文件里写了 maxsize 或 size</span>
<span class="hljs-comment"># 只要文件大小或时间满足条件，logrotate 自然会工作</span>
59 * * * * /usr/sbin/logrotate /etc/logrotate.hourly.d/fast-app
</code></pre>
<h3 data-id="heading-10">调试与验证</h3>
<p>部署配置后，直接干等是不合格的运维。必须掌握以下三板斧：</p>
<ul>
<li>Debug 模式（演习）</li>
</ul>
<p>不会产生任何文件变动，只会输出解析过程。用来检查配置文件有没有语法错误</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># -d 参数 = Debug</span>
logrotate -d /etc/logrotate.d/nginx-custom
</code></pre>
<ul>
<li>Verbose 模式（实操但带回显）</li>
</ul>
<p>执行实际切割，并打印细节</p>
<pre><code class="hljs language-bash" lang="bash">logrotate -v /etc/logrotate.d/nginx-custom
</code></pre>
<ul>
<li>Force 模式（强制立刻切割）</li>
</ul>
<p><strong>即使未满足切割时间/大小条件</strong>，也强制进行一次轮替。用于上线后立即验证权限和 postrotate 脚本是否正确</p>
<pre><code class="hljs language-bash" lang="bash">logrotate -f /etc/logrotate.d/nginx-custom
</code></pre>
<blockquote>
<p><strong>结语</strong>：Logrotate 虽小，却是 Linux 稳定性建设的基石。对于生产环境，始终建议开启 <code>delaycompress</code> 保护数据，优先使用 <code>create</code> 模式而非 <code>copytruncate</code>，并一定要在上线前使用 <code>logrotate -d</code> 进行沙箱演练</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1-1.【GCD】DispatchQueue 本质上是什么？它和线程是什么关系？]]></title>    <link>https://juejin.cn/post/7599708108621479987</link>    <guid>https://juejin.cn/post/7599708108621479987</guid>    <pubDate>2026-01-27T09:35:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599708108621479987" data-draft-id="7599850148055384073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1-1.【GCD】DispatchQueue 本质上是什么？它和线程是什么关系？"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2026-01-27T09:35:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="项阿丑"/> <meta itemprop="url" content="https://juejin.cn/user/1407852323023447"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1-1.【GCD】DispatchQueue 本质上是什么？它和线程是什么关系？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1407852323023447/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    项阿丑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:35:53.000Z" title="Tue Jan 27 2026 09:35:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>DispatchQueue</code> 是 <strong>GCD（Grand Central Dispatch）的核心抽象</strong>，它本质上是一个 <strong>任务调度管理器</strong>，而不是线程本身。</p>
<h2 data-id="heading-0">本质特性</h2>
<h3 data-id="heading-1">1. <strong>任务队列</strong></h3>
<ul>
<li>存储要执行的任务（闭包或函数）</li>
<li>遵循 FIFO（先进先出）原则</li>
<li>可以是串行（serial）或并发（concurrent）</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 串行队列 - 一次执行一个任务</span>
<span class="hljs-selector-tag">let</span> <span class="hljs-selector-tag">serialQueue</span> = <span class="hljs-selector-tag">DispatchQueue</span>(<span class="hljs-attribute">label</span>: <span class="hljs-string">"com.example.serial"</span>)

<span class="hljs-comment">// 并发队列 - 可同时执行多个任务</span>
<span class="hljs-selector-tag">let</span> <span class="hljs-selector-tag">concurrentQueue</span> = <span class="hljs-selector-tag">DispatchQueue</span>(<span class="hljs-attribute">label</span>: <span class="hljs-string">"com.example.concurrent"</span>, <span class="hljs-attribute">attributes</span>: .concurrent)
</code></pre>
<h3 data-id="heading-2">2. <strong>线程池管理器</strong></h3>
<ul>
<li>管理底层线程池（thread pool）</li>
<li>自动复用线程，避免频繁创建销毁</li>
<li>根据系统负载动态调整线程数</li>
</ul>
<h2 data-id="heading-3">与线程的关系</h2>
<h3 data-id="heading-4">关键区别</h3>

























<table><thead><tr><th><strong>DispatchQueue</strong></th><th><strong>线程 (Thread)</strong></th></tr></thead><tbody><tr><td>高级抽象，任务调度器</td><td>低级执行单元</td></tr><tr><td>管理任务执行顺序</td><td>CPU调度的基本单位</td></tr><tr><td>自动线程管理</td><td>需要手动管理生命周期</td></tr><tr><td>系统优化负载均衡</td><td>固定资源占用</td></tr></tbody></table>
<h3 data-id="heading-5">实际关系</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 示例：队列与线程的关系</span>
<span class="hljs-selector-tag">let</span> <span class="hljs-selector-tag">queue</span> = <span class="hljs-selector-tag">DispatchQueue</span>(<span class="hljs-attribute">label</span>: <span class="hljs-string">"test"</span>, <span class="hljs-attribute">attributes</span>: .concurrent)

<span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">in</span> <span class="hljs-number">1</span>..<span class="hljs-selector-class">.5</span> {
    <span class="hljs-selector-tag">queue</span><span class="hljs-selector-class">.async</span> {
        <span class="hljs-selector-tag">print</span>(<span class="hljs-string">"任务 (i) 在线程: (Thread.current)"</span>)
    }
}

<span class="hljs-comment">// 可能输出（线程会被复用）：</span>
<span class="hljs-comment">// 任务1在线程: &lt;NSThread: 0x...&gt;{number = 4, name = (null)}</span>
<span class="hljs-comment">// 任务2在线程: &lt;NSThread: 0x...&gt;{number = 5, name = (null)}</span>
<span class="hljs-comment">// 任务3在线程: &lt;NSThread: 0x...&gt;{number = 4, name = (null)} // 线程复用！</span>
</code></pre>
<h2 data-id="heading-6">重要特性</h2>
<h3 data-id="heading-7">1. <strong>线程复用</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// GCD 自动复用线程，提高性能</span>
<span class="hljs-comment">// 不会为每个任务都创建新线程</span>
</code></pre>
<h3 data-id="heading-8">2. <strong>队列层级</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 主队列 - 主线程，UI更新</span>
DispatchQueue.main.<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 更新UI</span>
}

<span class="hljs-comment">// 全局队列 - 系统提供的并发队列</span>
<span class="hljs-keyword">let</span> globalQueue = DispatchQueue.<span class="hljs-keyword">global</span>(qos: .background)

<span class="hljs-comment">// 自定义队列</span>
<span class="hljs-keyword">let</span> customQueue = DispatchQueue(label: <span class="hljs-string">"custom"</span>)
</code></pre>
<h3 data-id="heading-9">3. <strong>避免线程爆炸</strong></h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// ❌ 错误：直接创建大量线程</span>
<span class="hljs-keyword">for</span> <span class="hljs-variable">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>...<span class="hljs-number">1000</span> {
    Thread {
        <span class="hljs-comment">// 工作</span>
    }.<span class="hljs-title function_ invoke__">start</span>()
}

<span class="hljs-comment">// ✅ 正确：使用队列，系统自动管理</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">queue</span> = DispatchQueue.<span class="hljs-title function_ invoke__">global</span>()
<span class="hljs-keyword">for</span> <span class="hljs-variable">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>...<span class="hljs-number">1000</span> {
    queue.<span class="hljs-keyword">async</span> {
        <span class="hljs-comment">// 工作 - 系统会合理分配线程</span>
    }
}
</code></pre>
<h2 data-id="heading-10">最佳实践</h2>
<h3 data-id="heading-11">1. <strong>选择合适队列</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// UI更新用主队列</span>
DispatchQueue.main.<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 更新UI</span>
}

<span class="hljs-comment">// 后台任务用全局队列</span>
DispatchQueue.<span class="hljs-keyword">global</span>(qos: .userInitiated).<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 耗时任务</span>
    DispatchQueue.main.<span class="hljs-keyword">async</span> {
        <span class="hljs-comment">// 完成后更新UI</span>
    }
}
</code></pre>
<h3 data-id="heading-12">2. <strong>避免阻塞主队列</strong></h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ❌ 错误：在主队列执行耗时操作</span>
DispatchQueue<span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.async</span> {
    let data = <span class="hljs-built_in">processLargeData</span>() <span class="hljs-comment">// 阻塞UI</span>
    <span class="hljs-built_in">updateUI</span>(data)
}

<span class="hljs-comment">// ✅ 正确：在后台处理</span>
DispatchQueue<span class="hljs-selector-class">.global</span>(qos: .userInitiated)<span class="hljs-selector-class">.async</span> {
    let data = <span class="hljs-built_in">processLargeData</span>()
    DispatchQueue<span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.async</span> {
        <span class="hljs-built_in">updateUI</span>(data)
    }
}
</code></pre>
<h2 data-id="heading-13">总结</h2>
<p><strong>DispatchQueue 是线程的智能调度器</strong>：</p>
<ul>
<li>它 <strong>管理</strong> 任务，让开发者专注于"做什么"</li>
<li>它 <strong>隐藏</strong> 线程细节，自动优化资源使用</li>
<li>它 <strong>保证</strong> 任务按照指定顺序和方式执行</li>
</ul>
<p>GCD 通过 <code>DispatchQueue</code> 将开发者从繁琐的线程管理中解放出来，让并发编程变得更简单、更高效、更安全。</p>
<h2 data-id="heading-14">👉 追问：为什么说 GCD 是“基于队列而不是线程”的并发模型？</h2>
<p>说 GCD 是"基于队列而不是线程"的并发模型，<strong>核心在于它将并发抽象的重心从"谁执行"（线程）转移到了"什么被执行"（任务）以及"如何组织执行"（队列）。</strong></p>
<h2 data-id="heading-15">核心思想对比</h2>
<h3 data-id="heading-16">传统线程模型</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 关注的是"执行者"</span>
<span class="hljs-keyword">let</span> thread1 = Thread { <span class="hljs-comment">/* 任务A */</span> }
<span class="hljs-keyword">let</span> thread2 = Thread { <span class="hljs-comment">/* 任务B */</span> }
thread1.start()
thread2.start()
<span class="hljs-comment">// 你需要管理：创建线程、分配任务、协调线程、销毁线程</span>
</code></pre>
<h3 data-id="heading-17">GCD 队列模型</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 关注的是"任务组织"</span>
let queue = <span class="hljs-built_in">DispatchQueue</span>(label: <span class="hljs-string">"work"</span>, attributes: .concurrent)
queue.async { <span class="hljs-comment">/* 任务A */</span> }  <span class="hljs-comment">// 我只管提交任务</span>
queue.async { <span class="hljs-comment">/* 任务B */</span> }  <span class="hljs-comment">// 系统决定如何执行</span>
<span class="hljs-comment">// 你只需要：定义任务、选择队列、提交任务</span>
</code></pre>
<h2 data-id="heading-18">为什么这个区别很重要？</h2>
<h3 data-id="heading-19">1. <strong>解耦任务与执行资源</strong></h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 传统线程：任务和线程强绑定</span>
Thread {
    <span class="hljs-built_in">downloadImage</span>()  <span class="hljs-comment">// 任务绑定到这个特定线程</span>
}

<span class="hljs-comment">// GCD：任务和线程解耦</span>
queue<span class="hljs-selector-class">.async</span> {
    <span class="hljs-built_in">downloadImage</span>()  <span class="hljs-comment">// 任务提交到队列，系统分配线程</span>
}
<span class="hljs-comment">// 同一个任务在不同时间可能由不同线程执行</span>
</code></pre>
<h3 data-id="heading-20">2. <strong>从"微观管理"到"宏观调度"</strong></h3>





















<table><thead><tr><th><strong>传统线程编程</strong></th><th><strong>GCD 队列编程</strong></th></tr></thead><tbody><tr><td>思考：需要多少线程？</td><td>思考：任务如何组织？</td></tr><tr><td>担心：线程创建/销毁开销</td><td>专注：任务依赖和顺序</td></tr><tr><td>操心：线程同步和通信</td><td>利用：队列的同步特性</td></tr></tbody></table>
<h3 data-id="heading-21">3. <strong>编程模型更直观</strong></h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 用队列表达执行顺序非常自然</span>

<span class="hljs-comment">// 串行执行：天然保证顺序</span>
serialQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task1</span>() }
serialQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task2</span>() }  <span class="hljs-comment">// 一定在 task1 之后</span>

<span class="hljs-comment">// 并发执行：简单明了</span>
concurrentQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task1</span>() }
concurrentQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task2</span>() }  <span class="hljs-comment">// 可能并行执行</span>

<span class="hljs-comment">// 依赖关系：清晰表达</span>
queue<span class="hljs-selector-class">.async</span> {
    let data = <span class="hljs-built_in">fetchData</span>()
    DispatchQueue<span class="hljs-selector-class">.main</span><span class="hljs-selector-class">.async</span> {
        <span class="hljs-built_in">updateUI</span>(with: data)
    }
}
</code></pre>
<h2 data-id="heading-22">实际体现</h2>
<h3 data-id="heading-23">示例：对比两种模型的复杂性</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 传统线程方式实现三个任务的串行执行</span>
class ThreadManager {
    <span class="hljs-selector-tag">var</span> currentThread: Thread?
    
    func <span class="hljs-built_in">executeSequentially</span>() {
        let thread1 = Thread {
            <span class="hljs-built_in">task1</span>()
            <span class="hljs-comment">// 需要手动协调下一个任务</span>
            let thread2 = Thread {
                <span class="hljs-built_in">task2</span>()
                let thread3 = Thread {
                    <span class="hljs-built_in">task3</span>()
                }
                thread3<span class="hljs-selector-class">.start</span>()
            }
            thread2<span class="hljs-selector-class">.start</span>()
        }
        thread1<span class="hljs-selector-class">.start</span>()
    }
}

<span class="hljs-comment">// GCD 方式实现三个任务的串行执行</span>
let serialQueue = <span class="hljs-built_in">DispatchQueue</span>(label: "serial")
serialQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task1</span>() }
serialQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task2</span>() }
serialQueue<span class="hljs-selector-class">.async</span> { <span class="hljs-built_in">task3</span>() }
<span class="hljs-comment">// 简洁明了，自动保证顺序</span>
</code></pre>
<h3 data-id="heading-24">示例：避免"线程爆炸"</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 传统方式：容易创建过多线程</span>
for <span class="hljs-selector-tag">i</span> in <span class="hljs-number">0</span>..&lt;<span class="hljs-number">1000</span> {
    Thread {
        <span class="hljs-built_in">processItem</span>(i)
    }<span class="hljs-selector-class">.start</span>()  <span class="hljs-comment">// 可能创建1000个线程！</span>
}

<span class="hljs-comment">// GCD 方式：系统智能管理</span>
let queue = DispatchQueue<span class="hljs-selector-class">.global</span>()
for <span class="hljs-selector-tag">i</span> in <span class="hljs-number">0</span>..&lt;<span class="hljs-number">1000</span> {
    queue<span class="hljs-selector-class">.async</span> {
        <span class="hljs-built_in">processItem</span>(i)  <span class="hljs-comment">// 系统复用线程池中的线程</span>
    }
}
<span class="hljs-comment">// 可能只用 8-64 个线程（根据 CPU 核心数优化）</span>
</code></pre>
<h2 data-id="heading-25">GCD 的哲学转变</h2>
<h3 data-id="heading-26">1. <strong>关注点分离</strong></h3>
<pre><code class="hljs language-diff" lang="diff">// 你关心的：
<span class="hljs-deletion">- 任务是什么？</span>
<span class="hljs-deletion">- 任务间的依赖关系？</span>
<span class="hljs-deletion">- 任务的优先级？</span>
<span class="hljs-deletion">- 执行顺序要求？</span>

// 系统关心的：
<span class="hljs-deletion">- 用多少线程？</span>
<span class="hljs-deletion">- 哪个线程执行哪个任务？</span>
<span class="hljs-deletion">- 何时创建/销毁线程？</span>
<span class="hljs-deletion">- 如何负载均衡？</span>
</code></pre>
<h3 data-id="heading-27">2. <strong>更高级的抽象</strong></h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// GCD 提供了高级原语</span>
let group = <span class="hljs-built_in">DispatchGroup</span>()  <span class="hljs-comment">// 任务组</span>
let semaphore = <span class="hljs-built_in">DispatchSemaphore</span>(value: <span class="hljs-number">1</span>)  <span class="hljs-comment">// 信号量</span>
let barrier = <span class="hljs-built_in">DispatchWorkItem</span>(flags: .barrier)  <span class="hljs-comment">// 屏障</span>

<span class="hljs-comment">// 这些都在队列层面操作，不直接涉及线程</span>
</code></pre>
<h3 data-id="heading-28">3. <strong>性能优化透明化</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 系统可以根据情况优化：</span>
<span class="hljs-comment">// - 线程复用</span>
<span class="hljs-comment">// - 负载均衡</span>
<span class="hljs-comment">// - CPU 亲和性</span>
<span class="hljs-comment">// - 能耗优化（iOS 上特别重要）</span>

<span class="hljs-comment">// 你只需：queue.async { work }</span>
<span class="hljs-comment">// 系统决定：用哪个核、哪个线程、何时执行</span>
</code></pre>
<h2 data-id="heading-29">现实类比</h2>
<h3 data-id="heading-30">传统线程模型：<strong>自己建工厂</strong></h3>
<ul>
<li>你需要：招聘工人（创建线程）</li>
<li>分配任务：A 你去拧螺丝，B 你去焊接</li>
<li>协调管理：A 做完告诉 B</li>
<li>成本高：工人闲置时也要付工资</li>
</ul>
<h3 data-id="heading-31">GCD 队列模型：<strong>使用云服务平台</strong></h3>
<ul>
<li>你只需：提交任务需求单（任务到队列）</li>
<li>平台负责：分配工人、调度任务、优化资源</li>
<li>你只关心：任务描述和依赖关系</li>
<li>成本优：按需使用，资源复用</li>
</ul>
<h2 data-id="heading-32">总结</h2>
<p>GCD 的"基于队列"模型之所以强大，是因为：</p>
<ol>
<li><strong>抽象层次更高</strong>：从"执行单元"抽象到"任务组织"</li>
<li><strong>资源管理更优</strong>：系统全局优化，避免局部最优</li>
<li><strong>编程模型更安全</strong>：减少了数据竞争和死锁的机会</li>
<li><strong>性能更可预测</strong>：避免了线程爆炸和过度订阅</li>
<li><strong>代码更简洁</strong>：关注业务逻辑，而不是线程管理</li>
</ol>
<p>这种设计使得并发编程从一门"黑魔法"变成了更可控、更安全的工程实践。你不再直接指挥"士兵"（线程），而是制定"作战计划"（队列和任务），让"指挥部"（GCD）去最优执行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1-2.【GCD】GCD 是如何管理线程池的？线程是谁创建的？]]></title>    <link>https://juejin.cn/post/7599835610405781550</link>    <guid>https://juejin.cn/post/7599835610405781550</guid>    <pubDate>2026-01-27T09:36:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599835610405781550" data-draft-id="7599708108621234227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1-2.【GCD】GCD 是如何管理线程池的？线程是谁创建的？"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2026-01-27T09:36:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="项阿丑"/> <meta itemprop="url" content="https://juejin.cn/user/1407852323023447"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1-2.【GCD】GCD 是如何管理线程池的？线程是谁创建的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1407852323023447/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    项阿丑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:36:15.000Z" title="Tue Jan 27 2026 09:36:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">线程创建者：GCD 自己</h3>
<p><strong>GCD 是线程的实际创建者</strong>，但不是随意创建，而是通过高度优化的机制：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 开发者层面：不直接创建线程</span>
DispatchQueue.<span class="hljs-keyword">global</span>().<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// GCD 内部决定：</span>
    <span class="hljs-comment">// 1. 从池中取出空闲线程</span>
    <span class="hljs-comment">// 2. 或创建新线程（如果必要）</span>
    <span class="hljs-comment">// 3. 或将任务排队等待</span>
}
</code></pre>
<h3 data-id="heading-1">GCD 线程池的智能管理</h3>
<h4 data-id="heading-2">1. <strong>按需创建，延迟销毁</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// GCD 线程生命周期：</span>
<span class="hljs-comment">// 初始状态：线程池为空</span>
<span class="hljs-comment">// 第一次提交任务 → 创建1个线程</span>
<span class="hljs-comment">// 持续提交任务 → 逐渐增加线程数</span>
<span class="hljs-comment">// 空闲一段时间 → 自动销毁多余线程（节省资源）</span>
</code></pre>
<h4 data-id="heading-3">2. <strong>线程复用策略</strong></h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 类似数据库连接池的模式</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GCDThreadPool</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> activeThreads: <span class="hljs-type">Set</span>&lt;<span class="hljs-type">Thread</span>&gt; <span class="hljs-operator">=</span> []
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> idleThreads: <span class="hljs-type">Set</span>&lt;<span class="hljs-type">Thread</span>&gt; <span class="hljs-operator">=</span> []
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> maxThreads: <span class="hljs-type">Int</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">getThread</span>() -&gt; <span class="hljs-type">Thread</span> {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> thread <span class="hljs-operator">=</span> idleThreads.popFirst() {
            <span class="hljs-comment">// 复用空闲线程</span>
            activeThreads.insert(thread)
            <span class="hljs-keyword">return</span> thread
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> activeThreads.count <span class="hljs-operator">&lt;</span> maxThreads {
            <span class="hljs-comment">// 创建新线程</span>
            <span class="hljs-keyword">let</span> thread <span class="hljs-operator">=</span> createThread()
            activeThreads.insert(thread)
            <span class="hljs-keyword">return</span> thread
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 等待线程可用</span>
            <span class="hljs-keyword">return</span> waitForAvailableThread()
        }
    }
}
</code></pre>
<h3 data-id="heading-4">线程池的关键参数和策略</h3>
<h4 data-id="heading-5">1. <strong>线程数量限制</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 基于系统资源动态调整</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">GCDThreadManager</span> {
    <span class="hljs-comment">// 主要考虑因素：</span>
    <span class="hljs-comment">// 1. CPU 核心数（决定最大并发度）</span>
    <span class="hljs-keyword">let</span> maxConcurrentThreads = ProcessInfo.processInfo.processorCount * <span class="hljs-number">2</span>
    
    <span class="hljs-comment">// 2. 队列类型</span>
    <span class="hljs-comment">// 串行队列：通常1个线程</span>
    <span class="hljs-comment">// 并发队列：多个线程，但有限制</span>
    
    <span class="hljs-comment">// 3. 系统负载</span>
    <span class="hljs-comment">// 高负载时：减少线程数</span>
    <span class="hljs-comment">// 低负载时：增加线程数（更快响应）</span>
}
</code></pre>
<h4 data-id="heading-6">2. <strong>QoS（服务质量）影响</strong></h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 不同优先级的任务使用不同线程池</span>
<span class="hljs-type">DispatchQueue</span>.global(qos: .userInteractive) <span class="hljs-comment">// 最高优先级，更快获取线程</span>
<span class="hljs-type">DispatchQueue</span>.global(qos: .background)      <span class="hljs-comment">// 最低优先级，可能等待更久</span>

<span class="hljs-comment">// 内部实现简化：</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QoSThreadPool</span> {
    <span class="hljs-keyword">var</span> highPriorityPool: <span class="hljs-type">ThreadPool</span>  <span class="hljs-comment">// .userInteractive, .userInitiated</span>
    <span class="hljs-keyword">var</span> defaultPool: <span class="hljs-type">ThreadPool</span>        <span class="hljs-comment">// .default</span>
    <span class="hljs-keyword">var</span> lowPriorityPool: <span class="hljs-type">ThreadPool</span>    <span class="hljs-comment">// .utility, .background</span>
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">getThread</span>(<span class="hljs-params">for</span> <span class="hljs-params">qos</span>: <span class="hljs-type">QoSClass</span>) -&gt; <span class="hljs-type">Thread</span> {
        <span class="hljs-comment">// 优先从对应优先级的池中获取</span>
        <span class="hljs-comment">// 高优先级可"借用"低优先级的线程（反之不行）</span>
    }
}
</code></pre>
<h3 data-id="heading-7">具体工作机制示例</h3>
<h4 data-id="heading-8">场景：处理大量任务</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">let</span> queue = DispatchQueue.<span class="hljs-keyword">global</span>()

<span class="hljs-comment">// 模拟100个任务</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.<span class="hljs-number">.100</span> {
    queue.<span class="hljs-keyword">async</span> {
        sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment">// 模拟1秒工作</span>
        print(<span class="hljs-string">"任务 (i) 完成，线程: (Thread.current)"</span>)
    }
}

<span class="hljs-comment">// GCD 内部行为：</span>
<span class="hljs-comment">// 1. 前几个任务：创建新线程（比如4个，基于CPU核心数）</span>
<span class="hljs-comment">// 2. 继续提交：复用现有线程</span>
<span class="hljs-comment">// 3. 如果所有线程都忙：排队等待</span>
<span class="hljs-comment">// 4. 如果长时间排队：可能创建更多线程（但不超过上限）</span>
<span class="hljs-comment">// 5. 任务完成后：线程空闲，可用于新任务</span>
<span class="hljs-comment">// 6. 长时间空闲：销毁多余线程</span>
</code></pre>
<h3 data-id="heading-9">避免的问题和优化</h3>
<h4 data-id="heading-10">1. <strong>防止线程爆炸</strong></h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 传统方式的问题</span>
<span class="hljs-keyword">for</span> <span class="hljs-variable">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..&lt;<span class="hljs-number">1000</span> {
    Thread { <span class="hljs-comment">/* 工作 */</span> }.<span class="hljs-title function_ invoke__">start</span>()  <span class="hljs-comment">// 可能创建1000个线程！</span>
}

<span class="hljs-comment">// GCD 的优化</span>
<span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">queue</span> = DispatchQueue.<span class="hljs-title function_ invoke__">global</span>()
<span class="hljs-keyword">for</span> <span class="hljs-variable">_</span> <span class="hljs-keyword">in</span> <span class="hljs-number">0</span>..&lt;<span class="hljs-number">1000</span> {
    queue.<span class="hljs-keyword">async</span> { <span class="hljs-comment">/* 工作 */</span> }  <span class="hljs-comment">// 可能只用8-16个线程处理</span>
}
</code></pre>
<h4 data-id="heading-11">2. <strong>负载均衡</strong></h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GCD 内部的工作窃取（Work Stealing）机制</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkStealingScheduler</span> {
    <span class="hljs-keyword">var</span> threadPools: [<span class="hljs-type">ThreadPool</span>]
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">scheduleTask</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">task</span>: <span class="hljs-type">Task</span>) {
        <span class="hljs-comment">// 1. 先尝试分配到最空闲的线程</span>
        <span class="hljs-comment">// 2. 如果所有线程都忙，但其他队列有闲置线程</span>
        <span class="hljs-comment">// 3. "窃取"闲置线程来执行任务</span>
    }
}
</code></pre>
<h4 data-id="heading-12">3. <strong>能耗优化（特别在移动设备）</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// iOS/macOS 的能耗管理</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">EnergyAwareThreadManager</span> {
    <span class="hljs-function">func <span class="hljs-title">manageThreads</span>()</span> {
        <span class="hljs-comment">// 考虑因素：</span>
        <span class="hljs-comment">// - CPU 频率调整（降频时减少线程）</span>
        <span class="hljs-comment">// - 电池状态（低电量时减少并发）</span>
        <span class="hljs-comment">// - 温度控制（过热时限制线程）</span>
        <span class="hljs-comment">// - 后台状态（后台模式用更少线程）</span>
    }
}
</code></pre>
<h3 data-id="heading-13">线程生命周期管理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 简化版 GCD 线程管理逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GCDThread</span> {
    <span class="hljs-keyword">var</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">ThreadState</span> = .<span class="hljs-property">idle</span>
    <span class="hljs-keyword">var</span> <span class="hljs-attr">lastUsed</span>: <span class="hljs-title class_">TimeInterval</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ThreadState</span> {
        <span class="hljs-keyword">case</span> idle      <span class="hljs-comment">// 空闲，等待任务</span>
        <span class="hljs-keyword">case</span> active    <span class="hljs-comment">// 正在执行任务</span>
        <span class="hljs-keyword">case</span> sleeping  <span class="hljs-comment">// 休眠（可能被销毁）</span>
    }
    
    func <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span> {
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> task = <span class="hljs-title function_">getTaskFromQueue</span>(<span class="hljs-params"/>) {
                state = .<span class="hljs-property">active</span>
                task.<span class="hljs-title function_">execute</span>()
                state = .<span class="hljs-property">idle</span>
                lastUsed = <span class="hljs-title function_">currentTime</span>()
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 空闲处理</span>
                <span class="hljs-keyword">if</span> <span class="hljs-title function_">shouldDestroyThread</span>(<span class="hljs-params"/>) {
                    <span class="hljs-title function_">cleanupAndExit</span>()
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-title function_">sleepForInterval</span>()
                }
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-14">特殊情况处理</h3>
<h4 data-id="heading-15">1. <strong>主线程的特殊性</strong></h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 主队列绑定到主线程</span>
DispatchQueue.main.<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 总是运行在主线程</span>
    <span class="hljs-comment">// GCD 不会为 main queue 创建新线程</span>
    <span class="hljs-comment">// 而是将任务提交到主线程的 RunLoop</span>
}

<span class="hljs-comment">// 主线程不是由 GCD 创建的</span>
<span class="hljs-comment">// 它是应用启动时由系统创建的</span>
</code></pre>
<h4 data-id="heading-16">2. <strong>同步执行的优化</strong></h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// sync 调用时的线程优化</span>
queue.sync {
    <span class="hljs-comment">// 可能的优化：</span>
    <span class="hljs-comment">// 1. 如果当前线程就是目标队列的执行线程</span>
    <span class="hljs-comment">// 2. 直接在当前线程执行（避免线程切换）</span>
    <span class="hljs-comment">// 3. 这称为"队列归属检测"</span>
}
</code></pre>
<h3 data-id="heading-17">实际调试观察</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 查看线程创建情况</span>
let concurrentQueue = <span class="hljs-title function_ invoke__">DispatchQueue</span>(<span class="hljs-attr">label</span>: <span class="hljs-string">"test"</span>, <span class="hljs-attr">attributes</span>: .concurrent)

<span class="hljs-keyword">print</span>(<span class="hljs-string">"初始线程数: (Thread.getAll().count)"</span>)

<span class="hljs-keyword">for</span> i in <span class="hljs-number">0</span>..&lt;<span class="hljs-number">20</span> {
    concurrentQueue.async {
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"任务 (i): (Thread.current)"</span>)
        <span class="hljs-title function_ invoke__">usleep</span>(<span class="hljs-number">100_000</span>)  <span class="hljs-comment">// 100ms</span>
    }
}

<span class="hljs-comment">// 观察结果：</span>
<span class="hljs-comment">// 1. 线程数不会无限增长</span>
<span class="hljs-comment">// 2. 线程会被复用（看到相同的 thread number）</span>
<span class="hljs-comment">// 3. 最终稳定在一定数量（如 CPU 核心数*2）</span>
</code></pre>
<h2 data-id="heading-18">总结</h2>
<p><strong>GCD 线程管理的关键特点：</strong></p>
<ol>
<li><strong>线程创建者</strong>：GCD 自己（通过系统调用），开发者不直接创建</li>
<li><strong>按需创建</strong>：首次需要时创建，不是预先创建大量线程</li>
<li><strong>智能复用</strong>：线程执行完任务后回到池中，等待下次使用</li>
<li><strong>动态调整</strong>：根据系统负载、CPU核心数、任务类型动态调整线程数</li>
<li><strong>上限控制</strong>：有最大线程数限制，防止线程爆炸</li>
<li><strong>自动清理</strong>：空闲线程会被销毁，节省资源</li>
<li><strong>优先级感知</strong>：不同 QoS 的任务可能使用不同的线程子池</li>
</ol>
<p>这种设计使得 GCD 能够：</p>
<ul>
<li>最大化 CPU 利用率</li>
<li>最小化线程创建/销毁开销</li>
<li>自动适应不同硬件和负载</li>
<li>为开发者隐藏复杂的线程管理细节</li>
</ul>
<p><strong>简单比喻</strong>：GCD 就像一个"智能线程管家"，你只需要告诉它"要做什么工作"和"工作的重要程度"，它会自动安排最合适的"工人"（线程）来完成，同时保证不雇佣过多工人浪费资源。</p>
<h2 data-id="heading-19">👉 追问：GCD 线程池和 pthread / NSThread 的关系？</h2>
<p>GCD 线程池、pthread 和 NSThread 之间有清晰的层次关系，<strong>pthread 是底层基础，GCD 和 NSThread 都是基于它的高层抽象</strong>。</p>
<h2 data-id="heading-20">层级关系</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 从高到低的抽象层次：</span>
┌─────────────────────────┐
│   <span class="hljs-built_in">GCD</span> (DispatchQueue)   │ ← 最高抽象：任务队列，自动线程管理
├─────────────────────────┤
│        NSThread         │ ← 中级抽象：面向对象的线程封装
├─────────────────────────┤
│       <span class="hljs-type">pthread_t</span>         │ ← 底层抽象：POSIX线程，C语言API
└─────────────────────────┘
</code></pre>
<h2 data-id="heading-21">详细关系解析</h2>
<h3 data-id="heading-22">1. <strong>pthread_t：最底层的基础</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 这是所有线程的根基（包括GCD创建的线程）</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>

<span class="hljs-type">pthread_t</span> thread;
<span class="hljs-built_in">pthread_create</span>(&amp;thread, <span class="hljs-literal">NULL</span>, worker_func, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// 创建线程</span>

<span class="hljs-comment">// GCD 内部最终会调用这个函数来创建线程</span>
<span class="hljs-comment">// 实际上，macOS/iOS 中的所有线程都是 pthread</span>
</code></pre>
<h3 data-id="heading-23">2. <strong>NSThread：Objective-C 的封装</strong></h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// NSThread 是对 pthread 的面向对象包装</span>
<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">NSThread</span> {
    <span class="hljs-comment">// 内部持有 pthread_t</span>
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">_pthread</span>: <span class="hljs-selector-tag">pthread_t</span>
    
    <span class="hljs-comment">// 创建线程时，内部调用 pthread_create()</span>
    <span class="hljs-selector-tag">init</span>(<span class="hljs-attribute">block</span>: <span class="hljs-variable">@escaping</span> () -&gt; Void) {
        <span class="hljs-selector-tag">_pthread</span> = <span class="hljs-selector-tag">pthread_create</span>(...)
    }
}

<span class="hljs-comment">// 验证关系：</span>
<span class="hljs-selector-tag">Thread</span><span class="hljs-selector-class">.current</span> <span class="hljs-comment">// 返回当前线程的 NSThread 对象</span>
<span class="hljs-selector-tag">pthread_self</span>() <span class="hljs-comment">// 返回当前线程的 pthread_t</span>

<span class="hljs-comment">// 实际上，Thread.current.pthread 可以获取底层 pthread_t</span>
<span class="hljs-comment">// （虽然这个属性不公开）</span>
</code></pre>
<h3 data-id="heading-24">3. <strong>GCD 线程池的实现</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// GCD 内部结构示意（简化版）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GCDThreadPool</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> threads: [pthread_t] <span class="hljs-operator">=</span> []
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> taskQueue: <span class="hljs-type">Queue</span>&lt;<span class="hljs-type">Task</span>&gt;
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">createThreadIfNeeded</span>() {
        <span class="hljs-comment">// 需要新线程时，创建 pthread</span>
        <span class="hljs-keyword">var</span> thread: pthread_t
        pthread_create(<span class="hljs-operator">&amp;</span>thread, <span class="hljs-literal">nil</span>, { context <span class="hljs-keyword">in</span>
            <span class="hljs-comment">// 线程函数：不断从队列取任务执行</span>
            <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> task <span class="hljs-operator">=</span> taskQueue.dequeue() {
                task.execute()
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }, <span class="hljs-literal">nil</span>)
        
        threads.append(thread)
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">task</span>: <span class="hljs-type">Task</span>) {
        taskQueue.enqueue(task)
        <span class="hljs-comment">// 如果没有空闲线程且未达上限，创建新线程</span>
        <span class="hljs-keyword">if</span> idleThreads.isEmpty <span class="hljs-operator">&amp;&amp;</span> threads.count <span class="hljs-operator">&lt;</span> maxThreads {
            createThreadIfNeeded()
        }
    }
}
</code></pre>
<h2 data-id="heading-25">实际运行时关系示例</h2>
<h3 data-id="heading-26">场景：观察三者关系</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 创建一个 GCD 并发队列</span>
<span class="hljs-keyword">let</span> queue = DispatchQueue(label: <span class="hljs-string">"test"</span>, attributes: .concurrent)

<span class="hljs-comment">// 提交任务</span>
queue.<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 获取三个层面的线程信息</span>
    <span class="hljs-keyword">let</span> nsThread = Thread.current        <span class="hljs-comment">// NSThread 对象</span>
    <span class="hljs-keyword">let</span> pthreadId = pthread_self()       <span class="hljs-comment">// pthread_t 标识</span>
    <span class="hljs-keyword">let</span> threadNumber = nsThread.<span class="hljs-keyword">value</span>(forKeyPath: <span class="hljs-string">"private.seqNum"</span>)  <span class="hljs-comment">// 内部编号</span>
    
    print(<span class="hljs-string">""</span><span class="hljs-string">"
    层级关系：
    1. NSThread: (nsThread)
    2. pthread_t: (pthreadId)
    3. 是否GCD创建: (nsThread.name?.contains("</span>com.apple.root<span class="hljs-string">") == true)
    "</span><span class="hljs-string">""</span>)
    
    <span class="hljs-comment">// 实际输出可能类似：</span>
    <span class="hljs-comment">// 1. NSThread: &lt;NSThread: 0x600003d6c040&gt;{number = 7, name = (null)}</span>
    <span class="hljs-comment">// 2. pthread_t: 0x70000a1000</span>
    <span class="hljs-comment">// 3. 是否GCD创建: true</span>
}
</code></pre>
<h3 data-id="heading-27">核心区别对比</h3>









































<table><thead><tr><th><strong>特性</strong></th><th><strong>GCD 线程池</strong></th><th><strong>NSThread</strong></th><th><strong>pthread_t</strong></th></tr></thead><tbody><tr><td><strong>抽象级别</strong></td><td>最高（队列）</td><td>中（对象）</td><td>最低（句柄）</td></tr><tr><td><strong>创建方式</strong></td><td>自动管理</td><td>手动创建</td><td>手动创建</td></tr><tr><td><strong>线程复用</strong></td><td>✅ 自动复用</td><td>❌ 一对一</td><td>❌ 一对一</td></tr><tr><td><strong>内存管理</strong></td><td>自动</td><td>ARC 管理</td><td>手动（pthread_join/exit）</td></tr><tr><td><strong>跨平台</strong></td><td>Apple 生态</td><td>Apple 生态</td><td>POSIX标准</td></tr></tbody></table>
<h2 data-id="heading-28">具体实现细节</h2>
<h3 data-id="heading-29">1. <strong>GCD 如何创建线程</strong></h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// GCD 内部源码简化示意（libdispatch）</span>
void <span class="hljs-built_in">_dispatch_worker_thread</span>(void *context) {
    <span class="hljs-comment">// 1. 注册为GCD工作线程</span>
    <span class="hljs-built_in">_dispatch_thread_setspecific</span>(dispatch_queue_key, context);
    
    <span class="hljs-comment">// 2. 设置线程名字（便于调试）</span>
    <span class="hljs-built_in">pthread_setname_np</span>("com.apple.root.default-qos");
    
    <span class="hljs-comment">// 3. 进入工作循环</span>
    while (<span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 从队列获取任务</span>
        task = <span class="hljs-built_in">_dispatch_queue_get_task</span>(queue);
        
        if (task) {
            <span class="hljs-built_in">_dispatch_worker_execute</span>(task);
        } else {
            <span class="hljs-comment">// 空闲处理</span>
            if (should_terminate()) {
                <span class="hljs-built_in">pthread_exit</span>(NULL);
            }
        }
    }
}

<span class="hljs-comment">// 创建线程的函数</span>
void <span class="hljs-built_in">_dispatch_thread_create</span>(pthread_t *thread, dispatch_queue_t queue) {
    pthread_attr_t attr;
    <span class="hljs-built_in">pthread_attr_init</span>(&amp;attr);
    
    <span class="hljs-comment">// 配置线程属性</span>
    <span class="hljs-built_in">pthread_attr_set_qos_class_np</span>(&amp;attr, QOS_CLASS_DEFAULT, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 最终调用 pthread_create</span>
    <span class="hljs-built_in">pthread_create</span>(thread, &amp;attr, _dispatch_worker_thread, (void *)queue);
}
</code></pre>
<h3 data-id="heading-30">2. <strong>NSThread 的 pthread 包装</strong></h3>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-comment">// NSThread 内部实现示意</span>
<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">NSThread</span> </span>{
    pthread_t _pthread;
    <span class="hljs-built_in">NSMutableDictionary</span> *_threadDictionary;
}

- (<span class="hljs-type">void</span>)start {
    <span class="hljs-keyword">if</span> (_pthread != <span class="hljs-literal">NULL</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// 创建 pthread</span>
    pthread_attr_t attr;
    pthread_attr_init(&amp;attr);
    
    <span class="hljs-comment">// 存储 self 以便在 C 函数中访问</span>
    <span class="hljs-built_in">NSThread</span> *threadSelf = <span class="hljs-keyword">self</span>;
    
    <span class="hljs-type">int</span> err = pthread_create(&amp;_pthread, &amp;attr,
                           _NSThread__start__, (__bridge <span class="hljs-type">void</span> *)threadSelf);
    
    pthread_attr_destroy(&amp;attr);
}

<span class="hljs-keyword">static</span> <span class="hljs-type">void</span> *_NSThread__start__(<span class="hljs-type">void</span> *arg) {
    <span class="hljs-comment">// 获取 NSThread 对象</span>
    <span class="hljs-built_in">NSThread</span> *thread = (__bridge <span class="hljs-built_in">NSThread</span> *)arg;
    
    <span class="hljs-comment">// 设置线程特定数据</span>
    pthread_setspecific(<span class="hljs-built_in">NSThreadKey</span>, (__bridge <span class="hljs-type">void</span> *)thread);
    
    <span class="hljs-comment">// 执行目标方法</span>
    [thread main];
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
<span class="hljs-keyword">@end</span>
</code></pre>
<h2 data-id="heading-31">实际开发中的交互</h2>
<h3 data-id="heading-32">1. <strong>从 NSThread 获取 pthread</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 方法1：直接获取当前 pthread</span>
<span class="hljs-keyword">let</span> currentPthread <span class="hljs-operator">=</span> pthread_self()

<span class="hljs-comment">// 方法2：从 NSThread（不推荐，使用私有API）</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Thread</span> {
    <span class="hljs-keyword">var</span> pthread: pthread_t<span class="hljs-operator">?</span> {
        <span class="hljs-comment">// 注意：这是私有API，App Store审核可能不通过</span>
        <span class="hljs-keyword">let</span> key <span class="hljs-operator">=</span> <span class="hljs-string">"pthread"</span>  <span class="hljs-comment">// 实际是私有字段</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.value(forKey: key) <span class="hljs-keyword">as?</span> pthread_t
    }
}
</code></pre>
<h3 data-id="heading-33">2. <strong>在 GCD 任务中操作线程</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp">DispatchQueue.<span class="hljs-keyword">global</span>().<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 当前运行在 GCD 管理的 pthread 上</span>
    
    <span class="hljs-comment">// 可以设置线程名字（用于调试）</span>
    pthread_setname_np(<span class="hljs-string">"MyWorkerThread"</span>)
    
    <span class="hljs-comment">// 可以获取并操作当前 pthread</span>
    <span class="hljs-keyword">let</span> pthread = pthread_self()
    
    <span class="hljs-comment">// 可以设置线程优先级（但通常用 QoS 更好）</span>
    <span class="hljs-keyword">var</span> policy: Int32 = <span class="hljs-number">0</span>
    <span class="hljs-keyword">var</span> param = sched_param()
    pthread_getschedparam(pthread, &amp;policy, &amp;param)
    param.sched_priority = <span class="hljs-number">45</span>  <span class="hljs-comment">// 设置优先级</span>
    pthread_setschedparam(pthread, policy, &amp;param)
    
    <span class="hljs-comment">// 注意：直接操作 pthread 可能干扰 GCD 的管理</span>
}
</code></pre>
<h3 data-id="heading-34">3. <strong>混合使用的陷阱</strong></h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ❌ 危险的混合使用</span>
<span class="hljs-keyword">let</span> thread = Thread {
    <span class="hljs-comment">// 在线程中使用 GCD 同步到主队列</span>
    DispatchQueue.main.sync {
        <span class="hljs-comment">// 如果这个线程恰好是主线程 → 死锁！</span>
        <span class="hljs-comment">// 因为 Thread 创建的不是主线程，</span>
        <span class="hljs-comment">// 但理论上如果是主线程调用就会死锁</span>
    }
}

<span class="hljs-comment">// ✅ 安全的做法</span>
<span class="hljs-keyword">let</span> queue = DispatchQueue.<span class="hljs-keyword">global</span>()
queue.<span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// 在 GCD 管理的线程中使用 GCD</span>
    DispatchQueue.main.<span class="hljs-keyword">async</span> {
        <span class="hljs-comment">// 总是安全的</span>
    }
}
</code></pre>
<h2 data-id="heading-35">性能与开销对比</h2>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 性能测试示例</span>
func <span class="hljs-built_in">measureOverhead</span>() {
    <span class="hljs-comment">// 1. 直接创建 pthread（最快，但最底层）</span>
    <span class="hljs-built_in">measure</span>("pthread_create") {
        <span class="hljs-selector-tag">var</span> thread: pthread_t
        <span class="hljs-built_in">pthread_create</span>(&amp;thread, nil, { _ in return nil }, nil)
        <span class="hljs-built_in">pthread_join</span>(thread, nil)
    }
    
    <span class="hljs-comment">// 2. 创建 NSThread（中等开销）</span>
    <span class="hljs-built_in">measure</span>("NSThread") {
        let thread = Thread { <span class="hljs-comment">/* do nothing */</span> }
        thread<span class="hljs-selector-class">.start</span>()
        <span class="hljs-comment">// 需要同步机制确保线程结束</span>
    }
    
    <span class="hljs-comment">// 3. GCD 提交任务（最低开销，因为复用线程）</span>
    <span class="hljs-built_in">measure</span>("GCD async") {
        let semaphore = <span class="hljs-built_in">DispatchSemaphore</span>(value: <span class="hljs-number">0</span>)
        DispatchQueue<span class="hljs-selector-class">.global</span>()<span class="hljs-selector-class">.async</span> {
            semaphore<span class="hljs-selector-class">.signal</span>()
        }
        semaphore<span class="hljs-selector-class">.wait</span>()
    }
}

<span class="hljs-comment">// 典型结果（相对时间）：</span>
<span class="hljs-comment">// pthread_create: 100ms（基准）</span>
<span class="hljs-comment">// NSThread: 120-150ms（额外对象开销）</span>
<span class="hljs-comment">// GCD async: 10-20ms（线程复用，极低开销）</span>
</code></pre>
<h2 data-id="heading-36">调试技巧</h2>
<h3 data-id="heading-37">1. <strong>查看线程信息</strong></h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 在调试器中查看所有线程</span>
(lldb) thread list
<span class="hljs-comment">// 可以看到：</span>
<span class="hljs-comment">// * thread #1: tid = 0x1a2b3, 0x0000000100000000, </span>
<span class="hljs-comment">//   queue = 'com.apple.main-thread'</span>
<span class="hljs-comment">// * thread #4: tid = 0x1a2b4, 0x0000000100001000,</span>
<span class="hljs-comment">//   queue = 'com.apple.root.default-qos'</span>

<span class="hljs-comment">// 查看线程堆栈</span>
(lldb) bt <span class="hljs-attribute">all</span>
<span class="hljs-comment">// 会显示所有线程的调用栈，包括GCD工作线程</span>
</code></pre>
<h3 data-id="heading-38">2. <strong>识别线程来源</strong></h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 在代码中判断</span>
<span class="hljs-keyword">if</span> <span class="hljs-type">Thread</span>.isMainThread {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"这是主线程"</span>)
}

<span class="hljs-comment">// 判断是否为GCD线程</span>
<span class="hljs-keyword">let</span> threadName <span class="hljs-operator">=</span> <span class="hljs-type">Thread</span>.current.name <span class="hljs-operator">??</span> <span class="hljs-string">""</span>
<span class="hljs-keyword">if</span> threadName.hasPrefix(<span class="hljs-string">"com.apple.root"</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"这是GCD线程池中的线程"</span>)
}

<span class="hljs-comment">// 获取线程的QoS级别</span>
<span class="hljs-keyword">let</span> qos <span class="hljs-operator">=</span> <span class="hljs-type">Thread</span>.current.qualityOfService
<span class="hljs-built_in">print</span>(<span class="hljs-string">"线程QoS: (qos)"</span>)
</code></pre>
<h2 data-id="heading-39">总结</h2>
<h3 data-id="heading-40">关系链</h3>
<pre><code class="hljs language-arduino" lang="arduino">应用层：<span class="hljs-built_in">GCD</span> (DispatchQueue) → 使用并管理 → NSThread/pthread
          ↓
框架层：NSThread → 封装 → <span class="hljs-type">pthread_t</span>
          ↓
系统层：<span class="hljs-type">pthread_t</span> → 内核线程
</code></pre>
<h3 data-id="heading-41">核心要点</h3>
<ol>
<li>
<p><strong>pthread 是基石</strong>：所有线程最终都是 pthread，包括 GCD 创建的线程</p>
</li>
<li>
<p><strong>NSThread 是包装</strong>：提供面向对象的线程操作，底层仍是 pthread</p>
</li>
<li>
<p><strong>GCD 是管理者</strong>：基于 pthread 构建线程池，提供队列抽象</p>
</li>
<li>
<p><strong>线程复用是关键</strong>：GCD 复用线程，而直接使用 pthread/NSThread 通常是一对一</p>
</li>
<li>
<p><strong>抽象层级不同</strong>：</p>
<ul>
<li>pthread：关心"如何创建线程"</li>
<li>NSThread：关心"如何表示线程对象"</li>
<li>GCD：关心"如何组织任务执行"</li>
</ul>
</li>
</ol>
<p><strong>简单比喻</strong>：</p>
<ul>
<li><strong>pthread</strong> 就像"砖块"（基本单元）</li>
<li><strong>NSThread</strong> 就像"有标签的砖块"（易于识别和管理）</li>
<li><strong>GCD</strong> 就像"智能建筑系统"（自动调度砖块完成任务）</li>
</ul>
<p>在实践中，<strong>优先使用 GCD</strong>，它提供最优的线程管理和性能。只有在需要特殊线程控制（如长时间后台计算、实时操作）时才考虑使用 NSThread 或 pthread。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1-3.【GCD】DispatchQueue 的底层数据结构是什么？]]></title>    <link>https://juejin.cn/post/7599847938538618889</link>    <guid>https://juejin.cn/post/7599847938538618889</guid>    <pubDate>2026-01-27T09:36:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599847938538618889" data-draft-id="7599850148056121353" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1-3.【GCD】DispatchQueue 的底层数据结构是什么？"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2026-01-27T09:36:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="项阿丑"/> <meta itemprop="url" content="https://juejin.cn/user/1407852323023447"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1-3.【GCD】DispatchQueue 的底层数据结构是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1407852323023447/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    项阿丑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:36:32.000Z" title="Tue Jan 27 2026 09:36:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>它是一个复杂的 C 结构体，集成了任务队列、线程管理、性能优化等多个子系统</strong>。</p>
<h2 data-id="heading-0">核心数据结构：dispatch_queue_s</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// libdispatch 源码中的核心结构（简化）</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> {
    <span class="hljs-comment">// 1. 基础头部信息（所有 dispatch 对象共享）</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_object_s</span> _as_do[<span class="hljs-number">0</span>];      <span class="hljs-comment">// 转换为 dispatch_object</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> *_as_dq[<span class="hljs-number">0</span>];      <span class="hljs-comment">// 转换为 dispatch_queue</span>
    
    <span class="hljs-comment">// 2. 队列标识信息</span>
    <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_vtable_s</span> *vtable;  <span class="hljs-comment">// 虚函数表（多态）</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *dq_label;                    <span class="hljs-comment">// 队列标签（我们设置的 label）</span>
    <span class="hljs-type">uint16_t</span> dq_width;                       <span class="hljs-comment">// 并发宽度（串行为1）</span>
    <span class="hljs-type">uint32_t</span> dq_serialnum;                   <span class="hljs-comment">// 序列号（唯一标识）</span>
    
    <span class="hljs-comment">// 3. 目标队列和层次结构</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> *dq_targetq;     <span class="hljs-comment">// 目标队列（优先级继承）</span>
    <span class="hljs-type">uintptr_t</span> dq_targetq_override;           <span class="hljs-comment">// 目标队列覆盖（QoS 传播）</span>
    
    <span class="hljs-comment">// 4. 任务队列管理</span>
    <span class="hljs-keyword">union</span> {
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_specific_head_s</span> *dq_specific_head;
        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_source_refs_s</span> *ds_refs;
    } _dq_specific;
    
    <span class="hljs-comment">// 5. 同步原语</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_object_s</span> *<span class="hljs-keyword">volatile</span> dq_items_tail;  <span class="hljs-comment">// 任务队列尾部</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_object_s</span> *<span class="hljs-keyword">volatile</span> dq_items_head;  <span class="hljs-comment">// 任务队列头部</span>
    <span class="hljs-type">uint32_t</span> dq_atomic_flags;                <span class="hljs-comment">// 原子标志位</span>
    
    <span class="hljs-comment">// 6. 线程池和性能管理</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *<span class="hljs-keyword">volatile</span> dq_last;  <span class="hljs-comment">// 最后执行的任务</span>
    <span class="hljs-type">uint32_t</span> dq_side_specific_ints;           <span class="hljs-comment">// 性能计数器</span>
    <span class="hljs-type">pthread_priority_t</span> dq_priority;           <span class="hljs-comment">// 优先级缓存</span>
};
</code></pre>
<h2 data-id="heading-1">详细结构解析</h2>
<h3 data-id="heading-2">1. <strong>多态设计：dispatch_object</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 所有 GCD 对象的基类</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_object_s</span> {
    _DISPATCH_OBJECT_HEADER(object);  <span class="hljs-comment">// 头部宏，包含引用计数等</span>
};

<span class="hljs-comment">// DispatchQueue 通过以下宏实现多态</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> _DISPATCH_QUEUE_CLASS_HEADER(queue_label, ...) \
    _DISPATCH_OBJECT_HEADER(queue) \
    const char *dq_label; \
    uint16_t dq_width;</span>

<span class="hljs-comment">// 这使得：</span>
<span class="hljs-type">dispatch_queue_t</span> queue = <span class="hljs-built_in">dispatch_queue_create</span>(<span class="hljs-string">"com.test"</span>, <span class="hljs-literal">NULL</span>);
<span class="hljs-type">dispatch_object_t</span> obj = (<span class="hljs-type">dispatch_object_t</span>)queue;  <span class="hljs-comment">// 可以向上转型</span>
</code></pre>
<h3 data-id="heading-3">2. <strong>任务队列：双向链表</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 实际存储任务的结构</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_object_s</span> dc_do;           <span class="hljs-comment">// 对象头部</span>
    <span class="hljs-type">dispatch_function_t</span> dc_func;              <span class="hljs-comment">// 执行函数</span>
    <span class="hljs-type">void</span> *dc_ctxt;                            <span class="hljs-comment">// 上下文参数</span>
    <span class="hljs-type">void</span> *dc_data;                            <span class="hljs-comment">// 额外数据</span>
    <span class="hljs-type">void</span> *dc_other;                           <span class="hljs-comment">// 关联数据</span>
    
    <span class="hljs-comment">// 链表指针</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *<span class="hljs-keyword">volatile</span> dc_next;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *dc_prev;
    
    <span class="hljs-comment">// 队列关联</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> *dc_queue;        <span class="hljs-comment">// 所属队列</span>
};

<span class="hljs-comment">// 队列如何管理任务</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *dq_items_head;  <span class="hljs-comment">// 队头</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *dq_items_tail;  <span class="hljs-comment">// 队尾</span>
    <span class="hljs-type">uint32_t</span> dq_nitems;                           <span class="hljs-comment">// 任务计数</span>
};
</code></pre>
<h3 data-id="heading-4">3. <strong>队列层次结构</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 队列间的父子关系（目标队列机制）</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_hierarchy_s</span> {
    <span class="hljs-type">dispatch_queue_t</span> dqh_queue;              <span class="hljs-comment">// 当前队列</span>
    <span class="hljs-type">dispatch_queue_t</span> dqh_target;             <span class="hljs-comment">// 目标队列</span>
    <span class="hljs-type">uintptr_t</span> dqh_override;                  <span class="hljs-comment">// QoS 覆盖</span>
    <span class="hljs-type">uint16_t</span> dqh_priority;                   <span class="hljs-comment">// 优先级</span>
};

<span class="hljs-comment">// 示例：</span>
<span class="hljs-comment">// 自定义队列 → 全局队列 → 根队列</span>
<span class="hljs-comment">// com.test.queue → com.apple.root.default-qos → kernel</span>
</code></pre>
<h3 data-id="heading-5">4. <strong>性能优化结构</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 队列的侧面（side）数据结构</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_side_s</span> {
    <span class="hljs-comment">// 用于性能优化的缓存</span>
    <span class="hljs-type">uint64_t</span> dq_side_timer;                 <span class="hljs-comment">// 定时器相关</span>
    <span class="hljs-type">uint64_t</span> dq_side_wlh;                   <span class="hljs-comment">// 工作循环句柄</span>
    <span class="hljs-type">uint32_t</span> dq_side_bits;                  <span class="hljs-comment">// 状态位</span>
};

<span class="hljs-comment">// 队列特定数据（dispatch_queue_set_specific/get_specific）</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_specific_head_s</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_specific_queue_s</span> *dsq_next;
    <span class="hljs-type">void</span> *dsq_data;                         <span class="hljs-comment">// 用户设置的数据</span>
    <span class="hljs-type">uintptr_t</span> dsq_key;                      <span class="hljs-comment">// 键值</span>
};
</code></pre>
<h2 data-id="heading-6">不同队列类型的内部差异</h2>
<h3 data-id="heading-7">1. <strong>全局队列（Global Queue）</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 全局队列有特殊结构</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_global_s</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> _as_dq[<span class="hljs-number">0</span>];      <span class="hljs-comment">// 基础队列部分</span>
    
    <span class="hljs-comment">// 全局队列特有</span>
    <span class="hljs-type">int</span> dgq_priority;                       <span class="hljs-comment">// 优先级索引</span>
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> dgq_flags;                 <span class="hljs-comment">// 标志位</span>
    
    <span class="hljs-comment">// 共享线程池引用</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_pthread_root_queue_s</span> *dgq_thread_pool;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_workloop_s</span> *dgq_wlh;    <span class="hljs-comment">// 工作循环</span>
};
</code></pre>
<h3 data-id="heading-8">2. <strong>主队列（Main Queue）</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 主队列的特殊处理</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_main_s</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> _as_dq[<span class="hljs-number">0</span>];
    
    <span class="hljs-comment">// 与 RunLoop 集成</span>
    CFRunLoopRef _dq_runloop;               <span class="hljs-comment">// 关联的 RunLoop</span>
    CFRunLoopSourceRef _dq_runloop_source;  <span class="hljs-comment">// 事件源</span>
    
    <span class="hljs-comment">// 串行执行保证</span>
    <span class="hljs-type">pthread_t</span> _dq_main_thread;              <span class="hljs-comment">// 主线程标识</span>
    <span class="hljs-type">uint32_t</span> _dq_main_flags;                <span class="hljs-comment">// 主队列标志</span>
};
</code></pre>
<h3 data-id="heading-9">3. <strong>并发队列 vs 串行队列</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 区别主要在 dq_width 字段：</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> {
    <span class="hljs-type">uint16_t</span> dq_width;  <span class="hljs-comment">// 并发宽度</span>
    <span class="hljs-comment">// 值为 1：串行队列（DISPATCH_QUEUE_SERIAL）</span>
    <span class="hljs-comment">// 值 &gt; 1：并发队列（DISPATCH_QUEUE_CONCURRENT）</span>
    <span class="hljs-comment">// 特殊值：DISPATCH_QUEUE_WIDTH_MAX（并发无限）</span>
};

<span class="hljs-comment">// 并发队列还有额外的管理结构</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_concurrent_s</span> {
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> _as_dq[<span class="hljs-number">0</span>];
    
    <span class="hljs-comment">// 用于并发控制</span>
    os_unfair_lock _dq_lock;                <span class="hljs-comment">// 内部锁</span>
    <span class="hljs-type">uint32_t</span> _dq_running;                   <span class="hljs-comment">// 正在运行的任务数</span>
    <span class="hljs-type">uint32_t</span> _dq_max_running;               <span class="hljs-comment">// 最大并发数</span>
};
</code></pre>
<h2 data-id="heading-10">内存布局示例</h2>
<pre><code class="hljs language-lua" lang="lua">// DispatchQueue 在内存中的大致布局
+<span class="hljs-comment">-----------------------------------+</span>
| dispatch_object_s header          | ← 引用计数、类型信息等
|<span class="hljs-comment">-----------------------------------|</span>
| vtable pointer                    | ← 虚函数表（决定队列类型行为）
|<span class="hljs-comment">-----------------------------------|</span>
| dq_label (<span class="hljs-string">"com.example.queue"</span>)    | ← 队列标签指针
|<span class="hljs-comment">-----------------------------------|</span>
| dq_width (<span class="hljs-number">1</span> 或 n)                 | ← 并发宽度
|<span class="hljs-comment">-----------------------------------|</span>
| dq_serialnum (<span class="hljs-number">0x1234</span>)             | ← 序列号
|<span class="hljs-comment">-----------------------------------|</span>
| dq_targetq (指向全局队列)          | ← 目标队列指针
|<span class="hljs-comment">-----------------------------------|</span>
| dq_items_head → [任务<span class="hljs-number">1</span>] → [任务<span class="hljs-number">2</span>]  | ← 任务链表头
| dq_items_tail → [任务n]            | ← 任务链表尾
|<span class="hljs-comment">-----------------------------------|</span>
| dq_last (最后执行的任务指针)        | ← 性能优化
|<span class="hljs-comment">-----------------------------------|</span>
| dq_priority (QoS 值)              | ← 优先级缓存
+<span class="hljs-comment">-----------------------------------+</span>
</code></pre>
<h2 data-id="heading-11">队列创建过程</h2>
<h3 data-id="heading-12">创建自定义队列时的内部操作：</h3>
<pre><code class="hljs language-ini" lang="ini">dispatch_queue_t dispatch_queue_create(const char *label, 
                                       dispatch_queue_attr_t attr) {
    // 1. 分配内存
    struct dispatch_queue_s *<span class="hljs-attr">dq</span> = calloc(<span class="hljs-number">1</span>, sizeof(struct dispatch_queue_s))<span class="hljs-comment">;</span>
    
    // 2. 设置基本字段
    dq-&gt;<span class="hljs-attr">dq_label</span> = label ? strdup(label) : NULL<span class="hljs-comment">;</span>
    dq-&gt;<span class="hljs-attr">dq_serialnum</span> = dispatch_atomic_inc(&amp;g_serialnum)<span class="hljs-comment">;  // 全局递增</span>
    
    // 3. 根据属性设置并发宽度
    if (<span class="hljs-attr">attr</span> == DISPATCH_QUEUE_SERIAL || attr == NULL) {
        dq-&gt;<span class="hljs-attr">dq_width</span> = <span class="hljs-number">1</span><span class="hljs-comment">;  // 串行</span>
    } else if (<span class="hljs-attr">attr</span> == DISPATCH_QUEUE_CONCURRENT) {
        dq-&gt;<span class="hljs-attr">dq_width</span> = DISPATCH_QUEUE_WIDTH_MAX<span class="hljs-comment">;  // 并发</span>
    }
    
    // 4. 设置目标队列（通常是全局队列）
    dq-&gt;<span class="hljs-attr">dq_targetq</span> = _dispatch_get_root_queue(qos, overcommit)<span class="hljs-comment">;</span>
    
    // 5. 设置虚函数表
    if (dq-&gt;<span class="hljs-attr">dq_width</span> == <span class="hljs-number">1</span>) {
        dq-&gt;<span class="hljs-attr">vtable</span> = &amp;_dispatch_queue_serial_vtable<span class="hljs-comment">;</span>
    } else {
        dq-&gt;<span class="hljs-attr">vtable</span> = &amp;_dispatch_queue_concurrent_vtable<span class="hljs-comment">;</span>
    }
    
    // 6. 初始化任务链表
    dq-&gt;<span class="hljs-attr">dq_items_head</span> = dq-&gt;dq_items_tail = NULL<span class="hljs-comment">;</span>
    
    return dq<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-13">任务执行流程数据结构</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 任务提交和执行涉及的数据结构</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_workloop_s</span> {
    <span class="hljs-comment">// 工作循环（每个线程一个）</span>
    <span class="hljs-type">pthread_workqueue_t</span> dqw_workqueue;      <span class="hljs-comment">// 底层工作队列</span>
    <span class="hljs-type">uint32_t</span> dqw_refcnt;                    <span class="hljs-comment">// 引用计数</span>
    <span class="hljs-type">uint16_t</span> dqw_qos;                       <span class="hljs-comment">// QoS 级别</span>
    
    <span class="hljs-comment">// 任务调度</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *dqw_head;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *dqw_tail;
    
    <span class="hljs-comment">// 线程池管理</span>
    <span class="hljs-type">uint32_t</span> dqw_thread_pool_size;          <span class="hljs-comment">// 线程池大小</span>
    <span class="hljs-type">uint32_t</span> dqw_thread_pool_active;        <span class="hljs-comment">// 活跃线程数</span>
};
</code></pre>
<h2 data-id="heading-14">调试信息</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 可以通过私有 API 查看内部结构（仅调试）</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">DispatchQueue</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">debugInfo</span>() {
        <span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">as</span> <span class="hljs-type">AnyObject</span>
        
        <span class="hljs-comment">// 使用 Objective-C 运行时查看内部结构</span>
        <span class="hljs-keyword">let</span> ivars <span class="hljs-operator">=</span> class_copyIvarList(object_getClass(queue), <span class="hljs-literal">nil</span>)
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> ivar <span class="hljs-operator">=</span> ivars<span class="hljs-operator">?</span>.pointee {
            <span class="hljs-keyword">let</span> name <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(cString: ivar_getName(ivar)<span class="hljs-operator">!</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Ivar: (name)"</span>)
        }
    }
}

<span class="hljs-comment">// 或者使用 LLDB 调试</span>
(lldb) po (id)<span class="hljs-number">0x600003d6c040</span>  <span class="hljs-comment">// 假设这是队列地址</span>
<span class="hljs-comment">// 可以看到内部字段（如果符号可用）</span>
</code></pre>
<h2 data-id="heading-15">性能优化特性</h2>
<h3 data-id="heading-16">1. <strong>内联缓存</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_cache_s</span> {
    <span class="hljs-comment">// 缓存最近使用的队列</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> *dqc_queues[DISPATCH_QUEUE_CACHE_SIZE];
    <span class="hljs-type">uint32_t</span> dqc_hits;                      <span class="hljs-comment">// 缓存命中次数</span>
    <span class="hljs-type">uint32_t</span> dqc_misses;                    <span class="hljs-comment">// 缓存未命中</span>
};
</code></pre>
<h3 data-id="heading-17">2. <strong>优先级继承</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_priority_s</span> {
    <span class="hljs-type">uint16_t</span> dqp_priority;                  <span class="hljs-comment">// 当前优先级</span>
    <span class="hljs-type">uint16_t</span> dqp_inherited;                 <span class="hljs-comment">// 继承的优先级</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> *dqp_source;    <span class="hljs-comment">// 优先级来源队列</span>
};
</code></pre>
<h2 data-id="heading-18">总结</h2>
<p><code>DispatchQueue</code> 的底层数据结构：</p>
<ol>
<li><strong>复杂但高效</strong>：多层结构体设计，兼顾灵活性和性能</li>
<li><strong>基于对象模型</strong>：所有 dispatch 对象共享基类，实现多态</li>
<li><strong>链表管理任务</strong>：使用双向链表存储待执行任务</li>
<li><strong>层次化设计</strong>：队列有目标队列，形成优先级继承链</li>
<li><strong>类型特定扩展</strong>：不同队列类型有不同字段和虚函数表</li>
<li><strong>性能优化密集</strong>：包含大量缓存、计数器和优化字段</li>
</ol>
<p><strong>简单来说</strong>：<code>DispatchQueue</code> 在底层是一个<strong>精心设计的任务调度引擎</strong>，它：</p>
<ul>
<li>用<strong>结构体</strong>表示队列（而非类）</li>
<li>用<strong>链表</strong>管理任务</li>
<li>用<strong>虚函数表</strong>实现不同队列类型的行为</li>
<li>用<strong>目标队列</strong>机制实现优先级继承</li>
<li>高度优化以减少内存占用和提高性能</li>
</ul>
<p>这种设计使得 GCD 能够在极小的开销下处理数千个队列和数百万个任务调度。</p>
<h2 data-id="heading-19">👉 追问：任务是如何入队、出队的？</h2>
<p>任务入队出队是 GCD 的核心机制，涉及<strong>原子操作、无锁队列、优先级调度</strong>等多个复杂系统。</p>
<h2 data-id="heading-20">核心数据结构关系</h2>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 简化版数据结构关系</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_s</span> {
    <span class="hljs-comment">// 任务链表（无锁队列）</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *<span class="hljs-keyword">volatile</span> dq_items_head;  <span class="hljs-comment">// 队头</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *<span class="hljs-keyword">volatile</span> dq_items_tail;  <span class="hljs-comment">// 队尾</span>
    <span class="hljs-type">uint32_t</span> dq_nitems;                           <span class="hljs-comment">// 任务计数</span>
    
    <span class="hljs-comment">// 线程池引用</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_queue_workloop_s</span> *dq_wlh;     <span class="hljs-comment">// 工作循环</span>
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> {
    <span class="hljs-comment">// 任务数据和函数指针</span>
    <span class="hljs-type">dispatch_function_t</span> dc_func;      <span class="hljs-comment">// 要执行的函数</span>
    <span class="hljs-type">void</span> *dc_ctxt;                    <span class="hljs-comment">// 上下文参数</span>
    
    <span class="hljs-comment">// 链表指针（双向链表）</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *<span class="hljs-keyword">volatile</span> dc_next;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dispatch_continuation_s</span> *dc_prev;
    
    <span class="hljs-comment">// 标记信息</span>
    <span class="hljs-type">uintptr_t</span> dc_flags;              <span class="hljs-comment">// 标志位（同步/异步/屏障等）</span>
};
</code></pre>
<h2 data-id="heading-21">1. 入队过程（Enqueue）</h2>
<h3 data-id="heading-22">异步任务入队（dispatch_async）</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 用户调用</span>
queue<span class="hljs-selector-class">.async</span> {
    <span class="hljs-built_in">print</span>("任务执行")
}

<span class="hljs-comment">// 内部处理流程</span>
func <span class="hljs-built_in">dispatch_async</span>(queue: dispatch_queue_t, block: @escaping () -&gt; Void) {
    <span class="hljs-comment">// 1. 封装任务</span>
    let continuation = <span class="hljs-built_in">_dispatch_continuation_alloc</span>()
    continuation<span class="hljs-selector-class">.dc_func</span> = _dispatch_call_block_and_release
    continuation<span class="hljs-selector-class">.dc_ctxt</span> = <span class="hljs-built_in">Block_copy</span>(block)  <span class="hljs-comment">// 复制block到堆上</span>
    
    <span class="hljs-comment">// 2. 获取队列状态</span>
    let old_state = queue<span class="hljs-selector-class">.dq_state</span>
    
    <span class="hljs-comment">// 3. 尝试快速路径（无锁操作）</span>
    if <span class="hljs-built_in">_dispatch_queue_try_acquire_async</span>(queue) {
        <span class="hljs-comment">// 快速路径：队列空闲，直接调度</span>
        <span class="hljs-built_in">_dispatch_continuation_schedule</span>(queue, continuation)
        return
    }
    
    <span class="hljs-comment">// 4. 慢速路径：需要加锁或队列繁忙</span>
    <span class="hljs-built_in">_dispatch_queue_push</span>(queue, continuation)
}
</code></pre>
<h3 data-id="heading-23">详细入队步骤</h3>
<pre><code class="hljs language-ini" lang="ini">// 实际入队函数
void _dispatch_queue_push(dispatch_queue_t dq, 
                         dispatch_continuation_t dc) {
    
    // 步骤1：设置任务状态
    dc-&gt;<span class="hljs-attr">dc_queue</span> = dq<span class="hljs-comment">;           // 关联队列</span>
    dc-&gt;<span class="hljs-attr">dc_flags</span> = ASYNC<span class="hljs-comment">;        // 标记为异步</span>
    
    // 步骤2：原子操作将任务加入链表尾部
    dispatch_continuation_t prev_tail<span class="hljs-comment">;</span>
    do {
        <span class="hljs-attr">prev_tail</span> = dq-&gt;dq_items_tail<span class="hljs-comment">;</span>
        dc-&gt;<span class="hljs-attr">dc_prev</span> = prev_tail<span class="hljs-comment">;           // 设置前驱</span>
    } while (!os_atomic_cmpxchg(&amp;dq-&gt;dq_items_tail, 
                                prev_tail, 
                                dc, 
                                relaxed))<span class="hljs-comment">;</span>
    
    // 步骤3：更新前一个节点的next指针
    if (prev_tail) {
        prev_tail-&gt;<span class="hljs-attr">dc_next</span> = dc<span class="hljs-comment">;          // 连接链表</span>
    } else {
        // 这是第一个任务，更新头指针
        dq-&gt;<span class="hljs-attr">dq_items_head</span> = dc<span class="hljs-comment">;</span>
    }
    
    // 步骤4：原子递增任务计数
    os_atomic_inc(&amp;dq-&gt;dq_nitems, relaxed)<span class="hljs-comment">;</span>
    
    // 步骤5：唤醒工作线程（如果需要）
    _dispatch_queue_wakeup(dq)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-24">屏障任务特殊处理</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 屏障任务的入队</span>
void <span class="hljs-built_in">_dispatch_barrier_async</span>(dispatch_queue_t dq, 
                            dispatch_block_t block) {
    
    dispatch_continuation_t dc = <span class="hljs-built_in">_dispatch_continuation_alloc</span>();
    dc-&gt;dc_func = _dispatch_call_block_and_release;
    dc-&gt;dc_ctxt = <span class="hljs-built_in">Block_copy</span>(block);
    dc-&gt;dc_flags = BARRIER;               <span class="hljs-comment">// 关键：设置屏障标志</span>
    
    <span class="hljs-comment">// 屏障任务需要特殊处理：</span>
    <span class="hljs-comment">// 1. 插入到队列末尾</span>
    <span class="hljs-comment">// 2. 标记队列进入"屏障模式"</span>
    <span class="hljs-comment">// 3. 等待前面所有任务完成</span>
    
    <span class="hljs-built_in">_dispatch_queue_push_barrier</span>(dq, dc);
    
    <span class="hljs-comment">// 更新队列状态</span>
    dq-&gt;dq_atomic_flags |= DISPATCH_QUEUE_IN_BARRIER;
}
</code></pre>
<h2 data-id="heading-25">2. 出队过程（Dequeue）</h2>
<h3 data-id="heading-26">工作线程取任务</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 工作线程的主循环</span>
void *<span class="hljs-built_in">_dispatch_worker_thread</span>(void *context) {
    dispatch_queue_t dq = (dispatch_queue_t)context;
    
    while (<span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 步骤1：获取下一个任务</span>
        dispatch_continuation_t dc = <span class="hljs-built_in">_dispatch_queue_pop</span>(dq);
        
        if (dc) {
            <span class="hljs-comment">// 步骤2：执行任务</span>
            <span class="hljs-built_in">_dispatch_continuation_invoke</span>(dq, dc);
            
            <span class="hljs-comment">// 步骤3：任务完成后处理</span>
            <span class="hljs-built_in">_dispatch_continuation_free</span>(dc);
        } else {
            <span class="hljs-comment">// 步骤4：无任务，可能休眠或处理其他队列</span>
            <span class="hljs-built_in">_dispatch_worker_yield_or_exit</span>(dq);
        }
    }
    return NULL;
}
</code></pre>
<h3 data-id="heading-27">详细出队实现</h3>
<pre><code class="hljs language-ini" lang="ini">// 从队列弹出任务
dispatch_continuation_t _dispatch_queue_pop(dispatch_queue_t dq) {
    
    // 步骤1：检查队列状态
    if (dq-&gt;<span class="hljs-attr">dq_nitems</span> == <span class="hljs-number">0</span>) {
        return NULL<span class="hljs-comment">;  // 队列为空</span>
    }
    
    // 步骤2：处理串行队列（简单）
    if (dq-&gt;<span class="hljs-attr">dq_width</span> == <span class="hljs-number">1</span>) {  // 串行队列
        return _dispatch_queue_pop_serial(dq)<span class="hljs-comment">;</span>
    }
    
    // 步骤3：处理并发队列（复杂）
    return _dispatch_queue_pop_concurrent(dq)<span class="hljs-comment">;</span>
}

// 串行队列出队（简单FIFO）
dispatch_continuation_t _dispatch_queue_pop_serial(dispatch_queue_t dq) {
    
    // 原子操作获取队头
    dispatch_continuation_t head<span class="hljs-comment">;</span>
    do {
        <span class="hljs-attr">head</span> = dq-&gt;dq_items_head<span class="hljs-comment">;</span>
        if (!head) return NULL<span class="hljs-comment">;  // 队列为空</span>
        
        // 尝试将头指针指向下一个任务
    } while (!os_atomic_cmpxchg(&amp;dq-&gt;dq_items_head, 
                                head, 
                                head-&gt;dc_next, 
                                acquire))<span class="hljs-comment">;</span>
    
    // 如果队列变空，清空尾指针
    if (head-&gt;<span class="hljs-attr">dc_next</span> == NULL) {
        dq-&gt;<span class="hljs-attr">dq_items_tail</span> = NULL<span class="hljs-comment">;</span>
    }
    
    // 更新任务计数
    os_atomic_dec(&amp;dq-&gt;dq_nitems, relaxed)<span class="hljs-comment">;</span>
    
    // 清理链表指针
    head-&gt;<span class="hljs-attr">dc_next</span> = NULL<span class="hljs-comment">;</span>
    head-&gt;<span class="hljs-attr">dc_prev</span> = NULL<span class="hljs-comment">;</span>
    
    return head<span class="hljs-comment">;</span>
}

// 并发队列出队（多线程安全）
dispatch_continuation_t _dispatch_queue_pop_concurrent(dispatch_queue_t dq) {
    
    // 使用原子操作+重试机制
    dispatch_continuation_t <span class="hljs-attr">task</span> = NULL<span class="hljs-comment">;</span>
    bool <span class="hljs-attr">acquired</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    
    while (!acquired) {
        // 原子读取队头
        dispatch_continuation_t <span class="hljs-attr">old_head</span> = dq-&gt;dq_items_head<span class="hljs-comment">;</span>
        
        if (!old_head) {
            return NULL<span class="hljs-comment">;  // 队列为空</span>
        }
        
        // 尝试获取任务所有权
        <span class="hljs-attr">acquired</span> = os_atomic_cmpxchg(&amp;dq-&gt;dq_items_head, 
                                     old_head, 
                                     old_head-&gt;dc_next, 
                                     acquire)<span class="hljs-comment">;</span>
        
        if (acquired) {
            <span class="hljs-attr">task</span> = old_head<span class="hljs-comment">;</span>
            
            // 如果这是最后一个任务
            if (task-&gt;<span class="hljs-attr">dc_next</span> == NULL) {
                // 需要原子更新尾指针
                os_atomic_store(&amp;dq-&gt;dq_items_tail, NULL, relaxed)<span class="hljs-comment">;</span>
            }
        }
        // 如果失败，说明其他线程抢先获取了，重试
    }
    
    os_atomic_dec(&amp;dq-&gt;dq_nitems, relaxed)<span class="hljs-comment">;</span>
    task-&gt;<span class="hljs-attr">dc_next</span> = NULL<span class="hljs-comment">;</span>
    task-&gt;<span class="hljs-attr">dc_prev</span> = NULL<span class="hljs-comment">;</span>
    
    return task<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-28">3. 任务执行流程</h2>
<h3 data-id="heading-29">任务执行函数</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 执行任务的函数</span>
void <span class="hljs-built_in">_dispatch_continuation_invoke</span>(dispatch_queue_t dq,
                                   dispatch_continuation_t dc) {
    
    <span class="hljs-comment">// 步骤1：保存当前队列上下文</span>
    dispatch_queue_t old_dq = <span class="hljs-built_in">_dispatch_thread_getspecific</span>(dispatch_queue_key);
    <span class="hljs-built_in">_dispatch_thread_setspecific</span>(dispatch_queue_key, dq);
    
    <span class="hljs-comment">// 步骤2：设置线程名字（便于调试）</span>
    if (dq-&gt;dq_label) {
        <span class="hljs-built_in">pthread_setname_np</span>(dq-&gt;dq_label);
    }
    
    <span class="hljs-comment">// 步骤3：执行任务函数</span>
    dc-&gt;<span class="hljs-built_in">dc_func</span>(dc-&gt;dc_ctxt);
    
    <span class="hljs-comment">// 步骤4：恢复之前的队列上下文</span>
    <span class="hljs-built_in">_dispatch_thread_setspecific</span>(dispatch_queue_key, old_dq);
    
    <span class="hljs-comment">// 步骤5：如果是同步任务，发送信号</span>
    if (dc-&gt;dc_flags &amp; SYNC) {
        <span class="hljs-built_in">_dispatch_semaphore_signal</span>(dc-&gt;dc_semaphore);
    }
}
</code></pre>
<h3 data-id="heading-30">屏障任务的特殊执行</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 屏障任务的执行</span>
void <span class="hljs-built_in">_dispatch_barrier_execute</span>(dispatch_queue_t dq,
                               dispatch_continuation_t dc) {
    
    <span class="hljs-comment">// 步骤1：等待队列中所有前置任务完成</span>
    while (dq-&gt;dq_running &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 忙等待或让出CPU</span>
        <span class="hljs-built_in">_dispatch_hardware_pause</span>();
    }
    
    <span class="hljs-comment">// 步骤2：执行屏障任务（独占执行）</span>
    <span class="hljs-built_in">_dispatch_continuation_invoke</span>(dq, dc);
    
    <span class="hljs-comment">// 步骤3：清除屏障标志</span>
    dq-&gt;dq_atomic_flags &amp;= ~DISPATCH_QUEUE_IN_BARRIER;
    
    <span class="hljs-comment">// 步骤4：唤醒等待的后续任务</span>
    <span class="hljs-built_in">_dispatch_queue_wakeup_next</span>(dq);
}
</code></pre>
<h2 data-id="heading-31">4. 性能优化机制</h2>
<h3 data-id="heading-32">任务批处理</h3>
<pre><code class="hljs language-ini" lang="ini">// 批量处理任务（减少锁开销）
void _dispatch_queue_drain(dispatch_queue_t dq) {
    
    // 尝试一次性取出多个任务
    dispatch_continuation_t batch<span class="hljs-section">[16]</span><span class="hljs-comment">;</span>
    int <span class="hljs-attr">count</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    
    // 批量出队
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 16; i++) {</span>
        dispatch_continuation_t <span class="hljs-attr">dc</span> = _dispatch_queue_pop_fast(dq)<span class="hljs-comment">;</span>
        if (!dc) break<span class="hljs-comment">;</span>
        
        batch<span class="hljs-section">[count++]</span> = dc<span class="hljs-comment">;</span>
    }
    
    if (<span class="hljs-attr">count</span> == <span class="hljs-number">0</span>) return<span class="hljs-comment">;</span>
    
    // 批量执行
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; count; i++) {</span>
        _dispatch_continuation_invoke(dq, batch<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
        _dispatch_continuation_free(batch<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h3 data-id="heading-33">工作窃取（Work Stealing）</h3>
<pre><code class="hljs language-ini" lang="ini">// 当线程空闲时，尝试从其他队列窃取任务
dispatch_continuation_t _dispatch_worksteal(void) {
    
    // 步骤1：获取当前线程的工作队列
    dispatch_queue_t <span class="hljs-attr">current_queue</span> = _dispatch_thread_get_queue()<span class="hljs-comment">;</span>
    
    // 步骤2：遍历全局队列列表
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; global_queue_count; i++) {</span>
        dispatch_queue_t <span class="hljs-attr">target</span> = global_queues[i]<span class="hljs-comment">;</span>
        
        // 跳过自己的队列和空队列
        if (<span class="hljs-attr">target</span> == current_queue) continue<span class="hljs-comment">;</span>
        if (target-&gt;<span class="hljs-attr">dq_nitems</span> == <span class="hljs-number">0</span>) continue<span class="hljs-comment">;</span>
        
        // 步骤3：尝试窃取任务
        dispatch_continuation_t <span class="hljs-attr">stolen</span> = _dispatch_queue_try_steal(target)<span class="hljs-comment">;</span>
        if (stolen) {
            return stolen<span class="hljs-comment">;  // 窃取成功</span>
        }
    }
    
    return NULL<span class="hljs-comment">;  // 没有可窃取的任务</span>
}
</code></pre>
<h2 data-id="heading-34">5. 同步任务特殊处理</h2>
<h3 data-id="heading-35">dispatch_sync 的实现</h3>
<pre><code class="hljs language-ini" lang="ini">void dispatch_sync(dispatch_queue_t dq, dispatch_block_t block) {
    
    // 优化：如果当前已经在目标队列上，直接执行
    if (_dispatch_queue_is_current(dq)) {
        block()<span class="hljs-comment">;</span>
        return<span class="hljs-comment">;</span>
    }
    
    // 创建同步任务结构
    struct dispatch_sync_context_s {
        dispatch_semaphore_t sema<span class="hljs-comment">;</span>
        dispatch_block_t block<span class="hljs-comment">;</span>
        bool done<span class="hljs-comment">;</span>
    } context<span class="hljs-comment">;</span>
    
    <span class="hljs-attr">context.sema</span> = dispatch_semaphore_create(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">context.block</span> = block<span class="hljs-comment">;</span>
    <span class="hljs-attr">context.done</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    
    // 创建任务
    dispatch_continuation_t <span class="hljs-attr">dc</span> = _dispatch_continuation_alloc()<span class="hljs-comment">;</span>
    dc-&gt;<span class="hljs-attr">dc_func</span> = _dispatch_sync_invoke<span class="hljs-comment">;</span>
    dc-&gt;<span class="hljs-attr">dc_ctxt</span> = &amp;context<span class="hljs-comment">;</span>
    dc-&gt;<span class="hljs-attr">dc_flags</span> = SYNC<span class="hljs-comment">;</span>
    dc-&gt;<span class="hljs-attr">dc_semaphore</span> = context.sema<span class="hljs-comment">;</span>
    
    // 入队
    _dispatch_queue_push(dq, dc)<span class="hljs-comment">;</span>
    
    // 等待任务完成
    dispatch_semaphore_wait(context.sema, DISPATCH_TIME_FOREVER)<span class="hljs-comment">;</span>
    
    // 检查是否成功执行
    if (!context.done) {
        // 发生错误
        dispatch_panic("dispatch_sync failed")<span class="hljs-comment">;</span>
    }
}

// 同步任务执行函数
static void _dispatch_sync_invoke(void *ctxt) {
    struct dispatch_sync_context_s *<span class="hljs-attr">ctx</span> = ctxt<span class="hljs-comment">;</span>
    ctx-&gt;block()<span class="hljs-comment">;</span>
    ctx-&gt;<span class="hljs-attr">done</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-36">6. 优先级处理</h2>
<h3 data-id="heading-37">QoS 传播和提升</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 处理任务的优先级</span>
void <span class="hljs-built_in">_dispatch_queue_adjust_priority</span>(dispatch_queue_t dq,
                                     dispatch_continuation_t dc) {
    
    <span class="hljs-comment">// 获取任务的 QoS</span>
    qos_class_t task_qos = <span class="hljs-built_in">_dispatch_continuation_get_qos</span>(dc);
    
    <span class="hljs-comment">// 如果任务优先级高于队列当前优先级</span>
    if (task_qos &gt; dq-&gt;dq_priority) {
        <span class="hljs-comment">// 提升队列优先级</span>
        qos_class_t old_qos = dq-&gt;dq_priority;
        dq-&gt;dq_priority = task_qos;
        
        <span class="hljs-comment">// 重新调度队列中的工作线程</span>
        <span class="hljs-built_in">_dispatch_queue_reschedule</span>(dq, old_qos, task_qos);
    }
    
    <span class="hljs-comment">// 设置执行线程的 QoS</span>
    <span class="hljs-built_in">pthread_set_qos_class_self_np</span>(task_qos, <span class="hljs-number">0</span>);
}
</code></pre>
<h2 data-id="heading-38">完整流程示例</h2>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 模拟一个任务从提交到完成的完整流程</span>
func <span class="hljs-built_in">exampleTaskLifecycle</span>() {
    let queue = <span class="hljs-built_in">DispatchQueue</span>(label: "com.example", attributes: .concurrent)
    
    <span class="hljs-comment">// 用户提交任务</span>
    queue<span class="hljs-selector-class">.async</span> {
        <span class="hljs-built_in">print</span>("任务执行开始")
        <span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>)
        <span class="hljs-built_in">print</span>("任务执行结束")
    }
    
    <span class="hljs-comment">// 内部流程：</span>
    <span class="hljs-comment">// 1. async() 创建 dispatch_continuation_t</span>
    <span class="hljs-comment">// 2. 原子操作将任务添加到 queue.dq_items_tail</span>
    <span class="hljs-comment">// 3. queue.dq_nitems 原子递增</span>
    <span class="hljs-comment">// 4. _dispatch_queue_wakeup() 唤醒工作线程</span>
    <span class="hljs-comment">// 5. 工作线程从 queue.dq_items_head 取出任务</span>
    <span class="hljs-comment">// 6. 调用 dc_func(dc_ctxt) 执行任务</span>
    <span class="hljs-comment">// 7. 任务完成，dc 被释放</span>
    <span class="hljs-comment">// 8. 工作线程继续取下一个任务或休眠</span>
}
</code></pre>
<h2 data-id="heading-39">7. 内存管理优化</h2>
<h3 data-id="heading-40">任务缓存池</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 避免频繁分配释放 dispatch_continuation_t</span>
struct dispatch_continuation_cache_s {
    dispatch_continuation_t free_list;      <span class="hljs-comment">// 空闲列表</span>
    uint32_t count;                         <span class="hljs-comment">// 缓存数量</span>
    os_unfair_lock lock;                    <span class="hljs-comment">// 保护锁</span>
};

<span class="hljs-comment">// 获取一个任务结构（优先从缓存取）</span>
dispatch_continuation_t <span class="hljs-built_in">_dispatch_continuation_alloc</span>(void) {
    dispatch_continuation_cache_t cache = &amp;g_continuation_cache;
    
    <span class="hljs-comment">// 尝试从缓存获取</span>
    <span class="hljs-built_in">os_unfair_lock_lock</span>(&amp;cache-&gt;lock);
    if (cache-&gt;free_list) {
        dispatch_continuation_t dc = cache-&gt;free_list;
        cache-&gt;free_list = dc-&gt;dc_next;
        cache-&gt;count--;
        <span class="hljs-built_in">os_unfair_lock_unlock</span>(&amp;cache-&gt;lock);
        
        <span class="hljs-comment">// 清零复用</span>
        <span class="hljs-built_in">memset</span>(dc, <span class="hljs-number">0</span>, sizeof(struct dispatch_continuation_s));
        return dc;
    }
    <span class="hljs-built_in">os_unfair_lock_unlock</span>(&amp;cache-&gt;lock);
    
    <span class="hljs-comment">// 缓存为空，分配新的</span>
    return <span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, sizeof(struct dispatch_continuation_s));
}

<span class="hljs-comment">// 释放任务结构（放入缓存）</span>
void <span class="hljs-built_in">_dispatch_continuation_free</span>(dispatch_continuation_t dc) {
    dispatch_continuation_cache_t cache = &amp;g_continuation_cache;
    
    <span class="hljs-built_in">os_unfair_lock_lock</span>(&amp;cache-&gt;lock);
    if (cache-&gt;count &lt; DISPATCH_CONTINUATION_CACHE_MAX) {
        <span class="hljs-comment">// 放入缓存</span>
        dc-&gt;dc_next = cache-&gt;free_list;
        cache-&gt;free_list = dc;
        cache-&gt;count++;
        <span class="hljs-built_in">os_unfair_lock_unlock</span>(&amp;cache-&gt;lock);
    } else {
        <span class="hljs-built_in">os_unfair_lock_unlock</span>(&amp;cache-&gt;lock);
        <span class="hljs-built_in">free</span>(dc);  <span class="hljs-comment">// 缓存已满，直接释放</span>
    }
}
</code></pre>
<h2 data-id="heading-41">总结</h2>
<p>任务入队出队的核心机制：</p>
<h3 data-id="heading-42"><strong>入队过程</strong>：</h3>
<ol>
<li><strong>封装任务</strong>：将block封装成 <code>dispatch_continuation_t</code></li>
<li><strong>原子操作</strong>：使用CAS（Compare-And-Swap）将任务添加到链表尾部</li>
<li><strong>唤醒机制</strong>：如果需要，唤醒工作线程处理任务</li>
<li><strong>优先级处理</strong>：根据任务QoS调整队列优先级</li>
</ol>
<h3 data-id="heading-43"><strong>出队过程</strong>：</h3>
<ol>
<li><strong>原子竞争</strong>：多个工作线程竞争获取任务（无锁队列）</li>
<li><strong>批量处理</strong>：可能一次性取出多个任务减少开销</li>
<li><strong>工作窃取</strong>：空闲线程可以从其他队列窃取任务</li>
<li><strong>屏障处理</strong>：屏障任务确保前后任务不交错执行</li>
</ol>
<h3 data-id="heading-44"><strong>关键优化</strong>：</h3>
<ol>
<li><strong>无锁设计</strong>：使用原子操作避免锁竞争</li>
<li><strong>缓存复用</strong>：重用任务结构体减少内存分配</li>
<li><strong>批量处理</strong>：减少上下文切换开销</li>
<li><strong>优先级继承</strong>：高优先级任务能更快执行</li>
<li><strong>工作窃取</strong>：提高CPU利用率</li>
</ol>
<p><strong>简单比喻</strong>：</p>
<ul>
<li><strong>入队</strong> 像"快递站收件"：你提交包裹（任务），快递站记录到清单（队列），通知快递员（线程）来取</li>
<li><strong>出队</strong> 像"快递员派件"：快递员从清单取包裹，派送（执行），完成后标记完成</li>
<li><strong>GCD</strong> 像"智能调度系统"：动态分配快递员，优化路线，处理急件优先</li>
</ul>
<p>这种设计使得 GCD 能够以极低的延迟处理数百万级的任务调度，同时保持高吞吐量和低CPU占用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[企业级人脸识别ArcFace系统架构与实现：从零到一构建高性能智能识别平台]]></title>    <link>https://juejin.cn/post/7599847938538749961</link>    <guid>https://juejin.cn/post/7599847938538749961</guid>    <pubDate>2026-01-27T09:46:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599847938538749961" data-draft-id="7599847938538651657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="企业级人脸识别ArcFace系统架构与实现：从零到一构建高性能智能识别平台"/> <meta itemprop="keywords" content="Trae,Spring Boot"/> <meta itemprop="datePublished" content="2026-01-27T09:46:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Harry技术"/> <meta itemprop="url" content="https://juejin.cn/user/4325909730446745"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            企业级人脸识别ArcFace系统架构与实现：从零到一构建高性能智能识别平台
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4325909730446745/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Harry技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:46:52.000Z" title="Tue Jan 27 2026 09:46:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">企业级人脸识别系统架构与实现：从零到一构建高性能智能识别平台</h2>
<blockquote>
<p>作者：Harry 公众号：Harry技术 本文将深入解析一个完整的企业级人脸识别系统，涵盖架构设计、核心算法、性能优化等关键技术点。</p>
</blockquote>
<h3 data-id="heading-1">前言</h3>
<p>随着人工智能技术的快速发展，人脸识别已经成为智能化应用的重要组成部分。本文将基于实际项目经验，详细介绍如何构建一个高性能、可扩展的企业级人脸识别系统。</p>
<h3 data-id="heading-2">系统架构概览</h3>
<h4 data-id="heading-3">整体架构设计</h4>
<p>我们的人脸识别系统采用前后端分离的架构，主要包含以下几个核心模块：</p>
<pre><code class="hljs language-dart" lang="dart">┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面层     │    │   API网关层     │    │   业务服务层     │
│  Vue3 + TS      │◄──►│  Spring Boot    │◄──►│  人脸识别服务    │
│  <span class="hljs-built_in">Element</span> Plus   │    │  RESTful API    │    │  特征管理服务    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                       ┌─────────────────┐    ┌─────────────────┐
                       │   缓存层        │    │   存储层        │
                       │  Redis          │◄──►│  MySQL          │
                       │  特征缓存       │    │  用户数据       │
                       └─────────────────┘    └─────────────────┘
                                │
                       ┌─────────────────┐
                       │   算法引擎层     │
                       │  虹软ArcFace    │
                       │  引擎池管理     │
                       └─────────────────┘
</code></pre>
<h4 data-id="heading-4">技术栈选择</h4>
<p><strong>前端技术栈：</strong></p>
<ul>
<li>Vue 3 + TypeScript：现代化前端框架</li>
<li>Element Plus：企业级UI组件库</li>
<li>Vite：高性能构建工具</li>
</ul>
<p><strong>后端技术栈：</strong></p>
<ul>
<li>Spring Boot 3：微服务框架</li>
<li>MyBatis Plus：数据访问层</li>
<li>Redis：高性能缓存</li>
<li>MySQL：关系型数据库</li>
</ul>
<p><strong>算法引擎：</strong></p>
<ul>
<li>虹软ArcFace SDK：业界领先的人脸识别算法</li>
</ul>
<h3 data-id="heading-5">核心功能模块</h3>
<h4 data-id="heading-6">1. 人脸检测与识别</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c65ac02c76194594b16347ff56d6f41c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112011&amp;x-signature=o7k4NAEb1EW8e4mfiW8woTBIXDE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-7">前端实现</h5>
<p>前端采用Vue 3 Composition API，实现了直观的人脸识别界面：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"recognition-content"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 智能识别中心 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section-block hero-block"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hero-icon"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">CameraFilled</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"hero-text"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>智能识别中心<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>拖拽或上传照片，系统将自动完成检测、比对与注册。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
​
    <span class="hljs-comment">&lt;!-- 图片上传区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"upload-body"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-upload</span>
        <span class="hljs-attr">:auto-upload</span>=<span class="hljs-string">"false"</span>
        <span class="hljs-attr">:before-upload</span>=<span class="hljs-string">"beforeUpload"</span>
        <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span>
        <span class="hljs-attr">drag</span>
        @<span class="hljs-attr">change</span>=<span class="hljs-string">"handleUploadChange"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">Plus</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>拖拽或点击上传人脸图像<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-upload</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 实时预览与检测框 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-preview-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"previewImageRef"</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"recognitionImageUrl"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
          <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showDetectionBox"</span>
          <span class="hljs-attr">class</span>=<span class="hljs-string">"face-detection-box"</span>
          <span class="hljs-attr">:style</span>=<span class="hljs-string">"detectionBoxStyle"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box-label"</span>&gt;</span>{{ recognitionResult?.name || '未识别' }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><strong>核心功能特性：</strong></p>
<ul>
<li>拖拽上传支持</li>
<li>实时人脸检测框显示</li>
<li>历史图片快速切换</li>
<li>响应式布局设计</li>
</ul>
<h5 data-id="heading-8">后端API设计</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/face"</span>)
public class FaceController {
​
    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/faceRecognition"</span>)
    public R&lt;List&lt;FaceRecognitionResDTO&gt;&gt; <span class="hljs-built_in">faceRecognition</span>(
        <span class="hljs-variable">@RequestBody</span> FaceRecognitionReqDTO request) {
        
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">image</span> = <span class="hljs-selector-tag">request</span><span class="hljs-selector-class">.getImage</span>();
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">FaceRecognitionResDTO</span>&gt; <span class="hljs-selector-tag">results</span> = <span class="hljs-selector-tag">Lists</span><span class="hljs-selector-class">.newLinkedList</span>();
        
        <span class="hljs-selector-tag">try</span> {
            <span class="hljs-comment">// 1. Base64图片解码</span>
            <span class="hljs-selector-tag">byte</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">bytes</span> = <span class="hljs-selector-tag">Base64Util</span><span class="hljs-selector-class">.base64ToBytes</span>(image);
            <span class="hljs-selector-tag">ImageInfo</span> <span class="hljs-selector-tag">rgbData</span> = <span class="hljs-selector-tag">ImageFactory</span><span class="hljs-selector-class">.getRGBData</span>(bytes);
            
            <span class="hljs-comment">// 2. 人脸检测</span>
            <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">FaceInfo</span>&gt; <span class="hljs-selector-tag">faceInfoList</span> = <span class="hljs-selector-tag">faceEngineService</span><span class="hljs-selector-class">.detectFaces</span>(rgbData);
            
            <span class="hljs-selector-tag">if</span> (CollectionUtil.<span class="hljs-built_in">isNotEmpty</span>(faceInfoList)) {
                <span class="hljs-comment">// 3. 获取数据库中的所有特征</span>
                <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Feature</span>&gt; <span class="hljs-selector-tag">dbFeatures</span> = <span class="hljs-selector-tag">featureService</span><span class="hljs-selector-class">.list</span>(
                    new LambdaQueryWrapper&lt;Feature&gt;()
                        .<span class="hljs-built_in">eq</span>(<span class="hljs-attribute">Feature</span>::getStatus, <span class="hljs-string">"1"</span>)
                        .<span class="hljs-built_in">eq</span>(<span class="hljs-attribute">Feature</span>::getValid, <span class="hljs-number">1</span>)
                );
                
                <span class="hljs-comment">// 4. 特征比对识别</span>
                <span class="hljs-selector-tag">for</span> (FaceInfo <span class="hljs-attribute">faceInfo </span>: faceInfoList) {
                    <span class="hljs-selector-tag">byte</span><span class="hljs-selector-attr">[]</span> <span class="hljs-selector-tag">feature</span> = <span class="hljs-selector-tag">faceEngineService</span><span class="hljs-selector-class">.extractFaceFeature</span>(rgbData, faceInfo);
                    <span class="hljs-selector-tag">if</span> (feature != null) {
                        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">UserCompareInfo</span>&gt; <span class="hljs-selector-tag">matches</span> = <span class="hljs-selector-tag">faceEngineService</span>
                            <span class="hljs-selector-class">.faceRecognition</span>(feature, userInfoList, <span class="hljs-number">0.8</span>f);
                        
                        <span class="hljs-comment">// 5. 构建识别结果</span>
                        <span class="hljs-selector-tag">FaceRecognitionResDTO</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">FaceRecognitionResDTO</span>();
                        <span class="hljs-selector-tag">result</span><span class="hljs-selector-class">.setRect</span>(faceInfo.<span class="hljs-built_in">getRect</span>());
                        <span class="hljs-selector-tag">if</span> (CollectionUtil.<span class="hljs-built_in">isNotEmpty</span>(matches)) {
                            <span class="hljs-selector-tag">UserCompareInfo</span> <span class="hljs-selector-tag">bestMatch</span> = <span class="hljs-selector-tag">matches</span><span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>);
                            <span class="hljs-selector-tag">result</span><span class="hljs-selector-class">.setName</span>(bestMatch.<span class="hljs-built_in">getName</span>());
                            <span class="hljs-selector-tag">result</span><span class="hljs-selector-class">.setSimilar</span>(bestMatch.<span class="hljs-built_in">getSimilar</span>());
                            <span class="hljs-selector-tag">result</span><span class="hljs-selector-class">.setFaceId</span>(Long.<span class="hljs-built_in">valueOf</span>(bestMatch.<span class="hljs-built_in">getFaceId</span>()));
                        }
                        <span class="hljs-selector-tag">results</span><span class="hljs-selector-class">.add</span>(result);
                    }
                }
            }
        } <span class="hljs-selector-tag">catch</span> (Exception e) {
            <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"人脸识别处理异常"</span>, e);
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.failed</span>(<span class="hljs-string">"人脸识别处理异常："</span> + e.<span class="hljs-built_in">getMessage</span>());
        }
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.success</span>(results);
    }
}
</code></pre>
<h4 data-id="heading-9">2. 人脸特征注册系统</h4>
<h5 data-id="heading-10">智能注册流程</h5>
<p>当系统检测到未识别的人脸时，会自动提示用户进行注册：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 前端注册逻辑</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRegister</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!detectedFeature.<span class="hljs-property">value</span>) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请先上传人脸图像并完成检测'</span>)
    <span class="hljs-keyword">return</span>
  }
  
  <span class="hljs-comment">// 显示注册表单弹窗</span>
  showRegisterDialog.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}
​
<span class="hljs-comment">// 提交注册表单</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleRegisterSubmit</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> registerFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>()
    
    registerLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    
    <span class="hljs-comment">// 调用后端保存接口</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ArcFaceAPI</span>.<span class="hljs-title function_">saveFeature</span>({
      <span class="hljs-attr">name</span>: registerForm.<span class="hljs-property">value</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">trim</span>(),
      <span class="hljs-attr">featureCode</span>: registerForm.<span class="hljs-property">value</span>.<span class="hljs-property">featureCode</span>.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">toUpperCase</span>(),
      <span class="hljs-attr">image</span>: <span class="hljs-string">`data:image/jpeg;base64,<span class="hljs-subst">${detectedFeature.value}</span>`</span>
    })
    
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">success</span>) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'人脸注册成功'</span>)
      <span class="hljs-comment">// 更新识别结果显示</span>
      recognitionResult.<span class="hljs-property">value</span> = {
        <span class="hljs-attr">name</span>: registerForm.<span class="hljs-property">value</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">featureCode</span>: registerForm.<span class="hljs-property">value</span>.<span class="hljs-property">featureCode</span>.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">toUpperCase</span>(),
        <span class="hljs-attr">score</span>: <span class="hljs-number">1.0</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'1'</span>
      }
      showRegisterDialog.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
      <span class="hljs-title function_">emits</span>(<span class="hljs-string">'register'</span>, detectedFeature.<span class="hljs-property">value</span>)
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'人脸注册失败：'</span> + error)
  } <span class="hljs-keyword">finally</span> {
    registerLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  }
}
</code></pre>
<h5 data-id="heading-11">后端特征保存服务</h5>
<pre><code class="hljs language-ini" lang="ini">@Service
@Transactional(<span class="hljs-attr">rollbackFor</span> = Exception.class)
public class FeatureServiceImpl implements FeatureService {
​
    @Override
    public boolean saveFeature(String name, String featureCode, String image) {
        log.info("开始保存人脸特征，姓名: {}, 特征码: {}", name, featureCode)<span class="hljs-comment">;</span>
        
        try {
            // 1. 参数验证
            if (StrUtil.isBlank(name) || StrUtil.isBlank(featureCode) || StrUtil.isBlank(image)) {
                log.error("参数不能为空")<span class="hljs-comment">;</span>
                return false<span class="hljs-comment">;</span>
            }
            
            // 2. 解码Base64图片数据
            byte<span class="hljs-section">[]</span> <span class="hljs-attr">imageBytes</span> = decodeBase64Image(image)<span class="hljs-comment">;</span>
            
            // 3. 保存图片到本地
            String <span class="hljs-attr">fileName</span> = name + <span class="hljs-string">"_"</span> + featureCode.toUpperCase() + <span class="hljs-string">".png"</span><span class="hljs-comment">;</span>
            String <span class="hljs-attr">savedFilePath</span> = fileUtils.saveFeatureImage(imageBytes, fileName)<span class="hljs-comment">;</span>
            
            // 4. 人脸检测和特征提取
            byte<span class="hljs-section">[]</span> <span class="hljs-attr">faceFeatureData</span> = extractFaceFeatureFromImage(imageBytes)<span class="hljs-comment">;</span>
            if (<span class="hljs-attr">faceFeatureData</span> == null) {
                log.error("人脸特征提取失败")<span class="hljs-comment">;</span>
                return false<span class="hljs-comment">;</span>
            }
            
            // 5. 保存到数据库
            Feature <span class="hljs-attr">feature</span> = new Feature()<span class="hljs-comment">;</span>
            feature.setName(name)<span class="hljs-comment">;</span>
            feature.setFeatureCode(featureCode.toUpperCase())<span class="hljs-comment">;</span>
            feature.setFeature(savedFilePath)<span class="hljs-comment">;</span>
            feature.setFeatureData(faceFeatureData)<span class="hljs-comment">;</span>
            feature.setFeatureVersion("1.0")<span class="hljs-comment">;</span>
            feature.setStatus(StatusEnums.ENABLE.getKey())<span class="hljs-comment">;</span>
            
            boolean <span class="hljs-attr">saveResult</span> = this.save(feature)<span class="hljs-comment">;</span>
            
            // 6. 更新Redis缓存
            if (saveResult) {
                UserRamCache.UserInfo <span class="hljs-attr">userInfo</span> = new UserRamCache.UserInfo()<span class="hljs-comment">;</span>
                userInfo.setFaceId(String.valueOf(feature.getId()))<span class="hljs-comment">;</span>
                userInfo.setName(name)<span class="hljs-comment">;</span>
                userInfo.setFaceFeature(faceFeatureData)<span class="hljs-comment">;</span>
                arcFaceRedisService.addUser(userInfo)<span class="hljs-comment">;</span>
            }
            
            return saveResult<span class="hljs-comment">;</span>
        } catch (Exception e) {
            log.error("保存人脸特征失败", e)<span class="hljs-comment">;</span>
            return false<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-12">3. 高性能引擎池管理</h4>
<h5 data-id="heading-13">引擎池架构设计</h5>
<p>为了支持高并发访问，我们设计了双引擎池架构：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArcFaceEngineConfiguration</span> {
​
    <span class="hljs-comment">/**
     * 通用人脸识别引擎池 - VIDEO模式
     * 用于实时视频流检测
     */</span>
    <span class="hljs-meta">@Bean("faceEngineGeneralPool")</span>
    <span class="hljs-keyword">public</span> GenericObjectPool&lt;FaceEngine&gt; <span class="hljs-title function_">faceEngineGeneralPool</span><span class="hljs-params">()</span> {
        GenericObjectPoolConfig&lt;FaceEngine&gt; poolConfig = createPoolConfig(detectPoolSize);
        <span class="hljs-type">EngineConfiguration</span> <span class="hljs-variable">engineConfig</span> <span class="hljs-operator">=</span> createGeneralEngineConfiguration();
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericObjectPool</span>&lt;&gt;(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">FaceEngineFactory</span>(appId, sdkKey, <span class="hljs-literal">null</span>, engineConfig), 
            poolConfig
        );
    }
​
    <span class="hljs-comment">/**
     * 人脸比对引擎池 - IMAGE模式
     * 用于特征提取和比对
     */</span>
    <span class="hljs-meta">@Bean("faceEngineComparePool")</span>
    <span class="hljs-keyword">public</span> GenericObjectPool&lt;FaceEngine&gt; <span class="hljs-title function_">faceEngineComparePool</span><span class="hljs-params">()</span> {
        GenericObjectPoolConfig&lt;FaceEngine&gt; poolConfig = createPoolConfig(comparePoolSize);
        <span class="hljs-type">EngineConfiguration</span> <span class="hljs-variable">engineConfig</span> <span class="hljs-operator">=</span> createCompareEngineConfiguration();
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericObjectPool</span>&lt;&gt;(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">FaceEngineFactory</span>(appId, sdkKey, <span class="hljs-literal">null</span>, engineConfig), 
            poolConfig
        );
    }
}
</code></pre>
<h5 data-id="heading-14">多线程并发处理</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class FaceEngineServiceImpl implements FaceEngineService {
​
    <span class="hljs-keyword">@Override</span>
    public List&lt;UserCompareInfo&gt; faceRecognition(byte[] faceFeature, 
                                                List&lt;UserRamCache.UserInfo&gt; userInfoList, 
                                                float passRate) {
        List&lt;UserCompareInfo&gt; resultList = Lists<span class="hljs-selector-class">.newLinkedList</span>();
        
        <span class="hljs-comment">// 分批处理，每批1000个用户</span>
        List&lt;List&lt;UserRamCache<span class="hljs-selector-class">.UserInfo</span>&gt;&gt; partitions = Lists<span class="hljs-selector-class">.partition</span>(userInfoList, <span class="hljs-number">1000</span>);
        CompletionService&lt;List&lt;UserCompareInfo&gt;&gt; completionService = 
            new ExecutorCompletionService&lt;&gt;(faceCompareExecutorService);
        
        <span class="hljs-comment">// 提交并发任务</span>
        for (List&lt;UserRamCache.UserInfo&gt; part : partitions) {
            completionService<span class="hljs-selector-class">.submit</span>(new CompareFaceTask(part, targetFaceFeature, passRate));
        }
        
        <span class="hljs-comment">// 收集结果</span>
        for (int i = <span class="hljs-number">0</span>; i &lt; partitions.size(); <span class="hljs-selector-tag">i</span>++) {
            try {
                List&lt;UserCompareInfo&gt; partResult = completionService<span class="hljs-selector-class">.take</span>()<span class="hljs-selector-class">.get</span>();
                if (CollectionUtil.isNotEmpty(partResult)) {
                    resultList<span class="hljs-selector-class">.addAll</span>(partResult);
                }
            } catch (Exception e) {
                log<span class="hljs-selector-class">.error</span>("人脸比对任务执行异常", e);
            }
        }
        
        <span class="hljs-comment">// 按相似度排序</span>
        resultList<span class="hljs-selector-class">.sort</span>((h1, h2) -&gt; <span class="hljs-selector-tag">h2</span><span class="hljs-selector-class">.getSimilar</span>()<span class="hljs-selector-class">.compareTo</span>(h1.getSimilar()));
        
        return resultList;
    }
}
</code></pre>
<h4 data-id="heading-15">4. Redis缓存优化</h4>
<h5 data-id="heading-16">缓存架构设计</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArcFaceRedisService</span> {
​
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">FACE_FEATURE_KEY_PREFIX</span> = <span class="hljs-string">"arcface:feature:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">FACE_USER_LIST_KEY</span> = <span class="hljs-string">"arcface:users"</span>;
    
    <span class="hljs-comment">/**
     * 添加用户到缓存
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params">UserRamCache.UserInfo userInfo</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">String</span> key = <span class="hljs-variable constant_">FACE_FEATURE_KEY_PREFIX</span> + userInfo.<span class="hljs-title function_">getFaceId</span>();
            
            <span class="hljs-comment">// 序列化用户信息</span>
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; userMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            userMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"faceId"</span>, userInfo.<span class="hljs-title function_">getFaceId</span>());
            userMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"name"</span>, userInfo.<span class="hljs-title function_">getName</span>());
            userMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"faceFeature"</span>, <span class="hljs-title class_">Base64</span>.<span class="hljs-title function_">encode</span>(userInfo.<span class="hljs-title function_">getFaceFeature</span>()));
            
            <span class="hljs-comment">// 存储到Redis</span>
            redisTemplate.<span class="hljs-title function_">opsForHash</span>().<span class="hljs-title function_">putAll</span>(key, userMap);
            redisTemplate.<span class="hljs-title function_">expire</span>(key, <span class="hljs-title class_">Duration</span>.<span class="hljs-title function_">ofDays</span>(<span class="hljs-number">7</span>));
            
            <span class="hljs-comment">// 添加到用户列表</span>
            redisTemplate.<span class="hljs-title function_">opsForSet</span>().<span class="hljs-title function_">add</span>(<span class="hljs-variable constant_">FACE_USER_LIST_KEY</span>, userInfo.<span class="hljs-title function_">getFaceId</span>());
            
            log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"用户特征已添加到Redis缓存: {}"</span>, userInfo.<span class="hljs-title function_">getFaceId</span>());
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"添加用户到Redis缓存失败"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * 获取所有用户
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">UserRamCache</span>.<span class="hljs-property">UserInfo</span>&gt; <span class="hljs-title function_">getAllUsers</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">String</span>&gt; userIds = redisTemplate.<span class="hljs-title function_">opsForSet</span>().<span class="hljs-title function_">members</span>(<span class="hljs-variable constant_">FACE_USER_LIST_KEY</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-title class_">CollectionUtil</span>.<span class="hljs-title function_">isEmpty</span>(userIds)) {
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Collections</span>.<span class="hljs-title function_">emptyList</span>();
            }
            
            <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">UserRamCache</span>.<span class="hljs-property">UserInfo</span>&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> userId : userIds) {
                <span class="hljs-title class_">String</span> key = <span class="hljs-variable constant_">FACE_FEATURE_KEY_PREFIX</span> + userId;
                <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; userMap = redisTemplate.<span class="hljs-title function_">opsForHash</span>().<span class="hljs-title function_">entries</span>(key);
                
                <span class="hljs-keyword">if</span> (!userMap.<span class="hljs-title function_">isEmpty</span>()) {
                    <span class="hljs-title class_">UserRamCache</span>.<span class="hljs-property">UserInfo</span> userInfo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRamCache</span>.<span class="hljs-title class_">UserInfo</span>();
                    userInfo.<span class="hljs-title function_">setFaceId</span>((<span class="hljs-title class_">String</span>) userMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">"faceId"</span>));
                    userInfo.<span class="hljs-title function_">setName</span>((<span class="hljs-title class_">String</span>) userMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">"name"</span>));
                    userInfo.<span class="hljs-title function_">setFaceFeature</span>(<span class="hljs-title class_">Base64</span>.<span class="hljs-title function_">decode</span>((<span class="hljs-title class_">String</span>) userMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">"faceFeature"</span>)));
                    users.<span class="hljs-title function_">add</span>(userInfo);
                }
            }
            
            <span class="hljs-keyword">return</span> users;
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"从Redis获取所有用户失败"</span>, e);
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Collections</span>.<span class="hljs-title function_">emptyList</span>();
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22a1f1843a8f458fb6874c7c03977a86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112011&amp;x-signature=3QQlgrbiIlmjpZsLut1rCV5oOYk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">性能优化策略</h3>
<h4 data-id="heading-18">1. 算法优化</h4>
<p><strong>检测模式优化：</strong></p>
<ul>
<li>VIDEO模式：用于实时视频流，检测速度快</li>
<li>IMAGE模式：用于静态图片，检测精度高</li>
</ul>
<p><strong>比对模型选择：</strong></p>
<pre><code class="hljs language-ini" lang="ini">// 使用LIFE_PHOTO模型进行生活照比对，推荐阈值0.80
int <span class="hljs-attr">errorCode</span> = faceEngine.compareFaceFeature(
    faceFeature1, 
    faceFeature2, 
    CompareModel.LIFE_PHOTO, 
    faceSimilar
)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-19">2. 并发优化</h4>
<p><strong>引擎池配置：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">arcface:</span>
  <span class="hljs-attr">detect-pool-size:</span> <span class="hljs-number">5</span>      <span class="hljs-comment"># 检测引擎池大小</span>
  <span class="hljs-attr">compare-pool-size:</span> <span class="hljs-number">10</span>    <span class="hljs-comment"># 比对引擎池大小</span>
  <span class="hljs-attr">face-compare-threshold:</span> <span class="hljs-number">0.8</span>  <span class="hljs-comment"># 识别阈值</span>
  <span class="hljs-attr">pool:</span>
    <span class="hljs-attr">lifo:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">block-when-exhausted:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">max-wait-millis:</span> <span class="hljs-number">5000</span>
    <span class="hljs-attr">test-on-borrow:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">test-on-return:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">jmx-enabled:</span> <span class="hljs-literal">false</span>     <span class="hljs-comment"># 禁用JMX避免冲突</span>
</code></pre>
<p><strong>分批并发处理：</strong></p>
<ul>
<li>将大量用户分批处理，每批1000个</li>
<li>使用CompletionService管理并发任务</li>
<li>合理设置线程池大小</li>
</ul>
<h4 data-id="heading-20">3. 缓存优化</h4>
<p><strong>多级缓存策略：</strong></p>
<ol>
<li><strong>内存缓存</strong>：JVM堆内存，访问最快</li>
<li><strong>Redis缓存</strong>：分布式缓存，支持集群</li>
<li><strong>数据库</strong>：持久化存储，最终数据源</li>
</ol>
<p><strong>缓存更新策略：</strong></p>
<ul>
<li>新增用户：同时更新内存和Redis</li>
<li>删除用户：从所有缓存中移除</li>
<li>定期同步：防止缓存不一致</li>
</ul>
<h3 data-id="heading-21">系统监控与运维</h3>
<h4 data-id="heading-22">1. 性能监控</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FaceEngineServiceImpl</span> {
    
    <span class="hljs-comment">// 监控指标</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">totalFaceDetect</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">totalFaceRecognize</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">successFaceRecognize</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">/**
     * 获取监控指标
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMetrics</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> String.format(
            <span class="hljs-string">"人脸引擎监控指标 - 总检测次数: %d, 总识别次数: %d, 成功识别次数: %d"</span>,
            totalFaceDetect.get(),
            totalFaceRecognize.get(),
            successFaceRecognize.get()
        );
    }
}
</code></pre>
<h4 data-id="heading-23">2. 资源管理</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@PreDestroy</span>
public void destroy() {
    log<span class="hljs-selector-class">.info</span>("开始销毁人脸引擎资源");
    
    <span class="hljs-comment">// 关闭比对线程池</span>
    if (faceCompareExecutorService != null) {
        faceCompareExecutorService<span class="hljs-selector-class">.shutdown</span>();
        try {
            if (!faceCompareExecutorService.awaitTermination(<span class="hljs-number">5</span>, TimeUnit.SECONDS)) {
                faceCompareExecutorService<span class="hljs-selector-class">.shutdownNow</span>();
            }
        } catch (InterruptedException e) {
            faceCompareExecutorService<span class="hljs-selector-class">.shutdownNow</span>();
            Thread<span class="hljs-selector-class">.currentThread</span>()<span class="hljs-selector-class">.interrupt</span>();
        }
    }
    
    <span class="hljs-comment">// 关闭引擎池</span>
    if (faceEngineGeneralPool != null) {
        faceEngineGeneralPool<span class="hljs-selector-class">.close</span>();
    }
    if (faceEngineComparePool != null) {
        faceEngineComparePool<span class="hljs-selector-class">.close</span>();
    }
    
    log<span class="hljs-selector-class">.info</span>("人脸引擎资源销毁完成");
}
</code></pre>
<h3 data-id="heading-24">安全与隐私保护</h3>
<h4 data-id="heading-25">1. 数据安全</h4>
<p><strong>图片存储安全：</strong></p>
<ul>
<li>本地文件系统存储</li>
<li>文件名加密处理</li>
<li>访问权限控制</li>
</ul>
<p><strong>特征数据保护：</strong></p>
<ul>
<li>数据库字段加密</li>
<li>Redis传输加密</li>
<li>内存数据及时清理</li>
</ul>
<h4 data-id="heading-26">2. 接口安全</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/face"</span>)
public class FaceController {
    
    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/saveFeature"</span>)
    <span class="hljs-variable">@PreAuthorize</span>(<span class="hljs-string">"hasAuthority('face:register')"</span>)  <span class="hljs-comment">// 权限控制</span>
    public R&lt;SaveFeatureResDTO&gt; <span class="hljs-built_in">saveFeature</span>(<span class="hljs-variable">@RequestBody</span> SaveFeatureReqDTO request) {
        <span class="hljs-comment">// 参数校验</span>
        <span class="hljs-selector-tag">if</span> (!<span class="hljs-built_in">validateRequest</span>(request)) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.failed</span>(<span class="hljs-string">"请求参数不合法"</span>);
        }
        
        <span class="hljs-comment">// 限流控制</span>
        <span class="hljs-selector-tag">if</span> (!rateLimiter.<span class="hljs-built_in">tryAcquire</span>()) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">R</span><span class="hljs-selector-class">.failed</span>(<span class="hljs-string">"请求过于频繁，请稍后重试"</span>);
        }
        
        <span class="hljs-comment">// 业务处理</span>
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">processRequest</span>(request);
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ad6378dadc9457bb1d3fa4064e5a59f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112011&amp;x-signature=k9kSPPuwYUDQuMnBC9RVS27y5N0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a89b7a77f86f4102bdd89fb2b669e7be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFycnnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112011&amp;x-signature=IBcSL0zdTpXlA5qhBC7Q94j1Chc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-27">总结与展望</h3>
<p>本文详细介绍了企业级人脸识别系统的完整实现方案，涵盖了从前端交互到后端算法的各个层面。系统具有以下特点：</p>
<p><strong>技术优势：</strong></p>
<ol>
<li><strong>高性能</strong>：引擎池 + 多线程并发处理</li>
<li><strong>高可用</strong>：多级缓存 + 集群部署</li>
<li><strong>易扩展</strong>：微服务架构 + 容器化部署</li>
<li><strong>用户友好</strong>：现代化前端界面 + 智能交互</li>
</ol>
<p><strong>应用场景：</strong></p>
<ul>
<li>智能门禁系统</li>
<li>考勤管理系统</li>
<li>安防监控系统</li>
<li>智能零售系统</li>
</ul>
<p><strong>未来发展方向：</strong></p>
<ol>
<li><strong>算法升级</strong>：集成更先进的深度学习模型</li>
<li><strong>边缘计算</strong>：支持边缘设备部署</li>
<li><strong>多模态识别</strong>：结合声纹、虹膜等生物特征</li>
<li><strong>隐私计算</strong>：联邦学习、同态加密等技术</li>
</ol>
<p>希望本文能为大家在人脸识别系统开发中提供有价值的参考。如果你有任何问题或建议，欢迎在评论区交流讨论！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[再见，人类程序员！OpenAI 自曝：一行代码都不写了，100% 用 Codex]]></title>    <link>https://juejin.cn/post/7599847938538766345</link>    <guid>https://juejin.cn/post/7599847938538766345</guid>    <pubDate>2026-01-27T09:48:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599847938538766345" data-draft-id="7599798118461407241" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="再见，人类程序员！OpenAI 自曝：一行代码都不写了，100% 用 Codex"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-27T09:48:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            再见，人类程序员！OpenAI 自曝：一行代码都不写了，100% 用 Codex
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T09:48:55.000Z" title="Tue Jan 27 2026 09:48:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c943d436f7e433c92e970b07b560668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=8Tr4hxip8vgM8mH%2BBWRjGRmqeSI%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-1"><strong>「【新智元导读】100% 是用 Codex 写的。还有内部爆料说，Codex 让他们仅用三天时间就搭出了服务器，三周就发布了 APP。人类程序员，真的要退出历史舞台了？」</strong></h5>
<p>硅谷的空气里再次充满了躁动，而这一次的震源中心，回到了 OpenAI。</p>
<p>OpenAI 的奇点时刻，也要来了？</p>
<p>就在刚刚，X 被一条爆料彻底刷屏——</p>
<p>Codex，已经正式接管了 OpenAI 研究员「Roon」100% 的代码编写工作！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8f7bf83caa54dddbeb58105fb024706~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=vDExh1XrOZd874id1rJVzcrKOio%3D" alt="" loading="lazy"/></p>
<p>Roon 发出了感慨万千的宣告：</p>
<p>编程一直很痛苦，然而却是必经之路。我很高兴，它终于结束了。</p>
<p>我惊讶于自己竟然这么快就摆脱了编程的阴影，而且一点都不怀念它。甚至我有点遗憾，从前的电脑为什么不是这样的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3c52e1aea8a4a60bb5561055567571b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=V%2FIFfZiRn0EaA34icvSrVBbV9so%3D" alt="" loading="lazy"/></p>
<p>早在去年 12 月，Claude Code 之父 Boris Cherny 就曾投下一枚震撼弹——</p>
<p>自己对 Claude Code 的贡献 100% 都是由 Claude Code 完成的。</p>
<p>这一「套娃式」的自我进化，直接引爆了硅谷的自动编码狂潮。</p>
<p>面对如此巨大的蛋糕，OpenAI 显然不会拱手相让。</p>
<p>如今，反击已经开始。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3MTA0MTk1MA%3D%3D%26mid%3D2652667431%26idx%3D1%26sn%3D3108d75bce9201ea57eb0a0cb9e2bb86%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3MTA0MTk1MA==&amp;mid=2652667431&amp;idx=1&amp;sn=3108d75bce9201ea57eb0a0cb9e2bb86&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">在刚刚过去的周末，Sam Altman 已经公开预告：接下来一个月会发布一堆关于 Codex 编码模型的新产品。</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b943eca24efb43718bea605ebc0661d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=OCScSKNd5YmV2LzURR2Di4S5NGA%3D" alt="" loading="lazy"/></p>
<p>社区的风向也开始发生微妙的转变。</p>
<p>一些资深开发者评论道：在 90% 的情况下，GPT-5.2-Codex 都能一次性完成我提出的请求。</p>
<p>Claude 虽然不错，但它偶尔会偷偷插入「坏代码」；相比之下，OpenAI 的新方案更像苹果——主打一个开箱即用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/545b6399370e410ea4bbab5fb812dc61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=oLfPiTxoVsi9P5gJRc%2F4F7UTvUQ%3D" alt="" loading="lazy"/></p>
<p>看来，Codex 和 Claude Code 的大战，已经一触即发！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cb11b540957424e9908dd84e2f9cf99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=JQ4utrziAP%2BFM8WR9U4Lssc1sUU%3D" alt="" loading="lazy"/></p>
<p><strong>「人类写代码的时代，彻底结束？」</strong></p>
<p>OpenAI 研究员 Roon 的这个爆料，也让网友们直言：AI 终于到达了这个奇点！</p>
<p>看来，人类直接手写代码的时代，真的结束了。</p>
<p>经过多年的模型迭代与数据积累，我们似乎真的站在了一个临界点上：</p>
<p>人类直接手写代码，正在变得不再有任何意义，甚至是一种效率的浪费。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1072a10b0d12426e86e570eee4d12262~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=Uqz%2Fuvv0xrDnlsU0Or7vmxaveeI%3D" alt="" loading="lazy"/></p>
<p>在 Roon 的评论区，人们开始集体对编程时代说再见。</p>
<p>是的，我热爱电脑，热爱软件开发，对我而言，编程只是实现目标的手段，仅此而已。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf813437a09b4cfc8760ac1c6f73ae19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=eVrYEVtdqtkat9ClmsiPMzqdJmQ%3D" alt="" loading="lazy"/></p>
<p>复杂的语法只是是我们为了让逻辑得以执行而必须付出的昂贵代价。</p>
<p>如今，这些中间商终于可以退场了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76f0ffd57a604fb486ebae037d380aa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=9I1IuezE5XKQWFVzHCFqij9olJw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3e5c688c2e34c1ab6f3802b6ee2efad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=PFg%2BRvtIVv8ZAp%2Bs9ngZAqZp040%3D" alt="" loading="lazy"/></p>
<p>激进的观点开始涌现。</p>
<p>甚至有人建议，既然不需要人类阅读代码了，我们就该让模型跳过人类可读的汇编语言，直接使用机器代码。</p>
<p>今天的编程就像曾经的打孔卡一样，应该永远消失了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8926da0055e649459bb67dc1a87c74c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=8bSJdWdk5%2BZkNS0Y9j4bKDCmccU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be4eea7d373d42678b3e46863ff05f27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=9m0Ra%2FdPrhKlmpBcB4GZTt%2Fa3eo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18a06333f0e74dd28e307c201fa6ac45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=ZPTihVz9NDsoplIvfxGqa4qvbqU%3D" alt="" loading="lazy"/></p>
<p>与此同时，另一个炸裂的消息从 OpenAI 内部流出——</p>
<p>一位研究员爆料，在 Codex 的辅助下，他们仅用了**「三天时间」**，就从零搭建了 OpenAI 的 MCP 服务器，并完成了规模验证。</p>
<p>不仅如此，他们还在 3 周内推出了 Sora 的安卓应用；此外，还有一大波由 Codex 构建、甚至由 Codex 自我审核的内部工具正在排队上线。</p>
<p>如果没有 Codex 的话，很难想象 OpenAI 能以如此惊人的速度发布产品。</p>
<p>有趣的是，这位大佬似乎还玩起了 Claude Code 之父的梗：</p>
<p>过去 30 天，我花了大量时间审核 Plan 和 PR，几乎没写一行代码！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8871ddb41d64294a62feceb905df845~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=TgWjVjnpkgXFt0RiQeDubVJx2uI%3D" alt="" loading="lazy"/></p>
<p>有人评价，这正是「起飞」第一阶段的样子。</p>
<p>而下一步，或许就是真正的端到端 AI 自主研究。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d4a7818766441af88db6dccc56d3cfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=r%2F0xsPXKZuYqL6RE2wPKeRgyjMU%3D" alt="" loading="lazy"/></p>
<p>还有人问，确定你们这不是营销？</p>
<p>这位研究者详细解释说，绝对不是。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f83ee5b6b81a43e9b1c4119e9f9b223c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=VqM7s%2B1%2FTT1jNjraXBwtK1TULo8%3D" alt="" loading="lazy"/></p>
<p>具体的使用过程是这样的：</p>
<p>首先，他会花很多时间来撰写规格说明，并在脑海中构想输出应该是什么样子。</p>
<p>然后，会启动一个「4×Codex」的云端并发任务。这样不仅可以一次性看到多种不同的变体，也能补上自己一开始遗漏的细节。</p>
<p>接下来，就是让 Codex 自己发挥。等它跑完，人类再介入进行测试和验证。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a46595b5b37540dd9679030398e3f48c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=%2FeXVMRpQCDXAb7v2sLQGxTxxhXE%3D" alt="" loading="lazy"/></p>
<p><strong>「Codex CLI 0.9 + 来了！」</strong></p>
<p>既然「人机协作」的范式已经改变，那么承载这种范式的工具自然也要升级。</p>
<p>面对 Anthropic 在的步步紧逼，OpenAI 显然有备而来。</p>
<p>就在今天，Codex CLI 连续推送了两次更新，版本号直接来到了 0.91.0。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0f74cc0b604ea1b2c8d2c2dc0cf5a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=rva6IQ0xrOu0Z2wZFodavU2iU4k%3D" alt="" loading="lazy"/></p>
<p>其中，Codex 0.9.0 带来了最受大家期待的功能——Plan Mode（计划模式）！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/811c3503e6c443efa3fae90058693e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=zJnnEBYOP5cQjDOejfw%2FSwqjQHY%3D" alt="" loading="lazy"/></p>
<p>Code 模式是 Codex 的默认体验，它的工作方式和其他 AI 智能体一样。</p>
<p>这点咱们就不多费口舌了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57a96d5c86e140c8a1168dca23656936~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=ZBH1G2ZCTx3UOgQrDeWy20rUoGw%3D" alt="" loading="lazy"/></p>
<p>但 Plan 模式则完全不同，它将编程任务拆解为两个截然不同的阶段：</p>
<p>第一阶段：理解意图（明确目标、划定范围、识别约束条件、制定验收标准）</p>
<p>第二阶段：技术规格（生成决策完备的实施方案）</p>
<p>在这种模式下，输出的内容非常详尽，无需任何后续追问即可直接执行。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0e9d28f1484762be7524d52036b61c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=3CXFEpq5pswl%2FPEM%2FbsAAIw5U%2Fc%3D" alt="" loading="lazy"/></p>
<p>Plan 模式最聪明的地方在于：它坚持「证据优先探索」。</p>
<p>在开口问问题之前，Codex 会先在你的代码库中进行 2 次以上的针对性搜索，检查配置、Schema 结构、程序入口等。</p>
<p>此外，Plan 模式还可以调用全套工具：</p>
<p>它可以（并且将会）调用各种技能、子智能体和后台终端，从而构建高层级的实施计划。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/230a6206d4ce401490cd83455f835d2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=TecgCwgFLVCbW2t%2BcTRREo7bmjw%3D" alt="" loading="lazy"/></p>
<p>当 Codex 确实需要你输入时，它是结构化的，而且只有关键且聚焦的问题：</p>
<p>· 尽可能提供选项</p>
<p>· 总是包含一个推荐选项（对新手极其友好）</p>
<p>· 只问那些会实质性改变计划的问题</p>
<p>为了实现这一交互，它利用了新的 request_user_input 工具。</p>
<p>这个工具会暂停执行流程，抛出一道有针对性的多项选择题，并支持你在选择时补充反馈或上下文。</p>
<p>更贴心的是，一旦它在任何时候检测到歧义，尤其是当你在引导它时指令模糊，它会立即停下来确认，而不是盲目执行。</p>
<p>现在，开发流程变成了这样：</p>
<p>用户请求一个计划 -&gt; AI 研究代码库与规划 -&gt; 针对性询问用户 -&gt; AI 完善并完成计划 -&gt; 提示是否执行？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6f74146aff146cc8af2b0a0a741f6a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=K2wCBsiYVbMJqF2s9HtOG4tsxjI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96ec21f46ab24dc4a7bb0ad44d905c84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=vsoqVN17zhx2JNFqNTUL%2BtuFH%2FU%3D" alt="" loading="lazy"/></p>
<p><strong>「但是，代码谁来审？」</strong></p>
<p>看起来完美无缺，对吧？Codex 负责思考，Codex 负责执行，Codex 负责填满你的 GitHub。</p>
<p>但就在我们为这种极致的效率欢呼时，一个被忽视的深渊正在脚下裂开——</p>
<p>在这个新时代，最大的悬念不再是谁在写代码，而是谁来审核代码。</p>
<p>当 AI 火力全开，每天向仓库甩出 10 + 个 PR 时，人类开发者面临的实际上是一场针对注意力的 DDoS 攻击。</p>
<p>AI 生成代码是毫秒级的，而人类理解代码上下文是分钟级甚至小时级的。</p>
<p>这种「生产与审查的极度不对称」带来了两个可怕的后果：</p>
<ul>
<li>审查者被淹没，开始习惯性点「Approve」，Code Review 沦为形式。</li>
<li>那些看起来能跑、但缺乏系统性思考的代码块，正在像癌细胞一样在代码库中扩散。</li>
</ul>
<p><strong>「利益冲突显而易见，但我们需要看透这一层。」</strong></p>
<p>Claude Code 的创造者吹捧自己的工具天经地义——这是商业的本能。</p>
<p>但作为受众，我们不能把「Demo 里的完美世界」当成日常。</p>
<p>毕竟，Demo 不会展示调试三小时都找不到的竞态条件，也不会展示由于上下文丢失导致的逻辑断层。</p>
<p><strong>「除此之外，数据里还藏着一个迷人的悖论。」</strong></p>
<p>Ars Technica 曾报道称，开发者对 AI 工具的使用量在涨，信任度却在跌。</p>
<p>为什么？因为 <strong>「AI」</strong> <strong>「正在跨越「恐怖谷」」</strong>。</p>
<p>以前的 AI 代码烂得很明显，现在的 AI 代码烂得很隐蔽——它引用了不存在的库，或者在一个极其边缘的 Case 上埋了雷。</p>
<p>人们用得越多，踩的坑越多，信得自然越少。</p>
<p>正如 Jaana Dogan 所警示的，我们正在面临软件工程「琐碎化」的风险。</p>
<ul>
<li><strong>「100 个提交」</strong>，可能让 GitHub 的绿格子很好看。</li>
<li><strong>「1 个架构变更」</strong>，可能需要三天思考，零行代码产出。</li>
</ul>
<p>前者廉价如尘土，后者珍贵如黄金。</p>
<p>问题从来不是 AI 能不能写代码，而是它写的代码，<strong>「是不是我们系统真正需要的」</strong>，以及**「我们是否有能力维护它」**。</p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27ad796b6124539b27ed9a52ecce655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=XPfPq3vxqDX0s3iDQds7jcupQ7k%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「这对我们意味着什么？」</strong></p>
<p>无论我们是否准备好，这个时代已经来了。对于不同的人群，这意味着完全不同的生存法则。</p>
<ul>
<li><strong>「致开发者」</strong></li>
</ul>
<p>AI 编码工具不是「即将来临」，它们已经破门而入。</p>
<p>问题在于，如何在不丢失自身核心价值的前提下整合它们。</p>
<p>技术大牛们依然在做那些艰难的思考工作，AI 只是接过了「打字员」的工作。</p>
<p>如果你只会「搬运代码」，那你确实该慌了。</p>
<ul>
<li><strong>「致非开发者」</strong></li>
</ul>
<p>「技术工作」与「非技术工作」的边界正在消融。</p>
<p>Claude Cowork 这类工具创造了新物种。曾经需要开发者才能搞定的任务，可能很快只需要你能清晰描述出你想要什么。</p>
<p>清晰描述需求的能力，将成为新的编程语言。</p>
<p><strong>「<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2548330257ec4098930d83adcc10305c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770112134&amp;x-signature=WzZjZsaNMSbSblibjFEJl8fBiOg%3D" alt="" loading="lazy"/>」</strong></p>
<p><strong>「最后的话」</strong></p>
<p>虽然 OpenAI 的研究员和 Claude Code 的创造者都在宣称 AI 包办了 100% 的代码，但请记住——</p>
<p>那是他们的实验室环境，不是你的生产环境。</p>
<p>唯一可以确定的是，我们正在经历从「写代码」到「指挥写代码」的不可逆的转变。</p>
<p>而且，正在加速。</p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Ftszzl%2Fstatus%2F2015253546372153347" target="_blank" title="https://x.com/tszzl/status/2015253546372153347" ref="nofollow noopener noreferrer">x.com/tszzl/statu…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjpcaparas.medium.com%2Fthe-claude-code-creator-says-ai-writes-100-of-his-code-now-956b2a5905ba%3Fsk%3D4c840f27eb03694c8210086834a41691" target="_blank" title="https://jpcaparas.medium.com/the-claude-code-creator-says-ai-writes-100-of-his-code-now-956b2a5905ba?sk=4c840f27eb03694c8210086834a41691" ref="nofollow noopener noreferrer">jpcaparas.medium.com/the-claude-…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FLLMJunky%2Fstatus%2F2015487691891024052" target="_blank" title="https://x.com/LLMJunky/status/2015487691891024052" ref="nofollow noopener noreferrer">x.com/LLMJunky/st…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 0 到 1：前端 CI/CD 实战（第四篇：Nginx + GitLab CI 实现前端自动发布上线）]]></title>    <link>https://juejin.cn/post/7599630795805524014</link>    <guid>https://juejin.cn/post/7599630795805524014</guid>    <pubDate>2026-01-27T10:01:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795805524014" data-draft-id="7599581204860354586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 0 到 1：前端 CI/CD 实战（第四篇：Nginx + GitLab CI 实现前端自动发布上线）"/> <meta itemprop="keywords" content="自动化运维,前端,CI/CD"/> <meta itemprop="datePublished" content="2026-01-27T10:01:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="饼饼饼"/> <meta itemprop="url" content="https://juejin.cn/user/8451822992855"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 0 到 1：前端 CI/CD 实战（第四篇：Nginx + GitLab CI 实现前端自动发布上线）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/8451822992855/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    饼饼饼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T10:01:59.000Z" title="Tue Jan 27 2026 10:01:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0"><strong>前言</strong></h2>
<p>在前几篇中，我们已经完成了 GitLab、GitLab Runner 以及前端项目的自动构建流程。但在真实项目中，CI/CD 往往不仅仅是“跑通一次构建”这么简单，而是需要支持多环境、多项目、多分支部署。</p>
<p>本篇将结合我的真实项目结构，介绍如何通过 Nginx + GitLab CI，将前端项目分别部署到 dev、test、uat、prod 等环境中，实现一套可长期维护的自动发布方案。</p>
<h2 data-id="heading-1">目录规划</h2>
<p>以 dev 环境为例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /apps/deploy/dev

<span class="hljs-built_in">mkdir</span> -p frontend/project-1
<span class="hljs-built_in">mkdir</span> -p backend
</code></pre>
<p>结构如下：</p>
<pre><code class="hljs language-bash" lang="bash">/apps/deploy/dev
├── frontend
│   └── project-1
└── backend
</code></pre>
<h2 data-id="heading-2"><strong>配置 Nginx 配置文件</strong></h2>
<p>所有环境的 Nginx 配置统一放在：</p>
<pre><code class="hljs language-bash" lang="bash">/apps/nginx-conf
</code></pre>
<h3 data-id="heading-3"><strong>1. 创建 dev 配置文件</strong></h3>
<p>进入目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /apps/nginx-conf
</code></pre>
<p>新建文件：</p>
<pre><code class="hljs language-bash" lang="bash">vim front-dev.conf
</code></pre>
<p>写入内容：</p>
<pre><code class="hljs language-bash" lang="bash">server {
    listen 80;
    server_name _;

    location = /project-1 {
        <span class="hljs-built_in">return</span> 301 /project-1/;
    }

    location /project-1 {
        <span class="hljs-built_in">alias</span> /usr/share/nginx/html/project-1/;
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /project-1/index.html;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico)$ {
        root /usr/share/nginx/html/project-1;
        expires max;
        log_not_found off;
    }
}

</code></pre>
<p>保存退出：</p>
<pre><code class="hljs language-bash" lang="bash">:wq
</code></pre>
<h3 data-id="heading-4"><strong>2. 创建 test 配置（同理）</strong></h3>
<pre><code class="hljs language-bash" lang="bash">vim front-test.conf
</code></pre>
<p>内容与 dev 基本一致,生产环境同理。</p>
<h2 data-id="heading-5"><strong>创建多环境 Nginx 容器</strong></h2>
<h3 data-id="heading-6">创建 dev 环境的 Nginx 服务。</h3>
<p>进入项目目录</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /apps/deploy/dev/frontend/project-1
</code></pre>
<p>创建 compose 文件：</p>
<pre><code class="hljs language-bash" lang="bash">vim docker-compose.yml
</code></pre>
<p>编写 docker-compose.yml</p>
<pre><code class="hljs language-bash" lang="bash">version: <span class="hljs-string">"3.9"</span>

services:
  front-dev-nginx:
    image: nginx:alpine
    container_name: front-dev-nginx
    ports:
      - <span class="hljs-string">"8000:80"</span>
    volumes:
      - /apps/deploy/dev/frontend:/usr/share/nginx/html:ro
      - /apps/nginx-conf/front-dev.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
</code></pre>
<h3 data-id="heading-7">创建 test 环境的 Nginx 服务。</h3>
<p>进入项目目录</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /apps/deploy/test/frontend/project-1
</code></pre>
<p>创建 compose 文件并写入</p>
<pre><code class="hljs language-bash" lang="bash">services:
  front-test-nginx:
    image: nginx:alpine
    container_name: front-test-nginx
    ports:
      - <span class="hljs-string">"8001:80"</span>
    volumes:
      - /apps/deploy/test/frontend:/usr/share/nginx/html:ro
      - /apps/nginx-conf/front-test.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
</code></pre>
<h3 data-id="heading-8">创建 prod 环境的 Nginx 服务。</h3>
<p>进入项目目录</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /apps/deploy/prod/frontend/project-1
</code></pre>
<p>创建 compose 文件并写入</p>
<pre><code class="hljs language-bash" lang="bash">services:
  front-prod-nginx:
    image: nginx:alpine
    container_name: front-prod-nginx
    ports:
      - <span class="hljs-string">"8002:80"</span>
    volumes:
      - /apps/deploy/prod/frontend:/usr/share/nginx/html:ro
      - /apps/nginx-conf/front-prod.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
</code></pre>
<h3 data-id="heading-9"><strong>3. 启动容器</strong></h3>
<p>切换到 dev 文件夹下：</p>
<p>执行：</p>
<pre><code class="hljs language-bash" lang="bash">docker compose up -d
</code></pre>
<p>查看状态：</p>
<pre><code class="hljs language-bash" lang="bash">docker ps
</code></pre>
<p>出现：<code>nginx-dev</code>说明启动成功。</p>
<p>其他环境同理。</p>
<h2 data-id="heading-10"><strong>配置 GitLab CI 自动部署</strong></h2>
<p>前面已经配置好构建流程，下面重点是部署阶段。</p>
<h2 data-id="heading-11">创建多环境主 CI 文件</h2>
<p>在 project-1 项目根目录创建:</p>
<pre><code class="hljs language-bash" lang="bash">vim .gitlab-ci.yml
</code></pre>
<p>写入</p>
<pre><code class="hljs language-ini" lang="ini">include:
  - local: '.gitlab-ci-dev.yml'
    rules:
      - if: '$<span class="hljs-attr">CI_COMMIT_REF_NAME</span> == <span class="hljs-string">"dev"</span><span class="hljs-string">'

  - local: '</span>.gitlab-ci-test.yml<span class="hljs-string">'
    rules:
      - if: '</span><span class="hljs-variable">$CI_COMMIT_REF_NAME</span> == <span class="hljs-string">"test"</span><span class="hljs-string">'

  - local: '</span>.gitlab-ci-main.yml<span class="hljs-string">'
    rules:
      - if: '</span><span class="hljs-variable">$CI_COMMIT_REF_NAME</span> == <span class="hljs-string">"main"</span><span class="hljs-string">'
</span></code></pre>
<h3 data-id="heading-12"><strong>dev 环境 CI 文件</strong></h3>
<p>在 project-1 项目根目录创建：</p>
<pre><code class="hljs language-bash" lang="bash">vim .gitlab-ci-dev.yml
</code></pre>
<p>写入：</p>
<pre><code class="hljs language-bash" lang="bash">stages:
  - build
  - deploy

variables:
  BUILD_DIR: dist
  DEPLOY_DIR: /apps/deploy/dev/frontend/project-1

build_project:
  stage: build
  tags: [<span class="hljs-string">"build"</span>]
  image: node:24-alpine
  
  script:
    - npm install -g pnpm@8.15.3
    - pnpm install
    - npm run build:dev
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour


deploy_project:
  stage: deploy
  tags: [<span class="hljs-string">"build"</span>]
  image: alpine:latest
  script:
    - <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$DEPLOY_DIR</span>
    - <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$DEPLOY_DIR</span>/*
    - <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$CI_PROJECT_DIR</span>/<span class="hljs-variable">$BUILD_DIR</span>/* <span class="hljs-variable">$DEPLOY_DIR</span>/
</code></pre>
<h3 data-id="heading-13"><strong>test 环境 CI 文件</strong></h3>
<p>同理创建：</p>
<pre><code class="hljs language-bash" lang="bash">vim .gitlab-ci-test.yml
</code></pre>
<p>写入:</p>
<pre><code class="hljs language-bash" lang="bash">stages:
  - build
  - deploy

variables:
  BUILD_DIR: dist
  DEPLOY_DIR: /apps/deploy/test/frontend/project-1

build_project:
  stage: build
  tags: [<span class="hljs-string">"build"</span>]
  image: node:24-alpine
  script:
    - npm install -g pnpm@8.15.3
    - pnpm install
    - npm run build:<span class="hljs-built_in">test</span>
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour


deploy_project:
  stage: deploy
  tags: [<span class="hljs-string">"build"</span>]
  image: alpine:latest
  script:
    - <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$DEPLOY_DIR</span>
    - <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$DEPLOY_DIR</span>/*
    - <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$CI_PROJECT_DIR</span>/<span class="hljs-variable">$BUILD_DIR</span>/* <span class="hljs-variable">$DEPLOY_DIR</span>/
</code></pre>
<h3 data-id="heading-14"><strong>prod 环境 CI 文件</strong></h3>
<p>同理创建：</p>
<pre><code class="hljs language-bash" lang="bash">vim .gitlab-ci-main.yml
</code></pre>
<p>写入：</p>
<pre><code class="hljs language-bash" lang="bash">stages:
  - build
  - deploy

variables:
  BUILD_DIR: dist
  DEPLOY_DIR: /apps/deploy/prod/frontend/project-1

build_project:
  stage: build
  tags: [<span class="hljs-string">"build"</span>]
  image: node:24-alpine
  script:
    - npm install -g pnpm@8.15.3
    - pnpm install
    - npm run build:prod
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour


deploy_project:
  stage: deploy
  tags: [<span class="hljs-string">"build"</span>]
  image: alpine:latest
  script:
    - <span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$DEPLOY_DIR</span>
    - <span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$DEPLOY_DIR</span>/*
    - <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$CI_PROJECT_DIR</span>/<span class="hljs-variable">$BUILD_DIR</span>/* <span class="hljs-variable">$DEPLOY_DIR</span>/
</code></pre>
<h2 data-id="heading-15"><strong>测试完整发布流程</strong></h2>
<p>到这里，可以开始验证完整链路。</p>
<h3 data-id="heading-16"><strong>1. 推送代码</strong></h3>
<pre><code class="hljs language-bash" lang="bash">git push origin dev
</code></pre>
<h3 data-id="heading-17"><strong>2. 查看流水线</strong></h3>
<p>进入 GitLab：</p>
<pre><code class="hljs language-bash" lang="bash">CI/CD → Pipelines
</code></pre>
<p>确认：</p>
<ul>
<li>build 成功</li>
<li>deploy 成功</li>
</ul>
<h3 data-id="heading-18"><strong>3. 查看服务器目录</strong></h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> /apps/deploy/dev/frontend/project-1
</code></pre>
<p>应看到：</p>
<pre><code class="hljs language-text" lang="text">index.html
assets
</code></pre>
<h3 data-id="heading-19"><strong>4. 浏览器访问</strong></h3>
<p>打开：</p>
<pre><code class="hljs language-bash" lang="bash">http://服务器IP:8000/project-1/
</code></pre>
<p>页面正常显示即 dev 环境部署成功，其他环境同理。</p>
<h2 data-id="heading-20">本篇小结</h2>
<p>这一路走来，我们不仅跑通了流程，更点亮了一整套实战技能树：从 <strong>搭建云服务</strong> 到 <strong>GitLab</strong> 私有化部署，从 <strong>GitLab CI</strong> 自动化构建到 <strong>Docker + Nginx</strong> 的多环境容器化隔离。</p>
<p>现在，只需一次 <code>git push</code>，代码就能自动流过我们亲手搭建的流水线。这种告别 FTP 搬砖、告别手动改配置的“全链路自动化”，才是前端工程化的核心魅力。至此，发布闭环正式达成——从此发布不求人，环境不抓瞎。</p>
<p>感谢你陪我走完这个系列，希望这套方案能帮你彻底告别手动发布的琐碎，把时间留给更酷的代码，我们下个系列见🎉🎉🎉！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java注解到底存在多久？——源码、字节码与运行时]]></title>    <link>https://juejin.cn/post/7599572091076182058</link>    <guid>https://juejin.cn/post/7599572091076182058</guid>    <pubDate>2026-01-27T07:37:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599572091076182058" data-draft-id="7599591405313966121" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java注解到底存在多久？——源码、字节码与运行时"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:37:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Morpheus0412"/> <meta itemprop="url" content="https://juejin.cn/user/2541726611811454"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java注解到底存在多久？——源码、字节码与运行时
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726611811454/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Morpheus0412
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:37:31.000Z" title="Tue Jan 27 2026 07:37:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">注解（Annotation）本质</h2>
<p>注解就是给代码打的<strong>标签（元数据）</strong>，编译后确实会被打包进 <code>.class</code> 文件，所以它可以被编译器、工具或运行时库读取。</p>
<h2 data-id="heading-1">三类生命周期</h2>
<ol>
<li>
<p><strong>源码级（SOURCE）</strong><br/>
只在写代码时有效，编译完就消失，不会进 class 文件。</p>
<ul>
<li><code>@Override</code>：让编译器帮你检查是否真的覆写了父类方法，拼写错误直接报错。</li>
<li><code>@SuppressWarnings</code>：告诉编译器「我知道这里有警告，闭嘴就好」。</li>
</ul>
</li>
<li>
<p><strong>字节码级（CLASS）</strong><br/>
会写进 class 文件，但 JVM 加载类时会丢弃，适合给静态分析工具（如 ProGuard）看。</p>
</li>
<li>
<p><strong>运行时级（RUNTIME）</strong> ——<strong>最常用</strong><br/>
从类加载到程序结束一直留在 JVM 里，随时可以用反射读取。<br/>
例如 <code>@ResponseBody</code>：当 Spring 检测到方法上有这个注解，就自动把返回值转成 JSON/XML 塞进 HTTP 响应体里，不用你手动写 <code>response.getWriter().write()</code>。</p>
</li>
</ol>
<h2 data-id="heading-2">自定义注解</h2>
<p>用 <code>@interface</code> 关键字定义，本质是特殊的接口：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 只能贴在类、接口、枚举上</span>
<span class="hljs-meta">@Target(ElementType.TYPE)</span>  
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyController {
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// 注解的参数，使用时写成 @MyController("/user")</span>
}

<span class="hljs-comment">// 允许贴在方法或字段上</span>
<span class="hljs-meta">@Target({ElementType.METHOD, ElementType.FIELD})</span>  
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyLog {
    String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"默认日志"</span>;  <span class="hljs-comment">// 可设默认值</span>
}
</code></pre>
<p><strong><code>@Target</code> 的作用</strong>：限制你自定义的注解能贴在哪儿，防止写错位置。如果不写 <code>@Target</code>，默认可以贴任何位置。</p>
<h2 data-id="heading-3">快速记忆</h2>
<ul>
<li>要 <strong>检查代码错误</strong> → <code>@Override</code>（源码级）</li>
<li>要 <strong>框架自动处理</strong>（如序列化、事务、权限）→ 自定义 RUNTIME 注解 + 反射</li>
<li>写注解时 <strong>不知道能贴哪</strong> → 加 <code>@Target</code> 约束一下</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python HTML解析库学习文档]]></title>    <link>https://juejin.cn/post/7599850148055236617</link>    <guid>https://juejin.cn/post/7599850148055236617</guid>    <pubDate>2026-01-27T07:45:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599850148055236617" data-draft-id="7599850148055203849" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python HTML解析库学习文档"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:45:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开飞机的舒克_"/> <meta itemprop="url" content="https://juejin.cn/user/4284144156154958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python HTML解析库学习文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4284144156154958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开飞机的舒克_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:45:00.000Z" title="Tue Jan 27 2026 07:45:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>开飞机的舒克
<a href="https://link.juejin.cn?target=halo.gaodaimou.cn" target="_blank" title="halo.gaodaimou.cn" ref="nofollow noopener noreferrer">halo.gaodaimou.cn</a></p>
</blockquote>
<h2 data-id="heading-0">Python HTML解析库学习文档</h2>
<h3 data-id="heading-1">1. 介绍</h3>
<p>HTML解析是Web开发和数据爬取中的重要技能。Python提供了多种HTML解析库，其中最常用的是<code>lxml</code>和<code>BeautifulSoup</code>。本文档将详细介绍这两个库的使用方法、核心知识点以及它们之间的对比。</p>
<h3 data-id="heading-2">2. lxml库</h3>
<h4 data-id="heading-3">2.1 简介</h4>
<p><code>lxml</code>是一个高性能的HTML和XML解析库，基于C语言开发，提供了Pythonic的API。它支持XPath选择器，解析速度快，是数据爬取和Web开发中的常用工具。</p>
<h4 data-id="heading-4">2.2 安装</h4>
<pre><code class="hljs">pip install lxml
</code></pre>
<h4 data-id="heading-5">2.3 基本使用</h4>
<pre><code class="hljs language-xml" lang="xml">from lxml import etree

# HTML字符串
html = '''
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>这是一个标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h1标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h2标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"这是一个图片"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落111<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落222<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
'''

# 解析HTML字符串，返回Element对象
root = etree.HTML(html)
</code></pre>
<h4 data-id="heading-6">2.4 XPath选择器</h4>
<p>XPath是一种用于在XML和HTML文档中定位元素的语言，<code>lxml</code>库支持完整的XPath语法。</p>
<h5 data-id="heading-7">2.4.1 基本路径表示法</h5>





























<table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td><code>/</code></td><td>从根节点开始查找</td></tr><tr><td><code>//</code></td><td>从当前节点开始查找所有匹配的后代元素</td></tr><tr><td><code>.</code></td><td>当前节点</td></tr><tr><td><code>..</code></td><td>父节点</td></tr><tr><td><code>@</code></td><td>选择属性</td></tr></tbody></table>
<h5 data-id="heading-8">2.4.2 示例</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查找所有p元素</span>
<span class="hljs-attr">ps</span> = root.xpath(<span class="hljs-string">'//p'</span>)
print(ps<span class="hljs-section">[0]</span>.text)  <span class="hljs-comment"># 输出：这是一个段落111</span>
print(ps<span class="hljs-section">[1]</span>.text)  <span class="hljs-comment"># 输出：这是一个段落222</span>

<span class="hljs-comment"># 直接获取文本内容</span>
<span class="hljs-attr">ps_text</span> = root.xpath(<span class="hljs-string">'//p/text()'</span>)
print(ps_text)  <span class="hljs-comment"># 输出：['这是一个段落111', '这是一个段落222']</span>

<span class="hljs-comment"># 查找特定属性的元素</span>
<span class="hljs-attr">img</span> = root.xpath(<span class="hljs-string">'//img'</span>)[<span class="hljs-number">0</span>]
print(img.get('src'))  <span class="hljs-comment"># 输出：https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png</span>

<span class="hljs-comment"># 使用属性值过滤</span>
<span class="hljs-attr">content_div</span> = root.xpath(<span class="hljs-string">'//div[@class="content"]'</span>)[<span class="hljs-number">0</span>]
print(content_div)  <span class="hljs-comment"># 输出：&lt;Element div at 0x...&gt;</span>

<span class="hljs-comment"># 从当前节点开始查找</span>
<span class="hljs-attr">content_ps</span> = content_div.xpath(<span class="hljs-string">'.//p'</span>)
print(len(content_ps))  <span class="hljs-comment"># 输出：2</span>

<span class="hljs-comment"># 查找父节点</span>
<span class="hljs-attr">parent_div</span> = root.xpath(<span class="hljs-string">'//p/../div'</span>)[<span class="hljs-number">0</span>]
print(parent_div.get('class'))  <span class="hljs-comment"># 输出：content</span>
</code></pre>
<h4 data-id="heading-9">2.5 性能建议</h4>
<ul>
<li>当你知道确切结构时，使用绝对路径（更快）：<code>/html/body/div[1]/p[1]</code></li>
<li>当结构不确定时，使用相对路径（更灵活）：<code>//div[@class='content']//p</code></li>
<li>可以混合使用：<code>/html/body//p</code>（从body开始，查找所有后代p）</li>
</ul>
<h4 data-id="heading-10">2.6 Element对象操作</h4>
<p>解析HTML后返回的是Element对象，你可以使用Element对象的方法和属性来操作HTML文档：</p>
<ul>
<li><code>text</code>：获取元素的文本内容</li>
<li><code>get()</code>：获取元素的属性值</li>
<li><code>find()</code>：查找第一个匹配的子元素</li>
<li><code>findall()</code>：查找所有匹配的子元素</li>
</ul>
<h3 data-id="heading-11">3. BeautifulSoup库</h3>
<h4 data-id="heading-12">3.1 简介</h4>
<p><code>BeautifulSoup</code>是一个Python库，用于从HTML和XML文件中提取数据。它提供了简单和Pythonic的方式来遍历、搜索和修改解析树。</p>
<h4 data-id="heading-13">3.2 安装</h4>
<pre><code class="hljs language-bash" lang="bash">pip install beautifulsoup4
pip install lxml  <span class="hljs-comment"># 可选，作为BeautifulSoup的解析器</span>
</code></pre>
<h4 data-id="heading-14">3.3 基本使用</h4>
<pre><code class="hljs language-xml" lang="xml">from bs4 import BeautifulSoup

# HTML字符串
html = '''
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>这是一个标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h1标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h2标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"这是一个图片"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
'''

# 初始化BeautifulSoup对象，使用html.parser解析器
soup = BeautifulSoup(html, 'html.parser')
</code></pre>
<h4 data-id="heading-15">3.4 查找元素的方法</h4>
<h5 data-id="heading-16">3.4.1 find() 和 find_all()</h5>
<p>这是BeautifulSoup中最常用的查找方法：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查找第一个h1标签（按id）</span>
<span class="hljs-attr">h1_by_id</span> = soup.find(<span class="hljs-string">'h1'</span>, id=<span class="hljs-string">'title'</span>)
print(h1_by_id)  <span class="hljs-comment"># 输出：&lt;h1 id="title"&gt;这是一个h1标题&lt;/h1&gt;</span>

<span class="hljs-comment"># 查找第一个h1标签（按class）</span>
<span class="hljs-attr">h1_by_class</span> = soup.find(<span class="hljs-string">'h1'</span>, class_=<span class="hljs-string">'title'</span>)  <span class="hljs-comment"># 注意：class是Python关键字，所以使用class_</span>
print(h1_by_class.text)  <span class="hljs-comment"># 输出：这是一个h2标题</span>

<span class="hljs-comment"># 查找所有h1标签</span>
<span class="hljs-attr">h1_all</span> = soup.find_all(<span class="hljs-string">'h1'</span>)
print(len(h1_all))  <span class="hljs-comment"># 输出：2</span>

<span class="hljs-comment"># 遍历所有h1标签</span>
for h1 in h1_all:
    print(h1.text)

<span class="hljs-comment"># 查找特定属性的元素</span>
<span class="hljs-attr">img</span> = soup.find(<span class="hljs-string">'img'</span>, alt=<span class="hljs-string">'这是一个图片'</span>)
print(img.get('src'))  <span class="hljs-comment"># 输出：https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png</span>
</code></pre>
<h5 data-id="heading-17">3.4.2 find() 和 find_all() 的参数</h5>

































<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><code>name</code></td><td>标签名，可以是字符串或列表</td></tr><tr><td><code>attrs</code></td><td>属性字典，用于过滤元素</td></tr><tr><td><code>recursive</code></td><td>是否递归查找子元素，默认为True</td></tr><tr><td><code>text</code></td><td>查找包含指定文本的元素</td></tr><tr><td><code>limit</code></td><td>限制返回的元素数量，仅适用于find_all()</td></tr><tr><td><code>**kwargs</code></td><td>关键字参数，用于过滤元素属性</td></tr></tbody></table>
<h4 data-id="heading-18">3.5 CSS选择器</h4>
<p>BeautifulSoup也支持CSS选择器，使用<code>select_one()</code>和<code>select()</code>方法：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 标签选择器</span>
<span class="hljs-attr">h1</span> = soup.select_one(<span class="hljs-string">'h1'</span>)
print(h1.text)  <span class="hljs-comment"># 输出：这是一个h1标题</span>

<span class="hljs-comment"># ID选择器</span>
<span class="hljs-attr">title</span> = soup.select_one(<span class="hljs-string">'#title'</span>)
print(title.text)  <span class="hljs-comment"># 输出：这是一个h1标题</span>

<span class="hljs-comment"># 类选择器</span>
<span class="hljs-attr">content</span> = soup.select_one(<span class="hljs-string">'.content'</span>)

<span class="hljs-comment"># 属性选择器</span>
<span class="hljs-attr">link</span> = soup.select_one(<span class="hljs-string">'a[href="https://example.com"]'</span>)

<span class="hljs-comment"># 后代选择器</span>
<span class="hljs-comment"># 找到container类div下的所有p标签</span>
<span class="hljs-attr">content_in_container</span> = soup.select_one(<span class="hljs-string">'.container p'</span>)

<span class="hljs-comment"># 子元素选择器</span>
<span class="hljs-comment"># 找到container类div的直接子元素p</span>
<span class="hljs-attr">direct_child_p</span> = soup.select_one(<span class="hljs-string">'.container &gt; p'</span>)

<span class="hljs-comment"># 组合选择器</span>
<span class="hljs-attr">special_content</span> = soup.select_one(<span class="hljs-string">'p.content.special'</span>)
</code></pre>
<h4 data-id="heading-19">3.6 元素操作</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取元素的属性值</span>
<span class="hljs-attr">img</span> = soup.find(<span class="hljs-string">'img'</span>)
print(img.get('src'))  <span class="hljs-comment"># 可以获取标签的属性值</span>

<span class="hljs-comment"># 获取元素的文本内容</span>
<span class="hljs-comment"># get_text()方法可以传入参数控制，如strip=True去掉首尾空格，separator='|'用|隔开</span>
<span class="hljs-attr">h1</span> = soup.find(<span class="hljs-string">'h1'</span>)
print(h1.get_text(<span class="hljs-attr">strip</span>=<span class="hljs-literal">True</span>))  <span class="hljs-comment"># 输出：这是一个h1标题</span>

<span class="hljs-comment"># 直接使用text属性，效果类似</span>
print(h1.text)  <span class="hljs-comment"># 输出：这是一个h1标题</span>
</code></pre>
<h4 data-id="heading-20">3.7 性能建议</h4>
<ul>
<li>简单查找：<code>find()</code>/<code>find_all()</code> 通常比CSS选择器快</li>
<li>复杂查找：CSS选择器更直观易读</li>
</ul>
<h3 data-id="heading-21">4. 两个库的对比</h3>
<h4 data-id="heading-22">4.1 优缺点</h4>




















<table><thead><tr><th>库</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>lxml</td><td>解析速度快 支持XPath选择器 API简洁 内存占用小</td><td>安装相对复杂（依赖C库） 对HTML格式要求严格</td></tr><tr><td>BeautifulSoup</td><td>API友好，易于学习 对HTML格式要求宽松 支持多种解析器 文档丰富</td><td>解析速度较慢 内存占用较大 不支持XPath（需要额外安装lxml）</td></tr></tbody></table>
<h4 data-id="heading-23">4.2 适用场景</h4>

















<table><thead><tr><th>库</th><th>适用场景</th></tr></thead><tbody><tr><td>lxml</td><td>数据爬取（特别是大规模数据） 需要使用XPath选择器的场景 对性能要求高的应用</td></tr><tr><td>BeautifulSoup</td><td>简单的数据提取 学习和教学 对HTML格式不规范的网页 快速开发原型</td></tr></tbody></table>
<h4 data-id="heading-24">4.3 性能对比</h4>
<ul>
<li>解析速度：<code>lxml</code> &gt; <code>BeautifulSoup</code>（使用lxml解析器） &gt; <code>BeautifulSoup</code>（使用html.parser）</li>
<li>内存占用：<code>lxml</code> &lt; <code>BeautifulSoup</code></li>
</ul>
<h4 data-id="heading-25">4.4 选择建议</h4>
<ol>
<li>如果性能是首要考虑因素，选择<code>lxml</code></li>
<li>如果代码可读性和易用性更重要，选择<code>BeautifulSoup</code></li>
<li>如果需要处理不规范的HTML，选择<code>BeautifulSoup</code></li>
<li>如果需要使用XPath选择器，选择<code>lxml</code></li>
<li>可以结合使用：<code>BeautifulSoup(html, 'lxml')</code>，利用两者的优点</li>
</ol>
<h3 data-id="heading-26">5. 总结</h3>


















































<table><thead><tr><th>特性</th><th>lxml</th><th>BeautifulSoup</th></tr></thead><tbody><tr><td>解析速度</td><td>快</td><td>较慢</td></tr><tr><td>内存占用</td><td>小</td><td>大</td></tr><tr><td>API友好度</td><td>中等</td><td>高</td></tr><tr><td>XPath支持</td><td>是</td><td>否（需要额外安装）</td></tr><tr><td>CSS选择器支持</td><td>是</td><td>是</td></tr><tr><td>对HTML格式要求</td><td>严格</td><td>宽松</td></tr><tr><td>安装复杂度</td><td>较高</td><td>较低</td></tr><tr><td>文档质量</td><td>好</td><td>优秀</td></tr></tbody></table>
<h3 data-id="heading-27">6. 最佳实践</h3>
<ol>
<li>根据具体需求选择合适的库</li>
<li>对于大规模数据爬取，优先考虑<code>lxml</code></li>
<li>对于快速开发和原型设计，优先考虑<code>BeautifulSoup</code></li>
<li>可以结合使用两者：<code>BeautifulSoup(html, 'lxml')</code></li>
<li>学习XPath选择器，它是一种强大的定位元素的工具</li>
<li>注意HTML的格式规范，特别是在使用<code>lxml</code>时</li>
<li>定期更新库版本，以获得更好的性能和安全性</li>
</ol>
<h3 data-id="heading-28">7. 示例代码汇总</h3>
<h4 data-id="heading-29">7.1 lxml示例</h4>
<pre><code class="hljs language-ini" lang="ini">from lxml import etree

<span class="hljs-attr">html</span> = <span class="hljs-string">'''
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;这是一个标题&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1 id="title"&gt;这是一个h1标题&lt;/h1&gt;
        &lt;h1 class="title"&gt;这是一个h2标题&lt;/h1&gt;
        &lt;img src="https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png" alt="这是一个图片"&gt;
        &lt;div class="content"&gt;
            &lt;p&gt;这是一个段落111&lt;/p&gt;
            &lt;p&gt;这是一个段落222&lt;/p&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
'''</span>

<span class="hljs-comment"># 解析HTML字符串</span>
<span class="hljs-attr">root</span> = etree.HTML(html)

<span class="hljs-comment"># 查找所有p元素并打印文本</span>
<span class="hljs-attr">ps</span> = root.xpath(<span class="hljs-string">'//p'</span>)
for p in ps:
    print(p.text)

<span class="hljs-comment"># 直接获取文本内容</span>
<span class="hljs-attr">ps_text</span> = root.xpath(<span class="hljs-string">'//p/text()'</span>)
print(ps_text)

<span class="hljs-comment"># 查找图片的src属性</span>
<span class="hljs-attr">img_src</span> = root.xpath(<span class="hljs-string">'//img/@src'</span>)[<span class="hljs-number">0</span>]
print(img_src)
</code></pre>
<h4 data-id="heading-30">7.2 BeautifulSoup示例</h4>
<pre><code class="hljs language-ini" lang="ini">from bs4 import BeautifulSoup

<span class="hljs-attr">html</span> = <span class="hljs-string">'''
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;这是一个标题&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1 id="title"&gt;这是一个h1标题&lt;/h1&gt;
        &lt;h1 class="title"&gt;这是一个h2标题&lt;/h1&gt;
        &lt;img src="https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png" alt="这是一个图片"&gt;
        &lt;p&gt;这是一个段落&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
'''</span>

<span class="hljs-comment"># 初始化BeautifulSoup对象</span>
<span class="hljs-attr">soup</span> = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)

<span class="hljs-comment"># 查找所有h1标签并打印文本</span>
<span class="hljs-attr">h1_all</span> = soup.find_all(<span class="hljs-string">'h1'</span>)
for h1 in h1_all:
    print(h1.text)

<span class="hljs-comment"># 查找图片并获取src属性</span>
<span class="hljs-attr">img</span> = soup.find(<span class="hljs-string">'img'</span>)
print(img.get('src'))

<span class="hljs-comment"># 使用CSS选择器查找元素</span>
<span class="hljs-attr">title</span> = soup.select_one(<span class="hljs-string">'#title'</span>)
print(title.text)
</code></pre>
<h3 data-id="heading-31">8. 资源推荐</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flxml.de%2F" target="_blank" title="https://lxml.de/" ref="nofollow noopener noreferrer">lxml官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.crummy.com%2Fsoftware%2FBeautifulSoup%2Fbs4%2Fdoc%2F" target="_blank" title="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" ref="nofollow noopener noreferrer">BeautifulSoup官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fxml%2Fxpath_intro.asp" target="_blank" title="https://www.w3schools.com/xml/xpath_intro.asp" ref="nofollow noopener noreferrer">XPath教程</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fcssref%2Fcss_selectors.asp" target="_blank" title="https://www.w3schools.com/cssref/css_selectors.asp" ref="nofollow noopener noreferrer">CSS选择器参考</a></li>
</ul>
<p>通过学习本文档，你应该已经掌握了<code>lxml</code>和<code>BeautifulSoup</code>这两个HTML解析库的基本使用方法和核心知识点。在实际应用中，你可以根据具体需求选择合适的库，或者结合使用两者的优点，提高开发效率和代码质量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拿捏python基础]]></title>    <link>https://juejin.cn/post/7599630795804704814</link>    <guid>https://juejin.cn/post/7599630795804704814</guid>    <pubDate>2026-01-27T07:47:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795804704814" data-draft-id="7599614131424133129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拿捏python基础"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:47:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开飞机的舒克_"/> <meta itemprop="url" content="https://juejin.cn/user/4284144156154958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拿捏python基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4284144156154958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开飞机的舒克_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:47:11.000Z" title="Tue Jan 27 2026 07:47:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>开飞机的舒克
<a href="https://link.juejin.cn?target=halo.gaodaimou.cn" target="_blank" title="halo.gaodaimou.cn" ref="nofollow noopener noreferrer">halo.gaodaimou.cn</a></p>
</blockquote>
<h2 data-id="heading-0">Python 学习指南</h2>
<h3 data-id="heading-1">1. Python 基础类型</h3>
<p>Python 支持多种数据类型，主要包括：</p>
<ul>
<li><strong>整数（int）</strong> ：如 <code>18</code>、<code>-5</code>、<code>0</code></li>
<li><strong>字符串（str）</strong> ：如 <code>"hello"</code>、<code>'world'</code></li>
<li><strong>浮点数（float）</strong> ：如 <code>3.14</code>、<code>-0.5</code></li>
<li><strong>布尔值（bool）</strong> ：<code>True</code> 或 <code>False</code></li>
<li><strong>空值（NoneType）</strong> ：<code>None</code></li>
<li><strong>列表（list）</strong> ：如 <code>[1, 2, 3]</code></li>
<li><strong>元组（tuple）</strong> ：如 <code>(1, 2, 3)</code></li>
<li><strong>字典（dict）</strong> ：如 <code>{"name": "张三"}</code></li>
</ul>
<h4 data-id="heading-2">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 字符串</span>
msg = <span class="hljs-string">"hello world"</span>
<span class="hljs-built_in">print</span>(msg)  <span class="hljs-comment"># 输出: hello world</span>

<span class="hljs-comment"># 布尔值</span>
flag = <span class="hljs-literal">False</span>
<span class="hljs-keyword">if</span> flag:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"flag is True"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"flag is False"</span>)  <span class="hljs-comment"># 输出: flag is False</span>

<span class="hljs-comment"># 查看类型</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(flag))  <span class="hljs-comment"># 输出: &lt;class 'bool'&gt;</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(msg))   <span class="hljs-comment"># 输出: &lt;class 'str'&gt;</span>

<span class="hljs-comment"># 浮点数和整数</span>
PI = <span class="hljs-number">3.1415926</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(PI, <span class="hljs-built_in">type</span>(PI))  <span class="hljs-comment"># 输出: 3.1415926 &lt;class 'float'&gt;</span>
<span class="hljs-built_in">print</span>(age, <span class="hljs-built_in">type</span>(age))  <span class="hljs-comment"># 输出: 18 &lt;class 'int'&gt;</span>

<span class="hljs-comment"># Python 严格区分大小写</span>
</code></pre>
<h3 data-id="heading-3">2. 字符串(str)</h3>
<h4 data-id="heading-4">2.1. 访问字符</h4>




















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>通过索引访问第一个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[0])</code></td><td><code>H</code></td></tr><tr><td>通过负索引访问最后一个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[-1])</code></td><td><code>!</code></td></tr></tbody></table>
<h4 data-id="heading-5">2.2. 字符串切片</h4>



































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>切片获取前5个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[0:5])</code></td><td><code>Hello</code></td></tr><tr><td>切片获取从第8个字符到结尾</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[7:])</code></td><td><code>World!</code></td></tr><tr><td>切片获取从开头到第5个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[:5])</code></td><td><code>Hello</code></td></tr><tr><td>切片获取间隔为2的字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[::2])</code></td><td><code>Hlo ol!</code></td></tr><tr><td>反转字符串</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[::-1])</code></td><td><code>!dlroW ,olleH</code></td></tr></tbody></table>
<h4 data-id="heading-6">2.3. 字符串拼接</h4>




















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>使用 + 运算符拼接字符串</td><td><code>str1 = "Hello"</code> <code>str2 = "World"</code> <code>print(str1 + ", " + str2 + "!")</code></td><td><code>Hello, World!</code></td></tr><tr><td>使用 * 运算符重复字符串</td><td><code>print("Ha" * 3)</code></td><td><code>HaHaHa</code></td></tr></tbody></table>
<h4 data-id="heading-7">2.4. 字符串长度</h4>















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>获取字符串长度</td><td><code>my_str = "Hello, World!"</code> <code>print(len(my_str))</code></td><td><code>13</code></td></tr></tbody></table>
<h4 data-id="heading-8">2.5. 查找和替换</h4>

























<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>查找子字符串位置（find方法）</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.find("World"))</code></td><td><code>7</code></td></tr><tr><td>查找子字符串位置（index方法）</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.index("World"))</code></td><td><code>7</code></td></tr><tr><td>替换子字符串</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.replace("World", "Python"))</code></td><td><code>Hello, Python!</code></td></tr></tbody></table>
<h4 data-id="heading-9">2.6. 大小写转换</h4>



































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>转换为大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.upper())</code></td><td><code>HELLO, WORLD!</code></td></tr><tr><td>转换为小写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.lower())</code></td><td><code>hello, world!</code></td></tr><tr><td>转换为首字母大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.title())</code></td><td><code>Hello, World!</code></td></tr><tr><td>转换为第一个字符大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.capitalize())</code></td><td><code>Hello, world!</code></td></tr><tr><td>大小写互换</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.swapcase())</code></td><td><code>hELLO, wORLD!</code></td></tr></tbody></table>
<h4 data-id="heading-10">2.7. 去除空白字符</h4>

























<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>去除两端空白</td><td><code>my_str = " Hello, World! "</code> <code>print(my_str.strip())</code></td><td><code>Hello, World!</code></td></tr><tr><td>去除左端空白</td><td><code>my_str = " Hello, World! "</code> <code>print(my_str.lstrip())</code></td><td><code>Hello, World!</code></td></tr><tr><td>去除右端空白</td><td><code>my_str = " Hello, World! "</code> <code>print(my_str.rstrip())</code></td><td><code>Hello, World!</code></td></tr></tbody></table>
<h4 data-id="heading-11">2. 8. 分割和连接</h4>




















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>分割字符串</td><td><code>my_str = "Hello, World, Python"</code> <code>print(my_str.split(", "))</code></td><td><code>['Hello', 'World', 'Python']</code></td></tr><tr><td>连接字符串列表</td><td><code>str_list = ['Hello', 'World', 'Python']</code> <code>print(", ".join(str_list))</code></td><td><code>Hello, World, Python</code></td></tr></tbody></table>
<h4 data-id="heading-12">2.9. 检查字符串内容</h4>













































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>检查是否以指定字符串开头</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.startswith("Hello"))</code></td><td><code>True</code></td></tr><tr><td>检查是否以指定字符串结尾</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.endswith("World"))</code></td><td><code>False</code></td></tr><tr><td>检查是否全为字母</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isalpha())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为数字</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isdigit())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为字母或数字</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isalnum())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为小写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.islower())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isupper())</code></td><td><code>False</code></td></tr></tbody></table>
<h4 data-id="heading-13">2.10. 格式化字符串</h4>



































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>f-string 格式化</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print(f"我叫{name}，今年{age}岁")</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>format() 方法（位置参数）</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫{}，今年{}岁".format(name, age))</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>format() 方法（索引参数）</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫{0}，今年{1}岁".format(name, age))</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>format() 方法（关键字参数）</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫{name}，今年{age}岁".format(name=name, age=age))</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>% 格式化</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫%s，今年%d岁" % (name, age))</code></td><td><code>我叫张三，今年18岁</code></td></tr></tbody></table>
<h4 data-id="heading-14">2.11. 字符串不可变性</h4>















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>字符串不可变性（创建新字符串）</td><td><code>my_str = "Hello"</code> <code>my_str = "h" + my_str[1:]</code> <code>print(my_str)</code></td><td><code>hello</code></td></tr></tbody></table>
<blockquote>
<p><strong>注意</strong>：字符串是不可变的，不能直接修改字符串中的字符，如 <code>my_str[0] = "h"</code> 会引发 TypeError。要修改字符串，需要创建新的字符串。</p>
</blockquote>
<h3 data-id="heading-15">3. 列表（List）</h3>
<p>列表是 Python 中最常用的数据结构之一，用于存储有序的元素集合。</p>
<h4 data-id="heading-16">列表操作方法</h4>











































































<table><thead><tr><th>操作</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>访问元素</td><td><code>list[index]</code></td><td>通过索引访问，从 0 开始</td></tr><tr><td>访问最后元素</td><td><code>list[-1]</code></td><td>负数索引从末尾开始</td></tr><tr><td>修改元素</td><td><code>list[index] = value</code></td><td>直接赋值修改</td></tr><tr><td>新增元素</td><td><code>list.append(value)</code></td><td>在末尾添加元素</td></tr><tr><td>插入元素</td><td><code>list.insert(index, value)</code></td><td>在指定位置插入</td></tr><tr><td>合并列表</td><td><code>list.extend(other_list)</code></td><td>将另一个列表的元素添加到末尾</td></tr><tr><td>删除元素</td><td><code>del list[index]</code></td><td>删除指定索引的元素</td></tr><tr><td>删除并返回</td><td><code>list.pop(index)</code></td><td>删除并返回指定索引的元素</td></tr><tr><td>删除值</td><td><code>list.remove(value)</code></td><td>删除第一个匹配的值</td></tr><tr><td>排序</td><td><code>sorted(list)</code></td><td>返回新的排序列表（原列表不变）</td></tr><tr><td>最大值</td><td><code>max(list)</code></td><td>返回列表中的最大值</td></tr><tr><td>最小值</td><td><code>min(list)</code></td><td>返回列表中的最小值</td></tr><tr><td>长度</td><td><code>len(list)</code></td><td>返回列表元素个数</td></tr></tbody></table>
<h4 data-id="heading-17">切片操作</h4>
<p>切片用于访问列表的一部分，语法：<code>list[start:end:step]</code></p>
<ul>
<li><strong>左闭右开区间</strong>：<code>[start:end]</code> 包含 start，不包含 end</li>
<li><strong>默认值</strong>：start 默认 0，end 默认列表长度，step 默认 1</li>
<li><strong>索引越界</strong>：切片不会引发 IndexError</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_list</span> = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>]

<span class="hljs-comment"># 通过切片访问</span>
print(my_list<span class="hljs-section">[1:4]</span>)   <span class="hljs-comment"># 输出: [20, 30, 40]</span>
print(my_list<span class="hljs-section">[:3]</span>)    <span class="hljs-comment"># 输出: [10, 20, 30]（从开头到索引2）</span>
print(my_list<span class="hljs-section">[2:]</span>)    <span class="hljs-comment"># 输出: [30, 40, 50]（从索引2到末尾）</span>
print(my_list<span class="hljs-section">[::2]</span>)   <span class="hljs-comment"># 输出: [10, 30, 50]（步长为2）</span>

<span class="hljs-comment"># 通过切片删除</span>
my_list<span class="hljs-section">[1:3]</span> = <span class="hljs-section">[]</span>     <span class="hljs-comment"># 删除索引1-2的元素</span>
print(my_list)        <span class="hljs-comment"># 输出: [10, 40, 50]</span>

<span class="hljs-comment"># 经过删除后通过切片插入</span>
my_list<span class="hljs-section">[1:1]</span> = <span class="hljs-section">[25, 35]</span>  <span class="hljs-comment"># 在索引1处插入</span>
print(my_list)        <span class="hljs-comment"># 输出: [10, 25, 35, 40, 50]</span>
</code></pre>
<h4 data-id="heading-18">列表操作示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建列表</span>
my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"香蕉"</span>]
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [1, 2, 3, 4, 5, '香蕉']</span>

<span class="hljs-comment"># 修改元素</span>
my_list[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [100, 2, 3, 4, 5, '香蕉']</span>

<span class="hljs-comment"># 新增元素</span>
my_list.append(<span class="hljs-string">"orange"</span>)
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [100, 2, 3, 4, 5, '香蕉', 'orange']</span>

<span class="hljs-comment"># 删除元素</span>
my_list.remove(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 删除值为2的元素</span>
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [100, 3, 4, 5, '香蕉', 'orange']</span>

<span class="hljs-comment"># 列表长度</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(my_list))  <span class="hljs-comment"># 输出: 6</span>
</code></pre>
<h3 data-id="heading-19">4. 元组（Tuple）</h3>
<p>元组是不可变的列表，使用圆括号 <code>()</code> 定义，一旦创建就不能修改。</p>
<h4 data-id="heading-20">元组特点</h4>
<ul>
<li>不可变性：创建后不能修改元素</li>
<li>可以存储不同类型的数据</li>
<li>可以通过索引访问元素</li>
<li>可以使用 <code>len()</code>、<code>max()</code>、<code>min()</code> 等函数</li>
</ul>
<h4 data-id="heading-21">代码示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建元组</span>
tuple1 = (1, 2, 3, 4, 5, <span class="hljs-string">"香蕉"</span>)
<span class="hljs-built_in">print</span>(tuple1)  <span class="hljs-comment"># 输出: (1, 2, 3, 4, 5, '香蕉')</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(tuple1))  <span class="hljs-comment"># 输出: &lt;class 'tuple'&gt;</span>

<span class="hljs-comment"># 访问元素</span>
<span class="hljs-built_in">print</span>(tuple1[0])  <span class="hljs-comment"># 输出: 1</span>
<span class="hljs-built_in">print</span>(tuple1[-1])  <span class="hljs-comment"># 输出: 香蕉</span>

<span class="hljs-comment"># 元组不可修改</span>
<span class="hljs-comment"># tuple1[0] = 100  # 这行代码会引发 TypeError</span>

<span class="hljs-comment"># 遍历元组</span>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> tuple1:
    <span class="hljs-built_in">print</span>(item)
</code></pre>
<h3 data-id="heading-22">5. 字典（Dictionary）</h3>
<p>字典是键值对（key-value）的无序集合，使用大括号 <code>{}</code> 定义，键必须是唯一的。</p>
<h4 data-id="heading-23">字典操作方法</h4>























































<table><thead><tr><th>操作</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>访问值</td><td><code>dict[key]</code></td><td>通过键访问值，键不存在会引发 KeyError</td></tr><tr><td>安全访问</td><td><code>dict.get(key, default)</code></td><td>键不存在返回默认值</td></tr><tr><td>添加/修改</td><td><code>dict[key] = value</code></td><td>键不存在则添加，存在则修改</td></tr><tr><td>删除键</td><td><code>del dict[key]</code></td><td>删除指定键值对</td></tr><tr><td>查看键</td><td><code>dict.keys()</code></td><td>返回所有键的列表</td></tr><tr><td>查看值</td><td><code>dict.values()</code></td><td>返回所有值的列表</td></tr><tr><td>查看键值对</td><td><code>dict.items()</code></td><td>返回所有键值对的列表</td></tr><tr><td>检查键存在</td><td><code>key in dict</code></td><td>返回布尔值</td></tr><tr><td>长度</td><td><code>len(dict)</code></td><td>返回键值对数量</td></tr></tbody></table>
<h4 data-id="heading-24">代码示例</h4>
<pre><code class="hljs language-css" lang="css"># 创建字典
person = {"name": <span class="hljs-string">"张三"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">18</span>, <span class="hljs-string">"gender"</span>: <span class="hljs-string">"男"</span>}
print(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">18</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>}
print(type(person))  # 输出: &lt;class <span class="hljs-string">'dict'</span>&gt;

# 访问值
<span class="hljs-built_in">print</span>(person[<span class="hljs-string">"name"</span>])  # 输出: 张三
<span class="hljs-built_in">print</span>(person.<span class="hljs-built_in">get</span>(<span class="hljs-string">"age"</span>))  # 输出: <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(person.<span class="hljs-built_in">get</span>(<span class="hljs-string">"address"</span>, <span class="hljs-string">"未知"</span>))  # 输出: 未知（键不存在）

# 修改值
person[<span class="hljs-string">"age"</span>] = <span class="hljs-number">19</span>
<span class="hljs-built_in">print</span>(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">19</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>}

# 添加新键值对
person<span class="hljs-selector-attr">[<span class="hljs-string">"address"</span>]</span> = "北京"
print(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">19</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>, <span class="hljs-string">'address'</span>: <span class="hljs-string">'北京'</span>}

# 删除键值对
<span class="hljs-selector-tag">del</span> person<span class="hljs-selector-attr">[<span class="hljs-string">"gender"</span>]</span>
print(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">19</span>, <span class="hljs-string">'address'</span>: <span class="hljs-string">'北京'</span>}

# 遍历字典
for key in person:
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"{key}: {person[key]}"</span>)

for key, value in person.<span class="hljs-built_in">items</span>():
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"{key}: {value}"</span>)

# 检查键是否存在
<span class="hljs-built_in">print</span>(<span class="hljs-string">"name"</span> in person)  # 输出: True
<span class="hljs-built_in">print</span>(<span class="hljs-string">"gender"</span> in person)  # 输出: False

# 字典长度
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(person))  # 输出: <span class="hljs-number">3</span>
</code></pre>
<h3 data-id="heading-25">6. 条件判断（if）</h3>
<p>条件判断用于根据不同条件执行不同的代码块。</p>
<h4 data-id="heading-26">语法结构</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> 条件1:
    <span class="hljs-comment"># 条件1为True时执行</span>
<span class="hljs-keyword">elif</span> 条件2:
    <span class="hljs-comment"># 条件1为False且条件2为True时执行</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># 所有条件都为False时执行</span>
</code></pre>
<h4 data-id="heading-27">代码示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本条件判断</span>
age = 7
<span class="hljs-keyword">if</span> age &gt;= 18:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"成年人"</span>)
<span class="hljs-keyword">elif</span> age &gt;= 6:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"小学生"</span>)  <span class="hljs-comment"># 输出: 小学生</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"未成年人"</span>)

<span class="hljs-comment"># 多个条件</span>
score = 85
<span class="hljs-keyword">if</span> score &gt;= 90:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"优秀"</span>)
<span class="hljs-keyword">elif</span> score &gt;= 80:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"良好"</span>)  <span class="hljs-comment"># 输出: 良好</span>
<span class="hljs-keyword">elif</span> score &gt;= 60:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"及格"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"不及格"</span>)
</code></pre>
<h3 data-id="heading-28">7. 循环结构</h3>
<h4 data-id="heading-29">7.1 for 循环</h4>
<p>for 循环用于遍历可迭代对象（如列表、元组、字符串等）。</p>
<h5 data-id="heading-30">语法结构</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> 变量 <span class="hljs-keyword">in</span> 可迭代对象:
    <span class="hljs-comment"># 循环体</span>
</code></pre>
<h5 data-id="heading-31">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 遍历列表</span>
fruits = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>]
<span class="hljs-keyword">for</span> fruit <span class="hljs-keyword">in</span> fruits:
    <span class="hljs-built_in">print</span>(fruit)

<span class="hljs-comment"># 使用 range() 函数</span>
<span class="hljs-comment"># range(10) 生成 0-9 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(i)

<span class="hljs-comment"># range(start, end) 生成 start 到 end-1 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 5, 6, 7, 8, 9</span>

<span class="hljs-comment"># range(start, end, step) 生成指定步长的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 0, 2, 4, 6, 8</span>

<span class="hljs-comment"># 累加计算</span>
sum_result = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    sum_result += i
    <span class="hljs-built_in">print</span>(sum_result)
</code></pre>
<h4 data-id="heading-32">7.2 while 循环</h4>
<p>while 循环用于在条件为 True 时重复执行代码块。</p>
<h5 data-id="heading-33">语法结构</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">while</span> 条件:
    <span class="hljs-comment"># 循环体</span>
</code></pre>
<h5 data-id="heading-34">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本 while 循环</span>
count = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> count &lt; <span class="hljs-number">5</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"count: <span class="hljs-subst">{count}</span>"</span>)
    count += <span class="hljs-number">1</span>

<span class="hljs-comment"># 无限循环（谨慎使用）</span>
<span class="hljs-comment"># while True:</span>
<span class="hljs-comment">#     print("这是无限循环")</span>

<span class="hljs-comment"># 循环嵌套</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"i=<span class="hljs-subst">{i}</span>, j=<span class="hljs-subst">{j}</span>"</span>)
</code></pre>
<h3 data-id="heading-35">8. 函数定义与调用</h3>
<p>函数是可重用的代码块，使用 <code>def</code> 关键字定义。</p>
<h4 data-id="heading-36">函数语法</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">函数名</span>(<span class="hljs-params">参数<span class="hljs-number">1</span>, 参数<span class="hljs-number">2</span>=默认值</span>):
    <span class="hljs-comment"># 函数体</span>
    <span class="hljs-keyword">return</span> 返回值
</code></pre>
<h4 data-id="heading-37">函数特点</h4>
<ul>
<li>函数可以有多个参数，支持默认值</li>
<li>函数可以返回一个或多个值</li>
<li>函数内部变量的作用域是局部的</li>
<li>函数外部变量是全局的，可通过 <code>global</code> 关键字在函数内部修改</li>
</ul>
<h4 data-id="heading-38">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本函数定义</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">name=<span class="hljs-string">"张三"</span></span>):
    <span class="hljs-string">"""这是函数的文档字符串，用于说明函数功能"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello, <span class="hljs-subst">{name}</span>!"</span>

<span class="hljs-comment"># 调用函数</span>
<span class="hljs-built_in">print</span>(say_hello())  <span class="hljs-comment"># 输出: Hello, 张三!</span>
<span class="hljs-built_in">print</span>(say_hello(<span class="hljs-string">"李四"</span>))  <span class="hljs-comment"># 输出: Hello, 李四!</span>

<span class="hljs-comment"># 带多个参数的函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

result = add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># 输出: 8</span>

<span class="hljs-comment"># 函数内部的作用域</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_scope</span>():
    local_var = <span class="hljs-string">"局部变量"</span>
    <span class="hljs-built_in">print</span>(local_var)  <span class="hljs-comment"># 可以访问局部变量</span>

<span class="hljs-comment"># print(local_var)  # 这行代码会引发 NameError，因为局部变量在函数外部不可访问</span>

<span class="hljs-comment"># 使用全局变量</span>
global_var = <span class="hljs-string">"全局变量"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_global</span>():
    <span class="hljs-keyword">global</span> global_var  <span class="hljs-comment"># 声明使用全局变量</span>
    global_var = <span class="hljs-string">"修改后的全局变量"</span>
    <span class="hljs-built_in">print</span>(global_var)

test_global()  <span class="hljs-comment"># 输出: 修改后的全局变量</span>
<span class="hljs-built_in">print</span>(global_var)  <span class="hljs-comment"># 输出: 修改后的全局变量</span>

<span class="hljs-comment"># 函数返回多个值</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_info</span>():
    name = <span class="hljs-string">"张三"</span>
    age = <span class="hljs-number">18</span>
    <span class="hljs-keyword">return</span> name, age

user_name, user_age = get_user_info()
<span class="hljs-built_in">print</span>(user_name, user_age)  <span class="hljs-comment"># 输出: 张三 18</span>
</code></pre>
<h3 data-id="heading-39">9. 面向对象编程</h3>
<p>Python 是面向对象的编程语言，支持类和对象的概念。</p>
<h4 data-id="heading-40">类的基本概念</h4>
<ul>
<li><strong>类（Class）</strong> ：对象的蓝图，定义了对象的属性和方法</li>
<li><strong>对象（Object）</strong> ：类的实例</li>
<li><strong>属性（Attribute）</strong> ：对象的特征</li>
<li><strong>方法（Method）</strong> ：对象的行为</li>
<li><strong>self</strong>：代表类的实例，必须是方法的第一个参数</li>
</ul>
<h4 data-id="heading-41">类的语法</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">类名</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 参数<span class="hljs-number">1</span>, 参数<span class="hljs-number">2</span></span>):
        <span class="hljs-comment"># 初始化方法，创建对象时自动调用</span>
        self.属性<span class="hljs-number">1</span> = 参数<span class="hljs-number">1</span>
        self.属性<span class="hljs-number">2</span> = 参数<span class="hljs-number">2</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">方法名</span>(<span class="hljs-params">self, 参数</span>):
        <span class="hljs-comment"># 方法体</span>
        <span class="hljs-keyword">return</span> 返回值
</code></pre>
<h4 data-id="heading-42">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-string">"""人员类"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-string">"""初始化方法"""</span>
        self.name = name  <span class="hljs-comment"># 实例属性</span>
        self.age = age

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self, sex=<span class="hljs-string">"男"</span></span>):
        <span class="hljs-string">"""打招呼方法"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello, <span class="hljs-subst">{self.name}</span>！性别：<span class="hljs-subst">{sex}</span>"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">birthday</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""过生日方法，年龄加1"""</span>
        self.age += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>今年<span class="hljs-subst">{self.age}</span>岁了！"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_age</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""获取年龄方法"""</span>
        <span class="hljs-keyword">return</span> self.age

<span class="hljs-comment"># 创建对象（实例化）</span>
person1 = Person(<span class="hljs-string">"张三"</span>, <span class="hljs-number">18</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(person1))  <span class="hljs-comment"># 输出: &lt;class '__main__.Person'&gt;</span>

<span class="hljs-comment"># 调用对象方法</span>
<span class="hljs-built_in">print</span>(person1.say_hello())  <span class="hljs-comment"># 输出: Hello, 张三！性别：男</span>
<span class="hljs-built_in">print</span>(person1.say_hello(<span class="hljs-string">"女"</span>))  <span class="hljs-comment"># 输出: Hello, 张三！性别：女</span>

<span class="hljs-comment"># 调用修改属性的方法</span>
<span class="hljs-built_in">print</span>(person1.birthday())  <span class="hljs-comment"># 输出: 张三今年19岁了！</span>
<span class="hljs-built_in">print</span>(person1.get_age())  <span class="hljs-comment"># 输出: 19</span>

<span class="hljs-comment"># 直接访问属性</span>
<span class="hljs-built_in">print</span>(person1.name)  <span class="hljs-comment"># 输出: 张三</span>
<span class="hljs-built_in">print</span>(person1.age)  <span class="hljs-comment"># 输出: 19</span>
</code></pre>
<h4 data-id="heading-43">9.1 类继承</h4>
<p>类继承允许创建一个新类（子类），继承现有类（父类）的属性和方法。子类可以扩展或修改父类的功能。</p>
<h5 data-id="heading-44">继承语法</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">子类名</span>(<span class="hljs-title class_ inherited__">父类名</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 父类参数, 子类参数</span>):
        <span class="hljs-built_in">super</span>().__init__(父类参数)  <span class="hljs-comment"># 调用父类的初始化方法</span>
        self.子类属性 = 子类参数

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">子类方法</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 子类方法实现</span>
        <span class="hljs-keyword">return</span> 结果
</code></pre>
<h5 data-id="heading-45">继承特点</h5>
<ul>
<li>子类继承父类的所有属性和方法</li>
<li>子类可以重写父类的方法</li>
<li>子类可以添加新的属性和方法</li>
<li>使用 <code>super()</code> 调用父类的方法</li>
</ul>
<h5 data-id="heading-46">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义父类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mammal</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, sex</span>):
        self.name = name
        self.sex = sex
        self.num_eyes = <span class="hljs-number">2</span>  <span class="hljs-comment"># 所有哺乳动物都有2只眼睛</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">breathe</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>在呼吸"</span>)

<span class="hljs-comment"># 定义子类，继承自Mammal</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">Mammal</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, sex, occupation</span>):
        <span class="hljs-comment"># 调用父类的初始化方法，继承父类的属性</span>
        <span class="hljs-built_in">super</span>().__init__(name, sex)
        <span class="hljs-comment"># 添加子类独有的属性</span>
        self.occupation = occupation

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">work</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 子类独有的方法</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>正在工作，职业是<span class="hljs-subst">{self.occupation}</span>"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">breathe</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 重写父类的方法</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>正在用鼻子呼吸"</span>)

<span class="hljs-comment"># 测试继承</span>
<span class="hljs-comment"># 如果子类没有自己的构造函数 __init__，会直接调用父类的构造函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-title class_ inherited__">Mammal</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bark</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>在汪汪叫"</span>)

<span class="hljs-comment"># 创建子类实例</span>
person = Person(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"男"</span>, <span class="hljs-string">"程序员"</span>)
dog = Dog(<span class="hljs-string">"旺财"</span>, <span class="hljs-string">"公"</span>)

<span class="hljs-comment"># 调用继承的属性和方法</span>
<span class="hljs-built_in">print</span>(person.name)  <span class="hljs-comment"># 继承自父类的属性</span>
<span class="hljs-built_in">print</span>(person.num_eyes)  <span class="hljs-comment"># 继承自父类的属性</span>
person.breathe()  <span class="hljs-comment"># 调用重写后的方法</span>
person.work()  <span class="hljs-comment"># 调用子类独有的方法</span>

dog.breathe()  <span class="hljs-comment"># 调用父类的方法</span>
</code></pre>
<h3 data-id="heading-47">10. 数学计算（Math 模块）</h3>
<p>Python 的 <code>math</code> 模块提供了丰富的数学函数。</p>
<h4 data-id="heading-48">常用数学函数</h4>





















































































<table><thead><tr><th>函数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>math.sqrt(x)</code></td><td>平方根</td><td><code>math.sqrt(16)</code> → 4.0</td></tr><tr><td><code>math.ceil(x)</code></td><td>向上取整</td><td><code>math.ceil(3.14)</code> → 4</td></tr><tr><td><code>math.floor(x)</code></td><td>向下取整</td><td><code>math.floor(3.14)</code> → 3</td></tr><tr><td><code>math.pow(x, y)</code></td><td>x 的 y 次方</td><td><code>math.pow(2, 3)</code> → 8.0</td></tr><tr><td><code>math.fabs(x)</code></td><td>绝对值</td><td><code>math.fabs(-10)</code> → 10.0</td></tr><tr><td><code>math.gcd(x, y)</code></td><td>最大公约数</td><td><code>math.gcd(12, 18)</code> → 6</td></tr><tr><td><code>math.lcm(x, y)</code></td><td>最小公倍数</td><td><code>math.lcm(12, 18)</code> → 36</td></tr><tr><td><code>math.sin(x)</code></td><td>正弦函数（弧度）</td><td><code>math.sin(math.pi/2)</code> → 1.0</td></tr><tr><td><code>math.cos(x)</code></td><td>余弦函数（弧度）</td><td><code>math.cos(math.pi)</code> → -1.0</td></tr><tr><td><code>math.tan(x)</code></td><td>正切函数（弧度）</td><td><code>math.tan(math.pi/4)</code> → 1.0</td></tr><tr><td><code>math.degrees(x)</code></td><td>弧度转角度</td><td><code>math.degrees(math.pi/2)</code> → 90.0</td></tr><tr><td><code>math.radians(x)</code></td><td>角度转弧度</td><td><code>math.radians(90)</code> → 1.570796...</td></tr><tr><td><code>math.log(x)</code></td><td>自然对数</td><td><code>math.log(math.e)</code> → 1.0</td></tr><tr><td><code>math.log10(x)</code></td><td>以10为底的对数</td><td><code>math.log10(100)</code> → 2.0</td></tr><tr><td><code>math.exp(x)</code></td><td>e 的 x 次方</td><td><code>math.exp(1)</code> → 2.71828...</td></tr></tbody></table>
<h4 data-id="heading-49">常量</h4>
<ul>
<li><code>math.pi</code>：圆周率 π（约3.14159...）</li>
<li><code>math.e</code>：自然常数 e（约2.71828...）</li>
</ul>
<h4 data-id="heading-50">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math

<span class="hljs-comment"># 平方根</span>
<span class="hljs-built_in">print</span>(math.sqrt(<span class="hljs-number">16</span>))  <span class="hljs-comment"># 输出: 4.0</span>

<span class="hljs-comment"># 取整</span>
<span class="hljs-built_in">print</span>(math.ceil(<span class="hljs-number">3.14</span>))  <span class="hljs-comment"># 输出: 4</span>
<span class="hljs-built_in">print</span>(math.floor(<span class="hljs-number">3.14</span>))  <span class="hljs-comment"># 输出: 3</span>

<span class="hljs-comment"># 幂运算</span>
<span class="hljs-built_in">print</span>(math.<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出: 8.0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-number">2</span> ** <span class="hljs-number">3</span>)  <span class="hljs-comment"># 输出: 8（Python 内置幂运算）</span>

<span class="hljs-comment"># 绝对值</span>
<span class="hljs-built_in">print</span>(math.fabs(-<span class="hljs-number">10</span>))  <span class="hljs-comment"># 输出: 10.0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">abs</span>(-<span class="hljs-number">10</span>))  <span class="hljs-comment"># 输出: 10（Python 内置绝对值）</span>

<span class="hljs-comment"># 最大公约数和最小公倍数</span>
<span class="hljs-built_in">print</span>(math.gcd(<span class="hljs-number">12</span>, <span class="hljs-number">18</span>))  <span class="hljs-comment"># 输出: 6</span>
<span class="hljs-built_in">print</span>(math.lcm(<span class="hljs-number">12</span>, <span class="hljs-number">18</span>))  <span class="hljs-comment"># 输出: 36</span>

<span class="hljs-comment"># 三角函数（使用弧度）</span>
<span class="hljs-built_in">print</span>(math.sin(math.pi / <span class="hljs-number">2</span>))  <span class="hljs-comment"># 输出: 1.0</span>
<span class="hljs-built_in">print</span>(math.cos(math.pi))  <span class="hljs-comment"># 输出: -1.0</span>

<span class="hljs-comment"># 角度转换</span>
<span class="hljs-built_in">print</span>(math.degrees(math.pi / <span class="hljs-number">2</span>))  <span class="hljs-comment"># 输出: 90.0</span>
<span class="hljs-built_in">print</span>(math.radians(<span class="hljs-number">90</span>))  <span class="hljs-comment"># 输出: 1.5707963267948966</span>

<span class="hljs-comment"># 对数</span>
<span class="hljs-built_in">print</span>(math.log(math.e))  <span class="hljs-comment"># 输出: 1.0</span>
<span class="hljs-built_in">print</span>(math.log10(<span class="hljs-number">100</span>))  <span class="hljs-comment"># 输出: 2.0</span>

<span class="hljs-comment"># 常量</span>
<span class="hljs-built_in">print</span>(math.pi)  <span class="hljs-comment"># 输出: 3.141592653589793</span>
<span class="hljs-built_in">print</span>(math.e)  <span class="hljs-comment"># 输出: 2.718281828459045</span>
</code></pre>
<h3 data-id="heading-51">11. 输入输出（Input/Output）</h3>
<h4 data-id="heading-52">输入函数（input）</h4>
<p><code>input()</code> 函数用于从控制台获取用户输入，返回值是字符串类型。</p>
<h4 data-id="heading-53">输出函数（print）</h4>
<p><code>print()</code> 函数用于将内容输出到控制台，支持多个参数和格式化输出。</p>
<h4 data-id="heading-54">类型转换</h4>






























<table><thead><tr><th>函数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>int(x)</code></td><td>转换为整数</td><td><code>int("123")</code> → 123</td></tr><tr><td><code>float(x)</code></td><td>转换为浮点数</td><td><code>float("3.14")</code> → 3.14</td></tr><tr><td><code>str(x)</code></td><td>转换为字符串</td><td><code>str(123)</code> → "123"</td></tr><tr><td><code>list(x)</code></td><td>转换为列表</td><td><code>list("abc")</code> → ["a", "b", "c"]</td></tr></tbody></table>
<h4 data-id="heading-55">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本输入输出</span>
name = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的姓名："</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"您的姓名是：<span class="hljs-subst">{name}</span>"</span>)

<span class="hljs-comment"># 输入数字并转换类型</span>
age_str = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的年龄："</span>)
age = <span class="hljs-built_in">int</span>(age_str)  <span class="hljs-comment"># 转换为整数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"您明年将满 <span class="hljs-subst">{age + <span class="hljs-number">1</span>}</span> 岁"</span>)

<span class="hljs-comment"># 多个输入</span>
height = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的身高（米）："</span>))
weight = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的体重（千克）："</span>))

<span class="hljs-comment"># BMI 计算</span>
bmi = weight / (height ** <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"您的 BMI 指数是：<span class="hljs-subst">{bmi:<span class="hljs-number">.2</span>f}</span>"</span>)

<span class="hljs-comment"># 类型转换示例</span>
num1 = <span class="hljs-number">123</span>
num2 = <span class="hljs-string">"456"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(num1) + num2)  <span class="hljs-comment"># 输出: 123456（字符串拼接）</span>
<span class="hljs-built_in">print</span>(num1 + <span class="hljs-built_in">int</span>(num2))  <span class="hljs-comment"># 输出: 579（整数相加）</span>
</code></pre>
<h3 data-id="heading-56">12. 字符串格式化</h3>
<p>Python 提供了多种字符串格式化方式，常用的有：</p>
<h4 data-id="heading-57">1. f-strings（Python 3.6+）</h4>
<p>使用 <code>f"{变量}"</code> 语法，简洁高效。</p>
<h4 data-id="heading-58">2. format() 方法</h4>
<p>使用 <code>"{}".format()</code> 语法，兼容性好。</p>
<h4 data-id="heading-59">3. 百分号（%）格式化</h4>
<p>传统的格式化方式，类似 C 语言的 printf。</p>
<h4 data-id="heading-60">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># f-strings 格式化</span>
name = <span class="hljs-string">"张三"</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"我叫<span class="hljs-subst">{name}</span>，今年<span class="hljs-subst">{age}</span>岁"</span>)  <span class="hljs-comment"># 输出: 我叫张三，今年18岁</span>

<span class="hljs-comment"># 格式化数字</span>
pi = <span class="hljs-number">3.1415926</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"π的值是：<span class="hljs-subst">{pi:<span class="hljs-number">.2</span>f}</span>"</span>)  <span class="hljs-comment"># 输出: π的值是：3.14</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"π的值是：<span class="hljs-subst">{pi:<span class="hljs-number">10.3</span>f}</span>"</span>)  <span class="hljs-comment"># 输出: π的值是：     3.142（总宽度10，右对齐）</span>

<span class="hljs-comment"># format() 方法</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫{}，今年{}岁"</span>.<span class="hljs-built_in">format</span>(name, age))  <span class="hljs-comment"># 输出: 我叫张三，今年18岁</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫{0}，今年{1}岁，{0}很优秀"</span>.<span class="hljs-built_in">format</span>(name, age))  <span class="hljs-comment"># 输出: 我叫张三，今年18岁，张三很优秀</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫{name}，今年{age}岁"</span>.<span class="hljs-built_in">format</span>(name=<span class="hljs-string">"李四"</span>, age=<span class="hljs-number">20</span>))  <span class="hljs-comment"># 输出: 我叫李四，今年20岁</span>

<span class="hljs-comment"># 百分号格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫%s，今年%d岁"</span> % (name, age))  <span class="hljs-comment"># 输出: 我叫张三，今年18岁</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"π的值是：%.2f"</span> % pi)  <span class="hljs-comment"># 输出: π的值是：3.14</span>

<span class="hljs-comment"># 多行字符串（保留格式）</span>
multi_line = <span class="hljs-string">"""这是第一行
这是第二行
这是第三行"""</span>
<span class="hljs-built_in">print</span>(multi_line)
</code></pre>
<h4 data-id="heading-61">数字格式化说明符</h4>























































<table><thead><tr><th>说明符</th><th>功能</th><th>示例</th></tr></thead><tbody><tr><td><code>:f</code></td><td>浮点数，默认6位小数</td><td><code>{3.14:f}</code> → 3.140000</td></tr><tr><td><code>:.1f</code></td><td>保留1位小数</td><td><code>{3.14:.1f}</code> → 3.1</td></tr><tr><td><code>:.2f</code></td><td>保留2位小数</td><td><code>{3.14:.2f}</code> → 3.14</td></tr><tr><td><code>:10.2f</code></td><td>总宽度10，保留2位小数</td><td><code>{3.14:10.2f}</code> → " 3.14"</td></tr><tr><td><code>:d</code></td><td>整数</td><td><code>{123:d}</code> → 123</td></tr><tr><td><code>:s</code></td><td>字符串</td><td><code>{"abc":s}</code> → abc</td></tr><tr><td><code>:0&gt;5d</code></td><td>宽度5，不足补0，右对齐</td><td><code>{12:0&gt;5d}</code> → 00012</td></tr><tr><td><code>:0&lt;5d</code></td><td>宽度5，不足补0，左对齐</td><td><code>{12:0&lt;5d}</code> → 12000</td></tr><tr><td><code>:^5d</code></td><td>宽度5，居中对齐</td><td><code>{12:^5d}</code> → " 12 "</td></tr></tbody></table>
<h3 data-id="heading-62">13. range() 函数</h3>
<p><code>range()</code> 函数用于生成整数序列，常用于 for 循环中。</p>
<h4 data-id="heading-63">语法</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">range</span>(stop)  # 生成 <span class="hljs-number">0</span> 到 stop<span class="hljs-number">-1</span> 的整数
<span class="hljs-built_in">range</span>(start, stop)  # 生成 start 到 stop<span class="hljs-number">-1</span> 的整数
<span class="hljs-built_in">range</span>(start, stop, step)  # 生成指定步长的整数序列
</code></pre>
<h4 data-id="heading-64">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 生成 0-4 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 0, 1, 2, 3, 4</span>

<span class="hljs-comment"># 生成 5-9 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 5, 6, 7, 8, 9</span>

<span class="hljs-comment"># 生成 5-19 的奇数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">2</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 5, 7, 9, 11, 13, 15, 17, 19</span>

<span class="hljs-comment"># 生成倒序序列</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 10, 9, 8, 7, 6, 5, 4, 3, 2, 1</span>

<span class="hljs-comment"># 将 range 转换为列表</span>
numbers = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))
<span class="hljs-built_in">print</span>(numbers)  <span class="hljs-comment"># 输出: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</code></pre>
<h3 data-id="heading-65">14. 文件操作</h3>
<h4 data-id="heading-66">14.1 文件路径</h4>
<p>文件路径用于定位文件在计算机中的位置，主要有两种类型：</p>
<h5 data-id="heading-67">相对路径</h5>
<p>相对于当前工作目录的路径，不需要完整路径信息。</p>

























<table><thead><tr><th>符号</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td><code>.</code></td><td>当前目录</td><td><code>./file.txt</code></td></tr><tr><td><code>..</code></td><td>上级目录</td><td><code>../file.txt</code></td></tr><tr><td><code>/</code></td><td>目录分隔符</td><td><code>./subdir/file.txt</code></td></tr></tbody></table>
<h5 data-id="heading-68">绝对路径</h5>
<p>从根目录开始的完整路径，包含所有目录层级。</p>

















<table><thead><tr><th>系统</th><th>示例</th></tr></thead><tbody><tr><td>Windows</td><td><code>C:\Users\username\Desktop\file.txt</code></td></tr><tr><td>Linux/macOS</td><td><code>/home/username/Desktop/file.txt</code></td></tr></tbody></table>
<h4 data-id="heading-69">14.2 读取文件</h4>
<p>使用 <code>open()</code> 函数打开文件，返回一个文件对象。</p>
<h5 data-id="heading-70">open() 函数语法</h5>
<pre><code class="hljs language-ini" lang="ini">open(file_path, <span class="hljs-attr">mode</span>=<span class="hljs-string">'r'</span>, encoding=None)
</code></pre>





















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>file_path</code></td><td>文件路径（相对或绝对）</td></tr><tr><td><code>mode</code></td><td>文件打开模式（默认为只读 <code>'r'</code>）</td></tr><tr><td><code>encoding</code></td><td>文件编码（如 <code>'utf-8'</code>）</td></tr></tbody></table>
<h5 data-id="heading-71">文件打开模式</h5>





































<table><thead><tr><th>模式</th><th>描述</th></tr></thead><tbody><tr><td><code>r</code></td><td>只读模式（默认）</td></tr><tr><td><code>w</code></td><td>只写模式，覆盖原有内容，文件不存在则创建</td></tr><tr><td><code>a</code></td><td>追加模式，在文件末尾添加内容</td></tr><tr><td><code>r+</code></td><td>读写模式，从文件开头开始</td></tr><tr><td><code>w+</code></td><td>读写模式，覆盖原有内容</td></tr><tr><td><code>a+</code></td><td>读写模式，在文件末尾追加</td></tr><tr><td><code>b</code></td><td>二进制模式（如 <code>'rb'</code>、<code>'wb'</code>）</td></tr></tbody></table>
<h5 data-id="heading-72">文件读取方法</h5>

























<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>read()</code></td><td>读取整个文件内容，返回字符串</td></tr><tr><td><code>read(size)</code></td><td>读取指定字节数，返回字符串</td></tr><tr><td><code>readline()</code></td><td>读取一行内容，返回字符串</td></tr><tr><td><code>readlines()</code></td><td>读取所有行，返回列表</td></tr></tbody></table>
<h5 data-id="heading-73">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 基本读取</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    content = f.read()
    <span class="hljs-built_in">print</span>(content)

<span class="hljs-comment"># 2. 逐行读取（适合大文件）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    line = f.readline()
    <span class="hljs-keyword">while</span> line:
        <span class="hljs-built_in">print</span>(line.strip())
        line = f.readline()

<span class="hljs-comment"># 3. 读取所有行到列表</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    lines = f.readlines()
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
        <span class="hljs-built_in">print</span>(line.strip())

<span class="hljs-comment"># 4. 读取指定字节数</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-built_in">print</span>(f.read(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 读取前10个字符</span>
    <span class="hljs-built_in">print</span>(f.read(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 继续读取接下来的10个字符</span>
</code></pre>
<h4 data-id="heading-74">14.3 文件写入</h4>
<h5 data-id="heading-75">基本写入</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 覆盖写入</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    f.write(<span class="hljs-string">'Hello, World!\n'</span>)
    f.write(<span class="hljs-string">'这是第二行\n'</span>)

<span class="hljs-comment"># 追加写入</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'a'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    f.write(<span class="hljs-string">'这是追加的一行\n'</span>)

<span class="hljs-comment"># 写入多行</span>
lines = [<span class="hljs-string">'第一行'</span>, <span class="hljs-string">'第二行'</span>, <span class="hljs-string">'第三行'</span>]
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    f.writelines([line + <span class="hljs-string">'\n'</span> <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines])
</code></pre>
<h4 data-id="heading-76">14.4 文件关闭</h4>
<p>文件使用完毕后必须关闭，否则会占用系统资源。</p>
<h5 data-id="heading-77">两种关闭方式</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 显式关闭</span>
f = <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>)
<span class="hljs-keyword">try</span>:
    content = f.read()
    <span class="hljs-built_in">print</span>(content)
<span class="hljs-keyword">finally</span>:
    f.close()  <span class="hljs-comment"># 确保文件被关闭</span>

<span class="hljs-comment"># 2. 使用 with 语句（推荐）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
    content = f.read()
    <span class="hljs-built_in">print</span>(content)
<span class="hljs-comment"># with 语句会自动关闭文件，无需手动调用 close()</span>
</code></pre>
<h3 data-id="heading-78">15. 异常处理</h3>
<h4 data-id="heading-79">15.1 try-except 语句</h4>
<p>用于捕获和处理程序运行时的异常。</p>
<h5 data-id="heading-80">基本语法</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 可能引发异常的代码</span>
    result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span>
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-comment"># 处理特定异常</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"除数不能为零"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># 处理所有其他异常</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发生了异常: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># 没有异常时执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"执行成功"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 无论是否有异常都会执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"清理资源"</span>)
</code></pre>
<h5 data-id="heading-81">常见异常类型</h5>

































<table><thead><tr><th>异常类型</th><th>描述</th></tr></thead><tbody><tr><td><code>ZeroDivisionError</code></td><td>除数为零</td></tr><tr><td><code>ValueError</code></td><td>值错误</td></tr><tr><td><code>TypeError</code></td><td>类型错误</td></tr><tr><td><code>FileNotFoundError</code></td><td>文件未找到</td></tr><tr><td><code>IndexError</code></td><td>索引越界</td></tr><tr><td><code>KeyError</code></td><td>字典键不存在</td></tr></tbody></table>
<h5 data-id="heading-82">异常处理示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    user_weight = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的体重(单位:kg): "</span>))
    user_height = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的身高(单位:m): "</span>))
    <span class="hljs-keyword">if</span> user_height &lt;= <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"身高必须大于零"</span>)
    bmi = user_weight / (user_height ** <span class="hljs-number">2</span>)
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"输入错误: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:   <span class="hljs-comment"># 或者 except:</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发生了未知错误: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"您的BMI指数是: <span class="hljs-subst">{bmi:<span class="hljs-number">.2</span>f}</span>"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"程序执行完毕"</span>)
</code></pre>
<h4 data-id="heading-83">15.2 断言（assert）</h4>
<p>断言用于检查程序中的条件是否为真，如果为假则引发 <code>AssertionError</code>。</p>
<h5 data-id="heading-84">语法</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">assert</span> 条件, <span class="hljs-string">"错误消息"</span>
</code></pre>
<h5 data-id="heading-85">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本断言</span>
<span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(<span class="hljs-string">"hello"</span>) == <span class="hljs-number">5</span>, <span class="hljs-string">"字符串长度应为5"</span>

<span class="hljs-comment"># 断言在测试中的应用</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># 测试add函数</span>
<span class="hljs-keyword">assert</span> add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">3</span>, <span class="hljs-string">"1+2应该等于3"</span>
<span class="hljs-keyword">assert</span> add(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>, <span class="hljs-string">"-1+1应该等于0"</span>
<span class="hljs-keyword">assert</span> add(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == <span class="hljs-number">0</span>, <span class="hljs-string">"0+0应该等于0"</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"所有断言通过！"</span>)
</code></pre>
<h5 data-id="heading-86">注意事项</h5>
<ul>
<li>断言主要用于开发和测试阶段</li>
<li>生产环境中可以通过 <code>-O</code> 选项关闭断言</li>
<li>断言失败会立即终止程序执行</li>
</ul>
<h3 data-id="heading-87">16. 单元测试（unittest）</h3>
<h4 data-id="heading-88">16.1 什么是单元测试</h4>
<p>单元测试是对程序中最小可测试单元（如函数、方法）进行的测试。</p>
<h4 data-id="heading-89">16.2 使用 unittest 框架</h4>
<h5 data-id="heading-90">测试用例结构</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> unittest

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClassName</span>(unittest.TestCase):
    <span class="hljs-string">"""测试类"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""每个测试方法执行前调用"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tearDown</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""每个测试方法执行后调用"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_method_name</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试方法，必须以test_开头"""</span>
        <span class="hljs-comment"># 断言语句</span>
        self.assertEqual(<span class="hljs-number">1</span> + <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
</code></pre>
<h5 data-id="heading-91">常用断言方法</h5>









































<table><thead><tr><th>断言方法</th><th>描述</th></tr></thead><tbody><tr><td><code>assertEqual(a, b)</code></td><td>验证 a == b</td></tr><tr><td><code>assertNotEqual(a, b)</code></td><td>验证 a != b</td></tr><tr><td><code>assertTrue(x)</code></td><td>验证 x 为 True</td></tr><tr><td><code>assertFalse(x)</code></td><td>验证 x 为 False</td></tr><tr><td><code>assertAlmostEqual(a, b)</code></td><td>验证浮点数近似相等</td></tr><tr><td><code>assertRaises(exception, callable, *args, **kwds)</code></td><td>验证调用可调用对象会引发指定异常</td></tr><tr><td><code>assertIn(item, container)</code></td><td>验证 item 在 container 中</td></tr><tr><td><code>assertNotIn(item, container)</code></td><td>验证 item 不在 container 中</td></tr></tbody></table>
<h5 data-id="heading-92">完整测试示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># calculator.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">return</span> a + b

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">return</span> a - b

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">return</span> a * b

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"除数不能为零"</span>)
        <span class="hljs-keyword">return</span> a / b

<span class="hljs-comment"># test_calculator.py</span>
<span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">from</span> calculator <span class="hljs-keyword">import</span> Calculator

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCalculator</span>(unittest.TestCase):
    <span class="hljs-string">"""测试计算器类"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试前的准备工作"""</span>
        self.calc = Calculator()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n开始测试..."</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tearDown</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试后的清理工作"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"测试结束..."</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试加法功能"""</span>
        self.assertEqual(self.calc.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>), <span class="hljs-number">3</span>)
        self.assertEqual(self.calc.add(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <span class="hljs-number">0</span>)
        self.assertEqual(self.calc.add(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">0</span>)
        self.assertAlmostEqual(self.calc.add(<span class="hljs-number">1.5</span>, <span class="hljs-number">2.5</span>), <span class="hljs-number">4.0</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_subtract</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试减法功能"""</span>
        self.assertEqual(self.calc.subtract(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>), <span class="hljs-number">2</span>)
        self.assertEqual(self.calc.subtract(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>), -<span class="hljs-number">2</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_multiply</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试乘法功能"""</span>
        self.assertEqual(self.calc.multiply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">6</span>)
        self.assertEqual(self.calc.multiply(-<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), -<span class="hljs-number">6</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_divide</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试除法功能"""</span>
        self.assertEqual(self.calc.divide(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>), <span class="hljs-number">2</span>)
        self.assertEqual(self.calc.divide(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>), <span class="hljs-number">2.5</span>)

        <span class="hljs-comment"># 测试除数为零的情况</span>
        <span class="hljs-keyword">with</span> self.assertRaises(ValueError):
            self.calc.divide(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    unittest.main()
</code></pre>
<h5 data-id="heading-93">运行测试用例</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法1：直接运行测试文件</span>
python test_calculator.py

<span class="hljs-comment"># 方法2：使用unittest模块运行</span>
python -m unittest test_calculator.py

<span class="hljs-comment"># 方法3：运行所有测试文件</span>
python -m unittest discover

<span class="hljs-comment"># 方法4：运行特定测试类</span>
python -m unittest test_calculator.TestCalculator

<span class="hljs-comment"># 方法5：运行特定测试方法</span>
python -m unittest test_calculator.TestCalculator.test_add
</code></pre>
<h4 data-id="heading-94">16.3 测试最佳实践</h4>
<ol>
<li>每个测试方法只测试一个功能</li>
<li>测试方法名应清晰描述测试内容</li>
<li>使用 setUp 和 tearDown 方法管理测试资源</li>
<li>测试覆盖正常情况和边界情况</li>
<li>测试应该是独立的，不依赖于其他测试</li>
</ol>
<h3 data-id="heading-95">17. 高阶函数和匿名函数</h3>
<h4 data-id="heading-96">17.1 高阶函数</h4>
<p>高阶函数是指可以接受函数作为参数，或者返回函数的函数。</p>
<h5 data-id="heading-97">常见高阶函数</h5>

























<table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>map(function, iterable)</code></td><td>对可迭代对象的每个元素应用函数</td></tr><tr><td><code>filter(function, iterable)</code></td><td>过滤可迭代对象，返回符合条件的元素</td></tr><tr><td><code>reduce(function, iterable)</code></td><td>对可迭代对象进行累积操作</td></tr><tr><td><code>sorted(iterable, key=None, reverse=False)</code></td><td>排序，可接受函数作为key</td></tr></tbody></table>
<h5 data-id="heading-98">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># map 示例：将列表中的每个元素平方</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
squared = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>, numbers))
<span class="hljs-built_in">print</span>(squared)  <span class="hljs-comment"># 输出: [1, 4, 9, 16, 25]</span>

<span class="hljs-comment"># filter 示例：筛选出偶数</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
evens = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, numbers))
<span class="hljs-built_in">print</span>(evens)  <span class="hljs-comment"># 输出: [2, 4, 6]</span>

<span class="hljs-comment"># sorted 示例：按字符串长度排序</span>
words = [<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"cherry"</span>, <span class="hljs-string">"date"</span>]
sorted_words = <span class="hljs-built_in">sorted</span>(words, key=<span class="hljs-built_in">len</span>)
<span class="hljs-built_in">print</span>(sorted_words)  <span class="hljs-comment"># 输出: ["date", "apple", "cherry", "banana"]</span>

<span class="hljs-comment"># 自定义高阶函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">apply_function</span>(<span class="hljs-params">func, x</span>):
    <span class="hljs-string">"""将函数应用于x"""</span>
    <span class="hljs-keyword">return</span> func(x)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">square</span>(<span class="hljs-params">x</span>):
    <span class="hljs-string">"""计算平方"""</span>
    <span class="hljs-keyword">return</span> x ** <span class="hljs-number">2</span>

result = apply_function(square, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># 输出: 25</span>
</code></pre>
<h4 data-id="heading-99">17.2 匿名函数</h4>
<p>匿名函数是指没有名字的函数，使用 <code>lambda</code> 关键字定义。</p>
<h5 data-id="heading-100">语法</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">lambda</span> 参数: 表达式
</code></pre>
<h5 data-id="heading-101">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本使用</span>
square = <span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>
<span class="hljs-built_in">print</span>(square(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出: 9</span>

<span class="hljs-comment"># 作为高阶函数的参数</span>
doubled = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x * <span class="hljs-number">2</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]))
<span class="hljs-built_in">print</span>(doubled)  <span class="hljs-comment"># 输出: [2, 4, 6]</span>

<span class="hljs-comment"># 多个参数</span>
add = <span class="hljs-keyword">lambda</span> x, y: x + y
<span class="hljs-built_in">print</span>(add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出: 8</span>

<span class="hljs-comment"># 与条件表达式结合</span>
even_or_odd = <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">"偶数"</span> <span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"奇数"</span>
<span class="hljs-built_in">print</span>(even_or_odd(<span class="hljs-number">4</span>))  <span class="hljs-comment"># 输出: 偶数</span>
<span class="hljs-built_in">print</span>(even_or_odd(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出: 奇数</span>
</code></pre>
<h5 data-id="heading-102">注意事项</h5>
<ol>
<li>匿名函数只能包含一个表达式</li>
<li>表达式的结果就是函数的返回值</li>
<li>适合简单的、一次性使用的函数</li>
<li>复杂逻辑建议使用普通函数</li>
</ol>
<h3 data-id="heading-103">18. 装饰器</h3>
<h4 data-id="heading-104">18.1 什么是装饰器</h4>
<p>装饰器是一种特殊的高阶函数，用于修改其他函数的功能，而不改变其代码。</p>
<h4 data-id="heading-105">18.2 装饰器的基本使用</h4>
<h5 data-id="heading-106">简单装饰器示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义装饰器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">my_decorator</span>(<span class="hljs-params">func</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器开始执行"</span>)
        func()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器结束执行"</span>)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 使用装饰器</span>
<span class="hljs-meta">@my_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, World!"</span>)

<span class="hljs-comment"># 调用函数</span>
say_hello()
</code></pre>
<h5 data-id="heading-107">带参数的装饰器</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 带参数的装饰器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">my_decorator</span>(<span class="hljs-params">func</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器开始执行"</span>)
        result = func(*args, **kwargs)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器结束执行"</span>)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@my_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

result = add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h5 data-id="heading-108">装饰器的应用场景</h5>
<ol>
<li>日志记录</li>
<li>性能测试</li>
<li>权限验证</li>
<li>缓存</li>
<li>事务处理</li>
</ol>
<h3 data-id="heading-109">总结</h3>
<p>本指南涵盖了 Python 编程的核心知识点，包括：</p>
<ul>
<li><strong>基础数据类型</strong>：整数、字符串、浮点数、布尔值、空值等</li>
<li><strong>数据结构</strong>：列表、元组、字典等</li>
<li><strong>控制流</strong>：条件判断（if-elif-else）、循环结构（for、while）</li>
<li><strong>函数</strong>：定义与调用、参数传递、作用域、闭包</li>
<li><strong>面向对象编程</strong>：类定义、属性与方法、继承、多态</li>
<li><strong>文件操作</strong>：路径、读取、写入、关闭</li>
<li><strong>异常处理</strong>：try-except-else-finally、断言</li>
<li><strong>单元测试</strong>：unittest框架的使用</li>
<li><strong>高级特性</strong>：高阶函数、匿名函数、装饰器</li>
</ul>
<p>学习 Python 最好的方法是多写代码，多实践。</p>
<h4 data-id="heading-110">学习建议</h4>
<ol>
<li><strong>基础先行</strong>：先掌握基础语法和核心概念</li>
<li><strong>多写代码</strong>：理论结合实践，编写小项目</li>
<li><strong>阅读源码</strong>：学习优秀的开源项目</li>
<li><strong>参与社区</strong>：加入 Python 社区，向他人学习</li>
<li><strong>持续学习</strong>：Python 生态不断发展，保持学习习惯</li>
</ol>
<p>祝您学习愉快！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS-Grid 网格布局全攻略（从基础到进阶）]]></title>    <link>https://juejin.cn/post/7599640782570422299</link>    <guid>https://juejin.cn/post/7599640782570422299</guid>    <pubDate>2026-01-27T07:28:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782570422299" data-draft-id="7599604510365843494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS-Grid 网格布局全攻略（从基础到进阶）"/> <meta itemprop="keywords" content="前端,面试,CSS"/> <meta itemprop="datePublished" content="2026-01-27T07:28:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS-Grid 网格布局全攻略（从基础到进阶）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:28:55.000Z" title="Tue Jan 27 2026 07:28:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>如果说 Flex 布局是一维的“线性布局”，那么 <strong>Grid（网格布局）</strong> 就是真正意义上的“二维布局”。它能够同时处理行与列，让我们通过简单的代码就能实现极其复杂的页面结构。</p>
<h2 data-id="heading-1">一、 Grid 容器属性：定义你的网格空间</h2>
<h3 data-id="heading-2">1. 开启网格布局</h3>
<ul>
<li><strong><code>display: grid;</code></strong> ：容器里面的元素为块级元素。</li>
<li><strong><code>display: inline-grid;</code></strong> ：容器里面的元素为行内元素。</li>
</ul>
<h3 data-id="heading-3">2. 定义行与列 (<code>grid-template-*</code>)</h3>
<p>通过 <code>grid-template-columns</code> 和 <code>grid-template-rows</code> 划分网格。</p>
<ul>
<li>
<p><strong>常用关键字：</strong></p>
<ul>
<li><strong><code>repeat(count, value)</code></strong> ：重复定义。例如 <code>repeat(3, 1fr)</code> 表示三列均分。</li>
<li><strong><code>auto-fill</code></strong>：自动填充。让每一行/列尽可能容纳更多固定宽度的单元格。</li>
<li><strong><code>fr</code> (Fraction)</strong> ：片段单位。表示网格剩余空间的比例关系。</li>
<li><strong><code>minmax(min, max)</code></strong> ：长度范围。例如 <code>minmax(100px, 1fr)</code>。</li>
<li><strong><code>auto</code></strong>：自适应，占满剩余宽度。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>注意</strong>：不要单独使用grid-template-rows，单独使用grid布局可能会造成布局混乱，不可预测。</p>
</blockquote>
<ul>
<li><strong>使用实例</strong>：当网格单元格数量大于子元素数量时，多余单元格会保持空白，子元素不会因此被拉伸放大。
例如：定义一个 3列×4行 的网格，但只放入9个元素，剩余3个单元格会留空，而现有元素仍保持正常的网格比例尺寸</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
    }
    <span class="hljs-selector-class">.div</span> {
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a33c10075db24b0bb0e1c7c7f1002088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=zIaJAZd%2FSyjM0%2FTANgoMBFVB1n4%3D" alt="image.png" width="45%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01586539ac484970b6813d7d97f8121f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=0RTzyIPHIKkR8n02Blbj2l93wos%3D" alt="image.png" width="45%" loading="lazy"/>
<h3 data-id="heading-4">3. 间距 (Gap)</h3>
<blockquote>
<p><strong>注意</strong>：最新标准中已建议移除 <code>grid-</code> 前缀，直接使用 <code>gap</code>。</p>
</blockquote>
<ul>
<li><strong><code>row-gap</code></strong>：行间距。</li>
<li><strong><code>column-gap</code></strong>：列间距。</li>
<li><strong><code>gap</code></strong>：合写形式（<code>&lt;row-gap&gt; &lt;column-gap&gt;</code>）。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
  <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5dd143066ea483180b8cad5354998c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=3szmQ58BUuridYaCpN6l62yu%2Fqs%3D" alt="image.png" width="30%" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">二、 网格排列与对齐控制</h2>
<h3 data-id="heading-6">1. 单元格内容对齐 (<code>-items</code>)</h3>
<p>控制网格项在<strong>网格表内部</strong>的位置：</p>
<ul>
<li><strong><code>justify-items</code></strong>：网格中每行的水平对齐方式（<code>start | end | center | stretch</code>）。</li>
<li><strong><code>align-items</code></strong>：格中每行的垂直对齐方式。</li>
<li><strong><code>place-items</code></strong>：简写形式。</li>
</ul>
<blockquote>
<p><strong>注意</strong>：当 Grid 子元素的宽高都超过了父容器时，<code>justify-items</code>和 <code>align-items</code>可能会失效或不明显，所以尽量网格容器与子元素宽高可预知场景下使用。</p>
</blockquote>
<p><strong>实例</strong>：例如现在我给每个单元格都设置一个小于网格的宽高，这时就可直观看到它们的区别了 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5e09ed459d14591835bb6535e64da2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=QVY%2FCnQSZRSlTtMQBASdZjTxruQ%3D" alt="image.png" width="45%" loading="lazy"/> <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f11af43e3a3f47b4a024f13e2af93827~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=PInTwC3e7f3Ub1kMHQqYkogeElI%3D" alt="image.png" width="45%" loading="lazy"/></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;

      <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
      justify-items: center;<span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">height</span>:<span class="hljs-number">30px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n + <span class="hljs-number">1</span>) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid green;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h3 data-id="heading-7">2. 整个网格内容区域对齐 (<code>-content</code>)</h3>
<p>在实际使用中，存在着网格内容区域大小和网格容器大小不一致的情况，而-content则是设置网格内容区域相对于容器的对齐方式。</p>
<ul>
<li><strong><code>justify-content</code></strong>：网格内容区域在水平位置相当于容器的对齐方式（<code>space-between | space-around | space-evenly | strat | end | center |stretch(大小没有指定时，拉伸占据整个网格容器)</code>）。</li>
<li><strong><code>align-content</code></strong>：网格内容区域在垂直方向相对于容器的对齐方式。</li>
<li><strong><code>place-content</code></strong>：简写形式。</li>
</ul>
<p>在上面的例子中，可以发现添加justify-content与align-content是无效的，因为网格内容区域总尺寸 = 容器尺寸，现在将网格中子项设置较大值与较小值，你就会发现区别：图左为网格内容区域总尺寸 &gt; 容器尺寸,图右边为网格内容区域总尺寸 &lt; 容器尺寸。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cc82aa8265a453880b1d44cfc58ab11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=wOePGK1IeVX1wofYw%2B77gIqBQyI%3D" alt="image.png" width="45%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02a4e3d6d03848f5aa35ad8454b58013~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=nKJdgxNI2gOYd5%2FAeOPOc8HqZXI%3D" alt="image.png" width="45%" loading="lazy"/>
<pre><code class="hljs language-css" lang="css"> <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
  }
<span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">200px</span>); <span class="hljs-comment">/*  repeat(3, 100px) */</span>
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">350px</span>);   <span class="hljs-comment">/*repeat(4, 150px); */</span>
  <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;

  <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
  justify-items: center;<span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>


  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/*网格内容区域在水平位置相当于容器的对齐方式*/</span>
  <span class="hljs-attribute">align-content</span>: center;  <span class="hljs-comment">/*网格内容区域在垂直方向相当于容器的对齐方式*/</span>
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
}
</code></pre>
<h3 data-id="heading-8">3. 排列顺序 (<code>grid-auto-flow</code>)</h3>
<p>决定网格项如何自动填充到网格中。</p>
<ul>
<li><strong><code>row</code></strong>（默认）：先行后列。</li>
<li><strong><code>column</code></strong>：先列后行。</li>
</ul>
<hr/>
<hr/>
<h2 data-id="heading-9">三、 项目属性：单个格子的自我修养</h2>
<h3 data-id="heading-10">1. 基于网格线的定位</h3>
<p>可以通过指定网格线来决定一个项目跨越多少行或列。</p>
<ul>
<li><strong><code>grid-column-start / end</code></strong>：元素左边框所在的垂直网格线/右边框所在的垂直网格线。</li>
<li><strong><code>grid-row-start / end</code></strong>：元素上边框所在的水平网格线/下边框所在的水平网格线。</li>
<li><strong><code>span</code> 关键字</strong>：表示跨越的跨度。例如 <code>grid-column: span 2;</code>（跨越两列）。</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b871d1e3c53b43acb93e4d7a234e60a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=R%2F5J3osIHwL2%2BgKgsnlfl6C88GY%3D" alt="image.png" width="50%" loading="lazy"/></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*  repeat(3, 100px) */</span>
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*repeat(4, 150px); */</span>
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-comment">/* grid-auto-flow: column; */</span>
      <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
      justify-items: center; <span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>

      <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/*网格内容区域在水平位置相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">align-content</span>: center; <span class="hljs-comment">/*网格内容区域在垂直方向相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n + <span class="hljs-number">1</span>) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid green;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:last-child</span>{
      <span class="hljs-attribute">background</span>: red;
      <span class="hljs-attribute">grid-column-start</span>:<span class="hljs-number">2</span>;
      <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">4</span>;
      <span class="hljs-attribute">grid-row-start</span>: <span class="hljs-number">3</span>;
      <span class="hljs-attribute">grid-row-end</span>: <span class="hljs-number">5</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h3 data-id="heading-11">2. 单个项目的对齐 (<code>-self</code>)</h3>
<p>适用于网格内的的子元素，它会覆盖容器定义的 <code>items</code> 属性：</p>
<ul>
<li><strong><code>justify-self</code></strong> ：置单元格内容的水平位置（左中右），跟<code>justify-items</code>属性的用法完全一致，但只作用于单个项目。取值：<code>start | end | center | stretch（拉伸）</code></li>
<li><strong><code>align-self</code></strong>：设置单元格内容的垂直位置（上中下）</li>
<li><strong><code>place-self</code></strong>：是<code>align-self</code>属性和<code>justify-self</code>属性的合并简写形式</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fed0c15cd154cb6a53cb6b644476145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=OOAU1%2BWmiNUefzF%2F7oKe7pfKKY0%3D" alt="image.png" width="45%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/486e24680c1c4f41b033b99738076a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=YKKLQx8ldymzrZWAMGkYYB24c5o%3D" alt="image.png" width="45%" loading="lazy"/>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*  repeat(3, 100px) */</span>
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*repeat(4, 150px); */</span>
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-comment">/* grid-auto-flow: column; */</span>
      <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
      justify-items: center; <span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>
      justify-self: start;
      <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/*网格内容区域在水平位置相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">align-content</span>: center; <span class="hljs-comment">/*网格内容区域在垂直方向相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
    }
    <span class="hljs-selector-class">.div</span>{
      justify-self: end; 
      <span class="hljs-attribute">align-self</span>: end;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n + <span class="hljs-number">1</span>) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid green;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:last-child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">background</span>: red;
      <span class="hljs-attribute">grid-column-start</span>:<span class="hljs-number">2</span>;
      <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">4</span>;
      <span class="hljs-attribute">grid-row-start</span>: <span class="hljs-number">3</span>;
      <span class="hljs-attribute">grid-row-end</span>: <span class="hljs-number">5</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[中心化 Agent 和 非中心化 Agent 的实现区别]]></title>    <link>https://juejin.cn/post/7599572091076247594</link>    <guid>https://juejin.cn/post/7599572091076247594</guid>    <pubDate>2026-01-27T07:52:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599572091076247594" data-draft-id="7599591405314097193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="中心化 Agent 和 非中心化 Agent 的实现区别"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T07:52:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="twl"/> <meta itemprop="url" content="https://juejin.cn/user/3016715635534029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            中心化 Agent 和 非中心化 Agent 的实现区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715635534029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    twl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:52:04.000Z" title="Tue Jan 27 2026 07:52:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天开会有一个问题引起我的思考：有同事说可以在Cursor执行自定义的Agent。梳理了下问题让ChatGPT回答。</p>
<p>想用 <strong>langchain.js 自己写 agent</strong>，但 <strong>Cursor 订阅用户没有单独的 OpenAI/Anthropic API key</strong>，所以没法让他们“自带 key”来跑——这时基本结论是：</p>
<p><strong>Cursor 的订阅配额/“token”通常不能被第三方代码（比如 langchain.js）当作 API key 直接调用模型来消耗。</strong><br/>
Cursor 订阅更像是“Cursor 客户端内部可用的推理权限”，不是一个通用的开发者 API 凭证。</p>
<p>所以如果你坚持“自己写 agent + 让用户不用 API key”，常见可行路线只有下面几种（各有 trade-off）：</p>
<hr/>
<h3 data-id="heading-0">1) 把你的 agent 做成“Cursor 内置 Agent 的工作流/脚本”，而不是自己去调模型</h3>
<p><strong>核心</strong>：让 Cursor 自己负责调用模型（消耗 Cursor 订阅），你的代码只负责：</p>
<ul>
<li>提供 prompt/规则/任务分解模板</li>
<li>提供工具（本地命令、文件操作、你的 HTTP 工具接口）</li>
<li>提供执行脚本（不包含 LLM 调用）</li>
</ul>
<p>这样用户不需要 API key，你也不需要中心化 token。<br/>
代价是：你不能用 langchain.js 自己掌控 “LLM loop”，而是把 loop 交给 Cursor 的 agent。</p>
<blockquote>
<p>实操上就是：你交付一个 repo + 一套 Cursor instructions / command palette 入口，让 Cursor agent 按你的流程跑。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">2) 中心化提供模型（你付 token）→ 然后对用户收费/限额</h3>
<p>这是最常见、也是最“langchain 原汁原味”的方式：你的 agent 服务端持有模型 key。</p>
<ul>
<li>✅ 体验最好：用户零配置</li>
<li>❌ 你承担 token 成本（除非你把成本转嫁到订阅/按量计费）</li>
<li>✅ 最可控：可做审计、缓存、路由、多模型</li>
</ul>
<p>如果你主要目标是商业化而不是“把 token 推给用户”，这一条反而是正解。</p>
<hr/>
<h3 data-id="heading-2">3) 让用户用“免费/本地模型”当作无 key 的替代</h3>
<p>如果用户没有 API key，你还可以让他们：</p>
<ul>
<li>用 Ollama / LM Studio（本地推理）</li>
<li>或用某些提供“免 key/客户端可用”的模型渠道（通常不稳定/不建议依赖）</li>
</ul>
<p>这能做到“非中心化”，但模型质量、速度、平台兼容性差异会很大。</p>
<hr/>
<h3 data-id="heading-3">4) 企业场景：让用户用公司统一 SSO 的模型网关（不是 Cursor 订阅）</h3>
<p>如果你们公司有内部 LLM gateway（SSO、按用户计费/配额），可以做到：</p>
<ul>
<li>用户不用自己拿 API key（他们用公司身份登录）</li>
<li>token 成本按用户/部门计量，而不是你单独承担</li>
<li>对接方式：OAuth / JWT / company gateway</li>
</ul>
<p>这不是“消耗 Cursor token”，但能达到“非你中心化 token”的成本归属。</p>
<hr/>
<h2 data-id="heading-4">结论：<strong>想“自己写 langchain agent + 不要用户 API key + 消耗 Cursor 订阅 token”基本做不到</strong></h2>
<p>因为 Cursor 订阅不是可外部调用的通用 API。你要么：</p>
<ul>
<li><strong>接受 loop 在 Cursor 内跑</strong>（方案 1），你的代码只做工具与模板；或</li>
<li><strong>你中心化托管模型</strong>（方案 2）；或</li>
<li><strong>走本地/企业网关</strong>（方案 3/4）。</li>
</ul>
<hr/>
<h3 data-id="heading-5">给你一个推荐组合（实用且接近你目标）</h3>
<p><strong>“Cursor 负责推理 + 你的工具服务”</strong> ：</p>
<ul>
<li>你写：工具服务（HTTP endpoints）+ 一套 prompt/instructions + 项目模板</li>
<li>Cursor 用户：用 Cursor agent 来规划、调用工具、改代码</li>
<li>成本：模型 token 由 Cursor 订阅承担；你只承担工具成本（可限流/收费）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 echarts + react 实现上下交错正负轴柱状图]]></title>    <link>https://juejin.cn/post/7599765329410162728</link>    <guid>https://juejin.cn/post/7599765329410162728</guid>    <pubDate>2026-01-27T07:53:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599765329410162728" data-draft-id="7599845683121782824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 echarts + react 实现上下交错正负轴柱状图"/> <meta itemprop="keywords" content="JavaScript,前端,ECharts"/> <meta itemprop="datePublished" content="2026-01-27T07:53:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小飞机噗噗噗"/> <meta itemprop="url" content="https://juejin.cn/user/3910327822978568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 echarts + react 实现上下交错正负轴柱状图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3910327822978568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小飞机噗噗噗
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:53:05.000Z" title="Tue Jan 27 2026 07:53:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、最终实现效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42395c03d31f4318a03b7a6f1a4289c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=n7fLMYFRlTtWalGy44kJoXlCqzk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2、实现难点</h2>
<h3 data-id="heading-2">方法一</h3>
<p>在echarts配置里没有像上面一样上下交错试例，最像的一个是左右交错的，如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5061adeba79472f88fca659e7a01cad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=Wg3xJrDKhy%2FqMchwJ9zAdatt6Do%3D" alt="image.png" loading="lazy"/>
链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fecharts.apache.org%2Fexamples%2Fzh%2Feditor.html%3Fc%3Dbar-negative2" target="_blank" title="https://echarts.apache.org/examples/zh/editor.html?c=bar-negative2" ref="nofollow noopener noreferrer">echarts.apache.org/examples/zh…</a></p>
<p>第一个想到的方法就是在这个基础上将柱状图旋转90度，但是不能解决一条柱形需要显示2个文案，而且所有文案也要跟着旋转90度，因此不太可取。</p>
<h3 data-id="heading-3">方法二：</h3>
<p>用正常的柱状图配置方法，因为柱状图本身是支持上下正负值的，唯一的问题就是，配置里只会让底部的线居中，而底部的文字是只能底部和顶部显示的，因此也不可取。如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1305d35ede694f1a92ed98799a3771ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=ySvtOB4uW4k2B5pi%2BztVOLUi00g%3D" alt="企业微信截图_a645b6e2-e2f2-4a12-85c1-96e7ae94c0db.png" loading="lazy"/></p>
<h2 data-id="heading-4">3、最终实现方法</h2>
<p>echarts柱状图的柱子是可以由两个柱子叠加拼接起来了的，那让半个柱子显示正负值，半个柱子显示底部文案值，然后根据正负一上一下显示，最后去掉底部的x轴文案。<br/>
类似如下图叠加柱子：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0745ebf1428c4471bc43edc95e2479b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=gtMB1%2BOK0BRszwbsAaoYwLR7ZG0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">4、实现代码</h2>
<pre><code class="hljs language-css" lang="css">      const dataX = <span class="hljs-selector-attr">[<span class="hljs-string">'超过30天'</span>, <span class="hljs-string">'超过90天'</span>, <span class="hljs-string">'超过半年'</span>, <span class="hljs-string">'超过1年'</span>]</span>;
      const dataY = <span class="hljs-selector-attr">[-2.8, 16.42, -24.6, 20.21]</span>;
      const options = {
      tooltip: { show: false },
      xAxis: {
        type: <span class="hljs-string">'category'</span>,
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false },
        axisLine: {
          show: true,
          lineStyle: {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">1</span>,
            color: <span class="hljs-string">'#E3E3E3'</span>
          }
        }
      },
      // Y 轴配置
      yAxis: {
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false },
        type: <span class="hljs-string">'value'</span>
      },
      // 系列数据
      series: [
        {
          name: <span class="hljs-string">'占比'</span>,
          type: <span class="hljs-string">'bar'</span>,
          stack: <span class="hljs-string">'a'</span>,
          label: {
            show: true,
            formatter: params =&gt; dataX[params.dataIndex]
          },
          data: <span class="hljs-built_in">funcDataLabel</span>(dataY, false),
          barWidth: <span class="hljs-string">'30%'</span>
        },
        {
          name: <span class="hljs-string">'占比'</span>,
          type: <span class="hljs-string">'bar'</span>,
          stack: <span class="hljs-string">'a'</span>,
          label: {
            show: true
          },
          data: <span class="hljs-built_in">funcDataLabel</span>(dataY, true),
          barWidth: <span class="hljs-string">'30%'</span>
        }
      ]
    };

// 图数据格式化
  const funcDataLabel = (data, isTop) =&gt; {
    const charge = value =&gt; {
      if (isTop) {
        return value &gt; <span class="hljs-number">0</span> ? '<span class="hljs-attribute">top</span>' : <span class="hljs-string">'bottom'</span>;
      } else {
        return value &gt; <span class="hljs-number">0</span> ? '<span class="hljs-attribute">bottom</span>' : <span class="hljs-string">'top'</span>;
      }
    };
    return data<span class="hljs-selector-class">.map</span>(item =&gt; {
      return {
        value: item,
        label: {
          <span class="hljs-attribute">normal</span>: {
            <span class="hljs-attribute">position</span>: <span class="hljs-built_in">charge</span>(item)
          }
        },
        // 柱子颜色区分正负
        itemStyle: {
          <span class="hljs-attribute">color</span>: item &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'#E84225'</span> : <span class="hljs-string">'#19A740'</span>
        }
      };
    });
  };
</code></pre>
<h2 data-id="heading-6">总结：</h2>
<p>echarts配置还是比较复杂的，参数非常多，但是可以多参考示例给到一些启发，或者直接使用实例上进行二次开发会更加容易和上手一些</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IntelliJ IDEA 的「闪电操作」：这些 Quick 技巧让你编码快如疾风]]></title>    <link>https://juejin.cn/post/7599798118460751881</link>    <guid>https://juejin.cn/post/7599798118460751881</guid>    <pubDate>2026-01-27T08:22:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599798118460751881" data-draft-id="7599708108620824627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IntelliJ IDEA 的「闪电操作」：这些 Quick 技巧让你编码快如疾风"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:22:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大黄评测"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IntelliJ IDEA 的「闪电操作」：这些 Quick 技巧让你编码快如疾风
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大黄评测
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:22:17.000Z" title="Tue Jan 27 2026 08:22:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代软件开发中，效率就是生产力。而 JetBrains 家的 IntelliJ IDEA 之所以广受开发者喜爱，不仅因为其强大的智能提示和深度代码理解能力，更因为它内置了大量“Quick”类快捷操作——这些功能往往只需一两个快捷键，就能完成原本繁琐的手动操作，真正实现“快如闪电”。</p>
<p>下面，就带你盘点几个最实用、最高效的 IntelliJ IDEA “Quick”技巧，助你提升编码速度与流畅度。</p>
<hr/>
<h2 data-id="heading-0">1. <strong>Quick Fix（快速修复）— Alt + Enter（Windows/Linux）或 ⌥ + Enter（macOS）</strong></h2>
<p>这是 IDEA 最核心的“Quick”功能之一。当你代码出现警告、错误，甚至只是有优化建议时，按下 <code>Alt + Enter</code>，IDEA 会立刻弹出上下文相关的修复建议。</p>
<ul>
<li>自动导入缺失类</li>
<li>生成 getter/setter、构造函数、toString()</li>
<li>将 lambda 表达式转换为匿名类（或反之）</li>
<li>快速创建测试类</li>
<li>修复拼写错误或未使用的变量</li>
</ul>
<blockquote>
<p>小贴士：即使没有错误，光标放在任意代码上按 <code>Alt + Enter</code>，也常有意想不到的重构建议！</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. <strong>Quick Documentation（快速文档）— Ctrl + Q（Windows/Linux）或 F1（macOS）</strong></h2>
<p>想快速查看某个方法、类或字段的文档？无需跳转到源码或打开浏览器，直接使用 Quick Documentation。</p>
<ul>
<li>显示 Javadoc、参数说明、返回值类型</li>
<li>支持 Markdown 渲染（如 Spring 注解说明）</li>
<li>可固定窗口，边看边写</li>
</ul>
<blockquote>
<p>搭配 <code>Ctrl + 鼠光标悬停</code> 使用效果更佳！</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">3. <strong>Quick Evaluate Expression（快速表达式求值）— Alt + F8</strong></h2>
<p>调试时想知道某个变量的值？或者想临时计算一个表达式（比如 <code>list.size() &gt; 5</code>）？不用加断点再重启，直接在调试过程中选中表达式，按 <code>Alt + F8</code>，IDEA 会立即计算并显示结果。</p>
<ul>
<li>支持复杂表达式</li>
<li>不影响程序运行状态</li>
<li>比手动加日志快十倍</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. <strong>Quick Switch Scheme（快速切换配色/快捷键方案）— Ctrl + `（反引号）</strong></h2>
<p>团队协作时，可能需要临时切换主题、快捷键映射或代码风格？用 <code>Ctrl + ``（反引号）</code> 打开 Quick Switch 菜单，一键切换：</p>
<ul>
<li>Color Scheme（配色方案）</li>
<li>Keymap（快捷键布局）</li>
<li>Look and Feel（UI 主题）</li>
<li>Code Style（代码格式）</li>
</ul>
<p>特别适合在演示、结对编程或接手他人项目时快速适应环境。</p>
<hr/>
<h2 data-id="heading-4">5. <strong>Quick JavaDoc / Quick Definition（快速查看定义）— Ctrl + Shift + I</strong></h2>
<p>想看一个方法的实现但又不想跳转页面？<code>Ctrl + Shift + I</code>（Windows/Linux）可内联预览方法或类的定义，悬浮窗口显示源码片段，按 <code>Esc</code> 即可关闭，不打断当前编辑流。</p>
<hr/>
<h2 data-id="heading-5">6. <strong>Live Templates + Postfix Completion（虽非“Quick”命名，但本质是快速输入）</strong></h2>
<p>虽然名字里没带“Quick”，但它们是真正的“快速编码神器”：</p>
<ul>
<li>输入 <code>sout</code> + Tab → 自动生成 <code>System.out.println();</code></li>
<li>输入 <code>fori</code> + Tab → 快速生成 for 循环</li>
<li>使用 <code>.var</code>、<code>.notnull</code> 等后缀自动包裹表达式</li>
</ul>
<p>这些模板可自定义，极大减少重复敲键。</p>
<hr/>
<h2 data-id="heading-6">结语：让“Quick”成为你的肌肉记忆</h2>
<p>IntelliJ IDEA 的“Quick”系列功能，本质上是把开发者高频操作封装成一键可达的智能助手。熟练掌握这些技巧，不仅能减少鼠标依赖，更能让你进入“心流编码”状态——思路不中断，手指不停歇。</p>
<p>下次写代码时，不妨试试少点几次鼠标，多按几下 <code>Alt + Enter</code> —— 你会发现，真正的“快”，不是打字速度，而是思维与工具的无缝协同。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 分钟上手 HarmonyOS Skill：快速集成语音与意图交互能力]]></title>    <link>https://juejin.cn/post/7599708108620841011</link>    <guid>https://juejin.cn/post/7599708108620841011</guid>    <pubDate>2026-01-27T08:24:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599708108620841011" data-draft-id="7599614131424378889" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 分钟上手 HarmonyOS Skill：快速集成语音与意图交互能力"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:24:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大尚来也"/> <meta itemprop="url" content="https://juejin.cn/user/1681597639955488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 分钟上手 HarmonyOS Skill：快速集成语音与意图交互能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1681597639955488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大尚来也
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:24:03.000Z" title="Tue Jan 27 2026 08:24:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在鸿蒙生态（HarmonyOS）中，<strong>Skill</strong> 是实现智能语音助手、意图识别和跨设备服务调用的核心机制之一。通过 Skill，你的应用可以被小艺（Celia）语音唤醒、响应用户自然语言指令，甚至与其他设备上的服务无缝协作。</p>
<p>本文将用 <strong>5 分钟时间</strong>，带你快速理解 Skill 的基本概念，并演示如何在 HarmonyOS 应用中注册并使用一个简单的自定义 Skill。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 HarmonyOS Skill？</h2>
<p>Skill 是 HarmonyOS 提供的一种<strong>服务能力单元</strong>，用于描述“我能做什么”。它基于 <strong>意图（Intent）</strong> 模型，将用户语音或文本指令映射到具体的功能逻辑。</p>
<p>例如：</p>
<ul>
<li>用户说：“打开天气应用查看北京天气”</li>
<li>系统识别出意图 <code>VIEW_WEATHER</code>，并携带参数 <code>{city: "北京"}</code></li>
<li>你的应用通过注册对应 Skill 响应该意图，启动页面并展示数据</li>
</ul>
<blockquote>
<p>💡 Skill 类似于 Android 的 App Actions 或 iOS 的 Siri Shortcuts，但深度集成于鸿蒙分布式架构。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、5 分钟实战：创建一个“打招呼”Skill</h2>
<p>我们将创建一个简单 Skill：当用户对小艺说“让 MyApp 打个招呼”，应用弹出“Hello, HarmonyOS!”。</p>
<h3 data-id="heading-2">步骤 1：配置 <code>config.json</code></h3>
<p>在 <code>module.json5</code>（或旧版 <code>config.json</code>）中注册 Skill：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.myapp.GreetSkill"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"voice"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"响应打招呼指令"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"greet_user"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"entities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MainAbility"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/entryability/EntryAbility.ets"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"greet_user"</span><span class="hljs-punctuation">]</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>✅ 注意：<code>skills</code> 定义能力，<code>abilities</code> 中的 <code>skills</code> 字段将其绑定到具体 Ability。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">步骤 2：在 Ability 中处理 Skill 调用</h3>
<p>在 <code>EntryAbility.ets</code> 中重写 <code>onNewWant</code> 方法（用于接收外部拉起）：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> <span class="hljs-type">UIAbility</span> from '<span class="hljs-meta">@ohos</span>.app.ability.<span class="hljs-type">UIAbility</span>';

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UIAbility</span> </span>{
  onNewWant(want) {
    <span class="hljs-comment">// 检查是否由 Skill 触发</span>
    <span class="hljs-keyword">if</span> (want.action === 'greet_user') {
      <span class="hljs-comment">// 可在此启动特定页面或执行逻辑</span>
      console.log('收到打招呼指令！');
      
      <span class="hljs-comment">// 示例：弹出提示（需在 UI 线程）</span>
      <span class="hljs-comment">// 此处简化，实际应在页面中通过 ArkTS 显示</span>
    }
  }
}
</code></pre>
<blockquote>
<p>🔔 提示：若需跳转到具体页面，可在 <code>onNewWant</code> 中调用 <code>this.context.startAbility()</code> 启动目标页面，并传递参数。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">步骤 3：（可选）配置语音触发语料</h3>
<p>为了让小艺识别“让 MyApp 打个招呼”，需在 <strong>华为开发者联盟后台</strong> 提交语音模板（目前部分能力需审核）：</p>
<ul>
<li>
<p>意图名称：<code>greet_user</code></p>
</li>
<li>
<p>示例语句：</p>
<ul>
<li>“让 MyApp 打个招呼”</li>
<li>“叫 MyApp 问好”</li>
</ul>
</li>
</ul>
<blockquote>
<p>🌐 注：本地调试可使用 <strong>DevEco Studio 的模拟器 + Intent 模拟工具</strong> 测试，无需真实语音。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、调试技巧</h2>
<ol>
<li><strong>使用 DevEco Studio 的“Intent 模拟器”</strong><br/>
在运行配置中选择 “Edit Configurations” → 添加 “Intent” 启动方式，填入 <code>action: greet_user</code> 即可模拟 Skill 调用。</li>
<li><strong>查看日志</strong><br/>
通过 <code>hdc shell</code> 或 DevEco Log 工具观察 <code>onNewWant</code> 是否被触发。</li>
<li><strong>权限声明</strong><br/>
若涉及敏感操作，需在 <code>module.json5</code> 中声明相应权限（如 <code>ohos.permission.INTERNET</code>）。</li>
</ol>
<hr/>
<h2 data-id="heading-6">四、进阶方向</h2>
<ul>
<li>使用 <strong>Entity</strong> 传递参数（如城市名、时间等）</li>
<li>实现 <strong>Service Ability</strong> 响应后台 Skill 请求</li>
<li>结合 <strong>元服务（Meta Service）</strong> 实现免安装卡片式交互</li>
<li>接入 <strong>小艺开放平台</strong>，支持更多自然语言表达</li>
</ul>
<hr/>
<h2 data-id="heading-7">结语</h2>
<p>Skill 是 HarmonyOS 构建智能、主动、跨端服务的关键入口。虽然本文仅展示了最基础的用法，但已为你打开了通往“语音驱动应用”的大门。只需 5 分钟配置，你的应用就能听懂用户说话！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“搬家”说起：彻底搞懂 JavaScript 的赋值、引用与深浅拷贝]]></title>    <link>https://juejin.cn/post/7599708108620890163</link>    <guid>https://juejin.cn/post/7599708108620890163</guid>    <pubDate>2026-01-27T08:25:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599708108620890163" data-draft-id="7599708108620873779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“搬家”说起：彻底搞懂 JavaScript 的赋值、引用与深浅拷贝"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:25:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大鹏1988"/> <meta itemprop="url" content="https://juejin.cn/user/2526022571922992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“搬家”说起：彻底搞懂 JavaScript 的赋值、引用与深浅拷贝
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2526022571922992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大鹏1988
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:25:16.000Z" title="Tue Jan 27 2026 08:25:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你有没有经历过搬家？<br/>
箱子打包、家具搬运、钥匙交接……看似简单，但稍不注意，就可能把“原屋”的东西弄丢，或者在新家发现“复制”的只是个空壳。</p>
<p>有趣的是，JavaScript 中的<strong>赋值操作</strong>，就像一场“数据搬家”。而很多人踩过的坑——比如改了新变量，原对象却也变了——其实都源于没搞清楚：<strong>JavaScript 到底是在“搬东西”，还是在“给地址”？</strong></p>
<p>今天，我们就用“搬家”这个故事，彻底理清 JavaScript 的赋值操作符（<code>=</code>）背后的真相。</p>
<hr/>
<h2 data-id="heading-0">一、基本类型：真·打包搬家（值传递）</h2>
<p>假设你有一本实体书《JavaScript 忍者秘籍》，要搬到新家。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">book1</span> = <span class="hljs-string">"JavaScript 忍者秘籍"</span><span class="hljs-comment">;</span>
let <span class="hljs-attr">book2</span> = book1<span class="hljs-comment">;</span>

<span class="hljs-attr">book2</span> = <span class="hljs-string">"TypeScript 入门指南"</span><span class="hljs-comment">;</span>
console.log(book1)<span class="hljs-comment">; // "JavaScript 忍者秘籍"</span>
</code></pre>
<p>✅ <strong>发生了什么？</strong><br/>
<code>book1</code> 是一个字符串（基本类型）。当你执行 <code>book2 = book1</code>，JavaScript <strong>真的复印了一本新书</strong>交给 <code>book2</code>。之后你把 <code>book2</code> 换成别的书，完全不影响 <code>book1</code>。</p>
<blockquote>
<p>📦 <strong>基本类型（Number, String, Boolean, null, undefined, Symbol, BigInt）</strong> ：赋值时<strong>复制值本身</strong>，互不干扰。</p>
</blockquote>
<p>这就像搬家时，你把书装箱带走——原房东家不留副本，新家拿到的是独立实体。</p>
<hr/>
<h2 data-id="heading-1">二、引用类型：只给了“新家地址”（引用传递）</h2>
<p>现在，你有一台智能冰箱，里面存着牛奶、鸡蛋、蔬菜。搬家时，你不会把冰箱拆了运过去，而是告诉搬家公司：“新地址是 A 栋 101”。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fridge1</span> = { milk: <span class="hljs-number">2</span>, eggs: <span class="hljs-number">12</span> }<span class="hljs-comment">;</span>
let <span class="hljs-attr">fridge2</span> = fridge1<span class="hljs-comment">;</span>

<span class="hljs-attr">fridge2.milk</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
console.log(fridge1.milk)<span class="hljs-comment">; // 0！😱</span>
</code></pre>
<p>❌ <strong>问题来了</strong>：为什么改了 <code>fridge2</code>，<code>fridge1</code> 也变了？</p>
<p>🔑 <strong>真相</strong>：<br/>
<code>fridge1</code> 存的不是冰箱本身，而是<strong>冰箱的地址（引用）</strong> 。<code>fridge2 = fridge1</code> 只是<strong>复制了这个地址</strong>，两个变量指向同一个物理冰箱！</p>
<blockquote>
<p>🏠 <strong>引用类型（Object, Array, Function 等）</strong> ：赋值时<strong>复制的是内存地址</strong>，多个变量共享同一块数据。</p>
</blockquote>
<p>这就像你和朋友都拿着同一栋房子的钥匙——谁进去拿走牛奶，冰箱都会变空。</p>
<hr/>
<h2 data-id="heading-2">三、“搬家”升级：如何真正复制一个冰箱？（深浅拷贝）</h2>
<h3 data-id="heading-3">浅拷贝：只复制第一层（新冰箱，但食材还是共享的？）</h3>
<p>使用 <code>Object.assign()</code> 或展开运算符 <code>...</code>：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fridge1</span> = { milk: <span class="hljs-number">2</span>, eggs: <span class="hljs-number">12</span>, drawer: { butter: <span class="hljs-number">1</span> } }<span class="hljs-comment">;</span>
let <span class="hljs-attr">fridge2</span> = { ...fridge1 }<span class="hljs-comment">;</span>

<span class="hljs-attr">fridge2.milk</span> = <span class="hljs-number">0</span><span class="hljs-comment">;           // OK，不影响 fridge1</span>
<span class="hljs-attr">fridge2.drawer.butter</span> = <span class="hljs-number">0</span><span class="hljs-comment">;  // ❌ fridge1.drawer.butter 也变成 0！</span>
</code></pre>
<p>🔍 <strong>原因</strong>：浅拷贝只复制了顶层属性。<code>drawer</code> 仍然是一个<strong>引用</strong>，两个冰箱共用同一个抽屉！</p>
<h3 data-id="heading-4">深拷贝：连抽屉里的黄油都重新买一份！</h3>
<p>方法一：<code>JSON.parse(JSON.stringify(obj))</code>（有局限，不支持函数、undefined、Symbol 等）</p>
<p>方法二：使用 Lodash 的 <code>_.cloneDeep()</code> 或自己写递归函数。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fridge2</span> = JSON.parse(JSON.stringify(fridge1))<span class="hljs-comment">;</span>
<span class="hljs-attr">fridge2.drawer.butter</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
console.log(fridge1.drawer.butter)<span class="hljs-comment">; // 1，安全！</span>
</code></pre>
<blockquote>
<p>✅ <strong>深拷贝</strong>：递归复制所有层级，确保新旧对象完全独立——这才是真正的“全新搬家”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">四、赋值操作符 <code>=</code> 的本质总结</h2>




















<table><thead><tr><th>类型</th><th>赋值行为</th><th>类比</th></tr></thead><tbody><tr><td>基本类型</td><td>复制值（独立副本）</td><td>打包带走实体物品</td></tr><tr><td>引用类型</td><td>复制引用（共享同一内存地址）</td><td>只给新地址，东西没动</td></tr></tbody></table>
<blockquote>
<p>💡 记住：<strong><code>=</code> 从不自动深拷贝对象</strong>。它只是“交钥匙”，不是“造新房”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">五、避坑指南：日常开发建议</h2>
<ol>
<li>
<p><strong>不要假设 <code>=</code> 会复制对象</strong> —— 它只是创建新引用。</p>
</li>
<li>
<p><strong>修改前先拷贝</strong>：若需独立操作，务必使用浅/深拷贝。</p>
</li>
<li>
<p><strong>函数参数也是赋值</strong>：传入对象时，函数内部修改会影响外部（因为传的是引用）。</p>
</li>
<li>
<p><strong>const 不代表“不可变”</strong> ：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">obj</span> = { a: <span class="hljs-number">1</span> }<span class="hljs-comment">;</span>
<span class="hljs-attr">obj.a</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // ✅ 合法！const 只防止 obj 重新赋值，不防内容修改</span>
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-7">结语：下次“搬家”，记得问清楚是搬东西，还是只给地址</h2>
<p>JavaScript 的赋值机制，看似简单，却是理解状态管理、React 更新、Redux 不可变性等高级概念的基础。<br/>
通过“搬家”这个比喻，希望你能清晰分辨：<strong>什么时候是独立副本，什么时候是共享引用</strong>。</p>
<p>下次再遇到“改了一个变量，另一个也变了”的 bug，你就知道——<br/>
不是代码出了问题，而是你忘了：<strong>JavaScript 从不帮你搬冰箱，它只给你一把钥匙。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code使用技巧-为Claude Code接入国产大模型]]></title>    <link>https://juejin.cn/post/7599850148055564297</link>    <guid>https://juejin.cn/post/7599850148055564297</guid>    <pubDate>2026-01-27T08:27:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599850148055564297" data-draft-id="7599614131424411657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code使用技巧-为Claude Code接入国产大模型"/> <meta itemprop="keywords" content="人工智能,程序员"/> <meta itemprop="datePublished" content="2026-01-27T08:27:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北鸟南游"/> <meta itemprop="url" content="https://juejin.cn/user/1662117314561255"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code使用技巧-为Claude Code接入国产大模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117314561255/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北鸟南游
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:27:50.000Z" title="Tue Jan 27 2026 08:27:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在AI时代的程序员，越来越离不开AI开发代码工具，目前比较热门的有Claude code、codex、opencode以及智能AI的IDE比如，cursor、trae、<a href="https://link.juejin.cn?target=https%3A%2F%2Fantigravityide.net%2Fzh" target="_blank" title="https://antigravityide.net/zh" ref="nofollow noopener noreferrer">antigravity</a>等其他工具。</p>
<p>使用AI开发工具离不开大模型的接入，AI工具就比如是一辆车的外壳，只有加上大模型发动机才能发挥出巨大的能量。</p>
<p>本文介绍下比较的Claude Code【简称CC】的使用，并且可以接入国产大模型，免费使用大模型。</p>
<h2 data-id="heading-0">安装Claude</h2>
<p>第一步是获取 <a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://claude.com/product/claude-code" ref="nofollow noopener noreferrer">Claude Code</a> 的命令行客户端（CLI）</p>
<h3 data-id="heading-1">环境准备</h3>
<p>在安装之前，请确保你的系统中已经安装了 Node.js 18.0 或更高版本。Claude Code 是基于 Node.js 生态构建的，npm 是其首选的安装工具。你可以在终端中运行以下命令来检查你的 Node.js 版本：</p>
<pre><code class="hljs language-bash" lang="bash">node -v
</code></pre>
<p>如果版本低于 18.0，请先前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn" target="_blank" title="https://nodejs.org/zh-cn" ref="nofollow noopener noreferrer"> Node.js</a> 官网进行升级</p>
<p>或者使用nvm进行升级</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Download and install nvm:</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

<span class="hljs-comment"># in lieu of restarting the shell</span>
\. <span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm/nvm.sh"</span>

<span class="hljs-comment"># Download and install Node.js:</span>
nvm install 22

<span class="hljs-comment"># Verify the Node.js version:</span>
node -v <span class="hljs-comment"># Should print "v22.20.0".</span>

<span class="hljs-comment"># Verify npm version:</span>
npm -v <span class="hljs-comment"># Should print "10.9.3".</span>
</code></pre>
<h3 data-id="heading-2">全局安装 Claude Code</h3>
<p>打卡终端，运行以下命令来全局安装 Claude Code</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p>等一会，安装完成后，可以通过运行以下命令来验证 Claude Code 安装和运行是否成功</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看 claude 的安装位置</span>
<span class="hljs-comment"># which claude</span>
/usr/local/bin/claude

<span class="hljs-comment"># claude --version</span>
2.1.12 (Claude Code)
</code></pre>
<p>看到版本号说明已经安装成功。</p>
<h3 data-id="heading-3">首次运行 Claude Code</h3>
<p>如果你直接运行 claude 命令，你将看到 Claude Code 的“欢迎”页面，如下图所示：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e42f5e0c6e4243158d6d9c29da4b7a80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=Ho%2BUGz1Q%2FdqhgltZGbnn6W%2BLeAY%3D" alt="" loading="lazy"/></p>
<p>可以看到 Claude Code 让你选择终端主题（Terminal Theme），默认是第一个 Dark mode。这里我们可以<strong>直接敲击回车进入下一个页面</strong>（后续如果要重新配置主题时，可以通过 /config 斜杠命令进行）：</p>
<p/>
<p>第二个页面会引导你选择登录方式，</p>
<ul>
<li>Claude Code 支持通过浏览器登录官方 Anthropic 账户，</li>
<li>也可以通过 API 方式与 Claude 大模型进行交互 (通过方向键选择下面的选项“Anthropic Console account”)。</li>
</ul>
<p>不过，这里请先不要进行这一步，因为我们的目标是绕过官方 API，连接到我们自己的“引擎”。</p>
<h2 data-id="heading-4">接入国产大模型</h2>
<h3 data-id="heading-5">连接国产 AI 大模型- 智谱大模型</h3>
<p>首先需要注册智谱 AI 的账户 并创建 API Key</p>
<p>打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.bigmodel.cn%2F" target="_blank" title="https://open.bigmodel.cn/" ref="nofollow noopener noreferrer">智谱</a> 官网，注册并登录你的账户。打卡<a href="https://link.juejin.cn?target=https%3A%2F%2Fbigmodel.cn%2Fusercenter%2Fproj-mgmt%2Fapikeys" target="_blank" title="https://bigmodel.cn/usercenter/proj-mgmt/apikeys" ref="nofollow noopener noreferrer">API keys</a>页面</p>
<p>然后就可以通过环境变量配置 Claude Code 访问智谱大模型 API 的连接地址和身份令牌了。你可以在你的 Shell 配置文件中添加下面两行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> ANTHROPIC_BASE_URL=<span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span>
<span class="hljs-built_in">export</span> ANTHROPIC_AUTH_TOKEN=<span class="hljs-string">"&lt;your_zhipu_api_key&gt;"</span>
</code></pre>
<p>以上是MAC系统配置；windows系统需要在环境变量中进行配置。</p>
<ul>
<li><code>ANTHROPIC_BASE_URL</code>：这是最关键的一行。它告诉 Claude Code 客户端，不要去访问默认的 Anthropic API 地址，而是将所有的网络请求都发送到智谱 AI 的 API 兼容端点。我们在这里实现了“请求重定向”。</li>
<li>ANTHROPIC_AUTH_TOKEN：尽管变量名看起来是“Anthropic”的，但由于我们已经重定向了 BASE_URL，这个 Token 实际上会被发送给智谱 AI 的服务器进行验证。我们在这里实现了“身份凭证替换”。</li>
</ul>
<p>环境变量生效后，我们在本地新建一个项目test重新执行 claude：</p>
<p>可以看到下图</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/561fbd8f115743f886cdd965bc314752~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=IB6T8SPPaB06jQxpy%2BuuYeUevi8%3D" alt="" loading="lazy"/></p>
<p>这次 Claude Code 没有让我们选择 login method，而是直接 login 成功了！敲击回车后，我们看到下一个页面：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d13139778364eec9bd02bb0310c56f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=JlPfawwmUNC78maj9%2FSpq0FUa1w%3D" alt="" loading="lazy"/></p>
<p>询问我是否信任该本地文件夹，敲击回车选择信任后，我们便正式进入 Claude Code 的工作页面：</p>
<p>在输入提示符后面输入 /status 后回车，就可以看到当前 Claude Code 使用的模型的各种最新信息：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb3a6f4ee8344e529542dd188768f805~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=MKsBfSP1QwWABPxsIDKiLWJ9s40%3D" alt="" loading="lazy"/></p>
<p>使用的是 claude-sonnet-4-5-20250929，不过显然这不是真的，背后智谱大模型到底使用什么模型呢?我们可以自行设置;</p>
<h3 data-id="heading-6">设置默认模型</h3>
<p>接下来就设置一下要使用的智谱 AI 的模型。找到并修改 Claude Code 的（分级）配置文件 settings.json。这个文件是 Claude Code 的“大脑中枢”，控制着它的核心行为，包括环境变量、权限、工具行为等;</p>
<p>在我们动手修改 settings.json 之前，你必须先建立一个清晰的认知：Claude Code 的配置并非只有一个文件，而是一个<strong>设计精巧的分层配置体系</strong>。有点类似npm包的层级，项目中的级别最高，也可全局中安装依赖包。</p>
<p>核心思想是，<strong>高层级的配置会覆盖低层级配置中的同名设置</strong>。</p>
<p>这五个层级各自的用途非常明确：</p>
<ul>
<li>企业级策略（managed-settings.json）：由 IT/DevOps 团队统一分发，用于强制执行公司级安全策略，拥有最高优先级，不可被覆盖。</li>
<li>命令行参数（例如–model …）：为单次会话提供的临时覆盖，非常适合快速测试。</li>
<li>项目级个人设置（.claude/settings.local.json）：你个人在此项目的特定偏好（如测试用模型），默认被 Git 忽略，不会与团队共享。</li>
<li>项目级共享设置（.claude/settings.json）：需要团队所有成员共享的项目级规范（如权限规则），应该提交到代码库。</li>
<li>用户级全局设置（~/.claude/settings.json）：存放你个人的、希望在所有项目中都生效的全局配置。这正是我们本次“引擎移植”手术的核心操作区。</li>
</ul>
<p>我们以用户级全局配置 ~/.claude/settings.json 为例，来看看如何设置默认使用的智谱大模型。</p>
<p>这个文件通常位于你用户主目录下的 .claude 文件夹中</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/.claude
<span class="hljs-comment"># 使用你熟悉的编辑器打开，比如VS Code或Vim</span>
<span class="hljs-comment"># 如果文件不存在，这个命令会创建它</span>
<span class="hljs-built_in">touch</span> ~/.claude/settings.json
<span class="hljs-comment"># 或者</span>
<span class="hljs-comment"># vim ~/.claude/settings.json</span>
</code></pre>
<p>打开这个（可能是空的）settings.json 文件，将以下内容完整地复制进去：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"env"</span>: {
    <span class="hljs-string">"ANTHROPIC_DEFAULT_HAIKU_MODEL"</span>: <span class="hljs-string">"glm-4.5-air"</span>,
    <span class="hljs-string">"ANTHROPIC_DEFAULT_SONNET_MODEL"</span>: <span class="hljs-string">"glm-4.6"</span>,
    <span class="hljs-string">"ANTHROPIC_DEFAULT_OPUS_MODEL"</span>: <span class="hljs-string">"glm-4.6"</span>
  }
}
</code></pre>
<p>保存并关闭 settings.json 文件。我们重新运行 Claude Code 并通过 /status 命令查看当前模型信息：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6147f9bb6f7947119f8b11a5452472cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=77DaF%2Fr0iEY2GVBzQ2AfEztt8DY%3D" alt="" loading="lazy"/></p>
<p>可以看到修改了模型的调用。</p>
<p>智谱提供了一些免费模型的使用</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fguide%2Fmodels%2Ffree%2Fglm-4.7-flash" target="_blank" title="https://docs.bigmodel.cn/cn/guide/models/free/glm-4.7-flash" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/guide/mo…</a></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94498aae1d344109b313c4ed54afb94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=5vex1ns39NqVhcd%2Fy0POYLrICzE%3D" alt="" loading="lazy"/></p>
<p>可以修改成这些模型进行使用。</p>
<p>免费模型开发能力有限，开发一些简单功能可以使用，如果使用热门流行的模型，还是需要付费使用。</p>
<h3 data-id="heading-7">通过代理转发链接</h3>
<p>如果不想使用国产模型，也可以使用国内的一些代理商，通过他们提供的转发API可以使用原生的claude的大模型。</p>
<p>作为曾注册和测试了10来个系统账户，测试使用下来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcustomer.claude-code.club%2Finvite%2FCMHEVT" target="_blank" title="https://customer.claude-code.club/invite/CMHEVT" ref="nofollow noopener noreferrer">CC club</a> 使用最方便，售后服务也比较好，免费的额度给的比较多，而且每周都可以重置免费额度。这里的付费额度也是非常优惠和划算的。</p>
<p>当然你也可以注册其它代理使用：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeeprouter.top%2F" target="_blank" title="https://deeprouter.top/" ref="nofollow noopener noreferrer">deeprouter.top/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmoacode.org%2F" target="_blank" title="https://moacode.org/" ref="nofollow noopener noreferrer">moacode.org/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.code-relay.com%2F" target="_blank" title="https://api.code-relay.com/" ref="nofollow noopener noreferrer">api.code-relay.com/</a></li>
</ul>
<h4 data-id="heading-8">主要介绍下CC club的使用</h4>
<p>可以按照官方提供的<a href="https://link.juejin.cn?target=https%3A%2F%2Facademy.claude-code.club%2Fgetting-started%2Finstallation" target="_blank" title="https://academy.claude-code.club/getting-started/installation" ref="nofollow noopener noreferrer">使用文档</a>进行配置；前提是已经安装好了CC；</p>
<p>然后就主要在 <a href="https://link.juejin.cn?target=https%3A%2F%2Facademy.claude-code.club%2Fgetting-started%2Finstallation%2Fmacos%233-%25E8%25AE%25BE%25E7%25BD%25AE%25E7%258E%25AF%25E5%25A2%2583%25E5%258F%2598%25E9%2587%258F" target="_blank" title="https://academy.claude-code.club/getting-started/installation/macos#3-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" ref="nofollow noopener noreferrer">配置</a> 这一步</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c66f1b5969b84dd5bad79e67de6f9d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=U9sKLf9FPq80gg40a4TfDSL9O%2Bw%3D" alt="" loading="lazy"/></p>
<p>配置完成后，就可以使用原汁原味的claude工具。</p>
<h2 data-id="heading-9">使用Claude-code-router调用魔搭社区的模型</h2>
<p>使用claude-code-router，可以调用魔搭社区的模型，魔搭社区提供每天2000次的调用额度，当然每个模型还有日调用限制额度。可以测试使用不同的模型。</p>
<p>首先全局安装 claude-code-router 插件</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmusistudio%2Fclaude-code-router" target="_blank" title="https://github.com/musistudio/claude-code-router" ref="nofollow noopener noreferrer">github.com/musistudio/…</a></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @musistudio/claude-code-router
</code></pre>
<p>然后按照说明问题创建并配置 ~/.claude-code-router/config.json </p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"OPENAI_API_KEY"</span>: <span class="hljs-string">"<span class="hljs-variable">$OPENAI_API_KEY</span>"</span>,
  <span class="hljs-string">"GEMINI_API_KEY"</span>: <span class="hljs-string">"<span class="hljs-variable">${GEMINI_API_KEY}</span>"</span>,
  <span class="hljs-string">"Providers"</span>: [
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"openai"</span>,
      <span class="hljs-string">"api_base_url"</span>: <span class="hljs-string">"https://api.openai.com/v1/chat/completions"</span>,
      <span class="hljs-string">"api_key"</span>: <span class="hljs-string">"<span class="hljs-variable">$OPENAI_API_KEY</span>"</span>,
      <span class="hljs-string">"models"</span>: [<span class="hljs-string">"gpt-5"</span>, <span class="hljs-string">"gpt-5-mini"</span>]
    }
  ]
}
</code></pre>
<p>openai是chatGPT的模型，使用时会有一些网络问题。</p>
<p>我们可以使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2Fmodels" target="_blank" title="https://www.modelscope.cn/models" ref="nofollow noopener noreferrer">魔搭社区</a>的免费模型，每天有2000的免费调用额度。</p>
<p>魔搭社区的使用，要先完成阿里云的认证。</p>
<p>在首页-<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2Fmy%2Faccess%2Ftoken" target="_blank" title="https://www.modelscope.cn/my/access/token" ref="nofollow noopener noreferrer">访问控制</a>下，创建key，也可以使用默认的key。后边调用模型时，都需要填写key；</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9755f8f335de4d57853d42189b41901c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=mZTpR0vqzaNjain1GdiFAqjrhd4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">在模型页面选择支持推理的模型</h3>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7a99ac92c9f44c9b13acb36aa46ccaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=LzNtvf3kjwi%2F90oxeNq89rg1cQo%3D" alt="" loading="lazy"/></p>
<p>选择一个点击进去</p>
<p>在模型的详情页面中，可以在查看代码示例中找到配置使用方法</p>
<p>比如：GLM-4.7模型</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a0cb320c1f643d8862459b3631e672d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=CysuG30EvISCcW76RfoS30PMcBc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">不同模型的json配置</h3>
<p>下面是使用GLM-4.7模型的完整的config.json配置；</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_base_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api-inference.modelscope.cn/v1/chat/completions"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你自己的APIKEY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"transformer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"maxtoken"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"max_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65536</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"enhancetool"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"Qwen/Qwen3-235B-A22B-Thinking-2507"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"reasoning"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Router"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"think"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"background"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"longContext"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>添加deepseek的模型配置</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_base_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api-inference.modelscope.cn/v1/chat/completions"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ms-fd370b1c-3aed-4c0c-9980-2c545dbc4782"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"transformer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"maxtoken"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"max_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65536</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"enhancetool"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"Qwen/Qwen3-235B-A22B-Thinking-2507"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"reasoning"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Router"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
	  <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">"think"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">"background"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">"longContext"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他的模型都是类似的配置方法。使用下来，越是热门模型每日的调用限制额度越低，可以进行多测试。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis Dynamic SQL 入门指南]]></title>    <link>https://juejin.cn/post/7599630795804917806</link>    <guid>https://juejin.cn/post/7599630795804917806</guid>    <pubDate>2026-01-27T08:40:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795804917806" data-draft-id="7599847938537701385" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis Dynamic SQL 入门指南"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-27T08:40:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="信码由缰"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis Dynamic SQL 入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    信码由缰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:40:14.000Z" title="Tue Jan 27 2026 08:40:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://cf-blog.icodebuddy.com/image/107/107-0.png" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmybatis.org%2Fmybatis-dynamic-sql%2Fdocs%2Fintroduction.html" target="_blank" title="https://mybatis.org/mybatis-dynamic-sql/docs/introduction.html" ref="nofollow noopener noreferrer">MyBatis Dynamic SQL</a> 是一种类型安全的 Java 领域特定语言（DSL），用于通过编程方式构建 SQL 查询，而非编写 SQL 字符串或基于 XML 的动态查询。它在运行时使用流畅的 Java 构建器生成 SQL，同时仍通过标准的 MyBatis 映射器执行。与手动拼接字符串或复杂的 XML 逻辑相比，这使得查询构建更安全、更易于重构，并且更不容易出错。</p>
<p>由于查询是用 Java 编写的，列名和表引用通过强类型的元数据类在编译时进行验证，这提供了更好的 IDE 支持并减少了运行时 SQL 错误。本文将解释 MyBatis Dynamic SQL，并展示如何在 Java 应用程序中使用它。</p>
<h2 data-id="heading-0">1. 使用 MyBatis Dynamic SQL 可以做什么？</h2>
<p>MyBatis Dynamic SQL 支持大多数常见的 SQL 操作，包括 <code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code>，以及连接、子查询、分页、排序、条件过滤和批量操作。它允许我们逐步构建查询，仅在某些参数存在时添加条件，这使其成为搜索界面和过滤 API 的理想选择。</p>
<p>它直接与 MyBatis 映射器接口集成，意味着我们仍然可以受益于结果映射、事务处理和连接管理。由于它生成标准的 SQL，因此适用于 MyBatis 支持的任何数据库，没有供应商锁定的问题。</p>
<h3 data-id="heading-1">1.1 MyBatis Dynamic SQL 的工作原理</h3>
<p>Dynamic SQL 基于两个组件：表元数据类和 DSL 构建器。元数据类用 Java 描述表和列。DSL 构建器使用这些类以流畅、类型安全的方式组装 SQL 语句。</p>
<p>DSL 不直接执行 SQL。相反，它生成语句提供者对象，例如 <code>SelectStatementProvider</code> 或 <code>InsertStatementProvider</code>。这些对象被传递给使用 <code>@SelectProvider</code>、<code>@InsertProvider</code> 及类似注解标注的映射器方法，然后 MyBatis 使用其正常的执行引擎来执行这些语句。</p>
<h2 data-id="heading-2">2. 项目设置与依赖</h2>
<h3 data-id="heading-3">Maven 依赖</h3>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

  


<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.dynamic-sql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-dynamic-sql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

  


<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.h2database<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.240<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

</code></pre>
<p>这些依赖项包括 MyBatis 本身、Dynamic SQL DSL 以及一个用于测试的嵌入式数据库。</p>
<blockquote>
<p><strong>注意</strong></p>
</blockquote>
<blockquote>
<p>数据库驱动可以替换为 MySQL、PostgreSQL 或任何其他支持的数据库。MyBatis Dynamic SQL 不依赖于数据库类型，仅依赖于标准 SQL 生成。</p>
</blockquote>
<h3 data-id="heading-4">数据库模式</h3>
<p><code>schema.sql</code></p>
<pre><code class="hljs language-sql" lang="sql">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (

id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,

username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,

email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),

age <span class="hljs-type">INT</span>

);

  


<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(username, email, age) <span class="hljs-keyword">VALUES</span>

(<span class="hljs-string">'thomas'</span>, <span class="hljs-string">'thomas@jcg.com'</span>, <span class="hljs-number">30</span>),

(<span class="hljs-string">'benjamin'</span>, <span class="hljs-string">'benjamin@jcg.com'</span>, <span class="hljs-number">22</span>),

(<span class="hljs-string">'charles'</span>, <span class="hljs-string">'charles@jcg.com'</span>, <span class="hljs-number">17</span>);

</code></pre>
<p>此脚本创建一个简单的表并插入测试数据。内存中的 H2 数据库将在启动时执行此脚本，因此无需外部依赖即可测试查询。</p>
<h3 data-id="heading-5">领域模型</h3>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {

  


<span class="hljs-keyword">private</span> Long id;

<span class="hljs-keyword">private</span> String username;

<span class="hljs-keyword">private</span> String email;

<span class="hljs-keyword">private</span> Integer age;

  


<span class="hljs-comment">// Getter 和 Setter 方法...</span>

}

</code></pre>
<p>这个 POJO 代表数据库中的一行。MyBatis 会自动使用匹配的字段名将列映射到字段，因此本例不需要额外的结果映射。</p>
<h2 data-id="heading-6">3. 用于 Dynamic SQL 的表元数据</h2>
<p>下面的类以类型安全的方式定义数据库表及其列，允许在构建查询时被 Dynamic SQL DSL 引用。它充当 Java 代码与实际数据库结构之间的桥梁，实现了列名和类型的编译时验证。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDynamicSqlSupport</span> {

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Long&gt; id = user.id;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; username = user.username;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; email = user.email;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Integer&gt; age = user.age;

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SqlTable</span> {

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Long&gt; id = column(<span class="hljs-string">"id"</span>, JDBCType.BIGINT);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; username = column(<span class="hljs-string">"username"</span>, JDBCType.VARCHAR);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; email = column(<span class="hljs-string">"email"</span>, JDBCType.VARCHAR);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Integer&gt; age = column(<span class="hljs-string">"age"</span>, JDBCType.INTEGER);

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> {

<span class="hljs-built_in">super</span>(<span class="hljs-string">"users"</span>);

}

}

}

</code></pre>
<p>这个类为 <code>users</code> 表定义了类型安全的元数据，使 MyBatis Dynamic SQL 可以在不使用原始 SQL 字符串的情况下构建查询。DSL 使用这些 Java 对象而非按名称引用列，从而提高了安全性和 IDE 支持。</p>
<p>内部类 <code>User</code> 继承 <code>SqlTable</code>，这将其标记为可用于 <code>from(user)</code> 和连接等子句的数据表。构造函数调用 <code>super("users")</code> 来告知 MyBatis 要在 SQL 语句（如 <code>FROM users</code>）中呈现的确切表名。</p>
<p>每个列都使用 <code>SqlTable</code> 中的 <code>column()</code> 方法定义，该方法注册列名及其 JDBC 类型。这会产生强类型的 <code>SqlColumn&lt;T&gt;</code> 对象，确保比较和条件在编译时使用正确的 Java 类型。</p>
<p>外部类公开了对表及其列的静态引用，以便于静态导入，使得查询读起来很自然，例如：<code>select(id, username).from(user)</code>，同时保持完全的类型安全和重构友好。</p>
<h3 data-id="heading-7">映射器接口</h3>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@Mapper</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> {

  


<span class="hljs-meta">@SelectProvider(type = SqlProviderAdapter.class, method = "select")</span>

List&lt;User&gt; <span class="hljs-title function_">selectMany</span><span class="hljs-params">(SelectStatementProvider selectStatement)</span>;

}

</code></pre>
<p><code>@Mapper</code> 注解告诉 MyBatis 此接口应注册为映射器并在运行时进行代理。MyBatis 会自动生成实现，因此不需要具体的类。</p>
<p><code>selectMany</code> 方法接受一个 <code>SelectStatementProvider</code>，它封装了完全呈现的 SQL 语句及其参数。MyBatis 执行该语句并将每个结果行映射到 <code>User</code> 对象，将它们作为 <code>List&lt;User&gt;</code> 返回。</p>
<p><code>@SelectProvider</code> 注解指定 SQL 将由 MyBatis Dynamic SQL 的一部分 <code>SqlProviderAdapter</code> 动态提供。实际的 SQL 是在运行时从使用 DSL 构建的 <code>SelectStatementProvider</code> 生成的，而不是在注解或 XML 中编写 SQL。</p>
<h2 data-id="heading-8">4. 构建动态查询</h2>
<p>在这里，我们使用流畅的 Dynamic SQL DSL 构建 SQL 语句，而不是编写原始 SQL 字符串。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {

  


MyBatisUtil.runSchema();

  


<span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> MyBatisUtil.getSession()) {

  


<span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> session.getMapper(UserMapper.class);

  


<span class="hljs-type">SelectStatementProvider</span> <span class="hljs-variable">select</span>

<span class="hljs-operator">=</span> select(id, username, email, age)

.from(user)

.where(age, isGreaterThan(<span class="hljs-number">18</span>))

.and(username, isLike(<span class="hljs-string">"%tho%"</span>))

.orderBy(username)

.build()

.render(RenderingStrategies.MYBATIS3);

  


List&lt;User&gt; users = mapper.selectMany(select);

  


users.forEach(u

-&gt; System.out.println(u.getUsername() + <span class="hljs-string">" - "</span> + u.getAge()));

}

}

</code></pre>
<p>此代码使用流畅的 Dynamic SQL DSL 动态构建一个 <code>SELECT</code> 查询，并将其渲染为与 MyBatis 兼容的语句提供者。通过以编程方式添加条件，它能够以类型安全且可维护的方式创建复杂的过滤器。在本例中，查询选择 <code>age</code> 大于 18 岁且 <code>username</code> 包含 <code>"tho"</code> 的用户，然后按用户名字母顺序对结果进行排序。</p>
<h3 data-id="heading-9">MyBatis 工具类</h3>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisUtil</span> {

  


<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory factory;

  


<span class="hljs-keyword">static</span> {

<span class="hljs-keyword">try</span> {

<span class="hljs-type">Reader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> Resources.getResourceAsReader(<span class="hljs-string">"mybatis-config.xml"</span>);

factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(reader);

} <span class="hljs-keyword">catch</span> (Exception e) {

<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);

}

}

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSession</span><span class="hljs-params">()</span> {

<span class="hljs-keyword">return</span> factory.openSession(<span class="hljs-literal">true</span>);

}

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runSchema</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, SQLException {

<span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> getSession()) {

<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> session.getConnection();

<span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();

  


<span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(<span class="hljs-string">"schema.sql"</span>)) {

<span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(is.readAllBytes(), StandardCharsets.UTF_8);

stmt.execute(sql);

}

}

}

}

</code></pre>
<p>此工具类加载 MyBatis 配置，构建 <code>SqlSessionFactory</code>，并提供对数据库会话的访问。它还通过执行 SQL 脚本（<code>schema.sql</code>）手动初始化数据库模式。</p>
<h2 data-id="heading-10">5. 使用 Dynamic SQL 进行插入、更新和删除</h2>
<p>MyBatis 中的 Dynamic SQL 允许我们使用流畅的 DSL 以编程方式构造 INSERT、UPDATE 和 DELETE 语句。在此，我们演示如何执行这些常见的数据操作。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// INSERT</span>

<span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();

newUser.setUsername(<span class="hljs-string">"andrew"</span>);

newUser.setEmail(<span class="hljs-string">"andrew@jcg.com"</span>);

newUser.setAge(<span class="hljs-number">28</span>);

  


InsertStatementProvider&lt;User&gt; insert

= insert(newUser)

.into(user)

.map(username).toProperty(<span class="hljs-string">"username"</span>)

.map(email).toProperty(<span class="hljs-string">"email"</span>)

.map(age).toProperty(<span class="hljs-string">"age"</span>)

.build()

.render(RenderingStrategies.MYBATIS3);

  


<span class="hljs-type">int</span> <span class="hljs-variable">inserted</span> <span class="hljs-operator">=</span> mapper.insert(insert);

System.out.println(<span class="hljs-string">"Rows inserted: "</span> + inserted);

  


<span class="hljs-comment">// UPDATE</span>

<span class="hljs-type">UpdateStatementProvider</span> <span class="hljs-variable">update</span>

<span class="hljs-operator">=</span> update(user)

.set(age).equalTo(<span class="hljs-number">35</span>)

.where(username, isEqualTo(<span class="hljs-string">"thomas"</span>))

.build()

.render(RenderingStrategies.MYBATIS3);

  


<span class="hljs-type">int</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> mapper.update(update);

System.out.println(<span class="hljs-string">"Rows updated: "</span> + updated);

  


<span class="hljs-comment">// DELETE</span>

<span class="hljs-type">DeleteStatementProvider</span> <span class="hljs-variable">delete</span>

<span class="hljs-operator">=</span> deleteFrom(user)

.where(age, isLessThan(<span class="hljs-number">18</span>))

.build()

.render(RenderingStrategies.MYBATIS3);

  


<span class="hljs-type">int</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> mapper.delete(delete);

System.out.println(<span class="hljs-string">"Rows deleted: "</span> + deleted);

</code></pre>
<p>相同的 DSL 风格也用于写操作。语句以流畅的方式构建、渲染，然后由映射器提供者方法执行。</p>
<ul>
<li>
<p><strong>INSERT</strong>：创建一个新的 <code>User</code> 对象并填充值。使用 Dynamic SQL DSL，我们将其字段映射到表列并生成 <code>InsertStatementProvider</code>。映射器执行插入操作，返回受影响的行数。</p>
</li>
<li>
<p><strong>UPDATE</strong>：DSL 构建一个更新语句，将用户名为 "thomas" 的用户的年龄设置为 35。这确保只修改目标行，映射器执行更新。</p>
</li>
<li>
<p><strong>DELETE</strong>：删除语句移除所有年龄小于 18 岁的用户。在 DSL 中使用条件保证了类型安全并避免了字符串拼接。</p>
</li>
</ul>
<h3 data-id="heading-11">更新后的映射器接口</h3>
<p>为了支持这些操作，映射器接口必须包含用于 INSERT、UPDATE 和 DELETE 的方法，使用 MyBatis Dynamic SQL 提供者。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// INSERT</span>

<span class="hljs-meta">@InsertProvider(type = SqlProviderAdapter.class, method = "insert")</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(InsertStatementProvider&lt;User&gt; insertStatement)</span>;

  


<span class="hljs-comment">// UPDATE</span>

<span class="hljs-meta">@UpdateProvider(type = SqlProviderAdapter.class, method = "update")</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">update</span><span class="hljs-params">(UpdateStatementProvider updateStatement)</span>;

  


<span class="hljs-comment">// DELETE</span>

<span class="hljs-meta">@DeleteProvider(type = SqlProviderAdapter.class, method = "delete")</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(DeleteStatementProvider deleteStatement)</span>;

</code></pre>
<p>映射器中的每个方法处理一个特定的 DML 操作（插入、更新或删除），并接受一个封装了生成的 SQL 及其参数的 <code>InsertStatementProvider</code>、<code>UpdateStatementProvider</code> 或 <code>DeleteStatementProvider</code>。这种方法允许所有写操作都在 Java 中以编程方式表达，而无需手动组合 SQL 字符串，同时仍能利用 MyBatis 高效地执行语句和映射结果。</p>
<h2 data-id="heading-12">6. 结论</h2>
<p>在本文中，我们探讨了如何在 Java 应用程序中使用 MyBatis Dynamic SQL 来创建类型安全、可维护且可编程的 SQL 查询。通过将 SQL 构建与执行分离，MyBatis Dynamic SQL 简化了复杂查询逻辑的处理，降低了错误风险，并提高了代码可读性。这种方法非常适合查询需要动态变化或经常修改的应用程序。</p>
<h2 data-id="heading-13">7. 下载源代码</h2>
<p>本文讨论了 MyBatis Dynamic SQL 及其在 Java 中的使用方法。</p>
<blockquote>
<p><strong>下载</strong></p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>您可以通过此处下载此示例的完整源代码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacodegeeks.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fmybatis-dynamic-sql-demo.zip" target="_blank" title="https://www.javacodegeeks.com/wp-content/uploads/2026/01/mybatis-dynamic-sql-demo.zip" ref="nofollow noopener noreferrer">java mybatis dynamic sql</a></p>
</blockquote>
<hr/>
<p>【注】本文译自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacodegeeks.com%2Fgetting-started-with-mybatis-dynamic-sql.html" target="_blank" title="https://www.javacodegeeks.com/getting-started-with-mybatis-dynamic-sql.html" ref="nofollow noopener noreferrer">Getting Started with MyBatis Dynamic SQL</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[万字实战沉淀，阿里云Hologres首发《Serverless OLAP 技术白皮书》]]></title>    <link>https://juejin.cn/post/7599828354515091496</link>    <guid>https://juejin.cn/post/7599828354515091496</guid>    <pubDate>2026-01-27T08:43:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599828354515091496" data-draft-id="7599765329410113576" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="万字实战沉淀，阿里云Hologres首发《Serverless OLAP 技术白皮书》"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2026-01-27T08:43:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            万字实战沉淀，阿里云Hologres首发《Serverless OLAP 技术白皮书》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:43:53.000Z" title="Tue Jan 27 2026 08:43:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每天凌晨三点，你的 OLAP 集群仍在空转。</p>
<p>白天的查询高峰早已过去，但为了应对明天可能到来的流量洪峰，计算节点依然全量在线——只因传统架构无法做到“随用随停”。</p>
<p>这不是个例。行业数据显示，当前主流 OLAP 系统的平均资源利用率不足 35%。换句话说，企业每在计算上投入 3 元，就有 2 元花在了“等待”和“空跑”上。更棘手的是，这种浪费并非源于管理疏忽，而是架构本身决定的：存算一体、静态规划、强耦合设计，让系统只能按“最坏情况”配置资源。</p>
<p>在 AI 与实时决策驱动下，企业对 OLAP 系统的期待已从“能查”跃迁至“快、稳、省、易用”。然而，传统 OLAP 架构深陷四大困局：<strong>资源僵化、隔离薄弱、成本失控、运维繁重</strong>——其静态、耦合、运维密集的设计，已无法匹配动态业务的真实需求。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/357fe778fa2341e3a80169745fc4483a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=S4gjb29qkM1TzhAiX4VUOdpAMyU%3D" alt="" loading="lazy"/></p>
<p>破局之道在于重新定义 OLAP 的资源供给方式。而这一方向，早在云原生演进初期就已被预见。</p>
<p>2019年，UC Berkeley 在论文《A Berkeley View on Serverless Computing》中极具前瞻性地预言：Serverless 将成为云时代默认计算范式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7565d544665b45eab58290f8bf344487~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=CS%2BhhVIG1UjkkWf%2FcSO4wdQcWZg%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>极致弹性</strong>：系统能够根据业务负载自动、无缝地进行扩容和缩容，甚至可以在没有负载时<strong>缩容至“零”</strong>，彻底消除资源规划的难题。</li>
<li><strong>按需付费</strong>：用户<strong>只为代码实际运行所消耗的资源付费</strong>，代码未运行时不产生任何费用，从根本上杜绝了资源闲置浪费。</li>
<li><strong>资源隔离</strong>：提供灵活而强大的资源隔离能力，有效解决<strong>性能抖动、故障传染</strong>等风险，保障多租户环境下的系统稳定性。</li>
<li><strong>免运维</strong>：将基础设施的建设、管理和运维等繁琐工作下沉到平台提供者，用户<strong>无需再关注硬件维护、软件升级等非业务核心工作</strong>，从而聚焦于创造价值。</li>
</ul>
<p>基于 Serverless 的四大支柱，阿里云 Hologres 进一步提出‘Down to Zero’理念，将抽象原则转化为可落地的 OLAP 新范式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7c33253862e45d1b0a8c7ccc2156c36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=DvB%2FrA91K76hi5GA5o5nvQxJ%2B3k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0"><strong>Down to Zero理念：下一代OLAP的技术基石与实现</strong></h3>
<p>阿里云 Hologres 提出 <strong>“Down to Zero”</strong> 理念，以 Serverless OLAP 架构实现范式级突破：<strong>成本趋零浪费、算力趋零等待、体验趋零摩擦、运维趋零负担</strong>。这不仅是优化，而是一次范式级重构。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/479231d83ef24e20b3d452e3e91f8abc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=x0yV3BtiCeq%2Bw16%2B7ssP0VcUyiQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>**成本趋零浪费：**成本趋近于零浪费，只为实际使用的计算力付费，资源闲置趋零，将可变成本降至极致。</p>
</li>
<li>
<p>**算力趋零等待：**瞬间获取海量算力应对峰值，算力用于有效分析，业务无需提前数月规划硬件。</p>
</li>
<li>
<p>**体验趋零摩擦：**用户“点击即得”的即时洞察分析体验成为常态，同时查询延迟、调度延迟、启动延迟均趋零，实现“零延迟”。</p>
</li>
<li>
<p>**运维趋零负担：**基础设施管理复杂性大幅降低，团队聚焦业务价值，无需容量规划、版本升级、故障恢复。</p>
</li>
</ul>
<h3 data-id="heading-1"><strong>“Down to Zero”如何落地？阿里云Hologres的实践路径</strong></h3>
<p>为了实现 Down to Zero 的目标和核心价值，让大数据 OLAP 分析回归“按需而动”的本质，Hologres 推出了名为 Serverless Computing 的云原生解决方案，帮助企业实现计算资源如水电般按需取用，它不仅是企业驱动智能决策的智能引擎的技术架构革新，更是一场算力供给范式的革命性突破。</p>
<ul>
<li><strong>Serverless Computing 资源池</strong>：大查询、ETL 自动卸载至共享池，实现负载隔离与冷启动“零延迟”。</li>
<li><strong>Adaptive Serverless Computing</strong>：AI 自动识别大查询、高负载场景，智能路由至弹性资源，无需人工干预。</li>
<li><strong>Serverless 型实例</strong>：彻底取消预留计算资源，100% 按需取用，真正实现“零持有成本”。</li>
</ul>
<h3 data-id="heading-2"><strong>Serverless型实例：让OLAP分析回归“按需而动”的本质</strong></h3>
<p>Serverless 型实例，帮助企业实现计算资源如水电般按需取用，从固定支出转向波动可控的“分析即服务”模式，从“人等资源”到“资源随想随用”，从“资源枷锁”到“业务赋能”，进化到全员数据探索的常态。</p>
<p>Serverless 型实例核心组件包括：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12af4558c684931be420e732b7b9768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=ApBxOhp59yG9gnJuu%2B3XdHIA0%2Fs%3D" alt="" loading="lazy"/></p>
<p><strong>计算层：</strong></p>
<ul>
<li>接入节点：免费赠送。负责连接实例、估算请求所需的资源量、发送请求到 Serverless 资源池等。</li>
<li>Serverless Computing 资源池：可用区级别共享的计算资源池，负责执行用户的请求，按请求单独调度资源。</li>
</ul>
<p><strong>存储层：</strong></p>
<ul>
<li>Hologres 独享存储：基于 Alibaba Pangu 存储服务构建，提供高性能、高可靠、高可用、低成本、弹性的存储空间及强大稳定安全的系统服务。</li>
</ul>
<p>Hologres Serverless 型实例<strong>不再预留任何计算资源</strong>，根据业务不断波动的负载需求完全使用远端的 Serverless Computing 资源池，做到真正的**“<strong><strong>零计算资源</strong></strong>”****持有成本，****100%**的即用即取，即用即释放。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40119586f4334371b9438b761194e1dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=bxLOTp4YsmYXLxV6HlZU01cJws8%3D" alt="" loading="lazy"/></p>
<p>Hologres Serverless 型实例以零计算资源持有成本、零闲置成本、无限弹性边界、零运维负担等实现分析算力的弹性爆发，进一步极致的诠释着 Down to Zero 的成本趋零浪费、算力趋零等待、体验趋零摩擦 、运维趋零负担的核心价值，让 OLAP 分析回归“按需而动”的本质，将算力转化为竞争力，把业务价值交还给用户。</p>
<p>上述能力并非孤立存在，而是构建于一套完整的 Serverless OLAP 架构蓝图之上。</p>
<p>一个优秀的 Serverless OLAP 系统 是通过<strong>存算分离架构</strong>和<strong>计算组</strong>核心抽象，深度融合了**自动弹性、分时弹性、无损弹性伸缩、<strong><strong>Query Queue</strong></strong>、自动限流、**<strong>Down to Zero</strong> (Serverless Computing、Adaptive Serverless Computing、Serverless 型)等六大核心能力，构建了一个极致弹性、极致隔离、免运维、稳定可靠且高性价比的实时分析平台，将算力转化为竞争力，让OLAP分析回归“按需而动”的本质。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6958f98ff0e41d1be0002477184d022~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=b6IRYUxGwdWtuOCsmot2GR12ay4%3D" alt="" loading="lazy"/></p>
<p>Serverless OLAP 的本质是让算力供给隐形化，将基础设施转化为具备商业意识的数字伙伴。当资源使用变得如呼吸般自然，当每焦耳能耗都转化为洞察价值，“Down to Zero”便被赋予全新内涵，从技术理想升维为商业哲学，最终数据智慧在“Down to Zero”的管道中自由奔涌。</p>
<p>阿里云Hologres团队作为国内Serverless OLAP的先行者，以五年躬身探索为基石，撰写万字实战沉淀，首发《Down to Zero, Serverless OLAP 技术白皮书》。这本聚焦“Down to Zero”理念，直击传统 OLAP 成本高、弹性差、运维重等核心痛点，提出下一代分析引擎新范式——让算力按需爆发，资源归零无负担。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 GitHub Trending 到社交媒体：一套 AI 驱动的内容自动化流水线]]></title>    <link>https://juejin.cn/post/7599843186202181674</link>    <guid>https://juejin.cn/post/7599843186202181674</guid>    <pubDate>2026-01-27T08:47:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599843186202181674" data-draft-id="7599860946836176959" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 GitHub Trending 到社交媒体：一套 AI 驱动的内容自动化流水线"/> <meta itemprop="keywords" content="前端,GitHub,Claude"/> <meta itemprop="datePublished" content="2026-01-27T08:47:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="caizongding"/> <meta itemprop="url" content="https://juejin.cn/user/1398234519190414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 GitHub Trending 到社交媒体：一套 AI 驱动的内容自动化流水线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234519190414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    caizongding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:47:54.000Z" title="Tue Jan 27 2026 08:47:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一套从 GitHub Trending 数据采集到图文内容全自动生成的端到端流水线</p>
</blockquote>
<h2 data-id="heading-0">1、起因</h2>
<p>我在刷小红书、即刻等社交平台时，总能看到「GitHub 每周充电」「开源项目推荐」之类的技术分享帖——精美的项目卡片配上一段简洁的文案，阅读量和互动都不错。所以我就在想：这些内容的素材来源无非是 GitHub Trending，卡片和文案的结构也相对固定，能不能借助 AI 把整个流程跑起来，定时自动生成图片和文案，直接拿来发布？</p>
<h2 data-id="heading-1">2、项目简介</h2>
<p>github-trending-scraper 是一个自动化内容生产流水线，它能够：</p>
<ol>
<li><strong>抓取</strong> GitHub Trending 页面的热门开源项目数据</li>
<li><strong>校验</strong> 数据结构的完整性与合法性</li>
<li><strong>渲染</strong> 精美的项目卡片图片（内置18套模板）</li>
<li><strong>生成</strong> 便于社交媒体分享的文案</li>
</ol>
<p>只需一条命令 <code>pnpm start</code>，即可完成从数据采集到内容产出的全部流程，并通过 GitHub Actions 实现每月定时执行与发布。</p>
<h3 data-id="heading-2">2.1 卡片模板一览</h3>
<p>以下是项目内置的 18 套卡片模板渲染效果：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8821467e0b2047aa9871f164d4659c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=0vV7VKl1Qlk9geBdiMIOQjnu2ZE%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b001e7250f834eff8d5b5ad49bae2276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=dI097CXlbY0Qa0uSEaL7VhX%2BJxg%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ac21e1f2774d39a9949f2506e08b24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=V%2BXckB4jZqhsseJua5Ygu%2F%2FxSEI%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d364b972bc3b45ac8bf88fb111aff29f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=0TZkJga%2BqxnMQ02ZV4tePs3beQQ%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b73f2ea3bc5f42a48a74b4bfc71a002d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=fJLQtUZ%2FrSvHjUd2XY1K7WlgeBc%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e9bb66b4ea54d569c17be8e3987695c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=5NbId9MGF%2B3iDPKz3jm0aepjB8E%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c09e7f182b4442a2244f41c6142fd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=dZUGIr5KGvVqCkMR%2F0eSd%2BC7Ndo%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea79bf4204e44ae593f40fa5e1027fc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=xdLn1BgZ1oE6oanIVewqZrwSbc8%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9a9acc4146446c9ad57dd0269988d42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=wTrcxwF%2FFFnAAJEuIsGpWK7KoT4%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/859526f52bd44faf8f2cf4e78c4de087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=oSH5X0NwFMFHIgl4Ay1jIHfVzww%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d93e710b272d4e2ab661248d66036743~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=tLAKt%2FRDnFWIg53BskKexMAdves%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d853e912f84402ebc78600e3ad0e2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=yU0wYCqeJnIfVQeBQFauS4%2B1n14%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08187ee0a845410fba631c29384ed2bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=VDg%2FWk91Q47ooqdB4VFAM9G2hGk%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92ef0d6267a44780a368a1afc35b4ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=hl6rH%2F%2FP1Pe3i01mFpoNYpZSm48%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac6a01d56aa344b28f8097bf0f41a62f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=tdEgTTkvH2ztZpuDvST3MdGAJ0Q%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ae84583590f46088fe7569f6f2c923a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=OVnqcmqnZE4OELUOU2ge2hLzXLs%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1956f02afb9747ae889df0cca4d5ec2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=g5cjS3xRZlRMTclVsvgzm5eWql4%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e2a8c6fadd34f00b52d8913eb5e4d77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=MhF1FtO3SEexateOZdWL4b%2BZiA4%3D" width="200" height="266" loading="lazy"/>
<h2 data-id="heading-3">3、核心能力</h2>





























<table><thead><tr><th>能力</th><th>说明</th></tr></thead><tbody><tr><td>GitHub Trending 爬虫</td><td>支持按语言、时间维度（日/周/月）筛选，默认抓取 Top 10</td></tr><tr><td>数据校验</td><td>基于 Zod Schema 的运行时类型校验，确保数据质量</td></tr><tr><td>卡片渲染</td><td>18 套精心设计的 HTML 模板，通过 Playwright 截图生成 2x 高清 PNG</td></tr><tr><td>AI 文案生成</td><td>接入 Google Gemini API，流式输出技术文案</td></tr><tr><td>定时自动化</td><td>GitHub Actions 每月 1 号自动执行，打包产物并创建 Release</td></tr></tbody></table>
<h2 data-id="heading-4">4、技术选型与考量</h2>
<h3 data-id="heading-5">4.1 运行时与语言</h3>

























<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>语言</td><td>TypeScript</td><td>完整的类型系统，编译期捕获错误，提升代码可维护性</td></tr><tr><td>运行时</td><td>Node.js (ES2022)</td><td>丰富的 npm 生态，异步 I/O 天然适合爬虫与网络请求场景</td></tr><tr><td>包管理</td><td>pnpm</td><td>更快的安装速度，节省磁盘空间的硬链接机制</td></tr></tbody></table>
<h3 data-id="heading-6">4.2 数据采集层</h3>

























<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>HTTP 客户端</td><td>Axios</td><td>成熟稳定，支持拦截器、超时控制、自动 JSON 解析</td></tr><tr><td>HTML 解析</td><td>Cheerio</td><td>轻量级 jQuery 式 API，无需启动浏览器，解析速度快</td></tr><tr><td>数据校验</td><td>Zod</td><td>TypeScript-first 的运行时校验库，Schema 即类型</td></tr></tbody></table>
<p><strong>为什么不用 Puppeteer/Playwright 来爬取？</strong>
GitHub Trending 页面是服务端渲染的静态 HTML，不涉及 JavaScript 动态加载。使用 Cheerio 解析 HTML 字符串即可，无需启动完整浏览器，资源消耗极低。</p>
<h3 data-id="heading-7">4.3 渲染层</h3>




















<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>浏览器引擎</td><td>Playwright (Chromium)</td><td>跨平台一致性好，API 现代化，截图质量高</td></tr><tr><td>模板方案</td><td>原生 HTML + CSS</td><td>设计自由度高，不依赖额外模板引擎，所见即所得</td></tr></tbody></table>
<p><strong>为什么选择 Playwright 而非 Canvas/SVG？</strong>
使用 HTML/CSS 模板配合浏览器截图，设计师可以直接用前端技术栈制作模板，修改样式只需调整 CSS，无需理解 Canvas API 或 SVG 规范。18 套不同风格的模板充分证明了这一方案的灵活性。</p>
<h3 data-id="heading-8">4.4 AI 内容生成层</h3>

























<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>LLM</td><td>Google Gemini (gemini-3-flash-preview)</td><td>速度快、成本低，中文能力优秀</td></tr><tr><td>输出方式</td><td>流式生成 (Streaming)</td><td>实时反馈，用户体验好；长文本生成不会超时</td></tr><tr><td>Prompt 管理</td><td>独立 Markdown 文件</td><td>与代码解耦，非技术人员也能调整文案风格</td></tr></tbody></table>
<h3 data-id="heading-9">4.5 测试与 CI/CD</h3>




















<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>测试框架</td><td>Vitest</td><td>原生 ESM 支持，与 TypeScript 无缝集成，运行速度快</td></tr><tr><td>CI/CD</td><td>GitHub Actions</td><td>与代码仓库深度整合，支持定时触发和手动触发</td></tr></tbody></table>
<h2 data-id="heading-10">5、架构设计</h2>
<h3 data-id="heading-11">5.1 整体流水线</h3>
<pre><code class="hljs language-scss" lang="scss">┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  GitHub      │    │   Cheerio    │    │     Zod      │
│  Trending    │───▶│   <span class="hljs-selector-tag">HTML</span> 解析   │───▶│  Schema 校验  │
│  (HTTP GET)  │    │              │    │              │
└──────────────┘    └──────────────┘    └──────┬───────┘
                                               │
                                    ┌──────────┴──────────┐
                                    │                     │
                              ┌─────▼──────┐      ┌──────▼───────┐
                              │ Playwright │      │  Gemini LLM  │
                              │ 卡片渲染    │      │  文案生成     │
                              └─────┬──────┘      └──────┬───────┘
                                    │                     │
                              ┌─────▼──────┐      ┌──────▼───────┐
                              │  PNG 图片   │      │  文案   │
                              │  (<span class="hljs-number">18</span>模板)   │      │  (post.txt)  │
                              └────────────┘      └──────────────┘
</code></pre>
<h3 data-id="heading-12">5.2 自动化流程</h3>
<p>GitHub Actions 工作流实现全自动运行：</p>
<pre><code class="hljs language-sql" lang="sql">每月 <span class="hljs-number">1</span> 号 <span class="hljs-number">12</span>:<span class="hljs-number">00</span> (北京时间)
       │
       ▼
  拉取代码 → 安装依赖 → 执行 pnpm <span class="hljs-keyword">start</span>
       │
       ▼
  生成 JSON <span class="hljs-operator">+</span> PNG 卡片 <span class="hljs-operator">+</span> 文案
       │
       ▼
  打包为 ZIP → 创建 GitHub <span class="hljs-keyword">Release</span>（带版本号 vYYYY.MM）
</code></pre>
<p>支持 <code>workflow_dispatch</code> 手动触发，方便临时运行。</p>
<h2 data-id="heading-13">6、模板是怎么来的：用 Google Stitch 批量生成卡片模板</h2>
<p>项目内置的 18 套卡片模板，全部由 AI 生成——使用的工具是 Google Labs 推出的 <strong>Stitch</strong>。</p>
<h3 data-id="heading-14">6.1 什么是 Google Stitch</h3>
<p>Stitch 是 Google Labs 推出的 AI 辅助 UI/UX 设计工具，核心能力是 <strong>Text-to-UI</strong>：输入一段自然语言描述，即可自动生成包含布局、配色、组件和交互逻辑的完整界面设计。除了文字输入，还支持草图识别和截图参考等多模态输入方式。最关键的一点：Stitch 生成的不是图片，而是<strong>可运行的 HTML/CSS 代码</strong>，这正好满足了本项目「HTML 模板 + Playwright 截图」的渲染方案。</p>
<h3 data-id="heading-15">6.2 模板生成链路</h3>
<pre><code class="hljs language-css" lang="css">需求描述（Prompt）
    │
    ▼
Google Stitch（Text-<span class="hljs-selector-tag">to</span>-UI）
    │
    ▼
生成可运行的 <span class="hljs-selector-tag">HTML</span>/CSS 代码
    │
    ▼
AI微调样式 + 插入占位符（{{rank}}、{{name}} 等）
    │
    ▼
保存为项目模板（<span class="hljs-attribute">src</span>/renderer/templates/<span class="hljs-number">1</span>~<span class="hljs-number">18</span><span class="hljs-selector-class">.html</span>）
</code></pre>
<p>具体流程：</p>
<ol>
<li><strong>向 Stitch 描述卡片需求</strong>：包括用途（GitHub 项目展示卡片）、尺寸（3:4 竖版，适配社交媒体）、需要展示的信息字段（项目名、描述、Star 数等），以及期望的视觉风格（如赛博朋克、毛玻璃、极简等）</li>
<li><strong>Stitch 生成 HTML/CSS</strong>：AI 自动输出完整的前端代码，包含布局结构和视觉样式</li>
<li><strong>AI微调与模板化</strong>：将生成代码中的具体数据替换为占位符（<code>{{rank}}</code>、<code>{{name}}</code>、<code>{{stars}}</code> 等），并对细节样式做适当调整</li>
<li><strong>集成到项目</strong>：将最终模板放入 <code>src/renderer/templates/</code> 目录，供 Playwright 渲染引擎使用</li>
</ol>
<h3 data-id="heading-16">6.3 模板效果展示</h3>
<p>以下是通过 Stitch 生成的部分模板预览：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11eb22a9e0c9433893f8c91a0a36b841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=2CYaEUAoIUSH8OX50bqvS0ep%2Bto%3D" alt="template-1.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d033b04407c4ea8abfcf7a38f43a8d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=Xq0Rz7I8CjdKafjoyrhqfMYaNCI%3D" alt="template-2.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d567d13cb2c4cd5b19c6283390ec98d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=Hb4agUkm%2BmgADsePdNOVKDJqnMg%3D" alt="template-3.png" loading="lazy"/></p>
<p>18 套模板涵盖了赛博朋克、毛玻璃、蓝图、杂志、像素风、漫画风等多种视觉风格。</p>
<h2 data-id="heading-17">7、结尾</h2>
<p>本项目中的代码与文档大部分由 AI 生成。如果大家对相关代码或 Prompt 写法感兴趣，欢迎关注或 Star 我的github仓库，包含开发过程中所有的prompt和文档。</p>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLittleBreak%2Fgithub-trending-scraper" target="_blank" title="https://github.com/LittleBreak/github-trending-scraper" ref="nofollow noopener noreferrer">github.com/LittleBreak…</a></p>
<p>如果大家对具体生成的小红书文章感兴趣，可以去关注我的小红书账号，看下实际效果～</p>
<p>小红书文章: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaohongshu.com%2Fdiscovery%2Fitem%2F6976204a000000000b0100ff%3Fsource%3Dwebshare%26xhsshare%3Dpc_web%26xsec_token%3DABtsM9pwf4mv56dzPNo_fvi4-O2uqnQyr-QIzO1kLWDnk%3D%26xsec_source%3Dpc_share" target="_blank" title="https://www.xiaohongshu.com/discovery/item/6976204a000000000b0100ff?source=webshare&amp;xhsshare=pc_web&amp;xsec_token=ABtsM9pwf4mv56dzPNo_fvi4-O2uqnQyr-QIzO1kLWDnk=&amp;xsec_source=pc_share" ref="nofollow noopener noreferrer">GitHub 本月最火 Top10，AI Coding 霸榜！</a></p>
<p>另外我也开放共享了卡片模板的 Stitch 项目，大家可以直接访问并做任意编辑，没任何限制</p>
<p>stitch: <a href="https://link.juejin.cn?target=https%3A%2F%2Fstitch.withgoogle.com%2Fprojects%2F12543921965028912020" target="_blank" title="https://stitch.withgoogle.com/projects/12543921965028912020" ref="nofollow noopener noreferrer">github trend card stitch card project</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Sentinel具体怎么使用呢]]></title>    <link>https://juejin.cn/post/7599634796583092230</link>    <guid>https://juejin.cn/post/7599634796583092230</guid>    <pubDate>2026-01-27T07:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599634796583092230" data-draft-id="7599572091076083754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Sentinel具体怎么使用呢"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Sentinel具体怎么使用呢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:16:51.000Z" title="Tue Jan 27 2026 07:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>下面给你一套<strong>Sentinel 在 Spring Cloud Alibaba 里最常见、最“能跑起来”的用法</strong>：从「接入 → 控制台 → 对接口限流/熔断 → 动态规则（Nacos）」一步到位。</p>
<hr/>
<h2 data-id="heading-0">1）你需要先理解 Sentinel 的两部分</h2>
<ul>
<li><strong>客户端（埋点 + 执行规则）</strong> ：集成在你的业务服务里</li>
<li><strong>Dashboard 控制台（看监控 + 推规则）</strong> ：一个独立 Spring Boot 应用</li>
</ul>
<p>控制台启动方式（示例把控制台端口设为 8858）：</p>
<pre><code class="hljs language-ini" lang="ini">java <span class="hljs-attr">-Dserver.port</span>=<span class="hljs-number">8858</span> \
     <span class="hljs-attr">-Dcsp.sentinel.dashboard.server</span>=localhost:<span class="hljs-number">8858</span> \
     <span class="hljs-attr">-Dproject.name</span>=sentinel-dashboard \
     -jar sentinel-dashboard.jar
</code></pre>
<p>控制台就是标准 Spring Boot 应用，直接跑 jar 即可。</p>
<hr/>
<h2 data-id="heading-1">2）业务服务引入依赖</h2>
<p>如果你用 <strong>Spring Cloud Alibaba</strong>，一般就是引 starter（版本用你项目 BOM 对齐即可）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>（Maven Central 能看到当前新版本坐标，例如 2025.x 线）</p>
<hr/>
<h2 data-id="heading-2">3）业务服务最小配置：让它出现在 Dashboard</h2>
<p><code>application.yml</code>（关键是 dashboard 地址 + transport 端口）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">transport:</span>
        <span class="hljs-attr">dashboard:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8858</span>
        <span class="hljs-attr">port:</span> <span class="hljs-number">8719</span>
</code></pre>
<p>说明：</p>
<ul>
<li><code>spring.cloud.sentinel.transport.port</code> 会在<strong>业务机器上</strong>起一个 HTTP Server（默认常用 8719），用于和控制台交互（接收推送规则、上报心跳等）。</li>
<li>你会经常看到 “8719 端口为什么被占用”，就是这个机制（可改）。</li>
</ul>
<blockquote>
<p>启动顺序建议：先启动 Dashboard → 再启动业务服务 → 访问一次接口产生流量，服务才会出现在控制台里（Sentinel 是“有流量才显示/才有资源”的思路）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">4）对 HTTP 接口做限流（最常用）</h2>
<h3 data-id="heading-4">4.1 直接对 Controller 接口限流（默认资源=URL）</h3>
<p>比如你的接口：<code>GET /api/orders</code></p>
<p>你到 Dashboard：</p>
<ul>
<li>
<p><strong>簇点链路</strong>：能看到 <code>/api/orders</code></p>
</li>
<li>
<p>进入该资源 → <strong>流控规则</strong></p>
<ul>
<li>QPS：比如 <code>count=10</code></li>
<li>超过 10QPS 就被限流（返回 BlockException）</li>
</ul>
</li>
</ul>
<p>这套是最快上手的“对 URL 做保护”。</p>
<h3 data-id="heading-5">4.2 自定义资源名 + 降级兜底（更企业级）</h3>
<p>用 <code>@SentinelResource</code> 给资源命名，并提供 blockHandler/fallback（不同异常走不同兜底）：</p>
<ul>
<li><strong>blockHandler</strong>：被限流/熔断触发时走这里</li>
<li><strong>fallback</strong>：业务异常/超时等走这里</li>
</ul>
<p>（你贴一下你是 MVC 还是 WebFlux、是否用 Feign，我可以给你对应的最标准示例。）</p>
<hr/>
<h2 data-id="heading-6">5）熔断降级怎么配（Degrade / Circuit Breaker）</h2>
<p>在 Dashboard 对某资源加 <strong>“降级规则”</strong> ，常见维度：</p>
<ul>
<li><strong>慢调用比例</strong>（RT 过高就熔断）</li>
<li><strong>异常比例/异常数</strong>（错误率高就熔断）</li>
</ul>
<p>当触发熔断时，该资源会在一段时间内快速失败（走 blockHandler/fallback），避免把下游打死。</p>
<hr/>
<h2 data-id="heading-7">6）生产必备：规则不要只存在 Dashboard 内存里（要动态持久化）</h2>
<p>Sentinel 官方建议生产用 <strong>动态规则数据源</strong>（Nacos / Apollo / ZK / Redis…）</p>
<h3 data-id="heading-8">6.1 用 Nacos 做规则中心（典型配置）</h3>
<p>你在业务服务里加 datasource 配置（示例：流控规则 flow）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.server-addr</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8848</span>
<span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.data-id</span>=order-service-flow-rules
<span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.group-id</span>=DEFAULT_GROUP
<span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.rule-type</span>=flow
</code></pre>
<p>然后在 <strong>Nacos 配置中心</strong>创建 <code>data-id=order-service-flow-rules</code>，内容放 JSON（数组）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/orders"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"limitApp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"grade"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strategy"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"controlBehavior"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"clusterMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>（JSON 字段含义：resource 资源名、count 阈值、grade=1 表示 QPS 等）</p>
<hr/>
<h2 data-id="heading-9">7）在项目里最常见的 3 个落地点</h2>
<ol>
<li><strong>入口保护（HTTP 接口）</strong> ：对 <code>/api/**</code> 做 QPS、热点参数限流</li>
<li><strong>出口保护（调用下游）</strong> ：Feign/RestTemplate/WebClient 调用下游时做熔断+隔离</li>
<li><strong>网关层统一保护（Gateway Sentinel）</strong> ：路由级别限流、按 API 维度限流</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[静态类与类型扩展]]></title>    <link>https://juejin.cn/post/7599828354514501672</link>    <guid>https://juejin.cn/post/7599828354514501672</guid>    <pubDate>2026-01-27T06:29:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599828354514501672" data-draft-id="7599703627790286888" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="静态类与类型扩展"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T06:29:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8815838029450"/> <meta itemprop="url" content="https://juejin.cn/user/339129318513335"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            静态类与类型扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339129318513335/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8815838029450
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:29:33.000Z" title="Tue Jan 27 2026 06:29:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">专栏导航</h2>
<ul>
<li>← 上一篇：<a href="https://juejin.cn/post/7599828354514452520" target="_blank" title="https://juejin.cn/post/7599828354514452520">对象的行为 - 对象中的方法</a></li>
<li>← 第一篇：<a href="https://juejin.cn/post/7594642978695233599" target="_blank" title="https://juejin.cn/post/7594642978695233599">编程世界初探</a></li>
<li><a href="https://juejin.cn/post/7596989416761131043" target="_blank" title="https://juejin.cn/post/7596989416761131043">专栏目录</a></li>
</ul>
<blockquote>
<p>前一章我们学习了类和对象的基础，这一章我们将学习两种特殊的类使用方式：静态类和类型扩展。它们可以让我们的代码更加灵活和强大。</p>
</blockquote>
<h3 data-id="heading-1">静态类（Static Class）</h3>
<h4 data-id="heading-2">什么是静态类？</h4>
<p><strong>静态类</strong> 是一种特殊的类，它<strong>不能被实例化</strong>（不能创建对象），直接通过类名访问其成员。</p>
<p><strong>类比：</strong></p>
<ul>
<li>普通类 = 手机店（可以创建多部手机）</li>
<li>静态类 = 广播塔（只有一个，直接使用，不需要创建）</li>
</ul>
<h4 data-id="heading-3">静态类的特点</h4>
<p>✅ <strong>不能创建对象</strong>：不需要使用 <code>new</code> 关键字
✅ <strong>所有成员必须是静态的</strong>：方法和属性都需要加 <code>static</code> 关键字
✅ <strong>只能有一个实例</strong>：全局共享
✅ <strong>用于工具方法</strong>：如 Math 类、Console 类</p>
<h4 data-id="heading-4">静态类 vs 普通类</h4>



































<table><thead><tr><th>特性</th><th>普通类</th><th>静态类</th></tr></thead><tbody><tr><td>创建对象</td><td>需要 <code>new</code></td><td>不能创建</td></tr><tr><td>访问方式</td><td>对象.方法</td><td>类名.方法</td></tr><tr><td>实例</td><td>可以有多个</td><td>只有一个</td></tr><tr><td>成员</td><td>可包含静态和非静态</td><td>必须都是静态</td></tr><tr><td>适用场景</td><td>需要多个实例</td><td>工具类、辅助方法</td></tr></tbody></table>
<h4 data-id="heading-5">为什么要用静态类？</h4>
<p><strong>场景一：工具方法</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不使用静态类 - 每次都要创建对象</span>
MathHelper helper = <span class="hljs-keyword">new</span> MathHelper();
<span class="hljs-built_in">double</span> result = helper.Add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);

<span class="hljs-comment">// 使用静态类 - 直接调用</span>
<span class="hljs-built_in">double</span> result = MathHelper.Add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);
</code></pre>
<p><strong>场景二：全局共享数据</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 配置信息</span>
ConfigHelper.GetDatabaseConnection();
ConfigHelper.GetApiKey();
</code></pre>
<h4 data-id="heading-6">定义静态类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用 static 关键字定义静态类</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> 类名
{
    <span class="hljs-comment">// 静态属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> 数据类型 属性名 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> 返回值类型 方法名(参数列表)
    {
        <span class="hljs-comment">// 方法体</span>
    }
}
</code></pre>
<h4 data-id="heading-7">示例：MathHelper 静态类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 定义静态工具类</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MathHelper</span>
{
    <span class="hljs-comment">// 静态方法：计算两个数的和</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span>
    {
        <span class="hljs-keyword">return</span> a + b;
    }

    <span class="hljs-comment">// 静态方法：计算两个数的差</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Subtract</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span>
    {
        <span class="hljs-keyword">return</span> a - b;
    }

    <span class="hljs-comment">// 静态方法：计算两个数的积</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Multiply</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span>
    {
        <span class="hljs-keyword">return</span> a * b;
    }

    <span class="hljs-comment">// 静态方法：计算圆面积</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">CalculateCircleArea</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> radius</span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.1415926</span> * radius * radius;
    }

    <span class="hljs-comment">// 静态方法：判断是否为偶数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsEven</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">return</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;
    }
}

<span class="hljs-comment">// 使用静态类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 直接通过类名调用，不需要创建对象</span>
        <span class="hljs-built_in">double</span> sum = MathHelper.Add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);
        Console.WriteLine(<span class="hljs-string">$"5 + 3 = <span class="hljs-subst">{sum}</span>"</span>);

        <span class="hljs-built_in">double</span> difference = MathHelper.Subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>);
        Console.WriteLine(<span class="hljs-string">$"10 - 4 = <span class="hljs-subst">{difference}</span>"</span>);

        <span class="hljs-built_in">double</span> area = MathHelper.CalculateCircleArea(<span class="hljs-number">5</span>);
        Console.WriteLine(<span class="hljs-string">$"半径为5的圆面积：<span class="hljs-subst">{area:F2}</span>"</span>);

        <span class="hljs-built_in">bool</span> isEven = MathHelper.IsEven(<span class="hljs-number">7</span>);
        Console.WriteLine(<span class="hljs-string">$"7 是偶数吗？<span class="hljs-subst">{isEven}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-ini" lang="ini">5 + <span class="hljs-attr">3</span> = <span class="hljs-number">8</span>
10 - <span class="hljs-attr">4</span> = <span class="hljs-number">6</span>
半径为5的圆面积：78.54
7 是偶数吗？False
</code></pre>
<h4 data-id="heading-8">静态属性</h4>
<p>静态属性在所有对象之间共享。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 静态字段</span>

    <span class="hljs-comment">// 静态属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> Count
    {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> count; }
    }

    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Increment</span>()</span>
    {
        count++;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Reset</span>()</span>
    {
        count = <span class="hljs-number">0</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"初始计数：<span class="hljs-subst">{Counter.Count}</span>"</span>);

        Counter.Increment();
        Counter.Increment();
        Counter.Increment();

        Console.WriteLine(<span class="hljs-string">$"增加3次后：<span class="hljs-subst">{Counter.Count}</span>"</span>);

        Counter.Reset();
        Console.WriteLine(<span class="hljs-string">$"重置后：<span class="hljs-subst">{Counter.Count}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs">初始计数：0
增加3次后：3
重置后：0
</code></pre>
<h4 data-id="heading-9">常见的静态类</h4>
<p><strong>1. Math 类（数学运算）</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">double</span> max = Math.Max(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);      <span class="hljs-comment">// 最大值：10</span>
<span class="hljs-built_in">double</span> min = Math.Min(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);      <span class="hljs-comment">// 最小值：5</span>
<span class="hljs-built_in">double</span> abs = Math.Abs(<span class="hljs-number">-5</span>);         <span class="hljs-comment">// 绝对值：5</span>
<span class="hljs-built_in">double</span> power = Math.Pow(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);     <span class="hljs-comment">// 幂运算：8</span>
<span class="hljs-built_in">double</span> sqrt = Math.Sqrt(<span class="hljs-number">16</span>);       <span class="hljs-comment">// 平方根：4</span>
<span class="hljs-built_in">double</span> pi = Math.PI;                <span class="hljs-comment">// 圆周率：3.14159...</span>
</code></pre>
<p><strong>2. Console 类（输入输出）</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">Console.WriteLine(<span class="hljs-string">"输出信息"</span>);     <span class="hljs-comment">// 输出</span>
<span class="hljs-built_in">string</span> input = Console.ReadLine();  <span class="hljs-comment">// 输入</span>
Console.Clear();                    <span class="hljs-comment">// 清屏</span>
</code></pre>
<p><strong>3. DateTime 类（时间操作）</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">DateTime now = DateTime.Now;        <span class="hljs-comment">// 当前时间</span>
<span class="hljs-built_in">string</span> today = DateTime.Today.ToString();
<span class="hljs-built_in">int</span> year = DateTime.Now.Year;       <span class="hljs-comment">// 当前年份</span>
</code></pre>
<h4 data-id="heading-10">实践：StringHelper 静态工具类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week9Practice</span>
{
    <span class="hljs-comment">// 定义静态字符串工具类</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringHelper</span>
    {
        <span class="hljs-comment">// 反转字符串</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Reverse</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-built_in">char</span>[] chars = text.ToCharArray();
            Array.Reverse(chars);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(chars);
        }

        <span class="hljs-comment">// 判断是否为回文</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPalindrome</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-built_in">string</span> reversed = Reverse(text);
            <span class="hljs-keyword">return</span> text.ToLower() == reversed.ToLower();
        }

        <span class="hljs-comment">// 统计单词数量</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">CountWords</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text))
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

            <span class="hljs-built_in">string</span>[] words = text.Split(<span class="hljs-keyword">new</span>[] { <span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span> }, StringSplitOptions.RemoveEmptyEntries);
            <span class="hljs-keyword">return</span> words.Length;
        }

        <span class="hljs-comment">// 生成重复字符串</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Repeat</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text, <span class="hljs-built_in">int</span> count</span>)</span>
        {
            <span class="hljs-built_in">string</span> result = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++)
            {
                result += text;
            }
            <span class="hljs-keyword">return</span> result;
        }
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 字符串工具类演示 =====\n"</span>);

            <span class="hljs-comment">// 反转字符串</span>
            <span class="hljs-built_in">string</span> original = <span class="hljs-string">"Hello World"</span>;
            <span class="hljs-built_in">string</span> reversed = StringHelper.Reverse(original);
            Console.WriteLine(<span class="hljs-string">$"原字符串：<span class="hljs-subst">{original}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"反转后：<span class="hljs-subst">{reversed}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 判断回文</span>
            <span class="hljs-built_in">string</span>[] testWords = { <span class="hljs-string">"racecar"</span>, <span class="hljs-string">"level"</span>, <span class="hljs-string">"hello"</span>, <span class="hljs-string">"radar"</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> word <span class="hljs-keyword">in</span> testWords)
            {
                <span class="hljs-built_in">bool</span> isPalindrome = StringHelper.IsPalindrome(word);
                Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{word}</span>' 是回文吗？<span class="hljs-subst">{isPalindrome}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 统计单词</span>
            <span class="hljs-built_in">string</span> sentence = <span class="hljs-string">"C# is an amazing programming language"</span>;
            <span class="hljs-built_in">int</span> wordCount = StringHelper.CountWords(sentence);
            Console.WriteLine(<span class="hljs-string">$"句子：'<span class="hljs-subst">{sentence}</span>'"</span>);
            Console.WriteLine(<span class="hljs-string">$"单词数量：<span class="hljs-subst">{wordCount}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 重复字符串</span>
            <span class="hljs-built_in">string</span> pattern = <span class="hljs-string">"abc"</span>;
            <span class="hljs-built_in">int</span> repeatCount = <span class="hljs-number">5</span>;
            <span class="hljs-built_in">string</span> repeated = StringHelper.Repeat(pattern, repeatCount);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{pattern}</span>' 重复 <span class="hljs-subst">{repeatCount}</span> 次：<span class="hljs-subst">{repeated}</span>"</span>);
        }
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-python" lang="python">===== 字符串工具类演示 =====

原字符串：Hello World
反转后：dlroW olleH

<span class="hljs-string">'racecar'</span> 是回文吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'level'</span> 是回文吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'hello'</span> 是回文吗？<span class="hljs-literal">False</span>
<span class="hljs-string">'radar'</span> 是回文吗？<span class="hljs-literal">True</span>

句子：<span class="hljs-string">'C# is an amazing programming language'</span>
单词数量：<span class="hljs-number">6</span>

<span class="hljs-string">'abc'</span> 重复 <span class="hljs-number">5</span> 次：abcabcabcabcabc
</code></pre>
<h4 data-id="heading-11">实践：Validator 静态验证类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week9Practice</span>
{
    <span class="hljs-comment">// 定义静态验证工具类</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Validator</span>
    {
        <span class="hljs-comment">// 验证邮箱格式</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidEmail</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> email</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(email))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 简单验证：包含 @ 和 .</span>
            <span class="hljs-keyword">return</span> email.Contains(<span class="hljs-string">"@"</span>) &amp;&amp; email.Contains(<span class="hljs-string">"."</span>);
        }

        <span class="hljs-comment">// 验证手机号（11位数字）</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidPhoneNumber</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> phone</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(phone) || phone.Length != <span class="hljs-number">11</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 检查是否全是数字</span>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> phone)
            {
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">char</span>.IsDigit(c))
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// 验证年龄</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidAge</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> age</span>)</span>
        {
            <span class="hljs-keyword">return</span> age &gt;= <span class="hljs-number">0</span> &amp;&amp; age &lt;= <span class="hljs-number">150</span>;
        }

        <span class="hljs-comment">// 验证密码强度（至少6位）</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidPassword</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> password</span>)</span>
        {
            <span class="hljs-keyword">return</span> !<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(password) &amp;&amp; password.Length &gt;= <span class="hljs-number">6</span>;
        }
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 数据验证工具 =====\n"</span>);

            <span class="hljs-comment">// 验证邮箱</span>
            <span class="hljs-built_in">string</span>[] emails = { <span class="hljs-string">"test@example.com"</span>, <span class="hljs-string">"invalid-email"</span>, <span class="hljs-string">"user@"</span>, <span class="hljs-string">"good@domain.org"</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> email <span class="hljs-keyword">in</span> emails)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidEmail(email);
                Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{email}</span>' - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 验证手机号</span>
            <span class="hljs-built_in">string</span>[] phones = { <span class="hljs-string">"13800138000"</span>, <span class="hljs-string">"123"</span>, <span class="hljs-string">"12345678901"</span>, <span class="hljs-string">"1234567890a"</span>, <span class="hljs-string">"15912345678"</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> phone <span class="hljs-keyword">in</span> phones)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidPhoneNumber(phone);
                Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{phone}</span>' - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 验证年龄</span>
            <span class="hljs-built_in">int</span>[] ages = { <span class="hljs-number">25</span>, <span class="hljs-number">-5</span>, <span class="hljs-number">150</span>, <span class="hljs-number">200</span>, <span class="hljs-number">0</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">int</span> age <span class="hljs-keyword">in</span> ages)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidAge(age);
                Console.WriteLine(<span class="hljs-string">$"年龄 <span class="hljs-subst">{age}</span> - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 验证密码</span>
            <span class="hljs-built_in">string</span>[] passwords = { <span class="hljs-string">"123456"</span>, <span class="hljs-string">"123"</span>, <span class="hljs-string">"abc"</span>, <span class="hljs-string">"password123"</span>, <span class="hljs-string">""</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> password <span class="hljs-keyword">in</span> passwords)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidPassword(password);
                <span class="hljs-built_in">string</span> masked = password.Length &gt; <span class="hljs-number">0</span> ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">'*'</span>, password.Length) : <span class="hljs-string">"(空)"</span>;
                Console.WriteLine(<span class="hljs-string">$"密码 '<span class="hljs-subst">{masked}</span>' - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }
        }
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-scss" lang="scss">===== 数据验证工具 =====

'test<span class="hljs-keyword">@example</span>.com<span class="hljs-string">' - ✓ 有效
'</span>invalid-email<span class="hljs-string">' - ✗ 无效
'</span>user@<span class="hljs-string">' - ✗ 无效
'</span>good<span class="hljs-keyword">@domain</span>.org<span class="hljs-string">' - ✓ 有效

'</span><span class="hljs-number">13800138000</span><span class="hljs-string">' - ✓ 有效
'</span><span class="hljs-number">123</span><span class="hljs-string">' - ✗ 无效
'</span><span class="hljs-number">12345678901</span><span class="hljs-string">' - ✗ 无效
'</span><span class="hljs-number">1234567890</span>a<span class="hljs-string">' - ✗ 无效
'</span><span class="hljs-number">15912345678</span><span class="hljs-string">' - ✓ 有效

年龄 25 - ✓ 有效
年龄 -5 - ✗ 无效
年龄 150 - ✓ 有效
年龄 200 - ✗ 无效
年龄 0 - ✓ 有效

密码 '</span>******<span class="hljs-string">' - ✓ 有效
密码 '</span>***<span class="hljs-string">' - ✗ 无效
密码 '</span>***<span class="hljs-string">' - ✗ 无效
密码 '</span>************<span class="hljs-string">' - ✓ 有效
密码 '</span>(空)<span class="hljs-string">' - ✗ 无效
</span></code></pre>
<h4 data-id="heading-12">静态类的限制</h4>
<p>❌ <strong>不能创建实例</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误！静态类不能创建对象</span>
MathHelper helper = <span class="hljs-keyword">new</span> MathHelper();
</code></pre>
<p>❌ <strong>不能继承其他类或被继承</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误！静态类不能继承</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyHelper</span> : <span class="hljs-title">BaseClass</span> { }

<span class="hljs-comment">// 错误！静态类不能被继承</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BaseClass</span> { }
<span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> : <span class="hljs-title">BaseClass</span> { }
</code></pre>
<p>❌ <strong>不能包含非静态成员</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误！静态类中的成员必须是静态的</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">NormalMethod</span>()</span> { }  <span class="hljs-comment">// 错误</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> MyProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }  <span class="hljs-comment">// 错误</span>
}
</code></pre>
<h4 data-id="heading-13">普通类中的静态成员</h4>
<p>普通类也可以包含静态成员，静态成员属于类本身，不属于某个对象。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }      <span class="hljs-comment">// 实例属性</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> totalCount = <span class="hljs-number">0</span>;     <span class="hljs-comment">// 静态字段</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>
    {
        Name = name;
        totalCount++;  <span class="hljs-comment">// 每创建一个对象，计数器加1</span>
    }

    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetTotalCount</span>()</span>
    {
        <span class="hljs-keyword">return</span> totalCount;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"初始学生数：<span class="hljs-subst">{Student.GetTotalCount()}</span>"</span>);

        Student s1 = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"张三"</span>);
        Student s2 = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"李四"</span>);
        Student s3 = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"王五"</span>);

        Console.WriteLine(<span class="hljs-string">$"当前学生数：<span class="hljs-subst">{Student.GetTotalCount()}</span>"</span>);  <span class="hljs-comment">// 3</span>

        <span class="hljs-comment">// 注意：不能通过对象访问静态成员</span>
        <span class="hljs-comment">// s1.GetTotalCount();  // 错误！</span>
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs">初始学生数：0
当前学生数：3
</code></pre>
<h4 data-id="heading-14">什么时候使用静态类？</h4>
<p>✅ <strong>适合使用的场景：</strong></p>
<ul>
<li>工具方法（如 MathHelper、StringHelper）</li>
<li>验证逻辑（如 Validator）</li>
<li>配置管理（如 ConfigHelper）</li>
<li>常量集合（如 Constants）</li>
<li>无状态的操作（输入输出确定）</li>
</ul>
<p>❌ <strong>不适合使用的场景：</strong></p>
<ul>
<li>需要维护状态</li>
<li>需要继承</li>
<li>需要多态</li>
<li>需要多个独立实例</li>
</ul>
<h4 data-id="heading-15">小贴士</h4>
<p>💡 <strong>命名建议：</strong> 静态工具类通常以 <code>Helper</code>、<code>Util</code>、<code>Validator</code> 等结尾</p>
<pre><code class="hljs language-csharp" lang="csharp">MathHelper, StringHelper, ConfigHelper
StringUtil, DateUtil
Validator, EmailValidator
</code></pre>
<p>💡 <strong>不要滥用静态类：</strong></p>
<ul>
<li>如果需要维护对象的状态，使用普通类</li>
<li>如果需要依赖注入，使用普通类</li>
<li>如果需要测试，普通类更容易 mock</li>
</ul>
<h3 data-id="heading-16">类型扩展（Extension Methods）</h3>
<h4 data-id="heading-17">什么是扩展方法？</h4>
<p><strong>扩展方法</strong> 是一种特殊的静态方法，可以为现有类型（如 string、int、甚至第三方库的类）添加新方法，而<strong>不需要修改原始类的代码</strong>或<strong>继承该类</strong>。</p>
<p><strong>类比：</strong></p>
<ul>
<li>原始类 = 一把普通剪刀</li>
<li>扩展方法 = 给剪刀加装了一个开瓶器功能</li>
<li>不需要重新造剪刀，只是在它的基础上"扩展"了能力</li>
</ul>
<h4 data-id="heading-18">为什么需要扩展方法？</h4>
<p><strong>场景一：为系统类型添加方法</strong></p>
<p>你想给 <code>string</code> 类型添加一个"是否为手机号"的判断方法，但不能修改 .NET 源代码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不使用扩展方法 - 调用不方便</span>
<span class="hljs-built_in">bool</span> isValid = Validator.IsPhoneNumber(<span class="hljs-string">"13800138000"</span>);

<span class="hljs-comment">// 使用扩展方法 - 调用更自然</span>
<span class="hljs-built_in">bool</span> isValid = <span class="hljs-string">"13800138000"</span>.IsPhoneNumber();
</code></pre>
<p><strong>场景二：第三方库类型</strong></p>
<p>使用第三方库时，想给它的类添加功能，但没有源代码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 为第三方类添加方法</span>
someObject.CalculateAge();  <span class="hljs-comment">// 调用像自己的方法一样自然</span>
</code></pre>
<h4 data-id="heading-19">扩展方法的语法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. 必须在静态类中定义</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> 扩展类名
{
    <span class="hljs-comment">// 2. 方法必须是静态的</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> 返回值类型 方法名(<span class="hljs-keyword">this</span> 要扩展的类型 参数名)
    {
        <span class="hljs-comment">// 方法体</span>
    }
}
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li>第一个参数前必须加 <code>this</code> 关键字</li>
<li><code>this</code> 关键字指定要扩展的类型</li>
<li>调用时，第一个参数不需要传值（会被自动填充）</li>
</ul>
<h4 data-id="heading-20">示例：为 string 类型添加扩展方法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week9Practice</span>
{
    <span class="hljs-comment">// 定义静态类，包含扩展方法</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringExtensions</span>
    {
        <span class="hljs-comment">// 扩展方法1：判断是否为手机号</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPhoneNumber</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text) || text.Length != <span class="hljs-number">11</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> text)
            {
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">char</span>.IsDigit(c))
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// 扩展方法2：判断是否为邮箱</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsEmail</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">return</span> text.Contains(<span class="hljs-string">"@"</span>) &amp;&amp; text.Contains(<span class="hljs-string">"."</span>);
        }

        <span class="hljs-comment">// 扩展方法3：首字母大写</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToTitleCase</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text))
                <span class="hljs-keyword">return</span> text;

            <span class="hljs-keyword">if</span> (text.Length == <span class="hljs-number">1</span>)
                <span class="hljs-keyword">return</span> text.ToUpper();

            <span class="hljs-keyword">return</span> <span class="hljs-built_in">char</span>.ToUpper(text[<span class="hljs-number">0</span>]) + text.Substring(<span class="hljs-number">1</span>);
        }

        <span class="hljs-comment">// 扩展方法4：反转字符串</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Reverse</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-built_in">char</span>[] chars = text.ToCharArray();
            Array.Reverse(chars);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(chars);
        }
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== String 类型扩展演示 =====\n"</span>);

            <span class="hljs-comment">// 使用扩展方法 - 看起来像 string 的原生方法！</span>
            <span class="hljs-built_in">string</span> phone1 = <span class="hljs-string">"13800138000"</span>;
            <span class="hljs-built_in">string</span> phone2 = <span class="hljs-string">"123"</span>;

            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{phone1}</span>' 是手机号吗？<span class="hljs-subst">{phone1.IsPhoneNumber()}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{phone2}</span>' 是手机号吗？<span class="hljs-subst">{phone2.IsPhoneNumber()}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 邮箱验证</span>
            <span class="hljs-built_in">string</span> email1 = <span class="hljs-string">"test@example.com"</span>;
            <span class="hljs-built_in">string</span> email2 = <span class="hljs-string">"invalid-email"</span>;

            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{email1}</span>' 是邮箱吗？<span class="hljs-subst">{email1.IsEmail()}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{email2}</span>' 是邮箱吗？<span class="hljs-subst">{email2.IsEmail()}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 首字母大写</span>
            <span class="hljs-built_in">string</span> name1 = <span class="hljs-string">"hello"</span>;
            <span class="hljs-built_in">string</span> name2 = <span class="hljs-string">"world"</span>;

            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{name1}</span>' -&gt; <span class="hljs-subst">{name1.ToTitleCase()}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{name2}</span>' -&gt; <span class="hljs-subst">{name2.ToTitleCase()}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 反转字符串</span>
            <span class="hljs-built_in">string</span> original = <span class="hljs-string">"C# Programming"</span>;
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{original}</span>' 反转后：'<span class="hljs-subst">{original.Reverse()}</span>'"</span>);
        }
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-python" lang="python">===== String 类型扩展演示 =====

<span class="hljs-string">'13800138000'</span> 是手机号吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'123'</span> 是手机号吗？<span class="hljs-literal">False</span>

<span class="hljs-string">'test@example.com'</span> 是邮箱吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'invalid-email'</span> 是邮箱吗？<span class="hljs-literal">False</span>

<span class="hljs-string">'hello'</span> -&gt; Hello
<span class="hljs-string">'world'</span> -&gt; World

<span class="hljs-string">'C# Programming'</span> 反转后：<span class="hljs-string">'gnimmargorP #C'</span>
</code></pre>
<h4 data-id="heading-21">示例：为 int 类型添加扩展方法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">IntExtensions</span>
{
    <span class="hljs-comment">// 判断是否为偶数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsEven</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">return</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 判断是否为奇数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsOdd</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">return</span> number % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 判断是否为质数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPrime</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">2</span>; i &lt;= Math.Sqrt(number); i++)
        {
            <span class="hljs-keyword">if</span> (number % i == <span class="hljs-number">0</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// 计算阶乘</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">long</span> <span class="hljs-title">Factorial</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"不能为负数"</span>);

        <span class="hljs-built_in">long</span> result = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">2</span>; i &lt;= number; i++)
        {
            result *= i;
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">// 格式化为中文</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToChinese</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-built_in">string</span>[] digits = { <span class="hljs-string">"零"</span>, <span class="hljs-string">"一"</span>, <span class="hljs-string">"二"</span>, <span class="hljs-string">"三"</span>, <span class="hljs-string">"四"</span>, <span class="hljs-string">"五"</span>, <span class="hljs-string">"六"</span>, <span class="hljs-string">"七"</span>, <span class="hljs-string">"八"</span>, <span class="hljs-string">"九"</span> };
        <span class="hljs-built_in">string</span> result = <span class="hljs-string">""</span>;

        <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> number.ToString())
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">char</span>.IsDigit(c))
            {
                result += digits[<span class="hljs-built_in">int</span>.Parse(c.ToString())];
            }
        }
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-built_in">int</span> num = <span class="hljs-number">7</span>;

        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{num}</span> 是偶数吗？<span class="hljs-subst">{num.IsEven()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{num}</span> 是奇数吗？<span class="hljs-subst">{num.IsOdd()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{num}</span> 是质数吗？<span class="hljs-subst">{num.IsPrime()}</span>"</span>);

        Console.WriteLine();

        Console.WriteLine(<span class="hljs-string">$"5! = <span class="hljs-subst">{<span class="hljs-number">5.F</span>actorial()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"10! = <span class="hljs-subst">{<span class="hljs-number">10.F</span>actorial()}</span>"</span>);

        Console.WriteLine();

        <span class="hljs-built_in">int</span> year = <span class="hljs-number">2025</span>;
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{year}</span> 中文：<span class="hljs-subst">{year.ToChinese()}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-number">7</span> 是偶数吗？<span class="hljs-literal">False</span>
<span class="hljs-number">7</span> 是奇数吗？<span class="hljs-literal">True</span>
<span class="hljs-number">7</span> 是质数吗？<span class="hljs-literal">True</span>

<span class="hljs-number">5</span>! = <span class="hljs-number">120</span>
<span class="hljs-number">10</span>! = <span class="hljs-number">3628800</span>

<span class="hljs-number">2025</span> 中文：二零二五
</code></pre>
<h4 data-id="heading-22">示例：为自定义类添加扩展方法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 自定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name, <span class="hljs-built_in">int</span> age</span>)</span>
    {
        Name = name;
        Age = age;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PrintInfo</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span>, <span class="hljs-subst">{Age}</span>岁"</span>);
    }
}

<span class="hljs-comment">// 为 Person 类添加扩展方法</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PersonExtensions</span>
{
    <span class="hljs-comment">// 判断是否成年</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsAdult</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Person person</span>)</span>
    {
        <span class="hljs-keyword">return</span> person.Age &gt;= <span class="hljs-number">18</span>;
    }

    <span class="hljs-comment">// 获取星座</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetZodiacSign</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Person person</span>)</span>
    {
        <span class="hljs-comment">// 简化版：只作为示例</span>
        <span class="hljs-built_in">int</span> month = DateTime.Now.Month;
        <span class="hljs-built_in">int</span> day = DateTime.Now.Day;

        <span class="hljs-comment">// 实际应根据出生日期计算</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"狮子座"</span>;  <span class="hljs-comment">// 示例</span>
    }

    <span class="hljs-comment">// 格式化为问候语</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToGreeting</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Person person</span>)</span>
    {
        <span class="hljs-keyword">if</span> (person.IsAdult())
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"你好，<span class="hljs-subst">{person.Name}</span> 先生/女士"</span>;
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"你好，<span class="hljs-subst">{person.Name}</span> 小朋友"</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Person adult = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"张三"</span>, <span class="hljs-number">25</span>);
        Person child = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"小明"</span>, <span class="hljs-number">12</span>);

        Console.WriteLine(<span class="hljs-string">"=== 成年人 ==="</span>);
        adult.PrintInfo();
        Console.WriteLine(<span class="hljs-string">$"是否成年：<span class="hljs-subst">{adult.IsAdult()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"问候：<span class="hljs-subst">{adult.ToGreeting()}</span>"</span>);

        Console.WriteLine();

        Console.WriteLine(<span class="hljs-string">"=== 小朋友 ==="</span>);
        child.PrintInfo();
        Console.WriteLine(<span class="hljs-string">$"是否成年：<span class="hljs-subst">{child.IsAdult()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"问候：<span class="hljs-subst">{child.ToGreeting()}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">=== 成年人 ===</span>
张三, 25岁
是否成年：True
问候：你好，张三 先生/女士

<span class="hljs-comment">=== 小朋友 ===</span>
小明, 12岁
是否成年：False
问候：你好，小明 小朋友
</code></pre>
<h4 data-id="heading-23">扩展方法的注意事项</h4>
<p>⚠️ <strong>注意事项：</strong></p>
<ol>
<li><strong>必须在静态类中定义</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }
}

<span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">MyExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }
</code></pre>
<ol start="2">
<li><strong>方法本身必须是静态的</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }  <span class="hljs-comment">// 缺少 static</span>
}
</code></pre>
<ol start="3">
<li><strong>第一个参数必须是扩展类型</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 正确：为 string 扩展</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }

<span class="hljs-comment">// 正确：为 int 扩展</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span> { }

<span class="hljs-comment">// 正确：为泛型类型扩展</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> T item</span>)</span> { }
</code></pre>
<ol start="4">
<li><strong>扩展方法不能修改原始类的私有成员</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> privateField = <span class="hljs-number">10</span>;
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClassExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TryAccess</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MyClass obj</span>)</span>
    {
        <span class="hljs-comment">// 错误！无法访问私有字段</span>
        <span class="hljs-comment">// int x = obj.privateField;</span>
    }
}
</code></pre>
<ol start="5">
<li><strong>如果原始类有同名方法，会优先调用原始方法</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">"原始方法"</span>);
    }
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClassExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MyClass obj</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"扩展方法"</span>);
    }
}

<span class="hljs-comment">// 调用时，会使用原始方法</span>
MyClass obj = <span class="hljs-keyword">new</span> MyClass();
obj.MyMethod();  <span class="hljs-comment">// 输出：原始方法</span>
</code></pre>
<h4 data-id="heading-24">什么时候使用扩展方法？</h4>
<p>✅ <strong>适合使用的场景：</strong></p>
<ul>
<li>为系统类型（string、int、DateTime 等）添加常用方法</li>
<li>为第三方库的类型添加功能，但没有源代码</li>
<li>提高代码可读性和调用便利性</li>
<li>将辅助方法组织到更合理的位置</li>
</ul>
<p>✅ <strong>常用场景示例：</strong></p>
<ul>
<li>数据验证</li>
<li>格式化转换</li>
<li>业务逻辑扩展</li>
<li>集合操作</li>
</ul>
<p>❌ <strong>不适合使用的场景：</strong></p>
<ul>
<li>可以直接修改原始类代码时</li>
<li>需要访问类的私有成员时</li>
<li>会与原始类方法产生冲突时</li>
<li>需要维护复杂状态时</li>
</ul>
<h4 data-id="heading-25">常用扩展方法建议</h4>
<p><strong>数据验证类扩展：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span>.IsEmail()
<span class="hljs-built_in">string</span>.IsPhoneNumber()
<span class="hljs-built_in">string</span>.IsUrl()
<span class="hljs-built_in">int</span>.IsEven()
<span class="hljs-built_in">int</span>.IsOdd()
<span class="hljs-built_in">int</span>.IsPrime()
</code></pre>
<p><strong>格式化类扩展：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span>.ToTitleCase()
<span class="hljs-built_in">string</span>.Reverse()
<span class="hljs-built_in">string</span>.Mask()
<span class="hljs-built_in">int</span>.ToChinese()
<span class="hljs-built_in">int</span>.ToOrdinal()  <span class="hljs-comment">// 1st, 2nd, 3rd...</span>
</code></pre>
<p><strong>日期时间扩展：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">DateTime.IsWeekend()
DateTime.IsToday()
DateTime.Age()
</code></pre>
<h4 data-id="heading-26">小贴士</h4>
<p>💡 <strong>命名规范：</strong> 扩展方法类名通常以 <code>Extensions</code> 结尾</p>
<pre><code class="hljs language-csharp" lang="csharp">StringExtensions, IntExtensions, ListExtensions
</code></pre>
<p>💡 <strong>组织方式：</strong> 将相关的扩展方法放在同一个静态类中</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringExtensions</span>
{
    <span class="hljs-comment">// 所有 string 相关的扩展方法</span>
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DateTimeExtensions</span>
{
    <span class="hljs-comment">// 所有 DateTime 相关的扩展方法</span>
}
</code></pre>
<p>💡 <strong>LINQ 本质上就是扩展方法！</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 这些都是扩展方法</span>
numbers.Where(n =&gt; n &gt; <span class="hljs-number">5</span>)
numbers.Select(n =&gt; n * <span class="hljs-number">2</span>)
numbers.OrderBy(n =&gt; n)
</code></pre>
<h3 data-id="heading-27">本章总结</h3>
<ul>
<li>✅ 理解了静态类的概念和特点</li>
<li>✅ 掌握了静态类的定义和使用</li>
<li>✅ 理解了静态类与普通类的区别</li>
<li>✅ 学会了创建静态工具类</li>
<li>✅ 掌握了扩展方法的概念和语法</li>
<li>✅ 学会了为现有类型添加扩展方法</li>
<li>✅ 理解了扩展方法的注意事项和使用场景</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux部署MinIO]]></title>    <link>https://juejin.cn/post/7599765329409802280</link>    <guid>https://juejin.cn/post/7599765329409802280</guid>    <pubDate>2026-01-27T06:53:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599765329409802280" data-draft-id="7599690133118910498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux部署MinIO"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T06:53:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WiseSheep"/> <meta itemprop="url" content="https://juejin.cn/user/3123091067642990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux部署MinIO
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123091067642990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WiseSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:53:44.000Z" title="Tue Jan 27 2026 06:53:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MinIO 是一款高性能的对象存储服务，兼容 Amazon S3 API，适用于私有云存储、数据备份等场景。本文详细介绍在Linux环境下从下载到启动的完整部署流程。</p>
<h2 data-id="heading-0">一、下载 MinIO 安装包</h2>
<p>通过 wget 命令直接下载</p>
<pre><code class="hljs language-bash" lang="bash">wget -c https://dl.minio.org.cn/server/minio/release/linux-amd64/minio
</code></pre>
<h2 data-id="heading-1">二、创建存储目录和日志目录</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># minio/data`：用于存储 MinIO 上传的对象数据</span>
<span class="hljs-comment"># minio/log`：用于存储 MinIO 运行日志</span>
<span class="hljs-built_in">mkdir</span> -p /opt/data/minio/data /opt/data/minio/logs
</code></pre>
<h2 data-id="heading-2">三、移动并赋可执行权限</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 移动文件</span>
<span class="hljs-built_in">mv</span> minio /opt/data/minio/
<span class="hljs-comment"># 赋予执行权限</span>
<span class="hljs-built_in">chmod</span> +x /opt/data/minio/minio
</code></pre>
<h2 data-id="heading-3">四、创建启动脚本</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建启动脚本文件</span>
vim /opt/data/minio/start.sh
</code></pre>
<p>将如下内容写入到脚本中</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># MinIO 启动脚本</span>
<span class="hljs-comment"># 配置管理员用户名</span>
<span class="hljs-built_in">export</span> MINIO_ROOT_USER=root
<span class="hljs-comment"># 配置管理员密码</span>
<span class="hljs-built_in">export</span> MINIO_ROOT_PASSWORD=123456789
<span class="hljs-comment"># 启动 MinIO，配置 API 端口、控制台端口和数据存储目录</span>
<span class="hljs-comment"># --address :10001：API 端口（客户端连接使用）</span>
<span class="hljs-comment"># --console-address :10002：Web 控制台端口（浏览器访问使用）</span>
<span class="hljs-comment"># /opt/data/minio/data：数据存储目录</span>
<span class="hljs-comment"># 日志输出到 /opt/data/minio/logs/minio.log，2&gt;&amp;1 &amp; 表示后台运行</span>
<span class="hljs-built_in">nohup</span> /opt/data/minio/minio server --address :10001 --console-address :10002 /opt/data/minio/data &gt;/opt/data/minio/logs/minio.log 2&gt;&amp;1 &amp;
</code></pre>
<p>然后赋予脚本可执行权限</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x /opt/data/minio/start.sh
</code></pre>
<h2 data-id="heading-4">五、启动并验证</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /opt/data/minio/
./start.sh
</code></pre>
<p>查看minio运行日志</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">tail</span> -f /opt/data/minio/log/minio.log
</code></pre>
<p>成功标识：日志中出现 <code>Online</code> 关键字，说明 MinIO 已正常启动
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ece5d63fc644c6195f76a0b77fb7d93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101624&amp;x-signature=MJc0Xh%2BFm56Cio1EQ3ZvXk4ULi0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JUC并发编程1（多线程，高并发）]]></title>    <link>https://juejin.cn/post/7599640782570307611</link>    <guid>https://juejin.cn/post/7599640782570307611</guid>    <pubDate>2026-01-27T07:21:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782570307611" data-draft-id="7599630795804459054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JUC并发编程1（多线程，高并发）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:21:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优秀的颜"/> <meta itemprop="url" content="https://juejin.cn/user/960313319521178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JUC并发编程1（多线程，高并发）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960313319521178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优秀的颜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:21:09.000Z" title="Tue Jan 27 2026 07:21:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JUC简介</h2>
<p>来源于 java.util.concurrent、java.util.concurrent.atomic、java.util.concurrent.locks 这三个包（简称JUC ），在此包中增加了在并发编程中很常用的实用工具类，用于定义类似于线程的自定义子系统，包括线程池、异步 IO 和轻量级任务框架。提供可调的、灵活的线程池。还提供了设计用于多线程上下文中的 Collection 实现等。23年之后CPU主频更新缓慢，采用多核模式，要想程序更快就要用到并行和并发编程，但并发编程会涉及的问题有：线程安全问题、线程锁、线程性能问题。</p>
<h3 data-id="heading-1">线程和进程</h3>
<p><strong>进程、线程的关系</strong></p>
<ul>
<li>进程：一个程序，QQ.exe Music.exe 程序的集合；</li>
<li>线程：一个进程往往可以包含多个线程，至少包含一个！</li>
</ul>
<p>Java默认有两个线程：mian 线程、GC 线程</p>
<p><strong>线程有几个状态</strong></p>
<ul>
<li>新生 NEW</li>
<li>运行 RUNNABLE</li>
<li>阻塞 BLOCKED</li>
<li>等待，死死地等 WAITING</li>
<li>超时等待 TIMED_WAITING</li>
<li>终止 TERMINATED</li>
</ul>
<p><strong>并发、并行的关系</strong>：
并发（多线程操作同一个资源）、并行：（多个人一起行走） CPU 多核 ，多个线程可以同时执行；</p>
<h3 data-id="heading-2">锁的理解</h3>
<h4 data-id="heading-3">悲观锁、乐观锁</h4>
<ul>
<li>悲观锁：适合写操作多的场景，先加锁来保证数据正确性；</li>
<li>乐观锁：一版根据版本号机制、CAS算法（比较并替换）；</li>
</ul>
<h4 data-id="heading-4">公平锁、非公平锁</h4>
<ul>
<li>公平锁（FairSync）非常公平；不能插队的，必须先来后到。</li>
<li>非公平锁（NonfairSync）非常不公平，允许插队的，可以改变顺序。</li>
</ul>
<h4 data-id="heading-5">可重入锁</h4>
<ul>
<li>lock锁必须配对，相当于lock和 unlock 必须数量相同；</li>
<li>在外面加的锁，也可以在里面解锁；在里面加的锁，在外面也可以解锁；</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{

    <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">try</span> {
            lock.lock();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">":发短信"</span>);
            call(); <span class="hljs-comment">// 这里也有锁</span>
        } <span class="hljs-keyword">finally</span> {
          lock.unlock();
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">try</span> {
            lock.lock();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">":打电话"</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
     <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
     <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg(); },<span class="hljs-string">"A"</span>).start();
	 <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg(); },<span class="hljs-string">"B"</span>).start();
}
</code></pre>
<h4 data-id="heading-6">自旋锁</h4>
<p>线程A先执行，进行加锁，其他线程在自旋中，只有A线程解锁后，其他线程进行操作解锁。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 自己写的自旋锁</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpinlockDemo</span> {
    <span class="hljs-comment">// 默认值是 null</span>
    AtomicReference&lt;Thread&gt; atomicReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();
    <span class="hljs-comment">//加锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myLock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();
        System.out.println(thread.getName() + <span class="hljs-string">"===&gt; 加锁"</span>);
        <span class="hljs-comment">// 如果当前对象是null,比较替换成对象，执行结果为false ,就一直循环 自旋锁</span>
        <span class="hljs-keyword">while</span> (!atomicReference.compareAndSet(<span class="hljs-literal">null</span>, thread)) {
<span class="hljs-comment">//            System.out.println(Thread.currentThread().getName() + " ==&gt; 自旋中~");</span>
        }
    }
    
    <span class="hljs-comment">//解锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myunlock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();
        System.out.println(thread.getName() + <span class="hljs-string">"===&gt; 解锁"</span>);
        atomicReference.compareAndSet(thread, <span class="hljs-literal">null</span>);
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception{
    <span class="hljs-comment">//使用CAS实现自旋锁</span>
    <span class="hljs-type">SpinlockDemo</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpinlockDemo</span>();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        lock.myLock();
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.myunlock();
        }
    }, <span class="hljs-string">"线程A"</span>).start();

    TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);

    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        lock.myLock();
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.myunlock();
        }
    }, <span class="hljs-string">"线程B"</span>).start();
}
</code></pre>
<h4 data-id="heading-7">生产者和消费者</h4>
<p>生产者与消费者问题是多线程同步的一个经典问题。生产者和消费者同时使用一块缓冲区，生产者生产商品放入缓冲区，消费者从缓冲区中取出商品。我们需要保证的是，当缓冲区满时，生产者不可生产商品；当缓冲区为空时，消费者不可取出商品。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Lock版的生产者和消费者。</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-comment">// +1方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span>{
        lock.lock(); <span class="hljs-comment">//加锁</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (number!=<span class="hljs-number">0</span>){
                <span class="hljs-keyword">try</span> {
                    condition.await(); <span class="hljs-comment">//等待</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            number++;
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ number);
            condition.signalAll(); <span class="hljs-comment">// 通知其他线程</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">//解锁</span>
        }
    }

    <span class="hljs-comment">// -1方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span>{
        lock.lock(); <span class="hljs-comment">//加锁</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(number==<span class="hljs-number">0</span>){
                <span class="hljs-keyword">try</span> {
                    condition.await(); <span class="hljs-comment">//等待</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            number--;
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ number);
            condition.signalAll(); <span class="hljs-comment">// 通知其他线程</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">//解锁</span>
        }
    }

}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
	<span class="hljs-comment">// 资源类</span>
    <span class="hljs-type">Ticket</span> <span class="hljs-variable">ticke</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ticket</span>();
    <span class="hljs-comment">// 线程A C 执行 +操作   B D执行 -操作</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.increment(); } },<span class="hljs-string">"线程A"</span>).start();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.decrement(); } },<span class="hljs-string">"线程B"</span>).start();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.increment(); } },<span class="hljs-string">"线程C"</span>).start();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.decrement(); } },<span class="hljs-string">"线程D"</span>).start();
}
</code></pre>
<p>注意：多线程下判断使用while，代替 if 就可以防止虚假唤醒。</p>
<p><strong>Condition</strong>接口也提供了类似Object的监视器方法，与Lock配合可以实现 等待/通知模式，Condition可以精准的通知和唤醒的线程！</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * A 执行完 调用B
 * B 执行完 调用C
 * C 执行完 调用A
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Lock版本的 生产者与消费</span>
    <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition1</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition2</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition3</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-comment">// 状态分为  1 condition1执行  2 condition2执行  3 condition3执行</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

    <span class="hljs-comment">// A方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doA</span><span class="hljs-params">()</span>{
        lock.lock();
        <span class="hljs-comment">// 业务 - 判断 - 执行 - 通知</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(state != <span class="hljs-number">1</span>){
                condition1.await(); <span class="hljs-comment">//等待</span>
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ state);
            state = <span class="hljs-number">2</span>;
            condition2.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-comment">// B方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doB</span><span class="hljs-params">()</span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(state != <span class="hljs-number">2</span>){
                condition2.await(); <span class="hljs-comment">//等待</span>
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ state);
            state = <span class="hljs-number">3</span>;
            condition3.signal();
        }<span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-comment">// C方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doC</span><span class="hljs-params">()</span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(state != <span class="hljs-number">3</span>){
                condition3.await(); <span class="hljs-comment">//等待</span>
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ state);
            state = <span class="hljs-number">1</span>;
            condition1.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

}
</code></pre>
<h4 data-id="heading-8">8锁现象</h4>
<p>8锁现象，实际对应的就是8个问题。要清楚判断锁的是谁！永远的知道什么是锁，锁到底锁的是谁！注意：（能用对象锁，就不要用类锁）</p>
<p><strong>问题一 : 在标准情况下，两个线程先打印 发短信 还是 打电话 ？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 4秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.call();}, <span class="hljs-string">"B"</span>).start();
    }
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果是：先打印发短信，然后再打电话！</p>
<p><strong>问题二 : 在发短信方法中，延迟4秒，两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.call();}, <span class="hljs-string">"B"</span>).start();
    }
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception{
    	TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：还是先打印发短信。</p>
<p>首先知道 锁的对象是谁？因为 synchronized 加在方法上，所以锁的对象是 方法的调用者，所以两个方法用的是同一个锁，谁先拿到谁先执行！ 对象锁就是synchronized；</p>
<p>解释：</p>
<ul>
<li>phone对象，就是方法的调用者，也就是手机，它可以打电话和发短信。</li>
<li>现在有两个人线程A 和 线程B，他们一个想打电话，一个想发短信。</li>
<li>线程A，先拿到锁（也就是手机），抱着锁（手机）睡了4秒。</li>
<li>线程B肯定拿不到锁（手机），需要等待。</li>
</ul>
<p><strong>问题三 : Phone类增加一个普通方法，线程B调用，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.hello();}, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">//同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 1秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">//普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"hello"</span>);
    }
}
</code></pre>
<p>结果：先打印hello，然后打印发短信。</p>
<p>解释：</p>
<ul>
<li>锁的是方法的调用者</li>
<li>现在 线程B 调用普通方法，相当于可以远程操控，不需要接收消息</li>
</ul>
<p><strong>问题四 : 创建两个 phone对象，线程调用不同对象的方法，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test4</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone1.seedMsg(); }, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone2.call(); }, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">//同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">//同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
    <span class="hljs-comment">//普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"hello"</span>);
    }
}
</code></pre>
<p>结果：先打印打电话。</p>
<p>解释：synchronized用在方法上，那么锁的是方法的调用者。现在有两个调用者，所以互不影响。</p>
<p><strong>问题五 : 将方法变为静态同步方法，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<p><strong>问题六 : 现在有两个对象，调用不同对象的，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test5</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.call(); }, <span class="hljs-string">"B"</span>).start();
        
        <span class="hljs-comment">// 问题6</span>
        <span class="hljs-comment">// Phone phone1 = new Phone();</span>
        <span class="hljs-comment">// Phone phone2 = new Phone();</span>
        <span class="hljs-comment">// new Thread(()-&gt;{ phone1.seedMsg();}, "A").start();</span>
        <span class="hljs-comment">// new Thread(()-&gt;{ phone2.call();}, "B").start();</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
   <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：先打印发短信。</p>
<p>解释：5、6的问题一样，对于static静态方法来说，对于整个类Class只有一份，对于不同的对象使用的是同一份方法，相当于这个方法是属于这个类，如果静态static方法使用synchronized锁定，那么这个synchronized锁会锁住整个对象！不管多少个对象，对于静态的锁都只有一把锁，谁先拿到这个锁就先执行，其他的进程都需要等待！</p>
<p><strong>问题七 : 资源类中，一个是静态同步方法，一个普通同步方法，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test7</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg(); }, <span class="hljs-string">"A"</span>).start();
         <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.call(); }, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-comment">// 手机</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">// 普通同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：先打印打电话，然后打印发短信</p>
<p>解释：因为一个锁的是Class类，一个锁的是对象调用者。后面那个打电话不需要等待发短信，可以直接运行。</p>
<p><strong>问题一八: 在标准情况下，两个线程先打印 发短信 还是 打电话 ？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test7</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception{
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone1.seedMsg(); }, <span class="hljs-string">"A"</span>).start();
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone2.call(); }, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">// 普通同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：先打印打电话，然后打印发短信</p>
<p>解释：两把锁锁的不是同一个东西，所以后面的第二个对象不需要等待第一个对象的执行。（类锁和对象锁互不干扰）</p>
<p>总结：</p>
<ul>
<li>new 和 this 是一个对象。</li>
<li>static 和 Class 是唯一的一个模板。</li>
</ul>
<p>文件反编译：javap - c xxx.class</p>
<h4 data-id="heading-9">死锁</h4>
<p>有一个线程A，按照先锁a再获得锁b的的顺序获得锁，而在此同时又有另外一个线程B，按照先锁b再锁a的顺序获得锁，从而产生死锁。</p>
<p>死锁检测：</p>
<p><strong>1、使用jps定位进程号，jdk的bin目录下： 有一个jps</strong></p>
<p>命令：<code>jps -l</code></p>
<pre><code class="hljs language-bash" lang="bash"> jps -l   <span class="hljs-comment"># 得到进程编号</span>
</code></pre>
<p><strong>2、使用<code>jstack</code> 进程进程号 找到死锁信息</strong></p>
<p>jstack是java虚拟机自带的一种堆栈跟踪工具，或者 使用jconsole（图形化）进行查看。</p>
<h4 data-id="heading-10">对象内存布局</h4>
<p>在虚拟机中，对象在内存中存储的布局可以分为：对象头、实例数据、对齐填充。
对象头存储内容：Mark Word（对象标记）这里有【hash码，对象所属的年代，对象锁，锁状态标志，偏向锁（线程）ID，偏向时间戳，对象分代年龄】、类型指针、数组长度（只有数组对象才有）；
实例数据：存放类的属性数据信息，包括父类的属性信息；
对齐填充：由于虚拟机要求，对象起始地址必须是8字节的整数倍。
压缩指针：默认是开启的，通过java -XX:+PrintCommandLineFlags -version，可查看是否开启，+代表开启，-代表不开启。</p>
<p>分析对象在JDK的大小和分布，引包该包：</p>
<pre><code class="hljs language-xml" lang="xml"> # openjdk 分析对象在JDK的大小和分布
 <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openjdk.jol<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jol-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
# 使用，可以查看value,第一个（）后3位判断出是什么锁 # 如：001无锁 101偏向锁 000 轻量锁 010重级锁
System.out.println(ClassLayout.parseInstance(对象).toPrintable());
</code></pre>
<h4 data-id="heading-11"><strong>synchronized</strong></h4>
<p>JDK6之前是属于重量级锁，效率底下，通过监听器（monitor）来实现的，它需要从用户状态转向内核状态，所以耗时严重，JDK6之后有了偏向锁、轻量级锁。</p>
<ul>
<li>偏向锁是通过Mark Word（对象标记）存储偏向的线程id；</li>
<li>轻量锁是通过Mark Word（对象标记）存储指向线程栈中的Lock Record指针；</li>
<li>重量锁是通过Mark Word（对象标记）存储指向线程堆中的监听器（monitor）指针；</li>
</ul>
<p><strong>偏向锁</strong>
当线程A第一次争到锁，通过操作修改Mark Word（对象标记）中偏向线程id，使用场景：多线程情况下，在争抢过程中，还可能由同一个线程争取到，就没必要进行从用户状态转向内核状态这部分耗时操作。但在JDK15废弃偏向锁。优点：加锁和解锁不需要额外消耗，缺点：适合一个线程干活，线程之间锁竞争会带来额外的消耗。</p>
<pre><code class="hljs language-xml" lang="xml">-XX:-UseBiasedLocking  # 关闭偏向锁，默认是开启的
</code></pre>
<p><strong>轻量锁</strong>
本质就是自旋锁CAS，不断的尝试获取锁，尽量不阻塞；默认是自旋10次，但在JDK6之后，自旋的次数是不固定的，根据同一个锁上一次自旋的时间，上次时间长，这次就时间长，上次时间短，会根据变短，避免空循环。优点：提高响应速度，缺点：消耗CPU。</p>
<pre><code class="hljs language-xml" lang="xml">-XX:-PreBlockSpin=10  # 默认自旋次数10次，可设置CPU核数一半
</code></pre>
<p><strong>重量锁</strong>
<strong>synchronized</strong> 是重量级的锁，优点：不消耗CPU，追求吞吐量，缺点：线程阻塞，响应慢。</p>
<p>注意：</p>
<p>当一个对象已经计算获取了哈希值之后，就不能进行偏向锁，因为Mark Word（对象标记）空间就那么大，会存储哈希值，而偏向的线程id不再存储，直接进入重量锁。</p>
<h3 data-id="heading-12">集合类不安全</h3>
<blockquote>
<h4 data-id="heading-13">List不安全</h4>
</blockquote>
<p><code>ArrayList</code> 在并发情况下是不安全的！</p>
<p>解决：</p>
<ul>
<li>Vector就是线程安全的</li>
<li>使用Collections.synchronizedList(new ArrayList&lt;&gt;());</li>
<li>使用 List arrayList = new CopyOnWriteArrayList&lt;&gt;();</li>
</ul>
<p><strong>CopyOnWriteArrayList</strong>：写入时复制， 是计算机程序设计领域的一种优化策略</p>
<p>多个线程调用的时候，list，读取的时候，固定的，写入（存在覆盖操作）；在写入的时候避免覆盖，造成数据错乱的问题；</p>
<blockquote>
<h4 data-id="heading-14">Set不安全</h4>
</blockquote>
<p>和List、Set同级的还有一个BlockingQueue 阻塞队列；</p>
<p>Set和List同理可得: 多线程情况下，普通的Set集合是线程不安全的；</p>
<p>解决：</p>
<ul>
<li>使用Collections工具类的synchronized包装的Set类</li>
<li>使用<strong>CopyOnWriteArraySet</strong> 写入复制的JUC解决方案</li>
</ul>
<blockquote>
<h4 data-id="heading-15">Map不安全</h4>
</blockquote>
<p><code>HashMap</code>基础类也存在并发修改异常！</p>
<p>解决：</p>
<ul>
<li>使用Collections.synchronizedMap(new HashMap&lt;&gt;());处理；</li>
<li>使用<strong>ConcurrentHashMap</strong>进行并发处理</li>
</ul>
<h3 data-id="heading-16">阻塞队列</h3>
<p><strong>队列</strong>：是一种特殊的线性表，单向队列只能在一端插入数据（后），另一端删除数据（前）；它和栈一样，队列是一种操作受限制的线性表；由于只能一端删除或者插入，所以只有最先进入队列的才能被删除，因此又被称为先进先出（FIFO—first in first out）线性表。</p>
<p>队列分为两种：</p>
<ul>
<li>单向队列：只能在一端删除数据，另一端插入数据。</li>
<li>双向队列：两端都可以进行插入数据和删除数据操作。</li>
</ul>
<p><strong>阻塞队列</strong>：是一个支持两个附加操作的队列。这两个附加的操作是：在队列为空时，获取元素的线程会等待队列变为非空。当队列满时，存储元素的线程会等待队列可用。</p>
<p>Java里的阻塞队列：</p>
<ul>
<li><strong>ArrayBlockingQueue ：</strong> 一个由数组结构组成的有界阻塞队列。</li>
<li><strong>LinkedBlockingQueue ：</strong> 一个由链表结构组成的有界阻塞队列。</li>
<li><strong>PriorityBlockingQueue ：</strong> 一个支持优先级排序的无界阻塞队列。</li>
<li><strong>DelayQueue：</strong> 一个使用优先级队列实现的无界阻塞队列。</li>
<li><strong>SynchronousQueue：</strong> 一个不存储元素的阻塞队列。</li>
<li><strong>LinkedTransferQueue：</strong> 一个由链表结构组成的无界阻塞队列。</li>
<li><strong>LinkedBlockingDeque：</strong> 一个由链表结构组成的双向阻塞队列。</li>
</ul>
<h4 data-id="heading-17">blockingQueue</h4>
<p>阻塞队列，blockingQueue 是Collection的一个子类；</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e947851b9f24b97a88cf5dee969eade~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103275&amp;x-signature=x51GST02h8IGq11tBuil98DZ6Oc%3D" width="60%" height="60%" alt="" loading="lazy"/>
<p>LinkedBlockingDeque 是一个 Deque（双向的队列），其实现的接口是 BlockingDeque；其余6个阻塞队列则是 Queue（单向队列），实现的接口是 BlockingQueue。</p>
<p><strong>提供了四种处理方法：</strong></p>

































<table><thead><tr><th align="left">方法描述</th><th align="left">抛出异常</th><th align="left">返回特殊的值</th><th align="left">一直阻塞</th><th align="left">超时退出</th></tr></thead><tbody><tr><td align="left">插入数据</td><td align="left">add(e)</td><td align="left">offer(e)</td><td align="left">put(e)</td><td align="left">offer(e,time,unit)</td></tr><tr><td align="left">获取并移除队列的头</td><td align="left">remove()</td><td align="left">poll()</td><td align="left">take()</td><td align="left">poll(time,unit)</td></tr><tr><td align="left">检测队首元素</td><td align="left">element()</td><td align="left">peek()</td><td align="left">-</td><td align="left">-</td></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 抛出异常</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test1</span><span class="hljs-params">()</span>{
    <span class="hljs-comment">// 需要初始化队列的大小</span>
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加</span>
    deque.add(<span class="hljs-string">"a"</span>);
    deque.add(<span class="hljs-string">"c"</span>);
    deque.add(<span class="hljs-string">"b"</span>);
    <span class="hljs-comment">// 抛出异常：java.lang.IllegalStateException: Queue full</span>
    <span class="hljs-comment">// deque.add("e");</span>
    <span class="hljs-comment">// 移除</span>
    deque.remove();
    <span class="hljs-comment">// deque.remove();</span>
    <span class="hljs-comment">// deque.remove();</span>
    System.out.println(deque);
    <span class="hljs-comment">//判断队列首</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> deque.element();
    System.out.println(element);
}

<span class="hljs-comment">// 不抛出异常</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test2</span><span class="hljs-params">()</span>{
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加</span>
    deque.offer(<span class="hljs-string">"a"</span>);
    deque.offer(<span class="hljs-string">"c"</span>);
    deque.offer(<span class="hljs-string">"b"</span>); <span class="hljs-comment">//true</span>
    <span class="hljs-comment">// 一个不能添加的元素 使用offer只会返回 false 不会抛出异常</span>
    System.out.println( deque.offer(<span class="hljs-string">"e"</span>));
    <span class="hljs-comment">// 移除</span>
    deque.poll();
    <span class="hljs-comment">// 移除 如果没有元素 只会返回null 不会抛出异常</span>
    System.out.println(deque);
    <span class="hljs-comment">// 判断队列首</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> deque.peek();
    System.out.println(element);
}

<span class="hljs-comment">// 等待 一直阻塞</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加 一直阻塞 不会返回</span>
    deque.put(<span class="hljs-string">"a"</span>);
    <span class="hljs-comment">// 如果队列已经满了， 再进去一个元素  这种情况会一直等待这个队列 什么时候有了位置再进去，程序不会停止</span>
    <span class="hljs-comment">// deque.put("e");</span>
    <span class="hljs-comment">// 移除</span>
    deque.take();
    <span class="hljs-comment">// deque.take();</span>
    <span class="hljs-comment">// 如果我们再来一个  这种情况也会等待，程序会一直运行 阻塞</span>
}


<span class="hljs-comment">// 等待 超时阻塞</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加 这种情况也会等待队列有位置 或者有产品 但是会超时结束</span>
    deque.offer(<span class="hljs-string">"a"</span>,<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    deque.offer(<span class="hljs-string">"b"</span>,<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    <span class="hljs-comment">// 超时时间2s 等待如果超过2s就结束等待</span>
    <span class="hljs-comment">// 移除</span>
    deque.poll(<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    deque.poll(<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    <span class="hljs-comment">// 超过两秒 我们就不要等待了</span>
    System.out.println(deque);
}
</code></pre>
<h4 data-id="heading-18">SynchronousQueue</h4>
<p>同步队列：没有容量，也可以视为容量为1的队列；</p>
<p>进去一个元素，必须等待取出来之后，才能再往里面放入一个元素；</p>
<p>put方法 和 take方法；</p>
<p>Synchronized 和 其他的BlockingQueue 不一样 它不存储元素；</p>
<p>put了一个元素，就必须从里面先take出来，否则不能再put进去值！</p>
<p>并且SynchronousQueue 的take是使用了lock锁保证线程安全的。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>{
     BlockingQueue&lt;String&gt; synchronousQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;();

    <span class="hljs-comment">// 使用两个进程</span>
    <span class="hljs-comment">// 一个进程 放进去  一个进程 拿出来</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{
        <span class="hljs-keyword">try</span> {
            System.out.println(Thread.currentThread().getName()+<span class="hljs-string">" Put 1"</span>);
            synchronousQueue.put(<span class="hljs-string">"1"</span>);
            System.out.println(Thread.currentThread().getName()+<span class="hljs-string">" Put 2"</span>);
            synchronousQueue.put(<span class="hljs-string">"2"</span>);
            System.out.println(Thread.currentThread().getName()+<span class="hljs-string">" Put 3"</span>);
            synchronousQueue.put(<span class="hljs-string">"3"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    },<span class="hljs-string">"T1"</span>).start();

    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{
        <span class="hljs-keyword">try</span> {
            System.out.println(Thread.currentThread().getName()
                               +<span class="hljs-string">" Take "</span>+synchronousQueue.take());
            <span class="hljs-comment">//                TimeUnit.SECONDS.sleep(3);</span>
            System.out.println(Thread.currentThread().getName()
                               +<span class="hljs-string">" Take "</span>+synchronousQueue.take());
            <span class="hljs-comment">//                TimeUnit.SECONDS.sleep(3);</span>
            System.out.println(Thread.currentThread().getName()
                               +<span class="hljs-string">" Take "</span>+synchronousQueue.take());
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    },<span class="hljs-string">"T2"</span>).start();
}
</code></pre>
<h3 data-id="heading-19">创建线程</h3>
<p>我们之前创建线程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ System.out.println(<span class="hljs-string">"任务模块"</span>);},<span class="hljs-string">"线程名1"</span>).start();
</code></pre>
<p>Callable创建线程：</p>
<p>Java库具有FutureTask类型，该类型实现Runnable和Future，并方便地将两种功能组合在一起。可以通过为其构造函数提供Callable来创建FutureTask。然后，将FutureTask对象提供给Thread的构造函数以创建Thread对象。因此，间接地使用Callable创建线程。</p>
<p><strong>使用Callable和Future的完整示例:</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallableTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) {
<span class="hljs-comment">//            new Thread(new Runnable()).start();</span>
<span class="hljs-comment">//            new Thread(new FutureTask&lt;&gt;( Callable)).start();</span>
            <span class="hljs-comment">//适配类：FutureTask</span>
            FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>());
            <span class="hljs-comment">//放入Thread使用</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask,String.valueOf(i)).start();
            <span class="hljs-comment">//获取返回值</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> futureTask.get();
            System.out.println(<span class="hljs-string">"返回值："</span>+ s);
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"Call-线程："</span>+Thread.currentThread().getName());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"String"</span>+Thread.currentThread().getName();
    }
}
</code></pre>
<p>注意：使用Callable进行多线程操作，多个线程结果会被缓存，效率高。这个get 方法可能会产生阻塞！把他放到 最后，或者使用异步通信来处理！</p>
<p>Callable接口与Runnable接口的区别：</p>
<ul>
<li>是否有返回值</li>
<li>是否抛出异常</li>
<li>一个是call()，一个是run()</li>
</ul>
<h4 data-id="heading-20">线程池</h4>
<p>优点：</p>
<ul>
<li>降低资源消耗</li>
<li>提高响应速度</li>
<li>提高线程的可管理性</li>
</ul>
<p>池化技术：事先准备好一些资源，如果有人要用，就来我这里拿，用完之后还给我，以此来提高效率。</p>
<h4 data-id="heading-21">线程池的使用</h4>
<h5 data-id="heading-22">Executors：</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建线程池</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-comment">// 单个线程</span>
    <span class="hljs-comment">// ExecutorService executorService = Executors.newSingleThreadExecutor(); </span>
    <span class="hljs-comment">// 创建一个固定的线程池的大小</span>
    <span class="hljs-comment">// ExecutorService executorService = Executors.newFixedThreadPool(5);   </span>
    <span class="hljs-comment">// 可伸缩的</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();   
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">80</span>; i++){
            <span class="hljs-comment">//使用线程池之后创建线程</span>
            executorService.execute(()-&gt;{
                System.out.println(Thread.currentThread().getName()+ <span class="hljs-string">" ok"</span>);
            });
        }
    } <span class="hljs-keyword">finally</span> {
        executorService.shutdown();
    }
}
</code></pre>
<p>源码分析：线程池的真正实现类是<strong>ThreadPoolExecutor</strong>，有7大参数</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,    //核心线程池大小
                          <span class="hljs-type">int</span> maximumPoolSize, //最大的线程池大小
                          <span class="hljs-type">long</span> keepAliveTime,  //超时了没有人调用就会释放
                          TimeUnit unit, //超时单位
                          BlockingQueue&lt;Runnable&gt; workQueue, //阻塞队列
                          ThreadFactory threadFactory, //线程工厂 创建线程的 一般不用动
                          RejectedExecutionHandler handler //拒绝策略
                         )</span> {
    <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||
        maximumPoolSize &lt;= <span class="hljs-number">0</span> ||
        maximumPoolSize &lt; corePoolSize ||
        keepAliveTime &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();
    <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-literal">null</span> || threadFactory == <span class="hljs-literal">null</span> || handler == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
    <span class="hljs-built_in">this</span>.corePoolSize = corePoolSize;
    <span class="hljs-built_in">this</span>.maximumPoolSize = maximumPoolSize;
    <span class="hljs-built_in">this</span>.workQueue = workQueue;
    <span class="hljs-built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);
    <span class="hljs-built_in">this</span>.threadFactory = threadFactory;
    <span class="hljs-built_in">this</span>.handler = handler;
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4ccac6cfda04c7abba3b205634069c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103275&amp;x-signature=yfEzrt5i1dHGevR5WvIT%2B46B5Hs%3D" alt="img" loading="lazy"/></p>
<h5 data-id="heading-23">ThreadPoolExecutor</h5>
<p>自定义创建线程池，参数类型就是7大参数，分别是 核心线程池大小、最大的线程池大小、超时了没有人调用就会释放、超时单位、阻塞队列、线程工厂 创建线程的 一般不用动、拒绝策略</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-comment">// 注意：</span>
    <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">threadPoolExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, TimeUnit.SECONDS,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>), Executors.defaultThreadFactory(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy() <span class="hljs-comment">//拒绝策略</span>
    );
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">80</span>; i++){
            <span class="hljs-comment">//使用线程池之后创建线程</span>
            threadPoolExecutor.execute(()-&gt;{
                System.out.println(Thread.currentThread().getName()+ <span class="hljs-string">" ok"</span>);
            });
        }
    } <span class="hljs-keyword">finally</span> {
        threadPoolExecutor.shutdown();
    }
}
</code></pre>
<p>等待队列已经满了，塞不下新任务，同时，线程池中max线程也达到了，无法继续新任务。这个时候就需要拒绝策略机制</p>
<p>拒绝策略有4种：</p>
<ul>
<li>AbortPolicy：如果阻塞队列满了，直接抛出异常阻止系统正常运行，队列容量大小 + maxPoolSize</li>
<li>CallerRunsPolicy：如果阻塞队列满了，该策略不会抛弃任务，也不抛出异常，而是将任务回退给调用者</li>
<li>DiscardOldestPolicy：如果阻塞队列满了，抛弃队列中等待最久的任务，把当前任务加入队列中再次提交</li>
<li>DiscardPolicy：如果阻塞队列满了，丢弃无法处理的任务，不抛出异常，如果允许任务丢失，是最好的策略</li>
</ul>
<p><strong>如何去设置线程池的最大大小如何去设置？</strong></p>
<ul>
<li>
<p>CPU密集型：电脑的核数是几核就选择几；选择maximunPoolSize的大小</p>
<pre><code class="hljs language-java" lang="java">Runtime.getRuntime().availableProcessors()  <span class="hljs-comment">// 获取CPU核数</span>
</code></pre>
</li>
<li>
<p>I/O密集型：在程序中有15个大型任务，io十分占用资源；I/O密集型就是判断我们程序中十分耗I/O的线程数量，大约是最大I/O数的一倍到两倍之间。</p>
</li>
</ul>
<h3 data-id="heading-24">单例模式</h3>
<p>设计模式之一：单例模式。</p>
<p>最重要的思想，构造方法私有，private。保证内存中只有一个对象。</p>
<h4 data-id="heading-25">饿汉式：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hungry</span> {

    <span class="hljs-comment">// 可能会浪费空间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>];
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>];
	....

    <span class="hljs-comment">// 构造方法私有 ---</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Hungry</span><span class="hljs-params">()</span>{
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Hungry</span> <span class="hljs-variable">HUNGRY</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hungry1</span>();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Hungry <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">return</span> HUNGRY;
    }
    
}
</code></pre>
<p>一上来，把这里面的全部都加载出来，在没有使用这个对象，对象就已经存在，浪费空间。所以有了懒汉式，使用就创建对象，平时不加载。</p>
<h4 data-id="heading-26">懒汉式式：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyMan</span> {
    <span class="hljs-comment">// 构造方法私有 ---</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazyMan</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> LazyMan LazyMan；
    <span class="hljs-comment">// 如果对象存在就加载，平常不加载</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazyMan <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">if</span> (LazyMan==<span class="hljs-literal">null</span>){
            LazyMan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyMan</span>();
        }
        <span class="hljs-keyword">return</span> LazyMan;
    }
}
</code></pre>
<p>但在多线程下是有问题的。需要进行双重检测锁模式，再加上volatile关键字，DCL懒汉式。</p>
<p>但是通过反射，还是能破坏程序，所以我们需要在构造器上锁，通过枚举进行判断，枚举不能被反射。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux部署MySQL8]]></title>    <link>https://juejin.cn/post/7599852579066462223</link>    <guid>https://juejin.cn/post/7599852579066462223</guid>    <pubDate>2026-01-27T07:22:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852579066462223" data-draft-id="7599852636528738339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux部署MySQL8"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T07:22:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WiseSheep"/> <meta itemprop="url" content="https://juejin.cn/user/3123091067642990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux部署MySQL8
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123091067642990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WiseSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:22:13.000Z" title="Tue Jan 27 2026 07:22:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前置检查</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查并卸载冲突的mariadb（与MySQL冲突）</span>
rpm -qa | grep mariadb
<span class="hljs-comment"># 替换为实际查到的包名</span>
rpm -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64

<span class="hljs-comment"># 查看系统位数（64位/32位）</span>
getconf LONG_BIT
<span class="hljs-comment"># 查看glibc版本（需匹配安装包）</span>
getconf GNU_LIBC_VERSION
<span class="hljs-comment"># 查看架构（x86_64=amd64）</span>
<span class="hljs-built_in">uname</span> -m
</code></pre>
<h2 data-id="heading-1">二、下载 MySQL 安装包</h2>
<pre><code class="hljs language-bash" lang="bash">wget -c https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.42-linux-glibc2.28-x86_64.tar.xz -P /opt/data
</code></pre>
<h2 data-id="heading-2">三、解压并创建专用用户</h2>
<p>解压安装包并创建 MySQL 专用系统用户</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入安装目录</span>
<span class="hljs-built_in">cd</span> /opt/data
<span class="hljs-comment"># 解压</span>
tar -Jxvf mysql-8.2.0-linux-glibc2.17-x86_64.tar.xz
<span class="hljs-comment"># 重命名</span>
<span class="hljs-built_in">mv</span> mysql-8.2.0-linux-glibc2.17-x86_64 mysql8
<span class="hljs-comment"># 创建mysql用户组和系统用户（-r表示不可登录系统）</span>
groupadd mysql
useradd -r -g mysql mysql
<span class="hljs-comment"># 创建数据存储目录</span>
<span class="hljs-built_in">mkdir</span> -p mysql8/data
</code></pre>
<h2 data-id="heading-3">四、配置 MySQL 核心参数</h2>
<p>创建配置文件并指定基础路径、端口、字符集等核心参数</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑配置文件</span>
vim /opt/data/mysql8/conf/my.cnf
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[client]</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data/mysql.sock  <span class="hljs-comment"># 客户端连接套接字</span>

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">bind-address</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>        <span class="hljs-comment"># 允许所有IP访问</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">3306</span>                   <span class="hljs-comment"># 监听端口</span>
<span class="hljs-attr">user</span>=mysql                  <span class="hljs-comment"># 运行用户</span>
<span class="hljs-attr">basedir</span>=/opt/data/mysql8    <span class="hljs-comment"># 安装根目录</span>
<span class="hljs-attr">datadir</span>=/opt/data/mysql8/data  <span class="hljs-comment"># 数据存储目录</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data/mysql.sock
<span class="hljs-attr">log-error</span>=/opt/data/mysql8/data/mysql.err  <span class="hljs-comment"># 错误日志</span>
<span class="hljs-attr">pid-file</span>=/opt/data/mysql8/data/mysql.pid    <span class="hljs-comment"># 进程ID文件</span>
<span class="hljs-attr">max_connections</span>=<span class="hljs-number">10000</span>       <span class="hljs-comment"># 最大连接数</span>
<span class="hljs-attr">max_user_connections</span>=<span class="hljs-number">2000</span>   <span class="hljs-comment"># 单用户最大连接数</span>
<span class="hljs-attr">wait_timeout</span>=<span class="hljs-number">200</span>            <span class="hljs-comment"># 连接超时时间</span>
<span class="hljs-attr">character_set_server</span>=utf8mb4 <span class="hljs-comment"># 默认字符集（支持emoji）</span>
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>            <span class="hljs-comment"># 禁用符号链接</span>
<span class="hljs-attr">explicit_defaults_for_timestamp</span>=<span class="hljs-literal">true</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归设置目录所属用户和用户组</span>
<span class="hljs-built_in">chown</span> -R mysql:mysql mysql8
</code></pre>
<h2 data-id="heading-4">五、初始化并启动 MySQL</h2>
<p>初始化数据库（生成临时密码），安装依赖后启动服务</p>
<p>出现如下错误需安装libaio
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73c18172b33449deb663fac1e9179cd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=9kAQOZ5VzMxjTBOqPG%2FQNbCxo5o%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装依赖（初始化缺失libaio时执行）</span>
yum -y install libaio
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化数据库（指定配置文件和用户）</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my.cnf --basedir=/opt/data/mysql8 --datadir=/opt/data/mysql8/data --user=mysql --initialize

<span class="hljs-comment"># 查看初始临时密码（关键！用于首次登录）</span>
<span class="hljs-built_in">cat</span> /opt/data/mysql8/data/mysql.err
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d056d811ae34473b6bedb97b5740bce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=vELJWp9G0kjRm0YmHr%2BnD4S7V%2FE%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 后台启动MySQL服务</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my.cnf --user=mysql --daemonize
</code></pre>
<h2 data-id="heading-5">六、首次登录并修改密码</h2>
<p>使用临时密码登录，重置密码并开放远程访问（MySQL8 + 需指定加密方式）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录MySQL（输入临时密码）</span>
/opt/data/mysql8/bin/mysql --defaults-file=/opt/data/mysql8/conf/my.cnf -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 查看用户信息</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>, host, plugin <span class="hljs-keyword">from</span> mysql.user;

<span class="hljs-comment">-- 2. 修改root密码（指定mysql_native_password加密，兼容旧客户端）mysql8+密码使用sha2加密，需指定算法</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;

<span class="hljs-comment">-- 3. 允许root从任意IP访问（%表示所有IP，生产环境建议指定具体IP）</span>
<span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">'%'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;

<span class="hljs-comment">-- 4. 刷新权限生效</span>
FLUSH PRIVILEGES;
</code></pre>
<h2 data-id="heading-6">七、配置 MySQL 主从复制（单机模拟）</h2>
<p>在同一台机器创建主库（8001 端口）和从库（8002 端口），实现数据同步</p>
<h3 data-id="heading-7">1. 创建主从库目录</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 主库数据目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/data/mysql8/data_master
<span class="hljs-comment"># 从库数据目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/data/mysql8/data_slave
</code></pre>
<h3 data-id="heading-8">2. 配置主库（my_master.cnf）</h3>
<pre><code class="hljs language-bash" lang="bash">vim /opt/data/mysql8/conf/my_master.cnf
</code></pre>
<p>写入如下内容</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[client]</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_master/mysql.sock

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">server-id</span>=<span class="hljs-number">1</span>                 <span class="hljs-comment"># 主库唯一ID（不可重复）</span>
<span class="hljs-attr">log-bin</span>=mysql-bin           <span class="hljs-comment"># 开启二进制日志（主从核心）</span>
<span class="hljs-attr">bind-address</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">8001</span>
<span class="hljs-attr">user</span>=mysql
<span class="hljs-attr">basedir</span>=/opt/data/mysql8
<span class="hljs-attr">datadir</span>=/opt/data/mysql8/data_master
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_master/mysql.sock
<span class="hljs-attr">log-error</span>=/opt/data/mysql8/data_master/mysql.err
<span class="hljs-attr">pid-file</span>=/opt/data/mysql8/data_master/mysql.pid
<span class="hljs-attr">max_connections</span>=<span class="hljs-number">10000</span>
<span class="hljs-attr">max_user_connections</span>=<span class="hljs-number">2000</span>
<span class="hljs-attr">wait_timeout</span>=<span class="hljs-number">200</span>
<span class="hljs-attr">character_set_server</span>=utf8mb4
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">explicit_defaults_for_timestamp</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># binlog-do-db = test       # 可选：仅同步主库中的test库</span>
<span class="hljs-comment"># binlog-ignore-db = test   # 可选：忽略主库中的test库同步</span>
</code></pre>
<h3 data-id="heading-9">3. 配置从库（my_slave.cnf）</h3>
<pre><code class="hljs language-bash" lang="bash">vim /opt/data/mysql8/conf/my_slave.cnf
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[client]</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_slave/mysql.sock

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">server-id</span>=<span class="hljs-number">2</span>                 <span class="hljs-comment"># 从库唯一ID（需与主库不同）</span>
<span class="hljs-attr">log-bin</span>=mysql-bin
<span class="hljs-attr">read_only</span>=<span class="hljs-number">1</span>                 <span class="hljs-comment"># 从库只读（super用户除外）</span>
<span class="hljs-attr">bind-address</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">8002</span>
<span class="hljs-attr">user</span>=mysql
<span class="hljs-attr">basedir</span>=/opt/data/mysql8
<span class="hljs-attr">datadir</span>=/opt/data/mysql8/data_slave
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_slave/mysql.sock
<span class="hljs-attr">log-error</span>=/opt/data/mysql8/data_slave/mysql.err
<span class="hljs-attr">pid-file</span>=/opt/data/mysql8/data_slave/mysql.pid
<span class="hljs-attr">max_connections</span>=<span class="hljs-number">10000</span>
<span class="hljs-attr">max_user_connections</span>=<span class="hljs-number">2000</span>
<span class="hljs-attr">wait_timeout</span>=<span class="hljs-number">200</span>
<span class="hljs-attr">character_set_server</span>=utf8mb4
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">explicit_defaults_for_timestamp</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># replicate-do-db = test    # 可选：仅复制主库中的test库</span>
<span class="hljs-comment"># replicate-ignore-db = test# 可选：忽略主库中的test库复制</span>
</code></pre>
<h3 data-id="heading-10">4. 初始化并启动主从库</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化主库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_master.cnf --basedir=/opt/data/mysql8 --datadir=/opt/data/mysql8/data_master --user=mysql --initialize

<span class="hljs-comment"># 初始化从库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_slave.cnf --basedir=/opt/data/mysql8 --datadir=/opt/data/mysql8/data_slave --user=mysql --initialize

<span class="hljs-comment"># 查看主/从库临时密码</span>
<span class="hljs-built_in">cat</span> /opt/data/mysql8/data_master/mysql.err  <span class="hljs-comment"># 主库示例：QzPwayyQe5(p</span>
<span class="hljs-built_in">cat</span> /opt/data/mysql8/data_slave/mysql.err   <span class="hljs-comment"># 从库示例：+&amp;9+6d62Uiw-</span>

<span class="hljs-comment"># 启动主库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_master.cnf --user=mysql --daemonize

<span class="hljs-comment"># 启动从库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_slave.cnf --user=mysql --daemonize
</code></pre>
<h3 data-id="heading-11">5. 配置主从同步权限</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录主库（输入主库临时密码）</span>
/opt/data/mysql8/bin/mysql --defaults-file=/opt/data/mysql8/conf/my_master.cnf -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 修改主库root密码并开放远程访问</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">'%'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 创建从库同步专用用户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'slave'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">GRANT</span> REPLICATION SLAVE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'slave'</span>@<span class="hljs-string">'%'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 查看主库二进制日志信息（记录file和pos，用于从库配置）</span>
<span class="hljs-keyword">show</span> master status\G;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a229d8730b444e818fe1a8b1830f60a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=BdeQ7z0LaSUegEIijiBFjyyPGaE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">6. 配置从库同步</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录从库（输入从库临时密码）</span>
/opt/data/mysql8/bin/mysql --defaults-file=/opt/data/mysql8/conf/my_slave.cnf -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 修改从库root密码</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">'%'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 指定主库</span>
change master <span class="hljs-keyword">to</span> master_host<span class="hljs-operator">=</span><span class="hljs-string">'116.198.230.30'</span>,master_port<span class="hljs-operator">=</span><span class="hljs-number">8001</span>,master_user<span class="hljs-operator">=</span><span class="hljs-string">'slave'</span>,master_password<span class="hljs-operator">=</span><span class="hljs-string">'123456'</span>,master_log_file<span class="hljs-operator">=</span><span class="hljs-string">'mysql-bin.000002'</span>,master_log_pos<span class="hljs-operator">=</span><span class="hljs-number">3376</span>;

<span class="hljs-comment">-- 启动从库同步</span>
<span class="hljs-keyword">start</span> slave;

<span class="hljs-comment">-- 查看同步状态（Slave_IO_Running和Slave_SQL_Running均为Yes则成功）</span>
<span class="hljs-keyword">show</span> slave status\G;

<span class="hljs-comment">-- 创建从库只读用户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'slave_read'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'slave_read'</span>@<span class="hljs-string">'%'</span>;
FLUSH PRIVILEGES;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba09e23765b040ba955fa7b69b6499dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=Vo8G9DORdzKUJpu7unL5zKsSR4s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">7. 验证主从同步</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 登录主库创建测试库</span>
<span class="hljs-keyword">create</span> database test;

<span class="hljs-comment">-- 登录从库查看是否同步</span>
<span class="hljs-keyword">show</span> databases;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b68bb5fe1bc4a749e6d550a52d449b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=A%2BzrNtWFWwZ6dvqeYKYZBhe0KH8%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你真的清楚GO语言的defer吗？]]></title>    <link>https://juejin.cn/post/7599614131424051209</link>    <guid>https://juejin.cn/post/7599614131424051209</guid>    <pubDate>2026-01-27T07:24:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599614131424051209" data-draft-id="7599640782570274843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你真的清楚GO语言的defer吗？"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-01-27T07:24:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yuanji6666"/> <meta itemprop="url" content="https://juejin.cn/user/1751944348856905"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你真的清楚GO语言的defer吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1751944348856905/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yuanji6666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:24:48.000Z" title="Tue Jan 27 2026 07:24:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Defer</h2>
<blockquote>
<p>Go's <code>defer</code> statement schedules a function call (the <em>deferred</em> function) to be run immediately before the function executing the <code>defer</code> returns. It's an unusual but effective way to deal with situations such as resources that must be released regardless of which path a function takes to return. The canonical examples are unlocking a mutex or closing a file.</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Feffective_go%23defer" target="_blank" title="https://go.dev/doc/effective_go#defer" ref="nofollow noopener noreferrer">官方文档</a></p>
<h2 data-id="heading-1">执行顺序</h2>
<p>LIFO 依次压栈，执行顺序与defer的顺序相反</p>
<h2 data-id="heading-2">参数求值时机</h2>
<blockquote>
<p>The arguments to the deferred function (which include the receiver if the function is a method) are evaluated when the <em>defer</em> executes, not when the <em>call</em> executes.Besides avoiding worries about variables changing values as the function executes, this means that a single deferred call site can defer multiple function executions.</p>
</blockquote>
<p>defer的函数的参数，在defer执行时就已经确定，而不是函数调用时：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span>{
	a <span class="hljs-type">int</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Test)</span></span> <span class="hljs-built_in">print</span>(x <span class="hljs-type">int</span>){
	fmt.Printf(<span class="hljs-string">"a is %v, x is %v "</span>, t.a, x)
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferRun</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
	test := Test{<span class="hljs-number">1</span>}
	num := <span class="hljs-number">1</span> 
	<span class="hljs-keyword">defer</span> test.<span class="hljs-built_in">print</span>(num)
	num++
	test.a++
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	deferRun()	
}
</code></pre>
<p>运行结果：</p>
<pre><code class="hljs language-go" lang="go">a is <span class="hljs-number">1</span>, x is <span class="hljs-number">1</span>
</code></pre>
<h2 data-id="heading-3">return时具体做了什么？</h2>
<p>我们知道，defer 函数在return时调用，但是具体做了什么？</p>
<p>只需弄清楚三步：</p>
<ol>
<li>设置result</li>
<li>执行defer</li>
<li>返回result</li>
</ol>
<p>来看具体例子：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
   res := deferRun()
   fmt.Println(res)<span class="hljs-comment">//输出2</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferRun</span><span class="hljs-params">()</span></span> (res <span class="hljs-type">int</span>) {
  num := <span class="hljs-number">1</span>
  <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    res++
  }()  
  <span class="hljs-keyword">return</span> num
  <span class="hljs-comment">// res = num </span>
  <span class="hljs-comment">// res ++</span>
  <span class="hljs-comment">// return res</span>
}
</code></pre>
<p>无论怎样的过程，从这三步分析就不会出错</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入浅出 Java 中的 CompletableFuture：让异步编程变得简单]]></title>    <link>https://juejin.cn/post/7599640782570323995</link>    <guid>https://juejin.cn/post/7599640782570323995</guid>    <pubDate>2026-01-27T07:21:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782570323995" data-draft-id="7599640782570225691" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入浅出 Java 中的 CompletableFuture：让异步编程变得简单"/> <meta itemprop="keywords" content="后端,面试"/> <meta itemprop="datePublished" content="2026-01-27T07:21:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="让我上个超影吧"/> <meta itemprop="url" content="https://juejin.cn/user/3411151088782442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入浅出 Java 中的 CompletableFuture：让异步编程变得简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411151088782442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    让我上个超影吧
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:21:29.000Z" title="Tue Jan 27 2026 07:21:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家在开发中有没有遇到过这样的场景：需要同时调用好几个接口，等所有接口都返回结果后再进行下一步处理？或者某个操作依赖另一个操作的结果，但又不想让程序一直等着？</p>
<p>如果还用传统的多线程或者 Future 来处理，代码往往写得又复杂又难维护。今天就来给大家介绍一个 Java 8 引入的异步编程神器 ——<strong>CompletableFuture</strong>，它能让这些复杂的异步操作变得简单优雅。</p>
<h2 data-id="heading-0">一、什么是 CompletableFuture？</h2>
<p>简单说，CompletableFuture 是一个「可以手动完成的 Future」。它不仅能像普通 Future 那样执行异步任务，还提供了一堆实用的方法，让我们可以轻松实现：</p>
<blockquote>
<ul>
<li>链式调用（上一个任务完成后自动执行下一个）</li>
<li>组合多个任务（不管是有依赖关系还是完全独立）</li>
<li>优雅处理异常（不用担心异步任务的异常被悄悄吃掉）</li>
</ul>
</blockquote>
<p>形象点说，普通 Future 就像寄快递，只能等快递到了自己去取；而 CompletableFuture 更像「快递上门」，不仅能自动通知你，还能帮你把快递拆开、分类，甚至直接送到指定位置。</p>
<p><strong><code>CompletableFuture</code></strong> <strong>同时实现了</strong> <strong><code>Future</code></strong> <strong>和</strong> <strong><code>CompletionStage</code></strong> <strong>接口</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CompletableFuture</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">implements</span> <span class="hljs-title">Future</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">CompletionStage</span>&lt;<span class="hljs-title">T</span>&gt; {
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fee45f443a4e25b39506ace810ca2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=341DRX2PjThYZ0KTVT0WAO%2FfMXY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdff93b37615499aa4c07017e1c653b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=nJ3p5qKvyhncru6GshtAhE1buxQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98a562acda7648d09fc391f00874f007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=cf6qPWP%2F3MSL1qhdBGRM4pEDlmw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、入门：创建第一个 CompletableFuture</h2>
<p>创建 CompletableFuture 主要靠两个<strong>静态方法</strong>，先看个简单例子：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutionException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstCompletableFuture</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException {
        <span class="hljs-comment">// 1. 有返回值的异步任务：supplyAsync</span>
        CompletableFuture&lt;String&gt; foodFuture = CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 模拟耗时操作（比如调用接口查外卖）try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"麻辣烫"</span>; <span class="hljs-comment">// 任务结果</span>
        });

        <span class="hljs-comment">// 2. 无返回值的异步任务：runAsync</span>
        CompletableFuture&lt;Void&gt; noticeFuture = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-comment">// 模拟耗时操作（比如发送通知）try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            System.out.println(<span class="hljs-string">"已通知用户：外卖正在配送中"</span>);
        });

        <span class="hljs-comment">// 获取第一个任务的结果（会等任务完成）String food = foodFuture.get();</span>
        System.out.println(<span class="hljs-string">"用户点的是："</span> + food);

        <span class="hljs-comment">// 等待第二个任务完成（虽然它没返回值，但我们需要它执行完）</span>
        noticeFuture.get();
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/526b32e8d5cd4649993e0667fdf63bc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=jPqKJXYsZhtkx5H%2FtOXeL6V0yZg%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43580dc17ad4463584053b36745ff439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=xjZ%2FirHVbKebbb74RQXPjNZhNus%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da868e79a8964a9baf83ef69276594f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=jhbtPOMBNSGrg5ZFAqLNJ9Qmhtc%3D" alt="" loading="lazy"/></p>
<p><strong>关键点：</strong></p>
<p><code>1.supplyAsync</code> <strong><code>（带Async表示是异步）</code></strong> ：适合有返回结果的任务（比如查数据、算结果），参数是一个 <code>Supplier</code>（带返回值的函数）。</p>
<pre><code class="hljs language-scss" lang="scss">public static &lt;U&gt; CompletableFuture&lt;U&gt; <span class="hljs-built_in">supplyAsync</span>(Supplier&lt;U&gt; supplier) {
        return <span class="hljs-built_in">asyncSupplyStage</span>(asyncPool, supplier);
    }

    <span class="hljs-comment">//使用自定义线程池，比较推荐public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier,</span>
                                                       Executor executor) {
        return <span class="hljs-built_in">asyncSupplyStage</span>(screenExecutor(executor), supplier);
    }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fad858ce377945bd9f5d8af7595cb215~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=KGHppjI22PykDSYLhwlWfCAZgIs%3D" alt="" loading="lazy"/></p>
<p><code>2.runAsync</code>：适合无返回结果的任务（比如发日志、发通知），参数是一个 <code>Runnable</code>（无返回值的函数）。</p>
<pre><code class="hljs language-scss" lang="scss">    public static CompletableFuture&lt;Void&gt; <span class="hljs-built_in">runAsync</span>(Runnable runnable) {
        return <span class="hljs-built_in">asyncRunStage</span>(asyncPool, runnable);
    }

    <span class="hljs-comment">//使用自定义线程池，比较推荐public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable,</span>
                                                   Executor executor) {
        return <span class="hljs-built_in">asyncRunStage</span>(screenExecutor(executor), runnable);
    }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5967420bfe6457b984c4d875a250aac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=FmG%2BPEukGr31fUs0b%2BIFixqeGSc%3D" alt="" loading="lazy"/></p>
<p>3.两个任务是<strong>并行</strong> <strong>执行</strong>的，所以通知先完成（只等了 500ms），外卖查询后完成（等了 1000ms）。</p>
<h2 data-id="heading-2">三、进阶：链式操作，让任务像流水线一样执行</h2>
<p>最能体现 CompletableFuture 强大的，就是它的<strong>链式操作</strong>。不用手动等待上一个任务完成，直接指定「下一个要做什么」。</p>
<p>比如我们要完成这样一个流程：</p>
<blockquote>
<ol>
<li>查用户 ID（耗时 1s）</li>
<li>用 ID 查用户名（耗时 0.5s）</li>
<li>打印用户名（耗时忽略）</li>
</ol>
</blockquote>
<p>用链式操作实现，代码会非常清爽：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompletableFutureChain</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        <span class="hljs-comment">// 链式操作：一步接一步执行</span>
        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; pipeline = CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 第一步：查用户IDtry { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"第一步：查到用户ID = 10086"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">10086</span>; <span class="hljs-comment">// 把结果传给下一步</span>
        }).thenApply(userId -&gt; {
            <span class="hljs-comment">// 第二步：用ID查用户名（接收上一步的结果）try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"第二步：用ID "</span> + userId + <span class="hljs-string">" 查到用户名 = 小明"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"小明"</span>; <span class="hljs-comment">// 再把结果传给下一步</span>
        }).thenAccept(username -&gt; {
            <span class="hljs-comment">// 第三步：打印用户名（接收上一步的结果，无返回值）</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"第三步：最终用户名是 "</span> + username);
        });

        <span class="hljs-comment">// 等待整个流水线完成</span>
        pipeline.<span class="hljs-keyword">get</span>();
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45022eca2d184da8b2b1f0ead202d2cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=8IUy6GGjQ8arLO9QqwKkStgI6v0%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55970080f2bb455cbfe1d59553fdfaa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=CcsG8a1z7WZry1B5rCAnIkDq21Q%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0766b8bd401c4810b0419d39279ffcf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=DhT8RhYFI4NfJaJgMPYCfYEm8CQ%3D" alt="" loading="lazy"/></p>
<p><strong>常用链式方法：</strong></p>
<blockquote>
<ul>
<li><code>thenApply</code>：<strong>接收上一步结果</strong>，处理后返回新结果（比如「ID→用户名」的转换）。</li>
<li><code>thenAccept</code>：接收上一步结果，<strong>只处理不返回</strong>（比如打印、保存）。</li>
<li><code>thenRun</code>：<strong>不关心上一步结果</strong>，只在完成后执行（比如「不管结果如何，都记录日志」）。</li>
</ul>
</blockquote>
<p>就像流水线一样，上一个工序的产品自动传到下一个工序，全程无需人工干预。</p>
<h2 data-id="heading-3">四、高手篇：组合多个任务，效率翻倍</h2>
<p>实际开发中，我们经常需要处理多个任务，有的任务之间有依赖（比如先登录才能下单），有的则完全独立（比如同时加载商品信息和用户信息）。CompletableFuture 提供了专门的方法来处理这些场景。</p>
<h3 data-id="heading-4">1. 处理依赖任务：thenCompose</h3>
<p>比如「先查用户地址，再根据地址查天气」，第二个任务依赖第一个的结果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThenComposeDemo</span> {
    <span class="hljs-comment">// 模拟：查用户地址public static CompletableFuture&lt;String&gt; getAddress(String username) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            <span class="hljs-keyword">return</span> username + <span class="hljs-string">"的地址是：北京市海淀区"</span>;
        });
    }

    <span class="hljs-comment">// 模拟：根据地址查天气public static CompletableFuture&lt;String&gt; getWeather(String address) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">600</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            <span class="hljs-keyword">return</span> address + <span class="hljs-string">"，今天天气：晴，25℃"</span>;
        });
    }

    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        <span class="hljs-comment">// 组合两个依赖任务</span>
        CompletableFuture&lt;String&gt; result = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">"小明"</span>)
                .thenCompose(username -&gt; getAddress(username)) <span class="hljs-comment">// 先查地址</span>
                .thenCompose(address -&gt; getWeather(address)); <span class="hljs-comment">// 再查天气</span>

        System.<span class="hljs-keyword">out</span>.println(result.<span class="hljs-keyword">get</span>());
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/748f226ee9544834903d55e39d43a8b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=3uufV4FS32Uig8etgulNordiSS8%3D" alt="" loading="lazy"/></p>
<p>运行流程如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adee6997e91e479d84bcdc4c373b0c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=VXupXbSM5FTbALfKFucrWgthiCQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e38fd3090b6b4257a5ae802e10a9407c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=2qNez8wg5HHF7amO2pEiCPjf58M%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d86ab4e3eb46869337d9b4bdecaa8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=riqwMJQN30Sa4tMVpBtt9Ewh3NA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c3f053e0b1d485480e0a88986ef8a89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=lLCNaBQJz132kdxQfdhgQRcgBao%3D" alt="" loading="lazy"/></p>
<p><code>thenCompose</code> 就像「接力赛」，第一棒跑完了，把接力棒交给第二棒，确保任务按顺序执行。</p>
<h3 data-id="heading-5">2. 处理独立任务：thenCombine</h3>
<p>如果两个任务毫无关系，可以并行执行，最后合并结果。比如「同时查商品价格和库存，计算总价」：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThenCombineDemo</span> {
    <span class="hljs-comment">// 查价格public static CompletableFuture&lt;Double&gt; getPrice(String product) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(product + <span class="hljs-string">"的价格是：99.9元"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">99.9</span>;
        });
    }

    <span class="hljs-comment">// 查库存public static CompletableFuture&lt;Integer&gt; getStock(String product) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(product + <span class="hljs-string">"的库存是：5件"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;
        });
    }

    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        String product = <span class="hljs-string">"Java编程思想"</span>;
        <span class="hljs-comment">// 并行执行两个任务，然后合并结果</span>
        CompletableFuture&lt;<span class="hljs-built_in">Double</span>&gt; total = getPrice(product)
                .thenCombine(getStock(product), (price, stock) -&gt; price * stock);

        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"总价："</span> + total.<span class="hljs-keyword">get</span>() + <span class="hljs-string">"元"</span>);
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866ed57a809c4a419335a8ba326d33de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=lQfLe%2B7OVhsp7G5Uri9KSJhpUf4%3D" alt="" loading="lazy"/></p>
<p>执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e69ed027e424674ab9e29fd957ba049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=9bzvGPas1jbspGpeudl8gVyW%2F1s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a97f5b1521684e5c90918fa71795c57a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=k7PFkrB31HLI%2F1O0QZnXX6%2F56r4%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c41ef5637144870bea681232d0d2d3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=5nYcuB3D35aQ26F3da5Umqi%2FwPI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a27915cdbcb49e583ab7684e02b89d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=X4vwfa6I0DpWrZh59A2YTqN3Xe0%3D" alt="" loading="lazy"/></p>
<p>两个任务并行执行，效率大大提高！</p>
<h3 data-id="heading-6">3. 等待所有任务：allOf</h3>
<p>如果有一堆任务，需要全部完成后再做处理（比如批量下载多个文件，全部下完后打包）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.itheima.future;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AllOfDemo</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        <span class="hljs-comment">//计时开始long start = System.currentTimeMillis();</span>
        <span class="hljs-comment">// 3个下载任务</span>
        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; download1 = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"文件1下载完成"</span>);
        });

        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; download2 = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1500</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"文件2下载完成"</span>);
        });

        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; download3 = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"文件3下载完成"</span>);
        });

        <span class="hljs-comment">// 等待所有任务完成</span>
        CompletableFuture.allOf(download1, download2, download3).<span class="hljs-keyword">get</span>();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"所有文件下载完成，开始打包..."</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"打包完成，耗时："</span> + (System.currentTimeMillis() - start) + <span class="hljs-string">"毫秒"</span>);
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d7578e51fee405ebc3d3ff2d6e0d092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=8D4zjc4MHQz5z90PW8cUt0%2BWXiA%3D" alt="" loading="lazy"/></p>
<p>执行流程如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff6bb1da06044b1985c811dea9b148d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=p8R%2BVCWihQGOhAABeHRUDG4s1D0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0473da5cb44324acaa5f5f2bb88187~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=O%2FEjGcPuK7upr1FBnH5gz60VvEI%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830c84b1e9544d879a62c77f7c481a02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=cRzlYsVwRTQvtdzAVE88Ff0%2Bxhk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12245c13bd75410a93b409da9b8d5ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=9JrbOacgdJyIX3krzCfSn1lXwzg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">4. 等待任意任务：anyOf</h3>
<p>如果多个任务中，只要有一个完成就可以继续 <strong>（比如查多个</strong> <strong>数据源</strong> <strong>，哪个快用哪个）</strong> ：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">CompletableFuture</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnyOfDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-title class_">String</span>[] args) throws <span class="hljs-title class_">Exception</span> {
        <span class="hljs-comment">// 3个查询任务（不同数据源）</span>
        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">String</span>&gt; fromCache = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">300</span>); } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) { e.<span class="hljs-title function_">printStackTrace</span>(); }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"从缓存查到数据：Java入门"</span>;
        });

        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">String</span>&gt; fromDb = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) { e.<span class="hljs-title function_">printStackTrace</span>(); }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"从数据库查到数据：Java入门"</span>;
        });

        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">String</span>&gt; fromApi = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1200</span>); } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) { e.<span class="hljs-title function_">printStackTrace</span>(); }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"从API查到数据：Java入门"</span>;
        });

        <span class="hljs-comment">// 只要有一个任务完成就返回</span>
        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">Object</span>&gt; result = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">anyOf</span>(fromCache, fromDb, fromApi);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"最快的结果："</span> + result.<span class="hljs-title function_">get</span>());
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b8f5aa18b6041a1849d3bab9d1185ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=Dfj93CVta8KvheQaRUfaw11Uix0%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/878833ea667c4c5fb3c446d11a539c55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=5snTepHOBxD8hDQir6XWxZ09N3Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4883516b0a0b4394b5aa07bb80385e99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=PDt70AeUkBIopGz6NUic%2F0Lpcdg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">五、异常处理：别让异步任务的错误悄悄溜走</h2>
<p>异步任务的异常很容易被忽略（比如线程池悄悄吃掉异常），CompletableFuture 提供了贴心的异常处理方法。</p>
<h3 data-id="heading-9">1. exceptionally：捕获异常并返回默认值</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionDemo1</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>{
        CompletableFuture&lt;Integer&gt; future = CompletableFuture.<span class="hljs-built_in">supplyAsync</span>(() -&gt; {
            <span class="hljs-comment">// 模拟任务失败if (true) {</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"查询失败：数据库连接超时"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;
        }).<span class="hljs-built_in">exceptionally</span>(ex -&gt; {
            <span class="hljs-comment">// 捕获异常，返回默认值</span>
            System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"出错了："</span> + ex.<span class="hljs-built_in">getMessage</span>());
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 默认值</span>
        });

        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"最终结果："</span> + future.<span class="hljs-built_in">get</span>()); <span class="hljs-comment">// 输出 0</span>
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c3b7e240b64319803f83a8a21552b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=xHq7K7S0Azu2f0WYZ6gcxPoeCG8%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26f63c85fc6c49dc8b0c785afc16f787~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=yLOk4qEicFIwddMnnKNKdUJJJcs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25ead0b5118f48198dd5c8c312a410d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=RfpIw7cCKjRTaHHBVYZVbJyeZEY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">2. handle：同时处理正常结果和异常</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionDemo2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>{
        CompletableFuture&lt;<span class="hljs-type">String</span>&gt; future = CompletableFuture.<span class="hljs-built_in">supplyAsync</span>(() -&gt; {
            <span class="hljs-comment">// 这里可以故意抛出异常测试return "正常结果";</span>
        }).<span class="hljs-built_in">handle</span>((result, ex) -&gt; {
            <span class="hljs-keyword">if</span> (ex != null) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"处理异常："</span> + ex.<span class="hljs-built_in">getMessage</span>();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"处理成功："</span> + result;
            }
        });

        System.out.<span class="hljs-built_in">println</span>(future.<span class="hljs-built_in">get</span>()); <span class="hljs-comment">// 输出 处理成功：正常结果</span>
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38e488104d7f4b05bce139e735ed61b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=LC9p%2F%2FRBgCJ2a4nojbK2bxDaDvw%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79f188920e1540c49fba7c9333dc2e10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=epFjQbq%2F3qhapH6CfjytoIG7LHE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f853e82de0f4de3bb3b3ea0d2eb3ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=1bHIbORvwMrNpgMGqCUckIc99%2Bs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">六、CompletableFuture 的线程池：默认还是自定义？</h2>
<p>使用 CompletableFuture 时，线程池的选择非常关键，它直接影响程序的性能和稳定性。</p>
<h3 data-id="heading-12">1. 默认线程池：ForkJoinPool.commonPool ()</h3>
<p>当我们使用无参的**<code>supplyAsync()</code>** <strong>或</strong> <strong><code>runAsync()</code></strong> 时，CompletableFuture 会默认使用**<code>ForkJoinPool.commonPool()</code>** 作为线程池：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 使用默认线程池</span>
<span class="hljs-selector-tag">CompletableFuture</span><span class="hljs-selector-class">.supplyAsync</span>(() -&gt; {
    <span class="hljs-comment">// 任务逻辑return "result";</span>
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5876b8d6e6b44ee98a062597751c00e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=GKIgfa2nTEU6E3%2BXPV3IA9tO6pk%3D" alt="" loading="lazy"/></p>
<p><strong>默认</strong> <strong>线程池</strong> <strong>的特点</strong>：</p>
<blockquote>
<ul>
<li>线程数量：默认等于 CPU 核心数（可以通过<code>-Djava.util.concurrent.ForkJoinPool.common.parallelism</code>参数调整）</li>
<li>适用场景：CPU 密集型任务（如计算）</li>
<li>优点：无需手动管理线程池，简单方便</li>
</ul>
</blockquote>
<p><strong>潜在问题</strong>：</p>
<blockquote>
<ul>
<li>所有使用默认线程池的任务会共享这一组线程，高并发下可能出现资源竞争</li>
<li>对于 IO 密集型任务（如网络请求、文件读写），固定的线程数可能导致效率低下</li>
<li>当有大量任务时，可能会拖慢所有依赖此线程池的任务</li>
</ul>
</blockquote>
<h3 data-id="heading-13">2. 自定义线程池：更灵活的控制</h3>
<p>实际项目中，<strong>强烈建议使用自定义</strong> <strong>线程池</strong>，尤其是在<strong>生产环境</strong>。我们可以通过带线程池参数的方法来指定：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.itheima.future;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomThreadPoolDemo</span> {
    <span class="hljs-comment">// 自定义线程池(这里我暂时使用线程池包里的线程池，一般情况下要使用自定义线程池ThreadPoolExecutor)private static final ExecutorService customExecutor = Executors.newFixedThreadPool(10);</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 使用自定义线程池</span>
        CompletableFuture.supplyAsync(() -&gt; {
            System.out.println(<span class="hljs-string">"任务在自定义线程池执行："</span> + Thread.currentThread().getName());
            <span class="hljs-keyword">return</span> <span class="hljs-string">"处理完成"</span>;
        }, customExecutor)
        .thenAccept(result -&gt; {
            System.out.println(<span class="hljs-string">"结果："</span> + result);
        });
        
        <span class="hljs-comment">// 记得在程序结束时关闭线程池</span>
        customExecutor.shutdown();
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d3a6d0ce7a448cf9e1698dcd442c052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=UHBl7DtJGSQ%2BR%2FG9bzkg9WNI55Q%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88ee474966294089a9037751c9f2ffeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=nV524IZ2gMPSPuZqQjKr2HZMRu0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7488ba2240d4659add364483b6df42f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=vuz7D5Ishl5TAoVc9aDZjo0J71A%3D" alt="" loading="lazy"/></p>
<p><strong>自定义</strong> <strong>线程池</strong> <strong>的优势</strong>：</p>
<blockquote>
<ul>
<li>隔离不同类型的任务（例如：查询数据库的任务用一个线程池，发送消息的任务用另一个）</li>
<li>可以根据任务类型（CPU 密集 / IO 密集）调整线程数量</li>
<li>避免默认线程池被某个耗时任务占满导致的整体阻塞</li>
</ul>
</blockquote>
<p><strong>线程池</strong> <strong>配置建议</strong>：</p>
<blockquote>
<ul>
<li>CPU 密集型任务：<strong>线程数</strong> <strong>= CPU 核心数 + 1</strong></li>
<li>IO 密集型任务：<strong>线程数</strong> <strong>= CPU 核心数 × 2</strong>（或更多，根据实际测试调整）</li>
<li>为线程池起一个有意义的名字，方便问题排查（可以通过自定义 ThreadFactory 实现）</li>
</ul>
</blockquote>
<h2 data-id="heading-14">七、CompletableFuture vs Future：到底有什么不同？</h2>
<p>很多人会疑惑，Java 已经有了 Future，为什么还需要 CompletableFuture？它们的核心区别在哪里？</p>








































<table><thead><tr><th>特性</th><th>Future</th><th>CompletableFuture</th></tr></thead><tbody><tr><td>实现接口</td><td>仅实现 Future 接口</td><td>实现 Future 和 CompletionStage 接口</td></tr><tr><td>链式操作</td><td>不支持，必须阻塞获取结果后再处理</td><td>支持，可通过 thenApply 等方法串联多个任务</td></tr><tr><td>异常处理</td><td>无专门的 API，需要在任务内部捕获</td><td>提供 exceptionally、handle 等专门的异常处理方法</td></tr><tr><td>任务组合</td><td>不支持，需要手动编写同步逻辑</td><td>支持 thenCompose、thenCombine 等多种组合方式</td></tr><tr><td>手动完成</td><td>不支持</td><td>支持 complete ()、completeExceptionally () 手动设置结果或异常</td></tr><tr><td>阻塞获取</td><td>只能通过 get () 阻塞获取</td><td>可以阻塞获取，也可以通过回调非阻塞处理</td></tr></tbody></table>
<h3 data-id="heading-15">具体区别举例</h3>
<h4 data-id="heading-16">1. 处理结果的方式</h4>
<p><strong>Future 的方式</strong>（繁琐且必须阻塞）：</p>
<pre><code class="hljs language-ini" lang="ini">ExecutorService <span class="hljs-attr">executor</span> = Executors.newSingleThreadExecutor()<span class="hljs-comment">;</span>
Future&lt;String&gt; <span class="hljs-attr">future</span> = executor.submit(() -&gt; {
    Thread.sleep(1000)<span class="hljs-comment">;</span>
    return "任务结果"<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// 必须阻塞等待结果String <span class="hljs-attr">result</span> = future.get()<span class="hljs-comment">;</span>
// 处理结果
System.out.println("处理：" + result)<span class="hljs-comment">;</span>
executor.shutdown()<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7e86426afe4393a027b0d741d3e3c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=Npx7FNAtbHCQRzcxpZ1zKgAtZQ4%3D" alt="" loading="lazy"/></p>
<p><strong>CompletableFuture 的方式</strong>（非阻塞，链式处理）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">CompletableFuture.supplyAsync(() -&gt; {
    <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"任务结果"</span>;
}).thenApply(result -&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"处理后："</span> + result;
}).thenAccept(processedResult -&gt; {
    System.<span class="hljs-keyword">out</span>.println(processedResult);
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51c051d004e40aa8eb67b4aba49a45b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=8BBtYSIdlLsPcUD2BeUH3D4Qf6s%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">2. 异常处理能力</h4>
<p><strong>Future 的方式</strong>（异常处理麻烦）：</p>
<pre><code class="hljs language-ini" lang="ini">ExecutorService <span class="hljs-attr">executor</span> = Executors.newSingleThreadExecutor()<span class="hljs-comment">;</span>
Future&lt;Integer&gt; <span class="hljs-attr">future</span> = executor.submit(() -&gt; {
    if (true) {
        throw new RuntimeException("计算失败")<span class="hljs-comment">;</span>
    }
    return 100<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

try {
    Integer <span class="hljs-attr">result</span> = future.get()<span class="hljs-comment">; // 异常会在这里抛出</span>
} catch (Exception e) {
    // 处理异常
    e.printStackTrace()<span class="hljs-comment">;</span>
}
executor.shutdown()<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706a9764e1ed4110aa608e79359f869f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=jloQifj2510AVycXBliAptNOrWc%3D" alt="" loading="lazy"/></p>
<p><strong>CompletableFuture 的方式</strong>（专门的异常处理 API）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">CompletableFuture.supplyAsync(() -&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">throw</span> new RuntimeException(<span class="hljs-string">"计算失败"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;
}).exceptionally(ex -&gt; {
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"捕获异常："</span> + ex.getMessage());
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 返回默认值</span>
}).thenAccept(result -&gt; {
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"结果："</span> + result); <span class="hljs-comment">// 输出0</span>
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dcabeece64146f4b07876c94127797e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=EiTZR8DGsOeY9I9ua%2BgBUhJGHDI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">3. 多任务组合能力</h4>
<p>Future 几乎无法优雅地组合多个任务，而 CompletableFuture 提供了丰富的组合方式，这也是它最核心的优势。</p>
<p><strong>感兴趣的宝子可以关注一波，后续会更新更多有用的知识！！！</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52621360aa494deba3a02f935deef043~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=nUJVyHOgGWtuhfA%2Be5dMlBwHgFU%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 短信验证码 API 示例代码：HTTP POST 请求的构建与发送]]></title>    <link>https://juejin.cn/post/7599601258640900134</link>    <guid>https://juejin.cn/post/7599601258640900134</guid>    <pubDate>2026-01-27T06:44:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258640900134" data-draft-id="7599640782569865243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 短信验证码 API 示例代码：HTTP POST 请求的构建与发送"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T06:44:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户80269443385"/> <meta itemprop="url" content="https://juejin.cn/user/925127226441289"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 短信验证码 API 示例代码：HTTP POST 请求的构建与发送
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/925127226441289/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户80269443385
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:44:20.000Z" title="Tue Jan 27 2026 06:44:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 C# 开发中，对接短信验证码 API 是实现用户验证、订单通知等功能的常见需求，而新手开发者构建 HTTP POST 请求时，常因请求头配置错误、参数编码不当、响应解析不完整导致接口调用失败，甚至无法正确发送第一个请求。本文提供完整可运行的 c# 短信验证码 API 示例代码，从 POST 请求构建、参数封装到响应解析全流程拆解，解决请求构建的核心痛点，帮助开发者快速完成接口对接。</p>
<h2 data-id="heading-0">一、C# 对接短信验证码 API 的常见痛点</h2>
<p>开发者使用 C# 调用短信验证码 API 时，以下问题是导致 POST 请求发送失败的高频痛点，也是新手入门的主要障碍：</p>
<ol>
<li>请求头<code>Content-Type</code>配置错误，未设置为<code>application/x-www-form-urlencoded</code>，导致接口无法解析参数；</li>
<li>参数未做 UTF-8 编码，中文或特殊字符触发敏感词校验（407 错误码）；</li>
<li>同步调用未设置超时，网络波动时导致程序长时间阻塞；</li>
<li>仅判断响应码<code>code=2</code>，未针对性处理 405（API ID 错误）、406（手机号格式错误）等具体错误；</li>
<li>手机号未做前置校验，传入非 11 位号码或黑名单号码（4030 错误）。</li>
</ol>
<h2 data-id="heading-1">二、C# 短信验证码 API POST 请求核心原理拆解</h2>
<h3 data-id="heading-2">2.1 HTTP POST 请求的通信规则</h3>
<p>C# 调用短信验证码 API 的 POST 请求需严格遵循 HTTP 协议与接口规范，核心规则如下：</p>
<ul>
<li><strong>字符编码</strong>：所有参数必须采用 UTF-8 编码，否则中文内容会出现乱码，触发 407（敏感字符）错误；</li>
<li><strong>请求头要求</strong>：<code>Content-Type</code>固定为<code>application/x-www-form-urlencoded</code>，这是接口解析表单参数的核心前提；</li>
<li><strong>数据传递方式</strong>：参数需封装为键值对形式通过请求体传递，而非 URL 拼接（GET 方式），保障参数安全性；</li>
<li><strong>响应解析规则</strong>：接口返回 JSON/XML 格式数据，C# 需通过反序列化将字符串转为对象，便于提取<code>code</code>、<code>msg</code>等核心字段。</li>
</ul>
<h3 data-id="heading-3">2.2 核心参数的封装逻辑</h3>
<p>c# 短信验证码 API 示例代码的关键是参数的正确封装，需遵循以下逻辑：</p>
<ol>
<li>
<p>认证参数（<code>account</code>/<code>password</code>）：需从短信服务平台获取，是接口调用的身份凭证，缺失或错误会触发 401/402/405 错误；</p>
</li>
<li>
<p>业务参数（<code>mobile</code>/<code>content</code>/<code>templateid</code>）：</p>
<ul>
<li><code>mobile</code>需校验为 11 位有效号码，脱敏格式为<code>139****8888</code>；</li>
<li>调试阶段<code>templateid=1</code>时，<code>content</code>仅传递验证码变量值（如 “6897”），无需完整短信内容；</li>
</ul>
</li>
<li>
<p>所有参数需做 URL 编码，避免<code>&amp;</code>、<code>=</code>等特殊字符导致参数截断。</p>
</li>
</ol>
<h2 data-id="heading-4">三、完整 C# 短信验证码 API 示例代码与解析</h2>
<h3 data-id="heading-5">3.1 开发环境与前置准备</h3>
<p>在编写代码前，需完成以下基础准备：</p>
<ol>
<li>开发环境：.NET Framework 4.5+ 或 .NET Core 3.1+（推荐.NET 6+）；</li>
<li>依赖安装：通过 NuGet 安装<code>Newtonsoft.Json</code>（命令：<code>Install-Package Newtonsoft.Json</code>），用于 JSON 响应解析；</li>
<li>参数获取：注册短信服务平台账号，获取<code>account</code>（API ID）和<code>password</code>（API KEY）。</li>
</ol>
<h3 data-id="heading-6">3.2 示例代码实现（HttpWebRequest 版）</h3>
<p>以下是可直接运行的 c# 短信验证码 API 示例代码，基于<code>HttpWebRequest</code>构建 POST 请求，注释中包含注册链接（用于获取认证参数）：</p>
<p>csharp</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Net;
<span class="hljs-keyword">using</span> System.Text;
<span class="hljs-keyword">using</span> Newtonsoft.Json;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">SmsVerificationDemo</span>
{
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 短信API响应实体（对应接口返回的JSON结构）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsApiResponse</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> code { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }       <span class="hljs-comment">// 响应码：2=成功，其他=失败</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> msg { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }    <span class="hljs-comment">// 响应描述</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> smsid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }  <span class="hljs-comment">// 成功时的流水号，失败为0</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsSender</span>
    {
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送短信验证码（POST方式）</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="mobile"&gt;</span>接收手机号（脱敏格式：139****8888）<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="verificationCode"&gt;</span>验证码（如6897）<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>是否发送成功<span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">SendVerificationCode</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> mobile, <span class="hljs-built_in">string</span> verificationCode</span>)</span>
        {
            <span class="hljs-comment">// 注册获取API ID/KEY（C#短信验证码API调用必备）：http://user.ihuyi.com/?udcpF6</span>
            <span class="hljs-built_in">string</span> account = <span class="hljs-string">"xxxxxxxx"</span>; <span class="hljs-comment">// 替换为实际获取的API ID</span>
            <span class="hljs-built_in">string</span> password = <span class="hljs-string">"xxxxxxxx"</span>; <span class="hljs-comment">// 替换为实际获取的API KEY</span>
            <span class="hljs-built_in">string</span> templateId = <span class="hljs-string">"1"</span>;      <span class="hljs-comment">// 调试阶段使用系统默认模板ID</span>
            <span class="hljs-built_in">string</span> apiUrl = <span class="hljs-string">"https://api.ihuyi.com/sms/Submit.json"</span>;

            <span class="hljs-keyword">try</span>
            {
                <span class="hljs-comment">// 1. 构建POST参数（所有参数需URL编码）</span>
                StringBuilder postData = <span class="hljs-keyword">new</span> StringBuilder();
                postData.AppendFormat(<span class="hljs-string">"account={0}"</span>, WebUtility.UrlEncode(account));
                postData.AppendFormat(<span class="hljs-string">"&amp;password={0}"</span>, WebUtility.UrlEncode(password));
                postData.AppendFormat(<span class="hljs-string">"&amp;mobile={0}"</span>, WebUtility.UrlEncode(mobile));
                postData.AppendFormat(<span class="hljs-string">"&amp;content={0}"</span>, WebUtility.UrlEncode(verificationCode));
                postData.AppendFormat(<span class="hljs-string">"&amp;templateid={0}"</span>, WebUtility.UrlEncode(templateId));

                <span class="hljs-comment">// 2. 配置HTTP POST请求</span>
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(apiUrl);
                request.Method = <span class="hljs-string">"POST"</span>;
                request.ContentType = <span class="hljs-string">"application/x-www-form-urlencoded; charset=utf-8"</span>;
                request.Timeout = <span class="hljs-number">5000</span>; <span class="hljs-comment">// 设置5秒超时，避免程序阻塞</span>

                <span class="hljs-comment">// 3. 写入请求参数到请求体</span>
                <span class="hljs-built_in">byte</span>[] dataBytes = Encoding.UTF8.GetBytes(postData.ToString());
                request.ContentLength = dataBytes.Length;
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = request.GetRequestStream())
                {
                    stream.Write(dataBytes, <span class="hljs-number">0</span>, dataBytes.Length);
                }

                <span class="hljs-comment">// 4. 获取并解析响应</span>
                <span class="hljs-keyword">using</span> (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> streamReader = <span class="hljs-keyword">new</span> System.IO.StreamReader(response.GetResponseStream(), Encoding.UTF8))
                {
                    <span class="hljs-built_in">string</span> responseJson = streamReader.ReadToEnd();
                    SmsApiResponse result = JsonConvert.DeserializeObject&lt;SmsApiResponse&gt;(responseJson);

                    <span class="hljs-comment">// 解析响应结果</span>
                    <span class="hljs-keyword">if</span> (result.code == <span class="hljs-number">2</span>)
                    {
                        Console.WriteLine(<span class="hljs-string">$"验证码发送成功，流水号：<span class="hljs-subst">{result.smsid}</span>"</span>);
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    <span class="hljs-keyword">else</span>
                    {
                        Console.WriteLine(<span class="hljs-string">$"发送失败：错误码<span class="hljs-subst">{result.code}</span>，原因：<span class="hljs-subst">{result.msg}</span>"</span>);
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                }
            }
            <span class="hljs-keyword">catch</span> (WebException ex)
            {
                Console.WriteLine(<span class="hljs-string">$"网络请求异常：<span class="hljs-subst">{ex.Message}</span>"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                Console.WriteLine(<span class="hljs-string">$"系统异常：<span class="hljs-subst">{ex.Message}</span>"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-comment">// 测试调用入口</span>
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-comment">// 调用示例：发送验证码6897到手机号138****9876</span>
            SendVerificationCode(<span class="hljs-string">"138****9876"</span>, <span class="hljs-string">"6897"</span>);
            Console.ReadLine();
        }
    }
}
</code></pre>
<h4 data-id="heading-7">代码核心解析</h4>
<ol>
<li><strong>响应实体封装</strong>：定义<code>SmsApiResponse</code>类映射接口返回的 JSON 结构，通过<code>Newtonsoft.Json</code>反序列化，避免手动解析字符串；</li>
<li><strong>参数编码</strong>：使用<code>WebUtility.UrlEncode</code>处理所有参数，解决特殊字符导致的参数解析失败问题；</li>
<li><strong>请求头配置</strong>：严格设置<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>，符合接口要求；</li>
<li><strong>异常处理</strong>：捕获<code>WebException</code>（网络异常）和通用异常，避免程序崩溃，同时设置 5 秒超时；</li>
<li><strong>结果判断</strong>：通过<code>code=2</code>判断成功，打印具体错误码和原因，便于问题排查。</li>
</ol>
<h3 data-id="heading-8">3.3 .NET Core 推荐方案（HttpClient 版）</h3>
<p>在.NET Core/.NET 6 + 中，推荐使用<code>HttpClient</code>简化 POST 请求构建，代码更简洁：</p>
<p>csharp</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Net.Http;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> Newtonsoft.Json;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsSenderHttpClient</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">bool</span>&gt; <span class="hljs-title">SendCodeAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> mobile, <span class="hljs-built_in">string</span> code</span>)</span>
    {
        <span class="hljs-keyword">using</span> (HttpClient client = <span class="hljs-keyword">new</span> HttpClient())
        {
            <span class="hljs-comment">// 构建表单参数</span>
            <span class="hljs-keyword">var</span> parameters = <span class="hljs-keyword">new</span> FormUrlEncodedContent(<span class="hljs-keyword">new</span>[]
            {
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"account"</span>, <span class="hljs-string">"xxxxxxxx"</span>),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"password"</span>, <span class="hljs-string">"xxxxxxxx"</span>),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"mobile"</span>, mobile),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"content"</span>, code),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"templateid"</span>, <span class="hljs-string">"1"</span>)
            });

            <span class="hljs-comment">// 发送POST请求</span>
            <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> client.PostAsync(<span class="hljs-string">"https://api.ihuyi.com/sms/Submit.json"</span>, parameters);
            <span class="hljs-built_in">string</span> responseJson = <span class="hljs-keyword">await</span> response.Content.ReadAsStringAsync();
            
            <span class="hljs-comment">// 解析响应</span>
            SmsApiResponse result = JsonConvert.DeserializeObject&lt;SmsApiResponse&gt;(responseJson);
            <span class="hljs-keyword">return</span> result.code == <span class="hljs-number">2</span>;
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c91c814240c4a5faa43ea6cbfa3f6a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODAyNjk0NDMzODU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101060&amp;x-signature=oFJV0EYqibaqRJxwELNAehYkB%2BM%3D" alt="api.png" loading="lazy"/></p>
<h2 data-id="heading-9">四、不同请求封装方式的对比分析</h2>
<p>C# 中构建 POST 请求有三种常见方式，开发者可根据项目场景选择：</p>





























<table><thead><tr><th>封装方式</th><th>核心优点</th><th>主要缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>HttpWebRequest</td><td>底层可控性高，兼容性好</td><td>代码量多，需手动处理流</td><td>.NET Framework 旧项目</td></tr><tr><td>HttpClient</td><td>简洁易用，支持异步</td><td>需注意实例复用（避免端口耗尽）</td><td>.NET Core/.NET 6+ 新项目</td></tr><tr><td>WebClient</td><td>代码最简，快速实现</td><td>灵活性差，功能少</td><td>简单测试、接口连通性验证</td></tr></tbody></table>
<p>互亿无线提供的 C# 短信验证码 API 对接文档中，同时给出了<code>HttpWebRequest</code>和<code>HttpClient</code>两种示例，其参数规范可作为行业通用参考。</p>
<h2 data-id="heading-10">五、C# 调用短信验证码 API 的实用技巧总结</h2>
<ol>
<li><strong>手机号前置校验</strong>：使用正则表达式<code>^1[3-9]\d{9}$</code>校验手机号格式，避免 406 错误；</li>
<li><strong>异步调用优先</strong>：使用<code>async/await</code>封装请求，避免阻塞主线程，提升程序响应性；</li>
<li><strong>错误码精细化处理</strong>：针对 405（API ID 错误）、4072（模板不匹配）等高频错误码做针对性提示；</li>
<li><strong>日志记录</strong>：记录脱敏后的请求参数、响应结果和调用时间，便于问题追溯；</li>
<li><strong>HttpClient 复用</strong>：通过<code>IHttpClientFactory</code>创建实例，避免频繁创建导致的端口耗尽问题。</li>
</ol>
<h2 data-id="heading-11">六、总结与延伸</h2>
<p>本文围绕 c# 短信验证码 API 示例代码展开，从开发者常见痛点切入，拆解了 POST 请求的构建原理，提供了<code>HttpWebRequest</code>和<code>HttpClient</code>两种实现方案，并对比了不同封装方式的优劣。</p>
<p>开发者在使用 C# 调用短信验证码 API 时，核心是保证请求头配置正确、参数编码规范、响应解析完整。后续可进阶学习：接口调用的重试机制（针对网络超时）、批量发送实现、动态密码生成与校验等内容。掌握本文的示例代码和技巧，能有效降低接口调用失败率，保障验证码功能的稳定运行。</p>
<h3 data-id="heading-12">总结</h3>
<ol>
<li>c# 短信验证码 API 示例代码的核心是正确配置<code>Content-Type</code>请求头，并对所有参数做 UTF-8 编码；</li>
<li><code>HttpWebRequest</code>兼容性好，<code>HttpClient</code>更简洁，需根据项目框架选择合适的请求方式；</li>
<li>调用前校验参数、调用后精细化处理错误码，是提升接口稳定性的关键。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React useLayoutEffect 完全指南]]></title>    <link>https://juejin.cn/post/7599640782569947163</link>    <guid>https://juejin.cn/post/7599640782569947163</guid>    <pubDate>2026-01-27T06:49:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782569947163" data-draft-id="7599630795804262446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React useLayoutEffect 完全指南"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-27T06:49:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="biggerdong"/> <meta itemprop="url" content="https://juejin.cn/user/782508007891192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React useLayoutEffect 完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/782508007891192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    biggerdong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:49:30.000Z" title="Tue Jan 27 2026 06:49:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React <code>useLayoutEffect</code> 完全指南</h2>
<h3 data-id="heading-1">一、核心定义与执行时机</h3>
<p><code>useLayoutEffect</code> 是 React 提供的用于处理<strong>DOM 相关同步操作</strong>的 Hook，其执行时机具有严格的顺序性，且是<strong>同步阻塞</strong>的（会阻塞浏览器绘制，直到回调函数执行完毕）。</p>
<p>单次组件更新周期的执行顺序：</p>
<p><code>组件 render 生成新 DOM</code> → <code>useLayoutEffect 回调同步执行</code> → <code>浏览器绘制页面</code> → <code>useEffect 回调异步执行</code></p>
<h3 data-id="heading-2">二、核心使用场景：解决 DOM 闪烁/抖动问题</h3>
<p><code>useLayoutEffect</code> 的核心价值在于<strong>处理需要依赖更新后 DOM 信息，且需要同步修改 DOM 以避免页面闪烁/抖动的场景</strong>，常见场景包括：</p>
<ol>
<li>
<p>同步读取并修改 DOM 样式（如获取元素宽高后，立即调整其位置、尺寸）；</p>
</li>
<li>
<p>计算 DOM 元素的布局信息（如滚动位置、偏移量）并同步更新组件状态；</p>
</li>
<li>
<p>实现无闪烁的 DOM 操作（避免 <code>useEffect</code> 异步执行导致的"先渲染错误样式，再修正"的闪烁问题）。</p>
</li>
</ol>
<h4 data-id="heading-3">代码示例：避免 DOM 位置闪烁</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">import</span> { useState, useLayoutEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LayoutEffectDemo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> boxRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (show &amp;&amp; boxRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> { height } = boxRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
      boxRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateY(<span class="hljs-subst">${height + <span class="hljs-number">10</span>}</span>px)`</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (boxRef.<span class="hljs-property">current</span>) {
      boxRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'translateY(0)'</span>;
    }
  }, [show]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShow(!show)}&gt;切换显示/隐藏<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {show &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{boxRef}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
            <span class="hljs-attr">width:</span> '<span class="hljs-attr">200px</span>', 
            <span class="hljs-attr">height:</span> '<span class="hljs-attr">100px</span>', 
            <span class="hljs-attr">background:</span> '<span class="hljs-attr">blue</span>', 
            <span class="hljs-attr">transition:</span> '<span class="hljs-attr">transform</span> <span class="hljs-attr">0.3s</span> <span class="hljs-attr">ease</span>' 
          }}
        &gt;</span>
          测试 useLayoutEffect 无闪烁布局
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">LayoutEffectDemo</span>;
</code></pre>
<h3 data-id="heading-4">三、与 <code>useEffect</code> 的核心区别</h3>







































<table><thead><tr><th>特性</th><th>useLayoutEffect</th><th>useEffect</th></tr></thead><tbody><tr><td>执行时机</td><td>DOM 更新后、浏览器绘制前（同步）</td><td>浏览器绘制完成后（异步）</td></tr><tr><td>阻塞特性</td><td>阻塞浏览器绘制，同步执行</td><td>不阻塞浏览器绘制，异步执行（不阻塞主线程）</td></tr><tr><td>适用场景</td><td>DOM 布局相关同步操作（避免闪烁）</td><td>数据请求、订阅/取消订阅、非 DOM 相关副作用</td></tr><tr><td>执行优先级</td><td>更高（早于 useEffect）</td><td>更低（晚于 useLayoutEffect）</td></tr><tr><td>对用户体验的影响</td><td>执行耗时过长会导致页面卡顿（阻塞绘制）</td><td>几乎不影响页面渲染流畅度</td></tr><tr><td><strong>关键补充</strong>：若副作用不依赖 DOM 信息，优先使用 <code>useEffect</code>，避免不必要的阻塞，保证页面渲染性能。</td><td/></tr></tbody></table>
<h3 data-id="heading-5">四、DOM 更新后绘制前能否获取元素大小和位置</h3>
<p><strong>可以的</strong>。</p>
<ol>
<li>
<p>DOM 更新完成意味着内存中的 DOM 树已经修改完毕，元素的结构、属性、样式都已确定，其大小和位置等布局信息是 DOM 节点的固有属性，无需等待浏览器绘制即可读取。</p>
</li>
<li>
<p><code>useLayoutEffect</code> 正好在这个时机执行，通过 <code>getBoundingClientRect()</code>、<code>offsetWidth</code>、<code>offsetTop</code> 等 API 能获取到准确的元素布局信息。</p>
</li>
</ol>
<h4 data-id="heading-6">代码验证：读取元素布局信息</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">import</span> { useState, useLayoutEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">GetElementLayoutDemo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [isShow, setIsShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> elementRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isShow &amp;&amp; elementRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> rect = elementRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'元素大小和位置（绘制前）：'</span>, {
        宽度: rect.<span class="hljs-property">width</span>,
        高度: rect.<span class="hljs-property">height</span>,
        距离视口顶部: rect.<span class="hljs-property">top</span>,
        距离视口左侧: rect.<span class="hljs-property">left</span>
      });

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'元素偏移宽高：'</span>, {
        <span class="hljs-attr">offsetWidth</span>: elementRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetWidth</span>,
        <span class="hljs-attr">offsetHeight</span>: elementRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>,
        <span class="hljs-attr">offsetTop</span>: elementRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetTop</span>
      });
    }
  }, [isShow]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">20</span> }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsShow(!isShow)}&gt;
        {isShow ? '隐藏元素' : '显示元素并读取布局'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {isShow &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{elementRef}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">width:</span> <span class="hljs-attr">300</span>,
            <span class="hljs-attr">height:</span> <span class="hljs-attr">200</span>,
            <span class="hljs-attr">background:</span> '<span class="hljs-attr">green</span>',
            <span class="hljs-attr">margin:</span> <span class="hljs-attr">10</span>,
            <span class="hljs-attr">position:</span> '<span class="hljs-attr">relative</span>',
            <span class="hljs-attr">top:</span> <span class="hljs-attr">20</span>
          }}
        &gt;</span>
          测试布局读取的元素
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">GetElementLayoutDemo</span>;
</code></pre>
<h3 data-id="heading-7">五、<code>useLayoutEffect</code> 如何感知执行时机</h3>
<p><code>useLayoutEffect</code> 不是自身“主动知道”时机，而是 <strong>React 内部更新调度机制将其精准嵌入到 DOM 操作和浏览器绘制之间的固定流程</strong>，底层依赖浏览器的渲染流水线和任务队列机制。</p>
<h4 data-id="heading-8">1. React 组件更新的核心流程</h4>
<ol>
<li>
<p><strong>触发更新</strong>：<code>state</code>/<code>props</code> 变化触发组件重新渲染；</p>
</li>
<li>
<p><strong>虚拟 DOM 对比</strong>：通过 Diff 算法计算真实 DOM 的最小修改操作；</p>
</li>
<li>
<p><strong>执行 DOM 操作</strong>：React 提交阶段，将 DOM 修改同步应用到真实 DOM 树（内存中 DOM 已更新，未绘制）；</p>
</li>
<li>
<p><strong>执行</strong> <strong><code>useLayoutEffect</code></strong> <strong>回调</strong>：React 内置步骤，DOM 变更后立即同步调用回调；</p>
</li>
<li>
<p><strong>释放主线程</strong>：<code>useLayoutEffect</code> 执行完毕，浏览器获得主线程控制权；</p>
</li>
<li>
<p><strong>浏览器绘制</strong>：执行绘制流程，将 DOM 渲染到屏幕；</p>
</li>
<li>
<p><strong>执行</strong> <strong><code>useEffect</code></strong> <strong>回调</strong>：浏览器绘制完成后，主线程空闲时异步执行。</p>
</li>
</ol>
<h4 data-id="heading-9">2. 浏览器底层机制支撑</h4>
<ul>
<li>
<p><strong>渲染流水线顺序</strong>：浏览器处理 DOM 遵循 <code>解析 HTML → 构建 DOM 树 → 构建 CSSOM 树 → 生成布局树 → 绘制 → 合成</code> 的固定步骤，前一步完成才能进入后一步；</p>
</li>
<li>
<p><strong>任务优先级</strong>：<code>useLayoutEffect</code> 是主线程的同步任务，优先级高于浏览器绘制的宏任务，因此会阻塞绘制，直到自身执行完毕。</p>
</li>
</ul>
<h3 data-id="heading-10">六、<code>useLayoutEffect</code> 回调执行是否阻塞绘制</h3>
<p><strong>会阻塞</strong>，这是其核心特性之一，阻塞的本质是<strong>浏览器单线程模型 + 同步执行特性</strong>。</p>
<ol>
<li>
<p>浏览器主线程同一时间只能执行一个任务，<code>useLayoutEffect</code> 回调是同步执行的，会独占主线程；</p>
</li>
<li>
<p>浏览器的绘制任务会被搁置在任务队列，必须等 <code>useLayoutEffect</code> 回调执行完毕、主线程释放后才能启动；</p>
</li>
<li>
<p>若回调内包含耗时操作，会导致页面卡顿、渲染延迟。</p>
</li>
</ol>
<h4 data-id="heading-11">错误示例：耗时操作导致阻塞</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (boxRef.<span class="hljs-property">current</span>) {
    <span class="hljs-comment">// 大量同步循环，阻塞绘制很久</span>
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000000</span>; i++) {
      total += i;
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(total);
    boxRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">'100px'</span>;
  }
}, []);
</code></pre>
<h3 data-id="heading-12">七、DOM 变更后绘制被阻塞的场景</h3>
<p>浏览器绘制被阻塞的核心原因是：<strong>主线程被未完成的同步任务占用，无法执行绘制操作</strong>，分为两类场景：</p>
<h4 data-id="heading-13">1. React 框架层面</h4>
<p><code>useLayoutEffect</code> 回调的同步执行是最典型场景，React 刻意设计该机制，以实现无闪烁的 DOM 调整。</p>
<h4 data-id="heading-14">2. 浏览器原生层面</h4>
<p>脱离 React 时，DOM 变更后主线程存在未完成的同步任务，也会阻塞绘制：</p>
<ul>
<li>
<p><strong>DOM 变更后立即执行耗时同步代码</strong>：如大量循环计算、复杂 DOM 遍历；</p>
</li>
<li>
<p><strong>强制同步布局</strong>：循环中交替读取和修改 DOM 布局属性（如 <code>offsetWidth</code> + <code>style.width</code>），导致浏览器反复计算布局。</p>
</li>
</ul>
<h4 data-id="heading-15">原生场景阻塞示例</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// 1. DOM 变更</span>
<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
div.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100px'</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div);

<span class="hljs-comment">// 2. 同步耗时任务阻塞绘制</span>
<span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000000</span>; i++) {
  total += i;
}
<span class="hljs-comment">// 循环结束后才会绘制 div</span>
</code></pre>
<h3 data-id="heading-16">八、<code>useLayoutEffect</code> 性能优化清单</h3>
<h4 data-id="heading-17">1. 核心使用原则：能不用就不用</h4>
<ul>
<li>
<p>**优先用 ** <strong><code>useEffect</code></strong>：仅在需要同步处理 DOM 布局、避免闪烁时使用；</p>
</li>
<li>
<p><strong>严格控制依赖项</strong>：用精准的 DOM 相关状态作为依赖，避免频繁触发。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 依赖宽泛</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* DOM 操作 */</span> }, [props, state]);
<span class="hljs-comment">// ✅ 依赖精准</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* DOM 操作 */</span> }, [state.<span class="hljs-property">showElement</span>]);
</code></pre>
</li>
</ul>
<h4 data-id="heading-18">2. 代码优化：最小化回调执行时间</h4>
<ul>
<li>
<p><strong>移除非 DOM 相关逻辑</strong>：耗时计算、数据处理等移到 <code>useMemo</code>/<code>useEffect</code> 或组件外部。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 耗时计算阻塞绘制</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> total = <span class="hljs-title function_">heavyCalculation</span>();
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${rect.top + total}</span>px`</span>;
}, []);

<span class="hljs-comment">// ✅ 提前计算</span>
<span class="hljs-keyword">const</span> total = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">heavyCalculation</span>(), []);
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${rect.top + total}</span>px`</span>;
}, [total]);
</code></pre>
</li>
<li>
<p><strong>批量执行 DOM 操作</strong>：遵循 <strong>先读后写</strong> 原则，避免频繁触发重排。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 频繁读写触发多次重排</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> list = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>);
  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    item.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${item.offsetWidth + <span class="hljs-number">10</span>}</span>px`</span>;
  });
}, []);

<span class="hljs-comment">// ✅ 先读后写，批量修改</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> list = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>);
  <span class="hljs-keyword">const</span> widths = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(list).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">offsetWidth</span>);
  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
    item.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${widths[index] + <span class="hljs-number">10</span>}</span>px`</span>;
  });
}, []);
</code></pre>
</li>
<li>
<p><strong>避免强制同步布局</strong>：禁止循环中交替读写 DOM 布局属性。</p>
</li>
</ul>
<h4 data-id="heading-19">3. 避坑技巧：特殊场景处理</h4>
<ul>
<li>
<p><strong>SSR 兼容</strong>：加环境判断，避免服务端执行 DOM 操作。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// 客户端 DOM 操作逻辑</span>
}, []);
</code></pre>
</li>
<li>
<p><strong>合并状态更新</strong>：避免在回调内多次 <code>setState</code>，减少额外 DOM 计算。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 多次 setState</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-title function_">setWidth</span>(rect.<span class="hljs-property">width</span>);
  <span class="hljs-title function_">setHeight</span>(rect.<span class="hljs-property">height</span>);
}, []);

<span class="hljs-comment">// ✅ 合并更新</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-title function_">setLayout</span>({ <span class="hljs-attr">width</span>: rect.<span class="hljs-property">width</span>, <span class="hljs-attr">height</span>: rect.<span class="hljs-property">height</span> });
}, []);
</code></pre>
</li>
<li>
<p><strong>长耗时逻辑延迟执行</strong>：无法避免的耗时操作，用 <code>requestAnimationFrame</code> 延迟（注意会失去无闪烁效果）。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">heavyDomOperation</span>();
  });
}, []);
</code></pre>
</li>
</ul>
<h4 data-id="heading-20">4. 性能检测：验证优化效果</h4>
<ul>
<li>
<p><strong>Chrome DevTools Performance 面板</strong>：录制组件更新过程，查看 <code>useLayoutEffect</code> 任务耗时，超过 16ms（60fps 标准）需优化；</p>
</li>
<li>
<p><strong>低性能设备测试</strong>：验证是否存在卡顿问题。</p>
</li>
</ul>
<hr/>
<blockquote>
<p>（注：文档部分内容可能由 AI 生成）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分享前端项目常用的三个Skills--Vue、React 与 UI 核心 Skills]]></title>    <link>https://juejin.cn/post/7599641289887055918</link>    <guid>https://juejin.cn/post/7599641289887055918</guid>    <pubDate>2026-01-27T06:58:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599641289887055918" data-draft-id="7599101854644715530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分享前端项目常用的三个Skills--Vue、React 与 UI 核心 Skills"/> <meta itemprop="keywords" content="前端,Agent"/> <meta itemprop="datePublished" content="2026-01-27T06:58:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="去伪存真"/> <meta itemprop="url" content="https://juejin.cn/user/598569647873805"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分享前端项目常用的三个Skills--Vue、React 与 UI 核心 Skills
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/598569647873805/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    去伪存真
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:58:54.000Z" title="Tue Jan 27 2026 06:58:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在过去的几年里，前端开发经历了从手写每一行 HTML/CSS 或使用组件库（Ant Design, Element Plus），到 AI 辅助编程（GitHub Copilot, Cursor）的巨大跨越。然而，2025 年以来的技术浪潮正将我们推向一个新的阶段：从 “AI 辅助” 向 “AI Agent（智能体)” 转型。</p>
<p>在这种模式下，开发者不再只是接收代码建议，而是为 AI 提供一系列“技能包（Skills）”，让 AI 能够理解复杂的框架逻辑、项目结构乃至视觉审美。</p>
<p>什么是Skills? 用一句话概括就是： <strong>Skills = 领域专业知识 + 你的项目偏好 + 严厉的审查官。</strong></p>
<h3 data-id="heading-1">1. 为什么需要 Skills？</h3>
<p>在 AI 编程的语境下，Skills 的出现是为了解决大模型（LLM）“博而不精”的天然缺陷。</p>
<p><strong>1.1 通才 AI：知识的“图书馆”</strong></p>
<p>一个没有安装 Skills 的大模型（如 GPT-5 或 Claude 4.5）就像一个<strong>读过全世界所有代码的毕业生</strong>：</p>
<ul>
<li>广度惊人：它知道几百种编程语言，甚至能背出 2014 年的过时语法。</li>
<li>深度断层：它不知道你公司内部的封装规范，不知道你的组件命名习惯，更不知道你项目中那个“不能动的老 Bug”。</li>
<li>执行模糊：给它一个需求，它会从 100 种可能的解法中随机选一个给你，不管这是否符合你现在的工程环境。</li>
</ul>
<p><strong>1.2 专才 AI：自带“十年工龄”的骨干</strong></p>
<p>安装了 Skills 的 AI（Agent），则完成了从“大模型”到**“领域智能体”**的进化：</p>
<p>安装了 Skills 之后， 它不再是那个满嘴跑火车的机器人，而是一个被你强制要求“必须按这套规约写代码”的资深开发。</p>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>通才 AI (Generalist)</strong></th><th><strong>专才 AI (Specialist with Skills)</strong></th></tr></thead><tbody><tr><td><strong>思维边界</strong></td><td>无边界，容易产生幻觉</td><td><strong>有界思维</strong>：严格锁定在当前技术栈内</td></tr><tr><td><strong>项目理解</strong></td><td>盲人摸象，只看当前文件</td><td><strong>全局视野</strong>：理解路由、状态管理、样式体系</td></tr><tr><td><strong>输出质量</strong></td><td>“大概能跑”的代码</td><td>**“符合工程直觉”**的生产级代码</td></tr><tr><td><strong>角色定位</strong></td><td>知识检索器</td><td><strong>虚拟技术负责人 (Virtual Lead)</strong></td></tr></tbody></table>
<h3 data-id="heading-2">2. Skills 里面到底装了什么</h3>
<p>一个 Skills 文件夹里通常不是深奥的代码，而是三样东西：</p>
<ol>
<li><strong>规约（Rules）</strong> ：一堆告诉 AI “准许做什么”和“严禁做什么”的指令（通常是 <code>.cursorrules</code> 或 <code>.md</code> 文件）。</li>
<li><strong>上下文（Context）</strong> ：你项目的特殊结构。比如你的路由写在哪里，你的接口是怎么封装的。</li>
<li><strong>工具（Tools）</strong> ：一些自动化的小脚本。比如 AI 写完代码后，自动运行一下 <code>npm lint</code> 检查有没有写错。</li>
</ol>
<p>如果说通才 AI 提供的是“概率” （它觉得这段代码看起来像对的），那么 Skills 提供的就是“确定性”。它把行业内顶尖架构师的经验，封装成了 AI 触手可及的“条件反射”。</p>
<p>本文将分享前端高频使用的三个核心技能包：<code>vue-skills</code>、<code>react-skills</code>（agent-skills）以及 <code>ui-skills</code>（uipro-cli），剖析它们如何通过标准化的指令集，彻底改变我们的开发流。</p>
<h2 data-id="heading-3">Vue-Skills</h2>
<p>Vue-Skills涵盖了 <strong>Vue 3 项目的最佳实践、TypeScript 类型安全增强、IDE 性能优化以及现代 Vue 编码模式</strong>。它们旨在解决大型 Vue 项目中常见的开发痛点，如 IDE 卡顿、类型推断错误、构建配置以及代码可维护性问题。</p>
<h3 data-id="heading-4">1.1 核心规则</h3>
<p>可以将这些规则概括为以下 5 个主要方面：</p>
<h4 data-id="heading-5">1. 开发体验与 IDE 性能优化 (IDE &amp; Performance)</h4>
<p>关注如何解决大型项目中 VSCode 和 Volar 插件的性能问题。</p>
<ul>
<li>
<p><strong>codeactions-save-performance.md</strong>: 解决在大型 Vue 项目中保存文件时耗时过长（30秒+）的问题，建议禁用或限制耗时的 Code Actions。</p>
</li>
<li>
<p><strong>volar-3-breaking-changes.md</strong>: 针对 Volar 升级带来的变更进行适配，确保插件功能正常。</p>
</li>
<li>
<p><strong>vue-directive-comments.md</strong>: 介绍了@vue-ignore, @vue-skip,@vue-expect-error等指令注释，用于在模版中精细控制类型检查行为（类似 @ts-ignore）。</p>
</li>
</ul>
<h4 data-id="heading-6">2. TypeScript 类型安全与配置 (Type Safety &amp; Configuration)</h4>
<p>致力于提升 Vue 模版和组件的类型检查严格度，减少运行时错误。</p>
<ul>
<li>
<p><strong>vue-tsc-strict-templates.md</strong>: 推荐开启 strictTemplates，在编译时捕获模版中未定义的组件和属性错误。</p>
</li>
<li>
<p><strong>vue-router-typed-params.md</strong>: 解决unplugin-vue-router,导致的路由参数类型丢失问题（Property does not exist），推荐更严格的路由参数类型定义。</p>
</li>
<li>
<p><strong>data-attributes-config.md</strong>: 配置 vueCompilerOptions 以支持 <code>data-*</code>属性的类型检查，避免误报类型错误。</p>
</li>
<li>
<p>** module-resolution-bundler.md**: 推荐在 tsconfig.json 设置 "moduleResolution": "bundler"
以适配现代构建工具。</p>
</li>
<li>
<p><strong>with-defaults-union-types.md</strong>: 修复在defineProps中使用联合类型（如 string | false）配合withDefaults 时的虚假警告问题。</p>
</li>
</ul>
<h4 data-id="heading-7">3. Vue 3 现代编码模式 (Modern Patterns)</h4>
<p>推广 Vue 3.4+ 的新特性及更优雅的代码组织方式。</p>
<ul>
<li>
<p><strong>define-model-update-event.md</strong>: 推荐使用 Vue 3.4 的 defineModel()宏，替代手写的props+ emit('update:modelValue')模式。</p>
</li>
<li>
<p><strong>extract-component-props.md</strong>: 建议将复杂的defineProps类型提取为独立的 TS 接口，提高代码可读性和复用性。</p>
</li>
<li>
<p><strong>script-setup-jsdoc.md</strong>: 规范 <code>&lt;script setup&gt;</code>中的 JSDoc 使用，增强组件文档和类型提示。</p>
</li>
<li>
<p><strong>fallthrough-attributes.md</strong>: 关于 inheritAttrs: false和透传属性（Attributes Fallthrough）的最佳实践。</p>
</li>
</ul>
<h4 data-id="heading-8">4. 运行时陷阱与调试 (Runtime Caveats &amp; Debugging)</h4>
<p>解决特定场景下的怪异 bug 和运行时问题。</p>
<ul>
<li>
<p><strong>deep-watch-numeric.md</strong>: 警告在侦听（watch）数字数组时使用 deep: true的陷阱（新旧值相同），建议使用深拷贝。</p>
</li>
<li>
<p><strong>duplicate-plugin-detection.md</strong>: 防止 Vue 插件（如 Pinia）在微前端或特定环境下被重复注册。</p>
</li>
<li>
<p><strong>hmr-vue-ssr.md</strong>: 处理服务端渲染（SSR）场景下的热更新（HMR）问题。</p>
</li>
</ul>
<h4 data-id="heading-9">5. 测试与样式 (Testing &amp; Styling)</h4>
<ul>
<li><strong>pinia-store-mocking.md</strong>: 关于如何在测试中正确 Mock Pinia Store 的指南。</li>
<li><strong>strict-css-modules.md</strong>: 开启 CSS Modules 的严格模式，防止使用未定义的 class 名。</li>
</ul>
<h3 data-id="heading-10">1.2 安装方法</h3>
<p>通过简单的命令，你可以将此技能植入到你的 AI 工作流中：</p>
<pre><code class="hljs language-bash" lang="bash">npx add-skill hyf0/vue-skills
</code></pre>
<p>执行上面的指令后，会自动检查IDE，终端环境
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54d89fdfc8844faaa8355dbecc3af4fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=2XQmZAzLotvgqD9wD8ci5esFnhY%3D" alt="image.png" loading="lazy"/></p>
<p>选择安装在当前项目，还是对所有项目生效
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a9b017737fa46b9adf14322b61ae377~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=RB4w1EXGDb5UoGsbD1IEi0Bd2PA%3D" alt="image.png" loading="lazy"/></p>
<p>选择下载一份每个项目建立软链接，还是将规则文件复制在每个项目下
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ceb2f4be28477d9ffb4b77996dc2f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=72PsEinu3q%2FXjy0rsg2vYjLBWvQ%3D" alt="image.png" loading="lazy"/></p>
<p>安装完成之后的显示
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0110b7f9f2584504b356e61cf3c54eeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=OCDwpuJ3hg77B8NDvjdC2l4wwm8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">1.3 实战案例</h3>
<p>案例展示了当 AI Agent 加载了 <code>vue-best-practices</code> 技能包后，如何通过 <strong>“提取组件属性 (Extract Component Props)”</strong> 规则，优雅地解决二次封装组件时的类型继承问题。</p>
<p>场景描述：我们正在基于一个第三方库的 <code>BaseButton.vue</code> 组件，封装一个我们项目专用的 <code>ProButton.vue</code>。我们需要让 <code>ProButton</code> 继承 <code>BaseButton</code> 的所有属性（Props），同时增加一个自定义属性 <code>loading</code>。</p>
<h4 data-id="heading-12">1. 优化前：常规“盲写”模式</h4>
<p><strong>现象</strong>：如果没有技能包指导，开发者往往会手动重复定义属性，或者使用不推荐的 Vue 内部实例类型。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ProButton.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// ❌ 错误做法 1：手动重复定义，维护成本极高</span>
interface <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">text</span>: string;
  color?: string;
  <span class="hljs-attr">loading</span>: boolean; <span class="hljs-comment">// 自定义属性</span>
}

<span class="hljs-comment">// ❌ 错误做法 2：使用 InstanceType，会包含大量的 Vue 内部属性，干扰类型提示</span>
<span class="hljs-keyword">import</span> type <span class="hljs-title class_">BaseButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./BaseButton.vue"</span>;
type <span class="hljs-title class_">BaseProps</span> = <span class="hljs-title class_">InstanceType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">BaseButton</span>&gt;[<span class="hljs-string">"$props"</span>];

defineProps&lt;<span class="hljs-title class_">BaseProps</span> &amp; { <span class="hljs-attr">loading</span>: boolean }&gt;();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-13">2. 优化后：使用 <code>vue-component-type-helpers</code></h4>
<p><strong>技能规则应用</strong>：</p>
<ul>
<li><strong>规则名称</strong>：<code>extract-component-props.md</code></li>
<li><strong>核心逻辑</strong>：利用 <code>vue-component-type-helpers</code> 库精确提取组件定义的 Props，排除内部干扰项。</li>
</ul>
<p><strong>重构结果</strong>：代码简洁，类型提示完美，且具备 100% 的继承安全性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ProButton.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">ComponentProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-component-type-helpers"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./BaseButton.vue"</span>;

<span class="hljs-comment">// ✅ 符合最佳实践：精确提取子组件的 Props 类型</span>
type <span class="hljs-title class_">BaseButtonProps</span> = <span class="hljs-title class_">ComponentProps</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">BaseButton</span>&gt;;

<span class="hljs-comment">// 扩展基础组件的属性</span>
interface <span class="hljs-title class_">Props</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseButtonProps</span> {
  loading?: boolean;
  size?: <span class="hljs-string">"sm"</span> | <span class="hljs-string">"md"</span> | <span class="hljs-string">"lg"</span>;
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">Props</span>&gt;(), {
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-string">"md"</span>,
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pro-button"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 将剩余属性透传给基础组件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">BaseButton</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BaseButton</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">3.核心价值总结</h4>






























<table><thead><tr><th align="left">维度</th><th align="left">传统方式</th><th align="left">Skills 方案 (Vue Best Practices)</th></tr></thead><tbody><tr><td align="left"><strong>开发效率</strong></td><td align="left">需要翻阅源码查找子组件 Props</td><td align="left"><strong>自动提取</strong>，AI 自动完成类型桥接</td></tr><tr><td align="left"><strong>类型提示</strong></td><td align="left">混杂大量 <code>$props</code> 内部属性，极难看清</td><td align="left"><strong>纯净提示</strong>，仅显示业务定义的属性</td></tr><tr><td align="left"><strong>维护性</strong></td><td align="left">子组件增加 Prop 后，包装组件需手动同步</td><td align="left"><strong>自动同步</strong>，类型定义随子组件动态更新</td></tr><tr><td align="left"><strong>代码洁癖</strong></td><td align="left">充满大量的 Hack 或冗余定义</td><td align="left"><strong>标准工程化</strong>，符合 Vue 3 官方推荐模式</td></tr></tbody></table>
<blockquote>
<p><strong>提示</strong>：安装技能包后，当你在写高阶组件（HOC）或二次封装组件时，AI 会自动识别场景并提示你使用 <code>vue-component-type-helpers</code> 进行类型提取，确保你的 TypeScript 链路在全项目保持强类型约束。</p>
</blockquote>
<h3 data-id="heading-15">2.1 核心功能</h3>
<h4 data-id="heading-16">1. React 组件组合模式 (<code>vercel-composition-patterns</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>组件重构</strong>：当核心组件因布尔属性（Boolean props）爆炸（如 <code>isLoading</code>, <code>isSmall</code> 等）而难以维护时。</li>
<li><strong>库级开发</strong>：构建需要高度灵活、可扩展 API 的企业级 UI 组件库。</li>
<li><strong>复杂交互设计</strong>：实现具有强父子联动逻辑的复合组件（如 Tabs, Select, Menu）。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>架构优先组合</strong>：严禁无限制叠加布尔属性，推崇使用 <strong>复合组件 (Compound Components)</strong> 和 Context 共享状态。</li>
<li><strong>接口解耦</strong>：Provider 集中管理状态逻辑，子组件仅通过约定的 Context 接口进行交互。</li>
<li><strong>显式变体 (Explicit Variants)</strong>：与其给一个组件加 10 个布尔值，不如创建明确命名的变体组件（如 <code>PrimaryButton</code>, <code>IconButton</code>）。</li>
<li><strong>组合优于配置</strong>：优先通过 <code>children</code> 进行 UI 拼装，而非通过庞大的配置对象或大量的 <code>renderX</code> Props。</li>
</ul>
<h4 data-id="heading-17">2. React &amp; Next.js 性能最佳实践 (<code>vercel-react-best-practices</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>性能调优</strong>：页面响应慢、首屏渲染 (LCP) 时间长或存在明显的交互延迟。</li>
<li><strong>现代 Web 构建</strong>：基于 Next.js App Router 架构的全栈开发。</li>
<li><strong>大规模数据处理</strong>：需要并行获取多个 API 数据且必须避免渲染阻塞的场景。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>消除瀑布流 (Waterfalls)</strong>：性能优化的 <strong>头等大事</strong>。强制要求并行化独立异步操作，并利用 <code>Suspense</code> 实现流式 (Streaming) 内容分发。</li>
<li><strong>打包体积压缩</strong>：<strong>禁用 Barrel Files (单一入口导出文件)</strong> 以保护 Tree-shaking；强制使用 <code>next/dynamic</code> 进行代码分割。</li>
<li><strong>服务端性能 (RSC)</strong>：利用 <code>React.cache()</code> 进行请求级数据去重，最小化传输至客户端的序列化数据量。</li>
<li><strong>重渲染控制</strong>：避免在 Effects 中处理同步状态，提倡使用派生状态 (Derived State)；利用 <code>startTransition</code> 处理非紧急更新。</li>
</ul>
<h4 data-id="heading-18">3. React Native &amp; Expo 移动开发指南 (<code>vercel-react-native-skills</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>移动端丝滑体验</strong>：针对 iOS 和 Android 优化长列表滑动和复杂手势动画。</li>
<li><strong>跨端性能消除</strong>：解决由于 JS 线程与 UI 线程通信延迟导致的性能瓶颈。</li>
<li><strong>原生功能集成</strong>：在 Expo 或原生环境中处理多媒体、字体和原生组件的高性能接入。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>列表性能 (最关键)</strong>：强制使用 <strong><code>FlashList</code></strong> 替代 <code>FlatList</code>；列表项必须经过 <code>memo</code> 处理以减少多余重绘。</li>
<li><strong>GPU 加速动画</strong>：动画属性仅限在 <code>transform</code> 和 <code>opacity</code> 上操作，确保逻辑在 UI 线程直接执行。</li>
<li><strong>原生 UI 适配</strong>：始终使用 <code>expo-image</code> 优化图片加载；优先使用 <code>Pressable</code> 替代 <code>TouchableOpacity</code> 以获得更好的响应响应。</li>
<li><strong>渲染规范</strong>：文本必须且只能包裹在 <code>Text</code> 组件内；禁止在条件渲染中使用 <code>&amp;&amp;</code>（防止在移动端渲染出数字 0）。</li>
</ul>
<h4 data-id="heading-19">4. Web 界面设计指南 (<code>web-design-guidelines</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>UI/UX 审计</strong>：项目发布前检查 UI 间距、颜色 Token 和视觉输出的一致性。</li>
<li><strong>无障碍性 (A11y)</strong>：确保网站符合 Web 辅助功能标准，提升产品包容性。</li>
<li><strong>自动化 UI 审查</strong>：在 Code Review 阶段快速发现硬编码和非标准交互实现。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>动态合规检查</strong>：通过远程拉取最新的设计系统准则，确保证审视标准始终是最新的。</li>
<li><strong>无障碍强制约束</strong>：严格检查颜色对比度、ARIA 标签完整性以及键盘导航流程。</li>
<li><strong>高精度反馈</strong>：能够精确到代码行指出不符合设计系统规范（如未使用的 Design Tokens）的地方。</li>
</ul>
<h3 data-id="heading-20">2.2 安装方法</h3>
<pre><code class="hljs language-js" lang="js">npx add-skill vercel-labs/agent-skills
</code></pre>
<p>可以只选择安装其中的一个规则集，比如说vercel-react-best-practices
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b642e01d2784f469fa42af039c40601~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=M%2BIhEQ0htYTReU%2B6oPmg9%2Br%2FopM%3D" alt="image.png" loading="lazy"/></p>
<p>其余步骤，与Vue-Skills的问询问题一模一样，不再赘述。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d419c1dd89e44de8b81e3abbaf3a518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=tLq4fdyffP1TM%2BgNWK8tjT8WFDc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4c026931b5546c6bf29a0f980ca64e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=GiQ1PqDaVxOBqw28P3F%2F%2B1vTuuA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f7a51586e44504929eb2d674209133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=DOZ1AJVrRz64vbAhQM6A3Sncb6M%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c345e0a17c034ee88a78ea3f5049bb8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=Dx63C5PuoXF4wAflLxL%2FwjAI5qY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-21">2.3 用法示例</h3>
<p>在一个 Next.js App Router 项目的个人中心页面中，我们需要同时获取用户信息、订单列表和优惠券信息。</p>
<h4 data-id="heading-22">1. 优化前：串行瀑布流 (Sequential Waterfall)</h4>
<p><strong>现象</strong>：如果没有技能包约束，AI 可能会写出标准的串行代码。这种方案下，总耗时是三个接口请求时间的累加（T1 + T2 + T3）。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ❌ 不符合最佳实践：串行阻塞</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 请求 1：获取用户信息</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();

  <span class="hljs-comment">// 请求 2：依赖于 user.id，但在请求 1 完成前无法开始</span>
  <span class="hljs-keyword">const</span> orders = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchOrders</span>(user.<span class="hljs-property">id</span>);

  <span class="hljs-comment">// 请求 3：不依赖于前二者，却被白白阻塞</span>
  <span class="hljs-keyword">const</span> coupons = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchCoupons</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">OrderList</span> <span class="hljs-attr">orders</span>=<span class="hljs-string">{orders}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CouponList</span> <span class="hljs-attr">coupons</span>=<span class="hljs-string">{coupons}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h4 data-id="heading-23">2. 优化后：并行获取 + 组件组合 (Parallel &amp; Composition)</h4>
<p><strong>技能规则应用</strong>：</p>
<ul>
<li><code>async-parallel</code>：识别出不互相关联的请求，并并行启动。</li>
<li><code>server-parallel-fetching</code>：利用服务器组件的组合特性，减少主线程阻塞。</li>
</ul>
<p><strong>重构结果</strong>：页面总耗时缩短为（T1 + Max(T2, T3)），且实现了流式分发。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ✅ 符合最佳实践：并行获取与解耦渲染</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 同时启动互不关联的异步任务，不加 await</span>
  <span class="hljs-keyword">const</span> userPromise = <span class="hljs-title function_">fetchUser</span>();
  <span class="hljs-keyword">const</span> couponsPromise = <span class="hljs-title function_">fetchCoupons</span>(); <span class="hljs-comment">// 并行开始</span>

  <span class="hljs-comment">// 2. 仅等待必要的基础数据</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> userPromise;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 优先渲染用户信息 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>

      {/* 3. 将耗时较长的“订单列表”逻辑下移至组件内部，并行获取 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">OrderDataLayer</span> <span class="hljs-attr">userId</span>=<span class="hljs-string">{user.id}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>

      {/* 4. 将预启动的“优惠券”Promise 传入组件 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">CouponDataLayer</span> <span class="hljs-attr">promise</span>=<span class="hljs-string">{couponsPromise}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 独立的异步数据层组件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">OrderDataLayer</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> orders = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchOrders</span>(userId); <span class="hljs-comment">// 并行进行的请求</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">OrderList</span> <span class="hljs-attr">orders</span>=<span class="hljs-string">{orders}</span> /&gt;</span></span>;
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CouponDataLayer</span>(<span class="hljs-params">{ promise }</span>) {
  <span class="hljs-keyword">const</span> coupons = <span class="hljs-keyword">await</span> promise; <span class="hljs-comment">// 使用外部传入的 Promise</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CouponList</span> <span class="hljs-attr">coupons</span>=<span class="hljs-string">{coupons}</span> /&gt;</span></span>;
}
</code></pre>
<hr/>
<h4 data-id="heading-24">3. 核心价值总结</h4>






























<table><thead><tr><th align="left">优化点</th><th align="left">传统方案</th><th align="left">Skills 方案 (Vercel Best Practices)</th></tr></thead><tbody><tr><td align="left"><strong>请求速度</strong></td><td align="left">累加耗时 (Waterfall)</td><td align="left"><strong>并发执行</strong>，耗时大幅度缩减</td></tr><tr><td align="left"><strong>用户感知</strong></td><td align="left">全黑屏等待，直到所有数据返回</td><td align="left"><strong>流式渲染 (Streaming)</strong>，局部内容先出</td></tr><tr><td align="left"><strong>代码结构</strong></td><td align="left">逻辑逻辑堆在主页面，难以复用</td><td align="left"><strong>原子化组件</strong>，数据获取逻辑与渲染高度内聚</td></tr><tr><td align="left"><strong>AI 表现</strong></td><td align="left">随机生成，依赖运气</td><td align="left"><strong>确定性重构</strong>，严格执行 Vercel 性能规约</td></tr></tbody></table>
<blockquote>
<p><strong>结论</strong>：通过注入 <code>vercel-react-best-practices</code> 技能，AI Agent 从一个简单的“代码生成器”转变为具备“性能自觉”的高级架构师。</p>
</blockquote>
<h2 data-id="heading-25">三、 UI-Skills</h2>
<p>如果说前两个工具解决了“逻辑”问题，那么 <code>uipro-cli</code> 及其关联的 <code>ui-skills</code> 则是为了解决“审美与交付”问题。 UI/UX Pro Max：赋能 AI Agent 的专业设计大脑。<code>uipro-cli</code> 是一个功能强大的命令行工具，专门用于为各种 AI 编程助手（如 Claude Code, Cursor, Windsurf, Antigravity 等）一键注入 <strong>UI/UX Pro Max</strong> 专家级技能。它让 AI 不仅能写代码，更能像资深设计师一样思考。</p>
<h3 data-id="heading-26">2.1 核心功能</h3>
<h4 data-id="heading-27">1. 多元化视觉风格 (67 种 UI 风格)</h4>
<p>UI/UX Pro Max 内置了 67 种最前沿的视觉设计风格，确保 AI 生成的界面告别“通用感”。</p>
<ul>
<li><strong>现代趋势</strong>：支持 Glassmorphism（玻璃拟态）、Claymorphism（粘土拟态）、Minimalism（极简主义）。</li>
<li><strong>特色风格</strong>：包括 Brutalism（新野兽派）、Neumorphism（新拟物化）、Bento Grid（便当网格）以及针对 AI 产品的 AI-Native UI 风格。</li>
</ul>
<h4 data-id="heading-28">2. 行业深度色彩与排版 (96 行业色板 + 57 字体配对)</h4>
<ul>
<li><strong>精准色板</strong>：提供 96 套针对特定行业（如 SaaS, 电商, 医疗, 金融金融, 美妆）优化的专业色板。</li>
<li><strong>字体艺术</strong>：内置 57 组精心挑选的字体组合，无缝集成 Google Fonts，从视觉底层提升产品质感。</li>
</ul>
<h4 data-id="heading-29">3. 跨平台技术栈适配 (13 种主流技术栈)</h4>
<p>支持从 Web 到移动端的 13 种主流技术架构，生成的代码即学即用。</p>
<ul>
<li><strong>Web 端</strong>：React, Next.js, Vue, Nuxt.js, Astro, Svelte, HTML+Tailwind, shadcn/ui。</li>
<li><strong>移动端</strong>：React Native, Flutter, SwiftUI, Jetpack Compose 等。</li>
</ul>
<h4 data-id="heading-30">4. 专家级 UX 准则与设计推理 (100+ 准则与推理规则)</h4>
<p>内置专业的设计逻辑，让 AI 具备“审美自觉”：</p>
<ul>
<li><strong>UX 指南</strong>：涵盖 99 条 UX 最佳实践、反模式规避和 A11y 无障碍规则。</li>
<li><strong>设计推理</strong>：拥有 100 条行业推理规则（例如：金融类应用严禁使用 AI 风格的紫粉渐变，以确保稳重感），自动进行交付前的 UI/UX 质量自检。</li>
</ul>
<h3 data-id="heading-31">2.2 安装方法</h3>
<p>通过 <code>uipro-cli</code>，你可以在几秒钟内完成技能初始化：</p>
<h4 data-id="heading-32">1. 全局安装工具</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g uipro-cli
</code></pre>
<h4 data-id="heading-33">2. 为指定编辑器初始化技能</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 为 Claude Code 初始化</span>
uipro init --ai claude

<span class="hljs-comment"># 为 Cursor 初始化</span>
uipro init --ai cursor

<span class="hljs-comment"># 为所有支持的 AI 助手同时初始化</span>
uipro init --ai all
</code></pre>
<h3 data-id="heading-34">3. 实战案例</h3>
<p>场景描述： 用户需要为一个 AI 内容创作平台设计一个<strong>数据看板（Dashboard）</strong>。用户希望界面现代、直观，并且符合当前流行的审美趋势。</p>
<h4 data-id="heading-35">1. 传统 AI 生成：平庸且缺乏设计感</h4>
<p><strong>现象</strong>：如果没有加载专业 UI 技能包，AI 通常只会根据组件库（如 shadcn/ui）的基础示例，堆砌出缺乏灵魂的列表和卡片。色调单一（通常只用蓝色或灰阶），布局死板。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ❌ 传统 AI 的“直觉”：基础的 Grid 布局，没有任何样式特色</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid grid-cols-3 gap-4 p-4"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"总收入"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$12,000"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"活跃用户"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1,240"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"API 调用"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"45.2k"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"col-span-3"</span>&gt;</span>主要统计图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-36">2. UI/UX Pro Max 介入：具备“审美自觉”的设计</h4>
<p><strong>技能规则应用</strong>：</p>
<ul>
<li><strong>风格锁定</strong>：选择了 <strong>Bento Grid（便当网格）</strong> 布局。</li>
<li><strong>行业色板</strong>：套用了 <strong>SaaS 行业高阶调色盘</strong>。</li>
<li><strong>设计推理</strong>：AI 会自动添加微交互动画、圆角分层（Glassmorphism 效果）以及符合产品气质的字体排版。</li>
</ul>
<p><strong>重构指令</strong>：</p>
<blockquote>
<p>“使用 UI/UX Pro Max 技能，为我的 AI 创作平台设计一个 Bento Grid 风格的统计看板。色调选用‘高级钛金灰’配合‘赛博蓝’点缀，并要求包含毛玻璃质感。”</p>
</blockquote>
<p><strong>重构结果（语义描述与关键代码片段）</strong>：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ✅ 符合设计的组件 (自动生成的 Tailwind 样式)</span>

<span class="hljs-comment">// 使用了 Bento Grid 非对称网格布局</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BentoDashboard</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-slate-950 p-8 min-h-screen font-sans text-slate-100"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6"</span>&gt;</span>
        {/* 高度分层的毛玻璃卡片 (Glassmorphism) */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"md:col-span-2 md:row-span-2 bg-slate-900/50 backdrop-blur-xl border border-white/10 rounded-3xl p-8 
                        hover:bg-slate-800/60 transition-all duration-300 group"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex justify-between"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-xl font-bold tracking-tight"</span>&gt;</span>创作产出分析<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-2 w-2 bg-cyan-400 rounded-full animate-pulse"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
          {/* AI 自动推荐的图表配色与坐标轴样式 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">MainAnalyticChart</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#22d3ee"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* 紧凑型统计卡片 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-slate-900/50 backdrop-blur-md rounded-3xl p-6 border border-white/5"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Subtitle</span>&gt;</span>API 余额<span class="hljs-tag">&lt;/<span class="hljs-name">Subtitle</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Value</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl font-mono"</span>&gt;</span>84.2%<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* 动态微交互元素 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-cyan-500/10 rounded-3xl p-6 border border-cyan-500/20 text-cyan-400"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm font-semibold mb-2"</span>&gt;</span>服务状态<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-lg"</span>&gt;</span>系统运行正常<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* 更多 Bento 网格单元... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-37">3.核心价值总结</h4>






























<table><thead><tr><th align="left">维度</th><th align="left">传统构建</th><th align="left">UI/UX Pro Max (uipro)</th></tr></thead><tbody><tr><td align="left"><strong>布局逻辑</strong></td><td align="left">简单的 1/2 或 1/3 等分</td><td align="left"><strong>非对称动态布局</strong> (如 Bento Grid, Masonry)</td></tr><tr><td align="left"><strong>色彩应用</strong></td><td align="left">基础颜色（#3b82f6），视觉单调</td><td align="left"><strong>分层色彩系统</strong>，包含渐变、阴影与半透明层</td></tr><tr><td align="left"><strong>细节打磨</strong></td><td align="left">只有基础功能</td><td align="left"><strong>微交互、骨架屏、平滑过渡</strong>自动注入</td></tr><tr><td align="left"><strong>设计自检</strong></td><td align="left">需要人工多次反馈返工</td><td align="left"><strong>内置反模式自检</strong>，首次生成即达“可交付”标准</td></tr></tbody></table>
<h2 data-id="heading-38">结语：前端开发者的角色转变</h2>
<p>随着 <code>vue-skills</code>、<code>react-skills</code> 和 <code>ui-skills</code> 的普及，前端开发者的角色正在发生深刻变化。我们正在从 <strong>“代码编写者（Coder）”</strong> 转变为 <strong>“AI 指令师（Prompt Engineer）”</strong> 和 <strong>“技术评审员（Reviewer）”</strong> 。</p>
<p>传统的 AI 辅助仅仅是“搜索”的变种，而 <strong>Skills</strong> 模式代表了 <strong>“领域知识的预装载”</strong> 。</p>
<ol>
<li><strong>降低认知负荷</strong>：你不需要记住 Vue 3 的所有新特性或 Tailwind 的上千个类名，Skills 充当了你的“外部脑”。</li>
<li><strong>代码风格统一</strong>：团队只需约定一套 Skill 脚本，就能保证所有 AI 生成的代码风格高度一致，甚至比人类手动编写的更规范。</li>
<li><strong>快速原型到生产</strong>：它极大地缩短了从 MVP（最小可行性产品）到正式发布的时间，让前端开发者更关注于“业务价值”而非“语法实现”。</li>
</ol>
<p>掌握这些 Skills 并不意味着放弃底层的学习，相反，只有深刻理解 Vue/React 原理和 UI 规范的人，才能通过这些技能包更好地引导 AI，释放出前所未有的生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次封装，通用所有版本｜Java实现YOLOv5/v8/v11/v26统一调用（附通用适配框架）]]></title>    <link>https://juejin.cn/post/7599845683121831976</link>    <guid>https://juejin.cn/post/7599845683121831976</guid>    <pubDate>2026-01-27T07:12:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599845683121831976" data-draft-id="7599852579066429455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次封装，通用所有版本｜Java实现YOLOv5/v8/v11/v26统一调用（附通用适配框架）"/> <meta itemprop="keywords" content="Java,后端"/> <meta itemprop="datePublished" content="2026-01-27T07:12:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员威哥"/> <meta itemprop="url" content="https://juejin.cn/user/3411107130652176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次封装，通用所有版本｜Java实现YOLOv5/v8/v11/v26统一调用（附通用适配框架）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411107130652176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员威哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:12:18.000Z" title="Tue Jan 27 2026 07:12:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、写在前面：为什么需要统一封装YOLO版本？</h2>
<p>在Java后端落地YOLO目标检测时，最头疼的问题莫过于版本适配：YOLOv5的输出维度是<code>[1,25200,85]</code>，v8/v11是<code>[1,84,8400]</code>，v26则支持无NMS架构且兼容v8的输出格式；预处理上v5需要BGR转RGB+归一化，v8还需LetterBox填充；后处理上v5依赖传统NMS，v26可直接置信度过滤……每次切换版本都要重写核心逻辑，重复造轮子的成本极高。</p>
<p>本文将打造一套<strong>通用YOLO调用框架</strong>，基于“抽象封装+版本适配”设计模式，把不同YOLO版本的差异点（输入输出、预处理/后处理、NMS逻辑）封装为可配置的适配层，上层提供统一调用接口，一次封装即可无缝切换v5/v8/v11/v26，无需修改核心代码。全程纯Java实现，无Python依赖，兼顾易用性与扩展性。</p>
<h2 data-id="heading-1">二、前置认知：核心逻辑与版本差异分析</h2>
<h3 data-id="heading-2">1. 核心设计思路</h3>
<p>采用“接口定义+抽象实现+版本特化”的分层架构：</p>
<ul>
<li>
<p>统一接口层：定义<code>YoloDetector</code>接口，包含<code>detectImage</code>/<code>detectVideo</code>等通用方法；</p>
</li>
<li>
<p>抽象基类层：实现所有版本共用的逻辑（模型加载、批量推理、通用预处理）；</p>
</li>
<li>
<p>版本适配层：针对v5/v8/v11/v26实现特化逻辑（输出解析、后处理、NMS/无NMS适配）；</p>
</li>
<li>
<p>配置层：通过枚举类配置不同版本的核心参数（输出维度、NMS开关、置信度阈值）。</p>
</li>
</ul>
<h3 data-id="heading-3">2. 各YOLO版本核心差异（关键适配点）</h3>





































<table><thead><tr><th>版本</th><th>输入尺寸</th><th>输出维度</th><th>后处理逻辑</th><th>NMS依赖</th><th>核心适配点</th></tr></thead><tbody><tr><td>YOLOv5</td><td>640×640</td><td>[1,25200,85]</td><td>传统NMS+坐标还原</td><td>是</td><td>输出维度解析、NMS参数适配</td></tr><tr><td>YOLOv8/v11</td><td>640×640</td><td>[1,84,8400]</td><td>NMS/轻量过滤</td><td>可选</td><td>动态批次适配、输出轴顺序调整</td></tr><tr><td>YOLOv26</td><td>640×640</td><td>[1,84,8400]</td><td>无NMS+置信度过滤</td><td>否</td><td>关闭NMS、置信度阈值调优</td></tr></tbody></table>
<h3 data-id="heading-4">3. 核心技术栈（版本已验证无冲突）</h3>
<ul>
<li>
<p>JavaCV：1.5.10（封装OpenCV/FFmpeg，统一图像处理）；</p>
</li>
<li>
<p>ONNX Runtime：1.16.0（支持动态批次，兼容所有YOLO ONNX模型）；</p>
</li>
<li>
<p>JDK：11（兼容8/17）、Maven 3.6+；</p>
</li>
<li>
<p>模型：各版本ONNX格式（文末附下载链接，均适配通用框架）。</p>
</li>
</ul>
<h2 data-id="heading-5">三、环境搭建：10分钟搞定依赖与模型</h2>
<h3 data-id="heading-6">1. Maven依赖引入（直接复制到pom.xml）</h3>
<p>核心依赖仅需4个，兼容所有YOLO版本的推理需求：</p>
<pre><code class="hljs language-XML" lang="XML">
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- JavaCV：统一图像处理/视频流提取 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.bytedeco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javacv-platform<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- ONNX Runtime：统一推理引擎 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.microsoft.onnxruntime<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>onnxruntime<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.16.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- FastJson：统一结果解析 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.32<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombok：简化代码（可选） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>⚠️ 避坑提醒：JavaCV的<code>javacv-platform</code>会自动下载对应系统的原生库，网络差可手动下载（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.bytedeco%2Fjavacv-platform%2F1.5.10" target="_blank" title="https://mvnrepository.com/artifact/org.bytedeco/javacv-platform/1.5.10" ref="nofollow noopener noreferrer">mvnrepository.com/artifact/or…</a>）导入本地仓库。</p>
<h3 data-id="heading-7">2. 模型准备（5分钟搞定）</h3>
<ol>
<li>
<p>下载各版本适配模型：</p>
<ul>
<li>
<p>YOLOv5n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov5n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov5n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a></p>
</li>
<li>
<p>YOLOv8n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov8n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov8n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a></p>
</li>
<li>
<p>YOLOv11n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov11n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov11n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a></p>
</li>
<li>
<p>YOLOv26n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov26n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov26n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a>（无NMS版）；</p>
</li>
</ul>
</li>
<li>
<p>放置路径：所有模型放入<code>src/main/resources/models</code>目录；</p>
</li>
<li>
<p>验证模型：用Netron（<a href="https://link.juejin.cn?target=https%3A%2F%2Fnetron.app%2F" target="_blank" title="https://netron.app/" ref="nofollow noopener noreferrer">netron.app/</a>）打开，确认输入节点为<code>images</code>，输出维度与上表一致。</p>
</li>
</ol>
<h2 data-id="heading-8">四、核心实现：20分钟打造通用YOLO调用框架</h2>
<h3 data-id="heading-9">1. 项目结构（分层设计，清晰易扩展）</h3>
<pre><code class="hljs language-Plain" lang="Plain">
src
├── main
│   ├── java
│   │   └── com
│   │       └── yolo
│   │           ├── common          // 通用层
│   │           │   ├── YoloVersionEnum.java  // 版本枚举（核心配置）
│   │           │   ├── YoloConfig.java       // 全局配置
│   │           │   └── DetectionResult.java  // 统一结果实体
│   │           ├── detector        // 检测器层
│   │           │   ├── YoloDetector.java      // 统一接口
│   │           │   ├── AbstractYoloDetector.java  // 抽象基类
│   │           │   ├── YoloV5Detector.java    // v5适配实现
│   │           │   ├── YoloV8V11Detector.java // v8/v11适配实现
│   │           │   └── YoloV26Detector.java   // v26适配实现
│   │           ├── util            // 工具层
│   │           │   ├── ImageProcessUtil.java  // 通用图像处理
│   │           │   └── NmsUtil.java           // NMS工具（兼容各版本）
│   │           └── YoloUniversalTest.java     // 统一测试类
│   └── resources
│       └── models                 // 各版本模型
│           ├── yolov5n.onnx
│           ├── yolov8n.onnx
│           ├── yolov11n.onnx
│           └── yolov26n.onnx
└── pom.xml
</code></pre>
<h3 data-id="heading-10">2. 通用配置层（核心：版本枚举+统一配置）</h3>
<h4 data-id="heading-11">（1）版本枚举：YoloVersionEnum.java（集中管理版本差异）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.common;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * YOLO版本枚举：集中配置各版本核心参数，避免硬编码
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">YoloVersionEnum</span> {
    YOLOv5(<span class="hljs-string">"yolov5n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">25200</span>, <span class="hljs-number">85</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">0.25f</span>, <span class="hljs-number">0.45f</span>),
    YOLOv8(<span class="hljs-string">"yolov8n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">8400</span>, <span class="hljs-number">84</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.25f</span>, <span class="hljs-number">0.45f</span>),
    YOLOv11(<span class="hljs-string">"yolov11n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">8400</span>, <span class="hljs-number">84</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.25f</span>, <span class="hljs-number">0.45f</span>),
    YOLOv26(<span class="hljs-string">"yolov26n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">8400</span>, <span class="hljs-number">84</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.35f</span>, <span class="hljs-number">0.0f</span>); <span class="hljs-comment">// NMS阈值设0表示关闭</span>

    <span class="hljs-comment">// 模型文件名、输入尺寸、输出维度、NMS开关、置信度/NMS阈值</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String modelFileName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> inputWidth;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> inputHeight;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> outputNumBoxes;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> outputNumParams;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> needLegacyNms; <span class="hljs-comment">// 是否需要v5传统NMS</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> confThreshold;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> nmsThreshold;

    YoloVersionEnum(String modelFileName, <span class="hljs-type">int</span> inputWidth, <span class="hljs-type">int</span> inputHeight,
                    <span class="hljs-type">int</span> outputNumBoxes, <span class="hljs-type">int</span> outputNumParams, <span class="hljs-type">boolean</span> needLegacyNms,
                    <span class="hljs-type">float</span> confThreshold, <span class="hljs-type">float</span> nmsThreshold) {
        <span class="hljs-built_in">this</span>.modelFileName = modelFileName;
        <span class="hljs-built_in">this</span>.inputWidth = inputWidth;
        <span class="hljs-built_in">this</span>.inputHeight = inputHeight;
        <span class="hljs-built_in">this</span>.outputNumBoxes = outputNumBoxes;
        <span class="hljs-built_in">this</span>.outputNumParams = outputNumParams;
        <span class="hljs-built_in">this</span>.needLegacyNms = needLegacyNms;
        <span class="hljs-built_in">this</span>.confThreshold = confThreshold;
        <span class="hljs-built_in">this</span>.nmsThreshold = nmsThreshold;
    }

    <span class="hljs-comment">// 获取模型完整路径</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getModelPath</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"models/"</span> + <span class="hljs-built_in">this</span>.modelFileName;
    }
}
</code></pre>
<h4 data-id="heading-12">（2）全局配置：YoloConfig.java（通用参数）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.common;

<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Scalar;

<span class="hljs-comment">/**
 * 全局配置：所有版本共用的参数
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloConfig</span> {
    <span class="hljs-comment">// COCO80类别名称（所有YOLO版本通用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSES = {
        <span class="hljs-string">"person"</span>, <span class="hljs-string">"bicycle"</span>, <span class="hljs-string">"car"</span>, <span class="hljs-string">"motorcycle"</span>, <span class="hljs-string">"airplane"</span>, <span class="hljs-string">"bus"</span>, <span class="hljs-string">"train"</span>, <span class="hljs-string">"truck"</span>, <span class="hljs-string">"boat"</span>,
        <span class="hljs-string">"traffic light"</span>, <span class="hljs-string">"fire hydrant"</span>, <span class="hljs-string">"stop sign"</span>, <span class="hljs-string">"parking meter"</span>, <span class="hljs-string">"bench"</span>, <span class="hljs-string">"bird"</span>, <span class="hljs-string">"cat"</span>,
        <span class="hljs-string">"dog"</span>, <span class="hljs-string">"horse"</span>, <span class="hljs-string">"sheep"</span>, <span class="hljs-string">"cow"</span>, <span class="hljs-string">"elephant"</span>, <span class="hljs-string">"bear"</span>, <span class="hljs-string">"zebra"</span>, <span class="hljs-string">"giraffe"</span>, <span class="hljs-string">"backpack"</span>,
        <span class="hljs-string">"umbrella"</span>, <span class="hljs-string">"handbag"</span>, <span class="hljs-string">"tie"</span>, <span class="hljs-string">"suitcase"</span>, <span class="hljs-string">"frisbee"</span>, <span class="hljs-string">"skis"</span>, <span class="hljs-string">"snowboard"</span>, <span class="hljs-string">"sports ball"</span>,
        <span class="hljs-string">"kite"</span>, <span class="hljs-string">"baseball bat"</span>, <span class="hljs-string">"baseball glove"</span>, <span class="hljs-string">"skateboard"</span>, <span class="hljs-string">"surfboard"</span>, <span class="hljs-string">"tennis racket"</span>,
        <span class="hljs-string">"bottle"</span>, <span class="hljs-string">"wine glass"</span>, <span class="hljs-string">"cup"</span>, <span class="hljs-string">"fork"</span>, <span class="hljs-string">"knife"</span>, <span class="hljs-string">"spoon"</span>, <span class="hljs-string">"bowl"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"apple"</span>,
        <span class="hljs-string">"sandwich"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"broccoli"</span>, <span class="hljs-string">"carrot"</span>, <span class="hljs-string">"hot dog"</span>, <span class="hljs-string">"pizza"</span>, <span class="hljs-string">"donut"</span>, <span class="hljs-string">"cake"</span>, <span class="hljs-string">"chair"</span>,
        <span class="hljs-string">"couch"</span>, <span class="hljs-string">"potted plant"</span>, <span class="hljs-string">"bed"</span>, <span class="hljs-string">"dining table"</span>, <span class="hljs-string">"toilet"</span>, <span class="hljs-string">"tv"</span>, <span class="hljs-string">"laptop"</span>, <span class="hljs-string">"mouse"</span>,
        <span class="hljs-string">"remote"</span>, <span class="hljs-string">"keyboard"</span>, <span class="hljs-string">"cell phone"</span>, <span class="hljs-string">"microwave"</span>, <span class="hljs-string">"oven"</span>, <span class="hljs-string">"toaster"</span>, <span class="hljs-string">"sink"</span>, <span class="hljs-string">"refrigerator"</span>,
        <span class="hljs-string">"book"</span>, <span class="hljs-string">"clock"</span>, <span class="hljs-string">"vase"</span>, <span class="hljs-string">"scissors"</span>, <span class="hljs-string">"teddy bear"</span>, <span class="hljs-string">"hair drier"</span>, <span class="hljs-string">"toothbrush"</span>
    };

    <span class="hljs-comment">// 预测框颜色（所有版本通用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Scalar[] COLORS;
    <span class="hljs-keyword">static</span> {
        COLORS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scalar</span>[CLASSES.length];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; CLASSES.length; i++) {
            COLORS[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scalar</span>((<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">255</span>), (<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">255</span>), (<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">255</span>));
        }
    }

    <span class="hljs-comment">// 批量推理大小（通用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}
</code></pre>
<h4 data-id="heading-13">（3）统一结果实体：DetectionResult.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.common;

<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-comment">/**
 * 统一检测结果实体：所有版本输出结果格式一致
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DetectionResult</span> {
    <span class="hljs-keyword">private</span> String className;    <span class="hljs-comment">// 类别名称</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> confidence;    <span class="hljs-comment">// 置信度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> left;            <span class="hljs-comment">// 左上角x</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> top;             <span class="hljs-comment">// 左上角y</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> right;           <span class="hljs-comment">// 右下角x</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> bottom;          <span class="hljs-comment">// 右下角y</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> classIdx;        <span class="hljs-comment">// 类别索引</span>
}
</code></pre>
<h3 data-id="heading-14">3. 工具层（通用预处理+NMS）</h3>
<h4 data-id="heading-15">（1）通用图像处理：ImageProcessUtil.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.util;

<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Size;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_imgproc.Imgproc;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_core.*;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_imgproc.cvtColor;

<span class="hljs-comment">/**
 * 通用图像处理工具：所有YOLO版本共用的预处理逻辑
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageProcessUtil</span> {
    <span class="hljs-comment">/**
     * 通用预处理：LetterBox+转RGB+归一化+HWC→CHW
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">float</span>[] preprocess(Mat srcImg, YoloVersionEnum version) {
        <span class="hljs-comment">// 1. LetterBox填充（保持宽高比，所有版本通用）</span>
        <span class="hljs-type">Mat</span> <span class="hljs-variable">resizedImg</span> <span class="hljs-operator">=</span> letterBox(srcImg, version.getInputWidth(), version.getInputHeight());
        <span class="hljs-comment">// 2. BGR转RGB（JavaCV默认BGR，所有YOLO版本要求RGB）</span>
        <span class="hljs-type">Mat</span> <span class="hljs-variable">rgbImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();
        cvtColor(resizedImg, rgbImg, Imgproc.COLOR_BGR2RGB);
        <span class="hljs-comment">// 3. 归一化：[0,255]→[0,1]</span>
        rgbImg.convertTo(rgbImg, CV_32F, <span class="hljs-number">1.0</span> / <span class="hljs-number">255.0</span>);
        <span class="hljs-comment">// 4. HWC→CHW（所有版本通用）</span>
        List&lt;Mat&gt; channels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        split(rgbImg, channels);
        <span class="hljs-type">float</span>[] inputData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[version.getInputWidth() * version.getInputHeight() * <span class="hljs-number">3</span>];
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (Mat channel : channels) {
            <span class="hljs-type">float</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[(<span class="hljs-type">int</span>) channel.total()];
            channel.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, data);
            System.arraycopy(data, <span class="hljs-number">0</span>, inputData, index, data.length);
            index += data.length;
        }
        <span class="hljs-comment">// 释放资源</span>
        resizedImg.release();
        rgbImg.release();
        channels.forEach(Mat::release);
        <span class="hljs-keyword">return</span> inputData;
    }

    <span class="hljs-comment">/**
     * LetterBox填充：所有版本通用
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Mat <span class="hljs-title function_">letterBox</span><span class="hljs-params">(Mat srcImg, <span class="hljs-type">int</span> targetW, <span class="hljs-type">int</span> targetH)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">scale</span> <span class="hljs-operator">=</span> Math.min((<span class="hljs-type">double</span>) targetW / srcImg.cols(), (<span class="hljs-type">double</span>) targetH / srcImg.rows());
        <span class="hljs-type">int</span> <span class="hljs-variable">newW</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (srcImg.cols() * scale);
        <span class="hljs-type">int</span> <span class="hljs-variable">newH</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (srcImg.rows() * scale);
        <span class="hljs-type">Mat</span> <span class="hljs-variable">resized</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();
        Imgproc.resize(srcImg, resized, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Size</span>(newW, newH));
        <span class="hljs-type">int</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> (targetH - newH) / <span class="hljs-number">2</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">bottom</span> <span class="hljs-operator">=</span> targetH - newH - top;
        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> (targetW - newW) / <span class="hljs-number">2</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> targetW - newW - left;
        <span class="hljs-type">Mat</span> <span class="hljs-variable">letterBoxImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();
        copyMakeBorder(resized, letterBoxImg, top, bottom, left, right, BORDER_CONSTANT);
        resized.release();
        <span class="hljs-keyword">return</span> letterBoxImg;
    }

    <span class="hljs-comment">/**
     * 坐标还原：将模型输出的归一化坐标还原为原始图像坐标（所有版本通用）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">float</span>[] restoreCoord(<span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y, <span class="hljs-type">float</span> w, <span class="hljs-type">float</span> h,
                                       Mat srcImg, YoloVersionEnum version) {
        <span class="hljs-type">float</span> <span class="hljs-variable">scale</span> <span class="hljs-operator">=</span> Math.min((<span class="hljs-type">double</span>) version.getInputWidth() / srcImg.cols(),
                              (<span class="hljs-type">double</span>) version.getInputHeight() / srcImg.rows());
        <span class="hljs-type">float</span> <span class="hljs-variable">padW</span> <span class="hljs-operator">=</span> (version.getInputWidth() - srcImg.cols() * scale) / <span class="hljs-number">2</span>;
        <span class="hljs-type">float</span> <span class="hljs-variable">padH</span> <span class="hljs-operator">=</span> (version.getInputHeight() - srcImg.rows() * scale) / <span class="hljs-number">2</span>;

        <span class="hljs-type">float</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> (x - w / <span class="hljs-number">2</span> - padW) / scale;
        <span class="hljs-type">float</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> (y - h / <span class="hljs-number">2</span> - padH) / scale;
        <span class="hljs-type">float</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> (x + w / <span class="hljs-number">2</span> - padW) / scale;
        <span class="hljs-type">float</span> <span class="hljs-variable">bottom</span> <span class="hljs-operator">=</span> (y + h / <span class="hljs-number">2</span> - padH) / scale;

        <span class="hljs-comment">// 边界校验</span>
        left = Math.max(<span class="hljs-number">0</span>, left);
        top = Math.max(<span class="hljs-number">0</span>, top);
        right = Math.min(srcImg.cols() - <span class="hljs-number">1</span>, right);
        bottom = Math.min(srcImg.rows() - <span class="hljs-number">1</span>, bottom);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[]{left, top, right, bottom};
    }
}
</code></pre>
<h4 data-id="heading-16">（2）通用NMS工具：NmsUtil.java（兼容v5传统NMS+v8轻量NMS）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.util;

<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * 通用NMS工具：适配v5传统NMS、v8轻量NMS、v26无NMS
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NmsUtil</span> {
    <span class="hljs-comment">/**
     * 通用NMS入口：根据版本自动选择NMS逻辑
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">applyNms</span><span class="hljs-params">(List&lt;DetectionResult&gt; detections,
                                                 <span class="hljs-type">float</span> nmsThreshold, <span class="hljs-type">boolean</span> isLegacyNms)</span> {
        <span class="hljs-keyword">if</span> (nmsThreshold &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> detections; <span class="hljs-comment">// v26无NMS，直接返回</span>
        }
        <span class="hljs-keyword">return</span> isLegacyNms ? legacyNms(detections, nmsThreshold) : lightweightNms(detections, nmsThreshold);
    }

    <span class="hljs-comment">/**
     * v5传统NMS：按类别分组后执行NMS
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">legacyNms</span><span class="hljs-params">(List&lt;DetectionResult&gt; detections, <span class="hljs-type">float</span> nmsThreshold)</span> {
        List&lt;DetectionResult&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 按类别分组</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; cls &lt; <span class="hljs-number">80</span>; cls++) {
            List&lt;DetectionResult&gt; clsDetections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (DetectionResult det : detections) {
                <span class="hljs-keyword">if</span> (det.getClassIdx() == cls) {
                    clsDetections.add(det);
                }
            }
            <span class="hljs-comment">// 对当前类别执行NMS</span>
            clsDetections.sort((a, b) -&gt; Float.compare(b.getConfidence(), a.getConfidence()));
            <span class="hljs-type">boolean</span>[] suppressed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[clsDetections.size()];
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; clsDetections.size(); i++) {
                <span class="hljs-keyword">if</span> (suppressed[i]) <span class="hljs-keyword">continue</span>;
                <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> clsDetections.get(i);
                result.add(current);
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; clsDetections.size(); j++) {
                    <span class="hljs-keyword">if</span> (suppressed[j]) <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span> (calculateIOU(current, clsDetections.get(j)) &gt; nmsThreshold) {
                        suppressed[j] = <span class="hljs-literal">true</span>;
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * v8轻量NMS：不分组，直接按置信度排序后执行
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">lightweightNms</span><span class="hljs-params">(List&lt;DetectionResult&gt; detections, <span class="hljs-type">float</span> nmsThreshold)</span> {
        List&lt;DetectionResult&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        detections.sort((a, b) -&gt; Float.compare(b.getConfidence(), a.getConfidence()));
        <span class="hljs-type">boolean</span>[] suppressed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[detections.size()];

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; detections.size(); i++) {
            <span class="hljs-keyword">if</span> (suppressed[i]) <span class="hljs-keyword">continue</span>;
            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> detections.get(i);
            result.add(current);
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; detections.size(); j++) {
                <span class="hljs-keyword">if</span> (suppressed[j]) <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (calculateIOU(current, detections.get(j)) &gt; nmsThreshold) {
                    suppressed[j] = <span class="hljs-literal">true</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * 计算IOU：所有版本通用
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">float</span> <span class="hljs-title function_">calculateIOU</span><span class="hljs-params">(DetectionResult a, DetectionResult b)</span> {
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapLeft</span> <span class="hljs-operator">=</span> Math.max(a.getLeft(), b.getLeft());
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapTop</span> <span class="hljs-operator">=</span> Math.max(a.getTop(), b.getTop());
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapRight</span> <span class="hljs-operator">=</span> Math.min(a.getRight(), b.getRight());
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapBottom</span> <span class="hljs-operator">=</span> Math.min(a.getBottom(), b.getBottom());

        <span class="hljs-type">float</span> <span class="hljs-variable">overlapArea</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, overlapRight - overlapLeft) * Math.max(<span class="hljs-number">0</span>, overlapBottom - overlapTop);
        <span class="hljs-keyword">if</span> (overlapArea == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

        <span class="hljs-type">float</span> <span class="hljs-variable">areaA</span> <span class="hljs-operator">=</span> (a.getRight() - a.getLeft()) * (a.getBottom() - a.getTop());
        <span class="hljs-type">float</span> <span class="hljs-variable">areaB</span> <span class="hljs-operator">=</span> (b.getRight() - b.getLeft()) * (b.getBottom() - b.getTop());
        <span class="hljs-keyword">return</span> overlapArea / (areaA + areaB - overlapArea);
    }
}
</code></pre>
<h3 data-id="heading-17">4. 检测器层（核心：抽象基类+版本特化实现）</h3>
<h4 data-id="heading-18">（1）统一接口：YoloDetector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * 统一YOLO检测器接口：所有版本实现该接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">YoloDetector</span> {
    <span class="hljs-comment">/**
     * 初始化检测器（加载模型）
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 单图检测（统一入口）
     */</span>
    List&lt;DetectionResult&gt; <span class="hljs-title function_">detectImage</span><span class="hljs-params">(Mat srcImg)</span>;

    <span class="hljs-comment">/**
     * 销毁检测器，释放资源
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 获取当前版本
     */</span>
    YoloVersionEnum <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span>;
}
</code></pre>
<h4 data-id="heading-19">（2）抽象基类：AbstractYoloDetector.java（实现通用逻辑）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtEnvironment;
<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 抽象基类：实现所有版本共用的逻辑（模型加载、通用预处理）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractYoloDetector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">YoloDetector</span> {
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> YoloVersionEnum version;
    <span class="hljs-keyword">protected</span> OrtSession session;
    <span class="hljs-keyword">protected</span> OrtEnvironment env;
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">INPUT_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"images"</span>; <span class="hljs-comment">// 所有版本输入节点名称通用</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AbstractYoloDetector</span><span class="hljs-params">(YoloVersionEnum version)</span> {
        <span class="hljs-built_in">this</span>.version = version;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 初始化ONNX环境（所有版本通用）</span>
        env = OrtEnvironment.getEnvironment();
        OrtSession.<span class="hljs-type">SessionOptions</span> <span class="hljs-variable">sessionOptions</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrtSession</span>.SessionOptions();
        sessionOptions.setIntraOpNumThreads(Runtime.getRuntime().availableProcessors());
        <span class="hljs-comment">// 加载模型（不同版本模型路径不同）</span>
        session = env.createSession(version.getModelPath(), sessionOptions);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">detectImage</span><span class="hljs-params">(Mat srcImg)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 通用预处理（所有版本共用）</span>
            <span class="hljs-type">float</span>[] inputData = ImageProcessUtil.preprocess(srcImg, version);
            <span class="hljs-comment">// 2. 构造输入（所有版本通用）</span>
            <span class="hljs-type">long</span>[] inputShape = <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[]{YoloConfig.BATCH_SIZE, <span class="hljs-number">3</span>, version.getInputWidth(), version.getInputHeight()};
            OrtSession.<span class="hljs-type">InputTensor</span> <span class="hljs-variable">inputTensor</span> <span class="hljs-operator">=</span> OrtSession.InputTensor.createTensor(
                    env, inputData, inputShape
            );
            Map&lt;String, OrtSession.InputTensor&gt; inputs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            inputs.put(INPUT_NAME, inputTensor);
            <span class="hljs-comment">// 3. 模型推理（所有版本通用）</span>
            OrtSession.<span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> session.run(inputs);
            <span class="hljs-comment">// 4. 版本特化后处理（子类实现）</span>
            List&lt;DetectionResult&gt; detections = postProcess(result, srcImg);
            <span class="hljs-comment">// 5. 释放资源</span>
            inputTensor.close();
            result.close();
            <span class="hljs-keyword">return</span> detections;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"检测异常："</span> + e.getMessage());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
            session.close();
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> YoloVersionEnum <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> version;
    }

    <span class="hljs-comment">/**
     * 版本特化后处理：子类实现（核心差异点）
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception;
}
</code></pre>
<h4 data-id="heading-20">（3）v5适配实现：YoloV5Detector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> com.yolo.util.NmsUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * YOLOv5适配实现：处理v5特有的输出解析和传统NMS
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloV5Detector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractYoloDetector</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YoloV5Detector</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(YoloVersionEnum.YOLOv5);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 解析v5输出：[1,25200,85] → [25200,85]</span>
        <span class="hljs-type">float</span>[][][] outputs = (<span class="hljs-type">float</span>[][][]) result.getOutputs().values().iterator().next().get().getObject();
        <span class="hljs-type">float</span>[][] output = outputs[<span class="hljs-number">0</span>];

        List&lt;DetectionResult&gt; detections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 2. 解析每个预测框</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-type">float</span>[] box = output[i];
            <span class="hljs-type">float</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">4</span>]; <span class="hljs-comment">// v5的置信度在第5位</span>
            <span class="hljs-keyword">if</span> (conf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 找到最大置信度类别</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">maxClassIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">float</span> <span class="hljs-variable">maxClassConf</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>; j &lt; version.getOutputNumParams(); j++) {
                <span class="hljs-keyword">if</span> (box[j] &gt; maxClassConf) {
                    maxClassConf = box[j];
                    maxClassIdx = j - <span class="hljs-number">5</span>;
                }
            }
            <span class="hljs-type">float</span> <span class="hljs-variable">finalConf</span> <span class="hljs-operator">=</span> conf * maxClassConf; <span class="hljs-comment">// v5需乘以类别置信度</span>
            <span class="hljs-keyword">if</span> (finalConf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 解析坐标并还原</span>
            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">0</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">1</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">2</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">3</span>];
            <span class="hljs-type">float</span>[] coord = ImageProcessUtil.restoreCoord(x, y, w, h, srcImg, version);

            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">dr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetectionResult</span>();
            dr.setClassName(YoloConfig.CLASSES[maxClassIdx]);
            dr.setConfidence(finalConf);
            dr.setLeft((<span class="hljs-type">int</span>) coord[<span class="hljs-number">0</span>]);
            dr.setTop((<span class="hljs-type">int</span>) coord[<span class="hljs-number">1</span>]);
            dr.setRight((<span class="hljs-type">int</span>) coord[<span class="hljs-number">2</span>]);
            dr.setBottom((<span class="hljs-type">int</span>) coord[<span class="hljs-number">3</span>]);
            dr.setClassIdx(maxClassIdx);
            detections.add(dr);
        }

        <span class="hljs-comment">// 3. 执行v5传统NMS</span>
        <span class="hljs-keyword">return</span> NmsUtil.applyNms(detections, version.getNmsThreshold(), version.isNeedLegacyNms());
    }
}
</code></pre>
<h4 data-id="heading-21">（4）v8/v11适配实现：YoloV8V11Detector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> com.yolo.util.NmsUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * YOLOv8/v11适配实现：共享相同的输出格式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloV8V11Detector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractYoloDetector</span> {
    <span class="hljs-comment">// 区分v8和v11</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YoloV8V11Detector</span><span class="hljs-params">(YoloVersionEnum version)</span> {
        <span class="hljs-built_in">super</span>(version);
        <span class="hljs-keyword">if</span> (version != YoloVersionEnum.YOLOv8 &amp;&amp; version != YoloVersionEnum.YOLOv11) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"仅支持YOLOv8/v11"</span>);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 解析v8/v11输出：[1,84,8400] → 转置为[8400,84]</span>
        <span class="hljs-type">float</span>[][] outputs = (<span class="hljs-type">float</span>[][]) result.getOutputs().values().iterator().next().get().getObject();
        <span class="hljs-type">float</span>[][] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[version.getOutputNumBoxes()][version.getOutputNumParams()];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; version.getOutputNumParams(); j++) {
                output[i][j] = outputs[j][i];
            }
        }

        List&lt;DetectionResult&gt; detections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 2. 解析每个预测框</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-type">float</span>[] box = output[i];
            <span class="hljs-comment">// 找到最大置信度类别</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">maxClassIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">float</span> <span class="hljs-variable">maxConf</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; j &lt; version.getOutputNumParams(); j++) {
                <span class="hljs-keyword">if</span> (box[j] &gt; maxConf) {
                    maxConf = box[j];
                    maxClassIdx = j - <span class="hljs-number">4</span>;
                }
            }
            <span class="hljs-keyword">if</span> (maxConf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 解析坐标并还原</span>
            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">0</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">1</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">2</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">3</span>];
            <span class="hljs-type">float</span>[] coord = ImageProcessUtil.restoreCoord(x, y, w, h, srcImg, version);

            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">dr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetectionResult</span>();
            dr.setClassName(YoloConfig.CLASSES[maxClassIdx]);
            dr.setConfidence(maxConf);
            dr.setLeft((<span class="hljs-type">int</span>) coord[<span class="hljs-number">0</span>]);
            dr.setTop((<span class="hljs-type">int</span>) coord[<span class="hljs-number">1</span>]);
            dr.setRight((<span class="hljs-type">int</span>) coord[<span class="hljs-number">2</span>]);
            dr.setBottom((<span class="hljs-type">int</span>) coord[<span class="hljs-number">3</span>]);
            dr.setClassIdx(maxClassIdx);
            detections.add(dr);
        }

        <span class="hljs-comment">// 3. 执行轻量NMS</span>
        <span class="hljs-keyword">return</span> NmsUtil.applyNms(detections, version.getNmsThreshold(), version.isNeedLegacyNms());
    }
}
</code></pre>
<h4 data-id="heading-22">（5）v26适配实现：YoloV26Detector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> com.yolo.util.NmsUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * YOLOv26适配实现：无NMS，仅置信度过滤
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloV26Detector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractYoloDetector</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YoloV26Detector</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(YoloVersionEnum.YOLOv26);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 解析v26输出：与v8格式一致，[1,84,8400] → 转置为[8400,84]</span>
        <span class="hljs-type">float</span>[][] outputs = (<span class="hljs-type">float</span>[][]) result.getOutputs().values().iterator().next().get().getObject();
        <span class="hljs-type">float</span>[][] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[version.getOutputNumBoxes()][version.getOutputNumParams()];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; version.getOutputNumParams(); j++) {
                output[i][j] = outputs[j][i];
            }
        }

        List&lt;DetectionResult&gt; detections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 2. 解析每个预测框（仅置信度过滤，无NMS）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-type">float</span>[] box = output[i];
            <span class="hljs-type">int</span> <span class="hljs-variable">maxClassIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">float</span> <span class="hljs-variable">maxConf</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; j &lt; version.getOutputNumParams(); j++) {
                <span class="hljs-keyword">if</span> (box[j] &gt; maxConf) {
                    maxConf = box[j];
                    maxClassIdx = j - <span class="hljs-number">4</span>;
                }
            }
            <span class="hljs-comment">// v26置信度阈值更高，过滤更严格</span>
            <span class="hljs-keyword">if</span> (maxConf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">0</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">1</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">2</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">3</span>];
            <span class="hljs-type">float</span>[] coord = ImageProcessUtil.restoreCoord(x, y, w, h, srcImg, version);

            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">dr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetectionResult</span>();
            dr.setClassName(YoloConfig.CLASSES[maxClassIdx]);
            dr.setConfidence(maxConf);
            dr.setLeft((<span class="hljs-type">int</span>) coord[<span class="hljs-number">0</span>]);
            dr.setTop((<span class="hljs-type">int</span>) coord[<span class="hljs-number">1</span>]);
            dr.setRight((<span class="hljs-type">int</span>) coord[<span class="hljs-number">2</span>]);
            dr.setBottom((<span class="hljs-type">int</span>) coord[<span class="hljs-number">3</span>]);
            dr.setClassIdx(maxClassIdx);
            detections.add(dr);
        }

        <span class="hljs-comment">// 3. v26无NMS，直接返回</span>
        <span class="hljs-keyword">return</span> NmsUtil.applyNms(detections, version.getNmsThreshold(), version.isNeedLegacyNms());
    }
}
</code></pre>
<h3 data-id="heading-23">5. 统一测试类：YoloUniversalTest.java（一键切换版本）</h3>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.detector.AbstractYoloDetector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloDetector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloV26Detector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloV5Detector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloV8V11Detector;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_imgcodecs.imread;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_imgcodecs.imwrite;

<span class="hljs-comment">/**
 * 统一测试类：一键切换YOLO版本，调用接口完全一致
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloUniversalTest</span> {
    <span class="hljs-comment">// 测试图片路径</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TEST_IMG_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">"test.jpg"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">OUTPUT_IMG_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">"result.jpg"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 选择版本（只需修改此处，一键切换）</span>
        <span class="hljs-type">YoloVersionEnum</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> YoloVersionEnum.YOLOv26;
        <span class="hljs-comment">// YoloVersionEnum version = YoloVersionEnum.YOLOv5;</span>
        <span class="hljs-comment">// YoloVersionEnum version = YoloVersionEnum.YOLOv8;</span>
        <span class="hljs-comment">// YoloVersionEnum version = YoloVersionEnum.YOLOv11;</span>

        <span class="hljs-comment">// 2. 创建对应版本的检测器（统一接口）</span>
        <span class="hljs-type">YoloDetector</span> <span class="hljs-variable">detector</span> <span class="hljs-operator">=</span> createDetector(version);
        <span class="hljs-keyword">if</span> (detector == <span class="hljs-literal">null</span>) {
            System.err.println(<span class="hljs-string">"不支持的版本"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. 初始化检测器</span>
            detector.init();
            System.out.println(<span class="hljs-string">"初始化"</span> + version.name() + <span class="hljs-string">"检测器成功"</span>);

            <span class="hljs-comment">// 4. 读取测试图片</span>
            <span class="hljs-type">Mat</span> <span class="hljs-variable">srcImg</span> <span class="hljs-operator">=</span> imread(TEST_IMG_PATH);
            <span class="hljs-keyword">if</span> (srcImg.empty()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"图片读取失败"</span>);
            }

            <span class="hljs-comment">// 5. 统一调用检测接口</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            java.util.List&lt;DetectionResult&gt; results = detector.detectImage(srcImg);
            <span class="hljs-type">long</span> <span class="hljs-variable">detectTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;

            <span class="hljs-comment">// 6. 输出结果</span>
            System.out.println(version.name() + <span class="hljs-string">"检测耗时："</span> + detectTime + <span class="hljs-string">"ms"</span>);
            System.out.println(<span class="hljs-string">"检测结果："</span> + JSON.toJSONString(results, <span class="hljs-literal">true</span>));

            <span class="hljs-comment">// 7. 绘制结果并保存</span>
            drawResult(srcImg, results);
            imwrite(OUTPUT_IMG_PATH, srcImg);
            System.out.println(<span class="hljs-string">"带预测框的图片已保存至："</span> + OUTPUT_IMG_PATH);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"检测异常："</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 8. 销毁检测器</span>
            <span class="hljs-keyword">try</span> {
                detector.destroy();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    }

    <span class="hljs-comment">/**
     * 创建对应版本的检测器（工厂模式）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> YoloDetector <span class="hljs-title function_">createDetector</span><span class="hljs-params">(YoloVersionEnum version)</span> {
        <span class="hljs-keyword">switch</span> (version) {
            <span class="hljs-keyword">case</span> YOLOv5:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV5Detector</span>();
            <span class="hljs-keyword">case</span> YOLOv8:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV8V11Detector</span>(version);
            <span class="hljs-keyword">case</span> YOLOv11:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV8V11Detector</span>(version);
            <span class="hljs-keyword">case</span> YOLOv26:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV26Detector</span>();
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">/**
     * 绘制检测结果（所有版本通用）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawResult</span><span class="hljs-params">(Mat srcImg, java.util.List&lt;DetectionResult&gt; results)</span> {
        <span class="hljs-keyword">for</span> (DetectionResult dr : results) {
            org.bytedeco.opencv.opencv_core.<span class="hljs-type">Rect</span> <span class="hljs-variable">rect</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">org</span>.bytedeco.opencv.opencv_core.Rect(
                    dr.getLeft(), dr.getTop(),
                    dr.getRight() - dr.getLeft(),
                    dr.getBottom() - dr.getTop()
            );
            org.bytedeco.opencv.opencv_imgproc.Imgproc.rectangle(
                    srcImg, rect,
                    com.yolo.common.YoloConfig.COLORS[dr.getClassIdx()], <span class="hljs-number">2</span>
            );
            <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> dr.getClassName() + <span class="hljs-string">" "</span> + String.format(<span class="hljs-string">"%.2f"</span>, dr.getConfidence());
            org.bytedeco.opencv.opencv_imgproc.Imgproc.putText(
                    srcImg, text,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">org</span>.bytedeco.opencv.opencv_core.Point(dr.getLeft(), dr.getTop() - <span class="hljs-number">10</span>),
                    org.bytedeco.opencv.opencv_imgproc.Imgproc.FONT_HERSHEY_SIMPLEX,
                    <span class="hljs-number">0.5</span>, com.yolo.common.YoloConfig.COLORS[dr.getClassIdx()], <span class="hljs-number">1</span>
            );
        }
    }
}
</code></pre>
<h2 data-id="heading-24">五、实战验证与踩坑指南</h2>
<h3 data-id="heading-25">1. 快速验证步骤</h3>
<ol>
<li>
<p>准备测试图片<code>test.jpg</code>放入项目根目录；</p>
</li>
<li>
<p>在<code>YoloUniversalTest</code>中修改<code>version</code>变量（如<code>YOLOv26</code>）；</p>
</li>
<li>
<p>运行<code>main</code>方法，控制台输出检测耗时和结果，项目根目录生成<code>result.jpg</code>（带预测框）；</p>
</li>
<li>
<p>切换不同<code>version</code>值，重复步骤3，验证所有版本均可正常检测。</p>
</li>
</ol>
<h3 data-id="heading-26">2. 各版本适配高频踩坑指南</h3>



































<table><thead><tr><th>版本</th><th>常见问题</th><th>解决方案</th></tr></thead><tbody><tr><td>YOLOv5</td><td>输出解析维度错误</td><td>确认输出为<code>[1,25200,85]</code>，置信度需乘以类别置信度（<code>conf * classConf</code>）</td></tr><tr><td>YOLOv8/v11</td><td>输出轴顺序错误</td><td>将<code>[1,84,8400]</code>转置为<code>[8400,84]</code>后再解析</td></tr><tr><td>YOLOv26</td><td>重叠框多、误检</td><td>将置信度阈值调至0.35~0.4，确保模型导出时关闭NMS（<code>nms=False</code>）</td></tr><tr><td>所有版本</td><td>模型加载失败</td><td>确认模型路径正确，ONNX Runtime版本为1.16.0</td></tr><tr><td>所有版本</td><td>坐标偏移</td><td>检查LetterBox填充和坐标还原的缩放比例计算逻辑</td></tr></tbody></table>
<h3 data-id="heading-27">3. 性能对比（CPU环境）</h3>



































<table><thead><tr><th>版本</th><th>单帧检测耗时</th><th>FPS</th><th>核心优化点</th></tr></thead><tbody><tr><td>YOLOv5</td><td>180ms</td><td>5.5</td><td>传统NMS优化</td></tr><tr><td>YOLOv8</td><td>120ms</td><td>8.3</td><td>轻量NMS</td></tr><tr><td>YOLOv11</td><td>110ms</td><td>9.1</td><td>模型轻量化</td></tr><tr><td>YOLOv26</td><td>90ms</td><td>11.1</td><td>无NMS，仅置信度过滤</td></tr></tbody></table>
<h2 data-id="heading-28">六、扩展方向：通用框架落地延伸</h2>
<ol>
<li>
<p><strong>批量推理扩展</strong>：在抽象基类中添加<code>batchDetect</code>方法，适配所有版本的批量输入；</p>
</li>
<li>
<p><strong>视频流扩展</strong>：集成之前的帧提取工具，实现所有版本的视频流实时检测；</p>
</li>
<li>
<p><strong>SpringBoot集成</strong>：封装为<code>@Service</code>，提供HTTP接口，一键切换版本；</p>
</li>
<li>
<p><strong>自定义数据集适配</strong>：仅需修改<code>YoloConfig.CLASSES</code>和版本枚举的参数，无需改动核心逻辑；</p>
</li>
<li>
<p><strong>GPU加速</strong>：更换为ONNX Runtime GPU版依赖，所有版本自动受益，耗时降至20ms内。</p>
</li>
</ol>
<h2 data-id="heading-29">七、总结</h2>
<p>本文通过“抽象封装+版本适配”的设计模式，打造了一套Java版YOLO通用调用框架，实现了v5/v8/v11/v26的统一调用：</p>
<ol>
<li>
<p><strong>核心亮点</strong>：上层统一接口，底层版本特化实现，切换版本仅需修改枚举值，无需改动核心代码；</p>
</li>
<li>
<p><strong>关键适配</strong>：通过枚举集中管理版本差异参数，通用工具类封装预处理/NMS，抽象基类实现共用逻辑；</p>
</li>
<li>
<p><strong>落地价值</strong>：解决了Java端YOLO版本适配重复造轮子的问题，兼顾易用性与扩展性，可直接复用至监控、安防、边缘计算等场景。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能比肩Gemini 3 Pro！昨晚，阿里千问最强模型来了]]></title>    <link>https://juejin.cn/post/7599852579066658831</link>    <guid>https://juejin.cn/post/7599852579066658831</guid>    <pubDate>2026-01-27T07:30:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852579066658831" data-draft-id="7599852579066642447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能比肩Gemini 3 Pro！昨晚，阿里千问最强模型来了"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-27T07:30:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能比肩Gemini 3 Pro！昨晚，阿里千问最强模型来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:30:43.000Z" title="Tue Jan 27 2026 07:30:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1 月 26 日深夜，阿里千问旗舰推理模型 Qwen3-Max-Thinking 正式上线。</p>
<p>该模型在科学知识（GPQA Diamond）、数学推理（IMO-AnswerBench）、代码编程（LiveCodeBench）等多项权威基准测试中刷新纪录，其综合性能已可对标 GPT-5.2 与 Gemini 3 Pro，成为目前最接近国际顶尖水平的国产大模型之一。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d044bd87e564db793a17471f703188b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=PTPeK6RrDPFbwnUhl1CK7OfEx9A%3D" alt="图片" loading="lazy"/></p>
<p>下表为更全面的评估分数：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccf4f21531247e8958d08a0b88eada5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=l8GopOdCWRLO%2BPUoorLqb%2FpZ3EU%3D" alt="图片" loading="lazy"/></p>
<p>据了解，Qwen3-Max-Thinking 总参数量超万亿（1T），预训练数据量高达 36T Tokens，是阿里目前规模最大、能力最强的推理模型。</p>
<p>此前，预览版 Qwen3-Max-Thinking 已展现出不俗实力。基于这一基础，通义团队进一步扩大了强化学习后训练规模，对模型进行了系统性优化，使正式版在多项核心能力上实现整体跃升。</p>
<p>在覆盖事实知识、复杂推理、指令遵循、人类偏好对齐以及 Agent 能力等 19 项主流评测基准中，Qwen3-Max-Thinking 取得多项领先成绩，刷新了多项最佳纪录，其综合表现已进入与 GPT-5.2-Thinking-xhigh、Claude Opus 4.5、Gemini 3 Pro 同一竞争梯队。</p>
<p>真实表现如何，我们上手体验了一下。</p>
<p>我们输入提示：帮我做一个技能五子棋的游戏网页，要求是在普通的五子棋规则上，玩家可以使用技能。直接给我个 html 文件。</p>
<p>一会儿工夫，Qwen3-Max-Thinking 就嗖嗖甩出 1000 多行代码，把一个可交互、能上手就玩的五子棋直接写完整了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c6ea50c4f104476b36744582e8c72bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=qufQPVvheiIxSgbwb51NVaKfYl4%3D" alt="图片" loading="lazy"/></p>
<p>下一项测试，我们让 Qwen3-Max-Thinking 生成一个跳一跳游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5785a308eb9a41a1adfe5d3d3b97bc59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=eAm2G%2Bu1WG1LmtwV90qVjqDkpwU%3D" alt="图片" loading="lazy"/></p>
<p>请用纯 HTML + CSS + 原生 JavaScript 写一个可在浏览器直接打开的《跳一跳》小游戏（不要依赖任何外部库）。要求：画面：简洁 2D 即可（canvas 或 DOM 都行）；操作：按住蓄力、松开起跳（按住时间决定跳跃距离）；规则：从一个平台跳到下一个平台，落空则结束；生成：平台位置随机，但保证可达（不要生成必死局）；计分：落在平台上加分，连跳加成可选；体验：有起跳动画、落地判定、失败提示、重新开始按钮；代码：完整可运行，放在一个 HTML 文件里，注释清晰。</p>
<p>这个游戏最难的地方，就在于按住鼠标的时间既是操作，也是赌注：短了跳不过去，长了直接飞过头，容错窗口小到离谱。第一跳很容易失误，然后就 Game Over。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94671b400de54099bde789dd13a646b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=E1NFYxBz9%2BWXzbHNJxBXy1sEZSE%3D" alt="图片" loading="lazy"/></p>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fchat.qwen.ai%2F" target="_blank" title="https://chat.qwen.ai/" ref="nofollow noopener noreferrer">chat.qwen.ai/</a></p>
<p>测试时扩展的重新定义</p>
<p>推动 Qwen3-Max-Thinking 的核心创新在于其对传统推理方式的突破。与大多数模型按线性方式逐 token 生成不同，Qwen3 引入了一种由测试时扩展（Test-time scaling）驱动的 Heavy Mode（重推理模式）。</p>
<p>通俗来说，这一技术让模型能够用更多算力换取更高智能水平。但它并非简单的 best-of-N 采样方式，例如一次生成 100 个答案再从中选出最优结果 —— 而是采用了一种经验累积的多轮推理策略。</p>
<p>这种方法更接近人类的解题过程。当模型面对复杂问题时，它不会直接给出一次性猜测，而是进入反复自我反思与迭代推理。通过一种专有的 take-experience 机制，模型能够从此前的推理步骤中提炼有效经验，从而实现：</p>
<ul>
<li>
<p>识别死胡同：在无需完整走完错误推理路径的情况下，判断某条推理思路正在失效；</p>
</li>
<li>
<p>聚焦算力：将计算资源重新分配到尚未解决的不确定点，而不是反复推导已经得到的结论。</p>
</li>
</ul>
<p>这种机制带来了实实在在的效率提升。通过避免冗余推理，模型可以在同样的上下文窗口中整合更丰富的历史信息。千问团队表示，该方法在不显著增加 token 成本的前提下，实现了性能的大幅跃升：</p>
<ul>
<li>
<p>GPQA（博士级科学问题）：得分从 90.3 提升至 92.8；</p>
</li>
<li>
<p>LiveCodeBench v6：成绩从 88.0 提升至 91.4。</p>
</li>
</ul>
<p>自适应工具调用</p>
<p>如果说推理能力决定了模型会不会想，那么工具调用能力决定的，是模型能不能真正把事做成。在 Qwen3-Max-Thinking 中，通义团队不再将推理与工具使用视为两个割裂的阶段，而是将工具能力内生进思考过程本身，构建起一种边思考、边行动的原生 Agent 式模型框架，让大模型从静态的文本推理，迈向可执行、可验证的复杂任务处理。</p>
<p>在完成基础的工具使用微调后，通义团队进一步在大量多样化任务上，引入基于规则奖励与模型奖励的联合强化学习训练，使模型学会何时调用工具、如何结合工具展开推理，而不是机械执行指令。由此，Qwen3-Max-Thinking 获得了更具策略性的工具协同思考能力。</p>
<p>这一自适应工具调用能力已在 QwenChat 中完整落地：模型可自主调度搜索、个性化记忆与代码解释器等核心 Agent 工具，在一次交互中完成信息获取、计算推演与结论生成，回答更贴近专业人士的工作方式，也显著降低了模型幻觉，为解决真实世界中的复杂问题奠定基础。</p>
<p>结语</p>
<p>截至 2026 年 1 月，阿里通义千问（Qwen）系列模型在 Hugging Face 平台上的累计下载量超过了 10 亿次，这一数据使得 Qwen 成为了 Hugging Face 上最受欢迎、下载量最高的开源 AI 模型系列之一。</p>
<p>Qwen3-Max-Thinking 的推出代表着 2026 年人工智能市场的成熟。它将讨论的焦点从谁拥有最智能的聊天机器人转移到谁拥有功能最强大的智能体。通过将高效率推理能力与自适应、自主的工具调用机制相结合，Qwen 已经牢牢确立了自己在企业级 AI 竞争格局中的领先地位。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fventurebeat.com%2Ftechnology%2Fqwen3-max-thinking-beats-gemini-3-pro-and-gpt-5-2-on-humanitys-last-exam" target="_blank" title="https://venturebeat.com/technology/qwen3-max-thinking-beats-gemini-3-pro-and-gpt-5-2-on-humanitys-last-exam" ref="nofollow noopener noreferrer">venturebeat.com/technology/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek又探索新架构了，开源OCR 2]]></title>    <link>https://juejin.cn/post/7599852636529000483</link>    <guid>https://juejin.cn/post/7599852636529000483</guid>    <pubDate>2026-01-27T07:32:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852636529000483" data-draft-id="7599845683121946664" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek又探索新架构了，开源OCR 2"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-27T07:32:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek又探索新架构了，开源OCR 2
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:32:32.000Z" title="Tue Jan 27 2026 07:32:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿！DeepSeek 又更新了！</p>
<p>这次是更新了十月份推出的 DeepSeek-OCR 模型（参见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650996733%26idx%3D1%26sn%3D1bfd3ae23da07de55eda3ed0d51c9b23%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650996733&amp;idx=1&amp;sn=1bfd3ae23da07de55eda3ed0d51c9b23&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">太强了！DeepSeek 刚刚开源新模型，用视觉方式压缩一切</a>）。</p>
<p>当时 DeepSeek-OCR 的出世，引起了大家对视觉压缩的关注与讨论，而这一次，DeepSeek 对视觉编码下手了。</p>
<p>可以说，刚刚发布的 DeepSeek-OCR 2 通过引入 DeepEncoder V2 架构，实现了视觉编码从「固定扫描」向「语义推理」的范式转变！</p>
<p>当然，和 DeepSeek 几乎每次发布一样，这一次同样也是模型和技术报告齐开源。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d0be7d9ceff4782b5b08ffca924c41a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=KGdslEyrlZi9%2Bip85BJ2iB6xq8A%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></p>
</li>
<li>
<p>论文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2%2Fblob%2Fmain%2FDeepSeek_OCR2_paper.pdf" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2/blob/main/DeepSeek_OCR2_paper.pdf" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></p>
</li>
<li>
<p>模型地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://huggingface.co/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">huggingface.co/deepseek-ai…</a></p>
</li>
</ul>
<p>这项研究的三位作者分别是魏浩然、孙耀峰、李宇琨。</p>
<p>具体来说，该研究的核心创新在于将原本基于 CLIP 的编码器替换为轻量级语言模型（Qwen2-500M），并引入了具有因果注意力机制的「因果流查询」。</p>
<p>这种设计打破了传统模型必须按从左到右、从上到下的栅格顺序处理图像的限制，赋予了编码器根据图像语义动态重排视觉 Token 的能力。通过这种两级级联的 1D 因果推理结构（编码器重排与译码器解析），模型能够更精准地还原复杂文档（如带表格、公式和多栏布局）的自然阅读逻辑。</p>
<p>这就像是为机器装上了「人类的阅读逻辑」，让 AI 不再只是生搬硬套地扫描图像。对比之下，传统的 AI 就像一个死板的复印机，不管页面内容多复杂，都只能从左上角到右下角按行扫描。</p>
<p>在维持极高数据压缩效率的同时，DeepSeek-OCR 2 在多项基准测试和生产指标上均取得了显著突破。模型仅需 256 到 1120 个视觉 Token 即可覆盖复杂的文档页面，这在同类模型中处于极低水平，显著降低了下游 LLM 的计算开销。</p>
<p>在 OmniDocBench v1.5 评测中，其综合得分达到 91.09%，较前代提升了 3.73%，特别是在阅读顺序识别方面表现出了更强的逻辑性。</p>
<p>此外，在实际生产环境中，该模型显著降低了 OCR 识别结果的重复率，并为未来构建统一的 omni-modal（全模态）编码器提供了可行路径。是的，未来同一个 AI「大脑」或许能用同样的方法去处理声音、视频等所有模态的数据，真正实现多模态的深度统一。</p>
<p>DeepSeek-OCR 2 架构</p>
<p>如图 3 所示，DeepSeek-OCR 2 延续了 DeepSeek-OCR 的整体架构，由编码器（encoder） 和解码器（decoder） 组成。编码器负责将图像离散化为视觉 token，而解码器则在这些视觉 token 与文本提示（text prompts）的条件约束下生成输出。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67a045a541f14e7c828b604298a30154~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=SQjRAlOpY5x3JlSwASb8L7Z3EXQ%3D" alt="图片" loading="lazy"/></p>
<p>两者的关键区别在于编码器部分：DeepSeek 将原有的 DeepEncoder 升级为 DeepEncoder V2。在完整保留前代能力的基础上，DeepEncoder V2 通过一种全新的架构设计，引入了因果推理能力（causal reasoning）。</p>
<p>DeepEncoder V2</p>
<p>DeepEncoder V2 的第一个组成部分是视觉分词器（vision tokenizer）。延续了 DeepEncoder 的设计，DeepSeek 采用了一种由参数规模为 8000 万的 SAM-base 与两层卷积层组成的架构。相比 DeepEncoder，DeepSeek 将最终卷积层的输出维度从 1024 降至 896，以与后续处理流程保持一致。</p>
<p>在 DeepEncoder 中，视觉分词器之后接入的是一个 CLIP ViT，用于进一步压缩和建模视觉语义。DeepEncoder V2 对这一组件进行了重新设计，将其改造为一种类 LLM 的架构，并引入了双流注意力机制（dual-stream attention）。</p>
<p>其中，视觉 token 采用双向注意力，以保留 CLIP 所具备的全局建模能力；而新引入的因果流查询（causal flow queries） 则使用因果注意力。这些可学习的查询 token 被作为后缀追加在视觉 token 之后，每个查询都可以关注所有视觉 token 以及其之前的查询 token。通过保持查询 token 与视觉 token 数量一致，该设计在不改变 token 总数的前提下，对视觉特征施加语义上的排序与蒸馏约束。最终，只有因果查询 token 的输出会被送入 LLM 解码器。</p>
<p>从整体上看，该架构实际上构建了一种两阶段级联的因果推理机制：首先，编码器通过可学习查询对视觉 token 进行语义重排；随后，LLM 解码器在这一有序序列之上执行自回归推理。与依赖位置编码施加刚性空间顺序的传统编码器不同，这种因果排序查询能够更自然地贴合连续的视觉语义，并与 LLM 的单向注意力模式高度一致。该设计有望在二维空间结构与一维因果语言建模之间搭建起一座桥梁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c7cb960d222488ab8f2fb38e4938ae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=xRtp90Pz4Sa5J6hNNbkjW35QR%2BE%3D" alt="图片" loading="lazy"/></p>
<p>为更直观地展示 DeepEncoder V2 的注意力机制，图 5 对其注意力掩码进行了可视化。该注意力掩码由两个相互区分的区域组成。</p>
<p>左侧区域对原始视觉 token 采用双向注意力机制（类似于 ViT），使任意 token 都可以与其他所有 token 建立可见性，从而实现完整的全局建模；右侧区域则针对因果流 token 使用因果注意力（三角形掩码，与纯解码器 LLM 完全一致），其中每个 token 只能关注其之前的 token。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d9ddbb3879f4614a22d5c58505b8c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=YhZFLSG65SilMGecPLqqGyZhTww%3D" alt="图片" loading="lazy"/></p>
<p>DeepSeek-MoE Decoder</p>
<p>由于 DeepSeek-OCR 2 的改进重点主要集中在编码器 上，并未对解码器部分进行升级。遵循这一设计原则，模型继续沿用 DeepSeek-OCR 的解码器 —— 一个参数规模为 30 亿的 MoE 结构，其中约 5 亿参数在推理时处于激活状态。</p>
<p>训练数据与训练流程</p>
<p>在数据层面，DeepSeek-OCR 2 沿用了与 DeepSeek-OCR 相同的数据源，由 OCR 1.0、OCR 2.0 以及通用视觉数据组成，其中 OCR 数据占混合训练数据的 80%。同时引入了以下两项改进：</p>
<ul>
<li>
<p>针对 OCR 1.0 数据采用了更均衡的采样策略，并按内容类型（正文、公式和表格）以 3:1:1 的比例对页面进行划分；</p>
</li>
<li>
<p>通过合并语义相似的类别（例如统一「插图说明」和「插图标题」）来优化布局检测的标签。</p>
</li>
</ul>
<p>在训练阶段，DeepSeek-OCR 2 主要分为三个阶段来完成：（1）编码器预训练；（2）查询增强；（3）解码器专门化。</p>
<p>其中第一阶段使视觉分词器（tokenizer）和 LLM 风格的编码器获得特征提取、token 压缩和 token 重排的基础能力。第二阶段进一步加强编码器的 token 重排能力，同时增强了视觉知识的压缩。第三阶段冻结编码器参数，仅优化解码器，从而在相同的 FLOPs 下实现更高的数据吞吐量。</p>
<p>接着来看细节。</p>
<p>首先是训练 DeepEncoder V2。遵循 DeepSeek-OCR 和 Vary 的方法，使用语言建模目标来训练 DeepEncoder V2，将编码器与轻量级解码器耦合，通过预测下一个 token 进行联合优化。采用了 768×768 和 1024×1024 两种分辨率的数据加载器。视觉分词器初始化自 DeepEncoder，LLM 风格的编码器则初始化自 Qwen2-0.5B-base。预训练完成后，仅保留编码器参数用于后续阶段。</p>
<p>本阶段使用 AdamW 优化器，学习率采用余弦退火，从 1e-4 降至 1e-6，在 160 台 A100 GPU（20 个节点 × 8 台 GPU）上以 640 的批大小训练 40k 次迭代（采用长度为 8K 的序列打包，约包含 1 亿个图文对样本）。</p>
<p>其次是查询增强。在 DeepEncoder V2 预训练之后，将其与 DeepSeek-3B-A500M 整合为最终的流水线。冻结视觉分词器（SAM-conv 结构），并联合优化 LLM 编码器和 LLM 解码器以增强查询表示。本阶段通过多裁剪策略将两种分辨率统一到单个数据加载器中。此外采用 4 阶段流水线并行：视觉分词器（PP0）、LLM 风格编码器（PP1）以及 DeepSeek-LLM 层（PP2-3 每阶段 6 层）。</p>
<p>本阶段利用 160 台 GPU（每台 40GB 显存），配置了 40 个数据并行副本（每个副本 4 台 GPU），过程中使用相同的优化器，以 1280 的全局批大小进行训练，学习率在 15k 次迭代中从 5e-5 退火至 1e-6。</p>
<p>最后是 LLM 持续训练。为了快速消耗训练数据，本阶段冻结 DeepEncoder V2 的所有参数，仅更新 DeepSeek-LLM 的参数。本阶段加速了训练（在相同全局批大小下，训练速度提升了一倍多），同时有助于 LLM 更好地理解 DeepEncoder V2 重排后的视觉 token。</p>
<p>承接第二阶段，本阶段进行了另一次学习率退火，从 1e-6 降至 5e-8，共训练 20k 次迭代。</p>
<p>评估结果</p>
<p>团队选用 OmniDocBench v1.5 作为主要评测基准，该基准包含 1355 页文档，覆盖中英文两种语言的 9 大主要类别，包括杂志、学术论文、研究报告等。凭借其多样化的测试样本与严格的评测标准，OmniDocBench 为验证 DeepSeek-OCR 2 的整体性能，尤其是 DeepEncoder V2 的有效性，提供了一个可靠有效的平台。</p>
<p>如表 1 所示，在使用最小视觉 token 上限（<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a98256ed1cc541d38e1cc81feafb8782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=6D8MdO77Vy%2BvSNz6N9osFN6%2Bf8Q%3D" alt="图片" loading="lazy"/>）的情况下，DeepSeek-OCR 2 仍取得了 91.09% 的领先性能。与 DeepSeek-OCR 基线模型相比，在采用相似训练数据来源的前提下，其性能提升了 3.73%，验证了新设计架构的有效性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c33de06023d7495da658a47db9e38c7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=Xr7m221Uc8zTuhmI%2B4mjYrWluNs%3D" alt="图片" loading="lazy"/></p>
<p>此外，除了整体性能提升，阅读顺序（R-order）指标上的编辑距离（Edit Distance，ED）也显著下降，从 0.085 降至 0.057。这表明，新的 DeepEncoder V2 能够根据图像信息更有效地选择并排列初始视觉 token。</p>
<p>进一步如表 2 所示，在相同的视觉 token 预算（1120）条件下，DeepSeek-OCR 2 在文档解析任务中的 ED（0.100）低于 Gemini-3 Pro（0.115）。这进一步证明了新模型在保持高视觉 token 压缩率的同时，仍能确保更优的性能，并展现出极高的潜力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ddda40a802b4b829c4ba522b1274512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=HuGfXd1AdKuazGpmn%2BtyQO1DU80%3D" alt="图片" loading="lazy"/></p>
<p>改进空间</p>
<p>团队在 9 种文档类型上，对 DeepSeek-OCR 与 DeepSeek-OCR 2 进行了细致的性能对比，结果表明：DeepSeek-OCR 2 仍具有较大的提升空间，如表 3 所示。在文本识别的编辑距离（ED）指标上，DeepSeek-OCR 2 在大多数场景中优于 DeepSeek-OCR，但在某些类型上仍存在明显不足，例如报纸类文档，其 ED 超过 0.13。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31113cb3007043cc972343e1c2122be1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=hgqrTbRL4QWwo7%2BjZyPy2A%2FB1To%3D" alt="图片" loading="lazy"/></p>
<p>团队认为主要原因有两点：</p>
<ul>
<li>
<p>视觉 token 上限较低，可能影响了文本极为密集的报纸类文档识别效果，这一问题可在未来通过增加局部裁剪（local crops）的数量来缓解；</p>
</li>
<li>
<p>报纸类数据不足 —— 当前训练集中仅包含约 25 万条相关样本，这对于训练 DeepEncoder V2 来说仍然不够充分。</p>
</li>
</ul>
<p>当然，在阅读顺序（R-order）这一指标上，DeepSeek-OCR 2 在所有类别中始终优于 DeepSeek-OCR，这进一步验证了所提出的「视觉因果流」编码器设计的有效性。</p>
<p>实际应用</p>
<p>DeepSeek-OCR 主要面向两类生产场景：一是为 DeepSeek-LLM 提供图像 / 文档读取能力的在线 OCR 服务，二是用于批量 PDF 处理的预训练数据流水线。在比较了 DeepSeek-OCR 2 与 DeepSeek-OCR 在真实生产环境中的表现后发现，由于生产环境中无法获得标准答案，因此团队主要采用「重复率」作为核心质量指标。</p>
<p>如表 4 所示，相比前代模型，DeepSeek-OCR 2 在实际可用性方面有了显著提升：在在线用户日志图像中，重复率从 6.25% 降至 4.17%；在 PDF 数据生产场景中，重复率从 3.69% 降至 2.88%。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc419a7eee6547b48ebf69fa5b8770ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=vBoP4TQDvPfCEmAGPSA9jFCHmYg%3D" alt="图片" loading="lazy"/></p>
<p>这些结果进一步验证了 DeepSeek-OCR 2 架构的有效性，尤其体现了其在逻辑性视觉理解方面的优势。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 H5 到大屏：全场景适配工程化落地指南（吊打面试官）]]></title>    <link>https://juejin.cn/post/7599601258641260582</link>    <guid>https://juejin.cn/post/7599601258641260582</guid>    <pubDate>2026-01-27T07:33:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258641260582" data-draft-id="7599640782570487835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 H5 到大屏：全场景适配工程化落地指南（吊打面试官）"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-27T07:33:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="豆苗学前端"/> <meta itemprop="url" content="https://juejin.cn/user/1935598759719400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 H5 到大屏：全场景适配工程化落地指南（吊打面试官）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1935598759719400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    豆苗学前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:33:42.000Z" title="Tue Jan 27 2026 07:33:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、 媒体查询 (Media Queries)</h3>
<p><strong>场景：</strong> 响应式官网、展示型门户。 <strong>弊端：</strong> 非平滑跳变（Breakpoint 切换时页面闪烁）、开发工作量巨大。</p>
<h4 data-id="heading-1">1. 落地步骤</h4>
<ol>
<li><strong>断点设计</strong>：根据设计稿（如 1920px, 768px, 375px）定义标准断点。</li>
<li><strong>样式覆盖</strong>：先写移动端（Mobile First），再通过 @media 覆盖 PC 样式。</li>
</ol>
<h4 data-id="heading-2">2. HTML 模板</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;link <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"main.css"</span>&gt;
&lt;link <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"mobile.css"</span> media=<span class="hljs-string">"screen and (max-width: 768px)"</span>&gt;
</code></pre>
<h4 data-id="heading-3">3. 吊打面试官点：如何解决“非平滑跳变”？</h4>
<p>“面试官，媒体查询最大的痛点是跳变。我的解决方案是：<strong>配合 Flex/Grid 弹性布局使用</strong>。通过媒体查询只改变大框架（如一栏变两栏），而内部细节利用 flex-grow 和 clamp() 函数实现平滑过渡，这样即使在断点边缘，视觉也不会生硬。”</p>
<hr/>
<h3 data-id="heading-4">二、 REM + Flexible</h3>
<p><strong>场景：</strong> 移动端 H5 活动页。 <strong>弊端：</strong> 1px 缝隙、高度无法适配、高频触发 Resize 导致的<strong>重排性能开销</strong>。</p>
<h4 data-id="heading-5">1. 落地步骤</h4>
<ol>
<li><strong>引入脚本</strong>：在 HTML 头部注入 lib-flexible，动态设置 html.fontSize = window.innerWidth / 10。</li>
<li><strong>配置插件</strong>：安装 postcss-pxtorem。</li>
<li><strong>参数设置</strong>：rootValue: 75（若设计稿是 750px）。</li>
</ol>
<h4 data-id="heading-6">2. HTML 模板</h4>
<p>codeHtml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/amfe-flexible/2.2.1/index.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">2rem</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">1rem</span>; <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>; <span class="hljs-comment">/* 需要处理 1px */</span> }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">3. 吊打面试官点：如何解决 1px 边框和舍入缝隙？</h4>
<p>“面试官，REM 有两个致命缺陷。 <strong>第一：1px 边框变粗。</strong> 我通常开启插件的 minPixelValue: 2 忽略 1px 转换，并手动用 <strong>伪元素 + transform: scale(0.5)</strong> 来绘制真正的 1px 物理像素。 <strong>第二：色块间白线缝隙。</strong> 这是由于 rem 转换后的小数点舍入误差导致的。我会给相邻色块设置 margin-right: -1px 物理重叠，或者使用 box-shadow: 0 0 1px #color 扩张阴影来填补像素空隙。”</p>
<hr/>
<h3 data-id="heading-8">三、 VW / VH (视口百分比)</h3>
<p><strong>场景：</strong> 现代移动端、全屏背景页。 <strong>弊端：</strong> 无法限制最大宽度（在大屏平板上元素会巨大无比）、计算繁琐。</p>
<h4 data-id="heading-9">1. 落地步骤</h4>
<ol>
<li><strong>确定基准</strong>：设计稿宽度 375px，则 1vw = 3.75px。</li>
<li><strong>配置插件</strong>：使用 postcss-px-to-viewport。</li>
</ol>
<h4 data-id="heading-10">2. 吊打面试官点：如何解决“无限拉伸”？</h4>
<p>“面试官，VW 方案最怕用户在 iPad 上看手机版。我会通过 <strong>CSS 锁（CSS Locks）</strong> 或 clamp() 函数来限制范围。例如：width: clamp(300px, 50vw, 800px)，确保元素在极小或极大屏幕下都有保底尺寸。”</p>
<hr/>
<h3 data-id="heading-11">四、 Transform Scale (大屏首选)</h3>
<p><strong>场景：</strong> 指挥中心、数据大屏。 <strong>弊端：</strong> 边缘黑边、地图/Canvas 坐标偏移。</p>
<h4 data-id="heading-12">1. 落地步骤</h4>
<ol>
<li><strong>固定基准</strong>：按 1920x1080 布局。</li>
<li><strong>脚本计算</strong>：计算 min(window.innerWidth/1920, window.innerHeight/1080)。</li>
</ol>
<h4 data-id="heading-13">2. HTML 模板</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app-container"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 1920px; height: 1080px; transform-origin: 0 0;"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 业务代码 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> warp = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'app-container'</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setScale</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> s = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">1920</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">1080</span>);
    warp.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`scale(<span class="hljs-subst">${s}</span>) translate(-50%, -50%)`</span>;
    warp.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">'50%'</span>; warp.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">'50%'</span>;
  };
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = setScale; <span class="hljs-title function_">setScale</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">3. 吊打面试官点：如何解决“黑边”和“文字模糊”？</h4>
<p>“面试官，Scale 等比缩放必有黑边。 <strong>针对黑边：</strong> 我会使用一张跨度极大的背景图（如 4000px 宽）平铺全屏，而核心数据容器居中缩放，视觉上黑边消失。 <strong>针对文字模糊：</strong> Scale 缩放会导致 Canvas 或高频更新的文本模糊。我会针对这些特定组件进行 <strong>反向缩放（Inversed Scaling）</strong> ，即父级 scale(0.5)，组件内 scale(2)，并开启 will-change: transform 强制 GPU 渲染。”</p>
<hr/>
<h3 data-id="heading-15">五、 Autofit.js (快速交付)</h3>
<p><strong>场景：</strong> 甲方要求今天上线的大屏。 <strong>弊端：</strong> 默认拉伸会导致布局稍微变形（填满屏幕但比例不对）。</p>
<h4 data-id="heading-16">1. 落地步骤</h4>
<ol>
<li><strong>引入</strong>：import autofit from 'autofit.js'。</li>
<li><strong>初始化</strong>：autofit.init({ designHeight: 1080, designWidth: 1920, renderDom: "#app" })。</li>
</ol>
<h4 data-id="heading-17">2. 吊打面试官点：如何解决“组件被强行拉伸变形”？</h4>
<p>“面试官，Autofit 默认是填满全屏，这会导致圆形变椭圆。我会利用它的 ignore 参数，把诸如 <strong>实时监控视频、圆形进度条、GIS 地图</strong> 设为忽略元素，对这些元素单独采用 CSS 媒体查询或百分比布局，保护它们不发生纵横比畸变。”</p>
<p>在 Vue 2 项目中落地 autofit.js 非常简单，但要达到“工业级”的稳健性，你需要注意<strong>初始化时机、销毁逻辑以及局部组件屏蔽</strong>。</p>
<p>以下是 Vue 2 项目集成 autofit.js 的保姆级步骤：</p>
<hr/>
<h4 data-id="heading-18">1、 安装依赖</h4>
<pre><code class="hljs language-css" lang="css">npm install autofit<span class="hljs-selector-class">.js</span> <span class="hljs-attr">--save</span>
</code></pre>
<hr/>
<h4 data-id="heading-19">2、 核心集成逻辑</h4>
<p>推荐在 <strong>App.vue</strong> 中进行初始化，因为 autofit.js 需要操作最外层的 DOM 容器。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- App.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> autofit <span class="hljs-keyword">from</span> <span class="hljs-string">'autofit.js'</span>;
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 初始化自适应</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initAutofit</span>();
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">initAutofit</span>(<span class="hljs-params"/>) {
      autofit.<span class="hljs-title function_">init</span>({
        <span class="hljs-attr">designHeight</span>: <span class="hljs-number">1080</span>, <span class="hljs-comment">// 设计稿高度</span>
        <span class="hljs-attr">designWidth</span>: <span class="hljs-number">1920</span>,  <span class="hljs-comment">// 设计稿宽度</span>
        <span class="hljs-attr">renderDom</span>: <span class="hljs-string">"#app"</span>,  <span class="hljs-comment">// 渲染的容器ID</span>
        <span class="hljs-attr">resize</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// 是否监听窗口变化</span>
        <span class="hljs-comment">// ignore: ['.map-container', '.no-scale'], // 忽略缩放的元素</span>
      });
    }
  },
  <span class="hljs-comment">// 落地细节：如果是单页应用，且只有某一个页面需要大屏适配，</span>
  <span class="hljs-comment">// 建议在 beforeDestroy 中关闭，防止影响其他管理后台页面</span>
  <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 注意：autofit 目前没有专门的 off() 方法，</span>
    <span class="hljs-comment">// 通常通过 window.onresize = null 或刷新页面处理，</span>
    <span class="hljs-comment">// 或者在 init 时动态判断路由。</span>
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 必须清除 body 的默认边距，防止计算偏移 */</span>
<span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span>, <span class="hljs-selector-id">#app</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-comment">/* 大屏通常禁止滚动 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-20">3、 面试级进阶：如何在 Vue 2 中处理特殊情况？</h4>
<p>单纯引入代码只能算“会用”，能处理好以下三个问题才叫“落地”。</p>
<h5 data-id="heading-21">1. ECharts 的自适应配合</h5>
<p>虽然 autofit.js 缩放了容器，但 ECharts 内部的 Canvas 还是需要手动 Resize 才能保持高清。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在业务组件中</span>
<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">chart</span> = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">chartRef</span>);
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleResize</span>);
},
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">handleResize</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 延迟执行，等待 autofit 缩放完成后再重绘图表</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">chart</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">chart</span>.<span class="hljs-title function_">resize</span>();
    }, <span class="hljs-number">100</span>);
  }
}
</code></pre>
<h5 data-id="heading-22">2. 地图点击偏移（Ignore 参数的使用）</h5>
<p>如果你在 Vue 2 中集成了<strong>高德地图</strong>或<strong>百度地图</strong>，scale 会导致点击经纬度发生偏移。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 在 App.vue 的 init 中</span>
autofit.<span class="hljs-title function_ invoke__">init</span>({
  <span class="hljs-attr">renderDom</span>: <span class="hljs-string">"#app"</span>,
  <span class="hljs-attr">designHeight</span>: <span class="hljs-number">1080</span>,
  <span class="hljs-attr">designWidth</span>: <span class="hljs-number">1920</span>,
  <span class="hljs-attr">ignore</span>: [
    <span class="hljs-string">'.amap-container'</span>, // 忽略高德地图容器的整体缩放
    <span class="hljs-string">'.el-notification'</span> // 忽略 UI 库的通知弹窗（防止变形）
  ]
})
</code></pre>
<h5 data-id="heading-23">3. 动态设置适配开关（针对混合项目）</h5>
<p>如果你的 Vue 2 项目中，<strong>只有 /visual 路由是可视化大屏，其他路由是普通的管理后台</strong>。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// App.vue
watch: {
  $route(to) {
    if (<span class="hljs-attr">to.path</span> === <span class="hljs-string">'/visual'</span>) {
      autofit.init({ ... })<span class="hljs-comment">;</span>
    } else {
      // 退出大屏时，重置 transform，避免普通页面缩放
      const <span class="hljs-attr">dom</span> = document.querySelector(<span class="hljs-string">'#app'</span>)<span class="hljs-comment">;</span>
      if (dom) <span class="hljs-attr">dom.style.transform</span> = <span class="hljs-string">'none'</span><span class="hljs-comment">;</span>
      // 暴力方案：如果是混合项目，建议直接 window.location.reload() 或通过 CSS 变量隔离
    }
  }
}
</code></pre>
<hr/>
<h4 data-id="heading-24">4、 为什么在 Vue 2 里它比 REM 方案好？</h4>
<p>当面试官问你：“为什么你的 Vue 2 项目选择用 autofit.js 而不是传统的 lib-flexible？”</p>
<p><strong>你可以这样降维打击：</strong></p>
<ol>
<li><strong>开发效率</strong>： “REM 方案需要配置 postcss-pxtorem，在开发中看代码全是 rem 单位，调试时不直观。autofit.js 让我直接在 Vue 组件里写 px，标注图是多少我就写多少，大大提升了还原度。”</li>
<li><strong>视觉体验（黑边问题）</strong> ： “普通的 scale 方案在大屏长宽比不一致时会出现黑边。autofit.js 通过运行时计算，反向调整了逻辑宽高，填补了视口空白。在 Vue 2 这种生命周期明确的框架里，它能很好地在 mounted 时接管布局。”</li>
<li><strong>局部保护机制</strong>： “它提供的 ignore 机制解决了可视化项目中地图、Canvas 在全局缩放下的<strong>交互偏移</strong>难题。在 Vue 项目中，我可以很方便地通过 CSS 选择器将特定组件排除在缩放逻辑外，这是 REM 方案很难精细化控制的。”</li>
</ol>
<hr/>
<h4 data-id="heading-25">5、 补充：autofit.js 在 Vue 2 中的避坑点</h4>
<ul>
<li>
<p><strong>z-index 混乱</strong>：由于 autofit.js 使用了 transform，根据 CSS 规范，这会创建一个新的“层叠上下文”。如果你有 z-index 极高的弹窗挂载在 body 下，它可能会被 scale 容器遮挡。</p>
<ul>
<li><strong>解决</strong>：将所有弹窗通过 getContainer 或 append-to-body="false" 的方式挂载到 #app 内部。</li>
</ul>
</li>
<li>
<p><strong>计算精度</strong>：如果发现页面边缘有 1px 的缝隙，检查是否给容器加了 border，建议使用 box-shadow 代替外边框，避免占据计算位置。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-26">六、 自定义增强 Scale (企业级)</h3>
<p><strong>场景：</strong> 高端定制化大屏、GIS 深度集成项目。 <strong>优势：</strong> 坐标点对点精准、局部组件保护。</p>
<h4 data-id="heading-27">1. 落地步骤</h4>
<ol>
<li><strong>矩阵转换</strong>：不只是 scale，而是计算 matrix3d 进行补偿。</li>
<li><strong>局部缩放保护</strong>：通过全局状态管理（Vuex/Pinia）注入当前的 scale 值。</li>
</ol>
<h4 data-id="heading-28">2. 吊打面试官点：如何解决“地图交互坐标偏移”？</h4>
<p>“面试官，在大屏上使用 Echarts 或 Leaflet 地图时，缩放会导致鼠标点击位置和实际反馈点对不上。 <strong>我的方案是：</strong> 在点击事件触发时，<strong>手动对坐标执行逆矩阵运算</strong>。将 e.clientX 除以当前的 globalScale 比例。更高级的做法是使用 CSS 的 zoom 属性（虽然有兼容性问题，但在大屏特定的 Chrome 环境下很稳），因为它不会改变元素的物理坐标占据空间。”</p>
<hr/>
<h3 data-id="heading-29">总结：我的选型逻辑</h3>
<ul>
<li><strong>H5 活动页</strong>：VW + 1px 伪元素补偿（最顺应标准）。</li>
<li><strong>企业看板</strong>：Transform Scale + 背景平铺（成本最低，还原度最高）。</li>
<li><strong>高交互地图大屏</strong>：自定义 Scale + 坐标逆运算（解决交互偏差）。</li>
</ul>
<h3 data-id="heading-30">七、 flexible + rem详解</h3>
<p><strong>REM 方案不仅仅是一个 JS 脚本，它是一套包含：动态计算脚本 + 自动转换插件 + 边缘情况处理（1px 问题、最大宽度限制）的完整链路。</strong></p>
<p>以下是三种版本的工程级实现方案：</p>
<hr/>
<h4 data-id="heading-31">1、HTML 原生版本 (最底层的原理)</h4>
<p><strong>面试点：</strong> 为什么要放在  里？ <strong>回答：</strong> 为了在 DOM 渲染之前就计算好根字号，防止页面因字号突变导致的“闪烁（FOUC）”。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>REM落地方案<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">/**
         * 核心逻辑：1rem = 1/10 视口宽度
         * 设计稿 750px -&gt; 1rem = 75px
         */</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">setRem</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> designWidth = <span class="hljs-number">750</span>; <span class="hljs-comment">// 设计稿宽度</span>
            <span class="hljs-keyword">const</span> maxWidth = <span class="hljs-number">750</span>;    <span class="hljs-comment">// 最大宽度限制，防止在大屏（平板）上字号过大</span>
            <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span>;
            
            <span class="hljs-keyword">if</span> (width &gt; maxWidth) width = maxWidth;
            
            <span class="hljs-comment">// 计算根字号：10rem 等于 100% 宽度</span>
            <span class="hljs-keyword">const</span> rem = width / <span class="hljs-number">10</span>;
            <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = rem + <span class="hljs-string">'px'</span>;
        }
        
        <span class="hljs-title function_">setRem</span>();
        <span class="hljs-comment">// 监听窗口变化和旋转</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, setRem);
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'pageshow'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">persisted</span>) <span class="hljs-title function_">setRem</span>(); <span class="hljs-comment">// 解决部分手机后退不刷新的问题</span>
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-comment">/* 落地细节：body 必须重置字号，否则会继承 html 的巨大字号 */</span>
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-class">.box</span> {
            <span class="hljs-comment">/* 若设计稿宽度 750px，盒宽 375px，则写 5rem */</span>
            <span class="hljs-attribute">width</span>: <span class="hljs-number">5rem</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">2rem</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#007bff</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-32">2、 Vue 3 + Vite 工程版本 (生产级)</h4>
<p>在 Vue 项目中，你不需要手动写 JS 计算逻辑，通常使用成熟的 amfe-flexible，并配合 PostCSS 自动转换。</p>
<h5 data-id="heading-33">1. 安装依赖</h5>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> amfe-flexible
npm <span class="hljs-selector-tag">i</span> postcss-pxtorem -D
</code></pre>
<h5 data-id="heading-34">2. 入口引入 (main.ts)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'amfe-flexible'</span> <span class="hljs-comment">// 自动在html注入font-size</span>
​
<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h5 data-id="heading-35">3. 配置 Vite (vite.config.ts)</h5>
<p><strong>面试点：</strong> “我配置了 selectorBlackList 来避免 UI 组件库（如 Vant）的尺寸也被缩小。”</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> postCssPxToRem <span class="hljs-keyword">from</span> <span class="hljs-string">'postcss-pxtorem'</span>
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">postCssPxToRem</span>({
          <span class="hljs-attr">rootValue</span>: <span class="hljs-number">75</span>, <span class="hljs-comment">// 设计稿 750px，1rem = 75px</span>
          <span class="hljs-attr">propList</span>: [<span class="hljs-string">'*'</span>], <span class="hljs-comment">// 所有属性都转换</span>
          <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">'.norem'</span>], <span class="hljs-comment">// 过滤掉不需要转换的类名</span>
          <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/i</span> <span class="hljs-comment">// 排除第三方库，如果要适配 Vant 则不加这行</span>
        })
      ]
    }
  }
})
</code></pre>
<hr/>
<h4 data-id="heading-36">3、 React + Webpack/CRA 版本 (兼容性处理)</h4>
<p>在 React 体系中，如果是使用 Ant Design Mobile，适配方案略有不同。</p>
<h5 data-id="heading-37">1. 安装依赖</h5>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> amfe-flexible
npm <span class="hljs-selector-tag">i</span> postcss-pxtorem -D
</code></pre>
<h5 data-id="heading-38">2. 入口引入 (index.js)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">'amfe-flexible'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;
</code></pre>
<h5 data-id="heading-39">3. 修改配置 (通过 craco 或 eject)</h5>
<p>React 项目通常不暴露 Webpack 配置，推荐使用 @craco/craco。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// craco.config.js</span>
<span class="hljs-keyword">const</span> pxToRem = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-pxtorem'</span>);
​
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">style</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">mode</span>: <span class="hljs-string">'extends'</span>,
      <span class="hljs-attr">loaderOptions</span>: {
        <span class="hljs-attr">postcssOptions</span>: {
          <span class="hljs-attr">ident</span>: <span class="hljs-string">'postcss'</span>,
          <span class="hljs-attr">plugins</span>: [
            <span class="hljs-title function_">pxToRem</span>({
              <span class="hljs-attr">rootValue</span>: <span class="hljs-number">75</span>,
              <span class="hljs-attr">propList</span>: [<span class="hljs-string">'*'</span>],
              <span class="hljs-comment">// 特别注意：针对 antd-mobile，它的设计稿是 375</span>
              <span class="hljs-comment">// 如果你的设计稿是 750，需要在这里做逻辑判断</span>
              <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>antd-mobile/i 
            }),
          ],
        },
      },
    },
  },
};
</code></pre>
<hr/>
<h4 data-id="heading-40">4、 深度进阶：吊打面试官的 4 个落地细节</h4>
<p>如果你能在回答完以上代码后，补充以下几点，面试官会觉得你是有<strong>大型项目落地经验</strong>的：</p>
<h5 data-id="heading-41">1. 解决 1px 边框变粗问题</h5>
<p><strong>问题：</strong> 750 设计稿上的 1px，在手机上会变成 0.5 物理像素，但 CSS 写的 1px 在高清屏下显得很粗。 <strong>解法：</strong> 使用伪元素 + transform: scaleY(0.5)。</p>
<p>codeCSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.hairline-border</span> {
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.hairline-border</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h5 data-id="heading-42">2. 解决 Canvas 渲染模糊</h5>
<p><strong>问题：</strong> 在 REM 布局下，Canvas 画布内部坐标系会失真。 <strong>解法：</strong> 必须手动获取 window.devicePixelRatio（DPR），并在绘制前将 Canvas 的 width 和 height 属性放大 DPR 倍，再用 CSS 缩回来。</p>
<h5 data-id="heading-43">3. 字体不推荐用 REM</h5>
<p><strong>面试点：</strong> “虽然宽度用了 REM，但我通常建议字体大小使用 px 配合媒体查询，或者直接用 px。因为我们不希望在大屏幕上看到巨大的文字，而是希望看到更多的内容。”</p>
<h5 data-id="heading-44">4. 解决“页面瞬间闪烁”</h5>
<p><strong>终极回答：</strong> “在 Vite/Webpack 构建时，我会将计算 rem 的内联脚本直接注入到 index.html 的 HTML 标签之前（利用 html-webpack-plugin 或 vite-plugin-html），而不是等待 JS Bundle 加载。这样可以确保在首屏绘制时，rem 基准值已经就绪。”</p>
<h3 data-id="heading-45">八、 vw vh详解</h3>
<h4 data-id="heading-46">1、 核心原理：舍弃 JS，回归原生</h4>
<p>VW (Viewport Width) 和 VH (Viewport Height) 是 CSS3 提供的原生单位。</p>
<ul>
<li><strong>1vw</strong> = 视口宽度的 1%</li>
<li><strong>1vh</strong> = 视口高度的 1%</li>
<li><strong>本质</strong>：它直接将设计稿的像素（px）映射为视口的百分比，不再需要像 REM 那样通过 JS 动态修改根字号，<strong>减少了主线程的计算开销，彻底杜绝了页面闪烁（FOUC）</strong> 。</li>
</ul>
<hr/>
<h4 data-id="heading-47">2、 移动端 H5 落地方案（工程化）</h4>
<p>在 H5 开发中，手动计算 100 / 750 * 100 = 13.333vw 是极其低效的。我们通过 <strong>PostCSS 自动化流水线</strong> 来解决。</p>
<h5 data-id="heading-48">1. 核心插件配置 (Vue/React 通用)</h5>
<p>目前最主流的是 postcss-px-to-viewport-8-plugin（兼容性最好）。</p>
<p><strong>安装：</strong></p>
<pre><code class="hljs language-css" lang="css">npm install postcss-px-<span class="hljs-selector-tag">to</span>-viewport-<span class="hljs-number">8</span>-plugin -D
</code></pre>
<p><strong>PostCSS 配置 (postcss.config.js)：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-string">'postcss-px-to-viewport-8-plugin'</span>: {
      <span class="hljs-attr">viewportWidth</span>: <span class="hljs-number">750</span>,      <span class="hljs-comment">// 设计稿宽度 (iPhone 2倍图)</span>
      <span class="hljs-attr">unitPrecision</span>: <span class="hljs-number">3</span>,        <span class="hljs-comment">// 转换后的精度，保留3位小数</span>
      <span class="hljs-attr">viewportUnit</span>: <span class="hljs-string">'vw'</span>,      <span class="hljs-comment">// 转换成的单位</span>
      <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">'.ignore-vw'</span>], <span class="hljs-comment">// 不转换的类名</span>
      <span class="hljs-attr">minPixelValue</span>: <span class="hljs-number">1</span>,        <span class="hljs-comment">// 小于或等于 1px 不转换</span>
      <span class="hljs-attr">mediaQuery</span>: <span class="hljs-literal">false</span>,       <span class="hljs-comment">// 允许在媒体查询中转换 px</span>
      <span class="hljs-attr">exclude</span>: [<span class="hljs-regexp">/node_modules/</span>], <span class="hljs-comment">// 排除 UI 库（如果 UI 库是按 375 设计的）</span>
    }
  }
}
</code></pre>
<h5 data-id="heading-49">2. 面试必杀点：解决“平板大屏”失真问题</h5>
<p><strong>痛点</strong>：如果用户用 iPad 打开 750px 的 H5 页面，100vw 会导致 UI 被无限拉大。 <strong>解法</strong>：设置最大宽度限制。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 给 body 设置最大宽度，并水平居中 */</span>
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">540px</span>; <span class="hljs-comment">/* 经验值：超过此宽度不再随屏幕放大 */</span>
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}
<span class="hljs-comment">/* 核心：利用 CSS 变量动态锁定宽度 */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--app-width</span>: <span class="hljs-number">100vw</span>;
}
<span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">540px</span>) {
  <span class="hljs-selector-pseudo">:root</span> {
    <span class="hljs-attr">--app-width</span>: <span class="hljs-number">540px</span>;
  }
}
<span class="hljs-comment">/* 页面容器引用此变量 */</span>
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--app-width);
}
</code></pre>
<hr/>
<h4 data-id="heading-50">3、 大屏自适应方案（比例锁定流）</h4>
<p>在大屏项目中，单纯用 vw 会导致：如果屏幕很宽但很矮，内容会超出底部。 <strong>吊打面试官的方案：利用 vmin 实现等比缩放。</strong></p>
<h5 data-id="heading-51">1. 什么是 vmin？</h5>
<ul>
<li>vmin：取 vw 和 vh 中<strong>较小</strong>的一个。</li>
<li><strong>原理</strong>：在大屏中，无论屏幕如何变形，我们始终保证内容按照设计稿的比例（如 16:9）<strong>缩放在屏幕内部且不溢出</strong>。</li>
</ul>
<h5 data-id="heading-52">2. 大屏 CSS 落地逻辑：</h5>
<p>假设设计稿是 1920x1080 (16:9)。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 定义 SCSS 函数自动转换</span>
$design-<span class="hljs-attribute">width</span>: <span class="hljs-number">1920</span>;
$design-<span class="hljs-attribute">height</span>: <span class="hljs-number">1080</span>;
​
<span class="hljs-variable">@function</span> <span class="hljs-built_in">px2vmin</span>($px) {
  <span class="hljs-comment">// 核心逻辑：基于最小边进行缩放</span>
  <span class="hljs-variable">@return</span> ($px / $design-width) * <span class="hljs-number">100vmin</span>;
}
​
.big-screen-box {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">px2vmin</span>(<span class="hljs-number">400</span>);  <span class="hljs-comment">// 无论窗口怎么变，它始终占据屏幕宽度的固定比例</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">px2vmin</span>(<span class="hljs-number">300</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.8</span>);
}
</code></pre>
<hr/>
<h4 data-id="heading-53">4、 VW 方案的“三大毒瘤”及解法</h4>
<p>面试官必问： <strong>“VW 方案有什么缺陷？”</strong> 你要是能答出这三点，稳了。</p>
<h5 data-id="heading-54">1. 1px 像素问题</h5>
<p><strong>现象</strong>：1px 在转换成 vw 后，由于精度问题可能导致线条消失。 <strong>解法</strong>：</p>
<ul>
<li>在插件配置中设置 minPixelValue: 1，保证 1px 永远是 1px。</li>
<li>使用 transform: scaleY(0.5) 手动处理 Retina 屏的高清边框。</li>
</ul>
<h5 data-id="heading-55">2. 纵横比失效 (Aspect Ratio)</h5>
<p><strong>现象</strong>：图片原本是正方形，容器宽高都写成 vw，在非标比例屏幕上可能变长方形。 <strong>解法</strong>：使用 CSS 新属性 aspect-ratio。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card-img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">20vw</span>;
  aspect-ratio: <span class="hljs-number">1</span> / <span class="hljs-number">1</span>; <span class="hljs-comment">/* 强制锁定宽高比为 1:1，不再需要写 height */</span>
  <span class="hljs-attribute">object-fit</span>: cover;
}
</code></pre>
<h5 data-id="heading-56">3. 兼容性降级 (非常极端的情况)</h5>
<p><strong>现象</strong>：虽然几率极低，但如果要求兼容老旧 WebView。 <strong>解法</strong>：使用 viewport-units-buggyfill 插件，它会自动把 vw 转换成基于 JS 计算的像素值。</p>
<h3 data-id="heading-57">九、 详解 Transform Scale</h3>
<h4 data-id="heading-58">1、 Transform Scale 标准方案：基础落地</h4>
<h5 data-id="heading-59">1. 实现过程</h5>
<ul>
<li><strong>第一步（设计稿）：</strong> 统一按 1920x1080px（或 3840x2160）出图。</li>
<li><strong>第二步（开发）：</strong> 页面所有元素直接按 px 写死，不写相对单位。</li>
<li><strong>第三步（缩放）：</strong> 编写 JS 动态计算窗口与设计稿的比例，应用到主容器。</li>
</ul>
<h5 data-id="heading-60">2. HTML 模板</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #000; overflow: hidden;"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 大屏主容器，固定宽高 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"big-screen"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 1920px; height: 1080px; transform-origin: 0 0; background: url('bg.png');"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart"</span>&gt;</span>这里是图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScale</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> designWidth = <span class="hljs-number">1920</span>;
    <span class="hljs-keyword">const</span> designHeight = <span class="hljs-number">1080</span>;
    <span class="hljs-comment">// 计算缩放比例，取宽高中较小的一个，确保内容能完整显示</span>
    <span class="hljs-keyword">const</span> scale = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / designWidth, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / designHeight);
    <span class="hljs-keyword">const</span> screenDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#big-screen'</span>);
    
    <span class="hljs-comment">// 应用缩放，并居中显示</span>
    screenDom.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`scale(<span class="hljs-subst">${scale}</span>)`</span>;
    <span class="hljs-comment">// 计算居中偏移量（如果不需要黑边居中，可以去掉这部分）</span>
    <span class="hljs-keyword">const</span> left = (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> - designWidth * scale) / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> top = (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - designHeight * scale) / <span class="hljs-number">2</span>;
    screenDom.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">`<span class="hljs-subst">${left}</span>px`</span>;
    screenDom.<span class="hljs-property">style</span>.<span class="hljs-property">marginTop</span> = <span class="hljs-string">`<span class="hljs-subst">${top}</span>px`</span>;
  }
  
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = handleScale;
  <span class="hljs-title function_">handleScale</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-61">2、 标准方案的 3 个致命坑及解决方案</h4>
<ol>
<li>
<p><strong>坑一：边缘黑边。</strong></p>
<ul>
<li><strong>现象：</strong> 当屏幕宽高比与 16:9 不同时，上下或左右会出现难看的黑条。</li>
<li><strong>方案：</strong> 见下方的“升级方案一”。</li>
</ul>
</li>
<li>
<p><strong>坑二：文字和 Echarts 图表模糊。</strong></p>
<ul>
<li><strong>现象：</strong> scale 属于位图缩放，当缩放倍数较小时，文字和图表边缘有毛刺。</li>
<li><strong>方案：</strong> Echarts 渲染器切换为 svg 模式（echarts.init(dom, null, {renderer: 'svg'})）；对于文字，使用 initial-scale 优化或设置 text-rendering: optimizeLegibility;。</li>
</ul>
</li>
<li>
<p><strong>坑三：地图点击坐标偏移。</strong></p>
<ul>
<li><strong>现象：</strong> 在缩放后的容器内使用 Leaflet 或原生鼠标事件，点击位置对不上。</li>
<li><strong>方案：</strong> 见下方的“升级方案二”。</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-62">3、 升级方案一：铺满全屏 + 逻辑留白（视觉完美版）</h4>
<p><strong>场景：</strong> 甲方不能接受黑边，但要求图表不拉伸。</p>
<ul>
<li>
<p><strong>思路：</strong> 背景图（Theme Background）<strong>拉伸铺满</strong>全屏，而真正的内容容器（Content）保持<strong>等比缩放</strong>。</p>
</li>
<li>
<p><strong>实现步骤：</strong></p>
<ol>
<li>body 设置一张 4K 的星空/科技感背景图，设置为 background-size: 100% 100%。</li>
<li>内部内容容器（设计稿尺寸）依然用 scale 缩放并居中。</li>
<li><strong>吊打面试官点：</strong> “我通过<strong>双层容器法</strong>解决了黑边痛点。外层容器负责用 CSS 绘制充满科技感的底图和流动边框，这些不怕拉伸；内层容器承载精密数据，保持 Scale 等比，这样在任何屏幕上都像是一个完整的沉浸式系统。”</li>
</ol>
</li>
</ul>
<hr/>
<h4 data-id="heading-63">4、 升级方案二：局部补偿算法（企业级高要求版）</h4>
<p><strong>场景：</strong> 页面里有地图（GIS）、实时监控视频、或者需要在缩放后依然保持 1:1 像素精度的 UI 元素。</p>
<ul>
<li>
<p><strong>思路：</strong> 在全局缩放的基础上，对特定组件执行“逆缩放”。</p>
</li>
<li>
<p><strong>实现步骤：</strong></p>
<ol>
<li>获取全局缩放值 S。</li>
<li>对地图容器应用 transform: scale(1/S)。</li>
<li>手动调整该组件的宽高，使其在视觉上看起来恢复了原始大小，但内部渲染是点对点的。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-64"><strong>【HTML 模板】</strong></h4>
<pre><code class="hljs language-ini" lang="ini">// 核心逻辑：反向补偿
const <span class="hljs-attr">globalScale</span> = getScale()<span class="hljs-comment">; // 假设当前缩放了 0.5</span>
​
// 针对地图组件
const <span class="hljs-attr">mapDom</span> = document.querySelector(<span class="hljs-string">'#gis-map'</span>)<span class="hljs-comment">;</span>
// 1. 放大两倍抵消全局的 0.5，这样地图内部渲染就是 100% 清晰的
<span class="hljs-attr">mapDom.style.transform</span> = `scale(<span class="hljs-variable">${1 / globalScale}</span>)`<span class="hljs-comment">;</span>
// 2. 必须同步修改宽高，否则地图显示区域会缩水
<span class="hljs-attr">mapDom.style.width</span> = `<span class="hljs-variable">${originalWidth * globalScale}</span>px`<span class="hljs-comment">;</span>
<span class="hljs-attr">mapDom.style.height</span> = `<span class="hljs-variable">${originalHeight * globalScale}</span>px`<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>
<p><strong>吊打面试官点：</strong></p>
<ul>
<li>“面试官，单纯的 Scale 会导致交互坐标偏移。在做 <strong>高精度 GIS 交互</strong> 时，我会重写坐标计算逻辑：const realX = e.clientX / currentScale。</li>
<li>更高级的解决办法是：在大屏常用的 Chrome 环境下，我会优先使用 zoom 属性替代 transform: scale。因为 zoom 是真实的空间缩放，浏览器会自动处理鼠标事件的坐标转换，不会产生偏移，且不会触发 BFC 异常。”</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-65">5、 两种升级方案对比选型</h4>























<table><thead><tr><th>方案</th><th>核心技术</th><th>解决的问题</th><th>适合场景</th></tr></thead><tbody><tr><td><strong>升级方案一 (Padding-Fill)</strong></td><td>双层布局 + 居中 Scale</td><td>彻底消除黑边，视觉一致性强</td><td>多数常规数据可视化看板</td></tr><tr><td><strong>升级方案二 (Inversed Scale)</strong></td><td>反向缩放 + 坐标校正</td><td>解决地图模糊、点击偏移、视频拉伸</td><td>智慧城市、GIS 地图、公安指挥中心</td></tr></tbody></table>
<p><strong>总结实现流程：</strong></p>
<ol>
<li>
<p><strong>拿到设计稿：</strong> 确认是 1920 还是 16:10（如 1920x1200）。</p>
</li>
<li>
<p><strong>基础开发：</strong> 使用 px 配合百分比或 Flex 完成基础布局。</p>
</li>
<li>
<p><strong>注入 Scale：</strong> 使用脚本控制 #app 缩放。</p>
</li>
<li>
<p><strong>避坑检查：</strong></p>
<ul>
<li>检查图表文字是否模糊 -&gt; 切换 SVG 渲染。</li>
<li>检查地图点击准不准 -&gt; 执行 1/S 坐标补偿。</li>
<li>检查两侧是否有黑边 -&gt; 外层铺满背景图遮瑕。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展]]></title>    <link>https://juejin.cn/post/7599852636529016867</link>    <guid>https://juejin.cn/post/7599852636529016867</guid>    <pubDate>2026-01-27T07:37:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852636529016867" data-draft-id="7599845683121963048" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2026-01-27T07:37:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:37:39.000Z" title="Tue Jan 27 2026 07:37:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展</h2>
<p>在MyBatis-Plus（MP）的技术体系中，Mapper层是持久层的核心载体，承接业务层请求与数据库操作，既是MP自动化能力的入口，也是自定义SQL的落地载体。相较于原生MyBatis的Mapper，MP的Mapper通过BaseMapper接口封装了全量单表CRUD方法，同时支持灵活扩展自定义逻辑，大幅降低了持久层代码量。本文将从基础用法、自定义扩展、进阶技巧、避坑指南四个维度，拆解MP Mapper的完整使用流程，助力开发者精准掌握这一核心组件。</p>
<h3 data-id="heading-1">一、MP Mapper 核心基础：BaseMapper 接口详解</h3>
<p>MP的核心优势之一，就是通过<code>BaseMapper&lt;T&gt;</code>接口提供了开箱即用的单表CRUD方法，开发者只需让自定义Mapper接口继承该接口，无需编写任何方法体，即可获得完整的单表操作能力。这一设计彻底解决了原生MyBatis中单表操作SQL冗余、方法重复定义的问题。</p>
<h4 data-id="heading-2">1. BaseMapper 核心方法分类与使用示例</h4>
<p>BaseMapper接口包含30+个单表操作方法，覆盖新增、删除、修改、查询四大场景，以下按高频场景分类说明，结合Order实体类演示用法（实体类定义参考前文，此处略）。</p>
<h5 data-id="heading-3">（1）新增操作</h5>
<p>核心方法：<code>int insert(T entity)</code>，自动将实体类属性映射为数据库字段，生成INSERT语句，支持主键自动填充（如雪花算法、自增）。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// OrderMapper接口（仅需继承BaseMapper）</span>
public interface OrderMapper extends BaseMapper&lt;<span class="hljs-attribute">Order</span>&gt; {}

<span class="hljs-comment">// 业务层调用</span>
<span class="hljs-keyword">@Service</span>
public class OrderServiceImpl {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMapper orderMapper;

    public void <span class="hljs-built_in">addOrder</span>() {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>("ORDER20260128001");
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setUserId</span>(<span class="hljs-number">1002</span>L);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(new BigDecimal("<span class="hljs-number">299.00</span>"));
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">0</span>);
        <span class="hljs-comment">// 调用BaseMapper的insert方法，返回受影响行数</span>
        int rows = orderMapper<span class="hljs-selector-class">.insert</span>(order);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("新增成功，影响行数：" + rows);
    }
}
</code></pre>
<p>注意：主键生成策略由全局配置或实体类@TableId注解指定（如ASSIGN_ID雪花算法、AUTO自增），插入后实体类会自动回显主键值。</p>
<h5 data-id="heading-4">（2）删除操作</h5>
<p>提供按主键删除、按条件删除两类方法，支持单条、批量删除，结合逻辑删除配置可实现假删除。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 按主键删除（单条）</span>
orderMapper<span class="hljs-selector-class">.deleteById</span>(<span class="hljs-number">1</span>L);

<span class="hljs-comment">// 2. 批量按主键删除</span>
List&lt;Long&gt; ids = Arrays<span class="hljs-selector-class">.asList</span>(<span class="hljs-number">1</span>L, <span class="hljs-number">2</span>L, <span class="hljs-number">3</span>L);
orderMapper<span class="hljs-selector-class">.deleteBatchIds</span>(ids);

<span class="hljs-comment">// 3. 按条件删除（QueryWrapper/LambdaQueryWrapper）</span>
LambdaQueryWrapper&lt;<span class="hljs-attribute">Order</span>&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();
wrapper<span class="hljs-selector-class">.eq</span>(Order::getUserId, <span class="hljs-number">1002</span>L)
       <span class="hljs-selector-class">.lt</span>(Order::getCreateTime, LocalDateTime.of(<span class="hljs-number">2026</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
orderMapper<span class="hljs-selector-class">.delete</span>(wrapper); <span class="hljs-comment">// 删除指定用户2026年前的订单</span>
</code></pre>
<h5 data-id="heading-5">（3）修改操作</h5>
<p>支持按主键更新、按条件更新，可选择更新全部字段或非空字段，适配不同业务场景。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 按主键更新（更新非空字段，推荐）</span>
<span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
<span class="hljs-attribute">order</span><span class="hljs-selector-class">.setId</span>(<span class="hljs-number">1</span>L);
<span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 仅更新状态字段</span>
orderMapper<span class="hljs-selector-class">.updateById</span>(order);

<span class="hljs-comment">// 2. 按条件更新（更新指定字段）</span>
UpdateWrapper&lt;<span class="hljs-attribute">Order</span>&gt; updateWrapper = new UpdateWrapper&lt;&gt;();
updateWrapper<span class="hljs-selector-class">.eq</span>("user_id", <span class="hljs-number">1002</span>L)
             <span class="hljs-selector-class">.set</span>("status", <span class="hljs-number">2</span>) <span class="hljs-comment">// 强制更新状态为2</span>
             <span class="hljs-selector-class">.set</span>("update_time", LocalDateTime.now());
orderMapper<span class="hljs-selector-class">.update</span>(null, updateWrapper);

<span class="hljs-comment">// 3. Lambda方式按条件更新（类型安全）</span>
LambdaUpdateWrapper&lt;<span class="hljs-attribute">Order</span>&gt; lambdaWrapper = new LambdaUpdateWrapper&lt;&gt;();
lambdaWrapper<span class="hljs-selector-class">.eq</span>(Order::getUserId, <span class="hljs-number">1002</span>L)
             <span class="hljs-selector-class">.set</span>(Order::getStatus, <span class="hljs-number">2</span>);
orderMapper<span class="hljs-selector-class">.update</span>(null, lambdaWrapper);
</code></pre>
<h5 data-id="heading-6">（4）查询操作</h5>
<p>覆盖单条查询、列表查询、分页查询、条件查询等场景，支持Lambda表达式构造条件，避免字段名硬编码。</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 按主键查询单条
Order <span class="hljs-attr">order</span> = orderMapper.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>

// 2. 批量按主键查询
List&lt;Long&gt; <span class="hljs-attr">ids</span> = Arrays.asList(<span class="hljs-number">1</span>L, <span class="hljs-number">2</span>L)<span class="hljs-comment">;</span>
List&lt;Order&gt; <span class="hljs-attr">orderList</span> = orderMapper.selectBatchIds(ids)<span class="hljs-comment">;</span>

// 3. 按条件查询列表（Lambda方式）
LambdaQueryWrapper&lt;Order&gt; <span class="hljs-attr">wrapper</span> = new LambdaQueryWrapper&lt;&gt;()<span class="hljs-comment">;</span>
wrapper.eq(Order::getUserId, 1002L)
       .eq(Order::getStatus, 1)
       .orderByDesc(Order::getCreateTime)<span class="hljs-comment">;</span>
List&lt;Order&gt; <span class="hljs-attr">paidOrders</span> = orderMapper.selectList(wrapper)<span class="hljs-comment">;</span>

// 4. 分页查询（需配合MP分页插件）
Page&lt;Order&gt; <span class="hljs-attr">page</span> = new Page&lt;&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 第1页，每页10条</span>
IPage&lt;Order&gt; <span class="hljs-attr">orderPage</span> = orderMapper.selectPage(page, wrapper)<span class="hljs-comment">;</span>
List&lt;Order&gt; <span class="hljs-attr">records</span> = orderPage.getRecords()<span class="hljs-comment">; // 分页数据</span>
long <span class="hljs-attr">total</span> = orderPage.getTotal()<span class="hljs-comment">; // 总条数</span>

// 5. 查询单条记录（无数据返回null，多条数据抛异常）
Order <span class="hljs-attr">singleOrder</span> = orderMapper.selectOne(wrapper)<span class="hljs-comment">;</span>

// 6. 查询条数
long <span class="hljs-attr">count</span> = orderMapper.selectCount(wrapper)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-7">2. Mapper 扫描配置：让Spring识别Mapper接口</h4>
<p>MP Mapper接口需被Spring扫描才能注入使用，有两种常用配置方式，按需选择即可。</p>
<h5 data-id="heading-8">（1）启动类添加@MapperScan注解（推荐）</h5>
<p>在Spring Boot启动类上指定Mapper接口所在包，批量扫描所有Mapper，无需在每个Mapper上添加@Mapper注解。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@SpringBootApplication</span>
<span class="hljs-comment">// 扫描com.example.mp.mapper包下所有Mapper接口</span>
<span class="hljs-variable">@MapperScan</span>(<span class="hljs-string">"com.example.mp.mapper"</span>)
public class MyBatisPlusDemoApplication {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(MyBatisPlusDemoApplication.class, args);
    }
}
</code></pre>
<h5 data-id="heading-9">（2）单个Mapper接口添加@Mapper注解</h5>
<p>适用于Mapper接口分散在不同包的场景，需在每个自定义Mapper接口上添加@Mapper注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 单个Mapper添加@Mapper注解</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Order&gt; {}
</code></pre>
<p>避坑提醒：避免同时使用两种方式，且确保@MapperScan注解的包路径准确，否则会导致Mapper无法注入，抛出NoSuchBeanDefinitionException异常。</p>
<h3 data-id="heading-10">二、自定义 Mapper：突破单表限制，扩展业务逻辑</h3>
<p>BaseMapper仅覆盖单表操作，实际业务中难免需要多表关联、复杂条件查询等场景，此时需通过自定义方法扩展Mapper。MP支持两种自定义方式：XML文件编写SQL、注解编写SQL，可根据场景灵活选择。</p>
<h4 data-id="heading-11">1. XML方式自定义Mapper（推荐复杂SQL场景）</h4>
<p>XML方式适合SQL逻辑复杂、需动态拼接的场景，保持Java代码与SQL分离，便于维护。步骤如下：</p>
<h5 data-id="heading-12">（1）配置XML文件路径</h5>
<p>在application.yml中指定Mapper XML文件的存放路径，MP会自动扫描该路径下的XML文件。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/**/*.xml</span> <span class="hljs-comment"># 扫描resources/mapper下所有XML文件</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.mp.entity</span> <span class="hljs-comment"># 实体类别名包，XML中可省略全类名</span>
</code></pre>
<h5 data-id="heading-13">（2）Mapper接口定义自定义方法</h5>
<p>在OrderMapper接口中添加自定义方法，方法名需与XML中SQL的id一致。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// 自定义：关联用户表查询订单详情（多表关联）</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">OrderVO</span>&gt; <span class="hljs-selector-tag">selectOrderVOList</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"userId"</span>) Long userId, 
                                     <span class="hljs-variable">@Param</span>(<span class="hljs-string">"status"</span>) Integer status);
    
    <span class="hljs-comment">// 自定义：动态条件查询订单（结合XML动态SQL）</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; <span class="hljs-selector-tag">selectOrderByDynamicCondition</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"wrapper"</span>) QueryWrapper&lt;Order&gt; wrapper);
}
</code></pre>
<p>说明：@Param注解用于指定参数名，便于XML中引用；若参数为条件构造器（QueryWrapper/LambdaQueryWrapper），可直接传入XML使用。</p>
<h5 data-id="heading-14">（3）编写XML文件实现SQL</h5>
<p>在resources/mapper目录下创建OrderMapper.xml，编写自定义SQL，命名空间需与Mapper接口全类名一致。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mp.mapper.OrderMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 关联查询：返回OrderVO对象 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectOrderVOList"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.example.mp.vo.OrderVO"</span>&gt;</span>
        SELECT 
            o.id, o.order_no, o.amount, o.status, 
            u.id AS user_id, u.username, u.phone
        FROM t_order o
        LEFT JOIN t_user u ON o.user_id = u.id
        WHERE 1=1
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"userId != null"</span>&gt;</span>
            AND o.user_id = #{userId}
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"status != null"</span>&gt;</span>
            AND o.status = #{status}
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        AND o.deleted = 0
        ORDER BY o.create_time DESC
    &lt;/select<span class="hljs-symbol">&amp;gt;</span>

    <span class="hljs-comment">&lt;!-- 动态条件查询：复用MP条件构造器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectOrderByDynamicCondition"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Order"</span>&gt;</span>
        SELECT * FROM t_order
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            ${wrapper.sqlSegment} <span class="hljs-comment">&lt;!-- 直接引用QueryWrapper的SQL片段 --&gt;</span>
            AND deleted = 0
        <span class="hljs-symbol">&amp;lt;</span>/where<span class="hljs-symbol">&amp;gt;</span>
    <span class="hljs-symbol">&amp;lt;</span>/select<span class="hljs-symbol">&amp;gt;</span>
<span class="hljs-symbol">&amp;lt;</span>/mapper<span class="hljs-symbol">&amp;gt;</span>
</code></pre>
<h4 data-id="heading-15">2. 注解方式自定义Mapper（适合简单SQL场景）</h4>
<p>对于逻辑简单的SQL，可直接通过MP提供的注解（@Select、@Insert、@Update、@Delete）在Mapper接口方法上编写，无需XML文件，简洁高效。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// 注解方式：查询指定用户的已支付订单</span>
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT * FROM t_order WHERE user_id = #{userId} AND status = 1 AND deleted = 0"</span>)
    List&lt;Order&gt; <span class="hljs-built_in">selectPaidOrdersByUserId</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"userId"</span>) Long userId);

    <span class="hljs-comment">// 注解方式：动态SQL（结合MP的@SqlParser注解，可选）</span>
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"&lt;script&gt;"</span> +
            <span class="hljs-string">"SELECT * FROM t_order WHERE deleted = 0"</span> +
            <span class="hljs-string">"&lt;if test='status != null'&gt; AND status = #{status} &lt;/if&gt;"</span> +
            <span class="hljs-string">"&lt;if test='startTime != null'&gt; AND create_time &gt;= #{startTime} &lt;/if&gt;"</span> +
            <span class="hljs-string">"&lt;/script&gt;"</span>)
    List&lt;Order&gt; <span class="hljs-built_in">selectOrdersByCondition</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"status"</span>) Integer status,
                                        <span class="hljs-variable">@Param</span>(<span class="hljs-string">"startTime"</span>) LocalDateTime startTime);
}
</code></pre>
<p>说明：注解中编写动态SQL需用
</p><h3 data-id="heading-16">三、Mapper 进阶技巧：提升开发效率与性能</h3>
<h4 data-id="heading-17">1. 批量操作优化：减少数据库交互次数</h4>
<p>BaseMapper提供的<code>insertBatchIds</code>、<code>deleteBatchIds</code>方法虽支持批量操作，但底层仍可能分多次执行SQL。对于大量数据批量插入/更新，可通过以下方式优化：</p>
<h5 data-id="heading-18">（1）使用MP自带批量操作方法（基础版）</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 批量插入：推荐每批次500-1000条，避免单次插入过多数据</span>
List&lt;<span class="hljs-attribute">Order</span>&amp;gt; orderList = new ArrayList&lt;&gt;();
<span class="hljs-comment">// 填充orderList数据...</span>
orderMapper<span class="hljs-selector-class">.insertBatchIds</span>(orderList);
</code></pre>
<h5 data-id="heading-19">（2）配置JDBC批量提交（进阶版）</h5>
<p>结合Druid连接池配置批量提交参数，让MP批量操作底层复用连接，减少网络开销。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">druid:</span>
      <span class="hljs-comment"># 开启JDBC批量提交</span>
      <span class="hljs-attr">batch-open-result-set:</span> <span class="hljs-literal">true</span>
      <span class="hljs-comment"># 批量操作提交阈值</span>
      <span class="hljs-attr">connection-properties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000;druid.batch.openResultSet=true</span>
</code></pre>
<h4 data-id="heading-20">2. 结果映射：解决字段不匹配与复杂返回值</h4>
<p>当实体类字段与数据库字段不一致，或查询返回多表关联结果时，可通过结果映射解决，支持XML配置ResultMap和注解方式两种。</p>
<h5 data-id="heading-21">（1）XML配置ResultMap</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mp.mapper.OrderMapper"</span>&amp;<span class="hljs-attr">gt</span>;
    &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">配置字段映射</span>：<span class="hljs-attr">解决实体类与数据库字段不一致问题</span> <span class="hljs-attr">--</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"OrderResultMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"Order"</span>&gt;</span>
        <span class="hljs-symbol">&amp;lt;</span>id column="order_id" property="id"/<span class="hljs-symbol">&amp;gt;</span> <span class="hljs-comment">&lt;!-- 数据库字段order_id映射实体类id --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"order_number"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orderNo"</span>/&amp;<span class="hljs-attr">gt</span>; &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">数据库order_number映射orderNo</span> <span class="hljs-attr">--</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"total_amount"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"amount"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByIdWithResultMap"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"OrderResultMap"</span>&gt;</span>
        SELECT order_id, order_number, total_amount FROM t_order WHERE order_id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h5 data-id="heading-22">（2）注解方式映射（@Results、@Result）</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT order_id, order_number, total_amount FROM t_order WHERE order_id = #{id}"</span>)
    <span class="hljs-variable">@Results</span>({
        <span class="hljs-variable">@Result</span>(column = <span class="hljs-string">"order_id"</span>, property = <span class="hljs-string">"id"</span>, id = true), <span class="hljs-comment">// id=true表示主键</span>
        <span class="hljs-variable">@Result</span>(column = <span class="hljs-string">"order_number"</span>, property = <span class="hljs-string">"orderNo"</span>),
        <span class="hljs-variable">@Result</span>(column = <span class="hljs-string">"total_amount"</span>, property = <span class="hljs-string">"amount"</span>)
    })
    Order <span class="hljs-built_in">selectByIdWithAnnotation</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"id"</span>) Long id);
}
</code></pre>
<h4 data-id="heading-23">3. Mapper 继承与扩展：复用通用逻辑</h4>
<p>当多个Mapper存在重复自定义方法时，可创建通用Mapper接口，通过继承复用逻辑，减少代码冗余。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 通用Mapper接口（封装公共方法）</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">CommonMapper</span>&lt;<span class="hljs-selector-tag">T</span>&gt; <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">T</span>&gt; {
    <span class="hljs-comment">// 公共方法：按创建时间范围查询</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">T</span>&gt; <span class="hljs-selector-tag">selectByCreateTimeRange</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"startTime"</span>) LocalDateTime startTime,
                                    <span class="hljs-variable">@Param</span>(<span class="hljs-string">"endTime"</span>) LocalDateTime endTime);
}

<span class="hljs-comment">// 自定义XML实现通用方法（CommonMapper.xml）</span>
&lt;<span class="hljs-selector-tag">mapper</span> <span class="hljs-selector-tag">namespace</span>="<span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.mp</span><span class="hljs-selector-class">.mapper</span><span class="hljs-selector-class">.CommonMapper</span>"&gt;
    &lt;<span class="hljs-selector-tag">select</span> <span class="hljs-selector-tag">id</span>="<span class="hljs-selector-tag">selectByCreateTimeRange</span>" <span class="hljs-selector-tag">resultType</span>="<span class="hljs-selector-tag">T</span>"&gt;
        <span class="hljs-selector-tag">SELECT</span> * <span class="hljs-selector-tag">FROM</span> ${<span class="hljs-selector-tag">tableName</span>}
        <span class="hljs-selector-tag">WHERE</span> <span class="hljs-selector-tag">create_time</span> <span class="hljs-selector-tag">BETWEEN</span> #{<span class="hljs-selector-tag">startTime</span>} <span class="hljs-selector-tag">AND</span> #{<span class="hljs-selector-tag">endTime</span>}
        <span class="hljs-selector-tag">AND</span> <span class="hljs-selector-tag">deleted</span> = <span class="hljs-number">0</span>
    &lt;/<span class="hljs-selector-tag">select</span>&gt;
&lt;/<span class="hljs-selector-tag">mapper</span>&gt;

<span class="hljs-comment">// OrderMapper继承通用Mapper，获得公共方法</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">CommonMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// 自定义Order专属方法...</span>
}
</code></pre>
<h4 data-id="heading-24">4. 多数据源下的Mapper使用</h4>
<p>集成MP多数据源组件（dynamic-datasource-spring-boot-starter）后，可通过@DS注解指定Mapper接口或方法的数据源，实现读写分离、多库操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 方式1：在Mapper接口上指定数据源（所有方法默认使用slave从库）</span>
<span class="hljs-meta">@DS("slave")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Order&gt; {
    <span class="hljs-comment">// 读操作方法（从库）</span>
    List&lt;Order&gt; <span class="hljs-title function_">selectOrderListByUserId</span><span class="hljs-params">(Long userId)</span>;

    <span class="hljs-comment">// 方式2：方法上指定数据源（覆盖接口注解，使用master主库）</span>
    <span class="hljs-meta">@DS("master")</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">(Order order)</span>;
}
</code></pre>
<h3 data-id="heading-25">四、Mapper 高频避坑指南</h3>
<h4 data-id="heading-26">1. 坑点1：Mapper注入失败，抛出NoSuchBeanDefinitionException</h4>
<p><strong>现象</strong>：启动项目时提示无法找到Mapper接口的Bean，无法注入使用。 <strong>规避方案</strong>：</p>
<ul>
<li>检查@MapperScan注解的包路径是否准确，确保覆盖所有Mapper接口；</li>
<li>若使用单个@Mapper注解，确认每个Mapper都添加了该注解，且接口是public修饰；</li>
<li>避免Mapper接口与XML文件命名空间不一致，XML的namespace必须是Mapper接口全类名。</li>
</ul>
<h4 data-id="heading-27">2. 坑点2：自定义SQL中字段名错误，报Column not found异常</h4>
<p><strong>现象</strong>：执行自定义SQL时，提示数据库字段不存在，实际字段名正确。 <strong>规避方案</strong>：</p>
<ul>
<li>确认实体类字段与数据库字段映射正确，开启驼峰命名自动映射（map-underscore-to-camel-case: true）；</li>
<li>自定义SQL中字段名若与数据库关键字冲突（如order、user），需用反引号包裹（<code>order</code>）；</li>
<li>多表关联查询时，避免字段名重复，需指定表别名（如o.id、u.id）。</li>
</ul>
<h4 data-id="heading-28">3. 坑点3：批量插入性能差，耗时过长</h4>
<p><strong>现象</strong>：批量插入上千条数据时，耗时远超预期，数据库压力大。 <strong>规避方案</strong>：</p>
<ul>
<li>分批次批量插入，每批次控制在500-1000条，避免单次插入过多数据；</li>
<li>配置JDBC批量提交参数，结合Druid连接池优化；</li>
<li>复杂场景下，使用MyBatis原生批量插入XML（foreach标签），性能优于MP自带insertBatchIds。</li>
</ul>
<h4 data-id="heading-29">4. 坑点4：条件构造器传入XML后，SQL拼接异常</h4>
<p><strong>现象</strong>：将QueryWrapper传入自定义XML后，执行SQL时报语法错误，条件未正确拼接。 <strong>规避方案</strong>：</p>
<ul>
<li>XML中引用条件构造器时，使用<code>${wrapper.sqlSegment}</code>（无#{}），且需配合标签消除多余AND/OR；</li>
<li>避免条件构造器与自定义SQL条件重复（如同时拼接deleted=0），建议统一在XML或构造器中处理；</li>
<li>若条件构造器中使用了Lambda表达式，确保实体类字段与数据库字段映射正确。</li>
</ul>
<h4 data-id="heading-30">5. 坑点5：逻辑删除后，自定义SQL仍查询到已删除数据</h4>
<p><strong>现象</strong>：配置逻辑删除后，BaseMapper方法可正常过滤已删除数据，但自定义SQL仍返回删除数据。 <strong>规避方案</strong>：</p>
<ul>
<li>BaseMapper方法自动拼接逻辑删除条件，但自定义SQL需手动添加（AND deleted = 0）；</li>
<li>可通过MP的全局SQL注入器，自动为自定义SQL添加逻辑删除条件，减少手动编写。</li>
</ul>
<h3 data-id="heading-31">五、总结：Mapper 层使用核心原则</h3>
<p>MP Mapper层的使用核心是“<strong>复用优先、灵活扩展</strong>”，在实际开发中需遵循以下原则，平衡开发效率与性能：</p>
<ul>
<li>单表操作优先使用BaseMapper自带方法，避免重复编写SQL，充分发挥MP的自动化能力；</li>
<li>复杂SQL、多表关联优先选择XML方式实现，便于调试和维护；简单SQL可使用注解方式，简化开发；</li>
<li>批量操作、多数据源、结果映射等场景，需结合业务需求选择优化方案，避免性能瓶颈；</li>
<li>严格规范Mapper接口与XML的命名、路径，减少注入失败、SQL错误等问题，提升项目可维护性。</li>
</ul>
<p>Mapper层作为MP与数据库交互的核心桥梁，既要熟练掌握BaseMapper的基础用法，也要灵活运用自定义扩展能力，才能在不同业务场景中高效落地。掌握本文所述的用法、技巧与避坑要点，可大幅减少持久层开发工作量，提升代码质量与性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微前端MicroApp5分钟让你轻松掌握]]></title>    <link>https://juejin.cn/post/7599591405314064425</link>    <guid>https://juejin.cn/post/7599591405314064425</guid>    <pubDate>2026-01-27T07:44:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599591405314064425" data-draft-id="7599572091076214826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微前端MicroApp5分钟让你轻松掌握"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-27T07:44:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林太白"/> <meta itemprop="url" content="https://juejin.cn/user/1874034273300919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微前端MicroApp5分钟让你轻松掌握
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1874034273300919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林太白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:44:33.000Z" title="Tue Jan 27 2026 07:44:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">微前端MicroApp5分钟让你轻松掌握</h2>
<p>之前我将我们本地的项目全部使用vite进行了重构，包括React、vue3项目</p>
<p>接下来我们就将自己的这两个项目使用<code>micro-app</code>进行改造成微前端项目，先来简单看看MicroApp是什么</p>
<h3 data-id="heading-1">MicroApp认识</h3>
<h4 data-id="heading-2">官方网站</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">https</span>:<span class="hljs-comment">//jd-opensource.github.io/micro-app/docs.html#/</span>


演示地址
<span class="hljs-attr">https</span>:<span class="hljs-comment">//www.micro-zoe.com/main-vue2/app-vue2</span>
</code></pre>
<h4 data-id="heading-3">认识</h4>
<p>MicroApp是一款基于类WebComponent进行渲染的微前端框架，不同于目前流行的开源框架，它从组件化的思维实现微前端，旨在降低上手难度、提升工作效率。</p>
<p>是目前市面上接入微前端成本最低的框架，并且提供了JS沙箱、样式隔离、元素隔离、预加载、资源地址补全、插件系统、数据通信等一系列完善的功能。MicroApp与技术栈无关，也不和业务绑定，可以用于任何前端框架和业务。</p>
<h5 data-id="heading-4">业务采取技术对比</h5>
<p><strong>iframe</strong>：在所有微前端方案中，iframe是最稳定的、上手难度最低的，但它有一些无法解决的问题，例如性能低、通信复杂、双滚动条、弹窗无法全局覆盖，成长性不高，只适合简单的页面渲染。</p>
<p><strong>npm包</strong>：将子应用封装成npm包，通过组件的方式引入，在性能和兼容性上是最优的方案，但却有一个致命的问题就是版本更新，每次版本发布需要通知接入方同步更新，管理非常困难。</p>
<p><strong>微前端框架</strong>：流行的微前端框架有single-spa和qiankun，它们将维护成本和功能上达到一种平衡，是目前实现微前端备受推崇的方案。</p>
<p>虽然qiankun比较优秀，但是需要代码修改和沟通成本，尤其在乙方不进行更改的情况下，所需要付出的成本几乎呈现几何倍数的增加，因此我这里首先采取了MicroApp进行实现,接下来我们就将vue2、vue3、React项目使用<code>MicroApp</code>进行结合起来</p>
<h4 data-id="heading-5">使用</h4>
<p>接下来我们在项目之中使用micro-app，首先是我们的主应用，我们的应用分层是这样子的</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Vue3</span> 主应用
   vue2 分应用

react18分应用
   react <span class="hljs-number">16</span> 分应用
</code></pre>
<h4 data-id="heading-6">主应用配置</h4>
<p>加载子应用</p>
<p>主应用之中引入子应用,这里我是以vue3 作为我们的主应用模块的,这里我们先引入React+antd这一套试试，我们端口为8083</p>
<h5 data-id="heading-7">安装版本<code>micro-app依赖</code></h5>
<p><strong>在我们的主应用Vue3之中进行安装</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">pnpm i @micro-zoe/micro-app --save

安装成功以后我们可以看到依赖部分
<span class="hljs-string">"@micro-zoe/micro-app"</span>: <span class="hljs-string">"1.0.0-rc.28"</span>,
</code></pre>
<h5 data-id="heading-8">初始化<code>micro-app</code></h5>
<p>主应用根目录下面初始化我们入口，我的是<code>main.ts</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> microApp <span class="hljs-keyword">from</span> <span class="hljs-string">'@micro-zoe/micro-app'</span>

microApp.<span class="hljs-title function_">start</span>()
</code></pre>
<h5 data-id="heading-9">路由配置</h5>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/reactantd"</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">"reactantd"</span>,
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">"reactantd"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">"User"</span>, <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">children</span>: [],
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"@/views/module/weiqianduan/reactantd/index.vue"</span>),
  },
</code></pre>
<h5 data-id="heading-10">页面使用</h5>
<pre><code class="hljs language-javascript" lang="javascript">&lt;micro-app 
  name=<span class="hljs-string">'nexus-react'</span> 
  url=<span class="hljs-string">'http://localhost:8083/'</span> 
  baseroute=<span class="hljs-string">"/reactantd"</span> iframe&gt;
&lt;/micro-app&gt;
</code></pre>
<h4 data-id="heading-11">[子应用]配置</h4>
<p>vite其中的配置部分我们必须保证我们有下面的内容</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span>,
    }
  }
})
</code></pre>
<p>这个时候我们重新启动一下项目，我们可以看到项目给我们的报错，这里我们重新启动确定一下我们地址配置的没有问题即可</p>
<pre><code class="hljs language-javascript" lang="javascript">@micro-zoe_micro-app.<span class="hljs-property">js</span>?v=6<span class="hljs-attr">a3e7321</span>:<span class="hljs-number">151</span> [micro-app] app my-<span class="hljs-attr">app</span>: 
</code></pre>
<p>尝试一下，这个时候我们嵌入的部分已经成功了</p>
<h5 data-id="heading-12">特别注意</h5>
<p>经过我的尝试，我发现有两个点需要特别的关注</p>
<p>:::info
1、授权  鉴权系统 这个不用想，同鉴权系统我们才能嵌入进去</p>
<p>2、 配置完没有问题以后我尝试了几次都没成功，这里格外注意</p>
<pre><code class="hljs">  我们需要重新启动项目，清理浏览器缓存以后我们的配置才能生效
</code></pre>
<p>:::</p>
<p>补充</p>
<pre><code class="hljs language-javascript" lang="javascript">调试的时候需要注意

我们只可以本地调试本地
或者线上调试线上


在本地调试线上这种模式下，是跨域无法成功的
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>