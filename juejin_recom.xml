<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[【深度学习新手踩坑实录】(NLP实战)Word2Vec+Bi-LSTM搭建企业级恶意评论检测系统（附GitHub+数据集链接）]]></title>    <link>https://juejin.cn/post/7601101531921104942</link>    <guid>https://juejin.cn/post/7601101531921104942</guid>    <pubDate>2026-02-01T08:24:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601101531921104942" data-draft-id="7600489282840002570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【深度学习新手踩坑实录】(NLP实战)Word2Vec+Bi-LSTM搭建企业级恶意评论检测系统（附GitHub+数据集链接）"/> <meta itemprop="keywords" content="深度学习,NLP,开源"/> <meta itemprop="datePublished" content="2026-02-01T08:24:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="柠柠酱"/> <meta itemprop="url" content="https://juejin.cn/user/3739876675556569"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【深度学习新手踩坑实录】(NLP实战)Word2Vec+Bi-LSTM搭建企业级恶意评论检测系统（附GitHub+数据集链接）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3739876675556569/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    柠柠酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:24:25.000Z" title="Sun Feb 01 2026 08:24:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>想给简历加个 NLP 实战项目？本文记录了我从零搭建一个企业级规范的恶意评论检测系统的全过程。</p>
</blockquote>
<p><strong>摘要</strong>：想给简历加个 NLP 实战项目？本文记录了我从零搭建一个<strong>企业级规范</strong>的恶意评论检测系统的全过程，从Kaggle数据集预处理、Word2Vec词向量构建，到Bi-LSTM模型搭建、工程化代码编写，再到模型评估与可视化，全程复盘新手易踩的技术坑。项目使用的数据集来自Kaggle的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Fcompetitions%2Fjigsaw-toxic-comment-classification-challenge%2Fdata" target="_blank" title="https://www.kaggle.com/competitions/jigsaw-toxic-comment-classification-challenge/data" ref="nofollow noopener noreferrer">Toxic Comment Classification Challenge</a>，包括训练集和测试集，目标是对网络评论进行多标签恶意属性分类。完整可运行代码已上传至<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSalem532%2FToxic_Comment_Detection" target="_blank" title="https://github.com/Salem532/Toxic_Comment_Detection" ref="nofollow noopener noreferrer">GitHub</a>，新手可直接参考避坑、快速上手运行项目。</p>
<p><em>关键词：NLP实战；Word2Vec；Bi-LSTM；恶意评论检测；多标签分类；Kaggle实战；PyTorch工程化；深度学习新手避坑</em></p>
<h2 data-id="heading-0">🧐 为什么做这个？</h2>
<p>作为一个深度学习新手，之前我们已经完成了车道线分割的CV实战，但NLP项目一直没动手实践过。NLP入门的经典任务（文本分类、情感分析、命名实体识别）看似简单，但要做到<strong>工程化、模块化、可复现</strong>，其实并不容易。</p>
<p>而企业招人的时候，<strong>根本不看你会不会跑demo，更看重工程化思维和项目落地能力</strong>——能不能把一个想法变成可复现、可维护、可优化的完整系统。</p>
<p>为了让简历上的NLP项目不再像“玩具”，也为了真正搞懂NLP基础任务的完整流程，这次我决定按<strong>企业级工程标准</strong>（Config参数分离、模块化设计、日志管理、结果可视化）来做经典NLP任务——<strong>恶意评论检测</strong>。毕竟，把基础任务做规范，比硬啃复杂模型更有实际意义。</p>
<h2 data-id="heading-1">🎯 任务目标：不仅是“好人坏人”，而是多标签精准分类</h2>
<p>我们要处理的是 Kaggle 上的经典比赛：<strong>Toxic Comment Classification</strong>，核心是对网络评论进行恶意属性标注，也是NLP入门必做的多标签分类任务。</p>
<h3 data-id="heading-2">⚠️ （回顾）新手核心知识点：多标签分类 vs 多分类</h3>
<p>很多新手会把这两个概念搞混（我就是个典型的例子），这里用最通俗的话讲清楚：</p>
<ul>
<li><strong>多分类</strong>：从多个互斥的类别中选一个，比如“猫/狗/鸟”，一张图片只能是其中一种；</li>
<li><strong>多标签</strong>：从多个不互斥的类别中选任意多个，比如评论可以同时是“恶意+侮辱+威胁”，就像一个人可以同时是“程序员+铲屎官+咖啡爱好者”。</li>
</ul>
<h3 data-id="heading-3">本次任务标签定义</h3>
<p>我们需要让模型对每条评论，同时预测6种恶意属性的概率（0=无，1=有），标签对应关系如下：</p>





























<table><thead><tr><th>标签名</th><th>含义</th><th>标签名</th><th>含义</th></tr></thead><tbody><tr><td>toxic</td><td>普通恶意</td><td>threat</td><td>威胁性评论</td></tr><tr><td>severe_toxic</td><td>重度恶意</td><td>insult</td><td>侮辱性评论</td></tr><tr><td>obscene</td><td>淫秽性评论</td><td>identity_hate</td><td>身份仇恨评论</td></tr></tbody></table>
<h2 data-id="heading-4">🛠️ 技术栈与“强迫症”工程结构（新手可直接默写）</h2>
<p>抛弃了以前“一把梭”的写法，这次采用<strong>模块化、可复现、易优化</strong>的分离式架构，所有模块解耦，改参数、换模型、加功能都不用动核心代码，新手照抄这个结构，做任何NLP基础任务都能用。</p>
<h3 data-id="heading-5">核心技术栈</h3>








































<table><thead><tr><th>模块</th><th>技术选型</th><th>选型原因（新手友好版）</th></tr></thead><tbody><tr><td>词向量构建</td><td>Word2Vec</td><td>轻量、易训练、适合中小规模数据集，是NLP词向量基础</td></tr><tr><td>特征提取</td><td>Bi-LSTM（双向LSTM）</td><td>相比基础RNN解决了梯度消失问题，能捕捉文本上下文信息，双向设计更贴合语言理解</td></tr><tr><td>配置管理</td><td>YAML</td><td>纯文本格式，易编写、易读取，不用在代码里硬编码参数</td></tr><tr><td>日志管理</td><td>Python logging</td><td>记录训练过程中的关键信息，跑崩了可追溯问题</td></tr><tr><td>可视化</td><td>Matplotlib + TSNE</td><td>词向量可视化、训练曲线可视化，直观验证模型效果</td></tr><tr><td>评估指标</td><td>AUC + F1 + 准确率</td><td>多维度评估模型，避免单一指标的误导</td></tr></tbody></table>
<h3 data-id="heading-6">企业级目录结构（附各文件夹/文件核心作用）</h3>
<p>新手最容易犯的错是“所有代码堆在一个文件里”，下面这个结构把<strong>数据、模型、训练、配置</strong>完全分离，每个模块只做一件事，注释写清了每个文件夹里该放什么，直接照搬就行：</p>
<pre><code class="hljs language-text" lang="text">toxic_comment_detection/
├── configs/            # 所有超参数/路径都在这，改参不用动代码！
│   └── config.yaml     # 包含批次大小、学习率、词向量维度、LSTM层数等所有参数
├── src/                # 核心代码库（模块化设计，显得专业且易维护）
│   ├── data/           # 数据相关所有代码（重点：NLP大部分坑在这）
│   │   ├── __init__.py
│   │   ├── data_clean.py  # 数据清洗：去特殊符号、去停用词、小写转换等
│   │   ├── tokenizer.py   # 分词、词表构建、OOV（未登录词）处理
│   │   ├── dataset.py     # PyTorch自定义Dataset，加载/处理训练/测试数据
│   │   └── word2vec_utils.py     # Word2Vec词向量训练与加载
│   ├── models/         # 模型定义，换模型只改这里！
│   │   ├── __init__.py
│   │   └── lstm.py     # Word2Vec+Bi-LSTM+全连接层，多标签输出
│   ├── trainer.py      # 训练循环核心逻辑：前向传播、损失计算、优化器更新
│   ├── evaluator.py    # 评估逻辑：AUC/F1/准确率计算，模型推理
│   └── utils/          # 工具函数：日志初始化、模型保存/加载、可视化
│       ├── __init__.py
│       ├── logger.py
│       ├── model_utils.py
│       └── visualization.py
├── saved/              # 自动保存，无需手动操作
│   ├── logs/           # 训练日志文件，记录每轮损失、验证集指标
│   ├── models/         # 自动保存的最优模型权重（按AUC筛选）
│   └── results/        # 测试集预测结果、可视化图片、评估报告
├── train.py            # 训练入口文件（一行命令启动训练，新手友好）
├── evaluate.py         # 评估入口文件（加载模型，跑测试集评估+可视化）
├── predict.py          # 单条评论预测入口（实际落地用，输入一句话直接出结果）
├── visualize.py        # 词向量TSNE可视化入口（验证词向量质量）
└── requirements.txt    # 锁死所有依赖版本，避免环境问题
</code></pre>
<h2 data-id="heading-7">📝 前置必备：NLP数据预处理全流程（新手踩坑重灾区）</h2>
<p>NLP任务中，<strong>数据预处理的质量决定了模型效果的上限</strong>，模型再牛，数据没处理好也是白搭。很多新手直接跳过清洗步骤就开始训练，结果模型效果差到离谱，还不知道问题出在哪。</p>
<p>本次项目基于Kaggle原始数据集，做了<strong>工业级标准的数据预处理流程</strong>，每一步都有明确的目的，新手可直接复用代码，以下是核心步骤（附代码片段和新手注意点）：</p>
<h3 data-id="heading-8">步骤1：数据加载与初步探索</h3>
<p>首先加载Kaggle的<code>train.csv</code>和<code>test.csv</code>，查看数据规模、标签分布、评论长度，<strong>重点看样本是否均衡、有无缺失值</strong>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 加载数据</span>
train_df = pd.read_csv(<span class="hljs-string">"train.csv"</span>)
test_df = pd.read_csv(<span class="hljs-string">"test.csv"</span>)
test_labels_df = pd.read_csv(<span class="hljs-string">"test_labels.csv"</span>)

<span class="hljs-comment"># 检查缺失值，直接删除或填充</span>
train_df = train_df.dropna(subset=[<span class="hljs-string">'comment_text'</span>])
test_df = test_df.dropna(subset=[<span class="hljs-string">'comment_text'</span>])

<span class="hljs-comment"># 查看标签分布（了解样本不均衡情况）</span>
label_cols = [<span class="hljs-string">'toxic'</span>, <span class="hljs-string">'severe_toxic'</span>, <span class="hljs-string">'obscene'</span>, <span class="hljs-string">'threat'</span>, <span class="hljs-string">'insult'</span>, <span class="hljs-string">'identity_hate'</span>]
<span class="hljs-built_in">print</span>(train_df[label_cols].<span class="hljs-built_in">sum</span>())
</code></pre>
<p>你会发现：普通恶意（toxic）评论约15000条，而身份仇恨（identity_hate）仅约1500条，样本极度不均衡，此时我们需要在后续训练中使用<strong>AUC指标</strong>，而不是准确率。</p>
<h4 data-id="heading-9">💣  避坑指南：AUC 是啥？为什么用 AUC 而不是准确率？</h4>
<p>很多新手在做分类任务时，第一反应是看“准确率（Accuracy）”。但在恶意评论检测这个场景下，准确率是一个极其危险的指标。在 Kaggle 的这个数据集里，90% 以上都是正常评论。这意味着，即使我的模型是个“复读机”，只会预测“正常”，它也能拿到 90% 以上的准确率。但这样的模型在实际业务中完全无法识别恶意攻击，是毫无意义的。</p>
<p>而 <strong>AUC (Area Under Curve)</strong> 指标，专门用来衡量模型区分正负样本的能力。</p>
<ul>
<li>它不看表面分数，看排序能力：AUC 衡量的是模型是否有能力把“恶意评论”打的分数比“正常评论”高。</li>
<li>它对样本分布不敏感：哪怕正负样本比例是 1:100，AUC 依然能公正地评估出模型的区分能力。</li>
<li>数值含义：AUC 越接近 1，代表模型区分“好坏”的能力越强。</li>
</ul>
<h3 data-id="heading-10">步骤2：文本清洗（去除噪声，让模型专注有效信息）</h3>
<p>网络评论包含大量噪声：特殊符号（@、#、&amp;）、多余空格、大写字母、停用词（the/a/an等无意义词汇），这些都会干扰模型学习，必须清洗干净。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re
<span class="hljs-keyword">def</span> <span class="hljs-title function_">clean_text</span>(<span class="hljs-params">text</span>):
    <span class="hljs-comment"># 转小写（避免Hello/hello/HELLO被视为不同词汇）</span>
    text = <span class="hljs-built_in">str</span>(text).lower()
    <span class="hljs-comment"># 正则过滤：仅保留小写字母和空格，去除其他所有字符（符号、数字、表情等）</span>
    text = re.sub(<span class="hljs-string">r'[^a-z\s]'</span>, <span class="hljs-string">''</span>, text)
    <span class="hljs-comment"># 按空格分词，返回单词列表</span>
    <span class="hljs-keyword">return</span> text.split()
</code></pre>
<blockquote>
<p><strong>注意点</strong>：不要过度清洗！比如不要去除所有标点，部分标点（！、？）能传递情绪，但网络评论的标点杂乱，本次直接全部去除更稳妥。</p>
</blockquote>
<h3 data-id="heading-11">步骤3：分词与词表构建（让计算机“认识”单词）</h3>
<p>计算机看不懂文字，只能看懂数字，所以需要：</p>
<ol>
<li><strong>分词</strong>：把句子拆成单个单词，比如<code>You are stupid</code>→<code>[You, are, stupid]</code>；</li>
<li><strong>词表构建</strong>：给每个唯一单词分配一个数字ID（词汇表），比如<code>You=1, are=2, stupid=3</code>；</li>
<li><strong>OOV处理</strong>：对词表外的未登录词，分配统一的ID（比如1），避免模型报错。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">from</span> .data_clean <span class="hljs-keyword">import</span> clean_text  <span class="hljs-comment"># 导入独立的清洗函数</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextTokenizer</span>:
    <span class="hljs-string">"""
    分词器核心类：负责词表构建、文本→ID序列转换、Tokenizer保存与加载
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_len=<span class="hljs-number">200</span>, min_freq=<span class="hljs-number">2</span></span>):
        self.max_len = max_len  <span class="hljs-comment"># 序列固定长度（截断/填充）</span>
        self.min_freq = min_freq  <span class="hljs-comment"># 词汇最小出现频率（过滤低频词）</span>
        <span class="hljs-comment"># 初始词表：&lt;PAD&gt;填充符（ID=0）、&lt;UNK&gt;未登录词（ID=1）</span>
        self.word2idx = {<span class="hljs-string">"&lt;PAD&gt;"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"&lt;UNK&gt;"</span>: <span class="hljs-number">1</span>}
        self.idx2word = {<span class="hljs-number">0</span>: <span class="hljs-string">"&lt;PAD&gt;"</span>, <span class="hljs-number">1</span>: <span class="hljs-string">"&lt;UNK&gt;"</span>}
        self.vocab_size = <span class="hljs-number">2</span>  <span class="hljs-comment"># 初始词表大小（2个特殊符号）</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_vocab</span>(<span class="hljs-params">self, texts</span>):
        <span class="hljs-string">"""
        基于输入文本构建词表
        Args:
            texts: 文本列表（list[str]），如 [ "I hate you", "You are stupid" ]
        """</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Building vocabulary..."</span>)
        word_counter = Counter()  <span class="hljs-comment"># 统计词频</span>

        <span class="hljs-comment"># 遍历所有文本，统计有效词频</span>
        <span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> texts:
            clean_words = clean_text(text)  <span class="hljs-comment"># 调用独立清洗函数</span>
            word_counter.update(clean_words)

        <span class="hljs-comment"># 过滤低频词，更新词表（仅保留出现次数≥min_freq的词）</span>
        <span class="hljs-keyword">for</span> word, freq <span class="hljs-keyword">in</span> word_counter.items():
            <span class="hljs-keyword">if</span> freq &gt;= self.min_freq:
                self.word2idx[word] = self.vocab_size
                self.idx2word[self.vocab_size] = word
                self.vocab_size += <span class="hljs-number">1</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Vocab building completed! Final vocab size: <span class="hljs-subst">{self.vocab_size}</span>"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_tokens_to_ids</span>(<span class="hljs-params">self, text</span>):
        <span class="hljs-string">"""
        文本→ID序列：清洗→分词→ID转换→截断/填充
        Args:
            text: 单条原始文本（str）
        Returns:
            固定长度的ID序列（list[int]）
        """</span>
        <span class="hljs-comment"># 1. 文本清洗+分词</span>
        clean_words = clean_text(text)
        <span class="hljs-comment"># 2. 转换为ID（未登录词用&lt;UNK&gt;的ID=1）</span>
        ids = [self.word2idx.get(word, self.word2idx[<span class="hljs-string">"&lt;UNK&gt;"</span>]) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> clean_words]
        <span class="hljs-comment"># 3. 截断（超长）或填充（超短）到max_len</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(ids) &gt; self.max_len:
            ids = ids[:self.max_len]  <span class="hljs-comment"># 截断：保留前max_len个ID</span>
        <span class="hljs-keyword">else</span>:
            ids += [self.word2idx[<span class="hljs-string">"&lt;PAD&gt;"</span>]] * (self.max_len - <span class="hljs-built_in">len</span>(ids))  <span class="hljs-comment"># 填充：末尾补&lt;PAD&gt;的ID=0</span>
        <span class="hljs-keyword">return</span> ids

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save</span>(<span class="hljs-params">self, save_path</span>):
        <span class="hljs-string">"""
        保存Tokenizer到本地（pickle格式，方便后续复用词表）
        Args:
            save_path: 保存路径（如 "saved/tokenizer.pkl"）
        """</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(save_path, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:
            pickle.dump(self, f)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Tokenizer successfully saved to: <span class="hljs-subst">{save_path}</span>"</span>)

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load</span>(<span class="hljs-params">load_path</span>):
        <span class="hljs-string">"""
        从本地加载Tokenizer（无需重新构建词表）
        Args:
            load_path: 加载路径（如 "saved/tokenizer.pkl"）
        Returns:
            加载后的TextTokenizer实例
        """</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(load_path, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
            tokenizer = pickle.load(f)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Tokenizer successfully loaded from: <span class="hljs-subst">{load_path}</span>"</span>)
        <span class="hljs-keyword">return</span> tokenizer
</code></pre>
<blockquote>
<p><strong>注意点</strong>：序列长度的选择！太短会截断有效信息，太长会增加计算量、引入噪声。一般选择<strong>95%分位数</strong>的长度作为max_len，既能覆盖大部分样本，又不会过长。</p>
</blockquote>
<h3 data-id="heading-12">步骤4：构建PyTorch Dataset（适配模型训练）</h3>
<p>最后把处理好的数字序列和标签，封装成PyTorch的<code>Dataset</code>类，让模型能批量加载数据，这是PyTorch训练的标准操作，新手必须掌握。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ToxicDataset</span>(<span class="hljs-title class_ inherited__">Dataset</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, texts, labels, tokenizer</span>):
        self.texts = texts
        self.labels = labels
        self.tokenizer = tokenizer

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.texts)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, idx</span>):
        <span class="hljs-comment"># 获取单条文本和标签</span>
        text = self.texts[idx]
        label = self.labels[idx]

        <span class="hljs-comment"># 文本→ID序列（调用Tokenizer的转换方法）</span>
        input_ids = self.tokenizer.convert_tokens_to_ids(text)

        <span class="hljs-comment"># 转换为PyTorch Tensor（匹配模型输入格式）</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"input_ids"</span>: torch.tensor(input_ids, dtype=torch.long),  <span class="hljs-comment"># 文本ID序列：(max_len,)</span>
            <span class="hljs-string">"label"</span>: torch.tensor(label, dtype=torch.float32)       <span class="hljs-comment"># 标签：(6,)</span>
        }
</code></pre>
<h2 data-id="heading-13">🧠 模型原理：从Word2Vec到Bi-LSTM，新手也能懂的NLP基础模型</h2>
<p>本次项目的核心模型是<strong>Word2Vec（词向量）+ Bi-LSTM（特征提取）+ 全连接层（多标签输出）</strong> ，都是NLP的基础模型，看似复杂，用通俗的比喻+示意图就能彻底搞懂，新手不用怕！</p>
<h3 data-id="heading-14">先搞懂：为什么需要Word2Vec？（计算机的“语言翻译官”）</h3>
<p>计算机只能处理数字，但文字是符号，直接把单词转成随机数字（比如You=1, are=2），模型根本学不到单词的语义——比如<code>stupid</code>和<code>idiot</code>是近义词，但随机数字没有任何关联。</p>
<p><strong>Word2Vec的核心作用</strong>：把每个单词转换成一个<strong>低维稠密的向量（Embedding）</strong> ，让<strong>语义相近的单词，向量在空间中距离更近</strong>。比如<code>stupid</code>和<code>idiot</code>的向量几乎重合，<code>good</code>和<code>nice</code>的向量距离很近，而<code>stupid</code>和<code>good</code>的向量距离很远。</p>
<h4 data-id="heading-15">Word2Vec的两种核心模式</h4>
<p>Word2Vec主要有两种训练方式，都是基于“上下文预测单词”的思想，本次项目用<strong>Skip-gram</strong>（适合中小规模数据集）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5aa6f660dd4324bc01279b18925a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539064&amp;x-signature=oZozcHzRtpoaw%2Bo0PWlSPmUnKYQ%3D" alt="Word2Vec.png" loading="lazy"/></p>
<ul>
<li><strong>Skip-gram</strong>：给中心词，预测周围的上下文词，适合稀有词较多的数据集（比如本次的恶意评论，有很多小众脏话）；</li>
<li><strong>CBOW</strong>：给上下文词，预测中心词，训练速度快，适合大规模通用数据集。</li>
</ul>
<h3 data-id="heading-16">再搞懂：LSTM是什么？为什么比RNN强？</h3>
<p>这个内容在<a href="https://juejin.cn/post/7597080391879671818" target="_blank" title="https://juejin.cn/post/7597080391879671818">【深度学习Day14】</a>里讲过，这里简要复盘，方便新手理解LSTM的核心原理。</p>
<p>处理文本这种<strong>序列数据</strong>，最基础的模型是RNN（循环神经网络），但RNN有个致命缺陷——<strong>梯度消失</strong>，当句子较长时，RNN会忘记前面的单词（比如读到句子末尾，已经忘了开头说的是什么），根本无法捕捉长距离上下文信息。<strong>LSTM（长短期记忆网络）</strong> 是RNN的改进版，核心是加入了<strong>记忆单元和门控机制</strong>，可以理解为一个“带筛选功能的笔记本”——能记住重要的信息，忘记无用的信息，完美解决了RNN的梯度消失问题。</p>
<h4 data-id="heading-17">LSTM的核心结构：3个门控+1个记忆单元</h4>
<p>不用记复杂的数学公式，用“笔记本”的比喻理解3个门控的作用：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a851998f649844288f7740e1374e68c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539064&amp;x-signature=I%2BHNSCot6vlWIHWsAnpu8e1sDfI%3D" alt="LSTM细胞.png" loading="lazy"/></p>
<ul>
<li><strong>遗忘门</strong>：决定哪些记忆需要被忘记，比如评论里的“的/地/得”，完全可以忘记；</li>
<li><strong>输入门</strong>：决定哪些新信息需要被记住，比如“stupid”“idiot”这些恶意关键词，必须牢牢记住；</li>
<li><strong>输出门</strong>：决定当前需要输出哪些记忆给下一个LSTM细胞，比如读到“you are”，需要把这个信息传递下去，方便后续判断是否是恶意评论；</li>
<li><strong>细胞状态</strong>：LSTM的核心，像一条“传送带”，从句子开头到结尾全程保存记忆，几乎不会丢失信息。</li>
</ul>
<h4 data-id="heading-18">Bi-LSTM（双向LSTM）：更贴合人类的“阅读方式”</h4>
<p>人类阅读时，会结合上下文理解语义（比如读到“You are stupid, but I like you”这句话，需要结合后半句才知道前半句不是恶意），而普通LSTM只能<strong>从左到右</strong>读文本，无法捕捉反向的上下文信息。<strong>Bi-LSTM（双向LSTM）</strong> 就是把两个LSTM叠加在一起：一个从左到右读，一个从右到左读，最后把两个LSTM的输出拼接起来，这样模型就能同时捕捉<strong>正向和反向</strong>的上下文信息，比单LSTM的效果提升一个档次，也是目前NLP基础任务的标配。</p>
<h3 data-id="heading-19">核心模型代码片段（Bi-LSTM多标签分类）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LSTMClassifier</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size, embed_dim, hidden_dim, num_layers, 
                 bidirectional, num_classes, dropout, embedding_matrix=<span class="hljs-literal">None</span></span>):
        <span class="hljs-built_in">super</span>(LSTMClassifier, self).__init__() 
        
        <span class="hljs-comment"># Embedding 层</span>
        self.embedding = nn.Embedding(vocab_size, embed_dim, padding_idx=<span class="hljs-number">0</span>) <span class="hljs-comment"># 初始化 Embedding 层</span>
        <span class="hljs-keyword">if</span> embedding_matrix <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"Loading pretrained embedding matrix..."</span>)
            self.embedding.weight.data.copy_(embedding_matrix) <span class="hljs-comment"># 加载预训练的 Word2Vec 权重</span>
            self.embedding.weight.requires_grad = <span class="hljs-literal">False</span> <span class="hljs-comment"># 冻结 Word2Vec 权重</span>
        
        <span class="hljs-comment"># LSTM 层</span>
        self.lstm = nn.LSTM(
            input_size=embed_dim,
            hidden_size=hidden_dim,
            num_layers=num_layers,
            bidirectional=bidirectional,
            batch_first=<span class="hljs-literal">True</span>,
            dropout=dropout <span class="hljs-keyword">if</span> num_layers &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        )
        
        <span class="hljs-comment"># 全连接层</span>
        lstm_out_dim = hidden_dim * <span class="hljs-number">2</span> <span class="hljs-keyword">if</span> bidirectional <span class="hljs-keyword">else</span> hidden_dim <span class="hljs-comment"># 双向 LSTM 输出维度翻倍</span>
        self.fc = nn.Sequential(
            nn.Linear(lstm_out_dim, hidden_dim), 
            nn.ReLU(), 
            nn.Dropout(dropout), 
            nn.Linear(hidden_dim, num_classes) 
        )
        self.sigmoid = nn.Sigmoid()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        embedded = self.embedding(x)
        output, (hidden, cell) = self.lstm(embedded)
         
        <span class="hljs-comment"># 取最后一个时间步 (双向则拼接最后两个隐状态)</span>
        <span class="hljs-keyword">if</span> self.lstm.bidirectional:
            final_feature = torch.cat((hidden[-<span class="hljs-number">2</span>,:,:], hidden[-<span class="hljs-number">1</span>,:,:]), dim=<span class="hljs-number">1</span>)
        <span class="hljs-keyword">else</span>:
            final_feature = hidden[-<span class="hljs-number">1</span>,:,:]
            
        logits = self.fc(final_feature)
        <span class="hljs-keyword">return</span> self.sigmoid(logits)
</code></pre>
<h2 data-id="heading-20">💣 踩坑实录（含泪总结）：</h2>
<p>这个项目看似是NLP入门任务，但从环境配置到模型训练，满地都是坑，以下是我踩过的3个坑，每个坑都包含<strong>报错原因、解决方法、核心教训</strong>，新手照做就能避坑，不用再走我的弯路。</p>
<h3 data-id="heading-21">坑1：NumPy 2.0 的“背刺”——环境配置的隐形雷</h3>
<p><strong>报错现象</strong>：刚配好环境，跑数据预处理脚本直接崩，一大堆 <code>ImportError: cannot import name 'xxx' from 'numpy'</code>，涉及<code>matplotlib</code>、<code>gensim</code>、<code>sklearn</code>等多个库。</p>
<p><strong>报错原因</strong>：NumPy 2.0 版本在2024年更新后，大量API发生了不兼容变动，而<code>gensim</code>（训练Word2Vec的库）、<code>matplotlib</code>等库还没适配，直接被“背刺”。</p>
<p><strong>解决方法</strong>：在<code>requirements.txt</code>里<strong>锁死NumPy版本</strong>，禁止安装2.0及以上版本，同时锁死其他核心库的版本，避免环境冲突。</p>
<p><strong>核心教训</strong>：环境配置是项目的第一步，也是最容易被新手忽略的一步！<strong>所有依赖必须锁死版本</strong>，不要盲目追求最新版本，稳定才是第一位的。</p>
<h3 data-id="heading-22">坑2：Kaggle 测试集的“陷阱”——-1标签的无效数据</h3>
<p><strong>报错现象</strong>：跑测试集的结果AUC只有0.6，准确率惨不忍睹，完全摸不着头脑。</p>
<p><strong>报错原因</strong>：Kaggle的<code>test_labels.csv</code>里，有大量标签值为-1的无效数据——官方为了防止作弊，把这些数据标记为“不参与评分”，如果不剔除，模型就是在对着一堆无效数据瞎猜，分数当然低。</p>
<p><strong>解决方法</strong>：在评估前，先清洗测试集，<strong>剔除所有标签为-1的行</strong>，只保留有效数据进行评估。</p>
<p><strong>核心教训</strong>：使用公开数据集前，<strong>一定要仔细阅读数据集说明</strong>，了解数据的格式、标记规则，避免踩官方的“陷阱”。</p>
<h3 data-id="heading-23">坑3：词表构建的OOV问题——未登录词让模型“看不懂”</h3>
<p><strong>报错现象</strong>：模型在训练集上效果很好，但在测试集上效果差很多，仔细看发现测试集里有很多生僻词（比如小众脏话、网络流行语），模型根本不认识。</p>
<p><strong>报错原因</strong>：词表是用训练集构建的，测试集里的一些单词在训练集里没出现过（未登录词，OOV），如果不处理，模型会把这些词当成未知，直接忽略，导致理解错误。</p>
<p><strong>解决方法</strong>：</p>
<ol>
<li>构建词表时，预留UNK标记，给未登录词分配统一的ID（比如1）；</li>
<li>适当增大最大词汇量（<code>max_vocab_size</code>），尽可能包含更多的单词；</li>
<li>数据清洗时，不要过度清洗，保留一些常见的网络词汇。</li>
</ol>
<p><strong>核心教训</strong>：NLP任务中，<strong>未登录词是不可避免的</strong>，必须提前处理，不要假设测试集的单词都在训练集里。</p>
<h2 data-id="heading-24">📈 最终战果：工业级可用的模型效果（AUC0.97+）</h2>
<p>在清洗后的测试集上（63978条有效样本），模型跑出了<strong>0.97的AUC</strong>，属于工业级可用的水平，看到结果的瞬间，感觉通宵调参都值了！以下是完整的测试集评估报告，包含多维度指标，全面验证模型效果：</p>
<pre><code class="hljs language-bash" lang="bash">==============================
       测试集最终评估报告
==============================
🏆 ROC-AUC Score: 0.97353
📊 Global Accuracy: 0.97366
📉 Macro F1 Score : 0.82013
------------------------------
</code></pre>
<h3 data-id="heading-25">可视化1：Word2Vec词向量TSNE降维——模型真的“学懂了”英语</h3>
<p>为了验证Word2Vec真的学到了单词的语义，我用<strong>TSNE</strong>把词向量降维到2维：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3b184bc49954cb8a61927c5c3f8c091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p-g5p-g6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539064&amp;x-signature=3kqpQdYdlia5E90%2BkEBDytqqEiQ%3D" alt="embedding_visualization.png" loading="lazy"/>
<strong>神奇现象</strong>：模型自动把近义词几乎重合在一起。这就是深度学习的魔法——模型没有任何人教它哪些是脏话，却通过学习训练集，自己学会了单词的“物以类聚”。</p>
<h3 data-id="heading-26">可视化2：单条评论预测——实际落地可用</h3>
<p>为了让模型能实际落地，我写了<code>predict.py</code>脚本，输入任意一条英文评论，模型能直接输出6个标签的概率，并标注出是否为恶意评论，示例如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行单条评论预测</span>
python predict.py --text <span class="hljs-string">"You are stupid, but I like you"</span>
</code></pre>
<p>👀这里有个有趣的<strong>插曲</strong>：</p>
<p>前面在讲解 Bi-LSTM 原理时，我举了 “You are stupid, but I like you” 的例子，认为模型应该识别出这不是恶意。但实际上手测试时，模型依然把它预测为了 Toxic。</p>
<p>为什么 Bi-LSTM 也会“翻车”？ 这其实揭示了深度学习的一个特性——数据偏见（Data Bias）。在 Kaggle 的训练集中，包含 "stupid" 的样本 99% 都是真实的辱骂，极少有“打情骂俏”的正样本。因此，模型学到了一个强特征：只要出现 stupid，大概率就是恶意。即便 Bi-LSTM 捕捉到了 "but I like you" 的上下文，但 "stupid" 的权重实在太大了，压过了上下文的修正作用。</p>
<p>我换了一些评论测试，模型都能给出合理的概率输出：</p>
<ul>
<li>“I will kill you.”（我要杀了你-恶意）但 “I need to kill this process.”（我需要杀死这个进程-正常）</li>
<li>“You are crazy.”（你是疯子-恶意） 但 “The crowd went crazy for the band.”（人群为乐队疯狂-正常）</li>
</ul>
<p>这也提醒我们：NLP 模型的判断标准来源于数据，而非真正的逻辑推理。 如果想解决这个问题，我们需要在训练集中增加更多“反讽”或“开玩笑”的样本进行数据增强。</p>
<h2 data-id="heading-27">🚀 项目总结与新手建议</h2>
<p>通过这个项目，我最大的收获不是跑出了0.97的AUC，而是<strong>真正掌握了NLP基础任务的完整流程和工程化思维</strong>——从数据集探索、数据预处理，到模型搭建、训练调试，再到评估可视化、项目落地，每一步都踩过坑，但每一步都有实实在在的收获。</p>
<h3 data-id="heading-28">给NLP新手的3条核心建议</h3>
<ol>
<li><strong>先把基础任务做规范，再啃复杂模型</strong>：先把恶意评论检测、文本分类、情感分析这些基础任务做透，掌握完整的流程和工程化方法，再去学习BERT、GPT等预训练模型，否则只会知其然不知其所以然；</li>
<li><strong>动手写代码，不要只看教程</strong>：看100遍教程，不如自己动手写一遍代码，跑通一个完整的项目，遇到问题自己调试，哪怕跑崩10次，也比光看不动手强；</li>
<li><strong>重视实验记录和复盘</strong>：训练过程中记录每轮的指标，改参数后对比效果，踩坑后及时复盘总结，形成自己的“避坑手册”，这是深度学习工程师的核心能力。</li>
</ol>
<p>完整的代码我已经开源在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSalem532%2FToxic_Comment_Detection" target="_blank" title="https://github.com/Salem532/Toxic_Comment_Detection" ref="nofollow noopener noreferrer">GitHub</a>了，包含<strong>完整的工程化代码、锁死版本的requirements.txt、一键启动/评估/预测脚本、详细的注释</strong>，新手可以直接克隆下来，按README的步骤跑通，也可以在此基础上修改，做自己的NLP项目。</p>
<p><em>觉得有帮助的话，GitHub求个 Star ⭐️！你的支持是我继续更新的最大动力~</em></p>
<h2 data-id="heading-29">📌 下期预告</h2>
<p>搞定了文本分类，你的 NLP 技能树已经点亮了重要的一环。下一期，我们将开启推荐系统实战，搭建一个基于 GNN 的推荐系统。我们下期不见不散~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[.NET + AI 实战：使用 Microsoft Agent Framework 集成自定义 Skills，打造可扩展的智能 AI Agent]]></title>    <link>https://juejin.cn/post/7601757036486098954</link>    <guid>https://juejin.cn/post/7601757036486098954</guid>    <pubDate>2026-02-01T09:10:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036486098954" data-draft-id="7601757036486082570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=".NET + AI 实战：使用 Microsoft Agent Framework 集成自定义 Skills，打造可扩展的智能 AI Agent"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-01T09:10:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼人"/> <meta itemprop="url" content="https://juejin.cn/user/2279731967827264"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            .NET + AI 实战：使用 Microsoft Agent Framework 集成自定义 Skills，打造可扩展的智能 AI Agent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2279731967827264/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:10:41.000Z" title="Sun Feb 01 2026 09:10:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着生成式 AI（Generative AI）技术的迅猛发展，AI Agent（智能代理）正成为构建下一代智能应用的核心范式。在 .NET 生态中，微软推出的 <strong>Microsoft Agent Framework（MAF）</strong> 为开发者提供了一套结构清晰、模块化且与 .NET 深度集成的框架，用于构建具备规划、记忆、工具调用和多技能协同能力的 AI Agent。</p>
<p>本文将手把手带你基于 .NET 8，使用 Microsoft Agent Framework 创建一个具备“天气查询”和“数学计算”能力的 AI Agent，并深入讲解如何通过 <strong>Skills（技能）</strong> 扩展其智能边界。</p>
<hr/>
<h3 data-id="heading-0">一、什么是 Microsoft Agent Framework？</h3>
<p>Microsoft Agent Framework 是微软在 Semantic Kernel 基础上进一步抽象出的高级 Agent 构建框架，旨在简化复杂 AI 应用的开发。它提供以下核心能力：</p>
<ul>
<li><strong>Agent 容器</strong>：托管多个 Skill，管理生命周期。</li>
<li><strong>Skill 模型</strong>：以插件形式封装具体功能（如调用 API、执行代码）。</li>
<li><strong>Planner（规划器）</strong> ：自动分析用户意图，选择并编排合适的 Skill。</li>
<li><strong>Memory 与 Context</strong>：支持短期/长期记忆，维持对话状态。</li>
<li><strong>.NET 原生支持</strong>：强类型、依赖注入、异步编程模型无缝集成。</li>
</ul>
<blockquote>
<p>💡 注意：截至 2026 年初，Microsoft Agent Framework 仍处于预览阶段，但已可通过 GitHub 和 NuGet 获取实验性版本。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">二、准备工作：创建 .NET 项目并引入依赖</h3>
<pre><code class="hljs language-sql" lang="sql">dotnet <span class="hljs-keyword">new</span> console <span class="hljs-operator">-</span>n DotNetAgentDemo
cd DotNetAgentDemo
dotnet <span class="hljs-keyword">add</span> package Microsoft.Agent <span class="hljs-comment">--prerelease</span>
dotnet <span class="hljs-keyword">add</span> package Microsoft.SemanticKernel <span class="hljs-comment">--prerelease</span>
</code></pre>
<p>你还需要一个 OpenAI 或 Azure OpenAI 的 API Key（用于 LLM 推理）。</p>
<p>在 <code>appsettings.json</code> 中配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"OpenAI"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ApiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ModelId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4o"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">三、定义第一个 Skill：数学计算器</h3>
<p>Skill 在 MAF 中是一个带有 <code>[Skill]</code> 特性的类，其方法通过 <code>[Function]</code> 标记为可被 Agent 调用。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Skills/MathSkill.cs</span>
<span class="hljs-keyword">using</span> Microsoft.Agent.Abstractions;

[<span class="hljs-meta">Skill(<span class="hljs-string">"Math"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MathSkill</span>
{
    [<span class="hljs-meta">Function(<span class="hljs-string">"Add two numbers"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span> =&gt; a + b;

    [<span class="hljs-meta">Function(<span class="hljs-string">"Multiply two numbers"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Multiply</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span> =&gt; a * b;
}
</code></pre>
<p>每个 <code>[Function]</code> 的描述文本将被 LLM 用于理解该函数的用途。</p>
<hr/>
<h3 data-id="heading-3">四、定义第二个 Skill：天气查询（模拟）</h3>
<p>实际项目中可调用天气 API（如 OpenWeatherMap），此处简化为模拟：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Skills/WeatherSkill.cs</span>
<span class="hljs-keyword">using</span> Microsoft.Agent.Abstractions;

[<span class="hljs-meta">Skill(<span class="hljs-string">"Weather"</span>)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherSkill</span>
{
    [<span class="hljs-meta">Function(<span class="hljs-string">"Get current weather for a city"</span>)</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetWeather</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> city</span>)</span>
    {
        <span class="hljs-keyword">return</span> city.ToLowerInvariant() <span class="hljs-keyword">switch</span>
        {
            <span class="hljs-string">"beijing"</span> =&gt; <span class="hljs-string">"Sunny, 22°C"</span>,
            <span class="hljs-string">"shanghai"</span> =&gt; <span class="hljs-string">"Cloudy, 18°C"</span>,
            _ =&gt; <span class="hljs-string">"Unknown city"</span>
        };
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">五、构建并运行 AI Agent</h3>
<p>在 <code>Program.cs</code> 中组装 Agent：</p>
<pre><code class="hljs language-ini" lang="ini">// Program.cs
using Microsoft.Agent<span class="hljs-comment">;</span>
using Microsoft.Extensions.Configuration<span class="hljs-comment">;</span>
using Microsoft.Extensions.DependencyInjection<span class="hljs-comment">;</span>
using Microsoft.SemanticKernel<span class="hljs-comment">;</span>

var <span class="hljs-attr">config</span> = new ConfigurationBuilder()
    .AddJsonFile("appsettings.json")
    .Build()<span class="hljs-comment">;</span>

var <span class="hljs-attr">services</span> = new ServiceCollection()<span class="hljs-comment">;</span>
services.AddAgentFramework()<span class="hljs-comment">; // 注册 MAF 核心服务</span>

// 配置 Semantic Kernel（作为 LLM 后端）
services.AddKernel()
    .AddOpenAIChatCompletion(
        modelId: config<span class="hljs-section">["OpenAI:ModelId"]</span>!,
        apiKey: config<span class="hljs-section">["OpenAI:ApiKey"]</span>!)<span class="hljs-comment">;</span>

// 注册自定义 Skills
services.AddSingleton&lt;MathSkill&gt;()<span class="hljs-comment">;</span>
services.AddSingleton&lt;WeatherSkill&gt;()<span class="hljs-comment">;</span>

var <span class="hljs-attr">serviceProvider</span> = services.BuildServiceProvider()<span class="hljs-comment">;</span>
var <span class="hljs-attr">agentHost</span> = serviceProvider.GetRequiredService&lt;IAgentHost&gt;()<span class="hljs-comment">;</span>

// 创建 Agent 实例
var <span class="hljs-attr">agent</span> = await agentHost.CreateAgentAsync(new AgentOptions
{
    <span class="hljs-attr">Name</span> = <span class="hljs-string">"SmartAssistant"</span>,
    <span class="hljs-attr">Description</span> = <span class="hljs-string">"A helpful assistant that can do math and check weather."</span>,
    <span class="hljs-attr">Skills</span> = { typeof(MathSkill), typeof(WeatherSkill) }
})<span class="hljs-comment">;</span>

// 用户交互循环
while (true)
{
    Console.Write("\nYou: ")<span class="hljs-comment">;</span>
    var <span class="hljs-attr">input</span> = Console.ReadLine()<span class="hljs-comment">;</span>
    if (string.IsNullOrEmpty(input)) break<span class="hljs-comment">;</span>

    var <span class="hljs-attr">response</span> = await agent.InvokeAsync(input)<span class="hljs-comment">;</span>
    Console.WriteLine($"Agent: {response}")<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-5">六、测试你的智能 Agent</h3>
<p>运行程序后，尝试以下对话：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">You:</span> What<span class="hljs-comment">'s 15 times 6?</span>
<span class="hljs-symbol">Agent:</span> The result <span class="hljs-built_in">is</span> <span class="hljs-number">90</span>.

<span class="hljs-symbol">You:</span> What<span class="hljs-comment">'s the weather in Beijing?</span>
<span class="hljs-symbol">Agent:</span> Sunny, <span class="hljs-number">22</span>°C.

<span class="hljs-symbol">You:</span> <span class="hljs-keyword">If</span> I add <span class="hljs-number">10</span> <span class="hljs-keyword">to</span> Beijing<span class="hljs-comment">'s temperature, what do I get?</span>
<span class="hljs-symbol">Agent:</span> Beijing<span class="hljs-comment">'s temperature is 22°C. Adding 10 gives 32.</span>
</code></pre>
<blockquote>
<p>✅ Agent 成功跨 Skill 协同：先调用 <code>WeatherSkill</code> 获取温度，再调用 <code>MathSkill</code> 进行加法！</p>
</blockquote>
<p>这背后是 MAF 内置的 <strong>AutoPlanner</strong> 在起作用——它利用 LLM 分析用户请求，生成执行计划（Plan），并按需调用多个 Skill。</p>
<hr/>
<h3 data-id="heading-6">七、进阶：添加记忆与上下文</h3>
<p>MAF 支持会话级记忆。通过 <code>agent.SetContext("user", "Alice")</code> 可注入上下文，后续对话中 LLM 可引用：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">await</span> agent.SetContextAsync(<span class="hljs-string">"user_name"</span>, <span class="hljs-string">"Alice"</span>);
<span class="hljs-keyword">var</span> reply = <span class="hljs-keyword">await</span> agent.InvokeAsync(<span class="hljs-string">"Hello!"</span>);
<span class="hljs-comment">// LLM 可能回复："Hello, Alice!"</span>
</code></pre>
<p>你还可以集成向量数据库实现长期记忆（需结合 Semantic Kernel 的 MemoryStore）。</p>
<hr/>
<h3 data-id="heading-7">八、最佳实践建议</h3>
<ol>
<li><strong>Skill 设计原则</strong>：单一职责、幂等、带清晰描述。</li>
<li><strong>输入验证</strong>：在 Skill 方法中校验参数，避免无效调用。</li>
<li><strong>错误处理</strong>：抛出异常会被 Agent 捕获并转为自然语言反馈。</li>
<li><strong>性能监控</strong>：记录每个 Skill 调用耗时，便于优化。</li>
<li><strong>安全沙箱</strong>：对敏感操作（如文件删除）添加权限控制层。</li>
</ol>
<hr/>
<h3 data-id="heading-8">结语</h3>
<p>Microsoft Agent Framework 将复杂的 AI Agent 架构封装为 .NET 开发者熟悉的依赖注入、接口和属性模型，极大降低了构建智能应用的门槛。通过组合不同的 Skill，你可以快速搭建客服机器人、运维助手、数据分析代理等场景化 AI 应用。</p>
<p>未来，随着框架的成熟和与 .NET Aspire、Orleans 等云原生技术的深度集成，基于 .NET 的 AI Agent 将成为企业智能化转型的重要基石。</p>
<blockquote>
<p>🚀 现在就动手，用 C# 编写你的第一个 AI Agent 吧！代码即智能，.NET 正在拥抱 AI 新时代。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的项目实战（九）—— 实现页面状态缓存？手写KeepAlive ，首页优化组件]]></title>    <link>https://juejin.cn/post/7601441475986931758</link>    <guid>https://juejin.cn/post/7601441475986931758</guid>    <pubDate>2026-02-01T09:13:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441475986931758" data-draft-id="7601169244454830106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的项目实战（九）—— 实现页面状态缓存？手写KeepAlive ，首页优化组件"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-02-01T09:13:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ETA8"/> <meta itemprop="url" content="https://juejin.cn/user/608445545328347"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的项目实战（九）—— 实现页面状态缓存？手写KeepAlive ，首页优化组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/608445545328347/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ETA8
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:13:22.000Z" title="Sun Feb 01 2026 09:13:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天，我们的项目要继续深入一个“看起来简单、实则暗流涌动”的功能场景：<strong>页面状态缓存 —— KeepAlive</strong>。</p>
<p>你可能已经见过这样的需求：</p>
<blockquote>
<p>“用户从首页点进详情页，再返回时，首页又要重新加载？能不能记住我之前滑到哪了？”</p>
</blockquote>
<p>这不只是用户体验的问题，更是对前端架构的一次考验。</p>
<hr/>
<h2 data-id="heading-0">一、问题起点：为什么首页总在“重复劳动”？</h2>
<p>在 React 单页应用中，路由切换并不会刷新页面，但组件会经历完整的挂载与卸载过程。</p>
<p>以常见的首页为例：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">"/home"</span> element={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span>} /&gt;
</code></pre>
<p>当用户从 <code>/home</code> 切换到 <code>/detail</code> 时，React 会执行 <code>Home.unmount()</code>；<br/>
再次返回时，则重新执行 <code>Home.mount()</code> —— 所有 <code>useState</code> 清零，<code>useEffect</code> 重跑，接口重发，列表重渲染。</p>
<p>结果就是：</p>
<ul>
<li>用户每次回来都要等数据加载；</li>
<li>滚动位置回到顶部；</li>
<li>已填写的搜索条件丢失；</li>
<li>动画闪烁明显。</li>
</ul>
<p>这不是 SPA 应该有的样子。我们需要的是：<strong>视觉上离开，逻辑上留下</strong>。</p>
<p>于是，<code>KeepAlive</code> 出现了。</p>
<hr/>
<h2 data-id="heading-1">二、目标拆解：一个合格的 KeepAlive 要解决什么问题？</h2>
<p>别急着引入第三方库，先明确我们的核心诉求：</p>
<ol>
<li><strong>组件状态保留</strong>：包括 state、ref、DOM 结构、滚动位置；</li>
<li><strong>按需缓存</strong>：不是所有页面都需要缓存，要可配置；</li>
<li><strong>内存可控</strong>：不能无限制缓存，避免内存泄漏；</li>
<li><strong>与路由系统良好集成</strong>：支持 React Router 等主流方案；</li>
<li><strong>组件卸载时自动清理资源</strong>：防止事件监听、定时器残留。</li>
</ol>
<p>这些要求听起来像 Vue 的 <code>&lt;keep-alive&gt;</code>？没错，但在 React 中，它需要我们更主动地去构建这套机制。</p>
<hr/>
<h2 data-id="heading-2">三、方案选型：自研 vs 第三方库</h2>
<h3 data-id="heading-3">方案一：手写简易版 KeepAlive</h3>
<p>我们可以用最朴素的方式模拟缓存行为：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> [cache, setCache] = <span class="hljs-title function_">useState</span>({});
<span class="hljs-keyword">const</span> [activeKey, setActiveKey] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 缓存当前组件</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (children &amp;&amp; activeId) {
    <span class="hljs-title function_">setCache</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [activeId]: children }));
  }
}, [activeId, children]);

<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    {Object.entries(cache).map(([key, comp]) =&gt; (
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{key}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> <span class="hljs-attr">key</span> === <span class="hljs-string">activeKey</span> ? '<span class="hljs-attr">block</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>
        {comp}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    ))}
  <span class="hljs-tag">&lt;/&gt;</span></span>
);
</code></pre>
<h4 data-id="heading-4">✅ 优点：</h4>
<ul>
<li>原理清晰，适合教学理解；</li>
<li>不依赖额外包，轻量；</li>
<li>可完全掌控缓存策略。</li>
</ul>
<h4 data-id="heading-5">❌ 缺点：</h4>
<ul>
<li>无法真正保留组件实例（如 ref、内部 state 生命周期）；</li>
<li>子组件更新可能导致缓存失效；</li>
<li>难以处理复杂嵌套结构；</li>
<li>没有统一的缓存管理机制。</li>
</ul>
<blockquote>
<p>这种方式更适合静态内容或演示用途，不适合生产环境。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">方案二：使用 <code>react-activation</code></h3>
<p>这是一个专门为 React 实现类似 Vue keep-alive 行为的成熟库。</p>
<p>它提供了三个核心能力：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AliveScope</span>, <span class="hljs-title class_">KeepAlive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AliveScope</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span>
            <span class="hljs-attr">path</span>=<span class="hljs-string">"/home"</span>
            <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
              &lt;<span class="hljs-attr">KeepAlive</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home"</span> <span class="hljs-attr">saveScrollPosition</span>=<span class="hljs-string">"screen"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
            }
          /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">AliveScope</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-7">核心组件说明：</h4>





















<table><thead><tr><th>组件</th><th>作用</th></tr></thead><tbody><tr><td><code>&lt;AliveScope&gt;</code></td><td>全局缓存容器，必须作为根节点包裹整个应用或需要缓存的部分</td></tr><tr><td><code>&lt;KeepAlive&gt;</code></td><td>包裹需要缓存的组件，通过 <code>name</code> 做唯一标识</td></tr><tr><td><code>useActivate/useUnactivate</code></td><td>替代 useEffect，监听组件激活/失活状态</td></tr></tbody></table>
<h4 data-id="heading-8">✅ 真正做到了什么？</h4>
<ul>
<li>组件卸载时不销毁实例，而是移入缓存池；</li>
<li>再次激活时直接复用原有实例，state 完全保留；</li>
<li>支持滚动位置记忆（<code>saveScrollPosition</code>）；</li>
<li>提供钩子函数控制数据刷新时机。</li>
</ul>
<p>这才是我们想要的“活”的组件。</p>
<hr/>
<h2 data-id="heading-9">四、实践细节：如何安全高效地使用 KeepAlive？</h2>
<h3 data-id="heading-10">1. 合理设置缓存粒度</h3>
<p>不是所有页面都值得被缓存。比如：</p>
<ul>
<li>登录页、支付成功页这类一次性页面，不应缓存；</li>
<li>数据强实时性页面（如股票行情），缓存反而会造成信息滞后。</li>
</ul>
<p>✅ 建议只对以下类型启用：</p>
<ul>
<li>首页、推荐流、商品列表等高频访问页；</li>
<li>Tab 类布局中的子页面（可用 name 动态生成）；</li>
<li>用户常往返跳转的路径。</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">KeepAlive</span> name={<span class="hljs-string">`list_<span class="hljs-subst">${category}</span>`</span>}&gt;...&lt;/<span class="hljs-title class_">KeepAlive</span>&gt;
</code></pre>
<h3 data-id="heading-11">2. 控制数据更新节奏：useActivate 是关键</h3>
<p>由于组件不会重新 mount，<code>useEffect(() =&gt; {}, [])</code> 只会在首次进入时触发一次。</p>
<p>这意味着：<strong>后续返回不会拉取最新数据</strong>。</p>
<p>解决方案是使用专属钩子：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useActivate } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-activation'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-comment">// 每次激活时执行</span>
  <span class="hljs-title function_">useActivate</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Home 被唤醒'</span>);
    <span class="hljs-title function_">fetchLatestData</span>().<span class="hljs-title function_">then</span>(setData);
  });

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{/* 渲染内容 */}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>这样既保留了状态，又能保证内容不过期。</p>
<hr/>
<h3 data-id="heading-12">3. 内存与性能的平衡</h3>
<p>虽然 <code>react-activation</code> 做了很多优化，但我们仍需警惕：</p>
<ul>
<li>长期缓存大量组件会导致内存占用上升；</li>
<li>特别是在移动端，内存资源有限。</li>
</ul>
<p>📌 <strong>建议措施</strong>：</p>
<ul>
<li>设置最大缓存数量（可通过封装中间层控制）；</li>
<li>对非活跃页面手动清除缓存（调用 <code>dropByCacheKey</code>）；</li>
<li>在开发工具中监控内存变化，及时发现问题。</li>
</ul>
<hr/>
<h3 data-id="heading-13">4. 清理副作用：别忘了事件监听和定时器</h3>
<p>即使组件被缓存，也不能放任副作用不管。</p>
<p>错误示例：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(polling, <span class="hljs-number">5000</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer); <span class="hljs-comment">// ❌ 只在 unmount 时清理</span>
});
</code></pre>
<p>如果组件一直被缓存，这个定时器将永远运行！</p>
<p>✅ 正确做法是结合 <code>useUnactivate</code>：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(polling, <span class="hljs-number">5000</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(timer);
}, []);

<span class="hljs-comment">// 或者使用专用钩子</span>
<span class="hljs-title function_">useUnactivate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Home 暂时休眠'</span>);
  <span class="hljs-comment">// 可在此暂停轮询、断开 WebSocket 等</span>
});
</code></pre>
<p>让组件在“休眠”前主动释放资源，醒来后再恢复。</p>
<hr/>
<h2 data-id="heading-14">五、总结：KeepAlive 是一种思维转变</h2>
<p><code>KeepAlive</code> 不只是一个技术组件，它代表了一种新的开发范式：</p>
<blockquote>
<p><strong>我们不再假设组件每次出现都是“全新”的，而要开始考虑它的“生命周期状态”</strong>。</p>
</blockquote>
<p>就像人离开房间又回来，不应该忘记自己刚才在做什么。</p>

























<table><thead><tr><th>能力</th><th>在本组件中的体现</th></tr></thead><tbody><tr><td>状态持久化</td><td>保留 scrollY、form 输入、局部状态</td></tr><tr><td>性能优化</td><td>避免重复渲染、减少网络请求</td></tr><tr><td>用户体验</td><td>返回即原样，无闪烁无等待</td></tr><tr><td>工程化思维</td><td>合理缓存、资源清理、可维护性</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">六、结语</h2>
<p>前端开发的魅力就在于：<br/>
那些最容易被忽略的小功能，往往藏着最深的设计哲学。</p>
<p>从“回到顶部”到“页面缓存”，我们在一次次打磨中学会思考：</p>
<blockquote>
<p>“用户真正需要的是什么？”<br/>
“我们是在做功能，还是在解决问题？”</p>
</blockquote>
<p>KeepAlive 不是为了炫技，而是为了让用户感受到：<strong>这个页面记得我</strong>。</p>
<p>下次当你接到“首页老是重新加载”的反馈时，不妨试试给它加一层 <code>KeepAlive</code> —— 让页面变得更有“记忆”。</p>
<p>欢迎点赞收藏，也期待你在评论区分享你的缓存策略或踩坑经历。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始搭建部署 block/goose 完整攻略]]></title>    <link>https://juejin.cn/post/7601144981169864754</link>    <guid>https://juejin.cn/post/7601144981169864754</guid>    <pubDate>2026-01-31T16:18:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601144981169864754" data-draft-id="7601144981169848370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始搭建部署 block/goose 完整攻略"/> <meta itemprop="keywords" content="大数据,数据库,开源"/> <meta itemprop="datePublished" content="2026-01-31T16:18:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大厂技术总监下海"/> <meta itemprop="url" content="https://juejin.cn/user/4091714106833577"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始搭建部署 block/goose 完整攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4091714106833577/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大厂技术总监下海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T16:18:25.000Z" title="Sat Jan 31 2026 16:18:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从零开始搭建部署 goose 完整攻略</h2>
<p><strong>新手入门指南 - V1.0版本</strong></p>
<h3 data-id="heading-1">📋 目录</h3>
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B" title="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82" title="#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82">系统要求</a></li>
<li><a href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85" title="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85">系统安装</a></li>
<li><a href="#%E9%A6%96%E6%AC%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%BF%90%E8%A1%8C" title="#%E9%A6%96%E6%AC%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%BF%90%E8%A1%8C">首次配置与运行</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8" title="#%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8">常用指令大全</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E7%A4%BA%E4%BE%8B%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C" title="#%E9%80%9A%E8%BF%87%E7%A4%BA%E4%BE%8B%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C">通过示例快速体验</a></li>
<li><a href="#%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4" title="#%E6%97%A5%E5%B8%B8%E7%BB%B4%E6%8A%A4">日常维护</a></li>
<li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4" title="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a></li>
<li><a href="#%E8%BF%9B%E9%98%B6%E9%85%8D%E7%BD%AE" title="#%E8%BF%9B%E9%98%B6%E9%85%8D%E7%BD%AE">进阶配置</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
<li><a href="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83%E5%8D%A1" title="#%E8%B5%84%E6%BA%90%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83%E5%8D%A1">资源链接与快速参考卡</a></li>
</ul>
<h3 data-id="heading-2">简介</h3>
<p>goose 是一个<strong>本地化、可扩展、开源</strong>的 AI 智能体框架，旨在<strong>自动化复杂的软件工程任务</strong>。与传统的代码补全工具不同，goose 能够理解高层次的目标，并自主执行从代码编写、文件操作、命令运行到调试、测试的完整工作流。它是一个运行在你机器上的“AI 工程师助手”。</p>
<p><strong>核心功能概览</strong>：</p>
<ul>
<li>🤖 <strong>自主任务执行</strong>：根据自然语言指令，完成从项目创建到代码部署的多种任务。</li>
<li>🔧 <strong>本地优先与可扩展</strong>：核心逻辑在本地运行，支持通过 Model Context Protocol (MCP) 集成多种工具和扩展。</li>
<li>💻 <strong>多模态交互</strong>：提供桌面图形界面 (GUI) 和命令行界面 (CLI)，满足不同场景需求。</li>
<li>📦 <strong>灵活的模型支持</strong>：可配置使用云端或本地的多种大型语言模型 (LLM)。</li>
<li>📁 <strong>项目感知与操作</strong>：内置开发者工具，可直接读写文件、运行 Shell 命令、分析代码结构。</li>
</ul>
<p><strong>版本说明</strong>：本指南基于 goose 主分支（版本约 1.21.0）编写。项目处于活跃开发中，部分功能可能更新，请以官方文档为准。</p>
<p><strong>教程约定</strong>：</p>
<ul>
<li><code>命令</code>：表示在终端中执行的命令。</li>
<li><code>$</code>：表示命令提示符，其后的内容是需要你输入的命令。</li>
<li><code>(GUI)</code>：表示在桌面应用程序中进行的操作。</li>
<li><code>路径/文件名</code>：表示文件系统路径或文件名。</li>
</ul>
<h3 data-id="heading-3">系统要求</h3>
<p>在安装 goose 前，请确保你的系统满足以下基础要求。</p>















































<table><thead><tr><th align="left">组件</th><th align="left">最低要求</th><th align="left">推荐配置</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>操作系统</strong></td><td align="left">Windows 10 (1809+), macOS 11+, Linux (主流发行版)</td><td align="left">最新稳定版</td><td align="left">需为64位系统。</td></tr><tr><td align="left"><strong>处理器</strong></td><td align="left">支持 SSE2 的 x86_64 或 Apple Silicon (arm64)</td><td align="left">多核处理器</td><td align="left">主要用于运行客户端，重型计算在模型服务端。</td></tr><tr><td align="left"><strong>内存</strong></td><td align="left">4 GB RAM</td><td align="left">8 GB RAM 或更高</td><td align="left">运行桌面应用和多个扩展时需要更多内存。</td></tr><tr><td align="left"><strong>磁盘空间</strong></td><td align="left">500 MB 可用空间</td><td align="left">1 GB 或更多</td><td align="left">用于安装二进制文件、存储配置和缓存。</td></tr><tr><td align="left"><strong>网络连接</strong></td><td align="left">可访问互联网</td><td align="left">稳定的宽带连接</td><td align="left">用于下载安装包、与模型 API 通信。</td></tr><tr><td align="left"><strong>依赖环境</strong></td><td align="left">无（二进制版本）</td><td align="left">Git, Rust（从源码编译时）</td><td align="left">大多数用户只需下载二进制文件。</td></tr></tbody></table>
<p><strong>各系统额外要求与提示</strong>：</p>
<ul>
<li><strong>Windows</strong>：建议在 <strong>WSL 2</strong> (Windows Subsystem for Linux) 环境下使用 CLI，以获得最佳兼容性。原生 Windows 命令提示符或 PowerShell 也可运行。</li>
<li><strong>macOS</strong>：可能需要允许运行来自“未识别开发者”的应用（首次运行时在系统偏好设置的“安全性与隐私”中批准）。</li>
<li><strong>Linux</strong>：需要基础的开发库（如 <code>libssl</code>, <code>ca-certificates</code>）。使用包管理器安装（如 <code>apt</code>, <code>yum</code>, <code>dnf</code>）即可。</li>
<li><strong>通用提示</strong>：
<ul>
<li><strong>代理设置</strong>：如果你所在网络需要代理才能访问 GitHub 或模型 API，请提前在系统或终端中配置好 HTTP/HTTPS 代理。</li>
<li><strong>权限问题</strong>：安装和运行可能需要管理员/root权限（如安装到 <code>/usr/local/bin</code>）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">系统安装</h3>
<p>goose 提供多种安装方式，你可以根据操作系统和偏好选择最合适的一种。</p>
<h4 data-id="heading-5">方案一：使用官方安装脚本（推荐，适用于所有主流系统）</h4>
<p>这是最简单快捷的方式，脚本会自动检测系统并下载对应的预编译二进制文件。</p>
<ol>
<li>
<p><strong>打开终端</strong> (Windows 可使用 PowerShell, CMD, 或 WSL终端)。</p>
</li>
<li>
<p><strong>执行安装命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载并运行安装脚本</span>
$ curl -fsSL https://github.com/block/goose/releases/download/stable/download_cli.sh | bash
</code></pre>
<p><strong>脚本行为说明</strong>：</p>
<ul>
<li>自动检测你的操作系统（Linux, macOS, Windows）和架构（x86_64, arm64）。</li>
<li>默认将 <code>goose</code> 二进制下载到 <code>$HOME/.local/bin/</code> 目录（Windows 为 <code>%USERPROFILE%\goose</code>）。</li>
<li>安装完成后，会尝试引导你进行首次配置（可跳过，后续手动进行）。</li>
</ul>
</li>
<li>
<p><strong>将 goose 添加到 PATH</strong>（如果脚本提示）：
安装后，如果终端提示 <code>GOOSE_BIN_DIR</code> 不在 PATH 中，你需要手动添加。</p>
<ul>
<li><strong>Linux/macOS</strong>：将以下行添加到 <code>~/.bashrc</code>, <code>~/.zshrc</code> 或你所用 shell 的配置文件中。
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.local/bin:<span class="hljs-variable">$PATH</span>"</span>
</code></pre>
然后执行 <code>source ~/.bashrc</code>（或对应配置文件）使其生效。</li>
<li><strong>Windows (PowerShell)</strong>：将以下行添加到 <code>$PROFILE</code> 文件中。
<pre><code class="hljs language-powershell" lang="powershell">$env:Path = "$env:USERPROFILE\goose;" + $env:Path
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>验证安装</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ goose --version
</code></pre>
<p>如果成功，将显示类似 <code>goose 1.21.0</code> 的版本信息。</p>
</li>
</ol>
<h4 data-id="heading-6">方案二：使用 Docker（适合容器化环境）</h4>
<p>如果你熟悉 Docker，这是保持环境纯净的好方法。项目提供了官方的 Docker 镜像。</p>
<ol>
<li>
<p><strong>拉取 goose 镜像</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ docker pull ghcr.io/block/goose:latest
</code></pre>
</li>
<li>
<p><strong>运行 goose 容器</strong>（基础命令）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 以交互模式运行，并挂载当前目录到容器内以便 goose 操作文件</span>
$ docker run -it --<span class="hljs-built_in">rm</span> -v $(<span class="hljs-built_in">pwd</span>):/home/goose/workspace ghcr.io/block/goose:latest
<span class="hljs-comment"># 获取帮助</span>
$ docker run --<span class="hljs-built_in">rm</span> ghcr.io/block/goose:latest --<span class="hljs-built_in">help</span>
</code></pre>
<p><strong>注意</strong>：Docker 方式主要运行 CLI。如需桌面应用或更复杂的集成，建议使用其他安装方式。</p>
</li>
</ol>
<h4 data-id="heading-7">方案三：桌面应用程序（适合偏好图形界面的用户）</h4>
<p>如果你不想使用命令行，可以直接下载并运行桌面应用。</p>
<ol>
<li><strong>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fblock%2Fgoose%2Freleases" target="_blank" title="https://github.com/block/goose/releases" ref="nofollow noopener noreferrer">GitHub Releases</a></strong> 页面。</li>
<li>找到最新的版本，在“Assets”部分下载对应你系统的安装包：
<ul>
<li><strong>macOS</strong>: <code>.dmg</code> 文件 (Apple Silicon 或 Intel)</li>
<li><strong>Windows</strong>: <code>.exe</code> 安装程序或 <code>.zip</code> 压缩包</li>
<li><strong>Linux</strong>: <code>.AppImage</code>, <code>.deb</code>, 或 <code>.rpm</code> 文件</li>
</ul>
</li>
<li>像安装普通软件一样完成安装并启动。</li>
</ol>
<h4 data-id="heading-8">方案四：从源代码构建（适合开发者或定制需求）</h4>
<p>此方式要求已安装 Rust 工具链。</p>
<ol>
<li>
<p><strong>安装 Rust</strong> (如未安装):</p>
<pre><code class="hljs language-bash" lang="bash">$ curl --proto <span class="hljs-string">'=https'</span> --tlsv1.2 -sSf https://sh.rustup.rs | sh
$ <span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.cargo/env
</code></pre>
</li>
<li>
<p><strong>克隆仓库并构建</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">$ git <span class="hljs-built_in">clone</span> https://github.com/block/goose.git
$ <span class="hljs-built_in">cd</span> goose
<span class="hljs-comment"># 构建 CLI</span>
$ cargo build --release --package goose-cli
<span class="hljs-comment"># 构建完成后，二进制位于 target/release/goose</span>
$ <span class="hljs-built_in">cp</span> target/release/goose ~/.local/bin/  <span class="hljs-comment"># 或其它 PATH 目录</span>
</code></pre>
</li>
</ol>
<p><strong>安装后验证</strong>：无论采用哪种方式，都请执行 <code>goose --version</code> 或启动桌面应用，确认安装成功。</p>
<h3 data-id="heading-9">首次配置与运行</h3>
<p>首次运行 goose 需要进行基础配置，主要是设置 AI 模型。</p>
<h4 data-id="heading-10">1. 启动配置向导</h4>
<p>在终端中执行：</p>
<pre><code class="hljs language-bash" lang="bash">$ goose configure
</code></pre>
<p>此命令将启动一个交互式配置向导。</p>
<h4 data-id="heading-11">2. 核心配置步骤</h4>
<p>向导会引导你完成以下关键设置：</p>
<ul>
<li>
<p><strong>选择 Provider (模型提供商)</strong>：
你会看到如 <code>databricks</code>、<code>openai</code> 等选项。这取决于你想要使用的 AI 服务。</p>
<ul>
<li>如果你使用 <strong>OpenAI</strong> 的模型（如 GPT-4），选择 <code>openai</code>。</li>
<li>如果你使用 <strong>Databricks</strong> 提供的模型（项目示例中提到的 <code>goose</code> 模型），选择 <code>databricks</code>。</li>
<li>其他选项对应其他支持的模型服务。</li>
</ul>
</li>
<li>
<p><strong>配置 API 密钥</strong>：
选择 Provider 后，系统会提示你输入相应的 <strong>API 密钥</strong>。</p>
<ul>
<li>对于 OpenAI：你需要一个有效的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fapi-keys" target="_blank" title="https://platform.openai.com/api-keys" ref="nofollow noopener noreferrer">OpenAI API Key</a>。</li>
<li>对于 Databricks：你需要配置 Databricks 主机和令牌。</li>
<li><strong>安全提示</strong>：API 密钥是敏感信息，请妥善保管。goose 会将其加密存储在本地配置文件中（通常位于 <code>~/.config/goose/config.toml</code>）。</li>
</ul>
</li>
<li>
<p><strong>选择模型</strong>：
根据上一步选择的 Provider，系统会列出可用的模型（例如 <code>gpt-4o</code>, <code>gpt-4-turbo</code>, <code>claude-3-5-sonnet</code> 或 <code>databricks</code> 特定的模型名）。选择你想使用的模型。</p>
</li>
<li>
<p><strong>工作目录设置</strong>：
配置 goose 操作文件的默认目录。可以保持默认（当前用户目录），或指定一个专用路径。</p>
</li>
</ul>
<h4 data-id="heading-12">3. 配置完成与快速测试</h4>
<p>配置完成后，你可以通过一个简单命令测试 goose 是否工作正常：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 向 goose 发送一个简单指令</span>
$ goose run <span class="hljs-string">"请用当前目录下的文件名创建一个 Markdown 列表"</span>
</code></pre>
<p>如果配置正确，goose 会列出当前目录的文件。你可能会看到它调用了相关工具（如 <code>developer</code> 扩展）来完成此任务。</p>
<h4 data-id="heading-13">4. （可选）启动桌面应用</h4>
<p>如果你安装了桌面版，首次启动时，应用界面内通常也会有类似的配置流程，引导你输入 Provider 和 API Key。</p>
<h3 data-id="heading-14">常用指令大全</h3>
<p>掌握以下核心命令将帮助你高效使用 goose CLI。</p>
<h4 data-id="heading-15">基础命令</h4>






























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose --version</code></td><td align="left">查看版本信息。</td><td align="left"><code>$ goose --version</code></td></tr><tr><td align="left"><code>goose --help</code></td><td align="left">查看全局帮助。</td><td align="left"><code>$ goose --help</code></td></tr><tr><td align="left"><code>goose configure</code></td><td align="left">交互式配置向导。</td><td align="left"><code>$ goose configure</code></td></tr><tr><td align="left"><code>goose doctor</code></td><td align="left">运行诊断，检查系统环境和配置。</td><td align="left"><code>$ goose doctor</code></td></tr></tbody></table>
<h4 data-id="heading-16">任务执行命令</h4>

























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose run &lt;指令&gt;</code></td><td align="left">执行单条自然语言指令。</td><td align="left"><code>$ goose run "创建一个简单的Python HTTP服务器"</code></td></tr><tr><td align="left"><code>goose chat</code></td><td align="left">进入交互式对话模式。</td><td align="left"><code>$ goose chat</code></td></tr><tr><td align="left"><code>goose cook &lt;recipe文件&gt;</code></td><td align="left">执行一个预定义的“食谱”任务。</td><td align="left"><code>$ goose cook recipe.yaml</code></td></tr></tbody></table>
<h4 data-id="heading-17">扩展管理命令</h4>

























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose extensions list</code></td><td align="left">列出已安装和可用的扩展。</td><td align="left"><code>$ goose extensions list</code></td></tr><tr><td align="left"><code>goose extensions add &lt;名称&gt;</code></td><td align="left">安装一个新扩展。</td><td align="left"><code>$ goose extensions add fetch</code></td></tr><tr><td align="left"><code>goose extensions remove &lt;名称&gt;</code></td><td align="left">移除一个扩展。</td><td align="left"><code>$ goose extensions remove fetch</code></td></tr></tbody></table>
<h4 data-id="heading-18">会话与日志命令</h4>




















<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose sessions list</code></td><td align="left">列出历史会话。</td><td align="left"><code>$ goose sessions list</code></td></tr><tr><td align="left"><code>goose logs</code></td><td align="left">查看 goose 的运行日志（需指定日志路径，通常在配置中）。</td><td align="left"><code>$ tail -f ~/.config/goose/logs/goose.log</code></td></tr></tbody></table>
<h4 data-id="heading-19">服务器命令（用于高级集成）</h4>

























<table><thead><tr><th align="left">命令</th><th align="left">说明</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><code>goose server start</code></td><td align="left">启动 goose 的本地 API 服务器。</td><td align="left"><code>$ goose server start --port 3001</code></td></tr><tr><td align="left"><code>goose server stop</code></td><td align="left">停止本地 API 服务器。</td><td align="left"><code>$ goose server stop</code></td></tr><tr><td align="left"><code>goose server status</code></td><td align="left">查看服务器状态。</td><td align="left"><code>$ goose server status</code></td></tr></tbody></table>
<h3 data-id="heading-20">通过示例快速体验</h3>
<p>理论不如实践。让我们通过运行一个内置的“食谱”来直观感受 goose 的能力。我们将执行 <code>recipe.yaml</code> 中描述的 <code>404Portfolio</code> 任务。</p>
<ol>
<li>
<p><strong>准备 recipe 文件</strong>：
将项目中的 <code>recipe.yaml</code> 内容保存为一个文件，例如 <code>404recipe.yaml</code>，放在你的工作目录。</p>
</li>
<li>
<p><strong>执行食谱任务</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ goose cook ./404recipe.yaml
</code></pre>
</li>
<li>
<p><strong>与 goose 交互</strong>：
命令执行后，goose 会开始处理这个复杂任务。它会：</p>
<ul>
<li>理解任务目标：创建一个基于用户公开资料的个性化 404 页面。</li>
<li><strong>向你提问</strong>：首先，它会询问你使用哪个平台（GitHub, Dev.to, Bluesky）及对应的用户名。</li>
<li><strong>自主执行</strong>：根据你的回答，它会调用内置的 <code>developer</code> 扩展来创建目录和文件，并可能调用 <code>fetch</code> 等扩展（如果已安装）去获取公开API数据。</li>
<li><strong>编写代码</strong>：最终，它会在一个名为 <code>404-story</code> 的文件夹中生成一个完整的、包含 HTML、CSS、JavaScript 的静态网站。</li>
</ul>
</li>
<li>
<p><strong>查看结果</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ <span class="hljs-built_in">ls</span> -la ./404-story/
$ open ./404-story/index.html  <span class="hljs-comment"># 在macOS中打开</span>
<span class="hljs-comment"># 或</span>
$ start ./404-story/index.html <span class="hljs-comment"># 在Windows中打开</span>
</code></pre>
</li>
</ol>
<p>这个例子展示了 goose 如何将高层次的需求分解为一系列具体操作（提问、获取数据、编写代码、组织文件），并自主完成。</p>
<h3 data-id="heading-21">日常维护</h3>
<ol>
<li>
<p><strong>检查更新</strong>：
goose 项目迭代较快。定期查看 GitHub Releases 页面，或使用桌面应用内的更新检查功能（如有）。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 对于 CLI，重新运行安装脚本通常可以更新到最新稳定版</span>
$ curl -fsSL https://github.com/block/goose/releases/download/stable/download_cli.sh | bash
</code></pre>
</li>
<li>
<p><strong>管理配置</strong>：
配置文件通常位于 <code>~/.config/goose/config.toml</code>。你可以手动编辑它，但建议使用 <code>goose configure</code> 命令修改主要设置。</p>
</li>
<li>
<p><strong>清理缓存</strong>：
扩展和模型可能会产生缓存。缓存目录通常也在配置文件夹下（<code>~/.cache/goose/</code>）。定期清理可以释放磁盘空间。</p>
</li>
<li>
<p><strong>日志管理</strong>：
遇到问题时，日志是第一手资料。默认日志路径在 <code>~/.config/goose/logs/</code>。你可以配置日志级别（如 <code>RUST_LOG=debug</code>）来获取更详细的信息。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 以调试模式运行并查看输出</span>
$ RUST_LOG=debug goose run <span class="hljs-string">"你的指令"</span> 2&gt;&amp;1 | less
</code></pre>
</li>
</ol>
<h3 data-id="heading-22">故障排除</h3>
<p><strong>问题：命令未找到 (<code>command not found: goose</code>)</strong></p>
<ul>
<li><strong>原因</strong>：<code>goose</code> 二进制所在目录未加入系统 PATH。</li>
<li><strong>解决</strong>：参考 <a href="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85" title="#%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85">系统安装</a> 章节，将 <code>$HOME/.local/bin</code>（或你自定义的目录）添加到 shell 的 PATH 环境变量中。</li>
</ul>
<p><strong>问题：配置 API 密钥后，运行任务失败，提示认证错误</strong></p>
<ul>
<li><strong>原因</strong>：API 密钥无效、过期，或网络无法访问对应服务商。</li>
<li><strong>解决</strong>：
<ol>
<li>重新在对应服务商平台检查并复制正确的 API 密钥。</li>
<li>运行 <code>goose configure</code> 重新配置。</li>
<li>检查网络连接和代理设置。</li>
<li>运行 <code>goose doctor</code> 查看更详细的错误信息。</li>
</ol>
</li>
</ul>
<p><strong>问题：执行文件操作或 Shell 命令时权限被拒绝</strong></p>
<ul>
<li><strong>原因</strong>：goose 进程权限不足以访问目标目录或执行命令。</li>
<li><strong>解决</strong>：
<ol>
<li>确保工作目录路径正确且 goose 有读写权限。</li>
<li>在 Linux/macOS 下，避免在 <code>/root</code> 或 <code>/etc</code> 等系统目录下直接操作，建议在用户目录内进行。</li>
<li>检查是否有防病毒软件或沙盒机制阻止了 goose 的操作。</li>
</ol>
</li>
</ul>
<p><strong>问题：桌面应用启动失败或崩溃</strong></p>
<ul>
<li><strong>原因</strong>：可能是缺少运行时依赖，或与系统图形环境不兼容。</li>
<li><strong>解决</strong>：
<ol>
<li>确保系统已安装必要的图形库（如 Linux 下的 <code>libgtk</code> 系列）。</li>
<li>尝试以命令行启动桌面应用（如果支持），查看错误输出。</li>
<li>查看应用日志（通常可在 <code>~/.config/Goose/logs/</code> 找到）。</li>
<li>考虑使用 CLI 版本作为替代。</li>
</ol>
</li>
</ul>
<p><strong>通用诊断流程</strong>：</p>
<ol>
<li><strong>运行 <code>goose doctor</code></strong>：这是内置的诊断工具，能检查核心配置和依赖。</li>
<li><strong>检查日志</strong>：查看详细错误信息。</li>
<li><strong>简化复现</strong>：尝试一个最简单的指令（如 <code>goose run "echo hello"</code>）是否能成功。</li>
<li><strong>查阅社区</strong>：前往 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2Fgoose-oss" target="_blank" title="https://discord.gg/goose-oss" ref="nofollow noopener noreferrer">Discord</a> 或 GitHub Issues 搜索类似问题。</li>
</ol>
<h3 data-id="heading-23">进阶配置</h3>
<p>goose 的配置文件 (<code>~/.config/goose/config.toml</code>) 支持更精细的调整。以下是一个配置示例片段及其说明：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[agent]</span>
<span class="hljs-comment"># 默认使用的模型提供商和模型</span>
<span class="hljs-attr">provider</span> = <span class="hljs-string">"openai"</span>
<span class="hljs-attr">model</span> = <span class="hljs-string">"gpt-4o"</span>

<span class="hljs-comment"># 工作目录</span>
<span class="hljs-attr">working_dir</span> = <span class="hljs-string">"/Users/yourname/Projects"</span>

<span class="hljs-section">[agent.openai]</span>
<span class="hljs-comment"># OpenAI 特定的配置</span>
<span class="hljs-attr">api_key</span> = <span class="hljs-string">"sk-..."</span> <span class="hljs-comment"># 建议通过 configure 设置，这里会自动填充</span>
<span class="hljs-attr">base_url</span> = <span class="hljs-string">"https://api.openai.com/v1"</span> <span class="hljs-comment"># 可指向自定义端点</span>

<span class="hljs-section">[extensions]</span>
<span class="hljs-comment"># 自动启用的内置扩展</span>
<span class="hljs-attr">enabled</span> = [<span class="hljs-string">"developer"</span>, <span class="hljs-string">"computercontroller"</span>]

<span class="hljs-comment"># 自定义扩展配置</span>
<span class="hljs-section">[[extensions.custom]]</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"my_mcp_tool"</span>
<span class="hljs-attr">type</span> = <span class="hljs-string">"stdio"</span> <span class="hljs-comment"># 通过标准输入输出通信</span>
<span class="hljs-attr">cmd</span> = <span class="hljs-string">"uvx"</span>    <span class="hljs-comment"># 使用 uvx 工具运行</span>
<span class="hljs-attr">args</span> = [<span class="hljs-string">"my-mcp-server"</span>] <span class="hljs-comment"># 服务器命令</span>
</code></pre>
<p><strong>适用场景</strong>：</p>
<ul>
<li><strong>多模型切换</strong>：你可以创建多个配置节，通过环境变量或命令行参数快速切换。</li>
<li><strong>自定义 MCP 服务器</strong>：集成自己编写的或第三方的 MCP 服务器以扩展 goose 的工具集。</li>
<li><strong>网络与代理</strong>：在配置中指定代理服务器地址。</li>
</ul>
<h3 data-id="heading-24">常见问题</h3>
<p><strong>Q：goose 会把我本地的代码上传到云端吗？</strong>
A：<strong>不会。</strong> goose 是一个本地优先的框架。代码、文件操作都在你的机器上完成。只有为了理解指令和生成计划，你选择的 <strong>LLM 提供商（如 OpenAI）会收到相关的文本提示</strong>。API 密钥和模型调用是你的直接交互。务必阅读并理解你所选模型提供商的数据使用政策。</p>
<p><strong>Q：支持哪些编程语言和框架？</strong>
A：goose 不限于特定语言。它的能力取决于其集成的工具（扩展）和背后 LLM 的知识。内置的 <code>developer</code> 扩展可以操作任何文本文件，因此理论上可以处理任何语言的代码。对于特定框架的深度支持，需要相应的扩展或 LLM 具备相关知识。</p>
<p><strong>Q：运行 goose 成本高吗？</strong>
A：成本主要来自你使用的 <strong>云端 LLM API 调用</strong>（如 OpenAI, Anthropic）。goose 本身是免费开源的。你可以通过以下方式控制成本：
- 使用更经济的模型（如 <code>gpt-4o-mini</code> 而非 <code>gpt-4o</code>）。
- 在配置中设置使用限制。
- 对于简单任务，考虑使用本地开源模型（需要额外配置兼容的 MCP 服务器）。</p>
<p><strong>Q：如何为 goose 开发扩展？</strong>
A：goose 通过 <strong>Model Context Protocol (MCP)</strong> 集成扩展。你可以遵循 MCP 协议开发任何语言编写的服务器，并通过配置文件将其添加为 <code>stdio</code> 类型的扩展。参考 <code>rmpc</code> crate 和 MCP 官方文档进行开发。</p>
<p><strong>Q：<code>goose run</code> 和 <code>goose chat</code> 有什么区别？</strong>
A：<code>goose run</code> 是<strong>单次指令执行</strong>模式，适合明确的、独立的任务。<code>goose chat</code> 是<strong>交互式会话</strong>模式，会保留对话历史上下文，适合需要多轮讨论、调试或探索的复杂任务。</p>
<h3 data-id="heading-25">资源链接与快速参考卡</h3>
<p><strong>官方资源</strong>：</p>
<ul>
<li><strong>GitHub 仓库</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fblock%2Fgoose" target="_blank" title="https://github.com/block/goose" ref="nofollow noopener noreferrer">github.com/block/goose</a> (代码、Issues、Releases)</li>
<li><strong>官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblock.github.io%2Fgoose%2Fdocs" target="_blank" title="https://block.github.io/goose/docs" ref="nofollow noopener noreferrer">block.github.io/goose/docs</a></li>
<li><strong>Discord 社区</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2Fgoose-oss" target="_blank" title="https://discord.gg/goose-oss" ref="nofollow noopener noreferrer">discord.gg/goose-oss</a> (获取实时帮助和交流)</li>
<li><strong>项目官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoose.blocks" target="_blank" title="https://goose.blocks" ref="nofollow noopener noreferrer">goose.blocks</a> (如有)</li>
</ul>
<p><strong>快速参考卡 (Cheatsheet)</strong>：</p>













































<table><thead><tr><th align="left">场景</th><th align="left">核心命令</th></tr></thead><tbody><tr><td align="left"><strong>安装与更新</strong></td><td align="left"><code>curl -fsSL ...download_cli.sh | bash</code></td></tr><tr><td align="left"><strong>首次配置</strong></td><td align="left"><code>goose configure</code></td></tr><tr><td align="left"><strong>执行一个任务</strong></td><td align="left"><code>goose run “你的指令”</code></td></tr><tr><td align="left"><strong>交互式对话</strong></td><td align="left"><code>goose chat</code></td></tr><tr><td align="left"><strong>运行食谱</strong></td><td align="left"><code>goose cook recipe.yaml</code></td></tr><tr><td align="left"><strong>列出扩展</strong></td><td align="left"><code>goose extensions list</code></td></tr><tr><td align="left"><strong>启动API服务</strong></td><td align="left"><code>goose server start --port 3001</code></td></tr><tr><td align="left"><strong>查看版本</strong></td><td align="left"><code>goose --version</code></td></tr><tr><td align="left"><strong>诊断问题</strong></td><td align="left"><code>goose doctor</code></td></tr></tbody></table>
<p><strong>反馈与贡献</strong>：</p>
<ul>
<li>发现 bug 或有功能建议？请在 GitHub Issues 创建。</li>
<li>想贡献代码？请阅读仓库中的 <code>CONTRIBUTING.md</code>（如有）和 <code>GOVERNANCE.md</code> 文件。</li>
<li>翻译或文档改进也是宝贵的贡献。</li>
</ul>
<hr/>
<p><strong>祝你使用 goose 开发愉快，提升工程效率！</strong> 🦢</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot]]></title>    <link>https://juejin.cn/post/7601175299011444751</link>    <guid>https://juejin.cn/post/7601175299011444751</guid>    <pubDate>2026-02-01T09:20:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601175299011444751" data-draft-id="7595831648825016360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2026-02-01T09:20:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="郡杰"/> <meta itemprop="url" content="https://juejin.cn/user/1823423934236172"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1823423934236172/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    郡杰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:20:30.000Z" title="Sun Feb 01 2026 09:20:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读43分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpringBoot 简介</h2>
<p><strong>SpringBoot</strong> 是由 Pivotal 团队提供的全新框架，其设计目的是为了<strong>简化</strong> Spring 应用的<strong>初始搭建</strong>与<strong>开发过程</strong>。</p>
<p>Spring 框架本身已经在一定程度上简化了 Java 企业级开发，而 SpringBoot 则是在此基础上进一步简化。由此可见，SpringBoot 旨在追求极致的开发简便性与广泛适用性。</p>
<p>为了理解 SpringBoot 带来的简化，我们可以先回顾一下传统 SpringMVC 应用的开发流程：</p>
<ol>
<li><strong>创建工程，并在 <code>pom.xml</code> 配置文件中配置所依赖的坐标</strong></li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring MVC --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Servlet API --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${servlet-api.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<ul>
<li>需要手动创建 Maven 工程。</li>
<li>在 <code>pom.xml</code> 中精确配置 SpringMVC、Servlet API 等相关依赖的坐标，并处理可能的版本兼容性问题。</li>
</ul>
<ol start="2">
<li><strong>编写 <code>web3.0</code> 的配置类</strong></li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 这是Spring 3.2+提供的更高级别的抽象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServletConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() {
        <span class="hljs-comment">// 返回Spring根容器的配置类（用于Service、DAO等非Web组件）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{SpringConfig.class};
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() {
        <span class="hljs-comment">// 返回SpringMVC的配置类（用于Controller等Web组件）</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{SpringMvcConfig.class};
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> String[] getServletMappings() {
        <span class="hljs-comment">// 配置DispatcherServlet的映射路径</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{<span class="hljs-string">"/"</span>};
    }
    <span class="hljs-comment">// 还可以重写其他方法进行更多配置</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Filter[] getServletFilters() {
        <span class="hljs-comment">// 添加过滤器</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Filter</span>[]{<span class="hljs-keyword">new</span> <span class="hljs-title class_">CharacterEncodingFilter</span>(<span class="hljs-string">"UTF-8"</span>)};
    }
}
</code></pre>
<ul>
<li>需要编写一个类来实现 <code>WebApplicationInitializer</code> 接口，用于替代传统的 <code>web.xml</code> 文件。</li>
<li>在此类中，需手动注册 Spring 的 <code>DispatcherServlet</code>，并指定配置文件位置、URL 映射等，代码较为模板化且繁琐。</li>
</ul>
<ol start="3">
<li><strong>编写 SpringMVC 配置类</strong></li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebMvc</span>  <span class="hljs-comment">// 启用Spring MVC</span>
<span class="hljs-meta">@ComponentScan("com.example.controller")</span>  <span class="hljs-comment">// 扫描控制器组件</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringMvcConfig</span> {
}
</code></pre>
<ul>
<li>需要创建配置类（使用 <code>@Configuration</code> 注解）。</li>
<li>在该类中启用 MVC 注解驱动（<code>@EnableWebMvc</code>）、配置视图解析器、静态资源处理等组件。这仅完成了应用程序基础框架的搭建。</li>
</ul>
<ol start="4">
<li><strong>编写业务 Controller</strong></li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@RestController</span>  <span class="hljs-comment">// 声明这是一个REST风格的控制器，所有方法返回JSON数据</span>
<span class="hljs-meta">@RequestMapping("/books")</span>  <span class="hljs-comment">// 定义该类所有请求的基础路径为"/books"</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {
    <span class="hljs-meta">@Autowired</span>   <span class="hljs-comment">// 自动注入BookService实例</span>
    <span class="hljs-keyword">private</span> BookService bookService;
    
    <span class="hljs-comment">// 处理HTTP GET请求，路径为"/books/{id}"</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-comment">// 定义查询方法，参数id来自URL路径</span>
    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 调用业务层方法，根据id查询书籍信息</span>
        <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> bookService.getById(id);
        <span class="hljs-comment">// 根据查询结果设置状态码：成功或失败</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> book != <span class="hljs-literal">null</span> ? Code.GET_OK : Code.GET_ERR;
        <span class="hljs-comment">// 根据查询结果设置消息：成功时为空，失败时显示错误信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> book != <span class="hljs-literal">null</span> ? <span class="hljs-string">""</span> : <span class="hljs-string">"数据查询失败，请重试！"</span>;
        <span class="hljs-comment">// 返回统一格式的结果对象，包含状态码、数据和消息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>(code, book, msg);
    }
}
</code></pre>
<ul>
<li>至此，才能开始编写真正的业务逻辑，例如提供一个简单的 <code>Controller</code> 类和请求处理方法。</li>
</ul>
<p>从以上流程可以看出，步骤 1 到 3 主要集中于<strong>环境搭建和配置</strong>，这些步骤相对固定且重复。SpringBoot 的核心价值正是为了<strong>自动化这些初始配置步骤</strong>，让开发者能更专注于业务代码的编写。</p>
<p>接下来，我们将通过一个入门案例来具体展示 SpringBoot 是如何极大地简化 Spring 应用开发的。</p>
<h3 data-id="heading-1">SpringBoot 快速入门</h3>
<h4 data-id="heading-2">开发步骤</h4>
<p><code>SpringBoot</code> 开发起来特别简单，分为如下几步：</p>
<ol>
<li><strong>创建新模块</strong>，选择 Spring Initializr，并配置模块相关基础信息</li>
<li><strong>选择当前模块需要使用的技术集</strong></li>
<li><strong>开发控制器类</strong></li>
<li><strong>运行自动生成的 Application 类</strong></li>
</ol>
<p>接下来我们进行具体的操作。</p>
<h5 data-id="heading-3">1. 创建新模块</h5>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p><strong>配置项目基本信息</strong><br/>
到 <strong><code>新建项目</code></strong> 界面，在 <strong><code>生成器</code></strong> 栏找到并点击 <strong><code>Spring Boot</code></strong> ，填写 <strong><code>名称</code></strong>、<strong><code>项目文件位置</code></strong>，选择 <strong><code>类型：Maven</code></strong>、<strong><code>打包：Jar</code></strong>。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e73c30deea454aa4847be4845ece37f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=wBi%2Bfd793ueSGjmUY392BzxaFgU%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong><code>类型：Maven</code></strong>、<strong><code>打包：Jar</code></strong> 选择理由</p>
<ul>
<li>我们使用这种方式构建的 <code>SpringBoot</code> 工程其实也是 <code>Maven</code> 工程，而该方式只是一种快速构建的方式</li>
<li>打包方式这里需要设置为 <code>Jar</code>（这是 SpringBoot 的默认打包方式，不同于传统的 war 包）</li>
</ul>
</blockquote>
</li>
<li>
<p><strong>选择依赖</strong><br/>
找到 <strong><code>依赖项</code></strong> - <strong><code>Web</code></strong> - <strong><code>Spring Web</code></strong>，并勾选。Spring Boot版本按需选择。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dfa8dc6d1a40549c3d825bdd4ec65f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=fqpbTa6ErrOxhg25U82R4Rpqo3o%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong>理解</strong>：<br/>
由于我们需要开发一个 <code>web</code> 程序，使用到了 <code>SpringMVC</code> 技术，所以需要勾选 <code>Spring Web</code> 依赖<br/>
这些依赖相当于我们传统 Maven 项目中的 pom.xml 依赖配置，但 Spring Initializr 帮我们自动添加了</p>
</blockquote>
</li>
<li>
<p><strong>完成创建</strong><br/>
经过以上步骤后会创建如下结构的模块：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4818d64d7a449de8e16c499bd906334~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=DeDP8o6q6KQWG%2Bne%2FmmFvd2%2BLn4%3D" alt="image.png" width="50%" loading="lazy"/></p>
</li>
</ol>
<blockquote>
<p>为方便后续学习，项目结构保持与资料基本一致，图中的包名、java类名经过重命名。重命名后直接运行失败，执行 “构建-构建项目Build Project”后解决，运行按钮旁出现两个 Application，删除旧的绿色无效配置</p>
</blockquote>
<blockquote>
<p><strong>清理建议</strong>：</p>
<p>创建好的项目会自动生成一些文件，这些文件目前对我们学习来说不是必需的，可以删除以下目录和文件以保持项目简洁：</p>
<ul>
<li><code>.mvn/</code> 目录（Maven 包装器相关，如果不需要跨环境一致可以删除）</li>
<li><code>.gitignore</code> 文件（如果要使用 Git 管理，建议保留）</li>
<li><code>HELP.md</code> 文件</li>
<li><code>mvnw</code> 和 <code>mvnw.cmd</code> 文件（Maven 包装器脚本）</li>
</ul>
</blockquote>
<h5 data-id="heading-4">2. 创建 Controller</h5>
<p>在 <code>com.itheima</code> 包下创建<code>controller</code>包，再在其中创建 <code>BookController.java</code> 类，代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * BookController - 书籍控制器类
 * 
 * 这个类演示了 SpringBoot 中 RESTful API 的基本写法
 * 
 * 知识点讲解：
 * 1. <span class="hljs-doctag">@RestController</span>：表示这是一个控制器类，方法的返回值直接作为 HTTP 响应体，而不是视图名称
 *    因此，所有方法的返回值都会自动转换为 JSON 格式
 * 
 * 2. <span class="hljs-doctag">@RequestMapping</span>("/books")：类级别的映射注解
 *    - 指定这个控制器处理以 "/books" 开头的所有请求
 *    - 这个路径会与方法的映射路径拼接起来，形成完整的 URL
 * 
 * 3. <span class="hljs-doctag">@GetMapping</span>("/{id}")：方法级别的映射注解
 *    - 表示这个方法处理 HTTP GET 请求
 *    - "/{id}" 是路径变量，用 {} 括起来的部分表示这是一个可变部分
 *    - 完整的访问路径是：GET http://localhost:8080/books/{id}
 * 
 * 4. <span class="hljs-doctag">@PathVariable</span> Integer id：路径变量绑定
 *    - 将 URL 中的 {id} 部分绑定到方法的参数 id 上
 *    - 参数名必须与 <span class="hljs-doctag">@PathVariable</span> 中的变量名一致（如果省略参数名，需要确保变量名与占位符名称一致）
 */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">/**
     * 根据ID获取书籍信息
     * 
     * 示例：访问 http://localhost:8080/books/1
     * - 会匹配到这个方法
     * - id 参数会获取到 1
     * - 方法返回的字符串会直接作为 HTTP 响应体
     * 
     * <span class="hljs-doctag">@param</span> id 书籍ID，从URL路径中获取
     * <span class="hljs-doctag">@return</span> 返回一个简单的字符串（实际项目中通常会返回对象或JSON）
     */</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 在实际项目中，这里通常会调用Service层获取数据</span>
        <span class="hljs-comment">// 例如：Book book = bookService.getById(id);</span>
        <span class="hljs-comment">// 返回：return book;</span>
        
        System.out.println(<span class="hljs-string">"id ==&gt; "</span> + id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<p><strong>创建控制器类步骤</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 第一步：导入必要的注解</span>
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-comment">// 第二步：添加 @RestController 注解</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-comment">// 第三步：添加 @RequestMapping 定义基础路径（可选）</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {
    
    <span class="hljs-comment">// 第四步：编写处理请求的方法</span>
    <span class="hljs-comment">// 示例1：GET请求，带路径参数</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ID: "</span> + id;
    }
    
    <span class="hljs-comment">// 示例2：GET请求，不带参数</span>
    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAll</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"所有数据"</span>;
    }
    
    <span class="hljs-comment">// 示例3：POST请求</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Book book)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"创建成功"</span>;
    }
}
</code></pre>
<blockquote>
<p><strong>常见映射注解</strong>：</p>
<ul>
<li><code>@GetMapping</code> - 处理 GET 请求</li>
<li><code>@PostMapping</code> - 处理 POST 请求</li>
<li><code>@PutMapping</code> - 处理 PUT 请求</li>
<li><code>@DeleteMapping</code> - 处理 DELETE 请求</li>
<li><code>@PatchMapping</code> - 处理 PATCH 请求</li>
</ul>
</blockquote>
<h5 data-id="heading-5">3. 启动服务器</h5>
<p>运行 SpringBoot 工程不需要使用本地的 Tomcat 和插件，只需运行项目 <code>com.itheima</code> 包下的 <code>Application</code> 类。  运行后控制台会显示类似以下信息：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06bce97193b1433386d557ec9463941a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=0zQ4EVsH3WOFf4L4MrhkEWU7p5U%3D" alt="image.png" width="100%" loading="lazy"/>
<blockquote>
<p><strong>关键信息解读：</strong></p>
<ol>
<li><strong><code>Tomcat initialized with port(s): 8080 (http)</code></strong> - 内嵌的 Tomcat 服务器已启动，监听 8080 端口</li>
<li><strong><code>Started Application in 1.168 seconds</code></strong> - 应用启动耗时 1.168 秒</li>
<li><strong><code>with context path '/'</code></strong> - 应用上下文路径为空，表示根路径</li>
</ol>
<p><strong>与传统的 Spring MVC 对比：</strong></p>

























<table><thead><tr><th>传统 Spring MVC</th><th>SpringBoot</th></tr></thead><tbody><tr><td>需要外部 Tomcat</td><td>内嵌 Tomcat，无需安装配置</td></tr><tr><td>需要 web.xml 配置</td><td>零 XML 配置</td></tr><tr><td>需要手动配置 DispatcherServlet</td><td>自动配置</td></tr><tr><td>部署时需要打 war 包</td><td>可执行 jar 包，直接运行</td></tr></tbody></table>
</blockquote>
<h5 data-id="heading-6">4. 进行测试</h5>
<p>使用 Postman 工具来测试我们的程序：</p>
<p><strong>Postman 测试步骤：</strong></p>
<ol>
<li><strong>打开 Postman</strong>：如果没有安装，可以从官网下载</li>
<li><strong>创建新请求</strong>：
<ul>
<li>请求方法：GET</li>
<li>请求 URL：<code>http://localhost:8080/books/1</code></li>
</ul>
</li>
<li><strong>发送请求</strong>：点击 Send 按钮</li>
<li><strong>查看响应</strong>：在响应体部分应该看到 <code>hello, spring boot!</code></li>
</ol>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e01f0b5c2614e65aeb12f9e3e68348e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=wQDF1HoELI0RjcdSZfrCQ9xS%2FGg%3D" alt="image.png" width="100%" loading="lazy"/>
<p>通过上面的入门案例我们可以看到使用 SpringBoot 进行开发，使整个开发变得很简单，那它是如何做到的呢？<br/>
要研究这个问题，我们需要看看 <code>Application</code> 类和 <code>pom.xml</code> 都书写了什么：</p>
<p><strong>Application 类分析：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 导入必要的包</span>
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-comment">/**
 * SpringBoot 应用的主启动类
 * 
 * 这个类是整个应用的入口点，也是 SpringBoot 应用的核心
 * 
 * <span class="hljs-doctag">@SpringBootApplication</span> 注解详解：
 * 这个注解告诉 Spring Boot：
 * 1. 这是一个 Spring Boot 应用
 * 2. 启用自动配置
 * 3. 扫描当前包及其子包下的组件
 */</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
    
    <span class="hljs-comment">/**
     * 主方法 - 应用启动入口
     * 
     * 这个方法只有一个核心操作：SpringApplication.run()
     * 
     * SpringApplication.run() 方法的作用：
     * 1. 创建 Spring 应用上下文（ApplicationContext）
     * 2. 注册所有 Bean（包括自动配置的 Bean）
     * 3. 启动内嵌的 Web 服务器（如 Tomcat）
     * 4. 启动 Spring Boot 应用
     * 
     * 方法的参数说明：
     * - Application.class: 主配置类
     * - args: 命令行参数
     * 
     * 方法的返回值：ConfigurableApplicationContext，可以用于获取 Bean
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 这行代码完成了传统 Spring MVC 中的所有配置工作</span>
        SpringApplication.run(Application.class, args);
        
        <span class="hljs-comment">// 启动后，应用会一直运行，直到收到关闭信号</span>
        <span class="hljs-comment">// 可以通过 Ctrl+C 或调用 context.close() 来关闭应用</span>
    }
}
</code></pre>
<p><strong>pom.xml 分析：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> 
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 
         https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 
    这是父工程配置，指定了一个父工程 - SpringBoot 的精髓之一
    作用：
    1. 版本管理：统一管理所有依赖的版本
    2. 默认配置：提供合理的默认配置
    3. 依赖继承：子工程可以继承父工程的依赖
    
    传统 Maven 项目需要为每个依赖指定版本号，容易冲突
    SpringBoot 通过父工程统一管理，避免版本冲突
    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目坐标 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.itheima<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot_01_quickstart<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 指定 JDK 版本 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 项目依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 
        Spring Web Starter - Web 应用起步依赖，是我们在创建 SpringBoot 工程勾选的那个 Spring Web 产生的
        这个依赖是 SpringBoot 简化开发的关键
        
        什么是起步依赖（Starter）？
        起步依赖是一组预配置的依赖集合，它包含了开发某种应用所需的所有基础依赖。
        
        传统方式：需要手动添加几十个依赖，并解决版本冲突
        SpringBoot：只需要添加这一个起步依赖
        --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 注意：这里没有指定版本号，版本由父工程统一管理 --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 
        测试起步依赖
        作用：提供测试所需的依赖（JUnit, Mockito, Spring Test等）
        注意：scope 为 test，表示只在测试时使用，不会打包到生产环境
        --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 构建配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 
            Spring Boot Maven 插件
            作用：
            1. 将应用打包成可执行的 JAR 文件（包含所有依赖）
            2. 提供运行、打包等 Maven 目标（goals）
            3. 支持热部署（spring-boot:run）
            
            传统方式：
            - 打 war 包，需要部署到外部 Tomcat
            - 依赖需要单独部署
            
            SpringBoot 方式：
            - 打可执行 JAR 包，包含所有依赖和内嵌服务器
            - 直接运行：java -jar app.jar
            --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">对比</h4>
<p>做完 <code>SpringBoot</code> 的入门案例后，接下来对比一下 <code>Spring</code> 程序和 <code>SpringBoot</code> 程序。如下图</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6146e87a9d21411e957c8064db386ea9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=5M%2Fx4fMB0FGLot1bjBhkqf3GXxU%3D" alt="image.png" width="100%" loading="lazy"/>
<ul>
<li><strong>坐标</strong><br/>
<code>Spring</code> 程序中的坐标需要自己编写，而且坐标非常多<br/>
<code>SpringBoot</code> 程序中的坐标是我们在创建工程时进行勾选自动生成的</li>
<li><strong>web3.0配置类</strong><br/>
<code>Spring</code> 程序需要自己编写这个配置类。这个配置类大家之前编写过，肯定感觉很复杂<br/>
<code>SpringBoot</code> 程序不需要我们自己书写</li>
<li><strong>配置类</strong><br/>
<code>Spring/SpringMVC</code> 程序的配置类需要自己书写。而 <code>SpringBoot</code>  程序则不需要书写。</li>
</ul>
<blockquote>
<ul>
<li><strong>基于 Idea 的 Spring Initializr 需要联网</strong>，因为它需要从 Spring 官方服务器获取模板和依赖列表</li>
<li>如果无法联网，可以：
<ul>
<li>手动创建 Maven 项目，添加 SpringBoot 依赖</li>
<li>使用本地缓存（如果之前下载过）</li>
</ul>
</li>
</ul>
</blockquote>
<h4 data-id="heading-8">官网构建工程</h4>
<p>通过IDEA快速创建的Spring Boot工程，其底层实现实际上是调用了Spring官方提供的在线构建工具——<strong>Spring Initializr</strong>。</p>
<p>了解如何在官网直接使用Spring Initializr构建工程，不仅能理解其原理，还能确保在没有IDEA或其他IDE的环境下，依然可以创建项目。</p>
<p><strong>访问 Spring Initializr</strong></p>
<p>直接在浏览器中输入Spring Initializr的地址：<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstart.spring.io" target="_blank" title="https://start.spring.io" ref="nofollow noopener noreferrer">start.spring.io</a></strong>。</p>
<p>打开后的界面如下图所示，它与你在IDEA中看到的创建向导在核心功能上完全一致：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/757cebcc989e4621aad9d6fa92ff2bf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=LqYXO1rJTNE8yuSOUHyVWsDg%2BR0%3D" alt="image.png" width="100%" loading="lazy"/>
<p><strong>配置项目信息与依赖</strong></p>
<p>在Spring Initializr页面上，你需要完成与IDEA中类似的配置：</p>
<p><strong>1. 项目基础信息</strong><br/>
你需要填写或选择页面顶部的几个关键元数据：</p>
<ul>
<li><strong>Project</strong>： 选择构建工具，如 <strong>Maven</strong> 或 <strong>Gradle</strong>。</li>
<li><strong>Language</strong>： 选择编程语言，如 <strong>Java</strong>。</li>
<li><strong>Spring Boot</strong>： 选择Spring Boot的版本（建议选择标注有 <strong><code>(SNAPSHOT)</code></strong> 以外的稳定版本）。</li>
<li><strong>Project Metadata</strong>：
<ul>
<li><code>Group</code>： 组织标识，通常使用倒写的域名（例如 <code>com.example</code>）。</li>
<li><code>Artifact</code>： 项目标识，即你的项目名（例如 <code>demo</code>）。</li>
<li>其他如 <code>Name</code>、<code>Description</code>、<code>Package name</code> 会根据前两项自动生成，通常无需修改。</li>
</ul>
</li>
</ul>
<p><strong>2. 添加项目依赖</strong><br/>
这是Spring Initializr的核心功能之一，用于为你的项目自动生成对应的依赖配置。</p>
<ul>
<li>点击 <strong>“ADD DEPENDENCIES”</strong> 按钮（或按 <code>Ctrl + B</code> 快捷键），会弹出依赖搜索面板。</li>
<li>在搜索框中输入你需要的技术名称，例如 <strong>“Web”</strong>。</li>
<li>从搜索结果中选择 <strong>“Spring Web”</strong> 依赖，它将负责添加构建一个Web应用所需的所有基础库（包含内嵌的Tomcat服务器、Spring MVC等）。</li>
<li>你还可以根据需要添加更多依赖，例如 “Spring Data JPA”、“MySQL Driver”、“Lombok” 等。</li>
</ul>
<p><strong>3. 生成并下载项目</strong></p>
<p>所有信息配置完成后：</p>
<ol>
<li>点击页面底部的 <strong>“GENERATE”</strong> 按钮（或按 <code>Ctrl + 回车</code>）。</li>
<li>浏览器会自动下载一个以你填写的 <code>Artifact</code> 命名的 <code>.zip</code> 压缩包（例如 <code>demo.zip</code>）。</li>
</ol>
<p><strong>4. 解压与导入IDE</strong></p>
<ol>
<li>将下载的 <code>.zip</code> 文件解压到你本地的工作目录。</li>
<li>解压后的目录结构与你用IDEA生成的项目<strong>完全一致</strong>，标准的Maven项目结构如下：
demo/
├── src/
│   ├── main/
│   │   ├── java/com/example/demo/
│   │   │   └── DemoApplication.java  # Spring Boot 主启动类
│   │   └── resources/
│   │       ├── static/
│   │       ├── templates/
│   │       └── application.properties  # 配置文件
│   └── test/                          # 测试目录
└── pom.xml                           # Maven 项目核心配置文件</li>
<li>打开 <code>pom.xml</code> 文件，你可以看到Spring Boot父工程坐标以及你刚才选择的 <strong>“Spring Web”</strong> 依赖都已经自动配置好了。</li>
<li>最后，你可以用IDEA、Eclipse等IDE的 <strong>“Open”</strong> 或 <strong>“Import”</strong> 功能，选择这个解压后的项目目录，将其导入为现有项目进行开发。</li>
</ol>
<h4 data-id="heading-9">工程快速启动-Jar包</h4>
<h5 data-id="heading-10">问题导入：解决前后端协作的部署依赖</h5>
<p>在前后端分离的协作开发中，前端开发者通常需要后端服务处于运行状态，以便测试接口、调试页面功能。这会造成前端工作进度受制于后端开发者本地的开发环境。</p>
<p><strong>传统方式的局限</strong>：如果让前端开发者在自己电脑上配置完整的后端开发环境（如安装JDK、Tomcat、Idea，并导入项目），过程非常繁琐且不现实。</p>
<p><strong>SpringBoot的解决方案</strong>：利用SpringBoot可以将工程打包成一个<strong>独立可执行的Jar文件</strong>。这个Jar包内嵌了Web服务器（如Tomcat），因此<strong>运行它不需要预先安装任何外部的Tomcat或IDE</strong>，只需要目标机器上有Java运行环境（JRE）即可。</p>
<p>这样，后端开发者只需将打包好的Jar文件交给前端，前端开发者（或任何需要的人）就可以在自己的电脑上，通过一条简单的命令独立启动后端服务，<strong>唯一的前提是能访问到项目所需的数据库等外部资源</strong>。</p>
<h5 data-id="heading-11">打包：生成可执行Jar包</h5>
<p>SpringBoot工程能够打包成“可执行Jar”（也称为“Fat Jar”），核心在于 <code>pom.xml</code> 中配置的 <code>spring-boot-maven-plugin</code> 插件。</p>
<p><strong>打包步骤</strong>：</p>
<ol>
<li>
<p><strong>确认插件</strong>：确保你的 <code>pom.xml</code> 文件的 <code>&lt;build&gt;</code> -&gt; <code>&lt;plugins&gt;</code> 部分包含该插件配置。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 这是生成可执行Jar的关键插件 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<blockquote>
<p><strong>重要提示</strong>：使用Spring Initializr创建的工程<strong>默认已包含</strong>此配置。如果缺失，打包出的Jar将无法以 <code>java -jar</code> 方式直接启动。</p>
</blockquote>
</li>
<li>
<p><strong>执行打包</strong>：</p>
</li>
</ol>
<p>在IDEA中打包Spring Boot项目，有两种直观的方法：</p>
<p><strong>方法一：使用IDEA右侧的Maven图形化工具</strong></p>
<ol>
<li><strong>打开Maven工具窗口</strong>：在IDEA主界面右侧，找到并点击 <strong>「Maven」</strong> 标签栏。如果没看到，请通过顶部菜单 <strong>View（视图） → Tool Windows（工具窗口） → Maven</strong> 打开。</li>
<li><strong>找到你的项目</strong>：在展开的Maven面板中，你会看到你的项目名（例如 <code>springboot_01_quickstart</code>）。点开它下面的 <strong>Lifecycle（生存期）</strong> 文件夹。</li>
<li><strong>执行打包</strong>：在 <code>Lifecycle</code> 里，找到 <strong>package</strong> 并 <strong>双击它</strong>。IDEA就会开始执行打包过程。</li>
</ol>
<p>执行时你会看到：IDEA底部会弹出「Run」工具窗口，显示详细的Maven构建日志。最后出现 <strong><code>BUILD SUCCESS</code></strong> 就表示打包成功。</p>
<p><strong>方法二：使用IDEA内置的终端（命令行）</strong></p>
<p>这个方法更接近真实的生产环境操作。</p>
<ol>
<li><strong>打开终端</strong>：在IDEA左边栏下部，找到并点击 <strong>Terminal（终端）</strong> 标签页。它会<strong>自动打开并定位在你的项目根目录</strong>（即 <code>pom.xml</code> 文件所在的目录）。</li>
<li><strong>输入命令</strong>：在终端里，直接输入以下命令并按回车：
<pre><code class="hljs language-bash" lang="bash">mvn clean package
</code></pre>
</li>
</ol>
<p>执行时你会看到：同样会在终端里滚动输出构建信息，直到出现 <code>BUILD SUCCESS</code>。</p>
<ol start="3">
<li><strong>获取产物</strong>：命令执行成功后，在项目的 <code>target</code> 目录下即可找到生成的Jar包，其命名格式通常为 <code>项目名-版本号.jar</code>（例如 <code>springboot_01_quickstart-0.0.1-SNAPSHOT.jar</code>）。</li>
</ol>
<h5 data-id="heading-12">启动：运行Jar包</h5>
<p>启动这个Jar包非常简单，无需任何容器。</p>
<ol>
<li><strong>打开命令行</strong>：进入 <code>target</code> 目录（<code>cd target</code>），或者记住Jar包的完整路径。</li>
<li><strong>执行启动命令</strong>：
<pre><code class="hljs language-bash" lang="bash">java -jar Jar包名
</code></pre>
</li>
<li><strong>观察日志</strong>：执行命令后，SpringBoot的启动日志会直接输出在控制台，你将会看到熟悉的启动信息，包括内嵌Tomcat的端口号。</li>
</ol>
<p>上述可以 在IDEA的终端中操作，也可以在系统的命令行中操作。</p>
<h3 data-id="heading-13">SpringBoot 概述</h3>
<p><code>SpringBoot</code> 是由 Pivotal 团队提供的全新框架，其设计目的就是<strong>简化</strong> Spring 应用的<strong>初始搭建</strong>和<strong>开发过程</strong>。</p>
<p>通过与原始 Spring 环境对比，可以清晰看到 SpringBoot 的核心价值：</p>





















<table><thead><tr><th align="left">原始 Spring 开发痛点</th><th align="left">SpringBoot 对应的解决方案</th></tr></thead><tbody><tr><td align="left"><strong>配置繁琐</strong><br/>需要大量 XML 或 Java 配置</td><td align="left"><strong>自动配置 (Auto Configuration)</strong><br/>根据类路径和设置，自动配置 Bean 和组件。</td></tr><tr><td align="left"><strong>依赖设置繁琐</strong><br/>需要手动管理大量依赖及其兼容版本</td><td align="left"><strong>起步依赖 (Starter Dependencies)</strong><br/>提供预设的、版本协调好的依赖包。</td></tr><tr><td align="left"><strong>部署依赖外部服务器</strong><br/>需要独立安装和配置 Tomcat 等服务器</td><td align="left"><strong>辅助功能 (如内置服务器)</strong><br/>内置 Tomcat、Jetty 等服务器，打包即可独立运行。</td></tr></tbody></table>
<h4 data-id="heading-14">起步依赖</h4>
<p>在使用 Spring Initializr 创建工程时，<code>pom.xml</code> 中自动生成的、名称中包含 <strong><code>starter</code></strong> 的依赖，就是 <strong>起步依赖</strong>。它们是简化依赖管理的核心。</p>
<p>起步依赖的实现机制主要基于两个关键设计：<strong>继承父工程 (<code>parent</code>)</strong> 和<strong>引入启动器 (<code>starter</code>)</strong></p>
<h5 data-id="heading-15">探索父工程：统一版本管理</h5>
<p>在项目的 <code>pom.xml</code> 中，通过 <code>&lt;parent&gt;</code> 指定了一个父工程（如 <code>spring-boot-starter-parent</code>）。这个父工程的核心作用是进行<strong>统一的依赖版本管理</strong>，而非直接引入所有依赖。</p>
<ul>
<li><strong>版本仓库 (<code>&lt;properties&gt;</code>)</strong>：父工程的 <code>pom.xml</code> 中，<code>&lt;properties&gt;</code> 标签像一个大仓库，定义了数百个常用技术依赖（如 Servlet、MySQL Driver、Jackson 等）的<strong>兼容版本号</strong>。</li>
<li><strong>依赖管理 (<code>&lt;dependencyManagement&gt;</code>)</strong>：<code>&lt;dependencyManagement&gt;</code> 标签则利用这个仓库，对大部分可能用到的依赖进行了<strong>版本锁定</strong>。</li>
<li><strong>对你的影响</strong>：正因为继承了此父工程，当你在项目中添加依赖时，<strong>通常只需指定 <code>groupId</code> 和 <code>artifactId</code>，无需再写 <code>version</code></strong>。SpringBoot 会自动从父工程管理的版本仓库中选取一个经过兼容性测试的版本，这从根本上避免了版本冲突问题。</li>
</ul>
<h5 data-id="heading-16">探索起步依赖：功能聚合包</h5>
<p>以 <code>spring-boot-starter-web</code> 为例，当你在 <code>pom.xml</code> 中声明此依赖后，它实际上会引入一个<strong>功能相关的依赖包集合</strong>，而不仅仅是一个库。</p>
<p>进入 <code>spring-boot-starter-web</code> 的 <code>pom.xml</code>，你会发现它自身又引入了多个协调好的依赖：</p>
<ul>
<li><code>spring-web</code> 和 <code>spring-webmvc</code>（用于实现 Spring MVC Web 框架）</li>
<li><code>spring-boot-starter-tomcat</code>（内嵌了 Tomcat 服务器）</li>
<li><code>spring-boot-starter-json</code>（提供了 JSON 处理能力）</li>
</ul>
<p><strong>结论</strong>：<code>starter</code> 是一个<strong>功能导向</strong>的依赖描述。你需要什么功能（例如做 Web 开发、操作数据库、进行安全控制），就引入对应的 <code>starter</code>（例如 <code>spring-boot-starter-web</code>、<code>spring-boot-starter-data-jpa</code>、<code>spring-boot-starter-security</code>）。这个 <code>starter</code> 会帮你把实现该功能所需的一整套、版本协调好的技术依赖全部引入进来。</p>
<p><strong>实际开发中的使用守则</strong>：</p>
<ol>
<li><strong>引入依赖</strong>：通常只需要写 <code>groupId</code> 和 <code>artifactId</code>，<strong>不写 <code>version</code></strong>，依赖版本由父工程统一管理。</li>
<li><strong>选择依赖</strong>：根据所需功能选择对应的 <code>spring-boot-starter-*</code>。</li>
<li><strong>处理版本冲突（特殊情况）</strong>：如果必须使用特定版本，可以在 <code>pom.xml</code> 中手动指定 <code>&lt;version&gt;</code>，但需谨慎评估兼容性。</li>
</ol>
<h4 data-id="heading-17">程序启动-引导类</h4>
<p>在 Spring Boot 中，每个项目都有一个核心的入口类，通常称为 <strong>引导类</strong> (Bootstrap Class) 或 <strong>主启动类</strong>。它通常是项目创建后自动生成的，类名格式默认为 <code>[项目名]Application</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 示例：Springboot01QuickstartApplication 就是一个引导类</span>
<span class="hljs-meta">@SpringBootApplication</span> <span class="hljs-comment">// 核心注解：标记此为SpringBoot应用，并启用自动配置</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot01QuickstartApplication</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 核心启动方法：这行代码负责启动整个SpringBoot应用</span>
        SpringApplication.run(Springboot01QuickstartApplication.class, args);
    }
}
</code></pre>
<p><strong>关键要点：</strong></p>
<ol>
<li><strong>唯一入口</strong>：<code>main</code> 方法是整个 Spring Boot 应用的唯一启动入口。</li>
<li><strong>核心注解</strong>：<code>@SpringBootApplication</code> 是一个组合注解，它整合了配置、组件扫描和自动配置启用等关键功能。</li>
<li><strong>启动原理</strong>：当你运行 <code>main</code> 方法时，<code>SpringApplication.run()</code> 会：
<ul>
<li>初始化 Spring 容器。</li>
<li>启动内嵌的 Web 服务器（因为你引入了 <code>spring-boot-starter-web</code> 依赖，所以默认是 Tomcat）。</li>
<li>运行你的应用程序。</li>
</ul>
</li>
<li><strong>打包方式</strong>：Spring Boot <strong>默认采用 jar 包</strong>的打包方式（而非传统的 war 包）。这使得应用成为一个<strong>独立、可携带</strong>的单元，只需 JDK 环境即可通过 <code>java -jar</code> 命令运行，非常适合微服务和云原生部署。</li>
</ol>
<h4 data-id="heading-18">切换 Web 服务器</h4>
<p>Spring Boot 默认使用 Tomcat 作为内嵌服务器，但它支持轻松切换为其他服务器，如 Jetty 或 Undertow。</p>
<p><strong>切换核心思想</strong>：<strong>“先排除，后引入”</strong>——从当前 Web 起步依赖中排除默认的 Tomcat，然后引入你想要的服务器起步依赖。</p>
<p><strong>操作步骤（以切换到 Jetty 为例）</strong></p>
<p><strong>第一步：排除默认的 Tomcat 依赖</strong></p>
<p>在 <code>pom.xml</code> 文件中，修改 <code>spring-boot-starter-web</code> 依赖，添加 <code>&lt;exclusions&gt;</code> 标签来排除 Tomcat。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 关键：排除自带的Tomcat --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>第二步：引入 Jetty 起步依赖</strong></p>
<p>在同一个 <code>pom.xml</code> 文件中，添加 Jetty 的起步依赖。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>第三步：验证切换</strong></p>
<p>完成以上修改后，点击 “<strong>同步Maven更改</strong>” 以保存 <code>pom.xml</code>，再重新启动引导类（运行 <code>main</code> 方法）。在控制台输出的启动日志中，将不再看到 Tomcat 的字样，取而代之的是 Jetty 的相关信息，类似如下：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d54222056734c828b4da7a80772c374~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=LSAsJi6z0mfH5%2B8He9WaWKkiqHU%3D" alt="image.png" width="100%" loading="lazy"/></p>
<p><strong>实践提示</strong>：</p>
<ul>
<li>这个例子清晰地展示了 Spring Boot <strong>起步依赖</strong>的强大之处：<strong>切换一项核心技术，通常只需要更换对应的 <code>starter</code> 即可</strong>，所有复杂的依赖传递和版本管理都由框架自动处理。</li>
<li>在真实项目中，如果你没有对 Jetty 或 Undertow 的特殊需求，使用<strong>默认的 Tomcat</strong> 是最稳妥、兼容性最好的选择。</li>
</ul>
<h2 data-id="heading-19">配置文件</h2>
<p>Spring Boot 的强大之处在于其 <strong>“约定大于配置”</strong> 的理念，它提供了合理的默认值。但当我们需要自定义设置（如更改端口、配置数据库）时，就要用到<strong>配置文件</strong>。你可以将它理解为你应用程序的 <strong>“遥控器”</strong> ，通过修改它，无需改动代码就能改变程序的行为。</p>
<h3 data-id="heading-20">配置文件格式</h3>
<p><strong>核心作用：自定义应用设置</strong></p>
<p>Spring Boot 应用启动时，许多设置（如服务器端口）都有默认值。如果想修改这些默认设置，就需要使用配置文件。</p>
<p><strong>举个例子</strong>：默认的服务器端口是 <code>8080</code>，访问地址是 <code>http://localhost:8080/books/1</code>。如果想把端口改成更常见的 <code>80</code>（HTTP默认端口，访问时可省略），使得访问地址变为 <code>http://localhost/books/1</code>，就需要通过配置文件来实现。</p>
<p>Spring Boot 支持三种主流的配置文件格式，它们功能相同，只是语法不同。</p>





























<table><thead><tr><th align="left">格式</th><th align="left">文件后缀</th><th align="left">语法特点</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><strong><code>.properties</code></strong></td><td align="left"><code>application.properties</code></td><td align="left">键值对，使用等号（<code>=</code>）连接。最传统，但层次结构不直观。</td><td align="left"><code>server.port=80</code></td></tr><tr><td align="left"><strong><code>.yml</code></strong></td><td align="left"><code>application.yml</code></td><td align="left">树状结构，使用冒号（<code>:</code>）和缩进来表示层级。<strong>结构清晰，推荐使用。</strong></td><td align="left"><code>yaml server: port: 81 </code></td></tr><tr><td align="left"><strong><code>.yaml</code></strong></td><td align="left"><code>application.yaml</code></td><td align="left">与 <code>.yml</code> 完全相同，只是后缀名不同。</td><td align="left">同 <code>.yml</code></td></tr></tbody></table>
<blockquote>
<p><strong>关键规则</strong>：Spring Boot 配置文件的<strong>主文件名必须是 <code>application</code></strong>，只有后缀名可以变化。</p>
</blockquote>
<h4 data-id="heading-21">环境准备</h4>
<p>创建一个新的 Spring Boot 项目（例如命名为 <code>springboot_02_base_config</code>）用来演示不同的配置文件，并创建一个简单的 <code>BookController</code> 控制器，用于后续测试配置是否生效。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/703faaac4a1e4112bbd1a7087301b177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=E2ZlURSxwOseVRJHUxNfegddV%2Fw%3D" alt="image.png" width="50%" loading="lazy"/>
<p>在该工程中的 <code>com.itheima.controller</code> 包下创建一个名为 <code>BookController</code> 的控制器。内容如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span>{
        System.out.println(<span class="hljs-string">"id ==&gt; "</span>+id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello , spring boot!"</span>;
    }
}
</code></pre>
<h4 data-id="heading-22">三种配置文件演示</h4>
<p><strong>1. 使用 <code>application.properties</code></strong><br/>
在 <code>src/main/resources/</code> 目录下找到或创建 <code>application.properties</code> 文件，添加一行配置：</p>
<pre><code class="hljs language-properties" lang="properties">server.port=80
</code></pre>
<p>启动应用，观察控制台日志，若看到 ↓，说明配置生效。\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44a2d3f86cd455cbd3d84a50a575123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=eZDab%2BgktXES8NA3SzmQ0jEMI0s%3D" alt="image.png" width="50%" loading="lazy"/></p>
<p><strong>2. 使用 <code>application.yml</code> (推荐)</strong><br/>
在相同目录中创建 <code>application.yml</code> 文件，将 <code>.properties</code> 文件中的所有配置项，转换为 YAML 语法后，完整写入 <code>.yml</code> 文件。再将原来的 <code>application.properties</code> 文件<strong>删除</strong>，或者将其<strong>重命名</strong>（例如改为 <code>application.properties.bak</code> 作为备份）。<code>.yml</code> 文件端口配置如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span>
</code></pre>
<p>启动应用，端口应变为 <code>81</code>。</p>
<blockquote>
<p><strong>YAML语法注意</strong>：</p>
<ol>
<li><strong>缩进</strong>：<strong>必须使用空格（通常2个）进行缩进</strong>，<strong>不能使用Tab键</strong>。同一层级的元素必须左对齐。</li>
<li><strong>冒号</strong>：每个键的后面<strong>必须紧跟一个英文冒号和一个空格</strong>，然后才是值。
<ul>
<li>✅ 正确：<code>port: 80</code></li>
<li>❌ 错误：<code>port:80</code>（缺少空格）或 <code>port: 80</code>（冒号错误）</li>
</ul>
</li>
</ol>
</blockquote>
<p><strong>3. 使用 <code>application.yaml</code></strong><br/>
操作与 <code>.yml</code> 完全一样，只是文件后缀名不同。<code>application.yaml</code>内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">82</span>
</code></pre>
<p>启动应用，端口应变为 <code>82</code>。</p>
<p><strong>提示功能</strong></p>
<p>三种配置文件都有提示功能，在 <code>.yml</code> 配置文件中，我们也可以在该文件中书写 <code>port</code> ，然后 IDEA 就会提示并书写成YAML格式：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b556338e8ee84811b3bc68fcbeda6de5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=1QRgkXHwbfRD6QCOtBzDWzz93%2FI%3D" alt="image.png" width="60%" loading="lazy"/></p>
<h4 data-id="heading-23">配置文件的优先级</h4>
<p>如果三种格式的配置文件<strong>同时存在</strong>，且配置了同一个属性（如端口），Spring Boot 会按以下<strong>优先级</strong>决定使用哪一个：
<strong><code>application.properties</code> &gt; <code>application.yml</code> &gt; <code>application.yaml</code></strong></p>
<p><strong>高优先级的配置会覆盖低优先级的相同配置</strong>。在项目中，通常建议只使用一种格式（推荐 <code>.yml</code>），以避免混淆。</p>
<h3 data-id="heading-24">YAML 格式</h3>
<p><strong>YAML</strong> (YAML Ain‘t Markup Language) 是一种专门用来<strong>编写配置文件</strong>的数据序列化格式。近年来，它凭借清晰的层次结构，在 Spring Boot 等现代框架中已成为主导的配置格式。</p>
<p>与之前的配置格式相比，YAML 的优势非常明显。我们可以通过一个公司信息的例子来直观对比：</p>

























<table><thead><tr><th align="left">格式</th><th align="left">示例</th><th align="left">特点分析</th></tr></thead><tbody><tr><td align="left"><strong>XML</strong> (早期)</td><td align="left"><code>&lt;enterprise&gt;</code><br/>    <code>&lt;name&gt;itcast&lt;/name&gt;</code> <br/>     <code>&lt;age&gt;16&lt;/age&gt;</code> <br/>     <code>&lt;tel&gt;4006184000&lt;/tel&gt;</code> <br/> <code>&lt;/enterprise&gt;</code></td><td align="left"><strong>注重格式</strong>：标签嵌套，结构严谨但冗余，可读性一般，数据被标签“包裹”。</td></tr><tr><td align="left"><strong>Properties</strong></td><td align="left"><code>enterprise.name=itcast</code><br/><code>enterprise.age=16</code><br/><code>enterprise.tel=4006184000</code></td><td align="left"><strong>平铺直叙</strong>：使用“点”分隔层级，结构简单但层级深时难以阅读。</td></tr><tr><td align="left"><strong>YAML</strong> (主流)</td><td align="left"><code>enterprise:</code><br/>    <code>name: itcast</code><br/>    <code>age: 16</code><br/>    <code>tel: 4006184000</code></td><td align="left"><strong>注重数据</strong>：<strong>树状缩进</strong>，层级一目了然，去除了不必要的符号，<strong>最易阅读和维护</strong>。</td></tr></tbody></table>
<p><strong>文件扩展名</strong>：<code>.yml</code>（最常用） 或 <code>.yaml</code>，两者完全等效。</p>
<h4 data-id="heading-25">语法规则</h4>
<ul>
<li>大小写敏感</li>
<li>属性层级关系使用多行描述，每行结尾使用冒号结束</li>
<li>使用缩进表示层级关系，同层级左侧对齐，只允许使用空格（不允许使用Tab键）<br/>
空格的个数并不重要，只要保证同层级的左侧对齐即可。</li>
<li>属性值前面添加空格（属性名与属性值之间使用<code>冒号+空格</code>作为分隔）</li>
<li><code>#</code> 表示注释，其后的内容会被忽略。</li>
</ul>

<ul>
<li><strong>数组（List）的表示</strong><br/>
在属性下方，使用 <strong><code>-</code> 减号</strong>（后面跟一个空格）来表示数组中的一个元素。
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">enterprise:</span>
  <span class="hljs-attr">subject:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Java</span>       <span class="hljs-comment"># 数组第一项</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">前端</span>        <span class="hljs-comment"># 数组第二项</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">大数据</span>      <span class="hljs-comment"># 数组第三项</span>
<span class="hljs-comment"># 这等价于Java中的：List&lt;String&gt; subject = Arrays.asList("Java", "前端", "大数据");</span>

<span class="hljs-comment"># 部门信息 (对象数组)</span>
<span class="hljs-attr">departments:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">研发部</span>
  <span class="hljs-attr">manager:</span> <span class="hljs-string">张三</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">市场部</span>
  <span class="hljs-attr">manager:</span> <span class="hljs-string">李四</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-26">YAML 配置文件数据读取</h3>
<p>这一节我们将学习三种从 <code>application.yml</code> 配置文件中读取数据的方法，这是将静态配置转化为程序中可用变量的关键步骤。</p>
<p>下面我们开始具体的环境准备和三种方式的详解。</p>
<h4 data-id="heading-27">环境准备</h4>
<p>新创建一个名为 <code>springboot_03_read_data</code> 的 <code>SpringBoot</code> 工程，目录结构如下：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/075f2fec49b34878acba59af8462f093~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=p7YjAaevELZaugiIWmC2Qmee%2BvA%3D" alt="image.png" width="50%" loading="lazy"/>
<p>在 <code>com.itheima.controller</code> 包写创建名为 <code>BookController</code> 的控制器，内容如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span>{
        System.out.println(<span class="hljs-string">"id ==&gt; "</span>+id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello , spring boot!"</span>;
    }
}
</code></pre>
<p>在 <code>com.itheima.domain</code> 包下创建一个名为 <code>Enterprise</code> 的实体类等会用来封装数据，内容如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Enterprise</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    <span class="hljs-keyword">private</span> String tel;
    <span class="hljs-keyword">private</span> String[] subject;
    
    <span class="hljs-comment">//setter and getter</span>
    
    <span class="hljs-comment">//toString</span>
}
</code></pre>
<p>在 <code>resources</code> 下创建一个名为 <code>application.yml</code> 的配置文件，里面配置了不同的数据，内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">lesson:</span> <span class="hljs-string">SpringBoot</span>

<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>

<span class="hljs-attr">enterprise:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">itcast</span>
  <span class="hljs-attr">age:</span> <span class="hljs-number">16</span>
  <span class="hljs-attr">tel:</span> <span class="hljs-number">4006184000</span>
  <span class="hljs-attr">subject:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">Java</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">前端</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">大数据</span>
</code></pre>
<h4 data-id="heading-28">三种读取配置数据的方式</h4>
<h5 data-id="heading-29"><code>@Value</code> 注解（读取单个值）</h5>
<p>这种方式简单直接，适合读取少量、零散的配置值。</p>
<p><strong>工作原理</strong>：在字段上使用 <code>${一级属性名.二级属性名……}</code>，Spring 会自动将对应的配置值注入到字段中。</p>
<p><strong>在 <code>BookController</code> 中的使用示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">// 1. 读取简单值 (lesson: SpringBoot)</span>
    <span class="hljs-meta">@Value("${lesson}")</span>
    <span class="hljs-keyword">private</span> String lesson;

    <span class="hljs-comment">// 2. 读取嵌套值 (server.port)</span>
    <span class="hljs-meta">@Value("${server.port}")</span>
    <span class="hljs-keyword">private</span> Integer port;

    <span class="hljs-comment">// 3. 读取数组中的第一个元素 (enterprise.subject[0])</span>
    <span class="hljs-meta">@Value("${enterprise.subject[0]}")</span>
    <span class="hljs-keyword">private</span> String subject_00;

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        System.out.println(lesson);
        System.out.println(port);
        System.out.println(subject_00);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<h5 data-id="heading-30">注入 <code>Environment</code> 对象（动态读取）</h5>
<p>这种方式将<strong>所有配置</strong>都加载到一个 <code>Environment</code> 对象中，可以动态地根据键名获取值。</p>
<p><strong>在 <code>BookController</code> 中的使用示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">// 自动注入Environment对象</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Environment env;

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 通过 getProperty 方法根据键名获取值</span>
        System.out.println(env.getProperty(<span class="hljs-string">"lesson"</span>));
        System.out.println(env.getProperty(<span class="hljs-string">"enterprise.name"</span>));
        System.out.println(env.getProperty(<span class="hljs-string">"enterprise.subject[0]"</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<p><strong>缺点</strong>：</p>
<ol>
<li><strong>类型不安全</strong>：<code>getProperty</code> 返回的是 <code>String</code>，需要自己转换类型。</li>
<li><strong>键名拼写易错</strong>：配置键名以字符串形式书写，没有IDE的检查和提示，容易出错。
因此，在需要读取大量配置的常规业务开发中<strong>很少直接使用</strong>。</li>
</ol>
<h5 data-id="heading-31">自定义对象（用于正式项目）</h5>
<p>这是最规范、最面向对象的方式，尤其适用于<strong>将一组逻辑相关的配置（如<code>enterprise</code>下的所有属性）一次性加载到一个自定义的JavaBean中</strong>。</p>
<p><strong>第一步：改造实体类 <code>Enterprise</code></strong><br/>
在 <code>com.itheima.domain</code> 包下的 <code>Enterprise</code> 类上添加关键注解：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 1. 将此类的对象交给Spring容器管理</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = "enterprise")</span> <span class="hljs-comment">// 2. 指定要绑定配置的前缀</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Enterprise</span> {
    <span class="hljs-comment">// 3. 字段名必须与配置文件中 ‘prefix.’ 后面的部分严格对应</span>
    <span class="hljs-comment">// 例如 ‘enterprise.name’ 对应字段 ‘name’</span>
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
    <span class="hljs-keyword">private</span> String tel;
    <span class="hljs-keyword">private</span> String[] subject;

    <span class="hljs-comment">// 4. 必须为每一个字段提供其getter和setter方法，否则Spring无法注入值</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> name; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> { <span class="hljs-built_in">this</span>.name = name; }
    <span class="hljs-comment">// ... 其他字段的getter/setter</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Enterprise{"</span> +
                <span class="hljs-string">"name='"</span> + name + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", age="</span> + age +
                <span class="hljs-string">", tel='"</span> + tel + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", subject="</span> + Arrays.toString(subject) +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p><strong>第二步：在 <code>BookController</code> 中注入使用</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/books")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookController</span> {

    <span class="hljs-comment">// 像注入普通Bean一样注入配置绑定好的Enterprise对象</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Enterprise enterprise;

    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Integer id)</span> {
        <span class="hljs-comment">// 直接使用对象的getter方法获取配置值，类型安全，有代码提示</span>
        System.out.println(enterprise.getName());
        System.out.println(enterprise.getAge());
        System.out.println(enterprise.getSubject());
        System.out.println(enterprise.getTel());
        System.out.println(enterprise.getSubject()[<span class="hljs-number">0</span>]);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"hello, spring boot!"</span>;
    }
}
</code></pre>
<p><strong>注意</strong>：消除 <code>@ConfigurationProperties</code> 的IDEA警告<br/>
在类上添加 <code>@ConfigurationProperties</code> 注解后，IDEA可能会显示一个警告（如黄色波浪线）。这个警告的意思是：<strong>“我（IDEA）不知道你配置了哪些属性，所以无法为你提供属性名的代码提示和拼写检查。”</strong></p>
<p><strong>解决方案</strong>：在 <code>pom.xml</code> 中添加一个<strong>编译期注解处理器</strong>依赖。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span> <span class="hljs-comment">&lt;!-- 注意：optional=true 表示此依赖不会传递到其他模块 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-32">多环境配置</h3>
<p>在实际开发中，应用通常需要在<strong>开发（dev）</strong>、<strong>测试（test）</strong>、<strong>生产（pro）</strong> 等不同环境中运行。每个环境的配置（如数据库地址、日志级别、服务器端口）往往不同。频繁手动修改配置文件不仅麻烦，而且容易出错。\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8634f9db0a374492b2cf4224a8dd53d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=VyYScRFSjdxJAKvKSOAvHbjOjbI%3D" alt="image.png" width="60%" loading="lazy"/></p>
<p>Spring Boot 提供了强大的多环境配置支持，让你能轻松地在不同环境间切换。主要有以下三种方式：</p>
<h4 data-id="heading-33">YAML 文件配置（推荐）</h4>
<p>YAML 文件支持在<strong>单个文件</strong>内使用 <code>---</code> 分隔符定义多个环境配置，结构非常清晰。</p>
<p><strong>基本语法与示例</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 第一部分：设置默认激活的环境 (必须放在最前面)</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 这里设置默认激活的是dev环境</span>

<span class="hljs-comment"># 用三个减号(---)进行分隔</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># 第二部分：开发环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 为此段配置命名为 ‘dev’</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/dev-api</span>  <span class="hljs-comment"># 为所有请求路径添加统一前缀，便于区分是什么环境中的接口</span>
<span class="hljs-attr">logging:</span>        <span class="hljs-comment"># logging.level根据不同环境设置不同的日志级别</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">debug</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># 第三部分：测试环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">test</span> <span class="hljs-comment"># 为此段配置命名为 ‘test’</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">info</span>

<span class="hljs-meta">---</span>
<span class="hljs-comment"># 第四部分：生产环境配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">config:</span>
    <span class="hljs-attr">activate:</span>
      <span class="hljs-attr">on-profile:</span> <span class="hljs-string">pro</span> <span class="hljs-comment"># 为此段配置命名为 ‘pro’</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">82</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">root:</span> <span class="hljs-string">warn</span>
</code></pre>
<p><strong>关键点说明</strong></p>
<ol>
<li><strong>激活环境</strong>：通过 <code>spring.config.activate.on-profile</code> 属性设置在文件顶部，决定应用启动时默认使用哪一段配置。</li>
<li><strong>分隔符</strong>：<code>---</code> 是YAML中定义文档段落的标记，Spring Boot用它来区分不同环境的配置。</li>
<li><strong>环境命名</strong>：
<ul>
<li><strong>新方式（推荐）</strong>：使用 <code>spring.config.activate.on-profile</code> 为配置段命名（如 <code>dev</code>, <code>test</code>）。</li>
<li><strong>旧方式（已过时）</strong>：<code>spring.profiles</code> 属性，新项目不建议再使用。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-34">Properties 文件配置</h4>
<p>Properties 格式通过<strong>创建多个文件</strong>来管理多环境配置，这是另一种常见的做法。</p>
<p><strong>文件命名规则与结构</strong><br/>
你需要创建一系列遵循特定命名规则的文件：</p>
<ul>
<li><code>application.properties</code>：<strong>主配置文件</strong>，用于设置激活哪个环境。</li>
<li><code>application-{profile}.properties</code>：<strong>环境专属配置文件</strong>，<code>{profile}</code> 替换为环境名（如 <code>dev</code>, <code>test</code>, <code>pro</code>）。</li>
</ul>
<p><strong>配置示例</strong><br/>
<strong>1. 主配置文件 (<code>application.properties</code>)</strong>：<br/>
在此文件中指定激活的环境配置</p>
<pre><code class="hljs language-properties" lang="properties"># 例如激活生产环境pro
spring.profiles.active=pro
</code></pre>
<p><strong>2. 环境专属配置文件</strong>：</p>
<ul>
<li><code>application-dev.properties</code> (开发环境)：
<pre><code class="hljs language-properties" lang="properties">server.port=8080  # 这里配置端口号为 8080
</code></pre>
</li>
<li><code>application-test.properties</code> (测试环境)：
<pre><code class="hljs language-properties" lang="properties">server.port=8081
</code></pre>
</li>
<li><code>application-pro.properties</code> (生产环境)：
<pre><code class="hljs language-properties" lang="properties">server.port=80
</code></pre>
</li>
</ul>
<p>启动应用时，Spring Boot 会加载 <code>application.properties</code> 中 <code>spring.profiles.active</code> 指定的环境对应文件（此例为 <code>application-pro.properties</code>），并将其中配置与主文件合并。</p>
<h4 data-id="heading-35">命令行参数设置（最灵活）</h4>
<p>当<code>SpringBoot</code> 开发的程序打包成 <strong>JAR 文件</strong>后，仍然可以在启动时通过命令行参数<strong>临时覆盖或指定</strong>配置，而无需修改打包在 JAR 内的配置文件。</p>
<p><strong>常用命令示例</strong></p>
<ol>
<li>
<p><strong>激活指定环境</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --spring.profiles.active=<span class="hljs-built_in">test</span>
</code></pre>
<p>这会让应用使用 <code>test</code> 环境的配置，无论打包时默认设置的是什么。</p>
</li>
<li>
<p><strong>临时修改特定配置项</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --server.port=8888
</code></pre>
<p>这会临时将服务器端口改为 8888。</p>
</li>
<li>
<p><strong>组合使用</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar --spring.profiles.active=pro --server.port=443 --logging.level.root=error
</code></pre>
<p>可以同时指定环境、修改端口和日志级别等多个参数。</p>
</li>
</ol>
<h4 data-id="heading-36">配置优先级与实践建议</h4>
<p>当同一个配置项通过多种方式（默认配置、环境配置、命令行等）被设置时，Spring Boot 遵循一个明确的<strong>优先级顺序</strong>，优先级高的会覆盖优先级低的。</p>
<p>配置的优先级在 <code>SpringBoot</code> 官网已经进行了说明，参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-boot%2Fdocs%2Fcurrent%2Freference%2Fhtml%2Fspring-boot-features.html%23boot-features-external-config" target="_blank" title="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config" ref="nofollow noopener noreferrer">Externalized Configuration</a>，进入上面网站后会看到如下页面：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3010462781d45cc8e1c4325b7ba7ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=JSz5WvV%2FolDItgEfPocjrYjhEqQ%3D" alt="image.png" width="100%" loading="lazy"/></p>
<p><strong>对比建议</strong></p>





























<table><thead><tr><th align="left">配置方式</th><th align="left">适用场景</th><th align="left">优点</th><th align="left">缺点</th></tr></thead><tbody><tr><td align="left"><strong>YAML 多文档</strong></td><td align="left">配置相对简单，且希望集中管理。</td><td align="left">结构清晰，所有配置在一个文件中。</td><td align="left">环境很多时文件会变得冗长。</td></tr><tr><td align="left"><strong>Properties 多文件</strong></td><td align="left">不同环境配置差异很大，或团队习惯文件分离。</td><td align="left">环境间隔离性好，便于按需打包。</td><td align="left">文件数量较多。</td></tr><tr><td align="left"><strong>命令行参数</strong></td><td align="left"><strong>生产部署、紧急调试、临时测试</strong>。</td><td align="left">优先级最高，最灵活，无需改动文件。</td><td align="left">不适合作为常规配置方式。</td></tr></tbody></table>
<ol>
<li><strong>开发阶段</strong>：在 <code>application.yml</code> 中使用多文档块，将 <code>dev</code> 设为默认环境，方便本地开发。</li>
<li><strong>打包阶段</strong>：在 <code>application.properties</code> 中通过 <code>spring.profiles.active=pro</code> 设置好生产环境为默认，避免打包后忘记切换。</li>
<li><strong>部署与运维阶段</strong>：掌握命令行参数覆盖技巧，以便在服务器上灵活调整配置。这是成为一名合格后端开发者的必备技能。</li>
</ol>
<h3 data-id="heading-37">配置文件分类与优先级</h3>
<p>想象一个场景：应用开发完成后，测试人员需要进行测试。由于测试环境和开发环境的配置（如数据库地址、服务端口等）通常不同，测试人员可能需要通过如下一长串复杂的命令行参数来启动应用，非常不便：</p>
<pre><code class="hljs language-bash" lang="bash">java –jar springboot.jar –-spring.profiles.active=<span class="hljs-built_in">test</span> --server.port=85 --server.servlet.context-path=/heima ……（更多参数）
</code></pre>
<p>为了解决这个问题，并让应用能灵活适应不同部署环境，Spring Boot 设计了一套<strong>配置文件放置位置的规则</strong>。应用会从多个预定位置加载 <code>application.yml</code> 或 <code>application.properties</code> 文件，并且 <strong>“位置”本身决定了配置的优先级</strong>。</p>
<h4 data-id="heading-38">优先级规则</h4>
<p>Spring Boot 支持从4个标准位置加载配置文件，其<strong>优先级由高到低</strong>如下：</p>
<ol>
<li>项目<strong>外部</strong>的 <code>/config</code> 目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>file:./config/</code></li>
<li><strong>含义</strong>：与最终打包的 <strong>JAR包（或WAR包）在同一目录</strong>下，且位于 <code>config</code> 子文件夹内的配置文件。</li>
</ul>
<ol start="2">
<li>项目<strong>外部</strong>的根目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>file:./</code></li>
<li><strong>含义</strong>：与最终打包的 <strong>JAR包（或WAR包）在同一目录</strong>下的配置文件。</li>
</ul>
<ol start="3">
<li>项目<strong>内部</strong>的 <code>/config</code> 目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>classpath:/config/</code></li>
<li><strong>含义</strong>：打包在 <strong>JAR/WAR包内部</strong>，位于类路径 <code>config</code> 目录下的配置文件。在开发项目中，对应 <code>src/main/resources/config/</code> 目录。</li>
</ul>
<ol start="4">
<li>项目<strong>内部</strong>的类路径根目录。</li>
</ol>
<ul>
<li><strong>具体路径</strong>：<code>classpath:/</code></li>
<li><strong>含义</strong>：打包在 <strong>JAR/WAR包内部</strong>，位于类路径根目录下的配置文件。在开发项目中，对应 <code>src/main/resources/</code> 目录。</li>
</ul>
<p><strong>核心规则</strong></p>
<ul>
<li>文件系统中JAR包外部的配置，优先级<strong>高于</strong>打包在JAR包内部的配置。</li>
<li>无论在外部还是内部，位于 <code>config</code> 子目录下的配置，优先级<strong>高于</strong>直接放在根目录下的配置。</li>
<li><strong>覆盖原则</strong>：高优先级配置文件中的属性会<strong>覆盖</strong>低优先级配置文件中定义的<strong>相同属性</strong>。</li>
</ul>
<h4 data-id="heading-39">环境准备</h4>
<p>下面我们通过实验来验证上述优先级规则。</p>
<p>创建一个名为 <code>springboot_06_config_file</code> 的 <code>SpringBoot</code> 工程，目录结构如下:\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78d928af549a48e08001654bf83462bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=HQ0nVlSi%2ByHga770Aavzhb%2FEJQg%3D" alt="image.png" width="50%" loading="lazy"/></p>
<p>在 <code>resources</code> 下创建一个名为 <code>config</code> 的目录，在该目录中创建 <code>application.yml</code> 配置文件，而在该配置文件中将端口号设置为 <code>81</code>，内容如下:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># resources/config/application.yml，第3级，类路径下的config目录</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">81</span>
</code></pre>
<p>在 <code>resources</code> 下创建的 <code>application.yml</code> 配置文件中并将端口号设置为 <code>80</code>，内容如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># resources/application.yml，第4级，类路径根目录</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
</code></pre>
<h4 data-id="heading-40">验证优先级</h4>
<p><strong>验证第3级与第4级的优先级</strong></p>
<p>运行启动引导类，观察控制台日志。你会发现应用使用的端口是 <strong><code>81</code></strong>。</p>
<p><strong>结论</strong>：位于 <code>classpath:/config/</code>（第3级）的配置文件，其优先级<strong>高于</strong> <code>classpath:/</code>（第4级）的配置文件。所以 <code>81</code> 覆盖了 <code>80</code>。</p>
<p><strong>验证第1级与第3级的优先级</strong></p>
<p>接下来，我们创建一个更高优先级（第1级）的配置来覆盖之前的设置。</p>
<ol>
<li><strong>打包应用</strong>：在IDEA的Maven工具窗口中，双击 <code>Lifecycle</code> 下的 <code>package</code>，将工程打成 <code>jar</code> 包。</li>
<li><strong>定位JAR包</strong>：在项目 <code>target</code> 目录下找到生成的 <code>springboot_06_config_file-0.0.1-SNAPSHOT.jar</code> 文件。</li>
<li><strong>创建外部配置文件</strong>：
<ol>
<li>在 <strong><code>jar</code>包所在的同级目录</strong>下，创建一个名为 <code>config</code> 的文件夹。</li>
<li>在该 <code>config</code> 文件夹内，创建一个 <code>application.yml</code> 文件，并设置端口：</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
<span class="hljs-attr">port:</span> <span class="hljs-number">82</span>   <span class="hljs-comment"># 端口设置为82</span>
</code></pre>
</li>
<li><strong>通过命令行启动</strong>：打开命令行，进入JAR包所在目录，执行：
<pre><code class="hljs language-bash" lang="bash">java -jar springboot_06_config_file-0.0.1-SNAPSHOT.jar
</code></pre>
</li>
</ol>
<p>观察控制台日志，应用使用的端口是 <strong><code>82</code></strong>。</p>
<p><strong>结论</strong>：位于 <code>file:./config/</code>（第1级，JAR包外部的config目录）的配置文件，其优先级<strong>最高</strong>，覆盖了所有内部配置。</p>
<blockquote>
<p>注意：<br/>
<strong>配置文件加载是叠加的</strong>：Spring Boot 会从<strong>所有这4个位置</strong>加载配置文件，并将它们合并。高优先级位置的配置值会覆盖低优先级位置的<strong>相同属性</strong>，而不同属性则会<strong>累积生效</strong>。</p>
</blockquote>
<h4 data-id="heading-41">实际应用意义</h4>
<p>理解配置文件的优先级，在项目部署和运维中至关重要：</p>

























<table><thead><tr><th align="left">场景</th><th align="left">操作与好处</th></tr></thead><tbody><tr><td align="left"><strong>开发阶段</strong></td><td align="left">使用 <code>resources/application.yml</code> （第4级），配置个人开发环境。</td></tr><tr><td align="left"><strong>团队测试</strong></td><td align="left">测试人员可以在JAR包外的 <code>config/application.yml</code> （第1级）放置测试数据库等配置，<strong>无需修改或重新打包项目</strong>。</td></tr><tr><td align="left"><strong>生产部署</strong></td><td align="left">运维人员将包含数据库密码等敏感信息的生产配置放在服务器上JAR包外部的 <code>config</code> 目录下，实现<strong>代码与敏感配置分离</strong>，更安全。</td></tr><tr><td align="left"><strong>临时调试</strong></td><td align="left">在JAR包同级目录（第2级）放一个简易配置，可快速覆盖某个属性进行调试。</td></tr></tbody></table>
<h2 data-id="heading-42">SpringBoot 整合 JUnit</h2>
<p>单元测试是保证代码质量的重要环节。相较于传统的 Spring 项目，SpringBoot 整合测试框架变得特别简单。</p>
<h3 data-id="heading-43">环境准备</h3>
<ol>
<li>
<p>创建一个名为 <code>springboot_07_test</code> 的 <code>SpringBoot</code> 工程，工程目录结构如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00e0106c039f401cb7ad4c57cde4ad05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=SS3E9mI3lb1vB3auCOPdSb9ink0%3D" alt="image.png" width="50%" loading="lazy"/></p>
</li>
<li>
<p>创建业务层接口与实现类，这是待测试的目标。</p>
</li>
</ol>
<ul>
<li><strong>接口 (<code>BookService</code>)</strong>: 在 <code>com.itheima.service</code> 包下。
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 业务接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BookService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>;
}
</code></pre>
</li>
<li><strong>实现类 (<code>BookServiceImpl</code>)</strong>: 在 <code>com.itheima.service.impl</code> 包下。<strong><code>@Service</code></strong> 注解将其声明为Spring容器管理的Bean。
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span> <span class="hljs-comment">// 关键：这个注解将该实现类注册为Spring的Bean</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BookService</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"book service is running ..."</span>);
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-44">编写测试类</h3>
<p>在 <code>src/test/java</code> 下的对应包（通常与主代码包名一致，例如 <code>com.itheima</code>）中创建测试类，并将 <code>BookService</code> 注入到该测试类中。</p>
<p><strong>核心步骤</strong>：</p>
<ol>
<li><strong>添加测试注解</strong>：在类上标注 <code>@SpringBootTest</code>。这个注解是测试的基石，它会启动一个为测试准备的Spring应用上下文。</li>
<li><strong>注入测试对象</strong>：使用 <code>@Autowired</code> 像在普通Spring Bean中一样，注入要测试的Service。</li>
<li><strong>编写测试方法</strong>：在方法上使用JUnit的 <code>@Test</code> 注解。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 标记此类为SpringBoot测试类，运行测试时会加载完整的应用上下文</span>
<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot07TestApplicationTests</span> {

    <span class="hljs-comment">// 2. 自动注入要测试的业务组件</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BookService bookService;

    <span class="hljs-comment">// 3. 测试方法</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSave</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 调用方法并断言结果</span>
        bookService.save();
        <span class="hljs-comment">// 此处可以添加更多断言，例如：</span>
        <span class="hljs-comment">// assertThat(...).isEqualTo(...);</span>
    }
}
</code></pre>
<p><strong>执行测试</strong><br/>
在IDEA中，你可以直接点击测试方法旁边的绿色箭头运行单个测试，或直接运行整个测试类。执行后控制台将看到：</p>
<ol>
<li>Spring Boot 测试上下文启动。</li>
<li>你的 <code>BookServiceImpl</code> 被成功注入。</li>
<li>控制台输出：<code>book service is running ...</code></li>
<li>测试通过（通常以绿色对勾显示）。</li>
</ol>
<p><strong>最重要的规则：包位置约定</strong></p>
<p><code>@SpringBootTest</code> 注解在<strong>默认情况</strong>下，会从<strong>当前测试类所在的包开始，向上扫描</strong>，寻找主配置类（<code>@SpringBootApplication</code> 标注的类）。</p>
<p><strong>为了保证主配置类能自动找到，请遵循以下约定：</strong></p>
<blockquote>
<p><strong>测试类的逻辑包名（由 <code>package</code> 语句定义），必须是主启动类的逻辑包名的子包或同一个包。</strong><br/>
判断逻辑包名是否匹配，与这个类物理上位于 <code>src/main/java</code> 还是 <code>src/test/java</code> 无关。测试类放在 <code>src/test/java/com/itheima</code>，主启动类在 <code>src/main/java/com/itheima</code>，这是完全正确且能正常运行的，它们在逻辑上属于同一个包 <code>com.itheima</code>。</p>
</blockquote>
<p><strong>不符合约定时如何解决？</strong></p>
<p>如果测试类无法放在约定范围内，必须在 <code>@SpringBootTest</code> 注解中<strong>显式指定主启动类</strong>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 当测试类不在主启动类所在包或其子包下时</span>
<span class="hljs-meta">@SpringBootTest(classes = Springboot07TestApplication.class)</span> <span class="hljs-comment">// 手动指定主启动类的Class对象</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OtherPackageTest</span> {
    ......
}
</code></pre>
<p><strong>同时也建议在 <code>@SpringBootTest</code> 注解中，总是通过 <code>classes</code> 属性显式指定主启动类。这是最明确、最可靠的方式。</strong></p>
<h2 data-id="heading-45">SpringBoot 整合 Mybatis</h2>
<h3 data-id="heading-46">回顾传统 Spring 整合 Mybatis 的复杂性</h3>
<p>传统的 Spring 整合 Mybatis 需要编写大量的配置类，步骤繁琐，主要体现在：</p>
<ol>
<li><strong>数据源配置</strong>：需手动读取 <code>jdbc.properties</code> 并创建 <code>DataSource</code> Bean。</li>
<li><strong>Mybatis 集成</strong>：需手动配置 <code>SqlSessionFactoryBean</code> 和 <code>MapperScannerConfigurer</code>。</li>
<li><strong>配置组装</strong>：需通过 <code>@Import</code> 将多个配置类组合。</li>
</ol>
<p>这种方式配置项分散，依赖管理复杂，容易出错。</p>
<h3 data-id="heading-47">SpringBoot 整合 Mybatis（极简步骤）</h3>
<p>SpringBoot 通过 <strong>“起步依赖”</strong> 和 <strong>“自动配置”</strong> 极大简化了整合过程。只需几步：</p>
<ol>
<li>
<p>创建模块并选择依赖<br/>
使用 Spring Initializr 创建模块勾选依赖时，勾选上 <strong><code>SQL</code> -&gt; <code>MyBatis Framework</code></strong> 和 <strong><code>MySQL Driver</code></strong>。IDEA 会自动在 <code>pom.xml</code> 中添加相应依赖。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb72656f9e7e4d2aabe102793ac4aa58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=zL0W40%2BAcFP19WwMywsBe0G3gMc%3D" alt="image.png" width="80%" loading="lazy"/></p>
</li>
<li>
<p>定义实体类 (<code>Book</code>)<br/>
在 <code>com.itheima.domain</code> 包下创建，包含属性及 getter/setter。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String type;
    <span class="hljs-keyword">private</span> String description;
    <span class="hljs-comment">// ... getter, setter, toString</span>
}
</code></pre>
</li>
<li>
<p>定义 Dao 接口 (<code>BookDao</code>)<br/>
在 <code>com.itheima.dao</code> 包下创建。在接口上添加 <strong><code>@Mapper</code></strong> 注解，这样 MyBatis 才会为其创建实现类并交给 Spring 管理。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span> <span class="hljs-comment">// 关键注解：标识这是一个 MyBatis 的 Mapper 接口</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BookDao</span> {
    <span class="hljs-meta">@Select("select * from tbl_book where id = #{id}")</span> <span class="hljs-comment">// MyBatis 注解，定义 SQL</span>
    <span class="hljs-keyword">public</span> Book <span class="hljs-title function_">getById</span><span class="hljs-params">(Integer id)</span>;
}
</code></pre>
</li>
<li>
<p>定义测试类<br/>
在 <code>src/test/java</code> 的对应包（如 <code>com.itheima</code>）下创建。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Springboot08MybatisApplicationTests</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BookDao bookDao; <span class="hljs-comment">// 直接注入 MyBatis Mapper</span>

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetById</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Book</span> <span class="hljs-variable">book</span> <span class="hljs-operator">=</span> bookDao.getById(<span class="hljs-number">1</span>);
        System.out.println(book);
    }
}
</code></pre>
</li>
<li>
<p>编写数据库配置 (<code>application.yml</code>)<br/>
所有配置集中于一个文件，结构清晰。</p>
</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span> <span class="hljs-comment"># 数据库驱动</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</span> <span class="hljs-comment"># 数据库连接URL，注意时区参数</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span> <span class="hljs-comment"># 用户名</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span> <span class="hljs-comment"># 密码</span>
</code></pre>
<blockquote>
<p><strong>注意</strong>：若使用 <code>SpringBoot</code> 版本低于2.4.3(不含)，Mysql驱动版本高于8.0时，，<strong>必须在 <code>url</code> 中配置时区</strong>，如 <code>serverTimezone=UTC</code> 或 <code>Asia/Shanghai</code>，否则可能连接失败。</p>
</blockquote>
<ol start="7">
<li>切换为 Druid 数据源（可选）<br/>
SpringBoot 默认使用 HikariCP 数据源，如需换为阿里 Druid：
<ol>
<li>添加 Druid 依赖 (<code>pom.xml</code>)：</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<ol start="2">
<li>修改配置文件 (<code>application.yml</code>)，通过 <code>type</code> 指定数据源类型：</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span> <span class="hljs-comment"># 关键：指定使用 Druid 数据源</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-48">综合案例：将传统 SSM 项目迁移至 SpringBoot</h2>
<p>这个案例旨在将你之前用 Spring + SpringMVC + MyBatis (SSM) 完成的整合项目，改造成 SpringBoot 项目。</p>
<p>改造的核心是 <strong>“做减法”</strong>：移除 XML 和 Java 配置类，利用 SpringBoot 的自动配置和起步依赖。下图清晰地展示了从传统 SSM 迁移到 SpringBoot 的核心变化与操作流程：\ <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/410a1b00a9aa4e1589908cc735778c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=40ehmKySkh9iKDcp%2BPlXzDs0agE%3D" alt="deepseek_mermaid_20260201_a514c0.png" width="100%" loading="lazy"/></p>
<h3 data-id="heading-49">创建 SpringBoot 工程</h3>
<ol>
<li>使用 Spring Initializr 创建新模块，命名为 <code>springboot_09_ssm</code>。</li>
<li><strong>关键步骤</strong>：在选择依赖时，必须勾选：
<ul>
<li><strong><code>Spring Web</code></strong> (提供Web能力)</li>
<li><strong><code>MyBatis Framework</code></strong> (整合MyBatis)</li>
<li><strong><code>MySQL Driver</code></strong> (连接MySQL)</li>
</ul>
</li>
<li>由于案例使用 Druid 数据源，还需在创建后，手动在 <code>pom.xml</code> 中添加其依赖坐标。
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.16<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-50">代码迁移与改造</h3>
<p>将原有 SSM 项目 (<code>springmvc_11_page</code>) 中的业务代码直接拷贝到新工程的对应包下。这是迁移中<strong>最大的一块工作，但主要是复制粘贴</strong>。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f64ffc4f310c43feb6c7f388a3250a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YOh5p2w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542430&amp;x-signature=VsZGSwZ6OCsgtkLjAki7S7Ke4%2BM%3D" alt="image.png" width="100%" loading="lazy"/>
<p><strong>需要进行的改造非常有限，只有以下三点：</strong></p>
<ul>
<li>删除<code>config</code> 包及包内所有配置类（<code>/config</code> 目录），SpringBoot 的自动配置已经替代了这些手动配置。</li>
<li><code>dao</code> 包下的接口拷贝到 <code>springboot_09-ssm</code> 工程中后，在每一个接口定义上方添加 <code>@Mapper</code> 注解
<blockquote>
<p><strong>替代方案</strong>：如果Dao接口很多，不想每个都加，可以在<strong>主启动类</strong>上添加 <code>@MapperScan(“com.itheima.dao”)</code> 注解，一次性扫描整个包。但在此案例中为求清晰，推荐使用 <code>@Mapper</code>。</p>
</blockquote>
</li>
<li><code>BookServiceTest</code> 测试需要改成 <code>SpringBoot</code> 整合 <code>junit</code> 的形式。</li>
</ul>
<h3 data-id="heading-51">编写配置文件 (<code>application.yml</code>)</h3>
<p>在 <code>application.yml</code> 配置文件中需要配置如下内容</p>
<ul>
<li>服务的端口号</li>
<li>连接数据库的信息</li>
<li>数据源</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 服务器配置</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>  <span class="hljs-comment"># 将端口改为80，访问时可省略端口号</span>

<span class="hljs-comment"># Spring相关配置</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-comment"># 1. 指定使用 Druid 数据源</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span>
    <span class="hljs-comment"># 2. 数据库驱动 (MySQL 8.0+ 使用 `cj.jdbc.Driver`)</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-comment"># 3. 数据库连接URL，注意时区参数</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/ssm_db?serverTimezone=Asia/Shanghai</span>
    <span class="hljs-comment"># 4. 用户名和密码</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
</code></pre>
<p><strong>说明</strong>：</p>
<ul>
<li><code>type</code>：指定数据源类型。如果不指定，SpringBoot 默认使用高性能的 <code>HikariDataSource</code>。</li>
<li><code>serverTimezone</code>：连接 MySQL 8.0 或更高版本时，<strong>强烈建议在URL中设置时区</strong>，如 <code>Asia/Shanghai</code> 或 <code>UTC</code>，否则可能因时区不一致导致连接失败或时间错误。</li>
</ul>
<h3 data-id="heading-52">处理静态资源（页面、图片、CSS/JS）</h3>
<p>这是与SSM项目<strong>结构上差异最大</strong>的地方。</p>
<ul>
<li><strong>SSM 惯例</strong>：静态资源放在 <code>webapp</code> 目录下（如 <code>webapp/pages/</code>）。</li>
<li><strong>SpringBoot 惯例</strong>：<strong>没有 <code>webapp</code> 目录</strong>。静态资源需要放在 <code>src/main/resources</code> 下的特定子目录中。</li>
</ul>
<p><strong>SpringBoot 寻找静态资源的默认路径（优先级从高到低）</strong>：</p>
<ol>
<li><code>classpath:/META-INF/resources/</code></li>
<li><code>classpath:/resources/</code></li>
<li><code>classpath:/static/</code> <strong>（最常用、推荐的位置）</strong></li>
<li><code>classpath:/public/</code></li>
</ol>
<p><strong>操作</strong>：将旧项目 <code>webapp</code> 下的所有内容（如 <code>.html</code>, <code>.css</code>, <code>.js</code>, 图片），<strong>整体拷贝</strong>到新项目的 <code>src/main/resources/static/</code> 目录下即可。</p>
<p>例如，你的 <code>index.html</code> 原来在 <code>webapp/pages/index.html</code>，现在应该放在 <code>src/main/resources/static/pages/index.html</code>。启动应用后，可以直接通过 <code>http://localhost/pages/index.html</code> 访问。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[明明环境变量已经解密，为啥@ConfigurationProperties 注入还是加密值？]]></title>    <link>https://juejin.cn/post/7601757036486180874</link>    <guid>https://juejin.cn/post/7601757036486180874</guid>    <pubDate>2026-02-01T09:22:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036486180874" data-draft-id="7601374668961087538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="明明环境变量已经解密，为啥@ConfigurationProperties 注入还是加密值？"/> <meta itemprop="keywords" content="后端,Spring Boot"/> <meta itemprop="datePublished" content="2026-02-01T09:22:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="javadaydayup"/> <meta itemprop="url" content="https://juejin.cn/user/2436173497635703"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            明明环境变量已经解密，为啥@ConfigurationProperties 注入还是加密值？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173497635703/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    javadaydayup
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:22:22.000Z" title="Sun Feb 01 2026 09:22:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题背景</h2>
<p>在微服务的 application.properties 文件中有一个 <code>test.container-name</code> 配置。原始配置如下：</p>
<pre><code class="hljs language-json" lang="json">test.container-name=Tomcat
</code></pre>
<p>同时有一个 Java 类 <code>TestConfigProperty</code> 中通过 <code>@ConfigurationProperties</code> 注解注入这个配置属性到它的变量 <code>containerName</code> 中，代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ConfigurationProperties(prefix = "test")</span>  
<span class="hljs-meta">@Component</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestConfigProperty</span> {  
    <span class="hljs-keyword">private</span> String containerName;  
  
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getContainerName</span><span class="hljs-params">()</span> {  
        <span class="hljs-keyword">return</span> containerName;  
    }  
  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setContainerName</span><span class="hljs-params">(String containerName)</span> {  
        <span class="hljs-built_in">this</span>.containerName = containerName;  
    }  
}
</code></pre>
<p>现在因为 <code>test.container-name</code> 配置包含敏感信息，不能直接配置原始的值，需要配置加密之后的值，在微服务启动的时候解密。现在是 <code>test.container-name</code> 配置引用了 <code>TEST_CONTAINER_NAME</code> 环境变量。配置如下：</p>
<pre><code class="hljs language-json" lang="json">test.container-name=$<span class="hljs-punctuation">{</span>TEST_CONTAINER_NAME<span class="hljs-punctuation">}</span>
</code></pre>
<p>然后在环境变量中配置了加密之后的值。在本案例中为了简化，这里加密就用的 Base64 编码作为示例演示。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca0f88057f3e4d5eae36f559d6e01316~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=gMr0YUyh5qjOQBz3ADuPbKgWnkA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e52a4f158d6a4f6e93734ccf6d542123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=3VNIDUS4SGCIatuyqV5mykvdiuY%3D" alt="image.png" loading="lazy"/></p>
<p>在项目中有框架提供了在微服务启动时对加密后的字符串解密的能力，实现的基本原理是提供了一个 <code>DecryptEnvironmentPostProcessor</code> 类扩展了 <code>EnvironmentPostProcessor</code>。</p>
<p>在它的 <code>postProcessEnvironment()</code> 方法中，判断环境变量配置的值是否是以 <code>ENC_</code> 开头，如果是则进行解密。解密之后放到一个 <code>MapPropertySource</code> 里面，然后添加到所有的 <code>PropertySource</code> 的前面。示例代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecryptEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span>, Ordered {  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DECRYPTED_SOURCE_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"decryptedSystemEnvironment"</span>;  
  
    <span class="hljs-meta">@Override</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {  
        <span class="hljs-type">String</span> <span class="hljs-variable">systemEnvName</span> <span class="hljs-operator">=</span> StandardEnvironment.SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME;  
        <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">systemEnvSource</span> <span class="hljs-operator">=</span> (MapPropertySource) environment.getPropertySources().get(systemEnvName);  
        Map&lt;String, Object&gt; decryptedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  
        <span class="hljs-keyword">if</span> (systemEnvSource == <span class="hljs-literal">null</span>) {  
            <span class="hljs-keyword">return</span>;  
        }  
        systemEnvSource.getSource().forEach((key, value) -&gt; {  
            <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String strVal) {  
                <span class="hljs-comment">// 这里进行了解密</span>
                <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(strVal) &amp;&amp; strVal.startsWith(<span class="hljs-string">"ENC_"</span>)) {  
                    <span class="hljs-type">String</span> <span class="hljs-variable">plainText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getDecoder().decode(strVal.substring(<span class="hljs-number">4</span>)));  
                    decryptedMap.put(key, plainText);  
                }  
            }  
        });  
  
        <span class="hljs-keyword">if</span> (!decryptedMap.isEmpty()) {  
            <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">decryptedSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(DECRYPTED_SOURCE_NAME, decryptedMap);  
            <span class="hljs-comment">// 这里添加到所有的PropertySource的前面</span>
            environment.getPropertySources().addBefore(systemEnvName, decryptedSource);  
        }  
    }  
  
    <span class="hljs-meta">@Override</span>  
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOrder</span><span class="hljs-params">()</span> {  
        <span class="hljs-keyword">return</span> Ordered.LOWEST_PRECEDENCE;  
    }  
}
</code></pre>
<p>按照上述配置，通过调试发现类 <code>TestConfigProperty</code> 里面注入的还是加密之后的值，而并不是想要的解密之后的值。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7febef8cf8d64f9eab907bfc32976d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=3I3BTahEgirLSaZpetbx551a75E%3D" alt="image.png" loading="lazy"/>
查看 <code>Environment</code> 的 <code>getPropertySources()</code> 方法的返回值中，解密之后的环境变量属性配置确实是在未解密的环境变量属性配置之前，按照直观上的理解，那应该注入的是解密之后的值才对，但是实际结果却不是这样的。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/391d4555f2d24e7590c802929faa12a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=v8iGSq8AM1P5eIPa68BSjrhBwuM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">问题原理</h2>
<p>之前的文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1920208706978678739" target="_blank" title="https://zhuanlan.zhihu.com/p/1920208706978678739" ref="nofollow noopener noreferrer">这就是宽松的适配规则！</a>里面讲了宽松适配的原理。在 Spring 的框架体系中是在 <code>ConfigurationPropertiesBindingPostProcessor</code> 中的 <code>postProcessBeforeInitialization()</code> 中实现对有 <code>@ConfigurationProperties</code> 注解修饰类的属性进行绑定的。</p>
<p>在它的内部实际上是通过调用 <code>ConfigurationPropertiesBinder</code> 的 <code>bind()</code> 来实现属性绑定的。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationPropertiesBindingPostProcessor</span>
    <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span>, PriorityOrdered, ApplicationContextAware, InitializingBean {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException {
        <span class="hljs-keyword">if</span> (!hasBoundValueObject(beanName)) {
            bind(ConfigurationPropertiesBean.get(<span class="hljs-built_in">this</span>.applicationContext, bean, beanName));
        }
        <span class="hljs-keyword">return</span> bean;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(ConfigurationPropertiesBean bean)</span> {
        <span class="hljs-keyword">if</span> (bean == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span>;
        }
        Assert.state(bean.asBindTarget().getBindMethod() != BindMethod.VALUE_OBJECT,
                <span class="hljs-string">"Cannot bind @ConfigurationProperties for bean '"</span> + bean.getName()
                        + <span class="hljs-string">"'. Ensure that @ConstructorBinding has not been applied to regular bean"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 这里实际上是调用了ConfigurationPropertiesBinder的bind()方法</span>
            <span class="hljs-built_in">this</span>.binder.bind(bean);
        }
        <span class="hljs-keyword">catch</span> (Exception ex) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationPropertiesBindException</span>(bean, ex);
        }
    }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30abd11f72ee4451bd3485b0efd1b517~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=zkmWXk%2BIPF0kJ62wXNgIDc7hwEQ%3D" alt="image.png" loading="lazy"/></p>
<p>在 <code>ConfigurationPropertiesBinder</code> 的 <code>bind()</code> 方法又调用了 <code>Binder</code> 的 <code>bind()</code> 方法。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96c6b918c1c149d097e70002cd3ce457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=AbRbeZHWRpArvIKHGQC7b%2BvJx2U%3D" alt="image.png" loading="lazy"/></p>
<p>在调用  <code>Binder</code> 的 <code>bind()</code> 方法时，会把注解上配置的前缀传进去，在本案例中就是 <code>test</code>，并基于这个前缀创建一个 <code>ConfigurationPropertyName</code> 对象，然后最终调用到 <code>bindObject()</code> 方法。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Binder</span> {
    <span class="hljs-keyword">public</span> &lt;T&gt; BindResult&lt;T&gt; <span class="hljs-title function_">bind</span><span class="hljs-params">(String name, Bindable&lt;T&gt; target, BindHandler handler)</span> {
        <span class="hljs-comment">// 这里基于test前缀创建了ConfigurationPropertyName对象</span>
        <span class="hljs-keyword">return</span> bind(ConfigurationPropertyName.of(name), target, handler);
    }
    
    <span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">bind</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target, BindHandler handler, Context context,
        <span class="hljs-type">boolean</span> allowRecursiveBinding, <span class="hljs-type">boolean</span> create)</span> {
        <span class="hljs-keyword">try</span> {
            Bindable&lt;T&gt; replacementTarget = handler.onStart(name, target, context);
            <span class="hljs-keyword">if</span> (replacementTarget == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> handleBindResult(name, target, handler, context, <span class="hljs-literal">null</span>, create);
            }
            target = replacementTarget;
            <span class="hljs-comment">// 调用bindObject()方法</span>
            <span class="hljs-type">Object</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> bindObject(name, target, handler, context, allowRecursiveBinding);
            <span class="hljs-keyword">return</span> handleBindResult(name, target, handler, context, bound, create);
        }
        <span class="hljs-keyword">catch</span> (Exception ex) {
            <span class="hljs-keyword">return</span> handleBindError(name, target, handler, context, ex);
        }
    }
}
</code></pre>
<p>在  <code>bindObject()</code> 中首先调用 <code>findProperty()</code> 方法查找属性，因为当前只是前缀 <code>test</code>，因此肯定是找不到对应的属性配置的。 因此往下走会调用到 <code>bindDataObject()</code>方法。对于 JavaBean 来说，在 <code>Binder</code> 的 <code>bindDataObject()</code> 方法最终会调用到 <code>JavaBeanBinder</code> 的 <code>bind()</code> 方法。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Binder</span> {
    <span class="hljs-keyword">private</span> &lt;T&gt; Object <span class="hljs-title function_">bindObject</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target, BindHandler handler,
	    Context context, <span class="hljs-type">boolean</span> allowRecursiveBinding)</span> {
	    <span class="hljs-type">ConfigurationProperty</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> findProperty(name, target, context);
	    <span class="hljs-keyword">if</span> (property == <span class="hljs-literal">null</span> &amp;&amp; context.depth != <span class="hljs-number">0</span> &amp;&amp; containsNoDescendantOf(context.getSources(), name)) {
	        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	    }
	    <span class="hljs-comment">// 省略中间代码</span>
	    
	    <span class="hljs-comment">//调用bindDataObject()方法</span>
	    <span class="hljs-keyword">return</span> bindDataObject(name, target, handler, context, allowRecursiveBinding);
	}

    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">bindDataObject</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;?&gt; target, BindHandler handler,
            Context context, <span class="hljs-type">boolean</span> allowRecursiveBinding)</span> {
        <span class="hljs-keyword">if</span> (isUnbindableBean(name, target, context)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        Class&lt;?&gt; type = target.getType().resolve(Object.class);
        <span class="hljs-type">BindMethod</span> <span class="hljs-variable">bindMethod</span> <span class="hljs-operator">=</span> target.getBindMethod();
        <span class="hljs-keyword">if</span> (!allowRecursiveBinding &amp;&amp; context.isBindingDataObject(type)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 注意这里的lambda表达式，在JavaBeanBinder的bind()方法最终又会调用到这个lambda表达式</span>
        <span class="hljs-type">DataObjectPropertyBinder</span> <span class="hljs-variable">propertyBinder</span> <span class="hljs-operator">=</span> (propertyName, propertyTarget) -&gt; bind(name.append(propertyName),
                propertyTarget, handler, context, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
                
	    <span class="hljs-comment">// 这里会调用到JavaBeanBinder的bind()方法</span>
        <span class="hljs-keyword">return</span> context.withDataObject(type, () -&gt; fromDataObjectBinders(bindMethod,
                (dataObjectBinder) -&gt; dataObjectBinder.bind(name, target, context, propertyBinder)));
    }
}
</code></pre>
<p>在 <code>JavaBeanBinder</code> 的 <code>bind()</code> 方法中会获取这个对象的所有的 <code>BeanProperty</code>，然后又反调用回 <code>Binder</code> 中的lambda表达式了。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaBeanBinder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DataObjectBinder</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">bind</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target, Context context,
            DataObjectPropertyBinder propertyBinder)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">hasKnownBindableProperties</span> <span class="hljs-operator">=</span> target.getValue() != <span class="hljs-literal">null</span> &amp;&amp; hasKnownBindableProperties(name, context);
        Bean&lt;T&gt; bean = Bean.get(target, hasKnownBindableProperties);
        <span class="hljs-keyword">if</span> (bean == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        BeanSupplier&lt;T&gt; beanSupplier = bean.getSupplier(target);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> bind(propertyBinder, bean, beanSupplier, context);
        <span class="hljs-keyword">return</span> (bound ? beanSupplier.get() : <span class="hljs-literal">null</span>);
    }
    
    <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(DataObjectPropertyBinder propertyBinder, Bean&lt;T&gt; bean, BeanSupplier&lt;T&gt; beanSupplier,
        Context context)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (BeanProperty beanProperty : bean.getProperties().values()) { <span class="hljs-comment">// 获取这个对象上所有的BeanProperty属性</span>
            bound |= bind(beanSupplier, propertyBinder, beanProperty);
            context.clearConfigurationProperty();
        }
        <span class="hljs-keyword">return</span> bound;
    }
    
    <span class="hljs-keyword">private</span> &lt;T&gt; <span class="hljs-type">boolean</span> <span class="hljs-title function_">bind</span><span class="hljs-params">(BeanSupplier&lt;T&gt; beanSupplier, DataObjectPropertyBinder propertyBinder,
        BeanProperty property)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">propertyName</span> <span class="hljs-operator">=</span> determinePropertyName(property);
        <span class="hljs-type">ResolvableType</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> property.getType();
        Supplier&lt;Object&gt; value = property.getValue(beanSupplier);
        Annotation[] annotations = property.getAnnotations();
        <span class="hljs-type">Object</span> <span class="hljs-variable">bound</span> <span class="hljs-operator">=</span> propertyBinder.bindProperty(propertyName, <span class="hljs-comment">//这个地方实际上又反调用回Binder中的lambda表达式了</span>
                Bindable.of(type).withSuppliedValue(value).withAnnotations(annotations));
        <span class="hljs-keyword">if</span> (bound == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">if</span> (property.isSettable()) {
            property.setValue(beanSupplier, bound);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span> || !bound.equals(value.get())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"No setter found for property: "</span> + property.getName());
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p><code>BeanProperty</code> 对象会将 JavaBean 中的属性统一为 Dash 格式。在本案例中属性名称是 <code>containerName</code>，统一之后就变成了 <code>container-name</code>。如下图所示：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8eb95c0912154e9c998600207f72451f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=Qg0dmDKlyy1kzjRH%2F%2FS6uc7tY9U%3D" alt="image.png" loading="lazy"/></p>
<p>在 <code>Binder</code> 中 lambda 表达式会将属性拼接到已有的 <code>ConfigurationPropertyName</code> 前缀上，在本案例中就变成了 <code>test.container-name</code>。然后又递归调用 <code>bind()</code> 方法，然后又调用 <code>findProperty()</code> 方法尝试从从对应的 <code>ConfigurationPropertySource</code> 中获取对应的配置中查找这个属性。</p>
<p>Spring 提供了 <code>SpringIterableConfigurationPropertySource</code> 作为 <code>ConfigurationPropertySource</code> 实现类， 它实际是对 <code>PropertySource</code> 的一个适配，内部有一个 <code>propertySource</code> 表示真正的配置。通过调试 <code>contex.getSource()</code> 方法的返回值，可以看到加密之后的 <code>PropertySource</code> 确实是在没有加密的前面。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">DataObjectPropertyBinder</span> <span class="hljs-variable">propertyBinder</span> <span class="hljs-operator">=</span> (propertyName, propertyTarget) -&gt; bind(name.append(propertyName), <span class="hljs-comment">//这里将属性名称拼接到test前缀上</span>
		propertyTarget, handler, context, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
                
<span class="hljs-keyword">private</span> &lt;T&gt; ConfigurationProperty <span class="hljs-title function_">findProperty</span><span class="hljs-params">(ConfigurationPropertyName name, Bindable&lt;T&gt; target,
    Context context)</span> {
    <span class="hljs-keyword">if</span> (name.isEmpty() || target.hasBindRestriction(BindRestriction.NO_DIRECT_PROPERTY)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">for</span> (ConfigurationPropertySource source : context.getSources()) {
        <span class="hljs-type">ConfigurationProperty</span> <span class="hljs-variable">property</span> <span class="hljs-operator">=</span> source.getConfigurationProperty(name);
        <span class="hljs-keyword">if</span> (property != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> property;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61dc8d5ecac64fafa6638bb1c22e1d19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgamF2YWRheWRheXVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542542&amp;x-signature=Ze2HUTIra0Fo%2BWL%2FCYZ%2FYG7krL4%3D" alt="image.png" loading="lazy"/></p>
<p>在 <code>getConfigurationProperty()</code> 方法中首先调用父类 <code>SpringConfigurationPropertySource</code> 的 <code>getConfigurationProperty()</code> 方法。在该方法中会调用 <code>PropertyMapper</code> 的 <code>map()</code> 方法对传入的 <code>ConfigurationPropertyName</code> 类型的 <code>name</code> 进行转换，然后根据转换后拿到的名称去 <code>PropertySource</code> 中获取对应的属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfigurationPropertySource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigurationPropertySource</span> {
    <span class="hljs-keyword">public</span> ConfigurationProperty <span class="hljs-title function_">getConfigurationProperty</span><span class="hljs-params">(ConfigurationPropertyName name)</span> {
        <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">for</span> (PropertyMapper mapper : <span class="hljs-built_in">this</span>.mappers) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (String candidate : mapper.map(name)) { <span class="hljs-comment">// 这里先通过PropertyMapper转换名称</span>
                    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> getPropertySource().getProperty(candidate); <span class="hljs-comment">// 根据转换后的名称获取获取对应的属性</span>
                    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
                        <span class="hljs-type">Origin</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> PropertySourceOrigin.get(<span class="hljs-built_in">this</span>.propertySource, candidate);
                        <span class="hljs-keyword">return</span> ConfigurationProperty.of(<span class="hljs-built_in">this</span>, name, value, origin);
                    }
                }
            }
            <span class="hljs-keyword">catch</span> (Exception ex) {
                <span class="hljs-comment">// Ignore</span>
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>在创建 <code>SpringConfigurationPropertySource</code> 对象时，会根据 <code>PropertySource</code> 是 <code>MapPropertySource</code> 还是 <code>SystemEnvironmentPropertySource</code> ，从而设置不同的 <code>mappers</code> 属性，对于 <code>SystemEnvironmentPropertySource</code>，它会多一个 <code>SystemEnvironmentPropertyMapper</code> 。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringConfigurationPropertySource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConfigurationPropertySource</span> {
   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> PropertyMapper[] DEFAULT_MAPPERS = { DefaultPropertyMapper.INSTANCE };

   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> PropertyMapper[] SYSTEM_ENVIRONMENT_MAPPERS = { SystemEnvironmentPropertyMapper.INSTANCE,
    DefaultPropertyMapper.INSTANCE };
    
   <span class="hljs-keyword">static</span> SpringConfigurationPropertySource <span class="hljs-title function_">from</span><span class="hljs-params">(PropertySource&lt;?&gt; source)</span> {
        Assert.notNull(source, <span class="hljs-string">"Source must not be null"</span>);
        PropertyMapper[] mappers = getPropertyMappers(source);
        <span class="hljs-keyword">if</span> (isFullEnumerable(source)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringIterableConfigurationPropertySource</span>((EnumerablePropertySource&lt;?&gt;) source, mappers);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpringConfigurationPropertySource</span>(source, mappers);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> PropertyMapper[] getPropertyMappers(PropertySource&lt;?&gt; source) {
        <span class="hljs-comment">// 这里判断了如果是SystemEnvironmentPropertySource则会返回SYSTEM_ENVIRONMENT_MAPPERS，里面包含了SystemEnvironmentPropertyMapper</span>
        <span class="hljs-keyword">if</span> (source <span class="hljs-keyword">instanceof</span> SystemEnvironmentPropertySource &amp;&amp; hasSystemEnvironmentName(source)) {
            <span class="hljs-keyword">return</span> SYSTEM_ENVIRONMENT_MAPPERS;
        }
        <span class="hljs-keyword">return</span> DEFAULT_MAPPERS;
    }
}
</code></pre>
<p>对于 <code>DefaultPropertyMapper</code> 它的 <code>map()</code> 方法会直接返回 <code>ConfigurationPropertyName</code> 的名称，在本案例中就会直接返回 <code>test.container-name</code>。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultPropertyMapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertyMapper</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(ConfigurationPropertyName configurationPropertyName)</span> {
        <span class="hljs-comment">// Use a local copy in case another thread changes things</span>
        LastMapping&lt;ConfigurationPropertyName, List&lt;String&gt;&gt; last = <span class="hljs-built_in">this</span>.lastMappedConfigurationPropertyName;
        <span class="hljs-keyword">if</span> (last != <span class="hljs-literal">null</span> &amp;&amp; last.isFrom(configurationPropertyName)) {
            <span class="hljs-keyword">return</span> last.getMapping();
        }
        <span class="hljs-comment">// 这里直接返回ConfigurationPropertyName的名称</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">convertedName</span> <span class="hljs-operator">=</span> configurationPropertyName.toString();
        List&lt;String&gt; mapping = Collections.singletonList(convertedName);
        <span class="hljs-built_in">this</span>.lastMappedConfigurationPropertyName = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LastMapping</span>&lt;&gt;(configurationPropertyName, mapping);
        <span class="hljs-keyword">return</span> mapping;
    }
}
</code></pre>
<p>对于 <code>SystemEnvironmentPropertyMapper</code> 它会返回两个格式的名称，在本案例中就会返回 <code>TEST_CONTAINERNAME</code> 和 <code>TEST_CONTAINER_NAME</code> 两种格式。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SystemEnvironmentPropertyMapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PropertyMapper</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">PropertyMapper</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemEnvironmentPropertyMapper</span>();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">map</span><span class="hljs-params">(ConfigurationPropertyName configurationPropertyName)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> convertName(configurationPropertyName);
        <span class="hljs-type">String</span> <span class="hljs-variable">legacyName</span> <span class="hljs-operator">=</span> convertLegacyName(configurationPropertyName);
        <span class="hljs-keyword">if</span> (name.equals(legacyName)) {
            <span class="hljs-keyword">return</span> Collections.singletonList(name);
        }
        <span class="hljs-comment">// 这里会返回两个格式的名称</span>
        <span class="hljs-keyword">return</span> Arrays.asList(name, legacyName);
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">convertName</span><span class="hljs-params">(ConfigurationPropertyName name)</span> {
        <span class="hljs-keyword">return</span> convertName(name, name.getNumberOfElements());
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">convertName</span><span class="hljs-params">(ConfigurationPropertyName name, <span class="hljs-type">int</span> numberOfElements)</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numberOfElements; i++) {
            <span class="hljs-keyword">if</span> (!result.isEmpty()) {
                result.append(<span class="hljs-string">'_'</span>);
            }
            result.append(name.getElement(i, Form.UNIFORM).toUpperCase(Locale.ENGLISH));
        }
        <span class="hljs-keyword">return</span> result.toString();
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">convertLegacyName</span><span class="hljs-params">(ConfigurationPropertyName name)</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; name.getNumberOfElements(); i++) {
            <span class="hljs-keyword">if</span> (!result.isEmpty()) {
                result.append(<span class="hljs-string">'_'</span>);
            }
            result.append(convertLegacyNameElement(name.getElement(i, Form.ORIGINAL)));
        }
        <span class="hljs-keyword">return</span> result.toString();
    }

    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">convertLegacyNameElement</span><span class="hljs-params">(String element)</span> {
        <span class="hljs-keyword">return</span> element.replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">'_'</span>).toUpperCase(Locale.ENGLISH);
    }
}
</code></pre>
<p>在本案例中<code>decryptedSystemEnvironment</code> 的 <code>PropertySource</code> 类型是 <code>MapPropertySource</code>，存放的内容是 <code>TEST_CONTAINER_NAME=Tomcat</code>。它只有 <code>DefaultPropertyMapper</code>；</p>
<p>名称为 <code>systemEnvironment</code> 的 <code>PropertySource</code> 类型是 <code>SystemEnvironmentPropertySource</code>，存放的内容是 <code>TEST_CONTAINER_NAME=ENC_VG9tY2F0</code>。它有<code>DefaultPropertyMapper</code> 和 <code>SystemEnvironmentPropertyMapper</code>。</p>
<p><code>decryptedSystemEnvironment</code> 在顺序上排在 <code>systemEnvironment</code> 前面。这个时候开始查找传入名称为 <code>test.container-name</code> 的 <code>ConfigurationPropertyName</code>，这个时候先从 <code>decryptedSystemEnvironment</code> 开始找，经过 <code>DefaultPropertyMapper</code> 转换之后拿到的属性名称是 <code>test.container-name</code>，配置里面没有这个配置；然后从 <code>systemEnvironment</code> 开始找，经过 <code>SystemEnvironmentPropertyMapper</code> 转换之后拿到的属性名称是<code>TEST_CONTAINERNAME</code> 和 <code>TEST_CONTAINER_NAME</code>，根据 <code>TEST_CONTAINER_NAME</code> 就拿到了 <code>ENC_VG9tY2F0</code> 。这就解释了为啥配置类注入的还是加密之后的值了。</p>
<h2 data-id="heading-2">问题解决</h2>
<p>知道问题的原理了之后，问题就好解决了。一种方法是可以在 <code>DecryptEnvironmentPostProcessor</code> 类的 <code>postProcessBeforeInitialization()</code> 方法中把添加的 <code>MapPropertySource</code> 类型改为 <code>SystemEnvironmentPropertySource</code> 就可以了。代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {  
    <span class="hljs-type">String</span> <span class="hljs-variable">systemEnvName</span> <span class="hljs-operator">=</span> StandardEnvironment.SYSTEM_ENVIRONMENT_PROPERTY_SOURCE_NAME;  
    <span class="hljs-type">MapPropertySource</span> <span class="hljs-variable">systemEnvSource</span> <span class="hljs-operator">=</span> (MapPropertySource) environment.getPropertySources().get(systemEnvName);  
    Map&lt;String, Object&gt; decryptedMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();  
    <span class="hljs-keyword">if</span> (systemEnvSource == <span class="hljs-literal">null</span>) {  
        <span class="hljs-keyword">return</span>;  
    }  
    systemEnvSource.getSource().forEach((key, value) -&gt; {  
        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String strVal) {  
            <span class="hljs-keyword">if</span> (StringUtils.isNotEmpty(strVal) &amp;&amp; strVal.startsWith(<span class="hljs-string">"ENC_"</span>)) {  
                <span class="hljs-type">String</span> <span class="hljs-variable">plainText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getDecoder().decode(strVal.substring(<span class="hljs-number">4</span>)));  
                decryptedMap.put(key, plainText);  
            }  
        }  
    });  
  
    <span class="hljs-keyword">if</span> (!decryptedMap.isEmpty()) {  
		<span class="hljs-comment">// 这里原来添加的是MapPropertySource类型，现在调整为SystemEnvironmentPropertySource类型</span>
        <span class="hljs-comment">// MapPropertySource decryptedSource = new MapPropertySource(DECRYPTED_SOURCE_NAME, decryptedMap);  </span>
        environment.getPropertySources().addBefore(systemEnvName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SystemEnvironmentPropertySource</span>(DECRYPTED_SOURCE_NAME, decryptedMap));  
        System.out.println(<span class="hljs-string">""</span>);  
    }  
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型训练全流程实战指南工具篇（五）——大模型训练全流程步骤详解与对应工具推荐]]></title>    <link>https://juejin.cn/post/7601313474719301667</link>    <guid>https://juejin.cn/post/7601313474719301667</guid>    <pubDate>2026-02-01T09:22:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719301667" data-draft-id="7601077764423483442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型训练全流程实战指南工具篇（五）——大模型训练全流程步骤详解与对应工具推荐"/> <meta itemprop="keywords" content="人工智能,DeepSeek,LangChain"/> <meta itemprop="datePublished" content="2026-02-01T09:22:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型训练全流程实战指南工具篇（五）——大模型训练全流程步骤详解与对应工具推荐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:22:49.000Z" title="Sun Feb 01 2026 09:22:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上篇文章《<a href="https://juejin.cn/post/7597650322409291828" target="_blank" title="https://juejin.cn/post/7597650322409291828">大模型训练全流程实战指南基础篇（四）——本地部署大模型API调用实战：Python对接OpenAI格式全解析</a>》介绍了如何通过代码调用本地部署的大模型，实现自动化任务处理。至此，大家已经掌握了模型文件结构、模型本地部署与API代码调用的基本技能。</p>
<p>从本期内容开始，本系列将进入<strong>工具篇</strong>。在<strong>工具篇</strong>笔者首先会系统梳理大模型训练的整体流程，并针对训练流程的每个阶段推荐相应的实用工具；随后，笔者将挑选其中具有代表性的工具进行详细讲解与实战演示。工具篇之后将进入<strong>实战篇</strong>，笔者会带领大家运用所学工具，完整走通从数据准备、模型训练到最终部署上线的全流程。可以说，工具篇是承上启下的关键环节，希望大家认真学习，为后续实战打下坚实基础。</p>
<p>本期内容笔者会帮助大家建立对大模型训练全流程的结构化认知，同时为每个环节提供可操作的工具推荐。大家可以借助推荐工具动手实践，逐步构建属于自己的大模型训练工作流。</p>
<p>需要注意的是，大模型训练对计算资源尤其是GPU显存有较高要求。为降低学习与实践门槛，笔者已与国内主流云平台合作，为大家争取到了<strong>H100 GPU 6.5小时</strong>的免费算力体验机会。只需点击链接 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> 即可领取。本系列所有实战环节均将基于该平台完成，助力大家以更低成本上手大模型训练。</p>
<h2 data-id="heading-1">一、大模型训练全流程概述</h2>
<p>大模型训练的整体流程通常可分为三大核心阶段：<strong>数据阶段</strong>、<strong>训练阶段</strong>与<strong>评测阶段</strong>。每个阶段又可进一步细分为若干关键步骤。</p>
<ul>
<li><strong>数据工程</strong>：主要包括文本采集、文本过滤、文本清洗与去重及数据集构建等步骤。</li>
<li><strong>训练工程</strong>：若从零开始设计模型，通常需经历选择基础架构、确定模型规模、设计模型结构与功能，随后进行预训练、监督微调（SFT）及强化学习对齐（RLHF）等步骤。然而，完全从头训练需消耗海量数据与巨额算力（例如数十亿条数据与数十台服务器并行），这对中小团队或个人开发者而言往往难以承担。因此，更常见的做法是在已有的预训练模型基础上，进行<strong>增量预训练</strong>、<strong>微调</strong>和<strong>强化学习</strong>步骤，本系列内容笔者首先会分享基于Qwen3等开源大模型的训练，在最后扩展篇也会带大家使用Pytorch从0到1手写模型并完成训练部署。</li>
<li><strong>评测工程</strong>：模型训练完成后必须经过系统评估，主要包括自动基准测试评估与人工深入评估两部分。</li>
</ul>
<p>了解整体流程后，大家可能仍对每个子环节的具体作用，以及应选用哪些工具进行处理感到困惑。别担心，接下来笔者将逐一详解各环节，并推荐相应的常用工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21a785e525a24cf5845453827e3793af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=6YXdXN4fM3rR2HTCMEUJP3H2g88%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-2">二、数据工程阶段详解</h2>
<p>数据工程阶段的核心任务，是将原始数据转化、处理为可用于大模型训练的高质量数据集。大模型本质上可以视作一个庞大的“知识库”，其能力直接源自于训练数据中所蕴含信息的广度与质量。尤其对于大语言模型（LLM）而言，如何获取并有效处理高价值的文本语料，是整个训练流程中最为关键的基石。该阶段主要包含以下四个核心环节。</p>
<h3 data-id="heading-3">2.1 文本采集</h3>
<p>文本采集旨在从各类来源收集原始文本材料，为后续处理提供基础原料。</p>
<p><strong>数据来源分类：</strong></p>
<ol>
<li><strong>需自行采集与处理的数据源</strong>：包括网页数据、书籍、学术论文、百科全书、社交媒体文本等。</li>
<li><strong>已公开的成熟数据集</strong>：例如由专业机构发布的 <code>Common Crawl</code>（PB级网络爬虫数据仓库）等大规模语料库。</li>
<li><strong>大模型知识蒸馏</strong>：通过构造覆盖特定知识领域的问题集，从现有大模型（如 GPT-4、Claude 等）的回复中提取知识，生成训练数据。相关原理可参考<a href="https://juejin.cn/post/7471648566849241128#heading-0" target="_blank" title="https://juejin.cn/post/7471648566849241128#heading-0">《大模型指南——蒸馏、量化、微调》</a>。</li>
<li><strong>商业数据采购</strong>：直接向专业数据公司购买经过清洗和标注的高质量数据集。</li>
</ol>
<p><strong>相关处理与工具推荐：</strong></p>
<ul>
<li>
<p><strong>自行采集数据</strong>：可使用专业爬虫工具（如<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bazhuayu.com%2Fabout%3Fref%3DzMROaF%26snid%3D1769871274214030731_xBCKjLSp%26x_collect_uid%3D4281d340ad8fa681f9bfadd5500339c7" target="_blank" title="https://www.bazhuayu.com/about?ref=zMROaF&amp;snid=1769871274214030731_xBCKjLSp&amp;x_collect_uid=4281d340ad8fa681f9bfadd5500339c7" ref="nofollow noopener noreferrer">八爪鱼</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bright.cn%2F%3Fps_partner_key%3Dd2VpanVuemh1OTEzNQ%26ps_xid%3DJ2teLLup1rP75t%26gsxid%3DJ2teLLup1rP75t%26gspk%3Dd2VpanVuemh1OTEzNQ%26utm_source%3Daffiliates%26utm_campaign%3Dd2VpanVuemh1OTEzNQ" target="_blank" title="https://www.bright.cn/?ps_partner_key=d2VpanVuemh1OTEzNQ&amp;ps_xid=J2teLLup1rP75t&amp;gsxid=J2teLLup1rP75t&amp;gspk=d2VpanVuemh1OTEzNQ&amp;utm_source=affiliates&amp;utm_campaign=d2VpanVuemh1OTEzNQ" ref="nofollow noopener noreferrer">亮数据</a>）或自行编写脚本（推荐使用 Python 的 <code>Scrapy</code> 等框架）。若目标为训练通用大模型，建议参考百度百科或学科门类（我国共13类：哲、经、法、教、文、史、理、工、农、医、军、管、艺）进行针对性爬取，以保证数据多样性及质量。若爬取得到的数据源为图片或扫描件，需通过 OCR 技术（推荐 <code>MinerU</code>工具、<code>DeepSeek-OCR</code> 模型）转为文本，更多OCR工具可参考笔者文章<a href="https://juejin.cn/post/7564921269491040271" target="_blank" title="https://juejin.cn/post/7564921269491040271">OCR技术简史: 从深度学习到大模型，最强OCR大模型花落谁家</a>。</p>
</li>
<li>
<p><strong>使用公开数据集</strong>：Hugging Face、ModelScope 等平台汇聚了大量开源数据集。例如，下图展示了智源研究院在 ModelScope 上开源的 <code>IndustryCorpus2</code> 分类预训练数据集，可直接下载使用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5fd995a6a974cafb63daddbcbd39935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=aOtvtO9p8LjTiliCGAfoyipdtRY%3D" alt="1.png" loading="lazy"/></p>
</li>
<li>
<p><strong>大模型知识蒸馏</strong>：核心是编写 Python 脚本调用大模型 API 进行问答生成。工具方面，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.easy-dataset.com%2F" target="_blank" title="https://docs.easy-dataset.com/" ref="nofollow noopener noreferrer">EasyDataset</a> 提供了便捷的界面，可指定主题（如“中国历史”）后自动构造问题并从大模型中蒸馏数据。</p>
</li>
</ul>
<h3 data-id="heading-4">2.2 文本过滤</h3>
<p>采集到的原始数据（尤其是网络爬虫数据）通常质量参差不齐，必须过滤掉低价值或有害内容，以保证训练数据的纯净度。</p>
<p><strong>处理流程：</strong></p>
<p>此步骤旨在识别并剔除广告、仇恨言论、大量无意义重复文本等低质量内容。公开数据集与蒸馏数据通常质量较高，可适度简化此步骤。</p>
<p><strong>相关处理与工具推荐：</strong></p>
<p>文本过滤通常需自行编写处理脚本，主要有以下三类方法：</p>
<ol>
<li><strong>模型过滤</strong>：调用大模型 API（如本地部署的模型），利用其强大的理解能力判断文本质量。<strong>优点</strong>：准确性高；<strong>缺点</strong>：处理速度慢，成本较高。</li>
<li><strong>统计指标过滤</strong>：编写 Python 脚本，计算文本的 n-gram、词汇多样性等统计特征，并训练轻量级分类模型（如基于 TF-IDF 的模型）进行自动过滤。</li>
<li><strong>规则过滤</strong>：基于专家经验，编写正则表达式或关键词列表，快速匹配并过滤垃圾短语、特定违规内容等。</li>
</ol>
<h3 data-id="heading-5">2.3 文本清洗与去重</h3>
<p>过滤后的文本需进一步规范化，并去除冗余信息，以确保数据的一致性和高效性。</p>
<p><strong>处理流程：</strong></p>
<ol>
<li><strong>清洗</strong>：检测并处理剩余的无效片段（非有害但无信息量的文本）、统一文本编码格式（如统一转为 UTF-8）、处理特殊字符与乱码。</li>
<li><strong>多语言对齐</strong>：若需训练跨语言模型，需进行平行语料（如中-英句子对）的对齐工作。</li>
<li><strong>去重</strong>：在文档级、段落级或句子级识别并去除重复内容，避免模型过度拟合相同信息。</li>
</ol>
<p><strong>相关处理与工具推荐：</strong></p>
<ul>
<li><strong>编码规范化</strong>：使用 Python 的 <code>codecs</code> 或 <code>chardet</code> 库进行自动检测与转换。</li>
<li><strong>无效片段检测</strong>：可继续使用大模型或轻量级文本分类模型进行判断。</li>
<li><strong>平行语料对齐</strong>：可使用专业工具，如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tmxmall.com%2Faligner%2Fhome" target="_blank" title="https://www.tmxmall.com/aligner/home" ref="nofollow noopener noreferrer">Tmxmall 在线对齐工具</a> 或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcorpus.shisu.edu.cn%2F5a%2Ff1%2Fc9380a154353%2Fpage.htm" target="_blank" title="https://corpus.shisu.edu.cn/5a/f1/c9380a154353/page.htm" ref="nofollow noopener noreferrer">SISU Aligner 2.0.0</a>。也可编写脚本调用机器翻译 API 进行粗对齐后人工校验。</li>
<li><strong>去重</strong>：可使用高效的算法（如 MinHash）编写脚本自行实现，或直接使用 Hugging Face 的 <strong>SemHash</strong> 开源工具去重。</li>
</ul>
<h3 data-id="heading-6">2.4 数据集构建</h3>
<p>此环节将清洗后的高质量原始文本，转换为大模型训练可直接使用的标准化数据格式。</p>
<p><strong>处理流程与数据格式：</strong></p>
<ol>
<li>
<p><strong>预训练数据集</strong>：格式通常为连续的纯文本块（<code>json</code>或<code>jsonl</code> 格式，每个对象包含一个 <code>"text"</code> 字段）。关键在于文本块的切分策略，需尽量保证知识单元的完整性（如按段落、章节切分）。可借鉴 RAG（检索增强生成）中知识库的文档切分算法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0465097199402ba4875dba776e17f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=s1D%2FJHRosC%2B8dbWDVMy4gLPr8fY%3D" alt="3.png" loading="lazy"/></p>
</li>
<li>
<p><strong>监督微调（SFT）数据集</strong>：格式为对话或指令-回答对（多轮对话）。若需训练模型具备思维链（Chain-of-Thought）能力，数据中需包含推理过程（常置于 <code>&lt;think&gt;...&lt;/think&gt;</code> 标签内，并将其和输出合并置于ouput字段）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b6c3f3383c64c66aab4d3719f26de87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=zubWwWvld6BNJKR7diPpWtsteSU%3D" alt="4.png" loading="lazy"/></p>
</li>
<li>
<p><strong>偏好对齐数据集</strong>：用于训练PPO算法中的关键奖励模型（RM）或进行 DPO/ORPO 训练。每条数据包含一个指令（或问题），以及一个被选中的（<code>chosen</code>）优质回答和一个被拒绝的（<code>rejected</code>）劣质回答。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74d0a467de4c4e0cb7bb1b69be69d337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=K5n3yvizszm763Mft1EL37%2BilsM%3D" alt="5.png" loading="lazy"/></p>
</li>
</ol>
<p><strong>相关处理与工具推荐：</strong></p>
<ul>
<li><strong>预训练数据切分</strong>：编写python脚本处理，可借鉴 RAGFlow、Dify 等工具中的智能分块算法，或自行实现固定长度、文档结构、章节感知等分块算法。</li>
<li><strong>监督微调数据生成</strong>：可使用 <code>EasyDataset</code> 等工具辅助生成，或编写脚本调用大模型 API 批量合成。</li>
<li><strong>偏好对齐数据生成</strong> 通常选取大量的评测集对初步训练的模型进行测试，选取表现较差的问答对，将问题预期的结果作为<code>chosen</code>, 实际生成的较差的回答作为<code>rejected</code>。</li>
</ul>
<h3 data-id="heading-7">2.5 工具调用与最佳实践</h3>
<p>数据质量是决定大模型性能上限的关键因素。在实际工作中，数据工程往往占据整个训练流程80%以上的精力。</p>
<ul>
<li>
<p><strong>对于领域适配或指令微调</strong>：推荐组合使用以下工具：</p>
<ul>
<li>使用 <strong>RAGFlow</strong> 等知识库的智能文本分割算法处理长文档。</li>
<li>使用 <strong>EasyDataset</strong> 高效构建指令微调、思维链或知识蒸馏数据集。</li>
</ul>
</li>
<li>
<p><strong>对于追求极致性能的精细优化</strong>：通常需要深入代码层面，进行数据合成增强、难度分级、负样本挖掘等更复杂的操作。相关高阶技巧与代码实践，将在本系列的扩展篇中详细展开。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dd22a270f6d4ccead98c2b74a2aefd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=NBIvQY6EYTZ8%2F7cuah9aaGUFMiU%3D" alt="14.png" loading="lazy"/></p>
<h2 data-id="heading-8">三、 训练工程阶段详解</h2>
<p>与数据工程相比，训练工程阶段的工具链和标准化流程更为成熟。整个训练过程通常划分为三个核心且环环相扣的阶段：<strong>预训练</strong>、<strong>监督微调（SFT）</strong>  和 <strong>强化学习对齐（如RLHF）</strong> 。关于这三阶段的作用，笔者在 <a href="https://juejin.cn/post/7594655863548297268" target="_blank" title="https://juejin.cn/post/7594655863548297268">大模型训练全流程实战指南（一）——为什么要学习大模型训练？</a>也基本提及过，笔者将其形象地比喻为  <strong>“培养一位超级学霸”</strong>  的过程：先海量阅读构建知识体系，再接受专业指导掌握方法，最后通过实践反馈优化言行。</p>
<h3 data-id="heading-9">3.1 预训练阶段</h3>
<p>预训练的核心目标，是将经过处理的海量文本数据中的语言规律和世界知识，“压缩”存储到大模型的参数中。在 <a href="https://juejin.cn/post/7594728203258347554" target="_blank" title="https://juejin.cn/post/7594728203258347554">大模型训练全流程实战指南基础篇（二）——大模型文件结构解读与原理解析</a>中笔者提过大模型预测的本质是学习语言的概率分布：模型通过数十亿乃至数万亿的token，学会根据给定的上文预测下一个最可能的词，从而掌握语法、事实和基础推理能力。这相当于让模型“读完整个图书馆的书”，建立起对世界的通用认知框架。</p>
<p>对于希望获得领域专家的模型（如法律、医疗），直接从头预训练成本过高。更可行的路径是 <strong>增量预训练（Continued Pre-training）</strong> ：在一个通用基座模型（如LLaMA、Qwen）基础上，使用领域专有数据（如法律条文、医学文献）继续训练。这能显著提升模型在特定领域的知识深度，但需注意可能伴随的 <strong>灾难性遗忘</strong> 问题——即模型在新领域变强的同时，可能损失部分原有通用能力。</p>
<h3 data-id="heading-10">3.2 微调阶段</h3>
<p>预训练模型虽“学识渊博”，却不懂如何与人类交流。例如，当被问及“长江”时，它可能仅基于统计关联回答“黄河”，而非给出有用信息。<strong>监督微调（SFT）</strong>  正是为了解决“如何与人对话”的问题。此阶段使用 <strong>高质量的指令-回答对数据集</strong>，以有监督的方式训练模型，目标是：</p>
<ul>
<li><strong>理解意图</strong>：学会解析各式各样的人类指令（如“写诗”、“总结文章”）。</li>
<li><strong>安全合规</strong>：遵循伦理准则，避免生成有害、偏见或虚构内容。</li>
<li><strong>格式化输出</strong>：能够按要求组织答案（如使用列表、分点论述）。</li>
</ul>
<p>这个过程好比让那位“学霸”进入实习期，由导师（高质量数据）手把手地教导其沟通礼仪、回答技巧与行为边界。在实际应用中，许多垂直领域模型会直接对通用基座模型进行SFT，以快速“激活”其在该领域的潜在能力，而跳过增量预训练阶段。</p>
<h3 data-id="heading-11">3.3 强化学习阶段</h3>
<p>掌握了知识与方法后，还需要通过反馈机制来优化行为，使其更符合人类的主观偏好和价值判断。这便是强化学习对齐阶段的任务。</p>
<p>以主流的 基于人类反馈的强化学习（RLHF）为例，该阶段通常分为两步：</p>
<ol>
<li><strong>训练奖励模型（RM）</strong> ：使用 偏好数据集（包含人类标注员选择的“好回答”与“差回答”），训练一个独立的模型作为“裁判”，学习评判回答质量的高低。</li>
<li><strong>优化策略模型</strong>：利用PPO等强化学习算法，让待优化的大模型（策略模型）生成回答，并由奖励模型打分。模型通过不断试错，学习生成能获得更高奖励（即更符合人类偏好）的回答。</li>
</ol>
<p>这如同为“实习生”配备了一位严格的实战教练，通过持续的练习与即时反馈，不断打磨其表现，直至其产出结果既专业又令人满意。</p>
<h3 data-id="heading-12">3.4 工具调用与最佳实践</h3>
<p>在工程实现上，模型训练主要分为两种路径，对应不同的开发深度与效率需求：</p>
<p><strong>1. 底层研发式训练</strong><br/>
适用于需要全新架构探索或深度定制的研究团队，通常是从0开发大模型的团队</p>
<ul>
<li><strong>核心框架</strong>：直接使用 <strong>PyTorch</strong> 与 <strong>Transformers</strong> 库从零构建训练流程。</li>
<li><strong>分布式与优化</strong>：大模型训练必须依赖分布式技术。典型组合是：<strong>Ray</strong>（分布式计算框架） + <strong>DeepSpeed</strong>（深度学习优化库，支持ZeRO、卸载等技术）来实现多机多卡高效训练。</li>
</ul>
<p><strong>2. 高效微调与一体化训练（推荐）</strong><br/>
对于绝大多数基于现有模型进行适配的专用模型训练场景，使用高层框架可以极大提升效率。</p>
<ul>
<li>
<p><strong>单卡高效微调</strong>：<strong>Unsloth</strong> 是当前的性能标杆，专注于极致优化LoRA等参数高效微调技术。</p>
</li>
<li>
<p><strong>一体化训练框架</strong>：</p>
<ul>
<li><strong>LLaMA Factory</strong>：提供Web UI和命令行，无需编码即可完成预训练、全参数/高效微调、强化学习等全流程。本系列后续实战将基于此框架进行。</li>
<li><strong>MS-SWIFT</strong>：由阿里团队开源，深度优化对Qwen系列模型的训练支持，同样提供易用的配置化训练。</li>
</ul>
</li>
<li>
<p><strong>强化学习专用库</strong>：</p>
<ul>
<li><strong>VeRL</strong>：字节跳动开源的通用强化学习库。</li>
<li><strong>Easy-R1</strong>：与LLaMA Factory同团队开发，基于VeRL，专门为大模型及多模态的强化学习对齐设计。</li>
</ul>
</li>
</ul>
<p><strong>最佳实践建议</strong>：<br/>
对于希望快速上手的开发者，推荐使用 <strong>LLaMA Factory</strong> 完成从数据准备到模型微调的全流程。本系列合作的实训平台 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> 已提供预置环境，可一键开启实践。对于有定制化强化学习需求的场景，可在VeRL或Easy-R1的基础上进行二次开发。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b114bff3c3f546fb9a9e441a75767f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=ZzUL4FjUwK7Ib78xFjeSYl10fpg%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-13">四、评测工程阶段详解</h2>
<p>模型训练完成并非终点，科学、系统的评估是衡量模型能力、发现潜在缺陷并指导后续迭代的关键环节。评测工程的目标是全面回答一个问题： <strong>“训练的模型效果究竟如何？”</strong>  通常从两个层次分析模型的实际效果：<strong>自动化的基准测试</strong>与<strong>深入的人工评估</strong>，这就好像一个学生既要参加标准化的期末考试，也需要老师在期末的时候写评语。</p>
<h3 data-id="heading-14">4.1 自动化基准测试</h3>
<p>自动评估通过一系列精心设计的标准化测试集和量化指标，对模型的各项能力进行快速、可重复的客观衡量。</p>
<p><strong>自动化评测常用数据集</strong>：</p>
<ul>
<li><strong>知识与推理</strong>：使用如 <strong>MMLU</strong>（大规模多任务语言理解）、<strong>C-Eval</strong>（中文知识评估）、<strong>GSM8K</strong>（数学推理）等基准，评估模型在专业领域、常识和逻辑推理方面的能力。</li>
<li><strong>代码能力</strong>：使用 <strong>HumanEval</strong>、<strong>MBPP</strong> 等数据集，评估模型生成可执行、符合要求的代码的能力。</li>
<li><strong>中文综合能力</strong>：针对中文模型，常用 <strong>CMMLU</strong>、<strong>Gaokao-Bench</strong>（高考题库）等评估其本土化理解与知识应用水平。</li>
<li><strong>对齐与安全性</strong>：使用 <strong>SafeBench</strong>、<strong>CValues</strong> 等数据集，评估模型输出是否安全、无害、符合价值观。</li>
</ul>
<p>以上测试集中既包含<strong>MMLU</strong>、<strong>C-Eval</strong>等一些专项知识的选择题，又包含<strong>GSM8K</strong>含标准答案的模型推理题以及<strong>Gaokao-Bench</strong>等主观求解题，全面评测模型的全部能力。</p>
<p><strong>关键指标：</strong></p>
<ul>
<li><strong>准确率（Accuracy）</strong> ：最直观的指标，适用于选择题、判断题等封闭式任务。</li>
<li><strong>NLP指标</strong>：文本类指标评测，评判生成回答与预期结果之间的语言相关程度，包括<strong>召回率（Rouge）、精确度（Precision）、F1分数、BLEU指标</strong>(这些指标具体含义笔者在介绍评测工具使用时会详细讲解)。</li>
<li><strong>基于大模型打分的评估（LLM-as-a-Judge）</strong> ：利用DeepSeek等强大模型作为“裁判”，编写提示词，评估生成答案在相关性、有用性、安全性等方面的质量，也是评估开放性任务的主流方法。</li>
</ul>
<h3 data-id="heading-15">4.2 人工深入评估</h3>
<p>自动化测试虽高效，但难以完全捕捉模型在复杂、开放场景下的真实表现和细微缺陷。<strong>人工深入评估</strong>不可或缺，它侧重于：</p>
<ul>
<li><strong>指令遵循度</strong>：模型是否精确理解了复杂、多层次的指令</li>
<li><strong>输出逻辑与连贯性</strong>：答案是否条理清晰、逻辑自洽</li>
<li><strong>事实准确性</strong>：生成的内容是否存在“幻觉”（编造事实）</li>
<li><strong>安全与伦理边界</strong>：在边缘案例中，模型的应对是否妥当</li>
</ul>
<p>此阶段通常由领域专家或标注团队，通过设计多样化的真实用户场景（如客服对话、创意写作、分析报告）进行系统性测试和主观评分。</p>
<h3 data-id="heading-16">4.3 工具调用与最佳实践</h3>
<p>目前主流的开源评测工具已经极大地提升了评估效率。</p>
<ul>
<li><strong>OpenCompass</strong>：由上海人工智能实验室推出，是<strong>国内最全面的开源评测体系</strong>。它集成了海量的主流评测数据集，支持一键发起对多个模型在数百个能力维度上的自动化评测，并生成详细的排行榜和可视化报告，是进行基准测试的“瑞士军刀”。</li>
<li><strong>EvalScope</strong>：由阿里团队推出，一个<strong>面向生产场景的、可扩展的评测平台</strong>。它的核心优势在于  <strong>“集成”与“工作流”</strong>  。它不仅能将 OpenCompass 作为其一个强大的评测后端引擎来调用，还可以灵活集成企业内部的私有评测集、人工评估流程以及自定义的评估脚本。它提供了统一的评估任务管理、结果分析和对比界面，旨在将分散的评估工作标准化、流程化。</li>
</ul>
<p>综合来看，虽然 OpenCompass 在基准评测的广度上排名No.1，但对于追求从研发到上线全链路质量管控的团队而言，更推荐将 <strong>EvalScope</strong> 作为评测阶段的工具，<strong>EvalScope</strong>不仅可以快速集成OpenCompass后台，还具备模型服务压力测试等额外功能，适合全面的分析评测。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef0f772e39af459fafd2204f78b296ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770542569&amp;x-signature=oxobMHkLuuolCLMgiu88KlekQNQ%3D" alt="12.png" loading="lazy"/></p>
<h2 data-id="heading-17">五、总结</h2>
<p>本篇内容系统分享了大模型训练三大核心阶段（数据工程、训练工程、评测工程）的全流程，为每个环节推荐了如EasyDataset、LLaMA Factory、EvalScope等关键实用工具，旨在帮助读者构建清晰的训练路径。</p>
<p>从下期内容开始，笔者将分享这些工具的详细使用指南，首先分享OCR工具的相关知识，看看我们是如何把大家爬取的文档识别为统一的markdown格式，大家敬请期待！</p>
<p>大模型训练对计算资源有一定要求，尤其是GPU显存。为降低学习门槛，笔者与国内主流云平台合作，大家可以通过打开链接: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">Lab4AI</a> ，体验<strong>H100 GPU 6.5小时</strong>的算力。本系列所有实战教程均将在该平台上完成，帮助大家低成本上手实践。</p>
<p>除大模型训练外，笔者也在同步更新<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>免费专栏，要说明该专栏适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 37 讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号<strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端生存指南：离了这十个工具，我写代码像在裸奔]]></title>    <link>https://juejin.cn/post/7601076694105079844</link>    <guid>https://juejin.cn/post/7601076694105079844</guid>    <pubDate>2026-02-01T06:36:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105079844" data-draft-id="7601103779392438335" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端生存指南：离了这十个工具，我写代码像在裸奔"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-01T06:36:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="霞浦小码哥"/> <meta itemprop="url" content="https://juejin.cn/user/1996368847058071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端生存指南：离了这十个工具，我写代码像在裸奔
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1996368847058071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    霞浦小码哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:36:02.000Z" title="Sun Feb 01 2026 06:36:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>键盘敲得冒火星，不如插件点一下</p>
</blockquote>
<p>作为一名在代码海洋里摸爬滚打了六年的“霞浦小码哥”，我发现程序员分两种：一种是用对工具的，一种是加班到深夜的。今天，就让我掏出压箱底的<strong>十个前端神器</strong>，它们就像是我的“外挂装备”，没了它们，我写代码简直像在迷雾中裸奔。</p>
<h2 data-id="heading-0">1. Vite：启动快得像“开了挂”</h2>
<p><strong>定位</strong>：下一代前端构建工具</p>
<p>如果你还在用 Webpack 等热更新要3秒以上的工具，试试 Vite 吧，它会让你有种“机械硬盘换 NVMe 固态”的错觉。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目只要一行命令</span>
npm create vite@latest my-project -- --template react
</code></pre>
<p><strong>神奇之处</strong>：</p>
<ul>
<li>冷启动时间从几十秒降到<strong>1秒内</strong></li>
<li>热更新几乎是<strong>即时反馈</strong>（不到100ms）</li>
<li>天然的ES模块支持，不用再等打包</li>
</ul>
<p><strong>小码哥体验</strong>：第一次用 Vite 时，我盯着秒开的开发服务器，愣是刷新了三次浏览器，怀疑自己电脑是不是被谁偷偷升级了。</p>
<h2 data-id="heading-1">2. ESLint + Prettier：代码界的“强迫症二人组”</h2>
<p><strong>定位</strong>：代码质量守护神</p>
<p>这对组合就像你的代码“保洁阿姨”和“格式管家”，一个负责找脏乱差，一个负责收拾整齐。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .eslintrc.json 经典配置</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"airbnb"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"prettier"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"plugins"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"prettier"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"rules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prettier/prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"error"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>为什么离不开</strong>：</p>
<ul>
<li>ESLint：在你写出<code>==</code>时立刻提醒“应该用<code>===</code>”</li>
<li>Prettier：保存时自动格式化，团队代码像一个人写的</li>
<li>搭配 VS Code 保存自动修复，代码整洁度直接拉满</li>
</ul>
<h2 data-id="heading-2">3. Vue DevTools / React Developer Tools</h2>
<p><strong>定位</strong>：框架专属“X光透视仪”</p>
<p>这是调试 Vue 或 React 应用的“作弊器”，能直接看到组件树、状态变化，甚至能实时修改 props。</p>
<p><strong>超能力展示</strong>：</p>
<ul>
<li>组件层级一目了然，再深的嵌套也不怕</li>
<li>状态变化时间旅行，像看视频回放一样调试</li>
<li>性能分析，找出拖慢应用的那个“罪魁祸首”</li>
</ul>
<p><strong>真实场景</strong>：有一次产品说“这个按钮点了没反应”，我打开 DevTools，两秒定位到是某个 state 没更新，避免了半小时的 console.log 盲猜。</p>
<h2 data-id="heading-3">4. Tailwind CSS：我的“原子级CSS武器库”</h2>
<p><strong>定位</strong>：实用优先的 CSS 框架</p>
<p>传统 CSS 写法像是手动组装家具，Tailwind 则是给你一套完美的乐高积木。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 以前要写一堆CSS类名 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 现在直接组合实用类 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-6 max-w-sm mx-auto bg-white rounded-xl shadow-lg"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 样式都在HTML里，一目了然 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>真香理由</strong>：</p>
<ul>
<li>再也不用为类名起什么而纠结（告别<code>.user-card-wrapper-inner-content</code>）</li>
<li>设计一致性天然保障</li>
<li>打包时自动移除未使用的 CSS，最终文件小得感人</li>
</ul>
<h2 data-id="heading-4">5. Framer Motion：让动画简单得像“拖拽”</h2>
<p><strong>定位</strong>：React 动画库的“降维打击”</p>
<p>如果普通的 CSS 动画是自行车，Framer Motion 就是磁悬浮列车。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { motion } <span class="hljs-keyword">from</span> <span class="hljs-string">'framer-motion'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">motion.div</span>
  <span class="hljs-attr">initial</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">opacity:</span> <span class="hljs-attr">0</span>, <span class="hljs-attr">y:</span> <span class="hljs-attr">20</span> }}
  <span class="hljs-attr">animate</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">opacity:</span> <span class="hljs-attr">1</span>, <span class="hljs-attr">y:</span> <span class="hljs-attr">0</span> }}
  <span class="hljs-attr">transition</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">duration:</span> <span class="hljs-attr">0.5</span> }}
&gt;</span>
  我会优雅地淡入并向上移动！
<span class="hljs-tag">&lt;/<span class="hljs-name">motion.div</span>&gt;</span></span>
</code></pre>
<p><strong>惊艳之处</strong>：</p>
<ul>
<li>声明式API，动画逻辑清晰得像写配置</li>
<li>手势识别（拖拽、点击、悬停）内置支持</li>
<li>布局动画自动处理，元素位置变化时有平滑过渡</li>
</ul>
<h2 data-id="heading-5">6. Storybook：组件库的“独立展示厅”</h2>
<p><strong>定位</strong>：UI组件开发与测试环境</p>
<p>把你的组件像博物馆展品一样单独陈列、测试、文档化。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化Storybook</span>
npx storybook init
</code></pre>
<p><strong>工作流革命</strong>：</p>
<ul>
<li>开发组件时<strong>无需启动整个应用</strong></li>
<li>可视化测试不同 props 下的组件状态</li>
<li>自动生成组件文档，产品、设计、测试都能看明白</li>
</ul>
<p><strong>团队价值</strong>：我们团队用 Storybook 后，设计师直接在里面看组件效果，省去了“我改好了，你刷新看看”的无限循环。</p>
<h2 data-id="heading-6">7. Chrome Lighthouse：网站的“全身体检仪”</h2>
<p><strong>定位</strong>：网页性能一站式审计工具</p>
<p>在 Chrome DevTools 里直接按 F12 找到 Lighthouse，它就像给你的网站做全面体检，并给出“健康报告”。</p>
<p><strong>体检项目包括</strong>：</p>
<ul>
<li>性能评分（为什么我的页面这么慢？）</li>
<li>无障碍访问（视障用户能正常使用吗？）</li>
<li>SEO 优化（搜索引擎喜欢我的页面吗？）</li>
<li>最佳实践检查（用了HTTPS吗？控制台有错误吗？）</li>
</ul>
<p><strong>小码哥忠告</strong>：每次项目上线前跑一次 Lighthouse，能避免80%的性能问题投诉。</p>
<h2 data-id="heading-7">8. Figma插件生态：设计到代码的“传送门”</h2>
<p><strong>定位</strong>：设计协作平台的强大扩展</p>
<p>虽然 Figma 本身是设计工具，但它的插件生态对前端来说简直是“金矿”。</p>
<p><strong>必装插件</strong>：</p>
<ul>
<li><strong>Figma to Code</strong>：直接从设计稿生成 React/Vue/HTML 代码</li>
<li><strong>Content Reel</strong>：快速填充真实数据替代 Lorem ipsum</li>
<li><strong>Icon Scout</strong>：海量图标直接拖拽使用</li>
</ul>
<p><strong>工作流升级</strong>：设计师更新了样式，我这边插件一点，代码建议就出来了，再也不用像素眼对齐了。</p>
<h2 data-id="heading-8">9. Web Vitals扩展：性能监控的“仪表盘”</h2>
<p><strong>定位</strong>：实时核心Web指标监控</p>
<p>Google 推出的这个 Chrome 扩展，能在你浏览时实时显示页面的核心性能指标。</p>
<p><strong>三个关键指标</strong>：</p>
<ul>
<li><strong>LCP</strong>（最大内容绘制）：页面主要内容加载速度</li>
<li><strong>FID</strong>（首次输入延迟）：用户首次交互的响应速度</li>
<li><strong>CLS</strong>（累积布局偏移）：页面稳定性，防跳闪</li>
</ul>
<p><strong>实用场景</strong>：竞品分析时打开这个扩展，瞬间知道对方网站的性能底细，产品问“别人能做到为什么我们不行”时，数据说话。</p>
<h2 data-id="heading-9">10. GitHub Copilot：我的“AI结对编程伙伴”</h2>
<p><strong>定位</strong>：AI智能代码补全工具</p>
<p>这可能是最近两年最具争议也最震撼的工具。它不只是补全代码，而是能理解你的意图。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 我输入注释：</span>
<span class="hljs-comment">// 函数：防抖函数，延迟执行</span>

<span class="hljs-comment">// Copilot自动补全：</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, wait</span>) {
  <span class="hljs-keyword">let</span> timeout;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">executedFunction</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">later</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-built_in">clearTimeout</span>(timeout);
      <span class="hljs-title function_">func</span>(...args);
    };
    <span class="hljs-built_in">clearTimeout</span>(timeout);
    timeout = <span class="hljs-built_in">setTimeout</span>(later, wait);
  };
}
</code></pre>
<p><strong>使用心得</strong>：</p>
<ul>
<li>写工具函数时，描述一下功能，代码就出来了</li>
<li>写重复业务代码时，能节省大量敲键盘时间</li>
<li>学习新API时，看它给的示例比自己查文档快</li>
</ul>
<p><strong>重要提醒</strong>：Copilot 是很好的“副驾驶”，但别让它完全“掌握方向盘”，始终要保持对代码的理解和把控。</p>
<h2 data-id="heading-10">小码哥的工具哲学</h2>
<p>用了这么多工具，我悟出一个道理：<strong>好工具不是让你变懒，而是让你聚焦真正重要的问题</strong>。</p>
<p>这些工具帮我从：</p>
<ul>
<li>“为什么样式不对？” → 快速定位问题</li>
<li>“怎么实现这个动画？” → 复制粘贴改参数</li>
<li>“性能怎么优化？” → 数据驱动决策</li>
<li>“代码怎么写规范？” → 自动强制执行</li>
</ul>
<p>工具在变，但核心不变：<strong>用更少的时间，解决更多的问题，留出更多的时间给生活</strong>（比如我的乒乓球和摄影）。</p>
<hr/>
<p><strong>最后的建议</strong>：不要一次性把所有工具都装上，那样就像背着一身神装却不知道怎么用。选一两个最痛点的开始，等用顺手了再加新的。</p>
<p>毕竟，最好的工具，永远是那个你用起来像“手臂自然延伸”的工具。现在，就去给你的开发环境装上一两个“外挂”吧！</p>
<p>（写完这篇文章，我默默关掉了还在用 Webpack 的老项目，打开了 Vite 新项目，真香！）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【设计模式-2.1】创建型——单例模式]]></title>    <link>https://juejin.cn/post/7601441797117657139</link>    <guid>https://juejin.cn/post/7601441797117657139</guid>    <pubDate>2026-02-01T09:28:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601441797117657139" data-draft-id="7601441475986948142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【设计模式-2.1】创建型——单例模式"/> <meta itemprop="keywords" content="设计模式"/> <meta itemprop="datePublished" content="2026-02-01T09:28:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="何中应"/> <meta itemprop="url" content="https://juejin.cn/user/1435305504958535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【设计模式-2.1】创建型——单例模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1435305504958535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    何中应
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:28:18.000Z" title="Sun Feb 01 2026 09:28:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说明：设计模式根据用途分为创建型、结构性和行为型。创建型模式主要用于描述如何创建对象，本文介绍创建型中的单例模式。</p>
<h2 data-id="heading-0">饿汉式单例</h2>
<p>单例模式是比较常见的一种设计模式，旨在确保对象的唯一性，什么时候去使用这个对象都是同一个。这样设计的目的是为了避免对象重复创建，浪费资源，同时也保证了对象的唯一性，不至于多个相同的对象，状态不一致的情况。</p>
<p>以下是单例模式的简单实现：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 太阳类
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sun</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sun</span>();

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Sun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>需要注意，==对象的创建是在对象类内部，且为static final修饰，并且私有化构造方法，使其不能在外部被创建，其次创建一个静态方法，返回其对象==；</p>
<p>此时，外部通过类名.方法名的方式，可以访问到该对象，且始终为同一个；</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Sun</span> <span class="hljs-variable">sun1</span> <span class="hljs-operator">=</span> Sun.getInstance();
        <span class="hljs-type">Sun</span> <span class="hljs-variable">sun2</span> <span class="hljs-operator">=</span> Sun.getInstance();
        System.out.println(sun1 == sun2);
    }
}
</code></pre>
<p>两次获取到的对象相同</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43be59f3d3f4132baf9e7ab897346ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2V5Lit5bqU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543050&amp;x-signature=t6KHOWNv5SActLLEyg1zmpru%2FiU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>上面这种创建方式，称为==饿汉式单例（Eager Singleton），即类加载完成时就创建对象==；</p>
<h2 data-id="heading-1">懒汉式单例</h2>
<p>以下这种方式，称为==懒汉式单例（Lazy Singleton），在调用静态方法时才创建对象==；</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 懒汉式单例模式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>这种创建方式，可以实现延迟加载，节约资源。但是==在多线程并发时，如果有多个线程在if (sun == null)，就会导致对象被创建多次==，所以我们很容易想到的是加锁，将静态方法加上锁，如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 懒汉式单例模式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>但是，给方法加上锁后，会影响性能，可以考虑减少锁的范围，只锁住创建对象这一行，如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 懒汉式单例模式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (LazySun.class) {
                sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
            }
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<h2 data-id="heading-2">双重检查锁定</h2>
<p>但是，还有问题。在多线程并发下，如果线程A在创建对象（未完成），线程B、C在if (sun == null) 这里判断为true，即便对象创建完成，线程B、C通过了if判断，也还是会依次再创建对象，也造成了对象被重复创建。因此，还需要改造，如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 双重检查锁定
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazySun</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> <span class="hljs-type">LazySun</span> <span class="hljs-variable">sun</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazySun</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazySun <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 第一次判断</span>
        <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (LazySun.class) {
                <span class="hljs-comment">// 第二次判断</span>
                <span class="hljs-keyword">if</span> (sun == <span class="hljs-literal">null</span>){
                    sun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazySun</span>();
                }
            }
        }
        <span class="hljs-keyword">return</span> sun;
    }
}
</code></pre>
<p>就是==在锁住的代码块里面再进行一次非空判断，称为双重检查锁定（Double-Check Locking）==，同时，单例对象修饰符加上volatile，确保多个线程都能正确处理；</p>
<h2 data-id="heading-3">IoDH</h2>
<p>饿汉式单例，是在类被加载时就创建了对象。不需要考虑多线程，但是无论是否使用到对象都创建，造成了资源浪费。而懒汉式单例，虽然做到了延迟加载，但是需要处理好多线程情况下的对象创建，使用了锁，影响了性能。</p>
<p>那有没有一种更好了方式，既能在多线程下使用，又不会影响性能？</p>
<p>在《设计模式的艺术》（刘伟著）中作者提供了一种更好的创建方式，称为IoDH（Initialization on Demand Holder，按需初始化），代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * IoDH
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HolderClass</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> HolderClass.instance;
    }
}
</code></pre>
<p>这种方式是对饿汉式单例的改进，是在单例类里创建了一个内部类，将单例对象的创建放在了这个内部类里面。因为单例对象不是单例类的一个成员变量，所以对象在类加载时不会被创建，而是会在调用静态方法时被创建，这样既能延迟加载，又没有使用锁，影响性能，一举两得。</p>
<p>书中说，<em><strong>通过使用IoDH，既可以实现延迟加载，又可以保证线程安全，不影响系统性能。因此，IoDH不失为一种最好的Java语言单例模式实现方式；其缺点是与编程语言本身的特性相关，很多面向对象语言不支持IoDH。</strong></em></p>
<h2 data-id="heading-4">总结</h2>
<p>本文参考《设计模式的艺术》、《秒懂设计模式》两书</p>
<h2 data-id="heading-5">首次发布</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhezhongying.blog.csdn.net%2Farticle%2Fdetails%2F134617851" target="_blank" title="https://hezhongying.blog.csdn.net/article/details/134617851" ref="nofollow noopener noreferrer">hezhongying.blog.csdn.net/article/det…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从N倍人力到1次修改：Vite Plugin Modular 如何拯救多产品前端维护困境]]></title>    <link>https://juejin.cn/post/7601075423003787300</link>    <guid>https://juejin.cn/post/7601075423003787300</guid>    <pubDate>2026-02-01T09:33:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601075423003787300" data-draft-id="7601075423003754532" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从N倍人力到1次修改：Vite Plugin Modular 如何拯救多产品前端维护困境"/> <meta itemprop="keywords" content="前端,Vite"/> <meta itemprop="datePublished" content="2026-02-01T09:33:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端develop"/> <meta itemprop="url" content="https://juejin.cn/user/3861140565142478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从N倍人力到1次修改：Vite Plugin Modular 如何拯救多产品前端维护困境
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3861140565142478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端develop
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:33:48.000Z" title="Sun Feb 01 2026 09:33:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">0. 引言：一个真实的故事</h2>
<blockquote>
<p>产品经理："我们需要在所有产品中添加一个新的用户反馈功能，下周上线！"</p>
<p>前端开发："😰 我们有8个产品，每个都需要单独修改，这得加班到什么时候啊..."</p>
<p>技术总监："🤔 这样下去不是办法，维护成本太高了。我们需要一个更好的解决方案！"</p>
<p>隔壁老王："我来！用 Vite Plugin Modular，一次修改，所有产品自动同步更新！"</p>
<p>前端开发："真的假的？这么神奇？"</p>
<p>技术总监："哇哦！（兴奋）好厉害！（星星眼🌟）这就是我们需要的！（一脸崇拜😍）"</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">1. 项目背景与痛点</h2>
<p>在我们公司的实际业务中，随着业务的快速发展，我们面临着一个具体的挑战：公司拥有许多不同的产品，但各产品都有类似的功能模块。传统的实现方案是为每个产品创建独立的前端项目，各自维护对应的功能。这种方式在初期可能运行良好，但随着业务的不断扩展，问题逐渐凸显：</p>
<ul>
<li><strong>维护成本高</strong>：功能变更需要在多个项目中重复实现，耗费N倍的人力。例如，当需要修改一个通用的登录功能时，需要在所有产品的前端项目中逐一修改，不仅耗时耗力，还容易出现遗漏。</li>
<li><strong>代码冗余</strong>：相似功能在不同项目中重复编写，导致代码库臃肿，增加了存储和维护成本。</li>
<li><strong>一致性难以保证</strong>：不同项目的相同功能可能出现实现差异，导致用户在使用不同产品时体验不一致，影响品牌形象。</li>
<li><strong>部署和配置复杂</strong>：每个项目都需要独立的部署流程和配置管理，增加了DevOps团队的工作负担。</li>
<li><strong>团队协作效率低</strong>：开发者需要在多个项目间切换，增加了上下文切换成本，降低了开发效率。</li>
<li><strong>技术债务累积</strong>：随着时间推移，各项目可能采用不同的技术栈和实现方式，导致技术债务不断累积，难以统一升级和维护。</li>
</ul>
<p>为了解决这些实际业务问题，我们开发了 Vite Plugin Modular，一个专为多模块、多环境前端项目设计的 Vite 插件。它通过将多个相关产品的功能模块整合到单个项目中，实现了代码的复用和统一管理，大幅降低了维护成本，提高了开发效率，为公司的业务发展提供了更灵活、更高效的前端技术支持。</p>
<h2 data-id="heading-2">2. 核心功能介绍</h2>
<h3 data-id="heading-3">2.1 多模块管理</h3>
<p>Vite Plugin Modular 允许在单个项目中管理多个独立的功能模块，每个模块都有自己的源码目录、入口文件和配置。通过命令行工具，开发者可以轻松添加、删除和管理模块：</p>
<ul>
<li><strong>模块化目录结构</strong>：自动生成标准化的模块目录结构，保持代码组织清晰</li>
<li><strong>独立的模块配置</strong>：每个模块可以有自己的标题、入口文件、输出目录等配置</li>
<li><strong>模块间隔离</strong>：模块间相互独立，避免命名冲突和代码耦合</li>
</ul>
<h3 data-id="heading-4">2.2 多环境配置</h3>
<p>针对每个模块，Vite Plugin Modular 支持配置多个环境（如 development、production、test 等），实现环境的精细化管理：</p>
<ul>
<li><strong>环境变量注入</strong>：自动将配置的环境变量注入到代码中，可通过 <code>import.meta.env</code> 访问</li>
<li><strong>环境特定配置</strong>：为不同环境提供不同的配置，满足各种部署场景需求</li>
<li><strong>统一的环境管理</strong>：通过命令行工具方便地添加和删除环境配置</li>
</ul>
<h3 data-id="heading-5">2.3 命令行工具</h3>
<p>提供了功能强大的命令行工具（<code>vmod</code>），简化模块和环境的管理：</p>
<ul>
<li><strong>模块管理命令</strong>：<code>add</code>、<code>delete</code>、<code>list</code> 等命令用于模块的生命周期管理</li>
<li><strong>环境管理命令</strong>：<code>addEnv</code>、<code>deleteEnv</code> 等命令用于环境配置的管理</li>
<li><strong>配置管理命令</strong>：<code>config</code> 命令用于修改模块配置</li>
<li><strong>智能命令生成</strong>：自动为每个模块和环境生成对应的 npm 脚本命令</li>
</ul>
<h3 data-id="heading-6">2.4 智能构建系统</h3>
<p>Vite Plugin Modular 集成了智能的构建系统，为每个模块和环境提供定制化的构建配置：</p>
<ul>
<li><strong>动态入口解析</strong>：根据当前模式自动解析模块入口路径</li>
<li><strong>自定义输出目录</strong>：每个模块可以配置独立的输出目录</li>
<li><strong>HTML 自动转换</strong>：替换 HTML 页面标题和入口脚本为模块配置的值</li>
<li><strong>构建优化</strong>：继承 Vite 的优秀构建性能，同时提供模块级别的优化</li>
</ul>
<h3 data-id="heading-7">2.5 环境变量处理</h3>
<p>提供了灵活的环境变量处理机制，简化配置管理：</p>
<ul>
<li><strong>自动环境变量注入</strong>：将配置的环境变量转换为 <code>VITE_</code> 前缀的环境变量</li>
<li><strong>命名规范转换</strong>：自动将驼峰命名转换为蛇形命名，保持环境变量命名一致性</li>
<li><strong>模块特定环境变量</strong>：每个模块可以有自己的环境变量配置</li>
</ul>
<h2 data-id="heading-8">3. 技术选型理由</h2>
<h3 data-id="heading-9">3.1 方案选型对比</h3>
<p>在设计 Vite Plugin Modular 之前，我们评估了多种前端多模块开发方案，包括：</p>






























<table><thead><tr><th>方案</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td><strong>npm 组件库</strong></td><td>• 代码复用性高 • 版本管理清晰 • 可跨项目使用</td><td>• 发布流程繁琐 • 调试不便 • 依赖管理复杂 • 无法共享完整页面级功能 • 不适用于经常变更的业务需求</td></tr><tr><td><strong>Monorepo</strong></td><td>• 代码集中管理 • 版本统一管理 • 跨包依赖便捷</td><td>• 初始设置复杂 • 构建时间长 • 学习成本高 • 配置繁琐</td></tr><tr><td><strong>Vite 多页</strong></td><td>• 配置简单 • 共享依赖 • 构建性能好</td><td>• 页面级隔离，无法实现模块级隔离 • 环境配置管理复杂 • 缺乏统一的模块管理工具 • 开发环境 URL 需要指定到具体的 HTML 文件</td></tr><tr><td><strong>Vite Plugin Modular</strong></td><td>• 模块级隔离 • 多环境配置 • 命令行工具支持 • 快速开发构建 • 统一管理与代码复用</td><td>• 依赖 Vite 生态 • 对单模块项目优势不明显</td></tr></tbody></table>
<h3 data-id="heading-10">3.2 基于 Vite</h3>
<p>选择 Vite 作为基础构建工具，主要考虑以下因素：</p>
<ul>
<li><strong>快速的开发服务器</strong>：Vite 的开发服务器采用原生 ESM，启动速度极快，适合多模块开发场景</li>
<li><strong>优化的构建性能</strong>：使用 Rollup 进行生产构建，提供优秀的代码分割和 tree-shaking</li>
<li><strong>丰富的插件生态</strong>：Vite 拥有活跃的插件生态系统，便于扩展功能</li>
<li><strong>现代前端特性支持</strong>：内置对 TypeScript、JSX、CSS 预处理器等的支持</li>
<li><strong>环境变量处理</strong>：Vite 内置了环境变量处理机制，与我们的需求高度契合</li>
</ul>
<h3 data-id="heading-11">3.3 TypeScript 开发</h3>
<p>采用 TypeScript 进行开发，带来以下优势：</p>
<ul>
<li><strong>类型安全</strong>：提供静态类型检查，减少运行时错误</li>
<li><strong>更好的 IDE 支持</strong>：TypeScript 提供了更强大的代码补全和类型提示</li>
<li><strong>可维护性</strong>：类型定义使代码更易于理解和维护</li>
<li><strong>更好的重构支持</strong>：类型系统使重构更加安全和高效</li>
</ul>
<h3 data-id="heading-12">3.4 命令行工具选型</h3>
<p>命令行工具采用以下技术栈：</p>
<ul>
<li><strong>Commander.js</strong>：用于解析命令行参数和选项</li>
<li><strong>Inquirer.js</strong>：提供交互式命令行界面，提升用户体验</li>
<li><strong>Chalk</strong>：用于终端彩色输出，提高日志可读性</li>
<li><strong>Node.js 文件系统 API</strong>：用于文件和目录的操作</li>
</ul>
<h4 data-id="heading-13">命令行工具效果展示</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eaf9aadca624a3b93e2e110080eccbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=FsIJjnyAU20lEgfC7eI4oS6O77E%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">4. 实现原理与流程</h2>
<h3 data-id="heading-15">4.1 核心工作流程</h3>
<p>Vite Plugin Modular 的核心工作流程如下所示，通过 Vite 插件机制，在构建过程中动态解析模块和环境信息，实现模块化的配置管理和构建流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47663a285e6d4805a5e2858e67b13b46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=hXuGNbgf9%2BxugdvDGf7akVr3Gno%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">4.1.1 模块解析机制</h4>
<ol>
<li><strong>模式解析</strong>：通过 Vite 的 <code>mode</code> 参数，解析模块和环境信息。例如，当运行 <code>vite --mode module1-dev</code> 时，插件会自动解析出模块名称为 <code>module1</code>，环境为 <code>dev</code>。</li>
<li><strong>配置加载</strong>：根据解析出的模块名称，加载对应的模块配置。配置文件采用 JSONC 格式，支持注释，提高了可读性和可维护性。</li>
<li><strong>路径转换</strong>：根据模块配置，动态转换入口文件路径和输出目录路径。例如，将 <code>src/main.ts</code> 转换为 <code>src/modules/module1/main.ts</code>，将输出目录设置为 <code>dist/module1</code>。</li>
<li><strong>HTML 处理</strong>：通过 Vite 的 HTML 转换钩子，替换页面标题和入口脚本为模块配置的值，确保每个模块都有正确的页面标题和入口点。</li>
</ol>
<h4 data-id="heading-17">4.1.2 环境变量处理</h4>
<ol>
<li><strong>变量注入</strong>：将模块配置中的 <code>define</code> 字段转换为环境变量，通过 Vite 的 <code>define</code> 选项注入到代码中。例如，将 <code>{ "apiUrl": "https://api.example.com" }</code> 转换为 <code>import.meta.env.VITE_API_URL</code>。</li>
<li><strong>命名规范</strong>：自动将驼峰命名转换为蛇形命名，保持环境变量命名的一致性。例如，将 <code>apiUrl</code> 转换为 <code>VITE_API_URL</code>。</li>
<li><strong>环境覆盖</strong>：支持环境特定的变量覆盖，确保不同环境可以使用不同的变量值。</li>
</ol>
<h3 data-id="heading-18">4.2 命令行工具实现</h3>
<p>命令行工具（<code>vmod</code>）的实现基于以下核心流程：</p>
<ol>
<li><strong>命令注册</strong>：使用 Commander.js 注册各种模块管理命令，如 <code>add</code>、<code>delete</code>、<code>list</code>、<code>addEnv</code>、<code>deleteEnv</code> 等。</li>
<li><strong>交互式界面</strong>：使用 Inquirer.js 实现交互式命令行界面，在用户执行命令时提供智能提示和选择。</li>
<li><strong>文件操作</strong>：使用 Node.js 文件系统 API 进行文件和目录的操作，如创建模块目录、生成配置文件、复制模板文件等。</li>
<li><strong>配置管理</strong>：实现配置文件的读取、修改和写入，确保模块配置的一致性和完整性。</li>
<li><strong>命令生成</strong>：在添加模块或环境时，自动生成对应的 npm 脚本命令，方便用户运行和构建模块。</li>
</ol>
<h3 data-id="heading-19">4.3 与 Vite 的集成</h3>
<p>Vite Plugin Modular 与 Vite 的集成主要通过以下钩子实现：</p>
<ol>
<li><strong>config</strong>：在 Vite 配置阶段，修改配置对象，设置正确的入口文件路径、输出目录路径和环境变量。</li>
<li><strong>transformIndexHtml</strong>：在 HTML 转换阶段，替换页面标题和入口脚本为模块配置的值，确保每个模块都有正确的页面标题和入口点。</li>
</ol>
<p>这两个钩子是实际实现中使用的核心钩子，通过它们实现了模块解析、配置加载、路径转换和 HTML 处理等核心功能。</p>
<h3 data-id="heading-20">4.4 模块隔离机制</h3>
<p>Vite Plugin Modular 实现了模块间的隔离，确保各模块之间相互独立，避免代码冲突和依赖混乱：</p>
<ol>
<li><strong>目录隔离</strong>：每个模块都有自己的目录，独立存放源码和资源文件。</li>
<li><strong>配置隔离</strong>：每个模块都有自己的配置，支持不同的入口文件、输出目录和环境变量。</li>
<li><strong>依赖隔离</strong>：各模块共享项目级的依赖，但可以通过条件导入实现模块特定的依赖。</li>
<li><strong>构建隔离</strong>：每个模块的构建过程相互独立，避免构建过程中的相互影响。</li>
</ol>
<h2 data-id="heading-21">5. 与传统多项目方案的对比</h2>
<p>针对公司多产品、功能重复的场景，Vite Plugin Modular 与传统的多项目方案相比具有显著优势：</p>




























































<table><thead><tr><th>特性</th><th>传统多项目方案</th><th>Vite Plugin Modular</th></tr></thead><tbody><tr><td>项目结构</td><td>多个独立项目，各自维护</td><td>单个项目多模块结构，集中管理</td></tr><tr><td>功能变更</td><td>需要在多个项目中重复实现，耗费N倍人力</td><td>集中修改，所有模块自动同步更新</td></tr><tr><td>代码复用</td><td>复制粘贴或通过 npm 包共享，复用成本高</td><td>项目内直接共享代码，复用成本低</td></tr><tr><td>一致性保证</td><td>不同项目可能出现实现差异，用户体验不一致</td><td>统一实现，确保所有产品功能一致性</td></tr><tr><td>开发流程</td><td>多项目切换，上下文切换成本高</td><td>单项目内开发，流程简化</td></tr><tr><td>部署管理</td><td>每个项目独立部署，配置复杂</td><td>统一部署配置，模块化部署</td></tr><tr><td>环境配置</td><td>每个项目独立管理环境变量</td><td>统一环境管理，模块化配置</td></tr><tr><td>构建性能</td><td>每个项目独立构建，构建时间长</td><td>共享构建配置，优化构建性能</td></tr><tr><td>学习成本</td><td>新成员需要熟悉多个项目结构</td><td>只需熟悉一个项目结构和模块配置</td></tr><tr><td>扩展性</td><td>新增产品需要创建新项目，周期长</td><td>新增模块即可，快速响应业务需求</td></tr></tbody></table>
<h2 data-id="heading-22">5. 快速开始指南</h2>
<h3 data-id="heading-23">5.1 安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 npm</span>
npm install @ad-feiben/vite-plugin-modular --save-dev

<span class="hljs-comment"># 使用 yarn</span>
yarn add @ad-feiben/vite-plugin-modular -D

<span class="hljs-comment"># 使用 pnpm</span>
pnpm add @ad-feiben/vite-plugin-modular -D
</code></pre>
<h3 data-id="heading-24">5.2 配置</h3>
<ol>
<li><strong>初始化配置</strong></li>
</ol>

<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 使用 CLI 命令初始化</span>
npx vmod <span class="hljs-keyword">init</span>

<span class="hljs-meta"># 或使用简写</span>
npx vm <span class="hljs-keyword">init</span>
</code></pre>
<p>2.  <strong>在 vite.config.ts 中注册插件</strong></p>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VitePluginModular</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ad-feiben/vite-plugin-modular'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title class_">VitePluginModular</span>()
  ]
})
</code></pre>
<h3 data-id="heading-25">5.3 创建模块</h3>
<p>以下是创建模块的流程图，展示了从执行命令到模块创建完成的完整过程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6882c8c1a8014c679746c9270453caa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=3ruXL2mAhH0A2VCvZsQrgUhDAJA%3D" alt="" loading="lazy"/></p>
<p>以下是创建模块的实际效果展示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/288be5e087914a2f96bbbdcd8cf034e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=xnJSvF8aV4HCiJmlZxIGnJnIOEo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-26">5.4 开发和构建</h3>
<p>创建模块后，Vite Plugin Modular 会自动生成对应的 npm 脚本命令：</p>
<pre><code class="hljs language-r" lang="r"><span class="hljs-comment"># 运行特定模块的开发服务器</span>
npm run dev<span class="hljs-operator">:</span>module1<span class="hljs-operator">-</span>dev

<span class="hljs-comment"># 构建特定模块的生产版本</span>
npm run build<span class="hljs-operator">:</span>module1<span class="hljs-operator">-</span><span class="hljs-built_in">prod</span>
</code></pre>
<h3 data-id="heading-27">5.5 目录结构</h3>
<p>创建模块后，会自动生成以下目录结构，保持代码组织清晰：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d46687f3cfa46abbe2aab0cf6051861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uvZGV2ZWxvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544058&amp;x-signature=Yc4EB5%2BqlZO%2FM8gebQ4mRazJwv8%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash">src/modules/
├── module1/          <span class="hljs-comment"># 模块目录</span>
└── module2/
└── moduleN/
</code></pre>
<h2 data-id="heading-28">6. 适用场景</h2>
<p>Vite Plugin Modular 特别适合以下场景：</p>
<h3 data-id="heading-29">6.1 多产品公司</h3>
<p>对于拥有多个相关产品的公司，Vite Plugin Modular 可以将这些产品的前端代码整合到单个项目中，实现代码复用和统一管理。</p>
<h3 data-id="heading-30">6.2 微前端架构</h3>
<p>在微前端架构中，Vite Plugin Modular 可以作为微前端模块的开发和构建工具，简化模块的管理和部署。</p>
<h3 data-id="heading-31">6.3 企业内部系统</h3>
<p>企业内部通常有多个功能相关的系统（如 CRM、ERP、OA 等），Vite Plugin Modular 可以将这些系统的前端代码整合到单个项目中，提高开发和维护效率。</p>
<h3 data-id="heading-32">6.4 SaaS 产品</h3>
<p>对于 SaaS 产品，不同客户可能有不同的定制需求，Vite Plugin Modular 可以通过模块和环境的配置，轻松实现不同客户的定制版本。</p>
<h3 data-id="heading-33">6.5 快速原型开发</h3>
<p>在需要快速开发多个相关原型的场景中，Vite Plugin Modular 可以帮助开发者快速创建和管理多个原型模块，提高原型开发效率。</p>
<h2 data-id="heading-34">7. 未来规划</h2>
<p>Vite Plugin Modular 是一个持续发展的项目，我们计划在未来的版本中添加以下功能：</p>
<h3 data-id="heading-35">7.1 国际化支持</h3>
<ul>
<li>实现模块级别的国际化配置，支持不同模块使用不同的语言设置</li>
<li>提供多语言资源管理系统，方便管理和维护多语言内容</li>
<li>支持自动语言切换，根据用户环境或配置自动选择合适的语言</li>
</ul>
<h3 data-id="heading-36">7.2 UI 界面</h3>
<ul>
<li>开发可视化的模块管理界面，提供直观的模块创建、编辑、删除功能</li>
<li>实现配置编辑器，通过图形界面编辑模块配置，减少手动编辑配置文件的错误</li>
<li>提供实时预览功能，在修改配置后立即查看效果</li>
<li>集成项目状态监控，显示模块构建状态、依赖关系等信息</li>
<li>支持拖放操作，通过拖放方式管理模块间的依赖关系</li>
</ul>
<h3 data-id="heading-37">7.3 完善文档</h3>
<ul>
<li>编写详细的 API 文档，覆盖所有插件配置选项和命令行参数</li>
<li>提供全面的使用指南，包括快速开始、高级配置、最佳实践等</li>
<li>建立社区支持渠道，收集用户反馈和建议，持续改进插件功能</li>
</ul>
<h2 data-id="heading-38">结语</h2>
<p>Vite Plugin Modular 为前端多模块开发提供了一种全新的思路，通过将多个相关产品的功能模块整合到单个项目中，实现了代码的复用和统一管理，大幅降低了维护成本，提高了开发效率。它不仅是一个技术工具，更是一种前端工程化的最佳实践。</p>
<p>无论您是在开发多个相关产品，还是在构建微前端架构，Vite Plugin Modular 都能为您的项目带来显著的价值。我们相信，随着它的不断发展和完善，它将成为前端多模块开发的标准解决方案之一。</p>
<p>立即尝试 Vite Plugin Modular，体验前端模块化开发的新境界！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟]]></title>    <link>https://juejin.cn/post/7601075423003770916</link>    <guid>https://juejin.cn/post/7601075423003770916</guid>    <pubDate>2026-02-01T09:32:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601075423003770916" data-draft-id="7601159804490907667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟"/> <meta itemprop="keywords" content="Cursor,AI编程,代码规范"/> <meta itemprop="datePublished" content="2026-02-01T09:32:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Genyuan的AI工程"/> <meta itemprop="url" content="https://juejin.cn/user/143390347639064"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/143390347639064/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Genyuan的AI工程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:32:08.000Z" title="Sun Feb 01 2026 09:32:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我们用 Cursor，把 Code Review 时间从 45 分钟降到 10 分钟</h2>
<p>大家好，我是 <strong>Genyuan</strong>。</p>
<p>在日常后端开发中，<strong>Code Review（CR）</strong> 是保障代码质量的关键环节。但在高频迭代的现实下，CR 正在变成一件<strong>高消耗、易疲劳、且质量高度依赖个人状态</strong>的事情。</p>
<p>在实际工程实践中我越来越明确一件事：</p>
<blockquote>
<p><strong>人类更擅长判断业务逻辑和上下文是否合理，但在重复性、规则性检查上，反而非常容易出错。</strong></p>
</blockquote>
<p>比如：</p>
<ul>
<li>团队规范很多，但某一次 CR 很容易被忽略</li>
<li>空指针、边界判断、异常处理等低级问题，在连续 Review 时极易漏掉</li>
</ul>
<p>因此，我们在团队中引入了一种方式：<br/>
👉 <strong>先用 AI 做一轮前置 Code Review，再由人完成最终 Review。</strong></p>
<p>这篇文章记录的是我在团队中，<strong>使用 Cursor 提升 Code Review 效率的一次工程化实践</strong>。</p>
<hr/>
<h3 data-id="heading-1">一、问题背景：为什么人工 CR 越来越“累”</h3>
<p>在双周甚至更快的迭代节奏下，人工 CR 普遍面临这些问题：</p>
<ul>
<li>Review 时间长，精力消耗大</li>
<li>边界条件、异常分支检查容易疲劳</li>
<li>Review 质量随 Reviewer 状态波动</li>
</ul>
<p>尤其是一些<strong>业务价值不高，但线上风险极大</strong>的问题（如空指针、越界、异常处理），非常适合交给 AI 处理。</p>
<hr/>
<h3 data-id="heading-2">二、传统 CR 的局限</h3>
<p>不使用 AI 的情况下，CR 主要依赖：</p>
<ul>
<li>Reviewer 的个人经验</li>
<li>团队规范文档</li>
<li>口头或代码评审中的反复强调</li>
</ul>
<p>这会带来几个明显问题：</p>
<ul>
<li>新人学习成本高</li>
<li>代码量一大就容易漏审</li>
<li>难以形成统一、可复用、可持续演进的检查流程</li>
</ul>
<p>整体效率和稳定性都有限。</p>
<hr/>
<h3 data-id="heading-3">三、AI 介入方案：Cursor + 命令式 Review</h3>
<p>在多种尝试之后，我选择使用 <strong>Cursor</strong> 来辅助 Code Review。</p>
<blockquote>
<p>Cursor 自带的 <strong>Diff with Main</strong> 功能是可用的，但它更偏“个人工具”，<br/>
并不适合做 <strong>团队级、可维护、可演进</strong> 的 CR 流程。</p>
</blockquote>
<p>我的做法是：<br/>
👉 <strong>把 Code Review 这件事，封装成一个“命令”，让 AI 按统一规则执行。</strong></p>
<hr/>
<h3 data-id="heading-4">四、整体方案概览</h3>
<p>这套方案的核心是三点：</p>
<ol>
<li>用 <strong>review.md</strong> 统一定义 CR 规则</li>
<li>用 Cursor 的 <strong>Command + MCP Git</strong> 执行审查</li>
<li>输出 <strong>结构化 Review 报告</strong>，作为人工 CR 的前置输入</li>
</ol>
<hr/>
<h4 data-id="heading-5">1️⃣ 环境准备</h4>
<ul>
<li>Cursor <code>2.3.35 (Universal)</code></li>
<li>Git</li>
<li>MCP 中的 Git 工具</li>
</ul>
<p>Git MCP 配置示例：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72e36db52ebf4c4299105cdf9c8adb3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VueXVhbueahEFJ5bel56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543691&amp;x-signature=pDrql8wg9Yi%2BWlS9k2wdi4Qo%2BBE%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"git"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"mcp-server-git"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">2️⃣ Review 规则维护</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d3ffcae90eb44c2be4f96b8842497b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VueXVhbueahEFJ5bel56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543691&amp;x-signature=hlCuLPSgu8az1VGHsGUG%2BVbqzMM%3D" alt="image.png" loading="lazy"/></p>
<p>所有 CR 规则统一维护在 <code>review.md</code> 中：</p>
<p>👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FApolloNaco%2FAITools%2Fblob%2Fmain%2Freview.md" target="_blank" title="https://github.com/ApolloNaco/AITools/blob/main/review.md" ref="nofollow noopener noreferrer">github.com/ApolloNaco/…</a></p>
<p>核心思想只有一句话：</p>
<blockquote>
<p><strong>把“人脑里的 Review 经验”，写成 AI 可以稳定执行的规则。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-7">五、如何执行 AI Review 命令</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5b9d963dcfd4a76a9d913b8c5193ec7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR2VueXVhbueahEFJ5bel56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543691&amp;x-signature=goZR9hhWVbDReIizgvf9Acmssr0%3D" alt="image.png" loading="lazy"/>
有了 <code>review.md</code> 规则后，团队成员只需运行一个命令，即可让 Cursor 按规则执行 AI Code Review。</p>
<pre><code class="hljs language-bash" lang="bash">/review --b 当前分支
</code></pre>
<h4 data-id="heading-8">执行流程说明</h4>
<ol>
<li>
<p><strong>指定分支</strong></p>
<ul>
<li>
<p><code>--b 当前分支</code>：对当前开发分支进行审查</p>
</li>
<li>
<p>可选参数：</p>
<ul>
<li><code>-o</code>：输出报告</li>
<li><code>--file</code>：审查指定文件</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>AI 自动执行规则</strong></p>
<ul>
<li>读取 <code>review.md</code> 中定义的规则</li>
<li>按文件类型过滤</li>
<li>对代码进行规范检查、问题分级分析</li>
</ul>
</li>
<li>
<p><strong>生成结构化报告</strong></p>
<ul>
<li>包含变更分析、问题列表、风险评估和合入建议</li>
<li>输出到 Terminal，也可直接同步到 PR 评论或 CI</li>
</ul>
</li>
<li>
<p><strong>开发者操作简化</strong></p>
<ul>
<li>不需要手动比对 diff</li>
<li>不需要逐行检查低级错误</li>
<li>人只需聚焦 <strong>业务逻辑和架构决策</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p>执行一次命令，即可完成前置 AI 审查，保证低级错误被拦截，同时提高 Review 效率和一致性。</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">Review Command 的核心设计</h3>
<h4 data-id="heading-10">① Git 命令执行规范（最关键）</h4>
<p><strong>问题：</strong><br/>
Git 命令在 Cursor 中非常容易被分页器（pager）卡住，导致流程失败。</p>
<p><strong>解决方式：</strong></p>
<ul>
<li>使用 <code>git --no-pager</code></li>
<li>统一通过 Cursor 内置 <code>run_terminal_cmd</code> 执行</li>
<li>从命令输出中按需提取信息</li>
</ul>
<p>👉 如果不处理这个问题，AI CR 基本不可用。</p>
<hr/>
<h4 data-id="heading-11">② 文件范围控制</h4>
<p>只审查以下文件：</p>
<ul>
<li><code>.java</code></li>
<li><code>.xml</code></li>
<li><code>.properties</code></li>
</ul>
<p>目的只有一个：<br/>
👉 <strong>聚焦真正影响逻辑和行为的代码，提高审查效率。</strong></p>
<hr/>
<h4 data-id="heading-12">③ 团队规范检查（强约束）</h4>
<p>在 <code>review.md</code> 中的：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">## 团队规范检查</span></span>
</code></pre>
<p>这个模块下，由技术 Leader 维护<strong>必须被拦截的问题</strong>，例如：</p>
<ul>
<li>方法 / Map key-value 是否强制注释</li>
<li>是否存在应抽取却未抽取的公共逻辑</li>
<li>是否存在冗余 if/else 分支</li>
<li>URL / 配置是否走统一封装</li>
</ul>
<p><strong>原则很简单：</strong></p>
<blockquote>
<p>这些问题一旦出现，就不能被合入。</p>
</blockquote>
<hr/>
<h4 data-id="heading-13">④ 问题分级机制</h4>
<p>在规则中明确问题优先级：</p>
<ul>
<li><strong>严重问题</strong>：线程安全、内存泄漏、安全漏洞、架构违规</li>
<li><strong>中等问题</strong>：性能问题、异常处理、数据一致性</li>
<li><strong>轻微问题</strong>：规范、可读性、可维护性</li>
</ul>
<p>这样可以让：</p>
<ul>
<li>AI 自动聚焦重点</li>
<li>人类 Reviewer 快速扫高风险问题</li>
</ul>
<p>避免被细节淹没。</p>
<hr/>
<h4 data-id="heading-14">⑤ 统一审查报告输出</h4>
<p>AI 最终输出结构化 Review 报告，包括：</p>
<ul>
<li>变更内容分析</li>
<li>问题列表（按严重程度）</li>
<li>风险评估</li>
<li>合入建议</li>
</ul>
<p>可以直接同步到 PR 评论或 CI 流程中。</p>
<hr/>
<h3 data-id="heading-15">六、实际效果</h3>
<p>在真实项目中的效果非常直观：</p>
<ul>
<li><strong>单次 Review 时间</strong>：30–45 分钟 → 10–15 分钟</li>
<li>命名、规范、空指针等低级问题几乎被完全拦截</li>
<li>新同学可以快速对齐团队规范</li>
<li>Review 质量明显更稳定</li>
</ul>
<p>组内反馈非常一致：</p>
<blockquote>
<p>“不用 Cursor 做辅助，Review 会明显更累。”</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">七、团队如何落地这套方案</h3>
<h4 data-id="heading-17">1️⃣ 技术 Leader 如何维护</h4>
<p>Leader 只需要维护两块内容：</p>
<ul>
<li><strong>团队规范检查</strong>：定义哪些问题必须被拦截</li>
<li><strong>问题分级规则</strong>：决定哪些问题必须优先处理</li>
</ul>
<p>本质上是把 <strong>Leader 的经验工程化</strong>。</p>
<hr/>
<h4 data-id="heading-18">2️⃣ 团队成员如何使用</h4>
<ul>
<li>同步最新 <code>review.md</code></li>
<li>写完模块后，先执行一次 AI CR</li>
<li>修掉低级错误，再提 PR</li>
</ul>
<p>👉 把问题拦在最早的阶段。</p>
<hr/>
<h4 data-id="heading-19">3️⃣ 工作流嵌入</h4>
<ul>
<li>AI Review 输出直接同步到 PR 评论</li>
<li>作为人工 CR 的前置输入</li>
<li>形成半自动 Code Review 流程</li>
</ul>
<hr/>
<h3 data-id="heading-20">八、为什么我认为这套方案在工程上是“对的”</h3>
<p>这不是功能堆砌，而是几条清晰的设计原则：</p>
<ol>
<li>
<p>写成了命令风格，对开发友好。只需要按照提示敲命令即可。例如：<code>/review --b -o [需要CR的分支]</code></p>
</li>
<li>
<p>用了Cursor AI的内置函数 <code>run_terminal_cmd</code> 提高执行效率</p>
</li>
<li>
<p>解决了cursor调git命令发生的常见问题：</p>
<ol>
<li>引入Git MCP</li>
<li><code>git --no-pager [command]</code> 处理代码时的分页问题</li>
<li><code>git fetch --all --prune</code> 避免了 CR的分支代码没有和最新的master分支对比的问题（多人开发尤其容易出现这个问题）</li>
</ol>
</li>
<li>
<p>设置了“团队规范检查”点，你可以在这个模块下写你们团队的常见团队规范，让AI在代码CR的时候帮你发现问题</p>
</li>
<li>
<p>设置严格的问题分级，可以聚焦重点问题的处理。</p>
</li>
<li>
<p>可以让AI最后分析的结果输出报告，集成到你们企业的CI/CD流程中。</p>
</li>
<li>
<p>让团队成员在每次写完代码之后，都先自己用AI CR一遍，把常见的团队问题和代码规范、低级错误自己先通过AICR的方式去避免。</p>
</li>
</ol>
<blockquote>
<p><strong>人负责判断业务和架构，AI 负责拦截低级错误。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-21">九、不足与后续规划</h3>
<p>目前这套 AI CR 仍有明显边界：</p>
<ul>
<li>无法校验真实业务逻辑是否正确</li>
<li>无法判断代码是否与项目结构匹配</li>
<li>团队级命令需要统一同步机制</li>
</ul>
<p>这些问题，我会在后续文章中展开</p>
<hr/>
<p><strong>Genyuan</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Obsidian 使用指南：从零开始搭建你的个人知识库]]></title>    <link>https://juejin.cn/post/7601313474719121443</link>    <guid>https://juejin.cn/post/7601313474719121443</guid>    <pubDate>2026-02-01T07:00:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719121443" data-draft-id="7601076815449997327" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Obsidian 使用指南：从零开始搭建你的个人知识库"/> <meta itemprop="keywords" content="笔记,笔记测评"/> <meta itemprop="datePublished" content="2026-02-01T07:00:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BugShare"/> <meta itemprop="url" content="https://juejin.cn/user/4469992354742361"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Obsidian 使用指南：从零开始搭建你的个人知识库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4469992354742361/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BugShare
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:00:48.000Z" title="Sun Feb 01 2026 07:00:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>我并不认为 Obsidian 是一款使用门槛很高的软件。</strong>
事实上，只使用 Obsidian 自带的核心功能，就已经可以非常高效地管理我们的笔记与知识。</p>
<p>写这篇文章的目的也很简单：
👉 <strong>希望刚接触，或还没有接触 Obsidian 的朋友，可以通过这篇文章快速上手这款软件。</strong></p>
<p>不讲复杂理论，不强推插件，只讲真正「一上手就能用」的部分。</p>
<hr/>
<h2 data-id="heading-0">一、安装</h2>
<p>Obsidian 是一款跨平台的本地笔记软件，支持 macOS / Windows / Linux / iOS / Android。</p>
<p>官方下载地址：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fobsidian.md" target="_blank" title="https://obsidian.md" ref="nofollow noopener noreferrer">obsidian.md</a></p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19748/59215/dab1af8e-df63-48f6-8ffe-916909469776.png" alt="screenshot-1.0-hero-combo.png" loading="lazy"/></p>
<p>下载安装到本地即可，无需注册账号也能直接使用。</p>
<hr/>
<h2 data-id="heading-1">二、仓库（Vault）</h2>
<p>在 Obsidian 中，<strong>仓库（Vault）本质上就是一个普通文件夹</strong>，你的所有笔记都会以 Markdown 文件的形式存放在这里。</p>
<blockquote>
<p>如果你使用的是 Mac，非常推荐把仓库位置放在 iCloud 中，方便多设备同步。</p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19748/59215/55eb70a7-5ecf-4251-81bc-a6a495be7618.png" alt="PixPin_2026-01-31_19-45-11.png" loading="lazy"/></p>
<p>优点只有一句话：
👉 <strong>数据完全属于你，不被任何平台绑定。</strong></p>
<hr/>
<h2 data-id="heading-2">三、布局</h2>
<h3 data-id="heading-3">1. 堆叠标签页</h3>
<p>如果你已经看腻了传统浏览器式的标签页布局，可以试试 <strong>堆叠标签页</strong>，整体视觉会更紧凑，也更有“工作区”的感觉。</p>
<p><img src="http://openwrite.cn/uploads/19748/59215/7978c0e9-edd6-4539-bff1-58c6f767a0a7.png" alt="1769862805965.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">2. 自由拖动标签</h3>
<ul>
<li>支持通过鼠标自由拖动标签页位置</li>
<li>可以分屏、上下或左右排列</li>
</ul>
<p>💡 <strong>Tips</strong>
当你调整好一个顺手的布局后，记得保存下来，后面可以一键恢复（下面的「工作区」插件会讲）。</p>
<p><img src="http://openwrite.cn/uploads/19748/59215/6f4a09aa-7794-4075-8592-50b72acccfd7.png" alt="PixPin_2026-01-31_20-40-24.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">四、笔记</h2>
<h3 data-id="heading-6">1. 创建笔记</h3>
<p>强烈建议你从一开始就 <strong>养成添加笔记属性（Frontmatter）</strong> 的习惯。</p>
<ul>
<li>在笔记中输入 <code>---</code></li>
<li>然后敲回车</li>
<li>Obsidian 会自动生成属性区域</li>
<li>点击最左侧图标可以选择属性类型
<img src="http://openwrite.cn/uploads/19748/59215/060a3e44-4168-40d6-9f2b-f607ce515f84.png" alt="PixPin_2026-01-31_21-55-18.png" loading="lazy"/></li>
</ul>
<p>这一步会在后期做检索、分类、自动化时非常有价值。</p>
<hr/>
<h3 data-id="heading-7">2. 出链与反链</h3>
<p>这是 Obsidian 最核心、也是最有价值的能力之一。</p>
<ul>
<li>输入 <code>[[</code> 即可创建或引用笔记</li>
<li>跳转到目标笔记后，可以看到哪些笔记引用了它（反链）</li>
<li><strong>即使没有显式加链接，只要提到了笔记名称，也会被识别</strong></li>
<li>当前笔记中还能发现「潜在链接」
<img src="http://openwrite.cn/uploads/19748/59215/59e532c6-02af-48a6-a6a1-8998fb14e4ec.png" alt="1769869292611.png" loading="lazy"/></li>
</ul>
<p>一句话总结：
👉 <strong>笔记之间会自然“长”成一张知识网络。</strong></p>
<hr/>
<h3 data-id="heading-8">3. 命令面板</h3>
<p>如果你记不住快捷键或语法，命令面板几乎可以解决 90% 的问题。</p>
<ul>
<li>左侧栏点击图标打开</li>
<li>或使用快捷键：<code>Command + P</code>
<img src="http://openwrite.cn/uploads/19748/59215/21b156f3-b158-4625-95fe-555772a81656.png" alt="PixPin_2026-01-31_22-40-33.png" loading="lazy"/></li>
</ul>
<p>很多功能你根本不需要记，只需要 <strong>会搜索</strong>。</p>
<hr/>
<h2 data-id="heading-9">五、语法</h2>
<h3 data-id="heading-10">1. 链接语法</h3>
<ul>
<li>使用 <code>|</code> 设置别名
<code>[[我的第二篇笔记|自定义名称]]</code></li>
<li>使用 <code>#</code> 定位到标题
<code>[[我的第二篇笔记#标题1]]</code></li>
<li>使用 <code>^</code> 定位到具体段落
<code>[[我的第二篇笔记^第二篇笔记的一句话]]</code>
<img src="http://openwrite.cn/uploads/19748/59215/ee0f1f3f-af28-441a-af03-033b8e05ecd2.png" alt="PixPin_2026-02-01_01-29-53.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-11">2. 嵌入笔记</h3>
<p>在链接前加一个 <code>!</code>，即可把内容直接嵌入当前笔记。</p>
<ul>
<li>嵌入整篇笔记
<code>![[我的第二篇笔记]]</code></li>
<li>嵌入某个标题
<code>![[我的第二篇笔记#标题1]]</code></li>
<li>嵌入某一段内容
<code>![[我的第二篇笔记^第二篇笔记的一句话]]</code>
<img src="http://openwrite.cn/uploads/19748/59215/a75bab02-1273-47a8-9b3f-64538a115e4d.png" alt="PixPin_2026-02-01_01-35-51.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-12">3. 外部链接</h3>
<p>标准 Markdown 语法：</p>
<pre><code class="hljs language-markdown" lang="markdown">[<span class="hljs-string">bugshare</span>](<span class="hljs-link">https://www.bugshare.cn</span>)
</code></pre>
<p><img src="http://openwrite.cn/uploads/19748/59215/0417ea81-8399-423f-9d9f-a9c5b09b5b37.png" alt="PixPin_2026-02-01_01-39-28.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-13">4. 其它常用语法</h3>
<ul>
<li>高亮：<code>==高亮内容==</code></li>
<li>加粗：<code>**加粗**</code> 或 <code>__加粗__</code></li>
<li>斜体：<code>*斜体*</code> 或 <code>_斜体_</code></li>
<li>删除线：<code>~~删除线~~</code></li>
<li>无序列表：<code>- </code></li>
<li>有序列表：<code>1. </code></li>
<li>待办事项：<code>- [ ] 任务</code></li>
<li>引用：<code>&gt; </code></li>
<li>标注块：
<code>&gt; [!NOTE]</code>
<code>&gt; [!SUCCESS]</code></li>
<li>注释：
<code>[^1]</code>
<code>^[这是注释]</code></li>
<li>表格：命令面板搜索「插入表格」
<img src="http://openwrite.cn/uploads/19748/59215/76fab748-9161-4c8f-a912-df86d86ba2da.png" alt="PixPin_2026-02-01_13-16-59.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-14">六、核心插件（强烈建议启用）</h2>
<blockquote>
<p>这里必须强调一句：
<strong>真的没必要 All in One。</strong>
不要把时间浪费在折腾插件上，有需求再装插件，别问我为什么 😖</p>
</blockquote>
<hr/>
<h3 data-id="heading-15">1. 工作区</h3>
<p>用于保存和快速切换布局。</p>
<ul>
<li>设置 → 核心插件 → 工作区 → 启用</li>
<li>左侧会出现「工作区」图标</li>
<li>给当前布局起个名字即可保存
<img src="http://openwrite.cn/uploads/19748/59215/a02d3c58-5a87-46aa-a5f2-489c003f269a.png" alt="PixPin_2026-01-31_21-08-07.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-16">2. 白板</h3>
<p>适合做结构梳理、思维发散。</p>
<ul>
<li>设置 → 核心插件 → 白板 → 启用
<img src="http://openwrite.cn/uploads/19748/59215/a47efa8c-91bd-437e-8b1c-3a762b57f74b.png" alt="PixPin_2026-01-31_23-01-57.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-17">3. 关系图谱</h3>
<p>可以非常直观地看到你的知识是如何一步步生长的。</p>
<ul>
<li>设置 → 核心插件 → 关系图谱 → 启用</li>
<li>打开「生长动画」效果更明显
<img src="http://openwrite.cn/uploads/19748/59215/4f231824-a728-42a8-9186-c25186ed0b0c.png" alt="PixPin_2026-01-31_23-21-06.png" loading="lazy"/></li>
</ul>
<hr/>
<h3 data-id="heading-18">4. 模板</h3>
<p>用于快速创建统一结构的笔记。</p>
<ul>
<li>设置 → 核心插件 → 模板 → 启用
<img src="http://openwrite.cn/uploads/19748/59215/0ea9cb73-4bc9-4d23-80e0-b84ee0f1fea6.png" alt="PixPin_2026-01-31_23-54-46.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-19">七、第三方插件（按需）</h2>
<p>首次使用需要关闭「安全模式」。</p>
<p>插件推荐网站：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fobsidian.md%2Fplugins" target="_blank" title="https://obsidian.md/plugins" ref="nofollow noopener noreferrer">obsidian.md/plugins</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpkmer.cn%2Fproducts%2Fplugin%2FpluginMarket" target="_blank" title="https://pkmer.cn/products/plugin/pluginMarket" ref="nofollow noopener noreferrer">pkmer.cn/products/pl…</a></p>
</blockquote>
<p><img src="http://openwrite.cn/uploads/19748/59215/2733e0f7-59c0-49db-b7be-8d12e1923f55.png" alt="PixPin_2026-02-01_12-47-01.png" loading="lazy"/></p>
<h3 data-id="heading-20">推荐插件（只列我觉得<strong>真的有用的</strong>）</h3>
<ul>
<li><strong>Iconize</strong>：自定义文件夹图标</li>
<li><strong>Link Favicons</strong>：外部链接显示站点图标</li>
<li><strong>Novel Word Count</strong>：统计文件夹内笔记数量与字数</li>
<li><strong>Number Headings</strong>：自动给多级标题编号</li>
<li><strong>Excalidraw</strong>：在笔记中嵌入手绘图</li>
<li><strong>Git</strong>：自动提交、拉取、推送笔记版本</li>
</ul>
<hr/>
<h2 data-id="heading-21">八、快捷键</h2>
<h3 data-id="heading-22">常用快捷键</h3>
<ul>
<li><code>Command + O</code>：快速切换笔记</li>
<li><code>Command + P</code>：命令面板</li>
</ul>
<h3 data-id="heading-23">自定义快捷键</h3>
<ul>
<li>设置 → 快捷键</li>
<li>搜索操作 → 添加快捷键</li>
<li>按下你想要的组合即可
<img src="http://openwrite.cn/uploads/19748/59215/0c872634-ad4a-46f4-a1a4-78136f23b28a.png" alt="PixPin_2026-01-31_23-21-55.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-24">写在最后</h2>
<p>如果你是第一次使用 Obsidian，我的建议只有一句话：</p>
<blockquote>
<p><strong>先用起来，再慢慢优化。</strong></p>
</blockquote>
<p>笔记系统不是一次性设计出来的，而是在长期使用中不断演化的。
Obsidian 的价值，也正是在于它给了你这种「自由生长」的空间。</p>
<p>后续分享 《Obsidian 怎么使用 Claude Code》，欢迎关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入了解 GitHub CLI（`gh`）的前世今生]]></title>    <link>https://juejin.cn/post/7601103779392782399</link>    <guid>https://juejin.cn/post/7601103779392782399</guid>    <pubDate>2026-02-01T07:15:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601103779392782399" data-draft-id="7601073900525879338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入了解 GitHub CLI（`gh`）的前世今生"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-02-01T07:15:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8491371754716"/> <meta itemprop="url" content="https://juejin.cn/user/2744800640504071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入了解 GitHub CLI（`gh`）的前世今生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2744800640504071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8491371754716
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:15:20.000Z" title="Sun Feb 01 2026 07:15:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从网页点击到命令行操作，GitHub CLI 如何彻底改变了开发者与 GitHub 的交互方式？</p>
</blockquote>
<h2 data-id="heading-0">引言</h2>
<p>在日常开发中，你是否经常需要在浏览器和终端之间来回切换？创建 Pull Request 需要打开网页、查看 Issue 需要打开网页、合并代码还是需要打开网页……这种繁琐的工作流程不仅打断开发思路，更大大降低了工作效率。</p>
<p>本文将带你深入了解 GitHub CLI（<code>gh</code>）的前世今生，从它的诞生背景到核心设计，再到实际应用场景。阅读本文，你将学到：</p>
<ul>
<li>GitHub CLI 诞生的历史背景和设计理念</li>
<li><code>gh</code> 命令的核心架构和功能模块</li>
<li>从基础操作到高级工作流的实战技巧</li>
<li>如何通过 <code>gh</code> 提升团队协作效率</li>
</ul>
<h2 data-id="heading-1">历史背景：从网页到命令行</h2>
<h3 data-id="heading-2">前传：Web 时代的局限</h3>
<p>在 Git 诞生后的很长一段时间里，开发者与 GitHub 的交互模式是分裂的：</p>
<ul>
<li><strong>代码管理</strong>：通过 <code>git</code> 命令在终端完成</li>
<li><strong>协作管理</strong>：通过浏览器在 GitHub 网页完成</li>
</ul>
<p>这种分裂模式带来了明显的痛点：</p>
<ol>
<li><strong>上下文切换频繁</strong>：从终端到浏览器，打断开发心流</li>
<li><strong>操作效率低下</strong>：创建 PR、查看 Issue 等操作需要多次点击</li>
<li><strong>自动化困难</strong>：网页操作难以脚本化</li>
<li><strong>远程协作受限</strong>：SSH 环境下无法使用网页界面</li>
</ol>
<h3 data-id="heading-3">GitHub CLI 的诞生</h3>
<p><strong>2020年9月</strong>，GitHub CLI 1.0 正式发布，代号 <code>gh</code>。它的设计理念非常明确：</p>
<blockquote>
<p><strong>"将 GitHub 的所有功能带到终端"</strong></p>
</blockquote>
<p><strong>关键里程碑</strong>：</p>





























<table><thead><tr><th>时间</th><th>事件</th></tr></thead><tbody><tr><td>2020年5月</td><td>GitHub CLI 的 beta 版开始发布（0.x 系列版本）</td></tr><tr><td>2020年9月</td><td><strong>正式发布 GitHub CLI 1.0 稳定版本</strong>，支持核心功能如 PR、Issue、Repo、API 等</td></tr><tr><td>2021年8月</td><td><strong>GitHub CLI 2.0 发布</strong>，增加扩展支持，使用户可创建/安装自定义命令</td></tr><tr><td>2021-2022年</td><td>持续发布 2.x 系列版本，功能更加成熟和完善（包含 Actions 支持、增强命令等）</td></tr><tr><td>2023年至今</td><td>2.x 系列持续更新（引入更多功能、优化 UX、增强 API 支持等）</td></tr></tbody></table>
<h2 data-id="heading-4">核心架构设计</h2>
<h3 data-id="heading-5">整体架构</h3>
<p><code>gh</code> 采用了<strong>模块化插件架构</strong>设计：</p>
<pre><code class="hljs language-bash" lang="bash">gh (核心)
├── auth       <span class="hljs-comment"># 认证模块</span>
├── repo       <span class="hljs-comment"># 仓库操作</span>
├── <span class="hljs-built_in">pr</span>         <span class="hljs-comment"># Pull Request 管理</span>
├── issue      <span class="hljs-comment"># Issue 管理</span>
├── api        <span class="hljs-comment"># 通用 API 调用</span>
├── gist       <span class="hljs-comment"># Gist 管理</span>
├── workflow   <span class="hljs-comment"># GitHub Actions</span>
└── extensions <span class="hljs-comment"># 扩展系统</span>
</code></pre>
<p><strong>设计亮点</strong>：</p>
<ol>
<li><strong>统一认证机制</strong>：一次登录，全局使用</li>
<li><strong>RESTful API 封装</strong>：所有操作最终调用 GitHub REST API</li>
<li><strong>可扩展架构</strong>：支持自定义扩展命令</li>
<li><strong>跨平台支持</strong>：Linux、macOS、Windows 全覆盖</li>
</ol>
<h3 data-id="heading-6">核心原理</h3>
<p><code>gh</code> 的工作流程可以概括为以下四步：</p>
<pre><code class="hljs">用户输入命令 → 参数解析 → API 调用 → 结果格式化 → 终端输出
</code></pre>
<p><strong>示例</strong>：当你执行 <code>gh pr list</code> 时，幕后发生的事情：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 解析命令</span>
<span class="hljs-comment"># 2. 调用 GitHub API: GET /repos/{owner}/{repo}/pulls</span>
<span class="hljs-comment"># 3. 解析 JSON 响应</span>
<span class="hljs-comment"># 4. 格式化输出为表格</span>
</code></pre>
<h2 data-id="heading-7">核心功能详解</h2>
<h3 data-id="heading-8">0. 快速安装</h3>
<p>在开始使用之前，需要先安装 <code>gh</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS（推荐使用 Homebrew）</span>
brew install gh

<span class="hljs-comment"># Windows（推荐使用 Winget）</span>
winget install --<span class="hljs-built_in">id</span> GitHub.cli

<span class="hljs-comment"># Linux（使用包管理器）</span>
<span class="hljs-comment"># Ubuntu/Debian</span>
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo <span class="hljs-built_in">dd</span> of=/usr/share/keyrings/githubcli-archive-keyring.gpg
<span class="hljs-built_in">echo</span> <span class="hljs-string">"deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main"</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/github-cli.list &gt; /dev/null
sudo apt update
sudo apt install gh

<span class="hljs-comment"># 验证安装</span>
gh --version
</code></pre>
<h3 data-id="heading-9">1. 认证系统</h3>
<p><code>gh</code> 的认证机制设计得非常优雅：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统方式：手动配置 Token（繁琐）</span>
git config --global github.token xxx

<span class="hljs-comment"># gh 的方式：交互式登录（简单）</span>
gh auth login
</code></pre>
<p><strong>认证流程</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 步骤1：启动登录</span>
gh auth login

<span class="hljs-comment"># 步骤2：选择认证方式</span>
? What account <span class="hljs-keyword">do</span> you want to <span class="hljs-built_in">log</span> into?
  &gt; GitHub.com
    GitHub Enterprise Server

<span class="hljs-comment"># 步骤3：选择认证协议</span>
? What is your preferred protocol <span class="hljs-keyword">for</span> Git operations?
  &gt; HTTPS
    SSH

<span class="hljs-comment"># 步骤4：浏览器确认</span>
<span class="hljs-comment"># 自动打开浏览器，一键授权</span>

<span class="hljs-comment"># 步骤5：完成</span>
✓ Logged <span class="hljs-keyword">in</span> as username
</code></pre>
<p><strong>技术实现</strong>：使用 OAuth 2.0 协议，支持设备流和浏览器授权两种方式。</p>
<h3 data-id="heading-10">2. Pull Request 工作流</h3>
<p>这是 <code>gh</code> 最核心、最常用的功能。</p>
<h4 data-id="heading-11">创建 PR</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统方式（需要多步操作）</span>
git push origin feature-branch
<span class="hljs-comment"># 然后打开浏览器</span>
<span class="hljs-comment"># 点击 "Compare &amp; pull request"</span>
<span class="hljs-comment"># 填写标题、描述</span>
<span class="hljs-comment"># 点击 "Create pull request"</span>

<span class="hljs-comment"># gh 方式（一行命令）</span>
gh <span class="hljs-built_in">pr</span> create --title <span class="hljs-string">"添加新功能"</span> --body <span class="hljs-string">"详细描述"</span>
</code></pre>
<p><strong>完整示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 切换到新分支</span>
git checkout -b feature/user-auth

<span class="hljs-comment"># 2. 提交代码</span>
git add .
git commit -m <span class="hljs-string">"添加用户认证功能"</span>
git push origin feature/user-auth

<span class="hljs-comment"># 3. 创建 PR</span>
gh <span class="hljs-built_in">pr</span> create \
  --title <span class="hljs-string">"feat: 添加用户认证功能"</span> \
  --body <span class="hljs-string">"## 功能说明
- 实现了用户登录
- 添加了 Token 认证

## 测试
已通过单元测试和集成测试

## 截图
![功能截图](https://...)"</span> \
  --base main \
  --reviewer @team-leader
</code></pre>
<h4 data-id="heading-12">查看 PR</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有 PR</span>
gh <span class="hljs-built_in">pr</span> list

<span class="hljs-comment"># 输出示例（简化格式）：</span>
<span class="hljs-comment"># #23  修复登录Bug              user1  2 hours ago</span>
<span class="hljs-comment"># #22  添加新功能               user2  1 day ago</span>
<span class="hljs-comment"># #21  更新文档                 user3  2 days ago</span>

<span class="hljs-comment"># 查看 PR 详情</span>
gh <span class="hljs-built_in">pr</span> view 23

<span class="hljs-comment"># 在浏览器中打开</span>
gh <span class="hljs-built_in">pr</span> view 23 --web

<span class="hljs-comment"># 筛选特定状态的 PR</span>
gh <span class="hljs-built_in">pr</span> list --state open --author <span class="hljs-string">"@me"</span>
</code></pre>
<h4 data-id="heading-13">审查和合并 PR</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看变更（类似 git diff）</span>
gh <span class="hljs-built_in">pr</span> diff 23

<span class="hljs-comment"># 添加评论</span>
gh <span class="hljs-built_in">pr</span> comment 23 --body <span class="hljs-string">"这个地方可以优化"</span>

<span class="hljs-comment"># 批准 PR</span>
gh <span class="hljs-built_in">pr</span> review 23 --approve

<span class="hljs-comment"># 请求变更</span>
gh <span class="hljs-built_in">pr</span> review 23 --request-changes --body <span class="hljs-string">"需要修改XX"</span>

<span class="hljs-comment"># 合并 PR</span>
gh <span class="hljs-built_in">pr</span> merge 23 --squash --delete-branch
</code></pre>
<h3 data-id="heading-14">3. Issue 管理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建 Issue</span>
gh issue create \
  --title <span class="hljs-string">"Bug: 用户无法登录"</span> \
  --body <span class="hljs-string">"## 复现步骤
1. 打开登录页面
2. 输入密码
3. 点击登录

## 期望
登录成功

## 实际
提示密码错误"</span> \
  --label bug,high-priority

<span class="hljs-comment"># 列出 Issue</span>
gh issue list --label bug --state open

<span class="hljs-comment"># 查看 Issue</span>
gh issue view 42

<span class="hljs-comment"># 在本地编辑 Issue</span>
gh issue edit 42 --add-label <span class="hljs-string">"in-progress"</span>
</code></pre>
<h3 data-id="heading-15">4. 仓库操作</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建仓库</span>
gh repo create my-awesome-project --public --<span class="hljs-built_in">source</span>=. --remote=origin

<span class="hljs-comment"># Fork 仓库</span>
gh repo fork username/repo

<span class="hljs-comment"># Clone 仓库</span>
gh repo <span class="hljs-built_in">clone</span> username/repo

<span class="hljs-comment"># 设置仓库可见性</span>
gh repo edit --visibility private
</code></pre>
<h3 data-id="heading-16">5. Actions 工作流</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看工作流运行记录</span>
gh run list

<span class="hljs-comment"># 查看特定运行详情</span>
gh run view 456

<span class="hljs-comment"># 查看运行日志</span>
gh run view 456 --<span class="hljs-built_in">log</span>

<span class="hljs-comment"># 重新运行失败的 workflow</span>
gh run rerun 456

<span class="hljs-comment"># 监控运行（实时输出）</span>
gh run watch
</code></pre>
<h3 data-id="heading-17">6. API 调用</h3>
<p>这是 <code>gh</code> 最强大的功能之一，允许你直接调用 GitHub API：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取用户信息</span>
gh api /users/octocat

<span class="hljs-comment"># 创建 Release</span>
gh api \
  --method POST \
  -H <span class="hljs-string">"Accept: application/vnd.github.v3+json"</span> \
  /repos/owner/repo/releases \
  -f tag_name=v1.0.0 \
  -f name=<span class="hljs-string">"v1.0.0"</span> \
  -f body=<span class="hljs-string">"发布说明"</span>

<span class="hljs-comment"># 查询 GraphQL API</span>
gh api graphql \
  -f query=<span class="hljs-string">'
    query {
      viewer {
        login
        contributionsCollection {
          totalCommitContributions
        }
      }
    }'</span>
</code></pre>
<h2 data-id="heading-18">实战应用场景</h2>
<h3 data-id="heading-19">场景一：高效的 PR 工作流</h3>
<p><strong>问题</strong>：每天需要处理大量 PR，在网页和终端之间切换非常累。</p>
<p><strong>解决方案</strong>：使用 <code>gh</code> 的组合命令</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 查看需要我审核的 PR</span>
gh <span class="hljs-built_in">pr</span> list --search <span class="hljs-string">"review-requested:@me"</span>

<span class="hljs-comment"># 2. 查看 PR 的代码变更</span>
gh <span class="hljs-built_in">pr</span> diff 123

<span class="hljs-comment"># 3. 如果没问题，直接批准</span>
gh <span class="hljs-built_in">pr</span> review 123 --approve -b <span class="hljs-string">"LGTM!"</span>

<span class="hljs-comment"># 4. 合并 PR</span>
gh <span class="hljs-built_in">pr</span> merge 123 --squash

<span class="hljs-comment"># 一键操作：查看 + 批准 + 合并</span>
gh <span class="hljs-built_in">pr</span> merge 123 --squash --subject <span class="hljs-string">"Merge PR #123"</span> --body <span class="hljs-string">"自动合并"</span>
</code></pre>
<h3 data-id="heading-20">场景二：批量操作 Issues</h3>
<p><strong>问题</strong>：需要批量关闭已解决的 Issue。</p>
<p><strong>前置条件</strong>：需要安装 <code>jq</code> 工具来处理 JSON 数据</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS</span>
brew install jq

<span class="hljs-comment"># Linux</span>
sudo apt install jq
</code></pre>
<p><strong>解决方案</strong>：结合 <code>jq</code> 进行批量操作</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有标注为 "done" 的 Issue</span>
gh issue list --label <span class="hljs-keyword">done</span> --json number,title --jq <span class="hljs-string">'.[].number'</span>

<span class="hljs-comment"># 批量关闭</span>
gh issue list --label <span class="hljs-keyword">done</span> --json number --jq <span class="hljs-string">'.[].number'</span> | \
  xargs -I {} gh issue close {} --comment <span class="hljs-string">"已完成，自动关闭"</span>
</code></pre>
<h3 data-id="heading-21">场景三：自动化 Release 流程</h3>
<p><strong>问题</strong>：每次发布需要手动创建 Release、上传 Asset。</p>
<p><strong>解决方案</strong>：使用 <code>gh</code> 脚本化</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># release.sh</span>

VERSION=<span class="hljs-variable">$1</span>

<span class="hljs-comment"># 构建</span>
npm run build

<span class="hljs-comment"># 创建 Tag</span>
git tag -a <span class="hljs-variable">$VERSION</span> -m <span class="hljs-string">"Release <span class="hljs-variable">$VERSION</span>"</span>
git push origin <span class="hljs-variable">$VERSION</span>

<span class="hljs-comment"># 创建 Release</span>
gh release create <span class="hljs-variable">$VERSION</span> \
  ./dist/bundle.zip \
  --title <span class="hljs-string">"Release <span class="hljs-variable">$VERSION</span>"</span> \
  --notes <span class="hljs-string">"## 更新内容
- 新增功能 X
- 修复 Bug Y

## 安装
\`\`\`bash
npm install @my/package@<span class="hljs-variable">$VERSION</span>
\`\`\`"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Release <span class="hljs-variable">$VERSION</span> created successfully!"</span>
</code></pre>
<p>使用方法：</p>
<pre><code class="hljs language-bash" lang="bash">./release.sh v1.2.0
</code></pre>
<h3 data-id="heading-22">场景四：CI/CD 集成</h3>
<p><strong>GitHub Actions 示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'v*'</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Create</span> <span class="hljs-string">Release</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">GITHUB_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">}}</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          gh release create ${{ github.ref_name }} \
            --title "Release ${{ github.ref_name }}" \
            --notes "自动发布"
</span></code></pre>
<h3 data-id="heading-23">场景五：团队协作优化</h3>
<p><strong>配置别名</strong>：在 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 中添加</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># PR 别名</span>
<span class="hljs-built_in">alias</span> prs=<span class="hljs-string">'gh pr list'</span>
<span class="hljs-built_in">alias</span> prc=<span class="hljs-string">'gh pr create'</span>
<span class="hljs-built_in">alias</span> prv=<span class="hljs-string">'gh pr view'</span>
<span class="hljs-built_in">alias</span> prm=<span class="hljs-string">'gh pr merge'</span>

<span class="hljs-comment"># Issue 别名</span>
<span class="hljs-built_in">alias</span> issues=<span class="hljs-string">'gh issue list'</span>
<span class="hljs-built_in">alias</span> issuec=<span class="hljs-string">'gh issue create'</span>

<span class="hljs-comment"># 常用查询</span>
<span class="hljs-built_in">alias</span> my-prs=<span class="hljs-string">'gh pr list --author "@me"'</span>
<span class="hljs-built_in">alias</span> my-issues=<span class="hljs-string">'gh issue list --author "@me"'</span>
<span class="hljs-built_in">alias</span> review-prs=<span class="hljs-string">'gh pr list --search "review-requested:@me"'</span>
</code></pre>
<h2 data-id="heading-24">扩展系统</h2>
<p><code>gh</code> 支持自定义扩展，这是它最强大的特性之一。</p>
<h3 data-id="heading-25">安装扩展</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 从 GitHub 仓库安装扩展</span>
gh extension install https://github.com/meiji163/gh-pr-overflow

<span class="hljs-comment"># 列出已安装的扩展</span>
gh extension list
</code></pre>
<h3 data-id="heading-26">创建自定义扩展</h3>
<p>示例 1：快速统计贡献的扩展</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建扩展目录</span>
<span class="hljs-built_in">mkdir</span> -p ~/.local/share/gh/extensions/gh-stats

<span class="hljs-comment"># 2. 创建可执行文件</span>
<span class="hljs-built_in">cat</span> &gt; ~/.local/share/gh/extensions/gh-stats/gh-stats &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># 统计个人贡献</span>

<span class="hljs-comment"># 获取用户名</span>
USER=$(gh api /user --jq <span class="hljs-string">'.login'</span>)

<span class="hljs-comment"># 获取统计信息（优化 API 调用）</span>
PRS=$(gh <span class="hljs-built_in">pr</span> list --author <span class="hljs-string">"@me"</span> --json <span class="hljs-built_in">id</span> --jq <span class="hljs-string">'. | length'</span>)
ISSUES=$(gh issue list --author <span class="hljs-string">"@me"</span> --json <span class="hljs-built_in">id</span> --jq <span class="hljs-string">'. | length'</span>)
REPOS=$(gh repo list --json name --jq <span class="hljs-string">'. | length'</span>)

<span class="hljs-built_in">echo</span> <span class="hljs-string">"贡献统计 (@<span class="hljs-variable">$USER</span>)"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"━━━━━━━━━━━━━━━━━━━━━━"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"PRs:      <span class="hljs-variable">$PRS</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Issues:   <span class="hljs-variable">$ISSUES</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Repos:    <span class="hljs-variable">$REPOS</span>"</span>
EOF

<span class="hljs-comment"># 3. 添加执行权限</span>
<span class="hljs-built_in">chmod</span> +x ~/.local/share/gh/extensions/gh-stats/gh-stats

<span class="hljs-comment"># 4. 使用扩展</span>
gh stats
</code></pre>
<p>示例 2：批量关闭 PR 的扩展</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建批量关闭 PR 的扩展</span>
<span class="hljs-built_in">mkdir</span> -p ~/.local/share/gh/extensions/gh-pr-close

<span class="hljs-built_in">cat</span> &gt; ~/.local/share/gh/extensions/gh-pr-close/gh-pr-close &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># 批量关闭已合并的 PR</span>

gh <span class="hljs-built_in">pr</span> list --state merged --json number --jq <span class="hljs-string">'.[].number'</span> | \
  xargs -I {} gh <span class="hljs-built_in">pr</span> close {} --comment <span class="hljs-string">"自动关闭已合并的 PR"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"已关闭所有已合并的 PR"</span>
EOF

<span class="hljs-built_in">chmod</span> +x ~/.local/share/gh/extensions/gh-pr-close/gh-pr-close
</code></pre>
<p><strong>输出示例</strong>：</p>
<pre><code class="hljs language-css" lang="css">贡献统计 (<span class="hljs-keyword">@octocat</span>)
━━━━━━━━━━━━━━━━━━━━━━
<span class="hljs-attribute">Commits</span>:  <span class="hljs-number">152</span>
<span class="hljs-attribute">PRs</span>:      <span class="hljs-number">23</span>
<span class="hljs-attribute">Issues</span>:   <span class="hljs-number">12</span>
</code></pre>
<h2 data-id="heading-27">与其他工具对比</h2>















































<table><thead><tr><th>特性</th><th>GitHub CLI (<code>gh</code>)</th><th>Hub</th><th>GitLab CLI (<code>glab</code>)</th></tr></thead><tbody><tr><td>官方支持</td><td>GitHub 官方</td><td>第三方</td><td>GitLab 官方</td></tr><tr><td>PR 操作</td><td>完整支持</td><td>基础支持</td><td>完整支持</td></tr><tr><td>Actions 支持</td><td>原生支持</td><td>不支持</td><td>CI/CD 有限支持</td></tr><tr><td>扩展系统</td><td>强大</td><td>不支持</td><td>有限支持</td></tr><tr><td>GraphQL API</td><td>支持</td><td>不支持</td><td>支持</td></tr><tr><td>学习曲线</td><td>简单</td><td>中等</td><td>简单</td></tr></tbody></table>
<p><strong>选择建议</strong>：</p>
<ul>
<li><strong>GitHub 用户</strong>：首选 <code>gh</code>，官方维护，功能完整</li>
<li><strong>GitLab 用户</strong>：使用 <code>glab</code>，设计理念类似</li>
<li><strong>需要跨平台</strong>：<code>gh</code> 支持最好</li>
</ul>
<p><strong>从 Hub 迁移到 gh</strong>：</p>
<p>如果你之前使用 Hub，迁移到 gh 非常简单：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Hub 命令 → gh 命令对照</span>
hub pull-request     → gh <span class="hljs-built_in">pr</span> create
hub <span class="hljs-built_in">pr</span> list          → gh <span class="hljs-built_in">pr</span> list
hub issue             → gh issue create
hub release           → gh release create
hub browse            → gh repo view --web
hub ci-status         → gh <span class="hljs-built_in">pr</span> checks
</code></pre>
<p>主要区别：</p>
<ul>
<li><code>gh</code> 默认不修改 Git 配置</li>
<li><code>gh</code> 需要显式认证（<code>gh auth login</code>）</li>
<li><code>gh</code> 使用子命令结构（如 <code>gh pr</code>）而不是 flag（如 <code>hub pr</code>）</li>
</ul>
<h2 data-id="heading-28">最佳实践</h2>
<h3 data-id="heading-29">1. 认证管理</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 多账号管理</span>
gh auth login --hostname github.company.com

<span class="hljs-comment"># 查看当前登录状态</span>
gh auth status

<span class="hljs-comment"># 退出登录</span>
gh auth <span class="hljs-built_in">logout</span>
</code></pre>
<h3 data-id="heading-30">2. 配置文件</h3>
<p>创建 <code>~/.config/gh/config.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 配置默认编辑器</span>
<span class="hljs-attr">editor:</span> <span class="hljs-string">vim</span>

<span class="hljs-comment"># 配置 Git 协议</span>
<span class="hljs-attr">git_protocol:</span> <span class="hljs-string">ssh</span>

<span class="hljs-comment"># 配置浏览器</span>
<span class="hljs-attr">browser:</span> <span class="hljs-string">chromium</span>
</code></pre>
<h3 data-id="heading-31">3. 别名和快捷键</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 常用别名</span>
<span class="hljs-built_in">alias</span> gh=<span class="hljs-string">'npx gh'</span>  <span class="hljs-comment"># 如果使用 npx 安装</span>

<span class="hljs-comment"># 快捷函数</span>
<span class="hljs-keyword">function</span> gh-pr-<span class="hljs-function"><span class="hljs-title">checkout</span></span>() {
  gh <span class="hljs-built_in">pr</span> checkout <span class="hljs-variable">$1</span>
}
</code></pre>
<h3 data-id="heading-32">4. 脚本集成</h3>
<p>在 CI/CD 脚本中广泛使用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 自动化脚本示例</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># 检查 PR 是否通过 CI</span>
pr_number=<span class="hljs-variable">$1</span>
status=$(gh <span class="hljs-built_in">pr</span> view <span class="hljs-variable">$pr_number</span> --json statusCheckRollup --jq <span class="hljs-string">'.statusCheckRollup[] | select(.status == "COMPLETED") | .conclusion'</span>)

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$status</span>"</span> == <span class="hljs-string">"SUCCESS"</span> ]; <span class="hljs-keyword">then</span>
  gh <span class="hljs-built_in">pr</span> merge <span class="hljs-variable">$pr_number</span> --squash
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"CI 未通过，无法合并"</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</code></pre>
<h2 data-id="heading-33">性能优化</h2>
<h3 data-id="heading-34">缓存机制</h3>
<p><code>gh</code> 使用本地缓存减少 API 调用：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看缓存列表</span>
gh cache list

<span class="hljs-comment"># 清除缓存</span>
gh cache reset

<span class="hljs-comment"># 禁用缓存（强制刷新）</span>
gh api /users/octocat --cache 0s

<span class="hljs-comment"># 设置缓存时间</span>
gh api /repos/user/repo --cache 5m
</code></pre>
<h3 data-id="heading-35">并发请求</h3>
<p>处理大量数据时，使用并发可以显著提升速度：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 xargs 并发处理（4 个并发）</span>
gh <span class="hljs-built_in">pr</span> list --json number --jq <span class="hljs-string">'.[].number'</span> | \
  xargs -P 4 -I {} gh <span class="hljs-built_in">pr</span> view {}

<span class="hljs-comment"># 对比：串行处理需要 10 秒，并发处理仅需 3 秒（约提升 70%）</span>
</code></pre>
<h3 data-id="heading-36">性能对比</h3>



































<table><thead><tr><th>操作</th><th>网页方式</th><th>gh 命令</th><th>效率提升</th></tr></thead><tbody><tr><td>创建 PR</td><td>~30 秒</td><td>~5 秒</td><td>约 83%</td></tr><tr><td>查看 PR 列表</td><td>~10 秒</td><td>~2 秒</td><td>约 80%</td></tr><tr><td>合并 PR</td><td>~15 秒</td><td>~3 秒</td><td>约 80%</td></tr><tr><td>批量关闭 Issue</td><td>~5 分钟</td><td>~30 秒</td><td>约 90%</td></tr></tbody></table>
<p><em>以上数据基于个人使用经验，实际速度取决于网络环境和操作复杂度</em></p>
<h2 data-id="heading-37">常见问题</h2>
<h3 data-id="heading-38">Q1: <code>gh</code> 命令执行很慢？</h3>
<p><strong>原因</strong>：每次都调用 GitHub API，网络延迟影响响应速度</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 使用缓存减少重复请求</span>
gh cache list  <span class="hljs-comment"># 查看缓存</span>
gh cache reset  <span class="hljs-comment"># 清除缓存</span>

<span class="hljs-comment"># 2. 减少查询字段</span>
gh <span class="hljs-built_in">pr</span> list --json number,title --<span class="hljs-built_in">limit</span> 10

<span class="hljs-comment"># 3. 限制返回数量</span>
gh issue list --<span class="hljs-built_in">limit</span> 20

<span class="hljs-comment"># 4. 使用并发处理</span>
gh <span class="hljs-built_in">pr</span> list --json number --jq <span class="hljs-string">'.[].number'</span> | xargs -P 4 -I {} gh <span class="hljs-built_in">pr</span> view {}
</code></pre>
<h3 data-id="heading-39">Q2: 如何在企业 GitHub 中使用？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录企业版</span>
gh auth login --hostname github.company.com

<span class="hljs-comment"># 查看当前登录状态</span>
gh auth status

<span class="hljs-comment"># 之后的命令会自动使用企业版实例</span>
gh repo list
</code></pre>
<h3 data-id="heading-40">Q3: 如何调试 API 请求？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用调试模式（查看详细的 API 调用信息）</span>
GH_DEBUG=1 gh <span class="hljs-built_in">pr</span> list

<span class="hljs-comment"># 查看 API 调用的详细信息</span>
gh api /user --verbose

<span class="hljs-comment"># 查看请求头和响应头</span>
gh api /user -i
</code></pre>
<h3 data-id="heading-41">Q4: 认证失败怎么办？</h3>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查登录状态</span>
gh auth status

<span class="hljs-comment"># 2. 重新登录</span>
gh auth <span class="hljs-built_in">logout</span>
gh auth login

<span class="hljs-comment"># 3. 刷新 Token</span>
gh auth refresh

<span class="hljs-comment"># 4. 检查网络连接</span>
gh api /user
</code></pre>
<h3 data-id="heading-42">Q5: 如何处理 API 速率限制？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看剩余配额</span>
gh api /rate_limit

<span class="hljs-comment"># 减少请求频率</span>
<span class="hljs-comment"># 方案1：使用缓存</span>
gh api /repos/user/repo --cache 5m

<span class="hljs-comment"># 方案2：批量操作</span>
gh <span class="hljs-built_in">pr</span> list --json number,title --<span class="hljs-built_in">limit</span> 100

<span class="hljs-comment"># 方案3：使用 GraphQL 一次获取多个数据</span>
gh api graphql -f query=<span class="hljs-string">'query { viewer { login repositories(first: 100) { nodes { name } } } }'</span>
</code></pre>
<h3 data-id="heading-43">Q6: 如何配置代理？</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置环境变量</span>
<span class="hljs-built_in">export</span> HTTP_PROXY=http://proxy.example.com:8080
<span class="hljs-built_in">export</span> HTTPS_PROXY=http://proxy.example.com:8080

<span class="hljs-comment"># 或在配置文件中设置</span>
<span class="hljs-comment"># 编辑 ~/.config/gh/config.yml</span>
<span class="hljs-comment"># http_proxy: http://proxy.example.com:8080</span>
</code></pre>
<h2 data-id="heading-44">未来展望</h2>
<p><code>gh</code> 的发展趋势：</p>
<ol>
<li><strong>AI 集成</strong>：结合 GitHub Copilot 提供智能建议</li>
<li><strong>更多扩展</strong>：社区驱动的扩展生态</li>
<li><strong>性能优化</strong>：更快的响应速度</li>
<li><strong>GraphQL 增强</strong>：更强大的查询能力</li>
</ol>
<h2 data-id="heading-45">总结</h2>
<p>GitHub CLI (<code>gh</code>) 从诞生到成熟，彻底改变了开发者与 GitHub 的交互方式：</p>
<p><strong>核心价值</strong>：</p>
<ul>
<li><strong>效率提升</strong>：大幅减少网页操作，基于个人使用经验，可减少约 70-80% 的浏览器切换</li>
<li><strong>自动化友好</strong>：易于脚本化和集成到 CI/CD 流程</li>
<li><strong>学习成本低</strong>：简洁直观的命令设计</li>
<li><strong>扩展性强</strong>：支持自定义扩展</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>日常开发工作流</li>
<li>CI/CD 自动化</li>
<li>团队协作优化</li>
<li>批量操作</li>
</ul>
<p><strong>学习建议</strong>：</p>
<ol>
<li>从基础命令开始：<code>gh pr</code>, <code>gh issue</code>, <code>gh repo</code></li>
<li>掌握 <code>gh api</code> 的强大功能</li>
<li>结合实际工作流创建别名和脚本</li>
<li>探索社区扩展，发现更多玩法</li>
</ol>
<h2 data-id="heading-46">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fen%2Fcli" target="_blank" title="https://docs.github.com/en/cli" ref="nofollow noopener noreferrer">GitHub CLI 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcli%2Fcli" target="_blank" title="https://github.com/cli/cli" ref="nofollow noopener noreferrer">GitHub CLI GitHub 仓库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcli%2Fcli%2Fwiki%2FExtensions" target="_blank" title="https://github.com/cli/cli/wiki/Extensions" ref="nofollow noopener noreferrer">gh 扩展市场</a></li>
</ul>
<hr/>
<p>如果你在使用 <code>gh</code> 的过程中遇到问题，或者有更高效的使用技巧，欢迎在评论区分享！</p>
<p><strong>如果本文对你有帮助，别忘了点赞收藏关注~</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C 语言循环语句详解：从入门到熟练，搞定重复操作不再难]]></title>    <link>https://juejin.cn/post/7601076815450095631</link>    <guid>https://juejin.cn/post/7601076815450095631</guid>    <pubDate>2026-02-01T08:02:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815450095631" data-draft-id="7601076815450062863" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C 语言循环语句详解：从入门到熟练，搞定重复操作不再难"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-02-01T08:02:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户11674320658"/> <meta itemprop="url" content="https://juejin.cn/user/4338018464577738"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C 语言循环语句详解：从入门到熟练，搞定重复操作不再难
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4338018464577738/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户11674320658
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:02:07.000Z" title="Sun Feb 01 2026 08:02:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>C 语言循环语句详解：从入门到熟练，搞定重复操作不再难</p>
<h2 data-id="heading-0">前言</h2>
<p>初学 C 语言时，你是不是也遇到过这样的场景：需要打印 100 遍「Hello World」，如果逐行写printf("Hello World");，不仅要写 100 行代码，还容易出错；需要计算 1 到 100 的累加和，手动计算既麻烦又不灵活。</p>
<p>这时候，「循环语句」就成了我们的「救星」—— 它能让程序重复执行某一段代码，大大简化工作量，提高代码效率和可维护性。</p>
<p>今天这篇文章，我们就来全面吃透 C 语言中的 3 大循环语句：for、while、do-while，包括它们的语法、用法、区别以及实战场景，新手也能轻松上手。</p>
<h2 data-id="heading-1">什么是循环语句</h2>
<p>在C语言中，循环语句是流程控制语句的一种，其核心作用是：在满足指定条件的前提下，重复执行某一段代码快（称为：循环体）。</p>
<p>在生活中，也有很多与循环有关的场景，比如：</p>
<p>1.每天早上 7 点起床→洗漱→吃早餐→上班，直到周末（条件：非周末）；</p>
<p>2.往杯子里倒水，直到水面到达杯口（条件：水杯未满）；</p>
<p>3.打印1到10的数字，重复执行（打印数字 + 数字+1）的操作，直到数字大于10。</p>
<p>C语言中有三种最基本的循环语句，分别是for，while，do-while，分别对应不同的场景，接下来让我们来逐一拆解。</p>
<h2 data-id="heading-2">三大循环语句详解</h2>
<h3 data-id="heading-3">一、while循环：简洁直观（适合未知循环次数，但知道终止条件的场景）</h3>
<h4 data-id="heading-4">语法格式：</h4>
<pre><code class="hljs language-c" lang="c">初始化表达式：
<span class="hljs-keyword">while</span>（条件判断表达式）
{
		循环体代码：<span class="hljs-comment">//条件为真时执行</span>
		更新表达式；<span class="hljs-comment">//修改循环变量，避免死循环</span>
}
</code></pre>
<h4 data-id="heading-5">执行流程</h4>
<p>1.先执行循环外的初始化表达式（仅一次）</p>
<p>2 执行while后的 [条件判断表达式] ,判断是否为真</p>
<p>3如果条件为真，则进入循环，并执行循环体代码；如果条件为假，则跳出循环</p>
<h4 data-id="heading-6">代码演示</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> n = <span class="hljs-number">1</span>;
	<span class="hljs-keyword">while</span> (n &lt;= <span class="hljs-number">10</span>)
	{
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, n);
		n++;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/483aa9e9c5014952afd877515c0b7134~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=%2BFR6wwRuTP8L6cjkawKJKAeHwKw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这段代码的作用是从1打印到10.</p>
<h4 data-id="heading-7">提醒</h4>
<ol>
<li>
<p>while循环的初始化在循环体外，更新表达式在循环体内，一定要记得写（更新循环体）的代码，否则循环将无法终止，容易造成死循环（比如：上述代码如果没有n++；则该段代码将陷入死循环，无限打印0）</p>
</li>
<li>
<p>当然更新表达式这一步骤可以根据情况写在while括号后面的条件判断表达式中</p>
</li>
<li>
<p>当循环体只有一行代码时，大括号”{ }‘可以省略，但是并不推荐这样做，这会导致代码不方便阅读</p>
</li>
</ol>
<h3 data-id="heading-8">二、for循环：最常用，最灵活的循环（适合已知循环次数的场景）</h3>
<p>for循环吧（初始化，循环条件，更新变量）集中在一行，结构清晰，是使用频率最高的循环。</p>
<h4 data-id="heading-9">语法格式</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">for</span>(初始化表达式；条件判断表达式；更新表达式）
{
		循环体代码<span class="hljs-comment">//条件为真时，重复执行</span>
}
</code></pre>
<h4 data-id="heading-10">执行流程</h4>
<ol>
<li>执行初始化表达式（仅执行一次，用于初始化循环变量）</li>
<li>执行条件判断表达式（返回布尔值：真 / 假，C语言中用（非0表示真，0表示假）</li>
<li>如果条件为“真 ”，执行 [循环体代码] ; 如果条件为 “假” , 直接跳出循环，结束for循环</li>
<li>循环体代码执行完毕后，执行更新表达式</li>
<li>回到步骤2，重复执行，直到条件为假</li>
</ol>
<h4 data-id="heading-11">代码演示</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> n = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span> (n = <span class="hljs-number">1</span>; n &lt;= <span class="hljs-number">10</span>; n++)
	{
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>,n);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f87e7d48fa274049bd8ff47cade9229f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=sUvdQrZiVgbpVK7WEi3xu58IfUQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这段代码先初始化n = 0；然后开始进入for循环，首先先将n初始化为1，然后进行条件判断n &lt;= 10，发现条件满足，然后进入循环体开始执行循环语句，打印n的值，循环体代码执行完毕后，再进行更新表达式这一步骤，即n++，让n的值自增1；然后不断循环直到 [条件判断表达式] 为假，然后结束循环。</p>
<h4 data-id="heading-12">提醒</h4>
<ol>
<li>初始化表达式可以定义多个变量，每个变量间用逗号隔开，更新表达式也可以修改多个变量，比如（for（int i = 0, j = 10; i &lt;= 10; i++, j--);</li>
<li>循环体如果只有一行代码，大括号“{ }”可以省略，但是不推荐这样做，这会导致代码的可读性差，容易出错;</li>
<li>for()的“（）”后面不要加“ ；”，否则的话会导致无法正常进入循环体，而是先执行完 [更新表达式] 里面的代码后，再进入循环体内；</li>
<li>对比while循环，for循环更适合 [已知循环次数] ,而while循环更适合 [未知循环次数] ,但二者可以根据情况相互转换。</li>
</ol>
<h3 data-id="heading-13">三、do-while循环：先执行后判断</h3>
<p>do-while循环是 “先执行循环体，再判断条件”，无论条件是否为真，循环体都会至少执行一次，使用场景较少，但在某些特定场景下不可替代。</p>
<h4 data-id="heading-14">语法格式</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// 语法格式</span>
初始化表达式; <span class="hljs-comment">// 循环变量初始化</span>
<span class="hljs-keyword">do</span> {
    循环体代码; <span class="hljs-comment">// 先执行1次，再判断条件</span>
    更新表达式; <span class="hljs-comment">// 修改循环变量</span>
} <span class="hljs-keyword">while</span> (条件判断表达式); <span class="hljs-comment">// 注意：末尾有分号</span>
</code></pre>
<h4 data-id="heading-15">执行流程</h4>
<ol>
<li>先执行循环外的 [初始化表达式];</li>
<li>进入do-while循环，先执行 [循环体代码] ,无论条件是否为真，都先执行一次；</li>
<li>执行 [更新表达式] ,修改循环变量；</li>
<li>执行while后面的 [条件判断表达式] ,判断是否为真。</li>
<li>如果条件为真：回到步骤2，继续进行循环。如果条件为假：则跳出循环。</li>
</ol>
<h4 data-id="heading-16">代码演示</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span> <span class="hljs-comment">// 用于strcmp()函数：比较两个字符串是否相等</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 示例：用户登录验证，默认密码为"123456"，至少提示1次输入密码</span>
    <span class="hljs-type">char</span> password[<span class="hljs-number">20</span>]; <span class="hljs-comment">// 定义字符数组，存储用户输入的密码</span>
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"=== 用户登录 ===\n"</span>);

    <span class="hljs-keyword">do</span> {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"请输入登录密码："</span>);
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, password); <span class="hljs-comment">// 读取用户输入的密码（无需&amp;，字符数组名本身是地址）</span>

        <span class="hljs-comment">// strcmp(a, b)：比较字符串a和b，相等返回0，不相等返回非0</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(password, <span class="hljs-string">"123456"</span>) == <span class="hljs-number">0</span>) {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"密码正确，登录成功！\n"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"密码错误，请重新输入！\n"</span>);
        }
    } <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strcmp</span>(password, <span class="hljs-string">"123456"</span>) != <span class="hljs-number">0</span>); <span class="hljs-comment">// 终止条件：密码正确</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fed790d0ef7a46b88bd2f66b5e34fa05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=XDhkjnRE%2FPkkJVIc%2F%2BXXNbY%2B7Ok%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>根据代码运行结果可以看出，无论输入的密码是否正确，都会进入一次循环，并执行一次循环体的内容。</p>
<h4 data-id="heading-17">提醒</h4>
<ol>
<li>do-while循环中，while的“ （）”后面必须加 [ ; ]，这是C语言语法的要求。</li>
<li>循环体至少执行一次，这一点与for循环和while循环不同。</li>
<li>使用场景有限，仅在必须先执行一次循环体的情况下才会使用</li>
</ol>
<h3 data-id="heading-18">循环跳转关键字(break/continue）</h3>
<p>我们已经掌握了三种循环的基础用法，但在实际开发中往往还需要在循环执行的过程中 [提前终止整个循环] 或 [跳过本次循环的剩余内容]。这时我们就需要 break 和 continue 这两个关键字来解决上述问题，下面我们就来详细拆解他们的用法和区别。</p>
<h4 data-id="heading-19">break</h4>
<p>break的作用是提前终止整个循环，当代码运行到break时，break会使整个循环提前终止，跳出循环。</p>
<h5 data-id="heading-20">代码演示</h5>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (i &lt;= <span class="hljs-number">10</span>)
	{
		<span class="hljs-keyword">if</span> (i == <span class="hljs-number">6</span>)
		{
			<span class="hljs-keyword">break</span>;
		}
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, i);
		i++;
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84522e07437b421080398c86b00f03d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=%2Fz6G4piVqsjRi9utMTaAc2uPSKI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>观察上述代码的运行结果，我们发现最后的结果并不是从0打印到10，为什么会出现这样的情况？</p>
<p>这是因为当 i 自增到6时会进入if的判断语句，i == 6，执行break，break使得循环强制终止，跳出循环，不再进入后面的循环。因此这段代码的运行结果是0 1 2 3 4 5.</p>
<h4 data-id="heading-21">continue</h4>
<p>continue的作用是当代码执行到continue时，continue会使得程序跳过本次循环后面的语句，进入下一次循环中。</p>
<h5 data-id="heading-22">代码演示</h5>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span>

<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
	<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;
	<span class="hljs-keyword">while</span> (i &lt; <span class="hljs-number">10</span>)
	{
		i++;
		<span class="hljs-keyword">if</span> (i == <span class="hljs-number">6</span>)
		{
			<span class="hljs-keyword">continue</span>;
		}
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d "</span>, i);
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>代码运行结果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcbe71b56351489a9e66a86bda15f212~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTE2NzQzMjA2NTg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537726&amp;x-signature=62VwYSFGSm1QyFLuXZGnj%2B4r8Y4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>由代码运行结果可以看出，这段代码从1到10依次打印却跳过了6，这是为什么呢？</p>
<p>究其原因是因为当 i 自增到6时，进入if语句中，i == 6；执行continue语句，continue使得本次循环强制终止，并进入到下一次循环中，因此当 i = 6时，printf("%d ",i)这个语句被跳过了，并没有被执行，因此屏幕上并没有打印6.</p>
<h5 data-id="heading-23">提醒</h5>
<p>使用continue时，一定要确保循环变量在continue之前完成更新，否则的话会进入死循环。</p>
<h3 data-id="heading-24">实战练习</h3>
<p>题目 1：使用for循环，打印 99 乘法表（经典练习题，考察循环嵌套，可选做）；</p>
<p>题目 2：使用while循环，计算 1 到 100 中所有偶数的和</p>
<p>题目 3：使用do-while循环，实现一个简单的菜单（选择 1 打印当前时间、选择 2 退出，至少显示 1 次菜单）。</p>
<h3 data-id="heading-25">总结</h3>
<p>今天我们全面讲解了 C 语言中的 3 大循环语句：for、while、do-while，核心总结如下：</p>
<ol>
<li>循环语句的核心作用是「重复执行某段代码」，简化工作量，提高代码效率；</li>
<li>for循环适合已知循环次数，while循环适合未知循环次数，do-while循环适合循环体至少执行 1 次；</li>
<li>三者可以相互转换，但优先根据场景选择最简洁、可读性最高的循环；
4，开发中要避免无意造成的死循环，记得写「更新表达式」。</li>
</ol>
<p>循环语句是 C 语言的基础，也是后续学习「循环嵌套」「数组遍历」「算法实现」的前提，建议大家多动手练习，熟能生巧。</p>
<p>如果你有任何问题，欢迎在评论区留言，我们一起交流学习！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[传说中的C++精灵库，专治“C++恐惧症”?]]></title>    <link>https://juejin.cn/post/7601313474719219747</link>    <guid>https://juejin.cn/post/7601313474719219747</guid>    <pubDate>2026-02-01T08:04:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601313474719219747" data-draft-id="7601077290682089524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="传说中的C++精灵库，专治“C++恐惧症”?"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2026-02-01T08:04:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="李兴球"/> <meta itemprop="url" content="https://juejin.cn/user/1528748152725595"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            传说中的C++精灵库，专治“C++恐惧症”?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1528748152725595/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    李兴球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:04:42.000Z" title="Sun Feb 01 2026 08:04:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这，是一个采用C++精灵库编写的程序，它画了一幅漂亮的图形：</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"sprites.h"</span>  <span class="hljs-comment">//包含C++精灵库 </span></span>
Sprite turtle;      <span class="hljs-comment">//建立角色叫turtle</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-type">int</span> d)</span></span>{
  <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)turtle.<span class="hljs-built_in">fd</span>(d).<span class="hljs-built_in">left</span>(<span class="hljs-number">72</span>);
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{        <span class="hljs-comment">//主功能块 </span>
   turtle.<span class="hljs-built_in">bgcolor</span>(<span class="hljs-string">"black"</span>);
   turtle.<span class="hljs-built_in">pensize</span>(<span class="hljs-number">2</span>).<span class="hljs-built_in">speed</span>(<span class="hljs-number">0</span>);
   <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> step=<span class="hljs-number">10</span>;step&lt;<span class="hljs-number">360</span>;step+=<span class="hljs-number">30</span>){
     turtle.<span class="hljs-built_in">color</span>(step);
     <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">12</span>;i++){
        turtle.<span class="hljs-built_in">pu</span>().<span class="hljs-built_in">fd</span>(step/<span class="hljs-number">2</span> ).<span class="hljs-built_in">right</span>(<span class="hljs-number">60</span>);
        turtle.<span class="hljs-built_in">pd</span>(); <span class="hljs-built_in">draw</span>(step/<span class="hljs-number">10</span>);
        turtle.<span class="hljs-built_in">pu</span>().<span class="hljs-built_in">left</span>(<span class="hljs-number">60</span>).<span class="hljs-built_in">bk</span>(step/<span class="hljs-number">2</span> );
        turtle.<span class="hljs-built_in">right</span>(<span class="hljs-number">30</span>);
     }
   }     
   turtle.<span class="hljs-built_in">ht</span>().<span class="hljs-built_in">done</span>();     <span class="hljs-comment">//完成了</span>
   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;    <span class="hljs-comment">//返回0</span>
}
</code></pre>
<p>而，这是另一个由python turtle编写的程序，画的图形和上面C++的图形几乎一模一样：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> turtle <span class="hljs-keyword">as</span> t
<span class="hljs-keyword">import</span> colorsys

<span class="hljs-comment"># 设置画布</span>
t.bgcolor(<span class="hljs-string">"black"</span>)
t.colormode(<span class="hljs-number">255</span>)  <span class="hljs-comment"># 使用 0-255 的 RGB 范围</span>
t.speed(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 最快速度</span>
t.pensize(<span class="hljs-number">2</span>)
t.hideturtle()

<span class="hljs-keyword">def</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">d</span>):
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
        t.forward(d)
        t.left(<span class="hljs-number">72</span>)

<span class="hljs-comment"># 主绘图逻辑</span>
<span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">360</span>, <span class="hljs-number">30</span>):
    <span class="hljs-comment"># 将 step 映射为颜色：使用 HSV 色彩空间，让颜色随 step 变化（彩虹效果）</span>
    hue = step / <span class="hljs-number">360.0</span>  <span class="hljs-comment"># 归一化到 [0, 1)</span>
    r, g, b = colorsys.hsv_to_rgb(hue, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>)
    t.color(<span class="hljs-built_in">int</span>(r * <span class="hljs-number">255</span>), <span class="hljs-built_in">int</span>(g * <span class="hljs-number">255</span>), <span class="hljs-built_in">int</span>(b * <span class="hljs-number">255</span>))    
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>):
        t.penup()
        t.forward(step / <span class="hljs-number">2</span>)
        t.right(<span class="hljs-number">60</span>)
        t.pendown()
        draw(step // <span class="hljs-number">10</span>)
        t.penup()
        t.left(<span class="hljs-number">60</span>)
        t.backward(step / <span class="hljs-number">2</span>)
        t.right(<span class="hljs-number">30</span>)
turtle.done()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a26a556facb4418bb418774c6248100d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YW055CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537882&amp;x-signature=qzsHGpaBs0kpIqQ45v6mkUJFYYA%3D" alt="2026-02-01_155350" loading="lazy"/></p>
<p><strong>等等！让我揉揉眼睛！</strong> 这到底是什么情况？！C++居然长得像Python？Python居然敢和C++撞衫？！是Python turtle出轨了C++的语法，还是C++红杏出墙学会了Python的撩人技巧？</p>
<p><strong>真相只有一个：因为有了C++精灵库（sprites.h），它专治“C++恐惧症”</strong></p>
<p>你看啊，传统的C++入门那是啥？<code>std::cout &lt;&lt; "Hello World" &lt;&lt; std::endl;</code> —— 这一串标点符号就能劝退半个班的新生！指针、内存管理、编译链接... 简直就是编程界的"高冷男神"，爱你但就是不让你靠近。</p>
<p>但是！有了C++精灵库之后呢？<code>turtle.fd(d).left(72)</code> —— 这链式调用，这丝滑手感，这简直是把C++从"西装革履的老干部"改造成了"穿着潮牌的邻家哥哥"！</p>
<p><strong>震惊！两行代码本质上居然一模一样！</strong></p>
<p>对比看看：</p>
<ul>
<li>C++：<code>turtle.pu().fd(step/2 ).right(60);</code></li>
<li>Python：<code>t.penup(); t.fd(step / 2); t.right(60)</code></li>
</ul>
<p>我的天！C++不仅学会了Python的简单，还保持了C++的优雅链式语法！就像一个人既会做饭又会浪漫，既懂底层又懂生活！</p>
<p><strong>等等，重点来了！这里有个惊天大秘密！</strong> 你以为这只是语法糖？只是简单的有样学样？ 这是<strong>双倍赋能</strong>啊朋友们！看到了没。</p>
<p>当你用Python turtle画图时，你学的是——怎么画图。仅此而已。</p>
<p>但当你用C++精灵库画图时，你学的是——<strong>怎么在数字世界的地基上画图！</strong></p>
<p>想想看，你的操作系统是谁写的？C/C++！你的浏览器内核是谁写的？C++！你的游戏引擎是谁写的？C++！连Python解释器本身，都是用C写的！这就好比，Python是精装修的房子，拎包入住很爽；但C++是钢筋混凝土的地基加精装修技能！<strong>既会盖楼又会装修，你不香吗？</strong></p>
<p><strong>我们可爱的</strong>Python 小海龟依旧玩得欢，它还是那个简单的Python。C++也依然是那个性能怪兽。</p>
<p>真正的"第三者"是<strong>C++精灵库</strong>这个伟大的媒婆！它让C++放下了身段，穿上了Python的便装，但骨子里还是那个能操控硬件、驾驭操作系统、构建数字文明的底层王者！</p>
<p><strong>结论：C++精灵库的出现是技术发展的必然。它让</strong>C++这位“深藏不露”的大佬，终于决定不再装高冷，用最温柔的方式，带你走上真正的技术巅峰！</p>
<p>想看视频的这里有链接： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.douyin.com%2Fvideo%2F7601797221754965288" target="_blank" title="https://www.douyin.com/video/7601797221754965288" ref="nofollow noopener noreferrer">www.douyin.com/video/76017…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数字]]></title>    <link>https://juejin.cn/post/7601076815450406927</link>    <guid>https://juejin.cn/post/7601076815450406927</guid>    <pubDate>2026-02-01T09:43:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815450406927" data-draft-id="7601076815450374159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数字"/> <meta itemprop="keywords" content="数据结构,后端,前端"/> <meta itemprop="datePublished" content="2026-02-01T09:43:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="仍沫"/> <meta itemprop="url" content="https://juejin.cn/user/184373685261719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数字
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685261719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    仍沫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:43:20.000Z" title="Sun Feb 01 2026 09:43:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>提到数字时，会想到当前所需的数值范围是什么，使用什么类型的数字会比较合适，会不会存在溢出或精度丢失等情况。本文会简单介绍数字的概念，以及日常使用数字时需要注意的一些问题。</p>
<p>不同语言中，对数字的实现形式是不同的，比如在Go中数字有int32、int64、float32、float64等类型；在JavaScript中数字只有Number类型，是一种双精度浮点数，不管是整数还是浮点数，都是Number类型（表示范围上相当于Go的float64类型）。</p>
<p>Go：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> a <span class="hljs-type">float64</span> = <span class="hljs-number">1.0</span>
<span class="hljs-keyword">var</span> b <span class="hljs-type">int64</span> = <span class="hljs-number">1</span>
fmt.Printf(<span class="hljs-string">"%T %T\n"</span>, a, b) <span class="hljs-comment">// float64 int64</span>
</code></pre>
<p>JavaScript：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> a = <span class="hljs-number">1.0</span>;
<span class="hljs-keyword">let</span> b = <span class="hljs-number">1</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> a, <span class="hljs-keyword">typeof</span> b) <span class="hljs-comment">// number number</span>
</code></pre>
<p>数字的核心概念部分其实都是一样的，因为实现形式不同，数字在不同语言的代码中，表现可能会不同，要将核心概念和不同语言的特点结合使用。</p>
<p>接下来的数据结构等一系列文章，都以Go语言为例进行说明。</p>
<h2 data-id="heading-0">bit（比特）</h2>
<blockquote>
<p><strong>bit（比特 binary digit）</strong> 是信息的最小单位，表示一个二进制位（0 或 1）。</p>
</blockquote>
<p>硬件能比较精确地区分两种状态，例如低电平/高电平，断电/通电等，这些状态被抽象为了0或1的二进制位，<strong>所有数据</strong>最终都是以<strong>bit序列</strong>存储在计算机中的。（为什么是二进制位，不是三进制或者十进制？因为更多状态实现起来非常困难且不精确）</p>
<p>人们日常生活中，比较常用的是十进制数字，比如12个月，十进制数字12转换为二进制数字就是1100。</p>
<h2 data-id="heading-1">byte（字节）</h2>
<p>1byte=8bits</p>
<p>十进制12等于二进制1100，看起来只需要4bits就能存储12这个数了，但实际至少需要8bits来存储，因为在计算机中CPU 和内存系统能直接访问的最小数据单元是1byte，这和历史原因、硬件实现等有关，地址总线按字节寻址，数据总线的位数通常也为8的倍数。以读数据为例，CPU从内存“找”数据，内存给CPU“吐”数据的时候，地址和数据的最小单位就到字节，不能更小了。</p>
<p>顺便记录一下一些常见单位的换算方式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1</mn><mi>K</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>10</mn></msup><mi>B</mi><mspace linebreak="newline"/><mn>1</mn><mi>M</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>K</mi><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>20</mn></msup><mi>B</mi><mspace linebreak="newline"/><mn>1</mn><mi>G</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>M</mi><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>30</mn></msup><mi>B</mi><mspace linebreak="newline"/><mn>1</mn><mi>T</mi><mi>B</mi><mo>=</mo><mn>1024</mn><mi>G</mi><mi>B</mi><mo>=</mo><msup><mn>2</mn><mn>40</mn></msup><mi>B</mi><mspace linebreak="newline"/></mrow><annotation encoding="application/x-tex">1 KB = 1024 B  = 2^{10} B \\
1 MB  = 1024 KB = 2^{20} B \\
1 GB  = 1024 MB = 2^{30} B \\
1 TB  = 1024 GB = 2^{40} B \\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">20</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.05017em;">MB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.05017em;">TB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1024</span><span class="mord mathnormal" style="margin-right:0.05017em;">GB</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">40</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace newline"/></span></span></span></div>
<h2 data-id="heading-2">Go中的数字类型</h2>
<p>Go中的数字类型有整数、浮点数、复数。</p>
<ul>
<li>整数
<ul>
<li>有符号整数：int8 、int16 、int32、int64 、int</li>
<li>无符号整数：uint8(byte) 、uint16 、uint32 、uint64 、uint 、uintptr</li>
</ul>
</li>
<li>浮点数：float32、float64</li>
<li>复数：complex64、complex128</li>
</ul>
<p>rune类型是int32类型的别名，其实就是数字类型，但语义上是Unicode码点，指的是单个字符的类型。</p>
<p>Go语言中的byte类型就是uint8，是一种数据类型，和上面说过的那个byte（更多是存储单位）有所不同。例：</p>
<p>变量a的类型是byte（数据类型）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> a <span class="hljs-type">byte</span> = <span class="hljs-number">1</span>
</code></pre>
<p>“数字.md”这个文件的大小是15394byte（存储单位）：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">stat</span> -f%z 数字.md</span>

15394
</code></pre>
<h3 data-id="heading-3">整数</h3>
<p>以unit8和int8为例，无符号8位整数unit8的二进制表示是这样的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b54d9203290d4ce296ca10d91d843338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=xlrkS976E33k55VSxY1ZNgxnppI%3D" alt="image.png" loading="lazy"/></p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>数值</mtext><mo>=</mo><msub><mi>b</mi><mn>7</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><msub><mi>b</mi><mn>6</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>6</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><msub><mi>b</mi><mn>0</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">数值=b_7·2^7 + b_6·2^6 + ... + b_1·2^1 + b_0·2^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">数值</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>数值范围是 0 ~ 255，当所有位都为0时是最小值0，所有位都为1时，是最大值255：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>7</mn></mrow><mn>0</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup><mo>=</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>6</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mspace linebreak="newline"/><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><mn>2</mn><mo separator="true">⋅</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>8</mn></mrow><mn>1</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup><mo>=</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>8</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mspace linebreak="newline"/><msub><mi>S</mi><mn>2</mn></msub><mo>−</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msub><mi>S</mi><mn>1</mn></msub><mo>=</mo><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>256</mn><mo>−</mo><mn>1</mn><mo>=</mo><mn>255</mn></mrow><annotation encoding="application/x-tex">S_1 =\sum_{i=7}^{0} b_i \cdot 2^i = 1·2^7 + 1·2^6 + ... + 1·2^1 + 1·2^0 \\
S_2 = 2 · S_1  =\sum_{i=8}^{1} b_i \cdot 2^i = 1·2^8 + 1·2^7 + ... + 1·2^2 + 1·2^1 \\
S_2 - S_1 = S_1 = 2^8 - 1 = 256 - 1 = 255
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">7</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord">2</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">8</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">256</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">255</span></span></span></span></span></div>
<p><strong>有符号整数</strong>在计算机中通常是以<strong>补码</strong>的形式存储的，有符号整数有原码、反码、补码的概念，使用补码表示有符号整数，是为了用二进制表示负数，并且尽可能让运算简单。感兴趣的读者朋友可以详细了解下为什么，现在只需要记住补码的计算公式即可，有符号整数使用这个公式计算：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><msub><mi>b</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⋅</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">−b_{n-1}⋅2^{n-1}+\sum_{i=0}^{n-2}b_i⋅2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"/><span class="mord">−</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>有符号8位整数int8的二进制表示是这样的：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba171fbed1324205b9cd2aed82ee29eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=%2BQ6R5aLSAlaAAk4gWQC8AEt3Koo%3D" alt="image 1.png" loading="lazy"/></p>
<p>符号位s就是第7位，<strong>符号位为1表示负数，为0表示正数</strong>。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>数值</mtext><mo>=</mo><mo>−</mo><msub><mi>b</mi><mn>7</mn></msub><mo>⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mn>6</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">数值 = −b_7⋅2^7+\sum_{i=0}^6b_i⋅2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">数值</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord">−</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>符号位为1，剩余位全为0时，是最小值-128：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><mn>0</mn><mo>=</mo><mo>−</mo><mn>128</mn></mrow><annotation encoding="application/x-tex">-1·2^7 + 0 = -128</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">128</span></span></span></span></span></div>
<p>符号位为0，剩余位全为1时，是最大值：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><mn>0</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>7</mn></msup><mo>+</mo><msup><mn>2</mn><mn>7</mn></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">-0·2^7 + 2^7 - 1 = 127</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">0</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">127</span></span></span></span></span></div>
<p>其他类型整数的计算方式uint8和int8是一样的，只是表示的数值范围根据二进制位数的不同而不同。
无符号n位整数的范围：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0</mn><mo>∼</mo><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \sim 2^n - 1
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7977em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></div>
<p>有符号n位整数的范围：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>∼</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">-2^{n-1} \sim 2^{n-1}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></div>
<p>整数中int、uint、unitptr类型根据不同平台的架构变化，通常在32位架构上是32位，在64位架构上是64位。</p>
<p>以下是已经计算好的一些整数类型的范围，方便使用时能对各类型的数值范围有大概的印象：</p>


















































<table><thead><tr><th>类型</th><th>范围</th><th>中文描述（大约值）</th></tr></thead><tbody><tr><td>int8</td><td>-128 ~ 127</td><td/></tr><tr><td>uint8</td><td>0 ~ 255</td><td/></tr><tr><td>int16</td><td>-32768 ~ 32767</td><td>-3万2千～ 3万2千</td></tr><tr><td>uint16</td><td>0 ~ 65535</td><td>0 ~ 6万5千</td></tr><tr><td>int32</td><td>-2147483648 ~ 2147483647</td><td>-21亿4748万 ～ 21亿4748万</td></tr><tr><td>uint32</td><td>0 ~ 4294967295</td><td>0 ～ 42亿9496万</td></tr><tr><td>int64</td><td>-9223372036854775808 ~ 9223372036854775807</td><td>-9223372万亿 ～9223372万亿</td></tr><tr><td>uint64</td><td>0 ~ 18446744073709551615</td><td>0 ~ 18446744 万亿</td></tr></tbody></table>
<p>比较常用的就是int32和int64类型。自增id，时间戳之类的可能会较大的值用int64， 一般数值范围比如一个视频的秒级时长就用int32。
PS：视频时长这种数字，已经明确了是正数了，不选择用uint32是为了和不同语言更好地兼容以及方便后续代码的扩展。</p>
<h4 data-id="heading-4">整数溢出表现</h4>
<p>接下来说一下在Go语言中，整数在运行期间溢出的表现，假设用一个int32或uint32变量来存放一个30分钟视频秒级别的总播放时长，在海量用户观看视频的过程中就一直在累加这个值。（只是为了举例，实际一般都会用有符号整数类型）</p>
<p>先看用int32的情况，已经累计到了最大值 2147483647，再加1的时候，得到的结果是什么：</p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-number">01111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>
+                                   <span class="hljs-number">1</span>

= <span class="hljs-number">10000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span>
</code></pre>
<p>最大值+1会变成了int32负数的最小值：-2147483648。</p>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">var</span> maxInt32 <span class="hljs-type">int32</span> = math.MaxInt32

	fmt.Println(maxInt32 + <span class="hljs-number">1</span>) <span class="hljs-comment">// -2147483648</span>
</code></pre>
<p>如果是批量统计了再汇总，两个2147483647相加，得到的结果是什么：</p>
<pre><code class="hljs language-jsx" lang="jsx">    <span class="hljs-number">01111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>
+   <span class="hljs-number">01111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>

  <span class="hljs-number">1</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111110</span>
  ↑ 超过<span class="hljs-number">32</span>位的高位会被舍弃
=   <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111110</span>
</code></pre>
<p>会得到-2。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>数值</mtext><mo>=</mo><mo>−</mo><mn>1</mn><mo>⋅</mo><msup><mn>2</mn><mn>31</mn></msup><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>30</mn></mrow><mn>0</mn></munderover><msub><mi>b</mi><mi>i</mi></msub><mo>⋅</mo><msup><mn>2</mn><mi>i</mi></msup><mspace linebreak="newline"/><mo>=</mo><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>30</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>29</mn></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>2</mn></msup><mo>+</mo><mn>1</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><mn>0</mn><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mspace linebreak="newline"/><mo>=</mo><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup><mo>+</mo><mo stretchy="false">(</mo><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mn>0</mn><mspace linebreak="newline"/><mo>=</mo><mo>−</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">数值 = −1⋅2^{31}+\sum_{i=30}^0b_i⋅2^i\\
= -2^{31} + 1·2^{30} + 1·2^{29} + ...  + 1·2^{2} + 1·2^{1} + 0·2^{0}\\
= -2^{31} + (2^{31} - 2) + 0 \\
= -2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">数值</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:3.0788em;vertical-align:-1.2777em;"/><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">30</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"/><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8747em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8747em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">30</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">29</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord">0</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">−</span><span class="mord">2</span></span></span></span></span></div>
<p>如果用uint32， 已经到了最大值4294967295，再加1的结果是什么：</p>
<pre><code class="hljs language-jsx" lang="jsx">    <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span> <span class="hljs-number">11111111</span>
+                                     <span class="hljs-number">1</span>

  <span class="hljs-number">1</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span>
  ↑ 超过<span class="hljs-number">32</span>位的高位会被舍弃
=   <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span> <span class="hljs-number">00000000</span>
</code></pre>
<p>最大值+1会变成uint32类型的最小值0。</p>
<p>int32和uint32整数溢出时，都只会保留低32位。</p>
<p>假使这个视频总播放时长统计功能，使用了int32类型的整数来累加时长，那么溢出之后就会变成负数，计算完之后存到数据库中，统计界面查询的时候就可能看到总的播放时长是一个负数，于是产生了bug。（如果已经产生了bug并出现了脏数据，只能尝试从日志或其他数据中寻找方法，对脏数据进行修复）</p>
<p>怎么避免这种情况呢？</p>
<p>1）在计算前先做范围检查，判断两者相加不会大于最大值，也不会小于最小值。</p>
<pre><code class="hljs language-jsx" lang="jsx">func <span class="hljs-title function_">addInt32</span>(a, b int32) (int32, bool) {
    <span class="hljs-keyword">if</span> (b &gt; <span class="hljs-number">0</span> &amp;&amp; a &gt; math.<span class="hljs-property">MaxInt32</span>-b) || (b &lt; <span class="hljs-number">0</span> &amp;&amp; a &lt; math.<span class="hljs-property">MinInt32</span>-b) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-literal">false</span> <span class="hljs-comment">// 溢出的情况返回false，由外层进行告警或快照之类的处理</span>
    }
    <span class="hljs-keyword">return</span> a + b, <span class="hljs-literal">true</span>
}
</code></pre>
<p>2）换成数字范围更大的int64类型存储。</p>
<p>3）如果int64的范围都不够用，考虑使用big.Int类型：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"math/big"</span>
	<span class="hljs-string">"fmt"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AddBigInt</span><span class="hljs-params">()</span></span> {
	a, _ := <span class="hljs-built_in">new</span>(big.Int).SetString(<span class="hljs-string">"9223372036854775807"</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// int64的最大值</span>
	b, _ := <span class="hljs-built_in">new</span>(big.Int).SetString(<span class="hljs-string">"9223372036854775807"</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// int64的最大值</span>

	sum := <span class="hljs-built_in">new</span>(big.Int).Add(a, b)
	fmt.Println(sum) <span class="hljs-comment">// 18446744073709551614</span>
}
</code></pre>
<p>int32和uint32的类型截断也是只保留低32位：</p>
<pre><code class="hljs language-go" lang="go">	<span class="hljs-keyword">var</span> a <span class="hljs-type">uint64</span> = <span class="hljs-number">429496729500</span>
	<span class="hljs-keyword">var</span> b <span class="hljs-type">uint32</span> = <span class="hljs-type">uint32</span>(a)
	fmt.Println(b) <span class="hljs-comment">// 只保留低32位 4294967196 </span>
</code></pre>
<p>整数计算是不会有精度丢失的，因为计算机能精确表示整数。（一些疑似精度丢失（实则并不是）的情况，是由于溢出、类型截断之类的导致的）</p>
<p>浮点数能表示的数字范围比整数大得多，那么int64的数字范围不够用的时候，能考虑换成float64类型吗？下文浮点数的部分会给出答案。</p>
<h3 data-id="heading-5">浮点数</h3>
<p>浮点数的一般科学计数法是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mo>=</mo><mi>M</mi><mo separator="true">⋅</mo><msup><mi>R</mi><mi>E</mi></msup></mrow><annotation encoding="application/x-tex">N = M · R^E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8913em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>其中N为任何一个浮点数，M为尾数，E为阶码，R为阶码的基数。</p>
<p>十进制浮点数的表示形式大家应该都比较熟悉，123456.789 这个十进制浮点数，用科学计数法表示就是(d是十进制的意思)：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>123456.789</mn><mo>=</mo><mn>1.2345678</mn><msub><mn>9</mn><mi>d</mi></msub><mo separator="true">⋅</mo><mn>1</mn><msup><mn>0</mn><mn>5</mn></msup></mrow><annotation encoding="application/x-tex">123456.789 = 1.23456789_d · 10 ^{5}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">123456.789</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord">1.2345678</span><span class="mord"><span class="mord">9</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>如果阶码E发生变化，小数点的位置也是会发生变化，这就是浮点数中的浮点的意思，小数点是“左右浮动”的。看上面这个数字，如果阶码E从 5 变为 6， 小数点向右移动一位变成1234567.89；阶码E从 5 变为 2，小数点向左移动3位变成123.456789。</p>
<p>二进制的科学计数法表示也是类似的，比如10111.110101这个二进制浮点数，用科学计数法表示就是(b是二进制的意思)：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>10111.110101</mn><mo>=</mo><mn>1.011111010</mn><msub><mn>1</mn><mi>b</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">10111.110101 = 1.0111110101_{b} · 2^{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">10111.110101</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0141em;vertical-align:-0.15em;"/><span class="mord">1.011111010</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Go语言中的float32和float64基本遵循IEEE-754标准，IEEE-754的浮点数计算公式为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>×</mo><mo stretchy="false">(</mo><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">)</mo><mo>×</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Value = (−1)^S×(1.Fraction)×2^{(Exp−bias)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.938em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<ul>
<li>
<p>基数R为2。</p>
</li>
<li>
<p>尾数M：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>×</mo><mtext>（</mtext><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext>）</mtext></mrow><annotation encoding="application/x-tex">M = (-1)^{S}×（1.Fraction）</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">（</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">）</span></span></span></span></span></div>
<ul>
<li>S是符号位：0表示正数，1表示负数。</li>
<li>Fraction是尾数。（虽然Fraction和M都被称为尾数，但它们表示的概念是不同的，Fraction只是M的一部分）</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">1.Fraction</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span></span> 表示最高位的1是隐含的。</li>
</ul>
</li>
<li>
<p>阶码E：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mo>=</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">E = Exp - bias</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">bia</span><span class="mord mathnormal">s</span></span></span></span></span></div>
<ul>
<li>Exp是指数，存的是带偏置的指数。</li>
<li>bias是偏置常数，值为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{k-1} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9324em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>，其中k是Exp的位数。
<ul>
<li>单精度浮点数(32-bit)的偏置常数是：127。<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mn>8</mn><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">2^{8-1} - 1= 127</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">127</span></span></span></span></span></li>
<li>双精度浮点数(64-bit)的偏置常数是:  1023。<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mn>11</mn><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn><mo>=</mo><mn>1023</mn></mrow><annotation encoding="application/x-tex">2^{11-1} - 1 = 1023</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1023</span></span></span></span></span></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0639d0d09c44490b90c4aeb59bfc8c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=3RcP3V6OUjDVLG%2FMBTJltgrmO0g%3D" alt="image 2.png" loading="lazy"/></p>
<p>IEEE标准中浮点数有这几类：正规数（normal）、次正规数（subnormal）、±0、 正负无穷大和NaN。</p>
<p>1）正规数 （normal）</p>
<ul>
<li>Exp即不是全为0，也不是全为1</li>
<li>有隐含1：有效数是1.Fraction</li>
<li>p：Fraction的bit位数（float32=23，float64=52）</li>
<li>frac：Fraction 这段比特当作无符号整数的值</li>
</ul>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mn>1.</mn><msub><mi>f</mi><mn>1</mn></msub><msub><mi>f</mi><mn>2</mn></msub><msub><mi>f</mi><mn>3</mn></msub><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msub><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><msub><mi>f</mi><mi>p</mi></msub><mspace linebreak="newline"/><mo>=</mo><mn>1</mn><mo>+</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msub><mi>f</mi><mi>p</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mi>p</mi></mrow></msup></mrow><annotation encoding="application/x-tex">1.Fraction
= 1.f_1f_2f_3...f_{p-2}f_{p-1}f_{p}\\
= 1 + f_1 · 2^{-1}+ f_2 · 2^{-2} + ... + f_{p-1} · 2^{-(p-1)} + f_{p} · 2^{-p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"/><span class="mord">1.</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">...</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2241em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1074em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>Fraction部分当作整数时的值frac为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mo>=</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mi>p</mi><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>1</mn></msup><mo>+</mo><msub><mi>f</mi><mi>p</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mn>0</mn></msup><mspace linebreak="newline"/><mfrac><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi></mrow><msup><mn>2</mn><mi>p</mi></msup></mfrac><mo>=</mo><msub><mi>f</mi><mn>1</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msub><mi>f</mi><mn>2</mn></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mn>2</mn></mrow></msup><mo>+</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>+</mo><msub><mi>f</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mo stretchy="false">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msub><mi>f</mi><mi>p</mi></msub><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo>−</mo><mi>p</mi></mrow></msup></mrow><annotation encoding="application/x-tex">frac = f_1 · 2^{p-1} + f_2 · 2^{p-2} + ... + f_{p-1} · 2^{1} + f_p · 2^0 \\
\frac{frac}{2^p} = f_1· 2^{-1} + f_2· 2^{-2} + ... + f_{p-1}· 2^{-(p-1)} + f_p· 2^{-p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1502em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1502em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.2241em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.1074em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8213em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>所以得到数值计算公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo separator="true">⋅</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi></mrow><msup><mn>2</mn><mi>p</mi></msup></mfrac><mo stretchy="false">)</mo><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Value = (-1)^S · (1 + \frac{frac}{2^p}) · 2^{(Exp - bias)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose">)</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>2）次正规数 (subnormal)</p>
<ul>
<li>Exp全为0，并且Fraction ≠ 0</li>
<li>没有隐含的1：有效数是0.Fraction</li>
<li>p：Fraction的bit位数（float32=23，float64=52）</li>
<li>frac：Fraction 这段比特当作无符号整数的值</li>
</ul>
<p>数值计算公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo separator="true">⋅</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi></mrow><msup><mn>2</mn><mi>p</mi></msup></mfrac><mo stretchy="false">)</mo><mo separator="true">⋅</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">Value = (-1)^S · (\frac{frac}{2^p}) · 2^{(1 - bias)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose">)</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></div>
<p>3）零（±0）</p>
<ul>
<li>Exp全为0，并且Fraction = 0</li>
<li>+0还是 -0根据S决定</li>
</ul>
<p>4）特殊值：正负无穷大和NaN</p>
<ul>
<li>Exp全为1
<ul>
<li>Fraction = 0， 为正负无穷大</li>
<li>Fraction ≠ 0，是NaN</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6"><strong>float32 （单精度，32位浮点数）</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52175cea39f2492a803f015a4a2e8396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=%2FPG3Ts2j%2BLrEcYl0f6%2Fxm%2FIOZgc%3D" alt="image 3.png" loading="lazy"/>
1）正规数</p>
<ul>
<li>Exp即不是全为0，也不是全为1</li>
<li>有隐含1：有效数是1.Fraction</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef6151557b7c48b89cf77d2fa53d56a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=b4JyJJDW3u4soovllh1mXE9R2RA%3D" alt="floa32正规数计算.drawio.svg" loading="lazy"/></p>
<p>2）次正规数</p>
<ul>
<li>Exp全为0，并且Fraction ≠ 0</li>
<li>没有隐含的1：有效数是0.Fraction</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/973159b9b53146bb8eab81d2b6f192f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=gYSv5z9UGIpurYVhze8JGTqaRQ4%3D" alt="float32次正规数的计算.drawio.svg" loading="lazy"/></p>
<p>3）零（±0）</p>
<ul>
<li>Exp全为0，并且Fraction = 0</li>
<li>+0还是 -0根据S决定</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdd03fa9a20d4f4da065cebc21f11c7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=oJJw9Oj03CtgGB3GNSuhVrDukXM%3D" alt="image 4.png" loading="lazy"/></p>
<p>4）特殊值：正负无穷大和NaN</p>
<ul>
<li>Exp全为1
<ul>
<li>Fraction = 0， 为正负无穷大</li>
<li>Fraction ≠ 0，是NaN</li>
</ul>
</li>
</ul>
<p>正负无穷大：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3838751e2654f529a0bbe8119394c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=IA5xWBi6WGWFbyT%2F4V8SyZnTj8M%3D" alt="image 5.png" loading="lazy"/></p>
<p>NaN：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70b3999d77c740f7b9df0ac241039277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=ockjTlUlFfg2YXuuQPa8xirsk0I%3D" alt="image 6.png" loading="lazy"/></p>
<h4 data-id="heading-7"><strong>float64 （双精度，64位浮点数）</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1066e5ed565d4293be31fc8445f6a3ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=iHhohqOVX9aM3cgZTCxkF74TGKk%3D" alt="image 7.png" loading="lazy"/></p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>S</mi></msup><mo>×</mo><mo stretchy="false">(</mo><mn>1.</mn><mi>F</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">)</mo><mo>×</mo><msup><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>E</mi><mi>x</mi><mi>p</mi><mo>−</mo><mi>b</mi><mi>i</mi><mi>a</mi><mi>s</mi><mo stretchy="false">)</mo></mrow></msup><mspace linebreak="newline"/></mrow><annotation encoding="application/x-tex">Value = (−1)^S×(1.Fraction)×2^{(Exp−bias)}\\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">Va</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">1.</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.938em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">p</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">bia</span><span class="mord mathnormal mtight">s</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"/></span></span></span></div>
<p>float64和float32的计算方式一样，只是Exp的位数、Fraction的位数，以及偏置常数与float32不同。</p>
<h4 data-id="heading-8">浮点数溢出表现</h4>
<p>按照IEEE标准规定，浮点数上溢时可能会变成±Inf，下溢时可能会变成次正规数或是0。</p>
<h4 data-id="heading-9">为什么浮点数会有精度丢失</h4>
<p>以小数点位全部为1的十进制小数和二进制小数举一个简单的例子：</p>
<p>只看小数的部分，十进制的小数部分是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mi>n</mi></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex"> \frac{1}{10^{n}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>比如十进制数0.111，就是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mn>1</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mn>2</mn></msup></mrow></mfrac><mo>+</mo><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{10^1} + \frac{1}{10^{2}} + \frac{1}{10^{3}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>而二进制的小数部分是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><msup><mn>2</mn><mi>n</mi></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>比如二进制小数0.111，就是：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><msup><mn>2</mn><mn>1</mn></msup></mfrac><mo>+</mo><mfrac><mn>1</mn><msup><mn>2</mn><mn>2</mn></msup></mfrac><mo>+</mo><mfrac><mn>1</mn><msup><mn>2</mn><mn>3</mn></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2^1} + \frac{1}{2^2} + \frac{1}{2^3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>十进制的小数转换为下面这个公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><mrow><mn>1</mn><msup><mn>0</mn><mi>n</mi></msup></mrow></mfrac><mspace linebreak="newline"/><mo>=</mo><mfrac><mn>1</mn><mrow><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">⋅</mo><mn>5</mn><msup><mo stretchy="false">)</mo><mi>n</mi></msup></mrow></mfrac><mspace linebreak="newline"/><mo>=</mo><mfrac><mn>1</mn><mrow><msup><mn>2</mn><mi>n</mi></msup><mo separator="true">⋅</mo><msup><mn>5</mn><mi>n</mi></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{10^n} \\
= \frac{1}{(2·5)^n} \\
= \frac{1}{2^n · 5^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.2574em;vertical-align:-0.936em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">5</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>能很直观地看出只有在十进制小数的分母中不包含质因数5的时候（仅包含质因数2时），才能被二进制准确表示。下面两个是能被二进制精确表示的十进制数字：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0.</mn><msub><mn>5</mn><mi>d</mi></msub><mo>=</mo><mfrac><mn>5</mn><mn>10</mn></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo>=</mo><mn>0.</mn><msub><mn>1</mn><mi>b</mi></msub><mspace linebreak="newline"/><mtext> </mtext><mspace linebreak="newline"/><mn>0.25</mn><mo>=</mo><mfrac><mn>25</mn><mn>100</mn></mfrac><mo>=</mo><mfrac><mn>1</mn><msup><mn>2</mn><mn>2</mn></msup></mfrac><mo>=</mo><mn>0.0</mn><msub><mn>1</mn><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">0.5_d = \frac{5}{10} = \frac{1}{2} = 0.1_b\\
~\\ 
0.25 = \frac{25}{100} = \frac{1}{2^2}  = 0.01_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"/><span class="mord">0.</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"/><span class="mord">0.</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0em;"/><span class="mspace nobreak"> </span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.25</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">100</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">25</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"/><span class="mord">0.0</span><span class="mord"><span class="mord">1</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>十进制转换为最简分数后，如果质因数包含5，这个数字就不能被有限二进制位表示了：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0.1</mn><mo>=</mo><mfrac><mn>1</mn><mn>10</mn></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><mo separator="true">⋅</mo><mn>5</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">0.1 = \frac{1}{10} = \frac{1}{2·5}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.1</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">10</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>能很直观看出十进制0.1没有这这种二进制位置：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mn>1</mn><msup><mn>2</mn><mi>n</mi></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{2^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></div>
<p>从数学的概念上，0.1是能表示为二进制无限循环小数的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/532e5973d1d647968648f70700b3870d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuN5rKr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543800&amp;x-signature=XfwKMPikK96gusyUUQgKRyr3g14%3D" alt="微信图片_20260131224253_26_3.jpg" loading="lazy"/></p>
<p>但计算机用于表示浮点数的位数不是无限的，而是有限位，所以只能通过把无限循环的小数位截断，以及进行舍入，用一个和十进制0.1近似的二进制数表示0.1，比如：</p>
<pre><code class="hljs language-jsx" lang="jsx">真实:  <span class="hljs-number">0.0001100110011001100110011001100110011</span>...
存储:  <span class="hljs-number">0.00011001100110011001100</span>            （截断/舍入）
</code></pre>
<p>这就是浮点数精度丢失的原因，在进行运算的时候，两个近似值相加，再进行截断/舍入，就会放大这种差异，比如经典的0.1 + 0.2 不等于 0.3。</p>
<p>用Go和JS打印了下0.1+0.2，终端看到的值不一样（JS是用Node执行的），</p>
<p>Go：</p>
<pre><code class="hljs language-jsx" lang="jsx">fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.20f\n"</span>, <span class="hljs-number">0.1</span>	+ <span class="hljs-number">0.2</span>) <span class="hljs-comment">// 0.29999999999999998890</span>
</code></pre>
<p>JS：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">0.1</span>+<span class="hljs-number">0.2</span>) <span class="hljs-comment">// 0.30000000000000004</span>
</code></pre>
<p>两边都是float64类型，遵循IEEE标准，所以底层存储应该是一样的，只是不同语言将这种存储转换为字符串的方式有所不同，一个取了较低的值（&lt;0.3），一个取了较高的值（&gt;0.3）。</p>
<p>为了解决浮点数的精度丢失问题，可以使用decimal包来做十进制的精确计算：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"github.com/shopspring/decimal"</span>
	<span class="hljs-string">"fmt"</span>
)

func <span class="hljs-title class_">AddNum</span>() {
	d1, _ := decimal.<span class="hljs-title class_">NewFromString</span>(<span class="hljs-string">"0.1"</span>)
	d2, _ := decimal.<span class="hljs-title class_">NewFromString</span>(<span class="hljs-string">"0.2"</span>)
	sum := d1.<span class="hljs-title class_">Add</span>(d2)

	fmt.<span class="hljs-title class_">Println</span>(sum.<span class="hljs-title class_">StringFixed</span>(<span class="hljs-number">20</span>)) <span class="hljs-comment">// 0.30000000000000000000</span>
}
</code></pre>
<p>二进制数无法通过有限的数位精确表示小数，所以会丢失精度，那么用来表示整数，是不是就是精确的了。比如int64整数溢出的时候，是否考虑用能表示的数字范围更广的float64类型。答案是不会，因为float64能精确表示的整数范围小于int64的范围，float64类型只能精确表示≤ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>53</mn></msup></mrow><annotation encoding="application/x-tex">2^{53}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">53</span></span></span></span></span></span></span></span></span></span></span></span></span> 的整数，超过这个范围的整数就不能精确表示了（这个和尾数Fraction的位数有关，float32只能精确表示≤ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>24</mn></msup></mrow><annotation encoding="application/x-tex">2^{24}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">24</span></span></span></span></span></span></span></span></span></span></span></span></span>的整数）。</p>
<p>二进制数无法通过有限的数位精确表示小数，所以会丢失精度，那么用来表示整数，是不是就是精确的了。比如int64整数溢出的时候，是否能考虑用数字范围更广的float64类型。答案是不能，因为float64能精确表示的整数范围小于int64的范围，float64类型只能精确表示≤ 2^53 的整数，超过这个范围的整数就不能精确表示了（这个和尾数Fraction的位数有关，float32只能精确表示≤ 2^24的整数）。</p>
<p>例如，float64是没有2^53 + 1这个整数的位置的：</p>
<pre><code class="hljs language-jsx" lang="jsx">	n := <span class="hljs-title function_">int64</span>(<span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">53</span> <span class="hljs-comment">// 2^53</span>

	fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.0f\n"</span>, <span class="hljs-title function_">float64</span>(n))   <span class="hljs-comment">// 9007199254740992</span>
	fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.0f\n"</span>, <span class="hljs-title function_">float64</span>(n+<span class="hljs-number">1</span>)) <span class="hljs-comment">// 9007199254740992（被舍入）</span>
	fmt.<span class="hljs-title class_">Printf</span>(<span class="hljs-string">"%.0f\n"</span>, <span class="hljs-title function_">float64</span>(n+<span class="hljs-number">2</span>)) <span class="hljs-comment">// 9007199254740994</span>
</code></pre>
<h2 data-id="heading-10">复数</h2>
<p>Go中的复数类型一般情况下不会用到，可以简单了解下是什么概念就可以了。</p>
<ul>
<li><strong>complex64</strong>：实部和虚部都是 float32，占 8 字节</li>
<li><strong>complex128</strong>：实部和虚部都是 float64，占 16 字节（默认是complex128类型）</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"math/cmplx"</span>
	<span class="hljs-string">"reflect"</span>
)

func <span class="hljs-title class_">ComplexNumber</span>() {
	a := <span class="hljs-number">3</span> + 4i
	b := <span class="hljs-number">1</span> - 2i

	fmt.<span class="hljs-title class_">Println</span>(<span class="hljs-string">"a + b ="</span>, a+b)          <span class="hljs-comment">// (4+2i)</span>
	fmt.<span class="hljs-title class_">Println</span>(<span class="hljs-string">"|a| ="</span>, cmplx.<span class="hljs-title class_">Abs</span>(a))   <span class="hljs-comment">// 5</span>
	fmt.<span class="hljs-title class_">Println</span>(reflect.<span class="hljs-title class_">TypeOf</span>(a))       <span class="hljs-comment">// complex128</span>
}
</code></pre>
<h2 data-id="heading-11">结尾</h2>
<p>数字涉及到的知识远不止于此，之后如果有数字相关的内容再单开文章写。</p>
<p>文中说过”所有数据最终都是以bit序列存储在计算机中的”，字符串也不例外。在这篇文章中已经大概了解到了数字是怎样以二进制方式存储的了，字符串中的字符其实也是转换成对应的数字之后，以二进制形式存储的，下一篇记录字符串相关的内容。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这回不仅是听个响：Mureka V8想让AI音乐直接上架Spotify]]></title>    <link>https://juejin.cn/post/7601159804491005971</link>    <guid>https://juejin.cn/post/7601159804491005971</guid>    <pubDate>2026-02-01T09:46:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601159804491005971" data-draft-id="7601103779393011775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这回不仅是听个响：Mureka V8想让AI音乐直接上架Spotify"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-01T09:46:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这回不仅是听个响：Mureka V8想让AI音乐直接上架Spotify
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:46:34.000Z" title="Sun Feb 01 2026 09:46:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年1月28日，北京Blue Note爵士俱乐部的灯光暗下，但这并不是一场传统的爵士演出。在这个充满了即兴与灵感的场域，昆仑万维旗下的昆仑天工把那层笼罩在AI音乐头上的“玩具”面纱狠狠扯了下来。</p>
<p>他们发布的Mureka V8音乐大模型，在这个寒冬里扔出了一句颇具火药味的宣言：AI音乐，要从“可生成”迈向“可发布”。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-01_17.35.39-1024x576.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-01_17.35.39-1024x576.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f0d8017f8614edbb70f9883989182fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=S%2FTjW4ixtMg10PFBSCgLaLakznc%3D" alt="iShot_2026-02-01_17.35.39" loading="lazy"/></a></p>
<p>作为长期关注AI生成领域的观察者，我必须承认，过去的AI音乐总有一种“恐怖谷”效应——乍一听像那么回事，但多听几秒，你就能感受到那种拼凑感、廉价的电子味，以及不知所云的段落结构。但Mureka V8这次似乎真的换了脑子。</p>
<h4 data-id="heading-0">它学会了像制作人一样思考</h4>
<p>这就要提到这次的核心技术突破——MusiCoT（Music Chain-of-Thought），即“音乐思维链”。</p>
<p>以前的AI生成音乐，更像是一个听过很多歌的鹦鹉，它在模仿声音的波形，却不懂音乐的逻辑。而基于MusiCoT的Mureka V8，更像是一个受过科班训练的作曲家。在生成音频之前，它会先在大脑里构思一张蓝图：这首歌的情绪起伏是怎样的？主歌到副歌怎么推进？哪里需要一个强有力的Bass Drop？</p>
<p>这种“先谋篇布局，后落笔填词”的逻辑，直接解决了AI音乐最大的痛点——结构松散。根据官方盲测数据，V8在中文歌曲的表现上已经把曾经的王者Suno V5甩在了身后。现在的它，不仅能写出抓耳的Hook（记忆点），还能搞定复杂的编曲层次。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-01_17.33.30-1024x376.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-01_17.33.30-1024x376.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95ce369a705d485c9b933249fd1ee286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=%2F6oNAws4PoS9RA%2FN16p76lxI1RA%3D" alt="iShot_2026-02-01_17.33.30" loading="lazy"/></a></p>
<h4 data-id="heading-1">不仅是生成，更是成品</h4>
<p>如果你听过现场的演示，你会发现“质感”是V8最大的护城河。</p>
<p>在人声表现上，它不再是冷冰冰的虚拟歌姬。V8模拟出的歌手具有极强的“主唱存在感”，你能听到换气时的微弱呼吸，感受到情绪的递进，甚至能精准匹配性别和唱法。</p>
<p>在编曲和混音层面，它试图达到工业级的标准。声场不再是一团浆糊，而是有了空间感和立体感。昆仑万维董事长周亚辉甚至直言，相比两年前的V1版本，V8的能力实现了百倍的跃升。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-01_17.33.37-1024x690.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-01_17.33.37-1024x690.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed245382c144922b5a9b6b5558a4c59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=rHc75KpkXBFw3mpq4cqAbBd%2BFWY%3D" alt="iShot_2026-02-01_17.33.37" loading="lazy"/></a></p>
<h4 data-id="heading-2">不仅是工具，更是一场关于“品类”的辩论</h4>
<p>发布会现场最精彩的并不是技术参数的罗列，而是观点的碰撞。</p>
<p>一边是技术派的周亚辉，他认为AI集成了所有乐器，能让普通人低成本创作，这必将诞生一个新的“音乐品类”。另一边是音乐界的“老炮儿”高晓松，他虽然对AI持审慎态度，认为AI创造的是新的UGC产品而非传统版权音乐，但也承认AI带来的海量内容需要新的形态来承载。</p>
<p>更有趣的是资深制作人闻震的观点，他给出了一个非常务实的解法：AI负责把那80%的基础工作做到极致，而音乐人要做的，是那决定性的20%——审美、认知，以及如何用提示词去驾驭这个庞然大物。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fsdagsgdf-1024x591.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/sdagsgdf-1024x591.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e5f954745624351a9b207845c13136c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543993&amp;x-signature=KbejyxrXmWBpiOh%2F%2FYIL5H2W2oQ%3D" alt="sdagsgdf" loading="lazy"/></a></p>
<h4 data-id="heading-3">剑指海外，意在成为“AI版Spotify”</h4>
<p>昆仑天工的野心显然不止于做一个生成器。</p>
<p>看看它的商业版图：C端会员月费88元，并不便宜，但这背后是一整套生态。它想做的是海外市场的“AI版Spotify”，目标直指3-5亿月活。在国内，它选择与太合音乐这样的巨头联手，把AI塞进主流音乐的制作发行流程里。</p>
<p>这就意味着，未来你在流媒体平台上听到的某首爆款热歌，很可能就是由Mureka V8打底，再由人类制作人润色而成的。</p>
<h4 data-id="heading-4">写在最后</h4>
<p>Mureka V8的出现，标志着AI音乐正式告别了“听个响”的猎奇阶段。</p>
<p>它给了普通创作者一把打开音乐大门的钥匙，只要你会说话，你就能通过自然语言、甚至哼唱一段旋律，让AI帮你完成一首像模像样的作品。当然，正如高晓松所虑，当音乐生产的门槛被夷为平地，我们将面临的是创意的爆发还是垃圾内容的泛滥？这还需要时间来验证。</p>
<p>但至少现在，对于那些满脑子旋律却不懂乐理的人来说，最好的时代可能真的来了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第9篇）：NexaSDK - 跨平台设备端 AI 运行时，让前沿模型在本地运行]]></title>    <link>https://juejin.cn/post/7601076694105423908</link>    <guid>https://juejin.cn/post/7601076694105423908</guid>    <pubDate>2026-02-01T09:51:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105423908" data-draft-id="7601076694105407524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第9篇）：NexaSDK - 跨平台设备端 AI 运行时，让前沿模型在本地运行"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2026-02-01T09:51:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第9篇）：NexaSDK - 跨平台设备端 AI 运行时，让前沿模型在本地运行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:51:02.000Z" title="Sun Feb 01 2026 09:51:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果最新的 AI 模型能在你的手机上、IoT 设备上、甚至边缘设备上运行，而不需要依赖云端，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第9篇文章。今天带你了解的项目是 <strong>NexaSDK</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNexaAI%2Fnexa-sdk" target="_blank" title="https://github.com/NexaAI/nexa-sdk" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>想象一下，你可以在 Android 手机上运行 Qwen3-VL 多模态模型，在 iOS 设备上使用 Apple Neural Engine 进行语音识别，在 Linux IoT 设备上运行 Granite-4 模型，所有这一切都不需要连接到云端。这就是 NexaSDK 带来的革命性体验——让前沿 AI 模型真正"落地"到各种设备上。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🚀 <strong>NPU 优先</strong>：业界首个 NPU-first 的设备端 AI 运行时</li>
<li>📱 <strong>全平台支持</strong>：PC、Android、iOS、Linux/IoT 全覆盖</li>
<li>🎯 <strong>Day-0 模型支持</strong>：支持最新发布的模型（GGUF、MLX、NEXA 格式）</li>
<li>🔌 <strong>多模态能力</strong>：LLM、VLM、ASR、OCR、Rerank、图像生成等</li>
<li>🌟 <strong>社区认可</strong>：7.6k+ Stars，与 Qualcomm 合作举办设备端 AI 竞赛</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>NexaSDK 的核心概念和架构设计</li>
<li>如何在各种平台上运行设备端 AI 模型</li>
<li>NPU、GPU、CPU 三种计算后端的支持和使用</li>
<li>多模态 AI 能力的集成和使用</li>
<li>与其他设备端 AI 框架的对比分析</li>
<li>如何开始使用 NexaSDK 构建设备端 AI 应用</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对 LLM 和 AI 模型有基本了解</li>
<li>熟悉至少一种编程语言（Python、Go、Kotlin、Swift）</li>
<li>了解设备端 AI 的基本概念（可选）</li>
<li>对 NPU、GPU 等硬件加速有基本了解（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>NexaSDK</strong> 是一个<strong>跨平台的设备端 AI 运行时</strong>，支持在 GPU、NPU 和 CPU 上运行前沿的 LLM 和 VLM 模型。它提供了全面的运行时覆盖，支持 PC（Python/C++）、移动端（Android &amp; iOS）和 Linux/IoT（Arm64 &amp; x86 Docker）平台。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>设备端 AI 运行时碎片化，不同平台需要不同的解决方案</li>
<li>缺乏对 NPU 的原生支持，无法充分利用硬件加速</li>
<li>新模型发布后，设备端支持滞后（缺乏 day-0 支持）</li>
<li>多模态 AI 能力在设备端难以集成</li>
<li>跨平台开发成本高，需要为每个平台单独实现</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>需要构建设备端 AI 应用的开发者</li>
<li>希望利用 NPU 加速的移动应用开发者</li>
<li>需要在 IoT 设备上运行 AI 模型的开发者</li>
<li>对设备端 AI 感兴趣的研究人员</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>团队：NexaAI</strong></p>
<ul>
<li><strong>背景</strong>：专注于设备端 AI 解决方案的团队</li>
<li><strong>合作伙伴</strong>：与 Qualcomm 合作，举办设备端 AI 竞赛</li>
<li><strong>贡献者</strong>：45 位贡献者，包括 @RemiliaForever、@zhiyuan8、@mengshengwu 等</li>
<li><strong>理念</strong>：让前沿 AI 模型能够在各种设备上高效运行</li>
</ul>
<p><strong>项目创建时间</strong>：2024年（从 GitHub 提交历史可以看出项目持续活跃）</p>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 7.6k+（持续快速增长）</li>
<li>🍴 <strong>Forks</strong>: 944+</li>
<li>📦 <strong>版本</strong>: v0.2.71（最新版本，2026年1月22日发布）</li>
<li>📄 <strong>License</strong>: Apache-2.0（CPU/GPU 组件），NPU 组件需要许可证</li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">docs.nexa.ai</a></li>
<li>📚 <strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">完整文档</a></li>
<li>💬 <strong>社区</strong>: Discord、Slack 社区活跃</li>
<li>🏆 <strong>竞赛</strong>: Nexa × Qualcomm 设备端 AI 竞赛（$6,500 奖金）</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2024年：项目启动，初步版本发布</li>
<li>2024-2025年：快速发展，添加多平台支持</li>
<li>2025年：NPU 支持完善，与 Qualcomm 合作</li>
<li>2026年：持续迭代，添加更多模型和功能支持</li>
</ul>
<p><strong>支持的模型</strong>：</p>
<ul>
<li>OpenAI GPT-OSS</li>
<li>IBM Granite-4</li>
<li>Qwen-3-VL</li>
<li>Gemma-3n</li>
<li>Ministral-3</li>
<li>以及更多前沿模型</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>NexaSDK 的核心作用是<strong>提供统一的跨平台设备端 AI 运行时</strong>，让开发者能够：</p>
<ol>
<li><strong>在多种设备上运行 AI 模型</strong>：PC、手机、IoT 设备全覆盖</li>
<li><strong>充分利用硬件加速</strong>：NPU、GPU、CPU 三种后端自动选择</li>
<li><strong>快速集成新模型</strong>：Day-0 支持，新模型发布即可使用</li>
<li><strong>多模态 AI 能力</strong>：文本、图像、音频、视频等全方位支持</li>
<li><strong>简化开发流程</strong>：统一的 API，一套代码多平台运行</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<ol>
<li>
<p><strong>移动端 AI 应用</strong></p>
<ul>
<li>手机上的智能助手</li>
<li>离线语音识别和翻译</li>
<li>图像识别和处理</li>
<li>本地 LLM 对话应用</li>
</ul>
</li>
<li>
<p><strong>IoT 和边缘计算</strong></p>
<ul>
<li>智能家居设备的 AI 能力</li>
<li>工业 IoT 的智能分析</li>
<li>边缘服务器的 AI 推理</li>
<li>自动驾驶设备的感知能力</li>
</ul>
</li>
<li>
<p><strong>桌面应用集成</strong></p>
<ul>
<li>本地 AI 助手</li>
<li>文档智能处理</li>
<li>代码生成工具</li>
<li>创意内容生成</li>
</ul>
</li>
<li>
<p><strong>企业级应用</strong></p>
<ul>
<li>数据隐私保护（本地处理）</li>
<li>离线 AI 能力</li>
<li>降低云端成本</li>
<li>实时响应需求</li>
</ul>
</li>
<li>
<p><strong>研究和开发</strong></p>
<ul>
<li>模型性能测试</li>
<li>硬件加速研究</li>
<li>新模型验证</li>
<li>算法优化实验</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">CLI 方式（最简单）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Nexa CLI</span>
<span class="hljs-comment"># Windows (x64 with Intel/AMD NPU)</span>
<span class="hljs-comment"># 下载: nexa-cli_windows_x86_64.exe</span>

<span class="hljs-comment"># macOS (x64)</span>
<span class="hljs-comment"># 下载: nexa-cli_macos_x86_64.pkg</span>

<span class="hljs-comment"># Linux (ARM64)</span>
curl -L https://github.com/NexaAI/nexa-sdk/releases/latest/download/nexa-cli_linux_arm64.sh | bash

<span class="hljs-comment"># 运行第一个模型</span>
nexa infer ggml-org/Qwen3-1.7B-GGUF

<span class="hljs-comment"># 多模态：拖拽图片到 CLI</span>
nexa infer NexaAI/Qwen3-VL-4B-Instruct-GGUF

<span class="hljs-comment"># NPU 支持（Windows arm64 with Snapdragon X Elite）</span>
nexa infer NexaAI/OmniNeural-4B
</code></pre>
<h4 data-id="heading-12">Python SDK</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安装</span>
pip install nexaai

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">from</span> nexaai <span class="hljs-keyword">import</span> LLM, GenerationConfig, ModelConfig, LlmChatMessage

<span class="hljs-comment"># 创建 LLM 实例</span>
llm = LLM.from_(model=<span class="hljs-string">"NexaAI/Qwen3-0.6B-GGUF"</span>, config=ModelConfig())

<span class="hljs-comment"># 构建对话</span>
conversation = [
    LlmChatMessage(role=<span class="hljs-string">"user"</span>, content=<span class="hljs-string">"Hello, tell me a joke"</span>)
]
prompt = llm.apply_chat_template(conversation)

<span class="hljs-comment"># 流式生成</span>
<span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> llm.generate_stream(prompt, GenerationConfig(max_tokens=<span class="hljs-number">100</span>)):
    <span class="hljs-built_in">print</span>(token, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<h4 data-id="heading-13">Android SDK</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 添加到 build.gradle.kts</span>
dependencies {
    implementation(<span class="hljs-string">"ai.nexa:core:0.0.19"</span>)
}

<span class="hljs-comment">// 初始化 SDK</span>
NexaSdk.getInstance().<span class="hljs-keyword">init</span>(<span class="hljs-keyword">this</span>)

<span class="hljs-comment">// 加载和运行模型</span>
VlmWrapper.builder()
    .vlmCreateInput(VlmCreateInput(
        model_name = <span class="hljs-string">"omni-neural"</span>,
        model_path = <span class="hljs-string">"/data/data/your.app/files/models/OmniNeural-4B/files-1-1.nexa"</span>,
        plugin_id = <span class="hljs-string">"npu"</span>,
        config = ModelConfig()
    ))
    .build()
    .onSuccess { vlm -&gt;
        vlm.generateStreamFlow(<span class="hljs-string">"Hello!"</span>, GenerationConfig()).collect { print(it) }
    }
</code></pre>
<h4 data-id="heading-14">iOS SDK</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> NexaSdk

<span class="hljs-comment">// 示例：语音识别</span>
<span class="hljs-keyword">let</span> asr <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">Asr</span>(plugin: .ane)
<span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> asr.load(from: modelURL)

<span class="hljs-keyword">let</span> result <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> asr.transcribe(options: .<span class="hljs-keyword">init</span>(audioPath: <span class="hljs-string">"audio.wav"</span>))
<span class="hljs-built_in">print</span>(result.asrResult.transcript)
</code></pre>
<h4 data-id="heading-15">Linux Docker</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取镜像</span>
docker pull nexa4ai/nexasdk:latest

<span class="hljs-comment"># 运行（需要 NPU token）</span>
<span class="hljs-built_in">export</span> NEXA_TOKEN=<span class="hljs-string">"your_token_here"</span>
docker run --<span class="hljs-built_in">rm</span> -it --privileged \
  -e NEXA_TOKEN \
  nexa4ai/nexasdk:latest infer NexaAI/Granite-4.0-h-350M-NPU
</code></pre>
<h3 data-id="heading-16">核心特性</h3>
<ol>
<li>
<p><strong>NPU 优先支持</strong></p>
<ul>
<li>业界首个 NPU-first 的设备端 AI 运行时</li>
<li>支持 Qualcomm Hexagon NPU</li>
<li>支持 Apple Neural Engine (ANE)</li>
<li>支持 Intel/AMD NPU</li>
<li>显著提升性能和能效比</li>
</ul>
</li>
<li>
<p><strong>全平台运行时</strong></p>
<ul>
<li><strong>PC</strong>: Python/C++ SDK</li>
<li><strong>Android</strong>: Kotlin SDK，支持 NPU/GPU/CPU</li>
<li><strong>iOS</strong>: Swift SDK，支持 ANE</li>
<li><strong>Linux/IoT</strong>: Docker 镜像，支持 Arm64 &amp; x86</li>
</ul>
</li>
<li>
<p><strong>Day-0 模型支持</strong></p>
<ul>
<li>支持最新发布的模型</li>
<li>支持多种模型格式：GGUF、MLX、NEXA</li>
<li>快速集成新模型到设备端</li>
</ul>
</li>
<li>
<p><strong>多模态 AI 能力</strong></p>
<ul>
<li><strong>LLM</strong>: 大语言模型</li>
<li><strong>VLM</strong>: 视觉语言模型（多模态）</li>
<li><strong>ASR</strong>: 自动语音识别</li>
<li><strong>OCR</strong>: 光学字符识别</li>
<li><strong>Rerank</strong>: 重排序</li>
<li><strong>Object Detection</strong>: 目标检测</li>
<li><strong>Image Generation</strong>: 图像生成</li>
<li><strong>Embedding</strong>: 向量嵌入</li>
</ul>
</li>
<li>
<p><strong>统一的 API 接口</strong></p>
<ul>
<li>OpenAI 兼容的 API</li>
<li>Function calling 支持</li>
<li>流式生成支持</li>
<li>统一的配置接口</li>
</ul>
</li>
<li>
<p><strong>模型格式支持</strong></p>
<ul>
<li><strong>GGUF</strong>: 广泛使用的量化格式</li>
<li><strong>MLX</strong>: Apple MLX 框架格式</li>
<li><strong>NEXA</strong>: NexaSDK 原生格式</li>
</ul>
</li>
<li>
<p><strong>硬件加速优化</strong></p>
<ul>
<li>自动选择最佳计算后端</li>
<li>NPU &gt; GPU &gt; CPU 的优先级</li>
<li>针对不同硬件的优化</li>
</ul>
</li>
<li>
<p><strong>开发者友好</strong></p>
<ul>
<li>一行代码运行模型</li>
<li>详细的文档和示例</li>
<li>活跃的社区支持</li>
<li>丰富的 Cookbook</li>
</ul>
</li>
</ol>
<h3 data-id="heading-17">项目优势</h3>
<p>与其他设备端 AI 框架相比，NexaSDK 的优势：</p>




































































<table><thead><tr><th align="left">对比项</th><th align="left">NexaSDK</th><th align="left">Ollama</th><th align="left">llama.cpp</th><th align="left">LM Studio</th></tr></thead><tbody><tr><td align="left"><strong>NPU 支持</strong></td><td align="left">⭐⭐⭐⭐⭐ NPU-first</td><td align="left">❌ 不支持</td><td align="left">❌ 不支持</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>Android/iOS SDK</strong></td><td align="left">⭐⭐⭐⭐⭐ 完整支持</td><td align="left">⚠️ 部分支持</td><td align="left">⚠️ 部分支持</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>Linux Docker</strong></td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">❌ 不支持</td></tr><tr><td align="left"><strong>Day-0 模型支持</strong></td><td align="left">⭐⭐⭐⭐⭐ GGUF/MLX/NEXA</td><td align="left">❌ 滞后</td><td align="left">⚠️ 部分支持</td><td align="left">❌ 滞后</td></tr><tr><td align="left"><strong>多模态支持</strong></td><td align="left">⭐⭐⭐⭐⭐ 完整支持</td><td align="left">⚠️ 部分支持</td><td align="left">⚠️ 部分支持</td><td align="left">⚠️ 部分支持</td></tr><tr><td align="left"><strong>跨平台支持</strong></td><td align="left">⭐⭐⭐⭐⭐ 全平台</td><td align="left">⚠️ 部分平台</td><td align="left">⚠️ 部分平台</td><td align="left">⚠️ 部分平台</td></tr><tr><td align="left"><strong>一行代码运行</strong></td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⚠️ 需要配置</td><td align="left">⭐⭐⭐⭐⭐ 支持</td></tr><tr><td align="left"><strong>OpenAI API 兼容</strong></td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td><td align="left">⭐⭐⭐⭐⭐ 支持</td></tr></tbody></table>
<p><strong>为什么选择 NexaSDK？</strong></p>
<ul>
<li>✅ <strong>NPU 优先</strong>：充分利用硬件加速，性能和能效比最优</li>
<li>✅ <strong>全平台支持</strong>：一套 SDK 覆盖所有平台，降低开发成本</li>
<li>✅ <strong>Day-0 支持</strong>：新模型发布即可使用，无需等待</li>
<li>✅ <strong>多模态能力</strong>：完整的 AI 能力栈，满足各种需求</li>
<li>✅ <strong>开发者友好</strong>：简单的 API，丰富的文档和示例</li>
</ul>
<hr/>
<h2 data-id="heading-18">项目详细剖析</h2>
<h3 data-id="heading-19">架构设计</h3>
<p>NexaSDK 采用<strong>分层式架构</strong>，核心是统一的运行时抽象层：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────┐
│   应用层 (Applications)              │
│   - CLI / Python / Android / iOS    │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   SDK 层 (SDK Layer)                 │
│   - 统一的 API 接口                   │
│   - 模型加载和管理                     │
│   - 配置和优化                         │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   运行时层 (Runtime Layer)           │
│   - 计算后端抽象                       │
│   - 模型格式解析                       │
│   - 推理引擎                           │
└──────────────┬──────────────────────┘
               │
    ┌──────────┴──────────┐
    │                     │
┌───▼────┐         ┌─────▼─────┐
│  NPU   │         │   GPU     │
│ Plugin │         │  Plugin   │
└────────┘         └───────────┘
    │                     │
┌───▼─────────────────────▼─────┐
│   CPU Plugin (Fallback)        │
└────────────────────────────────┘
</code></pre>
<h3 data-id="heading-20">核心模块详解</h3>
<h4 data-id="heading-21">1. 计算后端抽象层</h4>
<p><strong>功能</strong>：统一管理不同的计算后端（NPU、GPU、CPU）</p>
<p><strong>设计特点</strong>：</p>
<ul>
<li>插件化架构，易于扩展</li>
<li>自动选择最佳后端</li>
<li>优先级：NPU &gt; GPU &gt; CPU</li>
<li>支持后端切换和回退</li>
</ul>
<p><strong>支持的 NPU</strong>：</p>
<ul>
<li>Qualcomm Hexagon NPU（Snapdragon）</li>
<li>Apple Neural Engine（iOS/macOS）</li>
<li>Intel/AMD NPU（Windows）</li>
</ul>
<h4 data-id="heading-22">2. 模型格式支持</h4>
<p><strong>GGUF 格式</strong>：</p>
<ul>
<li>广泛使用的量化格式</li>
<li>支持多种量化级别</li>
<li>兼容 llama.cpp 生态</li>
</ul>
<p><strong>MLX 格式</strong>：</p>
<ul>
<li>Apple MLX 框架格式</li>
<li>针对 Apple Silicon 优化</li>
<li>支持 macOS 和 iOS</li>
</ul>
<p><strong>NEXA 格式</strong>：</p>
<ul>
<li>NexaSDK 原生格式</li>
<li>针对 NPU 优化</li>
<li>更好的性能和兼容性</li>
</ul>
<h4 data-id="heading-23">3. 多模态能力</h4>
<p><strong>LLM（大语言模型）</strong>：</p>
<ul>
<li>文本生成和对话</li>
<li>支持流式输出</li>
<li>支持 Function Calling</li>
</ul>
<p><strong>VLM（视觉语言模型）</strong>：</p>
<ul>
<li>图像理解和生成</li>
<li>多模态对话</li>
<li>视觉问答</li>
</ul>
<p><strong>ASR（自动语音识别）</strong>：</p>
<ul>
<li>语音转文字</li>
<li>支持多种音频格式</li>
<li>实时识别支持</li>
</ul>
<p><strong>OCR（光学字符识别）</strong>：</p>
<ul>
<li>图像中的文字识别</li>
<li>多语言支持</li>
<li>高精度识别</li>
</ul>
<p><strong>其他能力</strong>：</p>
<ul>
<li>Rerank：文本重排序</li>
<li>Object Detection：目标检测</li>
<li>Image Generation：图像生成</li>
<li>Embedding：向量嵌入</li>
</ul>
<h4 data-id="heading-24">4. 平台特定实现</h4>
<p><strong>PC 平台（Python/C++）</strong>：</p>
<ul>
<li>Python SDK：易于使用</li>
<li>C++ SDK：高性能</li>
<li>支持 Windows、macOS、Linux</li>
</ul>
<p><strong>Android 平台</strong>：</p>
<ul>
<li>Kotlin SDK</li>
<li>支持 NPU（Snapdragon 8 Gen 4+）</li>
<li>支持 GPU 和 CPU 回退</li>
<li>最小 SDK 27</li>
</ul>
<p><strong>iOS 平台</strong>：</p>
<ul>
<li>Swift SDK</li>
<li>支持 Apple Neural Engine</li>
<li>iOS 17.0+ / macOS 15.0+</li>
<li>Swift 5.9+</li>
</ul>
<p><strong>Linux/IoT 平台</strong>：</p>
<ul>
<li>Docker 镜像</li>
<li>支持 Arm64 和 x86</li>
<li>支持 Qualcomm Dragonwing IQ9</li>
<li>适合边缘计算场景</li>
</ul>
<h3 data-id="heading-25">关键技术实现</h3>
<h4 data-id="heading-26">1. NPU 加速优化</h4>
<p><strong>挑战</strong>：不同厂商的 NPU 架构差异大</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>统一的 NPU 抽象层</li>
<li>针对不同 NPU 的优化实现</li>
<li>自动检测和选择 NPU</li>
<li>性能监控和调优</li>
</ul>
<h4 data-id="heading-27">2. 模型格式转换</h4>
<p><strong>挑战</strong>：支持多种模型格式，需要统一处理</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>格式解析器抽象</li>
<li>统一的模型表示</li>
<li>格式转换工具</li>
<li>缓存机制优化</li>
</ul>
<h4 data-id="heading-28">3. 跨平台兼容性</h4>
<p><strong>挑战</strong>：不同平台的 API 和限制不同</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>平台抽象层</li>
<li>条件编译</li>
<li>统一的配置接口</li>
<li>平台特定的优化</li>
</ul>
<h4 data-id="heading-29">4. 内存管理</h4>
<p><strong>挑战</strong>：设备端内存有限，需要高效管理</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>智能内存分配</li>
<li>模型量化支持</li>
<li>内存池管理</li>
<li>及时释放资源</li>
</ul>
<h3 data-id="heading-30">扩展机制</h3>
<h4 data-id="heading-31">1. 添加新的计算后端</h4>
<p>实现 Plugin 接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> ComputeBackend <span class="hljs-keyword">interface</span> {
    Name() <span class="hljs-type">string</span>
    IsAvailable() <span class="hljs-type">bool</span>
    LoadModel(config ModelConfig) <span class="hljs-type">error</span>
    Generate(input Input, config GenerationConfig) (Output, <span class="hljs-type">error</span>)
}
</code></pre>
<h4 data-id="heading-32">2. 添加新的模型格式</h4>
<p>实现 FormatParser 接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> FormatParser <span class="hljs-keyword">interface</span> {
    CanParse(path <span class="hljs-type">string</span>) <span class="hljs-type">bool</span>
    Parse(path <span class="hljs-type">string</span>) (*Model, <span class="hljs-type">error</span>)
    Optimize(model *Model, target Backend) <span class="hljs-type">error</span>
}
</code></pre>
<h4 data-id="heading-33">3. 添加新的 AI 能力</h4>
<p>实现 Capability 接口：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Capability <span class="hljs-keyword">interface</span> {
    Name() <span class="hljs-type">string</span>
    SupportedModels() []<span class="hljs-type">string</span>
    Process(input Input, config Config) (Output, <span class="hljs-type">error</span>)
}
</code></pre>
<hr/>
<h2 data-id="heading-34">项目地址与资源</h2>
<h3 data-id="heading-35">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNexaAI%2Fnexa-sdk" target="_blank" title="https://github.com/NexaAI/nexa-sdk" ref="nofollow noopener noreferrer">github.com/NexaAI/nexa…</a></li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">docs.nexa.ai</a></li>
<li>📚 <strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nexa.ai" target="_blank" title="https://docs.nexa.ai" ref="nofollow noopener noreferrer">完整文档</a></li>
</ul>
<h3 data-id="heading-36">适用人群</h3>
<p><strong>强烈推荐</strong>：</p>
<ul>
<li>需要构建设备端 AI 应用的开发者</li>
<li>希望利用 NPU 加速的移动应用开发者</li>
<li>需要在 IoT 设备上运行 AI 模型的开发者</li>
<li>对设备端 AI 性能优化感兴趣的研究人员</li>
</ul>
<p><strong>也适合</strong>：</p>
<ul>
<li>想要学习设备端 AI 实现的学生</li>
<li>需要评估不同 AI 框架的架构师</li>
<li>对 NPU 加速感兴趣的技术人员</li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Kotlin系列17】协程在Android中的最佳实践：从入门到精通]]></title>    <link>https://juejin.cn/post/7601159804491022355</link>    <guid>https://juejin.cn/post/7601159804491022355</guid>    <pubDate>2026-02-01T10:00:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601159804491022355" data-draft-id="7601103779393044543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Kotlin系列17】协程在Android中的最佳实践：从入门到精通"/> <meta itemprop="keywords" content="Kotlin,Android,编程语言"/> <meta itemprop="datePublished" content="2026-02-01T10:00:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Kotlin系列17】协程在Android中的最佳实践：从入门到精通
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T10:00:26.000Z" title="Sun Feb 01 2026 10:00:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>"用户点击按钮后应用卡死2秒,然后突然显示数据。"——这是我在Code Review时听到最多的问题描述之一。</p>
<p>几年前,我接手过一个Android项目,代码里充斥着各种<code>Thread { ... }.start()</code>,还有大量的<code>runOnUiThread</code>,以及让人头疼的内存泄漏。每次用户旋转屏幕,网络请求都会重新发起;当用户快速点击按钮时,多个请求并发执行导致界面显示错乱。最糟糕的是,当Activity销毁后,后台线程仍在运行,持有Activity引用,造成内存泄漏。</p>
<p><strong>Kotlin协程彻底改变了这一切。</strong> 配合Android的生命周期感知组件(ViewModel、Lifecycle),协程让异步编程变得简单、安全、高效。Google官方已经将协程作为Android异步编程的首选方案,Jetpack库全面支持协程。</p>
<p>本文将系统讲解Kotlin协程在Android开发中的最佳实践,涵盖:</p>
<ul>
<li>协程作用域的正确使用(lifecycleScope、viewModelScope、GlobalScope)</li>
<li>网络请求、数据库操作、文件读写的协程实践</li>
<li>UI更新与线程切换</li>
<li>异常处理与错误传播</li>
<li>性能优化与常见陷阱</li>
</ul>
<p>无论你是协程新手,还是想深入掌握协程在Android中的应用,这篇文章都会给你带来价值。</p>
<hr/>
<h2 data-id="heading-1">一、Android协程生态概览</h2>
<h3 data-id="heading-2">1.1 协程在Android架构中的位置</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fc0c833e65d428e9d426763f6ab7550~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544829&amp;x-signature=famGuBNtqz7MxFG3KbK%2FA2TAnGg%3D" alt="17-01-android-coroutines-architecture.png" loading="lazy"/></p>
<p>在现代Android开发中,协程与以下组件深度集成:</p>
<p><strong>架构组件层</strong>:</p>
<ul>
<li><code>ViewModel</code> - 提供<code>viewModelScope</code>,自动取消协程</li>
<li><code>Lifecycle</code> - 提供<code>lifecycleScope</code>,生命周期感知</li>
<li><code>LiveData</code> - 通过<code>liveData {}</code>构建器支持协程</li>
<li><code>Room</code> - 原生支持<code>suspend</code>函数</li>
</ul>
<p><strong>网络层</strong>:</p>
<ul>
<li>Retrofit - 通过<code>suspend</code>关键字支持协程</li>
<li>OkHttp - 非阻塞I/O,与协程完美配合</li>
</ul>
<p><strong>数据持久化层</strong>:</p>
<ul>
<li>Room Database - <code>@Dao</code>接口支持<code>suspend</code>函数</li>
<li>DataStore - 完全基于协程和Flow</li>
</ul>
<h3 data-id="heading-3">1.2 核心依赖配置</h3>
<p>在<code>build.gradle.kts</code>中添加必要的依赖:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
    <span class="hljs-comment">// 协程核心库</span>
    implementation(<span class="hljs-string">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"</span>)
    implementation(<span class="hljs-string">"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3"</span>)

    <span class="hljs-comment">// Lifecycle与协程集成</span>
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0"</span>)
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-runtime-ktx:2.7.0"</span>)
    implementation(<span class="hljs-string">"androidx.lifecycle:lifecycle-livedata-ktx:2.7.0"</span>)

    <span class="hljs-comment">// Room与协程集成</span>
    implementation(<span class="hljs-string">"androidx.room:room-ktx:2.6.1"</span>)

    <span class="hljs-comment">// Retrofit与协程集成</span>
    implementation(<span class="hljs-string">"com.squareup.retrofit2:retrofit:2.9.0"</span>)
    implementation(<span class="hljs-string">"com.jakewharton.retrofit:retrofit2-kotlin-coroutines-adapter:0.9.2"</span>)
}
</code></pre>
<h3 data-id="heading-4">1.3 三大协程作用域</h3>
<p>Android提供了三个主要的协程作用域:</p>





























<table><thead><tr><th align="left">作用域</th><th align="left">生命周期</th><th align="left">调度器</th><th align="left">使用场景</th></tr></thead><tbody><tr><td align="left"><code>viewModelScope</code></td><td align="left">ViewModel生命周期</td><td align="left"><code>Dispatchers.Main</code></td><td align="left">ViewModel中的数据加载</td></tr><tr><td align="left"><code>lifecycleScope</code></td><td align="left">Activity/Fragment生命周期</td><td align="left"><code>Dispatchers.Main</code></td><td align="left">UI相关操作</td></tr><tr><td align="left"><code>GlobalScope</code></td><td align="left">应用进程生命周期</td><td align="left">需手动指定</td><td align="left">❌ 通常不推荐使用</td></tr></tbody></table>
<p><strong>核心原则</strong>: 始终使用生命周期感知的作用域,避免内存泄漏和不必要的计算。</p>
<hr/>
<h2 data-id="heading-5">二、ViewModel中的协程实践</h2>
<h3 data-id="heading-6">2.1 viewModelScope的正确使用</h3>
<p><code>viewModelScope</code>是ViewModel的扩展属性,当ViewModel被清除时自动取消所有协程。</p>
<p><strong>基本用法</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _userState = MutableStateFlow&lt;UiState&lt;User&gt;&gt;(UiState.Loading)
    <span class="hljs-keyword">val</span> userState: StateFlow&lt;UiState&lt;User&gt;&gt; = _userState.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _userState.value = UiState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)
                _userState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _userState.value = UiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">object</span> Loading : UiState&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : UiState&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UiState&lt;<span class="hljs-built_in">Nothing</span>&gt;()
}
</code></pre>
<p><strong>关键点</strong>:</p>
<ul>
<li>使用<code>viewModelScope.launch</code>启动协程,无需手动取消</li>
<li>使用<code>StateFlow</code>暴露UI状态,替代LiveData</li>
<li>在协程中处理异常,转换为UI状态</li>
</ul>
<h3 data-id="heading-7">2.2 并发请求优化</h3>
<p><strong>场景</strong>: 需要同时加载用户信息、好友列表和帖子列表。</p>
<p><strong>❌ 错误方式:串行执行</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 串行执行:总耗时 = time1 + time2 + time3</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)        <span class="hljs-comment">// 1秒</span>
    <span class="hljs-keyword">val</span> friends = friendsRepository.getFriends(userId) <span class="hljs-comment">// 1秒</span>
    <span class="hljs-keyword">val</span> posts = postsRepository.getPosts(userId)     <span class="hljs-comment">// 1秒</span>
    <span class="hljs-comment">// 总耗时:3秒</span>
}
</code></pre>
<p><strong>✅ 正确方式:并发执行</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.async
<span class="hljs-keyword">import</span> kotlinx.coroutines.awaitAll

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Triple&lt;User, List&lt;Friend&gt;, List&lt;Post&gt;&gt; {
    <span class="hljs-keyword">return</span> coroutineScope {
        <span class="hljs-comment">// 并发执行三个请求</span>
        <span class="hljs-keyword">val</span> userDeferred = async { userRepository.getUser(userId) }
        <span class="hljs-keyword">val</span> friendsDeferred = async { friendsRepository.getFriends(userId) }
        <span class="hljs-keyword">val</span> postsDeferred = async { postsRepository.getPosts(userId) }

        <span class="hljs-comment">// 等待所有结果</span>
        Triple(
            userDeferred.await(),
            friendsDeferred.await(),
            postsDeferred.await()
        )
    }
    <span class="hljs-comment">// 总耗时:约1秒(最慢的那个请求)</span>
}
</code></pre>
<p><strong>在ViewModel中使用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DashboardViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> friendsRepository: FriendsRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> postsRepository: PostsRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _dashboardState = MutableStateFlow&lt;DashboardState&gt;(DashboardState.Loading)
    <span class="hljs-keyword">val</span> dashboardState = _dashboardState.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadDashboard</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _dashboardState.value = DashboardState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> (user, friends, posts) = loadAllData(userId)
                _dashboardState.value = DashboardState.Success(
                    Dashboard(user, friends, posts)
                )
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _dashboardState.value = DashboardState.Error(e.message ?: <span class="hljs-string">"加载失败"</span>)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAllData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Triple&lt;User, List&lt;Friend&gt;, List&lt;Post&gt;&gt; {
        <span class="hljs-keyword">return</span> coroutineScope {
            <span class="hljs-keyword">val</span> userDeferred = async { userRepository.getUser(userId) }
            <span class="hljs-keyword">val</span> friendsDeferred = async { friendsRepository.getFriends(userId) }
            <span class="hljs-keyword">val</span> postsDeferred = async { postsRepository.getPosts(userId) }

            Triple(
                userDeferred.await(),
                friendsDeferred.await(),
                postsDeferred.await()
            )
        }
    }
}
</code></pre>
<p><strong>性能对比</strong>:</p>
<ul>
<li>串行执行:3秒</li>
<li>并发执行:1秒</li>
<li><strong>性能提升:67%</strong></li>
</ul>
<h3 data-id="heading-8">2.3 处理用户操作防抖</h3>
<p><strong>场景</strong>: 用户在搜索框输入时实时搜索,避免频繁请求。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> searchRepository: SearchRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _searchQuery = MutableStateFlow(<span class="hljs-string">""</span>)

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _searchResults = MutableStateFlow&lt;List&lt;SearchResult&gt;&gt;(emptyList())
    <span class="hljs-keyword">val</span> searchResults = _searchResults.asStateFlow()

    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// 使用Flow操作符实现防抖</span>
        viewModelScope.launch {
            _searchQuery
                .debounce(<span class="hljs-number">300</span>)  <span class="hljs-comment">// 300ms防抖</span>
                .distinctUntilChanged()  <span class="hljs-comment">// 去重</span>
                .filter { it.length &gt;= <span class="hljs-number">2</span> }  <span class="hljs-comment">// 至少2个字符才搜索</span>
                .collectLatest { query -&gt;
                    searchInternal(query)
                }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateQuery</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span> {
        _searchQuery.value = query
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">searchInternal</span><span class="hljs-params">(query: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> results = searchRepository.search(query)
            _searchResults.value = results
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            _searchResults.value = emptyList()
        }
    }
}
</code></pre>
<p><strong>UI层调用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: SearchViewModel <span class="hljs-keyword">by</span> viewModels()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)

        binding.searchEditText.addTextChangedListener { text -&gt;
            viewModel.updateQuery(text.toString())
        }

        lifecycleScope.launch {
            viewModel.searchResults.collect { results -&gt;
                updateSearchResults(results)
            }
        }
    }
}
</code></pre>
<p><strong>关键点</strong>:</p>
<ul>
<li>使用<code>debounce(300)</code>实现300ms防抖</li>
<li><code>distinctUntilChanged()</code>避免重复查询</li>
<li><code>collectLatest</code>确保只处理最新的搜索结果</li>
</ul>
<hr/>
<h2 data-id="heading-9">三、网络请求的协程实践</h2>
<h3 data-id="heading-10">3.1 Retrofit与协程集成</h3>
<p><strong>定义API接口</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiService</span> {
    <span class="hljs-meta">@GET(<span class="hljs-string">"users/{id}"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(<span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> userId: <span class="hljs-type">String</span>)</span></span>: User

    <span class="hljs-meta">@POST(<span class="hljs-string">"users"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createUser</span><span class="hljs-params">(<span class="hljs-meta">@Body</span> user: <span class="hljs-type">User</span>)</span></span>: User

    <span class="hljs-meta">@GET(<span class="hljs-string">"users/{id}/posts"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserPosts</span><span class="hljs-params">(
        <span class="hljs-meta">@Path(<span class="hljs-string">"id"</span>)</span> userId: <span class="hljs-type">String</span>,
        <span class="hljs-meta">@Query(<span class="hljs-string">"page"</span>)</span> page: <span class="hljs-type">Int</span>
    )</span></span>: List&lt;Post&gt;
}
</code></pre>
<p><strong>Repository层封装</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userDao: UserDao
) {
    <span class="hljs-comment">// 先从本地获取,再从网络更新</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 尝试从网络获取最新数据</span>
                <span class="hljs-keyword">val</span> user = apiService.getUser(userId)
                <span class="hljs-comment">// 缓存到本地数据库</span>
                userDao.insertUser(user)
                user
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// 网络失败,从本地数据库获取</span>
                userDao.getUserById(userId) ?: <span class="hljs-keyword">throw</span> e
            }
        }
    }

    <span class="hljs-comment">// 分页加载帖子</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserPosts</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>, page: <span class="hljs-type">Int</span>)</span></span>: List&lt;Post&gt; {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            apiService.getUserPosts(userId, page)
        }
    }
}
</code></pre>
<h3 data-id="heading-11">3.2 处理网络错误与重试</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b57f433e68a43bc86c9802aacdd7b42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544829&amp;x-signature=QrHjUvPXu5qKVotHeFD%2BD4LWUoU%3D" alt="17-02-network-error-handling.png" loading="lazy"/></p>
<p><strong>实现智能重试机制</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 重试扩展函数</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">retryIO</span><span class="hljs-params">(
    times: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
    initialDelay: <span class="hljs-type">Long</span> = <span class="hljs-number">100</span>,
    maxDelay: <span class="hljs-type">Long</span> = <span class="hljs-number">1000</span>,
    factor: <span class="hljs-type">Double</span> = <span class="hljs-number">2.0</span>,
    block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: T {
    <span class="hljs-keyword">var</span> currentDelay = initialDelay
    repeat(times - <span class="hljs-number">1</span>) { attempt -&gt;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> block()
        } <span class="hljs-keyword">catch</span> (e: IOException) {
            <span class="hljs-comment">// 网络错误,进行重试</span>
            delay(currentDelay)
            currentDelay = (currentDelay * factor).toLong().coerceAtMost(maxDelay)
        }
    }
    <span class="hljs-keyword">return</span> block() <span class="hljs-comment">// 最后一次尝试,失败则抛出异常</span>
}

<span class="hljs-comment">// 在Repository中使用</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService) {

    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserWithRetry</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            retryIO(times = <span class="hljs-number">3</span>) {
                apiService.getUser(userId)
            }
        }
    }
}
</code></pre>
<p><strong>处理不同类型的网络错误</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkResult</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: T) : NetworkResult&lt;T&gt;()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> exception: Exception) : NetworkResult&lt;<span class="hljs-built_in">Nothing</span>&gt;()
    <span class="hljs-keyword">object</span> Loading : NetworkResult&lt;<span class="hljs-built_in">Nothing</span>&gt;()
}

<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">safeApiCall</span><span class="hljs-params">(
    apiCall: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: NetworkResult&lt;T&gt; {
    <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
        <span class="hljs-keyword">try</span> {
            NetworkResult.Success(apiCall())
        } <span class="hljs-keyword">catch</span> (e: HttpException) {
            <span class="hljs-comment">// HTTP错误(4xx, 5xx)</span>
            NetworkResult.Error(Exception(<span class="hljs-string">"网络请求失败: <span class="hljs-subst">${e.code()}</span>"</span>))
        } <span class="hljs-keyword">catch</span> (e: IOException) {
            <span class="hljs-comment">// 网络连接错误</span>
            NetworkResult.Error(Exception(<span class="hljs-string">"网络连接失败"</span>))
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// 其他未知错误</span>
            NetworkResult.Error(Exception(<span class="hljs-string">"未知错误: <span class="hljs-subst">${e.message}</span>"</span>))
        }
    }
}

<span class="hljs-comment">// 在ViewModel中使用</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
    viewModelScope.launch {
        _userState.value = UiState.Loading

        <span class="hljs-keyword">when</span> (<span class="hljs-keyword">val</span> result = safeApiCall { userRepository.getUser(userId) }) {
            <span class="hljs-keyword">is</span> NetworkResult.Success -&gt; {
                _userState.value = UiState.Success(result.<span class="hljs-keyword">data</span>)
            }
            <span class="hljs-keyword">is</span> NetworkResult.Error -&gt; {
                _userState.value = UiState.Error(result.exception.message ?: <span class="hljs-string">"未知错误"</span>)
            }
            <span class="hljs-keyword">is</span> NetworkResult.Loading -&gt; {
                <span class="hljs-comment">// 不处理</span>
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">3.3 请求取消与超时</h3>
<p><strong>设置超时</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserWithTimeout</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User {
    <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
        withTimeout(<span class="hljs-number">5000</span>) {  <span class="hljs-comment">// 5秒超时</span>
            apiService.getUser(userId)
        }
    }
}

<span class="hljs-comment">// 或者使用withTimeoutOrNull返回null而不是抛出异常</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserWithTimeoutOrNull</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User? {
    <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
        withTimeoutOrNull(<span class="hljs-number">5000</span>) {
            apiService.getUser(userId)
        }
    }
}
</code></pre>
<p><strong>取消正在进行的请求</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> loadUserJob: Job? = <span class="hljs-literal">null</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// 取消之前的请求</span>
        loadUserJob?.cancel()

        loadUserJob = viewModelScope.launch {
            _userState.value = UiState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)
                _userState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: CancellationException) {
                <span class="hljs-comment">// 协程被取消,不处理</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _userState.value = UiState.Error(e.message ?: <span class="hljs-string">"未知错误"</span>)
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cancelLoadUser</span><span class="hljs-params">()</span></span> {
        loadUserJob?.cancel()
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-13">四、数据库操作的协程实践</h2>
<h3 data-id="heading-14">4.1 Room与协程集成</h3>
<p><strong>定义DAO接口</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Dao</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserDao</span> {
    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users WHERE id = :userId"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserById</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: User?

    <span class="hljs-meta">@Query(<span class="hljs-string">"SELECT * FROM users"</span>)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getAllUsersFlow</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;User&gt;&gt;

    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>

    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertUsers</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span>

    <span class="hljs-meta">@Delete</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deleteUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span>

    <span class="hljs-meta">@Query(<span class="hljs-string">"DELETE FROM users WHERE id = :userId"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deleteUserById</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>
}
</code></pre>
<p><strong>在Repository中使用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userDao: UserDao,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService
) {
    <span class="hljs-comment">// 从数据库读取用户(Flow自动在IO线程执行)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observeUsers</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;User&gt;&gt; {
        <span class="hljs-keyword">return</span> userDao.getAllUsersFlow()
    }

    <span class="hljs-comment">// 从网络获取并缓存</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refreshUsers</span><span class="hljs-params">()</span></span> {
        withContext(Dispatchers.IO) {
            <span class="hljs-keyword">val</span> users = apiService.getUsers()
            userDao.insertUsers(users)
        }
    }

    <span class="hljs-comment">// 单一数据源模式(Single Source of Truth)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Flow&lt;User?&gt; = flow {
        <span class="hljs-comment">// 1. 先发射数据库中的数据</span>
        emit(userDao.getUserById(userId))

        <span class="hljs-comment">// 2. 从网络获取最新数据</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> user = apiService.getUser(userId)
            userDao.insertUser(user)
            <span class="hljs-comment">// 数据库更新后,Flow会自动发射新值</span>
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// 网络错误,使用数据库缓存</span>
        }
    }.flowOn(Dispatchers.IO)
}
</code></pre>
<h3 data-id="heading-15">4.2 实现离线优先策略</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2303cc6b42c24377ad1339ca5b49a5e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770544829&amp;x-signature=V%2BZTF2xbVfIijPs1PLvzuLDXgog%3D" alt="17-03-offline-first-flow.png" loading="lazy"/></p>
<p><strong>完整的离线优先实现</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> postDao: PostDao,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> connectivityManager: ConnectivityManager
) {
    <span class="hljs-comment">// 观察帖子列表(离线优先)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">observePosts</span><span class="hljs-params">()</span></span>: Flow&lt;List&lt;Post&gt;&gt; = flow {
        <span class="hljs-comment">// 1. 立即发射本地缓存</span>
        emitAll(postDao.getAllPostsFlow())

        <span class="hljs-comment">// 2. 如果有网络,从服务器同步</span>
        <span class="hljs-keyword">if</span> (isNetworkAvailable()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> posts = apiService.getPosts()
                postDao.insertPosts(posts)
                <span class="hljs-comment">// 数据库更新后会自动触发新的emit</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// 网络同步失败,继续使用本地缓存</span>
            }
        }
    }.flowOn(Dispatchers.IO)

    <span class="hljs-comment">// 刷新(强制从网络加载)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span>: Result&lt;<span class="hljs-built_in">Unit</span>&gt; {
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> posts = apiService.getPosts()
                postDao.deleteAllPosts()
                postDao.insertPosts(posts)
                Result.success(<span class="hljs-built_in">Unit</span>)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Result.failure(e)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isNetworkAvailable</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">val</span> network = connectivityManager.activeNetwork ?: <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">val</span> capabilities = connectivityManager.getNetworkCapabilities(network) ?: <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        <span class="hljs-keyword">return</span> capabilities.hasCapability(NetworkCapabilities.NET_CAPABILITY_INTERNET)
    }
}
</code></pre>
<p><strong>在ViewModel中使用</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PostListViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> postRepository: PostRepository
) : ViewModel() {

    <span class="hljs-keyword">val</span> posts: StateFlow&lt;List&lt;Post&gt;&gt; = postRepository.observePosts()
        .stateIn(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(<span class="hljs-number">5000</span>),
            initialValue = emptyList()
        )

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _isRefreshing = MutableStateFlow(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">val</span> isRefreshing = _isRefreshing.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _isRefreshing.value = <span class="hljs-literal">true</span>
            postRepository.refresh()
            _isRefreshing.value = <span class="hljs-literal">false</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-16">4.3 批量操作优化</h3>
<p><strong>场景</strong>: 插入大量数据时使用事务提升性能。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Dao</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">PostDao</span> {
    <span class="hljs-meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertPosts</span><span class="hljs-params">(posts: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Post</span>&gt;)</span></span>

    <span class="hljs-comment">// 使用事务批量删除并插入</span>
    <span class="hljs-meta">@Transaction</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">replaceAllPosts</span><span class="hljs-params">(posts: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Post</span>&gt;)</span></span> {
        deleteAllPosts()
        insertPosts(posts)
    }

    <span class="hljs-meta">@Query(<span class="hljs-string">"DELETE FROM posts"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deleteAllPosts</span><span class="hljs-params">()</span></span>
}

<span class="hljs-comment">// 在Repository中使用</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">syncPosts</span><span class="hljs-params">()</span></span> {
    withContext(Dispatchers.IO) {
        <span class="hljs-keyword">val</span> posts = apiService.getPosts()
        postDao.replaceAllPosts(posts)  <span class="hljs-comment">// 事务中执行,保证原子性</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-17">五、UI更新与线程切换</h2>
<h3 data-id="heading-18">5.1 Dispatchers详解</h3>
<p>Kotlin协程提供了四种调度器:</p>






























<table><thead><tr><th align="left">Dispatcher</th><th align="left">用途</th><th align="left">线程池</th></tr></thead><tbody><tr><td align="left"><code>Dispatchers.Main</code></td><td align="left">UI更新、轻量级操作</td><td align="left">主线程</td></tr><tr><td align="left"><code>Dispatchers.IO</code></td><td align="left">网络、文件、数据库</td><td align="left">共享线程池(最多64线程)</td></tr><tr><td align="left"><code>Dispatchers.Default</code></td><td align="left">CPU密集型计算</td><td align="left">线程数=CPU核心数</td></tr><tr><td align="left"><code>Dispatchers.Unconfined</code></td><td align="left">不限制线程(不推荐)</td><td align="left">调用者线程</td></tr></tbody></table>
<p><strong>最佳实践</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModelScope.launch {
    <span class="hljs-comment">// 在主线程启动协程</span>

    <span class="hljs-keyword">val</span> user = withContext(Dispatchers.IO) {
        <span class="hljs-comment">// 切换到IO线程执行网络请求</span>
        apiService.getUser(userId)
    }
    <span class="hljs-comment">// 自动切回主线程</span>

    <span class="hljs-comment">// 更新UI(在主线程)</span>
    binding.userName.text = user.name
}
</code></pre>
<h3 data-id="heading-19">5.2 避免不必要的线程切换</h3>
<p><strong>❌ 过度切换</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
    withContext(Dispatchers.IO) {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = apiService.getData()

        withContext(Dispatchers.Main) {
            <span class="hljs-comment">// 不必要的切换</span>
            updateUI(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<p><strong>✅ 优化后</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = withContext(Dispatchers.IO) {
        apiService.getData()
    }
    <span class="hljs-comment">// 自动在主线程</span>
    updateUI(<span class="hljs-keyword">data</span>)
}
</code></pre>
<h3 data-id="heading-20">5.3 在Activity/Fragment中收集Flow</h3>
<p><strong>使用lifecycleScope与repeatOnLifecycle</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: UserViewModel <span class="hljs-keyword">by</span> viewModels()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState)

        <span class="hljs-comment">// ✅ 推荐:生命周期感知</span>
        viewLifecycleOwner.lifecycleScope.launch {
            viewLifecycleOwner.repeatOnLifecycle(Lifecycle.State.STARTED) {
                <span class="hljs-comment">// 只在STARTED状态收集Flow</span>
                viewModel.userState.collect { state -&gt;
                    <span class="hljs-keyword">when</span> (state) {
                        <span class="hljs-keyword">is</span> UiState.Loading -&gt; showLoading()
                        <span class="hljs-keyword">is</span> UiState.Success -&gt; showUser(state.<span class="hljs-keyword">data</span>)
                        <span class="hljs-keyword">is</span> UiState.Error -&gt; showError(state.message)
                    }
                }
            }
        }
    }
}
</code></pre>
<p><strong>为什么使用<code>repeatOnLifecycle(STARTED)</code></strong>:</p>
<ul>
<li>Fragment在后台时停止收集,节省资源</li>
<li>Fragment回到前台时自动恢复收集</li>
<li>避免内存泄漏和不必要的UI更新</li>
</ul>
<hr/>
<h2 data-id="heading-21">六、异常处理与错误传播</h2>
<h3 data-id="heading-22">6.1 协程中的异常类型</h3>
<p><strong>两种异常类型</strong>:</p>
<ol>
<li><strong>CancellationException</strong>: 协程取消,不会传播</li>
<li><strong>其他异常</strong>: 会传播到父协程,导致整个协程树取消</li>
</ol>
<p><strong>示例</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">viewModelScope.launch {
    launch {
        delay(<span class="hljs-number">100</span>)
        <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"子协程异常"</span>)
        <span class="hljs-comment">// 这个异常会传播到父协程,导致viewModelScope取消</span>
    }

    launch {
        delay(<span class="hljs-number">200</span>)
        println(<span class="hljs-string">"这行代码不会执行"</span>)  <span class="hljs-comment">// 父协程已被取消</span>
    }
}
</code></pre>
<h3 data-id="heading-23">6.2 使用SupervisorJob隔离异常</h3>
<p><strong>SupervisorJob</strong>: 子协程异常不会影响其他子协程。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> supervisorScope = CoroutineScope(SupervisorJob() + Dispatchers.Main)

supervisorScope.launch {
    launch {
        delay(<span class="hljs-number">100</span>)
        <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"子协程1异常"</span>)
        <span class="hljs-comment">// 这个异常不会影响子协程2</span>
    }

    launch {
        delay(<span class="hljs-number">200</span>)
        println(<span class="hljs-string">"子协程2继续执行"</span>)  <span class="hljs-comment">// 会执行</span>
    }
}
</code></pre>
<p><strong>在ViewModel中使用SupervisorJob</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RobustViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> supervisorJob = SupervisorJob()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> scope = CoroutineScope(supervisorJob + Dispatchers.Main)

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadMultipleData</span><span class="hljs-params">()</span></span> {
        scope.launch {
            <span class="hljs-comment">// 启动多个独立的子任务</span>
            launch {
                <span class="hljs-keyword">try</span> {
                    loadUserData()
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    handleError(<span class="hljs-string">"用户数据加载失败"</span>, e)
                }
            }

            launch {
                <span class="hljs-keyword">try</span> {
                    loadPostsData()
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    handleError(<span class="hljs-string">"帖子数据加载失败"</span>, e)
                }
            }
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCleared()
        supervisorJob.cancel()
    }
}
</code></pre>
<h3 data-id="heading-24">6.3 全局异常处理</h3>
<p><strong>设置CoroutineExceptionHandler</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> exceptionHandler = CoroutineExceptionHandler { _, exception -&gt;
    Log.e(<span class="hljs-string">"Coroutine"</span>, <span class="hljs-string">"捕获到未处理的异常"</span>, exception)
    <span class="hljs-comment">// 上报到崩溃收集平台(如Firebase Crashlytics)</span>
}

<span class="hljs-keyword">val</span> scope = CoroutineScope(SupervisorJob() + Dispatchers.Main + exceptionHandler)

scope.launch {
    <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"未捕获的异常"</span>)
    <span class="hljs-comment">// 会被exceptionHandler捕获</span>
}
</code></pre>
<p><strong>在Application中设置全局处理器</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()

        <span class="hljs-comment">// 设置全局协程异常处理器</span>
        Thread.setDefaultUncaughtExceptionHandler { thread, throwable -&gt;
            Log.e(<span class="hljs-string">"GlobalHandler"</span>, <span class="hljs-string">"未捕获的异常"</span>, throwable)
            <span class="hljs-comment">// 上报崩溃</span>
            FirebaseCrashlytics.getInstance().recordException(throwable)
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-25">七、性能优化与常见陷阱</h2>
<h3 data-id="heading-26">7.1 避免内存泄漏</h3>
<p><strong>❌ 陷阱1: 使用GlobalScope</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakyActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
        GlobalScope.launch {
            <span class="hljs-comment">// 危险!Activity销毁后协程仍在运行</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData()
            updateUI(<span class="hljs-keyword">data</span>)  <span class="hljs-comment">// 可能访问已销毁的Activity</span>
        }
    }
}
</code></pre>
<p><strong>✅ 正确方式: 使用lifecycleScope</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span></span> {
        lifecycleScope.launch {
            <span class="hljs-comment">// Activity销毁时自动取消</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData()
            updateUI(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<p><strong>❌ 陷阱2: 静态引用持有Context</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
    <span class="hljs-keyword">var</span> coroutineJob: Job? = <span class="hljs-literal">null</span>  <span class="hljs-comment">// 危险!</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    coroutineJob = GlobalScope.launch {
        <span class="hljs-comment">// context可能是Activity,导致内存泄漏</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData(context)
    }
}
</code></pre>
<p><strong>✅ 正确方式: 使用Application Context</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadData</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
    <span class="hljs-keyword">val</span> appContext = context.applicationContext

    viewModelScope.launch {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = fetchData(appContext)
    }
}
</code></pre>
<h3 data-id="heading-27">7.2 控制并发数量</h3>
<p><strong>问题</strong>: 同时发起1000个网络请求导致OOM。</p>
<p><strong>✅ 解决方案: 使用Semaphore限流</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.sync.Semaphore
<span class="hljs-keyword">import</span> kotlinx.coroutines.sync.withPermit

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageLoader</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> semaphore = Semaphore(<span class="hljs-number">5</span>)  <span class="hljs-comment">// 最多5个并发</span>

    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadImages</span><span class="hljs-params">(urls: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span>: List&lt;Bitmap&gt; {
        <span class="hljs-keyword">return</span> urls.map { url -&gt;
            async {
                semaphore.withPermit {
                    <span class="hljs-comment">// 最多同时执行5个</span>
                    loadImage(url)
                }
            }
        }.awaitAll()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadImage</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span>: Bitmap {
        <span class="hljs-comment">// 下载图片</span>
        <span class="hljs-keyword">return</span> withContext(Dispatchers.IO) {
            <span class="hljs-comment">// 实际下载逻辑</span>
            TODO()
        }
    }
}
</code></pre>
<h3 data-id="heading-28">7.3 使用Channel避免背压问题</h3>
<p><strong>场景</strong>: 生产者速度 &gt;&gt; 消费者速度,导致内存占用暴涨。</p>
<p><strong>❌ 使用Flow(无背压控制)</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produceData</span><span class="hljs-params">()</span></span>: Flow&lt;Data&gt; = flow {
    repeat(<span class="hljs-number">1_000_000</span>) {
        emit(Data(it))  <span class="hljs-comment">// 快速发射数据</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consumeData</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        produceData().collect { <span class="hljs-keyword">data</span> -&gt;
            delay(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 消费慢</span>
            process(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<p><strong>✅ 使用Channel(有容量限制)</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> channel = Channel&lt;Data&gt;(capacity = <span class="hljs-number">100</span>)  <span class="hljs-comment">// 缓冲100个元素</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produceData</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        repeat(<span class="hljs-number">1_000_000</span>) {
            channel.send(Data(it))  <span class="hljs-comment">// 缓冲满时挂起</span>
        }
        channel.close()
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consumeData</span><span class="hljs-params">()</span></span> {
    viewModelScope.launch {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">data</span> <span class="hljs-keyword">in</span> channel) {
            delay(<span class="hljs-number">10</span>)
            process(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-29">7.4 避免阻塞Dispatchers.IO线程池</h3>
<p><strong>❌ 在IO线程池执行CPU密集型任务</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processLargeData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    withContext(Dispatchers.IO) {
        <span class="hljs-comment">// CPU密集型计算,占用IO线程</span>
        <span class="hljs-keyword">data</span>.map { it * it * it }.sorted()
    }
}
</code></pre>
<p><strong>✅ 使用Dispatchers.Default</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processLargeData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    withContext(Dispatchers.Default) {
        <span class="hljs-comment">// CPU密集型任务使用Default</span>
        <span class="hljs-keyword">data</span>.map { it * it * it }.sorted()
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-30">八、总结与最佳实践清单</h2>
<h3 data-id="heading-31">核心要点回顾</h3>
<ol>
<li>
<p><strong>使用生命周期感知的作用域</strong></p>
<ul>
<li><code>viewModelScope</code> for ViewModel</li>
<li><code>lifecycleScope</code> for Activity/Fragment</li>
<li>避免使用<code>GlobalScope</code></li>
</ul>
</li>
<li>
<p><strong>线程切换</strong></p>
<ul>
<li><code>Dispatchers.Main</code> - UI操作</li>
<li><code>Dispatchers.IO</code> - 网络、文件、数据库</li>
<li><code>Dispatchers.Default</code> - CPU密集型计算</li>
</ul>
</li>
<li>
<p><strong>错误处理</strong></p>
<ul>
<li>使用<code>try-catch</code>处理已知异常</li>
<li>使用<code>SupervisorJob</code>隔离子协程异常</li>
<li>设置<code>CoroutineExceptionHandler</code>全局捕获</li>
</ul>
</li>
<li>
<p><strong>性能优化</strong></p>
<ul>
<li>使用<code>async</code>并发执行独立任务</li>
<li>使用<code>Semaphore</code>控制并发数量</li>
<li>避免在循环中创建协程</li>
</ul>
</li>
<li>
<p><strong>数据流管理</strong></p>
<ul>
<li>使用<code>StateFlow</code>替代<code>LiveData</code></li>
<li>使用<code>repeatOnLifecycle</code>收集Flow</li>
<li>实现离线优先策略</li>
</ul>
</li>
</ol>
<h3 data-id="heading-32">最佳实践检查清单</h3>
<p><strong>作用域管理</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>viewModelScope</code>在ViewModel中启动协程</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>lifecycleScope</code>在Activity/Fragment中启动协程</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 避免使用<code>GlobalScope</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在自定义作用域时使用<code>SupervisorJob</code></li>
</ul>
<p><strong>线程调度</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 网络请求使用<code>Dispatchers.IO</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 数据库操作使用<code>Dispatchers.IO</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> CPU密集型计算使用<code>Dispatchers.Default</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> UI更新在<code>Dispatchers.Main</code></li>
</ul>
<p><strong>异常处理</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在协程顶层使用<code>try-catch</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 区分<code>CancellationException</code>和其他异常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>CoroutineExceptionHandler</code>记录未捕获异常</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在Repository层捕获并转换异常</li>
</ul>
<p><strong>性能优化</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>async</code>并发执行独立任务</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>Semaphore</code>限制并发数量</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 避免阻塞Dispatcher线程池</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>Flow.buffer()</code>控制背压</li>
</ul>
<p><strong>测试</strong>:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>runTest</code>测试suspend函数</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用<code>StandardTestDispatcher</code>控制测试时间</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Mock Repository和API</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 测试不同的UI状态</li>
</ul>
<h3 data-id="heading-33">学习资源</h3>
<p><strong>官方文档</strong>:</p>
<ul>
<li>Kotlin协程官方指南: <a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fcoroutines-guide.html" target="_blank" title="https://kotlinlang.org/docs/coroutines-guide.html" ref="nofollow noopener noreferrer">kotlinlang.org/docs/corout…</a></li>
<li>Android协程最佳实践: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fkotlin%2Fcoroutines%2Fcoroutines-best-practices" target="_blank" title="https://developer.android.com/kotlin/coroutines/coroutines-best-practices" ref="nofollow noopener noreferrer">developer.android.com/kotlin/coro…</a></li>
</ul>
<p><strong>推荐阅读</strong>:</p>
<ul>
<li>《Kotlin Coroutines by Tutorials》</li>
<li>《Asynchronous Programming with Kotlin》</li>
<li>Roman Elizarov的博客(协程库作者)</li>
</ul>
<p><strong>视频教程</strong>:</p>
<ul>
<li>Android Developers YouTube频道 - Coroutines系列</li>
<li>Kotlin Conf演讲 - Coroutines相关主题</li>
</ul>
<p><strong>系列文章导航:</strong></p>
<ul>
<li>👉 上一篇: <a href="https://juejin.cn/post/7599920572839919625" target="_blank" title="https://juejin.cn/post/7599920572839919625">性能优化：内联、内存与字节码分析</a></li>
</ul>
<hr/>
<p><em>如果这篇文章对你有帮助,欢迎点赞、收藏、分享!有任何问题或建议,欢迎在评论区留言讨论。让我们一起学习,一起成长!</em></p>
<p><em>也欢迎访问我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>发现更多宝藏资源</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的状态管理哲学]]></title>    <link>https://juejin.cn/post/7601076815450390543</link>    <guid>https://juejin.cn/post/7601076815450390543</guid>    <pubDate>2026-02-01T09:41:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815450390543" data-draft-id="7601076976442769448" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的状态管理哲学"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-02-01T09:41:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="fe小陈"/> <meta itemprop="url" content="https://juejin.cn/user/4019470241892983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的状态管理哲学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4019470241892983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    fe小陈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T09:41:50.000Z" title="Sun Feb 01 2026 09:41:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<blockquote>
<p>简单讲讲 react 状态管理的演进过程</p>
</blockquote>
<p>React状态管理的演进始终围绕“组件通信”与“状态复用”两大核心需求展开。</p>
<p>早期类组件时代，开发者依赖props实现组件间传值，通过state管理组件内部状态，但跨层级组件通信需借助“props drilling”（属性透传），代码冗余且维护成本高。</p>
<p>为解决这一问题，Redux、MobX 等第三方状态管理库应运而生，通过集中式存储、统一状态更新机制，实现了全局状态共享，但其繁琐的配置与概念（如reducer、action、中间件）也增加了开发门槛。</p>
<p>随着React 16.8推出Hook特性，函数组件得以拥有状态管理能力，useState、useContext等原生Hook的出现，为轻量型状态管理提供了可能，也推动开发者探索更简洁、无依赖的状态管理思路，逐步打破对第三方库的依赖。</p>
<p>React生态核心路由工具react-router（常用v6版本）虽不直接管理状态，但与状态管理深度关联。其路由参数、查询参数及导航状态需与全局/局部状态联动（如通过路由参数获取详情ID、同步登录状态控制跳转权限）。React Router v6适配Hook，提供useParams、useSearchParams等方法，可便捷操作路由状态，后续自定义的原生Hook状态管理方案可与其兼容，实现路由与业务状态的协同管控。</p>
<p>第三方状态管理库中，react-query（现更名TanStack Query）极具代表性，它跳出传统全局集中存储思路，专注服务端状态管理，补齐了传统库与原生Hook在异步数据处理上的短板。不同于Redux等通用库，它专为接口请求、数据缓存等服务端状态场景设计，无需手动维护加载、错误等冗余状态，大幅简化异步逻辑。但它不擅长客户端状态（如主题、弹窗），需搭配客户端状态管理方案使用，这也印证了状态管理无万能方案，需结合场景选型。</p>
<p>Zustand是一款轻量的第三方状态管理库，基于Hook设计，兼顾简洁性与实用性。它无需Context嵌套，通过自定义Hook即可便捷获取和修改全局状态，规避了Context重渲染的问题，同时简化了Redux等库的繁琐配置。</p>
<h2 data-id="heading-1">取舍</h2>
<p>只要经过长年多个项目的开发经历，就会发现，没有哪个方案非常适用于所有的场景。</p>
<ol>
<li>
<p><strong>Redux</strong>：优点是状态集中可追溯、生态完善、适合大型项目团队协作；缺点是配置繁琐、概念多（reducer/action等）、上手成本高，小型项目使用显冗余。</p>
</li>
<li>
<p><strong>Mobx</strong>：优点是响应式更新、编码灵活、无需手动编写大量模板代码；缺点是依赖装饰器语法（存在兼容问题）、状态变化隐性化，复杂项目易失控。</p>
</li>
<li>
<p><strong>Zustand</strong>：优点是轻量简洁、基于Hook设计、无Context嵌套、规避重渲染问题；缺点是生态不如Redux完善，大型项目复杂状态管控能力稍弱。</p>
</li>
<li>
<p><strong>react-query（TanStack Query）</strong> ：优点是专注服务端状态、自动处理缓存/重试/加载状态、大幅简化异步逻辑；缺点是不擅长客户端状态管理，需搭配其他方案使用。</p>
</li>
<li>
<p><strong>rxjs</strong>：优点是擅长处理复杂异步流、状态联动能力强、可复用性高；缺点是学习曲线陡峭、概念抽象，简单场景使用成本过高。虽然 rxjs 本身不是状态管理，但其处理异步流的能力可以轻松构造出灵活的状态管理方案。</p>
</li>
<li>
<p><strong>react-use、ahooks</strong>：优点是封装大量通用Hook（含状态管理相关）、复用性强，简化重复开发，贴合React Hook生态；缺点是侧重通用Hook合集，无专属全局状态管理体系，复杂状态联动需基于其二次封装。</p>
</li>
</ol>
<p><strong>实际使用会将方案组合使用，这里我们会发现存在两种矛盾：</strong></p>
<ol>
<li>
<p>如果你倾向于使用 react hook 去开发逻辑，那么共享状态采用 context，会出现 context 套 context，逻辑混合在UI 组件树上，极难看懂，复杂应用中容易陷入性能优化又劣化的循环中。</p>
</li>
<li>
<p>如果不想使用 react context 作为状态共享的方案，通常是希望应用的业务状态能与 UI 框架解耦，选择 redux 和 zustand。这时候又会发现，这些方案并没有提供与 react hook 类似的逻辑组合复用能力，进入堆叠面条代码 “大力出奇迹” 的陷阱。</p>
</li>
</ol>
<p>本文并不打算完全解决这种矛盾，这是我经验上判断 react 状态管理存在的问题，或许有些大佬有这方面的解决方案也说不一定。</p>
<h2 data-id="heading-2">沉思与创造</h2>
<p>相信一些对状态管理或者应用架构设计感兴趣的人，必然设计过自己趁手的状态管理库。</p>
<p><strong>我理想中的状态管理库应该能够做到以下的事情：</strong></p>
<ol>
<li>
<p><strong>响应式状态</strong>：存储状态、读取状态、更新状态、订阅状态变更。</p>
</li>
<li>
<p><strong>状态类</strong>：一组状态可以形成一个模版类型，并创建实例。</p>
</li>
<li>
<p><strong>副作用管理</strong>：一个状态实例会管理自己的副作用（如定时器、监听器等），实例销毁（destroy方法）会清除其所有的副作用。</p>
</li>
<li>
<p><strong>层次管理</strong>：一个状态实例A可能被另一个状态实例B持有，这是一种附属关系（如某种插件机制），实例B销毁的时候，实例A也会销毁（连带副作用清除）。</p>
</li>
<li>
<p><strong>聚合事件</strong>：是对 “多个分散状态变更 / 副作用触发” 的统一收口与联动管理</p>
</li>
<li>
<p><strong>组合复用机制</strong>：就像 react 自定义 Hook 一样，一些纯工具能力应该能轻易的复用并组合。</p>
</li>
</ol>
<p>我曾自己尝试过很多种方案组合并用在自己维护的项目上，上面可以说就是无数次错误尝试与痛苦挣扎的总结。</p>
<p>一切不优雅的 hack 方案和 shit 代码都是源于某些能力没有提供，而你没有办法让库的提供者提供你想要的能力，可能得到的回答就是 “我们需要保持简洁、纯净”，你可以通过某某方式间接实现。</p>
<p>为什么要委屈自己，去接受这草台般的世界？最终我决定了放下一切信仰，自己开宗立派。</p>
<p>让我们一步步推演出这个方案的摸样（仅考虑 API 的设计，因为实现不复杂且一直在变化）。</p>
<h3 data-id="heading-3"><strong>状态类</strong></h3>
<blockquote>
<p>一组状态可以形成一个模版类型，并创建实例。</p>
<p>虽然这是第二点，但还是先说说这个，存在 API 的依赖。</p>
</blockquote>
<p>基于理想中“状态类”的诉求，我们先定义状态模版的创建方式——通过 createModel 方法封装状态的初始化逻辑，支持传入 id 和自定义参数 param，让同一种状态模版可以生成多个独立实例，兼顾复用性与灵活性。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>)=&gt;</span>({
        <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>
    }),
});
</code></pre>
<h3 data-id="heading-4"><strong>响应式状态</strong></h3>
<blockquote>
<p>存储状态、读取状态、更新状态、订阅状态变更。</p>
</blockquote>
<p>有了状态类的模版定义，接下来就要落地响应式核心能力——毕竟光有模版不能读写更新，跟空架子没区别。响应式API要足够简洁，还得兼顾灵活性，不用搞一堆冗余配置，直接在状态实例上挂载核心方法就行，具体用法如下：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 创建状态实例，调用 create 方法 (id,  param) 传入 initState</span>
<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-title function_">getState</span>();
stateIns.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">2</span> }); 
<span class="hljs-comment">// 或者 </span>
<span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> ({<span class="hljs-attr">count</span>: s.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>}));
stateIns.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">state, prevState</span>)=&gt;</span>{ <span class="hljs-comment">/* 状态变更回调 */</span> });
</code></pre>
<p>这就够了吗？到这里看起来就是跟 Zustand 的 store 一样，没什么特别的。</p>
<p>不够！只有信奉极简主义者才会觉得这是够的。</p>
<p>subscribe 是一种极其简陋的实现，它存在以下问题：</p>
<ol>
<li>订阅粒度太粗，没法精准订阅某个字段，哪怕只改了状态里的一个字段，所有订阅者都会被触发，跟Context的重渲染坑一模一样，大型应用里纯属性能灾难。</li>
<li>只是订阅了状态的变化，应该有场景需要对初值进行回调，因此需要分开它们。</li>
</ol>
<p>可以使用 rxjs 提供 Subject 来暴露订阅接口。</p>
<pre><code class="hljs language-tsx" lang="tsx">stateIns.<span class="hljs-property">states</span> <span class="hljs-comment">// 分离字段的 BehaviorSubjects</span>
stateIns.<span class="hljs-property">fullState</span> <span class="hljs-comment">// 整体状态 BehaviorSubject</span>
stateIns.<span class="hljs-property">updates</span>  <span class="hljs-comment">// 分离字段的更新事件 Subject</span>
stateIns.<span class="hljs-property">fullUpdate</span> <span class="hljs-comment">// 整体状态的更新事件 Subject</span>
</code></pre>
<h3 data-id="heading-5">副作用管理</h3>
<blockquote>
<p>一个状态实例会管理自己的副作用（如定时器、监听器等），实例销毁（destroy方法）会清除其所有的副作用。</p>
</blockquote>
<p>先说说计算属性吧，计算属性作为 state 的衍生。需要追踪 state 变更并重新计算，为了减少重复计算，如果没有像 vue proxy 响应式机制，那么就只能自己手动给到了。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
        <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
        <span class="hljs-attr">others1</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">others2</span>: <span class="hljs-number">456</span>,
    }),
    <span class="hljs-comment">// 添加 computed </span>
    <span class="hljs-attr">computed</span>: {
        <span class="hljs-attr">double</span>: {
            <span class="hljs-attr">dep</span>: <span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> [s.<span class="hljs-property">count</span>],
            <span class="hljs-attr">run</span>: <span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
        }
    },
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-title function_">getState</span>().<span class="hljs-property">double</span> <span class="hljs-comment">// 2</span>
</code></pre>
<p>这个设计，我只能说，很丑陋，实际也没想象中那么实用，后面再说。</p>
<p>再说说副作用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
    <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>)=&gt;</span>({
        <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
        <span class="hljs-attr">others1</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">others2</span>: <span class="hljs-number">456</span>,
    }),
    <span class="hljs-comment">// 添加 effects</span>
    <span class="hljs-attr">effects</span>: {
        <span class="hljs-attr">effect1</span>: {
            <span class="hljs-attr">dep</span>: <span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> [s.<span class="hljs-property">count</span>],
            <span class="hljs-attr">run</span>: <span class="hljs-function">(<span class="hljs-params">state, setState</span>)=&gt;</span>{
                <span class="hljs-keyword">const</span> t = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count is '</span>, state.<span class="hljs-property">count</span>)
                }, <span class="hljs-number">3000</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(t);
            }
        }
    }
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-title function_">setState</span>({<span class="hljs-attr">count</span>: <span class="hljs-number">2</span>});
stateIns.<span class="hljs-title function_">setState</span>({<span class="hljs-attr">count</span>: <span class="hljs-number">3</span>}); <span class="hljs-comment">// 3s 后打印 "count is 3"</span>
</code></pre>
<p>表达了当 count 更新并稳定 3s 后打印它。</p>
<p>到这里，其实我也不知道自己在写什么了，effects 的存在究竟为了什么？为了模拟 react 的 useEffect 吗？不管怎么样，存在即合理，如果要把代码从 react 屎山迁过来，结果发现没有 effect 能力该是多头疼。</p>
<p>可以对比一下 Zustand，它根本就没有这两个东西。Zustand 直接返回状态和封装过的方法，不直接让使用方调用 setState，而是把状态更新逻辑封装在自定义方法里，更侧重“状态操作收口”。</p>
<p>但是代码写起来就是另一种意义上的丑陋了。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// Zustand 典型用法</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { debounce } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash-es'</span>;

<span class="hljs-comment">// 直接创建store，封装状态和更新方法，不暴露setState</span>
<span class="hljs-keyword">const</span> useCountStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> logCount = <span class="hljs-title function_">debounce</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count is '</span>, <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span>);
  }, <span class="hljs-number">3000</span>);

  <span class="hljs-keyword">return</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">double</span>: <span class="hljs-number">2</span>,
    <span class="hljs-comment">// 封装更新逻辑，使用方直接调用方法，无需手动setState</span>
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>, <span class="hljs-attr">double</span>: (state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>) * <span class="hljs-number">2</span> }))
      <span class="hljs-title function_">logCount</span>(); <span class="hljs-comment">// 手动调用</span>
    },
    <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>, <span class="hljs-attr">double</span>: (state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>) * <span class="hljs-number">2</span> }))
      <span class="hljs-title function_">logCount</span>(); <span class="hljs-comment">// 手动调用</span>
    },
    <span class="hljs-attr">setCount</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
      <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: val, <span class="hljs-attr">double</span>: val * <span class="hljs-number">2</span> })
      <span class="hljs-title function_">logCount</span>(); <span class="hljs-comment">// 手动调用</span>
    },
  })
});
</code></pre>
<p>这大概就是为什么我始终没有大规模使用 Zustand（或许是用法不对吧）。</p>
<p>再回到自己的设计上来，我意识到直接让状态实例订阅自己的状态再执行计算属性变更和副作用，也能达到一样的效果。同时受到 Zustand 的启发，setState 就不应该暴露给外部使用，应该直接封死在内部的 actions 里面。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { debounceTime } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
      <span class="hljs-attr">double</span>: params.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
   }),
  <span class="hljs-attr">actions</span>: <span class="hljs-function">(<span class="hljs-params">get, set</span>) =&gt;</span> ({
    <span class="hljs-attr">inc</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }),
    <span class="hljs-attr">dec</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> - <span class="hljs-number">1</span> }),
    <span class="hljs-attr">setCount</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: val }),
  }),
  <span class="hljs-comment">// 处理 computed 和 effect 的地方</span>
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>) {
    <span class="hljs-keyword">return</span> [
      <span class="hljs-comment">// 1. 直接通过同步监听 count 来设置 double</span>
      self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>
        .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> thisInstance.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">double</span>: c * <span class="hljs-number">2</span> })),
      <span class="hljs-comment">// 2. 监听 count 再 pipe 一个 rxjs 防抖操作符</span>
      self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>
        .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">3000</span>))
        .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count is '</span>, c)),
    ]
  }
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>();
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>(); <span class="hljs-comment">// 3s 后打印 "count is 3"</span>
</code></pre>
<p>这个方案已经足够好用了，曾经我也这么认为，并在一个项目里面大规模使用，直到有人接手了我的代码并开始了吐槽。</p>
<p>我并不觉得 rxjs 是多么高深的技术，但事实如此 …… 不是谁都能接受的。</p>
<p>这个问题先按下不管，接着看。</p>
<p>createModel 内部通过返回 subscription 数组并在 destroy 的时候取消即可实现<strong>副作用的清理</strong>。</p>
<pre><code class="hljs language-tsx" lang="tsx">ins.<span class="hljs-property">_subscriptions</span> = <span class="hljs-title function_">setup</span>(ins);

ins.<span class="hljs-property">destroy</span> = <span class="hljs-function">()=&gt;</span>{
    ins.<span class="hljs-property">_subscriptions</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">sup</span>)=&gt;</span>{
        sup.<span class="hljs-title function_">unsubscribe</span>();
    })
}
</code></pre>
<p>上面的例子只在 setup 中实现了静态的副作用管理，当然还需要考虑动态添加副作用的情况。</p>
<p>比如在调用 action 方法的时候，开启一个定时器 interval 执行一些操作，同时还要考虑多次调用时对上一次副作用的清理。</p>
<p>这就需要引入一个动态副作用管理的工具了。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Subscription</span>, <span class="hljs-title class_">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FunctionClean</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Cleanup</span> = <span class="hljs-title class_">Subscription</span> | <span class="hljs-title class_">FunctionClean</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">EffectHandle</span> = 
    <span class="hljs-title class_">Observable</span> 
    | (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">FunctionClean</span>); 

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EffectManager</span> {
    <span class="hljs-title function_">addEffect</span>(<span class="hljs-attr">cleanup</span>: <span class="hljs-title class_">Cleanup</span>): <span class="hljs-title class_">FunctionClean</span>;
    <span class="hljs-title function_">runEffect</span>(<span class="hljs-attr">handle</span>: <span class="hljs-title class_">EffectHandle</span>): <span class="hljs-title class_">Cleanup</span>;
    <span class="hljs-title function_">cycleEffect</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">cb</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">EffectHandle</span> | <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-title function_">cleanAll</span>(): <span class="hljs-built_in">void</span>;
}
</code></pre>
<p>结合 EffectManager 使用示例，这时候静态副作用和动态副作用都可以用 EffectManager 管理，setup 里面也就可以显式添加副作用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 核心使用示例：结合状态模型的action动态管理副作用</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
    <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
    <span class="hljs-attr">double</span>: params.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
  }),
  <span class="hljs-attr">actions</span>: <span class="hljs-function">(<span class="hljs-params">get, set, self</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">inc</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> + <span class="hljs-number">1</span> }),
      <span class="hljs-attr">dec</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">count</span> - <span class="hljs-number">1</span> }),
      <span class="hljs-comment">// 动态副作用场景：调用action时开启定时器，多次调用自动清理上一次</span>
      <span class="hljs-attr">startCountLog</span>: <span class="hljs-function">() =&gt;</span> {
        self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">cycleEffect</span>(<span class="hljs-string">'countLog'</span>, <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">return</span> self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">pipe</span>(
              <span class="hljs-title function_">debounceTime</span>(<span class="hljs-number">3000</span>), 
              <span class="hljs-title function_">tap</span>(<span class="hljs-function">(<span class="hljs-params">c</span>)=&gt;</span><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'log'</span>, c))
          );
        });
      },
      <span class="hljs-attr">stopCountLog</span>: <span class="hljs-function">()=&gt;</span>{
          <span class="hljs-comment">// 传空即可清除</span>
          self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">cycleEffect</span>(<span class="hljs-string">'countLog'</span>, <span class="hljs-function">()=&gt;</span>{});
      }
    };
  },
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>) {
    <span class="hljs-comment">// 静态副作用：初始化时监听count，同步更新double</span>
    <span class="hljs-keyword">const</span> sub = self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> {
      self.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">double</span>: c * <span class="hljs-number">2</span> });
    });
    <span class="hljs-comment">// 将静态副作用交给EffectManager管理</span>
    self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">addEffect</span>(sub);
  },
});

<span class="hljs-comment">// 组件/业务中使用</span>
<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">// 调用动态副作用</span>
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">startCountLog</span>();
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>();  <span class="hljs-comment">// 3s 后 log 2</span>
</code></pre>
<p>createModel 内部的 destroy 也就变成了</p>
<pre><code class="hljs language-tsx" lang="tsx">ins.<span class="hljs-property">effectManager</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EffectManager</span>;
<span class="hljs-title function_">setup</span>(ins);

ins.<span class="hljs-property">destroy</span> = <span class="hljs-function">() =&gt;</span> {
    ins.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">cleanAll</span>();
}
</code></pre>
<p>当然上面这个 destroy 是被简化过了，实际上还需要阻止 ins 上所有 rxjs Subject 继续被订阅。</p>
<h3 data-id="heading-6">层次管理</h3>
<blockquote>
<p>一个状态实例A可能被另一个状态实例B持有，这是一种附属关系（如某种插件机制），实例B销毁的时候，实例A也会销毁（连带副作用清除）。</p>
</blockquote>
<p>类似组件树，状态实例也可以是一个树状的组合关系，父节点调用 destroy，子节点递归调用 destroy，完成副作用的全面清理。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> a = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'a'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
<span class="hljs-comment">//             通过调用 create 时第三个参数传入父节点</span>
<span class="hljs-keyword">const</span> b = <span class="hljs-title class_">StateModel2</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'b'</span>, { <span class="hljs-attr">other</span>: <span class="hljs-number">0</span> }, a);

a.<span class="hljs-title function_">destroy</span>() <span class="hljs-comment">// 连带触发 b.destroy() </span>
</code></pre>
<p>上面的例子已经说明了层次管理的含义，在插件化的设计中，围绕核心实体去挂载其他插件实体，可以确保核心实体销毁时插件实体也被销毁。</p>
<p>不过我想这一节可以顺便聊聊依赖注入。</p>
<h4 data-id="heading-7">基于层次管理实现依赖注入</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ContextModel 很重要，可以作为内部的一个导出</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ContextModel</span> = <span class="hljs-title function_">createModel</span>({...})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AppModel</span> = <span class="hljs-title function_">createModel</span>({...})

<span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureModel1</span> = = <span class="hljs-title function_">createModel</span>({...})
</code></pre>
<p>比如 FeatureModel1 依赖某个存储方法，通过一个 createDep 创建这个依赖。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">StoreDepToken</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'StoreDepToken'</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">StoreDepType</span> = {
   <span class="hljs-title function_">get</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span>;
   <span class="hljs-title function_">set</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureStoreDep</span> = createDependency&lt;<span class="hljs-title class_">StoreDepType</span>&gt;(<span class="hljs-title class_">StoreDepToken</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureModel1</span> = = <span class="hljs-title function_">createModel</span>({...})
</code></pre>
<p>然后通过 ContextModel 上的 setDep 来提供它。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> context = <span class="hljs-title class_">ContextModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">''</span>, {});

context.<span class="hljs-property">actions</span>.<span class="hljs-title function_">setDependency</span>(
    <span class="hljs-title class_">FeatureStoreDep</span>.<span class="hljs-title function_">provide</span>({
        <span class="hljs-title function_">get</span>(<span class="hljs-params">name</span>){
           localstorage.<span class="hljs-title function_">getItem</span>(name);
        },
        <span class="hljs-title function_">set</span>(<span class="hljs-params">name, content</span>){
            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(name, content);
        }
    })
);
</code></pre>
<p>FeatureModel 可以在 setup 中获取到，进而实现了依赖注入。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">FeatureModel1</span> = = <span class="hljs-title function_">createModel</span>({
    ...,
    <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>){
       <span class="hljs-comment">// 获取父节点中类型为 ContextModel 的 实例</span>
       <span class="hljs-keyword">const</span> context = self.<span class="hljs-title function_">getParent</span>(<span class="hljs-title class_">ContextModel</span>);
       <span class="hljs-comment">// 取出设置的依赖</span>
       <span class="hljs-keyword">const</span> storage = context.<span class="hljs-property">actions</span>.<span class="hljs-title function_">getDependency</span>(<span class="hljs-title class_">FeatureStoreDep</span>)
                           || {...} ; <span class="hljs-comment">// 注意兜底</span>
       <span class="hljs-comment">// 使用它们</span>
       storage.<span class="hljs-property">get</span>
       storage.<span class="hljs-property">set</span>
    }
})
</code></pre>
<h3 data-id="heading-8">聚合事件</h3>
<blockquote>
<p>对 “多个分散状态变更 / 副作用触发” 的统一收口与联动管理</p>
</blockquote>
<p>因为我构思的状态管理是多实例的，不同状态实例有其独有的事件流，实际开发中是有聚合事件的使用场景的。</p>
<ol>
<li>日志统一打印</li>
<li>错误事件统一处理</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title class_">StateModel</span>.<span class="hljs-property">aggregateEvent</span>.<span class="hljs-property">updates</span>
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">{key, value, preValue, instance}</span>)=&gt;</span>{

    });

<span class="hljs-title class_">StateModel</span>.<span class="hljs-property">aggregateEvent</span>.<span class="hljs-property">events</span>
    .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">(<span class="hljs-params">{eventName, data, instance}</span>)=&gt;</span>{

    })
</code></pre>
<p>写到这里，其实我还意识到，actions 也应该提供聚合事件，actions 其实是一种事件输入，其处理逻辑应该放在 setup 内部同样使用事件流订阅处理。actions 被实现为一个 proxy 并对 key 创建出一个触发输入事件的函数。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//                            定义泛型 状态、输入事件、输出事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = createModel&lt;{count,double}, {inc}, {event}&gt;({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
    <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
    <span class="hljs-attr">double</span>: params.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
  }),
  <span class="hljs-comment">// 这块就不要了</span>
  <span class="hljs-comment">// actions: (get, set, self) =&gt; {</span>
  <span class="hljs-comment">//   return {</span>
  <span class="hljs-comment">//    inc: () =&gt; set({ count: get().count + 1 }),</span>
  <span class="hljs-comment">//  },</span>
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>) {
    <span class="hljs-comment">// 改为一个 actions.inc 事件订阅</span>
    self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">addEffect</span>(
      self.<span class="hljs-property">actions</span>.<span class="hljs-property">inc</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
        self.<span class="hljs-title function_">setState</span>({
            <span class="hljs-attr">count</span>: self.<span class="hljs-property">state</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>,
        })
      })
    );
    
    <span class="hljs-comment">// 这个是 memo </span>
    self.<span class="hljs-property">effectManager</span>.<span class="hljs-title function_">addEffect</span>(
      self.<span class="hljs-property">states</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> {
        self.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">double</span>: c * <span class="hljs-number">2</span> });
      }));
  },
});

<span class="hljs-comment">// 组件/业务中使用</span>
<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });
stateIns.<span class="hljs-property">actions</span>.<span class="hljs-title function_">inc</span>();
</code></pre>
<p>这样实现有什么作用呢？当你需要对输入事件做流处理如防抖的时候，就可以直接复用到 rxjs 操作符了。</p>
<h3 data-id="heading-9">组合复用机制</h3>
<blockquote>
<p>就像 react 自定义 Hook 一样，一些纯工具能力应该能轻易的复用并组合。</p>
</blockquote>
<p>如果你觉得前面那些还看得过去，并且用起来还不错。</p>
<p><strong>对不起，到了这个地方，不破不立，我要推翻一些东西了。</strong></p>
<p>本质原因是，我想用完全不同的思路去实现它，创造另外一个东西。</p>
<p>我开始思考成本问题</p>
<ol>
<li>
<p>迁移成本，已有代码使用 react hook 实现状态管理，迁移到任何一种外部状态管理库方案时，如何保证实现的逻辑是一样的？尤其是一个大量使用了社区 hook 的自定义 hook 实现？</p>
</li>
<li>
<p>维护成本，redux 和 zustand，很难找到类似 react hook 一样的组合逻辑的能力，这大大增加了维护成本。</p>
</li>
</ol>
<p>如果你们用过 vue 的 pinia 状态管理方案，大概就知道了，pinia store 的 setup 方法是可以在里面使用 vue composition api 的。</p>
<p>虽说实现框架无关是状态管理的共识，但是实现上总是以某种方式实现的，只要实现方式不影响最终的 UI 层，那么以什么方式实现，就没那么重要了。</p>
<p>这里我脑子里蹦出一个惊人的想法，外部状态管理，就不能使用 react hook 吗？react 的铁律告诉我们， hook 只能在组件里面使用！</p>
<p>先抛开固有限制，以前面实现 computed 和 effect 的例子来讲，为什么不能是这样的？使用一个 hook 方法，每次 state 变更重新跑 useMemo 和 useEffect ，并将结果合并到 hookState 中给外部使用。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">StateModel</span> = <span class="hljs-title function_">createModel</span>({
  <span class="hljs-attr">initState</span>: <span class="hljs-function">(<span class="hljs-params">id, params</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: params.<span class="hljs-property">count</span>,
   }),
  <span class="hljs-title function_">hook</span>(<span class="hljs-params">{state, setState, self}</span>) {
      <span class="hljs-keyword">const</span> double = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>, [state.<span class="hljs-property">count</span>]);

      <span class="hljs-keyword">const</span> inc = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">s</span>=&gt;</span>({<span class="hljs-attr">count</span>: s.<span class="hljs-property">count</span>+<span class="hljs-number">1</span>}));
      }, []);
      
      <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>{
          <span class="hljs-keyword">const</span> t = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span>{
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'log count'</span>, state.<span class="hljs-property">count</span>);
          }, <span class="hljs-number">3000</span>);
          
          <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(t);
      }, [state.<span class="hljs-property">count</span>]);
      
      <span class="hljs-comment">// hook 返回，对象合并到 hookState 里面</span>
      <span class="hljs-keyword">return</span> {
          double,
          inc,
      }
  }
});

<span class="hljs-keyword">const</span> stateIns = <span class="hljs-title class_">StateModel</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'default'</span>, { <span class="hljs-attr">count</span>: <span class="hljs-number">1</span> });

<span class="hljs-keyword">await</span> stateIns.<span class="hljs-property">hookState</span>.<span class="hljs-title function_">inc</span>();
<span class="hljs-keyword">await</span> stateIns.<span class="hljs-property">hookState</span>.<span class="hljs-title function_">inc</span>(); <span class="hljs-comment">// 3s 后 log count 3</span>
stateIns.<span class="hljs-property">hookState</span>.<span class="hljs-property">double</span> <span class="hljs-comment">// 6</span>
</code></pre>
<p>有人会说：“这不能吧，hook 只能在组件树上使用，例子上这样做会不会破坏 react 的规则？”</p>
<p>我的想法是，react 组件树并不一定要产生 UI 输出，也可以单纯维护状态实例树。</p>
<p>有什么好处？<strong>好处可太大了！</strong></p>
<p>你可以使用 react-query 发起请求，它帮你维护了请求状态(data, loading, fetching, error, time)，但是这是 hook 的用法，你把请求放在 Zustand store 里面，你将失去一切！</p>
<p>但是，在一个底层以 react hook 实现的外部状态管理库中，你得到了这一切。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e64ae9e291d4a27ac308c11243cd4d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZmXlsI_pmYg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770543712&amp;x-signature=6aFKMiwH0%2Fm6x%2BzNcVLJtRt34zk%3D" alt="image.png" loading="lazy"/></p>
<p>外部状态库可以直接使用 react hook 是一种巨大的吸引力，逻辑复用直接就是 react hook 的思路。react-use、ahooks，这些都能复用上了，像呼吸一样简单。</p>
<h2 data-id="heading-10">总结：复杂 or 简洁</h2>
<p>做稍微复杂的设计，是为了在结构上承载复杂的逻辑，让转移后的复杂度变得可控、可维护。前文设计的状态实例层次管理、聚合事件、动态副作用管控等特性，看似增加了方案本身的设计复杂度，实则是为了承接业务中多实例联动、多状态协同、异步流处理等复杂场景的需求——如果为了追求方案表面的简洁，省略这些设计，复杂度并不会消失，反而会转移到业务代码中，变成分散的冗余逻辑、难以维护的硬编码，最终形成“表面简洁、内在混乱”的代码困境。这种有目的的复杂设计，核心是通过结构化的方案设计，将业务复杂度收纳在合理的框架内，兼顾扩展性与可维护性，避免复杂度无序扩散。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘火爆的ClawdBot（Moltbot/OpenClaw）]]></title>    <link>https://juejin.cn/post/7601159804490858515</link>    <guid>https://juejin.cn/post/7601159804490858515</guid>    <pubDate>2026-02-01T08:13:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601159804490858515" data-draft-id="7601075423003672612" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘火爆的ClawdBot（Moltbot/OpenClaw）"/> <meta itemprop="keywords" content="Agent,AI编程,AIGC"/> <meta itemprop="datePublished" content="2026-02-01T08:13:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序新视界"/> <meta itemprop="url" content="https://juejin.cn/user/3368559359568696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘火爆的ClawdBot（Moltbot/OpenClaw）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559359568696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序新视界
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:13:15.000Z" title="Sun Feb 01 2026 08:13:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>话说“AI一天，人间一年”，最近AI技术圈又出现一款火爆的产品ClawdBot，无论是在Github上、朋友圈以及公号文章中，都会看到它的身影。</p>
<p>有人这样评价ClawdBot，说“<strong>它是迄今为止最伟大的AI应用，相当于你24小时全天候专属AI员工。</strong> ”它的火爆甚至导致了Mac mini的大卖。</p>
<p>那么，ClawdBot到底有没有这么神奇？这篇文章带大家深度揭秘一下ClawdBot的一些相关知识。</p>
<h2 data-id="heading-0">ClawdBot名称的演变</h2>
<p>你可能在网上看到有人讲ClawdBot、有人讲Moltbot，又有人在讲OpenClaw，其实它们都是同一个开源项目，讲的都是ClawdBot。</p>
<p>在ClawdBot项目火爆后，由于它的发音与Anthropic的Claude Code等系列名称相近，涉嫌商标问题，于是改名为Moltbot（蜕壳之意），随后又改名为OpenClaw。大家知道有一回事就可以了，在后续我们使用最新的名称：<strong>OpenClaw</strong>。</p>
<h2 data-id="heading-1">OpenClaw的愿景</h2>
<p>在Github的项目说明中，OpenClaw的slogan为“<strong>Your own personal AI assistant.</strong> Any OS. Any Platform. The lobster way. 🦞”</p>
<p>关注的核心就是“你的私人AI助理”，同时记住这个龙虾🦞的图标，在大多数讲到OpenClaw的文章中你可能都会看到它。</p>
<p>OpenClaw不再仅仅是一个聊天机器人，而更像是一个拥有“手脚”的数字实体。它可以常驻在你的IM软件中，24小时在线，不仅能够聊天，还能够根据你的指令调用所在电脑的本地Shell、读写文件、控制浏览器等。</p>
<p>这里提到了“Any OS”，但目前看到广大网友的实践，对其他平台支持的并不是很友好，而且提供的大量的Tools都是针对Mac OS的，这也是导致Mac mini大卖的原因之一。</p>
<p>目前OpenClaw在Github上已经拥有130k+的Star，而且每天都以10k以上的速度增加，可见它的火爆程度。这里可以直观看一下它在Github上的增长趋势图。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2379fc8fda7147a2a971b241e8d4122a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=rGY0hVnpYYiSca8j6mf9bcazd6E%3D" alt="Star History" loading="lazy"/></p>
<p>在了解了关于OpenClaw的一些基础信息之后，我们来具体看看它提供了哪些功能，让它如此的火爆。</p>
<h2 data-id="heading-2">OpenClaw是什么？</h2>
<p>如果用一句话来总结OpenClaw的功能就是：<strong>OpenClaw本质上是一个运行在个人电脑或服务器上的个人专属的人工智能助理（AI Agent），你可以通过即时通信工具与它进行交互，让它帮你处理各类任务，实现真正意义上的干活。同时，它也拥有了“记忆”功能，能够记住你的偏好和历史对话，更懂你。</strong></p>
<p>这里我们重点关注的是基于个人电脑或服务器的系统来实现真正意义的干活。像我们平时使用ChatGPT或Claude，大多数情况下是在“聊天”，它们只是在帮忙“出主意”，没办法真正意义上在操作系统上进行命令的执行。</p>
<p>而OpenClaw所迈出的重要一步是：当你将个人电脑或服务器的操作权限授予它之后，它可以在操作系统上执行你的命令，可以真正的替你干活了。</p>
<p>当然，在实现这一步操作中，它相当于把Claude Code变成了可视化的桌面，把社交软件作为远程指挥的工具，拓宽了人与执行任务的电脑（或服务器）的物理距离。初步实现了一个可持续运行，可执行任务的个人AI智能体。</p>
<h2 data-id="heading-3">OpenClaw的震撼点</h2>
<p>通过观察OpenClaw的具体案例，其实目前效果并不完美，还有许多坑，但它让AI Agent往前走了一步，具有以下的震撼点：</p>
<p><strong>第一，它可以控制你的电脑，它能“动手”，而不是只“出主意”。</strong> 只要你给OpenClaw充分授权，它便可以控制你的电脑，像人一样操作你的电脑。</p>
<p>OpenClaw迈出了这一步，但目前并不完美。在真实使用时，还是需要通过虚拟机、独立的服务器或一台独立的电脑、或独立的项目环境，或有限的操作权限来进行安全把控。</p>
<p>否则，一旦OpenClaw乱来（模型和Agent的幻觉问题等），将会面临不可预估的损失。这也是购买Mac mini的原因之一，它提供了一个相对独立的环境。</p>
<p><strong>第二，拥有长期记忆，不是一次性对话。</strong> OpenClaw内置了一套长期记忆系统，你说过的话，做过的事，都会被记录、总结、提取出来，并存入长期记忆当中。当它更了解你时，它也就是你的个人专属助理了。</p>
<p><strong>第三，可通过聊天工具来“遥控”交互。</strong> 当集成对应的聊天工具之后，你通过聊天工具给它发消息，便可对OpenClaw下达任务命令，这样便实现了远程指挥，全天24小时待命的效果。但这里特别提醒，OpenClaw在使用时，安全隐患非常大。</p>
<p><strong>第四，OpenClaw并不只是“能干活”，同时它几乎是100%用AI写出来的。</strong> 不会写代码的人，也能直接提交PR，这也算是AI编程的一个新的真实案例的突破。</p>
<p>这些特性汇总起来意味着：<strong>一台永不关机的电脑，里面住着一位能够记住你，能够自己上网，能够自己动手，能够随时被你指挥，还能够自我迭代更新的AI员工</strong>。</p>
<p>目前的OpenClaw并不完美，但它的出现就像早期的智能手机的越狱插件、NAS（发烧友玩的家庭服务器）、Kubernetes（技术圈的新玩意）、Docker等软件，随着逐步的发展迭代，最终会成为日常的标准。</p>
<h2 data-id="heading-4">OpenClaw的架构实现</h2>
<p>在架构设计上，OpenClaw采用了非常巧妙的Gateway（网关）模式，从而实现了指令消息、模型以及指令执行的解耦。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09aec786a0e542fa9df7d9436ca1c33b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=EjA5B3%2BTq2Cn85G%2FG%2FZtkA9kW84%3D" alt="架构实现" loading="lazy"/></p>
<p>基本的全流程实现逻辑为：</p>
<p>用户可通过WhatsApp或Telegram等通信软件发送消息（指令），消息传到电脑上的Gateway（网关），网关也是整个系统的控制中心，是连接指令和电脑能力的桥梁。</p>
<p>网关通过LLM API（比如Claude或任何模型的API）将消息分发给LLM（大脑）或Skills（手脚），从而实现在电脑上执行相关命令（或任务）。</p>
<p>在这个过程中，Gateway就像是智能体的“小脑”，负责维持各大IM平台（Channels）的长连接、会话保持、任务分发等功能。</p>
<p>而Skills和Tools赋予了AI“肉身”，Skills也是此架构中的一等公民，通过定义明确的接口，AI可以调用本地工具，比如执行具有毁灭性的操作“<code>rm -rf</code>”、访问本地文件系统、控制浏览器抓取信息等。</p>
<h2 data-id="heading-5">OpenClaw的功能案例</h2>
<p>目前OpenClaw已经能够实现基础的安装软件、执行脚本、管理文件、监控网页、发邮件、社交媒体发消息等功能。理论上，只要手动能够操作的，有对应的接口或权限，OpenClaw都可以搞定。</p>
<p>这里在分享一个网络上所说的“汽车购买自动谈判”的案例，本质上没有那么神奇，只是一些列功能的组合。</p>
<p>案例的执行分以下几个阶段：</p>
<ul>
<li>价格调研：提示OpenClaw搜索 Reddit（r/hyundaipalisade）查找马萨诸塞州的典型价格，发现大多数人支付约 $58,000。</li>
<li>车辆定位：使用在线库存工具搜索波士顿50英里内符合特定颜色组合的经销商；</li>
<li>初始联系：OpenClaw自动填写经销商联系表单，预填用户手机号；</li>
<li>自动谈判：设置cron任务，每隔几分钟检查邮件中来自经销商的消息。谈判最低销售价格，不谈判换购或利率。在回复任何重要内容前提示我。</li>
</ul>
<p>OpenClaw让经销商互相竞争，发送报价PDF。最终获得<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo separator="true">,</mo><mn>200</mn><mtext>经销商折扣，价格降至</mtext></mrow><annotation encoding="application/x-tex">4,200经销商折扣，价格降至</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">200</span><span class="mord cjk_fallback">经销商折扣，价格降至</span></span></span></span></span>56,000——低于目标价格。</p>
<p>当然，还有利用智能家居Skills来控制灯光、温度、空气净化器的案例等案例，感兴趣的朋友可以网络上搜索一下。</p>
<h4 data-id="heading-6">为什么要用Mac mini？</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcd3764bd35c4a26b486fa4517e8a536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=XdXYCkqd%2Fw8MK5kK61mj%2F1TwkfE%3D" alt="Mac mini" loading="lazy"/></p>
<p>最后，我们再聊聊为什么要用Mac mini？</p>
<p>从官方的介绍来说，理论上“Any OS”都是可以的，只不过使用Mac mini更加适配OpenClaw的使用场景。</p>
<p>原因可能有这几点：</p>
<p>第一，社交软件的整合更加方便。无论是希望AI助手能够管理社交软件，还是通过社交软件来下达命令，在Mac OS系统下都更加容易实现。</p>
<p>像WhatsApp和Telegram等都有开发的API，但它们在美国不如 iMessage（苹果短信）普及。而苹果严密封锁了 iMessage协议，只允许在苹果设备上运行。如果你想让你的 AI 助手能处理你的短信（比如“帮我查一下昨天的购物清单”），OpenClaw必须跑在一台登录了Apple ID的Mac上。</p>
<p>第二，Mac系统自带强大的自动化工具（Shortcuts快捷指令、AppleScript）这些都比Linux和Windows要强。</p>
<p>第三，OpenClaw针对Mac系统，自带了许多适配Mac OS的Skills，可以拿来即用。</p>
<p>另外，购买Mac mini也是处于在日常办公的电脑上的安全性问题，需要买一台独立的设备，而它恰好适合。</p>
<h2 data-id="heading-7">关于OpenClaw的创始人Peter</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a78aa3912a5d4ed6b14cf313e60a27c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5paw6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770538397&amp;x-signature=7S6y1EWrwKtlPd3zxvalgI8PJlw%3D" alt="OpenClaw的创始人" loading="lazy"/></p>
<p>OpenClaw的开源作者为Peter Steinberger，他的个人博客也有相关的文章，感兴趣的朋友可以去关注一下：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsteipete.me%2F" target="_blank" title="https://steipete.me/" ref="nofollow noopener noreferrer">steipete.me/</a>。</p>
<p>如果你去看他的Github（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsteipete" target="_blank" title="https://github.com/steipete" ref="nofollow noopener noreferrer">github.com/steipete</a>），会发现他同时开发了多个项目，而且代码的提交量非常疯狂，日均上万行。</p>
<p>他在采访中曾说：<strong>我一天写的代码，可能比我以前70人公司一个月写得都多。在这个新世界里，构建东西的速度已经完全变了。</strong></p>
<p>这样的代码量，手敲代码根本无法完成。Peter在采访中也坦言“<strong>它是百分之百用 AI 写出来的，里面没有一行代码是我亲手敲的。</strong> ”</p>
<p>简单推测作者的编码过程：</p>
<ul>
<li>设定任务目标（TODO List），一部分来自Github上的PR；</li>
<li>利用AI进行评估、拆分任务；</li>
<li>利用类似Claude Code等平台并行执行任务；</li>
<li>完成任务之后，代码合并到同一分支，利用AI进行Code Review；</li>
<li>最后，Merge、提交；</li>
</ul>
<p>目前OpenClaw的具有完整的电脑访问能力，也懂Github的工作方式。</p>
<h2 data-id="heading-8">展望一下</h2>
<p>再次想说的是，OpenClaw目前并不完美，但它代表了个人AI助理领域的重大突破，提供了一种可能性。它通过本地有先、自托管架构，将原本纯聊天给建议的LLM能力与真实的执行能力进行了整合。</p>
<p>在架构分层上，通过Gateway-&gt;Agent-&gt; Skills -&gt; Channels/Nodes模式，实现了清晰的关注点分离，即保持了开放标准，又实现了与Claude Code、Cursor等工具的生态兼容。</p>
<p>当然，目前在安全方面，还存在很大的挑战，最好在沙盒环境下运行。另外，在token的消耗上一般人吃不消，原本通过人工操作非常简单的事情，目前还需要大量的token消耗，结果还存在一定的稳定性问题。</p>
<p>但无论怎样，OpenClaw提供了一个AI与现实世界相结合的完整案例参考，也是一步大胆的尝试。</p>
<p>最后，用OpenClaw发起者的一句话来作为本文的结束语，这句话值得我们深思：<strong>从AI出现之后，我其实已经没那么在意“用什么语言”了。语言本身的重要性在下降，真正重要的是生态</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战]]></title>    <link>https://juejin.cn/post/7601103779392946239</link>    <guid>https://juejin.cn/post/7601103779392946239</guid>    <pubDate>2026-02-01T08:26:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601103779392946239" data-draft-id="7601076694105276452" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-02-01T08:26:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="寒璃"/> <meta itemprop="url" content="https://juejin.cn/user/2559318802827933"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318802827933/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    寒璃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:26:51.000Z" title="Sun Feb 01 2026 08:26:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">鸿蒙开发手记（一）：从“傻瓜式”环境配置到首个 TodoList 实战</h2>
<p>在上一篇中，我分享了为什么在 2026 年选择从 Cocos 游戏开发转战 HarmonyOS NEXT。今天，我们直接进入实战：聊聊环境搭建，并用 ArkTS 亲手撸一个 TodoList。</p>
<h3 data-id="heading-1">1. 环境配置：集成度极高的“傻瓜式”体验</h3>
<p>对于习惯了在 VS Code 里折腾各种插件、Webpack 配置和浏览器调试的前端开发者来说，DevEco Studio 的初体验可以用 <strong>“省心”</strong> 来形容。</p>
<ul>
<li><strong>全家桶式的集成：</strong> 你不需要再去纠结模拟器怎么装、预览器怎么配。DevEco Studio 几乎把所有工具都集成在了一个安装包里。</li>
<li><strong>Previewer 与模拟器：</strong> 它的预览器响应速度很快，基本做到了代码改动即刻生效，这对于我们这种追求“所见即所得”的开发者非常友好。</li>
<li><strong>内置 AI 的辅助：</strong> 虽然它内置的 AI 功能目前还比不上 Cursor 那样惊艳，但在处理一些基础的代码补全和 API 查询时，已经能节省不少翻文档的时间。</li>
</ul>
<p>但是需要注意的是，在DevEco Studio中预览我们项目，有3种方式：</p>
<ol>
<li>
<p>Previewer： Previewer是一种集成在DevEco 中的预览方式，它具备热更新的能力，当我们的代码修改后，previewer能够实时的做出改变</p>
<p>但是它也具有一些不足的地方：比如某些API不支持previewer环境，这一点十分的重要，所以一定在调试代码的时候一定要注意API的适用环境。</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f26fefe68be0424c88f1738e53108289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=Y5QaWWndGD1PEg8gssyprpoFlG4%3D" alt="image-20260201153159100" loading="lazy"/></p>
<ol start="2">
<li>模拟器：模拟器是在电脑上安装一个模拟器，模拟器是一个单独的APP，相当于在电脑上运行了一个模拟Harmony OS的APP，在使用模拟器之前，我们需要先在设备管理器中安装一个模拟器，然后运行这个模拟器，然后我们就可以运行的时候选择该模拟器作为运行环境了。</li>
</ol>
<div>
    <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5841789c1024e8fae6cda4eb96335b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=JiUIJ%2FIHb7Q1LWfB7BFI1KqAMgc%3D" loading="lazy"/>
    <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba6fd07e38784cde825e898a2dec6063~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=Pydo1C5TLsurTiIPqMt9i14TxP0%3D" loading="lazy"/>
</div>
<ol start="3">
<li>真机调试：顾名思义，使用真机进行代码调试，对于一些特殊的场景只能使用真机调试的方式，比如意图开发场景中目前只支持真机调试。</li>
</ol>
<hr/>
<h3 data-id="heading-2">2. 核心思维转换：从命令式到 MVVM</h3>
<p>作为一个有着 5 年小游戏开发经验的人，我习惯了手动的去设置不同UI的值，但在 ArkUI 中，这种思维需要发生 180 度的转变。</p>
<h4 data-id="heading-3">数据驱动 UI（MVVM）</h4>
<p>在 ArkTS 中，你只需要关注<strong>数据（State）</strong> 。当你通过 <code>@State</code> 定义了一个变量，UI 就会像影子的主人一样，主人动（数据变），影子就跟着动（UI 刷新）。这一点与前端的Vue 框架很类似。</p>
<h4 data-id="heading-4">前端开发者的“撞墙”点</h4>
<p>虽然 ArkTS 看起来和 TypeScript 一模一样，但在父子组件通信上，它有几个非常硬核的“脾气”需要你适应：</p>
<ol start="0">
<li><strong>禁止传递函数：</strong> 在 React 或 Vue 中，父组件向子组件传递一个回调函数是常规操作。但在 ArkUI 里，<strong>父组件不能直接向子组件传递函数类型的值</strong>。这需要我们习惯使用 <code>@Link</code> 或自定义事件来处理交互。</li>
<li><strong>传值还是传址？</strong> 这是一个坑。参数传递方式的不同（值传递 vs 引用传递）会直接决定 UI 能否感应到数据的变化。比如你修改了对象内部的一个属性，如果没处理好引用关系，UI 可能会纹丝不动。</li>
</ol>
<hr/>
<h3 data-id="heading-5">3. 实战：手写一个TodoList</h3>
<p>我们来写一个最基础的 TodoList。虽然我以前不爱写 CSS，但 ArkUI 的链式调用确实让布局变得像写逻辑一样清晰。在编写这个例子的时候也让我来讲解一些ArkTS中的语法。</p>
<p>组件的定义，在ArkTS中，如果要定义一个组件需要使用 <code>struct</code> 关键字来定义，而不是继续使用<code>class</code> ，除了使用 <code>struct</code>以外，还需要使用 <code>@Component</code> 装饰器来修饰它。一般来说我们会把跟UI无关的逻辑封装在class中，而struct 则专门负责UI的逻辑。</p>
<h4 data-id="heading-6">数据绑定</h4>
<p>之前说了ArkTS是一种基于MVVM模型的双向数据绑定。需要UI响应的数据需要使用 <code>@State</code>装饰器修饰，如下面这个简单的例子</p>
<pre><code class="hljs language-kotlin" lang="kotlin">​
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct Index {
  <span class="hljs-meta">@State</span> message: string = <span class="hljs-string">'Hello World'</span>;
​
  <span class="hljs-keyword">private</span> flag: boolean = <span class="hljs-literal">true</span>;
​
  build() {
    Row() {
      Column() {
        Text(<span class="hljs-keyword">this</span>.message)
          .fontSize($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))
          .fontWeight(FontWeight.Bold)
          .onClick(() =&gt; {
​
            <span class="hljs-keyword">this</span>.message = <span class="hljs-keyword">this</span>.flag ? <span class="hljs-string">'Welcome'</span> : <span class="hljs-string">"Hello World"</span>;
            <span class="hljs-keyword">this</span>.flag = !<span class="hljs-keyword">this</span>.flag;
          })
      }
      .width(<span class="hljs-string">'100%'</span>)
    }
    .height(<span class="hljs-string">'100%'</span>)
  }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2635675722764c35923cf26c307ffcc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=VsgpVixIcQudneslsLEedoGLI5Y%3D" alt="iShot_2026-02-01_15.42.29" loading="lazy"/></p>
<p>可以看到这种数据绑定的方式十分的方便。</p>
<p>我现在要展示一种比较反前端直觉的案例，比如父子组件传递函数的情况。</p>
<p>在ArkTS中，不允许这样的做法！除了一种情况例外，父子之间传递函数，只能传递<code>@Builder</code>装饰器修饰的函数！</p>
<p>我们来看这样一个例子。在父组件中定义了一个状态msg，然后向子组件中传递一个修改<code>msg</code> 值的函数，让子组件的UI来改变这个值。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Child</span> {
  <span class="hljs-meta">@Prop</span>
  <span class="hljs-attr">updateMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
​
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update parent message'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateMessage</span>(<span class="hljs-string">'from child msg'</span>);
    })
  }
}
​
<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">updateMessage</span>: <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = msg;
  }
  <span class="hljs-keyword">private</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;
​
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
          .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))
          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
​
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> ? <span class="hljs-string">'Welcome'</span> : <span class="hljs-string">"Hello World"</span>;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;
          })
        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">updateMessage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateMessage</span> })
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}
​
</code></pre>
<p>编辑页面中并没有提示语法错误，但是一旦运行，编译器还是报错了。以下是报错信息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Error</span> <span class="hljs-attr">message</span>:<span class="hljs-meta">@Component</span> <span class="hljs-string">'@Component '</span><span class="hljs-title class_">Child</span><span class="hljs-string">'[8]'</span>: <span class="hljs-title class_">Illegal</span> variable value error <span class="hljs-keyword">with</span> decorated variable <span class="hljs-meta">@Prop</span> <span class="hljs-string">'updateMessage'</span>: failed <span class="hljs-attr">validation</span>: <span class="hljs-string">'undefined, null, number, boolean, string, or Object but not function, not V2 @ObservedV2 / @Trace class, and makeObserved return value either, attempt to assign value type: '</span><span class="hljs-keyword">function</span><span class="hljs-string">', value: '</span><span class="hljs-literal">undefined</span><span class="hljs-string">'!
</span></code></pre>
<p>大意就是不支持传递函数类型！那么应该如何修改呢？在ArkTS中，允许子组件直接修改父组件的状态！我们需要在子组件中把父组件传递的属性使用 <code>@Link</code>装饰器修饰，这表示这是一个父组件传递进来的状态，并且在子组件中修改它时，父组件中的值也会发生相应的变化！</p>
<p>我们把updateMessage 变为一个基本数据类型，并用 <code>@Link</code>装饰器修饰，然后在父组件中传递父组件的值。</p>
<pre><code class="hljs language-scss" lang="scss">​
<span class="hljs-keyword">@Component</span>
struct Child {
  <span class="hljs-keyword">@Link</span>
  <span class="hljs-attribute">parentMsg</span>: string;
  
  
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-selector-tag">Button</span>('update parent message')<span class="hljs-selector-class">.onClick</span>(() =&gt; {
      this<span class="hljs-selector-class">.parentMsg</span> = 'from Child Message';
    })
  }
}
  
  
<span class="hljs-keyword">@Entry</span>
<span class="hljs-keyword">@Component</span>
struct Index {
  <span class="hljs-built_in">build</span>() {
    ...
    <span class="hljs-built_in">Child</span>({ parentMsg: this.message })
  } 
}
</code></pre>
<p>运行效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89144312d697457cb99f5aac862262d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a-S55KD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539220&amp;x-signature=Xl2BodH6P3yOdyNypMBZr0jgvi4%3D" alt="iShot_2026-02-01_15.58.24" loading="lazy"/></p>
<p>有了以上的基础知识，我们可以开始开发一个基本的TodoList。</p>
<p>下面通过一个 TodoList 案例来展示 ArkTS 的核心语法。在鸿蒙中，我们推荐将数据逻辑封装在 <code>class</code> 中，而 UI 结构定义在 <code>struct</code> 内部。</p>
<h4 data-id="heading-7">为什么需要 <code>@Observed</code> 和 <code>@ObjectLink</code>？</h4>
<p>在开发 TodoList 这种包含对象数组的列表时，简单的 <code>@State</code> 是不够的。</p>
<ol>
<li><strong><code>@State</code> 的局限：</strong> 它只能观察到变量本身的变化。如果你修改了数组中某个对象成员的内部属性（例如 <code>task.isCompleted = true</code>），由于数组的引用地址没变，UI 不会触发刷新。</li>
<li><strong><code>@Observed</code>：</strong> 装饰在类定义上，使类成员的属性变化可以被追踪。</li>
<li><strong><code>@ObjectLink</code>：</strong> 装饰在子组件的变量上，用来接收父组件传来的 <code>Observed</code> 对象。这样子组件修改对象属性时，父组件对应的 UI 也会同步更新。</li>
</ol>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 定义数据模型，使用 @Observed 确保属性可被追踪</span>
<span class="hljs-keyword">@Observed</span>
class Task {
  id: number;
  <span class="hljs-attribute">content</span>: string = <span class="hljs-string">""</span>;
  isCompleted: boolean = false;
​
  <span class="hljs-built_in">constructor</span>(id: number, content: string, isCompleted: boolean = false) {
    this<span class="hljs-selector-class">.id</span> = id;
    this<span class="hljs-selector-class">.content</span> = <span class="hljs-attribute">content</span>;
    this<span class="hljs-selector-class">.isCompleted</span> = isCompleted;
  }
}
​
<span class="hljs-comment">// 2. 抽离列表项子组件，使用 @ObjectLink 同步状态</span>
<span class="hljs-keyword">@Component</span>
struct TaskView {
  <span class="hljs-keyword">@ObjectLink</span> <span class="hljs-attribute">task</span>: Task;
​
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-attribute">Flex</span>({ justifyContent: FlexAlign.SpaceAround }) {
      Text(this.task.id.toString())
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">333333</span>')
        <span class="hljs-selector-class">.margin</span>({ right: <span class="hljs-number">10</span> })
      
      Text(this.task.content)
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.fontColor</span>('#<span class="hljs-number">333333</span>')
        <span class="hljs-selector-class">.margin</span>({ right: <span class="hljs-number">10</span> })
        <span class="hljs-selector-class">.decoration</span>({
          type: this.task.isCompleted ? TextDecorationType.LineThrough : TextDecorationType.None
        })
        <span class="hljs-selector-class">.layoutWeight</span>(<span class="hljs-number">1</span>)
​
      Text(this.task.isCompleted ? "已完成" : "未完成")
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.fontColor</span>(this.task.isCompleted ? '#<span class="hljs-number">00</span>AA00' : '#FF0000')
        <span class="hljs-selector-class">.onClick</span>(() =&gt; {
          <span class="hljs-comment">// 修改状态，UI 自动响应</span>
          this<span class="hljs-selector-class">.task</span><span class="hljs-selector-class">.isCompleted</span> = !this<span class="hljs-selector-class">.task</span><span class="hljs-selector-class">.isCompleted</span>
        })
    }
    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.padding</span>(<span class="hljs-number">10</span>)
    <span class="hljs-selector-class">.backgroundColor</span>('#FFFFFF')
    <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">8</span>)
    <span class="hljs-selector-class">.margin</span>({ bottom: <span class="hljs-number">10</span> })
  }
}
​
<span class="hljs-comment">// 3. 主页面容器</span>
<span class="hljs-keyword">@Component</span>
export struct TodoList {
  <span class="hljs-keyword">@State</span> <span class="hljs-attribute">list</span>: Task[] = [
    new Task(<span class="hljs-number">1</span>, <span class="hljs-string">"熟悉项目结构"</span>),
    new Task(<span class="hljs-number">2</span>, <span class="hljs-string">"运行模拟器"</span>, true),
    new Task(<span class="hljs-number">3</span>, <span class="hljs-string">"编写第一个组件"</span>)
  ];
​
  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">Column</span>() {
      Text("待办清单")
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">24</span>)
        <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)
        <span class="hljs-selector-class">.margin</span>(<span class="hljs-number">20</span>)
​
      <span class="hljs-built_in">ForEach</span>(this.list, (item: Task) =&gt; {
        <span class="hljs-built_in">TaskView</span>({ task: item });
      }, (item: Task) =&gt; item<span class="hljs-selector-class">.id</span><span class="hljs-selector-class">.toString</span>());
    }
    <span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.height</span>('<span class="hljs-number">100%</span>')
    <span class="hljs-selector-class">.backgroundColor</span>('#F1F3F5')
  }
}
</code></pre>
<h3 data-id="heading-8">4. 总结</h3>
<p>通过 TodoList 的练习，可以发现鸿蒙开发的门槛并不在于语言，而在于对 <strong>Stage 模型</strong>和<strong>状态装饰器</strong>的理解。</p>
<p>对于前端开发者，ArkUI 的组件化思维是互通的，但需要额外关注父子组件间关于函数传递的限制。对于游戏开发者，从手动更新 UI 转向声明式的数据驱动，能够显著减少在界面维护上的逻辑代码量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[亿级洪流中的架构芭蕾：社交网络首页时间线的设计艺术]]></title>    <link>https://juejin.cn/post/7601757036485902346</link>    <guid>https://juejin.cn/post/7601757036485902346</guid>    <pubDate>2026-02-01T07:52:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036485902346" data-draft-id="7601757036485754890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="亿级洪流中的架构芭蕾：社交网络首页时间线的设计艺术"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-02-01T07:52:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一个骇客"/> <meta itemprop="url" content="https://juejin.cn/user/644760908336608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            亿级洪流中的架构芭蕾：社交网络首页时间线的设计艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/644760908336608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一个骇客
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:52:19.000Z" title="Sun Feb 01 2026 07:52:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想象一下，你在Y——一个拥有<strong>10亿月活</strong>的国民级社交平台——上刚刚点击了发布按钮。你可能没有意识到，此刻的平台，<strong>每天正吞吐着近8亿条新鲜动态</strong>，平均每秒就有近万条内容试图争夺眼球。若遇到"全民盛事"或"顶流空降"，流量峰值<strong>瞬间冲破每秒30万条</strong>也绝非天方夜谭。</p>
<p>这早已不是普通的信息展示，而是一场需要极高精度编排的<strong>数据风暴</strong>。今天，让我们深入幕后，探究那个让你流连忘返的"首页时间线"，如何在如此恐怖的规模下，依然保持令人愉悦的流畅。</p>
<h3 data-id="heading-0">第一幕：朴素的开端与数据结构</h3>
<p>最初的想法总是直接而单纯：每次用户下拉刷新，客户端就去数据库询问："我关心的人都更新了什么？"</p>
<p>首先，我们来看支撑这一功能的核心数据模型设计：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">erDiagram
    USER ||--o{ POST : "publishes"
    USER ||--o{ FOLLOW_RELATIONSHIP : "follows as follower"
    USER ||--o{ FOLLOW_RELATIONSHIP : "is followed as followee"
    
    POST {
        bigint id PK
        bigint author_id FK
        text content
        timestamp created_at
    }
    
    USER {
        bigint id PK
        varchar name
        varchar avatar_url
    }
    
    FOLLOW_RELATIONSHIP {
        bigint follower_id FK
        bigint followee_id FK
    }
</code></pre>
<p>基于这个模型，当请求你的首页时，系统会执行类似下面的查询：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> post.<span class="hljs-operator">*</span>, user.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> post
  <span class="hljs-keyword">JOIN</span> follow_relationship <span class="hljs-keyword">ON</span> post.author_id <span class="hljs-operator">=</span> follow_relationship.followee_id
  <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">ON</span> post.author_id <span class="hljs-operator">=</span> user.id
  <span class="hljs-keyword">WHERE</span> follow_relationship.follower_id <span class="hljs-operator">=</span> current_user_id
  <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> post.created_at <span class="hljs-keyword">DESC</span>
  LIMIT <span class="hljs-number">1000</span>
</code></pre>
<p><strong>逻辑清晰易懂</strong>：找到你关注的人，取出他们的动态，按时间排序，呈现最新的1000条。</p>
<p>但让我们计算一下现实的残酷：
假设有1亿用户同时在线，平均每人每2秒请求一次。这就是<strong>每秒5000万次查询</strong>。更可怕的是，如果平均每人关注了500个账号，数据库为了准备你的一次刷新，需要在500份数据中进行关联、排序与合并…… 折算下来，相当于每秒要进行 <strong>超过250亿次</strong> 的底层数据操作。</p>
<p><strong>数据库的哀鸣</strong>："这压力，我承受不来。" 💥</p>
<p>这种简单的<strong>拉取（Pull）</strong> 模式，在面对国民级数据洪流时，如同企图用一根水管疏浚长江，从设计上就注定了失败。</p>
<h3 data-id="heading-1">第二幕：范式转换：从"拉取"到"推送"</h3>
<p>工程师们意识到问题的关键：为何要让海量请求反复"拉取"重复数据？何不主动"推送"一次？</p>
<p>于是，核心模式 <strong>扇出（Fan-out）</strong> 被引入。</p>
<p>流程被彻底重构：</p>
<ol>
<li><strong>内容发布</strong>：你在Y发布一条动态。</li>
<li><strong>粉丝列表查询</strong>：系统立刻检索你所有的粉丝（假设平均500人）。</li>
<li><strong>异步投递</strong>：系统将这则新内容，异步"写入"到这500位粉丝各自预置的 <strong>个人时间线缓存</strong> 中。</li>
</ol>
<p>这个"缓存"，在架构上被称为<strong>物化视图（Materialized View）</strong>。它遵循 <strong>以空间和写入复杂度换取读取性能</strong> 的黄金法则。读取首页变得极快——仅是从专属缓存中顺序读取。但发布动态的成本变高，从"一次写入"变为"500次写入"。</p>
<p>计算新方案的成本：假设每秒产生1.2万条新动态，平均扇出系数为500，则每秒需完成 <strong>600万次</strong> 缓存写入。这个数字依然巨大，但相比之前每秒<strong>250亿次</strong>的关联查询，已从"理论灾难"降维为"可解决的工程挑战"。</p>
<p><strong>系统逻辑</strong>："从被动查询（Pull）到主动分发（Push），这是本质的效率飞跃。"</p>
<h3 data-id="heading-2">第三幕：应对极端：长尾与巨头的挑战</h3>
<p>真实的社交图谱遵循幂律分布。这套"推送系统"面临两类极端场景：</p>
<ol>
<li>
<p><strong>重度关注者</strong>：用户A关注了上万个账号。每秒涌入其个人缓存的数据量极大。工程洞察发现：此类用户存在严重的"信息过载"，实际消费率很低。因此系统引入 <strong>采样降级（Sampling）</strong> ：对其时间线进行智能采样，仅保证部分核心内容的投递。用户体验："信息流似乎更清爽了？"（系统：成功卸载冗余负载🙃）</p>
</li>
<li>
<p><strong>现象级创作者</strong>：例如一位坐拥<strong>2亿粉丝</strong>的超级明星发布动态。同步扇出任务列表瞬间爆炸：需要执行<strong>2亿次</strong>写入。若按常规流程，整个分发链路会立刻阻塞。</p>
</li>
</ol>
<p>对此，任何形式的丢弃都是不可接受的。工程策略是：<strong>为巨头启用专用通道</strong>。</p>
<ul>
<li><strong>热点分离</strong>：明星的动态不进入常规的实时扇出流水线，而是被标记并写入一个<strong>独立的热点内容池</strong>。</li>
<li><strong>读取时合并</strong>：当普通用户读取其物化时间线时，系统在返回结果前，实时地从热点池中查询并合并其关注的明星最新动态。这巧妙地将不可承受的<strong>同步写入洪峰</strong>，转化为了可被缓存和水平扩展的<strong>读取时查询压力</strong>。</li>
</ul>
<p><strong>系统日志</strong>："服务一个巨头，其数据波动堪比一场数字海啸。但正是他们，定义了平台的生态高度。"</p>
<h3 data-id="heading-3">总结：在性能与成本的钢丝上优雅行走</h3>
<p>Y社交平台首页时间线的设计演进，是一场典型的大规模系统<strong>架构权衡实践</strong>：</p>
<ul>
<li><strong>核心策略转换</strong>：从简单但不可行的<strong>拉取（Pull）</strong> 模型，果断转向了基于<strong>扇出（Fan-out）</strong> 的<strong>推送（Push）</strong> 架构，这是应对海量并发读取的根本性方案。</li>
<li><strong>关键牺牲与收获</strong>：引入<strong>物化视图（Materialized View）</strong>，明智地<strong>以更高的写入成本和存储空间为代价</strong>，换取了读取端的响应速度，实现了用户体验的质的飞跃。</li>
<li><strong>应对现实复杂性</strong>：没有一种架构能通吃所有场景。通过 <strong>读写分离</strong> 将明星动态导入<strong>热点内容池</strong>，以及对超重度用户时间线进行<strong>采样降级</strong>，系统巧妙地避开了幂律分布带来的“长尾”与“巨头”陷阱，确保了整体的稳定性与资源利用率。</li>
</ul>
<p>最终，这套组合方案展示了一个核心工程哲学：<strong>优秀的架构不是寻找“完美”的解，而是在诸多约束下（性能、成本、复杂度）寻找到那个“恰到好处”的平衡点</strong>。当你在社交媒体上流畅地刷新信息流时，你所体验到的正是这种精密权衡后的结果。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python基本数据类型和打印指南]]></title>    <link>https://juejin.cn/post/7601046076944334863</link>    <guid>https://juejin.cn/post/7601046076944334863</guid>    <pubDate>2026-02-01T06:29:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601046076944334863" data-draft-id="7601077290681925684" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python基本数据类型和打印指南"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-01T06:29:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xq9527"/> <meta itemprop="url" content="https://juejin.cn/user/1239904848712184"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python基本数据类型和打印指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904848712184/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xq9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:29:03.000Z" title="Sun Feb 01 2026 06:29:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python 基本数据类型和打印指南</h2>
<h3 data-id="heading-1">目录</h3>
<ol>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E6%25A6%2582%25E8%25BF%25B0" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E6%A6%82%E8%BF%B0" ref="nofollow noopener noreferrer">概述</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%259F%25BA%25E6%259C%25AC%25E6%2595%25B0%25E6%258D%25AE%25E7%25B1%25BB%25E5%259E%258B" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" ref="nofollow noopener noreferrer">基本数据类型</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%258F%2598%25E9%2587%258F%25E5%2591%25BD%25E5%2590%258D%25E8%25A7%2584%25E5%2588%2599" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99" ref="nofollow noopener noreferrer">变量命名规则</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E6%2589%2593%25E5%258D%25B0%25E8%25BE%2593%25E5%2587%25BA-print" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E6%89%93%E5%8D%B0%E8%BE%93%E5%87%BA-print" ref="nofollow noopener noreferrer">打印输出 (print)</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E7%2594%25A8%25E6%2588%25B7%25E8%25BE%2593%25E5%2585%25A5-input" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5-input" ref="nofollow noopener noreferrer">用户输入 (input)</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%25E6%25A0%25BC%25E5%25BC%258F%25E5%258C%2596" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96" ref="nofollow noopener noreferrer">字符串格式化</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E7%25B1%25BB%25E5%259E%258B%25E8%25BD%25AC%25E6%258D%25A2" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2" ref="nofollow noopener noreferrer">类型转换</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E6%259D%25A1%25E4%25BB%25B6%25E8%25AF%25AD%25E5%258F%25A5" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5" ref="nofollow noopener noreferrer">条件语句</a></li>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A63342%2FmarkdownPreview%2F1473041073%2Fmarkdown-preview-index-704308761.html%3F_ijt%3Dupvsp4f32qdp5s5suknfgpkl1g%23%25E5%25AE%259E%25E7%2594%25A8%25E7%25A4%25BA%25E4%25BE%258B" target="_blank" title="http://localhost:63342/markdownPreview/1473041073/markdown-preview-index-704308761.html?_ijt=upvsp4f32qdp5s5suknfgpkl1g#%E5%AE%9E%E7%94%A8%E7%A4%BA%E4%BE%8B" ref="nofollow noopener noreferrer">实用示例</a></li>
</ol>
<h3 data-id="heading-2">概述</h3>
<p>Python是一种简洁易读的编程语言，拥有丰富的内置数据类型。掌握基本数据类型和打印输出是学习Python的第一步，也是编程的基础技能。</p>
<h3 data-id="heading-3">基本数据类型</h3>
<h4 data-id="heading-4">1. 数值类型</h4>
<h5 data-id="heading-5">整数 (int)</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 正整数</span>
<span class="hljs-attr">x</span> = <span class="hljs-number">10</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">18</span>
<span class="hljs-attr">myNum</span> = <span class="hljs-number">123</span>
<span class="hljs-attr">myNumber</span> = <span class="hljs-number">456</span>
<span class="hljs-attr">_Number</span> = <span class="hljs-number">789</span>

<span class="hljs-comment"># 负整数</span>
<span class="hljs-attr">negative_num</span> = -<span class="hljs-number">5</span>

<span class="hljs-comment"># 大整数（Python支持任意精度）</span>
<span class="hljs-attr">big_number</span> = <span class="hljs-number">123456789012345678901234567890</span>

print(x)        <span class="hljs-comment"># 输出: 10</span>
print(age)      <span class="hljs-comment"># 输出: 18</span>
print(myNum)    <span class="hljs-comment"># 输出: 123</span>
</code></pre>
<h5 data-id="heading-6">浮点数 (float)</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 小数</span>
<span class="hljs-attr">y</span> = <span class="hljs-number">3.14</span>
<span class="hljs-attr">pi</span> = <span class="hljs-number">3.14159</span>
<span class="hljs-attr">temperature</span> = -<span class="hljs-number">2.5</span>

<span class="hljs-comment"># 科学计数法</span>
<span class="hljs-attr">scientific</span> = <span class="hljs-number">1.23</span>e-<span class="hljs-number">4</span>  <span class="hljs-comment"># 0.000123</span>

print(y)           <span class="hljs-comment"># 输出: 3.14</span>
print(f"π的值是: {pi}")
</code></pre>
<h4 data-id="heading-7">2. 字符串 (str)</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 单引号字符串</span>
<span class="hljs-attr">name</span> = <span class="hljs-string">"Alice"</span>
<span class="hljs-attr">the_name</span> = <span class="hljs-string">"name"</span>
<span class="hljs-attr">letter</span> = <span class="hljs-string">"abhbabsbbabw"</span>

<span class="hljs-comment"># 双引号字符串</span>
<span class="hljs-attr">message</span> = <span class="hljs-string">"Hello, World!"</span>

<span class="hljs-comment"># 多行字符串</span>
<span class="hljs-attr">multi_line</span> = <span class="hljs-string">"""这是第一行
这是第二行
这是第三行"""</span>

<span class="hljs-comment"># 字符串操作</span>
<span class="hljs-attr">upper_letter</span> = letter.upper()  <span class="hljs-comment"># 转换为大写</span>
print(upper_letter)            <span class="hljs-comment"># 输出: ABHBABSBBABW</span>
print(name)                    <span class="hljs-comment"># 输出: Alice</span>
</code></pre>
<h4 data-id="heading-8">3. 布尔值 (bool)</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 布尔值只有两个：True 和 False</span>
<span class="hljs-attr">is_valid</span> = <span class="hljs-literal">True</span>
<span class="hljs-attr">e</span> = <span class="hljs-literal">False</span>
<span class="hljs-attr">flag</span> = <span class="hljs-literal">True</span>

print(e)        <span class="hljs-comment"># 输出: False</span>
print(flag)     <span class="hljs-comment"># 输出: True</span>

<span class="hljs-comment"># 布尔值常用于条件判断</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">18</span>
if age &gt;= 18:
    print("你已经成年了")  <span class="hljs-comment"># 输出: 你已经成年了</span>
else:
    print("你还未成年")
</code></pre>
<h4 data-id="heading-9">4. 复合数据类型（简要介绍）</h4>
<h5 data-id="heading-10">列表 (list) - 可变有序集合</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_list</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
<span class="hljs-attr">fruits</span> = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>]
<span class="hljs-attr">mixed_list</span> = [<span class="hljs-number">1</span>, <span class="hljs-string">"hello"</span>, <span class="hljs-number">3.14</span>, <span class="hljs-literal">True</span>]
</code></pre>
<h5 data-id="heading-11">元组 (tuple) - 不可变有序集合</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_tuple</span> = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
<span class="hljs-attr">coordinates</span> = (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
</code></pre>
<h5 data-id="heading-12">字典 (dict) - 键值对集合</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_dict</span> = {<span class="hljs-string">'name'</span>: <span class="hljs-string">'徐庆'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">18</span>}
<span class="hljs-attr">student</span> = {<span class="hljs-string">"姓名"</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-string">"年龄"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"成绩"</span>: <span class="hljs-number">85</span>}
</code></pre>
<h5 data-id="heading-13">集合 (set) - 无序不重复元素</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_set</span> = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>}
<span class="hljs-attr">unique_numbers</span> = {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>}  <span class="hljs-comment"># 自动去重为 {1, 2, 3, 4}</span>
</code></pre>
<h3 data-id="heading-14">变量命名规则</h3>
<h4 data-id="heading-15">合法的变量名</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ✓ 正确的命名方式</span>
<span class="hljs-attr">age</span> = <span class="hljs-number">18</span>           <span class="hljs-comment"># 全小写</span>
<span class="hljs-attr">myName</span> = <span class="hljs-string">"Alice"</span>   <span class="hljs-comment"># 驼峰命名法</span>
<span class="hljs-attr">my_number</span> = <span class="hljs-number">42</span>     <span class="hljs-comment"># 下划线分隔（推荐）</span>
<span class="hljs-attr">_number</span> = <span class="hljs-number">789</span>      <span class="hljs-comment"># 下划线开头</span>
<span class="hljs-attr">name123</span> = <span class="hljs-string">"test"</span>   <span class="hljs-comment"># 字母数字组合</span>

print(age)         <span class="hljs-comment"># 输出: 18</span>
print(myName)      <span class="hljs-comment"># 输出: Alice</span>
</code></pre>
<h4 data-id="heading-16">命名规范建议</h4>
<ul>
<li>使用有意义的变量名</li>
<li>推荐使用下划线分隔（snake_case）</li>
<li>变量名应能表达其含义</li>
<li>避免使用Python关键字作为变量名</li>
</ul>
<h3 data-id="heading-17">打印输出 (print)</h3>
<h4 data-id="heading-18">基本打印</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 打印字符串</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, World!"</span>)           <span class="hljs-comment"># 输出: Hello, World!</span>

<span class="hljs-comment"># 打印变量</span>
x = <span class="hljs-number">10</span>
<span class="hljs-built_in">print</span>(x)                         <span class="hljs-comment"># 输出: 10</span>

<span class="hljs-comment"># 打印多个值</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"name   --- &gt;  "</span> + name)   <span class="hljs-comment"># 字符串拼接</span>
<span class="hljs-built_in">print</span>(<span class="hljs-number">111</span>)                       <span class="hljs-comment"># 输出: 111</span>
<span class="hljs-built_in">print</span>(<span class="hljs-literal">True</span>)                      <span class="hljs-comment"># 输出: True</span>
</code></pre>
<h4 data-id="heading-19">格式化打印</h4>
<h5 data-id="heading-20">1. 字符串拼接</h5>
<pre><code class="hljs language-bash" lang="bash">name = <span class="hljs-string">"Alice"</span>
age = 18
<span class="hljs-built_in">print</span>(<span class="hljs-string">"My name is "</span> + name)                    <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"name   --- &gt;  "</span> + name)                 <span class="hljs-comment"># 输出: name   --- &gt;  Alice</span>
</code></pre>
<h5 data-id="heading-21">2. f-string格式化（推荐）</h5>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"My name is <span class="hljs-subst">{name}</span>"</span>)                    <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"我今年<span class="hljs-subst">{age}</span>岁"</span>)                        <span class="hljs-comment"># 输出: 我今年18岁</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名: <span class="hljs-subst">{name}</span>, 年龄: <span class="hljs-subst">{age}</span>"</span>)            <span class="hljs-comment"># 输出: 姓名: Alice, 年龄: 18</span>
</code></pre>
<h5 data-id="heading-22">3. format方法</h5>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"My name is {}"</span>.<span class="hljs-built_in">format</span>(name))            <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名: {}, 年龄: {}"</span>.<span class="hljs-built_in">format</span>(name, <span class="hljs-number">18</span>))   <span class="hljs-comment"># 输出: 姓名: Alice, 年龄: 18</span>
</code></pre>
<h5 data-id="heading-23">4. %格式化（较老的方式）</h5>
<pre><code class="hljs language-perl" lang="perl">name = <span class="hljs-string">"Alice"</span>
<span class="hljs-keyword">print</span>(<span class="hljs-string">"My name is %s"</span> % name)                  <span class="hljs-comment"># 输出: My name is Alice</span>
<span class="hljs-keyword">print</span>(<span class="hljs-string">"姓名: %s, 年龄: %d"</span> % (name, <span class="hljs-number">18</span>))       <span class="hljs-comment"># 输出: 姓名: Alice, 年龄: 18</span>
</code></pre>
<h4 data-id="heading-24">高级打印技巧</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 打印换行</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"第一行"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"第二行"</span>)

<span class="hljs-comment"># 不换行打印</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello"</span>, end=<span class="hljs-string">" "</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"World"</span>)                                 <span class="hljs-comment"># 输出: Hello World</span>

<span class="hljs-comment"># 分隔符自定义</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>, sep=<span class="hljs-string">"-"</span>)    <span class="hljs-comment"># 输出: apple-banana-orange</span>

<span class="hljs-comment"># 打印到文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"output.txt"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"保存到文件的内容"</span>, file=f)
</code></pre>
<h3 data-id="heading-25">用户输入 (input)</h3>
<h4 data-id="heading-26">基本输入</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 获取用户输入</span>
user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入内容: "</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"你输入的是: <span class="hljs-subst">{user_input}</span>"</span>)

<span class="hljs-comment"># 输入数字（需要转换类型）</span>
get_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入数字："</span>)
number = <span class="hljs-built_in">int</span>(get_input)  <span class="hljs-comment"># 转换为整数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"你输入的数字是: <span class="hljs-subst">{number}</span>"</span>)
</code></pre>
<h4 data-id="heading-27">输入验证示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安全的数字输入</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_number_input</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">try</span>:
            user_input = <span class="hljs-built_in">input</span>(prompt)
            number = <span class="hljs-built_in">int</span>(user_input)
            <span class="hljs-keyword">return</span> number
        <span class="hljs-keyword">except</span> ValueError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"请输入有效的数字！"</span>)

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-comment"># age = get_number_input("请输入您的年龄: ")</span>
</code></pre>
<h3 data-id="heading-28">字符串格式化</h3>
<h4 data-id="heading-29">f-string（最推荐）</h4>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
age = <span class="hljs-number">18</span>
score = <span class="hljs-number">95.5</span>

<span class="hljs-comment"># 基本格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名: <span class="hljs-subst">{name}</span>"</span>)                          <span class="hljs-comment"># 输出: 姓名: Alice</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄: <span class="hljs-subst">{age}</span>"</span>)                           <span class="hljs-comment"># 输出: 年龄: 18</span>

<span class="hljs-comment"># 数字格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"成绩: <span class="hljs-subst">{score:<span class="hljs-number">.1</span>f}</span>"</span>)                     <span class="hljs-comment"># 输出: 成绩: 95.5</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"成绩: <span class="hljs-subst">{score:<span class="hljs-number">.2</span>f}</span>"</span>)                     <span class="hljs-comment"># 输出: 成绩: 95.50</span>

<span class="hljs-comment"># 表达式计算</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"明年年龄: <span class="hljs-subst">{age + <span class="hljs-number">1</span>}</span>"</span>)                   <span class="hljs-comment"># 输出: 明年年龄: 19</span>
</code></pre>
<h4 data-id="heading-30">format方法</h4>
<pre><code class="hljs language-python" lang="python">name = <span class="hljs-string">"Alice"</span>
age = <span class="hljs-number">18</span>

<span class="hljs-comment"># 位置参数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名: {}, 年龄: {}"</span>.<span class="hljs-built_in">format</span>(name, age))

<span class="hljs-comment"># 关键字参数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名: {name}, 年龄: {age}"</span>.<span class="hljs-built_in">format</span>(name=name, age=age))

<span class="hljs-comment"># 数字格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"成绩: {:.2f}"</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">95.567</span>))            <span class="hljs-comment"># 输出: 成绩: 95.57</span>
</code></pre>
<h3 data-id="heading-31">类型转换</h3>
<h4 data-id="heading-32">基本类型转换</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 字符串转数字</span>
str_num = <span class="hljs-string">"123"</span>
int_num = <span class="hljs-built_in">int</span>(str_num)          <span class="hljs-comment"># 转为整数</span>
float_num = <span class="hljs-built_in">float</span>(str_num)      <span class="hljs-comment"># 转为浮点数</span>

<span class="hljs-built_in">print</span>(int_num)                  <span class="hljs-comment"># 输出: 123</span>
<span class="hljs-built_in">print</span>(float_num)                <span class="hljs-comment"># 输出: 123.0</span>

<span class="hljs-comment"># 数字转字符串</span>
num = <span class="hljs-number">42</span>
str_num = <span class="hljs-built_in">str</span>(num)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"数字<span class="hljs-subst">{num}</span>转为字符串: '<span class="hljs-subst">{str_num}</span>'"</span>)

<span class="hljs-comment"># 布尔转换</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-number">0</span>))                  <span class="hljs-comment"># 输出: False</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-number">1</span>))                  <span class="hljs-comment"># 输出: True</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-string">""</span>))                 <span class="hljs-comment"># 输出: False</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">bool</span>(<span class="hljs-string">"hello"</span>))            <span class="hljs-comment"># 输出: True</span>
</code></pre>
<h4 data-id="heading-33">实用转换示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 用户输入数字处理</span>
user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入一个数字: "</span>)
<span class="hljs-keyword">try</span>:
    number = <span class="hljs-built_in">int</span>(user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"输入的数字是: <span class="hljs-subst">{number}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"数字的平方是: <span class="hljs-subst">{number ** <span class="hljs-number">2</span>}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"输入的不是有效数字！"</span>)
</code></pre>
<h3 data-id="heading-34">条件语句</h3>
<h4 data-id="heading-35">if-else语句</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本条件判断</span>
age = 18
<span class="hljs-keyword">if</span> age &gt;= 18:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你已经成年了"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"你还未成年"</span>)

<span class="hljs-comment"># 多重条件判断</span>
score = 85
<span class="hljs-keyword">if</span> score &gt;= 90:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"优秀"</span>)
<span class="hljs-keyword">elif</span> score &gt;= 80:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"良好"</span>)
<span class="hljs-keyword">elif</span> score &gt;= 60:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"及格"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"不及格"</span>)
</code></pre>
<h4 data-id="heading-36">数字判断示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 判断奇偶数</span>
get_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入数字："</span>)
number = <span class="hljs-built_in">int</span>(get_input)

<span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"是偶数"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"是奇数"</span>)

<span class="hljs-comment"># 判断素数（简单版本）</span>
<span class="hljs-keyword">if</span> number == <span class="hljs-number">2</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"是素数"</span>)
<span class="hljs-keyword">elif</span> number &lt; <span class="hljs-number">2</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"不是素数"</span>)
<span class="hljs-keyword">else</span>:
    is_prime = <span class="hljs-literal">True</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-built_in">int</span>(number ** <span class="hljs-number">0.5</span>) + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">if</span> number % i == <span class="hljs-number">0</span>:
            is_prime = <span class="hljs-literal">False</span>
            <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">if</span> is_prime:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"是素数"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"不是素数"</span>)
</code></pre>
<h3 data-id="heading-37">实用示例</h3>
<h4 data-id="heading-38">1. 简单计算器</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_calculator</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 简单计算器 ==="</span>)
    
    <span class="hljs-comment"># 获取用户输入</span>
    num1 = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第一个数字: "</span>))
    operator = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入运算符 (+, -, *, /): "</span>)
    num2 = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第二个数字: "</span>))
    
    <span class="hljs-comment"># 执行计算</span>
    <span class="hljs-keyword">if</span> operator == <span class="hljs-string">"+"</span>:
        result = num1 + num2
    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"-"</span>:
        result = num1 - num2
    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"*"</span>:
        result = num1 * num2
    <span class="hljs-keyword">elif</span> operator == <span class="hljs-string">"/"</span>:
        <span class="hljs-keyword">if</span> num2 != <span class="hljs-number">0</span>:
            result = num1 / num2
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误：除数不能为零"</span>)
            <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"错误：无效的运算符"</span>)
        <span class="hljs-keyword">return</span>
    
    <span class="hljs-comment"># 输出结果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果: <span class="hljs-subst">{num1}</span> <span class="hljs-subst">{operator}</span> <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># 使用示例（取消注释运行）</span>
<span class="hljs-comment"># simple_calculator()</span>
</code></pre>
<h4 data-id="heading-39">2. 个人信息录入系统</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">personal_info_system</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 个人信息录入系统 ==="</span>)
    
    <span class="hljs-comment"># 收集信息</span>
    name = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入姓名: "</span>)
    age = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入年龄: "</span>))
    height = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入身高(cm): "</span>))
    is_student_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"是否为学生？(y/n): "</span>)
    is_student = is_student_input.lower() == <span class="hljs-string">'y'</span>
    
    <span class="hljs-comment"># 显示信息</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== 个人信息 ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名: <span class="hljs-subst">{name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄: <span class="hljs-subst">{age}</span>岁"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"身高: <span class="hljs-subst">{height}</span>cm"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"学生身份: <span class="hljs-subst">{<span class="hljs-string">'是'</span> <span class="hljs-keyword">if</span> is_student <span class="hljs-keyword">else</span> <span class="hljs-string">'否'</span>}</span>"</span>)

<span class="hljs-comment"># 使用示例（取消注释运行）</span>
<span class="hljs-comment"># personal_info_system()</span>
</code></pre>
<h4 data-id="heading-40">3. 成绩等级判断系统</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">grade_system</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== 成绩等级判断系统 ==="</span>)
    
    <span class="hljs-comment"># 获取成绩</span>
    chinese = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入语文成绩: "</span>))
    math = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入数学成绩: "</span>))
    english = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入英语成绩: "</span>))
    
    <span class="hljs-comment"># 计算平均分</span>
    average = (chinese + math + english) / <span class="hljs-number">3</span>
    
    <span class="hljs-comment"># 判断等级</span>
    <span class="hljs-keyword">if</span> average &gt;= <span class="hljs-number">90</span>:
        grade = <span class="hljs-string">"优秀"</span>
    <span class="hljs-keyword">elif</span> average &gt;= <span class="hljs-number">80</span>:
        grade = <span class="hljs-string">"良好"</span>
    <span class="hljs-keyword">elif</span> average &gt;= <span class="hljs-number">70</span>:
        grade = <span class="hljs-string">"中等"</span>
    <span class="hljs-keyword">elif</span> average &gt;= <span class="hljs-number">60</span>:
        grade = <span class="hljs-string">"及格"</span>
    <span class="hljs-keyword">else</span>:
        grade = <span class="hljs-string">"不及格"</span>
    
    <span class="hljs-comment"># 输出结果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n平均成绩: <span class="hljs-subst">{average:<span class="hljs-number">.2</span>f}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"等级评定: <span class="hljs-subst">{grade}</span>"</span>)

<span class="hljs-comment"># 使用示例（取消注释运行）</span>
<span class="hljs-comment"># grade_system()</span>
</code></pre>
<h3 data-id="heading-41">学习建议</h3>
<ol>
<li><strong>多动手练习</strong> - 亲自编写代码比只看文档更重要</li>
<li><strong>理解概念</strong> - 不要死记硬背，要理解每种数据类型的用途</li>
<li><strong>注意细节</strong> - 变量命名、缩进、语法等都要规范</li>
<li><strong>循序渐进</strong> - 从简单的打印开始，逐步学习复杂的概念</li>
<li><strong>善用调试</strong> - 遇到问题时学会使用print()调试</li>
</ol>
<h3 data-id="heading-42">常见错误提醒</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误示例</span>
<span class="hljs-comment"># 1. 变量未定义就使用</span>
<span class="hljs-comment"># print(undefined_var)  # NameError</span>

<span class="hljs-comment"># 2. 字符串和数字直接拼接</span>
<span class="hljs-comment"># print("年龄: " + 18)  # TypeError</span>

<span class="hljs-comment"># 3. 输入转换错误</span>
<span class="hljs-comment"># user_input = input("输入数字: ")</span>
<span class="hljs-comment"># number = int(user_input)  # 如果输入非数字会报错</span>

<span class="hljs-comment"># ✓ 正确做法</span>
<span class="hljs-comment"># 1. 先定义变量</span>
message = <span class="hljs-string">"Hello"</span>
<span class="hljs-built_in">print</span>(message)

<span class="hljs-comment"># 2. 使用格式化</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄: <span class="hljs-subst">{age}</span>"</span>)

<span class="hljs-comment"># 3. 安全转换</span>
user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"输入数字: "</span>)
<span class="hljs-keyword">try</span>:
    number = <span class="hljs-built_in">int</span>(user_input)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"你输入了: <span class="hljs-subst">{number}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"请输入有效数字！"</span>)
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零构建坚固的前端堡垒：TypeScript 与 React 实战深度指南]]></title>    <link>https://juejin.cn/post/7601075423003492388</link>    <guid>https://juejin.cn/post/7601075423003492388</guid>    <pubDate>2026-02-01T06:44:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601075423003492388" data-draft-id="7601103779392569407" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零构建坚固的前端堡垒：TypeScript 与 React 实战深度指南"/> <meta itemprop="keywords" content="TypeScript,React.js,前端框架"/> <meta itemprop="datePublished" content="2026-02-01T06:44:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零构建坚固的前端堡垒：TypeScript 与 React 实战深度指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:44:39.000Z" title="Sun Feb 01 2026 06:44:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>在现代前端开发的浪潮中，JavaScript 无疑是统治者。然而，随着项目规模的指数级增长，JavaScript 灵活的动态类型特性逐渐从“优势”变成了“隐患”。你是否经历过项目上线后页面白屏，控制台赫然写着 <code>Cannot read property 'name' of undefined</code>？你是否在维护前同事的代码时，对着一个名为 <code>data</code> 的对象变量，完全猜不出里面到底装了什么？</p>
<p>这就是 <strong>TypeScript (TS)</strong> 诞生的意义。</p>
<p>作为 JavaScript 的超集，TypeScript 并不是要取代 JS，而是给它穿上了一层名为“静态类型系统”的钢铁侠战衣。它将类型检查从“运行时”提前到了“编译时”，让 Bug 扼杀在代码编写的那一刻。</p>
<p>今天，我们将通过一个经典的 Todo List（待办事项）项目，从基础语法到 React 组件实战，带你深入理解 TypeScript 如何让你的代码变得<strong>更安全、更易读、更易维护</strong>。</p>
<h2 data-id="heading-0">第一部分：TypeScript 的核心基石</h2>
<p>在进入 React 实战之前，我们需要先掌握 TS 的几块基石。这些概念通常定义在项目的通用逻辑或类型声明文件中。</p>
<h3 data-id="heading-1">1. 给变量一张“身份证”：基础类型</h3>
<p>在 JS 中，变量是自由的，今天是数字，明天可以是字符串。但在 TS 中，我们强调“契约精神”。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 简单类型：显式声明</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">18</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">username</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;

<span class="hljs-comment">// 类型推导：TS 的智能之处</span>
<span class="hljs-comment">// 即使不写类型，TS 也会根据初始值推断出 count 是 number</span>
<span class="hljs-keyword">let</span> count = <span class="hljs-number">1</span>; 
<span class="hljs-comment">// count = '11'; // 报错！你不能把字符串赋值给数字类型的变量</span>
</code></pre>
<p>这种<strong>类型推导</strong>机制意味着你不需要每一行都写类型定义，TS 编译器会默默地在后台守护你。</p>
<h3 data-id="heading-2">2. 更有序的集合：数组与元组</h3>
<p>在处理列表数据时，TS 提供了两种方式。</p>
<p>如果你想要一个纯粹的数组（比如全是数字），可以这样写：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">let</span> <span class="hljs-attr">scores</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>];
<span class="hljs-comment">// 或者使用泛型写法（两者等价）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">names</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">'Alice'</span>, <span class="hljs-string">'Bob'</span>];
</code></pre>
<p>但有时候，我们需要一个固定长度、且每个位置类型都确定的数组，这就是<strong>元组 (Tuple)</strong> 。这在 React Hooks 中非常常见：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 元组：第一个位置必须是数字，第二个必须是字符串</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">userRecord</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>] = [<span class="hljs-number">1001</span>, <span class="hljs-string">'Tom'</span>];
</code></pre>
<h3 data-id="heading-3">3. 告别魔法数字：枚举 (Enum)</h3>
<p>你一定见过这种代码：<code>if (status === 1) { ... }</code>。这个 <code>1</code> 到底代表什么？成功？失败？还是进行中？这种让人摸不着头脑的数字被称为“魔法数字”。</p>
<p>TS 的<strong>枚举</strong>类型完美解决了这个问题：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Status</span> {
    <span class="hljs-title class_">Pending</span>, <span class="hljs-comment">// 0</span>
    <span class="hljs-title class_">Success</span>, <span class="hljs-comment">// 1</span>
    <span class="hljs-title class_">Failed</span>,  <span class="hljs-comment">// 2</span>
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">currentStatus</span>: <span class="hljs-title class_">Status</span> = <span class="hljs-title class_">Status</span>.<span class="hljs-property">Pending</span>;
</code></pre>
<p>代码的可读性瞬间提升。当其他开发者阅读代码时，<code>Status.Pending</code> 远比 <code>0</code> 具有语义价值。</p>
<h3 data-id="heading-4">4. 逃生舱与安全门：Any vs Unknown</h3>
<p>这是 TS 新手最容易混淆的概念。</p>
<ul>
<li>
<p><strong>Any (任意类型)</strong> ：这是 TS 的“逃生舱”。当你把变量设为 <code>any</code>，你就放弃了所有类型检查。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">let</span> <span class="hljs-attr">risky</span>: <span class="hljs-built_in">any</span> = <span class="hljs-number">1</span>;
risky.<span class="hljs-title function_">hello</span>(); <span class="hljs-comment">// 编译器不报错，但运行时会崩！</span>
</code></pre>
<p><em>建议：除非万不得已，否则尽量少用 <code>any</code>，否则你写的只是“带注释的 JS”。</em></p>
</li>
<li>
<p><strong>Unknown (未知类型)</strong> ：这是更安全的 <code>any</code>。它的原则是：“你可以存任何东西，但在你证明它是谁之前，不能使用它。”</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">let</span> <span class="hljs-attr">safeData</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-number">1</span>;
<span class="hljs-comment">// safeData.toUpperCase(); // 报错！TS 说：我不知道这是不是字符串，不准用。</span>

<span class="hljs-comment">// 类型断言（Type Assertion）</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> safeData === <span class="hljs-string">'string'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(safeData.<span class="hljs-title function_">toUpperCase</span>()); <span class="hljs-comment">// 现在可以用了，因为你证明了它是字符串</span>
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-5">5. 契约精神：接口 (Interface)</h3>
<p><strong>接口</strong>是 TS 面向对象编程的核心。它定义了一个对象应该“长什么样”。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUser</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 只读属性：生下来就不能改</span>
    hobby?: <span class="hljs-built_in">string</span>[];    <span class="hljs-comment">// 可选属性：可以有，也可以没有</span>
}
</code></pre>
<ul>
<li><strong>readonly</strong>：保证了数据的不可变性，防止我们在业务逻辑中意外修改了核心 ID。</li>
<li><strong>? (可选)</strong> ：处理后端接口返回的不完整数据时非常有用。配合可选链操作符 <code>user.hobby?.length</code>，可以优雅地避免报错。</li>
</ul>
<h3 data-id="heading-6">6. 灵活多变：自定义类型 (Type Aliases)</h3>
<p>除了接口，TS 还提供了 <code>type</code> 关键字来创建<strong>类型别名</strong>。很多人会问：“它和接口有什么区别？”</p>
<p>接口主要用于定义对象的形状（Shape），而 <code>type</code> 更加灵活，它可以定义基础类型的别名，最重要的是它支持<strong>联合类型 (Union Types)</strong> 。</p>
<p><strong>场景一：联合类型（最常用）</strong> 当一个变量可能是字符串，也可能是数字时，接口就无能为力了，但 <code>type</code> 可以轻松搞定：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 定义一个 ID 类型，它可以是 string 或者 number</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">ID</span> = <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>; 

<span class="hljs-keyword">let</span> <span class="hljs-attr">userId</span>: <span class="hljs-variable constant_">ID</span> = <span class="hljs-number">111</span>;      <span class="hljs-comment">// 合法</span>
userId = <span class="hljs-string">"user_123"</span>;       <span class="hljs-comment">// 也合法</span>
<span class="hljs-comment">// userId = false;         // 报错！</span>
</code></pre>
<p><strong>场景二：定义对象别名</strong> 虽然通常用 <code>interface</code> 定义对象，但 <code>type</code> 也可以做到：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">UserType</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>
    hobby?: <span class="hljs-built_in">string</span>[]
}
</code></pre>
<blockquote>
<p><strong>最佳实践建议</strong>：</p>
<ul>
<li>如果你在定义对象或组件的 Props，优先使用 <strong>Interface</strong>（因为它可以被继承和合并）。</li>
<li>如果你需要定义基础类型的组合（如 <code>string | number</code>）或函数类型，使用 <strong>Type</strong>。</li>
</ul>
</blockquote>
<h2 data-id="heading-7">第二部分：React + TypeScript 项目架构设计</h2>
<p>理解了基础语法后，我们来构建应用。一个优秀的 React + TS 项目，其目录结构应该清晰地分离<strong>数据定义</strong>、<strong>逻辑</strong>和<strong>视图</strong>。</p>
<p>我们将按照以下结构组织代码：</p>
<ol>
<li><strong><code>src/types</code></strong>：存放通用的类型定义（接口）。</li>
<li><strong><code>src/utils</code></strong>：存放工具函数。</li>
<li><strong><code>src/hooks</code></strong>：存放自定义 Hooks（业务逻辑）。</li>
<li><strong><code>src/components</code></strong>：存放 React 组件（视图）。</li>
</ol>
<h3 data-id="heading-8">1. 数据模型先行 (src/types)</h3>
<p>在写任何 UI 代码之前，<strong>先定义数据</strong>。这是 TS 开发的最佳实践。我们在 <code>types</code> 目录下定义 Todo item 的结构：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// 这是整个应用的数据核心</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
}
</code></pre>
<p>有了这个接口，应用中任何涉及 Todo 的地方都有了“法律依据”。</p>
<h3 data-id="heading-9">2. 泛型的妙用 (src/utils)</h3>
<p>我们需要将数据持久化到 localStorage。为了让这个存储函数通用（既能存 Todo 数组，也能存用户信息），我们使用<strong>泛型 (Generics)</strong> 。</p>
<p>泛型就像是一个“类型的占位符”。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// &lt;T&gt; 就是这个占位符，调用时才决定它是什么类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> getStorage&lt;T&gt;(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">defaultValue</span>: T): T {
    <span class="hljs-keyword">const</span> value = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(key);
    <span class="hljs-keyword">return</span> value ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value) : defaultValue;
}
</code></pre>
<p>当我们调用 <code>getStorage&lt;Todo[]&gt;('todos', [])</code> 时，TS 就知道返回值一定是 <code>Todo</code> 类型的数组。如果不用泛型，<code>JSON.parse</code> 返回的是 <code>any</code>，我们就会丢失宝贵的类型保护。</p>
<h3 data-id="heading-10">3. 逻辑与视图分离 (src/hooks)</h3>
<p>我们将 Todo 的增删改查逻辑抽离到自定义 Hook 中。这里展示了 TS 如何保护业务逻辑。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Todo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTodos</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 显式声明 state 存放的是 Todo 类型的数组</span>
    <span class="hljs-keyword">const</span> [todos, setTodos] = useState&lt;<span class="hljs-title class_">Todo</span>[]&gt;([]);

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">addTodo</span> = (<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>) =&gt; {
        <span class="hljs-keyword">const</span> <span class="hljs-attr">newTodo</span>: <span class="hljs-title class_">Todo</span> = {
            <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">title</span>: title.<span class="hljs-title function_">trim</span>(),
            <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>, 
        }
        <span class="hljs-comment">// 如果这里少写了 completed 属性，TS 会立即标红报错！</span>
        <span class="hljs-title function_">setTodos</span>([...todos, newTodo]);
    }
    
    <span class="hljs-comment">// ... toggleTodo, removeTodo 的逻辑</span>
    
    <span class="hljs-keyword">return</span> { todos, addTodo, toggleTodo, removeTodo };
}
</code></pre>
<p>在 JS 中，如果你在创建 <code>newTodo</code> 时拼写错误（比如把 <code>completed</code> 写成 <code>complete</code>），这个错误会一直潜伏到页面渲染时才暴露。而在 TS 中，编辑器会当你面直接画红线拒绝编译。</p>
<h2 data-id="heading-11">第三部分：组件化开发实战</h2>
<p>接下来我们进入 <code>src/components</code> 目录，看看 TS 如何增强 React 组件的健壮性。</p>
<h3 data-id="heading-12">1. 组件 Props 的强契约</h3>
<p>React 组件通信依靠 Props。在 TS 中，我们不再需要 <code>PropTypes</code> 库，直接用 Interface 定义 Props。</p>
<p><strong>输入组件 (TodoInput)：</strong></p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 定义父组件必须传给我什么</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
    <span class="hljs-attr">onAdd</span>: <span class="hljs-function">(<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 一个函数，接收 string，没有返回值</span>
}

<span class="hljs-comment">// React.FC&lt;Props&gt; 告诉 TS：这是一个函数式组件，它的 Props 符合上面的定义</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">TodoInput</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">Props</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ onAdd }</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> [title, setTitle] = <span class="hljs-title class_">React</span>.<span class="hljs-property">useState</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">''</span>);

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span>(!title.<span class="hljs-title function_">trim</span>()) <span class="hljs-keyword">return</span>;
        <span class="hljs-title function_">onAdd</span>(title); <span class="hljs-comment">// TS 会检查这里传入的是否是 string</span>
        <span class="hljs-title function_">setTitle</span>(<span class="hljs-string">''</span>);
    }
    <span class="hljs-comment">// ... JSX 渲染 input 和 button</span>
}
</code></pre>
<h3 data-id="heading-13">2. 列表项组件 (TodoItem)</h3>
<p>这里展示了接口的复用。我们可以直接引入之前定义的 <code>Todo</code> 接口。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Todo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
    <span class="hljs-attr">todo</span>: <span class="hljs-title class_">Todo</span>; <span class="hljs-comment">// 直接复用核心类型</span>
    <span class="hljs-attr">onToggle</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">onRemove</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">TodoItem</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">Props</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{ todo, onToggle, onRemove }</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> 
                <span class="hljs-attr">checked</span>=<span class="hljs-string">{todo.completed}</span> 
                <span class="hljs-attr">onChange</span>=<span class="hljs-string">{()</span> =&gt;</span> onToggle(todo.id)}
            /&gt;
            {/* 样式处理：如果完成则加删除线 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textDecoration:</span> <span class="hljs-attr">todo.completed</span> ? '<span class="hljs-attr">line-through</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">none</span>'}}&gt;</span>
                {todo.title}
            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> onRemove(todo.id)}&gt;删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
    )
}
</code></pre>
<p><strong>TS 的威力展示</strong>：</p>
<p>如果在 <code>span</code> 标签里，你试图渲染 <code>{todo.name}</code>，TS 会立刻报错：“属性 'name' 在类型 'Todo' 中不存在”。这避免了运行时出现 <code>undefined</code> 的尴尬。</p>
<h3 data-id="heading-14">3. 整合组件 (TodoList &amp; App)</h3>
<p>最后，我们将这些组件组合起来。</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-comment">// TodoList 组件</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListProps</span> {
    <span class="hljs-attr">todos</span>: <span class="hljs-title class_">Todo</span>[];
    <span class="hljs-attr">onToggle</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">onRemove</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}
<span class="hljs-comment">// ... 遍历 todos 并渲染 TodoItem</span>
</code></pre>
<p>在根组件 <code>App</code> 中：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 从自定义 Hook 中获取数据和方法</span>
  <span class="hljs-keyword">const</span> { todos, addTodo, toggleTodo, removeTodo } = <span class="hljs-title function_">useTodos</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>TodoList<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      {/* 这里通过 Props 传递函数。
         TS 会自动比对：addTodo 的类型是否匹配 TodoInput 要求的 onAdd 类型。
         如果不匹配（比如参数个数不对），这里就会报错。
      */}
      <span class="hljs-tag">&lt;<span class="hljs-name">TodoInput</span> <span class="hljs-attr">onAdd</span>=<span class="hljs-string">{addTodo}</span> /&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">TodoList</span> 
        <span class="hljs-attr">todos</span>=<span class="hljs-string">{todos}</span>
        <span class="hljs-attr">onToggle</span>=<span class="hljs-string">{toggleTodo}</span>
        <span class="hljs-attr">onRemove</span>=<span class="hljs-string">{removeTodo}</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
</code></pre>
<h2 data-id="heading-15">第四部分：总结与展望</h2>
<p>通过这个 Todo List 项目，我们不仅学习了 TypeScript 的语法，更重要的是体会到了它带来的开发模式的变革。</p>
<h3 data-id="heading-16">TypeScript 带来的核心价值：</h3>
<ol>
<li>
<p><strong>代码即文档</strong>：</p>
<p>以前你需要看半天代码逻辑或者是过时的注释才能知道 <code>todos</code> 数组里存的是什么。现在，只需要把鼠标悬停在 <code>Todo</code> 接口上，数据结构一目了然。</p>
</li>
<li>
<p><strong>重构的信心</strong>：</p>
<p>想象一下，如果产品经理让你把 <code>title</code> 字段改成 <code>content</code>。在 JS 项目中，你需要全局搜索替换，还担心漏改或改错。在 TS 项目中，你只需要修改 <code>interface Todo</code> 里的定义，编译器会立刻列出所有报错的地方（所有用到 <code>title</code> 的组件），你逐一修正即可。这种“指哪打哪”的安全感是 JS 无法比拟的。</p>
</li>
<li>
<p><strong>极致的开发体验</strong>：</p>
<p>IDE 的智能提示（IntelliSense）会让你爱不释手。当你输入 <code>todo.</code> 时，自动弹出 <code>id</code>、<code>title</code>、<code>completed</code>，这不仅提高了输入速度，更减少了记忆负担和拼写错误。</p>
</li>
</ol>
<h3 data-id="heading-17">结语</h3>
<p>学习 TypeScript 是现代前端开发的必经之路。起初，你可能会觉得编写类型定义增加了代码量，甚至觉得编译器频繁的报错很烦人。但请相信，这些前期的投入，会在项目维护阶段以<strong>减少 Bug</strong>、<strong>提高可读性</strong>和<strong>提升团队协作效率</strong>的形式，给你百倍的回报。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零起步学习Redis || 第三章：Redis中数据类型的深层剖析讲解（下）]]></title>    <link>https://juejin.cn/post/7601175299011264527</link>    <guid>https://juejin.cn/post/7601175299011264527</guid>    <pubDate>2026-02-01T08:33:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601175299011264527" data-draft-id="7601077290682138676" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零起步学习Redis || 第三章：Redis中数据类型的深层剖析讲解（下）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-01T08:33:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="茶杯梦轩"/> <meta itemprop="url" content="https://juejin.cn/user/195039473183699"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零起步学习Redis || 第三章：Redis中数据类型的深层剖析讲解（下）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/195039473183699/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    茶杯梦轩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:33:58.000Z" title="Sun Feb 01 2026 08:33:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<h3 data-id="heading-0"> 前言：</h3>
<p>昨天讲解了Redis中String和List的数据类型的相关知识，今天我们来讲解一下剩余的几种常用数据类型：Hash，Set，Zset</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f87c6eaa74f43c69a7babf2a6b2d2d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Iy25p2v5qKm6L2p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770539637&amp;x-signature=kJiNtWpNNDKgX1tKRLCxMxVCKDM%3D" alt="" loading="lazy"/><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/>​编辑</p>
<h3 data-id="heading-1">一、 Hash （哈希）</h3>
<p>底层实现：</p>
<p>在底层，Redis 对 Hash 的实现有两种方式，取决于 <strong>元素数量和 field/value 的长度</strong>：</p>
<ol>
<li>ziplist（压缩列表，Redis 3.2 以后是 listpack）</li>
</ol>
<ul>
<li>
<p>当 Hash 中的 <strong>键值对数量较少</strong> 且 <strong>field 和 value 都比较短</strong> 时，Redis 会使用 <strong>压缩列表</strong> 来存储。</p>
</li>
<li>
<p>压缩列表是一块 <strong>连续的内存区域</strong>，内部紧凑存放 <code>field</code> 和 <code>value</code>。</p>
</li>
<li>
<p>优点：</p>
<ul>
<li>内存占用少，存储紧凑，适合小数据量。</li>
</ul>
</li>
<li>
<p>缺点：</p>
<ul>
<li>随着元素增多，插入、查找的性能会下降，因为需要线性扫描。</li>
</ul>
</li>
</ul>
<blockquote>
<p>默认条件：</p>
<ul>
<li><code>hash-max-ziplist-entries</code>（默认 512）—— 最大 entry 数量</li>
<li><code>hash-max-ziplist-value</code>（默认 64 字节）—— 单个 value 最大长度<br/>
超过阈值会转成 hashtable。</li>
</ul>
</blockquote>
<hr/>
<ol start="2">
<li>hashtable（哈希表）</li>
</ol>
<ul>
<li>
<p>当 Hash 中的 <strong>元素很多</strong> 或 <strong>field/value 较大</strong> 时，会自动转为 <strong>哈希表</strong> 存储。</p>
</li>
<li>
<p>本质上是一个 <strong>字典（dict）</strong> ，底层采用 <strong>哈希表 + 链地址法</strong> 实现冲突解决。</p>
</li>
<li>
<p>优点：</p>
<ul>
<li>查找、插入、删除的时间复杂度接近 O(1)。</li>
</ul>
</li>
<li>
<p>缺点：</p>
<ul>
<li>内存占用相对更多。</li>
</ul>
</li>
</ul>
<p>表格对比讲解：</p>













































<table><thead><tr><th>特性</th><th><strong>ziplist / listpack（压缩列表）</strong></th><th><strong>hashtable（哈希表）</strong></th></tr></thead><tbody><tr><td><strong>存储方式</strong></td><td>一块连续内存，按顺序紧凑存储 field 和 value</td><td>数组 + 哈希函数映射，冲突用链表（或 rehash 时双表）</td></tr><tr><td><strong>内存占用</strong></td><td>紧凑，节省内存</td><td>额外指针和哈希桶，内存开销大</td></tr><tr><td><strong>查找效率</strong></td><td>需要遍历，时间复杂度 O(N)</td><td>哈希查找，平均 O(1)</td></tr><tr><td><strong>适用场景</strong></td><td>元素个数少（≤512，默认）且 field/value 较小（≤64 字节）</td><td>元素多或 field/value 较大</td></tr><tr><td><strong>优点</strong></td><td>占用少、缓存友好</td><td>查找快、插入删除性能高</td></tr><tr><td><strong>缺点</strong></td><td>查找效率低，数据一多性能下降</td><td>内存浪费多，rehash 时开销较大</td></tr><tr><td><strong>应用举例</strong></td><td>小对象存储，如用户配置</td><td>大对象存储，如用户信息、购物车数据</td></tr></tbody></table>
<p>Hash 在项目中的应用场景：</p>
<p>Redis 的 Hash 特别适合存储对象，比如用户信息、配置、统计数据等。以下给几个常见应用场景：</p>
<ol>
<li>缓存对象数据（替代 JSON 存储）</li>
</ol>
<p>例如存储用户信息：</p>
<pre><code class="hljs language-sql" lang="sql">HSET <span class="hljs-keyword">user</span>:<span class="hljs-number">1001</span> name "Tom" age "18" gender "male" 
HGET <span class="hljs-keyword">user</span>:<span class="hljs-number">1001</span> name # <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> "Tom" 
HGETALL <span class="hljs-keyword">user</span>:<span class="hljs-number">1001</span> # <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> 获取整个对象
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>优点：</p>
<ul>
<li>可以只更新某个字段，不需要整个 JSON 覆盖。</li>
<li>内存占用比 JSON/string 更小。</li>
</ul>
<hr/>
<ol start="2">
<li>存储计数器或统计信息</li>
</ol>
<p>适合保存 <strong>多维度的计数</strong>：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable constant_">HINCRBY</span> <span class="hljs-symbol">article:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:stats</span> views <span class="hljs-number">1</span>
<span class="hljs-variable constant_">HINCRBY</span> <span class="hljs-symbol">article:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:stats</span> likes <span class="hljs-number">1</span>
<span class="hljs-variable constant_">HGETALL</span> <span class="hljs-symbol">article:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:stats</span>
<span class="hljs-comment"># -&gt; {views: 101, likes: 20}</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>适用场景：文章浏览量、点赞数、商品销量。</p>
<hr/>
<ol start="3">
<li>存储配置或元数据</li>
</ol>
<p>例如系统配置：</p>
<pre><code class="hljs language-arduino" lang="arduino">HSET system:config site_name <span class="hljs-string">"MySite"</span> theme <span class="hljs-string">"dark"</span> max_users <span class="hljs-string">"1000"</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>修改配置只需要改某个字段，不影响其他部分。</li>
</ul>
<hr/>
<ol start="4">
<li>Session/Token 存储</li>
</ol>
<p>存储用户会话信息：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">HSET</span> <span class="hljs-string">session:token123</span> <span class="hljs-string">user_id</span> <span class="hljs-number">1001 </span><span class="hljs-string">expire_at</span> <span class="hljs-number">1690000000</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>便于快速读取和更新。</p>
<hr/>
<ol start="5">
<li>电商购物车</li>
</ol>
<p>用户购物车：</p>
<pre><code class="hljs language-bash" lang="bash">HSET cart:1001 product:2001 2   <span class="hljs-comment"># 商品2001数量为2</span>
HSET cart:1001 product:2002 1
HGETALL cart:1001
<span class="hljs-comment"># -&gt; {product:2001: 2, product:2002: 1}</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>高效支持单个商品增删改。</li>
</ul>
<h3 data-id="heading-2">二、 Set </h3>
<p>Redis 的 <strong>Set</strong> 是一个 <strong>无序、去重的集合</strong>，支持集合运算（交集、并集、差集）。</p>
<p>底层实现：</p>
<ol>
<li>intset（整数集合）</li>
</ol>
<ul>
<li>
<p>当 Set 里的元素：</p>
<ul>
<li>全部是整数</li>
<li>且数量较少（默认 ≤ 512）</li>
</ul>
</li>
<li>
<p>Redis 会用 <strong>intset</strong> 来存储。</p>
</li>
<li>
<p><strong>intset</strong> 本质是一个紧凑的数组，内部元素有序存放，不允许重复。</p>
</li>
<li>
<p>优点：</p>
<ul>
<li>节省内存（紧凑存储，类似 ziplist）</li>
<li>查找时可以用二分搜索 O(log N)</li>
</ul>
</li>
<li>
<p>缺点：</p>
<ul>
<li>只支持整数</li>
<li>超过数量阈值或混合非整数时会自动转为 hashtable</li>
</ul>
</li>
</ul>
<hr/>
<ol start="2">
<li>hashtable（字典）</li>
</ol>
<ul>
<li>
<p>当集合中：</p>
<ul>
<li>元素是字符串（非整数）</li>
<li>或者数量超过 <code>set-max-intset-entries</code>（默认 512）</li>
</ul>
</li>
<li>
<p>Redis 会用 <strong>哈希表</strong> 存储，每个元素作为 key，value 为空。</p>
</li>
<li>
<p>优点：</p>
<ul>
<li>查找、插入、删除的平均复杂度 O(1)</li>
<li>支持任意字符串</li>
</ul>
</li>
<li>
<p>缺点：</p>
<ul>
<li>相比 intset 占用更多内存</li>
</ul>
</li>
</ul>
<p>Set 在项目中的应用场景</p>
<p>Redis Set 因为具备 <strong>去重、无序、集合运算</strong> 的特性，在实际开发中非常有用。</p>
<ol>
<li>用户标签、兴趣、喜好</li>
</ol>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable constant_">SADD</span> <span class="hljs-symbol">user:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:tags</span> <span class="hljs-string">"sports"</span> <span class="hljs-string">"music"</span> <span class="hljs-string">"travel"</span>
<span class="hljs-variable constant_">SADD</span> <span class="hljs-symbol">user:</span><span class="hljs-number">1002</span><span class="hljs-symbol">:tags</span> <span class="hljs-string">"music"</span> <span class="hljs-string">"tech"</span>
<span class="hljs-variable constant_">SINTER</span> <span class="hljs-symbol">user:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:tags</span> <span class="hljs-symbol">user:</span><span class="hljs-number">1002</span><span class="hljs-symbol">:tags</span>   <span class="hljs-comment"># -&gt; 共同兴趣</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：推荐系统、兴趣匹配。</li>
</ul>
<hr/>
<ol start="2">
<li>去重功能</li>
</ol>
<p>比如存储唯一的访问 IP：</p>
<pre><code class="hljs language-bash" lang="bash">SADD ip:today <span class="hljs-string">"192.168.1.1"</span>
SADD ip:today <span class="hljs-string">"192.168.1.2"</span>
SCARD ip:today   <span class="hljs-comment"># -&gt; 今日独立 IP 数</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：统计 UV（Unique Visitor）</li>
</ul>
<hr/>
<ol start="3">
<li>关注/粉丝关系（社交应用）</li>
</ol>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">SADD</span> <span class="hljs-string">user:1001:follow</span> <span class="hljs-number">1002 </span><span class="hljs-number">1003 </span><span class="hljs-number">1004</span>   <span class="hljs-comment"># 用户1001关注的人</span>
<span class="hljs-string">SADD</span> <span class="hljs-string">user:1002:fans</span> <span class="hljs-number">1001</span>               <span class="hljs-comment"># 用户1002的粉丝</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>可以快速求交集：共同好友</li>
<li>可以计算差集：推荐可能认识的人</li>
</ul>
<hr/>
<ol start="4">
<li>黑名单/白名单</li>
</ol>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">SADD</span> <span class="hljs-string">blacklist</span> <span class="hljs-number">1001 </span><span class="hljs-number">1002</span>
<span class="hljs-string">SISMEMBER</span> <span class="hljs-string">blacklist</span> <span class="hljs-number">1003</span>   <span class="hljs-comment"># -&gt; 0 (不在黑名单)</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：权限控制、封禁用户</li>
</ul>
<hr/>
<ol start="5">
<li>抽奖/随机推荐</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">SADD lottery 101 102 103 104
SRANDMEMBER lottery 1   <span class="hljs-comment"># 随机抽一个</span>
SPOP lottery            <span class="hljs-comment"># 抽出并移除</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：抽奖系统、随机内容推荐</li>
</ul>
<h3 data-id="heading-3">三、 Zset </h3>
<p>底层实现：</p>
<p>Zset 底层主要有两种结构，和 Hash/Set 类似，也是 <strong>双结构实现</strong>：</p>
<p>1. ziplist（压缩列表，Redis 3.2 后改为 listpack）</p>
<ul>
<li>当元素个数较少，且 member/score 较小时使用。</li>
<li>元素以 <strong>score + member 紧凑存储</strong>，按 score 顺序排列。</li>
<li><strong>优点</strong>：节省内存。</li>
<li><strong>缺点</strong>：查询复杂度 O(N)，不适合大数据量。</li>
</ul>
<blockquote>
<p>触发条件（默认配置）：</p>
<ul>
<li><code>zset-max-ziplist-entries</code> ≤ 128</li>
<li><code>zset-max-ziplist-value</code> ≤ 64 字节</li>
</ul>
</blockquote>
<p>超过阈值时会自动转为 skiplist。</p>
<hr/>
<p>2.skiplist（跳表）+ dict</p>
<p>当数据量较大或元素较复杂时，Redis 使用 <strong>双结构</strong>：</p>
<ul>
<li><strong>哈希表（dict）</strong> ：存储 member → score 映射，支持 O(1) 查找。</li>
<li><strong>跳表（skiplist）</strong> ：按照 score 排序存储，支持范围查询和有序遍历。</li>
</ul>
<p>Zset 在项目中的应用场景</p>
<p>Zset 的最大特点就是 <strong>有序性</strong>，在项目中常用于需要排序的数据。</p>
<ol>
<li>排行榜（经典场景）</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">ZADD rank 100 user1
ZADD rank 200 user2
ZADD rank 150 user3
ZREVRANGE rank 0 2 WITHSCORES  <span class="hljs-comment"># 前三名</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：游戏排行榜、积分榜、热门内容排名。</li>
</ul>
<hr/>
<ol start="2">
<li>延时队列 / 定时任务</li>
</ol>
<p>利用 score 存储任务执行时间戳：</p>
<pre><code class="hljs language-bash" lang="bash">ZADD delay_queue 1690000000 <span class="hljs-string">"task1"</span>
ZADD delay_queue 1690000050 <span class="hljs-string">"task2"</span>
ZRANGEBYSCORE delay_queue 0 1690000000   <span class="hljs-comment"># 取到期任务</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：定时发送消息、延迟执行任务。</li>
</ul>
<hr/>
<ol start="3">
<li>消息队列（按优先级）</li>
</ol>
<p>利用 score 存储任务优先级：</p>
<pre><code class="hljs language-arduino" lang="arduino">ZADD queue <span class="hljs-number">1</span> <span class="hljs-string">"task_low"</span>
ZADD queue <span class="hljs-number">10</span> <span class="hljs-string">"task_high"</span>
ZPOPMIN queue   # 取优先级最高的任务
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：异步任务调度。</li>
</ul>
<hr/>
<ol start="4">
<li>时间序列数据（日志/点击流）</li>
</ol>
<p>利用 score 存储时间戳，member 存储事件 ID：</p>
<pre><code class="hljs language-arduino" lang="arduino">ZADD click_log <span class="hljs-number">1690000001</span> <span class="hljs-string">"click1"</span>
ZADD click_log <span class="hljs-number">1690000002</span> <span class="hljs-string">"click2"</span>
ZRANGEBYSCORE click_log <span class="hljs-number">1690000000</span> <span class="hljs-number">1690000100</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：网站访问日志、用户行为数据。</li>
</ul>
<hr/>
<ol start="5">
<li>推荐系统</li>
</ol>
<p>存储物品权重：</p>
<pre><code class="hljs language-arduino" lang="arduino">ZADD recommend <span class="hljs-number">0.95</span> <span class="hljs-string">"item1"</span>
ZADD recommend <span class="hljs-number">0.87</span> <span class="hljs-string">"item2"</span>
ZREVRANGE recommend <span class="hljs-number">0</span> <span class="hljs-number">9</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：推荐 top10 商品/内容。</li>
</ul>
<hr/>
<ol start="6">
<li>去重 + 排序</li>
</ol>
<p>例如“最近登录的用户”：</p>
<pre><code class="hljs language-arduino" lang="arduino">ZADD recent_login <span class="hljs-number">1690001000</span> <span class="hljs-string">"user1"</span>
ZADD recent_login <span class="hljs-number">1690002000</span> <span class="hljs-string">"user2"</span>
ZREVRANGE recent_login <span class="hljs-number">0</span> <span class="hljs-number">9</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li>应用：最近活跃用户列表。</li>
</ul>
<h3 data-id="heading-4">补充跳表（skiplist）内容：</h3>
<p>例子：有序集合存储一些数字</p>
<p>假设我们要往跳表里存 <code>10, 20, 30, 40</code>，节点高度是随机生成的。最终跳表大概长这样（简化表示）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Level 2:</span>   <span class="hljs-string">Head</span> <span class="hljs-string">→</span> <span class="hljs-number">10</span> <span class="hljs-string">→</span> <span class="hljs-number">30</span>
<span class="hljs-attr">Level 1:</span>   <span class="hljs-string">Head</span> <span class="hljs-string">→</span> <span class="hljs-number">10</span> <span class="hljs-string">→</span> <span class="hljs-number">20</span> <span class="hljs-string">→</span> <span class="hljs-number">30</span> <span class="hljs-string">→</span> <span class="hljs-number">40</span>
<span class="hljs-attr">Level 0:</span>   <span class="hljs-string">Head</span> <span class="hljs-string">→</span> <span class="hljs-number">10</span> <span class="hljs-string">→</span> <span class="hljs-number">20</span> <span class="hljs-string">→</span> <span class="hljs-number">30</span> <span class="hljs-string">→</span> <span class="hljs-number">40</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-5">1. 查找（Search）</h3>
<p>目标：查找 <strong>30</strong></p>
<ul>
<li>
<p>从最高层（Level 2）开始：Head → 10 → 30，找到目标。</p>
</li>
<li>
<p>如果查找 <strong>25</strong>：</p>
<ul>
<li>Level 2: Head → 10，下一步是 30 &gt; 25，不能走 → 下到 Level 1</li>
<li>Level 1: 从 10 → 20，下一步是 30 &gt; 25，不能走 → 下到 Level 0</li>
<li>Level 0: 从 20 → 30，发现 30 &gt; 25，停止 → 说明 25 不存在。</li>
</ul>
</li>
</ul>
<p>思路：先快跳，再精细走。</p>
<hr/>
<h3 data-id="heading-6">2. 插入（Insert）</h3>
<p>目标：插入 <strong>25</strong></p>
<ol>
<li>
<p>先“查找”25，记录每层最后一个小于 25 的节点（我们叫它 <code>update[]</code> 数组）。</p>
<ul>
<li>Level 2: 10</li>
<li>Level 1: 20</li>
<li>Level 0: 20</li>
</ul>
</li>
<li>
<p>随机生成新节点高度，比如高度=2（Level 0 和 Level 1）。</p>
</li>
<li>
<p>若随机高度为 <code>k</code>，则新节点会出现在 <strong>第 0 层到第 k-1 层</strong>（共 <code>k</code> 个层级）</p>
</li>
<li>
<p>更新指针：</p>
<ul>
<li>在 Level 0 和 Level 1，把 <code>20.forward</code> 改指向 <code>25</code>，<code>25.forward</code> 指向原来的下一个节点。</li>
</ul>
</li>
</ol>
<p>结果：25 被插入到合适位置。</p>
<hr/>
<h3 data-id="heading-7">3. 删除（Delete）</h3>
<p>目标：删除 <strong>20</strong></p>
<ol>
<li>
<p>查找 20，同时记录每层前驱节点（<code>update[]</code>）。</p>
<ul>
<li>Level 2: 前驱=10（20 不在这一层）</li>
<li>Level 1: 前驱=10</li>
<li>Level 0: 前驱=10</li>
</ul>
</li>
<li>
<p>更新指针：</p>
<ul>
<li>把前驱的 forward 改为跳过 20，直接指向 30。</li>
</ul>
</li>
<li>
<p>如果某一层删完后该层空了，就降低跳表的最大层数。</p>
</li>
</ol>
<p>结果：20 被移除，跳表结构依然有序。</p>
<hr/>
<p>总结规律</p>
<ul>
<li><strong>查找</strong>：从上层往下逐层跳，找到或确定不存在。</li>
<li><strong>插入</strong>：查找时顺便记录前驱 → 随机高度 → 修改前驱指针。</li>
<li><strong>删除</strong>：查找时顺便记录前驱 → 修改前驱指针跳过目标。</li>
</ul>
<h3 data-id="heading-8">总结：</h3>
<p>至此，Redis中常见的几种数据类型的底层实现就已完成讲解，后续会补充bitmap的底层实现，</p>
<p>最后，感谢大家的支持，学习过程中有任何问题都可以在评论区提出，我会及时为大家解答，谢谢大家！</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Draw Call从1388降到26：模型的"瘦身四部曲"]]></title>    <link>https://juejin.cn/post/7601757036485640202</link>    <guid>https://juejin.cn/post/7601757036485640202</guid>    <pubDate>2026-02-01T06:52:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601757036485640202" data-draft-id="7601169244454469658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Draw Call从1388降到26：模型的&quot;瘦身四部曲&quot;"/> <meta itemprop="keywords" content="cesium,WebGL"/> <meta itemprop="datePublished" content="2026-02-01T06:52:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="goodName"/> <meta itemprop="url" content="https://juejin.cn/user/767898264016683"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Draw Call从1388降到26：模型的"瘦身四部曲"
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/767898264016683/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    goodName
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:52:44.000Z" title="Sun Feb 01 2026 06:52:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">Draw Call从1388降到26：BIM模型的"瘦身四部曲"</h2>
<h3 data-id="heading-1">一、先上效果：四步优化的"恐怖"数据</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/577a187e94d64b00a0543e09a96c74a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29vZE5hbWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770533564&amp;x-signature=u1i8CybJ1VhM%2FvtBuQwCvsUM4l0%3D" alt="image.png" loading="lazy"/></p>
<p>直接看我们最直观的对比：</p>















































<table><thead><tr><th>阶段</th><th>核心操作</th><th>Draw Calls</th><th>体积</th><th>关键指标变化</th></tr></thead><tbody><tr><td>原始</td><td>直接导出</td><td><strong>1388</strong></td><td>18.29MB</td><td>每个构件独立渲染</td></tr><tr><td>Step1</td><td>校验修复</td><td>1388</td><td>18.29MB</td><td>去掉非法属性，为后续铺路</td></tr><tr><td>Step2</td><td>GPU实例化</td><td><strong>922</strong></td><td>15.17MB</td><td>15万+顶点转为实例渲染</td></tr><tr><td>Step3</td><td>Feature ID绑定</td><td>922</td><td>16.85MB</td><td>每个构件有了"身份证"</td></tr><tr><td>Step4</td><td>Mesh合并</td><td><strong>26</strong></td><td>34.86MB*</td><td><strong>终极绝杀，Draw Call降98%</strong></td></tr></tbody></table>
<p>*注：Step4体积暂时上涨是因为增加了顶点属性数据（Feature ID和颜色），下一篇用Draco压缩后会大幅回落，但Draw Call保持26不变。</p>
<p><strong>1388 → 26</strong>，这就是我们要聊的"黑魔法"。</p>
<h3 data-id="heading-2">二、优化总览：四步"整容"流程</h3>
<p>BIM模型（Revit导出）最大的病：<strong>每个构件都是独立的Mesh，几何双胞胎互不认识，CPU和GPU疯狂"传纸条"</strong>。</p>
<p>我们的解决方案分四步：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[原始模型&lt;br&gt;1388个Draw Calls] --&gt; B
    subgraph B [Step1: 清垃圾]
        B1[修复后&lt;br&gt;1388个Draw Calls]
        B2[删除非法属性&lt;br&gt;修复4字节对齐]
    end
    B --&gt; C
    subgraph C [Step2: 去重]
        C1[实例化后&lt;br&gt;922个Draw Calls]
        C2[EXT_mesh_gpu_instancing&lt;br&gt;相同几何变实例]
    end
    C --&gt; D
    subgraph D [Step3: 上户口]
        D1[增加Feature后&lt;br&gt;922个Draw Calls]
        D2[EXT_mesh_features&lt;br&gt;EXT_instance_features]
    end
    D --&gt; E
    subgraph E [Step4: 大合并]
        E1[最终&lt;br&gt;26个Draw Calls]
        E2[Mesh合并 + 顶点颜色&lt;br&gt;材质归类]
    end
</code></pre>
<p><strong>四个GLTF扩展的协作战术</strong>：</p>
<ul>
<li><code>EXT_mesh_gpu_instancing</code>：解决"重复构件"（如100扇相同的门）</li>
<li><code>EXT_mesh_features</code>：给<strong>非实例化</strong>构件上户口（顶点属性_Feature_ID）</li>
<li><code>EXT_instance_features</code>：给<strong>实例化</strong>构件上户口（每个实例一个ID）</li>
<li><code>EXT_structural_metadata</code>：建户口本（Property Table，存Element ID等业务数据）</li>
</ul>
<h3 data-id="heading-3">三、详细拆解：一步步杀死Draw Call</h3>
<h4 data-id="heading-4">Step 1：清垃圾 —— 修复GLTF校验错误</h4>
<p>Revit导出的GLB总是带着"私货"：<code>Qid</code>、<code>mid</code>、<code>mapsymbolId</code>...这些非标准属性会让Cesium验证器直接红温，甚至导致后续工具链报错。</p>
<p><strong>核心操作</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 给模型"洗澡"：删除非法属性</span>
<span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> gltf_data[<span class="hljs-string">'nodes'</span>]:
    node.pop(<span class="hljs-string">'Qid'</span>, <span class="hljs-literal">None</span>)          <span class="hljs-comment"># Revit的构件ID，但非标准</span>
    node.pop(<span class="hljs-string">'index'</span>, <span class="hljs-literal">None</span>)        <span class="hljs-comment"># 非法属性</span>
    node.pop(<span class="hljs-string">'mapsymbolId'</span>, <span class="hljs-literal">None</span>)  <span class="hljs-comment"># Cesium不认识</span>
    
    <span class="hljs-comment"># 删除空的children数组（洁癖操作）</span>
    <span class="hljs-keyword">if</span> node.get(<span class="hljs-string">'children'</span>) == []:
        <span class="hljs-keyword">del</span> node[<span class="hljs-string">'children'</span>]
</code></pre>
<p><strong>还有4字节对齐强迫症治疗</strong>：GLTF规范要求所有buffer数据必须4字节对齐，Revit经常"歪着站"，我们要把它"扶正"，否则GPU读取会报错。</p>
<h4 data-id="heading-5">Step 2：GPU实例化 —— 几何去重（EXT_mesh_gpu_instancing）</h4>
<p><strong>效果</strong>：Draw Call 1388 → 922（降33%）</p>
<p>原理：100扇 identical 的门，传统方式是画100次；实例化后是画1次，传100个变换矩阵。</p>
<p><strong>一键命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">gltf-transform instance input.glb output.glb --min 10
</code></pre>
<p>这时候看截图里的<code>Instanced vertices: 156312</code>，意味着这15万+顶点是通过实例化渲染的——它们共享<strong>同一份几何数据</strong>，只传不同的<code>translation/rotation/scale</code>。</p>
<p><strong>但有个问题</strong>：合并后怎么知道用户点了哪扇门？这就引出Step 3。</p>
<h4 data-id="heading-6">Step 3：Feature ID体系 —— 给构件"上户口"</h4>
<p>这是<strong>最硬核</strong>的部分。我们要在WebGL的顶点数据里藏一个"暗号"：<code>_FEATURE_ID_0</code>。</p>
<h5 data-id="heading-7">3.1 非实例化构件：EXT_mesh_features</h5>
<p>对于没被实例化的几何（如异形楼板），直接在顶点属性里塞ID：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 给每个顶点分配Feature ID（同一构件用相同ID）</span>
feature_ids = np.full(vertex_count, property_table_row, dtype=np.uint16)

<span class="hljs-comment"># 绑定到GLTF primitive</span>
prim[<span class="hljs-string">'attributes'</span>][<span class="hljs-string">'_FEATURE_ID_0'</span>] = feature_acc_idx
prim[<span class="hljs-string">'extensions'</span>][<span class="hljs-string">'EXT_mesh_features'</span>] = {
    <span class="hljs-string">'featureIds'</span>: [{
        <span class="hljs-string">'featureCount'</span>: unique_feature_ids,
        <span class="hljs-string">'attribute'</span>: <span class="hljs-number">0</span>,        <span class="hljs-comment"># 对应 _FEATURE_ID_0</span>
        <span class="hljs-string">'propertyTable'</span>: <span class="hljs-number">0</span>     <span class="hljs-comment"># 查哪张表</span>
    }]
}
</code></pre>
<h5 data-id="heading-8">3.2 实例化构件：EXT_instance_features</h5>
<p>对于那100扇门（实例化后只有一个Mesh），需要给每个实例一个ID：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 每个实例一个Feature ID</span>
feature_ids = np.arange(instance_count, dtype=np.uint32) + start_id

<span class="hljs-comment"># 放到instancing的attributes里（和TRANSLATION/ROTATION同级）</span>
attributes[<span class="hljs-string">'_FEATURE_ID_0'</span>] = feature_acc_idx

<span class="hljs-comment"># 在node上声明</span>
node[<span class="hljs-string">'extensions'</span>][<span class="hljs-string">'EXT_instance_features'</span>] = {
    <span class="hljs-string">'featureIds'</span>: [{
        <span class="hljs-string">'featureCount'</span>: instance_count,
        <span class="hljs-string">'attribute'</span>: <span class="hljs-number">0</span>,
        <span class="hljs-string">'propertyTable'</span>: <span class="hljs-number">0</span>
    }]
}
</code></pre>
<h5 data-id="heading-9">3.3 建户口本：EXT_structural_metadata</h5>
<p>光有ID不够，还要把ID映射到<strong>Element ID</strong>（Revit里的构件ID）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Property Table：Feature ID → Element ID</span>
{
  <span class="hljs-string">"schema"</span>: {
    <span class="hljs-string">"classes"</span>: {
      <span class="hljs-string">"class_element"</span>: {
        <span class="hljs-string">"properties"</span>: {
          <span class="hljs-string">"elementID"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"STRING"</span>},  <span class="hljs-comment">// 存"3579221"</span>
          <span class="hljs-string">"name"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"STRING"</span>}        <span class="hljs-comment">// 存"标准门"</span>
        }
      }
    }
  },
  <span class="hljs-string">"propertyTables"</span>: [{
    <span class="hljs-string">"class"</span>: <span class="hljs-string">"class_element"</span>,
    <span class="hljs-string">"count"</span>: <span class="hljs-number">1000</span>,
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"elementID"</span>: {<span class="hljs-string">"values"</span>: 指向buffer的accessor索引}
    }
  }]
}
</code></pre>
<p><strong>工作流</strong>：点击模型 → Cesium读<code>_FEATURE_ID_0</code>（比如42）→ 查Property Table第42行 → 得到<code>elementID: "3579221"</code> → 查业务库得知这是"三楼男厕所第二扇门"。</p>
<h4 data-id="heading-10">Step 4：Mesh合并 —— 终极杀招（降Draw Call核心）</h4>
<p><strong>效果</strong>：Draw Call 922 → <strong>26</strong>（降97%！）</p>
<p>实例化解决了"重复构件"，但还有大量<strong>独一无二</strong>的小构件（不同形状的梁、板、柱）。<strong>Mesh合并</strong>就是把相同材质的mesh全部"焊"在一起。</p>
<p><strong>分类策略</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 识别已被实例化的mesh（这些不能动！）</span>
instanced_meshes = get_instanced_mesh_indices(gltf_data)

<span class="hljs-comment"># 剩下的按材质分类</span>
textured = []       <span class="hljs-comment"># 有贴图的：按贴图合并</span>
opaque_solid = []   <span class="hljs-comment"># 不透明纯色：全部焊成一个mesh！</span>
transparent = []    <span class="hljs-comment"># 透明的：单独一个mesh（避免深度排序问题）</span>

<span class="hljs-comment"># 顶点数据直接拼接（注意要用世界矩阵变换，避免叠在原点）</span>
merged_vertices = np.vstack([m[<span class="hljs-string">'vertices'</span>] <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> opaque_solid])
merged_indices = np.concatenate([m[<span class="hljs-string">'indices'</span>] + offset <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> opaque_solid])
</code></pre>
<p><strong>为什么用顶点颜色（COLOR_0）？</strong></p>
<p>如果不这么做，每个不同颜色的构件都要切分一个Material，切换Material又会产生新的Draw Call！把颜色绑在顶点上，<strong>一个Material走天下</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 材质颜色 → 顶点颜色（RGBA）</span>
colors = np.tile(base_color * <span class="hljs-number">255</span>, (vertex_count, <span class="hljs-number">1</span>))
prim[<span class="hljs-string">'attributes'</span>][<span class="hljs-string">'COLOR_0'</span>] = color_acc_idx  <span class="hljs-comment"># VEC4 UNSIGNED_BYTE normalized</span>
</code></pre>
<p><strong>26个Draw Call的构成</strong>：</p>
<ul>
<li>若干贴图材质（每个贴图1个）</li>
<li>1个不透明纯色大mesh</li>
<li>1个透明mesh</li>
<li>若干实例化mesh（每个实例化对象1个）</li>
</ul>
<h3 data-id="heading-11">四、关键认知：为什么体积暂时变大了？</h3>
<p>注意到Step4后体积从16MB涨到了34MB？别慌，这是<strong>正常的中间态</strong>：</p>
<ol>
<li><strong>增加了<code>_FEATURE_ID_0</code></strong>：每个顶点+4字节（uint16对齐到4字节）</li>
<li><strong>增加了<code>COLOR_0</code></strong>：每个顶点+4字节（RGBA）</li>
<li><strong>存了Property Table</strong>：字符串数据（elementID等）</li>
</ol>
<p>但这些数据是<strong>高度可压缩</strong>的：</p>
<ul>
<li>几何数据（顶点位置、法线）用Draco压缩 → 能压掉70%</li>
<li>贴图用KTX2/Basis压缩 → 能压掉80%</li>
<li>Feature ID是连续整数，压缩率极高</li>
</ul>
<h3 data-id="heading-12">五、总结：优化的本质是"让CPU少说话"</h3>
<p>记住这个公式：</p>
<blockquote>
<p><strong>优化的本质不是让GPU少干活，而是让CPU少说话（减少Draw Call）。</strong></p>
</blockquote>
<ul>
<li><strong>Step1</strong>：解决"格式错误"（让工具链能处理）</li>
<li><strong>Step2</strong>：解决"重复几何"（100扇门画1次）</li>
<li><strong>Step3</strong>：解决"身份识别"（能拾取、能查询）</li>
<li><strong>Step4</strong>：解决"琐碎绘制"（把小碎块焊成大块）</li>
</ul>
<p>GPU表示："顶点数量你随便加（反正我并行计算快），但你别一直烦我（Draw Call太多）。"</p>
<h3 data-id="heading-13">六、加载：Cesium的加载效果</h3>
<p>基于你的要求，补充<strong>Step 6：Cesium实战效果</strong>——这是检验前面所有优化是否成功的"验金石"。毕竟，<strong>Draw Call从1388降到26，最终要在浏览器里跑起来才算数</strong>。</p>
<hr/>
<h3 data-id="heading-14">六、Cesium实战：丝滑帧率 + 指哪打哪的拾取</h3>
<p>前面所有优化都是"幕后工作"，现在看看台前效果——当模型在Cesium里跑起来，帧率稳了，鼠标指哪就能选中哪根梁、哪扇窗。</p>
<h4 data-id="heading-15">6.1 帧率对比：从PPT到丝滑</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1a83e615edb4d50970baecc086c719f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29vZE5hbWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770533564&amp;x-signature=B8CYw3jdrdmEzxw3mcr0ffpKvgk%3D" alt="image.png" loading="lazy"/></p>
<p><strong>为什么帧率提升这么明显？</strong></p>
<p>Cesium的渲染管线中，Draw Call是头号性能杀手。1388次绘制意味着CPU每帧要准备1388次渲染状态、切换材质、上传数据；而26次绘制时，CPU基本在"摸鱼"，GPU全力干活。</p>
<blockquote>
<p>💡 <strong>冷知识</strong>：在WebGL里，<strong>CPU准备渲染状态的时间往往比GPU实际绘制时间还长</strong>。这就是为什么减少Draw Call比减少顶点数更能提升帧率。</p>
</blockquote>
<h4 data-id="heading-16">6.2 拾取功能：终于能"指哪打哪"了</h4>
<p>优化前的问题：<strong>点半天选不中一根柱子</strong>，或者<strong>选中了不知道是哪个构件</strong>（没有Element ID关联业务数据）。</p>
<p>优化后，基于Step 3绑定的Feature ID体系，我们可以实现<strong>像素级精准拾取</strong>。</p>
<h5 data-id="heading-17">拾取原理回顾</h5>
<p>当用户在Cesium中点击模型时，发生了什么？</p>
<pre><code class="hljs language-css" lang="css">鼠标点击 → Cesium读取该像素深度 → 找到对应图元
    ↓
读取 _FEATURE_ID_0 值（比如 <span class="hljs-number">42</span>）
    ↓
查 EXT_structural_metadata 的 Property <span class="hljs-selector-tag">Table</span>
    ↓
第<span class="hljs-number">42</span>行 → elementID: <span class="hljs-string">"3579221"</span>, name: <span class="hljs-string">"标准门"</span>
    ↓
拿着<span class="hljs-number">3579221</span>去查业务数据库 → 展示构件信息
</code></pre>
<p><strong>对于实例化构件的特殊处理</strong>：</p>
<p>如果是那100扇门（实例化渲染），Cesium会自动处理<code>EXT_instance_features</code>，<code>pickedFeature.featureId</code>返回的是<strong>实例级别的ID</strong>（0-99），而不是网格级别的ID。这也是为什么我们在Step 3要给每个实例单独分配Feature ID。</p>
<p>Cesium中模型的解析原理，有机会会单独出一篇文章细说。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让图片学会“等你看到再出场”——懒加载全攻略]]></title>    <link>https://juejin.cn/post/7601169244454633498</link>    <guid>https://juejin.cn/post/7601169244454633498</guid>    <pubDate>2026-02-01T07:47:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601169244454633498" data-draft-id="7601169244454486042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让图片学会“等你看到再出场”——懒加载全攻略"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-01T07:47:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xiaoxue_"/> <meta itemprop="url" content="https://juejin.cn/user/4065372122398027"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让图片学会“等你看到再出场”——懒加载全攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4065372122398027/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xiaoxue_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:47:57.000Z" title="Sun Feb 01 2026 07:47:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">图片懒加载全解析：从传统 Scroll 到现代 IntersectionObserver</h2>
<p>在前端开发的世界里，性能优化永远是绕不开的核心话题✨。尤其是在电商、资讯、社交这类图片密集型的页面中，大量图片的加载往往会成为页面性能的 “绊脚石”—— 首屏加载慢吞吞，用户没耐心直接离开；非可视区域的图片白白消耗带宽，服务器压力也徒增。</p>
<p>而图片懒加载（Lazy Load）作为前端性能优化的 “明星方案”，正是为解决这些痛点而生。今天我们就从概念、原理到实战，全方位拆解图片懒加载的实现逻辑，对比传统与现代方案的优劣，让你彻底吃透这个高频考点！</p>
<h3 data-id="heading-1">一、什么是图片懒加载？🤔</h3>
<p>图片懒加载，本质是一种 “按需加载” 的资源加载策略：浏览器解析页面时，不会一次性加载所有<code>&lt;img&gt;</code>标签对应的图片，而是先加载<strong>首屏可视区域</strong>内的图片；当用户滚动页面，使原本隐藏在视口外的图片进入可视区域（Viewport）时，再触发这些图片的真实加载。</p>
<p>核心实现逻辑的关键是 “资源延迟绑定”：将图片的真实地址暂存到<code>data-src</code>（自定义属性）中，而非直接赋值给<code>src</code>属性（<code>src</code>先指向体积极小的占位图，如 1x1 透明图），只有满足 “进入视口” 条件时，才把<code>data-src</code>的值替换到<code>src</code>中，触发真实的图片 HTTP 请求。</p>
<h3 data-id="heading-2">二、为什么需要图片懒加载？💡</h3>
<p>没有懒加载的页面，浏览器解析<code>&lt;img&gt;</code>标签时，只要看到<code>src</code>属性就会立刻发起请求，这会带来两个致命问题：</p>
<ol>
<li><strong>首屏加载速度慢</strong>：首页的所有图片请求会和 HTML、CSS、JS 的加载 “抢占” 网络资源，导致首屏 HTML 渲染、样式加载被阻塞，用户面对空白页面的等待时间变长（数据显示，首屏加载超过 3 秒，用户流失率超 50%）。</li>
<li><strong>无效请求浪费</strong>：视口之外的图片（如下滚才能看到的列表项），加载后用户可能永远不会滚动到对应位置，既浪费了用户的移动带宽（尤其是移动端），也增加了服务器的并发压力。</li>
</ol>
<p>而懒加载的引入，恰好解决了这些问题：</p>
<ol>
<li>
<p>✅ 提升用户体验：首屏内容快速渲染，用户无需长时间等待；</p>
</li>
<li>
<p>✅ 节省带宽资源：仅加载用户能看到的图片，减少无效请求；</p>
</li>
<li>
<p>✅ 降低服务器压力：分散图片请求的时间和并发量，避免瞬间高并发。</p>
</li>
</ol>
<h3 data-id="heading-3">三、图片懒加载的解决方案核心🔑</h3>
<p>所有懒加载方案都围绕两个核心原则展开，缺一不可：</p>
<h4 data-id="heading-4">1. 首屏优先</h4>
<p>暂时不需要加载的图片，<code>src</code>属性先指向小体积占位图（如 1x1 透明图、加载中占位图），让浏览器优先加载 HTML、CSS、JS 等核心资源，保证首屏内容快速呈现。</p>
<h4 data-id="heading-5">2. 按需加载</h4>
<p>通过监听页面滚动（或原生 API 监听交集状态），实时判断图片是否进入视口；只有当图片进入视口时，才将<code>data-src</code>中的真实地址赋值给<code>src</code>，触发真实图片的加载。</p>
<h3 data-id="heading-6">四、如何实现图片懒加载？🛠️</h3>
<p>接下来我们从代码层面，拆解传统方案和现代方案的实现逻辑，对比两者的优劣。</p>
<h4 data-id="heading-7">1. 传统方案：监听滚动事件（onscroll + 节流）</h4>
<p>这是早期懒加载的主流实现方式，核心是 “监听滚动 + 节流控制 + 手动计算位置”。</p>
<h5 data-id="heading-8">1.1 核心思路</h5>
<p>① 图片预处理：给非首屏图片添加<code>lazy</code>类，<code>src</code>赋值占位图，真实地址存在<code>data-src</code>自定义属性中；② 节流控制：给<code>scroll</code>事件绑定节流函数，避免高频触发导致性能卡顿；③ 视口判断：滚动时遍历所有<code>lazy</code>图片，通过<code>getBoundingClientRect()</code>计算图片与视口的位置关系，判断是否进入视口；④ 加载图片：若图片进入视口，将<code>data-src</code>赋值给<code>src</code>，移除<code>lazy</code>类、添加<code>loaded</code>类（用于样式过渡），并移除<code>data-src</code>属性；⑤ 初始化检查：页面加载完成后，先执行一次懒加载判断，避免首屏内的<code>lazy</code>图片未加载。</p>
<h5 data-id="heading-9">1.2 代码</h5>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 节流函数：控制函数高频触发，避免滚动时性能卡顿</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">func, wait</span>) {
    <span class="hljs-keyword">let</span> timeout = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 定时器标识，用于控制执行时机</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (!timeout) { <span class="hljs-comment">// 若定时器不存在，说明可以执行函数</span>
            timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// 执行目标函数，保留this和参数</span>
                timeout = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 执行完成后重置定时器</span>
            }, wait);
        }
    };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> lazyImages = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'img.lazy'</span>); <span class="hljs-comment">// 获取所有待加载的图片</span>
    <span class="hljs-keyword">const</span> windowHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>; <span class="hljs-comment">// 获取视口高度</span>

    lazyImages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
        <span class="hljs-comment">// 跳过已加载的图片（已移除lazy类）</span>
        <span class="hljs-keyword">if</span> (!img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'lazy'</span>)) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">const</span> rect = img.<span class="hljs-title function_">getBoundingClientRect</span>(); <span class="hljs-comment">// 获取图片的位置信息（相对于视口）</span>
        <span class="hljs-comment">// 核心判断：图片顶部进入视口下方，且底部未完全离开视口上方 → 图片进入视口</span>
        <span class="hljs-keyword">if</span> (rect.<span class="hljs-property">top</span> &lt; windowHeight &amp;&amp; rect.<span class="hljs-property">bottom</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Loading image via Scroll:'</span>, img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>);
                img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>; <span class="hljs-comment">// 替换src，触发真实图片加载</span>
                img.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">'data-src'</span>); <span class="hljs-comment">// 移除自定义属性，避免重复加载</span>
                img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'lazy'</span>); <span class="hljs-comment">// 移除lazy类，标记为已加载</span>
                img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'loaded'</span>); <span class="hljs-comment">// 添加loaded类，实现透明度过渡</span>
            }
        }
    });
}

<span class="hljs-comment">// 节流处理懒加载函数，200ms执行一次</span>
<span class="hljs-keyword">const</span> throttledLazyLoad = <span class="hljs-title function_">throttle</span>(lazyLoad, <span class="hljs-number">200</span>);

<span class="hljs-comment">// 监听滚动事件，触发节流后的懒加载</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, throttledLazyLoad);
<span class="hljs-comment">// 窗口大小变化时，重新判断图片位置</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, throttledLazyLoad);
<span class="hljs-comment">// 页面加载完成后，初始化检查首屏图片</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, lazyLoad);
</code></pre>
<h5 data-id="heading-10">1.3 代码实现效果</h5>
<p><strong>观察界面滚动图片变化与控制台打印：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cd90f5fa5554c5281f1b6dc818fd331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537575&amp;x-signature=xhErIlk0BEFQZlDKyDSRUVcEiGA%3D" alt="QQ20260201-145940.gif" loading="lazy"/></p>
<h5 data-id="heading-11">1.4 该方案的缺点</h5>
<p>❌ 性能损耗：即使加了节流，<code>scroll</code>事件仍会高频触发，存在一定的性能开销；❌ 代码冗余：需要手动计算元素与视口的位置关系，逻辑易出错，维护成本高；❌ 适配性差：在移动端、嵌套滚动等复杂布局中，位置计算容易失效，适配成本高。</p>
<h5 data-id="heading-12">1.5 关键 API 解析</h5>
<ul>
<li>
<p><code>throttle (func, wait)</code>：自定义节流函数，控制高频事件触发频率，避免性能卡顿。</p>
<ul>
<li><code>func</code>：需要被节流的目标函数（此处为 <code>lazyLoad</code>）；</li>
<li><code>wait</code>：节流等待时间（毫秒），此处为 200ms，即函数每 200ms 最多执行一次；</li>
</ul>
</li>
<li>
<p><code>document.querySelectorAll ('img.lazy')</code>：根据 <code>CSS</code> 选择器获取所有带 <code>lazy</code> 类的待加载图片，返回 <code>NodeList</code> 集合。</p>
</li>
<li>
<p><code>window.innerHeight</code>：获取当前浏览器视口的高度，用于判断图片是否进入视口。</p>
</li>
<li>
<p><code>Element.classList.contains ('lazy')</code>：布尔值，判断图片元素是否包含 <code>lazy </code>类，跳过已加载的图片。</p>
</li>
<li>
<p><code>Element.getBoundingClientRect ()</code>：获取元素相对于视口的位置信息（返回 <code>DOMRect</code> 对象），包含 <code>top</code>（元素顶部距视口顶部距离）、<code>bottom</code>（元素底部距视口顶部距离）等属性。</p>
</li>
<li>
<p><code>img.removeAttribute ('data-src')</code>：移除图片的 <code>data-src</code> 属性，避免重复读取。</p>
</li>
<li>
<p><code>Element.classList.remove ('lazy')</code>：移除图片的 <code>lazy</code> 类，标记为已加载。</p>
</li>
<li>
<p><code>Element.classList.add ('loaded')</code>：为图片添加 <code>loaded</code> 类，实现加载后的样式过渡。</p>
</li>
<li>
<p><code>document.addEventListener ('scroll', throttledLazyLoad)</code>：监听页面滚动事件，触发节流后的懒加载函数。</p>
</li>
<li>
<p><code>window.addEventListener ('resize', throttledLazyLoad)</code>：监听窗口大小变化事件，重新判断图片位置，适配视口尺寸变化。</p>
</li>
<li>
<p><code>document.addEventListener ('DOMContentLoaded', lazyLoad)</code>：监听 <code>DOM</code> 加载完成事件，初始化执行懒加载函数，检查首屏图片是否需要加载。</p>
</li>
</ul>
<h4 data-id="heading-13">2. 现代方案：IntersectionObserver（推荐）🌟</h4>
<p>为了解决传统方案的痛点，浏览器原生提供了<code>IntersectionObserver</code> API（交集观察器），专门用于监听 “元素是否进入视口 / 与其他元素产生交集”，是目前懒加载的最优解。</p>
<h5 data-id="heading-14">2.1 核心思路</h5>
<p>① 浏览器原生支持：无需手动监听<code>scroll</code>、<code>resize</code>等事件，由浏览器底层优化执行逻辑；② 交集监听：创建<code>IntersectionObserver</code>实例，指定观察的目标元素（<code>lazy</code>图片）；③ 自动判断：当目标元素与视口产生交集（满足阈值条件）时，触发回调函数；④ 加载图片：在回调中替换<code>data-src</code>到<code>src</code>，移除<code>lazy</code>类，停止观察该元素（避免重复触发）；⑤ 降级处理：若浏览器不支持该 API，直接加载所有图片，保证功能可用。</p>
<h5 data-id="heading-15">2.2 代码</h5>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"DOMContentLoaded"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> lazyImages = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">"img.lazy"</span>); <span class="hljs-comment">// 获取所有待加载图片</span>

    <span class="hljs-comment">// 检查浏览器是否支持IntersectionObserver</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"IntersectionObserver"</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
        <span class="hljs-comment">// 创建交集观察器实例</span>
        <span class="hljs-keyword">const</span> imageObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">entries, observer</span>) {
            <span class="hljs-comment">// 遍历所有被观察的元素的交集状态</span>
            entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">entry</span>) {
                <span class="hljs-comment">// entry.isIntersecting：元素是否进入视口（产生交集）</span>
                <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
                    <span class="hljs-keyword">const</span> img = entry.<span class="hljs-property">target</span>; <span class="hljs-comment">// 获取当前触发的图片元素</span>
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Loading image via IntersectionObserver:'</span>, img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>);
                    img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>; <span class="hljs-comment">// 替换src，加载真实图片</span>
                    img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">"lazy"</span>); <span class="hljs-comment">// 标记为已加载</span>
                    img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">"loaded"</span>); <span class="hljs-comment">// 添加样式过渡类</span>
                    observer.<span class="hljs-title function_">unobserve</span>(img); <span class="hljs-comment">// 停止观察该图片，避免重复触发</span>
                }
            });
        }, {
            <span class="hljs-attr">root</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 观察的根元素：null表示视口</span>
            <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">"0px"</span>, <span class="hljs-comment">// 根元素的边距，扩展/缩小观察区域</span>
            <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span> <span class="hljs-comment">// 阈值：图片10%可见时触发回调</span>
        });

        <span class="hljs-comment">// 遍历所有lazy图片，开始观察</span>
        lazyImages.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">image</span>) {
            imageObserver.<span class="hljs-title function_">observe</span>(image);
        });
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 降级处理：不支持时直接加载所有图片</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"IntersectionObserver not supported, loading all images."</span>);
        lazyImages.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">img</span>) {
            img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>;
            img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">"lazy"</span>);
            img.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">"loaded"</span>);
        });
    }
});
</code></pre>
<h5 data-id="heading-16">2.3 代码实现效果</h5>
<p><strong>观察界面滚动图片变化与控制台打印：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba1d949fbc46426f8f192108455f7cf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3h1ZV8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537575&amp;x-signature=dpj0oawpRR9xugVZrG5LBLOpkzI%3D" alt="QQ20260201-151226.gif" loading="lazy"/></p>
<h5 data-id="heading-17">2.4 该方案的优势</h5>
<p>✅ 无性能损耗：浏览器底层实现，无需手动节流 / 防抖，性能远超<code>scroll</code>监听；✅ 代码简洁：无需手动计算元素位置，逻辑清晰，维护成本低；✅ 适配性强：完美兼容移动端、嵌套滚动等复杂布局；✅ 可扩展：支持自定义观察规则（如<code>rootMargin</code>扩展观察区域、<code>threshold</code>调整触发阈值）。</p>
<h5 data-id="heading-18">2.5 关键 API 解析</h5>
<ul>
<li>
<p><code>IntersectionObserver(callback, options)</code>：构造函数，创建交集观察器实例。</p>
<ul>
<li>
<p><code>callback</code>：交集状态变化时的回调函数，接收两个参数：</p>
<ul>
<li><code>entries</code>：数组，每个元素是<code>IntersectionObserverEntry</code>对象，包含元素的交集状态、位置等信息；</li>
<li><code>observer</code>：当前的<code>IntersectionObserver</code>实例。</li>
</ul>
</li>
<li>
<p><code>options</code>：配置项（可选）：</p>
<ul>
<li><code>root</code>：观察的根元素，默认<code>null</code>（视口）；</li>
<li><code>rootMargin</code>：根元素的边距，格式同 CSS margin（如 "100px 0"），可扩展 / 缩小观察区域；</li>
<li><code>threshold</code>：触发回调的阈值（0~1），0 表示元素刚进入视口就触发，1 表示元素完全进入视口才触发。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>entry.isIntersecting</code>：布尔值，判断元素是否与根元素产生交集（进入视口）。</p>
</li>
<li>
<p><code>observer.observe(target)</code>：开始观察指定的目标元素。</p>
</li>
<li>
<p><code>observer.unobserve(target)</code>：停止观察指定的目标元素。</p>
</li>
</ul>
<h3 data-id="heading-19">五、CSS 与 HTML 代码</h3>
<p><strong>CSS：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-comment">/* 页面基础样式 */</span>
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">text-align</span>: center;
        }

        <span class="hljs-comment">/* 
         * 空白间隔区样式
         * 用于撑开页面高度，模拟长页面滚动效果
         */</span>
        <span class="hljs-selector-class">.spacer</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">150vh</span>;
            <span class="hljs-comment">/* 核心：高度设置为 1.5 倍视口高度 (150vh) */</span>
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">flex-direction</span>: column;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: flex-start;
            <span class="hljs-comment">/* 内容从顶部开始排列 */</span>
            <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">50vh</span>;
            <span class="hljs-comment">/* 核心：提示词距离顶部 1/3 (50vh / 150vh ≈ 0.33) */</span>
            <span class="hljs-attribute">box-sizing</span>: border-box;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f9f9f9</span>;
            <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
        }

        <span class="hljs-comment">/* 图片容器样式 */</span>
        <span class="hljs-selector-class">.image-wrapper</span> {
            <span class="hljs-attribute">padding</span>: <span class="hljs-number">50px</span> <span class="hljs-number">0</span>;
            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
            <span class="hljs-attribute">min-height</span>: <span class="hljs-number">400px</span>;
            <span class="hljs-comment">/* 最小高度，防止图片加载前高度塌陷 */</span>
            <span class="hljs-attribute">display</span>: flex;
            <span class="hljs-attribute">align-items</span>: center;
            <span class="hljs-attribute">justify-content</span>: center;
        }

        <span class="hljs-comment">/* 
         * 懒加载图片样式
         * .lazy 类表示图片尚未加载
         */</span>
        <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.lazy</span> {
            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">80%</span>;
            <span class="hljs-attribute">height</span>: auto;
            <span class="hljs-attribute">display</span>: block;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.3</span>;
            <span class="hljs-comment">/* 初始低透明度，显示占位效果 */</span>
            <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.5s</span>;
            <span class="hljs-comment">/* 添加过渡效果，使加载更平滑 */</span>
        }

        <span class="hljs-comment">/* 
         * 图片加载完成后的样式
         * .loaded 类在 JS 中加载完成后添加
         */</span>
        <span class="hljs-selector-tag">img</span><span class="hljs-selector-class">.loaded</span> {
            <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
            <span class="hljs-comment">/* 恢复完全不透明 */</span>
        }

        <span class="hljs-selector-tag">h1</span>,
        <span class="hljs-selector-tag">h2</span> {
            <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>HTML</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 
      第一部分：首屏空白区
      作用：展示标题和提示，迫使用户向下滚动
    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spacer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>传统懒加载方案<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>⬇️ 向下滑动加载第一张图片 ⬇️<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 
      第二部分：第一张图片
      data-src 存储真实图片地址，src 存储占位图
    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-wrapper"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lazy"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img10.360buyimg.com/wq/jfs/t24601/190/890984006/4559/731564fc/5b7f9b7bN3ccd29ab.png"</span>
            <span class="hljs-attr">data-src</span>=<span class="hljs-string">"https://img.36krcdn.com/hsossms/20260119/v2_53cad3f2226f48e2afc1942de3ab74e4@5888275@ai_oswg1141728oswg1053oswg495_img_png~tplv-1marlgjv7f-ai-v3:960:400:960:400:q70.jpg?x-oss-process=image/format,webp"</span>
            <span class="hljs-attr">alt</span>=<span class="hljs-string">"Image 1"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 
      第三部分：中间间隔区
      作用：分隔两张图片，确保加载第二张图片需要继续大幅滚动
    --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spacer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>⬇️ 向下滑动出现第二张图片 ⬇️<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 第四部分：第二张图片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image-wrapper"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lazy"</span>
            <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img10.360buyimg.com/wq/jfs/t24601/190/890984006/4559/731564fc/5b7f9b7bN3ccd29ab.png"</span>
            <span class="hljs-attr">data-src</span>=<span class="hljs-string">"https://img.36krcdn.com/hsossms/20260117/v2_1e74add07bb94971845c777e0ce87a49@000000@ai_oswg421938oswg1536oswg722_img_000~tplv-1marlgjv7f-ai-v3:960:400:960:400:q70.jpg?x-oss-process=image/format,webp"</span>
            <span class="hljs-attr">alt</span>=<span class="hljs-string">"Image 2"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 底部留白，确保能滚到底部，方便观察最后一张图的加载 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 50vh; background-color: #f9f9f9;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h3 data-id="heading-20">六、面试官会问🤨</h3>
<ol>
<li><strong>图片懒加载的核心原理是什么？</strong></li>
</ol>
<p>答：核心是 “按需加载”，将非首屏图片的真实地址存到<code>data-src</code>（自定义属性），<code>src</code>指向占位图；通过监听滚动（传统）或<code>IntersectionObserver</code>（现代）判断图片是否进入视口，进入后将<code>data-src</code>赋值给<code>src</code>，触发真实图片加载。</p>
<ol start="2">
<li><strong>传统懒加载方案中，为什么要使用节流函数？</strong></li>
</ol>
<p>答：<code>scroll</code>事件会在滚动过程中高频触发（每秒数十次），若直接执行懒加载逻辑，会导致大量 DOM 操作和计算，引发页面卡顿；节流函数能控制函数在指定时间内只执行一次，减少性能损耗。</p>
<ol start="3">
<li><strong>IntersectionObserver 相比传统 scroll 方案有哪些优势？</strong></li>
</ol>
<p>答：① 性能更好：浏览器底层优化，无需手动节流；② 代码更简洁：无需手动计算元素位置；③ 适配性强：兼容复杂布局；④ 可扩展：支持自定义观察规则。</p>
<ol start="4">
<li><strong>如何判断一个元素是否进入视口？</strong></li>
</ol>
<p>答：传统方案用<code>element.getBoundingClientRect()</code>获取元素的位置信息，判断<code>rect.top &lt; window.innerHeight &amp;&amp; rect.bottom &gt; 0</code>；现代方案直接通过<code>IntersectionObserver</code>的<code>isIntersecting</code>属性判断。</p>
<ol start="5">
<li><strong>懒加载的降级方案是什么？</strong></li>
</ol>
<p>答：若浏览器不支持<code>IntersectionObserver</code>（如部分老旧浏览器），直接遍历所有<code>lazy</code>图片，将<code>data-src</code>赋值给<code>src</code>，保证图片能正常加载。</p>
<h3 data-id="heading-21">七、结语🎯</h3>
<p>图片懒加载作为前端性能优化的 “基础操作”，其核心始终是 “按需加载”—— 优先保证首屏体验，减少无效资源消耗。传统的<code>scroll+节流</code>方案兼容旧浏览器，但存在性能和适配痛点；而<code>IntersectionObserver</code>作为现代方案，凭借浏览器原生优化、简洁的代码逻辑，成为当前懒加载的首选。</p>
<p>在实际开发中，我们需要根据项目的兼容需求选择方案：若需兼容老旧浏览器，可采用 “IntersectionObserver+scroll 降级” 的混合方案；若面向现代浏览器，直接使用<code>IntersectionObserver</code>即可。</p>
<p>性能优化没有银弹，但图片懒加载是列表类页面（电商、资讯、社交）的 “必做优化”，小小的改动就能显著提升页面加载速度和用户体验。希望这篇文章能帮你彻底吃透图片懒加载，无论是面试还是实战，都能游刃有余！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙next openCustomDialog 自定义弹窗进阶版 再战江湖]]></title>    <link>https://juejin.cn/post/7601076976442621992</link>    <guid>https://juejin.cn/post/7601076976442621992</guid>    <pubDate>2026-02-01T08:01:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076976442621992" data-draft-id="7601313474719203363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙next openCustomDialog 自定义弹窗进阶版 再战江湖  "/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-02-01T08:01:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xq9527"/> <meta itemprop="url" content="https://juejin.cn/user/1239904848712184"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙next openCustomDialog 自定义弹窗进阶版 再战江湖  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904848712184/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xq9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:01:18.000Z" title="Sun Feb 01 2026 08:01:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">前言导读</h5>
<p>之前我写过一篇关于  openCustomDialog 自定义弹窗的文档 ，但是在后面的开发过程中发现这个管理起来特别麻烦，所以我就写了这个进阶版本，能够更好管理弹窗的现实和隐藏 以及弹窗清栈操作等等。
使用 <strong>BaseDialog + DialogManager</strong>  来管理的我们的弹窗</p>
<h5 data-id="heading-1">效果图</h5>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d6ed50fb1f435da46886b903501c9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHE5NTI3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770537679&amp;x-signature=T5hzsVt43ZlxpEyhmZqh4mGFo8Y%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-2">用到的技术点</h5>
<p>openCustomDialog 来实现,自定义弹窗 openCustomDialog 可以看之前的文章</p>
<p><a href="https://juejin.cn/post/7492688487265222693" title="https://juejin.cn/post/7492688487265222693" target="_blank">鸿蒙next openCustomDialog 实现不依赖UI的自定义弹窗</a></p>
<h2 data-id="heading-3">HarmonyOS 弹窗管理系统使用文档</h2>
<h3 data-id="heading-4">一、概述</h3>
<p>本弹窗管理系统采用 <strong>BaseDialog + DialogManager</strong> 架构，实现了弹窗的统一管理、复用和扩展。</p>
<h4 data-id="heading-5">架构特点</h4>
<ul>
<li><strong>单例模式</strong>：DialogManager 采用单例设计，全局统一管理</li>
<li><strong>泛型支持</strong>：BaseDialog 支持泛型参数，灵活适配不同弹窗</li>
<li><strong>弹窗栈管理</strong>：使用栈结构管理弹窗层级，支持多弹窗叠加</li>
<li><strong>自动适配</strong>：自动检测屏幕方向，适配横竖屏布局</li>
</ul>
<hr/>
<h3 data-id="heading-6">二、文件结构</h3>
<pre><code class="hljs language-bash" lang="bash">pages/
├── BaseDialog.ets          <span class="hljs-comment"># 弹窗基类</span>
├── DialogManger.ets        <span class="hljs-comment"># 弹窗管理器</span>
└── PrivacyPolicyDialog.ets <span class="hljs-comment"># 隐私政策弹窗示例</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">三、核心类说明</h3>
<h4 data-id="heading-8">3.1 BaseDialog</h4>
<p>弹窗基类，封装通用弹窗逻辑。</p>









































<table><thead><tr><th>方法</th><th>参数</th><th>返回值</th><th>说明</th></tr></thead><tbody><tr><td><code>show(params, options?)</code></td><td>params: T, options?: DialogOptions</td><td>Promise</td><td>显示弹窗</td></tr><tr><td><code>hide()</code></td><td>-</td><td>Promise</td><td>隐藏弹窗</td></tr><tr><td><code>update(params)</code></td><td>params: T</td><td>void</td><td>更新弹窗内容</td></tr><tr><td><code>getIsShowing()</code></td><td>-</td><td>boolean</td><td>获取弹窗显示状态</td></tr><tr><td><code>getDialogType()</code></td><td>-</td><td>DialogType</td><td>获取弹窗类型</td></tr></tbody></table>
<h4 data-id="heading-9">3.2 DialogManager</h4>
<p>弹窗管理器，统一管理所有弹窗。</p>

































































<table><thead><tr><th>方法</th><th>参数</th><th>返回值</th><th>说明</th></tr></thead><tbody><tr><td><code>getInstance()</code></td><td>-</td><td>DialogManager</td><td>获取单例实例</td></tr><tr><td><code>init()</code></td><td>-</td><td>DialogManager</td><td>初始化管理器</td></tr><tr><td><code>registerDialog(type, builder)</code></td><td>DialogType, WrappedBuilder</td><td>DialogManager</td><td>注册弹窗</td></tr><tr><td><code>show(type, params?, options?)</code></td><td>DialogType, T?, DialogOptions?</td><td>Promise</td><td>显示弹窗</td></tr><tr><td><code>hide(type)</code></td><td>DialogType</td><td>Promise</td><td>隐藏弹窗</td></tr><tr><td><code>hideAll()</code></td><td>-</td><td>Promise</td><td>隐藏所有弹窗</td></tr><tr><td><code>hideTop()</code></td><td>-</td><td>Promise</td><td>隐藏最顶层弹窗</td></tr><tr><td><code>isShowing(type)</code></td><td>DialogType</td><td>boolean</td><td>检查弹窗是否显示</td></tr><tr><td><code>hasDialogShowing()</code></td><td>-</td><td>boolean</td><td>检查是否有弹窗显示</td></tr></tbody></table>
<h4 data-id="heading-10">3.3 DialogType 枚举</h4>
<pre><code class="hljs language-ini" lang="ini">export enum DialogType {
  <span class="hljs-attr">PRIVACY_POLICY</span> = <span class="hljs-string">'privacy_policy'</span>,  // 隐私政策弹窗
  <span class="hljs-attr">USER_PROTOCOL</span> = <span class="hljs-string">'user_protocol'</span>,    // 用户协议弹窗
  <span class="hljs-attr">EXIT_CONFIRM</span> = <span class="hljs-string">'exit_confirm'</span>,      // 退出确认弹窗
  <span class="hljs-attr">LOADING</span> = <span class="hljs-string">'loading'</span>,                // 加载弹窗
  <span class="hljs-attr">ALERT</span> = <span class="hljs-string">'alert'</span>,                    // 提示弹窗
  <span class="hljs-attr">CONFIRM</span> = <span class="hljs-string">'confirm'</span>,                // 确认弹窗
  <span class="hljs-attr">CUSTOM</span> = <span class="hljs-string">'custom'</span>                   // 自定义弹窗
}
</code></pre>
<h4 data-id="heading-11">3.4 DialogOptions 配置</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DialogOptions</span> {
  alignment?: <span class="hljs-title class_">DialogAlignment</span>;           <span class="hljs-comment">// 弹窗位置，默认 Center</span>
  isModal?: <span class="hljs-built_in">boolean</span>;                     <span class="hljs-comment">// 是否模态，默认 true</span>
  autoCancel?: <span class="hljs-built_in">boolean</span>;                  <span class="hljs-comment">// 点击遮罩是否关闭，默认 false</span>
  keyboardAvoidMode?: <span class="hljs-title class_">KeyboardAvoidMode</span>; <span class="hljs-comment">// 键盘避让模式，默认 NONE</span>
  maskColor?: <span class="hljs-title class_">ResourceColor</span>;             <span class="hljs-comment">// 遮罩颜色</span>
  onWillDismiss?: <span class="hljs-function">(<span class="hljs-params">action</span>) =&gt;</span> <span class="hljs-built_in">void</span>;      <span class="hljs-comment">// 弹窗即将关闭回调</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-12">四、使用示例</h3>
<h4 data-id="heading-13">4.1 初始化（在 EntryAbility 中）</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> { <span class="hljs-type">DialogManager</span> } from '../pages/<span class="hljs-type">DialogManger</span>';

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UIAbility</span> </span>{
  onCreate(want: <span class="hljs-type">Want</span>, launchParam: <span class="hljs-type">AbilityConstant</span>.<span class="hljs-type">LaunchParam</span>): void {
    <span class="hljs-comment">// 初始化弹窗管理器</span>
    <span class="hljs-type">DialogManager</span>.getInstance().init();
  }
}
</code></pre>
<h4 data-id="heading-14">4.2 显示/隐藏弹窗</h4>
<pre><code class="hljs language-csharp" lang="csharp">import { DialogManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/DialogManger'</span>;
import { DialogType } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/BaseDialog'</span>;

<span class="hljs-comment">// 方式一：使用便捷方法</span>
<span class="hljs-keyword">await</span> DialogManager.getInstance().showPrivacyPolicyDialog();
<span class="hljs-keyword">await</span> DialogManager.getInstance().hidePrivacyPolicyDialog();

<span class="hljs-comment">// 方式二：使用通用方法</span>
<span class="hljs-keyword">await</span> DialogManager.getInstance().show(DialogType.PRIVACY_POLICY);
<span class="hljs-keyword">await</span> DialogManager.getInstance().hide(DialogType.PRIVACY_POLICY);

<span class="hljs-comment">// 方式三：带参数显示</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">params</span> = <span class="hljs-keyword">new</span> PrivacyPolicyParams();
<span class="hljs-keyword">params</span>.title = <span class="hljs-string">"自定义标题"</span>;
<span class="hljs-keyword">await</span> DialogManager.getInstance().show(DialogType.PRIVACY_POLICY, <span class="hljs-keyword">params</span>);
</code></pre>
<h4 data-id="heading-15">4.3 自定义弹窗配置</h4>
<pre><code class="hljs language-ini" lang="ini">import { DialogOptionsImpl } from '../pages/BaseDialog'<span class="hljs-comment">;</span>

const <span class="hljs-attr">options</span> = new DialogOptionsImpl()<span class="hljs-comment">;</span>
<span class="hljs-attr">options.alignment</span> = DialogAlignment.Bottom<span class="hljs-comment">;</span>
<span class="hljs-attr">options.isModal</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
<span class="hljs-attr">options.autoCancel</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
<span class="hljs-attr">options.maskColor</span> = <span class="hljs-string">'#80000000'</span><span class="hljs-comment">;</span>

await DialogManager.getInstance().show(DialogType.PRIVACY_POLICY, params, options)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-16">4.4 批量关闭弹窗</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 关闭所有弹窗</span>
await DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.hideAll</span>();

<span class="hljs-comment">// 关闭最顶层弹窗</span>
await DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.hideTop</span>();
</code></pre>
<h4 data-id="heading-17">4.5 查询弹窗状态</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 检查特定弹窗是否显示</span>
if (DialogManager.getInstance()<span class="hljs-selector-class">.isShowing</span>(DialogType.PRIVACY_POLICY)) {
  console<span class="hljs-selector-class">.log</span>('隐私政策弹窗正在显示');
}

<span class="hljs-comment">// 检查是否有任何弹窗显示</span>
if (DialogManager.getInstance()<span class="hljs-selector-class">.hasDialogShowing</span>()) {
  console<span class="hljs-selector-class">.log</span>(`当前有 ${DialogManager.getInstance()<span class="hljs-selector-class">.getShowingCount</span>()} 个弹窗`);
}

<span class="hljs-comment">// 获取所有正在显示的弹窗类型</span>
const showingDialogs = DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.getShowingDialogs</span>();
</code></pre>
<hr/>
<h3 data-id="heading-18">五、自定义弹窗开发指南</h3>
<h4 data-id="heading-19">5.1 创建弹窗参数类</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">IBaseDialogParams</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./BaseDialog'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDialogParams</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBaseDialogParams</span> {
  flag?: <span class="hljs-built_in">boolean</span>;           <span class="hljs-comment">// 必须：屏幕方向标志</span>
  title?: <span class="hljs-built_in">string</span>;           <span class="hljs-comment">// 自定义参数</span>
  content?: <span class="hljs-built_in">string</span>;
  onConfirm?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  onCancel?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">"默认标题"</span>;
  }
}
</code></pre>
<h4 data-id="heading-20">5.2 创建弹窗组件</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Component</span>
export struct MyDialog {
  param: MyDialogParams = new <span class="hljs-built_in">MyDialogParams</span>();

  <span class="hljs-built_in">build</span>() {
    <span class="hljs-built_in">Column</span>() {
      Text(this.param.title)
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">20</span>)
        <span class="hljs-selector-class">.fontWeight</span>(FontWeight.Bold)
      
      Text(this.param.content)
        <span class="hljs-selector-class">.fontSize</span>(<span class="hljs-number">16</span>)
        <span class="hljs-selector-class">.margin</span>({ top: <span class="hljs-number">10</span> })
      
      <span class="hljs-built_in">Row</span>() {
        <span class="hljs-selector-tag">Button</span>('取消')
          <span class="hljs-selector-class">.onClick</span>(() =&gt; {
            DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.hide</span>(DialogType.CUSTOM);
            this<span class="hljs-selector-class">.param</span><span class="hljs-selector-class">.onCancel</span>?.();
          })
        
        <span class="hljs-selector-tag">Button</span>('确认')
          <span class="hljs-selector-class">.onClick</span>(() =&gt; {
            DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.hide</span>(DialogType.CUSTOM);
            this<span class="hljs-selector-class">.param</span><span class="hljs-selector-class">.onConfirm</span>?.();
          })
      }
      <span class="hljs-selector-class">.margin</span>({ top: <span class="hljs-number">20</span> })
    }
    <span class="hljs-selector-class">.width</span>(this.param.flag ? '<span class="hljs-number">80%</span>' : '<span class="hljs-number">40%</span>')  <span class="hljs-comment">// 横竖屏适配</span>
    <span class="hljs-selector-class">.padding</span>(<span class="hljs-number">20</span>)
    <span class="hljs-selector-class">.backgroundColor</span>(Color.White)
    <span class="hljs-selector-class">.borderRadius</span>(<span class="hljs-number">12</span>)
  }
}

<span class="hljs-keyword">@Builder</span>
export function myDialogBuilder(<span class="hljs-attribute">params</span>: MyDialogParams) {
  <span class="hljs-built_in">MyDialog</span>({ param: params })
}
</code></pre>
<h4 data-id="heading-21">5.3 注册弹窗</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 方式一：在 DialogManager.registerDefaultDialogs() 中添加</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">registerDefaultDialogs</span>(): <span class="hljs-keyword">void</span></span> {
  <span class="hljs-keyword">this</span>.registerDialog&lt;PrivacyPolicyParams&gt;(
    DialogType.PRIVACY_POLICY,
    wrapBuilder(privacyPolicyDialogBuilder)
  );
  
  <span class="hljs-comment">// 添加自定义弹窗</span>
  <span class="hljs-keyword">this</span>.registerDialog&lt;MyDialogParams&gt;(
    DialogType.CUSTOM,
    wrapBuilder(myDialogBuilder)
  );
}

<span class="hljs-comment">// 方式二：动态注册</span>
DialogManager.getInstance().registerDialog&lt;MyDialogParams&gt;(
  DialogType.CUSTOM,
  wrapBuilder(myDialogBuilder)
);
</code></pre>
<h4 data-id="heading-22">5.4 使用自定义弹窗</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">params</span> = new MyDialogParams()<span class="hljs-comment">;</span>
<span class="hljs-attr">params.title</span> = <span class="hljs-string">"提示"</span><span class="hljs-comment">;</span>
<span class="hljs-attr">params.content</span> = <span class="hljs-string">"确定要执行此操作吗？"</span><span class="hljs-comment">;</span>
<span class="hljs-attr">params.onConfirm</span> = () =&gt; {
  console.log('用户点击了确认')<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
<span class="hljs-attr">params.onCancel</span> = () =&gt; {
  console.log('用户点击了取消')<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

await DialogManager.getInstance().show(DialogType.CUSTOM, params)<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">六、最佳实践</h3>
<h4 data-id="heading-24">6.1 在弹窗内部关闭自身</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 推荐：通过 DialogManager 关闭</span>
DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.hide</span>(DialogType.PRIVACY_POLICY);

<span class="hljs-comment">// 不推荐：直接调用 promptAction（会导致状态不同步）</span>
</code></pre>
<h4 data-id="heading-25">6.2 处理返回键</h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">options</span> = new DialogOptionsImpl()<span class="hljs-comment">;</span>
<span class="hljs-attr">options.onWillDismiss</span> = (action: DismissDialogAction) =&gt; {
  if (<span class="hljs-attr">action.reason</span> === DismissReason.PRESS_BACK) {
    // 阻止返回键关闭
    action.dismiss<span class="hljs-comment">;</span>
    // 或执行自定义逻辑
  }
}<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-26">6.3 弹窗生命周期管理</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 页面销毁时关闭所有弹窗</span>
<span class="hljs-built_in">aboutToDisappear</span>(): void {
  DialogManager<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.hideAll</span>();
}
</code></pre>
<hr/>
<h3 data-id="heading-27">七、注意事项</h3>
<ol>
<li><strong>必须初始化</strong>：使用前必须调用 <code>DialogManager.getInstance().init()</code></li>
<li><strong>异步操作</strong>：<code>show()</code> 和 <code>hide()</code> 都是异步方法，需要使用 <code>await</code></li>
<li><strong>参数传递</strong>：弹窗参数中的 <code>flag</code> 会自动设置，无需手动指定</li>
<li><strong>弹窗注册</strong>：使用前必须先注册弹窗，否则会抛出异常</li>
<li><strong>ArkTS 兼容</strong>：代码已适配 ArkTS 严格模式，避免使用对象展开等不支持的语法</li>
</ol>
<hr/>
<h3 data-id="heading-28">八、版本历史</h3>




















<table><thead><tr><th>版本</th><th>日期</th><th>说明</th></tr></thead><tbody><tr><td>1.0.0</td><td>2025-09-03</td><td>初始版本，支持基础弹窗管理</td></tr><tr><td>2.0.0</td><td>2025-09-04</td><td>重构为 BaseDialog + DialogManager 架构</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Trae使用体验SOLO模式体验]]></title>    <link>https://juejin.cn/post/7601020578491662345</link>    <guid>https://juejin.cn/post/7601020578491662345</guid>    <pubDate>2026-01-31T16:18:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601020578491662345" data-draft-id="7601069677566722094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Trae使用体验SOLO模式体验"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-31T16:18:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Maxatom"/> <meta itemprop="url" content="https://juejin.cn/user/606586149804062"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Trae使用体验SOLO模式体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586149804062/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Maxatom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T16:18:40.000Z" title="Sat Jan 31 2026 16:18:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/758bf065c3bd4da0809b1be30586fc39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=oLKb9Vlv5iyjQgOuPbjNxaC9KEE%3D" alt="6a8001b60ce8fdb63c958ca30a2e3d9a.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">介绍</h2>
<p>我注意到AI流行起来是从ChatGPT开始的，当时网络上到处都是ChatGPT的消息，但是我从来没有用过，只是听说聊天很厉害。从去年底deepseek发布以来，我也下载了deepseek，跟这个用起来，发现聊天查资料确实很好用，逐渐替代搜索引擎了，我已经好久没打开百度了，百度一打开首先给你看一堆广告，然后在一堆广告里面找你要的资料，然后很多博文还是重复内容，互相抄袭，找点东西太痛苦了。相反，AI能直接给你答案，简直不要太爽。但是deepseek刚开始支持的流量有限，经常服务不在线。然后我就下载了豆包，快乐的用豆包了。</p>
<h2 data-id="heading-1">deepseek</h2>
<p>deepseek一出来简直就是深水炸弹，在网络上什么场景大家应该都知道，几乎所有人都在讨论AI带来的革命，连我不关心科技行业的表姐都在谈论这个，我当时是真被惊讶到了。我完全没有意识到这个东西影响力这么大，我用deepseek的时候当时并没有很震惊，只是觉得这个东西比以前的AI（比如微软小冰）好用多了，但是没想过能对行业有什么革命性影响，毕竟对于一个程序员来说，他的编程能力还不太够。但是很快就发现几乎所有企业都在讨论怎么用AI来替代员工。我们公司也一样，当时领导们在极力推动我们使用AI来编程，公司还买了阿里的通义灵码给我们用。
通义灵码的使用体验，整体上并不太好，它依赖有限的上下文，在单个文件写代码还行，没办法实现一个接口的整个链路，写出来的代码需要很大的改动。</p>
<h2 data-id="heading-2">Trae使用体验</h2>
<p>由于通义灵码用过一段时间，体验并不太好，然后就注意到了字节推出的Trae这个原生AI编程IDE，当时SOLO模式还没有发布，我已经在关注了，当时只是好奇，出来以后我立刻下载下来使用，发现真的非常好用，这是一个真的可以提高生产力的工具。我最近写的很多代码都是用Trae直接完成的，Trae确实可以端到端的完成任务，我让Trae写一个接口，它可以帮我完成所有的代码，写完还会调试成功，写好的代码可以直接使用。之前用的其他AI，写完的代码还有经过大量改动。</p>
<h2 data-id="heading-3">简单介绍</h2>
<p>如果有使用Trae，直接去Trae的官网把IDE下载下来，这里说一句实话，写java还是Intellij IDEA更好用。Trae的IDE应该是开源vscode上开发的，对写java来说没有Intellij IDEA强大。但是Trae大部分情况是AI在写代码，基本上人写的不多。</p>
<h3 data-id="heading-4">创建项目</h3>
<p>如图，下面是我已经有的一个项目，我从Gitee上把项目拉下来，我自己懒的去处理各种环境调试，直接在聊天框问Trae怎么运行这个项目，Trae直接帮我把环境弄好，把项目跑起来，太省事了。要是以往，还有把搞环境把项目跑起来折腾半天时间。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c3085b20a74afba6e06b4e614392a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=5Ob%2FYpqIE%2BoUr9tO4kzt3xKsS6w%3D" alt="截屏2026-01-31 23.48.54.png" loading="lazy"/></p>
<h5 data-id="heading-5">简单介绍一下过程：</h5>
<pre><code class="hljs">1、首先Trae扫描整个项目，了解项目结构，确认是Maven项目
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ca114ed09a04484807d6aeb0a3b3b5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=Uldocd3uTg45tcKydghW5Pg3Yh4%3D" alt="截屏2026-01-31 23.56.23.png" loading="lazy"/>
2、确认Maven是否安装，发现Maven没有安装
3、继续检查java是否安装，发现java已经安装，检查数据库是否可用
4、然后尝试使用mac的包管理工具安装Maven，发现没有安装权限</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2de8ff7cf87344688131a82def62b96a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=xEFHscFYrZf4DuDnQbY76q5EMfI%3D" alt="截屏2026-01-31 23.58.40.png" loading="lazy"/>
5、最后总结了一下项目，还给了一个安装maven的步骤，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89d73a35d0654bdca331c8f10e1fdf4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=lGqYokYwpYTTZsn0rLqPE2xYFMA%3D" alt="截屏2026-01-31 23.59.26.png" loading="lazy"/></p>
<h5 data-id="heading-6">继续追问</h5>
<p>1、 但是并没有放过他，直接贴了一个安装maven报错的信息给他，他开始尝试自己下载Maven，并直接安装到本地，不适应包管理工具。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f33bd67db4704eec9c01ede1b2235a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=SnX3kl3msezwP9joYkuQ39U1ee4%3D" alt="截屏2026-02-01 00.01.19.png" loading="lazy"/>
2、然后一番折腾，找到了正确的下载地址，并帮我把maven下载下来了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48f64425ac1a411482d24feaeb3c52f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=geMOSxbQVLIe%2FzjRYteEYAaNlXA%3D" alt="截屏2026-02-01 00.03.56.png" loading="lazy"/>
3、然后用Maven编译并启动项目，发现端口被占用（由于我在intellij ide已启动项目），停掉已启动的项目，重新启动
4、最后他安装的目录直接在项目目录下，我让他移到我希望的目录下，他能移动还能指定目录下，太棒了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aba6d3d84c424126b0ab69baac610da2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWF4YXRvbQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770481119&amp;x-signature=4YM4lOooR95ZrSbeIPv4pBYiGak%3D" alt="截屏2026-02-01 00.06.47.png" loading="lazy"/></p>
<h3 data-id="heading-7">总结</h3>
<p>使用Trae有一周左右了，能端到端的实现需求，只需要跟他聊天即可，不需要说的很细，这很重要，可以省很多事。以往的AI能写代码，但是写过的代码要经过大量调整，写需求要讲的很细，否则无法写出合格的代码，这很浪费时间，有这个时间我宁愿自己写。还可以自己调试接口修改bug，这点也很棒，修改bug通常挺浪费时间的，现在AI直接搞定。当时使用过程中也发现不少问题，比如有些bug怎么样都找不出来，只能人工排查。 有时候经常出现幻觉，写出错误的代码，不过还好自己能修改bug。需要不停的对话纠正。总结这是一个生产力工具，真能帮程序员提升很高的生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[千问 文心 元宝 KImi怎么输出不乱码]]></title>    <link>https://juejin.cn/post/7601049142866395136</link>    <guid>https://juejin.cn/post/7601049142866395136</guid>    <pubDate>2026-01-31T16:54:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601049142866395136" data-draft-id="7601076976440246312" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="千问 文心 元宝 KImi怎么输出不乱码"/> <meta itemprop="keywords" content="DeepSeek"/> <meta itemprop="datePublished" content="2026-01-31T16:54:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="DS随心转小程序"/> <meta itemprop="url" content="https://juejin.cn/user/1048267181271572"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            千问 文心 元宝 KImi怎么输出不乱码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1048267181271572/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    DS随心转小程序
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T16:54:25.000Z" title="Sat Jan 31 2026 16:54:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85e289391f4c479b9b6e6125c7aa442e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRFPpmo_lv4PovazlsI_nqIvluo8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770483265&amp;x-signature=ar2SlDFlWyNaievc9nxoLf8Dykw%3D" alt="在这里插入图片描述" loading="lazy"/><br/>
在中文大语言模型（LLM）爆发的当下，开发者和深度用户经常面临一个极其破坏体验的问题：<strong>Markdown 渲染崩坏、LaTeX 公式乱码、代码块嵌套错误，或是长文本输出时的特殊字符转义失败。</strong></p>
<p>无论是通义千问（Qwen）、文心一言（ERNIE Bot）、腾讯元宝还是 Kimi，在处理复杂排版需求时，偶尔都会出现“牛头不对马嘴”的乱码现象。本文将从技术原理、Prompt 调优、以及后处理方案三个维度，深度解析如何彻底解决 LLM 输出乱码问题。</p>
<hr/>
<h2 data-id="heading-0"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>一、 乱码背后的技术逻辑：为什么大模型会“胡言乱语”？</h2>
<p>要解决乱码，首先要理解乱码产生的根源。在 LLM 的生成过程中，乱码通常并非随机产生，而是由以下三种机制导致的：</p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. Tokenizer（分词器）的编码偏移</h3>
<p>LLM 并不直接处理字符，而是处理 Token。中文模型通常使用 Byte-Pair Encoding (BPE) 或类似算法。当模型试图生成一些冷僻字、数学符号或特定格式的代码时，如果该字符在词表中的权重较低，模型可能会选择错误的 Token 序列，导致解码回文字时出现位偏移或乱码。</p>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. Markdown 与 LaTeX 的语法冲突</h3>
<p>这是最常见的“逻辑乱码”。例如，当 Kimi 或千问输出包含多行公式的论文摘要时，Markdown 的加粗符号 <code>**</code> 可能会与 LaTeX 的乘法符号 <code>*</code> 冲突，导致整个页面渲染成一团乱糟糟的斜体，而非清晰的公式。</p>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 系统提示词（System Prompt）的约束失效</h3>
<p>由于各家厂商对输出流（Streaming）的控制逻辑不同，当长文本触发截断重连时，控制符可能会丢失，导致原本应该闭合的代码块 `````悬空，后续内容全部被识别为代码，形成视觉上的“排版乱码”。</p>
<hr/>
<h2 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>二、 实战指南：四大主流模型防乱码策略</h2>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 通义千问（Qwen）：强化 Schema 约束</h3>
<p>千问在代码生成和逻辑推理上很强，但有时会过度转义。</p>
<ul>
<li><strong>对策：</strong>  在 Prompt 中显式指定输出格式。</li>
<li><strong>技巧：</strong>  使用“XML 标签包裹法”。例如：<code>请将代码放在 &lt;CODE_BLOCK&gt; 标签内，确保不使用任何 Markdown 之外的特殊转义符。</code></li>
</ul>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 文心一言：处理中文全角符号干扰</h3>
<p>文心在处理中英文混排时，偶尔会将代码中的半角符号（如 <code>,</code>）误写作全角（如 <code>，</code>）。</p>
<ul>
<li><strong>对策：</strong>  增加“编码一致性”要求。</li>
<li><strong>技巧：</strong>  在提示词尾部加入：<code>注意：请严格区分中英文标点，所有代码片段必须使用标准 ASCII 字符。</code></li>
</ul>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 腾讯元宝：优化长文本截断</h3>
<p>元宝在处理超长任务时，有时会出现前后文格式不一致。</p>
<ul>
<li><strong>对策：</strong>  采用“分段生成，标记锚点”的方法。</li>
<li><strong>技巧：</strong>  要求模型在每一段结束时输出特定的结束符，便于人工或脚本校验格式完整性。</li>
</ul>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. Kimi：解决 LaTeX 渲染冲突</h3>
<p>Kimi 擅长长文本阅读，但在输出学术内容时，LaTeX 渲染器有时会崩溃。</p>
<ul>
<li><strong>对策：</strong>  强制使用双美元符号 <code>$$</code> 换行包裹公式。</li>
<li><strong>技巧：</strong>  <code>请确保所有数学公式独立成行，并使用标准的 LaTeX 语法，严禁在公式内部嵌套 Markdown 格式。</code></li>
</ul>
<hr/>
<h2 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>三、 高阶 Prompt 工程：预防乱码的通用模版</h2>
<p>如果你希望获得一份完全不乱码、格式精美的输出，建议在 Prompt 中加入以下**“格式保护层”**：</p>
<blockquote>
<p><strong>[系统约束]</strong></p>
<ol>
<li>请使用标准 CommonMark 规范进行渲染。</li>
<li>所有的数学公式必须符合 LaTeX 标准，行内公式用 ，独立公式用</li>
</ol>
<p>。<br/>
3. 代码块必须指明语言类型（如 ```python）。</p>
<ol start="4">
<li>严禁对非 ASCII 字符进行不必要的 Unicode 转义。</li>
<li>如果文本长度超过限制，请在结束处保留未闭合的标签提示。</li>
</ol>
</blockquote>
<hr/>
<h2 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>四、 后处理的“最后一步”：从屏幕到文档</h2>
<p>即便模型输出完美，我们在“复制-粘贴”的过程中，往往也会遇到格式丢失的问题。网页版的渲染器和本地的 Word/Notion 并不完全兼容。这时候，我们需要一个专业的<strong>解析中转站</strong>。</p>
<p>对于开发者和文字工作者来说，手动调整这些乱码不仅低效，而且容易出错。</p>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>深度解析解决方案：DS 随心转 APP</h3>
<p>在尝试了多种油猴插件和剪贴板清洗工具后，<strong>DS 随心转 APP</strong> 展现出了极高的工程化解决能力。它不仅是一个简单的格式转换器，更是针对 LLM 乱码问题的专项工具：</p>
<ul>
<li><strong>完美解析：</strong>  它内置了针对 DeepSeek、通义千问、Kimi 等主流模型输出风格的优化算法，能够自动识别并修复断掉的代码块和冲突的公式标签。</li>
<li><strong>解决乱码：</strong>  针对手机端、网页端复制出来的特殊字符乱码，DS 随心转能进行二次清洗，还原最纯净的文本逻辑。</li>
<li><strong>一键导出：</strong>  这一功能最为实用。通过 DS 随心转，你可以将模型生成的长篇内容，一键导出为 <strong>PDF、Markdown、甚至是排版整洁的 Word 文档</strong>，彻底告别了“手动复制-手动调格式-手动查乱码”的死循环。</li>
</ul>
<hr/>
<h2 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>结语</h2>
<p>如果你也深受模型排版混乱、公式显示异常的困扰，不妨尝试调整你的系统提示词，或者直接使用 <strong>DS 随心转 APP</strong> 进行一键式的格式修复与导出，让技术回归效率本身。</p>
<hr/>
<p><strong>互动话题：</strong>  你在用哪家大模型时遇到的乱码最让你头疼？欢迎在评论区分享你的调优经验！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《从零开始：Ubuntu 22.04 + RTX 4060 复现 RLinf 具身智能框架记录》]]></title>    <link>https://juejin.cn/post/7601076815449587727</link>    <guid>https://juejin.cn/post/7601076815449587727</guid>    <pubDate>2026-01-31T19:49:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076815449587727" data-draft-id="7601000638345166863" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《从零开始：Ubuntu 22.04 + RTX 4060 复现 RLinf 具身智能框架记录》"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-31T19:49:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="scilwb"/> <meta itemprop="url" content="https://juejin.cn/user/543600461486108"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《从零开始：Ubuntu 22.04 + RTX 4060 复现 RLinf 具身智能框架记录》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/543600461486108/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    scilwb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T19:49:53.000Z" title="Sat Jan 31 2026 19:49:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>官方项目链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRLinf%2FRLinf.git" target="_blank" title="https://github.com/RLinf/RLinf.git" ref="nofollow noopener noreferrer">github.com/RLinf/RLinf…</a><br/>
官方文档（中文版）<a href="https://link.juejin.cn?target=https%3A%2F%2Frlinf.readthedocs.io%2Fzh-cn%2Flatest%2Frst_source%2Fstart%2Finstallation.html" target="_blank" title="https://rlinf.readthedocs.io/zh-cn/latest/rst_source/start/installation.html" ref="nofollow noopener noreferrer">rlinf.readthedocs.io/zh-cn/lates…</a><br/>
官方文档（英文版<a href="https://link.juejin.cn?target=https%3A%2F%2Frlinf.readthedocs.io%2Fen%2Flatest%2Frst_source%2Fstart%2Finstallation.html" target="_blank" title="https://rlinf.readthedocs.io/en/latest/rst_source/start/installation.html" ref="nofollow noopener noreferrer">rlinf.readthedocs.io/en/latest/r…</a></p>
</blockquote>
<p>笔者开始复现前系统状态（刚重装了ubuntu22.04,近乎裸机，适合萌新参考）</p>
<ul>
<li>OS：Ubuntu 22.04</li>
<li>Driver：535.288.01（终端输入 <code>nvidia-smi</code>即可查询，后面步骤要求更新到nvidia-driver-<strong>590</strong>）</li>
<li>CUDA toolkit：12.4（终端输入 <code>nvcc -V</code>即可查询）</li>
<li>GPU：RTX 4060 8GB（即8188MiB）（终端输入<code>nvidia-smi</code> 即可查询）</li>
</ul>
<h3 data-id="heading-1">总体目录与推荐路径（笔者根目录为 <code>lwb@isus:~$</code>）</h3>
<p>建议把所有工作目录固定在：</p>
<ul>
<li><strong>项目根目录（宿主机）</strong> ：<code>~/work/RLinf</code></li>
<li><strong>模型/数据（宿主机）</strong> ：<code>~/data/rlinf/</code></li>
<li><strong>结果（宿主机）</strong> ：<code>~/work/RLinf/results</code>（或用项目默认的 <code>../results</code>，但我建议挂载出来）</li>
</ul>
<p>这样 Docker 里统一挂载到 <code>/workspace/RLinf</code>，模型数据挂载到 <code>/workspace/data</code>，不会因为容器删掉丢东西。</p>
<h2 data-id="heading-2">A. 宿主机：Docker + NVIDIA Container Toolkit 全流程</h2>
<blockquote>
<p>目标：让 <code>docker run --gpus all nvidia/cuda:12.4-base nvidia-smi</code> 正常输出<br/>
这是后续一切的“验收门槛”。</p>
</blockquote>
<h3 data-id="heading-3">A0) 先确认现状</h3>
<pre><code class="hljs">nvidia-smi
nvcc -V
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/727e73c67aca4f0e9a4d88c6b8761165~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=o548zQdu8WGW5jdGNnsRM7Gwxz0%3D" alt="image.png" width="50%" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d07606676c9416597a29851fd4ec17c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=SbBioTIZ7M70chZywwuv%2F7shBTM%3D" alt="image.png" width="50%" loading="lazy"/>
<strong>如图，笔者Driver是535.288.01，必须升级到高版本，推荐NVIDIA-SMI 590</strong></p>
<h5 data-id="heading-4">1. 安装驱动</h5>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install nvidia<span class="hljs-operator">-</span>driver<span class="hljs-number">-590</span>
</code></pre>
<p><em>(如果安装过程中弹出紫色屏幕询问 Secure Boot 相关设置，建议选择 Disable 或者设定一个密码，并在重启时按照提示操作。最省事的办法是在 BIOS 里直接关掉 Secure Boot)</em></p>
<h5 data-id="heading-5">2. 重启宿主机（必须）</h5>
<p>驱动安装涉及内核模块更新，不重启不会生效。</p>
<pre><code class="hljs">sudo reboot
</code></pre>
<h5 data-id="heading-6">3. 验证与验收</h5>
<p>重启回来后，在终端输入：</p>
<pre><code class="hljs">nvidia-smi
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ddc2f03d156469c8caa3bfb23c2d3ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=lC9l%2FjaIFTnJbrsv%2BbOorVUKPv0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">A1) 安装 Docker Engine（推荐 docker-ce，而不是 ubuntu 自带 docker.io）</h3>
<ol>
<li>卸载可能存在的旧组件（安全起见）：</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">sudo apt-get remove -y docker docker-engine docker.io containerd runc || <span class="hljs-literal">true</span>
</code></pre>
<p>2.  安装依赖并添加 Docker 官方源：</p>

<pre><code class="hljs language-bash" lang="bash">sudo apt-get update
sudo apt-get install -y ca-certificates curl gnupg lsb-release

sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo <span class="hljs-built_in">chmod</span> a+r /etc/apt/keyrings/docker.gpg

<span class="hljs-built_in">echo</span> \
  <span class="hljs-string">"deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  <span class="hljs-subst">$(. /etc/os-release &amp;&amp; echo $VERSION_CODENAME)</span> stable"</span> | \
  sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null
</code></pre>
<p>3.  安装 Docker（注意此时要把梯子关掉，否则会安装失败，导致步骤4报错）：</p>

<pre><code class="hljs language-sql" lang="sql">sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span>
sudo apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> install <span class="hljs-operator">-</span>y docker<span class="hljs-operator">-</span>ce docker<span class="hljs-operator">-</span>ce<span class="hljs-operator">-</span>cli containerd.io docker<span class="hljs-operator">-</span>buildx<span class="hljs-operator">-</span>plugin docker<span class="hljs-operator">-</span>compose<span class="hljs-operator">-</span>plugin
</code></pre>
<p>4.  允许当前用户免 sudo 用 docker（建议做，不然每条命令都 sudo）：</p>

<pre><code class="hljs language-bash" lang="bash">sudo usermod -aG docker <span class="hljs-variable">$USER</span>
newgrp docker
</code></pre>
<p><code>注意如果运行后，报错usermod：“docker”组不存在，说明步骤3梯子没关，导致docker安装失败，需要关掉梯子代理后重新执行步骤3 </code></p>
<ol start="5">
<li>验收：</li>
</ol>

<pre><code class="hljs">docker version
</code></pre>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b6a56804dd346d1a3b7f4ffe8be7497~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=ySfwlY7sroz5oWr8UdvJrDn5UCU%3D" alt="image.png" width="50%" loading="lazy"/>
<pre><code class="hljs language-arduino" lang="arduino">docker run --rm hello-world
</code></pre>
<ul>
<li>
<p><strong>如果你在国内，遇到网络问题时（镜像拉取速度慢）</strong>
等待一会报错如下图</p>
</li>
<li>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1d8eb7d931d4116a83d3ec868303048~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=VoYvycWUSJh95LFeXJGGMCmEoyA%3D" alt="image.png" loading="lazy"/>
解决办法
可以通过使用国内的 Docker 镜像源来加速拉取速度，使用阿里云等国内镜像。可以参考以下步骤配置阿里云的 Docker 镜像源：</p>
</li>
<li>
<p><strong>配置阿里云的 Docker 镜像源</strong>：</p>
</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/docker
sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">'EOF'</span> 
{ 
<span class="hljs-string">"registry-mirrors"</span>: [<span class="hljs-string">"&lt;your-aliyun-mirror-url&gt;"</span>] ,
<span class="hljs-string">"https://docker.m.daocloud.io"</span>]
} 
EOF 
</code></pre>
<ul>
<li>
<p>注意：替换其中的 <code>&lt;your-aliyun-mirror-url&gt;</code> 为你自己的阿里云镜像 URL，具体地址可以通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcr.console.aliyun.com%2Fcn-hangzhou%2Finstances%2Fmirrors" target="_blank" title="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" ref="nofollow noopener noreferrer">阿里云 Docker 镜像加速器</a> 获得。</p>
</li>
<li>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5da1d8c6324b45e2876bce59c041205f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=PzTT%2FoYIOxTdhKBvGCv6%2BTz9%2B5w%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>重新配置并清理 Docker 设置</strong>：<br/>
确保 <code>/etc/docker/daemon.json</code> 文件只包含你信任的几个镜像源。然后，执行以下步骤：</p>
<ul>
<li>
<p>清理 Docker 缓存：</p>
<pre><code class="hljs language-perl" lang="perl">docker <span class="hljs-keyword">system</span> prune -af
</code></pre>
</li>
<li>
<p>重新加载配置并重启 Docker：</p>
<pre><code class="hljs">sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>检查是否能访问 Docker Hub 镜像源</strong>：</p>
<pre><code class="hljs">docker pull hello-world
</code></pre>
<p>接着可以通过以下命令运行 <code>hello-world</code> 镜像来验证 Docker 是否配置正常：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker run --rm hello-world
</code></pre>
<p>成功结果如下：</p>
</li>
<li>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b9251c617b445c0b4dfa567b3307fb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=qR0h5Xr9zjF8HQ8Gr00NjD88PPA%3D" alt="image.png" width="50%" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8025ebd63a47400e9e8cd82c4603e01e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=7Iu49HzATB6Imezqb9BQj0VCaA0%3D" alt="image.png" width="50%" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-8">A2) 安装 NVIDIA Container Toolkit（GPU 透传）</h3>
<p>RLinf 文档明确要求 NVIDIA Container Toolkit（并给出版本要求）。</p>
<ol>
<li>添加 NVIDIA 源并安装：</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /etc/apt/keyrings/nvidia-container-toolkit.gpg</span>
curl -fsSL https:<span class="hljs-comment">//nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
  sed 's#deb https://#deb [signed-by=/etc/apt/keyrings/nvidia-container-toolkit.gpg] https://#g' | \
  sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list</span>

sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit
</code></pre>
<p>2.  配置 Docker runtime：</p>

<pre><code class="hljs language-ini" lang="ini">sudo nvidia-ctk runtime configure <span class="hljs-attr">--runtime</span>=docker
sudo systemctl restart docker
</code></pre>
<p>3.  验收 GPU 透传（非常关键）：</p>

<pre><code class="hljs language-css" lang="css">docker run <span class="hljs-attr">--rm</span> <span class="hljs-attr">--gpus</span> <span class="hljs-attribute">all</span> nvidia/cuda:<span class="hljs-number">12.4</span>.<span class="hljs-number">0</span>-base-ubuntu22.<span class="hljs-number">04</span> nvidia-smi
</code></pre>
<p>看到 4060 信息就说明 Docker GPU 透传成功。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc262f1a96c14231b8c7f7ae44f09144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=1HDcPqhr5UqGxQEYMMxXHI%2FDIZ8%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">B. 拉取 RLinf 官方镜像 + 挂载目录（推荐最稳的方式）</h2>
<p>RLinf 官方文档<br/>
(<br/>
官方文档中文版<a href="https://link.juejin.cn?target=https%3A%2F%2Frlinf.readthedocs.io%2Fzh-cn%2Flatest%2Frst_source%2Fstart%2Finstallation.html" target="_blank" title="https://rlinf.readthedocs.io/zh-cn/latest/rst_source/start/installation.html" ref="nofollow noopener noreferrer">rlinf.readthedocs.io/zh-cn/lates…</a><br/>
官方文档英文版<a href="https://link.juejin.cn?target=https%3A%2F%2Frlinf.readthedocs.io%2Fen%2Flatest%2Frst_source%2Fstart%2Finstallation.html" target="_blank" title="https://rlinf.readthedocs.io/en/latest/rst_source/start/installation.html" ref="nofollow noopener noreferrer">rlinf.readthedocs.io/en/latest/r…</a><br/>
)<br/>
提供两个快速开始镜像：</p>
<ul>
<li><strong>数学推理镜像（最适合你 4060 8GB 先跑通）</strong> ：<code>rlinf/rlinf:math-rlinf0.1-torch2.6.0-sglang0.4.6.post5-vllm0.8.5-megatron0.13.0-te2.1</code></li>
<li><strong>具身镜像（OpenVLA / Libero / ManiSkill 等，显存/资源压力更大）</strong> ：<code>rlinf/rlinf:agentic-rlinf0.1-torch2.6.0-openvla-openvlaoft-pi0</code></li>
</ul>
<p>我们先走<strong>数学推理镜像</strong>Quickstart 2（最低资源、官方单卡配置）</p>
<hr/>
<h3 data-id="heading-10">B1) 建目录（宿主机）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/work/RLinf
<span class="hljs-built_in">mkdir</span> -p ~/data/rlinf/models
<span class="hljs-built_in">mkdir</span> -p ~/data/rlinf/datasets
<span class="hljs-built_in">mkdir</span> -p ~/data/rlinf/cache/hf
<span class="hljs-built_in">mkdir</span> -p ~/data/rlinf/cache/torch
</code></pre>
<hr/>
<h3 data-id="heading-11">B2) 拉镜像（数学推理镜像）</h3>
<ul>
<li>先给Docker 配置文件<strong>添加代理设置</strong>：</li>
</ul>
<p>运行以下命令来创建和编辑 Docker 的 systemd 配置文件：</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/systemd/system/docker.service.d
sudo nano /etc/systemd/system/docker.service.d/override.conf
</code></pre>
<p>在打开的 <code>override.conf</code> 文件中，添加以下内容（注意图中代理地址127.0.0.1和端口7890，要根据自己的代理配置修改）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTP_PROXY=http://127.0.0.1:7890"</span>
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"HTTPS_PROXY=http://127.0.0.1:7890"</span>
</code></pre>
<ul>
<li>
<p><strong>保存并退出</strong>：</p>
<ul>
<li>在 <code>nano</code> 编辑器中，按 <code>Ctrl + O</code> 保存，按 <code>Y</code> 确认保存，然后按 <code>Ctrl + X</code>退出编辑器。</li>
</ul>
</li>
<li>
<p><strong>重新加载 Docker 配置并重启 Docker</strong>：<br/>
执行以下命令来重新加载 Docker 配置并重启 Docker 服务，使新的代理设置生效：</p>
<pre><code class="hljs">sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre>
</li>
<li>
<p><strong>验证代理设置</strong>：<br/>
代理配置完成后，尝试拉取镜像：</p>
<pre><code class="hljs language-bash" lang="bash">docker pull rlinf/rlinf:math-rlinf0.1-torch2.6.0-sglang0.4.6.post5-vllm0.8.5-megatron0.13.0-te2.1
</code></pre>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e959ff02267e44708cc1ecd9cffb89b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=gwtzpCa7AcBDtuN7B%2FATO6NAkeM%3D" alt="image.png" loading="lazy"/></p>
<p>这里想吐嘈一下，笔者第一次拉取下载了快两个小时，快下完的时候报错中断了，见下图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba2fda476d464441b2c7a3cf065ddc21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=1Nx6QbcbDCRRKgxGLsxt8AnIGEk%3D" alt="image.png" loading="lazy"/>
遇到这种情况的朋友不要担心，重新拉取一遍<code>docker pull rlinf/rlinf:math-rlinf0.1-torch2.6.0-sglang0.4.6.post5-vllm0.8.5-megatron0.13.0-te2.1</code>这一次会快很多，笔者又等了30分钟就完成了</p>
<hr/>
<h3 data-id="heading-12">B3) 克隆 RLinf 仓库到宿主机（方便编辑yaml）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~/work
git <span class="hljs-built_in">clone</span> https://github.com/RLinf/RLinf.git
<span class="hljs-built_in">cd</span> RLinf
</code></pre>
<hr/>
<h3 data-id="heading-13">B4) 启动容器（强烈推荐按这个写法：挂载代码 + 数据 + cache）</h3>
<blockquote>
<p>这样你在宿主机改 config，容器里立刻生效；模型和数据也都在宿主机落盘。</p>
</blockquote>
<pre><code class="hljs language-ruby" lang="ruby">cd ~<span class="hljs-regexp">/work/</span><span class="hljs-title class_">RLinf</span>
docker run -it --rm --gpus all \
  --shm-size 20g \
  --network host \
  --name rlinf-math \
  -e <span class="hljs-variable constant_">NVIDIA_DRIVER_CAPABILITIES</span>=all \
  -e <span class="hljs-variable constant_">HF_HOME</span>=<span class="hljs-regexp">/workspace/cache</span><span class="hljs-regexp">/hf \
  -e TORCH_HOME=/workspace</span><span class="hljs-regexp">/cache/torch</span> \
  -v <span class="hljs-variable">$(</span>pwd)<span class="hljs-symbol">:/workspace/RLinf</span> \
  -v ~<span class="hljs-regexp">/data/rlinf</span><span class="hljs-symbol">:/workspace/data</span> \
  -v ~<span class="hljs-regexp">/data/rlinf</span><span class="hljs-regexp">/cache:/workspace</span><span class="hljs-regexp">/cache \
  rlinf/rlinf</span><span class="hljs-symbol">:math-rlinf0</span>.<span class="hljs-number">1</span>-torch2.<span class="hljs-number">6.0</span>-sglang0.<span class="hljs-number">4.6</span>.post5-vllm0.<span class="hljs-number">8.5</span>-megatron0.<span class="hljs-number">13.0</span>-te2.<span class="hljs-number">1</span> \
  /bin/bash
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ff512f941744738912b2c25c27ac472~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=oMWxaJcMwEzu7Z0uWhcG8gotOYg%3D" alt="image.png" loading="lazy"/>
容器里你应当在：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /workspace/RLinf
</code></pre>
<h3 data-id="heading-14">B5) 容器内做一次最基础验收（GPU + PyTorch）</h3>
<p>在容器里执行：</p>
<pre><code class="hljs language-scss" lang="scss">nvidia-smi
python -c "import torch; <span class="hljs-built_in">print</span>('torch', torch.__version__); <span class="hljs-built_in">print</span>('cuda?', torch.cuda.is_available()); <span class="hljs-built_in">print</span>('gpu', torch.cuda.get_device_name(<span class="hljs-number">0</span>) if torch<span class="hljs-selector-class">.cuda</span><span class="hljs-selector-class">.is_available</span>() else <span class="hljs-attribute">None</span>)"
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d9492dd9f1c4dee86db6dcd778c1117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=yFsHk8XqXe3UReatLhYtLhWXVWM%3D" alt="image.png" loading="lazy"/>
这一步通过，说明“宿主机驱动 + Docker 透传 + 容器依赖”闭环。</p>
<hr/>
<h2 data-id="heading-15">C. 跑通 RLinf 最轻量 Demo（优先：Quickstart 2 单 GPU GRPO on MATH）</h2>
<p>官方 Quickstart 2 明确给了：</p>
<ul>
<li>要下载一个 1.5B 模型 checkpoint</li>
<li>下载 boba 数据集</li>
<li>修改 <code>examples/reasoning/config/math/qwen2.5-1.5b-single-gpu.yaml</code><br/>
并且说明这个配置<strong>默认单 GPU</strong>。</li>
</ul>
<h3 data-id="heading-16">C1) 在容器内安装 huggingface-hub</h3>
<pre><code class="hljs">pip install -U huggingface-hub
</code></pre>
<h3 data-id="heading-17">C2) 下载模型与数据（落在宿主机挂载目录，避免容器删掉丢失）</h3>
<p>在容器里：</p>
<h4 data-id="heading-18">方案一：使用 Hugging Face 国内镜像</h4>
<p>（优先尝试 <strong>方案一</strong> 。因为代理有时候带宽不够或者连接不稳定，下载大模型容易断连。国内镜像站 <code>hf-mirror.com</code> 通常非常稳定且速度极快）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /workspace/data
<span class="hljs-comment"># 设置 HF 镜像环境变量</span>
<span class="hljs-built_in">export</span> HF_ENDPOINT=https://hf-mirror.com

<span class="hljs-comment"># 模型</span>
hf download deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B \
  --local-dir /workspace/data/models/DeepSeek-R1-Distill-Qwen-1.5B

<span class="hljs-comment"># 数据集</span>
hf download inclusionAI/AReaL-boba-Data --repo-type=dataset \
  --local-dir /workspace/data/datasets/boba
</code></pre>
<p><strong>如何永久生效？</strong> 如果你希望每次进入容器都不用重新输这行命令，可以把它写入容器的配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export HF_ENDPOINT=https://hf-mirror.com'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">source</span> ~/.bashrc
</code></pre>
<h4 data-id="heading-19">方案二：在容器内配置代理</h4>
<p>如果你想让容器内的所有流量（不仅是 HF，还包括 pip install github 等）都走代理，可以使用这个方法。</p>
<p>因为你启动容器时加了 <code>--network host</code>，容器和宿主机共享网络，所以容器内的 <code>127.0.0.1</code> 就是宿主机的 <code>127.0.0.1</code>。</p>
<p>在容器内的终端执行（假设你的代理端口是 7890）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /workspace/data
<span class="hljs-built_in">export</span> http_proxy=http://127.0.0.1:7890
<span class="hljs-built_in">export</span> https_proxy=http://127.0.0.1:7890

<span class="hljs-comment"># 模型</span>
hf download deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B \
  --local-dir /workspace/data/models/DeepSeek-R1-Distill-Qwen-1.5B

<span class="hljs-comment"># 数据集</span>
hf download inclusionAI/AReaL-boba-Data --repo-type=dataset \
  --local-dir /workspace/data/datasets/boba
</code></pre>
<p><strong>如何永久生效？</strong> 同样写入 <code>.bashrc</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export http_proxy=http://127.0.0.1:7890'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">echo</span> <span class="hljs-string">'export https_proxy=http://127.0.0.1:7890'</span> &gt;&gt; ~/.bashrc
<span class="hljs-built_in">source</span> ~/.bashrc
</code></pre>
<blockquote>
<p><strong>显存建议（4060 8GB）</strong><br/>
1.5B 量级通常作为起点能更稳跑通。不要一开始就上 7B/更大。</p>
</blockquote>
<h3 data-id="heading-20">C3) 修改 YAML 配置</h3>
<p>配置文件路径（宿主机和容器一致，因为挂载了代码，所以直接在宿主机改文件即可）：</p>
<ul>
<li><code>/workspace/RLinf/examples/reasoning/config/math/qwen2.5-1.5b-single-gpu.yaml</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77cc3ce11095472099bef4a4ff872d6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=7Re6uoYmKLg1yP4J9j3PBxU70ao%3D" alt="image.png" loading="lazy"/>
需要按文档修改这几个字段（官方列出的关键字段）：</p>
<ul>
<li><code>rollout.model.model_path</code></li>
<li><code>data.train_data_paths</code></li>
<li><code>data.val_data_paths</code></li>
<li><code>actor.tokenizer.tokenizer_model</code></li>
</ul>
<p>把它们改成你实际路径（我们刚下载到 <code>/workspace/data/...</code>）。</p>
<p><strong>推荐值（对应上面下载位置）：</strong></p>
<ul>
<li>
<p><code>rollout.model.model_path: /workspace/data/models/DeepSeek-R1-Distill-Qwen-1.5B</code></p>
</li>
<li>
<p><code>actor.tokenizer.tokenizer_model: /workspace/data/models/DeepSeek-R1-Distill-Qwen-1.5B</code></p>
</li>
<li>
<p>数据集里你需要找到 <code>AReaL-boba-106k.jsonl</code> 的实际位置（文档提到这个文件名）。<br/>
可以先：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#容器中输入</span>
find /workspace/data/datasets/boba -maxdepth 4 -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">"*106k*.jsonl"</span> -o -name <span class="hljs-string">"*.jsonl"</span> | <span class="hljs-built_in">head</span>
</code></pre>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a4d731b996248a0b272ed81fdc0b9c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=%2FlTX95dMHdwGy0IrX6LxEpMnJt8%3D" alt="image.png" loading="lazy"/><br/>
找到的 jsonl 路径 <code>data.train_data_paths</code> 和 <code>data.val_data_paths</code>。</p>
<ul>
<li><code>data.train_data_paths: /workspace/data/datasets/boba/AReaL-boba-106k.jsonl</code></li>
<li><code>data.val_data_paths: /workspace/data/datasets/boba/AReaL-boba-106k.jsonl</code></li>
</ul>
<p>qwen2.5-1.5b-single-gpu.yaml文件具体修改如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment">#部分代码</span>
<span class="hljs-attr">model:</span>
    <span class="hljs-attr">model_path:</span> <span class="hljs-string">/workspace/data/models/DeepSeek-R1-Distill-Qwen-1.5B</span>
    <span class="hljs-attr">model_type:</span> <span class="hljs-string">qwen2.5</span>
    <span class="hljs-attr">precision:</span> <span class="hljs-string">${actor.model.precision}</span>             <span class="hljs-comment"># precision for rollout model, support [fp16, bf16, fp32]</span>
    
<span class="hljs-attr">tokenizer:</span>
    <span class="hljs-attr">tokenizer_model:</span> <span class="hljs-string">/workspace/data/models/DeepSeek-R1-Distill-Qwen-1.5B</span>
    <span class="hljs-attr">use_fast:</span> <span class="hljs-literal">False</span>
    <span class="hljs-attr">trust_remote_code:</span> <span class="hljs-literal">True</span>
    <span class="hljs-attr">padding_side:</span> <span class="hljs-string">'right'</span>
    
<span class="hljs-attr">train_data_paths:</span> [<span class="hljs-string">"/workspace/data/datasets/boba/AReaL-boba-106k.jsonl"</span>]
<span class="hljs-attr">val_data_paths:</span> [<span class="hljs-string">"/workspace/data/datasets/boba/AReaL-boba-106k.jsonl"</span>]
</code></pre>
<h3 data-id="heading-21">C4) 启动训练（用官方提供的 launch script）</h3>
<p>Quickstart 2 写的是“Execute the provided launch script”，并且配置默认单 GPU。<br/>
不同版本仓库脚本名字可能会变，但<strong>一定能在仓库 <code>examples/reasoning/</code> 或 <code>examples/</code> 下找到启动脚本</strong>。我建议你这样做，保证不走错：</p>
<ol>
<li>先列出 reasoning 例子目录：</li>
</ol>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -lah /workspace/RLinf/examples/reasoning
find /workspace/RLinf/examples/reasoning -maxdepth 2 -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">"*.sh"</span> -o -name <span class="hljs-string">"*.py"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/301d669a9ff54bcd90c50bf53da2958c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=gj3IfwTTffIlERrZpDaPNrpZaDA%3D" alt="image.png" loading="lazy"/>
2.  找到与 MATH / grpo / launch 相关的脚本后运行它，并把你刚改的 yaml 作为参数（如果脚本支持）。</p>
<blockquote>
<p>如果你希望我把“具体启动命令行”写成一条（不靠你自己 find），我也可以——但要以你仓库里实际的脚本文件名为准。你把 <code>find ... -name "*.sh"</code> 的输出贴出来，我就能给出精确到文件名的一行命令。</p>
</blockquote>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /workspace/RLinf/examples/reasoning
bash run_main_grpo_math.sh qwen2.5-1.5b-single-gpu
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29405f25a9cf4868bbaf592556767cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=quDxJZDtnOd0JaX53WdKu04kI%2BY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-22">C5) 结果与日志位置</h3>
<p>Quickstart 2 写了训练结果在 <code>../results</code>，TensorBoard 在 <code>../results/grpo-1.5b/tensorboard/</code>。<br/>
在宿主机可以看到如下生成的三个文件夹：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac34f5d31eeb419aaa486f4971bf1a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2NpbHdi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770494464&amp;x-signature=0WahdQ9VpJ9xHj4Wi7uYWbOwTlo%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-23">D. (未完待续)逐渐提高难度（仍然优先“先评测后训练”，省显存/省时间）</h2>
<h3 data-id="heading-24">D1) LLM 评测（比训练更省资源）</h3>
<p>RLinf 提供了 Math Reasoning 的评测教程。<br/>
建议按文档走：先用已有 checkpoint 做 eval，确认 pipeline 没问题，再考虑训练。</p>
<hr/>
<h3 data-id="heading-25">D2) 具身评测（Embodied VLA Evaluation，先跑 eval 脚本）</h3>
<p>官方给了一条<strong>一键 eval</strong> 的脚本命令：</p>
<pre><code class="hljs language-bash" lang="bash">bash examples/embodiment/eval_embodiment.sh libero_10_grpo_openvlaoft_eval
</code></pre>
<p>**注意：**具身评测往往涉及环境/资产（Libero/ManiSkill 等），你需要对应的具身镜像或按示例库安装依赖。官方说 eval 脚本都在 <code>examples/embodiment/</code>。</p>
<p>这一步属于“中等难度”：可能会吃到更多显存（VLA 模型 + 渲染）。</p>
<hr/>
<h3 data-id="heading-26">D3) 具身训练（最高难度，4060 8GB 很可能只能“降配跑通”）</h3>
<p>如果要上具身镜像（OpenVLA/Libero/ManiSkill），官方提供对应镜像 tag：</p>
<pre><code class="hljs language-bash" lang="bash">docker pull rlinf/rlinf:agentic-rlinf0.1-torch2.6.0-openvla-openvlaoft-pi0
</code></pre>
<p>再用类似的挂载方式启动。</p>
<p>现实边界：官方“extensively tested”硬件是服务器级多卡，4060 8GB 的目标应该是：</p>
<ul>
<li>✅ 跑通 eval / 跑通小规模训练 step</li>
<li>❌ 不要指望复现论文级吞吐/完整训练曲线（资源差两个量级）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows11安装opencode踩坑记录]]></title>    <link>https://juejin.cn/post/7601041482892967986</link>    <guid>https://juejin.cn/post/7601041482892967986</guid>    <pubDate>2026-01-31T16:46:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601041482892967986" data-draft-id="7601169987411771430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows11安装opencode踩坑记录"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-31T16:46:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="菜就得练"/> <meta itemprop="url" content="https://juejin.cn/user/937201674496142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows11安装opencode踩坑记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/937201674496142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    菜就得练
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T16:46:13.000Z" title="Sat Jan 31 2026 16:46:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近opencode很火爆，所以想安装试一下，目前网上已经有很多大牛写的安装流程，但真正按照流程一步步走下来却遇到了大牛没有的问题，所以这里记录一下自己踩的坑。您的坑可能跟我不一样，仅供参考。为了排除受网络限制影响，全程都是开了魔法。</p>
<p>windows安装opencode有很多方式，我首先选用的是Node.js，Node.js的安装还是很顺利的。方法是直接copy过来的。</p>
<h2 data-id="heading-0">安装Node.js</h2>
<ol>
<li>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn" target="_blank" title="https://nodejs.org/zh-cn" ref="nofollow noopener noreferrer">Node.js</a>官网；</li>
<li>点击网页左下角的LTS版本（长期支持版，推荐）；</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01c6146702df4773b83e99ec163a77ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=jICaW1cZapuQZ2wv%2BTZfuXZrO5I%3D" alt="image.png" loading="lazy"/>
3. 下载安装包（按自己需求，我选择的第一个）；</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47fdb7cc245147f68f34c556d4e606f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=t5Ubzgm%2FlzLxkOKNw%2FQU5UfPY30%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>一路“Next”（下一步）直到完成；</li>
<li>安装完成后，在PowerShell(尽量以管理员身份运行)中输入下面命令验证安装是否成功；</li>
</ol>
<pre><code class="hljs language-shell" lang="shell">node --version
</code></pre>
<p>如果像如下图片一样显示版本号，祝贺你，安装成功。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dee0ef52ca14bc5860fd8f1dc3fed86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=igPLJafh6ZQ7%2BLhlBGsiGhZQVII%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">安装opencode</h2>
<p>如果你安装好了Node.js，那么就可以直接在PowerShell中运行。</p>
<pre><code class="hljs">npm install -g opencode-ai
</code></pre>
<p>这里开始就是我遇到的第一个坑，执行完上面指令后会报类似下面的错误（图片在网上找的，当时忘了截图）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3198458bf3134da99c3d5796ecd6a489~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=LnHMst%2BWl7ntpjMeD9%2FV%2Fa0iqRg%3D" alt="image.png" loading="lazy"/>
原因主要是PowerShell的安全策略，将npm命令视为了不安全的脚本，不允许执行，不过只需要放开权限就可以。
解决办法是以管理员权限运行PowerShell，然后输入set-ExecutionPolicy RemoteSigned 回车。会出现一个选择提示，按要求选择Y即可，我图省事直接选的ALL（a）。</p>
<pre><code class="hljs language-arduino" lang="arduino">set-ExecutionPolicy RemoteSigned
</code></pre>
<p>设置完PowerShell的策略后，就可以重新输入上面的安装指令，等待安装完成即可。安装完成后输入下面指令查看版本号，验证是否安装成功。</p>
<pre><code class="hljs language-css" lang="css">opencode <span class="hljs-attr">--version</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3937bf0cbc6b430ea035e550b817512f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=xWXP3zecFqydAu2jV3quXJzeCCo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">运行opencode</h2>
<p>若安装顺利就可以直接在PowerShell中运行：</p>
<pre><code class="hljs">opencode
</code></pre>
<p>满怀激动地输入完指令后，展示在我眼前的却是黑屏。重启PowerShell几次之后都是一样的结果，起初以为是网络延迟导致的，所以干脆放在那里去睡觉了，结果第二天早上还是一样的黑屏，就知道事情并不简单。</p>
<p>在网上搜了半天黑屏的原因，也问了ai，不过并没有找到有效的解决办法。下面是我曾尝试的方案：</p>
<ul>
<li>卸载重装opencode，一样</li>
<li>使用其他工具安装（比如Chocolatey）opencode，一样</li>
<li>重新安装低版本的opencode，一样</li>
<li>关闭魔法，也一样</li>
</ul>
<p>最后在github的opencode项目里找到了遇到跟我相似问题的网友提问。
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanomalyco%2Fopencode%2Fissues%2F7662" target="_blank" title="https://github.com/anomalyco/opencode/issues/7662" ref="nofollow noopener noreferrer">github.com/anomalyco/o…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8d40ce7db824d46b80837d6f6285336~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=ZdtbvlSqfcfulKZ28IOiqP8R4r4%3D" alt="image.png" loading="lazy"/>
有位官方的工程师热心的询问了网友的问题并给出了指导，让网友执行如下指令定位下原因：</p>
<pre><code class="hljs language-arduino" lang="arduino">opencode run hello --print-logs
</code></pre>
<p>我也本地试了一下，结果跟网友一样。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4b392a4b7c54c7b82f24372bd78df77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=vEZ9m8mAJYopGIIhEBRUDf1beXM%3D" alt="image.png" loading="lazy"/>
官方工程师的回答如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3e0c44d9db64c608a694a01d8ea0b2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=%2F%2BiQwCcZuTWip8Udk%2BHd5sed914%3D" alt="image.png" loading="lazy"/>
也就是说bun添加依赖的时候耗时了，但这位工程师后续没有给出解决方案，不过起码有点方向了。所以就将这段信息粘贴给ai来解答。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/543212a0f0f74384b8271b922573cea7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=3AecRNHzStb7keeiPDoHJ%2FDjhQ8%3D" alt="image.png" loading="lazy"/>
ai分析是网络问题，建议使用npm的镜像，所以执行如下指令：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm config set registry https:<span class="hljs-comment">//registry.npmmirror.com</span>
</code></pre>
<p>然后再执行opencode，果然就启动了。</p>
<h2 data-id="heading-3">使用opencode</h2>
<p>大牛blog里一行指令的事，却花了这么多时间才运行起来。当我以为就这样让agent干活时，可agent却没有理我。在输入框输入“你好”之后，agent一直显示加载，好像卡住了一样，开关魔法都没有用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf3c1bdd1acb48a7a90dd9363e8b3c83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-c5bCx5b6X57uD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770519537&amp;x-signature=wzYkRjXbj%2F9rBn8Od277%2FHTWXuo%3D" alt="image.png" loading="lazy"/>
只能又求救ai看看有什么办法，ai分析主要还是网络问题，让我确认代理的设置，以及在PowerShell中设置临时代理，指令如下(端口号根据自己情况设置)：</p>
<pre><code class="hljs language-ini" lang="ini">$env:<span class="hljs-attr">HTTP_PROXY</span>=<span class="hljs-string">"http://127.0.0.1:XXXX"</span>
$env:<span class="hljs-attr">HTTPS_PROXY</span>=<span class="hljs-string">"http://127.0.0.1:XXXX"</span>
</code></pre>
<p>设置完代理后，重新启动opencode，agent总算能说话了。不过这样只是临时设置了代理。可以自行搜索全局设置的方法。</p>
<h2 data-id="heading-4">总结</h2>
<p>1.遇到PowerShell不允许执行脚本的问题可以使用如下指令允许：</p>
<pre><code class="hljs language-arduino" lang="arduino">set-ExecutionPolicy RemoteSigned
</code></pre>
<p>2.如果是通过npm安装opencode后启动不了，可以尝试设置npm代理：</p>
<pre><code class="hljs language-arduino" lang="arduino">npm config set registry https:<span class="hljs-comment">//registry.npmmirror.com</span>
</code></pre>
<p>3.遇到agent回答慢或者一直无响应可以尝试设置代理（需要魔法）：</p>
<pre><code class="hljs language-ini" lang="ini">$env:<span class="hljs-attr">HTTP_PROXY</span>=<span class="hljs-string">"http://127.0.0.1:XXXX"</span>
$env:<span class="hljs-attr">HTTPS_PROXY</span>=<span class="hljs-string">"http://127.0.0.1:XXXX"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[AI Coding 斗蛐蛐] 第一期: 瑕疵产品检测]]></title>    <link>https://juejin.cn/post/7601076976440262696</link>    <guid>https://juejin.cn/post/7601076976440262696</guid>    <pubDate>2026-01-31T17:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076976440262696" data-draft-id="7601046076943925263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[AI Coding 斗蛐蛐] 第一期: 瑕疵产品检测"/> <meta itemprop="keywords" content="AI编程,Cursor,Claude"/> <meta itemprop="datePublished" content="2026-01-31T17:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ArcX"/> <meta itemprop="url" content="https://juejin.cn/user/3632442147890910"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [AI Coding 斗蛐蛐] 第一期: 瑕疵产品检测
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3632442147890910/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ArcX
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-31T17:15:14.000Z" title="Sat Jan 31 2026 17:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">测试时间</h2>
<p>2026年1月30日</p>
<h2 data-id="heading-1">Prompt</h2>
<p>设计并开发一个基于 OpenAI API 的产品瑕疵检测系统，该系统应允许用户上传产品图片，通过调用 OpenAI API 分析图片内容，识别并以文字输出图片上存在的瑕疵。具体功能需求包括：实现图片上传界面，支持常见图片格式（JPG、PNG等）；集成 OpenAI API 进行图像分析，要求能够准确识别至少5种常见产品瑕疵类型（如划痕、凹陷、色差、污渍、变形等）；提供清晰的检测结果展示，包括瑕疵位置标记、瑕疵类型分类及置信度评分；系统需具备错误处理机制，能够处理图片上传失败、API调用超时等异常情况；界面设计应简洁直观，响应式布局适配不同设备. 有什么需要我做抉择的可以随时问我</p>
<h2 data-id="heading-2">简单分析</h2>
<p>这个任务唯一的难点在于如何调用 OpenAI API, 以及生成的 prompt, 别的都是非常常规的业务逻辑, 所以我们重点会关注 AI 生成的 prompt 的质量. 由于是调用 OpenAI API 来检测瑕疵, 最终的效果由 OpenAI 决定, 所以评分时<strong>不会关心瑕疵检测的准确性</strong>. 所以总的来说会关注以下几部分:</p>
<ol>
<li>prompt 的质量 (50%)</li>
<li>UI 的美观程度和功能 (40%)</li>
<li>开发的流畅程度 (10%)</li>
</ol>
<h2 data-id="heading-3">1. Claude Opus 4.5 (In Cursor)</h2>
<h3 data-id="heading-4">prompt</h3>
<pre><code class="hljs language-javascript" lang="javascript">你是一个专业的产品质量检测<span class="hljs-variable constant_">AI</span>助手。你的任务是分析产品图片，识别其中可能存在的瑕疵和质量问题。

你需要检测以下类型的瑕疵：
划痕 (<span class="hljs-title class_">Scratch</span>) - 表面的线性损伤或刮痕
凹陷 (<span class="hljs-title class_">Dent</span>) - 表面的凹陷或压痕
色差 (<span class="hljs-title class_">Color</span> <span class="hljs-title class_">Deviation</span>) - 颜色不均匀、斑点或与预期颜色不符
污渍 (<span class="hljs-title class_">Stain</span>) - 表面的污点、水渍或其他污染
变形 (<span class="hljs-title class_">Deformation</span>) - 形状扭曲、弯曲或不规则
裂纹 (<span class="hljs-title class_">Crack</span>) - 表面或结构的裂缝
气泡 (<span class="hljs-title class_">Bubble</span>) - 材料内部或表面的气泡
毛刺 (<span class="hljs-title class_">Burr</span>) - 边缘粗糙或毛边

请以<span class="hljs-title class_">JSON</span>格式返回分析结果，格式如下：
{
  <span class="hljs-string">"overallQuality"</span>: <span class="hljs-string">"优秀/良好/一般/较差"</span>,
  <span class="hljs-string">"qualityScore"</span>: <span class="hljs-number">0</span>-<span class="hljs-number">100</span>的数字,
  <span class="hljs-string">"defects"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"瑕疵类型（中文）"</span>,
      <span class="hljs-string">"typeEn"</span>: <span class="hljs-string">"瑕疵类型（英文）"</span>,
      <span class="hljs-string">"location"</span>: <span class="hljs-string">"瑕疵在图片中的位置描述"</span>,
      <span class="hljs-string">"severity"</span>: <span class="hljs-string">"严重程度：轻微/中等/严重"</span>,
      <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0</span>-<span class="hljs-number">100</span>的置信度数字,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"详细描述"</span>
    }
  ],
  <span class="hljs-string">"summary"</span>: <span class="hljs-string">"整体检测总结，简洁描述产品状况"</span>,
  <span class="hljs-string">"recommendations"</span>: [<span class="hljs-string">"改进建议1"</span>, <span class="hljs-string">"改进建议2"</span>]
}

注意事项：
如果图片不是产品图片或无法识别，请在summary中说明
如果没有检测到瑕疵，defects数组为空，qualityScore应该较高
置信度表示你对该瑕疵判断的确定程度
位置描述要具体，如<span class="hljs-string">"左上角"</span>、<span class="hljs-string">"中心偏右"</span>、<span class="hljs-string">"底部边缘"</span>等
请只返回<span class="hljs-title class_">JSON</span>，不要包含其他文字
</code></pre>
<p>总体来说 prompt 质量还不错, 唯一的缺点在于, 我们的需求 prompt 里明确说了 UI 上需要展示瑕疵的位置, 但是 Claude 生成的 prompt 里没有包含这个要求, 所以在生成代码的时候, Claude 生成的 UI 上没有展示瑕疵的位置, 这是一个扣分项.</p>
<p><strong>Prompt 得分: 7.</strong></p>
<h3 data-id="heading-5">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b043439f0d74c51b224b5eaaaddafdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=HifSPNEZkDHMcekk%2F04Kl%2FXBVFo%3D" alt="Claude Opus 4.5 (In Cursor)" loading="lazy"/></p>
<p>UI 现代且简洁, 配色舒适, 用了环形图展示评分, 列出了检测摘要, 还有改进建议, 唯一的缺点还是上面提到的没有展示瑕疵的位置.</p>
<p><strong>UI 得分: 7.</strong></p>
<h3 data-id="heading-6">开发体验</h3>
<p>Claude 的开发体验很少让人失望过, 对于这种简单的任务一次过是基本操作, 直接满分.</p>
<p><strong>开发体验得分: 10.</strong></p>
<h3 data-id="heading-7">综合评分</h3>
<p><strong>Claude Opus 4.5 (In Cursor): 7.3</strong></p>
<h2 data-id="heading-8">2. Claude Opus 4.5 (In Claude Code)</h2>
<h3 data-id="heading-9">Prompt</h3>
<pre><code class="hljs language-scss" lang="scss">你是一个专业的产品质量检测专家。请仔细分析这张产品图片，识别以下类型的瑕疵：
划痕 (Scratch) - 表面线性损伤
凹陷 (Dent) - 表面凹陷变形
色差 (Color Deviation) - 颜色不均匀或异常
污渍 (Stain) - 表面污染物
变形 (Deformation) - 形状异常
裂纹 (Crack) - 表面裂缝
气泡 (Bubble) - 表面气泡缺陷

请严格按照以下JSON格式返回检测结果，不要包含任何其他文字：
{
  "hasDefects": boolean,
  <span class="hljs-string">"defects"</span>: [
    {
      "type": <span class="hljs-string">"瑕疵类型中文名"</span>,
      <span class="hljs-string">"typeEn"</span>: <span class="hljs-string">"DefectTypeInEnglish"</span>,
      <span class="hljs-string">"location"</span>: <span class="hljs-string">"瑕疵在图片中的位置描述，如：左上角、中部偏右、底部边缘等"</span>,
      <span class="hljs-string">"severity"</span>: <span class="hljs-string">"low或medium或high"</span>,
      <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.0</span>到<span class="hljs-number">1.0</span>之间的数字,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"详细描述该瑕疵的特征"</span>
    }
  ],
  "overallQuality": <span class="hljs-string">"good或acceptable或poor"</span>,
  <span class="hljs-string">"summary"</span>: <span class="hljs-string">"对产品整体质量的总结评估"</span>
}

注意：
如果没有发现瑕疵，hasDefects设为false，defects为空数组
confidence表示你对该瑕疵判断的置信度
severity根据瑕疵对产品质量的影响程度判断
请仔细观察图片的每个区域
</code></pre>
<p>和 Cursor 里的结果差不多, 所以评分也保持一致.</p>
<p><strong>Prompt 得分: 7.</strong></p>
<h3 data-id="heading-10">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef548058bd3d49cb85cdb19213268be8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=JrW2LrieXgo1AtqaXfvkklF0er4%3D" alt="Claude Opus 4.5 (In Claude Code)" loading="lazy"/></p>
<p>这次 Claude 生成的 UI 就明显不如 Cursor 版的. 在点击分析后不仅没有展示上传的图片, 而且整体设计也比较花里胡哨, 背景色太杂, 还有 AI 特有的喜欢用 emoji.</p>
<p><strong>UI 得分: 5.</strong></p>
<h3 data-id="heading-11">开发体验</h3>
<p>Claude Code 不用多说, 一次过.</p>
<p><strong>开发体验得分: 10.</strong></p>
<h3 data-id="heading-12">综合评分</h3>
<p><strong>Claude Opus 4.5 (In Claude Code): 6.5</strong></p>
<h2 data-id="heading-13">3. GPT-5.2-codex</h2>
<h3 data-id="heading-14">Prompt</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-string">"你是产品瑕疵检测助手，请只输出严格 JSON。"</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"需要识别至少以下5种瑕疵类型：划痕、凹陷、色差、污渍、变形。"</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"输出结构如下："</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"{"</span><span class="hljs-punctuation">,</span>
'  <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一句话总结"</span><span class="hljs-punctuation">,</span>'<span class="hljs-punctuation">,</span>
'  <span class="hljs-attr">"defects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>'<span class="hljs-punctuation">,</span>
<span class="hljs-string">"    {"</span><span class="hljs-punctuation">,</span>
'      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"划痕|凹陷|色差|污渍|变形"</span><span class="hljs-punctuation">,</span>'<span class="hljs-punctuation">,</span>
'      <span class="hljs-attr">"confidence"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-number">-1.0</span><span class="hljs-punctuation">,</span>'<span class="hljs-punctuation">,</span>
'      <span class="hljs-attr">"bbox"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"x"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-number">-1</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"y"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-number">-1</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-number">-1</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-number">-1</span> <span class="hljs-punctuation">}</span>'<span class="hljs-punctuation">,</span>
<span class="hljs-string">"    }"</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"  ]"</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"}"</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"如果没有瑕疵，defects 为空数组，并说明 summary。"</span><span class="hljs-punctuation">,</span>
<span class="hljs-string">"bbox 为归一化坐标，基于图像宽高比例，粗略框出瑕疵位置。"</span>
</code></pre>
<p>这个 prompt 相比 Claude 来说明显拉了一大截. 虽说 context 不宜过长, 但是这也太简洁了.</p>
<p><strong>Prompt 得分: 4</strong></p>
<h3 data-id="heading-15">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08fc9f3dc10a436cbf81893576a64524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=gF%2BZOySr8s%2Fg5lCtn7bIO5Xhobk%3D" alt="GPT-5.2-codex" loading="lazy"/></p>
<p>Prompt 简陋, UI 也简陋, 检测结果就只简单写出了两个字. 不过在结果图片里标注了瑕疵位置(开头提到过, 不关心结果准确度, 因为这不 Coding Agent 主要决定的).</p>
<p><strong>UI 得分: 5</strong></p>
<h3 data-id="heading-16">开发体验</h3>
<p>说实话 GPT 这块真的挺让我震惊, 因为它是唯一一个调用 OpenAI API 报错的 AI, 自己调用自己的 API 都能因为传了不存在的参数而报错也是挺离谱的, 还报错了 3 轮.</p>
<p><strong>开发体验得分: 5</strong></p>
<h3 data-id="heading-17">综合评分</h3>
<p><strong>GPT-5.2-codex: 4.5</strong></p>
<h2 data-id="heading-18">4. Gemini 3 Pro</h2>
<h3 data-id="heading-19">Prompt</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">You are an expert Quality Assurance Inspector <span class="hljs-keyword">for</span> product manufacturing.
Your task <span class="hljs-built_in">is</span> <span class="hljs-keyword">to</span> analyze product images <span class="hljs-built_in">and</span> identify potential defects.
Focus <span class="hljs-keyword">on</span> these specific defect types:
Scratches (划痕)
Dents (凹陷)
Discoloration (色差)
Stains (污渍)
Deformation (变形)

<span class="hljs-keyword">For</span> <span class="hljs-keyword">each</span> defect found, provide:
<span class="hljs-symbol">type:</span> One <span class="hljs-keyword">of</span> the <span class="hljs-number">5</span> types listed above.
<span class="hljs-symbol">confidence:</span> A score between <span class="hljs-number">0</span> <span class="hljs-built_in">and</span> <span class="hljs-number">1</span> indicating your certainty.
<span class="hljs-symbol">description:</span> A brief description <span class="hljs-keyword">of</span> the defect.
<span class="hljs-symbol">location:</span> Approximate center coordinates <span class="hljs-keyword">of</span> the defect <span class="hljs-keyword">as</span> [x, y] percentages (<span class="hljs-number">0</span>-<span class="hljs-number">100</span>) relative <span class="hljs-keyword">to</span> the image width <span class="hljs-built_in">and</span> height. Top-left <span class="hljs-built_in">is</span> [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>].

<span class="hljs-keyword">Return</span> the result <span class="hljs-keyword">as</span> a JSON <span class="hljs-type">object</span> <span class="hljs-keyword">with</span> a <span class="hljs-string">"defects"</span> array.
Example format:
{
  <span class="hljs-string">"defects"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"Scratches"</span>,
      <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.95</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Visible scratch on the top surface"</span>,
      <span class="hljs-string">"location"</span>: [<span class="hljs-number">50</span>, <span class="hljs-number">25</span>]
    }
  ]
}

<span class="hljs-keyword">If</span> no defects are found, <span class="hljs-keyword">return</span> {<span class="hljs-string">"defects"</span>: []}.
</code></pre>
<p>Prompt 和 Claude 比较类似, 并且说明了 location 需要是一个坐标, 加分.</p>
<p><strong>Prompt 得分: 8</strong></p>
<h3 data-id="heading-20">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d4a189af8349daa1d936af03993a0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=%2BZuaiCsbhI8JWpkYrmxYKatE2jM%3D" alt="Gemini 3 Pro" loading="lazy"/></p>
<p>号称"前端严父"的 Gemini 做的 UI 也不怎么样, 过于简陋, 不过好在标注了瑕疵的位置, 并且位置是最准的一个(尽管这更多是 Openai 的功劳).</p>
<p><strong>UI 得分: 6</strong></p>
<h3 data-id="heading-21">开发体验</h3>
<p>一次过.</p>
<p><strong>开发体验得分: 10</strong></p>
<h3 data-id="heading-22">综合评分</h3>
<p><strong>Gemini 3 Pro: 7.4</strong></p>
<h2 data-id="heading-23">5. Composer-1</h2>
<h3 data-id="heading-24">Prompt</h3>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-type">You</span> are a quality control expert analyzing product images <span class="hljs-keyword">for</span> defects.
<span class="hljs-type">Analyze</span> the image and identify any defects from these categories:
- scratch: <span class="hljs-type">Surface</span> scratches or marks
- dent: <span class="hljs-type">Dents</span> or depressions
- color_difference: <span class="hljs-type">Color</span> inconsistencies or variations
- stain: <span class="hljs-type">Stains</span>, spots, or discolorations
- deformation: <span class="hljs-type">Shape</span> deformations or warping
- crack: <span class="hljs-type">Cracks</span> or fractures
- discoloration: <span class="hljs-type">Unusual</span> color changes
- surface_imperfection: <span class="hljs-type">Other</span> surface imperfections

<span class="hljs-type">For</span> each defect found, provide:
<span class="hljs-number">1.</span> <span class="hljs-type">Type</span> (from the categories above)
<span class="hljs-number">2.</span> <span class="hljs-type">Location</span> description (e.g., <span class="hljs-string">"top-left corner"</span>, <span class="hljs-string">"center area"</span>, <span class="hljs-string">"edge"</span>)
<span class="hljs-number">3.</span> <span class="hljs-type">Confidence</span> score (<span class="hljs-number">0</span><span class="hljs-number">-100</span>)
<span class="hljs-number">4.</span> <span class="hljs-type">Description</span> of the defect

<span class="hljs-type">Return</span> your response as a <span class="hljs-type">JSON</span> <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-keyword">with</span> <span class="hljs-title">this</span> <span class="hljs-title">structure</span></span>:
{
<span class="hljs-string">"defects"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"scratch"</span>,
    <span class="hljs-string">"location"</span>: <span class="hljs-string">"top-left corner"</span>,
    <span class="hljs-string">"confidence"</span>: <span class="hljs-number">85</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"Visible scratch approximately 2cm long"</span>
  }
],
<span class="hljs-string">"summary"</span>: <span class="hljs-string">"Overall quality assessment"</span>,
<span class="hljs-string">"overallQuality"</span>: <span class="hljs-string">"good|fair|poor"</span>
}

<span class="hljs-type">If</span> no defects are found, <span class="hljs-keyword">return</span> an empty defects array <span class="hljs-keyword">with</span> overallQuality <span class="hljs-string">"good"</span>.
</code></pre>
<p>和 Claude 非常像, 同样很详细清楚, 同样缺少了对具体位置的要求, 只要求了模糊位置.</p>
<p><strong>Prompt 得分: 7</strong></p>
<h3 data-id="heading-25">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/155a36f005ce47279e8e04b69cf6a7b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=s0tdCSdWz9T42cVxv5Ltbxrag0M%3D" alt="Composer-1" loading="lazy"/></p>
<p>UI 相比 Claude 就差了很多.</p>
<ul>
<li><code>Analyze Another Image</code> 按钮颜色有点突兀</li>
<li>没有在图里画出位置</li>
<li>检测结果里的 <code>90% confidence</code> 和 <code>Stain</code> 感觉应该互换颜色</li>
<li>具体瑕疵的文字颜色比较浅, 不醒目</li>
</ul>
<p><strong>UI 得分: 5</strong></p>
<h3 data-id="heading-26">开发体验</h3>
<p>一次过.</p>
<p><strong>开发体验得分: 10</strong></p>
<h3 data-id="heading-27">综合评分</h3>
<p><strong>Composer-1: 6.5</strong></p>
<h2 data-id="heading-28">6. Kimi-K2.5</h2>
<h3 data-id="heading-29">Prompt</h3>
<pre><code class="hljs language-javascript" lang="javascript">你是一个专业的产品质量检测专家。请仔细分析产品图片，识别以下<span class="hljs-number">5</span>种常见瑕疵类型：
划痕 (scratch) - 产品表面的线性损伤
凹陷 (dent) - 产品表面的局部下陷
色差 (color_difference) - 颜色不均匀或与标准不符
污渍 (stain) - 表面的污染或斑点
变形 (deformation) - 产品形状异常或扭曲

请以 <span class="hljs-title class_">JSON</span> 格式返回分析结果，格式如下：
{
  <span class="hljs-string">"defects"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"瑕疵类型英文"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"瑕疵中文名称"</span>,
      <span class="hljs-string">"location"</span>: <span class="hljs-string">"瑕疵位置描述"</span>,
      <span class="hljs-string">"confidence"</span>: <span class="hljs-number">0.0</span>-<span class="hljs-number">1.0</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"详细描述"</span>,
      <span class="hljs-string">"severity"</span>: <span class="hljs-string">"轻微/中等/严重"</span>
    }
  ],
  <span class="hljs-string">"summary"</span>: <span class="hljs-string">"总体评估摘要"</span>,
  <span class="hljs-string">"totalDefects"</span>: <span class="hljs-number">0</span>
}

注意：
只返回 <span class="hljs-title class_">JSON</span> 数据，不要其他文字说明
如果没有发现瑕疵，defects 为空数组
confidence 为 <span class="hljs-number">0</span>-<span class="hljs-number">1</span> 之间的浮点数
severity 只能是 <span class="hljs-string">"轻微"</span>、<span class="hljs-string">"中等"</span> 或 <span class="hljs-string">"严重"</span><span class="hljs-string">`
</span></code></pre>
<p>同样的, 没有写明 location 需要具体坐标.</p>
<p><strong>Prompt 得分: 7</strong></p>
<h3 data-id="heading-30">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a6b2a12d87d4fba8daa29057010072d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=mHamEkhACdZakwTUAkYX93jfPyo%3D" alt="Kimi-K2.5" loading="lazy"/></p>
<p>Kimi 生成的 UI 是 AI 味最浓的: 经典蓝紫色渐变, 经典 emoji, 经典黄色背景文字框.</p>
<p><strong>UI 得分: 6</strong></p>
<h3 data-id="heading-31">开发体验</h3>
<p>Kimi 在写代码的时候没有出什么乱子, 但是在运行的时候报了依赖找不到的错误, 应该是执行安装依赖的命令时出了什么错.</p>
<p><strong>开发体验得分: 6</strong></p>
<h3 data-id="heading-32">综合评分:</h3>
<p><strong>Kimi-K2.5: 6.5</strong></p>
<h2 data-id="heading-33">7. Qwen-3-coder</h2>
<p>本次挑战最大的小丑登场.</p>
<h3 data-id="heading-34">Prompt</h3>
<pre><code class="hljs language-scss" lang="scss">请分析这张产品图片，识别以下<span class="hljs-number">5</span>种类型的瑕疵：划痕、凹陷、色差、污渍、变形。对于每个发现的瑕疵，请提供：<span class="hljs-number">1</span>)瑕疵类型 <span class="hljs-number">2</span>)在图片中的位置描述 <span class="hljs-number">3</span>)置信度评分(<span class="hljs-number">0</span>-<span class="hljs-number">100%</span>)。如果未发现明显瑕疵，请回复'未发现明显瑕疵'。以JSON格式返回结果，包含字段：<span class="hljs-built_in">defects</span>(数组，每个元素包含type、location、confidence)。
</code></pre>
<ul>
<li>Prompt 没有换行</li>
<li>没有提供 JSON 形式的说明</li>
<li>虽然写了需要什么字段, 但是只写了字段名, 没有写字段类型和描述</li>
</ul>
<p><strong>Prompt 得分: 2</strong></p>
<h3 data-id="heading-35">UI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b995b4ad8c47b6a1fea3929842c6a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQXJjWA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518395&amp;x-signature=BBFLcaH2TruxAM%2FLWBL3Ngt2C54%3D" alt="Qwen-3-coder" loading="lazy"/></p>
<p>没啥好说的, 根本用不了.</p>
<ul>
<li>最上面那个蓝色的方块是上传按钮, 初始文本是 "点击上传", 结果上传之后就变成了文件名, 很匪夷所思的行为</li>
<li>"开始分析"和"重新选择", 一绿一灰, 非常不协调, 灰色一般用于 disabled 的样式</li>
<li>大黑 banner 很土很丑, 像 10 年前的 bootstrap 风格</li>
<li>同样没有在图里标明位置</li>
</ul>
<p><strong>UI 得分: 1</strong></p>
<h3 data-id="heading-36">开发体验</h3>
<p>结果都这样了, 开发体验也不重要了.</p>
<p><strong>开发体验得分: 1</strong></p>
<h3 data-id="heading-37">综合评分</h3>
<p><strong>Qwen-3-coder: 1.5</strong></p>
<h2 data-id="heading-38">排名</h2>





























































<table><thead><tr><th align="left">模型</th><th align="center">Prompt (50%)</th><th align="center">UI (40%)</th><th align="center">开发体验 (10%)</th><th align="center">综合评分</th></tr></thead><tbody><tr><td align="left"><strong>Gemini 3 Pro</strong></td><td align="center">8</td><td align="center">6</td><td align="center">10</td><td align="center"><strong>7.4</strong></td></tr><tr><td align="left"><strong>Claude Opus 4.5 (In Cursor)</strong></td><td align="center">7</td><td align="center">7</td><td align="center">10</td><td align="center"><strong>7.3</strong></td></tr><tr><td align="left"><strong>Claude Opus 4.5 (In Claude Code)</strong></td><td align="center">7</td><td align="center">5</td><td align="center">10</td><td align="center"><strong>6.5</strong></td></tr><tr><td align="left"><strong>Composer-1</strong></td><td align="center">7</td><td align="center">5</td><td align="center">10</td><td align="center"><strong>6.5</strong></td></tr><tr><td align="left"><strong>Kimi-K2.5</strong></td><td align="center">7</td><td align="center">6</td><td align="center">6</td><td align="center"><strong>6.5</strong></td></tr><tr><td align="left"><strong>GPT-5.2-codex</strong></td><td align="center">4</td><td align="center">5</td><td align="center">5</td><td align="center"><strong>4.5</strong></td></tr><tr><td align="left"><strong>Qwen-3-coder</strong></td><td align="center">2</td><td align="center">1</td><td align="center">1</td><td align="center"><strong>1.5</strong></td></tr></tbody></table>
<h2 data-id="heading-39">总结</h2>
<ol>
<li>Claude: 符合最强的地位. 虽然本次挑战里两次都没有注意到对坐标的要求导致惜败 Gemini, 但是别的方面基本都拉满了.</li>
<li>Gemini: 号称前端严父, 但是本次挑战里 UI 画得真的很差, 不过因为抓到了坐标这个需求功能点, 整体小胜 Claude 排到了第一.</li>
<li>GPT: 不符合预期. 虽然我平时没有怎么用过 GPT-5.2-codex 这个模型, 但是就仅有的个位数的次数体验里, 还是比较好的, 没有什么问题. 但是在本次挑战中暴露了严重的幻觉, 连自己的 API 都不知道有什么参数.</li>
<li>Composer-1: 很多人可能没听过这个模型, 这是 Cursor 官方推出的第一个自研编程模型, 最大的特点是速度真的快到飞起. 刚出来的时候我用它问过几个问题, 我的眼睛完全跟不上它往外吐 token 的速度, 一瞬间就完成了回复. 所以一直想测一下它的编程质量如何. 由于是 Cursor 自己出的第一个模型, 我其实是对它没报啥希望的, 但是最终呈现的效果还不错, 中规中矩地完成了, 所以整体超出预期.</li>
<li>Kimi-K2.5: 我之前一直不太喜欢 Kimi, 因为这家公司一直感觉营销大于实力, 尤其是 Kimi-K2 刚出来的时候, 全网都在刷如何用它来驱动 Claude Code, 所以我对它同样没啥期待, 但是最终的效果也还不错, 虽然生成 UI 的 AI 味很浓.</li>
<li>Qwen-3-coder: 有点过分了. 我一直以为它的能力是国产 AI 里第一梯队的, 没想到居然表现这么差, 全方位地差. 只能说继续加油吧☹️.</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 sk-get：AI 时代的技能包管理器，让你的 AI Agent 瞬间进化]]></title>    <link>https://juejin.cn/post/7601073900525502506</link>    <guid>https://juejin.cn/post/7601073900525502506</guid>    <pubDate>2026-02-01T01:33:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601073900525502506" data-draft-id="7601075423003164708" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 sk-get：AI 时代的技能包管理器，让你的 AI Agent 瞬间进化"/> <meta itemprop="keywords" content="前端,Agent,Cursor"/> <meta itemprop="datePublished" content="2026-02-01T01:33:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lyx"/> <meta itemprop="url" content="https://juejin.cn/user/1512550150971805"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 sk-get：AI 时代的技能包管理器，让你的 AI Agent 瞬间进化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1512550150971805/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lyx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T01:33:27.000Z" title="Sun Feb 01 2026 01:33:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 Cursor、Claude 和 VSCode Copilot 的普及，越来越多的开发者开始积累自己的 <strong>AI Agent Skills</strong>（提示词指令、工作流规范等）。但随之而来的问题是：如何高效地管理这些技能？如何跨平台、跨项目快速同步它们？</p>
<p><strong>sk-get</strong> 应运而生。它是一款专为开发者设计的简单、高效的命令行工具，旨在成为 AI Agent 领域的“npm”。</p>
<hr/>
<h3 data-id="heading-0">🌟 核心理念：连接任意仓库，同步无限可能</h3>
<p><strong>sk-get</strong> 的最大特点在于其<strong>开放性</strong>。它不绑定任何特定的技能库，你可以：</p>
<ul>
<li>对接自己的私有技能仓。</li>
<li>引入团队共享的规范库。</li>
<li>订阅社区中开源的高质量技能。</li>
</ul>
<p>只需一个 GitHub 仓库地址，所有的 AI 技能即刻触手可及。</p>
<hr/>
<h3 data-id="heading-1">✨ 核心功能亮点</h3>
<h4 data-id="heading-2">1. 跨平台一键安装</h4>
<p>无论你使用的是 <strong>Cursor</strong>、<strong>Claude</strong> 还是 <strong>VSCode</strong>，sk-get 都能精准投送。</p>
<ul>
<li><strong>Cursor/Claude</strong>：支持一键安装到当前项目的本地目录或用户全局目录。</li>
<li><strong>VSCode</strong>：自动识别并将技能指令追加到 <code>.github/copilot-instructions.md</code>，实现真正的零配置使用。</li>
</ul>
<h4 data-id="heading-3">2. 极致的交互体验</h4>
<p>讨厌记复杂的参数？sk-get 提供了丝滑的<strong>交互式菜单</strong>。
输入 <code>sg add</code>，你可以通过方向键在远程技能列表中自由选择；
输入 <code>sg rm</code>，它会智能扫描已安装的技能，助你精准卸载。</p>
<h4 data-id="heading-4">3. 轻量化 API 驱动</h4>
<p>sk-get 直接通过 <strong>GitHub API</strong> 获取内容。
这意味着你不需要安装本地 Git 环境，不需要克隆数百 MB 的仓库，运行速度极快，且原生支持本地智能缓存，断网也能查看已有的技能列表。</p>
<h4 data-id="heading-5">4. 多仓库管理与状态监控</h4>
<ul>
<li><strong>多源支持</strong>：轻松配置多个技能源，并根据项目需求灵活切换。</li>
<li><strong>状态概览</strong>：运行 <code>sg status</code>，一眼洞察当前激活的仓库、本地及全局已安装的技能分布。</li>
</ul>
<hr/>
<h3 data-id="heading-6">🛠️ 快速上手</h3>
<h4 data-id="heading-7">1. 安装</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g sk-get
</code></pre>
<h4 data-id="heading-8">2. 配置仓库</h4>
<p>添加你心仪的 GitHub 技能仓：</p>
<pre><code class="hljs language-bash" lang="bash">sg repo add https://github.com/your-name/my-ai-skills
</code></pre>
<h4 data-id="heading-9">3. 安装技能</h4>
<p>进入你的项目目录，直接运行：</p>
<pre><code class="hljs language-bash" lang="bash">sg add
</code></pre>
<p>随后按照交互提示，选择技能和目标平台即可！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6200a59da7ff4c0b9b0a3a0dea90d4f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTHl4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770514409&amp;x-signature=ZhsX%2BLG91VGZ6uasdg8ycy9n9QA%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-10">📂 仓库结构要求</h3>
<p>为了让 sk-get 正确读取，你的 GitHub 仓库只需保持以下简单的目录结构：</p>
<pre><code class="hljs language-text" lang="text">.
└── skills/
    ├── skill-name-1/
    │   └── SKILL.md
    └── skill-name-2/
        └── SKILL.md
</code></pre>
<hr/>
<h3 data-id="heading-11">结语</h3>
<p><strong>sk-get</strong> 并非只是一个简单的下载工具，它是 AI 协作流中的重要一环。通过将提示词工程（Prompt Engineering）资产化、版本化，它能帮助开发者和团队构建起一套可复用、可传播的 AI 核心竞争力。</p>
<p>如果你也在寻找一种更优雅的方式来管理你的 AI 助手，那么 <strong>sk-get</strong> 绝对值得一试。</p>
<p>👉 <strong>GitHub 仓库</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flyx-jay%2Fsk-get" target="_blank" title="https://github.com/lyx-jay/sk-get" ref="nofollow noopener noreferrer">github.com/lyx-jay/sk-…</a>
(欢迎 Star ⭐️ 并在 Issue 中提出你的建议！)</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅解 Junit 4 之 TestClass]]></title>    <link>https://juejin.cn/post/7601076694105292836</link>    <guid>https://juejin.cn/post/7601076694105292836</guid>    <pubDate>2026-02-01T08:49:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694105292836" data-draft-id="7601073900526059562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 浅解 Junit 4 之 TestClass"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-01T08:49:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="金銀銅鐵"/> <meta itemprop="url" content="https://juejin.cn/user/747323638159757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             浅解 Junit 4 之 TestClass
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323638159757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    金銀銅鐵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T08:49:56.000Z" title="Sun Feb 01 2026 08:49:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">背景</h2>
<p><code>JUnit 4</code> 是著名的单元测试框架，当我们使用以下这些注解时，<code>JUnit 4</code> 在背后做了些什么呢？</p>
<ul>
<li><code>@Test</code></li>
<li><code>@Before</code></li>
<li><code>@After</code></li>
<li><code>@BeforeClass</code></li>
<li><code>@AfterClass</code></li>
<li><code>@Ignore</code></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.313em;"/><span class="minner">⋯</span></span></span></span></span></li>
</ul>
<p>由于 <code>JUnit 4</code> 中有很多逻辑，如果用一篇文章涵盖过多内容的话，文章会很长，所以我打算写一系列文章，来讲讲我对 <code>JUnit 4</code> 的认识。本文是这个系列的第一篇。我们这就开始吧。</p>
<h2 data-id="heading-1">正文</h2>
<h3 data-id="heading-2">用到的文件</h3>
<p>我在本地创建了一个小项目来以便于学习 <code>JUnit 4</code>，这个项目中包含以下目录/文件（<code>.idea</code> 目录和 <code>target</code> 目录的内容均略去）</p>
<ul>
<li>src</li>
<li>src/test</li>
<li>src/test/java</li>
<li>src/test/java/org</li>
<li>src/test/java/org/study</li>
<li>src/test/java/org/study/AdderTest.java</li>
<li>src/main</li>
<li>src/main/resources</li>
<li>src/main/java</li>
<li>src/main/java/org</li>
<li>src/main/java/org/example</li>
<li>src/main/java/org/example/Adder.java</li>
<li>pom.xml</li>
</ul>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71b47ec8c3d646b6975f9809aca9986c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770540948&amp;x-signature=XoWmsc0imSEClGm%2FDcFixYPUNQ0%3D" alt="image.png" width="30%" loading="lazy"/>
<h4 data-id="heading-3"><code>pom.xml</code></h4>
<p><code>pom.xml</code> 文件内容如下（因为我们只关注 <code>JUnit 4</code>，所以只有 <code>JUnit 4</code> 的依赖）</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-study<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4"><code>Adder.java</code></h4>
<p><code>Adder.java</code> 的内容如下</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> org.example;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Adder</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
}
</code></pre>
<h4 data-id="heading-5"><code>AdderTest.java</code></h4>
<p><code>AdderTest.java</code> 的内容如下</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> org.study;

<span class="hljs-keyword">import</span> org.example.Adder;
<span class="hljs-keyword">import</span> org.junit.After;
<span class="hljs-keyword">import</span> org.junit.Assert;
<span class="hljs-keyword">import</span> org.junit.Before;
<span class="hljs-keyword">import</span> org.junit.Test;
<span class="hljs-keyword">import</span> org.junit.runners.model.TestClass;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdderTest</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Adder</span> <span class="hljs-variable">adder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Adder</span>();

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAdd</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Let's observe what we will get for 1 + 1"</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> adder.add(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        Assert.assertEquals(<span class="hljs-number">2</span>, result);
        System.out.println(<span class="hljs-string">"The result is: "</span> + result);
    }

    <span class="hljs-meta">@Before</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Hi, we are in a @Before-annotated method"</span>);
    }

    <span class="hljs-meta">@After</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Hi, we are in an @After-annotated method"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">TestClass</span> <span class="hljs-variable">testClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestClass</span>(AdderTest.class);
        <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">42</span>;
    }
}
</code></pre>
<p>在 <code>Intellij IDEA (Community Edition)</code> 里可以运行 <code>AdderTest</code> 中的单元测试，其效果如下所示 ⬇️</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3970e926f508418186fc732ad754a6eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770540948&amp;x-signature=sVGHRJrtRfgbDmdSIF0FTtKFBi4%3D" alt="image.png" loading="lazy"/></p>
<p>从运行结果中可以看到，</p>
<ul>
<li>带有 <code>@Before</code> 注解的方法在带有 <code>@Test</code> 注解的方法 <strong>之前</strong> 运行</li>
<li>带有 <code>@After</code> 注解的方法在带有 <code>@Test</code> 注解的方法 <strong>之后</strong> 运行</li>
</ul>
<p>但是 <code>JUnit 4</code> 怎么知道哪些方法带有 <code>@Before, @After, @Test</code> 注解呢？这就要提到本文的主角了: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>org.junit.runners.model.TestClass</mtext></mrow><annotation encoding="application/x-tex">\text{org.junit.runners.model.TestClass}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">org.junit.runners.model.TestClass</span></span></span></span></span></span></p>
<h2 data-id="heading-6"><code>TestClass</code></h2>
<p>我在 <code>AdderTest.java</code> 文件里写了 <code>main</code> 方法（具体代码请参考上文），我们可以在 <code>main</code> 方法里的 <code>int a = 42;</code> 这一行（这一行没有特别的含义，只是为了找个地方观察 <code>TestClass</code>）打一个断点，以观察 <code>TestClass</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d78743e06b704e8197507f21f0f95b47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770540948&amp;x-signature=hMT%2Fkt9iEOjjndC9D9%2FoWiJUlpI%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到 <code>testClass</code> 变量中有一个 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>methodsForAnnotations</mtext></mrow><annotation encoding="application/x-tex">\text{methodsForAnnotations}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">methodsForAnnotations</span></span></span></span></span></span> 字段（如上图所示）。这个字段是一个 <code>Map</code>。点击 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>methodsForAnnotations</mtext></mrow><annotation encoding="application/x-tex">\text{methodsForAnnotations}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">methodsForAnnotations</span></span></span></span></span></span> 这个字段后，可以看到其中有三个 <code>key</code> 分别和以下注解对应</p>
<ul>
<li><code>@Test</code></li>
<li><code>@Before</code></li>
<li><code>@After</code></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b0765bf1b934b2f9e3f8ceb8dd88081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770540948&amp;x-signature=Vm8qMdz6p82jGwI9q%2BEqgJWzSkk%3D" alt="image.png" loading="lazy"/></p>
<p>再点开这三个 <code>key-value</code> 对，可以看到带有对应注解的方法都出现在对应的 <code>value</code> 中 ⬇️</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73ac0903a5014213ad6321d8c53b6561~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770540948&amp;x-signature=quGTdiU3%2BLWE6SRgXXUQBol1jos%3D" alt="image.png" loading="lazy"/></p>
<p>由此可以猜测，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>org.junit.runners.model.TestClass</mtext></mrow><annotation encoding="application/x-tex">\text{org.junit.runners.model.TestClass}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">org.junit.runners.model.TestClass</span></span></span></span></span></span> 应该会分析指定类中各个方法上的注解，并将这些信息保存到了 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>methodsForAnnotations</mtext></mrow><annotation encoding="application/x-tex">\text{methodsForAnnotations}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord text"><span class="mord">methodsForAnnotations</span></span></span></span></span></span> 字段中。
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>org.junit.runners.model.TestClass</mtext></mrow><annotation encoding="application/x-tex">\text{org.junit.runners.model.TestClass}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord text"><span class="mord">org.junit.runners.model.TestClass</span></span></span></span></span></span> 的构造函数如下图所示，看起来这个猜测是正确的。（读者朋友可以在这个构造函数里打断点观察一下，加深理解，纯靠猜测还是会有失手的时候）
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/741b39ba01eb45948a2ef4b2fcccad3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770540948&amp;x-signature=TyJlsDYnautWqMMBOrJNDTKoqmw%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[开源了一个插件：让 Claude Skills 在任何 Agent 上跑起来 🚀]]></title>    <link>https://juejin.cn/post/7601101531919925294</link>    <guid>https://juejin.cn/post/7601101531919925294</guid>    <pubDate>2026-02-01T02:36:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601101531919925294" data-draft-id="7601144981170208818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="开源了一个插件：让 Claude Skills 在任何 Agent 上跑起来 🚀"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-01T02:36:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hahaeee"/> <meta itemprop="url" content="https://juejin.cn/user/3650034331552238"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            开源了一个插件：让 Claude Skills 在任何 Agent 上跑起来 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3650034331552238/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hahaeee
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T02:36:38.000Z" title="Sun Feb 01 2026 02:36:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开源了一个插件：让 Claude Skills 在任何 Agent 上跑起来 🚀</h2>
<h3 data-id="heading-1">背景</h3>
<p>最近在用 Claude Skills 的时候发现一个问题：很多 AI Agent 平台（比如 Kiro、Dify 等）只支持 MCP 协议，不支持原生的 Claude Skills。眼馋 Skills 却无法使用太痛苦了。</p>
<p>于是我做了这个工具，<strong>可以把 Claude Skills 转成 MCP 工具</strong>，通过MCP的方式将Skills接入进来。</p>
<h3 data-id="heading-2">使用步骤</h3>
<h4 data-id="heading-3">1. 下载skill</h4>
<p>通过 github 搜索你需要的 Skills 到本地,解压处理. (注意多个skill要放在同一个文件夹下)</p>
<pre><code class="hljs language-erlang" lang="erlang">路径:
    skill-<span class="hljs-number">1</span>
        skill.md
        ...
    skill-<span class="hljs-number">2</span>
        skill.md
        ...
</code></pre>
<h4 data-id="heading-4">2. 配置 MCP服务</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mcp-skills-explorer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"mcp-skills-explorer"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"SKILLS_DIR"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{你的skill文件夹路径}"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-5">3. 完事</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/890af721040c4f39a6a484c8952439d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFoYWVlZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518714&amp;x-signature=9BY8dYEwdMUaBQ8rzlH6uEg3Mdo%3D" alt="image.png" loading="lazy"/></p>
<p>搞定！ skill就会以MCP工具的方式被装载到agent上了.</p>
<p>当agent需要使用skill,就会通过mcp工具获取到skill信息,再阅读skill文档.</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce5be13030d04accb88b0d95c6b9e41b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFoYWVlZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770518714&amp;x-signature=304yn7HzaY%2BHh5ejRGpwk7i6c%2FQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">技术实现</h3>
<p>项目使用 TypeScript 开发，核心逻辑：</p>
<ol>
<li>监听 <code>claude-skills</code> 目录变化</li>
<li>解析 <code>skill.md</code> 文件（Markdown 格式）</li>
<li>动态注册为 MCP 工具</li>
<li>处理工具调用请求</li>
</ol>
<p>代码结构清晰，易于扩展，欢迎贡献 PR！</p>
<h3 data-id="heading-7">开源地址</h3>
<ul>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fd342784178%2Fmcp-skills-explorer" target="_blank" title="https://github.com/d342784178/mcp-skills-explorer" ref="nofollow noopener noreferrer">github.com/d342784178/…</a></li>
<li>NPM: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fmcp-skills-explorer" target="_blank" title="https://www.npmjs.com/package/mcp-skills-explorer" ref="nofollow noopener noreferrer">www.npmjs.com/package/mcp…</a></li>
</ul>
<hr/>
<p><strong>标签</strong>：#AI #Claude #MCP #开源 #工具</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openclaw 技术分析]]></title>    <link>https://juejin.cn/post/7601076694104801316</link>    <guid>https://juejin.cn/post/7601076694104801316</guid>    <pubDate>2026-02-01T03:15:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076694104801316" data-draft-id="7601159804490350611" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openclaw 技术分析"/> <meta itemprop="keywords" content="前端,架构"/> <meta itemprop="datePublished" content="2026-02-01T03:15:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dony7247"/> <meta itemprop="url" content="https://juejin.cn/user/3245414054367607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openclaw 技术分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3245414054367607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dony7247
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T03:15:38.000Z" title="Sun Feb 01 2026 03:15:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>github url :<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw" target="_blank" title="https://github.com/openclaw/openclaw" ref="nofollow noopener noreferrer">github.com/openclaw/op…</a></p>
<p>项目是纯前端写的，主要用typescript</p>
<h2 data-id="heading-0">主要概念：</h2>
<p><strong>Gateway</strong>, <strong>Agents</strong>, <strong>Sessions</strong>, <strong>Channels</strong>, <strong>Nodes</strong>, <strong>Tools</strong>,  <strong>Skills</strong>.</p>
<h3 data-id="heading-1">框架图：</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/530ed298ab77476d9efac0895010b41f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZG9ueTcyNDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770520537&amp;x-signature=22LzvYuEwanDqMlk1OwqdK99bcM%3D" alt="whiteboard_exported_image (2).png" loading="lazy"/></p>
<h3 data-id="heading-2">Gateway: The Control Plane</h3>
<p>网关是 OpenClaw 的中央协调枢纽——一个 WebSocket 服务器 <strong>，</strong> 用于协调所有系统组件。它作为单个进程运行（通常在 18789 端口上运行），并管理agents、sessions、channels、tools和nodes。</p>
<p>默认网关</p>
<pre><code class="hljs language-arduino" lang="arduino">ws:<span class="hljs-comment">//127.0.0.1:18789 </span>
</code></pre>
<h3 data-id="heading-3">Agents：AI 执行运行时</h3>
<p>Agent是通过<strong>Pi Agent Core</strong>运行时支持的 AI 助手实例。每个<strong>Agent</strong>都有自己的工作区、模型配置、工具策略和身份验证配置文件。</p>
<pre><code class="hljs language-perl" lang="perl">~<span class="hljs-regexp">/.openclaw/ag</span>ents/&lt;agentId&gt;<span class="hljs-regexp">/ 
├── agent/</span> 
│ ├── auth-profiles.json <span class="hljs-comment"># OAuth + API key credentials </span>
│ └── auth.json <span class="hljs-comment"># Runtime cache (managed by Pi Core) </span>
├── sessions/ 
│ └── agent-&lt;agentId&gt;.json <span class="hljs-comment"># Session transcripts </span>
└── workspace/ <span class="hljs-comment"># Files accessible to the agent </span>
├── AGENTS.md <span class="hljs-comment"># System prompt bootstrap </span>
├── SOUL.md <span class="hljs-comment"># Identity/personality </span>
├── TOOLS.md <span class="hljs-comment"># Tool guidance </span>
└── skills/
</code></pre>
<p><strong>代理工具执行：</strong>  代理通过执行工具<code>createOpenClawCodingTools</code>来完成组装：</p>
<ul>
<li>文件系统工具：<code>read</code>,<code>write</code>,<code>edit</code>,<code>apply_patch</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fblob%2Fbf6ec64f%2Fsrc%2Fagents%2Fpi-tools.ts%23L229-L251" target="_blank" title="https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L229-L251" ref="nofollow noopener noreferrer">src/agents/pi-tools.ts229-251</a>）</li>
<li>运行时工具：<code>exec</code>，<code>process</code>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fblob%2Fbf6ec64f%2Fsrc%2Fagents%2Fbash-tools.ts" target="_blank" title="https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts" ref="nofollow noopener noreferrer">src/agents/bash-tools.ts</a>）</li>
<li>OpenClaw 工具：<code>browser</code>，<code>canvas</code>,<code>nodes</code>,<code>message</code>,<code>sessions_*</code>,<code>cron</code>,<code>gateway</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fblob%2Fbf6ec64f%2Fsrc%2Fagents%2Fopenclaw-tools.ts" target="_blank" title="https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools.ts" ref="nofollow noopener noreferrer">src/agents/openclaw-tools.ts</a>）</li>
<li>插件工具：来自扩展的可选工具（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenclaw%2Fopenclaw%2Fblob%2Fbf6ec64f%2Fsrc%2Fplugins%2Ftools.ts" target="_blank" title="https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/tools.ts" ref="nofollow noopener noreferrer">src/plugins/tools.ts</a>）</li>
</ul>
<h3 data-id="heading-4">sessions：对话状态管理</h3>
<p>sessions 代表一个独立的对话上下文，拥有自己的消息历史记录、模型设置和工具执行状态。会话通过会话键进行标识，会话键编码了路由信息。</p>
<p>会话路由：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f559aa922f4149cb97d70cad9d288e99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZG9ueTcyNDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770520537&amp;x-signature=4zjxTMSN2OqBl2O%2FNTntVBW3SH0%3D" alt="sessions 路由.png" loading="lazy"/></p>
<p>会话模式：</p>
<ul>
<li>会话重置策略</li>
<li>会话队列模式</li>
<li>会话状态管理</li>
</ul>
<h3 data-id="heading-5">channels：消息平台集成</h3>
<p><strong>channels</strong>是连接 OpenClaw 和消息平台的适配器。每个通道负责处理特定于平台的身份验证、消息格式和传递。如：WhatsApp，telegram,discard,飞书，google chat</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8480b6a8a7043ba8329a8cc1f00d214~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZG9ueTcyNDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770520537&amp;x-signature=8oT3Tkpvy8uQdjEWOJ6vOm8ZLbE%3D" alt="channels流程图.png" loading="lazy"/></p>
<h3 data-id="heading-6">nodes：设备功能提供商</h3>
<p>**nodes **  是与网关配对的配套应用程序（iOS、Android、macOS），通过 gateway 与 agents 通信。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21609269983e4ab89cfac4e22c7fdeca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZG9ueTcyNDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770520537&amp;x-signature=bSxRO4MT0vz5rN0fSPgCQA6Nc14%3D" alt="whiteboard_exported_image (1).png" loading="lazy"/></p>
<h3 data-id="heading-7">tools：代理功能</h3>
<p><strong>tools</strong>是代理在执行过程中可以调用的功能。OpenClaw 提供内置工具，用于文件操作、shell 执行、浏览器控制、消息传递和系统集成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8881aff2d3546c2b1c114b69a0cf7c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZG9ueTcyNDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770520537&amp;x-signature=dzUhMfucakViLtGmD8ZtkJFp4RU%3D" alt="tools.png" loading="lazy"/></p>
<p><strong>skills</strong>是包含提示、脚本和元数据的独立包，用于扩展代理的功能。它们存在于代理的工作区中，并会被自动发现并注入到系统提示中。</p>
<pre><code class="hljs language-ruby" lang="ruby">~<span class="hljs-regexp">/.openclaw/agents</span><span class="hljs-regexp">/&lt;agentId&gt;/workspace</span><span class="hljs-regexp">/skills/</span> 
├── github/ 
│ ├── <span class="hljs-variable constant_">SKILL</span>.md <span class="hljs-comment"># Skill documentation (injected into prompt) </span>
│ ├── package.json <span class="hljs-comment"># Metadata (name, description, dependencies) </span>
│ └── bin/ <span class="hljs-comment"># Optional binaries/scripts </span>
├── slack/ 
│ ├── <span class="hljs-variable constant_">SKILL</span>.md 
│ └── package.json 
└── custom-skill/ 
├── <span class="hljs-variable constant_">SKILL</span>.md 
└── package.json
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用CodePlan 10分钟内带你部署启动 OpenClaw（原MoltBot/ClawdBot）]]></title>    <link>https://juejin.cn/post/7601073900525682730</link>    <guid>https://juejin.cn/post/7601073900525682730</guid>    <pubDate>2026-02-01T03:32:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601073900525682730" data-draft-id="7601075423003295780" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用CodePlan 10分钟内带你部署启动 OpenClaw（原MoltBot/ClawdBot）"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2026-02-01T03:32:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="EgoLee"/> <meta itemprop="url" content="https://juejin.cn/user/4408388462851657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用CodePlan 10分钟内带你部署启动 OpenClaw（原MoltBot/ClawdBot）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4408388462851657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    EgoLee
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T03:32:20.000Z" title="Sun Feb 01 2026 03:32:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"/>
<blockquote>
<p>"如果你想要一个感觉像本地助手、速度快、始终在线的单人个人助理，那就是它了。"</p>
</blockquote>
<p>本文档旨在指导用户在终端环境中快速安装并初始化 OpenClaw。在一切开始之前，您需要一台VM（虚拟机），且最好支持访问全球互联网。</p>
<h2 data-id="heading-1">1. 下载与安装 OpenClaw</h2>
<p>请根据您所在的网络环境，选择以下其中一种方式在终端中运行安装命令。该命令将自动下载组件并启动初始化流程。</p>
<h3 data-id="heading-2">选项 A：官方安装脚本</h3>
<p>*适用对象：国际网络环境较好的用户<br/>
*<br/>
<code>curl -fsSL https://openclaw.ai/install.sh | bash</code></p>
<h3 data-id="heading-3">选项 B：X-AIO 加速安装脚本</h3>
<p><em>适用对象：中国大陆地区用户（使用 CDN 加速）</em></p>
<p><code>curl -fsSL https://cdn.x-aio.com/X-AIO/Apps/OpenClaw/install.sh | bash</code></p>
<h2 data-id="heading-4">2. 初始化 OpenClaw</h2>
<p>运行上述脚本后，程序将自动进入 "OpenClaw onboarding" 流程。</p>
<h3 data-id="heading-5">2.1 阅读并同意安全风险警告 (Security Warning)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cd9a840e9684167a81924ce4b002992~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=Oby5YUNUS8bCsCeu%2FUAr2SQq9I4%3D" alt="Screenshot 2026-01-30 at 6.19.05 PM.png" loading="lazy"/></p>
<p>安装程序启动后，首先会显示 <strong>Security</strong>（安全）界面。</p>
<p>系统会告知您：</p>
<ul>
<li>OpenClaw 目前仍处于 Beta 测试阶段（"Expect sharp edges"）。</li>
<li>该助手具有读取文件和执行操作的权限，如果启用工具（Tools），错误的提示词可能会导致不安全的操作。</li>
<li>建议采取基本的安全措施（如沙箱环境、最小权限原则等）。</li>
</ul>
<p><strong>界面提示：</strong></p>
<p>屏幕底部会出现确认询问：</p>
<blockquote>
<p><code>I understand this is powerful and inherently risky. Continue?</code></p>
<p>(我明白这很强大且原本就具有风险。继续？)</p>
</blockquote>
<p><strong>操作步骤：</strong></p>
<ol>
<li>仔细阅读屏幕上的安全警告信息。</li>
<li>使用键盘 <strong>方向键</strong> 选中 <strong>Yes</strong>（选中项通常会显示为绿色圆点 <code>●</code>）。</li>
<li>按 <strong>回车键 (Enter)</strong> 确认进入下一步。</li>
</ol>
<h3 data-id="heading-6">2.2 确认快速启动配置并跳过模型设置</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e43c46f4e10e4571ae2894654650238d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=wGBAz64r7n3KvasAGmXvKPfsTxg%3D" alt="Screenshot 2026-01-30 at 6.19.28 PM.png" loading="lazy"/></p>
<p>同意安全警告后，系统会显示 <strong>QuickStart</strong>（快速启动）的默认网络配置，并要求您选择模型提供商。</p>
<p><strong>界面信息：</strong></p>
<ul>
<li><strong>QuickStart 配置预览</strong>：顶部方框内显示了默认的网关端口 (18789) 和绑定地址 (127.0.0.1)，这表示服务将在本地运行。</li>
<li><strong>Model/auth provider</strong>：列表显示了支持的各种 AI 模型提供商（如 OpenAI, Anthropic, Google 等）。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/751a3337a671453082864f2783757ba9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=cTZ3jN9KNpmUYFLU2qw2XOt%2FVg8%3D" alt="Screenshot 2026-01-30 at 6.19.49 PM.png" loading="lazy"/></li>
</ul>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p>系统展示默认配置时，无需修改，直接关注下方的列表。</p>
</li>
<li>
<p>使用键盘 <strong>方向键 (下)</strong> 将光标移动到列表的最底部。</p>
</li>
<li>
<p>选中 <strong>Skip for now</strong>（暂时跳过）。</p>
<ul>
<li><em>说明：我们将在后续步骤或配置文件中详细设置模型，此处先跳过以完成基础安装。</em></li>
</ul>
</li>
<li>
<p>按 <strong>回车键 (Enter)</strong> 确认。</p>
</li>
</ol>
<h3 data-id="heading-7">2.3 跳过通信渠道配置 (Select Channel)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa937491dac84f92832fd9ea7013be30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=H5mL%2BixSzi96LPh2%2BPlfbnLUSDA%3D" alt="Screenshot 2026-01-30 at 6.20.02 PM.png" loading="lazy"/></p>
<p>配置完模型后，系统会询问您希望通过哪个平台（Channel）与 OpenClaw 进行交互。OpenClaw 支持 Telegram、Discord、Slack、iMessage 等多种主流平台。</p>
<p><strong>界面信息：</strong></p>
<ul>
<li>列表列出了所有支持的即时通讯平台接口。</li>
<li>既然我们是在终端进行本地测试或计划稍后配置，这里同样选择跳过。</li>
</ul>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p>使用键盘 <strong>方向键 (下)</strong> 滚动到列表的最底部。</p>
</li>
<li>
<p>选中 <strong>Skip for now</strong>。</p>
<ul>
<li><em>提示信息显示：You can add channels later via <code>openclaw channels add</code>（您稍后可以通过命令添加渠道）。</em></li>
</ul>
</li>
<li>
<p>按 <strong>回车键 (Enter)</strong> 确认。</p>
</li>
</ol>
<h3 data-id="heading-8">2.4 配置技能安装方式 (Configure Skills)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80643ad6206c4d95a0f6d3c228e0ff78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=F2HoAojz%2BgaY1fW%2FFGWKtjOvCho%3D" alt="Screenshot 2026-01-30 at 6.20.25 PM.png" loading="lazy"/></p>
<p>系统会引导您配置 "Skills"（技能/工具）的运行环境。OpenClaw 依赖外部工具来扩展其能力。</p>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p><strong>Configure skills now?</strong> (现在配置技能？)</p>
<ul>
<li>选中 <strong>Yes</strong> 并按回车。</li>
</ul>
</li>
<li>
<p><strong>Show Homebrew install command?</strong> (显示 Homebrew 安装命令？)</p>
<ul>
<li>如果您的系统尚未安装 Homebrew，选中 <strong>Yes</strong> 查看命令；否则直接回车继续。</li>
</ul>
</li>
<li>
<p><strong>Preferred node manager for skill installs</strong> (选择首选的 Node 包管理器)</p>
<ul>
<li>使用键盘 <strong>方向键</strong> 选中 <strong>pnpm</strong>（推荐用于节省磁盘空间和加快安装速度）。</li>
<li>按 <strong>回车键 (Enter)</strong> 确认。</li>
</ul>
</li>
<li>
<p>暂时不配置Skills，之后可以再配置</p>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8fade4ef90245deb5beb1d9d1ce245e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=wVVabWwt4iYk55hC3F0CkQ9ZLzI%3D" alt="Screenshot 2026-01-30 at 6.20.34 PM.png" loading="lazy"/></p>
<h3 data-id="heading-9">2.5 跳过外部工具 API Key 配置</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294b11f91233405b8512e7a530cdd00f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=CaAiOvmp31NamHfguma%2FsQsuNz4%3D" alt="Screenshot 2026-01-30 at 6.21.15 PM.png" loading="lazy"/></p>
<p>在配置完技能环境后，系统会检测到一些预置的工具（如 Google Places, Notion 等），并询问是否立即设置它们的 API Key。</p>
<p><strong>界面信息：</strong></p>
<p>系统会依次列出如下服务，询问是否设置 Key (<code>Set ... API_KEY for ...?</code>)：</p>
<ul>
<li><code>GOOGLE_PLACES_API_KEY</code> (地图服务)</li>
<li><code>GEMINI_API_KEY</code> (Google AI)</li>
<li><code>NOTION_API_KEY</code> (笔记服务)</li>
<li><code>OPENAI_API_KEY</code> (图像生成/语音转文字)</li>
<li><code>ELEVENLABS_API_KEY</code> (语音合成)</li>
</ul>
<p><strong>操作步骤：</strong></p>
<ol>
<li>为了保持快速启动流程，且避免复杂的密钥申请过程，我们统一选择跳过。</li>
<li>对于每一个询问，确保光标停留在 <strong>No</strong> 上。</li>
<li>连续按 <strong>回车键 (Enter)</strong> ，直到通过所有询问。</li>
</ol>
<h3 data-id="heading-10">2.6 启用系统钩子与记忆功能 (Enable Hooks)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e15a1f10e90e4f54bc7ec466165ce880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=mFZKBH2v4vcfxAMvqI5tEOifxUQ%3D" alt="Screenshot 2026-01-30 at 6.21.44 PM.png" loading="lazy"/></p>
<p>这一步至关重要！系统会询问是否启用 "Hooks"（钩子），这些功能决定了 OpenClaw 是否具备记忆和自动化能力。</p>
<p><strong>选项说明：</strong></p>
<ul>
<li><code>boot-md</code>: <strong>启动脚本</strong>。允许 OpenClaw 在启动时自动运行 <code>BOOT.md</code> 中定义的指令。</li>
<li><code>command-logger</code>: <strong>命令审计</strong>。将所有交互记录保存到日志文件中，方便后续查阅。</li>
<li><code>session-memory</code>: <strong>会话记忆</strong>。这是核心功能！它允许 OpenClaw 在您输入 <code>/new</code> 开启新对话时，依然保留之前的上下文记忆（Context）。</li>
</ul>
<p><strong>操作步骤：</strong></p>
<ol>
<li>
<p>确保屏幕上的 <strong>boot-md</strong>, <strong>command-logger</strong>, 和 <strong>session-memory</strong> 这三项都被选中（显示为绿色方块 <code>■</code>）。</p>
<ul>
<li><em>提示：通常默认已全选。如果未选中，请使用方向键移动光标，按空格键 (Space) 进行切换。</em></li>
</ul>
</li>
<li>
<p>确保 <strong>Skip for now</strong> 未被选中（显示为 <code>□</code>）。</p>
</li>
<li>
<p>按 <strong>回车键 (Enter)</strong> 确认。</p>
</li>
</ol>
<h3 data-id="heading-11">2.7 完成配置并退出 (Finish)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a773a33844fe4161b24b34d49f6ab271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=h%2Bafzw6c0xj8QgEgplkK1CWpE6Q%3D" alt="Screenshot 2026-01-30 at 6.23.06 PM.png" loading="lazy"/></p>
<p>初始化流程的最后一步，系统会询问您希望如何 "孵化" (Hatch) 您的助手，即首次启动的方式。</p>
<p><strong>界面信息：</strong></p>
<ul>
<li><strong>Hatch in TUI</strong>: 在当前终端启动文本交互界面（推荐）。</li>
<li><strong>Open the Web UI</strong>: 打开网页版控制台。</li>
<li><strong>Do this later</strong>: 稍后手动启动。</li>
</ul>
<p><strong>操作步骤：</strong></p>
<ol>
<li>为了确保我们可以先检查安装状态或稍后手动启动服务，这里选择退出向导。</li>
<li>使用键盘 <strong>方向键 (下)</strong> 选中 <strong>Do this later</strong>。</li>
<li>按 <strong>回车键 (Enter)</strong> 确认。</li>
</ol>
<h2 data-id="heading-12">3. 配置 X-AIO 接口与模型参数</h2>
<p>为了让 OpenClaw 能够真正“思考”和回答问题，我们需要为其配置大模型接口。我们提供了一个自动化脚本，可以一键将 X-AIO CodePlan 的高性能接口配置到您的 OpenClaw 中。</p>
<p><strong>注意：</strong> 此步骤涉及关键参数的手动配置，直接影响 OpenClaw 的记忆和推理能力。</p>
<p>在终端中运行以下命令：</p>
<p><code>python3 &lt;(curl -fsSL https://cdn.x-aio.com/X-AIO/tools/openclaw_setup.py)</code></p>
<p>**<br/>
交互式配置指南：**</p>
<p>脚本运行过程中会提示您输入或确认以下信息。<strong>注意：以下参数应根据您实际选择的模型来决定。如果您不确定或不懂如何设置，请直接“照抄”以下推荐值以完成配置。</strong></p>
<ol>
<li>
<p><strong>选择主模型 (Main Model)</strong> ：</p>
<ul>
<li><strong>推荐选择</strong>：<code>x-aio/MiniMax-M2.1</code></li>
<li><em>说明：该模型在逻辑推理和长文本处理上表现优异，适合作为默认选择。</em></li>
</ul>
</li>
<li>
<p><strong>配置上下文窗口 (Context Window)</strong> ：</p>
<ul>
<li><strong>推荐值</strong>：<code>200000</code></li>
<li><em>说明：此数值取决于模型的最大上下文限制。对于 MiniMax 等大窗口模型，200k 是个不错的起点。</em></li>
</ul>
</li>
<li>
<p><strong>配置最大输出 (Max Output)</strong> ：</p>
<ul>
<li><strong>推荐值</strong>：<code>32000</code></li>
<li><em>说明：确保助手在生成长篇内容（如教程、代码）时不会中断。</em></li>
</ul>
</li>
<li>
<p><strong>配置 Embedding 模型 (关键！)</strong> ：</p>
<ul>
<li><strong>必选</strong>：<code>Qwen3-VL-Embedding-8B</code></li>
<li><em>警告：此选项直接决定 OpenClaw 记忆系统的工作情况。如果未正确配置，助手将无法通过语义搜索找回之前的记忆。</em></li>
</ul>
</li>
</ol>
<p><strong>配置完成确认：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc099b000cd44c9d828824bc26135bff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWdvTGVl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770521540&amp;x-signature=XP42wqnPf%2Bd0MPnb5I3MOFhU950%3D" alt="Screenshot 2026-01-30 at 7.21.33 PM.png" loading="lazy"/></p>
<p>如上图所示，当看到 <code>✨ 配置完成!</code> 且配置摘要中的参数与您的设置一致时，即表示接口接入成功。</p>
<h2 data-id="heading-13">4. 验证与启动</h2>
<p>配置完成后，建议按照以下步骤验证环境并启动助手。</p>
<h3 data-id="heading-14">4.1 验证配置</h3>
<p>运行 OpenClaw 的医生程序来检查环境健康度：</p>
<p><code>openclaw doctor</code></p>
<p>查看已配置的模型列表，确保 x-aio 模型在列：</p>
<p><code>openclaw models list</code></p>
<h3 data-id="heading-15">4.2 启动对话</h3>
<p>使用以下命令直接启动一个名为 "main" 的 Agent，并发送测试消息：</p>
<p><code>openclaw agent --agent main -m "hello"</code></p>
<p>现在，OpenClaw 已经准备好为您服务了！现在您可以继续深入绑定您的OpenClaw到您的各种IM程序中。我会在帖子后续跟进补充对接到主流IM的的方法！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[零拷贝 IPC：用内存映射文件打造 .NET 高性能进程间通信队列]]></title>    <link>https://juejin.cn/post/7601101531921006638</link>    <guid>https://juejin.cn/post/7601101531921006638</guid>    <pubDate>2026-02-01T07:12:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601101531921006638" data-draft-id="7601757036485771274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="零拷贝 IPC：用内存映射文件打造 .NET 高性能进程间通信队列"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-01T07:12:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大黄评测"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            零拷贝 IPC：用内存映射文件打造 .NET 高性能进程间通信队列
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大黄评测
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:12:09.000Z" title="Sun Feb 01 2026 07:12:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在现代多进程系统中，进程间通信（IPC）是实现模块解耦、资源隔离和横向扩展的关键技术。传统的 IPC 方式如命名管道（Named Pipes）、TCP 套接字或 WCF 虽然成熟，但在高吞吐、低延迟场景下往往受限于内核缓冲区复制、序列化开销等问题。</p>
<p>内存映射文件（Memory-Mapped Files, MMF）提供了一种“零拷贝”共享内存机制，允许多个进程直接读写同一块物理内存区域，从而极大提升通信效率。本文将展示如何在 .NET（.NET 6+）中利用 <code>MemoryMappedFile</code> 构建一个线程安全、跨进程的环形队列（Ring Buffer），用于高性能消息传递。</p>
<hr/>
<h2 data-id="heading-1">内存映射文件简介</h2>
<p>.NET 提供了 <code>System.IO.MemoryMappedFiles</code> 命名空间，其中核心类型包括：</p>
<ul>
<li><code>MemoryMappedFile</code>：表示内存映射文件对象。</li>
<li><code>MemoryMappedViewAccessor</code> / <code>MemoryMappedViewStream</code>：用于访问映射区域。</li>
</ul>
<p>通过创建<strong>命名</strong>的内存映射文件，不同进程可打开同一个映射区域，实现共享内存通信。</p>
<hr/>
<h2 data-id="heading-2">设计思路：基于环形缓冲区的 IPC 队列</h2>
<p>我们设计一个固定大小的环形缓冲区，包含以下关键元素：</p>
<ul>
<li><strong>缓冲区数据区</strong>：存储实际消息（字节数组）。</li>
<li><strong>头指针（Head）</strong> ：下一个要读取的位置。</li>
<li><strong>尾指针（Tail）</strong> ：下一个要写入的位置。</li>
<li><strong>消息长度前缀</strong>：每个消息前附加 4 字节长度（int32），便于解析边界。</li>
<li><strong>同步原语</strong>：使用命名互斥体（Mutex）或信号量（Semaphore）保证多进程并发安全。</li>
</ul>
<p>为简化，本文使用 <strong>互斥锁 + 自旋重试</strong> 实现基本同步（生产环境建议结合事件通知优化性能）。</p>
<hr/>
<h2 data-id="heading-3">核心实现</h2>
<h3 data-id="heading-4">1. 定义共享内存布局</h3>
<p>假设最大消息大小为 1KB，队列总容量为 1MB：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> MAX_MESSAGE_SIZE = <span class="hljs-number">1024</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> BUFFER_SIZE = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 1MB</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> HEADER_SIZE = <span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">int</span>); <span class="hljs-comment">// 消息长度前缀</span>
</code></pre>
<p>共享内存结构如下：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Head (8 bytes)]</span><span class="hljs-selector-attr">[Tail (8 bytes)]</span><span class="hljs-selector-attr">[Data Buffer (BUFFER_SIZE)]</span>
</code></pre>
<blockquote>
<p>注意：使用 <code>long</code>（8 字节）存储指针，避免 32/64 位对齐问题。</p>
</blockquote>
<h3 data-id="heading-5">2. 创建/打开内存映射文件</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MmfIpcQueue</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> MemoryMappedFile _mmf;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> MemoryMappedViewAccessor _accessor;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> Mutex _mutex;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">string</span> _mutexName;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> HEAD_OFFSET = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> TAIL_OFFSET = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">long</span> DATA_OFFSET = <span class="hljs-number">16</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MmfIpcQueue</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>
    {
        _mmf = MemoryMappedFile.CreateOrOpen(name, DATA_OFFSET + BUFFER_SIZE);
        _accessor = _mmf.CreateViewAccessor();
        _mutexName = <span class="hljs-string">$"MMF_IPC_MUTEX_<span class="hljs-subst">{name}</span>"</span>;
        _mutex = <span class="hljs-keyword">new</span> Mutex(<span class="hljs-literal">false</span>, _mutexName);
    }
}
</code></pre>
<h3 data-id="heading-6">3. 写入消息（Enqueue）</h3>
<pre><code class="hljs language-ini" lang="ini">public bool TryEnqueue(byte<span class="hljs-section">[]</span> message)
{
    if (message.Length &gt; MAX_MESSAGE_SIZE)
        throw new ArgumentException("Message too large")<span class="hljs-comment">;</span>

    _mutex.WaitOne()<span class="hljs-comment">;</span>
    try
    {
        long <span class="hljs-attr">head</span> = _accessor.ReadInt64(HEAD_<span class="hljs-literal">OFF</span>SET)<span class="hljs-comment">;</span>
        long <span class="hljs-attr">tail</span> = _accessor.ReadInt64(TAIL_<span class="hljs-literal">OFF</span>SET)<span class="hljs-comment">;</span>

        int <span class="hljs-attr">required</span> = HEADER_SIZE + message.Length<span class="hljs-comment">;</span>
        long <span class="hljs-attr">nextTail</span> = (tail + required) % BUFFER_SIZE<span class="hljs-comment">;</span>

        // 检查是否追上 head（缓冲区满）
        if (<span class="hljs-attr">nextTail</span> == head &amp;&amp; tail != head)
            return false<span class="hljs-comment">; // 队列满</span>

        // 写入长度 + 数据
        _accessor.Write(DATA_OFFSET + tail, message.Length)<span class="hljs-comment">;</span>
        _accessor.WriteArray(DATA_OFFSET + tail + HEADER_SIZE, message, 0, message.Length)<span class="hljs-comment">;</span>

        // 更新 tail
        _accessor.WriteInt64(TAIL_OFFSET, nextTail)<span class="hljs-comment">;</span>
        return true<span class="hljs-comment">;</span>
    }
    finally
    {
        _mutex.ReleaseMutex()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h3 data-id="heading-7">4. 读取消息（Dequeue）</h3>
<pre><code class="hljs language-ini" lang="ini">public bool TryDequeue(out byte<span class="hljs-section">[]</span>? message)
{
    <span class="hljs-attr">message</span> = null<span class="hljs-comment">;</span>
    _mutex.WaitOne()<span class="hljs-comment">;</span>
    try
    {
        long <span class="hljs-attr">head</span> = _accessor.ReadInt64(HEAD_<span class="hljs-literal">OFF</span>SET)<span class="hljs-comment">;</span>
        long <span class="hljs-attr">tail</span> = _accessor.ReadInt64(TAIL_<span class="hljs-literal">OFF</span>SET)<span class="hljs-comment">;</span>

        if (<span class="hljs-attr">head</span> == tail)
            return false<span class="hljs-comment">; // 队列空</span>

        int <span class="hljs-attr">length</span> = _accessor.ReadInt32(DATA_<span class="hljs-literal">OFF</span>SET + head)<span class="hljs-comment">;</span>
        <span class="hljs-attr">message</span> = new byte[length]<span class="hljs-comment">;</span>
        _accessor.ReadArray(DATA_OFFSET + head + HEADER_SIZE, message, 0, length)<span class="hljs-comment">;</span>

        long <span class="hljs-attr">nextHead</span> = (head + HEADER_SIZE + length) % BUFFER_SIZE<span class="hljs-comment">;</span>
        _accessor.WriteInt64(HEAD_OFFSET, nextHead)<span class="hljs-comment">;</span>

        return true<span class="hljs-comment">;</span>
    }
    finally
    {
        _mutex.ReleaseMutex()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-8">使用示例</h2>
<p><strong>进程 A（生产者）</strong> ：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">using</span> var queue = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MmfIpcQueue</span>(<span class="hljs-string">"MyQueue"</span>);
queue.<span class="hljs-built_in">TryEnqueue</span>(Encoding.UTF8.<span class="hljs-built_in">GetBytes</span>(<span class="hljs-string">"Hello from Process A!"</span>));
</code></pre>
<p><strong>进程 B（消费者）</strong> ：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">using</span> var queue = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MmfIpcQueue</span>(<span class="hljs-string">"MyQueue"</span>);
<span class="hljs-keyword">if</span> (queue.<span class="hljs-built_in">TryDequeue</span>(out var msg))
{
    <span class="hljs-built_in">Console</span>.<span class="hljs-built_in">WriteLine</span>(Encoding.UTF8.<span class="hljs-built_in">GetString</span>(msg));
}
</code></pre>
<hr/>
<h2 data-id="heading-9">性能与注意事项</h2>
<h3 data-id="heading-10">优势</h3>
<ul>
<li><strong>零拷贝</strong>：消息直接在共享内存中读写，无内核缓冲区复制。</li>
<li><strong>低延迟</strong>：微秒级通信延迟。</li>
<li><strong>跨语言兼容</strong>：只要约定内存布局，C/C++、Rust 等也可接入。</li>
</ul>
<h3 data-id="heading-11">注意事项</h3>
<ol>
<li><strong>同步开销</strong>：频繁加锁会影响吞吐。可考虑无锁环形缓冲区（需原子操作支持）。</li>
<li><strong>生命周期管理</strong>：确保所有进程退出后清理 MMF（Windows 下重启可自动回收）。</li>
<li><strong>异常安全</strong>：进程崩溃可能导致互斥体未释放，需加入超时或看门狗机制。</li>
<li><strong>内存对齐</strong>：确保读写偏移按平台要求对齐（x64 通常 8 字节对齐）。</li>
</ol>
<hr/>
<h2 data-id="heading-12">扩展方向</h2>
<ul>
<li>支持多生产者/多消费者（MPMC）。</li>
<li>引入事件通知（如 <code>EventWaitHandle</code>）避免轮询。</li>
<li>添加 CRC 校验或版本号防止数据错乱。</li>
<li>封装为 <code>IProducerConsumerCollection&lt;T&gt;</code> 以兼容 <code>BlockingCollection</code>。</li>
</ul>
<hr/>
<h2 data-id="heading-13">结语</h2>
<p>内存映射文件为 .NET 开发者提供了一条通往极致 IPC 性能的路径。虽然实现比管道或套接字复杂，但在高频交易、实时日志聚合、游戏服务器等场景中，其低延迟、高吞吐的优势无可替代。合理设计同步机制与内存布局，你就能构建出媲美 C++ 的高效跨进程通信系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[倾听数据的声音：给数据分析初学者的温馨建议]]></title>    <link>https://juejin.cn/post/7601077290681991220</link>    <guid>https://juejin.cn/post/7601077290681991220</guid>    <pubDate>2026-02-01T07:22:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601077290681991220" data-draft-id="7601175299011100687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="倾听数据的声音：给数据分析初学者的温馨建议"/> <meta itemprop="keywords" content="数据分析,程序员,数据挖掘"/> <meta itemprop="datePublished" content="2026-02-01T07:22:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            倾听数据的声音：给数据分析初学者的温馨建议
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:22:07.000Z" title="Sun Feb 01 2026 07:22:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>提到 <strong>“数据分析”</strong>，你的脑海里浮现的是什么？是密密麻麻的Excel表格，是复杂的Python代码，还是令人眼花缭乱的仪表盘？</p>
<p>很多想踏入这个行业的新人，往往一上来就陷入了工具的学习中。</p>
<p>但实际上，工具只是手段。在成为一名“数据工匠”之前，你首先需要成为一名“数据思考者”。</p>
<p>今天，我们抛开枯燥的定义，一起聊聊数据分析的本质究竟是什么，以及我们该如何从零开始，培养一种能够“透视”数据的思维方式。</p>
<h2 data-id="heading-0">一、 从“原材料”到“智慧”的炼金术</h2>
<p>首先，我们要打破一个误区：<strong>数据不等于智慧</strong>。</p>
<p>在这个时代，我们每天都在有意无意地创造数据。但原始的数据（Data）就像是一堆未经加工的原材料，比如一堆测量的数字、一串统计的清单。它们本身是冰冷的，没有任何意义。</p>
<p>数据分析师的工作，本质上是一场 <strong>“炼金术”</strong>：</p>
<ol>
<li><strong>数据 -&gt; 信息</strong>： 我们把原材料整理、格式化，让它变得可读，它就成了“信息”。</li>
<li><strong>信息 -&gt; 知识</strong>： 我们把信息融入到具体的背景、经验中去理解，它就变成了“知识”。</li>
<li><strong>知识 -&gt; 智慧</strong>： 当我们利用这些知识去选择正确的行动方案时，这就升华为了“智慧”。</li>
</ol>
<p>所以，不要为了分析而分析。我们最终的目标只有一个：<strong>运用智慧，做出正确的决策</strong>。</p>
<h2 data-id="heading-1">二、 别让直觉和数据打架</h2>
<p>作为初学者，你可能会纠结：做决定时，是该听经验直觉的，还是听数据的？</p>
<p>诺贝尔奖得主丹尼尔·卡尼曼提出过“两种思维系统”：</p>
<ul>
<li>系统1（直觉）： 快速、自动、反射性的。</li>
<li>系统2（分析）： 缓慢、费力、需要深思熟虑的。</li>
</ul>
<p>数据分析并不是要彻底否定你的直觉，把你变成一个冷血的计算机器。</p>
<p>恰恰相反，数据分析的目的是把直觉和分析结合起来。</p>
<p>直觉能让你对环境和关键问题保持敏锐，帮你快速筛选方向；而数据分析则是调用 <strong>“系统2”</strong>，在这个方向上进行深思熟虑的验证。</p>
<p>没有直觉，你可能会迷失在海量无关数据中；没有数据，你的直觉可能会把你带入偏见的深渊。</p>
<h2 data-id="heading-2">三、 像医生一样思考：五层分析法</h2>
<p>那么，拿到数据后具体该怎么做？我们可以借用一个非常生动的比喻：把自己想象成一名医生。</p>
<p>当病人（业务问题）来到你面前时，数据分析的过程就像是一次诊疗：</p>
<ol>
<li><strong>描述性分析</strong>（发生了什么？）：
就像医生首先要观察症状、测量体温。你需要从数据中找出时间、地点、人物和事件，还原事实的真相。</li>
<li><strong>推理性分析</strong>（其他情况如何？）：
医生会参考其他类似的病例。你也需要基于已有的数据，去推测那些未被记录的数据特征。</li>
<li><strong>诊断性分析</strong>（为什么发生？）：
这是最关键的一步。医生要寻找病因，你要透过表象，发现隐藏在数据之下的关联和因素。但要切记：相关性强不代表有因果关系，不要轻易下结论。</li>
<li><strong>预测性分析</strong>（接下来会怎样？）：
医生会根据病情发展预测后果。你要通过观察数据的趋势和模式，建立模型来预测未来。</li>
<li><strong>指导性分析</strong>（我们该做什么？）：
最后，医生要开药或手术。这也是数据分析的落脚点——你需要给出具体的行动方案，并预估这些方案会带来什么结果。</li>
</ol>
<p>从“看症状”到“开处方”，这才是完整的数据分析闭环。</p>
<h2 data-id="heading-3">四、 在动手之前，先学会提问</h2>
<p>很多新人拿到数据就急着画图、跑模型，结果往往是做了一堆漂亮的图表，却回答不了老板的一个简单问题。</p>
<p>在处理数据之前（这属于“消费数据”的阶段），请务必先停下来，带着批判性思维问自己八个问题。</p>
<p>我们可以用<code>6W2H</code>来概括：</p>
<ul>
<li><code>Why</code>（为什么）： 你找这些数据是为了做决策，还是仅仅为了给已经做出的决定找借口？</li>
<li><code>Where</code>（哪里）： 数据源头是哪？如果来源不明，千万别用它来做决策。</li>
<li><code>Who</code>（谁）： 谁在维护这些数据？他们想取悦谁？这决定了数据的立场。</li>
<li><code>When</code>（何时）： 上一次更新是什么时候？过时的数据比没有数据更可怕。</li>
<li><code>Which</code>（哪个）： 几百个变量里，哪几个才是最重要的？</li>
<li><code>What</code>（定义）： 重要变量的定义是什么？细节决定成败。</li>
<li><code>How</code>（如何）： 数据是如何被收集和测量的？测量方式的差异会导致巨大的现实偏差。</li>
<li><code>How much</code>（多少）： 你有多少时间来思考这些数据？</li>
</ul>
<p>这八个问题，是你的“避雷针”，能帮你过滤掉垃圾数据，直击核心。</p>
<h2 data-id="heading-4">五、 会分析，更要会讲故事</h2>
<p>最后，别忘了数据分析的“最后一公里”：呈现数据。</p>
<p>你的分析结果可能是一堆复杂的数字或逻辑，但你的观众（老板、客户、同事）可能并没有那么多时间去消化。</p>
<ul>
<li><strong>从数字到故事</strong>： 不要只扔给别人一张Excel表。你需要把一个个孤立的“发现”，串联成一个连贯的“数据故事”。</li>
<li><strong>看人下菜碟</strong>： 面对熟人和生人，面对需要行动的结果还是观念的转变，你的呈现方式（图表、仪表盘、PPT）都应该不同。</li>
</ul>
<p>好的数据分析师，不仅要有理性的头脑，还要有感性的叙述能力。</p>
<h2 data-id="heading-5">结语</h2>
<p>数据分析是一项技能，更是一种生活方式。</p>
<p>它不仅存在于专业的工作岗位上，也存在于公共领域（了解社会问题）和私人领域（量化自我成长）中。</p>
<p>从今天开始，试着不再把数据看作枯燥的数字，而是把它看作待挖掘的“原材料”。运用你的两种思维系统，像医生一样去诊断问题，像侦探一样去盘问来源，最后像讲故事的人一样去呈现结果。</p>
<p>当你能做到这些时，你就会发现：数据，真的会说话。</p>
<p>本文的核心内容来源于《会说话的数据》一书，希望能为你的数据分析之路点亮一盏灯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[7天用Go从零实现分布式缓存--Day4 一致性哈希]]></title>    <link>https://juejin.cn/post/7601101531921039406</link>    <guid>https://juejin.cn/post/7601101531921039406</guid>    <pubDate>2026-02-01T07:15:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601101531921039406" data-draft-id="7601101531921023022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="7天用Go从零实现分布式缓存--Day4 一致性哈希"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-02-01T07:15:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Way2top"/> <meta itemprop="url" content="https://juejin.cn/user/1458388314893300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            7天用Go从零实现分布式缓存--Day4 一致性哈希
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458388314893300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Way2top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:15:06.000Z" title="Sun Feb 01 2026 07:15:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本系列文章全部参考自极客兔兔的《7天用Go从零实现分布式缓存GeeCache》：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgeektutu.com%2Fpost%2Fgeecache.html" title="https://link.juejin.cn/?target=https%3A%2F%2Fgeektutu.com%2Fpost%2Fgeecache.html" target="_blank">geektutu.com/post/geecac…</a> 下面的内容均参考自该文章，同时结合了我自己学习过程中的思考，如果存在问题还请大家多多指教。</p>
<p>备注：Day4 的内容原文讲的也很通俗易懂，所以大部分都是原文内容搬过来的，加上了一点我的理解和解释在里面。</p>
<h2 data-id="heading-0">Day4 一致性哈希</h2>
<h3 data-id="heading-1">1 为什么要用一致性哈希</h3>
<p>今天我们要实现的是一致性哈希算法，一致性哈希算法是 GeeCache 从单节点走向分布式节点的一个重要的环节。那你可能要问了，一致性哈希算法是啥？为什么要使用一致性哈希算法？这和分布式有什么关系？</p>
<h4 data-id="heading-2">1.1 我该访问谁</h4>
<p>对于分布式缓存来说，当一个节点接收到请求，如果该节点并没有存储缓存值，那么它面临的难题是，从谁那获取数据？自己，还是节点1, 2, 3, 4… 。假设包括自己在内一共有 10 个节点，当一个节点接收到请求时，随机选择一个节点，由该节点从数据源获取数据。</p>
<p>假设第一次随机选取了节点 1 ，节点 1 从数据源获取到数据的同时缓存该数据；那第二次，只有 1/10 的可能性再次选择节点 1, 有 9/10 的概率选择了其他节点，如果选择了其他节点，就意味着需要再一次从数据源获取数据，一般来说，这个操作是很耗时的。这样做，一是缓存效率低，二是各个节点上存储着相同的数据，浪费了大量的存储空间。</p>
<p>那有什么办法，对于给定的 key，每一次都选择同一个节点呢？使用 hash 算法也能够做到这一点。那把 key 的每一个字符的 ASCII 码加起来，再除以 10 取余数可以吗？当然可以，这可以认为是自定义的 hash 算法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aee648254aaa4aca87faef760bcf8baa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2F5MnRvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770534906&amp;x-signature=tTuuY1Zo4%2FtuMFeneXyc5dy0o8g%3D" alt="" loading="lazy"/></p>
<p>从上面的图可以看到，任意一个节点任意时刻请求查找键 <code>Tom</code> 对应的值，都会分配给节点 2，有效地解决了上述的问题。</p>
<h4 data-id="heading-3">1.2 节点数量变化了怎么办</h4>
<p>简单求取 Hash 值解决了缓存性能的问题，但是没有考虑节点数量变化的场景。假设，移除了其中一台节点，只剩下 9 个，那么之前 <code>hash(key) % 10</code> 变成了 <code>hash(key) % 9</code>，也就意味着几乎缓存值对应的节点都发生了改变。即几乎所有的缓存值都失效了。节点在接收到对应的请求时，均需要重新去数据源获取数据，容易引起 <code>缓存雪崩</code>。</p>
<blockquote>
<p>缓存雪崩：缓存在同一时刻全部失效，造成瞬时DB请求量大、压力骤增，引起雪崩。常因为缓存服务器宕机，或缓存设置了相同的过期时间引起。</p>
</blockquote>
<p>那么如何解决这个问题呢？一致性哈希算法就可以解决这个问题。</p>
<h3 data-id="heading-4">2 算法原理</h3>
<h4 data-id="heading-5">2.1 算法步骤</h4>
<p>一致性哈希算法将 key 映射到 2^32 的空间中，将这个数字首尾相连，形成一个环。</p>
<ul>
<li>计算节点/机器(通常使用节点的名称、编号和 IP 地址)的哈希值，放置在环上。</li>
<li>计算 key 的哈希值，放置在环上，顺时针寻找到的第一个节点，就是应选取的节点/机器。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc560f44b97b416daa9746c023cab2c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2F5MnRvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770534906&amp;x-signature=DN%2BMT3BAXw2UdzUJZlXtjUePx%2Bs%3D" alt="" loading="lazy"/></p>
<p>环上有 peer2，peer4，peer6 三个节点，<code>key11</code>，<code>key2</code>，<code>key27</code> 均映射到 peer2，<code>key23</code> 映射到 peer4。此时，如果新增节点/机器 peer8，假设它新增位置如图所示，那么只有 <code>key27</code> 从 peer2 调整到 peer8，其余的映射均没有发生改变。</p>
<p>也就是说，一致性哈希算法，在新增/删除节点时，只需要重新定位该节点附近的一小部分数据，而不需要重新定位所有的节点，这就解决了上述的问题。</p>
<h4 data-id="heading-6">2.2 数据倾斜问题</h4>
<p>如果服务器的节点过少，容易引起 key 的倾斜。例如上面例子中的 peer2，peer4，peer6 分布在环的上半部分，下半部分是空的。那么映射到环下半部分的 key 都会被分配给 peer2，key 过度向 peer2 倾斜，缓存节点间负载不均。</p>
<p>为了解决这个问题，引入了虚拟节点的概念，一个真实节点对应多个虚拟节点。</p>
<p>假设 1 个真实节点对应 3 个虚拟节点，那么 peer1 对应的虚拟节点是 peer1-1、 peer1-2、 peer1-3（通常以添加编号的方式实现），其余节点也以相同的方式操作。</p>
<ul>
<li>第一步，计算虚拟节点的 Hash 值，放置在环上。</li>
<li>第二步，计算 key 的 Hash 值，在环上顺时针寻找到应选取的虚拟节点，例如是 peer2-1，那么就对应真实节点 peer2。</li>
</ul>
<p>虚拟节点扩充了节点的数量，解决了节点较少的情况下数据容易倾斜的问题。而且代价非常小，只需要增加一个字典(map)维护真实节点与虚拟节点的映射关系即可。</p>
<p>并且虚拟节点还有一个很好的优点，就是可以根据服务器性能的不同分配虚拟节点个数，性能好的就多分配几个，性能差一点的就少分配几个——这就是<strong>加权一致性哈希</strong>，很多分布式缓存和负载均衡都在用这招。</p>
<h3 data-id="heading-7">3 Go语言实现</h3>
<p>我们在 geecache 目录下新建 package <code>consistenthash</code>，用来实现一致性哈希算法。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> consistenthash

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"hash/crc32"</span>
        <span class="hljs-string">"sort"</span>
        <span class="hljs-string">"strconv"</span>
)

<span class="hljs-keyword">type</span> Hash <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(data []<span class="hljs-type">byte</span>)</span></span> <span class="hljs-type">uint32</span>

<span class="hljs-keyword">type</span> Map <span class="hljs-keyword">struct</span> {
        hash     Hash           <span class="hljs-comment">// Hash 函数</span>
        replicas <span class="hljs-type">int</span>            <span class="hljs-comment">// 每个真实节点要生成多少个虚拟节点</span>
        keys     []<span class="hljs-type">int</span>          <span class="hljs-comment">// 所有虚拟节点的哈希值，排好序后形成一个“环”</span>
        hashMap  <span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">string</span> <span class="hljs-comment">// 虚拟节点与真实节点的映射表（key为虚拟节点的hash值，value为真实节点的名称）</span>
}

<span class="hljs-comment">// New 用于创建 Map 实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(replicas <span class="hljs-type">int</span>, fn Hash)</span></span> *Map {
        m := &amp;Map{
                replicas: replicas,
                hash:     fn,
                hashMap:  <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">int</span>]<span class="hljs-type">string</span>),
        }
        <span class="hljs-comment">// 如果用户未指定 Hash 函数，默认使用 crc32.ChecksumIEEE</span>
        <span class="hljs-keyword">if</span> m.hash == <span class="hljs-literal">nil</span> {
                m.hash = crc32.ChecksumIEEE
        }
        <span class="hljs-keyword">return</span> m
}
</code></pre>
<ul>
<li>
<p>定义了函数类型 <code>Hash</code>，采取依赖注入的方式，允许用于替换成自定义的 Hash 函数，也方便测试时替换，默认为 <code>crc32.ChecksumIEEE</code> 算法。</p>
</li>
<li>
<p><code>Map</code> 是一致性哈希算法的主数据结构，包含 4 个成员变量：</p>
<ul>
<li>hash：Hash 函数</li>
<li>replicas：表示每个真实节点生成多少个虚拟节点</li>
<li>keys：所有虚拟节点的哈希值，是一个有序列表，用于模拟“环”</li>
<li>hashMap：虚拟节点与真实节点的映射表（key为虚拟节点的hash值，value为真实节点的名称）</li>
</ul>
</li>
<li>
<p>构造函数 <code>New()</code> 允许自定义虚拟节点个数和 Hash 函数</p>
</li>
</ul>
<p>接下来实现添加 真实节点/机器 的 <code>Add()</code> 方法。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Add 用于添加 真实节点/机器</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> Add(keys ...<span class="hljs-type">string</span>) {
        <span class="hljs-keyword">for</span> _, key := <span class="hljs-keyword">range</span> keys {
                <span class="hljs-comment">// 创建 replicas 个虚拟节点</span>
                <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; m.replicas; i++ {
                        hash := <span class="hljs-type">int</span>(m.hash([]<span class="hljs-type">byte</span>(strconv.Itoa(i) + key)))
                        m.keys = <span class="hljs-built_in">append</span>(m.keys, hash)
                        m.hashMap[hash] = key
                }
        }
        sort.Ints(m.keys)
}
</code></pre>
<ul>
<li>
<p><code>Add</code> 函数允许传入 0 或 多个真实节点的名称。</p>
</li>
<li>
<p>对每一个真实节点 <code>key</code>，对应创建 <code>m.replicas</code> 个虚拟节点，虚拟节点的名称是：<code>strconv.Itoa(i) + key</code>，即通过添加编号的方式区分不同虚拟节点。</p>
</li>
<li>
<p>使用 <code>m.hash()</code> 计算虚拟节点的哈希值，使用 <code>append(m.keys, hash)</code> 添加到环上。</p>
</li>
<li>
<p>在 <code>hashMap</code> 中增加虚拟节点和真实节点的映射关系。</p>
</li>
<li>
<p>最后一步，环上的哈希值排序。</p>
</li>
</ul>
<p>最后一步实现选择节点的 <code>Get()</code> 方法。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Get 用于选择节点</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *Map)</span></span> Get(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> {
        <span class="hljs-comment">// 如果环上没有节点可以用来存储缓存，直接返回</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(m.keys) == <span class="hljs-number">0</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>
        }
        hash := <span class="hljs-type">int</span>(m.hash([]<span class="hljs-type">byte</span>(key))) <span class="hljs-comment">// 计算 key 的 hash值</span>
        <span class="hljs-comment">// 二分查找，找到第一个 &gt;= hash 的虚拟节点位置，并把下标返回给 idx</span>
        idx := sort.Search(<span class="hljs-built_in">len</span>(m.keys), <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">bool</span> {
                <span class="hljs-keyword">return</span> m.keys[i] &gt;= hash
        })

        <span class="hljs-comment">// 返回匹配到的节点的真实名字</span>
        <span class="hljs-keyword">return</span> m.hashMap[m.keys[idx%<span class="hljs-built_in">len</span>(m.keys)]]
}
</code></pre>
<ul>
<li>选择节点就非常简单了，第一步，计算 key 的哈希值。</li>
<li>第二步，顺时针找到第一个匹配的虚拟节点的下标 <code>idx</code>，从 m.keys 中获取到对应的哈希值。如果 <code>idx == len(m.keys)</code>，说明应选择 <code>m.keys[0]</code>，因为 <code>m.keys</code> 是一个环状结构，所以用取余数的方式来处理这种情况。</li>
<li>第三步，通过 <code>hashMap</code> 映射得到真实的节点。</li>
</ul>
<p>至此，整个一致性哈希算法就实现完成了。</p>
<h3 data-id="heading-8">4 测试</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// geecacge/consistenthash/consistenthash_test.go</span>
<span class="hljs-keyword">package</span> consistenthash

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"strconv"</span>
        <span class="hljs-string">"testing"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestHashing</span><span class="hljs-params">(t *testing.T)</span></span> {
        <span class="hljs-comment">// 这里传入了一个“假hash”，方便测试</span>
        hash := New(<span class="hljs-number">3</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(key []<span class="hljs-type">byte</span>)</span></span> <span class="hljs-type">uint32</span> {
                i, _ := strconv.Atoi(<span class="hljs-type">string</span>(key))
                <span class="hljs-keyword">return</span> <span class="hljs-type">uint32</span>(i)
        })

        <span class="hljs-comment">// 加入3个真实节点</span>
        <span class="hljs-comment">// 生成虚拟节点后得到的哈希环：2, 4, 6, 12, 14, 16, 22, 24, 26</span>
        hash.Add(<span class="hljs-string">"6"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"2"</span>)

        testCases := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
                <span class="hljs-string">"2"</span>:  <span class="hljs-string">"2"</span>,
                <span class="hljs-string">"11"</span>: <span class="hljs-string">"2"</span>,
                <span class="hljs-string">"23"</span>: <span class="hljs-string">"4"</span>,
                <span class="hljs-string">"27"</span>: <span class="hljs-string">"2"</span>,
        }

        <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> testCases {
                <span class="hljs-keyword">if</span> hash.Get(k) != v {
                        t.Errorf(<span class="hljs-string">"Asking for %s, should have yielded %s"</span>, k, v)
                }
        }

        <span class="hljs-comment">// 在环上添加虚拟节点 8, 18, 28</span>
        hash.Add(<span class="hljs-string">"8"</span>)

        <span class="hljs-comment">// 27 应该映射到 8</span>
        testCases[<span class="hljs-string">"27"</span>] = <span class="hljs-string">"8"</span>

        <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> testCases {
                <span class="hljs-keyword">if</span> hash.Get(k) != v {
                        t.Errorf(<span class="hljs-string">"Asking for %s, should have yielded %s"</span>, k, v)
                }
        }

}
</code></pre>
<p>如果要进行测试，那么我们需要明确地知道每一个传入的 key 的哈希值，那使用默认的 <code>crc32.ChecksumIEEE</code> 算法显然达不到目的。所以在这里使用了自定义的 Hash 算法。自定义的 Hash 算法只处理数字，传入字符串表示的数字，返回对应的数字即可。</p>
<ul>
<li>一开始，有 2/4/6 三个真实节点，对应的虚拟节点的哈希值是 02/12/22、04/14/24、06/16/26。</li>
<li>那么用例 2/11/23/27 选择的虚拟节点分别是 02/12/24/02，也就是真实节点 2/2/4/2。</li>
<li>添加一个真实节点 8，对应虚拟节点的哈希值是 08/18/28，此时，用例 27 对应的虚拟节点从 <code>02</code> 变更为 <code>28</code>，即真实节点 8。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【前瞻篇】HTTP/3 与 WebTransport：Web 实时通讯的未来]]></title>    <link>https://juejin.cn/post/7601076976440459304</link>    <guid>https://juejin.cn/post/7601076976440459304</guid>    <pubDate>2026-02-01T03:25:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601076976440459304" data-draft-id="7600957412129406991" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【前瞻篇】HTTP/3 与 WebTransport：Web 实时通讯的未来"/> <meta itemprop="keywords" content="前端,网络协议"/> <meta itemprop="datePublished" content="2026-02-01T03:25:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【前瞻篇】HTTP/3 与 WebTransport：Web 实时通讯的未来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T03:25:03.000Z" title="Sun Feb 01 2026 03:25:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为《前端视角下的网络协议》系列的终章，我们将目光投向正在发生的<strong>第二次 Web 传输革命</strong>。</p>
<p>如果说 HTTP/2 是一次软件层面的修补，那么 <strong>HTTP/3</strong> 和 <strong>WebTransport</strong> 就是对互联网底层协议的一次“推倒重来”。它们彻底抛弃了已经服役 40 多年的 TCP 协议，转而拥抱基于 UDP 的新架构，旨在解决那些在现代移动互联和 AI 时代显得日益沉重的性能包袱。</p>
<hr/>
<h2 data-id="heading-0">一、 HTTP/3：拥抱 QUIC 的新航向</h2>
<p>正如我们在《连接篇》和《演进篇》中提到的，HTTP/3 的核心在于 <strong>QUIC (Quick UDP Internet Connections)</strong> 。</p>
<h3 data-id="heading-1">1. 为什么它是“降维打击”？</h3>
<ul>
<li><strong>0-RTT/1-RTT 极速连接</strong>：在 TCP+TLS 环境下，传输数据前需要 3 个 RTT；而在 HTTP/3 中，由于 QUIC 合并了握手与加密过程，第一次连接仅需 1 个 RTT，复用连接甚至能达到 <strong>0 个 RTT</strong>（即发包即带数据）。</li>
<li><strong>彻底消灭队头阻塞</strong>：在 TCP 中，一个包丢失，整条流卡死。在 QUIC 中，UDP 允许每个流独立传输，一个请求丢包，完全不影响其他并发请求。</li>
<li><strong>连接迁移 (Connection Migration)</strong> ：这是移动端最硬核的功能。你在切换 WiFi 和 4G/5G 时，IP 地址会变。TCP 必须重连，而 QUIC 使用 <strong>Connection ID</strong> 识别用户。即便网络切换，你的视频通话或直播依然丝滑，不会断连。</li>
</ul>
<hr/>
<h2 data-id="heading-2">二、 WebTransport：WebSocket 的终极接班人</h2>
<p>虽然 HTTP/3 很快，但在<strong>双向实时通讯</strong>领域，我们依然面临选型尴尬：WebSocket 不支持多路复用且存在 TCP 的固有缺陷。于是，<strong>WebTransport</strong> 应运而生。</p>
<h3 data-id="heading-3">1. 什么是 WebTransport？</h3>
<p>它是一个基于 HTTP/3（QUIC）的新一代浏览器 API，旨在提供<strong>低延迟、双向、多流</strong>的数据传输能力。</p>
<h3 data-id="heading-4">2. 与 WebSocket 的核心差异</h3>
<ul>
<li><strong>支持不可靠传输 (Datagrams)</strong> ：对于游戏状态同步、实时音视频这类“丢一个包也没关系，但延迟必须低”的场景，WebTransport 允许你像使用原生 UDP 一样发送数据，而 WebSocket 必须保证 100% 到达。</li>
<li><strong>多流并行</strong>：你可以在同一个 WebTransport 连接中开启多个单向或双向流。某个流卡住了，不会影响其他流的数据收发。</li>
<li><strong>原生集成安全</strong>：它天生强制要求 TLS 加密，且复用 HTTP/3 的端口，能更轻松地穿透防火墙。</li>
</ul>
<hr/>
<h2 data-id="heading-5">三、 全栈实战：未来已来</h2>
<p>作为一名 8 年全栈，你应该如何准备迎接这波浪潮？</p>
<ol>
<li>
<p><strong>基础设施升级</strong>：确保你的 CDN 服务商（如 Cloudflare, Akamai）已开启 HTTP/3 支持。如果自建 Nginx，需要安装 <code>nginx-quic</code> 模块并配置 <code>Alt-Svc</code> 响应头告知浏览器支持升级。</p>
</li>
<li>
<p><strong>代码层适配</strong>：</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// WebTransport 预览版 API 示例
const <span class="hljs-attr">transport</span> = new WebTransport(<span class="hljs-string">"https://your-api.com:443/webtransport"</span>)<span class="hljs-comment">;</span>
await transport.ready<span class="hljs-comment">;</span>

// 创建一个发送流
const <span class="hljs-attr">writable</span> = await transport.createUnidirectionalStream()<span class="hljs-comment">;</span>
const <span class="hljs-attr">writer</span> = writable.getWriter()<span class="hljs-comment">;</span>
await writer.write(new Uint8Array(<span class="hljs-section">[1, 2, 3]</span>))<span class="hljs-comment">;</span>
</code></pre>
</li>
<li>
<p><strong>场景切换</strong>：</p>
<ul>
<li><strong>直播/游戏</strong>：从 WebSocket/WebRTC 切换到 WebTransport 以获得更低的延迟。</li>
<li><strong>大文件分片上传</strong>：利用 QUIC 的多路复用并行上传，不再担心 TCP 阻塞。</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-6">四、 总结：网络协议的新纪元</h2>






























<table><thead><tr><th><strong>维度</strong></th><th><strong>HTTP/2 (旧时代顶点)</strong></th><th><strong>HTTP/3 + WebTransport (未来)</strong></th></tr></thead><tbody><tr><td><strong>底层基础</strong></td><td>TCP + TLS</td><td><strong>UDP + QUIC</strong></td></tr><tr><td><strong>首字节延迟 (TTFB)</strong></td><td>较高 (多次握手)</td><td><strong>极低 (0-RTT/1-RTT)</strong></td></tr><tr><td><strong>弱网表现</strong></td><td>容易发生队头阻塞，重连慢</td><td><strong>极强，支持连接迁移</strong></td></tr><tr><td><strong>实时通讯</strong></td><td>WebSocket (TCP)</td><td><strong>WebTransport (QUIC)</strong></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-7">💡 结语</h3>
<p>《前端视角下的网络协议》系列到此完结。我们从底层的 TCP 握手出发，穿越了 HTTP/2 的多路复用、HTTPS 的信任链、缓存的博弈、跨域的围墙，最终抵达了 HTTP/3 的未来。</p>
<p><strong>技术总是在演进，但底层的核心逻辑——即如何在不稳定的网络中提供稳定、快速、安全的体验——永远不变。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你的 sideEffects 真的配对了吗？—— 深度拆解构建工具的 Tree-shaking 潜规则]]></title>    <link>https://juejin.cn/post/7601144981170356274</link>    <guid>https://juejin.cn/post/7601144981170356274</guid>    <pubDate>2026-02-01T04:13:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601144981170356274" data-draft-id="7600955777316601894" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你的 sideEffects 真的配对了吗？—— 深度拆解构建工具的 Tree-shaking 潜规则"/> <meta itemprop="keywords" content="JavaScript,Node.js,代码规范"/> <meta itemprop="datePublished" content="2026-02-01T04:13:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你的 sideEffects 真的配对了吗？—— 深度拆解构建工具的 Tree-shaking 潜规则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T04:13:05.000Z" title="Sun Feb 01 2026 04:13:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>🚀 省流助手（速通结论）：</strong></p>
<ol>
<li><code>sideEffects</code> 是给<strong>宿主</strong>（用你包的项目）看的声明，不是给你自己构建减重用的。</li>
<li>只要包里包含 <strong>CSS/样式</strong>、<strong>全局监听</strong>（<code>process.on</code>）或<strong>修改全局变量</strong>，<strong>绝不能</strong>简单设为 <code>false</code>。</li>
<li><code>/* @__PURE__ */</code> 的意思是  <strong>“这行没用到请删掉”</strong> ，而不是 “不能删”。</li>
<li><strong>Bundle 并不安全</strong>：即便你打包成了单文件，一旦声明了 <code>false</code>，宿主打包工具依然能从内部“抠掉”你的副作用代码。</li>
</ol>
</blockquote>
<hr/>
<p>一、 线上“失踪”案：谁偷走了我的初始化逻辑？</p>
<p>很多开发者都遇到过这种诡异场景：本地开发时一切正常的全局监听（如 <code>process.on('exit')</code>）或样式文件，发布成 npm 包被别人使用后，在生产环境竟然“失效”了。</p>
<p>检查代码，逻辑都在；检查产物，文件也引了。最后发现，根源竟然是你在 <code>package.json</code> 中随手写下的那行：</p>
<p>json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
</code></pre>
<p>请谨慎使用此类代码。</p>
<p>你以为是在帮宿主做性能优化，实际上你是在给自己的代码下“逐客令”。</p>
<p>二、 生效时刻：它是谁的“紧箍咒”？</p>
<p><strong>误区：</strong>  认为在库里写了 <code>sideEffects: false</code>，自己执行 <code>vite build</code> 时包体积就会变小。</p>
<p><strong>真相：它的真正战场是「宿主编译时刻」。</strong></p>
<ol>
<li><strong>自身构建时</strong>：当你运行构建指令时，工具遵循作者意图。只要你在入口写了 <code>import './effect.ts'</code>，这段代码就会物理存在于你的 <code>dist</code> 产物中。</li>
<li><strong>宿主打包时</strong>：当其他项目安装了你的包，宿主工具（Vite/Webpack）会读取你的声明。如果你承诺了“无副作用”，一旦宿主没引用你该模块导出的变量，工具就会开启“外科手术”：<strong>即使你的单文件 Bundle 物理上包含了这段代码，工具也会在最终输出时将其精准剔除。</strong></li>
</ol>
<p>三、 穿透 Bundle 的“外科手术”</p>
<p>这是最隐蔽的陷阱。很多开发者认为：“我打包时已经把副作用合并进 <code>index.js</code> 了，宿主引用了 <code>index.js</code> 就安全了。”</p>
<p><strong>错了。</strong>  现代打包工具具备 <strong>Module Concatenation（模块提升）</strong>  能力。它们能“看穿” Bundle 内部的结构。只要你声明了 <code>false</code>，它们有能力从一个大的文件块中只“抠”出用到的函数，而把剩下的（包括那段 <code>import './effect.ts'</code> 产生的内容）当作垃圾直接丢弃。</p>
<p>四、 微观博弈：<code>/* @__PURE__ */</code> 到底在帮谁？</p>
<p>如果说 <code>sideEffects</code> 是文件级的“粗调”，那么 <code>/* @__PURE__ */</code> 就是语句级的“微操”。</p>
<p><strong>纠正一个常见误区：</strong>  它是标记“可以删”，而不是“不能删”。</p>
<p>假设你的工具库有一个文件导出了 100 个函数，宿主只用了其中 1 个。</p>
<ul>
<li><strong>如果没有标记</strong>：剩下的 99 个导出中，如果包含 <code>export const config = init()</code> 这种函数执行，打包工具会因为不敢确定 <code>init()</code> 是否修改了全局变量而<strong>保守地保留</strong>这一行。</li>
<li><strong>如果加上标记</strong>：你是在给工具发“免责声明”。工具看到 <code>/* @__PURE__ */</code>，发现没人用 <code>config</code>，就会放心地把这一行代码从产物中抹除。</li>
</ul>
<p>五、 避坑总结：白名单管理</p>
<p>为了不让代码被“误杀”，你不能在包含副作用的文件里写 <code>false</code>。最专业的做法是使用数组进行<strong>精准保护</strong>。</p>
<p><strong>哪些文件必须进 <code>sideEffects</code> 数组？</strong></p>
<ol>
<li><strong>样式文件</strong>：<code>*.css</code>, <code>*.scss</code>。</li>
<li><strong>环境初始化</strong>：修改 <code>global</code> 或 <code>window</code> 的脚本。</li>
<li><strong>进程监控</strong>：包含 <code>process.on</code> 或 <code>interval</code> 的逻辑。</li>
</ol>
<p><strong>推荐配置：</strong></p>
<p>json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"**/*.css"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"./dist/_init/*.mjs"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>请谨慎使用此类代码。</p>
<p>结语</p>
<p>Tree-shaking 是一场开发者与构建工具之间的博弈。工具的本质是“保守”的，而 <code>sideEffects: false</code> 是你交给工具的一把“激进”的剪刀。</p>
<p>在下一篇中，我们将深入探讨：<strong>如何通过工程架构设计，强制开发者在编写副作用代码时进行“决策”，从而构建一套永远不会被意外误删的“契约式”架构。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ReactNode 与 ReactElement：到底差在哪？]]></title>    <link>https://juejin.cn/post/7601101531920334894</link>    <guid>https://juejin.cn/post/7601101531920334894</guid>    <pubDate>2026-02-01T04:35:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601101531920334894" data-draft-id="7601069677567852590" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ReactNode 与 ReactElement：到底差在哪？"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-02-01T04:35:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="努力找实习的前端小白"/> <meta itemprop="url" content="https://juejin.cn/user/3994957074930676"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ReactNode 与 ReactElement：到底差在哪？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3994957074930676/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    努力找实习的前端小白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T04:35:09.000Z" title="Sun Feb 01 2026 04:35:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ReactNode 与 ReactElement：到底差在哪？</h2>
<p>写 React + TypeScript 的时候，最常见的两个类型就是 <code>ReactNode</code> 和 <code>ReactElement</code>。它们经常一起出现，比如：</p>
<ul>
<li><code>children: React.ReactNode</code></li>
<li><code>render(): React.ReactElement</code></li>
</ul>
<p>看起来都像“React 能渲染的东西”，但它们的语义完全不同。理解这俩的差别，会直接影响你写组件 Props、封装 render prop。</p>
<hr/>
<h3 data-id="heading-1">一句话结论</h3>
<ul>
<li><strong>ReactElement</strong>：一个“React 元素对象”，也就是 JSX 编译后的产物（结构化对象，带 <code>type/props/key/ref</code>）。</li>
<li><strong>ReactNode</strong>：一个“可渲染值”的大集合，包含 <code>ReactElement</code>，还包含字符串、数字、数组、Fragment、Portal，以及 <code>null/undefined/boolean</code> 这类“渲染为空”的值。</li>
</ul>
<p>换句话说：</p>
<blockquote>
<p><code>ReactElement</code> 是 <code>ReactNode</code> 的一个子集；<code>ReactNode</code> 才是 “children 能接受什么” 的真正答案。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">ReactElement：JSX 编译后的对象</h3>
<p>你写的 JSX：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> a = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"box"</span> /&gt;</span></span>;
<span class="hljs-keyword">const</span> b = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyComp</span> <span class="hljs-attr">foo</span>=<span class="hljs-string">{1}</span> /&gt;</span></span>;
</code></pre>
<p>最终都会变成“React 元素对象”。在类型层面，它通常对应：</p>
<ul>
<li><code>React.ReactElement</code>（更准确、更底层的类型）</li>
<li><code>JSX.Element</code>（更常见的 JSX 返回类型，通常等价于 <code>ReactElement&lt;any, any&gt;</code> 的别名/包装，取决于 TS/React 版本配置）</li>
</ul>
<p>一个直观的理解是：<code>ReactElement</code> 是“描述 UI 的结构化数据”，像这样：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReactElementLike</span> = {
  <span class="hljs-attr">type</span>: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Function</span>;
  <span class="hljs-attr">props</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt;;
  <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>;
};
</code></pre>
<p>它不是 DOM，也不是 HTML 字符串，而是 React 用来构建 Fiber/协调更新的输入数据。</p>
<h4 data-id="heading-3">什么时候用 ReactElement？</h4>
<p>当你希望调用方“必须传一个组件/标签”，而不是随便传文本、数字、数组时，用 <code>ReactElement</code> 更合适：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = {
  <span class="hljs-attr">icon</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactElement</span>;
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">{ icon }: Props</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"btn"</span>&gt;</span>{icon}Click<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}

<span class="hljs-comment">// ✅ 可以</span>
&lt;<span class="hljs-title class_">Button</span> icon={<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>🔥<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>} /&gt;

<span class="hljs-comment">// ❌ 不行（因为 string 不是 ReactElement）</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>"🔥"} /&gt;</span></span>
</code></pre>
<hr/>
<h3 data-id="heading-4">ReactNode：React 能“吃下去并渲染”的所有东西</h3>
<p><code>ReactNode</code> 是一个联合类型（大杂烩）。你可以把它理解成：只要 React 渲染器接受，它就算 <code>ReactNode</code>。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ReactNode</span> =
  | <span class="hljs-title class_">React</span>$Element&lt;<span class="hljs-built_in">any</span>&gt;
  | <span class="hljs-title class_">ReactPortal</span>
  | <span class="hljs-title class_">ReactText</span>
  | <span class="hljs-title class_">ReactFragment</span>
  | <span class="hljs-title class_">ReactProvider</span>&lt;<span class="hljs-built_in">any</span>&gt;
  | <span class="hljs-title class_">ReactConsumer</span>&lt;<span class="hljs-built_in">any</span>&gt;;
</code></pre>
<p>按照这份源码定义，<code>ReactNode</code> 由下面 6 类组成：</p>
<h4 data-id="heading-5">1）React$Element（也就是我们常说的 ReactElement）</h4>
<pre><code class="hljs language-tsx" lang="tsx">&lt;div /&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyComp</span> /&gt;</span></span>
</code></pre>
<h4 data-id="heading-6">2）ReactPortal（Portal）</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { createPortal } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>;

<span class="hljs-title function_">createPortal</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"modal"</span>&gt;</span>Hi<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>);
</code></pre>
<h4 data-id="heading-7">3）ReactText（文本）</h4>
<p><code>ReactText</code> 通常就是 <code>string | number</code>，也就是 React 允许你直接写在 JSX 里的文本节点：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;div&gt;<span class="hljs-title class_">Hello</span>&lt;/div&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{123}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<h4 data-id="heading-8">4）ReactFragment（Fragment）</h4>
<p>Fragment 的作用是把多个子节点组合在一起，但它本身不会渲染成额外的 DOM 节点：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildA</span> /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildB</span> /&gt;</span></span>
&lt;/&gt;
</code></pre>
<h4 data-id="heading-9">5）ReactProvider（Context Provider）</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">theme:</span> "<span class="hljs-attr">dark</span>" }}&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Child</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Provider</span>&gt;</span></span>;
</code></pre>
<h4 data-id="heading-10">6）ReactConsumer（Context Consumer）</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Consumer</span>&gt;</span>
  {(value) =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span>{JSON.stringify(value)}<span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span>}
<span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Consumer</span>&gt;</span></span>;
</code></pre>
<p>补充一点：你在 TypeScript 里常见到的 <code>React.ReactNode</code> 往往会比这份定义更宽（例如包含 <code>null/undefined/boolean</code>、可迭代结构等）。这类差异通常来自 React/TS 版本、类型定义文件的演进，以及某些类型在不同实现里被拆分或合并。</p>
<h4 data-id="heading-11">什么时候用 ReactNode？</h4>
<p>当你想表达“这里可以放任意可渲染内容”，尤其是 <code>children</code>、slot、render 出来的片段，用 <code>ReactNode</code> 最合适：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">CardProps</span> = {
  <span class="hljs-attr">title</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
  <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">{ title, children }: CardProps</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 这些都合法：</span>
&lt;<span class="hljs-title class_">Card</span> title=<span class="hljs-string">"标题"</span>&gt;正文&lt;/<span class="hljs-title class_">Card</span>&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">b</span>&gt;</span>加粗标题<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>}&gt;{123}<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{null}</span>&gt;</span>{[<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"1"</span>&gt;</span>a<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>, <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"2"</span>&gt;</span>b<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>]}<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
</code></pre>
<hr/>
<h3 data-id="heading-12">ReactNode vs ReactElement：从“约束力度”来理解</h3>
<p>你可以把它们理解为两种不同强度的约束：</p>
<ul>
<li><code>ReactElement</code>：强约束。你必须给我一个“元素对象”（JSX 产物）。</li>
<li><code>ReactNode</code>：弱约束。你给我任何 React 能渲染的值都行（包括元素、文本、Fragment、Portal、Provider/Consumer 等；不同类型定义的覆盖范围可能略有差异）。</li>
</ul>
<p>这直接决定了 API 设计体验：</p>
<h4 data-id="heading-13">场景 1：你只接受一个“组件块”</h4>
<p>比如 <code>icon</code>、<code>header</code> 必须是一个组件标签，否则 UI 结构不好控制：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = { <span class="hljs-attr">header</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactElement</span> };
</code></pre>
<h4 data-id="heading-14">场景 2：你接受“任意内容”</h4>
<p>比如 <code>children</code>、<code>title</code>、<code>footer</code> 可以是文本也可以是组件：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Props</span> = { <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span> };
</code></pre>
<hr/>
<h3 data-id="heading-15">常见误区：JSX.Element、ReactElement、ReactNode 到底怎么选？</h3>
<p>简单规则：</p>
<ul>
<li><strong>写 children / slot</strong>：优先 <code>React.ReactNode</code></li>
<li><strong>写必须是一个元素的 props（比如 icon）</strong>：用 <code>React.ReactElement</code></li>
<li><strong>组件返回值类型</strong>：通常不需要手写；如果一定要写，React 组件返回值更贴近 <code>React.ReactElement | null</code>（实际情况依赖你的组件是否可能返回 <code>null</code>）</li>
</ul>
<p>一个容易踩坑的点是：<strong>组件的返回值常被认为是 <code>ReactNode</code></strong>，但这会让约束过于宽松（比如你可能并不希望函数组件返回 <code>string</code>）。实践里更常见的是不写返回类型，让 TS 推导，或者写 <code>JSX.Element</code> / <code>ReactElement | null</code>。</p>
<hr/>
<h3 data-id="heading-16">为什么这俩的差别跟 SSR/SEO/Hydration 有关系？</h3>
<p>因为 Hydration 关注的是：<strong>服务端生成的 HTML 与客户端“用同样的数据渲染出来的 ReactElement 树”是否一致</strong>。在这个过程中：</p>
<ul>
<li><code>ReactElement</code> 是结构（树形 UI 描述）</li>
<li><code>ReactNode</code> 是你可能塞进树里的各种值（包括空值、条件渲染结果、数组等）</li>
</ul>
<p>当你在服务端和客户端因为环境差异（时间、随机数、浏览器 API）导致 <code>ReactNode</code> 的取值不同，就会出现 hydration mismatch（内容对不上），React 会警告并可能回退到重新渲染。</p>
<hr/>
<h3 data-id="heading-17">最后一句</h3>
<blockquote>
<p><strong>ReactElement 是 JSX 编译出来的“元素对象”；ReactNode 是 React 能渲染的“所有东西”。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[three.js | 初识3D世界]]></title>    <link>https://juejin.cn/post/7601175299010854927</link>    <guid>https://juejin.cn/post/7601175299010854927</guid>    <pubDate>2026-02-01T04:36:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601175299010854927" data-draft-id="7601077290681843764" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="three.js | 初识3D世界"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-01T04:36:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hello_Code"/> <meta itemprop="url" content="https://juejin.cn/user/3423198551742986"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            three.js | 初识3D世界
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3423198551742986/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hello_Code
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T04:36:55.000Z" title="Sun Feb 01 2026 04:36:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概念理解</h2>
<p>在3D世界，或者说三维世界，每个物体（three中对应的“名词”是Mesh）都有自己的形状（Geometry），以及材质（Material）。
偏一下题，我突然想到了这可以关联现实世界的摄影：</p>
<ol>
<li>同样都是“将物体/人展现出来”，所以需要有“物体Mesh”的概念（3D中只有“物体”，一切都是“物体”）、需要有“相机 Camera”的概念</li>
<li>物体/人的形状对你如何拍照、拍摄角度同样有不可忽视的影响，所以需要有“场景 Scene”的概念</li>
<li>物体的材质同样需要不同的“光”去定格，所以需要有“光”的概念</li>
</ol>
<p>是的，光！
如同现实世界有光和阴影，可以展示不同的明暗效果一样，three中也有一个“灯光Light”的概念。
综上所说，相机拍出来的景色是体现在“照片”上，那3D世界中，当然还应该有一个“渲染器 Renderer”的概念，负责把场景 Scene、相机 Camera、灯光 Light 这些
综合渲染到 canvas 画布上。这就是three的基本概念了。</p>
<h2 data-id="heading-1">第一次实践</h2>
<p>先来打印下three：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;three-1&lt;/title&gt;
    &lt;style&gt;
        body, html {
            margin: 0;
            padding: 0;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script type="module"&gt;
        import * as THREE from "https://unpkg.com/three@0.174.0/build/three.module.js";
        console.log(THREE)
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>如图代表引入成功：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32b5fb3e35344bcd9f7da3bcec6fbece~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbG9fQ29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770525482&amp;x-signature=V9adDAY4fS8vMHh07J7ytkj1Q58%3D" alt="在这里插入图片描述" loading="lazy"/>
下面我想在“画布”中放一个正方体！</p>
<blockquote>
<p>下面例子只是three其中一个小场景，需要查看其他api请浏览官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fthreejs.org%2Fmanual%2F%23zh%2Fprimitives" target="_blank" title="https://threejs.org/manual/#zh/primitives" ref="nofollow noopener noreferrer">three.js</a></p>
</blockquote>
<p>依旧拍照 —— 拍人不可能只拍人，需要在一个“场景”中拍：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
</code></pre>
<p>上面说了，和“形状”有关的名词（其实是three提供的方法）叫Geometry：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// BoxGeometry是Three提供的创建“长方体”的方法，接收参数分别代表长、宽、高</span>
<span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
</code></pre>
<blockquote>
<p>除了长方体，还有“圆柱体CylinderGeometry”、“球体SphereGeometry”、“圆锥ConeGeometry”、“矩形平面PlaneGeometry”、“圆平面CircleGeometry”方法</p>
</blockquote>
<p>别急，物体怎么能没有颜色呢？还记得“材质”Material吗，我们让这个物体支持“漫反射”并且颜色是“橘色”：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshLambertMaterial</span>(({
 <span class="hljs-attr">color</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-string">'orange'</span>)
}));
</code></pre>
<blockquote>
<p>除了漫反射，还有“无光影响MeshBasicMaterial”、“高光MeshPhongMaterial”，以及两个物理光“MeshStandardMaterial”和“MeshPhysicalMaterial”</p>
</blockquote>
<p>我们利用“形状”和“材质”一起创建出一个“物体”，并添加到“场景”中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
<span class="hljs-comment">// 就像人拍照时要站在哪里一样，“物体”怎么能没有位置呢？</span>
mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// x、y、z坐标</span>
scene.<span class="hljs-title function_">add</span>(mesh);
</code></pre>
<p>这样一个物体就创建出来了。
但是还不够。我们说了，“物体”要被看到，除了有这个物体，还需要“有光照射”、“有相机拍”、“有照片承载”：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-keyword">const</span> pointLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PointLight</span>(<span class="hljs-number">0x00FFFF</span>, <span class="hljs-number">10000</span>);
 pointLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">80</span>, <span class="hljs-number">80</span>, <span class="hljs-number">80</span>);
 scene.<span class="hljs-title function_">add</span>(pointLight);
</code></pre>
<p>光源有了，我们让一束“蓝色”的“点光源”从（80,80,80）的位置以强度10000照向物体（光源默认照向坐标0,0,0）。</p>
<blockquote>
<p>three模拟了几种光源效果，除了点光源，还有“环境光AmbientLight”、“聚光灯光源SpotLight”、“平行光DirectionalLight”</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript">
 <span class="hljs-keyword">const</span> width = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
 <span class="hljs-keyword">const</span> height = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
 <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">60</span>, width / height, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>);
 camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>);
 camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
 <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
 renderer.<span class="hljs-title function_">setSize</span>(width, height)
 renderer.<span class="hljs-title function_">render</span>(scene, camera);
 <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">append</span>(renderer.<span class="hljs-property">domElement</span>);

</code></pre>
<p>相机和照片也有了，我们的相机位于（200,200,200），看向（0,0,0）。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8f507345cd5460c975df996fecb6bbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbG9fQ29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770525482&amp;x-signature=BakjfdK4bSdYm7Xrwx0EtvuFiaY%3D" alt="在这里插入图片描述" loading="lazy"/>
注意！依旧拿“拍照”类比，3D世界一切基于“相机Camera”，比如上面这张图，因为相机在（200,200,200），所以主视角是三维坐标都是正数值的某个中心位置，所以图片中物体是“某个点朝向屏幕”！</p>
<p>拿人眼来说，我们看一个物体，其实是在看一个“视锥体”范围内的场景：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca51d3746f604408b9fa24790c1b116d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbG9fQ29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770525482&amp;x-signature=FAzUySzub9D1%2FP8ULuk8rWIBZQ8%3D" alt="在这里插入图片描述" loading="lazy"/>
相机拍物体也是一样。
所以Camera的第一个参数是fov，相机视锥体竖直方向视野角度，这里我们设置的是60。改成20试试看：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0dbd8cbbf0844c387e3e70d42ec54de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGVsbG9fQ29kZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770525482&amp;x-signature=DdeuvwITLY39vSO6WF%2Fyf%2Bv20Uo%3D" alt="在这里插入图片描述" loading="lazy"/>
“看”不完整了。</p>
<p>Camera的第二个参数是宽高比，也就是这个视椎体的宽和高的比例，一般设置为Canvas画布宽高比width / height。
第三个和第四个参数是展示视椎体的哪一部分，最近是哪（相机视锥体近裁截面相对相机距离），最远是哪（相机视锥体远裁截面相对相机距离）。</p>
<p>然后我们可以观察到很多3D的网站都支持通过鼠标拖动来 360 度观察。这个用 Three 提供的轨道控制器 OrbitControls 即可实现：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 引入</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'https://unpkg.com/three@0.174.0/examples/jsm/controls/OrbitControls.js'</span>;
</code></pre>
<p>然后在“渲染render”后添加代码：</p>
<pre><code class="hljs language-javascript" lang="javascript">
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">60</span>, width / height, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>);
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
    <span class="hljs-comment">//...</span>
    <span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(controls)

</code></pre>
<p>但是只有这样是不行的，renderer创建场景只被调用了一次，没法完成“拖动”。所谓拖动就是不断的把新场景渲染到画布中，所以我们要封装函数并不断调用：</p>
<pre><code class="hljs language-javascript" lang="javascript">- renderer.<span class="hljs-title function_">render</span>(scene, camera);

+ <span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
+     renderer.<span class="hljs-title function_">render</span>(scene, camera);
+     <span class="hljs-title function_">requestAnimationFrame</span>(render)
+ }
+ <span class="hljs-title function_">render</span>()
</code></pre>
<p>把 render 改成渲染循环，用 requestAnimationFrame 来一帧帧的循环渲染，使调用频率和显示器刷新率一致。</p>
<blockquote>
<p>笔者前段时间弄了一个微信公众号：前端Code新谈。里面暂时有webrtc、前端面试和用户体验系列文章，最近暂时搁置了webrtc，新开了一个系列“three.js”，欢迎关注！希望能够帮到大家，也希望能互相交流！一起学习共同进步</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS3动画使用教程]]></title>    <link>https://juejin.cn/post/7601075423003377700</link>    <guid>https://juejin.cn/post/7601075423003377700</guid>    <pubDate>2026-02-01T04:37:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601075423003377700" data-draft-id="7601159804490547219" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS3动画使用教程"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-02-01T04:37:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户22176592792"/> <meta itemprop="url" content="https://juejin.cn/user/4461135061323432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS3动画使用教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4461135061323432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户22176592792
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T04:37:57.000Z" title="Sun Feb 01 2026 04:37:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你想要一份更详细、更系统的CSS3动画（animation）使用教程，我会从基础概念到实战案例，一步步拆解CSS3动画的核心用法，让你能轻松上手并灵活运用。</p>
<h3 data-id="heading-0">CSS3 动画（animation）全教程</h3>
<p>CSS3动画是通过​<code>​@keyframes​</code>​定义关键帧，再通过​<code>​animation​</code>​属性将动画应用到元素上，能实现比​<code>​transition​</code>​更复杂、更灵活的动态效果，且无需JavaScript参与。</p>
<h4 data-id="heading-1">一、核心概念理解</h4>
<p>在开始写代码前，先理清两个核心部分：</p>
<ol>
<li><strong>@keyframes（关键帧）</strong> ：定义动画的"关键状态"，比如起始、中间、结束时元素的样式。</li>
<li><strong>animation 属性</strong>：将定义好的关键帧动画应用到元素上，并设置动画的时长、循环、速度等规则。</li>
</ol>
<h4 data-id="heading-2">二、基础语法与步骤</h4>
<h5 data-id="heading-3">步骤1：定义关键帧（@keyframes）</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 格式：@keyframes 动画名称 { 关键帧规则 } */</span>
<span class="hljs-keyword">@keyframes</span> 动画名称 {
  <span class="hljs-comment">/* 0% 表示动画开始（也可以用 from 替代） */</span>
  <span class="hljs-number">0%</span> {
    <span class="hljs-comment">/* 起始样式 */</span>
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">0</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
  <span class="hljs-comment">/* 50% 表示动画进行到一半 */</span>
  <span class="hljs-number">50%</span> {
    <span class="hljs-comment">/* 中间样式 */</span>
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">100px</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
  <span class="hljs-comment">/* 100% 表示动画结束（也可以用 to 替代） */</span>
  <span class="hljs-number">100%</span> {
    <span class="hljs-comment">/* 结束样式 */</span>
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">200px</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
}
</code></pre>
<h5 data-id="heading-4">步骤2：应用动画（animation 属性）</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 给元素添加动画 */</span>
<span class="hljs-selector-class">.animated-box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#007bff</span>;
  
  <span class="hljs-comment">/* 核心：animation 复合属性（推荐） */</span>
  <span class="hljs-comment">/* 格式：动画名称 时长 速度曲线 延迟 循环次数 方向 填充模式 播放状态 */</span>
  <span class="hljs-attribute">animation</span>: 动画名称 <span class="hljs-number">2s</span> ease <span class="hljs-number">0.5s</span> infinite alternate forwards running;
  
  <span class="hljs-comment">/* 也可以拆分为单个属性（便于理解和调试） */</span>
  <span class="hljs-comment">/* animation-name: 动画名称;          // 必选：指定关键帧名称 */</span>
  <span class="hljs-comment">/* animation-duration: 2s;            // 必选：动画时长（默认0，无效果） */</span>
  <span class="hljs-comment">/* animation-timing-function: ease;  // 可选：速度曲线（默认ease） */</span>
  <span class="hljs-comment">/* animation-delay: 0.5s;             // 可选：延迟播放（默认0） */</span>
  <span class="hljs-comment">/* animation-iteration-count: infinite; // 可选：循环次数（默认1，infinite无限） */</span>
  <span class="hljs-comment">/* animation-direction: alternate;    // 可选：播放方向（默认normal） */</span>
  <span class="hljs-comment">/* animation-fill-mode: forwards;     // 可选：动画结束后样式（默认none） */</span>
  <span class="hljs-comment">/* animation-play-state: running;     // 可选：播放状态（默认running，paused暂停） */</span>
}
</code></pre>
<h4 data-id="heading-5">三、关键属性详解（必掌握）</h4>
<h5 data-id="heading-6">1. 速度曲线（animation-timing-function）</h5>
<p>控制动画的播放速度，常用值：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 常用值示例 */</span>
<span class="hljs-selector-class">.animated-box</span> {
  <span class="hljs-comment">/* linear：匀速（最常用） */</span>
  <span class="hljs-attribute">animation-timing-function</span>: linear;
  <span class="hljs-comment">/* ease：慢→快→慢（默认） */</span>
  <span class="hljs-comment">/* ease-in：慢→快 */</span>
  <span class="hljs-comment">/* ease-out：快→慢 */</span>
  <span class="hljs-comment">/* ease-in-out：慢→快→慢（比ease更平缓） */</span>
  <span class="hljs-comment">/* 自定义贝塞尔曲线（精准控制） */</span>
  <span class="hljs-comment">/* animation-timing-function: cubic-bezier(0.1, 0.7, 1.0, 0.1); */</span>
}
</code></pre>
<h5 data-id="heading-7">2. 播放方向（animation-direction）</h5>
<p>控制动画是否反向播放：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.animated-box</span> {
  <span class="hljs-comment">/* normal：正常播放（默认），从0%→100% */</span>
  <span class="hljs-comment">/* alternate：交替播放，奇数次正向（0%→100%），偶数次反向（100%→0%） */</span>
  <span class="hljs-comment">/* reverse：反向播放（100%→0%） */</span>
  <span class="hljs-comment">/* alternate-reverse：反向交替播放 */</span>
  <span class="hljs-attribute">animation-direction</span>: alternate;
}
</code></pre>
<h5 data-id="heading-8">3. 填充模式（animation-fill-mode）</h5>
<p>控制动画开始前/结束后的元素样式：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.animated-box</span> {
  <span class="hljs-comment">/* none：默认，动画结束后回到初始样式 */</span>
  <span class="hljs-comment">/* forwards：动画结束后，保持最后一帧样式 */</span>
  <span class="hljs-comment">/* backwards：动画延迟期间，保持第一帧样式 */</span>
  <span class="hljs-comment">/* both：同时应用forwards和backwards */</span>
  <span class="hljs-attribute">animation-fill-mode</span>: forwards;
}
</code></pre>
<h5 data-id="heading-9">4. 播放状态（animation-play-state）</h5>
<p>常用于通过:hover、JS控制动画暂停/播放：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.animated-box</span> {
  <span class="hljs-attribute">animation</span>: move <span class="hljs-number">2s</span> infinite;
}
<span class="hljs-comment">/* 鼠标悬停时暂停动画 */</span>
<span class="hljs-selector-class">.animated-box</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">animation-play-state</span>: paused;
}
</code></pre>
<h4 data-id="heading-10">四、实战案例（直接复用）</h4>
<h5 data-id="heading-11">案例1：呼吸灯效果（透明度变化）</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 定义关键帧 */</span>
<span class="hljs-keyword">@keyframes</span> breathe {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>);
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-comment">/* 应用动画 */</span>
<span class="hljs-selector-class">.breathe-box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff6700</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-comment">/* 匀速、无限循环 */</span>
  <span class="hljs-attribute">animation</span>: breathe <span class="hljs-number">2s</span> linear infinite;
}
</code></pre>
<h5 data-id="heading-12">案例2：加载动画（旋转+多元素）</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- HTML结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loader"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loader-item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loader-item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loader-item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 定义旋转关键帧 */</span>
<span class="hljs-keyword">@keyframes</span> load {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>;
  }
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">20px</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.2</span>;
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>;
  }
}

<span class="hljs-selector-class">.loader</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.loader-item</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#007bff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">animation</span>: load <span class="hljs-number">1.2s</span> ease infinite;
}
<span class="hljs-comment">/* 给每个小球设置不同延迟，实现错落效果 */</span>
<span class="hljs-selector-class">.loader-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>) {
  <span class="hljs-attribute">animation-delay</span>: <span class="hljs-number">0.2s</span>;
}
<span class="hljs-selector-class">.loader-item</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) {
  <span class="hljs-attribute">animation-delay</span>: <span class="hljs-number">0.4s</span>;
}
</code></pre>
<h5 data-id="heading-13">案例3：文字渐入动画</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@keyframes</span> text-fade {
  <span class="hljs-number">0%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">20px</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
}

<span class="hljs-selector-class">.fade-text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">animation</span>: text-fade <span class="hljs-number">0.8s</span> ease forwards;
  <span class="hljs-comment">/* 初始状态隐藏 */</span>
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-14">五、使用注意事项</h4>
<ol>
<li><strong>性能优化</strong>：优先使用​<code>​transform​</code>​和​<code>​opacity​</code>​属性做动画（浏览器硬件加速，无重绘），避免用​<code>​width​</code>​、​<code>​height​</code>​、​<code>​top​</code>​、​<code>​left​</code>​（会触发频繁重排，卡顿）。</li>
<li><strong>兼容性</strong>：现代浏览器（Chrome/Firefox/Safari/Edge）均支持CSS3动画，无需加前缀；如需兼容老旧浏览器（如IE10-），可加前缀​<code>​-webkit-​</code>​（如​<code>​@-webkit-keyframes​</code>​、​<code>​-webkit-animation​</code>​）。</li>
<li><strong>动画暂停</strong>：通过​<code>​animation-play-state: paused​</code>​暂停动画，比重新设置时长为0更优雅。</li>
</ol>
<hr/>
<h4 data-id="heading-15">总结</h4>
<ol>
<li><strong>核心结构</strong>：CSS3动画由​<code>​@keyframes​</code>​（定义关键帧）和​<code>​animation​</code>​（应用动画）两部分组成，​<code>​animation-duration​</code>​是必选属性（否则无动画效果）。</li>
<li><strong>常用属性</strong>：​<code>​animation-iteration-count: infinite​</code>​（无限循环）、​<code>​animation-direction: alternate​</code>​（交替播放）、​<code>​animation-fill-mode: forwards​</code>​（保持结束样式）是高频组合。</li>
<li><strong>性能原则</strong>：动画优先操作​<code>​transform​</code>​和​<code>​opacity​</code>​，避免触发页面重排，保证动画流畅。</li>
</ol>
<p>你可以把这些案例代码复制到HTML文件中运行，修改关键帧的样式、动画时长、速度曲线等参数，直观感受不同设置的效果，很快就能熟练掌握。如果想实现某个特定的动画效果（比如弹跳、滑动、闪烁），可以告诉我，我会针对性给出代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入拆解SpringMvc父子容器构建全流程]]></title>    <link>https://juejin.cn/post/7601144981171241010</link>    <guid>https://juejin.cn/post/7601144981171241010</guid>    <pubDate>2026-02-01T07:33:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601144981171241010" data-draft-id="7520820286565826569" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入拆解SpringMvc父子容器构建全流程"/> <meta itemprop="keywords" content="后端,Spring Boot"/> <meta itemprop="datePublished" content="2026-02-01T07:33:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="毅航"/> <meta itemprop="url" content="https://juejin.cn/user/615331640389037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入拆解SpringMvc父子容器构建全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615331640389037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    毅航
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T07:33:38.000Z" title="Sun Feb 01 2026 07:33:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="atelier-heath-light">.hljs-comment,.hljs-quote{color:#776977}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ca402b}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#a65926}.hljs-bullet,.hljs-string,.hljs-symbol{color:#918b3b}.hljs-section,.hljs-title{color:#516aec}.hljs-keyword,.hljs-selector-tag{color:#7b59c0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f7f3f7;color:#695d69}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<blockquote>
<p>思考，输出，沉淀。用通俗的语言陈述技术，让自己和他人都有所收获。<br/>
作者：毅航😜</p>
</blockquote>
<hr/>
<blockquote>
<p>     在使用<code>SpringMvc</code>中，我们不可避免的总是会涉及到父子容器的相关概念，而一概念其实并非<code>Spring</code>所独创。这其实是<strong>软件架构中层级化资源管理的通用设计思想</strong>，<code>Spring</code>框架只是将这一思想落地到 <code>IOC</code>容器体系中并形成了标准化实现。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在学习了解<code>SpringMVC</code>的过程中，框架内容部通常会构建两个<code>Bean</code>容器，两个容器相互绑定，从而形成<strong>父子容器</strong>的概念。容器间借助单向可见的层级关系实现 <code>Bean</code> 职责的隔离与有序管理。</p>
<p>其中，父容器作为全局根容器，负责管理 <code>Service、Repository</code>、数据源等非 <code>Web</code> 层核心 <code>Bean</code>；而子容器则归属于 <code>Spring MVC</code> 核心组件 <code>DispatcherServlet</code>，专门管理 <code>Controller</code>、视图解析器等<code>Web</code> 层相关的<code>Bean</code>信息。</p>
<p>接下来，我们便从 <code>SpringMVC</code>源码的角度来深入剖析<code>SpringMVC</code>内部双容器的构建全流程。</p>
<h2 data-id="heading-1"><code>SpringMVC</code>容器构建流程</h2>
<h3 data-id="heading-2">父容器构建</h3>
<p>在使用<code>SpringMVC</code>时，通常我们会在<code>web.xml</code>文件中配置一个叫做<code>ContextLoaderListener</code>的监听器，具体配置如下。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.
            context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span>

</code></pre>
<p>而<code>ContextLoaderListener</code>默认会实现<code>ServletContextListener</code>接口。而当<code> Tomcat</code>启动并完成<code>ServletContext</code>上下文的创建后，会自动触发<code>ServletContextEvent</code>事件。</p>
<p>此时<code>ContextLoaderListener</code>作为监听器，会接收到相关事件并执行<code>contextInitialized()</code>回调方法；进而调用内部<code>initWebApplicationContext()</code>方法，从而完成启动并初始化<code>Spring IoC</code>。</p>
<p>(PS：有关<code>ContextLoaderListener</code>的介绍可参考：<a href="https://juejin.cn/post/7256759718811648058" target="_blank" title="https://juejin.cn/post/7256759718811648058">SpringMVC流程分析(一)：从一行配置入手，搞懂web环境下Ioc容器的构建</a>)</p>
<h3 data-id="heading-3">子容器构建</h3>
<p>在梳理完 <code>SpringMVC</code> 父容器的构建脉络后，我们继续深入子容器的实现流程，延续前文的分析思路，我们还是从配置文件这一基础环节切入。在最开始接触<code>SpringMVC</code>时，对于<code>DispatcherServlet</code>的加载，我们通常通过在<code>web.xml</code>中配置如下内容：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span> 
  <span class="hljs-comment">&lt;!-- Servlet 名称，自定义（需与下方 servlet-mapping 对应） --&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
       <span class="hljs-comment">&lt;!-- DispatcherServlet 全类名（必选） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet
    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>
</code></pre>
<p>上述配置信息的解析借助<code>Tomcat</code>来完成。具体来看，当<code>Tomcat</code>启动并初始化<code> Web</code> 应用时，会优先扫描解析应用的部署描述文件 <code>web.xml</code>，从中识别 <code>&lt;servlet&gt;</code> 标签定义，提取出<code>Servlet</code>的名称、全类名及初始化参数等核心配置信息。随后 <code>Tomcat</code> 内置的 <code>ServletContainer</code> 会根据解析到的类名，通过类加载器加载 <code>DispatcherServlet</code> 并完成实例化。</p>
<p>当相关<code>Servlet</code>完成加载后，<code>Tomcat</code> 会在启动阶段立即调用其 <code>init()</code> 方法完成初始化，<code>init()</code> 方法完成相关<code>Servlet</code>的初始化操作。具体到<code>DispatcherServlet</code>中来看，其容器初始化链路整体如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad4ae6fc49964426a33c72b15109a615~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q-F6Iiq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770536017&amp;x-signature=tVOZdxhwccbHZblMB2nau2eyud4%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p><code>FrameworkServlet # initWebApplicationContext()</code></p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
* 初始化Web应用程序上下文
* 
* <span class="hljs-doctag">@return</span> 初始化后的Web应用程序上下文
*/</span>
<span class="hljs-keyword">protected</span> WebApplicationContext <span class="hljs-title function_">initWebApplicationContext</span><span class="hljs-params">()</span> {
  <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">rootContext</span> <span class="hljs-operator">=</span>
  		WebApplicationContextUtils.getWebApplicationContext(getServletContext());
  <span class="hljs-type">WebApplicationContext</span> <span class="hljs-variable">wac</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

<span class="hljs-comment">//初始时，属性webApplicationContext为空，不会执行此处父子容器设定逻辑</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.webApplicationContext != <span class="hljs-literal">null</span>) {
  	<span class="hljs-comment">// ...省略其他无关代码</span>
  		
  	}
  }
  
  <span class="hljs-comment">// 检查是否已通过构造函数注入了上下文实例</span>
  <span class="hljs-keyword">if</span> (wac == <span class="hljs-literal">null</span>) {
  	wac = findWebApplicationContext();
  }
  
  <span class="hljs-comment">// 如果仍未找到上下文实例，则创建一个新的本地上下文</span>
  <span class="hljs-keyword">if</span> (wac == <span class="hljs-literal">null</span>) {
     wac = createWebApplicationContext(rootContext);
  }

       <span class="hljs-comment">// ...省略其他无关代码</span>

  <span class="hljs-keyword">return</span> wac;
}
</code></pre>
<p>其中之所以会执行<code>FrameworkServlet</code>的<code>initServletBean</code>方法。这正是由于我们在<code>web.xml</code> 里面配置了<code>DispatcherServlet</code>缘故。</p>
<p>当加载<code>DispatcherServlet</code>时，会去调用<code>DispatcherServlet</code>的<code>init</code>方法，由于<code>DispatcherServlet</code>与<code>FrameworkServlet</code>的继承关系，上述<code>Servlet</code>初始化的调用逻辑，最终会执行到<code>FrameworkServlet</code>内部<code>initWebApplicationContext</code>方法，这就是<code>SpringMVC</code>内部子容器的一个启动执行顺序。</p>
<p>但这里有一个很容易被忽视的点，很多人总是认为<code>SpringMVC</code>内部父子容器的设定在<code>this.webApplicationContext != null</code>这处分支逻辑中执行，但其实并不然。</p>
<p><strong>造成这一错误认知的核心在于对于搞混了<code>Spring</code>中<code>Bean</code>信息的管理</strong>。很多人在翻阅<code>SpringMVC</code>源码时，看到<code>FrameworkServlet</code>会实现<code>ApplicationContextAware</code>接口，所以总会想当然的将认为当<code>FrameworkServlet</code>子类在初始化时，会默认将容器中的<code>容器</code>赋值到<code>webApplicationContext</code>。</p>
<p>回到我们开始有关<code>DispatcherServlet</code>的配置信息，你会发现，有关<code>DispatcherServlet </code>的注入其实我们并没有借助<code>Spring</code>容器，而是借助<code>Tomcat</code>对于<code>Servlet</code>的解析来完成。</p>
<p><strong>换言之，我们通过<code>web.xml</code>中配置的方式 ，让<code>Tomcat</code>识别到了<code>DispatcherServlet</code>信息，从而令其摆脱了<code>Spring</code>的管理。这也就使得其生命周期不被<code>Spring</code>所管理，进而相关<code>Spring</code>中的<code>ApplicationContextAware</code>埋点操作也就不会执行。</strong></p>
<p>因此，在<code>SpringMVC</code>内部，相关父子容器的绑定其实是在<code>wac == null</code>这一分支条件中执行，即借助<code>createWebApplicationContext</code>完成相关<code>SpringMVC</code>子容器的构建。</p>
<blockquote>
<p><code>FrameworkServlet # createWebApplicationContext()</code></p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> WebApplicationContext <span class="hljs-title function_">createWebApplicationContext</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ApplicationContext parent)</span> {
   Class&lt;?&gt; contextClass = getContextClass();
   <span class="hljs-keyword">if</span> (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplicationContextException</span>(
            <span class="hljs-string">"Fatal initialization error in servlet with name '"</span> + getServletName() +
            <span class="hljs-string">"': custom WebApplicationContext class ["</span> + contextClass.getName() +
            <span class="hljs-string">"] is not of type ConfigurableWebApplicationContext"</span>);
   }
   <span class="hljs-type">ConfigurableWebApplicationContext</span> <span class="hljs-variable">wac</span> <span class="hljs-operator">=</span>
         (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);

   wac.setEnvironment(getEnvironment());
   wac.setParent(parent);
   <span class="hljs-type">String</span> <span class="hljs-variable">configLocation</span> <span class="hljs-operator">=</span> getContextConfigLocation();
   <span class="hljs-keyword">if</span> (configLocation != <span class="hljs-literal">null</span>) {
      wac.setConfigLocation(configLocation);
   }
   configureAndRefreshWebApplicationContext(wac);

   <span class="hljs-keyword">return</span> wac;
}
</code></pre>
<p>总结来看，在<code>SpringMVC</code>内部，整个父子容器构建逻辑如下图所示。首先，<code>ContextLoaderListner</code>监听到<code>Tomcat</code>容器启动事件后，完成父容器的构建；待进行到相关<code>Servlet</code>初始化阶段后，<code>DispatcherServlet</code>完成相关子容器构建，并实现父子容器的相互绑定。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9befe4fe8f041c895dc0f2256fc8007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q-F6Iiq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770536017&amp;x-signature=djUqmFkjjHO5H6OywOXh8FzegAs%3D" alt="image.png" loading="lazy"/></p>
<p>最终，当<code>SpringMVC</code>中完成父子容器构建后，两者容器间的关系如下所示。其中，父容器作为全局根容器，负责管理<code> Service、Repository</code>、数据源等非<code>Web</code> 层核心 <code>Bean</code>；子容器则归属于<code>Spring MVC</code> ,并专门管理 <code>Controller</code>、视图解析器等 <code>Web</code> 层 <code>Bean</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87fc18ecd7e04229a2b09b10fc4f3a9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q-F6Iiq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770536017&amp;x-signature=hiPjAuS56SD4E7Mg9X41lLOq1y8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">深究父子容器机制</h2>
<p>至此，我们便讲清楚了<code>SpringMVC</code>中父子容器的构建全过程，但你可能会疑惑，为什么<code>Spring</code>在构建时，会通过双容器的机制来完成容器加载呢？</p>
<p>其实，之所以的采用父子容器的实现的本质，无非就是进行分层。从而解决单一容器管理所有 <code>Bean</code> 时易出现的职责混编、加载冲突、功能失效等问题。</p>
<ul>
<li>
<p><strong>避免功能失效</strong>。 若不拆分父子容器，<code>DispatcherServlet</code> 初始化时会与 <code>ContextLoaderListener</code> 重复扫描并创建 <code>Service</code>等业务层 <code>Bean</code>。子容器重复创建的 <code>Bean</code> 则无法关联到事务管理器，直接导致 <code>@Transactional</code> 注解完全失效，业务层事务控制形同虚设。</p>
</li>
<li>
<p><strong>降低加载冲突</strong>。在单一容器中若出现同名 <code>Bean</code>（如容器中如果出现同名<code>Bean</code>会直接致使项目无法正常加载。而父子容器的 “单向可见性”（子容器可访问父容器 <code>Bean</code>，父容器无法感知子容器 <code>Bean</code>）避免了子容器 <code>Bean </code>污染父容器，进而且明确的职责拆分让<code>Bean</code> 管理的边界清晰可追溯。同时更能有效<strong>解决多 <code>DispatcherServlet</code> 实例的配置冲突问题</strong>。多模块项目中若配置多个 <code>DispatcherServlet</code>，单一容器会导致不同 <code>DispatcherServlet</code> 的配置互相干扰。父子容器架构下，每个 <code>DispatcherServlet</code> 拥有独立的子容器，可配置专属的<code>Bean</code>信息，同时共享父容器的核心业务层 <code>Bean</code>，既保证了多 <code>Servlet </code>实例的隔离性，又实现了核心资源的复用。</p>
</li>
</ul>
<p>进一步来看，<code>SpringMVC</code>内部父子容器思想的本质便是<strong>软件架构中 “层级化资源管理” 的通用设计思想</strong>，而<code>Spring</code> 只是将这一思想落地到<code> IoC</code> 容器体系中并形成了标准化实现。从技术本质来看，只要涉及 “分层隔离、单向依赖、资源复用” 的场景，都会衍生出类似父子容器的设计。例如，操作系统中父子进程的资源隔离，以及 前端<code>Vue</code>框架中父子组件的关系，其本质都是该思想的拓展。</p>
<h2 data-id="heading-5">总结</h2>
<p>好的设计往往具备共通的核心逻辑，回到如今的<code>大模型</code>开发场景，资源隔离是其面临的典型难题。具体来看，大模型的交互过程中，不同用户、不同任务的上下文必须严格区分。</p>
<p>例如<code>用户 A</code>的对话历史、会话配置（如温度参数、角色设定）与<code>用户 B</code>的相关内容需完全隔离，不能出现混淆。若未做好隔离设计，不仅可能导致<code>用户 A</code>的对话内容被<code>用户 B</code>意外获取，还会造成前序任务的上下文污染后续任务的推理结果，严重影响使用安全性与推理准确性。</p>
<p>针对这一痛点，我们可借鉴 <code>Spring MVC</code> 父子容器的分层设计思路来优化。具体而言，可构建 “父 - 子” 两级上下文容器，实现资源隔离与高效复用：</p>
<ul>
<li><strong>父上下文（全局容器）</strong> ：存储所有会话共享的通用资源，包括模型基础参数、全局通用知识库、统一权限规则等，一次初始化后供所有会话调用；</li>
<li><strong>子上下文（会话容器）</strong> ：仅存储单一会话的临时状态，比如用户专属对话历史、个性化 <code>Prompt</code> 模板、会话级配置等，仅作用于当前会话，且可单向访问父上下文的通用资源，父上下文无需感知子容器存在。</li>
</ul>
<p>通过这种 <strong>“全局复用 + 会话隔离”</strong> 的架构设计，既能从根源避免不同会话的临时状态互相干扰，杜绝上下文串流与数据泄露风险，又能减少通用资源的重复加载，显著降低系统资源占用，提升大模型服务的稳定性与运行效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue<前端页面版本检测>]]></title>    <link>https://juejin.cn/post/7601175299010953231</link>    <guid>https://juejin.cn/post/7601175299010953231</guid>    <pubDate>2026-02-01T06:13:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7601175299010953231" data-draft-id="7601077290681876532" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue&lt;前端页面版本检测&gt;"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-02-01T06:13:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="誰在花里胡哨"/> <meta itemprop="url" content="https://juejin.cn/user/1011206430666551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue&lt;前端页面版本检测&gt;
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1011206430666551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    誰在花里胡哨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-01T06:13:19.000Z" title="Sun Feb 01 2026 06:13:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为什么需要版本检测</h2>
<h3 data-id="heading-1">1. 解决浏览器缓存问题</h3>
<ul>
<li><strong>静态资源缓存</strong>：浏览器会缓存 JS、CSS 等静态资源，用户可能继续使用旧版本</li>
<li><strong>用户体验影响</strong>：用户无法及时获取新功能，导致功能缺失或操作异常</li>
</ul>
<h3 data-id="heading-2">2. 保障功能一致性</h3>
<ul>
<li><strong>功能同步</strong>：确保所有用户都能使用最新的功能和修复</li>
<li><strong>数据一致性</strong>：避免因版本差异导致的数据不一致问题</li>
</ul>
<h3 data-id="heading-3">3. 提升用户体验</h3>
<ul>
<li><strong>主动提醒</strong>：在新版本发布后主动通知用户更新</li>
<li><strong>无缝升级</strong>：减少用户手动刷新页面的需求</li>
</ul>
<h2 data-id="heading-4">版本检测核心思路</h2>
<p align="center"><img width="400px" src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/201719ca776e476ca30793edf20ed3d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Kqw5Zyo6Iqx6YeM6IOh5ZOo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770531199&amp;x-signature=dnxrNVrGXVVZKOtMJagIipMtS8Y%3D" alt="version1.gif" loading="lazy"/></p>
<h3 data-id="heading-5">整体架构</h3>
<blockquote>
<p>构建阶段 → 版本文件生成 → 运行时检测 → 版本对比 → 用户提醒</p>
</blockquote>
<h3 data-id="heading-6">技术实现要点</h3>
<h4 data-id="heading-7">1. 版本标识生成</h4>
<ul>
<li><strong>构建时生成</strong>：每次打包时生成唯一的版本标识</li>
<li><strong>时间戳方案</strong>：使用时间戳确保每次构建版本号唯一</li>
</ul>
<h4 data-id="heading-8">2. 版本文件部署</h4>
<ul>
<li><strong>JSON 格式</strong>：将版本信息保存为 <code>version.json</code> 文件</li>
<li><strong>静态访问</strong>：通过 HTTP 请求可直接访问版本文件</li>
</ul>
<h4 data-id="heading-9">3. 客户端检测机制</h4>
<ul>
<li><strong>定时轮询</strong>：定期检查服务器版本文件</li>
<li><strong>版本对比</strong>：比较本地缓存版本与服务器版本</li>
<li><strong>智能提醒</strong>：仅在版本不一致时提醒用户</li>
</ul>
<h2 data-id="heading-10">版本检测实现步骤</h2>
<h3 data-id="heading-11">步骤一：构建版本文件生成脚本</h3>
<p>创建 <code>build-version.js</code> 文件：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// build-version.js （自动生成版本文件脚本）</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-comment">// 方案A：使用时间戳作为版本标识（最简单，确保每次打包唯一）</span>
<span class="hljs-keyword">const</span> version = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>().<span class="hljs-title function_">toString</span>()

<span class="hljs-comment">// 版本文件内容</span>
<span class="hljs-keyword">const</span> versionJson = {
  <span class="hljs-attr">version</span>: version,
  <span class="hljs-attr">updateTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleString</span>() <span class="hljs-comment">// 可选：添加更新时间，便于排查</span>
}

<span class="hljs-comment">// 写入version.json文件（项目根目录）</span>
<span class="hljs-keyword">const</span> versionPath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'public'</span>, <span class="hljs-string">'version.json'</span>)
fs.<span class="hljs-title function_">writeFileSync</span>(versionPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(versionJson, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), <span class="hljs-string">'utf-8'</span>)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 自动生成版本文件成功，版本号：<span class="hljs-subst">${version}</span>`</span>)

</code></pre>
<h3 data-id="heading-12">步骤二：修改构建命令</h3>
<p>在 <code>package.json</code> 中修改构建命令：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build:prod"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node build-version.js &amp;&amp; vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-13">步骤三：配置 Vue 构建过程</h3>
<p>在 <code>vue.config.js</code> 中添加版本文件复制配置：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">chainWebpack</span>(<span class="hljs-params">config</span>) {
  <span class="hljs-comment">// ... 其他配置</span>
  
  <span class="hljs-comment">// 复制 version.json 到 dist 目录</span>
  config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'copy'</span>)
    .<span class="hljs-title function_">tap</span>(<span class="hljs-function"><span class="hljs-params">args</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> hasVersionJson = args[<span class="hljs-number">0</span>].<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">from</span> === <span class="hljs-string">'version.json'</span>)
      <span class="hljs-keyword">if</span> (!hasVersionJson) {
        args[<span class="hljs-number">0</span>].<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">from</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'public/version.json'</span>),
          <span class="hljs-attr">to</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist/version.json'</span>)
        })
      }
      <span class="hljs-keyword">return</span> args
    })
}
</code></pre>
<h3 data-id="heading-14">步骤四：实现版本检测工具类</h3>
<p>创建 <code>src/utils/versionUpdate.js</code>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/utils/versionUpdate.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Notification</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-ui'</span>
<span class="hljs-comment">/**
 * 版本更新检测工具类（仅生产环境启用轮询，内置环境判断）
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">VersionUpdate</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
      <span class="hljs-attr">versionFileUrl</span>: <span class="hljs-string">'/version.json'</span>, <span class="hljs-comment">// 版本文件地址</span>
      <span class="hljs-attr">localVersionKey</span>: <span class="hljs-string">'cmpVersion'</span>, <span class="hljs-comment">// 本地存储的版本号key</span>
      <span class="hljs-attr">disableFetchCache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 禁用Fetch缓存</span>
      <span class="hljs-attr">pollInterval</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 5分钟轮询一次</span>
      <span class="hljs-attr">hasNotified</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 是否已提醒过用户有新版本</span>
    }
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>, options)
    <span class="hljs-comment">// 定时轮询定时器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollTimer</span> = <span class="hljs-literal">null</span>
    <span class="hljs-comment">// 识别当前环境（Vue CLI 4 自动注入的环境变量）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProduction</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>
  }

  <span class="hljs-comment">/**
   * 核心方法：执行版本检测
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkVersion</span>(<span class="hljs-params">isInit = <span class="hljs-literal">false</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">hasNotified</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

      <span class="hljs-keyword">const</span> localVersion = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">localVersionKey</span>) || <span class="hljs-string">''</span>
      <span class="hljs-keyword">const</span> fetchOptions = {}
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">disableFetchCache</span>) {
        fetchOptions.<span class="hljs-property">cache</span> = <span class="hljs-string">'no-cache'</span>
      }

      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">versionFileUrl</span>, fetchOptions)
      <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`版本文件请求失败，状态码：<span class="hljs-subst">${response.status}</span>`</span>)
      }
      <span class="hljs-keyword">const</span> latestVersionInfo = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
      <span class="hljs-keyword">const</span> serverVersion = latestVersionInfo.<span class="hljs-property">version</span>

      <span class="hljs-keyword">if</span> (isInit) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">cacheLatestVersion</span>(serverVersion)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      }

      <span class="hljs-keyword">if</span> (serverVersion &amp;&amp; serverVersion !== localVersion) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">hasNotified</span> = <span class="hljs-literal">true</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'有新版本可用'</span>, latestVersionInfo)
        <span class="hljs-title class_">Notification</span>({
          <span class="hljs-attr">title</span>: <span class="hljs-string">'🎉 有新版本可用'</span>,
          <span class="hljs-attr">dangerouslyUseHTMLString</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">`&lt;p style="font-size:12px;"&gt;建议点击刷新页面，以获取最新功能和修复&lt;/p&gt; &lt;p style="color:#cccccc;font-size:12px;"&gt;更新时间：<span class="hljs-subst">${latestVersionInfo.updateTime}</span>&lt;/p&gt;`</span>,
          <span class="hljs-attr">duration</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">customClass</span>: <span class="hljs-string">'check-version-notify'</span>,
          <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forceRefreshPage</span>()
          },
          <span class="hljs-attr">onClose</span>: <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resetNotifyFlag</span>()
          }
        })
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 版本一致时，重置提醒标记，便于后续轮询检测新版本</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">hasNotified</span> = <span class="hljs-literal">false</span>
        <span class="hljs-comment">// console.log('当前已是最新版本，已缓存最新版本号')</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'版本检测异常，不影响应用运行：'</span>, error.<span class="hljs-property">message</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }
  }
  <span class="hljs-comment">/**
   * 启动定时轮询检测（内置环境判断：仅生产环境生效）
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">startPolling</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 核心：非生产环境，直接返回，不启动轮询</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isProduction</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前为非生产环境，不启动版本检测轮询'</span>)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 生产环境：正常启动轮询</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">stopPolling</span>() <span class="hljs-comment">// 先停止已有轮询，避免重复启动</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkVersion</span>(<span class="hljs-literal">true</span>) <span class="hljs-comment">// 立即执行一次检测</span>

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollTimer</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkVersion</span>()
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">pollInterval</span>)

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`生产环境版本轮询检测已启动，每隔<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.config.pollInterval / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>}</span>分钟检测一次`</span>)
  }

  <span class="hljs-comment">/**
   * 停止定时轮询检测
   */</span>
  <span class="hljs-title function_">stopPolling</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollTimer</span>) {
      <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pollTimer</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pollTimer</span> = <span class="hljs-literal">null</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'版本轮询检测已停止'</span>)
    }
  }

  <span class="hljs-comment">/**
   * 重置提醒标记
   */</span>
  <span class="hljs-title function_">resetNotifyFlag</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">hasNotified</span> = <span class="hljs-literal">false</span>
  }

  <span class="hljs-comment">// 缓存最新版本号</span>
  <span class="hljs-title function_">cacheLatestVersion</span>(<span class="hljs-params">version</span>) {
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">localVersionKey</span>, version)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resetNotifyFlag</span>()
  }

  <span class="hljs-comment">// 强制刷新页面</span>
  <span class="hljs-title function_">forceRefreshPage</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>(<span class="hljs-literal">true</span>)
  }
}

<span class="hljs-keyword">const</span> versionUpdateInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VersionUpdate</span>()
<span class="hljs-keyword">export</span> { <span class="hljs-title class_">VersionUpdate</span>, versionUpdateInstance }
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> versionUpdateInstance

</code></pre>
<p>创建自定义<code>.check-version-notify</code>的版本检测全局样式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8070ccb4ebe4a028f3aabab68afeafd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Kqw5Zyo6Iqx6YeM6IOh5ZOo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770531199&amp;x-signature=J1pi0sKApxNPUvXlsJ5PxfqK%2FH0%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 版本检测通知样式</span>
<span class="hljs-selector-class">.check-version-notify</span>{
  <span class="hljs-attribute">border</span>: <span class="hljs-number">3px</span> solid transparent <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.6</span>) <span class="hljs-meta">!important</span>;
  backdrop-<span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">5px</span>);
  &amp;<span class="hljs-selector-pseudo">:hover</span>{
    <span class="hljs-attribute">border</span>: <span class="hljs-number">3px</span> solid <span class="hljs-variable">$--color-primary</span> <span class="hljs-meta">!important</span>;
  }
  <span class="hljs-selector-class">.el-notification__icon</span>{
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">18px</span>;
  }
  <span class="hljs-selector-class">.el-notification__title</span>{
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">18px</span>;
  }
  <span class="hljs-selector-class">.el-notification__group</span>{
    <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;
  }
}
</code></pre>
<h3 data-id="heading-15">步骤五：在应用入口启动版本检测</h3>
<p>在 <code>App.vue</code> 或合适的入口文件中启动版本检测：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> versionUpdate <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/versionUpdate'</span>
...
<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  versionUpdate.<span class="hljs-title function_">startPolling</span>()
},
<span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
  versionUpdate.<span class="hljs-title function_">stopPolling</span>()
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>