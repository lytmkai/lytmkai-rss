<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[AI终于学会「读懂人心」，带飞DeepSeek R1，OpenAI o3等模型]]></title>    <link>https://juejin.cn/post/7574619023805136934</link>    <guid>https://juejin.cn/post/7574619023805136934</guid>    <pubDate>2025-11-20T09:40:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023805136934" data-draft-id="7574615024293314586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI终于学会「读懂人心」，带飞DeepSeek R1，OpenAI o3等模型"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-20T09:40:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI终于学会「读懂人心」，带飞DeepSeek R1，OpenAI o3等模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:40:13.000Z" title="Thu Nov 20 2025 09:40:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“What is meant often goes far beyond what is said, and that is what makes conversation possible.” ——H. P. Grice </p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3694a5f2b0654668b389d5dbac827037~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=mjxOUn8DX51%2FXlycuPdH7Sx7les%3D" alt="图片" loading="lazy"/></p>
<p>引言：从「语义理解」到「心智共情」的跨越</p>
<p>在人类日常交流中，话语的含义往往超越字面本身。举个例子，当有人说出 “这里好冷啊” 的时候，真正的用意可能远不止是在描述温度 —— 这句话可能是一种委婉的请求（希望对方关窗），也可能是在表达不适、寻求关心。再比如，当人类说出 “我最近总是失眠” 时，背后的潜台词可能是工作压力、情感困扰，或是生理疾病 —— 人类社交之所以能领会言外之意，是通过碎片信息，比如社交语境、先验常识和预设反馈推测他人未明说的意图、情绪和信念等心理状态，一种被称为心智理论（Theory of Mind, ToM）的能力，也是社交智能的核心。发展心理学研究表明，儿童大约在 4 岁左右就开始具备这种对他人心态的推理能力。这种 “读心术” 式的社交智力让人类对语言的理解超越字面，做到 “听言外之意，观其心中之思”。</p>
<p>让机器拥有类似的人类社交智力一直是人工智能领域的一项巨大挑战。尽管大型语言模型（LLM）在语义理解和问答对话上表现出色，它们在面对人类交流中的模糊性和间接暗示时却常常表现不佳，因此在真实社交场景中的表现常被诟病为机械式回应。人们很快发现：单纯的语言流畅 ≠ 理解 “人情世故”。一些尝试为模型注入社交行为的工作，比如预先设定角色档案，或通过偏好数据微调模型等，往往只是让模型在表层对齐（如遵循对话格式或避免禁忌语），并未真正赋予模型类人般分层次的心理推理能力。简而言之，传统方法大多把社交推理当成一次生成问题，而不是像人类那样经历解读 - 反思 - 适应的多阶段过程。如何使 AI 具备这种人类式的多层社交推理能力，成为通往更高层次人工智能的一道关键门槛。</p>
<p>为应对这一挑战，威斯康星大学麦迪逊分校联合清华大学 NeurIPS 2025 Spotlight 的最新研究《MetaMind: Modeling Human Social Thoughts with Metacognitive Multi-Agent Systems》，首次将发展心理学中的元认知（Metacognition）理论融入 LLM 架构，通过仿生人类假设生成 - 反思修正 - 行为验证的认知闭环，在 8 项标准化心智理论测试中使 LLM 达到人类平均水平。该成果不仅刷新多项基准记录，显著提升模型对隐含意图、情绪和社会规范的把握能力，更揭示了构建社交智能 AI 的系统性方法论，让 AI “读懂人心”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01fcd2210a2b460ba74dd15df2640fe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=uI4NU%2F0HjQtOhNiJwZFeIc2gJAE%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>论文链接：<a href="https://link.juejin.cn?target=http%3A%2F%2Farxiv.org%2Fabs%2F2505.18943" target="_blank" title="http://arxiv.org/abs/2505.18943" ref="nofollow noopener noreferrer">arxiv.org/abs/2505.18…</a></p>
</li>
<li>
<p>Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FXMZhangAI%2FMetaMind" target="_blank" title="https://github.com/XMZhangAI/MetaMind" ref="nofollow noopener noreferrer">github.com/XMZhangAI/M…</a></p>
</li>
<li>
<p>Hugging Face：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fpapers%2F2505.18943" target="_blank" title="https://huggingface.co/papers/2505.18943" ref="nofollow noopener noreferrer">huggingface.co/papers/2505…</a></p>
</li>
</ul>
<p>MetaMind 框架：三阶段的元认知多智能体</p>
<p>MetaMind 试图让 LLM 通过多智能体协作来模拟人类的社交推理过程，这一框架受启发于心理学中的元认知理论。美国心理学家 Flavell 于 1979 年提出元认知（Metacognition）概念，指出人类在认知活动中会进行自我监控和调节：我们会对自己的想法进行反思，根据社会规则修正理解，并在复杂情景中调整行为。MetaMind 正是借鉴来这种 “思考之上的思考” 理念，将社交理解拆解为逐层深入的三个阶段，每个阶段由一个专门的智能体（Agent）负责处理不同层面的推理任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c036ea03bc444d64a9efc1fe73e21e7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=7Gqj2vxY054DO2tO1O3Yg7yH1Z4%3D" alt="图片" loading="lazy"/></p>
<p>阶段 1：理论心智智能体（ToM Agent）负责生成心理状态假设。在这一初始阶段，ToM 智能体会尝试推测用户话语背后 “未尽之意”，生成多个关于用户潜在心理状态的假设。这些假设涵盖了用户可能的信念、愿望、意图、情绪等不同类型。举个例子，当用户说 “最近工作把我累坏了”，ToM 代理不会直接生成劝你注意休息的统一答复，而是先推测用户真正的心理状态：可能是假设用户感到 “倦怠和沮丧”，或是假设用户在寻求同情和理解。通过生成一系列多样的假设，模型在回答前就对用户的潜在诉求有了更全面的考虑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889cad5707c84cf6b3c6664c77bebbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=nwsWyBXvz3uajkK8oBAwMm5sO4A%3D" alt="图片" loading="lazy"/></p>
<p>阶段 2：道德约束智能体（Moral Agent）负责应用社交规范约束，对上一阶段产生的心理假设进行审视和过滤。该智能体扮演 “社交常识与规范审查员” 的角色：它会考虑当前场景下的文化背景、伦理准则以及情境适当性，对不合理或不恰当的假设进行修正或摒弃。正如人类会用社会经验来调整自己对他人话语的解读一样，该代理确保模型的推理符合社会常情。例如，如果 ToM 阶段假设出 “浪漫意图”，但对话发生在工作场合，那么领域代理会根据职业场合的规范将此解读调整为普通的 “同事间欣赏”，避免产生越界的理解。通过引入社会约束，模型能够抑制不合时宜的推测，使推理结果在情境中更加合理、负责任。</p>
<p>值得注意的是，该阶段通过平衡目标假设在上下文中的概率与假设的意外性，保证最优假设的语境合理性与场景专有的信息增益。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/541b56ccd9de43d5902096ef5c88bfeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=L9izy%2BVUYIrjw%2BWLnObG8C7z1HQ%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7792a8078f1443ef988c25e84bd87d47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=pQxStYH3MdU%2BxZCpqLqEUOnNqns%3D" alt="图片" loading="lazy"/></p>
<p>阶段 3：响应验证智能体（Response Agent）负责生成并验证最终回答。经过前两阶段，模型已经 “想明白” 了用户可能的潜在诉求，也过滤出了最合适的假设。最后一步，响应智能体要做的就是据此生成实际的回答，并在生成过程中进行自我验证。该智能体以前两阶段提出的最佳假设为条件，加上用户的社交记忆作为额外输入，一方面确保回答内容切题且语气贴合用户当下的情绪，另一方面在回答完成后对其进行质量评估：生成回答后会反思其是否与推断的用户意图以及自我的社交状态相一致、在情感和语境上是否合适，如有偏差还能触发认知循环，通过在社交记忆中注入经验反馈以改进答案。通过 “生成 + 校验” 的闭环，模型的最终输出在语义准确性之外，更具共情力和社交认知。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f3780384924b0c854df1cd29ba1b35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=IFgqTXT1K%2FtSUNrBAMHrnJTWLU4%3D" alt="图片" loading="lazy"/></p>
<p>上述三步循环让 MetaMind 在理解和回应用户时，能够像人类一样经过假设、反思和调整的过程，而非一上来就给出武断答复。这种多智能体协作的分层推理设计，使模型初步具备了人类式的社交认知能力。值得一提的是，MetaMind 的智能体之间并非各自孤立地工作，而是通过共享记忆和信息形成一个有机整体。例如，第一阶段生成假设时会参考社交记忆的用户偏好，第三阶段生成回答时又会用到经过领域智能体修正的假设等 —— 整个流程构建出一种 “元认知循环”，不断自我反馈改进，正如人类在社交互动中大脑所做的那样。</p>
<p>动态社交记忆：长期、可进化的用户画像</p>
<p>在 MetaMind 框架中，有一个贯穿始终的关键机制叫作社交记忆（Social Memory）。它就像 AI 的大脑中一个不断更新的笔记本，用来记录用户在交互过程中的重要信息。具体来说，社交记忆会存储用户长期的偏好、人格特征以及突出的情绪模式，并在对话推进时动态更新。每当模型需要推理用户的意图或决定如何回应时，这个记忆库都可以被检索，提供额外的背景参考。例如，在连续多轮交互中，用户曾表现出害羞内向的性格或偏好委婉隐喻的交流方式，MetaMind 可以将这些历史信息纳入考虑，从而对用户有更一致且连贯的把握。</p>
<p>社交记忆的作用在 MetaMind 架构中贯穿始终：第一阶段 ToM 智能体在生成心理假设时，会交叉引用社交记忆，以确保推测符合用户一贯的行为模式。基于假设类型，当假设被判定为新的用户偏好时，将注入社交记忆作为常识性用户建模；第三阶段响应智能体在生成回答时，则会调取社交记忆来调整回复的情感基调，使语气和内容与用户以往的情绪状态相协调。当该轮验证失败，社交记忆将通过风险反馈再次优化 —— 基于这种方式，MetaMind 实现了长期用户建模和情感一致性两大提升：一方面，模型能够持续累积用户信息，形成更全面的用户画像；另一方面，在长对话或多轮交互中，模型的回应风格情绪不会前后矛盾，而是与用户先前情绪脉络相呼应。这有效避免了传统 LLM 常见的 “失忆” 和情感不连贯问题。</p>
<p>更进一步，社交记忆还赋予了模型一定程度的个性化适应能力。如果说传统模型面对每个新对话都是 “从零开始” 的话，那么具备社交记忆的 MetaMind 则能 “记住你是谁”。例如，在教育场景中，一个教学 AI 助手如果有社交记忆，就可以记住学生以往知识的掌握曲线和情绪反应，从而调整教学策略，拿捏反馈的语气力度。这种个性化的长程适应对于人机交互体验至关重要，也是迈向更具情感智能的 AI 的一大步。简而言之，社交记忆具有如下特性：</p>
<ul>
<li>
<p>动态结构化存储：记录用户长期信念、情绪模式与社交偏好。</p>
</li>
<li>
<p>三步演化：① 场景初始化 M₀ —— 基于场景 / 角色 / 文化背景预设；② 基于 ToM 假设更新 Mₜ → Mₜ₊₁ —— 写入持久化心智片段；③ 失败反馈修正 —— 若响应被判低效或违背规范，记忆自我矫正。</p>
</li>
<li>
<p>用户建模：为多轮对话带来 “熟人感”，同时为 Response Agent 提供情感与语调的连续性约束。</p>
</li>
</ul>
<p>从 Folk Psychology 到元认知理论</p>
<p>MetaMind 的设计深深植根于认知心理学理论，与人类社交认知的原理高度对齐。首先，它借鉴了发展心理学中的 “朴素心理学（Folk Psychology）” 概念。朴素心理学指的是人们在日常生活中自发形成的一套关于他人行为背后心理状态的推理方法 —— 简单说就是我们直觉地去理解他人的想法和动机，这正是心智理论 ToM 能力的基础。</p>
<p>MetaMind 的第一阶段 ToM 代理所做的事情，本质上就是在模仿人类的朴素心理学过程：面对一段话，列举出可能的隐含心态（信念、情绪等），就如同我们在脑海中猜测对方 “是不是在暗示 XX” 那样。这种设计让 AI 对语言的理解不再停留于字面，而是尝试触及背后的心理语境。</p>
<p>其次，MetaMind 引入的元认知多阶段循环理念，直接受益于 Flavell 的元认知理论。元认知强调，人会对自己的认知活动进行计划、监控和评估，从而实现自我调节。对应到 MetaMind 框架，三个智能体的协作过程正体现了类似的自我调节机制：ToM 代理完成计划和假设（对应计划阶段），领域代理对假设进行审核和调整（对应监控反思阶段），响应代理则对最终输出进行评估验证（对应评估阶段）。可以说，MetaMind 在 LLM 架构中显式地融合了人类元认知的原则。这种分工协作的系统，比起简单靠提示词让单个模型 “一步到位” 地给出答案，更加接近人类解决复杂社交任务时的思维方式。</p>
<p>相比之下，目前常用的 LLM 对齐手段就显得过于扁平了。例如，链式 Prompt 虽然在一定程度上分步引导模型思考，但缺乏根据上下文动态调整的机制；预设人设的对话让模型假装扮演某角色，但难以捕捉真实对话中动态变化的社交意图；RLHF 通过大规模人工反馈微调模型，提升了礼貌和安全性，却很难针对千变万化的社交场景做到举一反三，而且收集广覆盖的训练数据本身就非常困难。这些方法本质上都还是让模型学会一种 “静态” 的或 “表层” 的对齐策略，缺乏对人类社交认知过程更深层的模拟。MetaMind 的出现，正是对这种现状的反思和突破：它不再将社会交互视作一个静态的问题，而是让 AI 通过元认知的多阶段推理，在内部重现人类的社交思维链条。正因如此，MetaMind 在各类复杂社交场景中表现出更强的上下文适应性和行为合理性。</p>
<p>性能表现：多基准上的 SOTA 与人类水平逼近</p>
<p>MetaMind 框架在一系列严格的基准测试中取得了卓越的成绩，展示出其赋予 LLM 社会推理能力的有效性。作者在论文中选取了三个具有挑战性的测试：一个是专门评估社交推理能力的 ToMBench，涵盖了多种 ToM 推理任务；第二是一系列社交认知任务（如社交常识问答 SocialIQA 等），考察模型对社交情景的理解；第三是社会模拟任务集 STSS 及 SOTOPIA，让模型在交互式情景中执行行为决策。综合这几方面，可以较全面地测量模型的社交智能水平。</p>
<p>实验结果显示，MetaMind 让各种底层 LLM 在这些基准上均实现了大幅度的性能提升。例如，在 ToMBench 上，MetaMind 框架将 GPT-4 的平均心理推理准确率从约 74.8% 提高到了 81.0%，超过了以往所有针对 ToM 能力的提升方法。值得注意的是，无论是小模型（7-13 亿参数量级）、大模型（GPT-3.5/4 等）还是最先进的推理模型（DeepSeek r1，OpenAI o3 等），几乎清一色地被 MetaMind “带飞”：这说明 MetaMind 提供的多阶段推理机制对各类模型通用有效，并非只对个别模型奏效。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78b99c2ed9754e578a61501957a6d3dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=EAPwh45oTg9RD0FV1xhIIV1CB4s%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1466139f9a0a41bc92e15fafa49a93bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=EeBwZ43kKwj9LcRoA%2BQLhbMAG%2FY%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ec453ece2ea41f88acf1af387e929e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=cCtxSm5vQjLPYUqAH9X3oeMpr0w%3D" alt="图片" loading="lazy"/></p>
<p>不仅在选择题式的 ToM 测试上崭露头角，MetaMind 在更加开放复杂的社交任务上也表现卓越。在社交认知类任务中（如对对话中隐含动机的判断、尴尬场景识别等），MetaMind 同样取得了比现有模型更高的综合得分。而在交互式的 STSS 社会模拟测试中，MetaMind 相比原始模型更是取得了 34.5% 的性能提升，显著增强了模型在真实社交场景下的应对能力。一个令人瞩目的里程碑是：借助 MetaMind 框架，一些 LLM 首次在关键的心理推理任务上达到了平均人类水平 —— 这在过去是难以想象的。考虑到推理模型的大规模运行成本，我们着重分析八个非推理模型在六种典型 ToM 能力维度上的得分雷达图。可以看到，它们的原始雷达图普遍小于人类标准，且形状各异，表示这些模型在不同心智维度上能力不均衡、且整体逊于人类。而同样的模型集成 MetaMind 后雷达图面积显著增广，GPT-4 甚至几乎追平蓝色的人类圈。特别的，在加入 MetaMind 后，GPT-4 在 “信念推理” 维度上达到 89.3 分，超越人类平均表现的 88.6 分；在 “自然语言交流理解” 维度也达到 89.0 分，超过人类平均表现的 88.5 分。这些结果清晰地表明：MetaMind 有效地弥合了 LLM 与人类社交认知水平之间的差距，使模型能够更全面、均衡地掌握人类推理他人心理的能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e7e197e740d4b2e8e74192816f75bf7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=b4JmkDDLU7KLxyejiztx80IApME%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f18e091eb14db9a880bbfaf95d1be3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=PQqXMBuD6pOb2uEdPv6cMa5YR14%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035104ceefea4e3891cc1e0634242ec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=iGeh2WqRu3FQ5MTsT7va%2FLlc0v4%3D" alt="图片" loading="lazy"/></p>
<p>消融实验与参数敏感性：验证架构设计的必要性</p>
<p>为了进一步弄清 MetaMind 各组成部分对整体性能的贡献，研究者进行了消融实验，逐一移除架构中的关键组件以观察性能变化。结果表明，MetaMind 的三阶段架构和社交记忆机制都是不可或缺的。具体来说：</p>
<ul>
<li>
<p>移除阶段 1（心理假设生成）：去掉 ToM 智能体的结构化心理状态推理后，模型在社交认知任务上的平均成绩下降约 2.6%，在高歧义性的任务中降幅更大（例如在意外结果测试下降 4.3%）。在 STSS 模拟场景下，缺少心理假设往往容易错失潜在含义，导致性能下滑，再次证明了事先推测用户状态及偏好的价值。</p>
</li>
<li>
<p>移除阶段 2（规范约束审查）：跳过领域智能体，对心理假设不做任何文化 / 伦理过滤，直接将阶段 1 的假设用于回应，平均表现将下降 3.8%，在涉及规范违规或潜台词理解的任务中跌幅最大。例如在 “社交失礼（Faux-pas）识别” 任务上成绩下降 5.5%。这说明社会规范约束对于避免不恰当解读至关重要。</p>
</li>
<li>
<p>移除阶段 3（回复自我验证）：如果不进行响应阶段的自我检查，模型将直接根据假设生成答案而不做反思校验。在 STSS 综合社交任务中，这种改动造成了整体性能骤降 16.1%。可见，最后的自我验证步骤对高质量响应至关重要：没有这道把关，模型很容易成为不计后果的 “冒失鬼”，生成与用户真实意图不符或欠缺共情的回复。</p>
</li>
<li>
<p>移除社交记忆：当关闭动态社交记忆模块后，模型性能下降明显。失去长期记忆支撑的模型，在对话中表现得短视且生硬：无法牢记用户之前提供的偏好信息和情绪线索，导致推理和回答都变得片面。尤其在需要跨多轮跟踪用户状态的任务上，没有记忆的模型往往顾此失彼、前后不一致。这进一步证明了长期社交记忆对于模拟真实对话的必要性。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71fdc19a9e9547b390251a35261b3324~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=mX69vNaCpMvjHXURtWP3Fi2p6lU%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db9410404dbc4cd4b072391748561ef1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=2GAI0Cc1WA%2BRi2YoNggUMn1PoMU%3D" alt="图片" loading="lazy"/></p>
<p>上述消融分析清楚地印证了 MetaMind 架构设计的合理性：每一阶段的智能体和社交记忆机制各有独特作用，缺少任何一个都会明显削弱模型的社交推理能力。阶段 1 提供对用户潜在心态的洞察基础，阶段 2 保障了推理符合社会常情，阶段 3 确保了最终输出的质量和一致性，社交记忆贯穿其中提供长程依托。正是这些要素的协同，才造就了 MetaMind 卓越的整体性能。这也从另一个侧面强调了一个观点：真正逼近人类社交智能的 AI，需要的是这种层次分明、环环相扣的类人认知架构，而非简单堆砌参数或数据。</p>
<p>除了验证框架有效性，论文还对 MetaMind 中的超参数进行了敏感性分析，以找到最优配置并了解模型性能对参数的依赖程度。例如，ToM 智能体需要生成多少条假设（记为 k）才能保证覆盖充分？领域智能体在筛选假设时如何平衡假设的 “语境可能性” 与 “信息增益”（记为 λ）？响应代理在验证时如何平衡 “共情” 与 “连贯” 的权重（记为 β）？研究者通过网格搜索发现，生成约 6 条心理假设（k=6）时效果最佳，并能保证合理效能，超过这个数量并不会带来更大提升。另外，在选择和验证的效能函数中，引入约 60% 权重用于语境可能性，约 80% 权重用于情感共情可以取得较优效果。总的来说，MetaMind 在合理范围内对这些参数并不极端敏感，说明框架具有一定鲁棒性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb015e497a2b477fbc38ba640029dd7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=0yXZ0XCWQ8UkvfNE57vfjeeOldM%3D" alt="图片" loading="lazy"/></p>
<p>真实对话剖面：十分钟跑步建议的 “说服术”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a218884d7afa49e981a4bc85d10a4112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764236413&amp;x-signature=RjHadCJhZmJcHQGcku8n3%2FVEqx0%3D" alt="图片" loading="lazy"/></p>
<p>在实际的案例分析中，MetaMind 表现出能够理解用户的显性和隐性表达，并运用适当的策略与用户沟通，这种能力在说服、谈判、合作场景灵活泛化。此外，当 MetaMind 加成后的模型与普通模型对话时，其交互质量明显更高：在外部裁判评审时，无论是 AI 还是人类评审员，都倾向于将对话认定为人机或人人进行，并且将 MetaMind 所属一方判定为人类，这在普通模型交互中则是很难误判的。该现象进一步彰显 MetaMind 的社交智能潜力 —— 建立自交互数据系统，从而为未来模型的训练构建珍贵的异质、长尾交互数据；以及人工智能的重大目标 —— 尝试攻克图灵测试。</p>
<p>未来展望：迈向更高社交智能的 AI 应用</p>
<p>MetaMind 的研究成果向我们展示了赋予 AI 类人社交智力的巨大潜力。这一多智能体元认知框架不仅在学术基准上取得了优异成绩，更为实际应用打开了新的大门。首先，在人机自然交互方面，具备 ToM 推理的 AI 将更善于领会用户的言下之意和情感状态，从而提供更贴心、恰如其分的回应。无论是智能客服、虚拟助手，还是陪伴型对话机器人，都有望因 MetaMind 式的升级而变得更加通情达理，真正理解用户所思所想，而非机械地回答问题。</p>
<p>其次，在跨文化敏感对话中，MetaMind 的领域代理可以发挥重要作用。当 AI 面对不同文化背景的用户时，能够依据当地的社会规范和礼仪来调整自己的理解和回应。这意味着未来的全球化 AI 系统可以更好地避免文化冒犯和误解，实现文化自适应的对话体验。例如，一个经过 MetaMind 式升级的国际客服机器人，能识别出某些表达在特定文化中可能是不礼貌的，从而自动修正回复用语，使之符合该文化的社交期待。</p>
<p>在教育场景下，具备社交心智的 AI 导师将大放异彩。它可以通过社交记忆了解学生的知识掌握情况和情绪变化，在教学对话中提前洞察学生可能的困惑或挫败感（ToM 智能体），并用贴合学生文化背景和个性特点的方式来引导（领域智能体），最终给予温暖而有指导性的反馈（响应智能体）。这样的智能教学系统将更像一位知冷暖、懂进退的私人导师，既能针对学术问题答疑解惑，又能在情感上激励学生，给予人性化的陪伴。</p>
<p>最后，从更宏大的视角来看，MetaMind 代表了一种 AI 设计理念的转变 —— 从追求单一指标上的极致性能，转向追求与人类认知过程的同构性。它提示我们，与其不断增大模型参数规模，不如让 AI 的思考方式更接近人类：学会像我们一样深度思考、反思自己的认知并根据社会规则调节行为。这样的 AI 将更有可能融入人类社会，帮助我们解决那些既需要智能又需要共情和伦理考量的问题，比如心理咨询、医疗陪护、群体决策等等。总而言之，MetaMind 让我们看到了打造 “懂人心” 的 AI 的曙光：未来的人工智能或许不仅能听懂我们说的话，更能明白我们没有说出口的那些话。这无疑是迈向通用人工智能的一大步，也是让技术更好服务于人的美好愿景。</p>
<p>欢迎留言：你期待 AI 在哪些社交场景大显身手？</p>
<p>作者介绍</p>
<p>张轩铭，威斯康星大学麦迪逊分校大四本科生。研究方向为类人智能 (Humanoid Intelligence) 与认知学习。他曾作为学生研究员在亚马逊 AGI、字节跳动、清华大学、智谱、北京大学高可信软件技术重点实验室参与研究。其研究成果已多次在 NeurIPS、ACL、ICLR 等顶会发表。</p>
<p>陈宇轩，清华大学计算机系硕士生。研究方向为 AI 对话模型与 AI 社交智能，涵盖多智能体与认知推理。论文曾发表于 NeurIPS、ACL、AAAI 等国际顶会。</p>
<p>Samuel Yeh，威斯康星大学麦迪逊分校计算机科学博士生。研究领域为可靠机器学习，涵盖数据导向的 AI 对齐与幻觉检测。论文多次发表于 NeurIPS、ICML、EMNLP 等国际顶会。</p>
<p>Sharon Li，威斯康星大学麦迪逊分校计算机科学系副教授，ICML 2026 程序主席。她博士毕业于康奈尔大学，师从图灵奖得主 John E. Hopcroft。Li 教授是 Alfred P. Sloan 学者，并曾获得 NSF CAREER Award、MIT Innovators Under 35 Award、Forbes 30under30 in Science 等荣誉。她的团队曾荣获 NeurIPS 2022 和 ICLR 2022 杰出论文奖。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini3 强势来袭，这次前端真的死了。。。]]></title>    <link>https://juejin.cn/post/7573958996668760091</link>    <guid>https://juejin.cn/post/7573958996668760091</guid>    <pubDate>2025-11-19T03:46:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573958996668760091" data-draft-id="7573972055269130278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini3 强势来袭，这次前端真的死了。。。"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-19T03:46:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini3 强势来袭，这次前端真的死了。。。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:46:52.000Z" title="Wed Nov 19 2025 03:46:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 451篇原创！</p>
<p>大家好，我是苍何。</p>
<p>Gemini3 终于还是来了，预热了这么久，谷歌这次没让人失望。</p>
<p>全网现在你能看到都是 Gemini 3 了，我熬夜测到 3 点，狗嘴里硬是吐不出几个字。</p>
<p>就 2 字：牛逼 + 炸裂。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6221200b16374f8a91f7fdc49e9c37d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=v9p8bYfv65q5E88Nyv1FqKUGcNo%3D" alt="图片" loading="lazy"/></p>
<p>这个本文章的信息图好看吗？也是 Gemini3 Pro生成的。</p>
<p>这次是真炸裂，我们先不看参数和 SOTA，直接看下 case。</p>
<p>这是用 Gemini3 复刻的网站首页，几乎都是一句朴实无华的 prompt：</p>
<blockquote>
<p>请帮我复刻该网站首页。</p>
</blockquote>
<p>这是复刻的 B 站首页：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3118aa7b9e2f47feb9c19451972fd4f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=n8LO7wT5QeEBNvbIKXeilA0lFD4%3D" alt="图片" loading="lazy"/></p>
<p>这是 X 的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18559f94c82541c5a651129ad28794c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=Sqa6ALuqowO701FrDvgX2CPQIXA%3D" alt="图片" loading="lazy"/></p>
<p>这是抖音的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75f2729167548baa1ba9fa544ba0bfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=YaB0BZ05EWlagJWDU1%2FzYz9zrq0%3D" alt="图片" loading="lazy"/></p>
<p>这是小红书的：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92485b4913ea4c0e97929a54da99162e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=Vc3cFVRjeC7MVvlfn78b76pSK7g%3D" alt="图片" loading="lazy"/></p>
<p>讲真，我要不说是复刻的，你大概率不会想到这特么是十几秒就能搞定的？</p>
<p>Gemini3 Pro 比 Gemini2.5 Pro 提升不止一点，这个是用 Gemini 3 Pro 出的天气卡片：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc43a8e85d646ad9cd039bbd0f0efb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=biDStvjTLs3wzcor5GActqumo%2FI%3D" alt="图片" loading="lazy"/></p>
<p>而之前 2.5 Pro 的长这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1494d9d7ea4f41b2810711f0a3a94ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=aS8mYvTOK1NcvUFUzagpizDeJMY%3D" alt="图片" loading="lazy"/></p>
<p>2.5 Pro 的代码能力和 Agent 能力确实挺抽象的。</p>
<p>然后是经典的六边形弹力小球测试 Gemini3 也不在话下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f1c868b4a340528e2f5474e0b8a57e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=y3gdz%2BUGm00J1edU0JWfVGp%2BFRI%3D" alt="图片" loading="lazy"/></p>
<p>还可以一句话生成一个完全可玩的植物大战僵尸游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14d01b006cb44a5ca98637469944bfdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=CGkNno0jCaWuqos4G6JQMJknMaU%3D" alt="wxv_4259791702086647811" loading="lazy"/></p>
<p>一句话生成可交互的 3 D 动画：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/669c9dbfb2d041b48df24284cfa0790f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=v9sQSRTz%2BrCTdt0O11QxAeOofN4%3D" alt="wxv_4259792337356046337" loading="lazy"/></p>
<blockquote>
<p>提示词：用 HTML 生成 3D 演示动画，像中学生演示DNA双螺旋的复制过程</p>
</blockquote>
<p>最绝的是，我让它帮我直接写了个 MacOS 操作系统，还内置了一个 Gemini AI 助手，和小助手聊天还能 AI 回复。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a7aa92a676a4a56aee0501f95b9008e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=h3WHnguIah59v3HHdqocEo%2F92JE%3D" alt="wxv_4259795426947022848" loading="lazy"/></p>
<p>还可以将架构图截上传后复刻这个页面，并让能直接修改里面的文字。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81b7bd3548854568b69dd96679bf3eb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=4BxOI2dtnFc3wdmcvRxC8ttWpY8%3D" alt="wxv_4259796213765423106" loading="lazy"/></p>
<p>效果相当不错，这以后画架构图也方便了啊。</p>
<p>不仅仅是复刻网页，甚至还可以直接让他做个应用，比如我让他仿着 lovart 的风格来做个公众号封面图生成器。</p>
<pre><code class="hljs">帮我做一个公众号封面图生成器，只需要输入公众号文章内容，自动根据内容帮我生成符合要求的公众号封面图  
你可以参考图片中的样式进行设计开发
</code></pre>
<p>最后，你一定要看下这个视频，他居然真的根据我的内容，帮我来生图了，卧槽。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047d31ebfafb441fa04fc4b3655c46cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=H%2F6g7k1h5Z4s7TwIoL9bsRQ30KU%3D" alt="wxv_4259802736176398337" loading="lazy"/></p>
<p>以上是我亲测的 case，除此还有非常多网友有意思的 case，比如 @arkitus 做的知识理解的 case 就很有意思，它不再是简单的文字演示，而是带有交互动画的效果演示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efd07f687279478c89d6921c5d1bd3c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=oaOphnTe5ZkSKkqbA3aLzlnj%2F9k%3D" alt="wxv_4259797222662782977" loading="lazy"/></p>
<p>除了编程能力，也测了下写作能力，因为 2.5 Pro 说实话已经很强了，这次的 Gemini 3 我感觉对指令的遵循上有提升，比如以前即使我让它不要加双引号，他总是不听话还是会加上。</p>
<p>现在 Gemini 3 Pro 就不会了，而且模仿上来说，绝对没问题的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3752042178a4a14a81262a5d5dab94a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=k6luvkhrn8IRShbldNIKo1wwXoA%3D" alt="图片" loading="lazy"/></p>
<p>好，case 看完了，确实牛逼。</p>
<p>这次 Gemini3 能力提升了非常多，可以说是飞跃式提升了，<strong>LMArena 直接干到了 1501 分，霸榜第一</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f8294a8f9b84cb190d8b27b1d72159c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=HnbYrDtxAvoZVvEijTdjBVmNlE4%3D" alt="图片" loading="lazy"/></p>
<p>Gemini3 Pro 在推理多模态上可以说是史诗级加强，可以毫不夸张的说，是目前全球最强的多模态模型了。</p>
<p>所以也就能解释为啥前端复刻能力如此之强，还在于其多模态和推理上。</p>
<p>在 Humanity’s Last Exam 这种变态难的测试里 Gemini 3 Pro 拿到 37.5%的成绩，数学能力在 MathArena 上也是刷新纪录。不管是看复杂的图表还是解高难度的数学题，它都能做好。</p>
<p>新增了 Deep Think 深度思考模式专门解决复杂问题的推理。</p>
<p>这次谷歌还推出了Agent 开发 IDE，叫 Antigravity，可以免费使用 Gemini3 Pro、Claude Sonnet 4.5。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b64fc855c5894855b1d5f07cc222c5d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764128811&amp;x-signature=pMcpcCektx6YcXgquxPjk%2Fp%2F%2Fb8%3D" alt="图片" loading="lazy"/></p>
<p>Gemini 3 在代码生成和长上下文规划上进步巨大，SWE-bench 达到了 76.2%。对于项目级开发来说，会有很大的帮助。</p>
<p>值得注意的是，Gemini 3 现在的上下文窗口依然是 100 万 token，但处理信息的维度更广了。20 分钟的视频，现在能精确的分析出每一个细节。</p>
<p>那现在哪里可以使用呢？其实很多平台都已经支持了。</p>
<p>谷歌的 AI Studio、Gemini APP、Gemini Cli 都已经可以直接用，还有 Cursor 上也能直接用了。</p>
<p>而且 Gemini 3 的 API 也可以直接用，在自己业务系统中可以替换试用。</p>
<p>这次谷歌是动真格了，不光模型重磅更新，全平台上线，还发布了新的 AI IDE。</p>
<p>这次感受最大的还是前端又再一次遭受到了前所未有的挑战。</p>
<p>可以夸张的说，当下的 Gemini3 有足够的实力来取代一个只会 code 的前端工程师，但工程化架构化以及更懂业务的的高级工程师一时还取代不了。</p>
<p>我看很多朋友说，这次Gemini3 是通向 AGI 的一个重要时刻，说的是夸张了些，但总归又回到了当年 GPT4 刚出来那阵的兴奋了。</p>
<p>AI 又再一次铺天盖地，而我们终将是时代的见证者。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再吹性能优化了：你的应用卡顿，纯粹是因为产品设计烂🤷‍♂️]]></title>    <link>https://juejin.cn/post/7573950036897038376</link>    <guid>https://juejin.cn/post/7573950036897038376</guid>    <pubDate>2025-11-19T03:52:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573950036897038376" data-draft-id="7573950036896694312" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再吹性能优化了：你的应用卡顿，纯粹是因为产品设计烂🤷‍♂️"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-11-19T03:52:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再吹性能优化了：你的应用卡顿，纯粹是因为产品设计烂🤷‍♂️
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:52:57.000Z" title="Wed Nov 19 2025 03:52:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3349dd0b49314e4d8ce7022bf38d6b5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764129309&amp;x-signature=G1sk68zwpAR89dMUvvv%2BOwnZC5k%3D" alt="image.png" loading="lazy"/></p>
<p>大家好！</p>
<p>最近面试，我发现一个很有意思的事情。几乎每个高级前端的简历上，都专门开辟了一栏，叫<strong>性能优化</strong>。</p>
<p>里面写满了各种高大上的名词😖：</p>
<blockquote>
<p>使用Virtual List（虚拟列表）优化长列表渲染...</p>
<p>使用Web Worker把复杂计算移出主线程...</p>
<p>使用WASM重写核心算法...</p>
</blockquote>
<p>看着这些，我通常会问一个问题：</p>
<p>你为什么要渲染一个有一万条数据的列表？用户真的看得过来吗？</p>
<p>候选人通常会愣住，然后支支吾吾地说：“呃...这是我们产品经理要求的🤷‍♂️。”</p>
<p>这就是今天我想聊的话题：</p>
<p><strong>在2025年的今天，前端领域90%的所谓性能瓶颈，根本不是技术问题，而是产品问题。</strong></p>
<p>我们这群工程师，拿着最先进的前端技术（Vite, Rust, WASM），却在日复一日地给一坨屎💩（糟糕的产品设计）雕花。</p>
<hr/>
<h4 data-id="heading-0"><strong>我们正在解决错误的问题</strong></h4>
<p>让我们还原一个经典的性能优化现场吧👇。</p>
<p>场景：一个中后台的超级表格（默认大家应该比较熟悉🤔）。</p>
<p>产品经理说需求：这个表格要展示所有订单，大概有50列，每页要展示500条，而且要支持实时搜索，还要支持列拖拽，每个单元格里可能还有下拉菜单...</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f83703961f444959f43e49f20afb178~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764129309&amp;x-signature=AZ2gRS3TrmKPqkg6x5SDLXcV9IQ%3D" alt="image.png" loading="lazy"/></p>
<p><strong>开发者的第一反应（技术视角）</strong> ：</p>
<ul>
<li>50列 x 500行 = 25000个DOM节点，浏览器肯定卡死。</li>
<li>快！上<strong>虚拟滚动</strong>（Virtual Scroll）！</li>
<li>快！上<strong>防抖</strong>（Debounce）！</li>
<li>快！上<strong>Memoization</strong>（缓存）！</li>
</ul>
<p>我们为了这个需求，引入了复杂的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ag-grid.com%2Freact-data-grid%2Fgetting-started%2F" target="_blank" title="https://www.ag-grid.com/react-data-grid/getting-started/" ref="nofollow noopener noreferrer">第三方库</a>，写了晦涩难懂的优化代码，甚至为了解决虚拟滚动带来的样式问题（比如高度坍塌、定位异常），又打了一堆补丁。</p>
<p>最后，页面终于不卡了。我们觉得自己很牛逼，技术很强。</p>
<p><strong>但我们从来没问过那个最核心的问题：</strong></p>
<blockquote>
<p><strong>人类的视网膜和大脑，真的能同时处理50列 x 500行的数据吗？</strong></p>
</blockquote>
<p>答案是：<strong>不能。</strong></p>
<p>当屏幕上密密麻麻挤满了数据时，用户的认知负荷已经爆表了。他根本找不到他要看的东西。他需要的不是高性能的渲染，他需要的是<strong>筛选</strong>和<strong>搜索</strong>。</p>
<p><strong>我们用顶级的技术，去实现了一个反人类的设计。</strong> 这不是优化，这是叫作恶😠。</p>
<hr/>
<h4 data-id="heading-1"><strong>真正的优化，是从砍需求开始</strong></h4>
<p>我曾经接手过一个类似的项目，页面卡顿到FPS只有10。前任开发留下了几千行用来优化渲染的复杂代码，维护起来生不如死。</p>
<p>我接手后，没有改一行渲染代码。</p>
<p>我直接去找了产品总监，把那个页面投在大屏幕上，问了他三个问题：</p>
<p><strong>1.你看这一列 订单原始JSON日志，平均长度3000字符，你把它全展示在表格里，谁会看？</strong></p>
<p>砍掉！改成一个查看详情的按钮，点开再加载。DOM节点减少20%。</p>
<p><strong>2.这50列数据，用户高频关注的真的有这么多吗？</strong></p>
<p>默认只展示核心的8列。剩下的放在自定义列里，用户想看自己勾选。DOM节点减少80%。</p>
<p><strong>3.我就不知道为什么🤷‍♂️ 要一次性加载500条？用户翻到第400条的时候，他还记得第1条是什么吗？</strong></p>
<p>赶紧砍掉！改成标准的分页，每页20条。DOM节点减少96%。</p>
<p><strong>做完这三件事，我甚至把之前的虚拟滚动代码全删了，回退到了最朴素的<code>&lt;table&gt;</code>标签。</strong></p>
<p>结果呢？</p>
<ul>
<li><strong>页面飞一样快</strong>（因为DOM只有原来的1%）。</li>
<li><strong>代码极其简单</strong>（维护就更简单了🤔）。</li>
<li><strong>用户反而更开心了</strong>（因为界面清爽了，信息层级清晰了）。</li>
</ul>
<p><strong>这才是最高级的性能优化：不仅优化了机器的性能，更优化了人的体验。</strong></p>
<hr/>
<h4 data-id="heading-2"><strong>技术自负的陷阱</strong></h4>
<p>为什么我们总是陷在技术优化的泥潭里出不来呢？😒</p>
<p>因为我们有<strong>技术自负</strong>。</p>
<p>作为工程师，我们潜意识里觉得：承认这个需求做不了（或者做不好），是因为我技术不行。</p>
<p><strong>产品经理要五彩斑斓的黑，我就得给他做出来！</strong></p>
<p><strong>产品经理要在这个页面跑3D地球，我就得去学Three.js！</strong></p>
<p>我们试图用技术去弥补产品逻辑上的懒惰！（非常有触感😖）</p>
<p><strong>因为产品经理懒得思考信息的层级</strong> ，所以他把所有信息一股脑扔给前端，让你去搞懒加载。</p>
<p><strong>技术不是万能的。</strong></p>
<p>浏览器的渲染能力是有上限的，JS的主线程是单核的，移动端的电量是有限的。更重要的是，<strong>用户的注意力是极其有限的。</strong></p>
<p>当你发现你需要用极其复杂的新技术才能勉强让一个页面跑起来的时候</p>
<p><strong>请停下来！</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59f0ebbf74847d88d4027a09418a1b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764129309&amp;x-signature=7r54IrvUz9ES%2FEdXo5WWtd%2Bo%2Bl8%3D" alt="stOpStopstopstOpstOp.gif" loading="lazy"/></p>
<p>这时候，问题的根源通常不在代码里，而可能是在 <strong>PRD（需求文档）</strong> 里。</p>
<hr/>
<h4 data-id="heading-3"><strong>说了那么多，该怎么做呢？</strong></h4>
<p>下次，当你再面对一个导致卡顿的需求时，别急着打开<code>Profiler</code>分析性能。</p>
<p>请试着做以下几步：</p>
<p><strong>我们真的需要在前端处理10万条数据吗？能不能在后端聚合好，只给我返回结果？</strong></p>
<p><strong>这个图表真的需要实时刷新吗？用户真的能看清1毫秒的变化吗？改成5秒刷新一次行不行？</strong></p>
<p><strong>在这个弹窗里塞个完整地图太卡了。能不能改成：点击缩略图，跳转到专门的地图页面？</strong></p>
<p>你要告诉产品经理： <strong>性能本身，也是一个产品功能。</strong></p>
<p>如果为了塞下更多的功能，牺牲了流畅度这个最核心的功能，那是丢了西瓜捡芝麻。</p>
<hr/>
<p>最好的代码，是 <strong>没有代码（No Code）</strong>。</p>
<p>同理，最好的性能优化，是<strong>没有需求</strong>。</p>
<p>作为高级工程师，你的价值不仅仅体现在你会写<code>Virtual List</code>，更体现在你敢不敢在需求评审会上，拍着桌子说：</p>
<p><strong>这个设计怎么这么反人类😠！我们能不能换个更好的方式？🤷‍♂️</strong></p>
<p>别再给屎山💩雕花了。把那座山推了，才是真正的优化。</p>
<p>关于这个观点你们怎么看？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[逆天！Gemini 3 Pro直接封神 （用三句话完成的小球物理世界）]]></title>    <link>https://juejin.cn/post/7573958996668858395</link>    <guid>https://juejin.cn/post/7573958996668858395</guid>    <pubDate>2025-11-19T04:06:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573958996668858395" data-draft-id="7573972055269081126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="逆天！Gemini 3 Pro直接封神 （用三句话完成的小球物理世界）"/> <meta itemprop="keywords" content="前端,JavaScript,Gemini"/> <meta itemprop="datePublished" content="2025-11-19T04:06:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ak啊"/> <meta itemprop="url" content="https://juejin.cn/user/237916932030253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            逆天！Gemini 3 Pro直接封神 （用三句话完成的小球物理世界）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237916932030253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ak啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T04:06:56.000Z" title="Wed Nov 19 2025 04:06:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    194
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">用三句话完成的小球物理世界</h2>
<p><em>2025·11·19</em></p>
<p>最近在测试 Gemini 3 Pro 的代码生成能力，我做了一个很简单的实验：用尽可能少的话，让它实现一个完整的交互动画。</p>
<p>最后，我只说了三句话。</p>
<hr/>
<h3 data-id="heading-1">第一句话：</h3>
<blockquote>
<p><strong>“生成一堆颜色各异，在空间乱弹的小球。”</strong></p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7574281654547447843" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7574281654547447843" data-src="https://code.juejin.cn/pen/7574281654547447843" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span>
它返回了一个结构完整的 Canvas 动画：</p>
<ul>
<li>随机颜色</li>
<li>随机速度</li>
<li>全屏</li>
<li>不断反弹</li>
<li>点击还能生成新的球</li>
</ul>
<hr/>
<h3 data-id="heading-2">第二句话：</h3>
<blockquote>
<p><strong>“不要光效，小球富有弹性，可以微变形。”</strong></p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7574280045792624686" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7574280045792624686" data-src="https://code.juejin.cn/pen/7574280045792624686" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span>
它自动理解了我想要“果冻球”“橡胶球”那种轻微的拉伸与压扁效果，并重新组织了代码：</p>
<ul>
<li>移除光效与叠加模式</li>
<li>给小球加上简单的体积渐变</li>
<li>根据速度方向进行轻微变形（stretch &amp; squash）</li>
</ul>
<p>我没有解释公式，它自己找到了合理实现方式。<br/>
这一点给我留下比较深的印象。</p>
<hr/>
<h3 data-id="heading-3">第三句话：</h3>
<blockquote>
<p><strong>“小球之间可以相互碰撞，碰撞后会变形然后复原。”</strong></p>
</blockquote>
<p><span href="https://code.juejin.cn/pen/7574273153342373934" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7574273153342373934" data-src="https://code.juejin.cn/pen/7574273153342373934" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<p>这是最难的一步，因为已经涉及：</p>
<ul>
<li>球体碰撞检测</li>
<li>动量计算</li>
<li>速度交换</li>
<li>位置修正（避免重叠）</li>
<li>碰撞瞬间的挤压变形</li>
</ul>
<p>结果返回的代码不仅实现了全部内容，而且结构化程度依然很高，便于继续扩展。</p>
<p>这个部分如果我自己写，从零开始至少需要 1～2 小时，因为要不断调试碰撞、修正重叠，还有变形的插值。</p>
<p>它一次性生成的代码没有明显逻辑问题，这对我来说是意外的。</p>
<hr/>
<h3 data-id="heading-4">简单总结</h3>
<p>这次体验非常直接，不需要夸大：</p>
<ul>
<li><strong>我只给了三句话</strong></li>
<li>每句话都在增加系统复杂度</li>
<li>它能持续保持代码质量</li>
<li>生成速度快</li>
<li>细节实现到位</li>
<li>没有出现明显 bug</li>
</ul>
<p>从实用角度讲，<strong>如果以后要快速验证动画、交互、物理效果的原型，这种能力非常有用</strong>。</p>
<p><strong>Gemini 3 Pro</strong> 表现出的能力远超我预期。我只说了三句话，它就把一个完整的小球物理世界搭建好了——从随机颜色、自由弹跳，到速度拉伸、碰撞挤压，再到防粘连修正，每一个细节都处理得井井有条。它不仅理解了我的意图，还能把复杂逻辑自动落地，生成结构清晰、可扩展的代码。这种速度、准确度和工程级质量，真的让人感受到大模型带来的效率革命——你说的三句话，它几乎读懂了你的脑子，并直接把想法变成现实。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跟着TRAE SOLO全链路看看项目部署服务器全流程吧]]></title>    <link>https://juejin.cn/post/7574041466710294571</link>    <guid>https://juejin.cn/post/7574041466710294571</guid>    <pubDate>2025-11-19T06:56:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574041466710294571" data-draft-id="7574084898878062633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跟着TRAE SOLO全链路看看项目部署服务器全流程吧"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-19T06:56:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林太白"/> <meta itemprop="url" content="https://juejin.cn/user/1874034273300919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跟着TRAE SOLO全链路看看项目部署服务器全流程吧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1874034273300919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林太白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T06:56:17.000Z" title="Wed Nov 19 2025 06:56:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">跟着TRAE SOLO全链路看看项目部署服务器全流程吧</h2>
<p>接下来我们新建一个项目，然后将项目部署到服务器上，并且配置好以后可以在外网进行访问</p>
<pre><code class="hljs language-bash" lang="bash">安装nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
</code></pre>
<h3 data-id="heading-1">1、简单服务器环境搭建</h3>
<p>接下来我们就实现把 Node.js 项目部署到<code> /opt/nexus-node-api </code>并配置外部访问</p>
<h4 data-id="heading-2">进入服务器以后安装环境</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 更新包列表</span>
sudo apt update

<span class="hljs-comment"># 安装 Node.js 和 npm</span>
sudo apt install nodejs npm

<span class="hljs-comment"># 验证安装</span>
node --version
npm --version
</code></pre>
<h4 data-id="heading-3">项目创建</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建目录</span>
sudo <span class="hljs-built_in">mkdir</span> -p /opt/nexus-node-api

<span class="hljs-comment"># 设置所有者和权限</span>
sudo <span class="hljs-built_in">chown</span> -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> /opt/nexus-node-api
<span class="hljs-built_in">chmod</span> -R 755 /opt/nexus-node-api

<span class="hljs-comment"># 进入目录</span>
<span class="hljs-built_in">cd</span> /opt/nexus-node-api

<span class="hljs-comment"># 创建一个项目</span>
nano app.js
</code></pre>
<h4 data-id="heading-4">项目内容</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World!\n'</span>);
});
server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-string">'0.0.0.0'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port 3000`</span>);
});
</code></pre>
<h4 data-id="heading-5">测试运行以及外网访问</h4>
<p>注意点：一定要注意这个时候必须保证你的服务器里面的防火墙（安全组）规则里面有3000这个端口号</p>
<pre><code class="hljs language-perl" lang="perl">node app.js

现在访问 http:<span class="hljs-regexp">//</span>你的服务器IP:<span class="hljs-number">3000</span> 应该能看到 <span class="hljs-string">"Hello World!"</span>
</code></pre>
<h3 data-id="heading-6">2、正式项目配置</h3>
<h4 data-id="heading-7">卸载node环境</h4>
<p>这里我们使用nvm来配置我们的环境，如果已经有的，我们删除一下已经有的环境</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 卸载 nodejs 和 npm</span>
sudo apt-<span class="hljs-keyword">get</span> <span class="hljs-keyword">remove</span> nodejs npm
sudo apt-<span class="hljs-keyword">get</span> purge nodejs npm
</code></pre>
<h4 data-id="heading-8">安装nvm</h4>
<pre><code class="hljs language-bash" lang="bash">// 安装 nvm
<span class="hljs-comment"># 建议安装 nvm，方便版本管理</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
</code></pre>
<p>配置环境变量</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑 .bashrc</span>
nano ~/.bashrc

//添加配置 ---一般系统会自动为我们添加
<span class="hljs-built_in">export</span> NVM_DIR=<span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm"</span>
[ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span> ] &amp;&amp; . <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/nvm.sh"</span>
[ -s <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span> ] &amp;&amp; . <span class="hljs-string">"<span class="hljs-variable">$NVM_DIR</span>/bash_completion"</span>

// 重新加载配置
<span class="hljs-built_in">source</span> ~/.bashrc

// 验证 nvm 安装
nvm --version
</code></pre>
<h4 data-id="heading-9">安装稳定版本node</h4>
<pre><code class="hljs language-csharp" lang="csharp">ubuntu为例子
<span class="hljs-comment">// 查看可以安装的稳定版本</span>
nvm ls-remote

<span class="hljs-comment">// 这里我安转版本</span>
nvm install v22<span class="hljs-number">.12</span><span class="hljs-number">.0</span>
<span class="hljs-comment">// 使用</span>
nvm use v22<span class="hljs-number">.12</span><span class="hljs-number">.0</span>

<span class="hljs-comment">// 设置默认版本</span>
nvm <span class="hljs-keyword">alias</span> <span class="hljs-literal">default</span> v22<span class="hljs-number">.12</span><span class="hljs-number">.0</span>
<span class="hljs-comment">//   pm2</span>
npm i -g pm2
</code></pre>
<h4 data-id="heading-10">使用pm2守护进程</h4>
<p>PM2 是 Node 应用的进程管理工具，能保证服务在后台持续运行：要不然关闭窗口之后，就无法访问了</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装 PM2</span>
npm install pm2 -g

<span class="hljs-comment"># 启动服务并命名（方便管理）</span>
pm2 start app.js --name <span class="hljs-string">"node-api-nexus"</span>

<span class="hljs-comment"># 查看服务状态</span>
pm2 list  <span class="hljs-comment"># 若 Status 为 online 则表示启动成功</span>
</code></pre>
<p>这个时候不管怎么刷新我们的页面或者窗口，可以始终稳定访问我们的接口</p>
<h5 data-id="heading-11">pm2 重启对应的服务</h5>
<pre><code class="hljs language-arduino" lang="arduino">pm2 restart <span class="hljs-string">"node-api-nexus"</span>
</code></pre>
<h3 data-id="heading-12">3、服务器安装mysql数据库</h3>
<h4 data-id="heading-13">环境搭建</h4>
<p>接下来我们在服务器上安装mysql数据库，这里需要我们输入服务器密码</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 更新包列表</span>
sudo apt update

<span class="hljs-meta"># 安装 MySQL 服务器 </span>
<span class="hljs-comment">// 安装 MySQL 8.0（Ubuntu 默认源即提供 MySQL 8.0）</span>
sudo apt install mysql-server -y

<span class="hljs-meta"># 安装过程中可能会提示输入服务器密码</span>

<span class="hljs-meta"># 确认 MySQL 版本</span>
mysql --version
</code></pre>
<h4 data-id="heading-14">MYSQl数据库安全配置</h4>
<h5 data-id="heading-15">调整 MySQL 服务器的安全性</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安全配置（可选但推荐）</span>
sudo mysql_secure_installation

测试可以都选n


按照提示配置：
是否启用强密码   <span class="hljs-comment">// y </span>
设置 root 密码   <span class="hljs-comment">// Le@1996#Lin</span>
移除匿名用户
禁止远程 root 登录（可选）
删除测试数据库
重新加载权限表
</code></pre>

<pre><code class="hljs language-css" lang="css">登录 MySQL
sudo mysql -u root -<span class="hljs-selector-tag">p</span>
输入密码即可
</code></pre>
<h4 data-id="heading-16">配置远程访问（可选）</h4>
<pre><code class="hljs language-ini" lang="ini">配置 MySQL 允许本地连接：

sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

配置信息
<span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 确保绑定到本地</span>
<span class="hljs-attr">bind-address</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>

<span class="hljs-comment"># 设置端口</span>
<span class="hljs-attr">port</span> = <span class="hljs-number">3306</span>

<span class="hljs-comment"># 设置字符集</span>
<span class="hljs-attr">character-set-server</span> = utf8mb4
<span class="hljs-attr">collation-server</span> = utf8mb4_unicode_ci
</code></pre>
<h5 data-id="heading-17">修改mysql数据库配置</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 注释掉原来的 bind-address 或改为 0.0.0.0</span>
<span class="hljs-comment"># bind-address = 127.0.0.1</span>
<span class="hljs-attr">bind-address</span> = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
<span class="hljs-attr">port</span> = <span class="hljs-number">3306</span>
</code></pre>
<h5 data-id="heading-18">重启服务,登录mysql创建远程连接用户</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重启mysql服务
sudo systemctl restart mysql

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 登录
sudo mysql <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 密码
<span class="hljs-number">123456</span>

<span class="hljs-comment">-- 创建远程用户（% 表示允许任何IP连接）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'账号'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'密码'</span>;

<span class="hljs-comment">-- 授予权限</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'密码'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;

<span class="hljs-comment">-- 或者只授权特定数据库(跳过)</span>
<span class="hljs-comment">-- GRANT ALL PRIVILEGES ON your_database.* TO 'remote_user'@'%';</span>

<span class="hljs-comment">-- 刷新权限</span>
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 查看用户</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">User</span>, Host <span class="hljs-keyword">FROM</span> mysql.user;

<span class="hljs-comment">-- 退出</span>
EXIT;

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重启 MySQL
sudo systemctl restart mysql

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 设置开机自启（默认应已设置）
sudo systemctl enable mysql
</code></pre>
<h3 data-id="heading-19">4、navicat远程mysql数据库</h3>
<p>切记：一定要保证我们的服务器已经添加了我们的端口3306</p>
<p>服务器允许我们远程连接</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 开放 3306 端口</span>
sudo ufw allow <span class="hljs-number">3306</span>

<span class="hljs-comment"># 或者只允许特定IP访问（更安全）</span>
sudo ufw allow <span class="hljs-keyword">from</span> 你的本地IP to <span class="hljs-built_in">any</span> port <span class="hljs-number">3306</span>

<span class="hljs-comment"># 查看防火墙状态</span>
sudo ufw status
</code></pre>
<h4 data-id="heading-20">远程连接</h4>
<p>本地远程mysql数据库,我使用的是navicat工具，这里直接输入我们的信息</p>
<pre><code class="hljs">连接名：远程服务器,随便起名字
主机：服务器IP
用户名：上面设置的
密码：上面设置的
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be106fdc964442998cf5af33acacd02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5aSq55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764140176&amp;x-signature=7QtCZG5aMpkvM1h5oUiXZdBLmA0%3D" alt="" loading="lazy"/></p>
<p>测试一下，服务器的数据库已经连接成功了</p>
<h4 data-id="heading-21">数据库连接测试</h4>
<p>新建一个数据库，这里我的名称是nexus</p>
<pre><code class="hljs">数据库名：nexus
字符集：utf8mb3
排序规则：utf8mb3_bin
</code></pre>
<p>新建一个表</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `sys_user`;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_user`  (
  `user_id` <span class="hljs-type">int</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'id'</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'姓名'</span>,
  `age` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'年龄'</span>,
  `sex` <span class="hljs-type">int</span>(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户性别 1男 2女 '</span>,
  `create_time` datetime(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  `address` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户的地址'</span>,
  `state` tinyint(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'1 正常  0 2  禁用'</span>,
  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'手机号'</span>,
  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户的登录账号'</span>,
  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'123456'</span> COMMENT <span class="hljs-string">'用户的登录密码'</span>,
  `avatar` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'头像地址'</span>,
  `update_time` datetime(<span class="hljs-number">0</span>) <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  `user_height` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'身高'</span>,
  `user_weight` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'体重'</span>,
  `disease` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> utf8mb3_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'健康状况，是否有疾病'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`user_id`, `password`) <span class="hljs-keyword">USING</span> BTREE
) ENGINE <span class="hljs-operator">=</span> InnoDB AUTO_INCREMENT <span class="hljs-operator">=</span> <span class="hljs-number">55</span> <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8mb3 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8mb3_general_ci ROW_FORMAT <span class="hljs-operator">=</span> <span class="hljs-keyword">Dynamic</span>;
</code></pre>
<h4 data-id="heading-22">本地运行项目测试</h4>
<p>这里我们现在就本地启动项目连接我们服务器，然后进行测试，这里我以开源的Node项目为例，主要修改四个参数</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">dbhost</span>=<span class="hljs-string">'xx'</span><span class="hljs-comment">; // 数据库主机地址，如果是本地数据库则使用localhost</span>
const <span class="hljs-attr">dbdatabase</span>=<span class="hljs-string">'xx'</span><span class="hljs-comment">; // 数据库名称</span>
const <span class="hljs-attr">dbuser</span>=<span class="hljs-string">'xx'</span><span class="hljs-comment">; // 数据库用户名</span>
const <span class="hljs-attr">dbpassword</span>=<span class="hljs-string">'xxx'</span><span class="hljs-comment">; // 数据库密码</span>
</code></pre>
<p>本地测试一下，我们的线上数据库已经可以使用了</p>
<h3 data-id="heading-23">5、Node项目部署</h3>
<p>接下来我们将node项目部署进我们的服务器，首先把我们项目都扔进去</p>
<h4 data-id="heading-24">配置环境</h4>
<p>这里我用的是yarn，安装一下</p>
<pre><code class="hljs language-arduino" lang="arduino">npm install yarn -g 


<span class="hljs-comment">// 配置环境</span>
yarn

<span class="hljs-comment">// 启动pm2</span>
pm2 start app.js --name <span class="hljs-string">"node-api-nexus"</span>

<span class="hljs-comment">// 重新启动pm2 设置开机自启</span>
pm2 startup
pm2 save
</code></pre>
<p>查看详细日志</p>
<pre><code class="hljs">pm2 logs node-api-nexus
</code></pre>
<p>启动以后我们就可以直接在浏览器打开地址对我们的系统后台进行访问了</p>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//XXX<span class="hljs-doctag">XXX:</span>3200/</span>
</code></pre>
<h3 data-id="heading-25">6、前端部署</h3>
<h4 data-id="heading-26">环境安装</h4>
<p>接下来我们继续部署我们的前端应用，先用我们的项目连接一下我们的数据库尝试一下 OK，没什么问题，然后我们开始部署前端项目</p>
<pre><code class="hljs language-arduino" lang="arduino">项目名称为nexus-vue，项目打包好的路径位于 /opt/nexus-vue 下面

<span class="hljs-comment">// 打包前端项目</span>
yarn build

<span class="hljs-comment">// 更新和安装nginx </span>
<span class="hljs-comment">// 更新可以跳过 之前我们已经进行过</span>
sudo apt update
sudo apt install nginx

<span class="hljs-comment">// 查看版本</span>
nginx -V
</code></pre>
<h4 data-id="heading-27">配置nginx</h4>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/nginx/sites-available/nexus-vue

// 配置如下
server {
    listen 80;
    server_name localhost;  <span class="hljs-comment"># 替换为你的域名或IP</span>

    root /opt/nexus-vue;
    index index.html;

    location / {
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
    }

    <span class="hljs-comment"># 如果需要代理API请求</span>
    location /api {
        proxy_pass http://localhost:3000;
    }
}
server {
    listen 8080;
    server_name localhost;  <span class="hljs-comment"># 替换为你的域名或IP</span>

    <span class="hljs-comment"># 前端静态文件</span>
    root /opt/nexus-vue;
    index index.html;

    <span class="hljs-comment"># 前端路由</span>
    location / {
        try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html;
    }

    <span class="hljs-comment"># 后端API请求</span>
    location /api {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span>;
        proxy_set_header Connection <span class="hljs-string">'upgrade'</span>;
        proxy_set_header Host <span class="hljs-variable">$host</span>;
        proxy_cache_bypass <span class="hljs-variable">$http_upgrade</span>;
    }

    <span class="hljs-comment"># WebSocket连接</span>
    location /ws {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span>;
        proxy_set_header Connection <span class="hljs-string">"upgrade"</span>;
        proxy_set_header Host <span class="hljs-variable">$host</span>;
    }
}
</code></pre>
<h4 data-id="heading-28">开放接口</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">sudo</span> <span class="hljs-string">ufw</span> <span class="hljs-string">allow</span> <span class="hljs-number">8080</span>

<span class="hljs-string">sudo</span> <span class="hljs-string">systemctl</span> <span class="hljs-string">restart</span> <span class="hljs-string">nginx</span>
</code></pre>
<p>处理日志错误</p>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/ 检查nginx错误日志
sudo tail -f /var</span><span class="hljs-regexp">/log/nginx</span><span class="hljs-regexp">/error.log


/</span><span class="hljs-regexp">/开放文件权限
sudo chmod -R 755 /opt</span><span class="hljs-regexp">/nexus-vue

/</span><span class="hljs-regexp">/ 检查配置
sudo nano /etc</span><span class="hljs-regexp">/nginx/sites</span>-available/nexus-vue

/<span class="hljs-regexp">/ 重新启动nginx
sudo systemctl restart nginx
</span></code></pre>
<h4 data-id="heading-29">部署</h4>
<p>写一个测试页面扔进去</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我是测试页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我是测试页面<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>访问我们的地址<code>http://域名IP:8080/</code></p>
<pre><code class="hljs">这个时候已经可以看到我们的项目已经部署上去了
</code></pre>
<p>重新加载以后，ok，到这里我们全链路都部署上去了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fcd06041e5942e1897904d1f5491a45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6X5aSq55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764140176&amp;x-signature=Vn5%2Ba7WRF5qXM%2FitGuRJ5%2B%2FySZQ%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【开源】耗时数月、我开发了一款功能全面【30W行代码】的AI图床]]></title>    <link>https://juejin.cn/post/7574271557938905139</link>    <guid>https://juejin.cn/post/7574271557938905139</guid>    <pubDate>2025-11-19T10:15:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574271557938905139" data-draft-id="7574271557938855987" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【开源】耗时数月、我开发了一款功能全面【30W行代码】的AI图床 "/> <meta itemprop="keywords" content="前端,后端,开源"/> <meta itemprop="datePublished" content="2025-11-19T10:15:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_小九"/> <meta itemprop="url" content="https://juejin.cn/user/3861140568811576"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【开源】耗时数月、我开发了一款功能全面【30W行代码】的AI图床 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3861140568811576/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _小九
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T10:15:48.000Z" title="Wed Nov 19 2025 10:15:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI编程发展迅猛，现在如果你是一个全栈开发，借助AI编辑器，比如<strong>Trae</strong>你可以开发很多你以往无法实现的功能，并且效率会大大提示，<strong>Tare</strong>的<strong>Coding能力</strong>已经非常智强了，借助他，我完成了这个<code>30W行</code>代码的开源项目，现在，想把这个项目推荐给你。</p>
<p>当前文章主要是介绍我们开发出的这个项目，在后续，将会新开一个文章专门介绍<strong>AI Coding</strong>的各种技巧，如何使用他，才能让他在<strong>大型项目</strong>中依然如虎添翼。</p>
<blockquote>
<p>如果你想快速了解此项目、你可以访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fpixelpunk.cc%2F" target="_blank" title="https://pixelpunk.cc/" ref="nofollow noopener noreferrer">PixelPunk官方文档</a>。</p>
</blockquote>
<blockquote>
<p>如果你想快速体验此项目、你可以访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fv1.pixelpunk.cc%2F" target="_blank" title="https://v1.pixelpunk.cc/" ref="nofollow noopener noreferrer">V1版本</a>,前往体验功能。</p>
</blockquote>
<blockquote>
<p>如果你想完整体验前后台全面的功能、你可以访问<a href="https://link.juejin.cn?target=http%3A%2F%2Fdev.pixelpunk.cc%2F" target="_blank" title="http://dev.pixelpunk.cc/" ref="nofollow noopener noreferrer">测试环境</a>。【root 123456】</p>
</blockquote>
<blockquote>
<p>如果您认可我的项目，愿意为我献上一个宝贵的Star，你可以前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCooperJiang%2FPixelPunk" target="_blank" title="https://github.com/CooperJiang/PixelPunk" ref="nofollow noopener noreferrer">PixelPunk</a>项目。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bada0a94aae436495f282772dd0748b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=046KAzJ3ITK5fWE0X%2BdC2dEoQZc%3D" alt="image.png" loading="lazy"/></p>
<p>开发这样一个项目在现在这个时间来看似乎没什么必要，实际上开发这样一个项目的原因其实就是在年初的时候失业了一段时间，闲在家里无聊，于是想着做一个自己的开源项目，最开始其实做的是另一个类型的项目，开发了一段时间感觉有些无聊就转战做了现在的这个项目<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCooperJiang%2FPixelPunk" target="_blank" title="https://github.com/CooperJiang/PixelPunk" ref="nofollow noopener noreferrer">PixelPunk图床</a>， 其实并不只是想要做一个<code>图床</code>，只是当前来说的一期功能比较贴合图床，后期的跌代准备支持更多格式包括视频文档等等，并且由于<code>AI多模态模型</code>的能力发展迅速，后期结合<code>AI</code>可以实现更多可玩性比较高的内容。</p>
<p>市面上已经有了非常多的开源图床了，开发这样一个项目要追求一些差异点才会有价值，本质上来说这类服务其实核心就是个存图片而已，其他功能并不是很重要，但是作为个人使用用户来说，除了存图也愿意去尝试一些便捷的功能，于是思考到这个点之后，我开始了这个项目的开发，项目的命名<code>[PixelPunk] </code>是我让AI起的，因为要做就要做一个不一样的有特点，我要做一个ui上就不一样的图床出来，于是有了此命名，中文翻译过来是<code>像素朋克</code>,由于像素风格感觉ui不是很适合工具类网站使用，于是我选择了<code>赛博朋克风格</code>，围绕这个ui来开发了此项目。</p>
<h3 data-id="heading-0">项目概览</h3>
<p>首先呢项目从开发就一个全栈项目，前后端放一起了，采用的技术栈是 go+vue， 前端会将打包的文件放入到go中一起打包为<code>二进制</code>安装包，这样部署起来将非常简单。
项目分为了用户端和管理端，并且同属于一个项目，不分离开发，为了符合我们定制化的ui，所有组件都是自定义的组件，项目使用了<code>70+</code>自定义组件。
项目接入了多模态<code>AI</code>大模型，在以前我们的图床要实现各种功能需要对接各种各样的平台，现在有了<code>AI</code>，我们只需要一个模型就能完成非常多的功能，比如【<strong>语义化描述图片</strong>】，【**<em>图片OCR识别</em>】，【**<em>图片自动分类</em>】，【**<em>图片自动打标</em>】，【**<em>图标自动审核NSFW、违规图、敏感图、血腥图等等</em>】，【<strong>图片颜色提取</strong>】等等功能都只需要配置一个<code>AI模型</code>即可，对于成本而言，比之前的三方<code>API</code>可能更加便宜</p>
<h3 data-id="heading-1">关于部署</h3>
<p>作为一个开源项目，我想的是需要使用者使用起来足够简单，部署起来也足够快，本身来讲，我们项目需要用来这些内容，<code>mysql|Sqlite</code> + <code>Redis|系统内存</code> + <code>qdrant向量数据库</code>， 这三件套，为了安装简单，我将向量数据库直接集成到安装包，用户可以无需关系任何内容，我们可以做到<code>0配置启动项目</code>，不需要你做任何配置即可超快部署项目。</p>
<p>我们提供了两种部署方式，一种是安装包部署，你可以下载对应平台的安装包**.zip安装包**，下载到你的服务器，解压之后里面有一个<code>install.sh</code>，直接<code>sh ./install.sh</code>即可安装，当然手动部署 可能还需要两个步骤，你可以使用我们的脚本直接进行部署，也可以看看我们的部署文档，<a href="https://link.juejin.cn?target=https%3A%2F%2Fpixelpunk.cc%2Fdocs%2Fgetting-started" target="_blank" title="https://pixelpunk.cc/docs/getting-started" ref="nofollow noopener noreferrer">PixelPunk部署文档</a>。</p>
<blockquote>
<p>安装包一键部署 <code>curl -fsSL https://download.pixelpunk.cc/shell/install.sh | bash</code></p>
</blockquote>
<blockquote>
<p>docker-compose一键部署脚本 <code>curl -fsSL https://download.pixelpunk.cc/shell/docker-install.sh | bash</code></p>
</blockquote>
<p>我们的部署非常简单，你只需要执行完脚本即可直接启动项目，我们的<code>docker-compose部署方式</code>已经配置了所有数据库缓存等信息，启动项目进入 <strong><a href="https://link.juejin.cn?target=http%3A%2F%2Fip%3A9520" target="_blank" title="http://ip:9520" ref="nofollow noopener noreferrer">http://ip:9520</a></strong> 会自动跳转到安装页面，添加管理员账号密码即可完成安装， 如果使用安装包模式呢，那么就支持你可以自定义选择数据库，可以填写自己的mysql，也可以使用系统内置的<code>Sqlite</code>，可以选择自己的<code>向量数据库和缓存</code>，也可以使用系统内置的，自由选择，总之，一键脚本预估20S就可以帮你安装并且启动项目，无需你的任何配置，希望会自己内置生成一些必要信息，比如<strong>jwt</strong>，系统安装后你可以进入后台管理进行修改。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28da070422dd4053915ba5f9e947322a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=QN8mnmOLPXfFpR6sGM1VVRjEBNw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">项目部分功能</h3>
<p>我们的项目功能可以说已经非常全面了，并且还在持续迭代，目前代码总行数已经达到了<code>30W行</code>，很多功能需要你自己体验，我们覆盖了主流图床的全部功能，并且还在进一步持续加入更多有趣的元素，我们可以列举一些功能做简要说明。</p>
<h4 data-id="heading-3">10+精美主题</h4>
<p>作为个人使用的工具，我一直在持续优化UI和交互，始终认为，<code>UI</code>还是很重要的一个步骤，目前的<code>UI还不够精美</code>，也是后续会持续调整的一个点，目前提供了<code>10多套</code>主题，并且您可以自定义主题，我在项目中放置了<strong>主题开发文档</strong>,你可以根据模板文件去替换一套变量即可完成一套主题的开发。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c9416634a9d4fe6a07b2f25dbab0ab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=pkSI7K4CTlF5zHMEZLBFxl1QmFg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdf3798fec034b7aaceff58524b7b733~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=gYITr0mdbY2Rj4EWqkTBkRBJJ3c%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">多语言双风格</h4>
<p>我们目前内置了三种语言<code>中英日</code>,并且为了迎合我们<code>PixelPunk风格</code>的特色，我们新增了一种风格选项，你可以选择<code>赛博朋克风格</code>的文案，让系统的所有内容提示充满赛博味道~</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3152eb1f44824daa9aaf4428e0357b0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=9u%2BdbT%2BNiVsgEKrlEa8cpZPpZXY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62ec4e8376c542c6b5fc0a62f9b8a512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=zQlg2awfkZ6nL8c7OPjhm2V2hoA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">多布局系统</h4>
<p>我们网站为了更好的工作体验，提供了两种的布局方式,<code>传统布局</code>,<code>工作布局</code>，既可以使用传统的轻量化的布局让人轻松，也可以使用工作台布局让工作更高效。并且您还可以在后台限制这些功能，使用固定布局而不开放这些功能，在后台管理部分都可以实现。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b76d28edf12749e180c31bd42d90ad6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=BqsX8kXEGnHy0rVFOuBgu6jFKkQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f22417779924ad1898afc8620ad40f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=YyNiK%2FGz7syOQpWj8I6Ng%2BwaYc8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">多种登录方式</h4>
<p>我们内置默认使用传统邮箱的登录方式，并且支持关闭注册，<code>邮箱配置也是后台配置即可</code>，同时系统对接了<code>Github</code>、<code>Google</code>、<code>LinuxDo</code>三种接入成本非常低的快捷登录方式，并且可能由于你是国内服务器，无法直接访问这些服务，所以系统贴心的准备了<code>(代理服务)</code>配置，让你即使是国内服务器也依然可以顺利完成这些快捷登录。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55af683a3ec340e09bba7b1a875dfaf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=bRWkKlZ%2FyX0ZYNK2y0Bpw41%2FQ3A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8fc5d4613564de4b8bb1b823ec4c39e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=AIrC%2Fyf%2BppTocXvsAPBoh16kV7o%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">强大的特色文件上传</h4>
<p>文件上传是一个基础的功能，所有图床都支持，我们当然也支持，我们在此功能上进行了耐心的打磨，支持很多特色功能，</p>
<ul>
<li>支持后台动态配置允许格式，动态配置上传图片限制尺寸</li>
<li>支持<code>大文件分片上传</code>、<code>断点续传</code>等功能。</li>
<li>支持<code>秒传</code>，后台动态开启是否启用</li>
<li>支持<code>游客模式</code>，限制游客上传数量，并限制上传资源有效时间</li>
<li>支持<code>自定义资源保存时间</code>，后台可配置用户允许选择有效期，精确到分钟</li>
<li>支持<code>重复图检测</code>，重复图自动秒传，不占用空间</li>
<li>支持水印，并且特色化水印，开发了一个水印专用面板用于你配置特色化水印，支持<code>文字、图片</code>水印。</li>
<li>支持<code>中断上传</code>,取消上传</li>
<li>支持<code>上传实时进度提示</code></li>
<li>支持<code>自动优化图片</code>，<code>自定义上传文件夹</code>。</li>
<li>支持<code>文件夹上传</code>,<code>拖拽上传</code>,<code>项目内全局上传（任意页面都支持上传）</code>。</li>
<li>支持<code>原图复制</code>,<code>MD格式复制</code>,<code>HTML格式复制</code>,<code>缩略图格式复制</code>,<code>全部图片链接批量复制</code></li>
<li>支持<code>公开、私密、受保护</code>,三种权限设置，<code>公开图片</code>可以在任何地方显示并且授权给管理员可以用于推荐，并且在作者首页可以展示对外，<code>私密</code>则仅自己可见，系统其他人不可见，<code>受保护</code>权限图片只能在系统观看打开，无法产生链接，除自己登录系统外，其他人无法观看。</li>
<li>支持<code>持久化</code>，你可以选择图片并且上传中，跳转到任何页面而不会中断你的上传，你可以在上传过程中干任何事情</li>
<li>支持<code>特色悬浮球</code>，当你不在上传页面的其他页面，如果有上传内容，会有一个特色上传球实时告知您上传的进度，并且你可以随意拖动控制悬浮球的位置。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fdc7ea1ec924525bf3b14d5d5ca803d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=P5I48qTZ681qRtQemYbnxdyM2MY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f66c5469421d47639f17f4d9fd308934~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=AGis85x6E6aOeT514m8gygfdzhU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ae54015b5348ceaa37d7fc7874985f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Vo6udTlkiV2aSaZXgQXvrfRQ6G4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">超过上传渠道支持</h4>
<p>作为一个图床的基本素养，都会支持对接三方，目前我们已经支持了<code>10+</code>的三方云储存渠道，并且添加时候可以测试渠道保障你的配置，首先我们支持<code>服务器自身存储</code>，这也是系统默认渠道，你可以在后台渠道配置更多，比如<code>阿里云COS</code>,<code>腾讯云OSS</code>,<code>七牛云</code>,<code>雨云</code>,<code>又拍云</code>,<code>S3</code>,<code>Cloudfare R2</code>,<code>WebDav</code>,<code>AZure</code>,<code>Sftp</code>,<code>Ftp</code>,等等渠道，<strong>S3</strong>协议本身就可以支持非常多的基于S3协议的渠道了，并且，如果你想要更多渠道，可以去往我们官网网站提起诉求，我们可以很快支持新的渠道。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa931accca7c4903a5eb329f90d1adb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=lykqpx7jqED%2B9tnj8GK1NffKGnE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e2674a6366e4caabe03f3f98f0f6391~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Ui6agEDPab1Q5OjE2WpOoaki%2B7A%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">特色AI功能</h4>
<p>AI也是我们图床的一大特色，我们利用AI做了这些事情</p>
<ul>
<li>自动分类</li>
<li>自动打标</li>
<li>语义化图片，提取信息，提取色调</li>
<li>实现ai自然语言搜索</li>
<li>实现相似图搜索</li>
<li>实现NSFW违规图审核</li>
</ul>
<p>而这些，仅仅只需要配置一个<strong>openai的gpt4-mini</strong>即可完成，后续会支持更多渠道（目前仅支持配置OPENAI格式的渠道），目前测试感觉<strong>gpt-4.1-mini</strong>足以胜任工作，并且价格低廉，性价比很高。</p>
<ul>
<li>违规图片检测 可以自定义等级 宽松或严格</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b57cfde532dc4c13bad16a572ff66a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=qYG9qLtaHLEDBDx28fKEH5Sd5Go%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>自然语言搜索图片</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/084de3398649419f834f4c948b2bcfa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Tt8nptZae1e3dNdJjKKL0js4HNI%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>相似图搜索</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d322149879694be5bfd9c7a94b420738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=V9k%2BBT44cE4Xln%2B6wh4JTSX5f8g%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>图片ai描述</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55e575a838c24ced9ef145455cdd7ef1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=l%2BKwYtVZq0zxvfGEX5EvvthywJU%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>自动分类打标签</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ea689cef8c44829823170ca949d523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=mn03ubC2618pQuafFawjHPicIOA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">文件夹功能</h4>
<p>文件分类是一个和合理的诉求，所以我们可以自定义创建文件夹，同样可以控制不同的权限，并且文件夹可以无限嵌套 你可以自定义多层级的文件夹 合理管理你的文件，并且我们支持<code>文件夹移动</code>，<code>图片移动</code>，<code>批量操作</code>，<code>右键菜单</code>，<code>拖拽排序</code>等等特色功能，你可以灵活的管理你的文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffa3db788fb14937a9ca47cf82d77def~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Zm%2F3TEl193SXbkK5hzmIiU0rJ8A%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>右键菜单</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/512e2954b1334e7fa3b57f69b490068d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=D3V4yCKNPBX62VmzJzfo0EBY%2F1g%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">分享系统</h4>
<p>我们拥有大量素材，或者一些收藏资源需要分享给好友，我们可以任意创建分享，可以分享自己的文件夹，图片，也可以组合分享，也可以分享用户公开的推荐图，选择任意探索广场的图进行分享，并且可以统计访问次数，限制访问次数，达到访问次数关闭分享，密码分享，限制时间有效期分享，邮箱通知等等功能。</p>
<p>您可以观看我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fv1.pixelpunk.cc%2Fshare%2FETDMDkz6EnzZxEMl" target="_blank" title="https://v1.pixelpunk.cc/share/ETDMDkz6EnzZxEMl" ref="nofollow noopener noreferrer">演示分享内容</a></p>
<ul>
<li>创建分享</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa459bf521ec476b8190f04bb4f84bd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=nnXi4XsOomOAIkEv6%2F9v4f1kaeU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a5e483c67d4441e897fb2c9879ec1b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=gh9K%2Bc9DazHicKKW500pas9c7EM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-12">防盗链管理</h4>
<p>图床安全始终是一个问题，经常会遇到被盗刷的风险，由于流量费用贵，鄙人有幸被刷破产过一次（TMD），我们加入了防盗链配置，可以配置<code>白黑名单域名|IP</code>，可以配置<code>网站refer</code>等内容，并且对于违规的用户，我们可以配置让其<code>302到他地址</code>,<code>可以自定义返回固定图</code>,<code>也可以直接拒绝</code>。</p>
<p>当我们对接三方渠道的时候，正常情况我们会拿到<code>远程url地址</code>，我们依然可以在后台配置渠道将其隐藏远程url地址，如果配置，那么域名请求将会从我们服务器代理获取，可以隐藏掉三方的地址，或者配置私有存储桶通过秘钥去动态获取图片，防止你的图片被盗刷大量流量</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6092e578d72a4b2f83e9f98b4ec1c277~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=s%2BghD%2FZfbwm7WX5k72c2eppjwgk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-13">开放API</h4>
<p>图床的基本功能之一，我们可以生成秘钥在三方进行上传文件，不同的是，我们系统支持了设置秘钥时可以<code>限制其使用的空间</code>，<code>限制上传次数</code>，可以<code>指定上传的文件夹</code>,指定<code>文件格式</code>等等，并位置提供了完整的上传文档，支持<code>单文件上传</code>,<code>多文件上传</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90d55a4cd12e45f3bccb57c8a30470dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=WQI3G2nTForI1P94vE%2FWCry264g%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-14">随机图片</h4>
<p>经常会有人需要一个随机图片的API，但是受限于使用别人的不够稳定，也不够灵活，于是我们开放了一个随机API功能，你可以动态的配置，选择其绑定你需要随机的图片，比如指定随机任意文件夹，指定返回方式302重定向，或直接返回图片，你可以点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fv1.pixelpunk.cc%2Fapi%2Fv1%2Fr%2Frnd_C3wEvW5T9EjJ" target="_blank" title="https://v1.pixelpunk.cc/api/v1/r/rnd_C3wEvW5T9EjJ" ref="nofollow noopener noreferrer">pixelpunk随机图片API演示</a> ，每次刷新你可以获取新的图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d507d4f2f6947ef80c161b73337a5fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=%2FI687jhTfSy0lKAJpYJMOLzcATQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-15">空间带宽控制</h4>
<p>我们允许为用户配置限制的使用空间和流量，后台动态灵活配置这些内容，保证多用户使用的时候限制用户使用量。</p>
<h3 data-id="heading-16">更多功能</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed3904072cee4741a79777739e8ae0af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=Pf96zVJF6ve6QljPCceE3AR9VnE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92f44fb955fd48d283b89d061a5651e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=ge1kF0X3PvyAs4tLCnpOoBnTLkM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/813a5acee47f4818a667273b7ee0785e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=m2rGsoQ%2BSLy1j4aeBf7r59K5AwU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7232fbd2fa040d888643bf21fee31dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=mxt90OLx%2BeUlacgijTrk5k8aeRk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/800b0f1909c343e4b00f1b8b18b06fcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wwj-S5nQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764152147&amp;x-signature=29ECRlu6CGV5sUt9sEG2TbhLWPg%3D" alt="image.png" loading="lazy"/></p>
<p>总之我们的功能远不止如此，我们还有很多有意思的功能，一些更多的细节需要你去探索，比如，公告系统、消息通知、活动日志、限制登录、IP登录记录，超全的管理系统、埋点统计、访客系统等等模块，这是我个人第一个花费较多时间开发的一套系统，目前对比市面上所有的开源图床，自我认为是一款相对功能最全面的图床，耗费了我大量时间。</p>
<p>如果佬友花费时间看到了这里，那么希望能收获你的一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCooperJiang%2FPixelPunk" target="_blank" title="https://github.com/CooperJiang/PixelPunk" ref="nofollow noopener noreferrer">宝贵的Star</a>,后续的功能我依然会持续跌代，如果你有任何需求，可以私信我，如果合理，我可以无偿免费优先加入到后续跌代中去。</p>
<h3 data-id="heading-17">待更新预期功能</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 后端多语言适配</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> UI 美化</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Desktop 端开发</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更多格式支持 (视频|文档)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 交互体验优化</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更多渠道支持</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更多AI接入</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 图片处理工具箱</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[4.Kotlin 流程控制：强大的 when 表达式：取代 Switch]]></title>    <link>https://juejin.cn/post/7574601160981659663</link>    <guid>https://juejin.cn/post/7574601160981659663</guid>    <pubDate>2025-11-20T09:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574601160981659663" data-draft-id="7574383670436118580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="4.Kotlin 流程控制：强大的 when 表达式：取代 Switch"/> <meta itemprop="keywords" content="后端,Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-20T09:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_小雨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            4.Kotlin 流程控制：强大的 when 表达式：取代 Switch
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:42:11.000Z" title="Thu Nov 20 2025 09:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>希望帮你在Kotlin进阶路上少走弯路，在技术上稳步提升。当然，由于个人知识储备有限，笔记中难免存在疏漏或表述不当的地方，也非常欢迎大家提出宝贵意见，一起交流进步。 —— Android_小雨</p>
</blockquote>
<p>整体目录：<a href="https://juejin.cn/spost/7573592952242602036" target="_blank" title="https://juejin.cn/spost/7573592952242602036">Kotlin 进阶不迷路：41 个核心知识点，构建完整知识体系</a></p>
<h2 data-id="heading-0">一、前言</h2>
<h3 data-id="heading-1">1.1 Java Switch 的使用痛点（语法繁琐、穿透风险、类型局限）</h3>
<p>用过Java的开发者对Switch语句肯定不陌生，它是处理多分支条件判断的常用工具，但在实际使用中，诸多痛点常常让人头疼不已。首先是<strong>语法繁琐</strong>，每个分支都需要写<code>case</code>关键字定义匹配条件，还得在分支末尾加<code>break</code>语句防止穿透，哪怕是简单的返回值逻辑，也得写一堆重复的结构。比如一个根据月份获取季节的逻辑，Java Switch写法就得嵌套多层<code>case</code>和<code>break</code>。</p>
<p>其次是<strong>穿透风险</strong>，这是Switch最容易踩的坑——一旦忘记写<code>break</code>，程序就会从匹配到的分支开始，依次执行后续所有分支的代码，导致逻辑错误。而且这种错误在编译时不会报错，只能在运行时发现，排查起来十分麻烦。</p>
<p>最后是<strong>类型局限</strong>，Java 7之前的Switch仅支持byte、short、int、char等基本类型，后续虽支持String和枚举，但仍无法匹配范围、类型判断等复杂场景。比如想判断一个数字是否在某个区间，或者判断一个对象的具体类型，Switch完全无能为力，只能转而使用繁琐的if-else嵌套。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 痛点示例：根据月份获取季节</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getSeason</span><span class="hljs-params">(<span class="hljs-type">int</span> month)</span> {
    String season;
    <span class="hljs-keyword">switch</span> (month) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
            season = <span class="hljs-string">"春季"</span>;
            <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 忘记写就会穿透到夏季</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
            season = <span class="hljs-string">"夏季"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">11</span>:
            season = <span class="hljs-string">"秋季"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">12</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            season = <span class="hljs-string">"冬季"</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:
            season = <span class="hljs-string">"月份无效"</span>;
    }
    <span class="hljs-keyword">return</span> season;
}

</code></pre>
<h3 data-id="heading-2">1.2 Kotlin when 表达式的核心亮点（简洁、灵活、无穿透）</h3>
<p>Kotlin的when表达式正是为解决Java Switch的痛点而生，它不仅是对Switch的替代，更是一次全面的升级，核心亮点体现在三个方面。第一是<strong>极致简洁</strong>，摒弃了<code>case</code>和<code>break</code>关键字，直接用“匹配条件 -&gt; 执行逻辑”的结构，多值匹配用逗号分隔即可，代码量大幅减少。</p>
<p>第二是<strong>高度灵活</strong>，突破了Switch的类型局限，支持单值、多值、范围、类型、表达式等多种匹配方式，甚至可以无参数使用，实现自定义复杂条件判断。比如判断数字区间、检测对象类型、匹配表达式结果等场景，when表达式都能轻松应对。</p>
<p>第三是<strong>无穿透风险</strong>，when表达式的每个分支都是独立的，默认不会发生穿透，无需像Switch那样手动加<code>break</code>，从语法层面避免了穿透错误。同时，when还是表达式，能直接返回结果赋值给变量或作为函数返回值，进一步简化代码。</p>
<p>同样是“根据月份获取季节”，用Kotlin when表达式改写后，逻辑清晰且简洁：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 表达式示例：根据月份获取季节</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getSeason</span><span class="hljs-params">(month: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (month) {
        <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"春季"</span>
        <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span> -&gt; <span class="hljs-string">"夏季"</span>
        <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span> -&gt; <span class="hljs-string">"秋季"</span>
        <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"冬季"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"月份无效"</span>
    }
}

</code></pre>
<h3 data-id="heading-3">1.3 本文核心内容预告（基础用法→进阶场景→实用技巧）</h3>
<p>本文将从基础到进阶，全面解析Kotlin when表达式的使用方法。首先从入门级内容讲起，介绍when表达式的定义、基本语法以及与Java Switch的核心区别，帮助新手快速上手；接着深入讲解when表达式的多种灵活匹配场景，包括单值、多值、范围、类型和无参数匹配，覆盖实际开发中的常见需求；然后通过具体案例展示when表达式的实用场景，如替代多分支Switch、变量赋值、函数返回值等；最后总结when表达式的核心知识点、适用场景和避坑技巧，助力大家在开发中灵活运用，写出更简洁高效的Kotlin代码。</p>
<h2 data-id="heading-4">二、when 表达式 基础入门</h2>
<h3 data-id="heading-5">2.1 什么是 when 表达式？（Kotlin 对 Switch 的优化升级）</h3>
<p>when表达式是Kotlin中用于处理多分支条件判断的核心语法结构，是对Java Switch语句的彻底优化和升级。从本质上讲，when是一个<strong>表达式</strong>（而非语句），这意味着它会计算并返回一个结果，这个结果可以直接赋值给变量、作为函数返回值，或者嵌入到其他表达式中。</p>
<p>when表达式的核心思想是“匹配分支并执行对应逻辑”，它会依次判断当前值与各个分支的匹配条件，找到第一个匹配的分支后执行相应逻辑，并返回该分支的结果（若为代码块则返回最后一行表达式的结果），之后不再执行后续分支（无穿透）。相比Switch，when不仅语法更简洁，匹配能力也更强大，是Kotlin流程控制中不可或缺的工具。</p>
<h3 data-id="heading-6">2.2 基本语法格式（简单条件匹配 + 直接赋值示例）</h3>
<h4 data-id="heading-7">2.2.1 基本语法</h4>
<p>when表达式的基本语法有两种形式：一种是带参数的形式（最常用），用于匹配指定参数的值；另一种是无参数形式，用于自定义复杂条件判断（后续进阶部分讲解）。带参数的基本语法如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 带参数的 when 表达式</span>
<span class="hljs-keyword">when</span> (参数) {
    匹配条件<span class="hljs-number">1</span> -&gt; 执行逻辑<span class="hljs-number">1</span> <span class="hljs-comment">// 单值匹配</span>
    匹配条件<span class="hljs-number">2</span>, 匹配条件<span class="hljs-number">3</span> -&gt; 执行逻辑<span class="hljs-number">2</span> <span class="hljs-comment">// 多值匹配</span>
    匹配条件<span class="hljs-number">4.</span>.匹配条件<span class="hljs-number">5</span> -&gt; 执行逻辑<span class="hljs-number">3</span> <span class="hljs-comment">// 范围匹配（后续讲解）</span>
    <span class="hljs-keyword">is</span> 数据类型 -&gt; 执行逻辑<span class="hljs-number">4</span> <span class="hljs-comment">// 类型匹配（后续讲解）</span>
    <span class="hljs-keyword">else</span> -&gt; 默认执行逻辑 <span class="hljs-comment">// 类似 Switch 的 default，匹配所有未覆盖的情况</span>
}

</code></pre>
<p>说明：1. 匹配条件可以是常量、变量、表达式等；2. 执行逻辑若为单条语句，可直接写在箭头后，无需花括号；若为多条语句，需用花括号包裹，此时分支结果为最后一行语句的结果；3. else分支可选，但建议加上，避免遗漏未覆盖的情况（若编译器能确定所有情况都已覆盖，可省略）。</p>
<h4 data-id="heading-8">2.2.2 直接赋值示例</h4>
<p>由于when是表达式，其结果可直接赋值给变量，这是Java Switch无法做到的。比如“根据星期几获取对应的中文名称”：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> day = <span class="hljs-number">3</span> <span class="hljs-comment">// 1-7 对应周一到周日</span>

    <span class="hljs-comment">// when 表达式结果直接赋值给变量</span>
    <span class="hljs-keyword">val</span> dayName = <span class="hljs-keyword">when</span> (day) {
        <span class="hljs-number">1</span> -&gt; <span class="hljs-string">"星期一"</span>
        <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"星期二"</span>
        <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"星期三"</span>
        <span class="hljs-number">4</span> -&gt; <span class="hljs-string">"星期四"</span>
        <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"星期五"</span>
        <span class="hljs-number">6</span> -&gt; <span class="hljs-string">"星期六"</span>
        <span class="hljs-number">7</span> -&gt; <span class="hljs-string">"星期日"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"无效日期"</span>
    }

    println(<span class="hljs-string">"今天是：<span class="hljs-variable">$dayName</span>"</span>) <span class="hljs-comment">// 输出：今天是：星期三</span>
}

</code></pre>
<p>再比如执行逻辑为多条语句的场景，此时用花括号包裹，返回最后一行结果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getScoreDesc</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (score) {
        <span class="hljs-keyword">in</span> <span class="hljs-number">90.</span><span class="hljs-number">.100</span> -&gt; {
            println(<span class="hljs-string">"成绩优异"</span>)
            <span class="hljs-string">"优秀"</span> <span class="hljs-comment">// 分支结果，作为整个 when 表达式的结果</span>
        }
        <span class="hljs-keyword">in</span> <span class="hljs-number">80.</span><span class="hljs-number">.89</span> -&gt; {
            println(<span class="hljs-string">"成绩良好"</span>)
            <span class="hljs-string">"良好"</span>
        }
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"其他"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getScoreDesc(<span class="hljs-number">95</span>)) <span class="hljs-comment">// 输出：成绩优异  优秀</span>
}

</code></pre>
<h3 data-id="heading-9">2.3 与 Switch 的核心区别（无需 break、支持表达式返回值）</h3>
<p>when表达式与Java Switch相比，有多个核心区别，正是这些区别让when更简洁、更灵活、更安全：</p>
<h4 data-id="heading-10">2.3.1 无需 break，无穿透风险</h4>
<p>Java Switch的分支默认会穿透，必须在每个分支末尾加<code>break</code>才能终止执行，而when表达式的分支默认不穿透，找到第一个匹配的分支执行后就会终止，无需手动加<code>break</code>，从语法层面避免了穿透错误。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 穿透风险示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">switch</span> (num) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            System.out.println(<span class="hljs-string">"一"</span>);
            <span class="hljs-comment">// 忘记加 break，会穿透到 case 2</span>
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            System.out.println(<span class="hljs-string">"二"</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
            System.out.println(<span class="hljs-string">"三"</span>);
    }
    <span class="hljs-comment">// 输出：二  三（发生穿透）</span>
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 无穿透示例</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> num = <span class="hljs-number">2</span>
    <span class="hljs-keyword">when</span> (num) {
        <span class="hljs-number">1</span> -&gt; println(<span class="hljs-string">"一"</span>)
        <span class="hljs-number">2</span> -&gt; println(<span class="hljs-string">"二"</span>)
        <span class="hljs-number">3</span> -&gt; println(<span class="hljs-string">"三"</span>)
    }
    <span class="hljs-comment">// 输出：二（无穿透）</span>
}

</code></pre>
<h4 data-id="heading-11">2.3.2 支持表达式返回值，可直接赋值</h4>
<p>Java Switch是语句，不返回值，无法直接赋值给变量，若要实现类似逻辑，需先定义变量再在分支中赋值；而when是表达式，会返回匹配分支的结果，可直接赋值给变量或作为函数返回值，代码更简洁。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 赋值需先定义变量</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLevel</span><span class="hljs-params">(<span class="hljs-type">int</span> score)</span> {
    String level;
    <span class="hljs-keyword">switch</span> (score / <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>, <span class="hljs-number">9</span> -&gt; level = <span class="hljs-string">"A"</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span> -&gt; level = <span class="hljs-string">"B"</span>;
        <span class="hljs-keyword">default</span> -&gt; level = <span class="hljs-string">"C"</span>;
    }
    <span class="hljs-keyword">return</span> level;
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 直接赋值</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLevel</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (score / <span class="hljs-number">10</span>) {
        <span class="hljs-number">10</span>, <span class="hljs-number">9</span> -&gt; <span class="hljs-string">"A"</span>
        <span class="hljs-number">8</span> -&gt; <span class="hljs-string">"B"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"C"</span>
    }
    <span class="hljs-comment">// 更简洁的单表达式函数写法</span>
    <span class="hljs-comment">// fun getLevel(score: Int) = when (score / 10) { 10,9 -&gt; "A"; 8-&gt;"B"; else-&gt;"C" }</span>
}

</code></pre>
<h4 data-id="heading-12">2.3.3 匹配能力更强大，支持多种匹配方式</h4>
<p>Java Switch仅支持单值匹配（除了枚举和String），而when表达式支持单值、多值、范围、类型、表达式等多种匹配方式，能应对更复杂的场景（后续章节详细讲解）。</p>
<h4 data-id="heading-13">2.3.4 语法更简洁，无需 case 关键字</h4>
<p>Java Switch需要用<code>case</code>定义每个分支的匹配条件，而when直接用“匹配条件 -&gt; 执行逻辑”的结构，省去了大量冗余的<code>case</code>关键字，代码更简洁直观。</p>
<h2 data-id="heading-14">三、when 表达式 灵活匹配场景</h2>
<p>when表达式的最大优势在于其灵活的匹配能力，除了类似Switch的单值匹配，还支持多种复杂的匹配场景，覆盖实际开发中的绝大多数需求。</p>
<h3 data-id="heading-15">3.1 单值匹配（直接匹配具体数值 / 字符串）</h3>
<p>单值匹配是when最基础的用法，与Java Switch的单值匹配类似，用于匹配指定的常量值（如数值、字符串、枚举等）。匹配条件可以是字面量、常量变量或返回常量的表达式。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 字符串单值匹配</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFruitColor</span><span class="hljs-params">(fruit: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (fruit) {
        <span class="hljs-string">"苹果"</span> -&gt; <span class="hljs-string">"红色"</span>
        <span class="hljs-string">"香蕉"</span> -&gt; <span class="hljs-string">"黄色"</span>
        <span class="hljs-string">"葡萄"</span> -&gt; <span class="hljs-string">"紫色"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"未知颜色"</span>
    }
}

<span class="hljs-comment">// 枚举单值匹配</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Direction</span> { UP, DOWN, LEFT, RIGHT }
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDirectionDesc</span><span class="hljs-params">(direction: <span class="hljs-type">Direction</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (direction) {
        Direction.UP -&gt; <span class="hljs-string">"向上"</span>
        Direction.DOWN -&gt; <span class="hljs-string">"向下"</span>
        Direction.LEFT -&gt; <span class="hljs-string">"向左"</span>
        Direction.RIGHT -&gt; <span class="hljs-string">"向右"</span>
    }
    <span class="hljs-comment">// 枚举匹配可省略枚举类名（需导入或在同一作用域）</span>
    <span class="hljs-comment">// return when (direction) { UP -&gt; "向上"; DOWN -&gt; "向下"; ... }</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getFruitColor(<span class="hljs-string">"苹果"</span>)) <span class="hljs-comment">// 输出：红色</span>
    println(getDirectionDesc(Direction.LEFT)) <span class="hljs-comment">// 输出：向左</span>
}

</code></pre>
<h3 data-id="heading-16">3.2 多值匹配（用逗号分隔多个匹配条件）</h3>
<p>当多个匹配条件对应相同的执行逻辑时，可在一个分支中用逗号分隔多个匹配条件，实现“多值对应同一结果”的逻辑，无需像Java Switch那样写多个重复的<code>case</code>分支。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 多值匹配：判断是否为工作日</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isWorkDay</span><span class="hljs-params">(day: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-comment">// 1-5 对应周一到周五，都返回 true</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (day) {
        <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span> -&gt; <span class="hljs-literal">true</span>
        <span class="hljs-number">6</span>, <span class="hljs-number">7</span> -&gt; <span class="hljs-literal">false</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"无效的星期数"</span>)
    }
}

<span class="hljs-comment">// 多值匹配：根据考试等级获取奖励</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getReward</span><span class="hljs-params">(level: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (level) {
        <span class="hljs-string">"A"</span>, <span class="hljs-string">"A+"</span> -&gt; <span class="hljs-string">"500元奖学金"</span>
        <span class="hljs-string">"B"</span>, <span class="hljs-string">"B+"</span> -&gt; <span class="hljs-string">"200元奖学金"</span>
        <span class="hljs-string">"C"</span> -&gt; <span class="hljs-string">"学习用品"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"鼓励信"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(isWorkDay(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 输出：true</span>
    println(getReward(<span class="hljs-string">"A+"</span>)) <span class="hljs-comment">// 输出：500元奖学金</span>
}

</code></pre>
<h3 data-id="heading-17">3.3 范围匹配（in 关键字匹配区间）</h3>
<p>when表达式支持通过<code>in</code>关键字匹配“值是否在指定范围内”，范围可以是数值范围、字符范围等，这是Java Switch完全不具备的能力，能极大简化区间判断的逻辑。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数值范围匹配：根据分数评级</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getScoreLevel</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>)</span></span>: String {
    require(score <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.100</span>) { <span class="hljs-string">"分数必须在 0-100 之间"</span> }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (score) {
        <span class="hljs-keyword">in</span> <span class="hljs-number">90.</span><span class="hljs-number">.100</span> -&gt; <span class="hljs-string">"优秀"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-number">80.</span><span class="hljs-number">.89</span> -&gt; <span class="hljs-string">"良好"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-number">60.</span><span class="hljs-number">.79</span> -&gt; <span class="hljs-string">"及格"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"不及格"</span> <span class="hljs-comment">// 0-59 范围</span>
    }
}

<span class="hljs-comment">// 字符范围匹配：判断字符类型</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCharType</span><span class="hljs-params">(c: <span class="hljs-type">Char</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (c) {
        <span class="hljs-keyword">in</span> <span class="hljs-string">'a'</span>..<span class="hljs-string">'z'</span>, <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'Z'</span> -&gt; <span class="hljs-string">"字母"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-string">'0'</span>..<span class="hljs-string">'9'</span> -&gt; <span class="hljs-string">"数字"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"特殊字符"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getScoreLevel(<span class="hljs-number">85</span>)) <span class="hljs-comment">// 输出：良好</span>
    println(getCharType(<span class="hljs-string">'5'</span>)) <span class="hljs-comment">// 输出：数字</span>
    println(getCharType(<span class="hljs-string">'@'</span>)) <span class="hljs-comment">// 输出：特殊字符</span>
}

</code></pre>
<p>除了匹配“在范围内”，还可以用<code>!in</code>匹配“不在范围内”的情况：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// !in 匹配不在范围内的值</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkAge</span><span class="hljs-params">(age: <span class="hljs-type">Int</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (age) {
        !<span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.120</span> -&gt; <span class="hljs-string">"年龄无效"</span>
        <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span><span class="hljs-number">.17</span> -&gt; <span class="hljs-string">"未成年"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"成年"</span>
    }
}

</code></pre>
<h3 data-id="heading-18">3.4 类型匹配（is 关键字判断数据类型）</h3>
<p>when表达式支持通过<code>is</code>关键字判断变量的具体数据类型，实现“类型匹配”逻辑，且匹配成功后会自动进行类型转换（智能类型转换），无需手动强转，这在处理多类型对象时非常实用。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 类型匹配：处理不同类型的数据</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">Any</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (<span class="hljs-keyword">data</span>) {
        <span class="hljs-keyword">is</span> <span class="hljs-built_in">Int</span> -&gt; <span class="hljs-string">"整数类型，值为：<span class="hljs-variable">$data</span>"</span> <span class="hljs-comment">// 自动转换为 Int 类型</span>
        <span class="hljs-keyword">is</span> String -&gt; <span class="hljs-string">"字符串类型，长度为：<span class="hljs-subst">${data.length}</span>"</span> <span class="hljs-comment">// 自动转换为 String 类型</span>
        <span class="hljs-keyword">is</span> <span class="hljs-built_in">Double</span> -&gt; <span class="hljs-string">"浮点数类型，值为：<span class="hljs-variable">$data</span>"</span> <span class="hljs-comment">// 自动转换为 Double 类型</span>
        <span class="hljs-keyword">is</span> List&lt;*&gt; -&gt; <span class="hljs-string">"列表类型，元素个数为：<span class="hljs-subst">${data.size}</span>"</span> <span class="hljs-comment">// 自动转换为 List 类型</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"未知类型"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(handleData(<span class="hljs-number">100</span>)) <span class="hljs-comment">// 输出：整数类型，值为：100</span>
    println(handleData(<span class="hljs-string">"Kotlin"</span>)) <span class="hljs-comment">// 输出：字符串类型，长度为：6</span>
    println(handleData(listOf(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))) <span class="hljs-comment">// 输出：列表类型，元素个数为：3</span>
}

</code></pre>
<p>智能类型转换的优势在于，匹配成功后可直接调用该类型的方法和属性（如上述示例中的<code>data.length</code>、<code>data.size</code>），无需手动强转，既简洁又安全。</p>
<h3 data-id="heading-19">3.5 无参数匹配（自定义复杂条件判断）</h3>
<p>when表达式还支持无参数的形式，此时每个分支的匹配条件是一个布尔表达式，当表达式结果为true时，执行对应的逻辑。这种方式适用于需要自定义复杂条件判断的场景，相当于多个独立的if-else分支，但语法更简洁。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 无参数 when：自定义复杂条件判断（判断学生是否符合奖学金条件）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEligibleForScholarship</span><span class="hljs-params">(score: <span class="hljs-type">Int</span>, attendance: <span class="hljs-type">Double</span>, isExcellent: <span class="hljs-type">Boolean</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        <span class="hljs-comment">// 条件1：成绩优秀且出勤率≥95%</span>
        score &gt;= <span class="hljs-number">90</span> &amp;&amp; attendance &gt;= <span class="hljs-number">0.95</span> -&gt; <span class="hljs-literal">true</span>
        <span class="hljs-comment">// 条件2：成绩良好且是优秀学生</span>
        score &gt;= <span class="hljs-number">80</span> &amp;&amp; isExcellent -&gt; <span class="hljs-literal">true</span>
        <span class="hljs-comment">// 条件3：其他情况不满足</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
    }
}

<span class="hljs-comment">// 无参数 when：替代多层 if-else</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getLoginStatus</span><span class="hljs-params">(username: <span class="hljs-type">String</span>?, password: <span class="hljs-type">String</span>?)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        username.isNullOrEmpty() -&gt; <span class="hljs-string">"用户名不能为空"</span>
        password.isNullOrEmpty() -&gt; <span class="hljs-string">"密码不能为空"</span>
        username == <span class="hljs-string">"admin"</span> &amp;&amp; password == <span class="hljs-string">"123456"</span> -&gt; <span class="hljs-string">"登录成功"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"用户名或密码错误"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(isEligibleForScholarship(<span class="hljs-number">92</span>, <span class="hljs-number">0.96</span>, <span class="hljs-literal">false</span>)) <span class="hljs-comment">// 输出：true</span>
    println(getLoginStatus(<span class="hljs-string">"admin"</span>, <span class="hljs-string">""</span>)) <span class="hljs-comment">// 输出：密码不能为空</span>
}

</code></pre>
<p>无参数when的本质是“多个布尔条件的依次判断”，找到第一个结果为true的条件分支执行，适用于各分支条件无共同参数的场景，比多层if-else更简洁易读。</p>
<h2 data-id="heading-20">四、when 表达式 实用场景举例</h2>
<p>在实际开发中，when表达式的应用场景非常广泛，无论是简单的多分支判断，还是复杂的条件匹配，都能发挥其优势。下面介绍几个最常见的实用场景。</p>
<h3 data-id="heading-21">4.1 替代多分支 Switch 逻辑</h3>
<p>这是when表达式最基础的应用场景，用于替代Java中繁琐的多分支Switch逻辑，尤其适合匹配枚举、字符串、数值等场景，代码更简洁且无穿透风险。</p>
<p>示例：根据支付方式处理支付逻辑（替代Java Switch）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Switch 处理支付逻辑</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">PaymentMethod</span> { ALIPAY, WECHAT, CARD }
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">processPayment</span><span class="hljs-params">(PaymentMethod method, <span class="hljs-type">double</span> amount)</span> {
    <span class="hljs-keyword">switch</span> (method) {
        <span class="hljs-keyword">case</span> ALIPAY:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"支付宝支付 "</span> + amount + <span class="hljs-string">" 元，已完成"</span>;
        <span class="hljs-keyword">case</span> WECHAT:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"微信支付 "</span> + amount + <span class="hljs-string">" 元，已完成"</span>;
        <span class="hljs-keyword">case</span> CARD:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"银行卡支付 "</span> + amount + <span class="hljs-string">" 元，已完成"</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的支付方式"</span>);
    }
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin when 替代 Switch 处理支付逻辑</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentMethod</span> { ALIPAY, WECHAT, CARD }
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processPayment</span><span class="hljs-params">(method: <span class="hljs-type">PaymentMethod</span>, amount: <span class="hljs-type">Double</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (method) {
        PaymentMethod.ALIPAY -&gt; <span class="hljs-string">"支付宝支付 <span class="hljs-variable">$amount</span> 元，已完成"</span>
        PaymentMethod.WECHAT -&gt; <span class="hljs-string">"微信支付 <span class="hljs-variable">$amount</span> 元，已完成"</span>
        PaymentMethod.CARD -&gt; <span class="hljs-string">"银行卡支付 <span class="hljs-variable">$amount</span> 元，已完成"</span>
    }
    <span class="hljs-comment">// 省略枚举类名的写法（需导入或同一作用域）</span>
    <span class="hljs-comment">// return when (method) { ALIPAY -&gt; "..."; WECHAT -&gt; "..."; CARD -&gt; "..." }</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(processPayment(PaymentMethod.ALIPAY, <span class="hljs-number">100.0</span>))
    <span class="hljs-comment">// 输出：支付宝支付 100.0 元，已完成</span>
}

</code></pre>
<h3 data-id="heading-22">4.2 变量赋值（直接通过匹配结果赋值）</h3>
<p>由于when是表达式，其结果可直接赋值给变量，这是非常常用的场景，能替代“定义变量+多分支赋值”的繁琐写法，让变量赋值逻辑更集中、更清晰。</p>
<p>示例：根据用户等级赋值对应的权限列表</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 用户等级枚举</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLevel</span> { ADMIN, MANAGER, USER, GUEST }

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPermissions</span><span class="hljs-params">(level: <span class="hljs-type">UserLevel</span>)</span></span>: List&lt;String&gt; {
    <span class="hljs-comment">// when 表达式结果直接赋值给变量</span>
    <span class="hljs-keyword">val</span> permissions = <span class="hljs-keyword">when</span> (level) {
        UserLevel.ADMIN -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>, <span class="hljs-string">"管理"</span>)
        UserLevel.MANAGER -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>)
        UserLevel.USER -&gt; listOf(<span class="hljs-string">"查"</span>, <span class="hljs-string">"改"</span>)
        UserLevel.GUEST -&gt; listOf(<span class="hljs-string">"查"</span>)
    }
    <span class="hljs-keyword">return</span> permissions
}

<span class="hljs-comment">// 更简洁的单表达式函数写法</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPermissionsSimpler</span><span class="hljs-params">(level: <span class="hljs-type">UserLevel</span>)</span></span> = <span class="hljs-keyword">when</span> (level) {
    UserLevel.ADMIN -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>, <span class="hljs-string">"管理"</span>)
    UserLevel.MANAGER -&gt; listOf(<span class="hljs-string">"增"</span>, <span class="hljs-string">"删"</span>, <span class="hljs-string">"改"</span>, <span class="hljs-string">"查"</span>)
    UserLevel.USER -&gt; listOf(<span class="hljs-string">"查"</span>, <span class="hljs-string">"改"</span>)
    UserLevel.GUEST -&gt; listOf(<span class="hljs-string">"查"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(getPermissions(UserLevel.MANAGER))
    <span class="hljs-comment">// 输出：[增, 删, 改, 查]</span>
}

</code></pre>
<h3 data-id="heading-23">4.3 函数返回值（作为函数主体直接返回结果）</h3>
<p>when表达式可直接作为函数的返回值，此时函数可简化为单表达式函数（省略花括号和return关键字），让函数定义更简洁，尤其适合逻辑简单的工具函数。</p>
<p>示例：1. 计算图形面积（根据图形类型和参数计算）；2. 转换日期格式（将数字星期转换为中文）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 图形类型枚举</span>
<span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> { CIRCLE, RECTANGLE, SQUARE }

<span class="hljs-comment">// when 作为函数返回值（计算图形面积）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateArea</span><span class="hljs-params">(shape: <span class="hljs-type">Shape</span>, <span class="hljs-keyword">vararg</span> params: <span class="hljs-type">Double</span>)</span></span>: <span class="hljs-built_in">Double</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (shape) {
        Shape.CIRCLE -&gt; {
            <span class="hljs-keyword">val</span> radius = params[<span class="hljs-number">0</span>]
            Math.PI * radius * radius <span class="hljs-comment">// 圆的面积公式</span>
        }
        Shape.RECTANGLE -&gt; {
            <span class="hljs-keyword">val</span> width = params[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">val</span> height = params[<span class="hljs-number">1</span>]
            width * height <span class="hljs-comment">// 矩形面积公式</span>
        }
        Shape.SQUARE -&gt; {
            <span class="hljs-keyword">val</span> side = params[<span class="hljs-number">0</span>]
            side * side <span class="hljs-comment">// 正方形面积公式</span>
        }
    }
}

<span class="hljs-comment">// 单表达式函数：when 直接作为返回值</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">convertWeekToChinese</span><span class="hljs-params">(week: <span class="hljs-type">Int</span>)</span></span> = <span class="hljs-keyword">when</span> (week) {
    <span class="hljs-number">1</span> -&gt; <span class="hljs-string">"星期一"</span>
    <span class="hljs-number">2</span> -&gt; <span class="hljs-string">"星期二"</span>
    <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"星期三"</span>
    <span class="hljs-number">4</span> -&gt; <span class="hljs-string">"星期四"</span>
    <span class="hljs-number">5</span> -&gt; <span class="hljs-string">"星期五"</span>
    <span class="hljs-number">6</span> -&gt; <span class="hljs-string">"星期六"</span>
    <span class="hljs-number">7</span> -&gt; <span class="hljs-string">"星期日"</span>
    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"无效星期"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(calculateArea(Shape.CIRCLE, <span class="hljs-number">5.0</span>)) <span class="hljs-comment">// 输出：78.5398...</span>
    println(calculateArea(Shape.RECTANGLE, <span class="hljs-number">3.0</span>, <span class="hljs-number">4.0</span>)) <span class="hljs-comment">// 输出：12.0</span>
    println(convertWeekToChinese(<span class="hljs-number">5</span>)) <span class="hljs-comment">// 输出：星期五</span>
}

</code></pre>
<h3 data-id="heading-24">4.4 简化复杂条件判断（替代多层 if-else）</h3>
<p>当存在多层if-else嵌套的复杂条件判断时，用无参数when表达式可将其转换为线性分支，消除嵌套缩进，提升代码可读性。这是when表达式比if-else更有优势的场景之一。</p>
<p>示例：用户注册信息校验（多层if-else嵌套 vs 无参数when）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 多层 if-else 嵌套：校验注册信息</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkRegisterInfoOld</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>, phone: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">if</span> (username.isEmpty()) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"用户名不能为空"</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (username.length &lt; <span class="hljs-number">3</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"用户名长度不能小于3位"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (password.isEmpty()) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"密码不能为空"</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (password.length &lt; <span class="hljs-number">6</span>) {
                    <span class="hljs-keyword">return</span> <span class="hljs-string">"密码长度不能小于6位"</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (!phone.matches(<span class="hljs-string">"^1[3-9]\\d{9}$"</span>.toRegex())) {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"手机号格式错误"</span>
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">"注册信息校验通过"</span>
                    }
                }
            }
        }
    }
}

<span class="hljs-comment">// 无参数 when 简化：校验注册信息（无嵌套）</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkRegisterInfoNew</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>, phone: <span class="hljs-type">String</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
        username.isEmpty() -&gt; <span class="hljs-string">"用户名不能为空"</span>
        username.length &lt; <span class="hljs-number">3</span> -&gt; <span class="hljs-string">"用户名长度不能小于3位"</span>
        password.isEmpty() -&gt; <span class="hljs-string">"密码不能为空"</span>
        password.length &lt; <span class="hljs-number">6</span> -&gt; <span class="hljs-string">"密码长度不能小于6位"</span>
        !phone.matches(<span class="hljs-string">"^1[3-9]\\d{9}$"</span>.toRegex()) -&gt; <span class="hljs-string">"手机号格式错误"</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"注册信息校验通过"</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(checkRegisterInfoNew(<span class="hljs-string">"kotlin"</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-string">"13800138000"</span>))
    <span class="hljs-comment">// 输出：注册信息校验通过</span>
    println(checkRegisterInfoNew(<span class="hljs-string">"ko"</span>, <span class="hljs-string">"12345"</span>, <span class="hljs-string">"123456"</span>))
    <span class="hljs-comment">// 输出：用户名长度不能小于3位</span>
}

</code></pre>
<p>可以看到，无参数when将5层嵌套的if-else简化为线性分支，逻辑一目了然，后续维护和修改也更方便。</p>
<h2 data-id="heading-25">五、总结与使用建议</h2>
<h3 data-id="heading-26">5.1 核心知识点回顾（when 表达式的灵活性与优势）</h3>
<ul>
<li><strong>本质特性</strong>：when是表达式而非语句，会返回匹配分支的结果，可直接赋值给变量或作为函数返回值；默认无穿透，无需手动加break。</li>
<li><strong>核心优势</strong>：相比Java Switch，语法更简洁（无case、break）、匹配能力更强（支持单值、多值、范围、类型、无参数匹配）、更安全（无穿透风险）；相比if-else，更适合多分支场景，可消除嵌套缩进。</li>
<li><strong>关键能力</strong>：支持智能类型转换（is匹配后自动转类型）、范围匹配（in关键字）、多值匹配（逗号分隔）、无参数自定义条件匹配，覆盖多种复杂场景。</li>
</ul>
<h3 data-id="heading-27">5.2 适用场景与避坑点（何时优先用 when、避免过度复杂匹配）</h3>
<h4 data-id="heading-28">5.2.1 适用场景</h4>
<ol>
<li><strong>多分支条件判断场景</strong>：当存在3个及以上条件分支时，优先使用when，比if-else更简洁；替代Java的Switch语句（所有Switch场景都可用when替代）。</li>
<li><strong>特定匹配场景</strong>：需要进行范围匹配（如数值区间）、类型匹配（如判断对象类型）、多值匹配（多个值对应同一逻辑）的场景，when是最优选择。</li>
<li><strong>变量赋值或函数返回值场景</strong>：需要根据条件动态赋值变量，或函数逻辑为多分支判断并返回结果的场景，可利用when表达式的返回值特性简化代码。</li>
<li><strong>复杂条件嵌套场景</strong>：存在多层if-else嵌套时，用无参数when可将嵌套拉平，提升可读性。</li>
</ol>
<h4 data-id="heading-29">5.2.2 避坑点</h4>
<ul>
<li><strong>避免遗漏else分支</strong>：除了编译器能确定所有情况都已覆盖的场景（如枚举匹配），建议加上else分支处理未覆盖的情况，避免运行时异常。</li>
<li><strong>不要过度复杂单个分支</strong>：若某个分支的执行逻辑过于复杂（如包含大量循环、条件判断），应将其抽离为单独的函数，避免when表达式臃肿不堪，影响可读性。</li>
<li><strong>区分带参数与无参数场景</strong>：当各分支有共同的匹配参数时，用带参数when；当各分支条件无共同参数（为独立布尔表达式）时，用无参数when，不要混用。</li>
<li><strong>注意智能类型转换的范围</strong>：is匹配的智能类型转换仅在当前分支内有效，若需在分支外使用转换后的类型，需手动定义变量。</li>
</ul>
<h3 data-id="heading-30">5.3 代码简洁性提升技巧（简化匹配逻辑、提高可读性）</h3>
<ul>
<li><strong>利用单表达式函数简化</strong>：当函数逻辑仅为when表达式时，用单表达式函数写法（省略花括号和return），代码更简洁。例如：<code>fun getLevel(score: Int) = when (score) { ... }</code>。</li>
<li><strong>合并重复逻辑的分支</strong>：多个匹配条件对应相同逻辑时，用逗号分隔合并为一个分支，避免代码重复。例如：<code>1,2,3 -&gt; "春季"</code>。</li>
<li><strong>优先处理简单或高频分支</strong>：将简单的分支或高频匹配的分支放在前面，复杂分支放在后面，提升代码执行效率和可读性。</li>
<li><strong>用常量或枚举优化匹配条件</strong>：避免在匹配条件中写字面量（如魔法数字、魔法字符串），改用常量或枚举，提升代码可维护性。例如：用<code>UserLevel.ADMIN</code>替代<code>"admin"</code>。</li>
<li><strong>无参数when的条件排序</strong>：无参数when的分支按“异常场景→普通场景→默认场景”排序，符合日常逻辑习惯，便于理解。</li>
</ul>
<p>when表达式是Kotlin中最具代表性的语法特性之一，它的灵活性和简洁性能极大提升开发效率和代码质量。掌握when的各种匹配方式，并在合适的场景灵活运用，能让你的Kotlin代码更优雅、更易读、更易维护。建议在开发中主动用when替代Switch和复杂的if-else，逐步养成简洁的编码习惯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5.Kotlin 流程控制：循环的艺术：for 循环与区间 (Range)]]></title>    <link>https://juejin.cn/post/7574626451748945920</link>    <guid>https://juejin.cn/post/7574626451748945920</guid>    <pubDate>2025-11-20T09:43:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574626451748945920" data-draft-id="7574614157955334178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5.Kotlin 流程控制：循环的艺术：for 循环与区间 (Range)"/> <meta itemprop="keywords" content="后端,Android,Kotlin"/> <meta itemprop="datePublished" content="2025-11-20T09:43:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_小雨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5.Kotlin 流程控制：循环的艺术：for 循环与区间 (Range)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_小雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:43:54.000Z" title="Thu Nov 20 2025 09:43:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>希望帮你在Kotlin进阶路上少走弯路，在技术上稳步提升。当然，由于个人知识储备有限，笔记中难免存在疏漏或表述不当的地方，也非常欢迎大家提出宝贵意见，一起交流进步。 —— Android_小雨</p>
</blockquote>
<p>整体目录：<a href="https://juejin.cn/spost/7573592952242602036" target="_blank" title="https://juejin.cn/spost/7573592952242602036">Kotlin 进阶不迷路：41 个核心知识点，构建完整知识体系</a></p>
<h2 data-id="heading-0">一、前言</h2>
<h3 data-id="heading-1">1.1 循环在开发中的核心作用（遍历数据、重复执行逻辑）</h3>
<p>循环是编程中最基础也最核心的流程控制结构之一，几乎所有开发场景都离不开它。其核心作用主要体现在两个方面：一是<strong>遍历数据</strong>，无论是数组、列表、集合还是字符串，我们都需要通过循环逐个访问其中的元素，实现数据的读取、筛选、转换等操作，比如遍历用户列表获取所有用户名、遍历订单数据统计总金额；二是<strong>重复执行逻辑</strong>，当一段代码需要多次执行时，循环能避免冗余的重复编写，只需定义一次逻辑即可指定执行次数或执行条件，比如批量创建10个测试用户、每隔1秒打印一次系统状态等。</p>
<p>以Java中遍历1到10的循环为例，传统写法需要定义循环变量、初始值、终止条件和步长，代码略显繁琐。而Kotlin通过“for循环+区间”的组合，将循环逻辑优化得极为简洁直观，让开发者能更专注于业务逻辑而非循环结构本身。</p>
<h3 data-id="heading-2">1.2 Kotlin for 循环 + 区间的优势（简洁、直观、功能强大）</h3>
<p>Kotlin并没有沿用Java中for循环的“三段式”语法（for(int i=0; i&lt;10; i++)），而是对for循环进行了重构，使其成为一种“迭代器遍历”的语法糖，尤其与Kotlin特有的“区间（Range）”结合后，展现出三大核心优势：</p>
<ul>
<li><strong>极致简洁</strong>：无需手动定义循环变量、终止条件和步长，通过区间表达式即可快速描述循环范围，一行代码就能实现常见的遍历需求，比如遍历1到10只需“for (i in 1..10)”。</li>
<li><strong>直观易懂</strong>：区间表达式的语法贴近自然语言，“1..5”表示“从1到5的闭区间”，“1 until 5”表示“从1到5但不包含5”，“10 downTo 1”表示“从10倒序到1”，即使是新手也能一眼看懂循环范围。</li>
<li><strong>功能强大</strong>：支持正序、倒序、指定步长遍历，还能直接与数组、列表等集合配合，同时兼容字符区间等特殊场景，覆盖绝大多数循环需求。</li>
</ul>
<p>同样是遍历1到10并打印，对比Java和Kotlin的写法就能直观感受到其优势：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java 传统 for 循环</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) {
    System.out.println(i);
}

</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin for 循环 + 区间</span>
<span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
    println(i)
}

</code></pre>
<h3 data-id="heading-3">1.3 本文核心内容预告（区间基础→for 循环用法→实用场景）</h3>
<p>本文将围绕“for循环与区间”展开，采用“基础先行、用法递进、场景落地”的思路逐步讲解。首先从Kotlin区间的基础概念入手，介绍区间的定义、三种核心类型（闭区间、半开区间、倒序区间）以及步长的使用方法；接着重点讲解for循环与区间的配合用法，覆盖正序、不包含终点、倒序、指定步长等常见遍历场景，同时拓展到for循环遍历数组、列表等其他集合的用法；然后通过多个实用场景案例，展示“for循环+区间”在实际开发中的应用；最后总结核心知识点、适用场景和避坑技巧，帮助读者真正掌握这一简洁高效的循环方式。</p>
<h2 data-id="heading-4">二、先搞懂：Kotlin 区间 (Range) 基础</h2>
<h3 data-id="heading-5">2.1 什么是区间？（连续值的集合，如数字 / 字符区间）</h3>
<p>在Kotlin中，<strong>区间（Range）是一种表示“连续值集合”的数据结构</strong>，它本质上是实现了ClosedRange接口的类，用于描述从一个起始值到一个结束值的连续范围。区间中的元素必须是可比较的（实现Comparable接口），常见的区间类型包括数字区间（如IntRange、LongRange）和字符区间（CharRange），比如“1到5的数字区间”包含1、2、3、4、5五个值，“A到E的字符区间”包含A、B、C、D、E五个字符。</p>
<p>区间的核心价值在于“简化范围的描述”，它将“起始值、结束值、增减方向”等信息封装为简洁的表达式，配合for循环使用时能极大简化遍历逻辑。需要注意的是，Kotlin的区间默认是“连续且有序”的，不支持非连续的离散值范围（如1、3、5这样的奇数集合，需通过其他方式实现）。</p>
<h3 data-id="heading-6">2.2 区间的基本语法（闭区间..、半开区间 until、倒序区间 downTo）</h3>
<p>Kotlin提供了三种核心的区间定义语法，分别对应不同的遍历需求，掌握这三种语法是使用区间的基础：</p>
<h4 data-id="heading-7">2.2.1 闭区间：.. （包含起始值和结束值）</h4>
<p>用“起始值..结束值”的语法定义闭区间，表示包含起始值和结束值在内的所有连续值。这是最常用的区间类型，适用于需要遍历“从a到b（含a和b）”的场景。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数字闭区间：1到5，包含1、2、3、4、5</span>
<span class="hljs-keyword">val</span> intRange = <span class="hljs-number">1.</span><span class="hljs-number">.5</span>
<span class="hljs-comment">// 字符闭区间：'A'到'E'，包含'A'、'B'、'C'、'D'、'E'</span>
<span class="hljs-keyword">val</span> charRange = <span class="hljs-string">'A'</span>..<span class="hljs-string">'E'</span>
<span class="hljs-comment">// 长整型闭区间：100L到105L</span>
<span class="hljs-keyword">val</span> longRange = <span class="hljs-number">100L</span>..<span class="hljs-number">105L</span>

</code></pre>
<h4 data-id="heading-8">2.2.2 半开区间：until （包含起始值，不包含结束值）</h4>
<p>用“起始值 until 结束值”的语法定义半开区间，表示包含起始值但不包含结束值的连续值。这种区间类型与Java中“i &lt; 结束值”的逻辑一致，适用于避免“结束值-1”的繁琐计算场景，比如遍历数组（数组索引从0开始，到长度-1结束）。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数字半开区间：1 until 5，包含1、2、3、4（不包含5）</span>
<span class="hljs-keyword">val</span> halfOpenRange = <span class="hljs-number">1</span> until <span class="hljs-number">5</span>
<span class="hljs-comment">// 字符半开区间：'a' until 'd'，包含'a'、'b'、'c'（不包含'd'）</span>
<span class="hljs-keyword">val</span> charHalfOpenRange = <span class="hljs-string">'a'</span> until <span class="hljs-string">'d'</span>

</code></pre>
<h4 data-id="heading-9">2.2.3 倒序区间：downTo （从结束值倒序到起始值）</h4>
<p>用“结束值 downTo 起始值”的语法定义倒序区间，表示从结束值开始，倒序遍历到起始值（包含起始值和结束值）。传统循环中倒序遍历需要手动调整循环变量，而downTo语法让倒序逻辑一目了然。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 数字倒序区间：5 downTo 1，包含5、4、3、2、1</span>
<span class="hljs-keyword">val</span> reverseRange = <span class="hljs-number">5</span> downTo <span class="hljs-number">1</span>
<span class="hljs-comment">// 字符倒序区间：'E' downTo 'A'，包含'E'、'D'、'C'、'B'、'A'</span>
<span class="hljs-keyword">val</span> charReverseRange = <span class="hljs-string">'E'</span> downTo <span class="hljs-string">'A'</span>

</code></pre>
<h3 data-id="heading-10">2.3 常用区间示例（数字区间、字符区间、步长 step 用法）</h3>
<p>除了三种基础区间类型，Kotlin还支持通过“step”关键字指定区间的遍历步长（即每次递增或递减的数值），默认步长为1。步长可以是正数（正序区间）或负数（倒序区间，但通常用downTo更直观），适用于需要“跳跃式”遍历的场景。下面通过具体示例展示数字区间、字符区间和步长的用法：</p>
<h4 data-id="heading-11">2.3.1 数字区间示例</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 闭区间：1到5，步长默认1</span>
    <span class="hljs-keyword">val</span> closedRange = <span class="hljs-number">1.</span><span class="hljs-number">.5</span>
    println(<span class="hljs-string">"闭区间 1..5：<span class="hljs-subst">${closedRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：闭区间 1..5：[1, 2, 3, 4, 5]</span>

    <span class="hljs-comment">// 2. 半开区间：1到5（不含5），步长默认1</span>
    <span class="hljs-keyword">val</span> halfOpenRange = <span class="hljs-number">1</span> until <span class="hljs-number">5</span>
    println(<span class="hljs-string">"半开区间 1 until 5：<span class="hljs-subst">${halfOpenRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：半开区间 1 until 5：[1, 2, 3, 4]</span>

    <span class="hljs-comment">// 3. 倒序区间：5到1，步长默认1</span>
    <span class="hljs-keyword">val</span> reverseRange = <span class="hljs-number">5</span> downTo <span class="hljs-number">1</span>
    println(<span class="hljs-string">"倒序区间 5 downTo 1：<span class="hljs-subst">${reverseRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：倒序区间 5 downTo 1：[5, 4, 3, 2, 1]</span>

    <span class="hljs-comment">// 4. 指定步长的正序区间：1到10，步长2（只取奇数）</span>
    <span class="hljs-keyword">val</span> stepRange = <span class="hljs-number">1.</span><span class="hljs-number">.10</span> step <span class="hljs-number">2</span>
    println(<span class="hljs-string">"步长2的正序区间：<span class="hljs-subst">${stepRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：步长2的正序区间：[1, 3, 5, 7, 9]</span>

    <span class="hljs-comment">// 5. 指定步长的倒序区间：10到1，步长3</span>
    <span class="hljs-keyword">val</span> reverseStepRange = <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span> step <span class="hljs-number">3</span>
    println(<span class="hljs-string">"步长3的倒序区间：<span class="hljs-subst">${reverseStepRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：步长3的倒序区间：[10, 7, 4, 1]</span>
}

</code></pre>
<h4 data-id="heading-12">2.3.2 字符区间示例</h4>
<p>字符区间基于字符的ASCII码值进行排序，支持正序、倒序和步长遍历，适用于需要遍历字母表等场景：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 正序字符闭区间：'a'到'e'</span>
    <span class="hljs-keyword">val</span> lowerCharRange = <span class="hljs-string">'a'</span>..<span class="hljs-string">'e'</span>
    println(<span class="hljs-string">"小写字母区间：<span class="hljs-subst">${lowerCharRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：小写字母区间：[a, b, c, d, e]</span>

    <span class="hljs-comment">// 2. 倒序字符区间：'Z'到'W'</span>
    <span class="hljs-keyword">val</span> upperReverseRange = <span class="hljs-string">'Z'</span> downTo <span class="hljs-string">'W'</span>
    println(<span class="hljs-string">"倒序大写字母区间：<span class="hljs-subst">${upperReverseRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：倒序大写字母区间：[Z, Y, X, W]</span>

    <span class="hljs-comment">// 3. 指定步长的字符区间：'A'到'I'，步长2（取A、C、E、G、I）</span>
    <span class="hljs-keyword">val</span> charStepRange = <span class="hljs-string">'A'</span>..<span class="hljs-string">'I'</span> step <span class="hljs-number">2</span>
    println(<span class="hljs-string">"步长2的字符区间：<span class="hljs-subst">${charStepRange.toList()}</span>"</span>) <span class="hljs-comment">// 输出：步长2的字符区间：[A, C, E, G, I]</span>
}

</code></pre>
<h4 data-id="heading-13">2.3.3 步长使用注意事项</h4>
<p>步长的使用虽然灵活，但有两个关键点需要注意：一是<strong>步长不能为0</strong>，否则会导致无限循环，Kotlin编译器会直接报错；二是<strong>倒序区间建议用downTo配合正步长</strong>，而非用正序区间配合负步长（虽然语法允许，但可读性极差）。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 错误示例：步长为0，编译报错</span>
    <span class="hljs-comment">// val errorRange = 1..5 step 0</span>

    <span class="hljs-comment">// 不推荐：正序区间配合负步长（可读性差）</span>
    <span class="hljs-keyword">val</span> notRecommended = <span class="hljs-number">5.</span><span class="hljs-number">.1</span> step -<span class="hljs-number">1</span>
    println(notRecommended.toList()) <span class="hljs-comment">// 输出：[5, 4, 3, 2, 1]</span>

    <span class="hljs-comment">// 推荐：用downTo定义倒序区间，配合正步长（可读性高）</span>
    <span class="hljs-keyword">val</span> recommended = <span class="hljs-number">5</span> downTo <span class="hljs-number">1</span> step <span class="hljs-number">1</span>
    println(recommended.toList()) <span class="hljs-comment">// 输出：[5, 4, 3, 2, 1]</span>
}

</code></pre>
<h2 data-id="heading-14">三、Kotlin for 循环：与区间的完美配合</h2>
<h3 data-id="heading-15">3.1 for 循环的基本语法（遍历区间的简洁写法）</h3>
<p>Kotlin的for循环摒弃了Java中“三段式”的复杂语法，采用“for (元素变量 in 可迭代对象)”的简洁形式，其中“可迭代对象”可以是区间、数组、列表、集合等实现了Iterable接口的类型。当可迭代对象是区间时，for循环会逐个遍历区间中的元素，语法如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// for 循环遍历区间的基本语法</span>
<span class="hljs-keyword">for</span> (element <span class="hljs-keyword">in</span> 区间表达式) {
    <span class="hljs-comment">// 循环体：element 为当前遍历到的区间元素</span>
    执行逻辑
}

</code></pre>
<p>这种语法的优势在于“聚焦元素本身”，无需关注循环变量的初始化、终止条件和步长调整（区间已封装这些信息），比如遍历1到5并打印每个元素，只需一行循环头即可实现：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 遍历1到5的闭区间，打印每个元素</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$i</span> "</span>) <span class="hljs-comment">// 输出：1 2 3 4 5</span>
    }
}

</code></pre>
<h3 data-id="heading-16">3.2 遍历常见区间场景</h3>
<p>结合上一章讲解的三种区间类型和步长用法，for循环与区间配合可实现多种常见的遍历场景，下面分别介绍并给出示例。</p>
<h4 data-id="heading-17">3.2.1 正序遍历（如 1..5 遍历 1-5）</h4>
<p>正序遍历是最基础的场景，使用闭区间“起始值..结束值”即可，默认步长为1，适用于需要从起始值到结束值依次遍历的场景，比如打印1到10的数字、遍历字母表等。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：打印1到10的正整数</span>
    println(<span class="hljs-string">"1到10的正整数："</span>)
    <span class="hljs-keyword">for</span> (num <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$num</span> "</span>) <span class="hljs-comment">// 输出：1 2 3 4 5 6 7 8 9 10</span>
    }
    println()

    <span class="hljs-comment">// 场景2：打印A到F的大写字母</span>
    println(<span class="hljs-string">"A到F的大写字母："</span>)
    <span class="hljs-keyword">for</span> (char <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'F'</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$char</span> "</span>) <span class="hljs-comment">// 输出：A B C D E F</span>
    }
}

</code></pre>
<h4 data-id="heading-18">3.2.2 不包含终点遍历（until 关键字）</h4>
<p>当需要遍历“从起始值到结束值，但不包含结束值”时，使用半开区间“起始值 until 结束值”，这种场景在遍历数组、列表等索引从0开始的集合时尤为常用，能避免“索引越界”的风险。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：遍历0到4（不包含5），模拟数组索引</span>
    <span class="hljs-keyword">val</span> array = arrayOf(<span class="hljs-string">"Kotlin"</span>, <span class="hljs-string">"Java"</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-string">"Go"</span>, <span class="hljs-string">"Swift"</span>)
    println(<span class="hljs-string">"数组元素："</span>)
    <span class="hljs-comment">// 数组长度为5，索引范围0-4，用until避免索引越界</span>
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until array.size) {
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-subst">${array[index]}</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引0：Kotlin</span>
    <span class="hljs-comment">// 索引1：Java</span>
    <span class="hljs-comment">// 索引2：Python</span>
    <span class="hljs-comment">// 索引3：Go</span>
    <span class="hljs-comment">// 索引4：Swift</span>

    <span class="hljs-comment">// 场景2：打印1到9（不包含10）的数字</span>
    println(<span class="hljs-string">"1到9的数字："</span>)
    <span class="hljs-keyword">for</span> (num <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> until <span class="hljs-number">10</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$num</span> "</span>) <span class="hljs-comment">// 输出：1 2 3 4 5 6 7 8 9</span>
    }
}

</code></pre>
<h4 data-id="heading-19">3.2.3 倒序遍历（downTo 关键字）</h4>
<p>倒序遍历使用“结束值 downTo 起始值”的倒序区间，适用于需要从大到小遍历的场景，比如倒计时、逆序打印数据等。相比传统循环的倒序写法，downTo语法更直观。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：倒计时（10到1）</span>
    println(<span class="hljs-string">"倒计时开始："</span>)
    <span class="hljs-keyword">for</span> (count <span class="hljs-keyword">in</span> <span class="hljs-number">10</span> downTo <span class="hljs-number">1</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$count</span> "</span>)
        Thread.sleep(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 模拟延迟1秒</span>
    }
    println(<span class="hljs-string">"！倒计时结束"</span>) <span class="hljs-comment">// 输出：10 9 8 7 6 5 4 3 2 1 ！倒计时结束</span>

    <span class="hljs-comment">// 场景2：逆序打印数组元素</span>
    <span class="hljs-keyword">val</span> numbers = arrayOf(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>)
    println(<span class="hljs-string">"数组逆序元素："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> numbers.size - <span class="hljs-number">1</span> downTo <span class="hljs-number">0</span>) {
        print(<span class="hljs-string">"<span class="hljs-subst">${numbers[index]}</span> "</span>) <span class="hljs-comment">// 输出：50 40 30 20 10</span>
    }
}

</code></pre>
<h4 data-id="heading-20">3.2.4 指定步长遍历（step 控制间隔）</h4>
<p>当需要“跳跃式”遍历区间时，在区间表达式后加上“step 步长值”即可，适用于只需要遍历区间中部分元素的场景，比如遍历奇数、偶数，或每隔n个元素处理一次。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 场景1：遍历1到20的偶数（步长2，起始值为2）</span>
    println(<span class="hljs-string">"1到20的偶数："</span>)
    <span class="hljs-keyword">for</span> (even <span class="hljs-keyword">in</span> <span class="hljs-number">2.</span><span class="hljs-number">.20</span> step <span class="hljs-number">2</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$even</span> "</span>) <span class="hljs-comment">// 输出：2 4 6 8 10 12 14 16 18 20</span>
    }
    println()

    <span class="hljs-comment">// 场景2：遍历100到50的整十数（倒序，步长10）</span>
    println(<span class="hljs-string">"100到50的整十数："</span>)
    <span class="hljs-keyword">for</span> (ten <span class="hljs-keyword">in</span> <span class="hljs-number">100</span> downTo <span class="hljs-number">50</span> step <span class="hljs-number">10</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$ten</span> "</span>) <span class="hljs-comment">// 输出：100 90 80 70 60 50</span>
    }
    println()

    <span class="hljs-comment">// 场景3：每隔3个字母打印一次（A到Z，步长3）</span>
    println(<span class="hljs-string">"A到Z每隔3个字母："</span>)
    <span class="hljs-keyword">for</span> (char <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'Z'</span> step <span class="hljs-number">3</span>) {
        print(<span class="hljs-string">"<span class="hljs-variable">$char</span> "</span>) <span class="hljs-comment">// 输出：A D G J M P S V Y</span>
    }
}

</code></pre>
<h3 data-id="heading-21">3.3 for 循环遍历其他集合（结合区间思想遍历数组、列表）</h3>
<p>虽然Kotlin的for循环与区间配合极为默契，但它并非只能遍历区间。实际上，for循环可以遍历所有实现了Iterable接口的集合（如数组、List、Set等），其核心思想与遍历区间一致——“逐个访问集合中的元素”。下面介绍两种常见的集合遍历场景：直接遍历元素和通过索引遍历元素（结合区间思想）。</p>
<h4 data-id="heading-22">3.3.1 直接遍历集合元素</h4>
<p>对于数组、List等集合，for循环可以直接遍历其中的元素，无需通过索引，语法为“for (元素 in 集合)”，这种方式最简洁，适用于不需要关注元素索引的场景。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 遍历数组元素</span>
    <span class="hljs-keyword">val</span> fruits = arrayOf(<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"葡萄"</span>, <span class="hljs-string">"橙子"</span>)
    println(<span class="hljs-string">"水果数组："</span>)
    <span class="hljs-keyword">for</span> (fruit <span class="hljs-keyword">in</span> fruits) {
        println(<span class="hljs-string">"水果：<span class="hljs-variable">$fruit</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 水果：苹果</span>
    <span class="hljs-comment">// 水果：香蕉</span>
    <span class="hljs-comment">// 水果：葡萄</span>
    <span class="hljs-comment">// 水果：橙子</span>

    <span class="hljs-comment">// 2. 遍历List元素</span>
    <span class="hljs-keyword">val</span> scores = listOf(<span class="hljs-number">85</span>, <span class="hljs-number">92</span>, <span class="hljs-number">78</span>, <span class="hljs-number">95</span>, <span class="hljs-number">88</span>)
    println(<span class="hljs-string">"成绩列表："</span>)
    <span class="hljs-keyword">var</span> total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> (score <span class="hljs-keyword">in</span> scores) {
        total += score
    }
    println(<span class="hljs-string">"总成绩：<span class="hljs-variable">$total</span>，平均分：<span class="hljs-subst">${total / scores.size}</span>"</span>) <span class="hljs-comment">// 输出：总成绩：438，平均分：87</span>
}

</code></pre>
<h4 data-id="heading-23">3.3.2 通过索引遍历集合元素（结合区间）</h4>
<p>当需要同时获取元素的索引和值时，可以结合区间思想，通过“0 until 集合.size”的半开区间遍历索引，再通过索引获取元素。这种方式类似于Java中的“for循环遍历索引”，但语法更简洁。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 遍历数组：同时获取索引和元素</span>
    <span class="hljs-keyword">val</span> colors = arrayOf(<span class="hljs-string">"红色"</span>, <span class="hljs-string">"绿色"</span>, <span class="hljs-string">"蓝色"</span>, <span class="hljs-string">"黄色"</span>)
    println(<span class="hljs-string">"颜色数组（索引-值）："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until colors.size) {
        <span class="hljs-keyword">val</span> color = colors[index]
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-variable">$color</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引0：红色</span>
    <span class="hljs-comment">// 索引1：绿色</span>
    <span class="hljs-comment">// 索引2：蓝色</span>
    <span class="hljs-comment">// 索引3：黄色</span>

    <span class="hljs-comment">// 遍历List：倒序获取索引和元素</span>
    <span class="hljs-keyword">val</span> names = listOf(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-string">"王五"</span>)
    println(<span class="hljs-string">"姓名列表（逆序索引-值）："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> names.size - <span class="hljs-number">1</span> downTo <span class="hljs-number">0</span>) {
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-subst">${names[index]}</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引2：王五</span>
    <span class="hljs-comment">// 索引1：李四</span>
    <span class="hljs-comment">// 索引0：张三</span>
}

</code></pre>
<p>此外，Kotlin还提供了“withIndex()”方法，可直接获取包含索引和值的Pair对象，进一步简化“索引+值”的遍历逻辑：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> languages = listOf(<span class="hljs-string">"Kotlin"</span>, <span class="hljs-string">"Java"</span>, <span class="hljs-string">"Python"</span>)
    <span class="hljs-keyword">for</span> ((index, lang) <span class="hljs-keyword">in</span> languages.withIndex()) {
        println(<span class="hljs-string">"索引<span class="hljs-variable">$index</span>：<span class="hljs-variable">$lang</span>"</span>)
    }
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 索引0：Kotlin</span>
    <span class="hljs-comment">// 索引1：Java</span>
    <span class="hljs-comment">// 索引2：Python</span>
}

</code></pre>
<h2 data-id="heading-24">四、for 循环 + 区间 实用场景举例</h2>
<p>“for循环+区间”的组合在实际开发中应用广泛，无论是简单的数字遍历，还是复杂的业务数据处理，都能发挥其简洁高效的优势。下面通过四个常见的实用场景，展示其在开发中的具体应用。</p>
<h3 data-id="heading-25">4.1 数字遍历（如循环打印 1-10）</h3>
<p>数字遍历是最基础的场景，常用于打印连续数字、生成连续数据、计数等需求。下面以“生成1到100的奇数并计算总和”为例，展示数字遍历的应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 场景：生成1到100的奇数，打印并计算总和
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateOddNumbers</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> oddList = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;()
    <span class="hljs-keyword">var</span> total = <span class="hljs-number">0</span>
    <span class="hljs-comment">// 遍历1到100，步长2，获取所有奇数</span>
    <span class="hljs-keyword">for</span> (num <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.100</span> step <span class="hljs-number">2</span>) {
        oddList.add(num)
        total += num
    }
    println(<span class="hljs-string">"1到100的奇数共有<span class="hljs-subst">${oddList.size}</span>个："</span>)
    println(oddList.take(<span class="hljs-number">10</span>).joinToString(<span class="hljs-string">", "</span>) + <span class="hljs-string">"..."</span> + oddList.takeLast(<span class="hljs-number">10</span>).joinToString(<span class="hljs-string">", "</span>))
    println(<span class="hljs-string">"1到100的奇数总和：<span class="hljs-variable">$total</span>"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    generateOddNumbers()
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 1到100的奇数共有50个：</span>
    <span class="hljs-comment">// 1, 3, 5, 7, 9, 11, 13, 15, 17, 19...81, 83, 85, 87, 89, 91, 93, 95, 97, 99</span>
    <span class="hljs-comment">// 1到100的奇数总和：2500</span>
}

</code></pre>
<h3 data-id="heading-26">4.2 字符遍历（如循环打印 A-Z）</h3>
<p>字符遍历常用于生成字母表、字符编码转换、批量生成字符串等场景。下面以“生成A-Z的大写字母和对应的ASCII码”为例，展示字符遍历的应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 场景：生成A-Z的大写字母，打印字母及对应的ASCII码
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printCharAndAscii</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"大写字母 | ASCII码"</span>)
    println(<span class="hljs-string">"--------|--------"</span>)
    <span class="hljs-comment">// 遍历'A'到'Z'的字符区间</span>
    <span class="hljs-keyword">for</span> (char <span class="hljs-keyword">in</span> <span class="hljs-string">'A'</span>..<span class="hljs-string">'Z'</span>) {
        <span class="hljs-keyword">val</span> ascii = char.toInt() <span class="hljs-comment">// 获取字符的ASCII码</span>
        println(<span class="hljs-string">"<span class="hljs-variable">$char</span>        | <span class="hljs-variable">$ascii</span>"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    printCharAndAscii()
    <span class="hljs-comment">// 输出（部分）：</span>
    <span class="hljs-comment">// 大写字母 | ASCII码</span>
    <span class="hljs-comment">// --------|--------</span>
    <span class="hljs-comment">// A        | 65</span>
    <span class="hljs-comment">// B        | 66</span>
    <span class="hljs-comment">// C        | 67</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// Z        | 90</span>
}

</code></pre>
<h3 data-id="heading-27">4.3 集合遍历（如遍历列表、数组）</h3>
<p>集合遍历是开发中最常用的场景之一，常用于数据筛选、转换、统计等操作。下面以“遍历学生列表，筛选出成绩≥90分的优秀学生并排序”为例，展示集合遍历的应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义学生数据类</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> score: <span class="hljs-built_in">Int</span>)

<span class="hljs-comment">/**
 * 场景：遍历学生列表，筛选优秀学生并排序
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">filterExcellentStudents</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 模拟学生列表数据</span>
    <span class="hljs-keyword">val</span> students = listOf(
        Student(<span class="hljs-string">"张三"</span>, <span class="hljs-number">85</span>),
        Student(<span class="hljs-string">"李四"</span>, <span class="hljs-number">92</span>),
        Student(<span class="hljs-string">"王五"</span>, <span class="hljs-number">78</span>),
        Student(<span class="hljs-string">"赵六"</span>, <span class="hljs-number">95</span>),
        Student(<span class="hljs-string">"钱七"</span>, <span class="hljs-number">88</span>),
        Student(<span class="hljs-string">"孙八"</span>, <span class="hljs-number">90</span>)
    )

    <span class="hljs-keyword">val</span> excellentStudents = mutableListOf&lt;Student&gt;()
    <span class="hljs-comment">// 遍历学生列表，筛选成绩≥90分的学生</span>
    <span class="hljs-keyword">for</span> (student <span class="hljs-keyword">in</span> students) {
        <span class="hljs-keyword">if</span> (student.score &gt;= <span class="hljs-number">90</span>) {
            excellentStudents.add(student)
        }
    }

    <span class="hljs-comment">// 按成绩降序排序（通过索引遍历排序后的列表）</span>
    <span class="hljs-keyword">val</span> sortedStudents = excellentStudents.sortedByDescending { it.score }
    println(<span class="hljs-string">"优秀学生列表（成绩≥90分，按成绩降序）："</span>)
    <span class="hljs-keyword">for</span> (index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until sortedStudents.size) {
        <span class="hljs-keyword">val</span> student = sortedStudents[index]
        println(<span class="hljs-string">"第<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>名：<span class="hljs-subst">${student.name}</span>，成绩：<span class="hljs-subst">${student.score}</span>"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    filterExcellentStudents()
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// 优秀学生列表（成绩≥90分，按成绩降序）：</span>
    <span class="hljs-comment">// 第1名：赵六，成绩：95</span>
    <span class="hljs-comment">// 第2名：李四，成绩：92</span>
    <span class="hljs-comment">// 第3名：孙八，成绩：90</span>
}

</code></pre>
<h3 data-id="heading-28">4.4 简单业务场景（如计数、批量处理数据）</h3>
<p>在实际业务中，“for循环+区间”可用于批量处理数据、计数统计、生成测试数据等场景。下面以“批量生成10个测试用户并统计男性用户数量”为例，展示其业务应用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义用户数据类</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> id: <span class="hljs-built_in">Int</span>, <span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> gender: String)

<span class="hljs-comment">/**
 * 场景：批量生成10个测试用户，统计男性用户数量
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateTestUsers</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> users = mutableListOf&lt;User&gt;()
    <span class="hljs-keyword">var</span> maleCount = <span class="hljs-number">0</span>
    <span class="hljs-comment">// 遍历1到10的区间，生成10个用户</span>
    <span class="hljs-keyword">for</span> (id <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
        <span class="hljs-keyword">val</span> name = <span class="hljs-string">"测试用户<span class="hljs-variable">$id</span>"</span>
        <span class="hljs-comment">// 奇数ID为男性，偶数ID为女性</span>
        <span class="hljs-keyword">val</span> gender = <span class="hljs-keyword">if</span> (id % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>) <span class="hljs-string">"男"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"女"</span>
        <span class="hljs-keyword">val</span> user = User(id, name, gender)
        users.add(user)
        <span class="hljs-comment">// 统计男性用户数量</span>
        <span class="hljs-keyword">if</span> (gender == <span class="hljs-string">"男"</span>) {
            maleCount++
        }
    }

    <span class="hljs-comment">// 打印所有用户信息</span>
    println(<span class="hljs-string">"批量生成的10个测试用户："</span>)
    <span class="hljs-keyword">for</span> (user <span class="hljs-keyword">in</span> users) {
        println(<span class="hljs-string">"ID：<span class="hljs-subst">${user.id}</span>，姓名：<span class="hljs-subst">${user.name}</span>，性别：<span class="hljs-subst">${user.gender}</span>"</span>)
    }
    println(<span class="hljs-string">"男性用户数量：<span class="hljs-variable">$maleCount</span>，女性用户数量：<span class="hljs-subst">${users.size - maleCount}</span>"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    generateTestUsers()
    <span class="hljs-comment">// 输出（部分）：</span>
    <span class="hljs-comment">// 批量生成的10个测试用户：</span>
    <span class="hljs-comment">// ID：1，姓名：测试用户1，性别：男</span>
    <span class="hljs-comment">// ID：2，姓名：测试用户2，性别：女</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">// ID：10，姓名：测试用户10，性别：女</span>
    <span class="hljs-comment">// 男性用户数量：5，女性用户数量：5</span>
}

</code></pre>
<h2 data-id="heading-29">五、总结与使用建议</h2>
<h3 data-id="heading-30">5.1 核心知识点回顾（区间类型、for 循环遍历方式）</h3>
<ul>
<li><strong>区间核心知识点</strong>：区间是连续值的集合，支持三种类型——闭区间（..，包含首尾）、半开区间（until，包含首不包含尾）、倒序区间（downTo，从尾到首）；可通过step指定步长（默认1，不能为0），支持数字和字符区间。</li>
<li><strong>for循环核心知识点</strong>：采用“for (元素 in 可迭代对象)”的简洁语法，可遍历区间、数组、列表等集合；遍历区间时无需关注循环变量细节，聚焦元素本身；遍历集合时支持直接遍历元素或通过索引遍历（结合区间）。</li>
<li><strong>组合优势</strong>：“for循环+区间”实现了循环逻辑的极致简化，将“范围描述”与“遍历执行”完美结合，语法直观、可读性高，覆盖绝大多数循环场景。</li>
</ul>
<h3 data-id="heading-31">5.2 适用场景与避坑点（何时用哪种区间、步长注意事项）</h3>
<h4 data-id="heading-32">5.2.1 适用场景与区间选择</h4>
<ol>
<li><strong>正序遍历且包含首尾值</strong>：选择闭区间“a..b”，如遍历1到10的所有数字。</li>
<li><strong>正序遍历且不包含尾值</strong>：选择半开区间“a until b”，如遍历数组索引（0 until 数组.size）。</li>
<li><strong>倒序遍历</strong>：选择倒序区间“b downTo a”，如倒计时、逆序打印数据。</li>
<li><strong>跳跃式遍历</strong>：在上述区间基础上添加“step 步长”，如遍历奇数（1..100 step 2）。</li>
<li><strong>集合遍历</strong>：直接遍历元素用“for (元素 in 集合)”；需要索引用“for (index in 0 until 集合.size)”或“for ((index, 元素) in 集合.withIndex())”。</li>
</ol>
<h4 data-id="heading-33">5.2.2 避坑点</h4>
<ul>
<li><strong>步长不可为0</strong>：步长为0会导致无限循环，编译器会直接报错，务必确保步长为非0整数。</li>
<li><strong>倒序遍历避免负步长</strong>：倒序遍历推荐用“downTo”配合正步长，而非正序区间配合负步长，提升代码可读性。</li>
<li><strong>字符区间注意ASCII码顺序</strong>：字符区间基于ASCII码排序，大写字母ASCII码小于小写字母（如'A'..'z'会包含其他字符），需谨慎使用跨大小写的字符区间。</li>
<li><strong>区间不可直接用于非连续值</strong>：区间仅支持连续值，若需遍历非连续值（如1、3、5、7），可通过步长实现，或使用集合存储非连续值后遍历。</li>
</ul>
<h3 data-id="heading-34">5.3 代码简洁性技巧（用区间简化循环逻辑）</h3>
<ul>
<li><strong>替代传统计数循环</strong>：摒弃Java“三段式”循环，所有计数循环都用“for (i in 区间)”实现，如“for (i in 1..10)”替代“for (int i=1; i&lt;=10; i++)”。</li>
<li><strong>利用区间生成集合</strong>：通过“区间.toList()”快速生成连续值集合，如“(1..5).toList()”生成[1,2,3,4,5]，避免手动添加元素。</li>
<li><strong>结合集合函数简化逻辑</strong>：遍历集合时，若需筛选、转换数据，可结合Kotlin集合函数（如filter、map），减少for循环内的复杂逻辑。例如，筛选成绩≥90的学生可简化为“students.filter { it.score ≥ 90 }”。</li>
<li><strong>单语句循环省略花括号</strong>：若循环体仅包含一条语句，可省略花括号，进一步简化代码，如“for (i in 1..5) print(i)”。</li>
</ul>
<p>Kotlin的“for循环+区间”是对传统循环语法的一次重要优化，其核心在于“用简洁的语法描述复杂的循环范围”，让开发者能更专注于业务逻辑。掌握区间的三种类型、步长的使用以及for循环与不同可迭代对象的配合，能极大提升代码的简洁性和可读性。建议在开发中主动摒弃传统的“三段式”循环思维，多用“for循环+区间”的组合，逐步养成Kotlin式的简洁编码习惯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI概念解惑系列 - RAG]]></title>    <link>https://juejin.cn/post/7573950036897202216</link>    <guid>https://juejin.cn/post/7573950036897202216</guid>    <pubDate>2025-11-19T04:26:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573950036897202216" data-draft-id="7574204970774659099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI概念解惑系列 - RAG"/> <meta itemprop="keywords" content="前端,AIGC,LLM"/> <meta itemprop="datePublished" content="2025-11-19T04:26:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="酥风"/> <meta itemprop="url" content="https://juejin.cn/user/4388906148064231"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI概念解惑系列 - RAG
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906148064231/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    酥风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T04:26:09.000Z" title="Wed Nov 19 2025 04:26:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    87
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文发布于掘金，转载请声明</p>
</blockquote>
<p>随着最近几年AI在各个领域大放异彩，作为一个前端开发，我也对AI里的各种技术概念产生了浓厚的兴趣，希望能详细了解这些技术概念和背后的原理后，找寻和前端结合的一些思路。今天我们就来一起了解下AI领域常用到的一个技术——<strong>RAG（Retrieval-Augmented Generation）</strong>，检索增强生成。</p>
<h2 data-id="heading-0">一、 开始之前</h2>
<p>在开始介绍RAG之前，我们先来简单回顾一下大语言模型LLM的原理。</p>
<p>LLM通过预训练，让模型学习了全网公开的知识（网页、书籍、论文、代码等等），得到一堆“参数”，之后根据用户的输入来不断地预测下一个token应该是什么，最终得到输出。</p>
<p>这种训练好的模型，在通用领域有着比较好的表现。但是根据LLM的原理，我们也能发现它的一些不足：</p>
<ul>
<li>“<strong>预训练</strong>”：由于是使用了旧的数据进行的训练，对于在训练之后产生新信息，LLM无法回答</li>
<li>“<strong>公开的知识</strong>”：LLM使用了公开的知识训练，对于一些非公开的内容，或者专业数据，LLM同样无法回答</li>
<li>“<strong>预测</strong>”：因为LLM本质上是一个“看前文、猜下文”的大规模统计生成器，所以对于它不知道的信息，在回答时往往会“胡说八道”，也就是常说的Hallucination，“<strong>幻觉</strong>”</li>
</ul>
<p>对于普通用户一些不要求实时性的通用性问题来说，上面这些不是什么大问题，但是一旦涉及到<strong>实时性、专业数据、企业内私有数据</strong>时，上面的问题就会严重影响用户体验。</p>
<p>为了解决这些问题，通常有下面两个手段：</p>
<ol>
<li>微调大模型</li>
<li>手动给LLM添加额外知识，即外挂知识库</li>
</ol>
<h2 data-id="heading-1">二、 微调 vs 外挂知识库</h2>
<h3 data-id="heading-2">1. 微调Fine-tuning</h3>
<p>所谓<strong>微调（Fine-tuning）</strong>，就是在预训练模型的基础上，使用特定任务的数据（如私有数据、专业领域知识、最新的信息等）进行进一步训练，让模型在特定领域表现更好。</p>
<p>举个比较形象的例子，通过预训练得到的大模型，就是学习了小学到高中的通识教育的知识，学会语言、数学、常识、逻辑思维，知识面广但不够专业。</p>
<p>而微调阶段（Fine-tuning）类似于专业教育，就好像学习了专业领域课程、成为某个领域的专家。</p>
<p>即“<strong>通用模型 + 专业数据 + 针对性训练 = 专业模型</strong>”：</p>
<ul>
<li>GPT + 代码数据 + 代码任务训练 = CodeGPT</li>
<li>GPT + 医学数据 + 医学任务训练 = MedicalGPT</li>
<li>GPT + 法律数据 + 法律任务训练 = LegalGPT</li>
</ul>
<h3 data-id="heading-3">2. 外挂知识库</h3>
<p>在和LLM交互时，我们可以通过一些特殊手段，从外部知识库检索相关信息提供给LLM，相当于给AI配个"外挂知识库"，让它可以获取到专业领域知识、私有数据、实时信息等等。</p>
<p>而RAG就是比较常用的手段。</p>
<h3 data-id="heading-4">3. 对比</h3>
<p>对比这两个不难发现，微调是内化知识到了模型参数中，最终的效果肯定是稍微好一些的。</p>
<p>但是考虑到微调下面这些点：</p>
<ul>
<li>需要<strong>大量的标注训练数据</strong>（需要对文档等进行数据清洗、标注等）</li>
<li><strong>较高的训练成本</strong>（比如训练需要较高的算力，有不小的经济成本和时间成本）</li>
<li><strong>较高的实现难度</strong>（需要AI领域的专业知识）</li>
<li><strong>无法保持数据是最新的</strong>（内化的知识需要重新训练才能更新）</li>
</ul>
<p>对于个人或者中小型企业来说，通过RAG外挂知识库是一个更合适的选择：</p>
<ul>
<li>只需要<strong>结构化的文档</strong></li>
<li><strong>不需要训练</strong></li>
<li><strong>较低的实现难度</strong>（大多是工程方面的实现）</li>
<li><strong>知识库更新很方便</strong>（不需要重新训练，只需要重新向量化即可）</li>
</ul>
<h2 data-id="heading-5">三、 RAG</h2>
<p>那我们来看下RAG是什么，所谓 <strong>RAG（Retrieval-Augmented Generation）</strong> 检索增强生成，就是：</p>
<ol>
<li><strong>检索(Retrieval)</strong>: 从外部知识库中检索相关信息</li>
<li><strong>增强(Augmented)</strong>: 将检索到的信息作为上下文</li>
<li><strong>生成(Generation)</strong>: 大模型基于检索内容生成回答</li>
</ol>
<p>它的本质就是上面说的给LLM外挂一个知识库，而它的工作过程，简单来讲就是下面这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d1ad7ba2b5f42a386942cf8fc28fd4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=vprImOLDcCSdMjQLPRBcpM6Gsb0%3D" alt="工作流程" loading="lazy"/></p>
<p>而一个RAG完整工程的架构示意图，则如下所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c2962721a194f80aa63ff971265d41c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=JorK7KNJlRPpJkWkkvRz2W3ZfWw%3D" alt="架构示意图" loading="lazy"/></p>
<p>看不懂？没关系，我们一步一步来讲解。</p>
<h2 data-id="heading-6">四、 向量和向量化</h2>
<p>首先，最基础的一个概念，什么是<strong>向量（Vector）<strong>和</strong>向量化（Vectorization/Embedding）</strong>。</p>
<h3 data-id="heading-7">向量（Vector）</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%2590%2591%25E9%2587%258F" target="_blank" title="https://zh.wikipedia.org/wiki/%E5%90%91%E9%87%8F" ref="nofollow noopener noreferrer">向量</a>我们应该不陌生，我们最早应该在高中就学过了，就是一个同时具有数值和方向的量。相对应的，标量则只有数值，没有方向。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edc9198f575a4e2e8a33e947cbb9e2e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=Z%2FLBLe%2FCr40EP0dw1FnWdqppjb4%3D" alt="向量" loading="lazy"/></p>
<p>向量通常用一个有序的数字数组来表示，比如：</p>
<ul>
<li>2维向量: [3, 4]，可以理解为一个有x轴和y轴的平面直角坐标系，从原点指向[3, 4]这个坐标点的一个向量</li>
<li>3维向量: [1, 2, 3]，可以理解为一个有x、y、z三个轴的空间直角坐标系，从原点指向[1, 2, 3]这个坐标点的一个向量</li>
<li>高维向量: [0.2, 0.5, 0.1, ..., 0.8]，以此类推，在数学或者计算机领域，一个向量可以有任意多个维度， 比如有几百甚至上千维</li>
</ul>
<p>而在AI领域，向量是<strong>原始数据的数值化表示</strong>，用来捕捉语义信息，比如</p>
<ul>
<li>文本“苹果很好吃”，可以用这样一个向量表示：[0.12, 0.34, 0.89, ..., 0.45]</li>
<li>图片🍎，可以用这样一个向量表示：[0.23, 0.67, 0.12, ..., 0.91]</li>
</ul>
<p>而具体是怎么把一串文本或者图片转换为向量的，就是向量化所做的工作了。</p>
<h3 data-id="heading-8">向量化（Vectorization/Embedding）</h3>
<p>向量化，就是将非结构化原始数据(文本、图片、音频等)转换为向量的过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc600b46672646c3890041b2b33a4cb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=mpdNC%2Fx88FBuqpxLk6Cbi%2FrcZeY%3D" alt="向量化" loading="lazy"/></p>
<p>而为了将一个非结构化数据，变为向量，我们首先需要给这个数据定义好它的<strong>维度</strong>。</p>
<p>世界上的所有数据，都可以根据它在某一项特点上的程度而打一个分，数值越高代表这个原始数据在这个特点上的特征越强烈。我们规定<strong>数值的范围是[-1, 1]</strong>，1代表完全符合这个特征，-1代表拥有完全相反的特征。</p>
<p>例如下面这个二维的向量空间：</p>
<ul>
<li>横坐标代表情感极性，越靠近1代表越正向的情感，越靠近-1代表越负向的情感</li>
<li>纵坐标代表内容类型，越靠近1代表越主观的观点评价，越靠近-1代表越客观的事实陈述</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/390da64c4f3c46959adb72cc3bac8778~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=PRyrYkwQe8Nyi6Bun8w4Tzkmcug%3D" alt="二维向量示例" loading="lazy"/></p>
<p>上面的几个原始文本数据里：</p>
<blockquote>
<ol>
<li>这部电影太精彩了，演员表演完美
<ul>
<li>横轴（情感）：+0.9（强烈正面）</li>
<li>纵轴（内容类型）：+0.8（明显观点评价）</li>
<li>坐标：[0.9, 0.8]</li>
</ul>
</li>
<li>水的沸点是100摄氏度
<ul>
<li>横轴（情感）：0.0（完全中性）</li>
<li>纵轴（内容类型）：-0.9（纯粹事实）</li>
<li>坐标：[0.0, -0.9]</li>
</ul>
</li>
<li>这个产品质量很差，完全不符合预期
<ul>
<li>横轴（情感）：-0.8（明显负面）</li>
<li>纵轴（内容类型）：+0.7（个人评价）</li>
<li>坐标：[-0.8, 0.7]</li>
</ul>
</li>
<li>令人失望的是，数据显示销售额下降了20%"
<ul>
<li>横轴（情感）：-0.6（负面情绪）</li>
<li>纵轴（内容类型）：-0.3（偏向事实但带有主观色彩）</li>
<li>坐标：[-0.6, -0.3]</li>
</ul>
</li>
<li>数据表明用户流失率高达30%
<ul>
<li>横轴（情感）：-0.7（负面情绪）</li>
<li>纵轴（内容类型）：-0.8（事实陈述，且没有明显主观评价在里面）</li>
<li>坐标：[-0.7, -0.8]</li>
</ul>
</li>
<li>我们彩票中了500万
<ul>
<li>横轴（情感）：+0.9（正面）</li>
<li>纵轴（内容类型）：-0.8（事实陈述，且没有明显主观评价在里面）</li>
<li>坐标：[0.9, -0.8]</li>
</ul>
</li>
</ol>
</blockquote>
<p>可以看到，在我们对原始的文本数据从不同维度打分后会出现</p>
<ul>
<li>相似文本会聚集：比如所有正面评价都会集中在第一象限</li>
<li>距离/夹角反映相似度：坐标距离/夹角越近，文本在情感和类型上越相似</li>
</ul>
<p>我们的例子里只有两个维度，而在实际应用中可能有几百上千个维度，每个维度代表不同特征，这样的话就可以得到一个高维的向量空间，在向量空间内可以体现出不同数据之间或近或远的关系。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d73c9a1216941de8e8561882c97ce49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=nZ2LUJEuGcRtmSo7ALhxg8f2j8A%3D" alt="向量空间" loading="lazy"/></p>
<p>另外，向量化除了叫做Vectorization外，有时候也会叫做<strong>Embedding，嵌入</strong>。这是因为向量化的过程，不只是将一个非结构化数据转为向量数字，更重要的是在这个过程中，将原始数据的语义信息嵌入到了向量空间中,使得语义关系被保留。</p>
<p>举个例子，通常情况下“国王King”和“王后Queen”常出现在相似的上下文中，“男人Man”和“女人Women”经常出现在相似的上下文中。</p>
<p>皇室词汇（King, Queen, Prince）之间的相似度整体大于它们与普通人词汇（Man, Women）的相似度。但是“国王King”和“男人Man”之间又有一些相似，“王后Queen”和“女人Women”之间有一些相似。</p>
<p>而将这四个单词进行向量化后，可能如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c9da8bf27840e9bc1bfd49d2774e4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=%2Fhz2yotgf%2FZ%2FQPlKJm2iw7e0Fmc%3D" alt="语义嵌入" loading="lazy"/></p>
<p>“国王King”、“王后Queen”、“男人Man”、“女人Women”的语义以及语义关系被嵌入了向量空间，做到了：</p>
<ol>
<li><strong>保持语义关系</strong>: 意思相近的词在向量空间中也靠近</li>
<li><strong>支持语义运算</strong>: 实现了<code>king - man + woman ≈ queen</code>这种神奇的运算</li>
</ol>
<h3 data-id="heading-9">如何向量化</h3>
<p>向量化是一个很复杂的过程，通常都是使用模型来实现的，即“<strong>Embedding models</strong>”，比如OpenAI的text-embedding-ada-002（需要API密钥访问），或者也可以使用一些开源的模型。</p>
<p>通常一个模型向量化数据后的维度越高，在后续进行信息检索时就会越精准。</p>
<p>其实除了调用模型这一步之外，完整的向量化过程还有一些其他工作要做，整个过程大概如下：</p>
<ol>
<li>
<p>读取文档</p>
<ul>
<li>PDF → 提取文本</li>
<li>Word → 提取文本</li>
<li>Markdown → 读取内容</li>
<li>...</li>
</ul>
</li>
<li>
<p>清洗文本</p>
<ul>
<li>去除乱码</li>
<li>统一格式</li>
<li>去除无用内容（页眉页脚等）</li>
</ul>
</li>
<li>
<p>把文本进行切割，即<strong>文本分块 (Chunking)</strong></p>
<p>为什么要分块？因为原始文档可能特别长，几千上万字，不方便后续进行向量化和检索。</p>
<p>而分块的规则也有多种，比如根据标点符号分割，但是可能会存在有的块长度很长，有的又很短的情况；也可以根据固定长度分割，但是可能会导致一个完整的语义被切割到不同的块，每个块里的部分词变得毫无语义价值。</p>
<p>所以RAG 分割一般用<strong>相同块大小</strong> + <strong>块重叠</strong>的办法，即所谓的<strong>滑动窗口分块</strong>，这和按长度截断来分割有点像。用这种办法，在一定程度上能避免文档原意被截断导致分出来的片段变得没价值，而且重叠块里有重复的信息，能让模型更好地理解文档内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23760b3089254b1faa25715d6b51db5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=dDSt%2BNpVrS4OTWuQyNS0Xli5vN4%3D" alt="文本分块" loading="lazy"/></p>
</li>
<li>
<p>使用某个模型进行<strong>向量化（Embedding）</strong></p>
<ul>
<li>
<p>BGE-base-zh (中文效果好)</p>
</li>
<li>
<p>all-MiniLM-L6-v2 (英文，轻量)</p>
</li>
<li>
<p>text-embedding-ada-002 (OpenAI，需联网)</p>
<p>假设选择BGE-base-zh (中文)，输出维度768维，模型大小约 400MB</p>
</li>
</ul>
</li>
<li>
<p>将向量化后的数据存入向量数据库，<strong>构建索引（Indexing）</strong></p>
<p>普通的数据存储有数据库，那么向量的存储，也有专门的<strong>向量数据库</strong>，它是专为存储与检索高维嵌入向量而设计的数据库。支持基于相似度的检索并可结合元数据过滤，常用于语义搜索、推荐和 RAG。常见的数据库有：</p>
<ul>
<li>Chroma</li>
<li>Milvus</li>
<li>Qdrant</li>
</ul>
<p>假设选择Chroma，那么它的每条记录的存储结构大概为：</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"id"</span>: <span class="hljs-string">"doc_1_chunk_1"</span>,
  <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.23</span>, <span class="hljs-number">0.45</span>, ..., <span class="hljs-number">0.12</span>],  <span class="hljs-comment">// 768维向量</span>
  <span class="hljs-string">"metadata"</span>: {
    <span class="hljs-string">"source"</span>: <span class="hljs-string">"系统架构文档.pdf"</span>,
    <span class="hljs-string">"chunk_index"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"第一章 系统架构..."</span>  <span class="hljs-comment">// 原始文本</span>
  }
}
</code></pre>
</li>
</ol>
<p>在做完上述的几个步骤之后，就算是完成了RAG的准备工作，即给LLM准备好了“外挂的知识库”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/260f81589cae4e1297c6b45b0caf0c36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=py20iRdJjMvMRLEFI4PTDKr%2FE2Y%3D" alt="知识库向量化过程" loading="lazy"/></p>
<h2 data-id="heading-10">五、 RAG - R (Retrieval)</h2>
<p>在准备好知识库之后，就可以和LLM进行问答了。那在提出问题后，如何让LLM知晓知识库的内容呢？答案就是RAG中的R，<strong>Retrieval检索</strong>。</p>
<p>在上面的知识库的准备过程中，我们使用了某个<strong>Embedding Model</strong>进行了知识库的向量化，那么在用户提出问题Query之后，也需要使用相同的<strong>Embedding Model</strong>，对用户的输入Query进行相同的向量化。</p>
<p>在都进行了向量化之后，就可以开始在向量数据库中检索了，检索和用户的Query相似语义的向量。</p>
<h3 data-id="heading-11">相似度匹配</h3>
<p>和普通数据库基于关键字的检索不同，向量数据库是基于语义的检索。那怎么判断两个向量的语义是否接近，常见的衡量标准有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E4%25BD%2599%25E5%25BC%25A6%25E7%259B%25B8%25E4%25BC%25BC%25E6%2580%25A7" target="_blank" title="https://zh.wikipedia.org/wiki/%E4%BD%99%E5%BC%A6%E7%9B%B8%E4%BC%BC%E6%80%A7" ref="nofollow noopener noreferrer">余弦相似度（Cosine Similarity）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E6%25AC%25A7%25E5%2587%25A0%25E9%2587%258C%25E5%25BE%2597%25E8%25B7%259D%25E7%25A6%25BB" target="_blank" title="https://zh.wikipedia.org/wiki/%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB" ref="nofollow noopener noreferrer">欧氏L2（Euclidean L2/Square L2）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%2586%2585%25E7%25A7%25AF" target="_blank" title="https://zh.wikipedia.org/wiki/%E5%86%85%E7%A7%AF" ref="nofollow noopener noreferrer">内积IP（Inner Product）</a></li>
</ul>
<p>这三个的具体定义和区别如下所示：</p>





























<table><thead><tr><th align="left">算法</th><th align="left">公式</th><th align="left">定义</th><th align="left">适用场景</th></tr></thead><tbody><tr><td align="left">余弦相似度（Cosine Similarity）</td><td align="left"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c058bf3e2fa240fe95b03ad3ef4aa21f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=mAvkfHDB2lMzNcfrBPdAhJUj80E%3D" alt="cosine" loading="lazy"/></td><td align="left">余弦相似度通过测量两个向量的夹角的余弦值来度量它们之间的相似性。<br/>仅反映方向一致性而与长度无关。</td><td align="left">当你关心“语义方向/形状”而不想被向量长度影响。<br/>典型应用场景有文本/图像嵌入检索、RAG 向量检索、语义去重、语义聚合。</td></tr><tr><td align="left">欧氏L2（Euclidean L2/Square L2）</td><td align="left"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8cab793bbfb4a82803b42fd700cc3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=We0YS2tAP%2BbOi8VwIlta2rz6bvU%3D" alt="L2" loading="lazy"/></td><td align="left">对两向量差的平方和开平方来度量几何距离（或向量自身长度），反映它们在空间中的直线距离。</td><td align="left">当你你需要真正的几何距离（度量性质、三角不等式）时。<br/>典型应用场景有K-means 聚类（目标是平方 L2）、最小二乘/MSE、几何邻近、部分 ANN 索引默认。</td></tr><tr><td align="left">内积（Inner Product/Dot Product）</td><td align="left"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5239a9147eee49e99c2c9aed16456bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=On0xXHp%2BWkXSD5JsiQxENWD5ed0%3D" alt="Inner Product" loading="lazy"/></td><td align="left">将两个向量对应分量相乘后求和，得到同时受方向与长度影响的对齐程度（线性打分）。</td><td align="left">典型应用场景有最大内积搜索（MIPS）、推荐召回、因子分解机/embedding 打分。</td></tr></tbody></table>
<p>而在RAG语义搜索中，通常使用余弦相似度来计算两个向量是否相似，即通过判断两个向量的夹角大小，来判断两个向量的语义是否接近。还是以上面的这个图为例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f31f8d0a76643deac54c1a6c524ec7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=3Cdwsqq59eu1rjGIY4xjZJDXydU%3D" alt="向量空间夹角" loading="lazy"/></p>
<p>在这个向量空间里，Chicken和“鸡”的图片之间，向量的夹角很小，Dog和Wolf夹角很小，Banana和Apple夹角很小，Apple和Apple公司的Logo夹角很小。但是动物和水果之间的向量夹角就很大了，语义上相差很远。</p>
<blockquote>
<p>为什么用余弦相似度？</p>
<p>因为文本长度不重要（一句话和一段话可能表达同一意思），我们只关心语义方向是否一致。</p>
</blockquote>
<h3 data-id="heading-12">ANN</h3>
<p>在上面的图中，我们还看到了一个叫做Approximate Nearest Neighbor（ANN）近似最近邻检索算法的东西，这个和余弦相似度有什么关系呢？</p>
<p>简单来讲：</p>
<ul>
<li>ANN是“怎么快地找相似向量”（检索算法/索引）</li>
<li>余弦相似度是“用什么标准衡量相似”（度量/打分）</li>
</ul>
<p>在RAG中它们是配套使用的，用余弦相似度等度量定义“近邻”，再用ANN在大规模向量库上高效近似地找这些近邻。</p>
<h3 data-id="heading-13">完整过程</h3>
<p>在完成检索后，通常会拿到Top-K最相关的几条数据。假设用户输入的问题是“如何配置HTTPS？”，那么过程大概如下：</p>
<ol>
<li>
<p>用户提问：“如何配置HTTPS？”</p>
</li>
<li>
<p>用户问题向量化，使用和文档向量化时相同的Embedding Model</p>
</li>
<li>
<p>得到Query的向量</p>
<pre><code class="hljs language-plain" lang="plain">query_vector = [0.31, 0.48, 0.73, ..., 0.15]  // 768维
</code></pre>
</li>
<li>
<p>在向量数据库中搜索</p>
</li>
<li>
<p>计算相似度
Chroma自动计算query_vector与所有向量数据库中向量的相似度</p>
<ul>
<li>向量1: [0.23, 0.45, ...] → 相似度 0.45</li>
<li>向量2: [0.31, 0.52, ...] → 相似度 0.89 ⭐</li>
<li>向量3: [0.12, 0.34, ...] → 相似度 0.32</li>
<li>...</li>
<li>向量8234: [0.29, 0.51, ...] → 相似度 0.91 ⭐⭐</li>
<li>向量8235: [0.35, 0.48, ...] → 相似度 0.87 ⭐</li>
<li>...</li>
</ul>
</li>
<li>
<p>返回 Top-K 最相关的，假设我们设置 K=3，返回相似度最高的3个文本块</p>
<p>结果：</p>
<ol>
<li>(相似度 0.91) "4.2 HTTPS配置步骤：首先需要申请SSL证书..."</li>
<li>(相似度 0.89) "安全配置章节：HTTPS是保障网站安全的关键..."</li>
<li>(相似度 0.87) "第五章 证书管理：SSL/TLS证书的申请与部署..."</li>
</ol>
</li>
</ol>
<h2 data-id="heading-14">六、 RAG - A (Augmented)</h2>
<p>在得到Top-K相关的数据后，会把这几条结果的原始数据（每条数据的metadata中会有原始数据），和用户的Query，一起给LLM。为什么叫<strong>Augmented增强</strong>呢？</p>
<p>其实Augmented，就是一个Prompt Engineering提示词工程相关的工作，把Query和知识库中的相关数据，通过一些特殊的Prompt给到LLM，让LLM更好地回答问题。即通过清晰的结构 + 明确的指令，让模型知道该参考什么。例如，一个完整的增强后的提示词可能如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个技术支持助手。请根据以下参考资料回答用户问题。

<span class="hljs-section">## 参考资料</span>

<span class="hljs-section">### 文档1（相关度：91%）</span>
来源：网络安全配置手册.pdf
内容：{检索到的文本块1}

<span class="hljs-section">### 文档2（相关度：89%）</span>
来源：服务器部署指南.pdf  
内容：{检索到的文本块2}

<span class="hljs-section">### 文档3（相关度：87%）</span>
来源：证书管理文档.pdf
内容：{检索到的文本块3}

<span class="hljs-section">## 回答要求</span>
<span class="hljs-bullet">1.</span> 必须基于上述参考资料
<span class="hljs-bullet">2.</span> 如果资料不足，明确说明
<span class="hljs-bullet">3.</span> 给出具体步骤
<span class="hljs-bullet">4.</span> 标注信息来源

<span class="hljs-section">## 用户问题</span>
如何配置HTTPS？

<span class="hljs-section">## 你的回答</span>
</code></pre>
<h2 data-id="heading-15">七、 RAG - G (Generation)</h2>
<p>最后一步的Generation生成，就和平时使用LLM没什么区别了，LLM会根据提示词，来回答问题并按照指定的格式来输出内容。即：</p>
<ol>
<li>读取参考资料</li>
<li>理解用户问题</li>
<li>从资料中提取相关信息</li>
<li>组织成结构化回答</li>
<li>逐字生成输出</li>
</ol>
<p>以上面的问题为例，LLM最终生成的内容可能如下所示：</p>
<pre><code class="hljs language-markdown" lang="markdown">根据参考资料，HTTPS配置步骤如下：

<span class="hljs-bullet">1.</span> <span class="hljs-strong">**申请SSL证书**</span>
<span class="hljs-bullet">   -</span> 可以通过Let's Encrypt获取免费证书
<span class="hljs-bullet">   -</span> 或购买商业证书（来源：证书管理文档）

<span class="hljs-bullet">2.</span> <span class="hljs-strong">**安装证书**</span>

   sudo cp cert.pem /etc/ssl/certs/
   sudo cp key.pem /etc/ssl/private/
   ...

<span class="hljs-bullet">3.</span> ...

</code></pre>
<p>到这里，整个RAG的过程就算是结束了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b33a3d8f95d4031ac035523fdbbcd1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=xPKRa%2F9K342d4AniNIJ7YMZ%2FPf8%3D" alt="RAG流程" loading="lazy"/></p>
<h2 data-id="heading-16">八、 完整RAG过程</h2>
<p>现在把上面几个步骤结合起来：</p>
<pre><code class="hljs language-plain" lang="plain">私有的知识库
→ 文本分块Chunking
→ 向量化Embedding
→ 存储向量构建索引Indexing
→ 用户提问Query
→ 检索Retrieval
→ 增强Augmented
→ 生成Generation
</code></pre>
<p>之后就得到了最开始的这个架构示意图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d206e521d05f4c15a599196edbe8396f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YWl6aOO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764208128&amp;x-signature=mejh1lMg2nOf%2B%2BtH4YeDth2BUn8%3D" alt="架构示意图" loading="lazy"/></p>
<h2 data-id="heading-17">九、 FAQ</h2>
<p>下面是一些常见的问题：</p>
<ol>
<li>
<p><strong>RAG和传统的全文模糊搜索有什么区别？</strong></p>
<p>传统的模糊搜索是关键词匹配的，比如</p>
<ul>
<li>用户搜索："如何做蛋糕"</li>
<li>系统匹配：只能找到包含"蛋糕"字样的文档</li>
<li>结果：❌ 找不到"烘焙教程"、"甜点制作"等相关内容</li>
</ul>
<p>而RAG最重要的一步就是把知识库做了向量化，是根据语义进行搜索的</p>
<ul>
<li>用户搜索："如何做蛋糕"</li>
<li>系统理解：用户想学习烘焙技能</li>
<li>结果：✅ 找到"烘焙教程"、"甜点制作"、"面包制作"等相关内容</li>
</ul>
</li>
<li>
<p><strong>既然RAG还是要通过构造提示词，来把参考资料放入提示词，那这和“直接在问题里把参考文档也输进去”有什么区别？</strong></p>
<p>这是因为我们要考虑成本和效率，一个知识库可能很大，成百上千个文档，数万数十万字，在实际操作的时候，要考虑到：</p>
<ul>
<li>Token限制：GPT-4 最多128K tokens ≈ 10万字，知识库无法塞进去</li>
<li>成本问题：即使能塞进去，128K tokens可能一次调用可能要几美元，成本激增</li>
<li>效率低下：LLM要读完所有无关内容</li>
<li>响应缓慢：处理海量文本需要很长时间</li>
</ul>
<p>所以RAG中R检索这一步，就是在做过滤，它的本质就是把“无限大”的知识库变成“刚刚好”的上下文</p>
</li>
<li>
<p><strong>在做向量化的时候，使用到的Embedding Model和LLM的Model有什么关联，为什么Embedding Model可以识别原始数据的语义？</strong></p>
<p>简单来讲，<strong>Embedding模型</strong>和<strong>大语言模型</strong>，他们的基础架构是相似的，但目标和训练方式不同。
两者都基于Transformer架构，即：</p>
<ul>
<li>多头自注意力机制 (Multi-Head Attention)</li>
<li>前馈神经网络 (Feed-Forward)</li>
<li>层归一化 (Layer Normalization)</li>
<li>位置编码 (Positional Encoding)</li>
</ul>
<p>但是</p>
<ul>
<li>Embedding Model：专门学习“理解和表示”，输出是向量</li>
<li>LLM：专门学习“生成文本”，输出是文字</li>
</ul>
<p>完整的Transformer可以理解为Encoder编码器 + Decoder解码器。</p>

















<table><thead><tr><th>组成</th><th>作用</th></tr></thead><tbody><tr><td>Encoder编码器</td><td>理解输入，提取特征</td></tr><tr><td>Decoder解码器</td><td>生成输出，逐字生成</td></tr></tbody></table>
<p>Embedding模型主要用的是Encoder，大语言模型主要用Decoder。</p>
<p>而Embedding模型之所以比LLM小很多（如BGE-base-zh只有400M），主要是因为它的任务相对简单（映射到向量空间），不需要生成能力，也就不需要记忆海量知识和复杂的推理能力。</p>
</li>
</ol>
<h2 data-id="heading-18">十、 小结</h2>
<p>这篇文章里，我们一起了解了一下RAG，以及这个技术如何通过外挂知识库解决大语言模型的三大局限：</p>
<ul>
<li>时效性不足（无法处理训练后新数据）</li>
<li>私有数据缺失</li>
<li>幻觉问题</li>
</ul>
<p>它的核心机制包含三个阶段：</p>
<ul>
<li>基于语义的向量化检索</li>
<li>结构化提示词增强上下文</li>
<li>以及大模型的知识整合生成</li>
</ul>
<p>这样就能实现低成本、易于维护的专业领域知识融合。相比微调方案， RAG无需训练标注数据且支持实时更新，适合用在企业知识库问答、实时政策解读这些场景里。</p>
<p>还有就是这篇文章（或者说《AI概念解惑》这个系列）更专注于概念解惑和原理解析，所以没有包含什么代码实操。</p>
<p>另外这也只是一个简单的原理解析，实际的RAG工程中可能还会包含很多其他的步骤，比如：</p>
<ul>
<li>文本分块时可能会同时使用语义分块+滑动窗口分块</li>
<li>Retrieval阶段可能不只是用向量相似度检索，会使用向量相似度+关键词（如BM25）的混合检索
<ul>
<li>为什么？因为向量相似度只对语义敏感，对关键词不敏感，比如“Python 3.12”和“Python 3.13”的向量基本相同，但是用户可能是提问具体Python版本的问题</li>
</ul>
</li>
<li>在Retrieval检索后还可能存在一个Reranking重排的步骤
<ul>
<li>对候选片段进行精细化打分和排序</li>
</ul>
</li>
<li>对于用户的问题Query可能会增加一个Query Rewriting
<ul>
<li>是为了让问题更规范，比如从一个口语化的表达到一个规范化的表达</li>
</ul>
</li>
<li>使用多路检索（Multi-Path Retrieval）、上下文压缩（Context Compression）、自我反思（Self-Reflection）等手段进行优化</li>
<li>引入RAG评分机制，对RAG的输出结果进行评估</li>
<li>...</li>
</ul>
<p>感兴趣的可以自行搜索了解。</p>
<p>希望这篇文章能帮助你理解RAG的核心原理和应用场景，如果这篇文章有什么问题，辛苦大家指正。</p>
<h2 data-id="heading-19">参考链接</h2>
<ul>
<li><a href="https://juejin.cn/post/7464756728685936694" target="_blank" title="https://juejin.cn/post/7464756728685936694">检索增强生成技术RAG：向量化与大模型的结合</a></li>
<li><a href="https://juejin.cn/post/7251903805980524581" target="_blank" title="https://juejin.cn/post/7251903805980524581">被 AI 带火的向量数据库是什么</a></li>
<li><a href="https://juejin.cn/post/7554986681502957587#heading-5" target="_blank" title="https://juejin.cn/post/7554986681502957587#heading-5">大模型系列教程：什么是RAG（检索增强生成模型）技术</a></li>
<li><a href="https://juejin.cn/post/7379831020495732773" target="_blank" title="https://juejin.cn/post/7379831020495732773">RAG-检索增强生成</a></li>
<li><a href="https://juejin.cn/post/7502279037948313651" target="_blank" title="https://juejin.cn/post/7502279037948313651">第一章：RAG 开发入门与基础概念</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F647646322" target="_blank" title="https://zhuanlan.zhihu.com/p/647646322" ref="nofollow noopener noreferrer">文本 Embedding 基本概念和应用实现原理</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweaviate.io%2Fblog%2Fdistance-metrics-in-vector-search" target="_blank" title="https://weaviate.io/blog/distance-metrics-in-vector-search" ref="nofollow noopener noreferrer">Distance Metrics in Vector Search</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatacream.substack.com%2Fp%2Frag-explained-understanding-embeddings" target="_blank" title="https://datacream.substack.com/p/rag-explained-understanding-embeddings" ref="nofollow noopener noreferrer">RAG Explained: Understanding Embeddings, Similarity, and Retrieval</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 相对颜色：告别 180 个颜色变量的设计系统噩梦]]></title>    <link>https://juejin.cn/post/7574045294611546147</link>    <guid>https://juejin.cn/post/7574045294611546147</guid>    <pubDate>2025-11-19T07:51:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574045294611546147" data-draft-id="7574245788948283407" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 相对颜色：告别 180 个颜色变量的设计系统噩梦"/> <meta itemprop="keywords" content="CSS,前端"/> <meta itemprop="datePublished" content="2025-11-19T07:51:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 相对颜色：告别 180 个颜色变量的设计系统噩梦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T07:51:30.000Z" title="Wed Nov 19 2025 07:51:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    77
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>当组件库中的颜色变量达到 180 个时，一次品牌色变更就成了前端开发的噩梦。CSS 相对颜色语法将彻底改变这一现状。</p>
</blockquote>
<h2 data-id="heading-0">一个让人沉默的现实</h2>
<p>最近在排查一个组件库的主题 BUG 时，我们发现了令人震惊的事实：这个看似成熟的设计系统中，竟然定义了 <strong>180 个颜色变量</strong>。</p>
<p>更可怕的是，每次品牌主色调整，都需要在 3 个不同的文件中同步修改 15 种深浅变化、hover 状态、透明度变体……设计同学轻描淡写的一句"主色想从偏蓝调成更紫一点"，意味着工程侧需要：</p>
<ul>
<li>
<p>手动修改 15+ 个变量</p>
</li>
<li>
<p>反复对比 hover、active 状态是否协调</p>
</li>
<li>
<p>仔细检查半透明背景是否漏改</p>
</li>
<li>
<p>确保整个颜色体系保持和谐</p>
</li>
</ul>
<p>漏改一个变量，hover 状态显得怪异；漏改两个，整套主题就开始"发脏"。</p>
<h2 data-id="heading-1">传统颜色系统的困境</h2>
<p>当前绝大多数设计系统的配色方案可以概括为：<strong>靠人肉复制的"颜色农场"</strong>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* 主色系 */</span>
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-number">#3b82f6</span>;
  <span class="hljs-attr">--color-primary-hover</span>: <span class="hljs-number">#2563eb</span>;
  <span class="hljs-attr">--color-primary-active</span>: <span class="hljs-number">#1d4ed8</span>;
  <span class="hljs-attr">--color-primary-light</span>: <span class="hljs-number">#93c5fd</span>;
  <span class="hljs-attr">--color-primary-dark</span>: <span class="hljs-number">#1e40af</span>;
  
  <span class="hljs-comment">/* 辅助色系 */</span>
  <span class="hljs-attr">--color-secondary</span>: <span class="hljs-number">#8b5cf6</span>;
  <span class="hljs-attr">--color-secondary-hover</span>: <span class="hljs-number">#7c3aed</span>;
  <span class="hljs-attr">--color-secondary-active</span>: <span class="hljs-number">#6d28d9</span>;
  
  <span class="hljs-comment">/* 继续衍生... */</span>
}
</code></pre>
<p>这种模式的痛点显而易见：</p>
<ul>
<li>
<p><strong>维护成本高</strong>：一个主色系需要十几二十个变量</p>
</li>
<li>
<p><strong>同步困难</strong>：多处定义的变量容易遗漏</p>
</li>
<li>
<p><strong>不可靠</strong>：手动调色依赖个人感觉，缺乏系统性</p>
</li>
</ul>
<h2 data-id="heading-2">CSS 相对颜色：革命性的解决方案</h2>
<p>CSS 相对颜色语法引入的 <code>from</code> 关键字，让颜色从"死值"变成"活公式"。</p>
<h3 data-id="heading-3">基础语法</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">color</span>-function(<span class="hljs-selector-tag">from</span> origin-<span class="hljs-attribute">color</span> channel1 channel2 channel3 / alpha)
</code></pre>
<p>拆解说明：</p>
<ul>
<li>
<p><code>color-function</code>：输出格式，如 <code>rgb()</code>、<code>hsl()</code>、<code>oklch()</code></p>
</li>
<li>
<p><code>from</code>：关键字符，声明颜色来源</p>
</li>
<li>
<p><code>origin-color</code>：基准颜色，支持 hex、RGB、HSL 等格式</p>
</li>
<li>
<p><code>channel1 ~ 3</code>：可访问和修改的通道值</p>
</li>
<li>
<p><code>alpha</code>：可选透明度通道</p>
</li>
</ul>
<h3 data-id="heading-4">实际应用示例</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary</span>: <span class="hljs-number">#3b82f6</span>;
}
​
<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--primary);
}
​
<span class="hljs-selector-class">.button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-comment">/* 基于主色自动计算 hover 状态 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">hsl</span>(from <span class="hljs-built_in">var</span>(--primary) h s <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">10</span>));
}
</code></pre>
<p>这一行 <code>hsl(from ...)</code> 的改变，将 hover 效果从"写死"变成了"相对基色、自动联动"。从此，品牌色只需修改一个 <code>--primary</code> 变量，所有衍生状态自动跟随。</p>
<h2 data-id="heading-5">from 关键字的魔力</h2>
<p><code>from</code> 的核心作用是将颜色分解为通道值，让我们能够像搭乐高一样重新组合：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* 将绿色分解为 RGB 通道 */</span>
<span class="hljs-built_in">rgb</span>(from green r g b)  <span class="hljs-comment">/* 输出: rgb(0 128 0) */</span>
​
<span class="hljs-comment">/* 用绿色通道创建灰度 */</span>
<span class="hljs-built_in">rgb</span>(from green g g g)  <span class="hljs-comment">/* 输出: rgb(128 128 128) */</span>
​
<span class="hljs-comment">/* 随意调换通道顺序 */</span>
<span class="hljs-built_in">rgb</span>(from green b r g)  <span class="hljs-comment">/* 输出: rgb(0 0 128) */</span>
</code></pre>
<h3 data-id="heading-6">跨色彩空间转换</h3>
<p><code>from</code> 自动处理色彩空间转换，让颜色格式不再成为障碍：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* RGB 转 HSL */</span>
<span class="hljs-built_in">hsl</span>(from rgb(<span class="hljs-number">255</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>) h s l)
​
<span class="hljs-comment">/* Hex 转 OKLCH */</span>
<span class="hljs-built_in">oklch</span>(from #<span class="hljs-number">3</span>b82f6 l c h)
</code></pre>
<p>这对设计系统意义重大：源头存储格式不再重要，使用端始终使用统一的可计算空间。</p>
<h2 data-id="heading-7">calc()：颜色计算的引擎</h2>
<p>真正的威力在于将 <code>calc()</code> 与颜色通道结合：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">/* 变亮：提高亮度 */</span>
<span class="hljs-built_in">hsl</span>(from blue h s calc(l + <span class="hljs-number">20</span>))
​
<span class="hljs-comment">/* 变暗：降低亮度 */</span>  
<span class="hljs-built_in">hsl</span>(from blue h s calc(l - <span class="hljs-number">20</span>))
​
<span class="hljs-comment">/* 半透明：调整透明度 */</span>
<span class="hljs-built_in">rgb</span>(from blue r g b / calc(alpha * <span class="hljs-number">0.5</span>))
​
<span class="hljs-comment">/* 调色：旋转色相 */</span>
<span class="hljs-built_in">hsl</span>(from blue calc(h + <span class="hljs-number">180</span>) s l)
</code></pre>
<p>大部分颜色衍生逻辑都可以归结为：<strong>通道 + 偏移量</strong> 或 <strong>通道 × 系数</strong>。</p>
<h2 data-id="heading-8">OKLCH：更智能的色彩空间</h2>
<p>虽然 HSL 很流行，但它有个致命缺陷：<strong>亮度感知不均</strong>。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">hsl</span>(<span class="hljs-number">220</span> <span class="hljs-number">80%</span> <span class="hljs-number">50%</span>)  <span class="hljs-comment">/* 蓝色 */</span>
<span class="hljs-built_in">hsl</span>(<span class="hljs-number">120</span> <span class="hljs-number">80%</span> <span class="hljs-number">50%</span>)  <span class="hljs-comment">/* 绿色 */</span>
</code></pre>
<p>理论上两者亮度相同，但人眼感知中绿色明显更亮。OKLCH 解决了这个问题：</p>
<ul>
<li>
<p><strong>L（Lightness）</strong>：0-1，感知亮度，更符合人眼</p>
</li>
<li>
<p><strong>C（Chroma）</strong>：0-约0.37，颜色纯度</p>
</li>
<li>
<p><strong>H（Hue）</strong>：0-360，色相角度</p>
<p>oklch(0.55 0.15 260)  /* 蓝色 <em>/
oklch(0.55 0.15 140)  /</em> 绿色 */</p>
</li>
</ul>
<p>在 OKLCH 中，相同的 L 值在不同色相间具有一致的亮度感知，这让程序化调色更加可靠。</p>
<h2 data-id="heading-9">构建智能颜色系统</h2>
<h3 data-id="heading-10">第一步：定义品牌基色</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* 只用定义 4 个基础品牌色 */</span>
  <span class="hljs-attr">--brand-primary</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.55</span> <span class="hljs-number">0.2</span> <span class="hljs-number">265</span>);
  <span class="hljs-attr">--brand-success</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.65</span> <span class="hljs-number">0.18</span> <span class="hljs-number">145</span>);
  <span class="hljs-attr">--brand-error</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.6</span> <span class="hljs-number">0.25</span> <span class="hljs-number">25</span>);
  <span class="hljs-attr">--brand-warning</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.75</span> <span class="hljs-number">0.15</span> <span class="hljs-number">85</span>);
}
</code></pre>
<h3 data-id="heading-11">第二步：按规则生成完整色板</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-comment">/* Primary 色系 - 全部从基色派生 */</span>
  <span class="hljs-attr">--primary</span>: <span class="hljs-built_in">var</span>(--brand-primary);
  <span class="hljs-attr">--primary-hover</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.1</span>) c h);
  <span class="hljs-attr">--primary-active</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.15</span>) c h);
  <span class="hljs-attr">--primary-light</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.2</span>) <span class="hljs-built_in">calc</span>(c * <span class="hljs-number">0.5</span>) h);
  <span class="hljs-attr">--primary-lighter</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.3</span>) <span class="hljs-built_in">calc</span>(c * <span class="hljs-number">0.3</span>) h);
  <span class="hljs-attr">--primary-alpha-10</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) l c h / <span class="hljs-number">0.1</span>);
  <span class="hljs-attr">--primary-alpha-20</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) l c h / <span class="hljs-number">0.2</span>);
  
  <span class="hljs-comment">/* 其他色系采用相同模式 */</span>
  <span class="hljs-attr">--success</span>: <span class="hljs-built_in">var</span>(--brand-success);
  <span class="hljs-attr">--success-hover</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-success) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.1</span>) c h);
  <span class="hljs-attr">--success-light</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-success) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.2</span>) <span class="hljs-built_in">calc</span>(c * <span class="hljs-number">0.5</span>) h);
}
</code></pre>
<p>四个基色变量，扩展出完整的颜色体系。品牌色调整时，只需修改四个基础值。</p>
<h2 data-id="heading-12">暗色模式的革命</h2>
<p>传统暗色模式需要维护两套 token，现在只需一个公式：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--surface</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.98</span> <span class="hljs-number">0.02</span> <span class="hljs-number">240</span>);
  <span class="hljs-attr">--text</span>: <span class="hljs-built_in">oklch</span>(<span class="hljs-number">0.25</span> <span class="hljs-number">0.03</span> <span class="hljs-number">240</span>);
}
​
<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">"dark"</span>]</span> {
  <span class="hljs-comment">/* 亮度反转实现暗色模式 */</span>
  <span class="hljs-attr">--surface</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--surface) <span class="hljs-built_in">calc</span>(<span class="hljs-number">1</span> - l) c h);
  <span class="hljs-attr">--text</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--text) <span class="hljs-built_in">calc</span>(<span class="hljs-number">1</span> - l) c h);
}
</code></pre>
<h2 data-id="heading-13">实战高级技巧</h2>
<h3 data-id="heading-14">1. 智能阴影系统</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
  <span class="hljs-attr">--card-bg</span>: <span class="hljs-built_in">var</span>(--primary);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--card-bg);
  <span class="hljs-attribute">box-shadow</span>: 
    <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">6px</span> <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--card-bg) l c h / <span class="hljs-number">0.2</span>),
    <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--card-bg) l c h / <span class="hljs-number">0.15</span>);
}
</code></pre>
<p>阴影自动适应背景色，主题切换时自然过渡。</p>
<h3 data-id="heading-15">2. 确保可读性的文本颜色</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.tag</span> {
  <span class="hljs-attr">--tag-bg</span>: <span class="hljs-built_in">var</span>(--primary);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--tag-bg);
  <span class="hljs-comment">/* 文本亮度比背景高 0.6，确保对比度 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--tag-bg) <span class="hljs-built_in">calc</span>(l + <span class="hljs-number">0.6</span>) c h);
}
</code></pre>
<h3 data-id="heading-16">3. 品牌化半透明遮罩</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.modal-backdrop</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--brand-primary) l c h / <span class="hljs-number">0.7</span>);
}
</code></pre>
<h2 data-id="heading-17">浏览器支持与渐进增强</h2>
<p>截至 2025 年，相对颜色已获得良好支持：</p>
<ul>
<li>
<p>Chrome 119+ ✅</p>
</li>
<li>
<p>Firefox 128+ ✅</p>
</li>
<li>
<p>Safari 16.4+ ✅</p>
</li>
<li>
<p>Edge 119+ ✅</p>
</li>
</ul>
<p>覆盖率约 83%，对于不支持的环境可提供静态回退：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#2563eb</span>; <span class="hljs-comment">/* 回退值 */</span>
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">oklch</span>(from <span class="hljs-built_in">var</span>(--primary) <span class="hljs-built_in">calc</span>(l - <span class="hljs-number">0.1</span>) c h);
}
</code></pre>
<h2 data-id="heading-18">避坑指南</h2>
<ol>
<li>
<p><strong>避免过深派生链</strong>：从基色直接推导，最多两层</p>
</li>
<li>
<p><strong>控制 Chroma 范围</strong>：OKLCH 中 Chroma 超过 0.37 可能导致颜色溢出</p>
</li>
<li>
<p><strong>正确使用 Alpha</strong>：<code>oklch(0.6 0.2 265 / 0.5)</code> 而非 <code>oklch(0.6 0.2 265 0.5)</code></p>
</li>
</ol>
<h2 data-id="heading-19">总结：从小升级到大变革</h2>
<p>CSS 相对颜色解决的不仅是技术问题，更是设计系统维护的哲学变革：</p>
<ul>
<li>
<p><strong>主题切换不再是灾难</strong>：改一个变量，全站自洽</p>
</li>
<li>
<p><strong>颜色 Token 真正集中管理</strong>：从分散定义到统一源头</p>
</li>
<li>
<p><strong>设计规则化</strong>：深浅、状态、透明度都成为可复用的公式</p>
</li>
<li>
<p><strong>开发体验提升</strong>：从机械调色到智能推导</p>
</li>
</ul>
<p>下一次重构配色系统时，不妨尝试将基准色、状态色、暗色模式、半透明层全部交给相对颜色计算。那种"改一处，全局联动"的流畅体验，确实让人上头。</p>
<p>从 180 个颜色变量到 4 个基色变量，这不只是数量的减少，更是设计系统维护理念的质的飞跃。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SysInfoKeeper是一款面向 Linux/Unix 的硬件变动检测 CLI 工具]]></title>    <link>https://juejin.cn/post/7574619023805104166</link>    <guid>https://juejin.cn/post/7574619023805104166</guid>    <pubDate>2025-11-20T09:38:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023805104166" data-draft-id="7574639741149626419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SysInfoKeeper是一款面向 Linux/Unix 的硬件变动检测 CLI 工具"/> <meta itemprop="keywords" content="运维"/> <meta itemprop="datePublished" content="2025-11-20T09:38:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泷厨logan做机器学习"/> <meta itemprop="url" content="https://juejin.cn/user/2285221467402489"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SysInfoKeeper是一款面向 Linux/Unix 的硬件变动检测 CLI 工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285221467402489/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泷厨logan做机器学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:38:38.000Z" title="Thu Nov 20 2025 09:38:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SysInfoKeeper 是一款面向 Linux/Unix 的硬件资产与漂移检测 CLI 工具。<br/>
每次执行都会采集完整的硬件快照（CPU、内存、磁盘、网卡、GPU、风扇、传感器等），与存储在 SQLite 中的历史记录比对，并将设备标记为 <strong>新增</strong>、<strong>移除</strong>、<strong>变更</strong> 或 <strong>位置调整</strong>。CLI 支持渲染丰富的终端表格、输出 JSON/YAML，也可以作为守护进程持续记录硬件事件。</p>
<p>获取：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper" target="_blank" title="https://github.com/binrchq/sysinfokeeper" ref="nofollow noopener noreferrer">github.com/binrchq/sys…</a></p>
<p>图例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db8ff88bd6184962ac93ce88e7df8927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=4Tdy0gYDZoSbJ5NbdT4DqIHMymQ%3D" alt="1763628646256.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8557aa14d4b3411cb2f940d896669bad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=5fLcjYU0AaZCLKeIwgMG%2FrlcgPw%3D" alt="1763628551735.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87661ac0fa754e98b494f1b276b32d56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=bacHYvpiPpAGSHzMrPffYJmG4%2Bg%3D" alt="1763628567628.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32624efb75e449a38125ff345a7ef4d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=yl7%2FolhIRdCOF8O21BZ11f1RtC0%3D" alt="1763628573878.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa8b9aefdece459d9e2e6dce049c8ea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rO35Y6obG9nYW7lgZrmnLrlmajlrabkuaA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237321&amp;x-signature=J8sVMFWIsB4430wAQzZGcDj47So%3D" alt="1763628853755.png" loading="lazy"/></p>
<h2 data-id="heading-0">功能亮点</h2>
<ul>
<li><strong>精准的硬件发现</strong>：整合 <code>lsblk</code>、<code>udevadm</code>、<code>dmidecode</code>、<code>smartctl</code>、<code>findmnt</code>、<code>pterm</code> 等工具，统一输出每个部件的规范视图。</li>
<li><strong>磁盘基准测试</strong>：在真实挂载点上执行校准后的 <code>dd</code> 测试（避开 tmpfs），并记录读/写吞吐与 SMART 数据。</li>
<li><strong>事件追踪</strong>：快照持久化在 SQLite，比较器会标记新增/移除/迁移，并保留完整时间线，便于审计。</li>
<li><strong>留存策略</strong>：默认保存 30 天历史（可通过 <code>sinfo retention</code> 调整），过期记录可自动或手动清理。</li>
<li><strong>自动化友好</strong>：支持多种输出格式（<code>graph</code>、<code>table</code>、<code>json</code>、<code>json-line</code>、<code>yaml</code>），按硬件类型筛选，分级输出 (<code>basic</code> / <code>advanced</code> / <code>full</code>)，并附带 systemd service 与 AppImage 打包脚本。</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">.
├── cmd/sinfo/            <span class="hljs-comment"># Cobra CLI 入口（root、clean、retention 等）</span>
├── core/                 <span class="hljs-comment"># 采集器、模型、数据库层、比较器</span>
│   ├── hardware/         <span class="hljs-comment"># 快照管理、DB 存储、调度器</span>
│   ├── model/            <span class="hljs-comment"># 渲染助手与 JSON 结构体</span>
│   └── packages/         <span class="hljs-comment"># CPU / RAM / Disk / GPU / NIC 采集逻辑</span>
├── deployments/          <span class="hljs-comment"># systemd 示例</span>
├── tools/                <span class="hljs-comment"># 调用图、构建脚本</span>
├── LICENSE               <span class="hljs-comment"># 双重许可策略（AGPLv3 + 商业协议）</span>
├── LICENSE.AGPLv3        <span class="hljs-comment"># AGPLv3 正文</span>
└── LICENSE.COMMERCIAL    <span class="hljs-comment"># 商业授权摘要</span>
</code></pre>
<p>获取：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">GO111MODULE</span>=<span class="hljs-literal">on</span> go install binrc.com/sysinfokeeper/cmd/sinfo@latest
sinfo
</code></pre>
<h2 data-id="heading-1">核心命令</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper%2Fblob%2Fmain%2FREADME_CN.md%23%25E6%25A0%25B8%25E5%25BF%2583%25E5%2591%25BD%25E4%25BB%25A4" target="_blank" title="https://github.com/binrchq/sysinfokeeper/blob/main/README_CN.md#%E6%A0%B8%E5%BF%83%E5%91%BD%E4%BB%A4" ref="nofollow noopener noreferrer"/></p>





























<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>sinfo</code></td><td>采集硬件信息、输出结果并写入快照。</td></tr><tr><td><code>sinfo clean</code></td><td>清理历史记录（支持 <code>--all</code>、<code>--inactive</code>、<code>--days</code>、<code>--type</code>、<code>--dry-run</code> 等）。</td></tr><tr><td><code>sinfo retention</code></td><td>查看或修改留存天数（默认 30 天）。</td></tr><tr><td><code>sinfo --output json</code></td><td>机器可读输出。</td></tr><tr><td><code>sinfo --target cpu --target memory</code></td><td>仅采集指定硬件类型。</td></tr></tbody></table>
<p>无人值守场景可结合 cron/systemd，或使用 <code>core/hardware/scheduler.go</code> 中的调度器。</p>
<h2 data-id="heading-2">使用 <code>serve</code> 以 systemd 服务方式运行</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper%2Fblob%2Fmain%2FREADME_CN.md%23%25E4%25BD%25BF%25E7%2594%25A8-serve-%25E4%25BB%25A5-systemd-%25E6%259C%258D%25E5%258A%25A1%25E6%2596%25B9%25E5%25BC%258F%25E8%25BF%2590%25E8%25A1%258C" target="_blank" title="https://github.com/binrchq/sysinfokeeper/blob/main/README_CN.md#%E4%BD%BF%E7%94%A8-serve-%E4%BB%A5-systemd-%E6%9C%8D%E5%8A%A1%E6%96%B9%E5%BC%8F%E8%BF%90%E8%A1%8C" ref="nofollow noopener noreferrer"/></p>
<p>仓库中已经提供了参考配置 <code>deployments/sinfo.service</code>。可将其复制到 <code>/etc/systemd/system/</code> 并按需修改，用于长时间运行 <code>sinfo serve</code> 调度任务：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Unit]</span>
<span class="hljs-attr">Description</span>=SysInfoKeeper Hardware Monitoring Service
<span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target
<span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target

<span class="hljs-section">[Service]</span>
<span class="hljs-attr">Type</span>=simple
<span class="hljs-attr">User</span>=sysinfokeeper
<span class="hljs-attr">Group</span>=sysinfokeeper
<span class="hljs-attr">WorkingDirectory</span>=/var/lib/sysinfokeeper
<span class="hljs-attr">Environment</span>=SINFO_INTERVAL=<span class="hljs-number">3600</span>
<span class="hljs-attr">Environment</span>=SINFO_RETENTION=<span class="hljs-number">30</span>
<span class="hljs-attr">Environment</span>=SINFO_SPEED_TEST=low
<span class="hljs-attr">EnvironmentFile</span>=-/etc/sysinfokeeper.env
<span class="hljs-attr">ExecStart</span>=/usr/local/bin/sinfo serve \
  --interval $SINFO_INTERVAL \
  --retention $SINFO_RETENTION \
  --speed-test $SINFO_SPEED_TEST
<span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure

<span class="hljs-section">[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.target
</code></pre>
<p>可以通过环境变量或 <code>/etc/sysinfokeeper.env</code> 覆盖 <code>interval</code>、<code>retention</code>、<code>speed-test</code> 等参数。<code>sinfo serve</code> 将常驻运行，不断采集并写入快照直至服务停止。</p>
<h2 data-id="heading-3">参与贡献</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbinrchq%2Fsysinfokeeper%2Fblob%2Fmain%2FREADME_CN.md%23%25E5%258F%2582%25E4%25B8%258E%25E8%25B4%25A1%25E7%258C%25AE" target="_blank" title="https://github.com/binrchq/sysinfokeeper/blob/main/README_CN.md#%E5%8F%82%E4%B8%8E%E8%B4%A1%E7%8C%AE" ref="nofollow noopener noreferrer"/></p>
<ol>
<li>Fork &amp; Clone 仓库。</li>
<li>开启 Go Modules（<code>GO111MODULE=on</code>）。</li>
<li>提交前请 <code>gofmt</code>/<code>goimports</code>，并运行 lint / test。</li>
<li>提交 Issue 时请尽量描述硬件环境（内核、发行版、存储拓扑、RAID 等）。</li>
</ol>
<p>贡献默认遵循本项目的双重许可方案（见下文）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决 XXL-Job 定时任务时间偏差8小时的问题]]></title>    <link>https://juejin.cn/post/7573957755369160714</link>    <guid>https://juejin.cn/post/7573957755369160714</guid>    <pubDate>2025-11-19T03:23:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573957755369160714" data-draft-id="7567309723478442036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决 XXL-Job 定时任务时间偏差8小时的问题"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-19T03:23:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决 XXL-Job 定时任务时间偏差8小时的问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T03:23:45.000Z" title="Wed Nov 19 2025 03:23:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是大华！</p>
<p>最近把XXL-Job定时任务迁移到新服务器时，遇到了一个让人困惑的问题：任务设置在上午10点执行，但执行调度和执行却显示晚上18点。经过排查，发现问题根源是<strong>A服务器的时间少了8个小时</strong>！</p>
<p>所有任务执行时间都多了8小时，如图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff86a6fa1ff54003896609007d04da3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764127425&amp;x-signature=DCsLc9FZuFnLHRP3HaCPvTtPNp4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">问题分析</h2>
<h3 data-id="heading-1">执行时间线</h3>
<p><strong>1.我设置的时间</strong>：10:00（我以为的北京时间）
<strong>2.A服务器理解的时间</strong>：10:00 UTC（相当于北京时间18:00）
<strong>3.触发任务</strong>：A服务器在UTC时间10:00向B服务器发送请求
<strong>4.B服务器接收时刻</strong>：北京时间18:00（UTC 10:00 + 8小时）
<strong>5.执行任务</strong>：北京时间18:00</p>
<h2 data-id="heading-2">解决方案：修复A服务器时间</h2>
<h3 data-id="heading-3">第一步：检查B服务器时区配置</h3>
<p>登录B服务器，执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看当前时间和时区</span>
<span class="hljs-built_in">date</span>
timedatectl

<span class="hljs-comment"># 预期正确输出（北京时间）：</span>
<span class="hljs-comment"># Wed May 15 10:00:00 CST 2024</span>

<span class="hljs-comment"># 错误输出示例：</span>
<span class="hljs-comment"># Wed May 15 02:00:00 UTC 2024</span>
</code></pre>
<h3 data-id="heading-4">第二步：修正B服务器时区</h3>
<p><strong>CentOS/RedHat系统：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 设置时区为上海</span>
timedatectl set-timezone Asia/Shanghai

<span class="hljs-comment"># 验证设置</span>
<span class="hljs-built_in">date</span>
</code></pre>
<p><strong>Ubuntu/Debian系统：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 交互式设置时区</span>
sudo dpkg-reconfigure tzdata
<span class="hljs-comment"># 选择 Asia -&gt; Shanghai</span>
</code></pre>
<h3 data-id="heading-5">第三步：确保时间同步</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装并配置NTP时间同步</span>
yum install -y ntp  <span class="hljs-comment"># CentOS</span>
sudo apt-get update  <span class="hljs-comment"># Ubuntu</span>

<span class="hljs-comment"># 验证当前时间状态</span>
timedatectl status
<span class="hljs-comment"># 确认为Time zone: Asia/Shanghai (CST, +0800)</span>
</code></pre>
<h3 data-id="heading-6">第四步：验证B服务器配置</h3>
<p>虽然问题主要出在A服务器，但确保环境一致性很重要：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在A服务器上也执行同样的检查</span>
<span class="hljs-built_in">date</span>
timedatectl
</code></pre>
<p>确保B服务器也使用 <code>Asia/Shanghai</code> 时区。</p>
<h4 data-id="heading-7">最后一定要记得重启定时任务。</h4>
<h2 data-id="heading-8">在XXL-Job管理界面中确认</h2>
<p>登录XXL-Job Admin管理后台，查看调度日志：</p>
<p><strong>1.调度时间</strong>：反映A服务器（调度中心）的触发时间
<strong>2.执行时间</strong>：来自B服务器（执行器）上报的时间</p>
<p>修复前后对比：
<strong>修复前</strong>：调度时间 10:00，执行时间 18:00
<strong>修复后</strong>：调度时间 10:00，执行时间 10:00</p>
<h2 data-id="heading-9">实践建议</h2>
<p><strong>1.环境标准化</strong></p>
<ul>
<li>所有服务器统一使用 <code>Asia/Shanghai</code> 时区</li>
<li>使用相同的时间同步服务</li>
</ul>
<p><strong>2.日志规范</strong></p>
<ul>
<li>在业务日志中明确输出时区信息</li>
<li>考虑使用UTC时间存储日志，展示时按需转换</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>这个问题本质上是一个环境配置一致性问题。在分布式系统中，时间一致性是经常被忽视却又至关重要的基础配置。
<code>XXL-Job</code>作为一个优秀的分布式任务调度框架，其本身的时间机制是清晰的，问题往往出现在环境配置层面。</p>
<p>下次当你发现定时任务执行时间对不上时，首先检查服务器的时区和时间同步配置，这可能会为你节省大量的排查时间。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<p><strong>📌 扩展阅读：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F72THiVPtsrA2xvtHmdDLmA" target="_blank" title="https://mp.weixin.qq.com/s/72THiVPtsrA2xvtHmdDLmA" ref="nofollow noopener noreferrer">《SpringBoot+Vue3 整合 SSE 实现实时消息推送》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">《这20条SQL优化方案，让你的数据库查询速度提升10倍》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FgQK9L1TxKL50FUVMcgh6JQ" target="_blank" title="https://mp.weixin.qq.com/s/gQK9L1TxKL50FUVMcgh6JQ" ref="nofollow noopener noreferrer">《SpringBoot 动态菜单权限系统设计的企业级解决方案》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fn1DqvgnDTFzpv9hJaudQeA" target="_blank" title="https://mp.weixin.qq.com/s/n1DqvgnDTFzpv9hJaudQeA" ref="nofollow noopener noreferrer">《Vue3 + ElementPlus 动态菜单实现：一套代码完美适配多角色权限系统》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[专为 LLM 设计的数据格式 TOON，可节省 60% Token]]></title>    <link>https://juejin.cn/post/7574204970745397294</link>    <guid>https://juejin.cn/post/7574204970745397294</guid>    <pubDate>2025-11-19T01:13:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574204970745397294" data-draft-id="7472577976657264692" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="专为 LLM 设计的数据格式 TOON，可节省 60% Token "/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-19T01:13:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            专为 LLM 设计的数据格式 TOON，可节省 60% Token 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:13:17.000Z" title="Wed Nov 19 2025 01:13:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>最近在使用 NestJs 和 NextJs 在做一个协同文档 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a>，如果感兴趣，欢迎 star，有任何疑问，欢迎加我微信进行咨询 <code>yunmz777</code></p>
<p>随着社交媒体的深度渗透，朋友圈、微博、Instagram 等平台已成为用户展示生活、分享瞬间的核心场景。其中，"九宫格"排版形式凭借其规整的视觉美感和内容叙事性，成为年轻用户（尤其是女性群体）高频使用的图片发布方式。</p>
<p>在接下来的内容中，我们将使用 NextJs 结合 sharp 来实现图片裁剪的功能。</p>
<h2 data-id="heading-0">编写基本页面</h2>
<p>首先我们将编写一个图片裁剪的功能，以支持用户来生成不同规格的图片，例如 3x3、2x2 等格式。</p>
<p>如下代码所示：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">"use client"</span>;

<span class="hljs-keyword">import</span> { useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [rows, setRows] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">3</span>);
  <span class="hljs-keyword">const</span> [columns, setColumns] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">3</span>);
  <span class="hljs-keyword">const</span> [image, setImage] = useState&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [splitImages, setSplitImages] = useState&lt;<span class="hljs-built_in">string</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [isProcessing, setIsProcessing] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [imageLoaded, setImageLoaded] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> imageRef = useRef&lt;<span class="hljs-title class_">HTMLImageElement</span>&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> fileInputRef = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFileUpload</span> = (<span class="hljs-params">file: File</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"image/"</span>)) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"请上传图片文件"</span>);

      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 先重置状态</span>
    <span class="hljs-title function_">setImage</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-title function_">setSplitImages</span>([]);
    <span class="hljs-title function_">setImageLoaded</span>(<span class="hljs-literal">false</span>);

    <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();

    reader.<span class="hljs-property">onload</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>?.<span class="hljs-property">result</span>) {
        <span class="hljs-title function_">setImage</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
      }
    };

    reader.<span class="hljs-title function_">readAsDataURL</span>(file);
  };

  <span class="hljs-comment">// 修改图片加载完成的处理函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleImageLoad</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Image loaded"</span>); <span class="hljs-comment">// 添加日志以便调试</span>
    <span class="hljs-title function_">setImageLoaded</span>(<span class="hljs-literal">true</span>);
  };

  <span class="hljs-comment">// 渲染切割辅助线</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderGuideLines</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!image || !imageRef.<span class="hljs-property">current</span> || !imageLoaded) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> commonLineStyles = <span class="hljs-string">"bg-blue-500/50 absolute pointer-events-none"</span>;
    <span class="hljs-keyword">const</span> imgRect = imageRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> containerRect =
      imageRef.<span class="hljs-property">current</span>.<span class="hljs-property">parentElement</span>?.<span class="hljs-title function_">getBoundingClientRect</span>();

    <span class="hljs-keyword">if</span> (!containerRect) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> imgStyle = {
      <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.left - containerRect.left}</span>px`</span>,
      <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.top - containerRect.top}</span>px`</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.width}</span>px`</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-string">`<span class="hljs-subst">${imgRect.height}</span>px`</span>,
    };

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute pointer-events-none"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{imgStyle}</span>&gt;</span>
        {/* 垂直线 */}
        {Array.from({ length: Math.max(0, columns - 1) }).map((_, i) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">v-</span>${<span class="hljs-attr">i</span>}`}
            <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">commonLineStyles</span>} <span class="hljs-attr">top-0</span> <span class="hljs-attr">bottom-0</span> <span class="hljs-attr">w-</span>[<span class="hljs-attr">1px</span>] <span class="hljs-attr">md:w-</span>[<span class="hljs-attr">2px</span>] <span class="hljs-attr">backdrop-blur-sm</span>`}
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">left:</span> `${((<span class="hljs-attr">i</span> + <span class="hljs-attr">1</span>) * <span class="hljs-attr">100</span>) / <span class="hljs-attr">columns</span>}%`,
              <span class="hljs-attr">transform:</span> "<span class="hljs-attr">translateX</span>(<span class="hljs-attr">-50</span>%)",
            }}
          /&gt;</span>
        ))}
        {/* 水平线 */}
        {Array.from({ length: Math.max(0, rows - 1) }).map((_, i) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">h-</span>${<span class="hljs-attr">i</span>}`}
            <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">commonLineStyles</span>} <span class="hljs-attr">left-0</span> <span class="hljs-attr">right-0</span> <span class="hljs-attr">h-</span>[<span class="hljs-attr">1px</span>] <span class="hljs-attr">md:h-</span>[<span class="hljs-attr">2px</span>] <span class="hljs-attr">backdrop-blur-sm</span>`}
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">top:</span> `${((<span class="hljs-attr">i</span> + <span class="hljs-attr">1</span>) * <span class="hljs-attr">100</span>) / <span class="hljs-attr">rows</span>}%`,
              <span class="hljs-attr">transform:</span> "<span class="hljs-attr">translateY</span>(<span class="hljs-attr">-50</span>%)",
            }}
          /&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  };

  <span class="hljs-comment">// 处理图片切割</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSplitImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!image) <span class="hljs-keyword">return</span>;

    <span class="hljs-title function_">setIsProcessing</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(image);
      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
      <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>([blob], <span class="hljs-string">"image.jpg"</span>, { <span class="hljs-attr">type</span>: blob.<span class="hljs-property">type</span> });

      <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
      formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"image"</span>, file);
      formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"rows"</span>, rows.<span class="hljs-title function_">toString</span>());
      formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">"columns"</span>, columns.<span class="hljs-title function_">toString</span>());

      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/api/split-image"</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
        <span class="hljs-attr">body</span>: formData,
      });

      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();

      <span class="hljs-keyword">if</span> (data.<span class="hljs-property">error</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(data.<span class="hljs-property">error</span>);
      }

      <span class="hljs-title function_">setSplitImages</span>(data.<span class="hljs-property">pieces</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to split image:"</span>, error);
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"图片切割失败，请重试"</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setIsProcessing</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 添加下载单个图片的函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDownloadSingle</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">imageUrl: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(imageUrl);
      <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(blob);
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
      link.<span class="hljs-property">href</span> = url;
      link.<span class="hljs-property">download</span> = <span class="hljs-string">`piece_<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>.png`</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
      link.<span class="hljs-title function_">click</span>();
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"下载失败:"</span>, error);
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"下载失败，请重试"</span>);
    }
  };

  <span class="hljs-comment">// 添加打包下载所有图片的函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDownloadAll</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 如果没有 JSZip，需要先动态导入</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">JSZip</span> = (<span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"jszip"</span>)).<span class="hljs-property">default</span>;
      <span class="hljs-keyword">const</span> zip = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSZip</span>();

      <span class="hljs-comment">// 添加所有图片到 zip</span>
      <span class="hljs-keyword">const</span> promises = splitImages.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (imageUrl, index) =&gt; {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(imageUrl);
        <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
        zip.<span class="hljs-title function_">file</span>(<span class="hljs-string">`piece_<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>.png`</span>, blob);
      });

      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);

      <span class="hljs-comment">// 生成并下载 zip 文件</span>
      <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> zip.<span class="hljs-title function_">generateAsync</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">"blob"</span> });
      <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">createObjectURL</span>(content);
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"a"</span>);
      link.<span class="hljs-property">href</span> = url;
      link.<span class="hljs-property">download</span> = <span class="hljs-string">"split_images.zip"</span>;
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(link);
      link.<span class="hljs-title function_">click</span>();
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">removeChild</span>(link);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(url);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"打包下载失败:"</span>, error);
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">"打包下载失败，请重试"</span>);
    }
  };

  <span class="hljs-comment">// 修改预览区域的渲染函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderPreview</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!image) {
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>切割后的图片预览<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }

    <span class="hljs-keyword">if</span> (isProcessing) {
      <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>正在处理中...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
    }

    <span class="hljs-keyword">if</span> (splitImages.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative w-full h-full flex items-center justify-center"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"grid gap-[3px] bg-[#242c3e]"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">gridTemplateColumns:</span> `<span class="hljs-attr">repeat</span>(${<span class="hljs-attr">columns</span>}, <span class="hljs-attr">1fr</span>)`,
              <span class="hljs-attr">gridTemplateRows:</span> `<span class="hljs-attr">repeat</span>(${<span class="hljs-attr">rows</span>}, <span class="hljs-attr">1fr</span>)`,
              <span class="hljs-attr">width:</span> <span class="hljs-attr">imageRef.current</span>?<span class="hljs-attr">.width</span> || "<span class="hljs-attr">100</span>%",
              <span class="hljs-attr">height:</span> <span class="hljs-attr">imageRef.current</span>?<span class="hljs-attr">.height</span> || "<span class="hljs-attr">100</span>%",
              <span class="hljs-attr">maxWidth:</span> "<span class="hljs-attr">100</span>%",
              <span class="hljs-attr">maxHeight:</span> "<span class="hljs-attr">100</span>%",
            }}
          &gt;</span>
            {splitImages.map((src, index) =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative group"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                  <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span>
                  <span class="hljs-attr">alt</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">切片</span> ${<span class="hljs-attr">index</span> + <span class="hljs-attr">1</span>}`}
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full h-full object-cover"</span>
                /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleDownloadSingle(src, index)}
                  className="absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity"
                &gt;
                  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"w-6 h-6 text-white"</span>
                    <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                    <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span>
                    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
                  &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                      <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span>
                      <span class="hljs-attr">d</span>=<span class="hljs-string">"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"</span>
                    /&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      );
    }

    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>点击切割按钮开始处理<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"fixed inset-0 bg-[#0B1120] -z-10"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"min-h-screen w-full py-16 md:py-20"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container mx-auto px-4 sm:px-6 max-w-7xl"</span>&gt;</span>
          {/* 标题区域 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-center mb-12 md:mb-16"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl md:text-4xl lg:text-5xl font-bold mb-4 animate-fade-in"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-transparent bg-clip-text bg-[size:400%] animate-gradient"</span>&gt;</span>
                图片切割工具
              <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400 text-base md:text-lg max-w-2xl mx-auto animate-fade-in-up"</span>&gt;</span>
              上传一张图片，快速将其切割成网格布局，支持自定义行列数。
            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 图片区域 - 调整高度和响应式布局 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 mb-12 md:mb-16"</span>&gt;</span>
            {/* 上传区域 - 调整高度 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative h-[400px] md:h-[500px] lg:h-[600px] bg-[#1a2234] rounded-xl overflow-hidden"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
                <span class="hljs-attr">ref</span>=<span class="hljs-string">{fileInputRef}</span>
                <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span>
                <span class="hljs-attr">accept</span>=<span class="hljs-string">"image/*"</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">"hidden"</span>
                <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
                  const file = e.target.files?.[0];
                  if (file) handleFileUpload(file);
                }}
                id="imageUpload"
              /&gt;
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span>
                <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">"imageUpload"</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute inset-0 flex flex-col items-center justify-center cursor-pointer"</span>
              &gt;</span>
                {image ? (
                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"relative w-full h-full flex items-center justify-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                      <span class="hljs-attr">ref</span>=<span class="hljs-string">{imageRef}</span>
                      <span class="hljs-attr">src</span>=<span class="hljs-string">{image}</span>
                      <span class="hljs-attr">alt</span>=<span class="hljs-string">"上传的图片"</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-full max-h-full object-contain"</span>
                      <span class="hljs-attr">onLoad</span>=<span class="hljs-string">{handleImageLoad}</span>
                      <span class="hljs-attr">key</span>=<span class="hljs-string">{image}</span>
                    /&gt;</span>
                    {renderGuideLines()}
                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                ) : (
                  <span class="hljs-tag">&lt;&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4 rounded-full bg-[#242c3e] mb-4"</span>&gt;</span>
                      <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                        <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 text-gray-400"</span>
                        <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                        <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span>
                        <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
                      &gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                          <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">"round"</span>
                          <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">"round"</span>
                          <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{1.5}</span>
                          <span class="hljs-attr">d</span>=<span class="hljs-string">"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"</span>
                        /&gt;</span>
                      <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400"</span>&gt;</span>点击或拖拽图片到这里上传<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                  <span class="hljs-tag">&lt;/&gt;</span>
                )}
              <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

            {/* 预览区域 - 调整高度 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-[400px] md:h-[500px] lg:h-[600px] bg-[#1a2234] rounded-xl flex items-center justify-center"</span>&gt;</span>
              {renderPreview()}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 控制器 - 添加上下边距的容器 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"py-4 md:py-6"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col sm:flex-row items-center justify-center gap-4 md:gap-6"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-[#1a2234] rounded-xl px-5 py-2.5 flex items-center gap-4 border border-[#242c3e] w-full sm:w-auto"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400 font-medium min-w-[40px]"</span>&gt;</span>
                    行数
                  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center gap-2 bg-[#242c3e] rounded-lg p-1 flex-1 sm:flex-none justify-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setRows(Math.max(1, rows - 1))}
                    &gt;
                      -
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-white min-w-[32px] text-center font-medium"</span>&gt;</span>
                      {rows}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setRows(rows + 1)}
                    &gt;
                      +
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-[#1a2234] rounded-xl px-5 py-2.5 flex items-center gap-4 border border-[#242c3e] w-full sm:w-auto"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-gray-400 font-medium min-w-[40px]"</span>&gt;</span>
                    列数
                  <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center gap-2 bg-[#242c3e] rounded-lg p-1 flex-1 sm:flex-none justify-center"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setColumns(Math.max(1, columns - 1))}
                    &gt;
                      -
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-white min-w-[32px] text-center font-medium"</span>&gt;</span>
                      {columns}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                      <span class="hljs-attr">className</span>=<span class="hljs-string">"w-8 h-8 flex items-center justify-center text-white rounded-lg hover:bg-blue-500 transition-colors"</span>
                      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setColumns(columns + 1)}
                    &gt;
                      +
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-5 py-2.5 bg-[#1a2234] text-gray-400 rounded-xl hover:bg-[#242c3e] hover:text-white transition-all font-medium border border-[#242c3e] w-full sm:w-auto"</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                    setRows(3);
                    setColumns(3);
                  }}
                &gt;
                  重置
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex flex-col sm:flex-row gap-4 w-full sm:w-auto"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 font-medium shadow-lg shadow-blue-500/20 w-full sm:w-auto"</span>
                  <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!image</span> || <span class="hljs-attr">isProcessing</span>}
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleSplitImage}</span>
                &gt;</span>
                  {isProcessing ? "处理中..." : "切割图片"}
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl hover:from-red-600 hover:to-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed font-medium shadow-lg shadow-red-500/20 w-full sm:w-auto"</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                    setImage(null);
                    setSplitImages([]);
                    setImageLoaded(false);

                    if (fileInputRef.current) {
                      fileInputRef.current.value = "";
                    }
                  }}
                  disabled={!image}
                &gt;
                  清除
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

              {/* 下载按钮 */}
              {splitImages.length &gt; 0 &amp;&amp; (
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleDownloadAll}</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 transition-all font-medium shadow-lg shadow-green-500/20 flex items-center justify-center gap-2 w-full sm:w-auto"</span>
                &gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"w-5 h-5"</span>
                    <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                    <span class="hljs-attr">stroke</span>=<span class="hljs-string">"currentColor"</span>
                    <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>
                  &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                      <span class="hljs-attr">strokeLinecap</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeLinejoin</span>=<span class="hljs-string">"round"</span>
                      <span class="hljs-attr">strokeWidth</span>=<span class="hljs-string">{2}</span>
                      <span class="hljs-attr">d</span>=<span class="hljs-string">"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"</span>
                    /&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                  打包下载
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              )}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 底部留白 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-16 md:h-20"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Home</span>;
</code></pre>
<p>在上面的代码中，当用户上传图片兵当图片加载完成之后，renderGuideLines 方法会绘制图片的切割网格，显示垂直和水平的分隔线，便于用户预览切割后的效果。</p>
<p>它会根据用户设置的行数（rows）和列数（columns），这些切割线将被动态渲染。用户设置完行列数后，点击 "切割图片" 按钮，会触发 handleSplitImage 函数，将图片传递到后端进行切割。图片会被发送到后端接口 /api/split-image，并返回切割后的图片数据（即每个小图的 URL）。</p>
<p>最终 ui 效果如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c7e71c2cdbb40eabf5f6a78eff72a2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119596&amp;x-signature=ubudRkRxtENlOB7m7lF7eRv%2FeeA%3D" alt="20250218163115" loading="lazy"/></p>
<h2 data-id="heading-1">设计 API</h2>
<p>前面的内容中，我们已经编写了前端的 ui，接下来我们要设计我们的 api 接口以支持前端页面调用。</p>
<p>首先我们要先知道一个概念，sharp 是一个高性能的 Node.js 图像处理库，支持各种常见的图像操作，如裁剪、调整大小、旋转、转换格式等。它基于 libvips（一个高效的图像处理库），与其他一些图像处理库相比，它的处理速度更快，内存消耗也更低。</p>
<p>而 Next.js 是一个服务器端渲染（SSR）的框架，可以通过 API 路由来处理用户上传的文件。在 API 路由中使用 sharp 可以确保图像在服务器端得到处理，而不是在客户端进行，这样可以减轻客户端的负担，并且保证图像在服务器上处理完成后再发送到客户端，从而提高页面加载速度。</p>
<p>如下代码所示：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> sharp <span class="hljs-keyword">from</span> <span class="hljs-string">"sharp"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NextResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">POST</span>(<span class="hljs-params">request: Request</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">formData</span>();
    <span class="hljs-keyword">const</span> file = data.<span class="hljs-title function_">get</span>(<span class="hljs-string">"image"</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">File</span>;
    <span class="hljs-keyword">const</span> rows = <span class="hljs-title class_">Number</span>(data.<span class="hljs-title function_">get</span>(<span class="hljs-string">"rows"</span>));
    <span class="hljs-keyword">const</span> columns = <span class="hljs-title class_">Number</span>(data.<span class="hljs-title function_">get</span>(<span class="hljs-string">"columns"</span>));

    <span class="hljs-keyword">if</span> (!file || !rows || !columns) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Missing required parameters"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-keyword">if</span> (!file.<span class="hljs-property">type</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">"image/"</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid file type"</span> }, { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> });
    }

    <span class="hljs-keyword">const</span> buffer = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">await</span> file.<span class="hljs-title function_">arrayBuffer</span>());

    <span class="hljs-keyword">if</span> (!buffer || buffer.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid image buffer"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-keyword">const</span> image = <span class="hljs-title function_">sharp</span>(buffer);
    <span class="hljs-keyword">const</span> metadata = <span class="hljs-keyword">await</span> image.<span class="hljs-title function_">metadata</span>();

    <span class="hljs-keyword">if</span> (!metadata.<span class="hljs-property">width</span> || !metadata.<span class="hljs-property">height</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid image metadata"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Processing image:"</span>, {
      <span class="hljs-attr">width</span>: metadata.<span class="hljs-property">width</span>,
      <span class="hljs-attr">height</span>: metadata.<span class="hljs-property">height</span>,
      <span class="hljs-attr">format</span>: metadata.<span class="hljs-property">format</span>,
      rows,
      columns,
    });

    <span class="hljs-keyword">const</span> <span class="hljs-attr">pieces</span>: <span class="hljs-built_in">string</span>[] = [];
    <span class="hljs-keyword">const</span> width = metadata.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">const</span> height = metadata.<span class="hljs-property">height</span>;
    <span class="hljs-keyword">const</span> pieceWidth = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(width / columns);
    <span class="hljs-keyword">const</span> pieceHeight = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(height / rows);

    <span class="hljs-keyword">if</span> (pieceWidth &lt;= <span class="hljs-number">0</span> || pieceHeight &lt;= <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
        { <span class="hljs-attr">error</span>: <span class="hljs-string">"Invalid piece dimensions"</span> },
        { <span class="hljs-attr">status</span>: <span class="hljs-number">400</span> }
      );
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; rows; i++) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; columns; j++) {
        <span class="hljs-keyword">const</span> left = j * pieceWidth;
        <span class="hljs-keyword">const</span> top = i * pieceHeight;
        <span class="hljs-keyword">const</span> currentWidth = j === columns - <span class="hljs-number">1</span> ? width - left : pieceWidth;
        <span class="hljs-keyword">const</span> currentHeight = i === rows - <span class="hljs-number">1</span> ? height - top : pieceHeight;

        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> piece = <span class="hljs-keyword">await</span> image
            .<span class="hljs-title function_">clone</span>()
            .<span class="hljs-title function_">extract</span>({
              left,
              top,
              <span class="hljs-attr">width</span>: currentWidth,
              <span class="hljs-attr">height</span>: currentHeight,
            })
            .<span class="hljs-title function_">toBuffer</span>();

          pieces.<span class="hljs-title function_">push</span>(
            <span class="hljs-string">`data:image/<span class="hljs-subst">${metadata.format}</span>;base64,<span class="hljs-subst">${piece.toString(<span class="hljs-string">"base64"</span>)}</span>`</span>
          );
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error processing piece:"</span>, { i, j, err });
          <span class="hljs-keyword">throw</span> err;
        }
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>({ pieces });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error processing image:"</span>, error);

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NextResponse</span>.<span class="hljs-title function_">json</span>(
      {
        <span class="hljs-attr">error</span>: <span class="hljs-string">"Failed to process image"</span>,
        <span class="hljs-attr">details</span>: error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">"Unknown error"</span>,
      },
      { <span class="hljs-attr">status</span>: <span class="hljs-number">500</span> }
    );
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">api</span>: {
    <span class="hljs-attr">bodyParser</span>: {
      <span class="hljs-attr">sizeLimit</span>: <span class="hljs-string">"10mb"</span>,
    },
  },
};
</code></pre>
<p>在上面的这些代码中，它的具体流程如下：</p>
<ol>
<li>
<p>接收请求：首先通过 POST 方法接收包含图片和切割参数（行数和列数）的表单数据。request.formData() 用来解析表单数据并提取文件和参数。</p>
</li>
<li>
<p>参数验证：检查文件类型是否为图片，确保上传数据完整且有效。如果缺少必需的参数或上传的不是图片，返回相应的错误信息。</p>
</li>
<li>
<p>图片处理：通过 sharp 库将图片数据转换为可操作的 Buffer，然后获取图片的元数据（如宽度、高度、格式）。如果图片的元数据无效或获取不到，返回错误。</p>
</li>
<li>
<p>计算切割尺寸：根据用户输入的行数和列数计算每个小块的宽高，并检查计算出来的尺寸是否有效。如果计算出的尺寸不合适，返回错误。</p>
</li>
<li>
<p>图片切割：使用 sharp 的 extract 方法对图片进行切割。每次提取一个小块后，将其转换为 base64 编码的字符串，并保存到 pieces 数组中。</p>
</li>
<li>
<p>返回结果：成功处理后，将切割后的图片数据作为 JSON 响应返回，每个图片切块以 base64 编码形式存储。若遇到错误，捕获并返回详细的错误信息。</p>
</li>
<li>
<p>配置：通过 config 配置，设置请求体的最大大小限制为 10MB，防止上传过大的文件导致请求失败。</p>
</li>
</ol>
<p>这里的代码完成之后，我们还要设计一下 next.config.mjs 文件，如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** <span class="hljs-doctag">@type</span> {<span class="hljs-type">import('next').NextConfig</span>} */</span>
<span class="hljs-keyword">const</span> nextConfig = {
  <span class="hljs-attr">webpack</span>: <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    config.<span class="hljs-property">externals</span> = [...config.<span class="hljs-property">externals</span>, <span class="hljs-string">"sharp"</span>];
    <span class="hljs-keyword">return</span> config;
  },
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<p>当我们点击切割图片的时候，最终生成的效果如下图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f458680138c47b3b0c19f6b94d7fe28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764119596&amp;x-signature=%2BEN6DjJ1SkO8XELRCVvcoJ8036c%3D" alt="20250218164009" loading="lazy"/></p>
<h2 data-id="heading-2">总结</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2Fimage" target="_blank" title="https://github.com/xun082/image" ref="nofollow noopener noreferrer">完整项目地址</a></p>
<p>如果你想参与进来开发或者想进群学习，可以添加我微信 <code>yunmz777</code>，后面还会有很多需求，等这个项目完成之后还会有很多新的并且很有趣的开源项目等着你。</p>
<p>如果该项目对你有帮助或者对这个项目感兴趣，欢迎 Star⭐️⭐️⭐️</p>
<p>最后再来提一些这两个开源项目，它们都是我们目前正在维护的开源项目：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2Fonline-edit-web" target="_blank" title="https://github.com/xun082/online-edit-web" ref="nofollow noopener noreferrer">在线代码协同编辑器</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2Fcreate-neat" target="_blank" title="https://github.com/xun082/create-neat" ref="nofollow noopener noreferrer">前端脚手架 create-neat</a></p>
</li>
</ul>
<p>🐒🐒🐒</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Reqable 3.0版本云同步的实践过程]]></title>    <link>https://juejin.cn/post/7573995798604021775</link>    <guid>https://juejin.cn/post/7573995798604021775</guid>    <pubDate>2025-11-19T07:45:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573995798604021775" data-draft-id="7573989365614510080" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Reqable 3.0版本云同步的实践过程"/> <meta itemprop="keywords" content="前端,后端,测试"/> <meta itemprop="datePublished" content="2025-11-19T07:45:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MegatronKing"/> <meta itemprop="url" content="https://juejin.cn/user/2559318798642792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Reqable 3.0版本云同步的实践过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2559318798642792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MegatronKing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T07:45:38.000Z" title="Wed Nov 19 2025 07:45:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Reqable 3.0上线了的云服务功能，支持数据云端存储和多设备实时同步，就这一个不大不小的功能却花费了我们很大的心思和精力，今天写了这篇文章来和大家分享一下我们的实践过程。</p>
<p>首先，大家可以先看看下面的Reqable的多设备云同步的视频，左边是手机，右边是电脑。在右边电脑上操作数据时，左边手机上可以实时看到最新的API数据，这对团队多人协作非常有用！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5768f3c202be41f08bd3a9f1d4af7348~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWVnYXRyb25LaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764143138&amp;x-signature=HhOi1txzLWLY7kT6j%2BiEGDnak5s%3D" alt="output.gif" loading="lazy"/></p>
<p>下面简单聊聊我们的思考和实践过程。</p>
<h3 data-id="heading-0">1. 方案调研</h3>
<p>仅仅实现数据存储到云端其实并不难，暴力点一个上传和一个下载接口可能就干完事了。但是为了用户体验我们并不能这么做，有很多需要考虑的点，比如下面这些。</p>
<ul>
<li>
<p>数据何时上传，何时下载？这个问题本质其实就是如何保证本地数据和云端数据的时效性。简单点的方式，是交给用户去操作，用户手动触发上传云端，手动触发从云端下载。逻辑复杂些，再增加一个定时逻辑，每隔一段时间和服务器交互一次，上传数据或者下载数据。让用户来操作，体验必然不会很好，比如数据忘记同步了等等。</p>
</li>
<li>
<p>如何解决数据版本冲突？单设备的情况下，不会出现数据版本问题。但是多设备的时候，必然会出现版本冲突问题。比如两台设备同时上传数据，这个问题其实好解决，先来先存储，后到的失败。这个问题衍生开来，还有一些情况，例如本地数据和云端数据都更新了采用哪一个，无论最后是保留本地数据还是保留云端数据，都有数据丢失了，丢失数据的概率和多少取决于上一个问题中同步的时效性，同步的间隔越长，丢失数据的概率和数据量就越大。</p>
</li>
<li>
<p>如何上传，如何下载？在数据量不大的情况下，把所有数据一起丢到接口就可以了，但是如果数据量大了，就非常不合适了，同步时间变慢不说，服务器的带宽也吃不消。我们没办法控制用户接口到底有多少，可能一个API的请求体就好几M了。对此，我们只能做增量更新，比如可以考虑用git来管理数据。为了用户体验，我们决定既要做实时又要做增量更新。无论是REST接口，还是GIT管理，或者是Webdav同步文件，似乎都无法满足，我们只能自己来造个轮子了。</p>
</li>
</ul>
<h3 data-id="heading-1">2. WebSocket长连接</h3>
<p>因为考虑到要做实时性，我们只能上长连接了。常用的长连接网络通信方案有WebSocket、MQTT、HTTP2等，相对来说WebSocket更加稳妥一点，这也是我们目前采用的方案。</p>
<p>至于增量上传，就是用户每一个操作都需要实时通过WebSocket来与服务器进行同步，比如创建了一个API请求，修改了某个环境变量，修改了API请求的数据，删除了集合等等，无需将全部数据都上传到服务器，只需将用户的操作指令和操作的相关的数据上传即可。</p>
<p>服务器接收到用户的操作指令后，更新云端数据，再将操作指令和数据发送给所有连接的其他设备，其他设备接收到服务器下发的指令后更新本地数据，这样保证服务器和所有的客户端数据都是最新且一致的。</p>
<p>增量更新很容易出现数据版本不一致的问题，比如某台设备接收到操作指令后数据处理出错，这时候这台设备的数据就无法和其他设备保持一致了，这种情况我们就需要做全量同步了。此外，每次启动应用加载数据后，为了保持数据一致，我们也要做全量同步。</p>
<p>全量同步如果触发太过频繁，对服务器也是一个很大的压力，比如用户有几十个API集合，仅仅因为一个操作指令没法完成，所有集合数据都从服务器下载一遍，就太浪费资源了。为此，我们给每个API集合都增加了一个revision字段，服务端集合数据每更新一次revision值都加1，客户端请求全量同步的时候上传本地的revision，如果本地的revision和服务端相同，服务器就无需将数据同步给客户端。</p>
<h3 data-id="heading-2">3. 离完美还有距离</h3>
<p>我们这种方案虽然解决了数据实时性和数据增量更新两个问题，但是却有一个非常大的缺点，就是太依赖服务器了。如果服务器故障或者用户设备离线，用户的操作指令无法同步到服务器，该怎么办？</p>
<p>一种方案是把用户的操作指令和数据全部存储到本地，等网络恢复再同步。但是操作指令囤积过多又该怎么办，缓存数据会爆炸；另外，就多台设备都缓存了操作指令，同时都同步到服务器该怎么处理。</p>
<p>对于这个问题我们也没想到什么好的解决方案，只好学竞品Postman等一样，在无法连接服务器的时候集合变成只读状态。当然，和Postman完全依赖云端不同，Reqable不会出现集合数据加载不出来的情况，在本地仍然会有数据。即使我们服务器故障，用户仍然可以正常查看集合数据和进行API测试，也可以新建API测试，基本上不会中断大家的工作，限制就是新建或者修改的API无法保存到集合，集合内的数据也没办法删除。</p>
<h3 data-id="heading-3">4. 服务端设计</h3>
<p>在之前我们对后端是用Java还是Python来实现纠结了很久，最终采纳了多数的建议使用Java，首选当然是Spring Boot了。我们之前后端是使用Dart来写的，这次全部使用Java来重写了。</p>
<p>我们把后端分成了多个子项目来实现，例如常用的接口API，登录注册等等作为一个子项目，云服务作为另一个子项目，和产品功能不相关的像事件统计也单独拆分出来，每个子项目放在不同的服务器上单独部署。这样有个好处，像常规的接口更新会比较频繁，重新部署用户也不会有感知，像云服务使用长连接，我们尽量不去动，因为只要一重新部署所有客户端都会感知到。另外一个考虑，按照我们的规划，云服务这部分代码后面会开源出来，供用户私有部署，如果不放心将数据存储到我们服务器上面的话。</p>
<p>对于数据存储，我们采购了腾讯云的高可用MySQL数据，自带容灾。为了稳妥起见，我们还会每日将数据自动备份到阿里云，毕竟鸡蛋不能放一个篮子里，大家的数据是无价的。</p>
<h3 data-id="heading-4">5. 后续规划</h3>
<p>目前阶段，多设备同步只能在同一个账户下面进行，后续我们会增加团队功能，同一个团队成员之间可以访问和同步同一个集合的数据。另外，就是不同团队不同账户之间的数据分享功能，例如可以在Reqable内将数据直接分享给指定的用户。</p>
<p>另外一个重要的事项，就是如何让用户自行部署，由于新版本刚上线，还有许多地方需要再思虑和打磨，项目还会有不小的变动，这事情也急不得。</p>
<h3 data-id="heading-5">6. 竞品对比</h3>
<p>最后，简单聊聊一些知名竞品的实现方案，以及各自的优缺点。</p>
<ul>
<li>
<p>Postman，方案和我们类似，也是通过WebSocket向服务器同步用户的操作指令并接收其他账户或者设备的修改指令，然后更新云端和本地数据。只要无法连接服务器，API集合便会进入只读状态。但是我们两者有一个最大的不同点，Postman本质是个浏览器，数据每次都需要从服务器拉取，而且数据只是缓存在本地而不是存储在本地，断网打开Postman可以看到什么数据都没有，加载不出来，直接影响到用户的工作，而Reqable本地的数据仍然可以查看和使用。</p>
</li>
<li>
<p>Bruno，主要是通过Git来管理和同步数据，这也是我们曾经思考过的方案之一。Bruno使用文件来组织API数据，通过Git命令来提交和更新文件。由于使用文本描述语言，可以直观地让用户处理数据版本冲突。缺点是无法做到实时同步，上传数据，需要修改、提交、推送三步走，下载数据还需要暂存本地的修改，其实并不是很方便。</p>
</li>
</ul>
<h3 data-id="heading-6">7. 结语</h3>
<p>Reqable虽然还有很多不完善的地方，但我们一直在努力更新，一步一个脚印，致力于做最好的API工具，希望大家支持！欢迎访问我们的网站：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freqable.com%2F" target="_blank" title="https://reqable.com/" ref="nofollow noopener noreferrer">reqable.com/</a></p>
<p>谢谢大家！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue.js 项目静态资源 OSS 部署完整实现指南]]></title>    <link>https://juejin.cn/post/7573900332637798410</link>    <guid>https://juejin.cn/post/7573900332637798410</guid>    <pubDate>2025-11-19T01:38:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573900332637798410" data-draft-id="7573899782803882030" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue.js 项目静态资源 OSS 部署完整实现指南"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-19T01:38:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浮游本尊"/> <meta itemprop="url" content="https://juejin.cn/user/2533726710668696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue.js 项目静态资源 OSS 部署完整实现指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533726710668696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浮游本尊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:38:13.000Z" title="Wed Nov 19 2025 01:38:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    34
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#%E8%83%8C%E6%99%AF%E4%B8%8E%E9%9C%80%E6%B1%82" title="#%E8%83%8C%E6%99%AF%E4%B8%8E%E9%9C%80%E6%B1%82">背景与需求</a></li>
<li><a href="#%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1" title="#%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88%E8%AE%BE%E8%AE%A1">技术方案设计</a></li>
<li><a href="#vue-cli-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3" title="#vue-cli-%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3">Vue CLI 配置详解</a></li>
<li><a href="#oss-%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE" title="#oss-%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE">OSS 工具安装与配置</a></li>
<li><a href="#%E4%B8%8A%E4%BC%A0%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99" title="#%E4%B8%8A%E4%BC%A0%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99">上传脚本编写</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B" title="#%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B">部署流程</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">注意事项与最佳实践</a></li>
<li><a href="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" title="#%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">问题排查</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">背景与需求</h2>
<h3 data-id="heading-2">业务场景</h3>
<p>在大型前端项目的生产环境部署中，静态资源（JS、CSS、字体文件等）通常占据较大的体积。将这些资源部署到对象存储服务（OSS）并通过 CDN 加速，可以带来以下优势：</p>
<ol>
<li><strong>减轻服务器压力</strong>：静态资源不再占用应用服务器的带宽和存储</li>
<li><strong>提升访问速度</strong>：CDN 边缘节点就近分发，降低延迟</li>
<li><strong>降低服务器成本</strong>：减少服务器带宽和存储需求</li>
<li><strong>提高可用性</strong>：CDN 的高可用性保障</li>
</ol>
<h3 data-id="heading-3">需求分析</h3>
<p>我们的项目需要实现以下功能：</p>
<ul>
<li><strong>环境区分</strong>：测试环境使用本地资源，生产环境使用 OSS CDN</li>
<li><strong>选择性上传</strong>：只上传 <code>static/css/</code>、<code>static/fonts/</code>、<code>static/js/</code> 目录</li>
<li><strong>路径处理</strong>：<code>favicon.ico</code> 和 <code>styles/</code> 目录不上传 OSS，使用相对路径</li>
<li><strong>自动化部署</strong>：通过脚本自动化完成上传流程</li>
<li><strong>版本管理</strong>：通过文件 hash 实现缓存控制</li>
</ul>
<hr/>
<h2 data-id="heading-4">技术方案设计</h2>
<h3 data-id="heading-5">架构设计</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────┐
│  本地开发环境    │  → 相对路径 (/)
└─────────────────┘

┌─────────────────┐
│  测试环境构建    │  → 相对路径 (/) → 直接部署
└─────────────────┘

┌─────────────────┐
│  生产环境构建    │  → CDN 路径 (https://cdn.example.com/)
└─────────────────┘
         │
         ├─→ static/css/   → 上传 OSS
         ├─→ static/fonts/ → 上传 OSS
         ├─→ static/js/    → 上传 OSS
         ├─→ favicon<span class="hljs-selector-class">.ico</span>   → 不上传（相对路径）
         └─→ styles/       → 不上传（相对路径）
</code></pre>
<h3 data-id="heading-6">技术选型</h3>
<ul>
<li><strong>构建工具</strong>：Vue CLI（基于 Webpack）</li>
<li><strong>OSS 工具</strong>：ossutil（阿里云官方命令行工具）</li>
<li><strong>脚本语言</strong>：Bash Shell</li>
<li><strong>路径处理</strong>：Webpack 插件 + 自定义 HTML 修改插件</li>
</ul>
<hr/>
<h2 data-id="heading-7">Vue CLI 配置详解</h2>
<h3 data-id="heading-8">1. publicPath 动态配置</h3>
<p><code>publicPath</code> 决定了构建后资源的引用路径。我们需要根据环境变量动态设置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">publicPath</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">CDN_URL</span> || 
    (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span> ? <span class="hljs-string">'/'</span> : <span class="hljs-comment">// 本地开发环境</span>
     process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_PATH_TYPE</span> === <span class="hljs-string">'gray'</span> ? <span class="hljs-string">'/'</span> : <span class="hljs-comment">// 测试环境使用相对路径</span>
     <span class="hljs-string">'https://js-cdn.m.cc/'</span>), <span class="hljs-comment">// 生产环境使用 CDN</span>
  <span class="hljs-attr">outputDir</span>: <span class="hljs-string">'dist'</span>,
  <span class="hljs-attr">assetsDir</span>: <span class="hljs-string">'static'</span>,
  <span class="hljs-attr">filenameHashing</span>: <span class="hljs-literal">true</span>,
}
</code></pre>
<p><strong>关键点说明</strong>：</p>
<ul>
<li><code>assetsDir: 'static'</code>：所有资源输出到 <code>static/</code> 目录</li>
<li><code>filenameHashing: true</code>：启用文件名 hash，实现缓存控制</li>
<li>环境判断逻辑：
<ul>
<li>开发环境：始终使用相对路径</li>
<li>测试环境（<code>VUE_APP_PATH_TYPE === 'gray'</code>）：使用相对路径</li>
<li>生产环境：使用 CDN 路径</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">2. 输出文件名配置</h3>
<p>为了确保文件路径的一致性，需要显式设置输出文件名：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">configureWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 统一使用 static/js/ 路径，与 assetsDir 保持一致</span>
  config.<span class="hljs-property">output</span>.<span class="hljs-property">filename</span> = <span class="hljs-string">'static/js/[name].[hash:8].js'</span>
  config.<span class="hljs-property">output</span>.<span class="hljs-property">chunkFilename</span> = <span class="hljs-string">'static/js/[name].[hash:8].js'</span>
}
</code></pre>
<p><strong>为什么需要显式设置</strong>？</p>
<p>虽然 <code>assetsDir: 'static'</code> 会自动处理路径，但显式设置可以：</p>
<ul>
<li>确保所有环境路径一致</li>
<li>避免不同 Webpack 版本的差异</li>
<li>便于后续维护和理解</li>
</ul>
<h3 data-id="heading-10">3. HTML 路径修改插件</h3>
<p>生产环境需要特殊处理：静态资源使用 CDN，但 <code>favicon.ico</code> 和 <code>styles/</code> 使用相对路径。</p>
<p><strong>实现原理</strong>：</p>
<p>在 Webpack 的 <code>emit</code> 阶段（生成文件后，写入磁盘前），通过自定义插件修改 HTML 内容：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">chainWebpack</span>: <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 只在生产环境（非测试环境）运行</span>
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span> &amp;&amp; process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_APP_PATH_TYPE</span> !== <span class="hljs-string">'gray'</span>) {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModifyHtmlPlugin</span> {
      <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
        compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">'ModifyHtmlPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> {
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">filename</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (filename.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.html'</span>)) {
              <span class="hljs-keyword">let</span> html = compilation.<span class="hljs-property">assets</span>[filename].<span class="hljs-title function_">source</span>()
              
              <span class="hljs-comment">// 1. 先处理 BASE_URL 变量（如果还没被 Vue CLI 替换）</span>
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="&lt;%= BASE_URL %&gt;favicon\.ico"/g</span>, <span class="hljs-string">'href="/favicon.ico"'</span>)
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="&lt;%= BASE_URL %&gt;styles\/([^"]+)"/g</span>, <span class="hljs-string">'href="/styles/$1"'</span>)
              
              <span class="hljs-comment">// 2. 替换其他 BASE_URL 变量为 CDN 路径</span>
              <span class="hljs-keyword">const</span> baseUrl = process.<span class="hljs-property">env</span>.<span class="hljs-property">CDN_URL</span> || <span class="hljs-string">'https://js-cdn.m.cc/'</span>
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;%= BASE_URL %&gt;/g</span>, baseUrl)
              
              <span class="hljs-comment">// 3. 最后处理已经被替换的 CDN 路径（将 favicon 和 styles 改回相对路径）</span>
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="https:\/\/js-cdn\.modb\.cc\/favicon\.ico"/g</span>, <span class="hljs-string">'href="/favicon.ico"'</span>)
              html = html.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/href="https:\/\/js-cdn\.modb\.cc\/styles\/([^"]+)"/g</span>, <span class="hljs-string">'href="/styles/$1"'</span>)
              
              compilation.<span class="hljs-property">assets</span>[filename] = {
                <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> html,
                <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> html.<span class="hljs-property">length</span>
              }
            }
          })
          <span class="hljs-title function_">callback</span>()
        })
      }
    }
    config.<span class="hljs-title function_">plugin</span>(<span class="hljs-string">'modify-html'</span>).<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ModifyHtmlPlugin</span>)
  }
}
</code></pre>
<p><strong>处理顺序的重要性</strong>：</p>
<ol>
<li>先处理 <code>BASE_URL</code> 变量（模板阶段）</li>
<li>替换为 CDN 路径</li>
<li>最后将特定文件改回相对路径</li>
</ol>
<p>这样可以确保所有路径都被正确处理。</p>
<h3 data-id="heading-11">4. 代码分割优化</h3>
<p>为了提升加载性能，我们配置了代码分割：</p>
<pre><code class="hljs language-javascript" lang="javascript">config.<span class="hljs-property">optimization</span>.<span class="hljs-property">splitChunks</span> = {
  <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>,
  <span class="hljs-attr">minSize</span>: <span class="hljs-number">20000</span>,
  <span class="hljs-attr">maxAsyncRequests</span>: <span class="hljs-number">20</span>,
  <span class="hljs-attr">maxInitialRequests</span>: <span class="hljs-number">15</span>,
  <span class="hljs-attr">cacheGroups</span>: {
    <span class="hljs-comment">// Vue 核心库单独拆分</span>
    <span class="hljs-attr">vueCore</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'chunk-vue-core'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/](vue|vue-router|vuex|vue-i18n)[\\/]/</span>,
      <span class="hljs-attr">priority</span>: <span class="hljs-number">40</span>,
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'initial'</span>,
      <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-comment">// 大型 UI 库单独拆分</span>
    <span class="hljs-attr">elementPlus</span>: {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'chunk-element-plus'</span>,
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]element-plus[\\/]/</span>,
      <span class="hljs-attr">priority</span>: <span class="hljs-number">35</span>,
      <span class="hljs-attr">chunks</span>: <span class="hljs-string">'initial'</span>,
      <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-comment">// 其他配置...</span>
  }
}
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>大型库单独拆分，便于缓存</li>
<li>按需加载的库设置为 <code>async</code>，减少初始加载体积</li>
<li>公共代码提取，避免重复打包</li>
</ul>
<hr/>
<h2 data-id="heading-12">OSS 工具安装与配置</h2>
<h3 data-id="heading-13">1. 确定服务器架构</h3>
<p>首先需要确定服务器的 CPU 架构，以选择正确的 ossutil 版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -m
<span class="hljs-comment"># 输出示例：</span>
<span class="hljs-comment"># x86_64  → 使用 ossutil64</span>
<span class="hljs-comment"># aarch64 → 使用 ossutilarm64</span>
</code></pre>
<h3 data-id="heading-14">2. 下载 ossutil</h3>
<p>根据架构下载对应版本（以阿里云 OSS 为例）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建目录</span>
<span class="hljs-built_in">mkdir</span> -p /root/oss
<span class="hljs-built_in">cd</span> /root/oss

<span class="hljs-comment"># 下载对应版本（示例：ARM64 架构）</span>
wget https://gosspublic.alicdn.com/ossutil/1.7.13/ossutilarm64

<span class="hljs-comment"># 或者使用 curl</span>
curl -o ossutilarm64 https://gosspublic.alicdn.com/ossutil/1.7.13/ossutilarm64

<span class="hljs-comment"># 添加执行权限</span>
<span class="hljs-built_in">chmod</span> +x ossutilarm64

<span class="hljs-comment"># 验证安装</span>
/root/oss/ossutilarm64 --version
</code></pre>
<h3 data-id="heading-15">3. 配置 OSS 凭证</h3>
<p>ossutil 支持两种配置方式：</p>
<h4 data-id="heading-16">方式一：命令行配置（临时）</h4>
<pre><code class="hljs language-bash" lang="bash">/root/oss/ossutilarm64 config -e &lt;endpoint&gt; \
  -i &lt;accessKeyId&gt; \
  -k &lt;accessKeySecret&gt;
</code></pre>
<h4 data-id="heading-17">方式二：配置文件（推荐）</h4>
<p>创建配置文件 <code>~/.ossutilconfig</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt; /root/.ossutilconfig &lt;&lt; <span class="hljs-string">'EOF'</span>
[Credentials]
language=EN
endpoint=oss-cn-hangzhou.aliyuncs.com
accessKeyID=YOUR_ACCESS_KEY_ID
accessKeySecret=YOUR_ACCESS_KEY_SECRET
EOF

<span class="hljs-comment"># 设置文件权限（安全考虑）</span>
<span class="hljs-built_in">chmod</span> 600 /root/.ossutilconfig
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>language=EN</code>：使用英文输出，避免编码问题</li>
<li><code>endpoint</code>：OSS 区域节点地址</li>
<li><code>accessKeyID</code> 和 <code>accessKeySecret</code>：OSS 访问凭证</li>
</ul>
<h3 data-id="heading-18">4. 测试连接</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试连接</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/

<span class="hljs-comment"># 如果成功，会显示 OSS 上的文件列表</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">上传脚本编写</h2>
<h3 data-id="heading-20">脚本结构设计</h3>
<p>上传脚本需要包含以下功能：</p>
<ol>
<li><strong>环境检查</strong>：验证构建输出是否存在</li>
<li><strong>连接测试</strong>：确保 OSS 连接正常</li>
<li><strong>清理旧文件</strong>：删除 OSS 上的旧版本文件</li>
<li><strong>上传新文件</strong>：上传指定的目录</li>
<li><strong>验证上传</strong>：确认上传成功</li>
</ol>
<h3 data-id="heading-21">完整脚本示例</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e  <span class="hljs-comment"># 遇到错误立即退出</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Starting OSS upload for production environment..."</span>

<span class="hljs-comment"># ========== 1. OSS 配置 ==========</span>
<span class="hljs-comment"># 如果使用配置文件，可以跳过此步骤</span>
<span class="hljs-comment"># 如果需要动态配置，使用以下命令：</span>
<span class="hljs-comment"># /root/oss/ossutilarm64 config -e &lt;endpoint&gt; \</span>
<span class="hljs-comment">#   -i &lt;accessKeyId&gt; \</span>
<span class="hljs-comment">#   -k &lt;accessKeySecret&gt;</span>

<span class="hljs-comment"># ========== 2. 测试 OSS 连接 ==========</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Testing OSS connection..."</span>
<span class="hljs-keyword">if</span> /root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/ 2&gt;/dev/null &gt; /dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"OSS connection test passed"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: OSS connection test failed, but continuing..."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># ========== 3. 设置构建路径 ==========</span>
DIST_PATH=<span class="hljs-string">"/u01/dist"</span>

<span class="hljs-comment"># ========== 4. 检查构建输出 ==========</span>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span> not found"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Build path: <span class="hljs-variable">$DIST_PATH</span>"</span>

<span class="hljs-comment"># 检查 static 目录</span>
<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span>/static not found"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 检查关键文件</span>
<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/index.html"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span>/index.html not found"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -f <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/favicon.ico"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/favicon.ico not found"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-keyword">if</span> [ ! -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/styles"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/styles directory not found"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># ========== 5. 清理 OSS 上的旧文件 ==========</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Cleaning old files from OSS..."</span>

<span class="hljs-comment"># 删除 OSS 上的 css 目录（使用 -f 参数避免交互式提示）</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Deleting old CSS files..."</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://your-bucket-name/static/css/ -f 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"   (CSS directory may not exist, skipping)"</span>

<span class="hljs-comment"># 删除 OSS 上的 fonts 目录</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Deleting old fonts files..."</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://your-bucket-name/static/fonts/ -f 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"   (Fonts directory may not exist, skipping)"</span>

<span class="hljs-comment"># 删除 OSS 上的 js 目录</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Deleting old JS files..."</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://your-bucket-name/static/js/ -f 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"   (JS directory may not exist, skipping)"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"Old files cleaned (if any existed)"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-comment"># ========== 6. 上传新文件 ==========</span>

<span class="hljs-comment"># 上传 static/css/ 目录</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static/css"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Uploading static/css/ directory..."</span>
    /root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/css/ oss://your-bucket-name/static/css/ -f
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"CSS directory uploaded successfully"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed to upload CSS directory"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/static/css not found, skipping..."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 上传 static/fonts/ 目录</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static/fonts"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Uploading static/fonts/ directory..."</span>
    /root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/fonts/ oss://your-bucket-name/static/fonts/ -f
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Fonts directory uploaded successfully"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed to upload fonts directory"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: <span class="hljs-variable">$DIST_PATH</span>/static/fonts not found, skipping..."</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 上传 static/js/ 目录</span>
<span class="hljs-keyword">if</span> [ -d <span class="hljs-string">"<span class="hljs-variable">$DIST_PATH</span>/static/js"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Uploading static/js/ directory..."</span>
    /root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/js/ oss://your-bucket-name/static/js/ -f
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"JS directory uploaded successfully"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Failed to upload JS directory"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Error: <span class="hljs-variable">$DIST_PATH</span>/static/js not found (required)"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># ========== 7. 验证上传 ==========</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Verifying upload..."</span>

<span class="hljs-comment"># 统计上传的文件数量</span>
JS_COUNT=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/js/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)
CSS_COUNT=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/css/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)
FONTS_COUNT=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/fonts/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Upload completed!"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Upload statistics:"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   JS files: <span class="hljs-variable">$JS_COUNT</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   CSS files: <span class="hljs-variable">$CSS_COUNT</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"   Fonts files: <span class="hljs-variable">$FONTS_COUNT</span>"</span>

<span class="hljs-comment"># 检查关键文件是否存在</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Checking key files..."</span>

JS_CHECK=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/js/app.*.js 2&gt;/dev/null | <span class="hljs-built_in">head</span> -1 | <span class="hljs-built_in">wc</span> -l)
CSS_CHECK=$(/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://your-bucket-name/static/css/app.*.css 2&gt;/dev/null | <span class="hljs-built_in">head</span> -1 | <span class="hljs-built_in">wc</span> -l)

<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$JS_CHECK</span>"</span> -gt 0 ] &amp;&amp; [ <span class="hljs-string">"<span class="hljs-variable">$CSS_CHECK</span>"</span> -gt 0 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Key files app.js and app.css found in OSS"</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Upload verification passed!"</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"Warning: Some key files may be missing"</span>
<span class="hljs-keyword">fi</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"OSS upload process completed!"</span>
</code></pre>
<h3 data-id="heading-22">脚本关键点说明</h3>
<h4 data-id="heading-23">1. <code>set -e</code> 的作用</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> -e
</code></pre>
<p>遇到任何错误立即退出，避免继续执行可能导致的问题。</p>
<h4 data-id="heading-24">2. 使用 <code>-f</code> 参数</h4>
<pre><code class="hljs language-bash" lang="bash">ossutilarm64 <span class="hljs-built_in">rm</span> -r oss://bucket/path/ -f
ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-built_in">local</span>/path/ oss://bucket/path/ -f
</code></pre>
<p><code>-f</code> 参数的作用：</p>
<ul>
<li><code>rm -r -f</code>：强制删除，不询问确认</li>
<li><code>cp -r -f</code>：强制覆盖，不询问确认</li>
</ul>
<p><strong>为什么重要</strong>：在自动化脚本中，交互式提示会导致脚本挂起。</p>
<h4 data-id="heading-25">3. 错误处理</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">command</span> 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"fallback message"</span>
</code></pre>
<ul>
<li><code>2&gt;/dev/null</code>：隐藏错误输出</li>
<li><code>||</code>：如果命令失败，执行后续命令</li>
<li>适用于首次运行（目录可能不存在）的场景</li>
</ul>
<h4 data-id="heading-26">4. 变量命名注意事项</h4>
<p>避免使用可能被系统识别的变量名：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ❌ 不推荐（可能被某些系统识别为系统变量）</span>
BUILD_PATH=<span class="hljs-string">"/u01/dist"</span>

<span class="hljs-comment"># ✅ 推荐</span>
DIST_PATH=<span class="hljs-string">"/u01/dist"</span>
</code></pre>
<h4 data-id="heading-27">5. 文件计数验证</h4>
<pre><code class="hljs language-bash" lang="bash">JS_COUNT=$(ossutilarm64 <span class="hljs-built_in">ls</span> oss://bucket/static/js/ 2&gt;/dev/null | <span class="hljs-built_in">wc</span> -l)
</code></pre>
<p>使用 <code>wc -l</code> 统计文件数量，用于验证上传是否成功。</p>
<hr/>
<h2 data-id="heading-28">部署流程</h2>
<h3 data-id="heading-29">测试环境部署</h3>
<p>测试环境使用相对路径，不需要上传 OSS：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 构建项目</span>
npm run gray

<span class="hljs-comment"># 2. 打包</span>
tar -czf dist.gz dist/

<span class="hljs-comment"># 3. 上传到服务器并解压</span>
scp dist.gz user@server:/path/to/deploy/
ssh user@server <span class="hljs-string">"cd /path/to/deploy &amp;&amp; tar -xzf dist.gz"</span>
</code></pre>
<h3 data-id="heading-30">生产环境部署</h3>
<p>生产环境需要上传资源到 OSS：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 构建项目</span>
npm run build

<span class="hljs-comment"># 2. 打包</span>
tar -czf dist.gz dist/

<span class="hljs-comment"># 3. 上传到服务器</span>
scp dist.gz user@server:/u01/
scp upload-to-oss-production.sh user@server:/u01/

<span class="hljs-comment"># 4. 在服务器上执行部署脚本</span>
ssh user@server &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-built_in">cd</span> /u01
<span class="hljs-built_in">rm</span> -rf dist &amp;&amp; tar -zxvf ./dist.gz
<span class="hljs-built_in">chmod</span> +x upload-to-oss-production.sh
./upload-to-oss-production.sh
EOF
</code></pre>
<h3 data-id="heading-31">完整部署脚本示例</h3>
<p>可以将解压和上传合并到一个脚本中：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">set</span> -e

<span class="hljs-comment"># 解压构建文件</span>
<span class="hljs-built_in">cd</span> /u01
<span class="hljs-built_in">rm</span> -rf dist &amp;&amp; tar -zxvf ./dist.gz

<span class="hljs-comment"># 执行 OSS 上传脚本</span>
./upload-to-oss-production.sh

<span class="hljs-comment"># 部署到 Web 服务器（Nginx 示例）</span>
<span class="hljs-comment"># cp -r dist/* /usr/share/nginx/html/</span>
<span class="hljs-comment"># systemctl reload nginx</span>
</code></pre>
<hr/>
<h2 data-id="heading-32">注意事项与最佳实践</h2>
<h3 data-id="heading-33">1. 安全性</h3>
<h4 data-id="heading-34">凭证管理</h4>
<ul>
<li><strong>不要</strong>在脚本中硬编码凭证</li>
<li><strong>使用</strong>环境变量或配置文件</li>
<li><strong>设置</strong>配置文件权限为 <code>600</code></li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> 600 ~/.ossutilconfig
</code></pre>
<h4 data-id="heading-35">最小权限原则</h4>
<p>为 OSS 访问密钥设置最小必要权限：</p>
<ul>
<li>只允许上传到指定目录</li>
<li>禁止删除其他目录的文件</li>
</ul>
<h3 data-id="heading-36">2. 性能优化</h3>
<h4 data-id="heading-37">并行上传</h4>
<p>对于大量文件，可以考虑并行上传：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用后台任务并行上传</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/css/ oss://bucket/static/css/ -f &amp;
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/fonts/ oss://bucket/static/fonts/ -f &amp;
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-variable">$DIST_PATH</span>/static/js/ oss://bucket/static/js/ -f &amp;

<span class="hljs-comment"># 等待所有任务完成</span>
<span class="hljs-built_in">wait</span>
</code></pre>
<h4 data-id="heading-38">增量上传</h4>
<p>如果文件很多，可以使用 <code>--update</code> 参数进行增量上传：</p>
<pre><code class="hljs language-bash" lang="bash">ossutilarm64 <span class="hljs-built_in">cp</span> -r <span class="hljs-built_in">local</span>/path/ oss://bucket/path/ --update
</code></pre>
<p>但需要注意：如果文件名包含 hash，每次构建都是新文件，增量上传意义不大。</p>
<h3 data-id="heading-39">3. 缓存策略</h3>
<h4 data-id="heading-40">HTTP 缓存头</h4>
<p>在 OSS 控制台或通过 API 设置缓存头：</p>
<pre><code class="hljs language-arduino" lang="arduino">Cache-Control: <span class="hljs-keyword">public</span>, max-age=<span class="hljs-number">31536000</span>
</code></pre>
<p>对于带 hash 的文件名，可以设置长期缓存。</p>
<h4 data-id="heading-41">CDN 缓存</h4>
<p>如果使用 CDN，需要配置：</p>
<ul>
<li>缓存规则：根据文件类型和路径</li>
<li>缓存刷新：更新后及时刷新 CDN 缓存</li>
</ul>
<h3 data-id="heading-42">4. 监控与日志</h3>
<h4 data-id="heading-43">上传日志</h4>
<p>记录上传过程的关键信息：</p>
<pre><code class="hljs language-bash" lang="bash">LOG_FILE=<span class="hljs-string">"/var/log/oss-upload.log"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: Starting OSS upload"</span> &gt;&gt; <span class="hljs-variable">$LOG_FILE</span>
<span class="hljs-comment"># ... 上传过程 ...</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: OSS upload completed"</span> &gt;&gt; <span class="hljs-variable">$LOG_FILE</span>
</code></pre>
<h4 data-id="heading-44">监控告警</h4>
<ul>
<li>监控上传失败率</li>
<li>监控 OSS 存储使用量</li>
<li>监控 CDN 流量</li>
</ul>
<h3 data-id="heading-45">5. 回滚策略</h3>
<h4 data-id="heading-46">保留历史版本</h4>
<p>在删除旧文件前，可以先备份：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 备份当前版本</span>
BACKUP_DIR=<span class="hljs-string">"backup/<span class="hljs-subst">$(date +%Y%m%d_%H%M%S)</span>"</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r oss://bucket/static/ oss://bucket/<span class="hljs-variable">$BACKUP_DIR</span>/ -f
</code></pre>
<h4 data-id="heading-47">快速回滚</h4>
<p>如果需要回滚，可以从备份恢复：</p>
<pre><code class="hljs language-bash" lang="bash">/root/oss/ossutilarm64 <span class="hljs-built_in">cp</span> -r oss://bucket/<span class="hljs-variable">$BACKUP_DIR</span>/static/ oss://bucket/static/ -f
</code></pre>
<hr/>
<h2 data-id="heading-48">问题排查</h2>
<h3 data-id="heading-49">1. 路径问题</h3>
<h4 data-id="heading-50">问题：HTML 中的路径不正确</h4>
<p><strong>症状</strong>：浏览器控制台显示 404 错误</p>
<p><strong>排查步骤</strong>：</p>
<ol>
<li>检查 <code>dist/index.html</code> 中的路径</li>
<li>确认 <code>publicPath</code> 配置是否正确</li>
<li>验证 <code>ModifyHtmlPlugin</code> 是否正常运行</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查构建后的 HTML</span>
<span class="hljs-built_in">cat</span> dist/index.html | grep -E <span class="hljs-string">'(href|src)='</span>

<span class="hljs-comment"># 检查环境变量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$NODE_ENV</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$VUE_APP_PATH_TYPE</span>
</code></pre>
<h3 data-id="heading-51">2. OSS 连接问题</h3>
<h4 data-id="heading-52">问题：ossutil 连接失败</h4>
<p><strong>症状</strong>：<code>ossutil: No such file or directory</code> 或连接超时</p>
<p><strong>排查步骤</strong>：</p>
<ol>
<li>检查 ossutil 是否安装</li>
<li>检查网络连接</li>
<li>验证凭证是否正确</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 ossutil 是否存在</span>
<span class="hljs-built_in">ls</span> -la /root/oss/ossutilarm64

<span class="hljs-comment"># 测试网络连接</span>
ping oss-cn-hangzhou.aliyuncs.com

<span class="hljs-comment"># 测试 OSS 连接</span>
/root/oss/ossutilarm64 <span class="hljs-built_in">ls</span> oss://bucket-name/
</code></pre>
<h3 data-id="heading-53">3. 上传失败</h3>
<h4 data-id="heading-54">问题：上传过程中断或失败</h4>
<p><strong>症状</strong>：脚本执行失败，部分文件未上传</p>
<p><strong>排查步骤</strong>：</p>
<ol>
<li>检查磁盘空间</li>
<li>检查网络稳定性</li>
<li>查看 OSS 控制台的错误日志</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查磁盘空间</span>
<span class="hljs-built_in">df</span> -h

<span class="hljs-comment"># 检查网络</span>
curl -I https://oss-cn-hangzhou.aliyuncs.com

<span class="hljs-comment"># 重试上传</span>
./upload-to-oss-production.sh
</code></pre>
<h3 data-id="heading-55">4. 文件权限问题</h3>
<h4 data-id="heading-56">问题：ossutil 无执行权限</h4>
<p><strong>症状</strong>：<code>Permission denied</code></p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x /root/oss/ossutilarm64
</code></pre>
<h3 data-id="heading-57">5. 脚本语法问题</h3>
<h4 data-id="heading-58">问题：脚本执行报语法错误</h4>
<p><strong>症状</strong>：<code>syntax error: unexpected EOF</code> 等</p>
<p><strong>常见原因</strong>：</p>
<ol>
<li>括号不匹配</li>
<li>引号未闭合</li>
<li>变量名包含特殊字符</li>
</ol>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查脚本语法</span>
bash -n upload-to-oss-production.sh

<span class="hljs-comment"># 使用 shellcheck 检查（如果已安装）</span>
shellcheck upload-to-oss-production.sh
</code></pre>
<h3 data-id="heading-59">6. 环境变量问题</h3>
<h4 data-id="heading-60">问题：构建时路径不正确</h4>
<p><strong>症状</strong>：测试环境使用了 CDN 路径，或生产环境使用了相对路径</p>
<p><strong>排查步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 package.json 中的脚本</span>
<span class="hljs-built_in">cat</span> package.json | grep -A 5 <span class="hljs-string">'"scripts"'</span>

<span class="hljs-comment"># 确认环境变量设置</span>
<span class="hljs-comment"># 测试环境应该设置 VUE_APP_PATH_TYPE=gray</span>
<span class="hljs-comment"># 生产环境不应该设置此变量</span>
</code></pre>
<hr/>
<h2 data-id="heading-61">总结</h2>
<p>本文详细介绍了 Vue.js 项目将静态资源部署到 OSS 的完整实现过程，包括：</p>
<ol>
<li><strong>配置层面</strong>：通过 Vue CLI 配置实现不同环境的路径处理</li>
<li><strong>工具层面</strong>：OSS 命令行工具的安装和配置</li>
<li><strong>脚本层面</strong>：自动化上传脚本的编写</li>
<li><strong>部署层面</strong>：完整的部署流程</li>
</ol>
<h3 data-id="heading-62">关键要点</h3>
<ul>
<li><strong>环境区分</strong>：测试环境使用相对路径，生产环境使用 CDN</li>
<li><strong>选择性上传</strong>：只上传必要的静态资源目录</li>
<li><strong>路径处理</strong>：通过自定义插件处理特殊文件的路径</li>
<li><strong>自动化</strong>：通过脚本实现一键部署</li>
<li><strong>安全性</strong>：妥善管理 OSS 凭证</li>
<li><strong>可维护性</strong>：清晰的代码结构和完善的错误处理</li>
</ul>
<h3 data-id="heading-63">扩展建议</h3>
<ol>
<li><strong>CI/CD 集成</strong>：将上传脚本集成到 CI/CD 流程中</li>
<li><strong>监控告警</strong>：添加监控和告警机制</li>
<li><strong>多环境支持</strong>：支持多个生产环境的配置</li>
<li><strong>版本管理</strong>：实现更完善的版本管理和回滚机制</li>
</ol>
<p>希望本文能帮助您成功实现静态资源的 OSS 部署！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[⚡Trae Solo Coding 的效率法则]]></title>    <link>https://juejin.cn/post/7574204970745528366</link>    <guid>https://juejin.cn/post/7574204970745528366</guid>    <pubDate>2025-11-19T01:21:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574204970745528366" data-draft-id="7574204970745495598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="⚡Trae Solo Coding 的效率法则"/> <meta itemprop="keywords" content="Trae,人工智能,前端"/> <meta itemprop="datePublished" content="2025-11-19T01:21:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ⚡Trae Solo Coding 的效率法则
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T01:21:34.000Z" title="Wed Nov 19 2025 01:21:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧭 一、什么是“Trae Solo Coding”？</h2>
<p>“<strong>Trae Solo Coding</strong>” 并不是某种官方的敏捷方法，而更像是一种 🧘‍♂️ 程序员的思维姿势：<br/>
当你独自面对需求、逻辑、Bug、甚至哲学问题时，如何在 <strong>无协作、无噪音、无救援</strong> 的状态下把效率推到极限。</p>
<p>一句话概括：</p>
<blockquote>
<p><strong>Solo coding ≠ 孤单写代码</strong>，而是一场与自己 CPU 对时钟的竞速。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">🔋 二、Trae Solo 的五条效率法则</h2>
<p>以下是从底层模式到认知层面提炼出的五条“Solo效率律”，它们既是心理策略，也能映射到底层执行逻辑（task scheduling）。</p>
<hr/>
<h3 data-id="heading-2">🧠 法则 1：<strong>任务队列应像 CPU 调度一样短</strong></h3>
<p>程序员常犯的第一个错，是脑子里放太多“中断请求”。<br/>
内心任务越多，CPU cache miss 越频繁，切换成本剧增。</p>
<p><strong>做法：</strong></p>
<ul>
<li>
<p>维护一个三层队列：</p>
<ul>
<li>🚀 <em>Now</em> 队列（正在写的功能）</li>
<li>🧩 <em>Next</em> 队列（下一步的小任务）</li>
<li>🌌 <em>Later</em> 队列（冷冻区，未来考虑）</li>
</ul>
</li>
<li>
<p>一次只能提交一个“线程”到 <em>Now</em> 区。</p>
</li>
</ul>
<blockquote>
<p>💡 把自己当作操作系统的调度器，不要让线程陷入死锁（多任务崩溃）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">🧩 法则 2：<strong>每段代码的“入口与出口”都要显式</strong></h3>
<p>Solo 开发最大风险是，自己成为未来的“他人”。<br/>
三天后你再看自己的代码，仿佛走进陌生人的厨房。</p>
<p><strong>写法建议：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// [入口] 初始化用户模块，执行环境：登录后</span>
<span class="hljs-built_in">initUserModule</span>();

<span class="hljs-comment">// [出口] 清理状态与事件监听，防止内存残留</span>
<span class="hljs-built_in">cleanupUserModule</span>();
</code></pre>
<p>这就像在函数间加了 <em>标志门</em>：</p>
<blockquote>
<p>“我从这儿进，从那儿出。路就算曲折，也不迷路。”</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">🧮 法则 3：<strong>模块化是独行侠的社会化手段</strong></h3>
<p>当团队不存在时，模块边界就是你与混乱之间的唯一防线。<br/>
Solo coder 不需要完美的架构，但需要可“拔插”的思维。</p>
<p><strong>技巧：</strong></p>
<ul>
<li>每个模块都要能<strong>独立运行与测试</strong>；</li>
<li>文件命名清晰如变量：“userLogin.js” 胜过 “test1.js”；</li>
<li>公共逻辑抽象为 util 函数，像 libc 一样被重用。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/network.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchJSON</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; (<span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url)).<span class="hljs-title function_">json</span>();
</code></pre>
<blockquote>
<p>模块不是为了组织代码，而是为了防止精神崩溃。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">🧭 法则 4：<strong>不要调试，应该“观测”</strong></h3>
<p>Solo 状态下，没人给你第二视角。你的 bug 往往不是代码错了，而是信息不够。</p>
<p><strong>观测式调试</strong> 就是让系统自己“说话”。<br/>
以事件日志的形式追踪行为，而不是反复断点。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">monitor</span>(<span class="hljs-params">tag, data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>] <span class="hljs-subst">${tag}</span>`</span>, data);
}
</code></pre>
<p>配合可视化（如 log viewer），你在低认知负荷下即可推断系统状态。</p>
<blockquote>
<p><strong>人类靠眼睛思考，程序靠时间线说话。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-6">🧩 法则 5：<strong>保持“节奏窗口”同步</strong></h3>
<p>我们在写代码时的思路，会形成一种“时间局部性”：<br/>
刚理解的函数上下文在脑中 cache 热度最高。<br/>
过了 20 分钟，cache 冷却，延迟上升。</p>
<p><strong>策略：</strong></p>
<ul>
<li>每 30 分钟为一个“节奏窗口”；</li>
<li>结束阶段必须留下执行线索（例如注释标记 TODO、断点处位置）；</li>
<li>下一窗口启动时能迅速“命中缓存”。</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 下一步将fetch结果映射到UI层——从这里继续</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">🧘‍♂️ 三、心流与底层机制</h2>
<p>Solo coding 的最高境界是 <strong>持续心流（flow）</strong> 。<br/>
你的大脑像事件循环（event loop）一样：</p>
<ul>
<li>🌀 专注执行当前任务；</li>
<li>⏳ 异步挂起待处理问题；</li>
<li>⚙️ 自动清理上下文无用对象。</li>
</ul>
<p>当心流打断时，相当于 event loop 被“阻塞”，你需要“异步恢复”：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setTimeout</span>(() =&gt; <span class="hljs-built_in">focusMode</span>(), <span class="hljs-number">1000</span>);
</code></pre>
<p>现实中可以这样“人肉实现”：</p>
<blockquote>
<p>关掉通知、放低音乐音量、切换黑暗模式、写一行注释→再出发。</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">🧭 四、效率矩阵：Trae Solo 思维框架</h2>



































<table><thead><tr><th>层级</th><th>技术对应</th><th>思维描述</th></tr></thead><tbody><tr><td>⏱️ 时间管理</td><td>任务切片、短执行周期</td><td>“调度思想”</td></tr><tr><td>🧠 认知结构</td><td>模块化、显式边界</td><td>“缓存命中”</td></tr><tr><td>🔍 观测机制</td><td>日志、断点、性能分析</td><td>“事件驱动反馈”</td></tr><tr><td>💡 学习回环</td><td>每日总结、持续复用</td><td>“自监督学习”</td></tr><tr><td>🎭 心流实现</td><td>节奏窗口、情绪同步</td><td>“AI层面的线程安全”</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">✨ 五、结语：孤独 ≠ 低效</h2>
<p>Trae Solo Coding 的核心不是一个人在战斗，而是：</p>
<blockquote>
<p>让自己变成团队，<br/>
让思维有结构，<br/>
让代码像乐器一样——可独奏，也能成交响。</p>
</blockquote>
<p>或许你此刻正对着屏幕喝着冷咖啡、调着异步逻辑。<br/>
别忘记，你并非一个人写代码。<br/>
你的 CPU、事件循环、日志系统，<br/>
都在默默与你协奏。 🎵</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【LM-PDF】一个大模型时代的 PDF 极速预览方案是如何实现的？]]></title>    <link>https://juejin.cn/post/7573892573346021428</link>    <guid>https://juejin.cn/post/7573892573346021428</guid>    <pubDate>2025-11-18T17:07:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892573346021428" data-draft-id="7573892650815094799" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【LM-PDF】一个大模型时代的 PDF 极速预览方案是如何实现的？"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-18T17:07:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Alang"/> <meta itemprop="url" content="https://juejin.cn/user/3913917126162429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【LM-PDF】一个大模型时代的 PDF 极速预览方案是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917126162429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Alang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T17:07:50.000Z" title="Tue Nov 18 2025 17:07:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最终效果示例（测试文档：290 页）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cfc5be92af4f4a98e493f6c1ed7101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764090470&amp;x-signature=UKUnAGoyKcpNy%2FfaKGTR1w1JkXs%3D" alt="Kapture 2025-11-18 at 23.45.35.gif" loading="lazy"/></p>
<p>开源地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fchennlang%2Flm-pdf" target="_blank" title="https://github.com/chennlang/lm-pdf" ref="nofollow noopener noreferrer">github.com/chennlang/l…</a> （如果觉得还不错，记得留下你的 star，这对我有很大帮助！）</p>
<h2 data-id="heading-0">背景</h2>
<p>随着 AGI 的日益发展，多模态的大模型也逐渐成为常态，出现在大众视野中，不过对于要求较高的场景，识别效果还是缺点意思，主要还是因为文档解析是一个复杂的流程（layout 分析 + 表格、文字识别 + 切片 + 原文对比、段落划分等），所以传统的 RAG 流程还是主流的方式。</p>
<p>大模型要去 “看” 到世界，首先得理解图片、文档。在 RAG 的流程中，大模型需要去学习本地的文档，从而生成更加专业的回答。而这些存量的文档大多数是 pdf 格式的，或者是以图片存在的。<strong>所以我们第一步要解决的问题就是如何把文档中的信息完整、准确的提取出来。</strong></p>
<p>PDF 渲染器其实是文档渲染的一个通用的文档展示方案，如果假设我们是在一个照相机后面看世界，所有图片、文档都能被看做是一张张图片，最终汇总起来就是一本 pdf 文档，所以理论上所有东西都能用 PDF 渲染器显示。</p>
<p>在 AGI 的前端项目中，无论是<code>训练模型语料</code>、还是模型回答<code>原文查看</code>、还是<code>切片来源</code>，都需要把原文档联系起来。所以都需要同时展示原文和回答的功能。</p>
<h2 data-id="heading-1">现有 PDF 预览方案</h2>



























































<table><thead><tr><th><strong>特性</strong></th><th><strong>pdf.js</strong></th><th><strong>react-pdf</strong></th><th><strong>react-pdf-viewer</strong></th></tr></thead><tbody><tr><td><strong>类型</strong></td><td>JavaScript 库</td><td>React 组件库</td><td>React 组件库</td></tr><tr><td><strong>依赖</strong></td><td>无</td><td>pdf.js</td><td>pdf.js</td></tr><tr><td><strong>UI</strong></td><td>无（需手动实现）</td><td>基础（需手动实现工具栏等）</td><td>完整（提供工具栏、缩略图等）</td></tr><tr><td><strong>功能</strong></td><td>渲染、缩放、搜索等</td><td>渲染、页面懒加载等</td><td>渲染、搜索、缩放、插件支持等</td></tr><tr><td><strong>定制性</strong></td><td>高（底层 API）</td><td>中（组件化）</td><td>中高（插件和主题定制）</td></tr><tr><td><strong>性能</strong></td><td>取决于 PDF 复杂度和实现</td><td>取决于 PDF 复杂度和实现</td><td>取决于 PDF 复杂度和实现</td></tr><tr><td><strong>学习成本</strong></td><td>高（需处理 UI 和交互）</td><td>中（React 组件）</td><td>中高（API 和插件系统）</td></tr><tr><td><strong>适用场景</strong></td><td>高度自定义、非 React 环境</td><td>React 项目，基础预览</td><td>React 项目，功能齐全的查看器</td></tr></tbody></table>
<p>目前主流开源的 pdf 渲染器都是基于 pdf.js 封装实现，其中比较有代表性的就是 react-pdf和 react-pdf-viewer，选型建议：</p>
<ul>
<li>如果你的项目基于 React，且需要一个开箱即用的 PDF 查看器，推荐选择 <strong>react-pdf-viewer</strong>。</li>
<li>如果你仅需在 React 中渲染 PDF 页面并希望自行设计 UI，建议使用 <strong>react-pdf</strong>。</li>
<li>如果你不在 React 环境中，或需要底层控制，建议直接使用 <strong>pdf.js</strong>。</li>
</ul>
<h2 data-id="heading-2">现存问题</h2>
<p>一直以来，我都是使用比较成熟的开源库 <code>react-pdf</code> 渲染 pdf 文档。不过，随着使用的深入，各种问题也随之浮现。例如开源的产品没法满足高度定制化、字体兼容问题导致显示错误.... 而最大的问题，是<strong>性能！</strong></p>
<ul>
<li>场景1： 500 页的 pdf 文档如果不做分页，市面上几乎没有一款 pdf 渲染器能做到流畅的滚动加载。</li>
<li>场景2：加载时间长，100M的文档，需要下载完才能预览，网络差的用户需要等 20分钟后才能看到。</li>
</ul>
<p>综上问题，本来原文档预览是一个方面使用者快速去对比分片、对比回答结果的快捷方式，却因为以上问题，使用起来特别难受。</p>
<p>react-pdf 兼容性问题可参考：<a href="https://juejin.cn/post/7429411484306128935" target="_blank" title="https://juejin.cn/post/7429411484306128935">全面解析 React-PDF 的浏览器兼容性及其解决策略背景 最近使用 react-pdf 进行 pdf 文件预览。上线 - 掘金</a></p>
<h2 data-id="heading-3">本文适用范围说明</h2>
<p>本文探讨的技术方案基于以下核心需求：</p>
<ol>
<li><strong>PDF 预览模式</strong>：采用无限滚动（Infinite Scroll）方式浏览文件内容，而非传统分页器（Pager）模式（逐页或固定页数翻页）。</li>
<li><strong>性能要求</strong>：需实现 PDF 文件的秒级加载，确保流畅体验。</li>
</ol>
<p><strong>重点说明</strong>： 无限滚动模式更符合现代用户习惯，适用于大多数实际场景。本文内容不涉及分页器模式的实现逻辑。</p>
<h2 data-id="heading-4">想法萌生</h2>
<p>就在我百思不得其解的时候，我看到了一款闭源的 canvas 实现的 pdf 渲染器。全文只有一个 canvas 元素！当然，简单体验了下，页数很多时依然会很卡，甚至不能用。</p>
<p>受此启发，所以我想，既然 pdf 文件在 OCR 识别之前的第一步，就一定是把每一页切成一张图片，那么基于这个场景下，我们完全可以使用图片来渲染呀，完全不用加载文件。</p>
<p>假设视图内只有一页，那么 canvas 中只会渲染 1 张图片，那速度岂不是秒开？</p>
<p>当然，pdf 文件流是二进制的，也能通过分段获取其中一部分文档。可是如何知道每一页的开始和结束符，这是一个问题。</p>
<h2 data-id="heading-5">lm-pdf</h2>
<p>为了方便下文讲解，我将此方案先命名为 <code>lm-pdf</code>, 主要是为了体现其出色的加载速度。</p>
<h2 data-id="heading-6">技术选型：react-konva</h2>
<p>有了以上思路，实现起来就是时间的问题了。我选用了 canvas 作为渲染底座，搜索一圈之后发现 <code>konvajs</code>在这个场景下非常适合。结合 react-konva, 在画布上渲染元素就非常简单了。</p>
<p>示例：在画布上渲染一张图片</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Stage</span>, <span class="hljs-title class_">Layer</span>, <span class="hljs-title class_">Image</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-konva'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> {
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Stage</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{window.innerWidth}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{window.innerHeight}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Layer</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Image</span> <span class="hljs-attr">x</span>=<span class="hljs-string">{0}</span> <span class="hljs-attr">y</span>=<span class="hljs-string">{0}</span> <span class="hljs-attr">image</span>=<span class="hljs-string">{...}</span>&gt;</span>&lt;/ Image&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Layer</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Stage</span>&gt;</span>
    );
  }
}
</span></code></pre>
<p>当然，使用 canvas 渲染还不够，既然要做到性能最好，我们还需要加上虚拟滚动。</p>
<h2 data-id="heading-7">核心功能：canvas 虚拟滚动</h2>
<p>很多人会说，都使用 canvas 了还使用什么虚拟滚动？可是你要知道，如果大量的元素常驻在画布上，加上滚动时，所有位置都要偏移，也就是说所有元素的位置都会被重新计算一遍。canvas 是按帧渲染的，这样 GPU 渲染肯定错错有余，不过内存和 CPU 性能却吃不消了！所以，<strong>要做就做到最好的！</strong> 而虚拟滚动恰好就能解决这个问题，因为视窗内同时显示的元素最多不超过 5 个，那么最多就这 5 个元素的计算量，会非常低。</p>
<h3 data-id="heading-8">虚拟滚动是什么</h3>
<p>虚拟滚动（Virtual Scrolling）是一种优化长列表渲染性能的技术。其基本原理是只渲染可视区域内的元素，而非整个列表，从而减少DOM节点的数量和提高页面性能。</p>
<p>虚拟滚动本身的原理说起来很简单，无非就是通过容器高度和滚动距离动态渲染子元素。不过，要实现一个基于 canvas 的<strong>虚拟滚动</strong>器，实现过程中，却有很多小细节值得分享。</p>
<h3 data-id="heading-9">传统实现方案</h3>
<p>Canvas 的虚拟滚动方案和常规实现方案有所不同，也有相同之处。所以我们需要先了解下传统的滚动条方案是怎么实现的。方便理解文章后面的内容。</p>
<p>完整 Demo 如下：</p>
<pre><code class="hljs language-ini" lang="ini">import React, { useState, useEffect, useRef } from 'react'<span class="hljs-comment">;</span>

// 虚拟滚动列表组件
const <span class="hljs-attr">VirtualScrollList</span> = ({ items, itemHeight }) =&gt; {
    // 状态：可见项的起始和结束索引
    const <span class="hljs-section">[startIndex, setStartIndex]</span> = useState(0)<span class="hljs-comment">;</span>
    const <span class="hljs-section">[endIndex, setEndIndex]</span> = useState(10)<span class="hljs-comment">;</span>

    // 引用：用于访问滚动容器
    const <span class="hljs-attr">containerRef</span> = useRef(null)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">handleScroll</span> = () =&gt; {
        // 获取当前滚动位置
        const <span class="hljs-attr">scrollTop</span> = containerRef.current.scrollTop<span class="hljs-comment">;</span>

        // 计算新的起始索引
        const <span class="hljs-attr">newStartIndex</span> = Math.floor(scrollTop / itemHeight)<span class="hljs-comment">;</span>

        // 计算新的结束索引
        const <span class="hljs-attr">newEndIndex</span> = newStartIndex + Math.ceil(containerRef.current.clientHeight / itemHeight)<span class="hljs-comment">;</span>

        // 更新可见项的索引
        setStartIndex(newStartIndex)<span class="hljs-comment">;</span>
        setEndIndex(newEndIndex)<span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>

    // 滚动事件监听
    useEffect(() =&gt; {
        const <span class="hljs-attr">container</span> = containerRef.current<span class="hljs-comment">;</span>
        container.addEventListener('scroll', handleScroll)<span class="hljs-comment">;</span>

        return () =&gt; {
            container.removeEventListener('scroll', handleScroll)<span class="hljs-comment">;</span>
        }<span class="hljs-comment">;</span>
    }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>

    // 可见项
    const <span class="hljs-attr">visibleItems</span> = items.slice(startIndex, endIndex)<span class="hljs-comment">;</span>

    // 计算占位符高度
    const <span class="hljs-attr">placeholderHeight</span> = items.length * itemHeight<span class="hljs-comment">;</span>

    return (
        &lt;div <span class="hljs-attr">style</span>={{ height: <span class="hljs-string">'300px'</span>, overflowY: <span class="hljs-string">'auto'</span> }} ref={containerRef}&gt;
            &lt;div <span class="hljs-attr">style</span>={{ height: `<span class="hljs-variable">${placeholderHeight}</span>px`, position: <span class="hljs-string">'relative'</span> }}&gt;
                &lt;div <span class="hljs-attr">style</span>={{ position: <span class="hljs-string">'absolute'</span>, top: `<span class="hljs-variable">${startIndex * itemHeight}</span>px`, left: <span class="hljs-number">0</span> }}&gt;
                    {visibleItems.map((item, index) =&gt; (
                        // 渲染可见项
                        &lt;div <span class="hljs-attr">key</span>={index} style={{ height: `<span class="hljs-variable">${itemHeight}</span>px` }}&gt;
                            {item}
                        &lt;/div&gt;
                    ))}
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

// 使用示例
const <span class="hljs-attr">items</span> = Array.from({ length: <span class="hljs-number">1000</span> }, (_, i) =&gt; `Item <span class="hljs-variable">${i + 1}</span>`)<span class="hljs-comment">;</span>
const <span class="hljs-attr">App</span> = () =&gt; (
    &lt;div&gt;
        &lt;h1&gt;虚拟滚动列表&lt;/h1&gt;
        &lt;VirtualScrollList <span class="hljs-attr">items</span>={items} itemHeight={<span class="hljs-number">30</span>} /&gt;
    &lt;/div&gt;
)<span class="hljs-comment">;</span>

export default App<span class="hljs-comment">;</span>
</code></pre>
<p>定义一个父容器，在容器中放一个<code>占位符</code>，占位符高度是所以 item 的总和，从而达到撑开父容器，出现滚动条。然后其子元素 item 使用 absolute 的方式悬浮在<code>占位符</code> 元素上。然后通过滚动的距离计算出要显示的子元素 visibleItems，渲染在页面上即可。</p>
<h3 data-id="heading-10">Canvas 虚拟滚动实现方案</h3>
<p>下面将使用伪代码展示核心原理。</p>
<p>一、canvas 内并没有滚动条的概念，所以我们需要自己实现一个滚动条。</p>
<p><strong>virtual-scroll-bar 组件</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Item</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Item</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
  [<span class="hljs-attr">k</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
    <span class="hljs-attr">items</span>: <span class="hljs-title class_">Item</span> [];
    <span class="hljs-attr">onVisibleItemChange</span>: <span class="hljs-function">(<span class="hljs-params">items: Item[]</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    onScroll?: <span class="hljs-function">(<span class="hljs-params">scroll: { left: <span class="hljs-built_in">number</span>; top: <span class="hljs-built_in">number</span> }</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">VirtualScrollBar</span> = (<span class="hljs-params">{ items }: </span>) =&gt; {
    <span class="hljs-comment">// 滚动触发</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScroll</span> (scroll) {
        <span class="hljs-title function_">updateVisibleItems</span>(scroll)
        <span class="hljs-title function_">onScroll</span>(scroll)
    }

    <span class="hljs-comment">// 计算可视元素</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateVisibleItems</span> (scroll) {
       <span class="hljs-keyword">const</span> visibleItems = []
       <span class="hljs-comment">// .....省略计算过程</span>
       <span class="hljs-title function_">onVisibleItemChange</span>(visibleItems)
    }

    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{divRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">v-scroll-bar</span> ${<span class="hljs-attr">direction</span>}`}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">height:</span> <span class="hljs-attr">items.reduce</span>((<span class="hljs-attr">sum</span>, <span class="hljs-attr">item</span>) =&gt;</span> (sum += item.height), 0),
        }}&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p>同样的方式，我们在 div 中加入一个占位符，高度是所以 item 的总和。然后通过监听 divRef 的滚动，计算出视图内出现的元素。</p>
<p><strong>核心逻辑（伪代码）</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 当前显示元素</span>
const <span class="hljs-selector-attr">[displayItems, setDisplayItems]</span> = useState&lt;PageItem<span class="hljs-selector-attr">[]</span>&gt;([]);

const onScroll: VirtualScrollBarProps[<span class="hljs-string">"onScroll"</span>] = ({ <span class="hljs-attribute">left</span>, <span class="hljs-attribute">top</span> }) =&gt; {
    <span class="hljs-comment">// 整体 y 方向偏移, 这里使用 setData 而不是 setData =&gt; old,</span>
    <span class="hljs-comment">// 因为滚动频繁，利用 setData 更新机制可以做到节流，提升性能</span>
    <span class="hljs-built_in">setDisplayItems</span>((old) =&gt;
      old<span class="hljs-selector-class">.map</span>((m) =&gt; ({
        ...m,
        y: m.top - top,
      }))
)};


<span class="hljs-comment">// 对比新旧值，更新 Y 的坐标</span>
<span class="hljs-comment">// 滚动的过程中，y 会偏移，新的 items 进来，如果有公共的 items ,要和旧的保持一致。</span>
function diffAndUpdateY () {}

function <span class="hljs-built_in">onVisibleItemChange</span>(originItems: VirtualScrollBarProps["items"]) {
    const items = originItems as PageItem<span class="hljs-selector-attr">[]</span>;
    <span class="hljs-comment">// 这里要做一件事，新的 items 会把 y 的坐标全部重新排过，这会有问题，表现为突然弹跳位置。</span>
    <span class="hljs-comment">// 如果新的 items 中和旧的 items 中有共同的 item, 那么以旧的 item 的 y 为准，保持不变</span>
    <span class="hljs-comment">// 那么新出现的，排在旧的上面或下面</span>
    <span class="hljs-built_in">startTransition</span>(() =&gt; {
      <span class="hljs-built_in">startTransition</span>(() =&gt; {
        <span class="hljs-built_in">setDisplayItems</span>((old) =&gt; <span class="hljs-built_in">diffAndUpdateY</span>(old, items));
      });
    });
}


&lt;VirtualScrollBar
    items={pages}
    onVisibleItemChange={onVisibleItemChange}
    onScroll={onScroll}
&gt;&lt;/VirtualScrollBar&gt;
</code></pre>
<h2 data-id="heading-11">核心功能：如何实现页面平滑切换</h2>
<p>不过你会发现，页面是一卡一卡的，像是幻灯片，子元素没有随着滚动而移动的。只是会到达一定滚动距离后，就会全部替换成新的元素。因为我们还没有做偏移，元素要随着滚动在容器内上下移动，直到移动到容器外，才替换成新的元素。实现偏移：所以我们把整体元素 y 值随着滚动偏移，<code> y = y + offsetY</code>, 这样元素就会滚动效果 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ed2ae897b0484d8049aeb722ff9579~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWxhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764090470&amp;x-signature=UDEmKgUVD32%2BGNizJOOyYYFe%2FtM%3D" alt="image.png" loading="lazy"/></p>
<p>要想实现流畅滚动（平滑切换），还要实现新旧元素 Diff ，原理如下：</p>
<p>如上图，假设我们当前视图显示了 [元素1、元素2]，子元素高度都是 200px，滚动了 30px 后，显示了 [元素1、元素2、元素 3]。</p>
<p>元素 1、元素 2 在是它们的交集。所以元素 1、元素 2 的位置要保持以前的位置不变（用户界面能看到的已有的元素，不能因为切换了新的元素而改变位置），而元素 3 应该在元素 2 后面。</p>

























<table><thead><tr><th>元素</th><th>初始坐标（滚动前）</th><th>滚动后坐标（向下滚动 30px）</th></tr></thead><tbody><tr><td>元素1</td><td><code>[0, 0]</code></td><td><code>[0, -30]</code></td></tr><tr><td>元素2</td><td><code>[0, 200]</code></td><td><code>[0, 170]</code></td></tr><tr><td>元素3</td><td>—</td><td><code>[0, 370]</code></td></tr></tbody></table>
<p>做完 diff 后，从用户的角度就会发现是连续的滚动，而实际是不停的在切换新元素。</p>
<h2 data-id="heading-12">性能优化：异步加载，减少线程阻塞</h2>
<p>因为滚动的过程中是连续的，例如从第1页滚到 100页，那么中间的 2-99 都会被渲染一遍，其实我只是想看第 100 页，这会严重拖慢页面的渲染性能。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// page.ts</span>
<span class="hljs-built_in">useEffect</span>(() =&gt; {
    if (!blocks.length) return;

    <span class="hljs-comment">// 延迟渲染定时器</span>
    const timer = <span class="hljs-built_in">setTimeout</span>(() =&gt; {
      <span class="hljs-comment">// 开始渲染</span>
      <span class="hljs-built_in">setDisplayBlocks</span>(blocks);
    }, <span class="hljs-number">500</span>);

    return () =&gt; {
      <span class="hljs-built_in">clearTimeout</span>(timer);
    };
  }, <span class="hljs-selector-attr">[blocks]</span>);
</code></pre>
<p>上面我用了一个定时器，完美解决了这个问题，只有等组件出现在可视区域，渲染后且 500 毫秒内没有消失，才会真正渲染。这样就能避免无效的渲染任务。</p>
<p>500 毫秒最终使用过程中被我改成了 200，不然会出现明显的等待渲染过程，影响体验。</p>
<h2 data-id="heading-13">性能对比</h2>
<p>页面加载速度测试，我采用目前开源中用的最多的 <code>react-pdf</code> 和 <code>lm-pdf</code> 作对比:</p>
<ul>
<li>测试指标： 首页渲染时间</li>
<li>测试网速：13.9 Mbps</li>
</ul>






























<table><thead><tr><th>PDF 测试文件页码</th><th>react-pdf</th><th>lm-pdf</th></tr></thead><tbody><tr><td>3页</td><td>3.5s</td><td>1s</td></tr><tr><td>50页</td><td>7s</td><td>1.5s</td></tr><tr><td>344页</td><td>109s</td><td>2.5s</td></tr><tr><td>1000页</td><td>240s</td><td>2.5s</td></tr></tbody></table>
<p>react-pdf 的加载速度取决于文档的大小，下载的网速影响。而 <code>lm-pdf</code> 的优势在于无论多少页，都趋近于 2.5s，打开的速度取决于单页的图片大小。</p>
<h2 data-id="heading-14">lm-pdf 优缺点</h2>
<p>优点：</p>
<ul>
<li>极快的首次加载速度（和文件大小、页数无关）</li>
<li>丝滑的滚动体验</li>
<li>极低的内存占用</li>
<li>极少的页面 DOM</li>
</ul>
<p>缺点：</p>
<ul>
<li>目前不支持复制 PDF 文本（研究中）</li>
<li>PDF 必须先被切成图片</li>
</ul>
<p>持续优化的点：其实还可以在远端无损压缩图片，进一步提高渲染速度。</p>
<h2 data-id="heading-15">总结</h2>
<p>如果你看重的是加速速度和性能，lm-pdf 绝对能满足你的需求，不过此方案还存在一些局限，例如强依赖后端生成 pdf 单页图片、不支持复制 PDF 文本等，不过目前已开源，后续还会持续完善，也希望感兴趣的同学一起 PR 共建。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue表单组件进阶：打造属于你的自定义v-model]]></title>    <link>https://juejin.cn/post/7573892156257746980</link>    <guid>https://juejin.cn/post/7573892156257746980</guid>    <pubDate>2025-11-18T23:32:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892156257746980" data-draft-id="7574069837526663210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue表单组件进阶：打造属于你的自定义v-model"/> <meta itemprop="keywords" content="Vue.js,JavaScript,前端"/> <meta itemprop="datePublished" content="2025-11-18T23:32:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="良山有风来"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue表单组件进阶：打造属于你的自定义v-model
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    良山有风来
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T23:32:59.000Z" title="Tue Nov 18 2025 23:32:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    43
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从基础到精通：掌握组件数据流的核心</h2>
<p>每次写表单组件，你是不是还在用 props 传值、$emit 触发事件的老套路？面对复杂表单需求时，代码就像一团乱麻，维护起来让人头疼不已。今天我要带你彻底掌握自定义 v-model 的奥秘，让你的表单组件既优雅又强大。</p>
<p>读完本文，你将学会如何为任何组件实现自定义的 v-model，理解 Vue 3 中 v-model 的进化，并掌握在实际项目中的最佳实践。准备好了吗？让我们开始这段精彩的组件开发之旅！</p>
<h2 data-id="heading-1">重新认识 v-model：不只是语法糖</h2>
<p>在深入自定义之前，我们先来回顾一下 v-model 的本质。很多人以为 v-model 是 Vue 的魔法，其实它只是一个语法糖。</p>
<p>让我们看一个基础示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原生 input 的 v-model 等价于：</span>
&lt;input 
  :value=<span class="hljs-string">"searchText"</span> 
  @input=<span class="hljs-string">"searchText = $event.target.value"</span>
&gt;

<span class="hljs-comment">// 这就是 v-model 的真相！</span>
</code></pre>
<p>在 Vue 3 中，v-model 迎来了重大升级。现在你可以在同一个组件上使用多个 v-model，这让我们的表单组件开发更加灵活。</p>
<h2 data-id="heading-2">自定义 v-model 的核心原理</h2>
<p>自定义 v-model 的核心就是实现一个协议：组件内部管理自己的状态，同时在状态变化时通知父组件。</p>
<p>在 Vue 3 中，这变得异常简单。我们来看看如何为一个自定义输入框实现 v-model：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// CustomInput.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-input"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"$emit('update:modelValue', $event.target.value)"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"input-field"</span>
    &gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 定义 props - 默认的 modelValue</span>
<span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
  }
})

<span class="hljs-comment">// 定义 emits - 必须声明 update:modelValue</span>
<span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>使用这个组件时，我们可以这样写：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CustomInput</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"username"</span> /&gt;</span></span>
&lt;/template&gt;
</code></pre>
<p>看到这里你可能要问：为什么是 <code>modelValue</code> 和 <code>update:modelValue</code>？这就是 Vue 3 的约定。默认情况下，v-model 使用 <code>modelValue</code> 作为 prop，<code>update:modelValue</code> 作为事件。</p>
<h2 data-id="heading-3">实战：打造一个功能丰富的搜索框</h2>
<p>让我们来实战一个更复杂的例子——一个带有清空按钮和搜索图标的搜索框组件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// SearchInput.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-input-wrapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"search-icon"</span>&gt;</span>🔍<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput"</span>
      @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">"handleSearch"</span>
      <span class="hljs-attr">:placeholder</span>=<span class="hljs-string">"placeholder"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"search-input"</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
      <span class="hljs-attr">v-if</span>=<span class="hljs-string">"modelValue"</span> 
      @<span class="hljs-attr">click</span>=<span class="hljs-string">"clearInput"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"clear-button"</span>
    &gt;</span>
      ×
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 接收 modelValue 和 placeholder</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">placeholder</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'请输入搜索内容...'</span>
  }
})

<span class="hljs-comment">// 定义可触发的事件</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">'search'</span>])

<span class="hljs-comment">// 处理输入事件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>)
}

<span class="hljs-comment">// 处理清空操作</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">clearInput</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">''</span>)
}

<span class="hljs-comment">// 处理搜索事件（按回车时）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'search'</span>, props.<span class="hljs-property">modelValue</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.search-input-wrapper</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#dcdfe6</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.search-icon</span> {
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#909399</span>;
}

<span class="hljs-selector-class">.search-input</span> {
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.clear-button</span> {
  <span class="hljs-attribute">background</span>: none;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#c0c4cc</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.clear-button</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#909399</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>使用这个搜索框组件：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SearchInput</span> 
      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"searchText"</span>
      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"搜索用户..."</span>
      @<span class="hljs-attr">search</span>=<span class="hljs-string">"handleSearch"</span>
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前搜索词：{{ searchText }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> searchText = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params">value</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行搜索：'</span>, value)
  <span class="hljs-comment">// 这里可以调用 API 进行搜索</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-4">进阶技巧：多个 v-model 绑定</h2>
<p>Vue 3 最令人兴奋的特性之一就是支持多个 v-model。这在处理复杂表单时特别有用，比如一个用户信息编辑组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// UserForm.vue</span>
&lt;template&gt;
  &lt;div class="user-form"&gt;
    &lt;div class="form-group"&gt;
      &lt;label&gt;姓名：&lt;/label&gt;
      &lt;input
        :value="name"
        @input="$emit('update:name', $event.target.value)"
      &gt;
    &lt;/div&gt;
    
    &lt;div class="form-group"&gt;
      &lt;label&gt;邮箱：&lt;/label&gt;
      &lt;input
        :value="email"
        @input="$emit('update:email', $event.target.value)"
        type="email"
      &gt;
    &lt;/div&gt;
    
    &lt;div class="form-group"&gt;
      &lt;label&gt;年龄：&lt;/label&gt;
      &lt;input
        :value="age"
        @input="$emit('update:age', $event.target.value)"
        type="number"
      &gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps({
  name: String,
  email: String,
  age: Number
})

defineEmits(['update:name', 'update:email', 'update:age'])
&lt;/script&gt;
</code></pre>
<p>使用这个多 v-model 组件：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span>
    <span class="hljs-attr">v-model:name</span>=<span class="hljs-string">"userInfo.name"</span>
    <span class="hljs-attr">v-model:email</span>=<span class="hljs-string">"userInfo.email"</span>
    <span class="hljs-attr">v-model:age</span>=<span class="hljs-string">"userInfo.age"</span>
  /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> userInfo = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-literal">null</span>
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-5">处理复杂数据类型</h2>
<p>有时候我们需要传递的不是简单的字符串，而是对象或数组。这时候自定义 v-model 同样能胜任：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ColorPicker.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"color-picker"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">v-for</span>=<span class="hljs-string">"color in colors"</span> 
      <span class="hljs-attr">:key</span>=<span class="hljs-string">"color"</span>
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"['color-option', { active: isSelected(color) }]"</span>
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ backgroundColor: color }"</span>
      @<span class="hljs-attr">click</span>=<span class="hljs-string">"selectColor(color)"</span>
    &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: {
    <span class="hljs-attr">type</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Array</span>],
    <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
  },
  <span class="hljs-attr">multiple</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-attr">colors</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> [<span class="hljs-string">'#ff4757'</span>, <span class="hljs-string">'#2ed573'</span>, <span class="hljs-string">'#1e90ff'</span>, <span class="hljs-string">'#ffa502'</span>, <span class="hljs-string">'#747d8c'</span>]
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-comment">// 处理颜色选择</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">selectColor</span> = (<span class="hljs-params">color</span>) =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">multiple</span>) {
    <span class="hljs-keyword">const</span> currentSelection = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(props.<span class="hljs-property">modelValue</span>) 
      ? [...props.<span class="hljs-property">modelValue</span>] 
      : []
    
    <span class="hljs-keyword">const</span> index = currentSelection.<span class="hljs-title function_">indexOf</span>(color)
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      currentSelection.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    } <span class="hljs-keyword">else</span> {
      currentSelection.<span class="hljs-title function_">push</span>(color)
    }
    
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, currentSelection)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, color)
  }
}

<span class="hljs-comment">// 检查颜色是否被选中</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">isSelected</span> = (<span class="hljs-params">color</span>) =&gt; {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">multiple</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(props.<span class="hljs-property">modelValue</span>) &amp;&amp; props.<span class="hljs-property">modelValue</span>.<span class="hljs-title function_">includes</span>(color)
  }
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">modelValue</span> === color
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.color-picker</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.color-option</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid transparent;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.color-option</span><span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.1</span>);
}

<span class="hljs-selector-class">.color-option</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.05</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>使用这个颜色选择器：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 单选模式 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ColorPicker</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"selectedColor"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>选中的颜色：{{ selectedColor }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 多选模式 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ColorPicker</span> 
      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"selectedColors"</span> 
      <span class="hljs-attr">:multiple</span>=<span class="hljs-string">"true"</span> 
    /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>选中的颜色：{{ selectedColors }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> selectedColor = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'#1e90ff'</span>)
<span class="hljs-keyword">const</span> selectedColors = <span class="hljs-title function_">ref</span>([<span class="hljs-string">'#ff4757'</span>, <span class="hljs-string">'#2ed573'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-6">性能优化与最佳实践</h2>
<p>在实现自定义 v-model 时，我们还需要注意一些性能问题和最佳实践：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 优化版本的表单组件</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
    @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput"</span>
    <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span>
  &gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { watch, toRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Number</span>],
  <span class="hljs-comment">// 添加防抖功能</span>
  <span class="hljs-attr">debounce</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span>
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-keyword">let</span> timeoutId = <span class="hljs-literal">null</span>

<span class="hljs-comment">// 使用 toRef 确保响应性</span>
<span class="hljs-keyword">const</span> modelValueRef = <span class="hljs-title function_">toRef</span>(props, <span class="hljs-string">'modelValue'</span>)

<span class="hljs-comment">// 监听外部对 modelValue 的更改</span>
<span class="hljs-title function_">watch</span>(modelValueRef, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
  <span class="hljs-comment">// 这里可以执行一些副作用</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'值发生变化：'</span>, newValue)
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">const</span> value = event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  
  <span class="hljs-comment">// 防抖处理</span>
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">debounce</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-built_in">clearTimeout</span>(timeoutId)
    timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
    }, props.<span class="hljs-property">debounce</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
  }
}

<span class="hljs-comment">// 组件卸载时清理定时器</span>
<span class="hljs-keyword">import</span> { onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-built_in">clearTimeout</span>(timeoutId)
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-7">常见问题与解决方案</h2>
<p>在实际开发中，你可能会遇到这些问题：</p>
<p><strong>问题1：为什么我的 v-model 不工作？</strong>
检查两点：是否正确定义了 <code>update:modelValue</code> 事件，以及是否在 emits 中声明了这个事件。</p>
<p><strong>问题2：如何处理复杂的验证逻辑？</strong>
可以在组件内部实现验证，也可以通过额外的 prop 传递验证规则：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 带有验证的表单组件</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"validated-input"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">:value</span>=<span class="hljs-string">"modelValue"</span>
      @<span class="hljs-attr">input</span>=<span class="hljs-string">"handleInput"</span>
      <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ error: hasError }"</span>
    &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"hasError"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error-message"</span>&gt;</span>
      {{ errorMessage }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">rules</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
  }
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>, <span class="hljs-string">'validation'</span>])

<span class="hljs-comment">// 计算验证状态</span>
<span class="hljs-keyword">const</span> validationResult = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!props.<span class="hljs-property">rules</span>.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> }
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> props.<span class="hljs-property">rules</span>) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">rule</span>(props.<span class="hljs-property">modelValue</span>)
    <span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">message</span>: result }
    }
  }
  
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span> }
})

<span class="hljs-keyword">const</span> hasError = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> !validationResult.<span class="hljs-property">value</span>.<span class="hljs-property">valid</span>)
<span class="hljs-keyword">const</span> errorMessage = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> validationResult.<span class="hljs-property">value</span>.<span class="hljs-property">message</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleInput</span> = (<span class="hljs-params">event</span>) =&gt; {
  <span class="hljs-keyword">const</span> value = event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:modelValue'</span>, value)
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'validation'</span>, validationResult.<span class="hljs-property">value</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-8">拥抱 Composition API 的强大能力</h2>
<p>使用 Composition API，我们可以创建更加灵活的可复用逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useVModel.js - 自定义 v-model 的 composable</span>
<span class="hljs-keyword">import</span> { computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useVModel</span>(<span class="hljs-params">props, emit, name = <span class="hljs-string">'modelValue'</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">computed</span>({
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> props[name]
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">value</span>) {
      <span class="hljs-title function_">emit</span>(<span class="hljs-string">`update:<span class="hljs-subst">${name}</span>`</span>, value)
    }
  })
}
</code></pre>
<p>在组件中使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 composable 的组件</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"valueProxy"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useVModel } <span class="hljs-keyword">from</span> <span class="hljs-string">'./useVModel'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">modelValue</span>: <span class="hljs-title class_">String</span>
})

<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update:modelValue'</span>])

<span class="hljs-comment">// 使用 composable</span>
<span class="hljs-keyword">const</span> valueProxy = <span class="hljs-title function_">useVModel</span>(props, emit)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-9">总结与思考</h2>
<p>通过今天的学习，我们深入掌握了 Vue 自定义 v-model 的方方面面。从基础原理到高级用法，从简单输入框到复杂表单组件，你现在应该能够自信地为任何场景创建自定义 v-model 组件了。</p>
<p>记住，自定义 v-model 的核心价值在于提供一致的用户体验。无论是在简单还是复杂的场景中，它都能让我们的组件使用起来更加直观和便捷。</p>
<p>现在，回顾一下你的项目，有哪些表单组件可以重构为自定义 v-model 的形式？这种重构会为你的代码库带来怎样的改善？欢迎在评论区分享你的想法和实践经验！</p>
<p>技术的进步永无止境，但掌握核心原理让我们能够从容应对各种变化。希望今天的分享能为你的 Vue 开发之路带来新的启发和思考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[优化：如何避免 React Context 引起的全局挂载节点树重新渲染]]></title>    <link>https://juejin.cn/post/7574270661864980507</link>    <guid>https://juejin.cn/post/7574270661864980507</guid>    <pubDate>2025-11-19T07:19:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574270661864980507" data-draft-id="7574040813748961331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="优化：如何避免 React Context 引起的全局挂载节点树重新渲染"/> <meta itemprop="keywords" content="前端,面试,GitHub"/> <meta itemprop="datePublished" content="2025-11-19T07:19:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃饺子不吃馅"/> <meta itemprop="url" content="https://juejin.cn/user/1148309742825495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            优化：如何避免 React Context 引起的全局挂载节点树重新渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1148309742825495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃饺子不吃馅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T07:19:30.000Z" title="Wed Nov 19 2025 07:19:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    36
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近项目中一个React Context在不断的接受websocket事件，然后一直修改state，导致重复渲染过多，比较卡顿</p>
<p>TM的这状态管理真乱，趁机总结一下React Context的使用的注意事项</p>
<p>React Context 用于在组件树中传递数据，而不必手动地通过 props 逐层传递。然而，它的便利性也带来了一个常见的性能陷阱：当 Context 的值发生变化时，所有依赖该 Context 的消费组件都会重新渲染，即使它们只使用了 Context 值中的一小部分。</p>
<p>如果处理不当，这种<strong>全局性的重新渲染</strong>可能会拖慢你的应用，尤其是在 Context Provider 位于组件树顶层，并且其值包含频繁变动的数据时。</p>
<h2 data-id="heading-0">Context的重新渲染机制</h2>
<p>当我们使用 <code>useContext(MyContext)</code> 或 <code>&lt;MyContext.Consumer&gt;</code> 时，React 会在内部建立一个订阅关系。</p>
<ol>
<li><strong>当 Provider 的 <code>value</code> 属性发生变化时</strong>：React 会检查新旧值是否严格相等（<code>===</code>）。</li>
<li><strong>如果值不相等</strong>：React 会通知所有订阅了该 Context 的 Consumer 组件执行重新渲染。</li>
</ol>
<p>React 并没有对 Consumer 实际使用了 Context 值中的<strong>哪部分属性</strong>进行细粒度分析。只要 <strong>Context 的 <code>value</code> 对象本身</strong> 引用发生了变化，所有 Consumer 都会触发更新。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// ❌ 常见但易导致全局渲染的模式</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyContext</span> = <span class="hljs-title function_">createContext</span>({ <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">settings</span>: {} });

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// state 只要更新，value 对象就会创建一个新的引用</span>
  <span class="hljs-keyword">const</span> [appState, setAppState] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">user</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Gemini'</span> }, <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span> });

  <span class="hljs-comment">// 每次 App 渲染，这个对象都是一个新的引用</span>
  <span class="hljs-keyword">const</span> contextValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> appState, [appState]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{contextValue}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Content</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 假设 Header 只使用了 appState.user</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { user } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">MyContext</span>);
  <span class="hljs-comment">// ... 其他代码</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome, {user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-comment">// 假设 Footer 只使用了 appState.theme</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Footer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { theme } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">MyContext</span>);
  <span class="hljs-comment">// ... 其他代码</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Current theme: {theme}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
}

<span class="hljs-comment">// ⚡️ 陷阱：即使只有 theme 变化，Header 也会重新渲染！</span>
</code></pre>
<h2 data-id="heading-1">避免全局重新渲染</h2>
<p>我们可以通过以下几种策略，将 Context 的重新渲染范围限制在真正需要更新的组件。</p>
<h3 data-id="heading-2">1. 拆分 Context</h3>
<p>这是最简单、最有效的策略之一。与其将所有状态都塞入一个“大 Context”中，不如根据数据的<strong>更新频率</strong>和<strong>耦合关系</strong>将其拆分成多个独立的 Context。</p>
<ul>
<li><strong>高频更新 / 独立的 Context</strong>：例如，用户交互状态（<code>IsLoadingContext</code>）。</li>
<li><strong>低频更新 / 共享的 Context</strong>：例如，全局配置和静态数据（<code>ThemeContext</code>）。</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// ✅ 拆分成多个独立的 Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Gemini'</span> });
  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'dark'</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{user}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{theme}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span> {/* 仅消费 UserContext */}
        <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span> {/* 仅消费 ThemeContext */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 优化效果：</span>
<span class="hljs-comment">// 1. user 变化，只有 Header 及其子树可能重新渲染。</span>
<span class="hljs-comment">// 2. theme 变化，只有 Footer 及其子树可能重新渲染。互不影响。</span>
</code></pre>
<h3 data-id="heading-3">2. 使用 Custom Hook 和 <code>memo</code> 结合</h3>
<p>这种方法适用于你无法拆分 Context，但又想防止 Consumer 重新渲染的情况</p>
<p>通过 <code>useMemo</code> 或自定义 Hook 仅提取 Context 中需要的属性，并结合 <code>React.memo</code> 来跳过不必要的渲染</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 针对 Header 组件的自定义 Hook</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useUser</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">MyContext</span>);
  <span class="hljs-comment">// 仅返回 user 部分，确保只有 user 改变时才返回新引用</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> context.<span class="hljs-property">user</span>, [context.<span class="hljs-property">user</span>]); 
};

<span class="hljs-comment">// 结合 React.memo</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MemoizedHeader</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useUser</span>(); <span class="hljs-comment">// 即使 MyContext 整体变了，只要 user 不变，useUser 就会返回旧引用</span>

  <span class="hljs-comment">// ... 渲染逻辑</span>
});

<span class="hljs-comment">// ⚡️ 陷阱规避：</span>
<span class="hljs-comment">// 1. MyContext 整体改变，MemoizedHeader 接收新的 props (即 useUser 返回的值)。</span>
<span class="hljs-comment">// 2. 但由于 useUser() 对 user 属性进行了 useMemo 优化，如果 user 对象引用没有变化，</span>
<span class="hljs-comment">// 3. React.memo 就会发挥作用，跳过 Header 的渲染。</span>
</code></pre>
<h2 data-id="heading-4">END</h2>
<p>祝大家暴富！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini3.0深度解析，它在重新定义智能，会是前端工程师噩梦吗？]]></title>    <link>https://juejin.cn/post/7574615024293429274</link>    <guid>https://juejin.cn/post/7574615024293429274</guid>    <pubDate>2025-11-20T09:57:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574615024293429274" data-draft-id="7574321422400077850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini3.0深度解析，它在重新定义智能，会是前端工程师噩梦吗？"/> <meta itemprop="keywords" content="人工智能,Agent,DeepSeek"/> <meta itemprop="datePublished" content="2025-11-20T09:57:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini3.0深度解析，它在重新定义智能，会是前端工程师噩梦吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:57:30.000Z" title="Thu Nov 20 2025 09:57:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>大家是否曾畅想过，通用人工智能（AGI）真正到来时会是什么样子？对笔者而言，希望它是一个真正懂用户的“私人教师”：当用户希望学习某个知识点时，它能一键生成可交互的前端应用，通过动态演示与引导式操作，让用户在实践过程中深入理解；更进一步，笔者期待 AGI 能成为一位“全能程序工程师”。无论是根据一张设计图还原出完整应用，还是将创意转化为可游玩的游戏，甚至是协助完成操作系统级别的开发任务——它都能高效响应。哪怕只是实现一个简单的前端页面，它也能在细节与视觉效果上做到极致。而这一切，已不仅是想象。在谷歌最新发布的大模型 Gemini 3.0 的实测演示中，正看到这样的能力成为现实。可以说，Gemini 3.0 不仅再次推高了大模型的性能上限，更为所有开发者勾勒出 AGI 应用的未来雏形。本期内容，笔者将带大家深入解析 Gemini 3.0 的核心特性，通过实际演示与测评，一探其技术内核与潜在影响。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daecbb5e8325404da9b8dad14888fe4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=G6xPRMWWht9QTxIhbVzbor8wT3c%3D" alt="6.png" loading="lazy"/></p>
<h2 data-id="heading-1">一、Gemini3.0 核心特性</h2>
<h3 data-id="heading-2">1.1 全方位性能领先</h3>
<p>11月19日，谷歌正式发布了新一代大模型Gemini 3.0。与以往模型不同，Gemini 3.0在发布当天就同步在Gemini APP、Google AI Studio和Vertex开发者平台全面上线。该模型的完整名称为Gemini-3.0-Pro-Preview，定位为推理专用模型。</p>
<p>从官方发布的评测数据来看，Gemini 3.0在多项关键指标上均展现出显著优势，性能表现全面超越当前市场上的主流大模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8162b7e0618841768e0efb49da57a94a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=GKvHxNclQMcnA6hfx%2BLAux1XA3Y%3D" alt="4.png" loading="lazy"/></p>
<p>在业界公认的高难度多模态基准测试“Humanity's Last Exam”（包含3000道高难度题目）中，Gemini 3.0以37.5%的准确率大幅领先，比第二名GPT-5.1高出近10个百分点。此外，在视觉推理、博士级科研问题解答、OCR性能、编程能力和长文本理解等五个核心维度上，Gemini 3.0也都保持着全面领先地位。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d47031b0fd4b47fbaaa8fd86d5d8a0d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=Spvqo72YQ3kd3KE%2BUu%2FiBc2LH3Q%3D" alt="7.png" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 卓越的编程能力</h3>
<p>AI编程已成为大模型最重要的应用场景之一。谷歌在本次发布会上特别强调了编程能力的突破，将其视为“AI梦工厂”的核心支撑。</p>
<p>Gemini 3.0在智能体编程（Agentic Coding）方面表现尤为突出，相比前代Gemini 2.5 Pro提升近一倍。在权威的大模型竞技场排名中，无论是对话交互、视觉推理还是前端开发任务，Gemini 3.0均位列榜首，展现出全面的技术优势。</p>
<p>值得注意的是，Gemini 3.0支持高达100万tokens的上下文长度，远超当前主流模型的12万tokens标准，同时还能实现最高64k tokens的单次输出，为处理复杂编程任务提供了坚实的技术基础。</p>
<h2 data-id="heading-4">二、实战体验：Gemini 3.0 的编程能力</h2>
<h3 data-id="heading-5">2.1 环境准备与工具选择</h3>
<p>想要快速体验 Gemini 3.0 的完整编程能力，除了自行开发智能体（不推荐，开发成本较高）之外，最便捷的方式是使用 Gemini APP 或 Google AI Studio。Gemini APP 是一款客户端对话应用，功能类似 ChatGPT，但墙很高；而 Google AI Studio（<a href="https://link.juejin.cn?target=https%3A%2F%2Faistudio.google.com%25EF%25BC%2589" target="_blank" title="https://aistudio.google.com%EF%BC%89" ref="nofollow noopener noreferrer">aistudio.google.com）</a> 是一个基于网页的模型测试与 API 管理平台，访问更为便利。笔者后续演示均基于 Google AI Studio 完成，通过一个前端开发任务展示 Gemini 3.0 的实际性能。</p>
<p>Google AI Studio 提供两种主要的模型调用模式：</p>
<ul>
<li><strong>普通对话模式</strong>：适用于常规问答与文本生成任务；</li>
<li><strong>氛围编程（Vibe Code）模式</strong>：支持 Gemini 调用本地文件管理、网络搜索、谷歌文生图（NanoBanana）等 API，具备完整的在线运行与演示环境，并能根据运行结果自动debug。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc506220d7ea47319ca3812093826dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=xgMa6q5CXOYcQ6AUtkLdAYDsg4M%3D" alt="13.png" loading="lazy"/></p>
<h3 data-id="heading-6">2.2 氛围编程实战演示</h3>
<p>选择“氛围编程”进入 Build 页面后，用户可在对话框中输入任意需求，并自由勾选需要调用的工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/466287e91f664e118e1e4a4343f38960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=X1%2FKK%2BjF4c0q3JW%2BsiL9aaEw87Y%3D" alt="14.png" loading="lazy"/></p>
<p>这里最强大的在于用户输入不仅限于严格的编程指令，也可以是日常对话。例如，笔者这里要求模型讲解某个知识点。Gemini 会以代码为工具、APP 为媒介响应用户需求。例如，输入以下内容：</p>
<blockquote>
<p>“我想深入了解 DeepSeek 最新发布的 DeepSeek-OCR 模型，尤其是模型特性和使用方法。”</p>
</blockquote>
<p>输入需求后，笔者勾选“谷歌搜索”作为关联工具，点击 Build。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/338a06d1aca24c56b9d528c70eee09fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=M7Olf2Ce%2BW7YWxA%2BE7qQUea89tU%3D" alt="15.png" loading="lazy"/></p>
<p>Gemini 不会直接返回文本答案，而是先检索相关信息，再通过构建一个完整的应用来满足需求。Google AI Studio 内置了应用的运行环境，构建完成后可直接启动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cdedae3df5d4d788a29cf436b5890a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=7A2QrWa9jP0PjAlZLtLy%2Ff9%2BXME%3D" alt="17.png" loading="lazy"/></p>
<p>最终生成的是一款专门用于介绍 DeepSeek-OCR 的聊天应用。用户既可通过右上角按钮跳转至官网，也可在下方对话框中提问，系统均能流畅应答，简直就是DeepSeek-OCR模型定制的聊天机器人。用户还可在 Code 选项栏中查看完整代码，或点击下载按钮将项目导出至本地部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5916a1678204cd391b409add13e562b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=9ZreSBMYQWC0HXBQsb8Qp%2BjSaBQ%3D" alt="18.png" loading="lazy"/></p>
<h3 data-id="heading-7">2.3 复杂项目开发能力</h3>
<p>除了上述示例，Gemini 3.0 还能完成更为复杂的开发任务。官方演示中，Gemini 成功构建了一个类 MacOS 的操作系统界面。最终编程效果如下（想要获得完整提示词，可以关注笔者同名微信公众号：<strong>大模型真好玩</strong>， 并私信：<strong>Gemini MacOS提示词</strong> 获得），不仅各项功能完整，而且交互流畅，各个小组件都能顺利运行，甚至拖拽和点击效果都和MacOS系统分毫不差，整体看非常惊艳！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2e118d08091402ab0f9362d18e4b0c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764237450&amp;x-signature=lwtuda%2Fdrw3R7LgASlROcfItscI%3D" alt="1.gif" loading="lazy"/></p>
<h3 data-id="heading-8">2.4 开发模式的演进与展望</h3>
<p>从编程流程中不难发现，Gemini 3.0 采用了一种“智能体优先”的开发方式。整个过程不依赖传统 IDE 界面，仅通过对话框与最终效果图进行交互，开发者可直接根据运行结果指导模型调整项目。这种高度自动化的流程，离不开底层模型强大的编程能力。</p>
<p>随着基座模型性能的持续提升，这种以智能体为核心、全任务托管的编程方式有望成为主流。为适应这一趋势，谷歌推出了全球首款智能体优先的集成开发环境：AntiGravity，实现从自然语言输入到最终成品的一站式高效开发。这或许正是未来智能编程的初步形态。</p>
<p>如果说Claude还能让笔者这个前端程序员心有余悸，那Gemini3.0 有点直接给笔者宣判死刑！我现在都得感谢产品，正是它们天马行空“不合理”的需求才能让我有立足之地！希望大模型永远不要学会这些。</p>
<h2 data-id="heading-9">三、 总结</h2>
<p>本文分享了谷歌Gemini 3.0模型的核心特性，它以全方位性能优势超越GPT-5.1等主流模型，更凭借其卓越的编程能力被誉为“AI梦工厂”。Gemini3.0 能将自然语言指令直接转化为可运行应用，甚至能复刻类MacOS系统，展现了从需求到成品的惊人自动化流程。这不仅是技术的飞跃，更预演了以Agent为核心的未来开发范式。</p>
<p>以上就是本篇分享全部内容，同时也预告一下笔者的专栏<a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>正在火热更新中，最近笔者在组织LangChain1.0 多模态RAG实战分享的第二期，带大家构建一个前后端多模态RAG项目，预计本周完成，大家敬请期待~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果应用商店上架全流程复盘，一次真实项目从构建、上传到审核通过的经验总结]]></title>    <link>https://juejin.cn/post/7574622940688302099</link>    <guid>https://juejin.cn/post/7574622940688302099</guid>    <pubDate>2025-11-20T08:08:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574622940688302099" data-draft-id="7574530224853417990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果应用商店上架全流程复盘，一次真实项目从构建、上传到审核通过的经验总结"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T08:08:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00后程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果应用商店上架全流程复盘，一次真实项目从构建、上传到审核通过的经验总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00后程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:08:33.000Z" title="Thu Nov 20 2025 08:08:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你在一个技术团队里待得足够久，你一定听过这样的抱怨：
“开发做完了，但苹果应用商店上架卡了三天。”
“证书不对、权限说明缺失、截图尺寸错了……”
“上传 IPA 就卡住，Transporter 直接报错。”</p>
<p>上架 App Store 看似简单，但在真正的项目周期里，它往往是最容易出现意外的环节之一。
这篇文章不是传统教程，而更像是一场 <strong>“上架复盘会”</strong> 的会议纪要，记录我们团队一次完整的苹果应用商店上架经验，希望能给其他开发团队提供思路。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、开始前：我们到底需要准备什么？（项目 Kick-Off 阶段）</strong></h2>
<p>在正式准备上架之前，我们的第一件事情是制作一张上架材料总表。
我们发现，如果提前把所有材料摸清楚，上架时间能直接缩短至少 40%。</p>
<p>这张表包含：</p>
<h3 data-id="heading-1"><strong>1. 账号层面</strong></h3>
<ul>
<li>Apple Developer Program（有效状态）</li>
<li>App Store Connect 权限是否正常</li>
<li>团队成员角色分配（Admin、Developer、App Manager）</li>
</ul>
<h3 data-id="heading-2"><strong>2. 技术层面</strong></h3>
<ul>
<li>证书（Distribution）</li>
<li>描述文件（App Store）</li>
<li>App ID（Bundle ID）</li>
<li>IPA 构建方式（原生 / uni-app / Flutter 等）</li>
</ul>
<h3 data-id="heading-3"><strong>3. 内容层面</strong></h3>
<ul>
<li>6.5 寸 / 5.5 寸 iPhone 截图</li>
<li>iPad 截图（如支持）</li>
<li>隐私政策 URL</li>
<li>权限用途说明文案</li>
</ul>
<p>所有角色提前确认后，整个过程就不会临时插队和返工。</p>
<hr/>
<h2 data-id="heading-4"><strong>二、证书与描述文件：团队一致性的关键</strong></h2>
<p>过去我们团队最混乱的部分，就是“每个人电脑里都有一套自己的证书”，最终导致：</p>
<ul>
<li>有人上传失败</li>
<li>有人构建失败</li>
<li>有人描述文件版本对不上</li>
</ul>
<p>后来我们彻底调整流程，建立了一个统一原则：</p>
<h3 data-id="heading-5"><strong>所有证书只能由一个人或一条流水线生成，并集中管理。</strong></h3>
<p>在 Mac 不够用、团队成员操作系统不一致的情况下，我们采用了开心上架（Appuploader）跨平台生成方式。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b83aa8c377541e68337ed5443fab87c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230913&amp;x-signature=wzx8IDv9YYBrA0CNn%2B4wdkYiX5A%3D" alt="证书" loading="lazy"/></p>
<p>生成后的文件存放在团队安全仓库（例如 GitLab Protected Storage 或加密盘），所有人从同一套证书签名，避免环境不一致导致的构建问题。</p>
<hr/>
<h2 data-id="heading-6"><strong>三、构建 IPA：技术栈不同，策略不同</strong></h2>
<p>我们的项目包含原生部分，也包含 uni-app 部分，因此构建策略如下：</p>
<h3 data-id="heading-7"><strong>1. 原生部分（Swift）</strong></h3>
<p>由 Mac 端负责：</p>
<ul>
<li>Xcode → Archive → Export IPA</li>
<li>使用统一证书签名</li>
</ul>
<h3 data-id="heading-8"><strong>2. uni-app 部分</strong></h3>
<p>使用 HBuilderX 云打包，优点：</p>
<ul>
<li>Windows 成员也能构建</li>
<li>不依赖本地 Xcode</li>
<li>输出稳定的 IPA 文件
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b2df3e0b7ba4555afa60ac79ce14071~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230913&amp;x-signature=ikGEb%2FUZhkUrUA8suf3pmf7Jed4%3D" alt="hd打包" loading="lazy"/></li>
</ul>
<h3 data-id="heading-9"><strong>3. 自动化构建（CI/CD）</strong></h3>
<p>我们团队配置了一个 Pipeline：</p>
<ul>
<li>每次打 tag 自动构建</li>
<li>自动签名</li>
<li>自动产出 IPA</li>
</ul>
<p>这使得构建不再依赖某个开发者的电脑环境，也不再受 Mac 数量限制。</p>
<hr/>
<h2 data-id="heading-10"><strong>四、上传 IPA：瓶颈最多、最容易出问题的步骤</strong></h2>
<p>在没有统一工具前，团队曾经遇到过：</p>
<ul>
<li>Transporter 报错</li>
<li>上传卡住</li>
<li>某台 Mac 环境异常</li>
<li>altool 提示已弃用</li>
<li>Xcode 版本不兼容</li>
</ul>
<p>这些问题让我们意识到“上传应该尽量脱离个人电脑环境”。</p>
<p>最终我们采用跨平台命令行方式上传 IPA，这样无论团队成员使用 Windows、Linux 还是 macOS 都能发布。</p>
<p>示例命令：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./build/output.ipa
</code></pre>
<p>执行后 IPA 会进入：</p>
<ul>
<li><strong>TestFlight（用于测试）</strong></li>
<li><strong>App Store Connect 的构建版本栏位</strong></li>
</ul>
<p>此方式的最大价值在于：</p>
<ul>
<li><strong>不依赖某一台 Mac</strong></li>
<li><strong>可集成到 CI 自动上传</strong></li>
<li><strong>上传日志清晰可查</strong></li>
<li><strong>避免“个人机器坏了就无法发布”的风险</strong></li>
</ul>
<hr/>
<h2 data-id="heading-11"><strong>五、创建 App Store 页面：产品、设计与技术协同的环节</strong></h2>
<p>上传构建之后，App Store 页面配置同样关键，甚至经常决定审核是否顺利。</p>
<h3 data-id="heading-12">产品团队负责：</h3>
<ul>
<li>App 名称</li>
<li>简介与详细描述</li>
<li>分类与关键词</li>
<li>隐私政策 URL</li>
</ul>
<h3 data-id="heading-13">设计团队负责：</h3>
<ul>
<li>所有设备尺寸截图</li>
<li>必要的预览视频（可选）</li>
<li>截图语言版本（如多语言）</li>
</ul>
<h3 data-id="heading-14">技术团队负责：</h3>
<ul>
<li>权限用途说明检查</li>
<li>API 行为符合 App Store 规范</li>
<li>登录、注册流程稳定</li>
</ul>
<p>我们为此建立了一个共享文档，让每个角色一次性填完所有信息，减少来回修改造成的延迟。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc295d2bad6f4e4c83984e04ed0cade0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230913&amp;x-signature=EfE8Q0S%2BHwWKquZg5HrgoTIbHFU%3D" alt="asc" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-15"><strong>六、审核过程：如何避免被拒？</strong></h2>
<p>根据多年上架经验，我们总结了最容易被拒的 6 类问题：</p>
<h3 data-id="heading-16"><strong>1. 权限用途描述缺失（最常见）</strong></h3>
<p>例如缺少：</p>
<ul>
<li>NSCameraUsageDescription</li>
<li>NSLocationUsageDescription</li>
</ul>
<h3 data-id="heading-17"><strong>2. 截图与实际界面不符</strong></h3>
<p>审核员会对比截图与应用 UI。</p>
<h3 data-id="heading-18"><strong>3. App 闪退或某个功能不可用</strong></h3>
<p>TestFlight 测试能提前暴露这些问题。</p>
<h3 data-id="heading-19"><strong>4. 用户注册无法通过</strong></h3>
<p>苹果会实际操作流程。</p>
<h3 data-id="heading-20"><strong>5. 违反 IAP 规范</strong></h3>
<p>包含外链支付基本会被拒。</p>
<h3 data-id="heading-21"><strong>6. 账号权限问题</strong></h3>
<p>测试账号不可用，审核员会直接拒绝。</p>
<p>为了避免这些问题，我们团队建立了“审核前检查清单”，由 QA 或开发执行一次完整测试。</p>
<hr/>
<h2 data-id="heading-22"><strong>上线发布，管理版本与风险控制</strong></h2>
<p>审核通过后，我们通常不会立即发布，而是：</p>
<ul>
<li>选择“手动发布”</li>
<li>让团队再做一次验收</li>
<li>检查是否存在版本号冲突</li>
<li>更新应用更新公告</li>
</ul>
<p>当一切准备好后，才点击最终发布。</p>
<p>这种做法可以避免用户下载到问题版本，也避免紧急回滚的风险。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iFlow CLI：强大的终端AI助手，开启智能编程新时代]]></title>    <link>https://juejin.cn/post/7574581079627317254</link>    <guid>https://juejin.cn/post/7574581079627317254</guid>    <pubDate>2025-11-20T08:10:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627317254" data-draft-id="7574621075322847295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iFlow CLI：强大的终端AI助手，开启智能编程新时代"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-20T08:10:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iFlow CLI：强大的终端AI助手，开启智能编程新时代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:10:45.000Z" title="Thu Nov 20 2025 08:10:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>正在参与 iFlow CLI 模力全开｜案例征集活动</p>
<blockquote>
<p>快速开始 | 心流开放平台</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在当今快节奏的软件开发环境中，开发者们一直在寻求更高效、更智能的工具来提高工作效率。阿里心流团队推出的iFlow CLI正是一款应运而生的产品——一个集成在终端中的AI智能体，让开发者能够通过自然语言与AI交互，完成代码分析、文档生成、调试排错、文件管理等多种任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b01a56d7bf047aeb2aec9d13682265e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=IUFQzzufZ%2B42J8aBh%2Boe8mfX5zI%3D" alt="image-20251120151306448" loading="lazy"/></p>
<p>本文将详细介绍iFlow CLI的安装方法，并通过一个简单的Web工具开发案例，帮助读者快速上手这款强大的AI编程助手。</p>
<h2 data-id="heading-1">什么是iFlow CLI？</h2>
<p>iFlow CLI是一款在终端中运行的智能体式命令行工具，旨在把自然语言交互和多模态能力带入开发者日常工作流。它具备以下核心特性：</p>
<ul>
<li><strong>自然语言交互</strong>：支持用自然语言下达指令，无需记忆复杂命令</li>
<li><strong>本地仓库分析与上下文理解</strong>：通过<code>/init</code>命令扫描并理解本地代码仓库</li>
<li><strong>多模型支持</strong>：支持多种主流国产大模型，如Qwen3 Coder、Kimi K2、DeepSeek V3.2等</li>
<li><strong>永久免费</strong>：面向个人用户永久免费，不限流量</li>
<li><strong>扩展性强</strong>：支持通过安装子代理（SubAgents）和MCP工具来扩展功能</li>
</ul>
<h2 data-id="heading-2">安装iFlow CLI</h2>
<h3 data-id="heading-3">系统要求</h3>
<p>iFlow CLI支持多种操作系统：</p>
<ul>
<li>macOS</li>
<li>Linux</li>
<li>Windows（含WSL）</li>
</ul>
<h3 data-id="heading-4">安装步骤</h3>
<h4 data-id="heading-5">方法一：使用npm安装（推荐）</h4>
<pre><code class="hljs language-bash" lang="bash">
npm install -g @iflow/cli
</code></pre>
<h4 data-id="heading-6">方法二：使用国内镜像安装</h4>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 使用淘宝镜像</span>

npm install -g @iflow/cli --registry https://registry.npmmirror.com
</code></pre>
<h4 data-id="heading-7">方法三：直接下载安装包</h4>
<p>访问iFlow CLI的官方GitHub仓库，下载对应操作系统的安装包：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 克隆仓库（如果使用Git）</span>

git <span class="hljs-built_in">clone</span> https://github.com/iflow-fun/iflow-cli.git

<span class="hljs-built_in">cd</span> iflow-cli

npm install -g
</code></pre>
<h3 data-id="heading-8">验证安装</h3>
<p>安装完成后，可以在终端中输入以下命令验证安装是否成功：</p>
<pre><code class="hljs language-css" lang="css">
iflow <span class="hljs-attr">--version</span>
</code></pre>
<p>如果成功安装，将显示iFlow CLI的版本信息。</p>
<h3 data-id="heading-9">初始化配置</h3>
<p>首次使用时，运行以下命令进行初始化：</p>
<pre><code class="hljs language-csharp" lang="csharp">
iflow <span class="hljs-keyword">init</span>
</code></pre>
<p>这将引导你完成基本配置，包括选择默认AI模型等。</p>
<h2 data-id="heading-10">iFlow CLI核心功能介绍</h2>
<h3 data-id="heading-11">1. 四种运行模式</h3>
<p>iFlow CLI支持四种运行模式，可以通过Shift + Tab快捷键进行切换：</p>
<ul>
<li><strong>Yolo模式</strong>：模型拥有最高权限，执行操作零限制</li>
<li><strong>Accepting Edits模式</strong>：仅允许修改文件，安全可控</li>
<li><strong>Plan Mode</strong>：先规划任务步骤，再逐层执行</li>
<li><strong>Default模式</strong>：模型无任何权限</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a050da8a024d97861256bc412b7d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=VetVi40CeUO9pL0iKMgj3jIPFxU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">2. 项目分析功能</h3>
<p>在代码项目目录下运行<code>/init</code>，iFlow CLI可以分析项目的结构和主要功能，帮助开发者快速了解项目布局。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d6f4bcd4e164da39d9b187680a3a408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=2SeR2ob0msx9knMwOcL7o6VuEIY%3D" alt="image-20251120152131227" loading="lazy"/></p>
<h3 data-id="heading-13">3. 自然语言交互</h3>
<p>用户可以直接提出任务目标，iFlow CLI会开始逐步规划、生成、执行、确认修改，必要时提醒你测试或备份。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b277cc519bf4e3e83a61e6ce73f6bba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=jf%2BmxW7YWig5FBYeVmNA1oS6wcw%3D" alt="image-20251120152154513" loading="lazy"/></p>
<h3 data-id="heading-14">4. 多模态支持</h3>
<p>支持文本、图片、文件引用等多种输入形式，让AI模型能够"理解"图片内容。</p>
<h2 data-id="heading-15">开发案例：创建一个简单的Web工具</h2>
<p>接下来，我们通过一个实际案例来演示如何使用iFlow CLI开发一个简单的Web工具——一个待办事项管理器。</p>
<h3 data-id="heading-16">项目初始化</h3>
<p>首先，创建一个新项目目录并初始化：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-built_in">mkdir</span> todo-web-app

<span class="hljs-built_in">cd</span> todo-web-app
</code></pre>
<p>在项目目录中运行iFlow CLI的初始化命令：</p>
<pre><code class="hljs language-bash" lang="bash">
/init
</code></pre>
<p>iFlow CLI将扫描目录并生成项目说明。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc7e6a306f34abf87cb1850a5bb2896~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=TI4C%2B%2BLxdq54F9CIISmo%2B8OL%2Btk%3D" alt="image-20251120152454101" loading="lazy"/></p>
<h3 data-id="heading-17">创建项目结构</h3>
<p>让我们使用iFlow CLI创建一个基本的项目结构：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我创建一个简单的待办事项Web应用，包含以下文件：

<span class="hljs-deletion">- index.html：主页面</span>

<span class="hljs-deletion">- styles.css：样式文件</span>

<span class="hljs-deletion">- script.js：JavaScript逻辑</span>

<span class="hljs-deletion">- README.md：项目说明</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4ac570d097947ce97de2cd7f6d69e78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=nfYjUF1%2F7SZwlbvdwn9K0JZ3KDQ%3D" alt="image-20251120153010775" loading="lazy"/></p>
<h3 data-id="heading-18">编写HTML页面</h3>
<p>现在让我们创建主页面：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我编写index.html文件，创建一个简洁美观的待办事项管理器界面，包含：

<span class="hljs-deletion">- 标题"我的待办事项"</span>

<span class="hljs-deletion">- 一个输入框用于添加新任务</span>

<span class="hljs-deletion">- 添加按钮</span>

<span class="hljs-deletion">- 任务列表展示区域</span>

<span class="hljs-deletion">- 清空已完成任务的按钮</span>
</code></pre>
<h3 data-id="heading-19">添加样式设计</h3>
<p>让我们为页面添加样式：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我编写styles.css文件，为待办事项管理器添加现代风格的样式，包括：

<span class="hljs-deletion">- 响应式布局</span>

<span class="hljs-deletion">- 美观的颜色搭配</span>

<span class="hljs-deletion">- 任务项的悬停效果</span>

<span class="hljs-deletion">- 完成任务的样式变化</span>
</code></pre>
<h3 data-id="heading-20">实现JavaScript功能</h3>
<p>现在让我们实现核心功能：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我编写script.js文件，实现待办事项管理器的完整功能，包括：

<span class="hljs-deletion">- 添加新任务</span>

<span class="hljs-deletion">- 标记任务为完成/未完成</span>

<span class="hljs-deletion">- 删除任务</span>

<span class="hljs-deletion">- 清空已完成任务</span>

<span class="hljs-deletion">- 本地存储保存数据</span>
</code></pre>
<h3 data-id="heading-21">测试应用</h3>
<p>让我们测试一下我们的应用：</p>
<pre><code class="hljs">
请帮我启动一个本地服务器来运行这个待办事项应用，并告诉我如何访问
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfceab3a1a614b8eb228ee9a55b4be03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=mRR6SS8hR7MHOHISW%2BoNbs%2B56lw%3D" alt="image-20251120153130505" loading="lazy"/></p>
<h3 data-id="heading-22">优化功能</h3>
<p>根据测试结果，我们可以进一步优化：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我优化待办事项应用的功能，添加以下特性：

<span class="hljs-deletion">- 任务优先级设置（高/中/低）</span>

<span class="hljs-deletion">- 任务搜索功能</span>

<span class="hljs-deletion">- 任务统计信息（总任务数、已完成数等）</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b146711fffc4b858dbeda4f45f60e16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=LLrB9RIxAo2z%2BAPI%2F8vsbjVZu8I%3D" alt="image-20251120154059007" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a426d089f0f94be5b10523f14ee9d97d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=2ACy9%2B%2FUYSBxJ1g2Axe%2Bo6iEdeg%3D" alt="image-20251120154112049" loading="lazy"/></p>
<h2 data-id="heading-23">高级功能与技巧</h2>
<h3 data-id="heading-24">SubAgent智能分工系统</h3>
<p>iFlow CLI支持SubAgent系统，类似于拥有一个专业团队，每个成员都有自己的专长领域：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 查看所有可用的SubAgents</span>

iflow agent --<span class="hljs-built_in">help</span>

<span class="hljs-comment"># 安装特定的SubAgent</span>

iflow agent install &lt;agent-name&gt;
</code></pre>
<h3 data-id="heading-25">MCP工具集成</h3>
<p>通过心流MCP市场，可以快速安装MCP工具到iFlow CLI中：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 查看可用的MCP工具</span>

iflow mcp list
</code></pre>
<h3 data-id="heading-26">项目级上下文理解</h3>
<p>使用<code>/init</code>命令让iFlow CLI预先学习当前项目的文件结构，从而对上下文有更好的理解。</p>
<h2 data-id="heading-27">使用技巧与最佳实践</h2>
<h3 data-id="heading-28">1. 明确的指令</h3>
<p>提供清晰明确的指令，包括具体的功能要求和样式偏好。</p>
<h3 data-id="heading-29">2. 分步骤开发</h3>
<p>将复杂的开发任务分解为多个小步骤，逐步完成。</p>
<h3 data-id="heading-30">3. 利用上下文理解</h3>
<p>在项目目录中使用<code>/init</code>命令，让iFlow CLI更好地理解项目结构。</p>
<h3 data-id="heading-31">4. 模式选择</h3>
<p>根据任务安全要求选择合适的运行模式。</p>
<h2 data-id="heading-32">与同类工具的对比</h2>
<p>| 特性 | iFlow CLI | GitHub Copilot | Claude Code |</p>
<p>|------|-----------|----------------|-------------|</p>
<p>| 语言交互 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4060329340479081efc0d3f2e4b9bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=5YSTwGRPvvChkKr3Jay0efv3pkQ%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8951c8bfa634a02a01e52de08ee6ef6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=BLWxjr%2Bb%2B9Tjo8%2FPj2%2Fwi7BKnrw%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fd6b15c21934ce09c4570451395d732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=Q3Mm7NhX8rnt5uf5PDlsEdNYDPA%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> |</p>
<p>| 项目分析 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63344cc42d0343fcbca683850d9db5bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=YPBJddEIyNRxJofD5%2FFr83YZNFs%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | 部分 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37b039a7f6934136a5ef7907101bb00c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=Z4w%2Fz2fOsOyi5TSc5vR5HiBHU64%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> |</p>
<p>| 国产模型支持 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d90a493b82614837a8f263fa1c8c5aa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=AFnuMCfhcR6m6y8C%2BOhbQub5EeY%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4858d6ef42b647589711f16fbcb7d101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=OTsU7VL26nQ%2FcOToXuyjXMwgmbY%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e5507241a5b4607bf560b30e7210c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=rHBGIV%2F3zd9ACvm9l%2F8EuEkW1iE%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> |</p>
<p>| 永久免费 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b9d390b8d034d3190ce12119f93bfd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=%2BRDPzJjdq%2B4Wklc%2FoWPH%2Ba5P9I8%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0155cc21e5b54c5688ad61e98edc1aa7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=Xq4PiNQM4j4FGFeoXTfwWYGtwPk%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f59dece1fbb9414cab43a3870fb79e3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=nI%2F4XFxihXuRBmmONz1KSwww3EE%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> |</p>
<p>| 终端集成 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1baa3228ee1943b59ae3bb0bf242a93a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=yrigUaAOeeMjWiihPUuAGiE4AIg%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cddba2b9670d4bd898cc96a2761ffe90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=bMVE554d1x4Q6gkY5GZO3pZyvKU%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/598eba58ff694f8f94a78acd9a6070b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=lSE3mAYP4WEIKLxWQ%2BTvqujcQsE%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> |</p>
<p>| 本土化体验 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/697b19d6f90a4446a51b0ba876b736c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=EEfOP0012RWoy5%2Bba8UzlS65AcA%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27e40973f9384c998d9f2ccb75e0f3cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=WrzBzyC%2BWf%2FMLc5IlVkvpmrQr%2Bc%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8e2f79ca7bd459aba2ea929ae9c606e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=ioZcxTAL1xAEoupUx230SrqevYA%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> |</p>
<h2 data-id="heading-33">总结</h2>
<p>iFlow CLI作为一款强大的终端AI助手，为开发者提供了全新的编程体验。通过自然语言交互，开发者可以更专注于创意和逻辑，而将具体实现细节交给AI助手处理。</p>
<p>本文通过详细介绍iFlow CLI的安装方法和一个完整的Web应用开发案例，展示了这款工具的强大功能和易用性。从项目初始化到功能实现，iFlow CLI都能提供有力的支持。</p>
<p>随着AI技术的不断发展，像iFlow CLI这样的智能编程工具将成为开发者的重要伙伴，帮助我们更高效地完成各种开发任务。</p>
<h3 data-id="heading-34">未来展望</h3>
<p>iFlow CLI团队还在不断更新和完善产品，未来可能包括：</p>
<ul>
<li>更多国产模型的集成</li>
<li>更丰富的SubAgent生态</li>
<li>更强大的项目分析能力</li>
<li>更完善的开发工作流</li>
</ul>
<p>如果你还在为复杂的编程任务而困扰，不妨试试iFlow CLI，体验AI编程带来的全新体验！</p>
<hr/>
<p><em>本文介绍了iFlow CLI的基本安装方法和开发应用案例，希望能帮助开发者们更高效地使用这一强大工具。如需更多信息，请访问iFlow CLI官方网站和文档。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[架构提效的矛盾和矛盾的主要方面]]></title>    <link>https://juejin.cn/post/7574621387572838446</link>    <guid>https://juejin.cn/post/7574621387572838446</guid>    <pubDate>2025-11-20T08:08:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621387572838446" data-draft-id="7574621387572576302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="架构提效的矛盾和矛盾的主要方面"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:08:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            架构提效的矛盾和矛盾的主要方面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:08:48.000Z" title="Thu Nov 20 2025 08:08:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在软件开发领域，架构设计是确保系统高效、稳定运行的重要环节或者称之为重要动作。无论架构从简单到复杂，还是从复杂回归简洁的演变过程。在这个过程中，又无论是初创公司还是大型企业，架构提效始终是技术团队的核心追求。本文将从稳定、性能、代码三大维度出发，结合实战经验，探讨如何有效提升架构效能。</p>
<p>为什么要选择或者认为这三个维度是必要要素呢？</p>
<blockquote>
<p>“一切事物中包含的矛盾方面的相互依赖和相互斗争，决定一切事物的生命，推动一切事物的发展。没有什么事物是不包含矛盾的，没有矛盾就没有世界。”</p>
</blockquote>
<p>当然架构也有自身的矛盾统一，在架构提效上，系统的运行正常和问题频出是一对矛盾，功能的快和慢是一对矛盾，工程的整洁有序和无序是一对矛盾。这三对矛盾正是架构提效的矛盾。</p>
<p>如果不稳定，系统三天两头出故障，研发人员成了救火队员，系统的效率将无从谈起，稳定是我们谈架构效率的基础。如果性能不高，在网络基础环境稳定的情况下，访问一个页面3S才响应，那我们也不好意思说架构有效率。如果代码乱成一锅粥，比如大段大段面条式的代码，再比如满眼望去N多个if结构语句，研发人员加一个功能都要查找好久，也是无颜谈效率。</p>
<p>因此，我们认为，稳定、性能、代码是架构提效矛盾中的主要方面。接下来我们将从这三个主要方面去介绍。</p>
<p>软件工程发展了这么多年，高可用、高扩展、高并发已经有大量的文章篇幅，从宏观的角度去讲如何做微服务、如何分库分表，如何使用缓存等等。因此呢，本篇文章想聚焦到架构矛盾的微观层面，也就是偏工程结构、偏代码方面去阐述这三个要素。另外本篇文章的思想也参考了前辈们的研究成果，我也附在了文末。</p>
<p><strong>稳定：架构的基石与守护神</strong></p>
<p>“万事万物都是运动的，发展的”。业务功能变多，用户数量变多，团队规模变大。如果没有规则和规范的引导和约束，系统逐渐野蛮生长，逐渐碎片化。那么，我们的系统何谈稳定呢。</p>
<p>我们就希望能找到这样的一种规则、规范 -- 正交分解或者叫做正交设计。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4701579a6f7e4ef9bb95a9cc66ba76f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=X6JEv09vRwQG67EFrmOsyCXN96s%3D" alt="image.png" loading="lazy"/></p>
<p>架构设计的过程就是一个业务正交分解的过程。</p>
<p><strong>架构设计并不仅仅是技术层面的规划，更重要的是对业务逻辑的深入理解和把握。通过正交分解，我们可以将复杂的业务系统拆解成若干个相互独立但又彼此关联的模块或组件。这些模块或组件在保持功能完整性的同时，还能实现高度的内聚和松散的耦合，从而提高系统的可扩展性、可维护性和可重用性。</strong></p>
<p>正交分解的关键在于消除重复、分离关注点和管理依赖。通过这一方法，我们可以将业务系统中的公共部分和可变部分进行明确的划分，从而实现对业务逻辑的精准掌控。在架构设计过程中，我们需要不断地对业务进行抽象和分解，直至得到一系列规模可控、结构清晰的小模块。这些小模块通过组合和协作，能够形成更加复杂且功能完善的软件系统。</p>
<p>因此，正交分解的思想是我们架构设计保障稳定的重要方法基础。</p>
<p><strong>性能：速度与效率的双重考验</strong></p>
<p>想快，就使用“战术设计”。曾经这是很多程序员的法宝，因为他们认为这样开发“确实快”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f19c2a19ca841879052a09a529928c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=G8vY7LbSK4ePQEsvqN4yawaaHnM%3D" alt="image.png" loading="lazy"/></p>
<p>大多数程序员以称为战术编程的心态来进行软件开发。在战术方法中，主要重点是使某些功能正常工作，例如新功能或错误修复。乍一看，这似乎是完全合理的：还有什么比编写有效的代码更重要的呢？但是，战术编程几乎不可能产生出良好的系统设计。</p>
<p>想快的“战术设计”会造成常见的下面这样的情况。</p>
<p><strong>“团队新人不熟悉系统，为了急于上线一个特性，又不想影响到系统的其他部分，就会很自然地在某个地方加一个 flag，然后在所有需要改动的地方加 if 判断，而不是去调整系统设计以适应新的问题空间。”</strong></p>
<p>在一个充满活力的软件开发团队中，新成员小张刚刚加入不久。他对于团队正在使用的复杂系统还不是很熟悉，但面对紧迫的项目进度和上级施加的压力，他急于证明自己，并希望能尽快为团队做出贡献。团队正计划上线一个新的特性，这个特性需要在不干扰系统其他部分的前提下实现。</p>
<p>小张在浏览了系统的代码库后，发现要全面理解并调整整个系统设计以适应新的特性，需要花费大量的时间和精力。他深知自己作为新人，在这方面还有所欠缺，因此，他决定采取一个他认为更为“高效”的方法：在某个关键位置添加一个临时的标志位（flag），然后在所有需要改动的地方都加上if判断，以确保新特性能够按时上线，同时尽量减少对现有系统的影响。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cc186e29b0147d3b81e38b406a94689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=sIk5G3Xomu9fEJ7YvoFi8Wu9gUI%3D" alt="image.png" loading="lazy"/></p>
<p>虽然这种方法在短时间内确实让新特性得以顺利上线，但团队中的资深成员很快便发现了潜在的问题。这种做法虽然看似快速解决了问题，但实际上却在系统中埋下了隐患。它不仅增加了代码的复杂性，降低了代码的可读性和可维护性，还可能在未来引发更多的bug和性能问题。更重要的是，这种做法违背了软件开发中的最佳实践，<strong>即应通过优化系统设计来适应新的问题空间，而不是通过添加临时性的补丁来解决问题。</strong></p>
<p><strong>“几乎每个软件开发组织都有至少一个将战术编程发挥到极致的开发人员：战术龙卷风”，而且常常被视为团队”英雄“，因为能“快速完成任务且高产”。</strong></p>
<p>“战术龙卷风”通常以战术编程为主要手段，即采用最快速、最直接的方法来解决当前的问题，而不考虑长远的影响和代码的可持续性。这种方法在初次使用时往往能够取得显著的效果，任务完成得既快又好，赢得了团队成员的赞誉和领导的认可。</p>
<p>然而，随着时间的推移，“战术龙卷风”所留下的隐患逐渐暴露出来。由于缺乏对系统设计的深入理解和长远规划，他的代码往往难以维护和扩展。当需要添加新功能或修复bug时，团队成员往往需要花费更多的时间和精力来理解和修改他的代码。因此，第二次和第三次修改时，效率会大幅下降，甚至可能引发新的问题。</p>
<p>实际造成结果：第一次快、第二次慢、第三次更慢。</p>
<p><strong>代码：简洁与优雅的双重追求</strong></p>
<p>我们做业务开发，代码的优雅简洁，不能局限在一段方法，还是要从整个工程结构然后在到类、到方法，这样从宏观到中观再到微观的整体去要求。我们的应用工程结构，常见大致分为四层。分别是api层、biz层、domain层和dao层。</p>
<p>这个时候我们就要很清晰地熟悉每一层的职责，然后将我们的代码放入进去。首先，api层的作用，正如它的名字一样，是提供api服务的。向谁提供api呢，比如客户端，比如APP端、pc端等等，公司外面的客户，比如isv等。其次，biz层的作用，这一层也叫业务服务层。它主要负责编排。把一个业务场景下的主流程逻辑处理完成。这个主流程会涉及到多个原子接口，就在这层负责组装。再次，domain层的作用，也叫做领域服务层。按照OO思想，领域编程的思维，我们的”厚对象“的代码都在这层。比如订单域、运费域等。这里对“这一层的位置”多说几句，在没有形成领域之前，这层一般叫service层，不过我们都是建议领域思维编写代码。最后是dao层，也就是我们的存储层了，负责持久化。</p>
<p>在清晰了每一层的作用之后，如果我们的代码职责也是按照这样逐层放入的，那么大体是符合我们的整洁要求的。但是呢，随着时间的推移，需求的增多和变化。原来整洁的工程结构和代码已经不那么优雅了。</p>
<p><strong>这个时候，一般会出现两类现象，一类是业务层（biz）变的臃肿，能力层（domain）变的单薄。另一类是出现了网状调用。而且这两类现象也很有可能是混合在一起出现。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b367953438843b6bff7bb3a28d9cd8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=cSJBvD5QX55aVA6DrtmX0Ls4T2Y%3D" alt="image.png" loading="lazy"/></p>
<p>这两类现象会直接带来下面4种结果。</p>
<p>1、biz层越来越”胖“。胖了之后，还长成了两小层。上小层是面向单一业务场景的“业务biz层”，下小层成了通用场景可复用的“通用biz层”。</p>
<p>2、service层越来越”瘦“。当service层变薄了以后，也就只能沦为service了，而这样的service层跟dao层实际没什么区别，更不能再称之为domain层或者没有机会演变成domain层。</p>
<p>3、但是也不是所有的service层都变瘦、变薄了。可能有的萎缩，有的膨胀。人员与设计的差异，导致颗粒度不一。</p>
<p>4、出现了网状调用。原本biz-1 -&gt; service-1 的实现链路下，随着新增业务逻辑，又新起了一个service-2，链路演变成了biz-1 -&gt; service-1-&gt; service-2。“这样的趋势持续发展下去，会发现biz-1下的service调用链路越发的复杂，呈现为一颗深度调用树，而biz层失去了业务编排的作用退化为一个业务场景入口的标志符”。有可能后面继续3-4-5-6，越挖越深，不见尽头。</p>
<p>很显然，到这里，这样的结构现状，代码现状，已经远离了我们简洁和优雅的初衷。也谈不上提效了。</p>
<p>到此，我们介绍了架构提效中的稳定、性能和代码这三个主要的方面，限于篇幅和架构本身的实践性，还需要我们在架构提效上进行持续的优化。需要我们在稳定、性能、代码三大维度上不断探索和实践。通过高可用架构设计、性能优化策略、模块化与解耦、代码质量与规范等措施，我们可以构建一个既稳定又高效，且易于维护和扩展的系统。</p>
<blockquote>
<p>“在复杂的事物发展过程中，有许多的矛盾存在，其中必有一种是主要的矛盾，由于它的存在和发展规定和影响着其他矛盾的存在和发展。”</p>
</blockquote>
<p>架构的发展本身也是对抗熵增这一矛盾的过程，我们上面描述的稳定、性能和代码中的矛盾方面有是围绕和关联这一主要矛盾的。在这个过程中不仅有系统的有序变无序，也有组织的简单变复杂。我们既要关注技术层面的提升，更要注重团队协作、知识共享和持续改进的文化建设。只有这样，我们才能在快速变化的市场环境中，保持竞争力，不断前行。</p>
<p>最后，如果您对文章中的表述和观点有任何问题，亦或者您当前也正在致力于架构提效方面的工作，我们可以一起学习交流，微信号：wangxindong2015。</p>
<p>REF：<br/>
1、<a href="https://link.juejin.cn?target=https%3A%2F%2Ftime.geekbang.org%2Fcolumn%2Farticle%2F167844" target="_blank" title="https://time.geekbang.org/column/article/167844" ref="nofollow noopener noreferrer">time.geekbang.org/column/arti…</a> 如何判断架构设计的优劣<br/>
2、<a href="https://link.juejin.cn?target=https%3A%2F%2Fcactus-proj.github.io%2FA-Philosophy-of-Software-Design-zh%2F" target="_blank" title="https://cactus-proj.github.io/A-Philosophy-of-Software-Design-zh/" ref="nofollow noopener noreferrer">cactus-proj.github.io/A-Philosoph…</a> 软件设计的哲学<br/>
3、<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FjJzzJIGozOpt7KaXwBS3Ww" target="_blank" title="https://mp.weixin.qq.com/s/jJzzJIGozOpt7KaXwBS3Ww" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/jJzzJIGoz…</a> 业务系统架构实践总结<br/>
4、《矛盾论》，《毛泽东选集》第一卷</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[设计模式-策略模式]]></title>    <link>https://juejin.cn/post/7574369095545208866</link>    <guid>https://juejin.cn/post/7574369095545208866</guid>    <pubDate>2025-11-20T08:11:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574369095545208866" data-draft-id="7574601160980987919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="设计模式-策略模式"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:11:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            设计模式-策略模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:11:58.000Z" title="Thu Nov 20 2025 08:11:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">一、概念</h5>
<p>策略模式（Strategy Pattern）也称为（Policy Parttern）。 它定义了算法家族，分别封装起来，让它们之间可以互相替换，此模式让算法的变换，不会影响到使用算法的客户。策略模式属性行为模式。</p>
<p>策略模式结构图<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e29dc6f4c524494d8852178d25a41593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231118&amp;x-signature=la88RVSjLexw7oLo7TRUyfqDEFs%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-1"><strong>二、实际应用</strong></h5>
<p>业务场景：业务需要监听多种消息，将接收到的消息更新到同一个ES中，不同的消息类型使用不同的策略处理，补充不同的数据信息，更新到ES中，供商家搜索和统计使用。</p>
<p>代码实现结合spring框架、简单工厂和策略模式一起使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GatherExecuteService</span> {    
    <span class="hljs-comment">/**     
    * 处理消息体     
    *     
    * <span class="hljs-doctag">@param</span> gatherDataVo     
    */</span>    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(GatherDataVo gatherDataVo)</span>;
}
</code></pre>
<p>多个实现类</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 价格策略实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriceExecuteServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatherExecuteService</span> {    
    <span class="hljs-meta">@Override</span>    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">GatherDataVo gatherDataVo</span>) {
         .....具体实现代码省略   
    }
}
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 商品策略实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductExecuteServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatherExecuteService</span> {  

    <span class="hljs-meta">@Override</span>    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">GatherDataVo gatherDataVo</span>) {  

        .....具体实现代码省略  
    }
}
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 库存策略实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockExecuteServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatherExecuteService</span> {    
    <span class="hljs-meta">@Override</span>    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">GatherDataVo gatherDataVo</span>) {   
     .....具体实现代码省略  

     }
}
</code></pre>
<p>使用枚举存储策略实现bean</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">MessageTypeEnum</span> {    
    <span class="hljs-title function_">PRODUCT</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"productExecuteServiceImpl"</span>, <span class="hljs-string">"商品基本信息消息"</span>),    
    <span class="hljs-title function_">PRICE</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"priceExecuteServiceImpl"</span>, <span class="hljs-string">"价格消息"</span>),    
    <span class="hljs-title function_">STOCK</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"stockExecuteServiceImpl"</span>, <span class="hljs-string">"库存消息"</span>) ;    
    <span class="hljs-keyword">private</span> int <span class="hljs-keyword">type</span>;    
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> service;   
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> description;    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getServiceName</span>(<span class="hljs-params">int <span class="hljs-keyword">type</span></span>) {        
        <span class="hljs-title class_">MessageTypeEnum</span>[] typeEnums = <span class="hljs-title class_">MessageTypeEnum</span>.<span class="hljs-title function_">values</span>();        
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">MessageTypeEnum</span> enumType : typeEnums) {            
            <span class="hljs-keyword">if</span> (enumType.<span class="hljs-title function_">getType</span>() == <span class="hljs-keyword">type</span>) {                
                <span class="hljs-keyword">return</span> enumType.<span class="hljs-title function_">getService</span>();            
            }     
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    
    }
}
</code></pre>
<p>使用到不同策略的代码</p>
<pre><code class="hljs language-ini" lang="ini">// 根据消息类型获取不同策略类，然后使用spring的ApplicationContext获取bean，达到执行不同策略的目的。
String <span class="hljs-attr">serviceName</span> = MessageTypeEnum.getServiceName(gatherDataVo.getMessageType())<span class="hljs-comment">;</span>
if (StringUtils.isNotBlank(serviceName)) {  
    GatherExecuteService <span class="hljs-attr">gatherExecuteService</span> = (GatherExecuteService) SpringContextUtil.getBean(serviceName,                      GatherExecuteService.class)<span class="hljs-comment">;  </span>
}
</code></pre>
<p>策略模式是一种比较简单的设计模式，工作中经常和其他设计模式一块使用。简单的应用记录分享一下。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【A/B实验常见问题】实验异常值应该如何处理？]]></title>    <link>https://juejin.cn/post/7574404398066647040</link>    <guid>https://juejin.cn/post/7574404398066647040</guid>    <pubDate>2025-11-20T08:11:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574404398066647040" data-draft-id="7574600119750377482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【A/B实验常见问题】实验异常值应该如何处理？"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:11:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【A/B实验常见问题】实验异常值应该如何处理？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:11:27.000Z" title="Thu Nov 20 2025 08:11:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>背景</strong></h2>
<p>大家在做实验时有没有遇到过以下的问题？</p>
<blockquote>
<p>实验分流不太稳定，多次分流以后，发现随机分组历史数据指标波动特别大 实验结果不符合预期，在去掉几个特殊用户后结果变化较大、甚至正负反转 不同的业务场景设置的指标过滤规则不同，例如A场景过滤掉了成单超过100单的用户、但B场景没有过滤，实验指标应该选择哪个</p>
</blockquote>
<p>这里实验者大概率是遇到了实验中的异常值问题，我们接下来会讨论在互联网AB实验场景中，应该如何进行处理？</p>
<h2 data-id="heading-1"><strong>概念解析</strong></h2>
<p>从严格的学术角度来看，异常值并没有一个统一的定义和划分标准，在不同的领域会根据使用目的和数据特点有不同的定义逻辑和检验方法。即我们可以得到“在一个样本或集合中，与其余样本均有较大差异的样本点就是异常值”这样一个通用、模糊的概念，但具体差异较大的判定标准是什么，检测差异的方法有哪些，场景之间各不相同。</p>
<p>举个例子，很多人都听说过的3sigma原则指的是：如果一个样本取值超过了</p>
<p>均值±3∗标准差均值±3∗标准差</p>
<p>﻿这个范围，那么就属于异常值。但这个标准通常假设了样本的分布属于正态分布或者近似正态分布，对于互联网公司的幂律分布指标适用性较差，我相信大家都能感受到“JD大盘Top1%的用户成单GMV都是异常值”这个结论有多么的离谱。</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50238b71d72f487bb3caec39fe80fc46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=gpX%2Fvi787UOTkVgTmzcnW0JW%2Ff8%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>基于上述思考，后续研究中我们会着重研究在大样本、幂律分布等和互联网AB实验面临状况比较相似的情况，并参考比如调研分析、社会学等直接收集人类社会经济活动数据的学术分枝统计方法，以及新兴的算法方向的异常值检测、处理方法。</p>
<p>﻿</p>
<h2 data-id="heading-2"><strong>异常值产生的基本原因</strong></h2>
<p>•数据收集过程中的测量误差（工具误差）</p>
<p>•群体中个体的差异性（抽样带来的随机性）</p>
<p>•数据造假、作弊（刷单）</p>
<p>•收集的样本来源于不同的群体（比如京东App中有很多背后是B端的用户）</p>
<p>﻿</p>
<h2 data-id="heading-3"><strong>AB实验中异常值剔除的作用与局限性</strong></h2>
<h3 data-id="heading-4"><strong>1.为什么AB实验需要进行异常值处理？</strong></h3>
<p>•有一小部分异常用户，由于数据分布非常异常，造成了分流时无法将这一批用户每一次都很完美的均匀分布在实验组、对照组，异常用户在哪、哪个组就会出现AA不均匀的情况</p>
<p>•由于异常用户的指标值较大，造成了整体指标的波动性较大，让实验的精度变差、样本量需求变大，原本可以观测的实验效果就会被淹没在噪音中（指标方差较大带来实验最小提升量-MDE较大）</p>
<h3 data-id="heading-5"><strong>2.异常值剔除方案的局限性</strong></h3>
<p>•做不到的：无法识别业务逻辑中认定的异常值以及异常用户（比如xx用户命中了xx风控规则，所有数据不可信），无法识别指标统计错误（比如某用户1天内在一个页面的停留时长超过24H）</p>
<p>•能做但做不好的：降低指标的波动性，但同时可能会去掉了部分有效样本和有效数据，会让样本产生偏差（bias）。此时需要用更多的样本才能进行更灵敏的实验，或使用ANCOVA、CUPED等方差缩减的方法。</p>
<p>﻿</p>
<h2 data-id="heading-6"><strong>传统统计学方法的应用——</strong> <strong>trim &amp; winsorize方法对于补贴实验的效果对比</strong></h2>
<h3 data-id="heading-7"><strong>1.什么是trim方法与winsorize方法，为什么选择这些方法？</strong></h3>
<p>这两种方法其实源自于上个世纪的调研分析方法，当年的统计学家除了会遇到样本量不足的问题外，也会遇到在样本收集、统计过程中发生错误而导致的异常值。在当年各种算法技术、算力限制的情况下，统计学家会通过观察、处理当前数据指标分布的方式，对样本进行更加稳健的估计。具体来看</p>
<p>◦Winsorizing（或缩尾法）：当样本点的取值超过样本的特定分位数后，将取值直接替换为分位数值</p>
<p>◦Trimming（或去尾法）：当样本点的取值超过样本的特定分位数后，将样本点直接丢弃</p>
<h3 data-id="heading-8"><strong>2.数据表现</strong></h3>
<p>•我们使用异常值处理后对样本均值、标准差的影响作对比，可以发现在同样的分位数下，trimming方法通常会有更大的效果。</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/717091cfe3794b2eafb212f0d811d7fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=L3RgNTd%2F0a388Vtn9EE2QuTjv2I%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>•但如果我们忽略掉具体的分位数选择，直接对比方法的损失（横轴，均值估计偏差）与收益（纵轴，方差缩减效果），可以发现winsorize方法更具有优势，即在相同的均值估计偏差下，有更大的方差缩减效果（即下图中，左下角更好）。</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/220dcaa8f3ca423391666243eddb9b31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=79YlGIUAlT7Jt5JcgMF7itgC2ag%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>•方法对于实验的一类、二类错误影响如下👇</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5c3a827dde046259828e64d4dbbfa69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=piPhPeNaINEIn8g2f3O58K5LeH4%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<h3 data-id="heading-9"><strong>3.方案原理、效果对比</strong></h3>
<p>•在我们认为实验收集到的样本基本都是正常数据，只是分布比较分散时，不要轻易丢弃样本点，以防止损失样本对应的信息，此时Winsorizing（或缩尾法）相对是一个更加稳健的做法</p>
<p>•当样本中包含了很多脏数据和异常用户时（例如作弊、刷单用户），他们带来的信息会将会影响到样本的分布状态，那么使用trimming方法去掉他们会尽可能减弱此类影响</p>
<p>•在没有很多的业务输入情况下，可以根据数据的分布特征，并用winsorizing方法进行相对保守的异常值处理。</p>
<h3 data-id="heading-10"><strong>4.业务落地建议</strong></h3>
<p>•对于不同场景、不同类型的指标，业务需要根据自身场景特点，尽量排除脏数据、刷单作弊数据等异常情况</p>
<p>•对于本场景的重点指标，可以由分析人员进行一次性的分析，在得到合理的处理方案后可以尝试固化在实验平台</p>
<p>﻿</p>
<h2 data-id="heading-11"><strong>风控模型的应用</strong></h2>
<p>风控模型在内容时长指标异常值处理的应用👇</p>
<p>例：某实验在2024-09-30对照组出现人均时长指标异常增加的情况，影响实验观测。</p>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c817d367f04ce8a2862323e207faea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=YORDXP1oOcgncJ6g9%2F45pz%2BxfRs%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><em>注：数据已经做脱敏处理</em></p>
<p>通过排查发现若干异常用户的作弊行为，反馈风控团队进行剔刷。剔刷后，作弊用户数据有效减少。另一方面，从实验信息上报的角度，采用服务端上报也可以从一定程度避免异常用户进入实验，减少异常值，让实验数据更可靠。</p>
<p>﻿</p>
<h2 data-id="heading-12"><strong>一些异常值检测方法的介绍</strong></h2>
<p>从实验平台功能建设上，往往采用计算量较小的较为通用的方案；一种适用于实验平台的异常值检测方法：当峰度大于某个阈值时，取 top x%极大值作为异常样本。其核心思想是根据数据分布判断是否需要进行异常值处理，然后通过分位数划定异常样本范围。</p>
<p>•<em>峰度：对实值随机变量的概率分布的尾部的度量，峰度高就意味着方差增大是由低频度的大于或小于平均值的极端差值引起的。峰度计算公式如下：</em></p>
<p>γ2=μ4/σ4−3γ2​=μ4​/σ4−3</p>
<p>﻿ <em>，其中</em></p>
<p>μ4μ4​</p>
<p>﻿<em>表示四阶矩。</em></p>
<p>对于特定的数据，Z-score等简单方法效果不佳时，我们也可以使用较为复杂的方法进行处理。下面是一些异常值检测方法的简单</p>





















































































































<table><thead><tr><th>﻿</th><th><strong>方法</strong></th><th><strong>基本原理</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th></tr></thead><tbody><tr><td>统计和概率模型</td><td>箱线图</td><td>基于1.5倍IQR划定异常值阈值。</td><td>直观、简便。</td><td>自适应较差，对于部分数据分布会完全失效。</td></tr><tr><td>Z-score方法</td><td>基于数据标准化变换得到Z-score。正态分布可基于3sigma原则判断；一般分布可基于Chebyshev不等式；样本有界可基于Hoeffding不等式‌；对于高维空间，可基于样本与均值的马氏距离计算Z-score。</td><td>直观、简便。</td><td>样本统计量的估计受异常值影响；3sigma原则要求总体需服从正态分布；Chebyshev不等式需要合理选取阈值；高维空间需要矩阵求逆，计算量较大。</td><td/></tr><tr><td>Grubbs方法</td><td>基于样本的均值、最大值和最小值进行异常值检验。</td><td>避免方差受异常值干扰的影响。</td><td>通常只适用于小样本。</td><td/></tr><tr><td>基于方差贡献</td><td>寻找样本子集，使得样本在移除该子集前后基于方差定义的损失函数。</td><td>直观、简便。</td><td>直接计算子集无法在多项式时间内求解， 需要启发式算法，计算量较大。</td><td/></tr><tr><td>EM算法</td><td>可基于给定先验分布和群数计算各样本点分布的概率密度，基于概率密度判断异常值。</td><td>能够解决一般方法的打分阈值难选择的问题。</td><td>需要比较强的先验假设，计算量较大。</td><td/></tr><tr><td>绝对离差中位数</td><td>计算绝对离差。取其中位数，衡量异常值。</td><td>由于使用中位数，可以有效对抗异常值带来的影响。</td><td>自适应较差，对于部分数据分布会完全失效。</td><td/></tr><tr><td>基于机器学习算法</td><td>ODIN/LOF/LOCI</td><td>基于距离或者密度估计的异常值检测方法。</td><td>有一定的自适应性，能够根据相对疏密程度判断异常值</td><td>计算量较大。</td></tr><tr><td>直方图/Parzen窗函数概率密度估计</td><td>使用给定的分布计算各个样本点附近生成概率，加和构成估计的概率密度函数。</td><td>直观，简便，没有对分布的先验假设。</td><td>窗宽度是一个超参数，计算量较大。</td><td/></tr><tr><td>基于回归残差</td><td>基于先验知识拟合特征间的回归曲线，并基于拟合残差判定异常值，有时为了避免异常值对拟合结果产生影响，可以进行抽样。</td><td>直观，简便，在先验知识正确的前提下，检测结果较好。</td><td>需要较强的先验假设，异常值对回归拟合可能产生较大影响。</td><td/></tr><tr><td>PCA</td><td>将n维数据投影至k维平面上，在中心化的数据中，剩余k维向量范数较大的样本被判定为异常值。</td><td>可处理高维流行空间的异常值问题。</td><td>超参数k难以选择，如果需要使用PCA，核函数的选择需要先验知识。</td><td/></tr><tr><td>矩阵分解</td><td>将原矩阵分解为两个低秩矩阵，并将原数据用这两个低秩矩阵表出，将残差较大的样本判定为异常值。PCA本质上也可以理解为一种矩阵分解方法。</td><td>能够处理数据缺失问题。</td><td>仅适用于线性情况。</td><td/></tr><tr><td>autoencoder</td><td>使用给定数据训练自编码器，其编码器部分可以视作非线性降维方法，通过比较autoencoder的输入和输出差异，进行异常值判别。</td><td>引入非线性，通过自监督方式解决异常值检测缺乏训练标签的问题。</td><td>计算量较大。</td><td/></tr><tr><td>One-Class SVM</td><td>将所有样本视为1类，基于软间隔最大化训练支持向量机，并将跨过分隔平面的样本判定为异常值。</td><td>可通过核函数引入非线性。</td><td>核函数计算量较大。</td><td/></tr><tr><td>Isolation Forest</td><td>通过无监督方法构造一颗或多棵树，通过节点深度衡量异常程度。</td><td>通过抽样方法构建子树，使方法具有很高的效率。通过峰度系数选择特征，可以进一步提升子空间选择效率。</td><td>阈值的选择通常较为困难，且对不同的情况需要选择不同的阈值。</td><td/></tr><tr><td>Robust Random Cut Forest</td><td>改进Isolation Forest，对于特征选择概率依赖于各个维度的range。</td><td>相比改进Isolation Forest，对于特征选择的效率更高。</td><td>阈值的选择通常较为困难，且对不同的情况需要选择不同的阈值。</td><td/></tr></tbody></table>
<p>﻿</p>
<h2 data-id="heading-13"><strong>附录</strong></h2>
<p>实验波动性和实验精确度的关系：在计算实验效果时，利用实验组、对照组的均值、方差、样本量可以进行实验效果的假设检验，公式如下:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab7d353310940f4896aa3cd2a131293~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=QOsRQGebERwBeTydWColK4de83M%3D" alt="image.png" loading="lazy"/></p>
<p>其中,</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8164ff9e4efe4695a1d0e77cc9ede1aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=jG3%2FwxFX4mtZWdgoNm7TFpZljrA%3D" alt="image.png" loading="lazy"/></p>
<p>E(ATE)=μT−μCvar(ATE)=σATE2=σT2nT+σC2nCE(ATE)=μT​−μC​var(ATE)=σATE2​=nT​σT2​​+nC​σC2​​</p>
<p>﻿﻿</p>
<p>可以看到，如果实验的波动性（var(ATE)）越大，在实验效果（E(ATE)）不变的情况下，那T统计量就越小，实验就越不容易显著（精度较差）；此时就需要减小var(ATE)，即通过改变样本方差和样本量来减小样本波动性。</p>
<p>﻿</p>
<p><strong>关于我们</strong></p>
<blockquote>
<p>试金石作为京东零售统一的AB实验平台，致力于通过数据驱动的AB测试方法，进行科学的实验设计和数据分析，为业务提供客观、可靠的实验结果，帮助业务持续优化产品和服务；让业务能够自助、高效的运行实验，科学的进行业务决策，赋能业务持续迭代。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Axios 拦截器]]></title>    <link>https://juejin.cn/post/7574404398066483200</link>    <guid>https://juejin.cn/post/7574404398066483200</guid>    <pubDate>2025-11-20T07:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574404398066483200" data-draft-id="7574529034672767011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Axios 拦截器"/> <meta itemprop="keywords" content="前端,axios"/> <meta itemprop="datePublished" content="2025-11-20T07:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新晨437"/> <meta itemprop="url" content="https://juejin.cn/user/3957868231143133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Axios 拦截器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3957868231143133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新晨437
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:42:11.000Z" title="Thu Nov 20 2025 07:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Axios 拦截器是 Axios 库中非常强大的功能，它允许你在请求发送前或响应返回后对数据进行处理。下面详细介绍 Axios 拦截器的使用方法：</p>
<h2 data-id="heading-0">1. 请求拦截器</h2>
<h3 data-id="heading-1">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 添加请求拦截器</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) {
    <span class="hljs-comment">// 在发送请求之前做些什么</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求配置:'</span>, config);
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-comment">// 对请求错误做些什么</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h3 data-id="heading-2">实际应用场景</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加认证 token</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>);
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 添加公共参数</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    config.<span class="hljs-property">params</span> = {
      ...config.<span class="hljs-property">params</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>
    };
    <span class="hljs-keyword">return</span> config;
  }
);
</code></pre>
<h2 data-id="heading-3">2. 响应拦截器</h2>
<h3 data-id="heading-4">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加响应拦截器</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) {
    <span class="hljs-comment">// 2xx 范围内的状态码都会触发该函数</span>
    <span class="hljs-comment">// 对响应数据做点什么</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'响应数据:'</span>, response);
    <span class="hljs-keyword">return</span> response;
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-comment">// 超出 2xx 范围的状态码都会触发该函数</span>
    <span class="hljs-comment">// 对响应错误做点什么</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'响应错误:'</span>, error);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h3 data-id="heading-5">实际应用场景</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 统一处理响应数据</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-comment">// 如果后端返回的数据有统一格式，可以在这里处理</span>
    <span class="hljs-keyword">const</span> { data, code, message } = response.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> data;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 业务错误</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message));
    }
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// 处理 HTTP 错误</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {
      <span class="hljs-keyword">switch</span> (error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
          <span class="hljs-comment">// 未授权，跳转到登录页</span>
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
          <span class="hljs-comment">// 禁止访问</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'没有权限访问该资源'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
          <span class="hljs-comment">// 服务器错误</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'服务器内部错误'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error.<span class="hljs-property">message</span>);
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h2 data-id="heading-6">3. 完整示例</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 创建 axios 实例</span>
<span class="hljs-keyword">const</span> instance = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.example.com'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
});

<span class="hljs-comment">// 请求拦截器</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-comment">// 显示 loading</span>
    <span class="hljs-title function_">showLoading</span>();
    
    <span class="hljs-comment">// 添加 token</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-title function_">getToken</span>();
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    
    <span class="hljs-comment">// 记录请求开始时间</span>
    config.<span class="hljs-property">metadata</span> = { <span class="hljs-attr">startTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() };
    
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-title function_">hideLoading</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 响应拦截器</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-comment">// 隐藏 loading</span>
    <span class="hljs-title function_">hideLoading</span>();
    
    <span class="hljs-comment">// 计算请求耗时</span>
    <span class="hljs-keyword">const</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    <span class="hljs-keyword">const</span> duration = endTime - response.<span class="hljs-property">config</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">startTime</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`请求 <span class="hljs-subst">${response.config.url}</span> 耗时: <span class="hljs-subst">${duration}</span>ms`</span>);
    
    <span class="hljs-comment">// 统一处理响应格式</span>
    <span class="hljs-keyword">const</span> { code, data, message } = response.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> data;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 业务逻辑错误</span>
      <span class="hljs-title function_">showMessage</span>(message, <span class="hljs-string">'error'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message));
    }
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// 隐藏 loading</span>
    <span class="hljs-title function_">hideLoading</span>();
    
    <span class="hljs-comment">// 处理 HTTP 错误</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {
      <span class="hljs-keyword">const</span> { status, data } = error.<span class="hljs-property">response</span>;
      
      <span class="hljs-keyword">switch</span> (status) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
          <span class="hljs-title function_">removeToken</span>();
          router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
          <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'没有权限访问该资源'</span>, <span class="hljs-string">'error'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
          <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'服务器内部错误'</span>, <span class="hljs-string">'error'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          <span class="hljs-title function_">showMessage</span>(data?.<span class="hljs-property">message</span> || <span class="hljs-string">'请求失败'</span>, <span class="hljs-string">'error'</span>);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">request</span>) {
      <span class="hljs-comment">// 请求发送失败</span>
      <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'网络连接失败，请检查网络'</span>, <span class="hljs-string">'error'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 其他错误</span>
      <span class="hljs-title function_">showMessage</span>(error.<span class="hljs-property">message</span>, <span class="hljs-string">'error'</span>);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 辅助函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showLoading</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 显示 loading 的逻辑</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hideLoading</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 隐藏 loading 的逻辑</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showMessage</span>(<span class="hljs-params">message, type</span>) {
  <span class="hljs-comment">// 显示消息的逻辑</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getToken</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">removeToken</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> instance;
</code></pre>
<h2 data-id="heading-7">4. 移除拦截器</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加拦截器时会返回一个 ID</span>
<span class="hljs-keyword">const</span> requestInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> config);
<span class="hljs-keyword">const</span> responseInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response);

<span class="hljs-comment">// 移除拦截器</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">eject</span>(requestInterceptor);
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">eject</span>(responseInterceptor);
</code></pre>
<h2 data-id="heading-8">5. 多个拦截器的执行顺序</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 拦截器会按照添加顺序执行</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个请求拦截器'</span>);
  <span class="hljs-keyword">return</span> config;
});

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个请求拦截器'</span>);
  <span class="hljs-keyword">return</span> config;
});

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个响应拦截器'</span>);
  <span class="hljs-keyword">return</span> response;
});

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个响应拦截器'</span>);
  <span class="hljs-keyword">return</span> response;
});

<span class="hljs-comment">// 执行顺序：</span>
<span class="hljs-comment">// 第一个请求拦截器 → 第二个请求拦截器 → 请求发送</span>
<span class="hljs-comment">// 第一个响应拦截器 ← 第二个响应拦截器 ← 响应返回</span>
</code></pre>
<h2 data-id="heading-9">6. 在特定实例中使用拦截器</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建不同的 axios 实例用于不同的 API</span>
<span class="hljs-keyword">const</span> authApi = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://auth.api.com'</span>
});

<span class="hljs-keyword">const</span> dataApi = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://data.api.com'</span>
});

<span class="hljs-comment">// 为不同实例添加不同的拦截器</span>
authApi.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 认证相关的拦截逻辑</span>
  <span class="hljs-keyword">return</span> config;
});

dataApi.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 数据相关的拦截逻辑</span>
  <span class="hljs-keyword">return</span> config;
});
</code></pre>
<p>Axios 拦截器是一个非常实用的功能，可以帮助你统一处理请求和响应，减少重复代码，提高开发效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 changeset 新增组件库更新日志]]></title>    <link>https://juejin.cn/post/7574581079627333638</link>    <guid>https://juejin.cn/post/7574581079627333638</guid>    <pubDate>2025-11-20T08:11:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627333638" data-draft-id="7574530224853204998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 changeset 新增组件库更新日志"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:11:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="404号扳手"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919022807"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 changeset 新增组件库更新日志
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919022807/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    404号扳手
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:11:07.000Z" title="Thu Nov 20 2025 08:11:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>changeset</code> 是一个用于版本管理和变更日志记录的工具，常用于现代前端项目中。它可以帮助团队更好地跟踪每个更改的影响，并自动生成变更日志。
如果你想在 <code>changeset</code> 中新增组件库的日志，你需要创建一个新的 changeset 文件。这个文件通常是一个 Markdown 格式的文件，其中包含了你想要添加到变更日志中的信息。
以下是具体步骤：</p>
<ol>
<li>
<p>安装 Changeset CLI：如果你还没有安装 <code>@changesets/cli</code>，可以通过 npm 或 yarn 进行安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install @changesets/cli --save-dev
</code></pre>
<p>或者</p>
<pre><code class="hljs language-bash" lang="bash">yarn add @changesets/cli --dev
</code></pre>
</li>
<li>
<p>初始化 Changeset（如果尚未初始化）：</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset init
</code></pre>
</li>
<li>
<p>添加新的 Changeset：
运行以下命令来创建一个新的 changeset 文件：</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset
</code></pre>
</li>
<li>
<p>如果是 monorepo 项目，需要先选择更新的 package：</p>
<p>i. 用 ↑ / ↓ 方向键移动光标，选择当前行的 package。</p>
<p>ii. 按 <code>Space</code>（空格键） 勾选/取消勾选，勾选后前面会出现一个 <code>✔</code> 或 <code>◉</code>。</p>
<pre><code class="hljs"> 按一下空格：选中
 再按一下空格：取消选中
</code></pre>
<p>iii. 完成选择后按 <code>Enter</code>（回车）继续下一步。</p>
</li>
<li>
<p>进入选择版本变更等级（patch / minor / major）。</p>
</li>
<li>
<p>填写 Changeset 内容：
在打开的编辑器中，你可以按照提示选择受影响的包以及此次变更的类型（major, minor, patch）。然后，在 Markdown 文档中详细描述这次变更的内容。
例如，假设你要为一个名为 <code>my-component-library</code> 的包添加一条日志，描述了一个新功能的添加，你可以这样写：</p>
</li>
</ol>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">"my-component-library": patch
---</span>

新增了一个按钮组件 (<span class="hljs-code">`Button`</span>)，支持多种主题颜色和尺寸选项。
</code></pre>
<ol start="6">
<li>提交 Changeset 文件：
保存并关闭编辑器后，Changeset 会在 <code>.changeset</code> 目录下生成一个新的文件，内容类似于上面的示例。</li>
<li>构建发布：
当你准备好发布这些更改时，运行以下命令来应用所有未发布的 changeset 并更新包的版本号：
<pre><code class="hljs language-bash" lang="bash">npx changeset version
</code></pre>
然后，你可以使用你喜欢的包管理工具来发布更新后的包，比如：
<pre><code class="hljs language-bash" lang="bash">npm publish
</code></pre>
或者
<pre><code class="hljs language-bash" lang="bash">yarn publish
</code></pre>
</li>
</ol>
<p>通过以上步骤，你就可以成功地在 <code>changeset</code> 中新增组件库的日志了。每次运行 <code>npx changeset version</code> 后，所有的 changeset 文件会被合并成最终的 CHANGELOG.md 文件。
如果你需要更复杂的配置或有特定的需求，可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fatlassian%2Fchangesets" target="_blank" title="https://github.com/atlassian/changesets" ref="nofollow noopener noreferrer">Changeset 官方文档</a> 获取更多信息。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录]]></title>    <link>https://juejin.cn/post/7574619023804416038</link>    <guid>https://juejin.cn/post/7574619023804416038</guid>    <pubDate>2025-11-20T08:20:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023804416038" data-draft-id="7574619023804399654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:20:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="睡不着的可乐"/> <meta itemprop="url" content="https://juejin.cn/user/1680496691259559"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1680496691259559/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    睡不着的可乐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:20:25.000Z" title="Thu Nov 20 2025 08:20:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录</h2>
<h3 data-id="heading-1">一、问题背景</h3>
<p>在 Vben Admin 2.0 项目中使用内置 TinyMCE 富文本组件时，需要实现图片 Base64 编码直接嵌入内容的功能。自定义了图片上传后的处理函数 <code>handleDone</code>，但修改 <code>data URI</code> 前缀后出现显示异常。
注意：接口上传图片返回的是链接不用修改</p>
<h3 data-id="heading-2">二、问题现象对比</h3>
<h4 data-id="heading-3">1. 正常场景（正确前缀）</h4>
<p>代码实现：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDone</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span></span>) {

 <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">unref</span>(editorRef);

 <span class="hljs-keyword">if</span> (!editor) {

   <span class="hljs-keyword">return</span>;

 }

 <span class="hljs-keyword">const</span> content = editor?.<span class="hljs-title function_">getContent</span>() ?? <span class="hljs-string">''</span>;

 <span class="hljs-comment">// 使用图片对应的 MIME 类型（如 image/png、image/jpeg）</span>

 <span class="hljs-keyword">const</span> val = content?.<span class="hljs-title function_">replace</span>(<span class="hljs-title function_">getUploadingImgName</span>(name), \<span class="hljs-string">`\&lt;img src="data:\${type};base64,\${url}" /&gt;\`) ?? '';

 setValue(editor, val);

}
</span></code></pre>
<p>效果：</p>
<ul>
<li>
<p>富文本框中正常显示图片</p>
</li>
<li>
<p>审查元素可见完整 <code>&lt;img&gt;</code> 标签，<code>src</code> 为 <code>data:image/xxx;base64,...</code> 格式</p>
</li>
<li>
<p>浏览器能正确解析 Base64 图片数据</p>
</li>
</ul>
<h4 data-id="heading-4">2. 异常场景（错误前缀）</h4>
<p>代码实现：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDone</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span></span>) {

 <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">unref</span>(editorRef);

 <span class="hljs-keyword">if</span> (!editor) {

   <span class="hljs-keyword">return</span>;

 }

 <span class="hljs-keyword">const</span> content = editor?.<span class="hljs-title function_">getContent</span>() ?? <span class="hljs-string">''</span>;

 <span class="hljs-comment">// 错误使用 application/force-download 作为 MIME 类型</span>

 <span class="hljs-keyword">const</span> val = content?.<span class="hljs-title function_">replace</span>(<span class="hljs-title function_">getUploadingImgName</span>(name), \<span class="hljs-string">`\&lt;img src="data:application/force-download;base64,\${url}" /&gt;\`) ?? '';

 setValue(editor, val);

}
</span></code></pre>
<p>效果：</p>
<ul>
<li>
<p>审查元素可见 <code>&lt;img&gt;</code> 标签，语法无错误</p>
</li>
<li>
<p>富文本框中图片显示为空白（无破损图标，纯空白）</p>
</li>
<li>
<p>相同 <code>&lt;img&gt;</code> 标签直接嵌入普通 HTML 文件时可正常显示图片</p>
</li>
</ul>
<h3 data-id="heading-5">三、核心原因分析</h3>
<h4 data-id="heading-6">1. 关键知识点：data URI 语法规范</h4>
<p><code>data URI</code> 是用于直接嵌入小型资源的协议，标准格式为：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-attr">data</span>:\[\&lt;mediatype&gt;]\[;base64],\&lt;data&gt;
</code></pre>
<p>其中 <code>&lt;mediatype&gt;</code> 必须是符合 IANA 规范的 MIME 类型，用于告知浏览器资源类型，浏览器仅在识别该类型时才会正确解析。</p>
<h4 data-id="heading-7">2. 两种 MIME 类型的本质区别</h4>























<table><thead><tr><th>前缀格式</th><th>MIME 类型说明</th><th>适用场景</th><th>浏览器 / 编辑器处理逻辑</th></tr></thead><tbody><tr><td><code>data:${type};base64,</code>（如 <code>image/png</code>）</td><td>标准图片 MIME 类型，明确标识资源为图片</td><td>图片渲染场景</td><td>浏览器识别为图片，解码 Base64 并渲染；TinyMCE 允许通过内容过滤</td></tr><tr><td><code>data:application/force-download;base64,</code></td><td>非标准图片类型，用于强制文件下载</td><td>文件下载接口响应头配置</td><td>浏览器视为 “待下载文件” 而非可渲染图片；TinyMCE 因安全过滤拒绝渲染</td></tr></tbody></table>
<h4 data-id="heading-8">3. 富文本与原生 HTML 差异的核心</h4>
<ul>
<li>
<p><strong>原生 HTML 环境</strong>：浏览器解析时会启动 “MIME 类型嗅探” 机制，即使 MIME 类型声明错误，也会通过 Base64 数据的字节特征（如 PNG 文件头 <code>89 50 4E 47</code>）识别实际资源类型，因此能正常显示图片。</p>
</li>
<li>
<p><strong>TinyMCE 环境</strong>：为保障编辑区域安全和稳定性，TinyMCE 内置严格的内容过滤（sanitization）机制，仅允许白名单内的 MIME 类型通过。<code>application/force-download</code> 不在图片 MIME 类型白名单中，导致编辑器拒绝渲染该图片资源，仅保留标签结构。</p>
</li>
</ul>
<h3 data-id="heading-9">四、解决方案</h3>
<h4 data-id="heading-10">1. 核心修复方案</h4>
<p>保留正确的图片 MIME 类型前缀，确保 <code>data URI</code> 符合规范：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDone</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span></span>) {

 <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">unref</span>(editorRef);

 <span class="hljs-keyword">if</span> (!editor) {

   <span class="hljs-keyword">return</span>;

 }

 <span class="hljs-keyword">const</span> content = editor?.<span class="hljs-title function_">getContent</span>() ?? <span class="hljs-string">''</span>;

 <span class="hljs-comment">// 确保 \${type} 传递的是图片对应的 MIME 类型（如 image/png、image/jpeg）</span>

 <span class="hljs-keyword">const</span> val = content?.<span class="hljs-title function_">replace</span>(<span class="hljs-title function_">getUploadingImgName</span>(name), \<span class="hljs-string">`\&lt;img src="data:\${type};base64,\${url}" /&gt;\`) ?? '';

 setValue(editor, val);

}
</span></code></pre>
<h4 data-id="heading-11">2. 补充说明</h4>
<ul>
<li>
<p>确保 <code>type</code> 参数的正确性：上传图片时需获取文件的真实 MIME 类型（可通过 <code>file.type</code> 获取），避免手动硬编码错误类型。</p>
</li>
<li>
<p>禁止使用非图片类 MIME 类型：如 <code>application/octet-stream</code>、<code>application/force-download</code> 等均不适合图片渲染场景。</p>
</li>
</ul>
<h3 data-id="heading-12">五、总结</h3>
<ol>
<li>
<p><strong>规范优先</strong>：<code>data URI</code> 的 MIME 类型必须与资源实际类型匹配，图片资源务必使用 <code>image/xxx</code> 系列类型。</p>
</li>
<li>
<p><strong>编辑器特性</strong>：TinyMCE 等富文本组件的内容过滤机制比原生 HTML 更严格，需遵循其白名单规则。</p>
</li>
<li>
<p><strong>避坑提醒</strong>：<code>application/force-download</code> 仅适用于文件下载接口的响应头配置，不可用于图片 <code>src</code> 属性。</p>
</li>
</ol>
<p>通过遵循 MIME 类型规范和富文本组件的特性要求，可彻底解决 Base64 图片显示异常问题，同时保证代码的兼容性和规范性。</p>
<blockquote>
<p>（注：文档部分内容可能由 AI 生成）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年AI大模型开发生态白皮书｜附123页PDF文件下载]]></title>    <link>https://juejin.cn/post/7574581079627579398</link>    <guid>https://juejin.cn/post/7574581079627579398</guid>    <pubDate>2025-11-20T08:31:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627579398" data-draft-id="7574581079627448326" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年AI大模型开发生态白皮书｜附123页PDF文件下载"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:31:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年AI大模型开发生态白皮书｜附123页PDF文件下载
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:31:05.000Z" title="Thu Nov 20 2025 08:31:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>《2025AI大模型开发生态白皮书》由中科算网算泥社区主编，联合中国科学技术大学苏州高等研究院、中国人民大学数据与人工智能研发实验中心发布，旨在系统梳理全球AI大模型的发展现状、技术趋势、生态布局及落地实践。</p>
<p>文档聚焦2024年6月至2025年9月的最新动态，覆盖技术、产业、人才等多维度，为开发者提供全景式洞察与实战指南。</p>
<p><strong>以下为报告节选：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39a93f32d269499bbab8bfd1aaa8b63b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=iYgrz4T%2FrXWmzEKlZPvwbVDSjV4%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3dd0d9e9ffb479894d0baad85f9ccde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=oIDZcSwXXDvvJcaFSE3J4cITbmg%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cbe163453e14fcea3b07f1d5c650bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=VTYzArQfGc6FZcsPIpQJcMvhwyo%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d935b6a700b4323b84ab8c5fd6f77ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=ctNiciI1bSV9NXlcwAHXxZplYt4%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/596a78fdc4dc440d9dfec617b2c4974c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=v4je6s0de4tElVUYkwvRiCOSV7U%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eae7fbe249ef494da0fc27bfaa25109d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=Xs2i2O2jCtI5CCqZYg6gXKKnyV8%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8349df4205634b72ae286453f5c45b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=UZj9ny6yb18G%2BSrpCNqqYEAOsdk%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14cf72862d7e45c1a57f6de087335720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=YPLJFsr%2FRDd4o3X5%2Fd1fjEpxSAk%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc5f6863032f49288bc82779cd298598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=4DD6TN5628m2yRYLgOZKLO%2BtXCQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx 反向代理完全指南：从安装到生产环境全流程]]></title>    <link>https://juejin.cn/post/7574529034673078307</link>    <guid>https://juejin.cn/post/7574529034673078307</guid>    <pubDate>2025-11-20T08:28:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574529034673078307" data-draft-id="7574404398066679808" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx 反向代理完全指南：从安装到生产环境全流程"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-11-20T08:28:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="micefind"/> <meta itemprop="url" content="https://juejin.cn/user/3927901240298430"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx 反向代理完全指南：从安装到生产环境全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3927901240298430/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    micefind
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:28:12.000Z" title="Thu Nov 20 2025 08:28:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nginx 反向代理完整指南</h2>
<h3 data-id="heading-1">一、基础概念</h3>
<p>反向代理是指服务器代理客户端去访问后端真实服务器，客户端无需知道实际服务器地址。</p>
<h3 data-id="heading-2">二、快速安装</h3>
<h4 data-id="heading-3">Linux（Ubuntu/Debian）</h4>
<pre><code class="hljs language-bash" lang="bash">sudo apt-get update
sudo apt-get install nginx
sudo systemctl start nginx
sudo systemctl <span class="hljs-built_in">enable</span> nginx
</code></pre>
<h4 data-id="heading-4">Linux（CentOS/RHEL）</h4>
<pre><code class="hljs language-bash" lang="bash">sudo yum install nginx
sudo systemctl start nginx
sudo systemctl <span class="hljs-built_in">enable</span> nginx
</code></pre>
<h4 data-id="heading-5">macOS</h4>
<pre><code class="hljs language-bash" lang="bash">brew install nginx
brew services start nginx
</code></pre>
<h3 data-id="heading-6">三、核心配置</h3>
<h4 data-id="heading-7">文件位置</h4>





















<table><thead><tr><th>系统</th><th>配置路径</th></tr></thead><tbody><tr><td>Ubuntu/Debian</td><td><code>/etc/nginx/nginx.conf</code></td></tr><tr><td>CentOS/RHEL</td><td><code>/etc/nginx/nginx.conf</code></td></tr><tr><td>macOS</td><td><code>/usr/local/etc/nginx/nginx.conf</code></td></tr></tbody></table>
<h4 data-id="heading-8">最小化反向代理配置</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<h3 data-id="heading-9">四、常用代理配置详解</h3>
<h4 data-id="heading-10">1. 单后端服务</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name api.example.com;

    location / {
        proxy_pass http://backend-server:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
</code></pre>
<h4 data-id="heading-11">2. 负载均衡（多后端）</h4>
<pre><code class="hljs language-nginx" lang="nginx">upstream backend {
    server 192.168.1.10:8080 weight=5;
    server 192.168.1.11:8080 weight=3;
    server 192.168.1.12:8080 backup;
}

server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
</code></pre>
<h4 data-id="heading-12">3. 路径路由</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;

    location /api/ {
        proxy_pass http://api-server:3000;
    }

    location /static/ {
        root /var/www/html;
    }

    location /admin/ {
        proxy_pass http://admin-server:8080;
    }
}
</code></pre>
<h4 data-id="heading-13">4. WebSocket 支持</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name websocket.example.com;

    location /ws {
        proxy_pass http://ws-server:9000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_read_timeout 3600s;
    }
}
</code></pre>
<h4 data-id="heading-14">5. HTTPS + 重定向</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<h3 data-id="heading-15">五、常用代理参数</h3>


















































<table><thead><tr><th>参数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>proxy_pass</code></td><td>后端服务地址</td><td><code>http://backend:8080</code></td></tr><tr><td><code>proxy_set_header</code></td><td>设置请求头</td><td><code>Host $host</code></td></tr><tr><td><code>proxy_redirect</code></td><td>重定向处理</td><td><code>off</code></td></tr><tr><td><code>proxy_connect_timeout</code></td><td>连接超时</td><td><code>60s</code></td></tr><tr><td><code>proxy_send_timeout</code></td><td>发送超时</td><td><code>60s</code></td></tr><tr><td><code>proxy_read_timeout</code></td><td>读取超时</td><td><code>60s</code></td></tr><tr><td><code>proxy_buffering</code></td><td>响应缓冲</td><td><code>on/off</code></td></tr><tr><td><code>proxy_buffer_size</code></td><td>缓冲大小</td><td><code>4k</code></td></tr></tbody></table>
<h4 data-id="heading-16">高性能配置示例</h4>
<pre><code class="hljs language-nginx" lang="nginx">location / {
    proxy_pass http://backend;
  
    # 超时设置
    proxy_connect_timeout 30s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
  
    # 缓冲设置
    proxy_buffering on;
    proxy_buffer_size 8k;
    proxy_buffers 8 8k;
    proxy_busy_buffers_size 16k;
  
    # 请求头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  
    # 其他设置
    proxy_http_version 1.1;
    proxy_redirect off;
}
</code></pre>
<h3 data-id="heading-17">六、调试与验证</h3>
<h4 data-id="heading-18">配置检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查配置语法</span>
nginx -t

<span class="hljs-comment"># 查看详细配置</span>
nginx -T
</code></pre>
<h4 data-id="heading-19">重启服务</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 重启 Nginx</span>
sudo systemctl restart nginx

<span class="hljs-comment"># 平滑重启（不中断连接）</span>
sudo nginx -s reload
</code></pre>
<h4 data-id="heading-20">日志查看</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 访问日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/access.log

<span class="hljs-comment"># 错误日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/error.log
</code></pre>
<h4 data-id="heading-21">测试反向代理</h4>
<pre><code class="hljs language-bash" lang="bash">curl -i http://example.com
curl -H <span class="hljs-string">"Host: example.com"</span> http://127.0.0.1
</code></pre>
<h3 data-id="heading-22">七、常见问题排查</h3>
<h4 data-id="heading-23">502 Bad Gateway</h4>
<pre><code class="hljs language-nginx" lang="nginx"># 增加超时时间
proxy_connect_timeout 90s;
proxy_send_timeout 90s;
proxy_read_timeout 90s;

# 检查后端服务是否运行
</code></pre>
<h4 data-id="heading-24">连接拒绝</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查防火墙</span>
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

<span class="hljs-comment"># 检查后端服务监听地址</span>
netstat -tlnp | grep LISTEN
</code></pre>
<h4 data-id="heading-25">请求头丢失</h4>
<pre><code class="hljs language-nginx" lang="nginx"># 明确传递请求头
proxy_set_header Host $host;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Real-IP $remote_addr;
</code></pre>
<h3 data-id="heading-26">八、生产环境配置模板</h3>
<pre><code class="hljs language-nginx" lang="nginx"># /etc/nginx/conf.d/production.conf
upstream production_backend {
    least_conn;
    server backend1.internal:8080 max_fails=3 fail_timeout=30s;
    server backend2.internal:8080 max_fails=3 fail_timeout=30s;
    server backend3.internal:8080 backup;
}

server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log warn;

    location / {
        proxy_pass http://production_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      
        proxy_connect_timeout 30s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
      
        proxy_buffering on;
        proxy_buffer_size 8k;
        proxy_buffers 8 8k;
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年企业级AI Agent（智能体）价值及应用报告｜附77页PDF文件下载]]></title>    <link>https://juejin.cn/post/7574621075323060287</link>    <guid>https://juejin.cn/post/7574621075323060287</guid>    <pubDate>2025-11-20T08:36:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621075323060287" data-draft-id="7574621075323027519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年企业级AI Agent（智能体）价值及应用报告｜附77页PDF文件下载"/> <meta itemprop="keywords" content="Agent,程序员,LLM"/> <meta itemprop="datePublished" content="2025-11-20T08:36:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年企业级AI Agent（智能体）价值及应用报告｜附77页PDF文件下载
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:36:54.000Z" title="Thu Nov 20 2025 08:36:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>一个全新的时代正以前所未有的速度向我们奔来。随着AIGC**（生成式人工智能）的浪潮席卷全球，我们观察到，技术的演进正从单纯的内容生成，迈向更深层次的“智能体”（AI Agent**）革命。这不仅是技术的迭代，更是生产力范式的颠覆性变革。当AI不再仅仅是工具，而是能自主理解、规划、并执行复杂任务的智能伙伴时，企业的每一个流程、每一次决策、每一个创想，都将被重新定义。</p>
<p>然而，机遇与迷思共存。2025年被视为“Agent元年”，但围绕AI Agent的讨论仍充满了诸多困惑：它的确切概念是什么？在中国独特的数字化土壤中，它将如何落地生根？从喧嚣的概念到切实的价值，中间的路径又该如何铺就？</p>
<p>正是带着这些深刻的思索与探问，我们深度访谈了行业先行者，剖析了众多实践案例，最终汇聚成了这份70页+的报告——《企业级AI Agent（智能体）价值及应用报告》。</p>
<p><strong>以下为报告节选：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b33778ad92fc4a3894ec381e78b68d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=Gs9Sf2ZUuwem2i7r1CFOoiZOON0%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7c8a0442fd4678ae256adb17ea5a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=%2BfIRq1gSeUXB%2Fqua8IVVuAJ6ctQ%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/357646c5cc794fd1b947abd25d466c52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=Z4%2FfPqpXaTBogGOi2%2Fbcwfzkieg%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b0a8ff1c84a4823a52d304b6ce43adf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=UafHpcOlvRy%2Bw%2Fo441dd%2B8I7Hu4%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d46db1e101d74a3a915b0e09de3551af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=4YTZgzWDvuBOnT2ae9iusdSxI%2Fo%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5aaab8f81f449d0a62c9c2836e92695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=p18gLJgSlYuOCwMP3QqK28CyrHM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6607f6a6f6d4ba19a8c4e69f17ba972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=ZJDC3fvCANV75OaIthS3KGBDkJo%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7aa060006b1448087644287483d983a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=wUx17VUspF8tVvPMUlOt9Kzqup8%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c86f754da6ec47e493f8e1b4a0d81528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=ODo%2Fm5Lgyi%2BZ%2FlhfUAOfvxzGcHw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 落地不用死磕！这 3个 tips，开发者直接抄作业]]></title>    <link>https://juejin.cn/post/7574608278421979172</link>    <guid>https://juejin.cn/post/7574608278421979172</guid>    <pubDate>2025-11-20T08:36:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574608278421979172" data-draft-id="7574622940688416787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 落地不用死磕！这 3个 tips，开发者直接抄作业"/> <meta itemprop="keywords" content="前端,AI编程,Vue.js"/> <meta itemprop="datePublished" content="2025-11-20T08:36:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 落地不用死磕！这 3个 tips，开发者直接抄作业
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:36:09.000Z" title="Thu Nov 20 2025 08:36:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文由体验技术团队成员原创。</p>
<h2 data-id="heading-0">1、大方向：合理规划产品演进形态，从+AI到AI+</h2>
<h3 data-id="heading-1">从业界AI Coding产品看：</h3>
<ul>
<li>Codium -&gt; WindSurf
Codeium成立于2021年，推出编程助手Codium（现Qodo）；2024年11月，Exafunction Inc.（原Codeium）推出了Windsurf Editor，AI原生IDE，专注于通过智能协作和自动化提升软件开发效率。</li>
<li>MarsCode -&gt; Trae
2024年6月，字节跳动在北京发布了基于豆包大模型打造的智能开发工具- 豆包MarsCode，可以无缝集成到 IDEA、VSCode 中；2025年1月，字节发布了国内首个 AI 原生 IDE——Trae。Trae正式发布，初期仅支持macOS系统，2月17日Windows版本全量上线。</li>
<li>Comate -&gt; Comate IDE
2023年6月，百度推出代码助手Comate；2025年6月的百度Create AI开发者大会上，推出了独立的AI原生开发环境工具——Comate AI IDE1。</li>
<li>Tongyilinma - &gt; Tongyilinma IDE
2023年10 月阿里云正式发布的通义灵码智能编码助手；2025年10月，阿里云发布通义灵码AI IDE。</li>
</ul>
<h3 data-id="heading-2">从业界数据分析Agent产品看：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d94ef26ca3419388c6c1f9fecd435c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=IeyhSq4WjZVPk6s18CA5r4YUrxY%3D" alt="1.png" loading="lazy"/></p>
<p>合理的演进形态？</p>
<ul>
<li>
<p><strong>阶段1：+AI验证价值</strong>
在现有流程中嵌入AI能力，快速验证AI价值和用户接受度，并累计AI应用经验与数据</p>
</li>
<li>
<p><strong>阶段2：AI+重构业务核心</strong>
重新设计核心业务流程，构建以AI为中心的产品架构，培养用户新的使用习惯</p>
</li>
<li>
<p><strong>阶段3：原声AI全新体验</strong>
AI Native终极目标达成</p>
</li>
</ul>
<h2 data-id="heading-3">2、怎么+AI？（如何寻找AI可切入的落地场景）</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8f9b6b97d6b4cd5bf1dda93860e2058~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=uHwRoNSPVEHqxUcu0%2Bq08%2BT%2FYdw%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-4">（1）敏锐洞察客户期望的演变趋势</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f4fd4f3d9d49dea7386108613e13cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=HcY3%2FtOoACNbg9%2BDrEpTp1%2BFtA0%3D" alt="3.png" loading="lazy"/></p>
<p><strong>重塑用户调研的繁琐过程</strong></p>
<p>可以利用AI工具，来聚合所有来源的用户反馈、分析和挖掘数据，然后实时地将洞察直接推送到规划者。用户的期望变化得太快，如果流程不改进，遭遇“PMF丢失”的概率就会大大增加。</p>
<p><strong>一些常见的期望演变：</strong></p>
<p>从“给我一个创作的工具”到“直接帮我搞定”
从“提供标准版，我自己具体调整”到“为我量身打造一个方案”（主要是B2B）
从“手动操作”到“自动化操作”</p>
<ul>
<li>JIRA领域，创建任务、更新任务、长期梳理任务都需要时间</li>
<li>CRM领域，销售代表需要花费大量时间来输入关于沟通和交易的数据）</li>
</ul>
<p>从“按使用者数量/按月付费”到“按完成的工作量付费”</p>
<ul>
<li>从lisence到生成的产品数量/节省的人力成本/...</li>
</ul>
<h3 data-id="heading-5">（2）端到端的用户体验仍然重要</h3>
<p><strong>AI提高了单个环节的效率、同时也放大了不同环节间协作的价值</strong></p>
<p>从企业服务看：回溯过去十年，企业服务的核心逻辑是模块化拼接，通过不同功能模块的组合满足企业需求，最佳单品才是主流。企业习惯用钉钉做协同、用用友管财务、用Salesforce搞CRM，再靠数据中台勉强去缝合。但随着AI技术走向成熟，这种逻辑逐渐失效。模块间数据因无法互通而形成信息孤岛，用户在多系统间切换导致体验割裂，第三方生态也难以深度整合。</p>
<ul>
<li>钉钉AI助手 -&gt; 钉钉One：阿里钉钉十周年发布会重磅推出“钉钉One”，聚焦员工日常高频任务，实现智能化识别与自动化处理。</li>
<li>YonSuite -&gt; One YonSuite：八月中旬，用友旗下面向成长型企业的SaaS产品YonSuite发布全新品牌口号——One AI-World, One YonSuite，并宣告以AI原生+全球化的双轮驱动，重塑企业服务的底层逻辑。</li>
</ul>
<p><strong>是否掌握用户的“主要工作流”？上下游、端到端的生态很重要</strong></p>
<p>用户关注的是诉求能否得到解决，并不在乎这是不是一个"AI功能”。因此，不同产品竞争优势未根本性变化, 应专注做好擅长领域, 利用AI快速补齐其余环节。</p>
<ul>
<li>腾讯智能座舱的“花活”，离不开小程序生态的支撑。</li>
<li>Coze的战略价值，强化豆包大模型的产品化落地路径（通过COZE构建即调用豆包），形成上游→下游联动闭环，构建后可一键发布至抖音、飞书、懂车帝等诸多平台，形成“内容+AI+分发”的平台生态闭环。</li>
<li>AI创作应用，比如编码开发环境、写作界面、设计画布等应用，如果产品位于这些创作界面的“下游”或外部，而不是用户完成核心工作的地方，就更容易被取代。AI可以直接整合到工作流中，成为一个更无缝的替代方案，而不是让用户离开他们的主要工作环境。</li>
</ul>
<h3 data-id="heading-6">（3）合理评估技术成熟度、数据/知识完备度与产品功能边界，找到落地甜区</h3>
<p><strong>产品功能边界评估：</strong></p>
<ul>
<li>
<p>功能边界要“小”：让AI在业务需要的地方做擅长的事
若对有用性低的领域进行导入，导入成本高，效果也很难达到预期，可能会导致项目失败。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a20d92346e84702b79b08651c3defb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=XzFloPlwaL0WtfqNZx82RTi%2Fyic%3D" alt="4.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8821177fda7d48b7ac14e8800577363e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=v2tMW2%2BX%2BiOvjcBrmXWjfE%2B0eHo%3D" alt="5.png" loading="lazy"/></p>
</li>
<li>
<p>功能边界要“大”：比大模型升级主路径“多思考一步”
AI 应用最大的危险是被大模型卷死，所以一定要避免在大模型升级的主路径上。否则就会变成一层包一层，Agent调Tool。</p>
</li>
</ul>
<p>应避免将AI应用的主要功能定义为通用性高、附加价值低的任务、给大模型打补丁的任务。这些任务过于普遍和标准化，容易被大模型学习和模仿。例如，自动摘要提取、文本改写、文章生成、机器翻译、语言解释以及常规问题的回答等，在这类任务中，大模型的学习能力可以迅速复制并普及。很多创业公司尤其是 wrapper 类产品，本质就是在对大模型的这种输出的不稳定，不专业做修复，补偿，深加工和各类未来会成为大模型组件的大拼盘。</p>
<p><strong>业务价值评估：</strong></p>
<ul>
<li>
<p>阿里云数字员工已扩展HC为结果目标：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f332c957648c497e8357ebf608d2ffe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=7XLXShTlZPDM0mII3NpYege4v2I%3D" alt="6.png" loading="lazy"/></p>
</li>
<li>
<p>2D产品claude code新特性对外发布的标准：内部开发者为自己直接做出原型，在司内发布，内部反响是否好是对外发布的标准；内部反响一般则先迭代，等ready后再发布。</p>
</li>
</ul>
<p><strong>数据治理与知识工程：</strong>
需要进行持续的数据治理与知识工程建设，配套调整组织与生产关系，为AI应用打好“蛋糕胚”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7295e895db84b2887957ad7ca013599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=HRhFRY3pAHm%2F55cr6aiWwBsIKpI%3D" alt="7.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a83f0d2ef1cb44a98ae22b270cb49360~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=GhZXSHipbWsWa6vBoDWzS%2Fzam%2Fc%3D" alt="8.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39d3ed54abd943b59db67faae0d49f88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=DYhj2Gr7Zor6wsaTIWsHH%2F8wj98%3D" alt="9.jpg" loading="lazy"/></p>
<h2 data-id="heading-7">3、AI时代的PMF不仅是product market fit</h2>
<h3 data-id="heading-8">（1）以前，我们如何寻找PMF（产品市场契合度）</h3>
<p>PMF(product market fit)指产品与市场需求达到匹配的一种状态，即产品能够很好地满足目标市场的需求，并且市场对该产品有强烈的需求和接受度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08df36d9dd794b9cbaa529ce7e6b6a18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=2jpIEnbBN3A7V6xcVCpZHkBDBc4%3D" alt="10.png" loading="lazy"/></p>
<p>通常，在寻找PMF时的一般路径是：</p>
<p>确定目标客户（未来产品的受众与未被满足的需求）→明确核心价值定位（有核心竞争力与一定壁垒）→明确产品MVP核心功能（团队与用户对产品的核心功能达成一致）→做出产品的模型并验证（目标客户使用MVP并密切互动、了解反馈，打磨体验）</p>
<p>传统互联网行业在评估 PMF 时，两个指标被认为是最关键的：</p>
<ul>
<li>用户留存率：衡量用户在初次使用产品后的一定时间内，仍然继续使用产品的比例。移动互联网产品有个经典指标叫 421，次留 40%，周留 20%，月留 10%，满足这个表示基本达标。最重要的参数是长期留存，月留存率达到 30%或以上，表明产品具有很高的用户粘性。月留存率在 20%-30%之间，表明产品较为符合用户需求。月留存率在 10%-20%，可能需要进一步优化产品功能或用户体验。月留存率低于 10%，表明产品与用户需求存在较大偏差。</li>
<li>用户生命周期价值（LTV）与客户获取成本（CAC）之比：LTV/CAC 比率是衡量产品盈利潜力的关键指标。一个健康的 LTV/CAC 比率通常被认为是 3:1 或更高，这意味着用户在其整个生命周期内为公司带来的总收益至少是获取该用户成本的三倍。这个比率越高，表明产品的市场适应性和盈利能力越强。</li>
</ul>
<h3 data-id="heading-9">（2）AI时代，寻找产品模型契合度（Produt Model Fit）同样重要</h3>
<p>PMF强调在 AI 技术特性与产品功能之间找到匹配是成功的关键，即 AI 模型的技术特性与产品功能之间的契合度。</p>
<p>许多 AI 产品的 Demo 视频表现出色，但实际产品却难以满足市场预期，主要是因为实际能力与演示时相比有差距。因此，意味着需要深入理解技术的优势和局限性，能够识别技术适合解决哪些类型的问题，以及技术如何与用户需求相结合，从而设计出比传统应用好 10 倍的用户体验。产品团队需要深入理解 AI 模型的能力边界，利用模型的强项并规避弱点，同时对模型的技术演进方向有前瞻性的预判。成功的 AI 产品应基于对模型能力和市场需求的深刻理解，做出明智的取舍，而不是追求满足市场所有需求的完美产品。</p>
<h3 data-id="heading-10">（3）如何量化衡量AI时代的产品是否满足了PMF？</h3>
<p>一般的产品路径：吸引客户 -&gt; 留住客户 -&gt; 赚到钱 -&gt; scaling -&gt; 守得住</p>
<p><strong>是否切中用户真实需求？</strong></p>
<p>是否切中用户真实需求，包括吸引和留住客户。这个要沿用活跃度指标，这个指标能反应MFP/TPF，因为否则的话，不可能吸引并留住用户。付费</p>
<p><strong>是否拥有专有数据与知识？</strong></p>
<p>在AI时代，数据才是真正的“新石油”，尤其是那些大型语言模型无法获取的专有数据。如果数据（或内容）是公开的，可轻易被大型语言模型获取和处理。专有数据越多，护城河就越深。</p>
<p><strong>能否在商业上闭环？</strong></p>
<p>每一笔帐能算的过来（token的成本，数据成本，渠道，试错，迭代等等），且要能高效的回款，因为在早期还无法判断和计算用户life-time的时候，LTV/CAC的公式会显得过于长远。</p>
<p>长期包括能否赚到钱和scaling，看ROI或者LTV/CAC。</p>
<p><strong>能否不被颠覆？</strong></p>
<p>在移动互联网时代，技术基础设施相对稳定，产品和客户的匹配之后，产品被颠覆的风险很小。在AI时代这个前提不一定成立。做半天，用户反馈也不错，但是可能大模型一更新，就没有意义了。所以，需要一个指标表示对大模型safe程度，这个要求提供的服务远离大模型的演进主线，同时要在业务主流程中积累自己的私有数据闭环。 这个指标至少是这两个参数的函数，如 F(主航道偏离度，私有数据积累度）。</p>
<p>所以，AI时代的PMF至少要额外添加一个指数表示不被颠覆的程度，由两个参数驱动：主航道偏离度，私有数据积累度。</p>
<blockquote>
<p>本文是由体验技术团队同学参与AICon后沉淀的技术思考及总结</p>
</blockquote>
<h2 data-id="heading-11">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～</p>
<p>OpenTiny 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue 源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
TinyEngine 源码： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
欢迎进入代码仓库 Star🌟TinyEngine、TinyVue、TinyNG、TinyCLI、TinyEditor~ 如果你也想要共建，可以进入代码仓库，找到 good first issue 标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比 pip 快 100 倍！更现代的 python 包管理工具，替代 pip、venv、poetry!]]></title>    <link>https://juejin.cn/post/7574601160981168143</link>    <guid>https://juejin.cn/post/7574601160981168143</guid>    <pubDate>2025-11-20T08:41:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574601160981168143" data-draft-id="7574614157954809890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比 pip 快 100 倍！更现代的 python 包管理工具，替代 pip、venv、poetry!"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2025-11-20T08:41:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="麦麦麦造"/> <meta itemprop="url" content="https://juejin.cn/user/1732486056126311"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比 pip 快 100 倍！更现代的 python 包管理工具，替代 pip、venv、poetry!
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486056126311/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    麦麦麦造
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:41:23.000Z" title="Thu Nov 20 2025 08:41:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>大家好，我是 <strong>MAI麦造</strong>!</p>
<p>之前比较喜欢用 anaconda 来管理虚拟环境，但只做包管理又太大材小用了。</p>
<p><strong>现在有一个轻量且更强的替代来了！！</strong></p>
<p>一站式超快的 Python 包与环境管理工具：<code>uv</code>。</p>
<p>作者：Astral（<code>ruff</code> 开发团队） ，口号：<strong>“比 pip 快 100 倍”</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a03a9a975f8842da8d6b20c555c3d6a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bqm6bqm6bqm6YCg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232883&amp;x-signature=9qyPeLibjaMDaid4p0JVFYrnhnw%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">🧭 一、uv 是什么？</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1442e4c39402413684bb154955f84127~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bqm6bqm6bqm6YCg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232883&amp;x-signature=2Simah%2B083RNnLmmP4BohiX%2B4yw%3D" alt="PixPin_2025-11-20_16-23-34.png" loading="lazy"/></p>
<p><code>uv</code> 是一个基于 <strong>Rust</strong> 编写的 Python 包管理器，它集成了以下功能：</p>






























<table><thead><tr><th>工具</th><th>功能</th><th>在 uv 中的替代</th></tr></thead><tbody><tr><td>pip</td><td>包安装</td><td>✅ <code>uv pip</code></td></tr><tr><td>venv</td><td>虚拟环境</td><td>✅ <code>uv venv</code></td></tr><tr><td>poetry</td><td>依赖管理</td><td>✅ <code>uv add</code> / <code>uv sync</code></td></tr><tr><td>pip-tools</td><td>锁定依赖</td><td>✅ 自动内置</td></tr></tbody></table>
<p>👉 简单理解：</p>
<p><code>uv = pip + venv + poetry</code> 的极速整合版。</p>
<hr/>
<h2 data-id="heading-1">⚙️ 二、安装 uv</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># linux/MacOS 官方推荐方式（自动检测平台）  </span>
curl -LsSf https://astral.sh/uv/install.sh | sh  
  
<span class="hljs-comment"># win11 上  </span>
  
winget install uv

</code></pre>
<p>或通过 pip：</p>
<pre><code class="hljs">pip install uv
</code></pre>
<hr/>
<h2 data-id="heading-2">🚀 三、常用命令速查</h2>
<h3 data-id="heading-3">1️⃣ 创建虚拟环境</h3>
<pre><code class="hljs">uv venv
</code></pre>
<p>在当前目录下创建 <code>.venv</code> 文件夹。</p>
<p>指定路径：</p>
<pre><code class="hljs language-bash" lang="bash">uv venv .envs/myenv
</code></pre>
<hr/>
<h3 data-id="heading-4">2️⃣ 指定 Python 版本创建虚拟环境</h3>
<pre><code class="hljs language-css" lang="css">uv venv <span class="hljs-attr">--python</span> <span class="hljs-number">3.11</span>
</code></pre>
<p>或指定绝对路径：</p>
<pre><code class="hljs language-bash" lang="bash">uv venv --python /usr/local/bin/python3.11
</code></pre>
<blockquote>
<p>💡 提示：uv 会自动下载所需 Python 版本（类似 pyenv 的体验）， 无需提前安装该版本的解释器。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3️⃣ 激活虚拟环境</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS / Linux  </span>
<span class="hljs-built_in">source</span> .venv/bin/activate  
  
<span class="hljs-comment"># Windows  </span>
.venv\Scripts\activate

</code></pre>
<hr/>
<h3 data-id="heading-6">4️⃣ 安装依赖</h3>
<pre><code class="hljs">uv pip install requests
</code></pre>
<p>可一次安装多个：</p>
<pre><code class="hljs">uv pip install numpy pandas matplotlib

</code></pre>
<hr/>
<h3 data-id="heading-7">5️⃣ 安装依赖文件</h3>
<pre><code class="hljs">uv pip install -r requirements.txt
</code></pre>
<hr/>
<h3 data-id="heading-8">6️⃣ 导出依赖列表</h3>
<pre><code class="hljs">uv pip freeze &gt; requirements.txt
</code></pre>
<hr/>
<h3 data-id="heading-9">7️⃣ 使用 pyproject.toml 管理依赖</h3>
<pre><code class="hljs language-csharp" lang="csharp">uv <span class="hljs-keyword">add</span> fastapi uv <span class="hljs-keyword">remove</span> fastapi uv sync
</code></pre>
<p>🔒 <code>uv sync</code> 会根据锁文件精确重建环境。</p>
<hr/>
<h3 data-id="heading-10">8️⃣ 一次性运行脚本（自动加载环境）</h3>
<pre><code class="hljs language-arduino" lang="arduino">uv run script.py
</code></pre>
<hr/>
<h3 data-id="heading-11">9️⃣ 临时安装依赖并运行命令</h3>
<pre><code class="hljs language-scss" lang="scss">uv run <span class="hljs-attr">--with</span> requests python -c "import requests; <span class="hljs-built_in">print</span>(requests.__version__)"
</code></pre>
<p>在隔离环境中运行，不污染全局依赖。</p>
<hr/>
<h3 data-id="heading-12">🔟 初始化项目模板</h3>
<pre><code class="hljs language-csharp" lang="csharp">uv <span class="hljs-keyword">init</span> myproject
</code></pre>
<p>自动创建项目结构和 <code>pyproject.toml</code>。</p>
<hr/>
<h2 data-id="heading-13">🧩 四、实用命令对照表</h2>

































































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>功能</td><td>命令</td><td>说明</td></tr><tr><td>创建虚拟环境</td><td><code>uv venv</code></td><td>默认使用当前 Python</td></tr><tr><td>指定 Python 版本</td><td><code>uv venv --python 3.11</code></td><td>自动下载版本</td></tr><tr><td>安装包</td><td><code>uv pip install &lt;pkg&gt;</code></td><td>兼容 pip</td></tr><tr><td>安装文件依赖</td><td><code>uv pip install -r requirements.txt</code></td><td/></tr><tr><td>导出依赖</td><td><code>uv pip freeze &gt; requirements.txt</code></td><td/></tr><tr><td>添加依赖（TOML）</td><td><code>uv add &lt;pkg&gt;</code></td><td>类似 poetry</td></tr><tr><td>删除依赖</td><td><code>uv remove &lt;pkg&gt;</code></td><td/></tr><tr><td>同步依赖</td><td><code>uv sync</code></td><td>更新虚拟环境</td></tr><tr><td>临时运行</td><td><code>uv run --with &lt;pkg&gt; &lt;cmd&gt;</code></td><td>不污染环境</td></tr><tr><td>初始化项目</td><td><code>uv init</code></td><td>创建标准项目结构</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-14">💡 五、优点总结</h2>
<p>✅ 极快安装速度（Rust 实现，比 pip 快 10–100 倍）</p>
<p>✅ 自动管理虚拟环境与依赖锁定✅ 完全兼容 pip✅ 支持多 Python 版本共存与下载✅ 可替代 Poetry、pip-tools、pyenv、pipx 的组合</p>
<hr/>
<h2 data-id="heading-15">🔍 六、进阶技巧</h2>
<h3 data-id="heading-16">✨ 指定 Python 版本运行脚本</h3>
<pre><code class="hljs language-css" lang="css">uv run <span class="hljs-attr">--python</span> <span class="hljs-number">3.10</span> <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
</code></pre>
<h3 data-id="heading-17">✨ 查看所有可用 Python 版本</h3>
<pre><code class="hljs">uv python list
</code></pre>
<h3 data-id="heading-18">✨ 安装特定 Python 版本</h3>
<pre><code class="hljs">uv python install 3.12
</code></pre>
<hr/>
<h2 data-id="heading-19">七、</h2>
<p>这是一个常用的 uv 命令速查表。 大家可以 mark 住，需要的时候可以快速找到～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2 的关于 $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？]]></title>    <link>https://juejin.cn/post/7574383670435741748</link>    <guid>https://juejin.cn/post/7574383670435741748</guid>    <pubDate>2025-11-20T08:43:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574383670435741748" data-draft-id="7574404398066810880" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2 的关于 $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:43:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wenps"/> <meta itemprop="url" content="https://juejin.cn/user/4301712026763790"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2 的关于 $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4301712026763790/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wenps
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:43:28.000Z" title="Thu Nov 20 2025 08:43:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？</h2>
<h3 data-id="heading-1">核心问题</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">c</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'watch 触发了'</span>)
  }
}

<span class="hljs-comment">// 路径 1：直接 $set</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// ✅ 触发 watch</span>

<span class="hljs-comment">// 路径 2：先赋值再 $set  </span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// ❌ 不触发 watch</span>
</code></pre>
<p><strong>为什么同样用了 <code>$set</code>，结果却不同？</strong></p>
<hr/>
<h3 data-id="heading-2">原因：$set 内部有属性存在性检查</h3>
<h4 data-id="heading-3">$set 源码简化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, val</span>) {
  <span class="hljs-comment">// 关键判断：属性是否已存在</span>
  <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> target &amp;&amp; !(key <span class="hljs-keyword">in</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)) {
    target[key] = val  <span class="hljs-comment">// ← 只做普通赋值</span>
    <span class="hljs-keyword">return</span> val         <span class="hljs-comment">// ← 直接返回，不触发通知</span>
  }
  
  <span class="hljs-comment">// 属性不存在才走这里</span>
  <span class="hljs-keyword">const</span> ob = target.<span class="hljs-property">__ob__</span>
  <span class="hljs-title function_">defineReactive</span>(target, key, val)  <span class="hljs-comment">// 定义响应式</span>
  ob.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// ← 触发 watch！</span>
  <span class="hljs-keyword">return</span> val
}
</code></pre>
<h4 data-id="heading-4">关键点</h4>
<p><strong><code>$set</code> 只在属性不存在时才调用 <code>dep.notify()</code></strong></p>
<hr/>
<h3 data-id="heading-5">两条路径的详细分析</h3>
<h4 data-id="heading-6">路径 1：直接 $set（✅ 触发）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始状态</span>
c = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }  <span class="hljs-comment">// b 不存在</span>

<span class="hljs-comment">// 执行</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 内部逻辑</span>
<span class="hljs-string">'b'</span> <span class="hljs-keyword">in</span> c  <span class="hljs-comment">// → false（属性不存在）</span>
↓
添加响应式属性 b
↓
c.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// ← 触发 watch！</span>
</code></pre>
<h4 data-id="heading-7">路径 2：先赋值再 $set（❌ 不触发）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始状态</span>
c = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }  <span class="hljs-comment">// b 不存在</span>

<span class="hljs-comment">// 第 1 步：普通赋值</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>
<span class="hljs-comment">// 现在：c = { a: 1, b: 1000 }</span>
<span class="hljs-comment">// 但 b 不是响应式的！</span>

<span class="hljs-comment">// 第 2 步：$set</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 内部逻辑</span>
<span class="hljs-string">'b'</span> <span class="hljs-keyword">in</span> c  <span class="hljs-comment">// → true（属性已存在！）</span>
↓
只执行：c.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>（普通赋值）
↓
不调用 dep.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// ← 不触发 watch！</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">Vue 为什么这样设计？</h3>
<p>Vue 的设计逻辑：</p>
<ol>
<li><strong>新属性</strong> = 对象结构变化 → 需要通知所有观察者</li>
<li><strong>已存在的属性</strong> = 只是值变化 → 应该通过属性自己的 setter 触发</li>
</ol>
<p>但问题是：路径 2 中的 <code>b</code> 虽然存在，但<strong>不是响应式的</strong>（没有 setter），所以：</p>
<ul>
<li><code>$set</code> 认为它已存在，不调用 <code>notify()</code></li>
<li>但它没有 setter，值变化不会触发更新</li>
<li><strong>结果就是：既不通知对象的观察者，也不触发属性的 setter</strong></li>
</ul>
<hr/>
<h3 data-id="heading-9">完整验证代码</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">c</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }
  }
},

<span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">c</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'watch 触发了！'</span>, val)
  }
},

<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 1：直接 $set ==='</span>)
  <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
  <span class="hljs-comment">// ✅ 打印 "watch 触发了！{a: 1, b: 1000}"</span>
  
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 2：先赋值再 $set ==='</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">d</span> = <span class="hljs-number">2000</span>  <span class="hljs-comment">// 先创建普通属性</span>
    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'d'</span>, <span class="hljs-number">3000</span>)  <span class="hljs-comment">// 再用 $set</span>
    <span class="hljs-comment">// ❌ 不打印任何东西</span>
  }, <span class="hljs-number">1000</span>)
  
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 3：$set 两次 ==='</span>)
    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'e'</span>, <span class="hljs-number">4000</span>)  <span class="hljs-comment">// 第一次</span>
    <span class="hljs-comment">// ✅ 打印 "watch 触发了！"</span>
    
    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'e'</span>, <span class="hljs-number">5000</span>)  <span class="hljs-comment">// 第二次</span>
    <span class="hljs-comment">// ✅ 也会触发（因为 e 已经是响应式的）</span>
  }, <span class="hljs-number">2000</span>)
}
</code></pre>
<hr/>
<h3 data-id="heading-10">dep.notify() 触发的是什么？</h3>
<h4 data-id="heading-11">Vue 的两层依赖收集</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> c = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">__ob__</span>: {
    <span class="hljs-attr">dep</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()  <span class="hljs-comment">// ← 对象自己的 dep</span>
  }
}

<span class="hljs-comment">// 同时，每个响应式属性也有自己的 dep（通过闭包）</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(c, <span class="hljs-string">'a'</span>, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 收集依赖到 a 的 dep</span>
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-comment">// 通知 a 的 dep</span>
  }
})
</code></pre>
<h4 data-id="heading-12">区别</h4>





























<table><thead><tr><th>操作</th><th>触发的 dep</th><th>watch: c</th><th>watch: 'c.a'</th></tr></thead><tbody><tr><td><code>c.a = 2</code></td><td><code>a</code> 的 dep</td><td>❌ 不触发</td><td>✅ 触发</td></tr><tr><td><code>$set(c, 'b', 1)</code></td><td><code>c.__ob__.dep</code></td><td>✅ 触发</td><td>-</td></tr><tr><td><code>c = {}</code></td><td>对象替换</td><td>✅ 触发</td><td>-</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">为什么不需要 deep 也能触发？</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">c</span>(<span class="hljs-params">val</span>) {  <span class="hljs-comment">// 没有 deep: true</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'触发了'</span>)
  }
}

<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// ✅ 会触发</span>
</code></pre>
<p><strong>原因：</strong></p>
<ul>
<li><code>$set</code> 触发的是 <code>c.__ob__.dep</code>（对象自己的 dep）</li>
<li>监听 <code>c</code> 的 watcher 收集的就是这个 dep</li>
<li>不需要 deep，因为是对象结构变化</li>
</ul>
<p><strong>deep 的作用：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">watch</span>: {
  <span class="hljs-attr">c</span>: {
    <span class="hljs-title function_">handler</span>(<span class="hljs-params">val</span>) {},
    <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// ← 递归收集所有属性的 dep</span>
  }
}

<span class="hljs-comment">// 现在修改已有属性也会触发</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">a</span> = <span class="hljs-number">2</span>  <span class="hljs-comment">// ✅ 触发（因为收集了 a 的 dep）</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">最佳实践</h3>
<h4 data-id="heading-15">❌ 永远不要这样做</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">111</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)  <span class="hljs-comment">// 不会触发 watch</span>
</code></pre>
<h4 data-id="heading-16">✅ 正确做法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方案 1：只用 $set</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 方案 2：在 data 中预先声明</span>
<span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">c</span>: {
      <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">b</span>: <span class="hljs-literal">null</span>  <span class="hljs-comment">// 预先声明</span>
    }
  }
}
<span class="hljs-comment">// 现在可以直接赋值</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>  <span class="hljs-comment">// ✅ 会触发</span>

<span class="hljs-comment">// 方案 3：整体替换对象</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1000</span> }

<span class="hljs-comment">// 方案 4：分两步（如果需要不同值）</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">111</span>)  <span class="hljs-comment">// 第一次触发</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>              <span class="hljs-comment">// 第二次触发（因为 b 已是响应式）</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">总结表格</h3>



































<table><thead><tr><th>场景</th><th>属性状态</th><th>$set 行为</th><th>是否触发 watch</th></tr></thead><tbody><tr><td><code>$set(c, 'b', 1)</code></td><td>不存在</td><td>添加响应式 + notify</td><td>✅ 触发</td></tr><tr><td><code>c.b = 1; $set(c, 'b', 2)</code></td><td>存在（非响应式）</td><td>只赋值，不 notify</td><td>❌ 不触发</td></tr><tr><td><code>$set(c, 'b', 1); $set(c, 'b', 2)</code></td><td>存在（响应式）</td><td>触发 setter</td><td>✅ 触发</td></tr><tr><td><code>$set(c, 'b', 1); c.b = 2</code></td><td>存在（响应式）</td><td>触发 setter</td><td>✅ 触发</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">记住一句话</h3>
<blockquote>
<p><strong><code>$set</code> 只在属性不存在时才调用 <code>dep.notify()</code></strong><br/>
<strong>先赋值再 <code>$set</code> = 属性已存在 = 不会触发 watch</strong></p>
</blockquote>
<hr/>
<p><strong>关键点：</strong></p>
<ul>
<li><code>$set</code> 有属性存在性检查：<code>key in target</code></li>
<li>普通赋值创建的属性不是响应式的</li>
<li>已存在的属性（即使非响应式）会让 <code>$set</code> 跳过 <code>notify()</code></li>
<li>永远不要在 <code>$set</code> 前先赋值！</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 进阶知识总结]]></title>    <link>https://juejin.cn/post/7574601160981217295</link>    <guid>https://juejin.cn/post/7574601160981217295</guid>    <pubDate>2025-11-20T08:47:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574601160981217295" data-draft-id="7574601160981200911" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 进阶知识总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:47:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小小小宇"/> <meta itemprop="url" content="https://juejin.cn/user/3386151546662077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 进阶知识总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3386151546662077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小小小宇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:47:31.000Z" title="Thu Nov 20 2025 08:47:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文深入探讨 TypeScript 类型系统的图灵完备性，涵盖从高级泛型、条件类型、模板字面量类型到元编程（装饰器）和 React 高级模式。</p>
<p>内容分为几个核心模块，每个模块都包含详细的理论解释和生产级代码示例。</p>
<hr/>
<h3 data-id="heading-0">模块一：高级泛型与类型体操基础</h3>
<p>在高级开发中，泛型不仅仅是 <code>&lt;T&gt;</code>，它涉及到约束（Constraints）、默认值和递归。</p>
<h4 data-id="heading-1">1.1 深度递归类型与对象属性修饰</h4>
<p>我们需要处理复杂的不可变数据结构或深度可选配置。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块一：高级泛型工具类型
 * 场景：复杂状态管理、配置对象处理
 */</span>

<span class="hljs-comment">// 1. DeepPartial: 递归地将对象所有属性变为可选</span>
<span class="hljs-comment">// 这在处理大型配置对象（如 Webpack 配置或图表库配置）时非常有用</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepPartial</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepPartial</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-comment">// 2. DeepReadonly: 递归地将对象所有属性变为只读</span>
<span class="hljs-comment">// 用于 Redux 的 State 或任何不可变数据结构</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T&gt; = {
    <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepReadonly</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-comment">// 3. DeepRequired: 递归移除可选属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepRequired</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]-?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepRequired</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-comment">// 4. Mutable: 移除只读属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Mutable</span>&lt;T&gt; = {
    -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];
};

<span class="hljs-comment">// --- 测试案例 ---</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserSettings</span> {
    <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">mode</span>: <span class="hljs-string">'dark'</span> | <span class="hljs-string">'light'</span>;
        <span class="hljs-attr">palette</span>: {
            <span class="hljs-attr">primary</span>: <span class="hljs-built_in">string</span>;
            secondary?: <span class="hljs-built_in">string</span>;
        };
    };
    <span class="hljs-attr">notifications</span>: {
        <span class="hljs-attr">email</span>: <span class="hljs-built_in">boolean</span>;
        sms?: <span class="hljs-built_in">boolean</span>;
    };
}

<span class="hljs-comment">// 使用 DeepPartial，允许只配置部分层级</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">initialConfig</span>: <span class="hljs-title class_">DeepPartial</span>&lt;<span class="hljs-title class_">UserSettings</span>&gt; = {
    <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">palette</span>: {
            <span class="hljs-attr">primary</span>: <span class="hljs-string">'#007bff'</span>
        }
    }
};

<span class="hljs-comment">// 使用 DeepReadonly 保护状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">DeepReadonly</span>&lt;<span class="hljs-title class_">UserSettings</span>&gt; = {
    <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">mode</span>: <span class="hljs-string">'dark'</span>,
        <span class="hljs-attr">palette</span>: { <span class="hljs-attr">primary</span>: <span class="hljs-string">'#000'</span>, <span class="hljs-attr">secondary</span>: <span class="hljs-string">'#fff'</span> }
    },
    <span class="hljs-attr">notifications</span>: { <span class="hljs-attr">email</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sms</span>: <span class="hljs-literal">false</span> }
};

<span class="hljs-comment">// state.theme.mode = 'light'; // 报错：无法分配到 "mode" ，因为它是只读属性。</span>

<span class="hljs-comment">// --- 进阶：复杂键值过滤 ---</span>

<span class="hljs-comment">// 获取类型中所有非函数属性的 Key</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NonFunctionKeys</span>&lt;T&gt; = {
    [K <span class="hljs-keyword">in</span> keyof T]: T[K] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? <span class="hljs-built_in">never</span> : K;
}[keyof T];

<span class="hljs-comment">// 获取类型中所有函数属性的 Key</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FunctionKeys</span>&lt;T&gt; = {
    [K <span class="hljs-keyword">in</span> keyof T]: T[K] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? K : <span class="hljs-built_in">never</span>;
}[keyof T];

<span class="hljs-comment">// 仅提取对象中的数据部分</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PickData</span>&lt;T&gt; = <span class="hljs-title class_">Pick</span>&lt;T, <span class="hljs-title class_">NonFunctionKeys</span>&lt;T&gt;&gt;;
<span class="hljs-comment">// 仅提取对象中的方法部分</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PickMethods</span>&lt;T&gt; = <span class="hljs-title class_">Pick</span>&lt;T, <span class="hljs-title class_">FunctionKeys</span>&lt;T&gt;&gt;;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Admin"</span>;
    
    <span class="hljs-title function_">login</span>(): <span class="hljs-built_in">void</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Logging in..."</span>); }
    <span class="hljs-title function_">logout</span>(): <span class="hljs-built_in">void</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Logging out..."</span>); }
    <span class="hljs-title function_">updateProfile</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">PickData</span>&lt;<span class="hljs-title class_">UserService</span>&gt;): <span class="hljs-built_in">void</span> { 
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = data.<span class="hljs-property">name</span>;
    }
}

<span class="hljs-keyword">const</span> service = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();
<span class="hljs-keyword">const</span> <span class="hljs-attr">dataOnly</span>: <span class="hljs-title class_">PickData</span>&lt;<span class="hljs-title class_">UserService</span>&gt; = { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"User"</span> };
<span class="hljs-comment">// const methodOnly: PickMethods&lt;UserService&gt; = { login: () =&gt; {} }; // 正确</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">模块二：条件类型（Conditional Types）与 <code>infer</code> 关键字</h3>
<p>这是 TypeScript 类型编程的核心。通过 <code>infer</code>，我们可以“解包”类型，例如获取 Promise 的返回值、数组的元素类型或函数的参数类型。</p>
<h4 data-id="heading-3">2.1 类型推断与解包工具</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块二：条件类型与 infer
 * 场景：API 响应处理、函数包装器、Vue/React 类型推导
 */</span>

<span class="hljs-comment">// 1. Unpacked: 解包数组、Promise 或基本类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Unpacked</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer U)[] 
    ? U 
    : T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt;
    ? U
    : T;

<span class="hljs-comment">// 测试 Unpacked</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T0</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-built_in">string</span>&gt;;  <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T1</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T2</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T3</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;[]&gt;; <span class="hljs-comment">// Promise&lt;string&gt;</span>

<span class="hljs-comment">// 2. GetReturnType: 获取函数返回类型 (内置 ReturnType 的实现原理)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;

<span class="hljs-comment">// 3. GetParameters: 获取函数参数类型 (内置 Parameters 的实现原理)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyParameters</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// --- 实战：类型安全的 API 请求封装 ---</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">TData</span>&gt; {
    <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">data</span>: <span class="hljs-title class_">TData</span>;
}

<span class="hljs-comment">// 模拟后端 API 函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;{ <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
    });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPosts</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;{ <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> }[]&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: [{ <span class="hljs-attr">title</span>: <span class="hljs-string">"TS is awesome"</span> }]
    });
}

<span class="hljs-comment">// 高级工具：提取 API 函数 Promise 解析后的 Data 部分</span>
<span class="hljs-comment">// 逻辑：</span>
<span class="hljs-comment">// 1. T 必须是一个函数</span>
<span class="hljs-comment">// 2. 函数返回 Promise&lt;ApiResponse&lt;Data&gt;&gt;</span>
<span class="hljs-comment">// 3. 提取 Data</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractApiData</span>&lt;T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = 
    <span class="hljs-title class_">ReturnType</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;infer <span class="hljs-title class_">Data</span>&gt;&gt; ? <span class="hljs-title class_">Data</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 自动推导出的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserData</span> = <span class="hljs-title class_">ExtractApiData</span>&lt;<span class="hljs-keyword">typeof</span> getUserInfo&gt;; <span class="hljs-comment">// { name: string; age: number }</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PostsData</span> = <span class="hljs-title class_">ExtractApiData</span>&lt;<span class="hljs-keyword">typeof</span> getPosts&gt;;   <span class="hljs-comment">// { title: string }[]</span>

<span class="hljs-comment">// 通用处理函数，自动保持类型</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> apiHandler&lt;<span class="hljs-title class_">TFunc</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt;(
    <span class="hljs-attr">apiFunc</span>: <span class="hljs-title class_">TFunc</span>, 
    ...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">TFunc</span>&gt;
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ExtractApiData</span>&lt;<span class="hljs-title class_">TFunc</span>&gt;&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiFunc</span>(...args);
    <span class="hljs-comment">// 这里假设 response 结构符合 ApiResponse</span>
    <span class="hljs-comment">// 在实际项目中通常会有拦截器处理</span>
    <span class="hljs-keyword">if</span> ((response <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">return</span> (response <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">data</span>;
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>((response <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">message</span>);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// user 自动被推断为 { name: string; age: number }</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiHandler</span>(getUserInfo, <span class="hljs-string">"123"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>);

    <span class="hljs-comment">// posts 自动被推断为 { title: string }[]</span>
    <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiHandler</span>(getPosts);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(posts[<span class="hljs-number">0</span>].<span class="hljs-property">title</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-4">模块三：模板字面量类型（Template Literal Types）</h3>
<p>TS 4.1 引入的特性，允许对字符串进行模式匹配和操作。这在处理 CSS 类名、事件名称或路由路径时非常强大。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块三：模板字面量类型
 * 场景：CSS-in-JS、事件系统、国际化键值生成
 */</span>

<span class="hljs-comment">// 1. 简单的字符串拼接</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Color</span> = <span class="hljs-string">"red"</span> | <span class="hljs-string">"blue"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Quantity</span> = <span class="hljs-string">"100"</span> | <span class="hljs-string">"200"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ItemCssClass</span> = <span class="hljs-string">`bg-<span class="hljs-subst">${Color}</span>-<span class="hljs-subst">${Quantity}</span>`</span>; 
<span class="hljs-comment">// "bg-red-100" | "bg-red-200" | "bg-blue-100" | "bg-blue-200"</span>

<span class="hljs-comment">// 2. 事件名称生成器</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Entity</span> = <span class="hljs-string">"User"</span> | <span class="hljs-string">"Product"</span> | <span class="hljs-string">"Order"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Operation</span> = <span class="hljs-string">"Create"</span> | <span class="hljs-string">"Update"</span> | <span class="hljs-string">"Delete"</span>;

<span class="hljs-comment">// 自动生成所有可能的事件名</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EventName</span> = <span class="hljs-string">`<span class="hljs-subst">${Entity}</span><span class="hljs-subst">${Operation}</span>`</span>; 
<span class="hljs-comment">// "UserCreate" | "UserUpdate" | ... | "OrderDelete"</span>

<span class="hljs-comment">// --- 实战：类型安全的事件总线 (Event Bus) ---</span>

<span class="hljs-comment">// 定义事件负载映射</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EventPayloads</span> = {
    <span class="hljs-string">"user:login"</span>: { <span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">time</span>: <span class="hljs-built_in">number</span> };
    <span class="hljs-string">"user:logout"</span>: <span class="hljs-built_in">void</span>;
    <span class="hljs-string">"modal:open"</span>: { <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> };
    <span class="hljs-string">"modal:close"</span>: <span class="hljs-built_in">void</span>;
};

<span class="hljs-comment">// 字符串操作工具类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Split</span>&lt;S <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>, D <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = 
    <span class="hljs-built_in">string</span> <span class="hljs-keyword">extends</span> S ? <span class="hljs-built_in">string</span>[] :
    S <span class="hljs-keyword">extends</span> <span class="hljs-string">''</span> ? [] :
    S <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer T}</span><span class="hljs-subst">${D}</span><span class="hljs-subst">${infer U}</span>`</span> ? [T, ...<span class="hljs-title class_">Split</span>&lt;U, D&gt;] : [S];

<span class="hljs-comment">// 测试 Split</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Parts</span> = <span class="hljs-title class_">Split</span>&lt;<span class="hljs-string">"user:login:success"</span>, <span class="hljs-string">":"</span>&gt;; <span class="hljs-comment">// ["user", "login", "success"]</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedEventBus</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: { [K <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">EventPayloads</span>]?: (<span class="hljs-function">(<span class="hljs-params">payload: EventPayloads[K]</span>) =&gt;</span> <span class="hljs-built_in">void</span>)[] } = {};

    <span class="hljs-comment">// on 方法：EventName 必须是 EventPayloads 的键，cb 参数自动推导</span>
    on&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">EventPayloads</span>&gt;(<span class="hljs-attr">eventName</span>: K, <span class="hljs-attr">cb</span>: <span class="hljs-function">(<span class="hljs-params">payload: EventPayloads[K]</span>) =&gt;</span> <span class="hljs-built_in">void</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName]!.<span class="hljs-title function_">push</span>(cb);
    }

    <span class="hljs-comment">// emit 方法：payload 类型必须匹配</span>
    emit&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">EventPayloads</span>&gt;(<span class="hljs-attr">eventName</span>: K, <span class="hljs-attr">payload</span>: <span class="hljs-title class_">EventPayloads</span>[K]) {
        <span class="hljs-keyword">const</span> callbacks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName];
        <span class="hljs-keyword">if</span> (callbacks) {
            callbacks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(payload));
        }
    }
}

<span class="hljs-keyword">const</span> bus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypedEventBus</span>();

<span class="hljs-comment">// 类型安全：payload 自动推断为 { userId: string; time: number }</span>
bus.<span class="hljs-title function_">on</span>(<span class="hljs-string">"user:login"</span>, <span class="hljs-function">(<span class="hljs-params">payload</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User <span class="hljs-subst">${payload.userId}</span> logged in at <span class="hljs-subst">${payload.time}</span>`</span>);
});

<span class="hljs-comment">// 类型报错演示</span>
<span class="hljs-comment">// bus.emit("user:login", { userId: 123 }); // Error: Type 'number' is not assignable to type 'string'.</span>
bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"user:login"</span>, { <span class="hljs-attr">userId</span>: <span class="hljs-string">"u_001"</span>, <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() }); <span class="hljs-comment">// OK</span>

<span class="hljs-comment">// --- 进阶：CSS Padding/Margin 简写类型检查 ---</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">SizeUnit</span> = <span class="hljs-string">"px"</span> | <span class="hljs-string">"em"</span> | <span class="hljs-string">"rem"</span> | <span class="hljs-string">"%"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">SizeValue</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">number</span>}</span><span class="hljs-subst">${SizeUnit}</span>`</span> | <span class="hljs-string">"0"</span> | <span class="hljs-string">"auto"</span>;

<span class="hljs-comment">// 允许 1 到 4 个值</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CSSPadding</span> = 
    | <span class="hljs-title class_">SizeValue</span>
    | <span class="hljs-string">`<span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span>`</span>
    | <span class="hljs-string">`<span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span>`</span>
    | <span class="hljs-string">`<span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span>`</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setPadding</span>(<span class="hljs-params">el: HTMLElement, padding: CSSPadding</span>) {
    el.<span class="hljs-property">style</span>.<span class="hljs-property">padding</span> = padding;
}

<span class="hljs-comment">// setPadding(document.body, "10px"); // OK</span>
<span class="hljs-comment">// setPadding(document.body, "10px 20px"); // OK</span>
<span class="hljs-comment">// setPadding(document.body, "10px 20px 0 5%"); // OK</span>
<span class="hljs-comment">// setPadding(document.body, "10"); // Error: 缺少单位</span>
<span class="hljs-comment">// setPadding(document.body, "red"); // Error</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">模块四：装饰器（Decorators）与元编程</h3>
<p>虽然装饰器在 ECMAScript 中仍处于演进阶段，但在 TypeScript（尤其是 Angular 和 NestJS 生态）中应用广泛。这里展示基于 TypeScript 实验性装饰器的高级用法。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块四：装饰器与 AOP (面向切面编程)
 * 注意：需要在 tsconfig.json 中开启 "experimentalDecorators": true
 */</span>

<span class="hljs-comment">// 1. 方法装饰器：日志记录与性能监控</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">LogPerformance</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
    <span class="hljs-keyword">const</span> originalMethod = descriptor.<span class="hljs-property">value</span>;

    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {
        <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Starting] <span class="hljs-subst">${propertyKey}</span> with args:`</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(args));
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Finished] <span class="hljs-subst">${propertyKey}</span> in <span class="hljs-subst">${(end - start).toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[Error] <span class="hljs-subst">${propertyKey}</span> failed:`</span>, error);
            <span class="hljs-keyword">throw</span> error;
        }
    };
    <span class="hljs-keyword">return</span> descriptor;
}

<span class="hljs-comment">// 2. 参数装饰器与方法装饰器配合：参数校验</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"reflect-metadata"</span>; <span class="hljs-comment">// 需要 npm install reflect-metadata</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">"required"</span>);

<span class="hljs-comment">// 参数装饰器：标记哪个参数是必填的</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Required</span>(<span class="hljs-params">target: <span class="hljs-built_in">Object</span>, propertyKey: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">symbol</span>, parameterIndex: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">existingRequiredParameters</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnMetadata</span>(<span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span>, target, propertyKey) || [];
    existingRequiredParameters.<span class="hljs-title function_">push</span>(parameterIndex);
    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span>, existingRequiredParameters, target, propertyKey);
}

<span class="hljs-comment">// 方法装饰器：执行校验逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Validate</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyName: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
    <span class="hljs-keyword">let</span> method = descriptor.<span class="hljs-property">value</span>;
    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> <span class="hljs-attr">requiredParameters</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnMetadata</span>(<span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span>, target, propertyName);
        <span class="hljs-keyword">if</span> (requiredParameters) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> parameterIndex <span class="hljs-keyword">of</span> requiredParameters) {
                <span class="hljs-keyword">if</span> (parameterIndex &gt;= <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> || <span class="hljs-variable language_">arguments</span>[parameterIndex] === <span class="hljs-literal">undefined</span> || <span class="hljs-variable language_">arguments</span>[parameterIndex] === <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Missing required argument at index <span class="hljs-subst">${parameterIndex}</span> for method <span class="hljs-subst">${propertyName}</span>`</span>);
                }
            }
        }
        <span class="hljs-keyword">return</span> method.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
    }
}

<span class="hljs-comment">// 3. 类装饰器：依赖注入 (简易版 IOC 容器)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Constructor</span>&lt;T = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-keyword">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ServiceMap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Service</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">constructor: Constructor</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Registering service: <span class="hljs-subst">${name}</span>`</span>);
        <span class="hljs-title class_">ServiceMap</span>.<span class="hljs-title function_">set</span>(name, <span class="hljs-keyword">new</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>));
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Inject</span>(<span class="hljs-params">serviceName: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-comment">// 在属性被访问时懒加载注入</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyKey, {
            <span class="hljs-attr">get</span>: <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> service = <span class="hljs-title class_">ServiceMap</span>.<span class="hljs-title function_">get</span>(serviceName);
                <span class="hljs-keyword">if</span> (!service) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Service <span class="hljs-subst">${serviceName}</span> not found`</span>);
                <span class="hljs-keyword">return</span> service;
            },
            <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
        });
    }
}

<span class="hljs-comment">// --- 综合应用 ---</span>

<span class="hljs-meta">@Service</span>(<span class="hljs-string">"Logger"</span>)
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerService</span> {
    <span class="hljs-title function_">log</span>(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[LOG SERVICE]: <span class="hljs-subst">${msg}</span>`</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Inject</span>(<span class="hljs-string">"Logger"</span>)
    <span class="hljs-keyword">private</span> logger!: <span class="hljs-title class_">LoggerService</span>;

    <span class="hljs-meta">@Validate</span>
    <span class="hljs-meta">@LogPerformance</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"><span class="hljs-meta">@Required</span> name: <span class="hljs-built_in">string</span>, <span class="hljs-meta">@Required</span> email: <span class="hljs-built_in">string</span>, age?: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-comment">// 模拟异步操作</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Creating user: <span class="hljs-subst">${name}</span> (<span class="hljs-subst">${email}</span>)`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">id</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span>), name, email };
    }
}

<span class="hljs-comment">// 测试运行</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runDecorators</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserController</span>();
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> controller.<span class="hljs-title function_">createUser</span>(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"bob@example.com"</span>); <span class="hljs-comment">// 成功</span>
        <span class="hljs-comment">// await controller.createUser("Alice", null as any); // 抛出 Error: Missing required argument</span>
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
    }
}
<span class="hljs-comment">// runDecorators();</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">模块五：React 高级模式与多态组件</h3>
<p>在前端开发中，React 的类型定义尤为重要。我们将构建一个多态组件（Polymorphic Component），它可以根据 <code>as</code> 属性改变渲染的 HTML 标签，同时保持类型安全。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块五：React 高级类型模式
 * 场景：组件库开发、高阶组件 (HOC)
 */</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 1. 多态组件 (Polymorphic Components)</span>
<span class="hljs-comment">// 这是一个非常高级的模式，允许 &lt;Text as="h1"&gt; 或 &lt;Text as="a" href="..."&gt;</span>

<span class="hljs-comment">// 获取元素自身的 Props，排除我们要重写的 'as'</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AsProp</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>&gt; = {
    <span class="hljs-keyword">as</span>?: C;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PropsToOmit</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>, P&gt; = keyof (<span class="hljs-title class_">AsProp</span>&lt;C&gt; &amp; P);

<span class="hljs-comment">// 这是一个复杂的类型定义：</span>
<span class="hljs-comment">// 1. 接收泛型 C (组件类型) 和 Props</span>
<span class="hljs-comment">// 2. 合并传入的 Props 和 as 属性</span>
<span class="hljs-comment">// 3. 合并 HTML 原生属性 (Omit 掉重复的)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PolymorphicComponentProps</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>, <span class="hljs-title class_">Props</span> = {}&gt; = 
    <span class="hljs-title class_">React</span>.<span class="hljs-property">PropsWithChildren</span>&lt;<span class="hljs-title class_">Props</span> &amp; <span class="hljs-title class_">AsProp</span>&lt;C&gt;&gt; &amp;
    <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentPropsWithoutRef</span>&lt;C&gt;, <span class="hljs-title class_">PropsToOmit</span>&lt;C, <span class="hljs-title class_">Props</span>&gt;&gt;;

<span class="hljs-comment">// 定义组件类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PolymorphicRef</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>&gt; = <span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentPropsWithRef</span>&lt;C&gt;[<span class="hljs-string">"ref"</span>];

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PolymorphicComponentPropWithRef</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>, <span class="hljs-title class_">Props</span> = {}&gt; = 
    <span class="hljs-title class_">PolymorphicComponentProps</span>&lt;C, <span class="hljs-title class_">Props</span>&gt; &amp; { ref?: <span class="hljs-title class_">PolymorphicRef</span>&lt;C&gt; };

<span class="hljs-comment">// 实现组件</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TextProps</span> = {
    color?: <span class="hljs-string">'primary'</span> | <span class="hljs-string">'secondary'</span> | <span class="hljs-string">'danger'</span>;
    size?: <span class="hljs-string">'sm'</span> | <span class="hljs-string">'md'</span> | <span class="hljs-string">'lg'</span>;
};

<span class="hljs-comment">// 使用 React.forwardRef 实现</span>
<span class="hljs-comment">// 注意：由于泛型组件和 forwardRef 的结合在 TS 中比较棘手，通常需要类型断言</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Text</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">forwardRef</span>(
    &lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span> = <span class="hljs-string">"span"</span>&gt;<span class="hljs-function">(<span class="hljs-params">
        { <span class="hljs-keyword">as</span>, color = <span class="hljs-string">'primary'</span>, size = <span class="hljs-string">'md'</span>, children, ...rest }: PolymorphicComponentProps&lt;C, TextProps&gt;,
        ref: PolymorphicRef&lt;C&gt;
    </span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-title class_">Component</span> = <span class="hljs-keyword">as</span> || <span class="hljs-string">"span"</span>;
        
        <span class="hljs-keyword">const</span> style = {
            <span class="hljs-attr">color</span>: color === <span class="hljs-string">'danger'</span> ? <span class="hljs-string">'red'</span> : <span class="hljs-string">'black'</span>,
            <span class="hljs-attr">fontSize</span>: size === <span class="hljs-string">'lg'</span> ? <span class="hljs-string">'20px'</span> : <span class="hljs-string">'14px'</span>
        };

        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{style}</span> {<span class="hljs-attr">...rest</span>}&gt;</span>
                {children}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Component</span>&gt;</span></span>
        );
    }
) <span class="hljs-keyword">as</span> &lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span> = <span class="hljs-string">"span"</span>&gt;<span class="hljs-function">(<span class="hljs-params">
    props: PolymorphicComponentPropWithRef&lt;C, TextProps&gt;
</span>) =&gt;</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactElement</span> | <span class="hljs-literal">null</span>;

<span class="hljs-comment">// --- 使用示例 ---</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* 渲染为 span (默认) */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            
            {/* 渲染为 h1 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"h1"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"lg"</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            
            {/* 渲染为 a 标签，TS 会自动提示 href 属性是必须的/可用的 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"a"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://google.com"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"danger"</span>&gt;</span>
                Link
            <span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            
            {/* 错误演示：div 没有 href 属性 */}
            {/* <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"div"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"..."</span> /&gt;</span> // Error: Property 'href' does not exist on type... */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}

<span class="hljs-comment">// 2. 类型安全的 Render Props</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListProps</span>&lt;T&gt; {
    <span class="hljs-attr">items</span>: T[];
    <span class="hljs-attr">renderItem</span>: <span class="hljs-function">(<span class="hljs-params">item: T, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
}

<span class="hljs-comment">// 使用泛型组件定义</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">List</span>&lt;T&gt;({ items, renderItem }: <span class="hljs-title class_">ListProps</span>&lt;T&gt;) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {items.map((item, index) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>{renderItem(item, index)}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
    );
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-comment">// &lt;List </span>
<span class="hljs-comment">//   items={[{ id: 1, name: 'A' }, { id: 2, name: 'B' }]} </span>
<span class="hljs-comment">//   renderItem={(item) =&gt; &lt;span&gt;{item.name}&lt;/span&gt;} // item 自动推断为对象</span>
<span class="hljs-comment">// /&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">模块六：混合（Mixins）与类的组合</h3>
<p>TypeScript 支持 Mixin 模式，允许我们将多个类的功能组合到一个类中。这在构建复杂的 UI 组件库（如 Material CDK）时非常常见。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块六：Mixins
 * 场景：多重继承模拟、功能组合
 */</span>

<span class="hljs-comment">// 定义构造函数类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Constructor</span>&lt;T = {}&gt; = <span class="hljs-keyword">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T;

<span class="hljs-comment">// 1. Activatable Mixin: 添加激活/未激活状态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">Activatable</span>&lt;<span class="hljs-title class_">TBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Constructor</span>&gt;(<span class="hljs-title class_">Base</span>: <span class="hljs-title class_">TBase</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
        <span class="hljs-attr">isActivated</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

        <span class="hljs-title function_">activate</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActivated</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Activated!"</span>);
        }

        <span class="hljs-title function_">deactivate</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActivated</span> = <span class="hljs-literal">false</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Deactivated!"</span>);
        }
    };
}

<span class="hljs-comment">// 2. Disposable Mixin: 添加资源清理功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">Disposable</span>&lt;<span class="hljs-title class_">TBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Constructor</span>&gt;(<span class="hljs-title class_">Base</span>: <span class="hljs-title class_">TBase</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-attr">disposables</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>)[] = [];

        <span class="hljs-title function_">addDisposable</span>(<span class="hljs-params">cb: () =&gt; <span class="hljs-built_in">void</span></span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">disposables</span>.<span class="hljs-title function_">push</span>(cb);
        }

        <span class="hljs-title function_">dispose</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">disposables</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>());
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">disposables</span> = [];
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Resources disposed."</span>);
        }
    };
}

<span class="hljs-comment">// 3. Timestamped Mixin: 记录创建时间</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">Timestamped</span>&lt;<span class="hljs-title class_">TBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Constructor</span>&gt;(<span class="hljs-title class_">Base</span>: <span class="hljs-title class_">TBase</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
        timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    };
}

<span class="hljs-comment">// --- 组合使用 ---</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseComponent</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Rendering <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
    }
}

<span class="hljs-comment">// 创建一个拥有所有能力的类</span>
<span class="hljs-comment">// 注意：Mixin 的应用顺序会影响类的层级</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">SmartComponent</span> = <span class="hljs-title class_">Timestamped</span>(<span class="hljs-title class_">Disposable</span>(<span class="hljs-title class_">Activatable</span>(<span class="hljs-title class_">BaseComponent</span>)));

<span class="hljs-comment">// 演示</span>
<span class="hljs-keyword">const</span> comp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmartComponent</span>(<span class="hljs-string">"MyButton"</span>);

comp.<span class="hljs-title function_">render</span>(); <span class="hljs-comment">// 来自 BaseComponent</span>
comp.<span class="hljs-title function_">activate</span>(); <span class="hljs-comment">// 来自 Activatable</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Created at: <span class="hljs-subst">${comp.timestamp}</span>`</span>); <span class="hljs-comment">// 来自 Timestamped</span>

comp.<span class="hljs-title function_">addDisposable</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cleaning up event listeners..."</span>));
comp.<span class="hljs-title function_">dispose</span>(); <span class="hljs-comment">// 来自 Disposable</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">模块七：高级类型守卫与断言</h3>
<p>运行时类型检查对于前端应用的健壮性至关重要。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块七：类型守卫 (Type Guards) 与断言
 * 场景：处理联合类型、运行时数据验证
 */</span>

<span class="hljs-comment">// 1. 区分联合类型 (Discriminated Unions)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Square</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"square"</span>;
    <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rectangle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"rectangle"</span>;
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"circle"</span>;
    <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <span class="hljs-title class_">Square</span> | <span class="hljs-title class_">Rectangle</span> | <span class="hljs-title class_">Circle</span>;

<span class="hljs-comment">// 计算面积：利用 switch 的类型收窄</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">s: Shape</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">switch</span> (s.<span class="hljs-property">kind</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"square"</span>:
            <span class="hljs-comment">// 在这里 s 被收窄为 Square</span>
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">size</span> * s.<span class="hljs-property">size</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"rectangle"</span>:
            <span class="hljs-comment">// 在这里 s 被收窄为 Rectangle</span>
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">width</span> * s.<span class="hljs-property">height</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"circle"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * s.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>;
        <span class="hljs-attr">default</span>:
            <span class="hljs-comment">// 穷尽性检查 (Exhaustiveness checking)</span>
            <span class="hljs-comment">// 如果未来添加了新形状但没处理，这里会报错</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = s;
            <span class="hljs-keyword">return</span> _exhaustiveCheck;
    }
}

<span class="hljs-comment">// 2. 用户自定义类型守卫 (User-Defined Type Guards)</span>
<span class="hljs-comment">// 返回值类型必须是 `arg is Type`</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span></span>): value is <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"string"</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isDate</span>(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span></span>): value is <span class="hljs-title class_">Date</span> {
    <span class="hljs-keyword">return</span> value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>;
}

<span class="hljs-comment">// 复杂对象的类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiError</span> {
    <span class="hljs-attr">error</span>: <span class="hljs-literal">true</span>;
    <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">details</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiSuccess</span>&lt;T&gt; {
    <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span>;
    <span class="hljs-attr">data</span>: T;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ApiResult</span>&lt;T&gt; = <span class="hljs-title class_">ApiSuccess</span>&lt;T&gt; | <span class="hljs-title class_">ApiError</span>;

<span class="hljs-keyword">function</span> isSuccess&lt;T&gt;(<span class="hljs-attr">result</span>: <span class="hljs-title class_">ApiResult</span>&lt;T&gt;): result is <span class="hljs-title class_">ApiSuccess</span>&lt;T&gt; {
    <span class="hljs-keyword">return</span> result.<span class="hljs-property">error</span> === <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleApiResult</span>(<span class="hljs-params">result: ApiResult&lt;<span class="hljs-built_in">string</span>&gt;</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSuccess</span>(result)) {
        <span class="hljs-comment">// TS 知道这里是 ApiSuccess，可以安全访问 .data</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">data</span>.<span class="hljs-title function_">toUpperCase</span>());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// TS 知道这里是 ApiError</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error <span class="hljs-subst">${result.code}</span>: <span class="hljs-subst">${result.details}</span>`</span>);
    }
}

<span class="hljs-comment">// 3. 断言签名 (Assertion Signatures) - TS 3.7+</span>
<span class="hljs-comment">// 类似于 Node.js 的 assert 模块</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">assertIsNumber</span>(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>): asserts val is <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val !== <span class="hljs-string">"number"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Not a number!"</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">double</span>(<span class="hljs-params">input: <span class="hljs-built_in">any</span></span>) {
    <span class="hljs-title function_">assertIsNumber</span>(input);
    <span class="hljs-comment">// 此行之后，input 被视为 number</span>
    <span class="hljs-keyword">return</span> input * <span class="hljs-number">2</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-9">模块八：类型体操挑战（Type Gymnastics）</h3>
<p>为了展示 TS 的极限能力，我们实现一些类似 Lodash 函数的类型版本。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块八：类型体操
 * 场景：库作者、极度复杂的类型推导
 */</span>

<span class="hljs-comment">// 1. 实现 Join 类型 (Array.join 的类型版)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Join</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], U <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt; = 
    T <span class="hljs-keyword">extends</span> [infer F, ...infer R]
        ? R[<span class="hljs-string">'length'</span>] <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span>
            ? <span class="hljs-string">`<span class="hljs-subst">${F &amp; <span class="hljs-built_in">string</span>}</span>`</span>
            : <span class="hljs-string">`<span class="hljs-subst">${F &amp; <span class="hljs-built_in">string</span>}</span><span class="hljs-subst">${U}</span><span class="hljs-subst">${Join&lt;R, U&gt;}</span>`</span>
        : <span class="hljs-string">""</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Path</span> = <span class="hljs-title class_">Join</span>&lt;[<span class="hljs-string">'users'</span>, <span class="hljs-string">'id'</span>, <span class="hljs-string">'posts'</span>], <span class="hljs-string">'/'</span>&gt;; <span class="hljs-comment">// "users/id/posts"</span>

<span class="hljs-comment">// 2. 实现 DeepValue (根据路径获取深度属性值)</span>
<span class="hljs-comment">// 类似于 lodash.get(obj, "a.b.c")</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetPropType</span>&lt;T, P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = 
    P <span class="hljs-keyword">extends</span> keyof T 
        ? T[P] 
        : P <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer K}</span>.<span class="hljs-subst">${infer R}</span>`</span>
            ? K <span class="hljs-keyword">extends</span> keyof T 
                ? <span class="hljs-title class_">GetPropType</span>&lt;T[K], R&gt;
                : <span class="hljs-built_in">never</span>
            : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试 DeepValue</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-attr">app</span>: {
        <span class="hljs-attr">database</span>: {
            <span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>;
            <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>;
        }
    }
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">DBHost</span> = <span class="hljs-title class_">GetPropType</span>&lt;<span class="hljs-title class_">Config</span>, <span class="hljs-string">"app.database.host"</span>&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DBPort</span> = <span class="hljs-title class_">GetPropType</span>&lt;<span class="hljs-title class_">Config</span>, <span class="hljs-string">"app.database.port"</span>&gt;; <span class="hljs-comment">// number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Invalid</span> = <span class="hljs-title class_">GetPropType</span>&lt;<span class="hljs-title class_">Config</span>, <span class="hljs-string">"app.database.password"</span>&gt;; <span class="hljs-comment">// never</span>

<span class="hljs-comment">// 3. 元组转对象</span>
<span class="hljs-keyword">const</span> tuple = [<span class="hljs-string">'tesla'</span>, <span class="hljs-string">'model 3'</span>, <span class="hljs-string">'model X'</span>, <span class="hljs-string">'model Y'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TupleToObject</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = {
    [P <span class="hljs-keyword">in</span> T[<span class="hljs-built_in">number</span>]]: P;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">CarModelObj</span> = <span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tuple&gt;;
<span class="hljs-comment">// { tesla: "tesla", "model 3": "model 3", ... }</span>

<span class="hljs-comment">// 4. 柯里化函数的类型推导 (Currying)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Curry</span>&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt; = 
    <span class="hljs-function">(<span class="hljs-params">arg: Head&lt;P&gt;</span>) =&gt;</span> <span class="hljs-title class_">HasTail</span>&lt;P&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span> ? <span class="hljs-title class_">Curry</span>&lt;<span class="hljs-title class_">Tail</span>&lt;P&gt;, R&gt; : R;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Head</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = T <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">any</span>, ...<span class="hljs-built_in">any</span>[]] ? T[<span class="hljs-number">0</span>] : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Tail</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = (<span class="hljs-function">(<span class="hljs-params">...t: T</span>) =&gt;</span> <span class="hljs-built_in">any</span>) <span class="hljs-keyword">extends</span> (<span class="hljs-function">(<span class="hljs-params">_: <span class="hljs-built_in">any</span>, ...tail: infer TT</span>) =&gt;</span> <span class="hljs-built_in">any</span>) ? <span class="hljs-variable constant_">TT</span> : [];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">HasTail</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = T <span class="hljs-keyword">extends</span> ([] | [<span class="hljs-built_in">any</span>]) ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;

<span class="hljs-comment">// 这是一个简化的定义，实际柯里化类型非常复杂</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> curry&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt;(<span class="hljs-attr">f</span>: <span class="hljs-function">(<span class="hljs-params">...args: P</span>) =&gt;</span> R): <span class="hljs-title class_">Curry</span>&lt;P, R&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span>, c: <span class="hljs-built_in">number</span></span>) =&gt; a + b + c;
<span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add);

<span class="hljs-comment">// const sum = curriedAdd(1)(2)(3); // 理想情况下推导出 number</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">模块九：声明合并与模块扩展 (Module Augmentation)</h3>
<p>在扩展第三方库（如给 Window 对象添加属性，或扩展 React 的 Theme）时必不可少。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块九：模块扩展
 * 场景：全局变量、第三方库补丁
 */</span>

<span class="hljs-comment">// 1. 扩展全局 Window 对象</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> {
        <span class="hljs-attr">__REDUX_DEVTOOLS_EXTENSION__</span>: <span class="hljs-built_in">any</span>;
        <span class="hljs-title class_">Analytics</span>: {
            <span class="hljs-attr">track</span>: <span class="hljs-function">(<span class="hljs-params">event: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
        };
    }
    
    <span class="hljs-comment">// 扩展 String 原型</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">String</span> {
        <span class="hljs-title function_">toTitleCase</span>(): <span class="hljs-built_in">string</span>;
    }
}

<span class="hljs-comment">// 实现扩展的方法</span>
<span class="hljs-title class_">String</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toTitleCase</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\w\S*/g</span>, <span class="hljs-function">(<span class="hljs-params">txt</span>) =&gt;</span> txt.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + txt.<span class="hljs-title function_">substr</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">toLowerCase</span>());
};

<span class="hljs-comment">// 使用</span>
<span class="hljs-comment">// window.Analytics.track("Page View");</span>
<span class="hljs-comment">// const title = "hello world".toTitleCase();</span>

<span class="hljs-comment">// 2. 扩展第三方库 (以 styled-components 为例)</span>
<span class="hljs-comment">// 假设这是一个名为 'my-theme-lib' 的库</span>
<span class="hljs-comment">// import 'my-theme-lib';</span>

<span class="hljs-comment">// declare module 'my-theme-lib' {</span>
<span class="hljs-comment">//     export interface DefaultTheme {</span>
<span class="hljs-comment">//         borderRadius: string;</span>
<span class="hljs-comment">//         colors: {</span>
<span class="hljs-comment">//             main: string;</span>
<span class="hljs-comment">//             secondary: string;</span>
<span class="hljs-comment">//         };</span>
<span class="hljs-comment">//     }</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h3 data-id="heading-11">总结与最佳实践</h3>
<p>建议：</p>
<ol>
<li><strong>不要过度设计</strong>：虽然泛型和条件类型很强大，但如果一个类型定义超过了 10 行且难以阅读，考虑简化它或添加详细注释。</li>
<li><strong>利用 <code>unknown</code> 代替 <code>any</code></strong>：在不确定类型时，<code>unknown</code> 强制你在使用前进行类型检查，比 <code>any</code> 安全得多。</li>
<li><strong>优先使用接口 (Interface) 定义对象</strong>：接口支持声明合并，对库的扩展性更好；类型别名 (Type Alias) 更适合联合类型和元组。</li>
<li><strong>严格模式</strong>：始终开启 <code>strict: true</code>，特别是 <code>strictNullChecks</code>，这能避免 80% 的运行时错误。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue页面渲染流程]]></title>    <link>https://juejin.cn/post/7574622940688564243</link>    <guid>https://juejin.cn/post/7574622940688564243</guid>    <pubDate>2025-11-20T08:53:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574622940688564243" data-draft-id="7573993452578783275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue页面渲染流程"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-20T08:53:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WebGirl"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868584478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue页面渲染流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868584478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WebGirl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:53:31.000Z" title="Thu Nov 20 2025 08:53:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Vue 核心中除了响应式原理外，视图渲染也是重中之重。我们都知道每次更新数据，都会走视图渲染的逻辑，而这当中牵扯的逻辑也是十分繁琐。</p>
<p>本文主要解析的是初始化视图渲染流程，你将会了解到从挂载组件开始，Vue 是如何构建 VNode，又是如何将 VNode 转为真实节点并挂载到页面。</p>
<p>Vue2 的页面渲染流程可分为<strong>初始化渲染</strong>和<strong>更新渲染</strong>两大阶段，核心围绕「VNode 构建」和「真实 DOM 生成」展开。以下是详细流程解析：</p>
<h2 data-id="heading-0">一、初始化渲染流程（首次渲染）</h2>
<h3 data-id="heading-1">实例化与初始化（new Vue()）</h3>
<ul>
<li>通过 <code>new Vue(options)</code> 创建组件实例，触发 <code>_init</code> 方法（<code>src/core/instance/init.js</code>）。</li>
<li><code>_init</code> 方法初始化组件选项（合并配置、初始化生命周期、事件、状态等），并判断是否存在 <code>el</code> 选项，若存在则调用 <code>$mount</code> 开始挂载。</li>
</ul>
<p><strong>Vue 是一个构造函数，通过 <code>new</code> 关键字进行实例化。</strong></p>
<p>代码块 1（src/core/instance/index.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/index.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Vue</span> (options) {
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span> &amp;&amp;
    !(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vue</span>)
  ) {
    <span class="hljs-title function_">warn</span>(<span class="hljs-string">'Vue is a constructor and should be called with the `new` keyword'</span>)
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_init</span>(options)
}
</code></pre>
<p><strong>在实例化时，会调用 <code>_init</code> 进行初始化。</strong></p>
<p>代码块 2（src/core/instance/init.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/init.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_init</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">options?: <span class="hljs-built_in">Object</span></span>) {
  <span class="hljs-comment">// ... component = this</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>) {
    vm.$mount(vm.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>)
  }
}
</code></pre>
<h3 data-id="heading-2">挂载组件（$mount）</h3>
<ul>
<li><code>$mount</code> 方法最终调用 <code>mountComponent</code>（<code>src/core/instance/lifecycle.js</code>），负责将组件挂载到 DOM。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/lifecycle.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mountComponent</span> (
  <span class="hljs-attr">vm</span>: <span class="hljs-title class_">Component</span>,
  <span class="hljs-attr">el</span>: <span class="hljs-title class_">Element</span>,
  hydrating?: boolean
): <span class="hljs-title class_">Component</span> {
  vm.<span class="hljs-property">$el</span> = el
  <span class="hljs-title function_">callHook</span>(vm, <span class="hljs-string">'beforeMount'</span>)

  <span class="hljs-keyword">let</span> updateComponent
  <span class="hljs-comment">/* istanbul ignore if */</span>
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span> &amp;&amp; config.<span class="hljs-property">performance</span> &amp;&amp; mark) {
    <span class="hljs-comment">// ...</span>
  } <span class="hljs-keyword">else</span> {
    updateComponent = <span class="hljs-function">() =&gt;</span> {
      vm.<span class="hljs-title function_">_update</span>(vm.<span class="hljs-title function_">_render</span>(), hydrating) <span class="hljs-comment">// 渲染页面函数</span>
    }
  }

  <span class="hljs-comment">// we set this to vm._watcher inside the watcher's constructor</span>
  <span class="hljs-comment">// since the watcher's initial patch may call $forceUpdate (e.g. inside child</span>
  <span class="hljs-comment">// component's mounted hook), which relies on vm._watcher being already defined</span>
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(vm, updateComponent, noop, { <span class="hljs-comment">// 渲染watcher</span>
    before () {
      <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">_isMounted</span> &amp;&amp; !vm.<span class="hljs-property">_isDestroyed</span>) {
        <span class="hljs-title function_">callHook</span>(vm, <span class="hljs-string">'beforeUpdate'</span>)
      }
    }
  }, <span class="hljs-literal">true</span> <span class="hljs-comment">/* isRenderWatcher */</span>)
  hydrating = <span class="hljs-literal">false</span>

  <span class="hljs-comment">// manually mounted instance, call mounted on self</span>
  <span class="hljs-comment">// mounted is called for render-created child components in its inserted hook</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$vnode</span> == <span class="hljs-literal">null</span>) {
    vm.<span class="hljs-property">_isMounted</span> = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">callHook</span>(vm, <span class="hljs-string">'mounted'</span>)
  }
  <span class="hljs-keyword">return</span> vm
}
</code></pre>
<p><code>mountComponent</code> 除了调用一些生命周期的钩子函数外，最主要是 <code>updateComponent</code>，它就是负责渲染视图的核心方法，其只有一行核心代码：</p>
<pre><code class="hljs language-js" lang="js">vm.<span class="hljs-title function_">_update</span>(vm.<span class="hljs-title function_">_render</span>(), hydrating)
</code></pre>
<ul>
<li><code>vm._render</code> 创建并返回 VNode，<code>vm._update</code> 接收 VNode 将其转为真实节点。</li>
<li>其中 <code>vm._render()</code> 生成 VNode，<code>vm._update()</code> 将 VNode 转为真实 DOM。</li>
<li>创建「渲染 Watcher」，监听数据变化，首次执行 <code>updateComponent</code> 触发初始化渲染。
<ul>
<li><code>updateComponent</code> 会被传入<strong>渲染 Watcher</strong>，每当数据变化触发 Watcher 更新就会执行该函数，重新渲染视图。</li>
<li><code>updateComponent</code> 传入<strong>渲染 Watcher</strong> 后会被执行一次进行初始化页面渲染。</li>
</ul>
</li>
</ul>
<p>所以我们着重分析的是 <code>vm._render</code> 和 <code>vm._update</code> 两个方法，这也是本文主要了解的原理 ——Vue 视图渲染流程。</p>
<h3 data-id="heading-3">构建VNode(_render)</h3>
<p><strong>首先是 <code>_render</code> 方法，它用来构建组件的 VNode。</strong></p>
<ul>
<li><code>vm._render()</code> 调用组件的 <code>render</code> 函数（模板编译生成或用户自定义），返回根 VNode（虚拟节点）。</li>
<li><code>render</code> 函数通过 <code>vm.$createElement</code>（或编译生成的 <code>vm._c</code>）创建 VNode，内部调用 <code>createElement</code> 方法。</li>
</ul>
<p>代码块 1（src/core/instance/render.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/render.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_render</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { render, _parentVnode } = vm.<span class="hljs-property">$options</span>
  vnode = render.<span class="hljs-title function_">call</span>(vm.<span class="hljs-property">_renderProxy</span>, vm.<span class="hljs-property">$createElement</span>)
  <span class="hljs-keyword">return</span> vnode
}
</code></pre>
<p><code>_render</code> 内部会执行 <code>render</code> 方法并返回构建好的 VNode，<code>render</code> 一般是模板编译后生成的方法，也有可能是用户自定义。</p>
<p>代码块 2（src/core/instance/render.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/render.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initRender</span> (vm) {
  vm.<span class="hljs-property">_c</span> = <span class="hljs-function">(<span class="hljs-params">a, b, c, d</span>) =&gt;</span> <span class="hljs-title function_">createElement</span>(vm, a, b, c, d, <span class="hljs-literal">false</span>)
  vm.<span class="hljs-property">$createElement</span> = <span class="hljs-function">(<span class="hljs-params">a, b, c, d</span>) =&gt;</span> <span class="hljs-title function_">createElement</span>(vm, a, b, c, d, <span class="hljs-literal">true</span>)
}
</code></pre>
<ul>
<li><code>initRender</code> 在初始化就会执行为实例上绑定两个方法，分别是 <code>vm._c</code> 和 <code>vm.$createElement</code>。它们两者都是调用 <code>createElement</code> 方法，它是创建 VNode 的核心方法，最后一个参数用于区别是否为用户自定义。</li>
<li><code>vm._c</code> 应用场景是在编译生成的 <code>render</code> 函数中调用，<code>vm.$createElement</code> 则用于用户自定义 <code>render</code> 函数的场景。就像上面 <code>render</code> 在调用时会传入参数 <code>vm.$createElement</code>，我们在自定义 <code>render</code> 函数接收到的参数就是它。</li>
</ul>
<h4 data-id="heading-4">createElement</h4>
<ul>
<li><code>createElement</code> 封装 <code>_createElement</code>，处理参数并规范化子节点（<code>children</code>）：
<ul>
<li>若为编译生成的 <code>render</code>，调用 <code>simpleNormalizeChildren</code> 扁平化子节点数组。</li>
<li>若为用户自定义 <code>render</code>，调用 <code>normalizeChildren</code> 将子节点转为 VNode 数组。</li>
</ul>
</li>
<li>根据 <code>tag</code> 类型创建对应 VNode：
<ul>
<li>内置标签（如 <code>div</code>）：直接创建普通 VNode。</li>
<li>组件：调用 <code>createComponent</code> 创建组件类型 VNode。</li>
</ul>
</li>
</ul>
<p>代码块 3（src/core/vdom/create-element.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/vdom/create-element.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createElement</span> (
  <span class="hljs-attr">context</span>: <span class="hljs-title class_">Component</span>,
  <span class="hljs-attr">tag</span>: any,
  <span class="hljs-attr">data</span>: any,
  <span class="hljs-attr">children</span>: any,
  <span class="hljs-attr">normalizationType</span>: any,
  <span class="hljs-attr">alwaysNormalize</span>: boolean
): <span class="hljs-title class_">VNode</span> | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">VNode</span>&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(data) || <span class="hljs-title function_">isPrimitive</span>(data)) {
    normalizationType = children
    children = data
    data = <span class="hljs-literal">undefined</span>
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(alwaysNormalize)) {
    normalizationType = <span class="hljs-variable constant_">ALWAYS_NORMALIZE</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">_createElement</span>(context, tag, data, children, normalizationType)
}
</code></pre>
<p><code>createElement</code> 方法实际上是对 <code>_createElement</code> 方法的封装，它允许传入的参数更加灵活。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">_createElement</span> (
  <span class="hljs-attr">context</span>: <span class="hljs-title class_">Component</span>,
  <span class="hljs-attr">tag</span>: string | <span class="hljs-title class_">Class</span>&lt;<span class="hljs-title class_">Component</span>&gt; | <span class="hljs-title class_">Function</span> | <span class="hljs-title class_">Object</span>,
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">VNodeData</span>,
  <span class="hljs-attr">children</span>: any,
  <span class="hljs-attr">normalizationType</span>: number
): <span class="hljs-title class_">VNode</span> | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">VNode</span>&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(data) &amp;&amp; <span class="hljs-title function_">isDef</span>((<span class="hljs-attr">data</span>: any).<span class="hljs-property">is</span>)) {
    tag = data.<span class="hljs-property">is</span>
  }
  <span class="hljs-keyword">if</span> (!tag) {
    <span class="hljs-comment">// in case of component :is set to falsy value</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createEmptyVNode</span>()
  }
  <span class="hljs-comment">// support single function children as default scoped slot</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children) &amp;&amp;
    <span class="hljs-keyword">typeof</span> children[<span class="hljs-number">0</span>] === <span class="hljs-string">'function'</span>
  ) {
    data = data || {}
    data.<span class="hljs-property">scopedSlots</span> = { <span class="hljs-attr">default</span>: children[<span class="hljs-number">0</span>] }
    data.<span class="hljs-property">children</span> = []
  }
  <span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">ALWAYS_NORMALIZE</span>) {
    children = <span class="hljs-title function_">normalizeChildren</span>(children)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">SIMPLE_NORMALIZE</span>) {
    children = <span class="hljs-title function_">simpleNormalizeChildren</span>(children)
  }
  <span class="hljs-keyword">let</span> vnode, ns
  <span class="hljs-comment">// 根据tag类型创建VNode</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> tag === <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-title class_">Ctor</span>
    ns = (context.<span class="hljs-property">$vnode</span> &amp;&amp; context.<span class="hljs-property">$vnode</span>.<span class="hljs-property">ns</span>) || config.<span class="hljs-title function_">getTagNamespace</span>(tag)
    <span class="hljs-keyword">if</span> (config.<span class="hljs-title function_">isReservedTag</span>(tag)) {
      <span class="hljs-comment">// platform built-in elements</span>
      vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
        config.<span class="hljs-title function_">parsePlatformTagName</span>(tag), data, children,
        <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
      )
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(<span class="hljs-title class_">Ctor</span> = <span class="hljs-title function_">resolveAsset</span>(context.<span class="hljs-property">$options</span>, <span class="hljs-string">'components'</span>, tag))) {
      <span class="hljs-comment">// component</span>
      vnode = <span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Ctor</span>, data, context, children, tag)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// unknown or unlisted namespaced elements</span>
      <span class="hljs-comment">// check at runtime because it may get assigned a namespace when its</span>
      <span class="hljs-comment">// parent normalizes children</span>
      vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
        tag, data, children,
        <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
      )
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// direct component options / constructor</span>
    vnode = <span class="hljs-title function_">createComponent</span>(tag, data, context, children)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(vnode)) {
    <span class="hljs-keyword">return</span> vnode
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(vnode)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(ns)) <span class="hljs-title function_">applyNS</span>(vnode, ns)
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(data)) <span class="hljs-title function_">registerDeepBindings</span>(data)
    <span class="hljs-keyword">return</span> vnode
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createEmptyVNode</span>()
  }
}
</code></pre>
<p><code>_createElement</code> 参数中会接收 <code>children</code>，它表示当前 VNode 的子节点，因为它是任意类型的，所以接下来需要将其规范为标准的 VNode 数组；</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 这里规范化 children</span>
<span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">ALWAYS_NORMALIZE</span>) {
  children = <span class="hljs-title function_">normalizeChildren</span>(children)
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">SIMPLE_NORMALIZE</span>) {
  children = <span class="hljs-title function_">simpleNormalizeChildren</span>(children)
}
</code></pre>
<p><code>simpleNormalizeChildren</code> 和 <code>normalizeChildren</code> 均用于规范化 <code>children</code>。由 <code>normalizationType</code> 判断 <code>render</code> 函数是编译生成的还是用户自定义的。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. when the children contains components - because a functional component</span>
<span class="hljs-comment">// may return an Array instead of a single root. In this case, just a simple</span>
<span class="hljs-comment">// normalization is needed. If the child is an Array, we flatten the whole</span>
<span class="hljs-comment">// thing with Array.prototype.concat. It is guaranteed to be only 1-level deep</span>
<span class="hljs-comment">// because functional components already normalize their own children.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">simpleNormalizeChildren</span> (<span class="hljs-attr">children</span>: any) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; children.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children[i])) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">concat</span>.<span class="hljs-title function_">apply</span>([], children)
    }
  }
  <span class="hljs-keyword">return</span> children
}

<span class="hljs-comment">// 2. when the children contains constructs that always generated nested Arrays,</span>
<span class="hljs-comment">// e.g. &lt;template&gt;, &lt;slot&gt;, v-for, or when the children is provided by user</span>
<span class="hljs-comment">// with hand-written render functions / JSX. In such cases a full normalization</span>
<span class="hljs-comment">// is needed to cater to all possible types of children values.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeChildren</span> (<span class="hljs-attr">children</span>: any): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">VNode</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isPrimitive</span>(children)
    ? [<span class="hljs-title function_">createTextVNode</span>(children)]
    : <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children)
      ? <span class="hljs-title function_">normalizeArrayChildren</span>(children)
      : <span class="hljs-literal">undefined</span>
}
</code></pre>
<p><code>simpleNormalizeChildren</code> 方法调用场景是 <code>render</code> 函数当函数是编译生成的。<code>normalizeChildren</code> 方法的调用场景主要是 <code>render</code> 函数是用户手写的。</p>
<p>经过对 <code>children</code> 的规范化，<code>children</code> 变成了一个类型为 VNode 的数组。之后就是创建 VNode 的逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/vdom/patch.js</span>
<span class="hljs-keyword">let</span> vnode, ns
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> tag === <span class="hljs-string">'string'</span>) {
  <span class="hljs-keyword">let</span> <span class="hljs-title class_">Ctor</span>
  ns = (context.<span class="hljs-property">$vnode</span> &amp;&amp; context.<span class="hljs-property">$vnode</span>.<span class="hljs-property">ns</span>) || config.<span class="hljs-title function_">getTagNamespace</span>(tag)
  <span class="hljs-keyword">if</span> (config.<span class="hljs-title function_">isReservedTag</span>(tag)) {
    <span class="hljs-comment">// platform built-in elements</span>
    vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
      config.<span class="hljs-title function_">parsePlatformTagName</span>(tag), data, children,
      <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
    )
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(<span class="hljs-title class_">Ctor</span> = <span class="hljs-title function_">resolveAsset</span>(context.<span class="hljs-property">$options</span>, <span class="hljs-string">'components'</span>, tag))) {
    <span class="hljs-comment">// component</span>
    vnode = <span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Ctor</span>, data, context, children, tag)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// unknown or unlisted namespaced elements</span>
    <span class="hljs-comment">// check at runtime because it may get assigned a namespace when its</span>
    <span class="hljs-comment">// parent normalizes children</span>
    vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
      tag, data, children,
      <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
    )
  }
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// direct component options / constructor</span>
  vnode = <span class="hljs-title function_">createComponent</span>(tag, data, context, children)
}
</code></pre>
<p>如果 <code>tag</code> 是 <code>string</code> 类型，则接着判断：如果是内置的一些节点，创建一个普通 VNode；如果是已注册的组件名，则通过 <code>createComponent</code> 创建一个组件类型的 VNode；否则创建一个未知的标签的 VNode。</p>
<p>如果 <code>tag</code> 不是 <code>string</code> 类型，那就是 <code>Component</code> 类型，则直接调用 <code>createComponent</code> 创建一个组件类型的 VNode 节点。</p>
<p>最后 <code>_createElement</code> 会返回一个 VNode，也就是调用 <code>vm._render</code> 时创建得到的 VNode。之后 VNode 会传递给 <code>vm._update</code> 函数，用于生成真实 DOM。</p>
<h3 data-id="heading-5">生成真实dom(_update 与 patch)</h3>
<ul>
<li><code>vm._update(vnode)</code> 调用 <code>vm.__patch__</code> 方法（平台相关实现，Web 端对应 <code>patch</code> 函数）。</li>
<li><code>patch</code> 函数核心逻辑：
<ol>
<li>首次渲染时，<code>oldVnode</code> 为真实 DOM（如 <code>#app</code>），先通过 <code>emptyNodeAt</code> 转为空 VNode。</li>
<li>调用 <code>createElm</code> 将 VNode 递归转为真实 DOM 并插入父节点。</li>
<li>移除旧节点，触发 <code>insert</code> 钩子，完成渲染。</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 核心代码简化</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_update</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">vnode</span>) {
  <span class="hljs-keyword">const</span> vm = <span class="hljs-variable language_">this</span>;
  <span class="hljs-keyword">const</span> prevVnode = vm.<span class="hljs-property">_vnode</span>;
  vm.<span class="hljs-property">_vnode</span> = vnode;
  <span class="hljs-keyword">if</span> (!prevVnode) {
    <span class="hljs-comment">// 首次渲染：将 VNode 转为真实 DOM 并挂载</span>
    vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(vm.<span class="hljs-property">$el</span>, vnode);
  }
};

<span class="hljs-comment">// patch 核心逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, vnode</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRealElement</span>(oldVnode)) {
    oldVnode = <span class="hljs-title function_">emptyNodeAt</span>(oldVnode); <span class="hljs-comment">// 真实 DOM 转空 VNode</span>
  }
  <span class="hljs-title function_">createElm</span>(vnode, parentElm); <span class="hljs-comment">// 创建真实 DOM 并插入</span>
  <span class="hljs-title function_">removeVnodes</span>([oldVnode]); <span class="hljs-comment">// 移除旧节点</span>
}
</code></pre>
<p>代码块 1（src/core/instance/lifecycle.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/lifecycle.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_update</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">vnode: VNode, hydrating?: boolean</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">Component</span> = <span class="hljs-variable language_">this</span>
  <span class="hljs-keyword">const</span> prevEl = vm.<span class="hljs-property">$el</span>
  <span class="hljs-keyword">const</span> prevVnode = vm.<span class="hljs-property">_vnode</span>
  <span class="hljs-keyword">const</span> prevActiveInstance = activeInstance
  activeInstance = vm
  vm.<span class="hljs-property">_vnode</span> = vnode
  <span class="hljs-comment">// Vue.prototype.__patch__ is injected in entry points</span>
  <span class="hljs-comment">// based on the rendering backend used.</span>
  <span class="hljs-keyword">if</span> (!prevVnode) {
    <span class="hljs-comment">// initial render</span>
    vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(vm.<span class="hljs-property">$el</span>, vnode, hydrating, <span class="hljs-literal">false</span> <span class="hljs-comment">/* removeOnly */</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// updates</span>
    vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(prevVnode, vnode)
  }
  activeInstance = prevActiveInstance
  <span class="hljs-comment">// update __vue__ reference</span>
  <span class="hljs-keyword">if</span> (prevEl) {
    prevEl.<span class="hljs-property">__vue__</span> = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$el</span>) {
    vm.<span class="hljs-property">$el</span>.<span class="hljs-property">__vue__</span> = vm
  }
  <span class="hljs-comment">// if parent is an HOC, update its $el as well</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$vnode</span> &amp;&amp; vm.<span class="hljs-property">$parent</span> &amp;&amp; vm.<span class="hljs-property">$vnode</span> === vm.<span class="hljs-property">$parent</span>.<span class="hljs-property">_vnode</span>) {
    vm.<span class="hljs-property">$parent</span>.<span class="hljs-property">$el</span> = vm.<span class="hljs-property">$el</span>
  }
  <span class="hljs-comment">// updated hook is called by the scheduler to ensure that children are</span>
  <span class="hljs-comment">// updated in a parent's updated hook.</span>
}
</code></pre>
<p><code>_update</code> 里最核心的方法就是 <code>vm.__patch__</code> 方法，不同平台的 <code>patch</code> 方法的定义稍有不同，在 web 平台中它是这样定义的：</p>
<p>代码块 2（src/platforms/web/runtime/index.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/platforms/web/runtime/index.js</span>
<span class="hljs-keyword">import</span> { patch } <span class="hljs-keyword">from</span> <span class="hljs-string">'./patch'</span>
<span class="hljs-comment">// install platform patch function</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__patch__</span> = inBrowser ? patch : noop
</code></pre>
<p>可以看到 <code>__patch__</code> 实际调用的是 <code>patch</code> 方法。</p>
<p>代码块 3（src/platforms/web/runtime/patch.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/platforms/web/runtime/patch.js</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> nodeOps <span class="hljs-keyword">from</span> <span class="hljs-string">'web/runtime/node-ops'</span>
<span class="hljs-keyword">import</span> { createPatchFunction } <span class="hljs-keyword">from</span> <span class="hljs-string">'core/vdom/patch'</span>
<span class="hljs-keyword">import</span> baseModules <span class="hljs-keyword">from</span> <span class="hljs-string">'core/vdom/modules/index'</span>
<span class="hljs-keyword">import</span> platformModules <span class="hljs-keyword">from</span> <span class="hljs-string">'web/runtime/modules/index'</span>

<span class="hljs-comment">// the directive module should be applied last, after all</span>
<span class="hljs-comment">// built-in modules have been applied.</span>
<span class="hljs-keyword">const</span> modules = platformModules.<span class="hljs-title function_">concat</span>(baseModules)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">patch</span>: <span class="hljs-title class_">Function</span> = <span class="hljs-title function_">createPatchFunction</span>({ nodeOps, modules })
</code></pre>
<p>而patch方法是由createPatchFunction方法创建返回出来的函数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/vdom/patch.js</span>
<span class="hljs-keyword">const</span> hooks = [<span class="hljs-string">'create'</span>, <span class="hljs-string">'activate'</span>, <span class="hljs-string">'update'</span>, <span class="hljs-string">'remove'</span>, <span class="hljs-string">'destroy'</span>]

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createPatchFunction</span> (backend) {
  <span class="hljs-keyword">let</span> i, j
  <span class="hljs-keyword">const</span> cbs = {}
  <span class="hljs-keyword">const</span> { modules, nodeOps } = backend

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; hooks.<span class="hljs-property">length</span>; i++) {
    cbs[hooks[i]] = []
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; modules.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(modules[j][hooks[i]])) {
        cbs[hooks[i]].<span class="hljs-title function_">push</span>(modules[j][hooks[i]])
      }
    }
  }

  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span> (oldVnode, vnode, hydrating, removeOnly) {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>这里有两个比较重要的对象 <code>nodeOps</code> 和 <code>modules</code>：</p>
<ul>
<li><code>nodeOps</code> 是封装的原生 dom 操作方法，在生成真实节点树的过程中，dom 相关操作都是调用 <code>nodeOps</code> 内的方法。</li>
<li><code>modules</code> 是待执行的钩子函数，在进入函数时，会将不同模块的钩子函数分类放置到 <code>cbs</code> 中，其中包括自定义指令钩子函数、ref 钩子函数。在 <code>patch</code> 阶段，会根据操作节点的行为取出对应类型进行调用。</li>
</ul>
<h4 data-id="heading-6">Patch</h4>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-comment">// initial render</span>
<span class="hljs-number">2</span> vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(vm.<span class="hljs-property">$el</span>, vnode, hydrating, <span class="hljs-literal">false</span> <span class="hljs-comment">/* removeOnly */</span>)
</code></pre>
<p>在首次渲染时，<code>vm.$el</code> 对应的是根节点 dom 对象，也就是我们熟知的 id 为 app 的 div。它作为 <code>oldVnode</code> 参数传入 <code>patch</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, vnode, hydrating, removeOnly</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isUndef</span>(vnode)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(oldVnode)) <span class="hljs-title function_">invokeDestroyHook</span>(oldVnode)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">let</span> isInitialPatch = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">const</span> insertedVnodeQueue = []

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isUndef</span>(oldVnode)) {
    <span class="hljs-comment">// empty mount (likely as component), create new root element</span>
    isInitialPatch = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">createElm</span>(vnode, insertedVnodeQueue)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> isRealElement = <span class="hljs-title function_">isDef</span>(oldVnode.<span class="hljs-property">nodeType</span>)
    <span class="hljs-keyword">if</span> (!isRealElement &amp;&amp; <span class="hljs-title function_">sameVnode</span>(oldVnode, vnode)) {
      <span class="hljs-comment">// patch existing root node</span>
      <span class="hljs-title function_">patchVnode</span>(oldVnode, vnode, insertedVnodeQueue, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, removeOnly)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (isRealElement) {
        <span class="hljs-comment">// mounting to a real element</span>
        <span class="hljs-comment">// check if this is server-rendered content and if we can perform</span>
        <span class="hljs-comment">// a successful hydration.</span>
        <span class="hljs-keyword">if</span> (oldVnode.<span class="hljs-property">nodeType</span> === <span class="hljs-number">1</span> &amp;&amp; oldVnode.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-variable constant_">SSR_ATTR</span>)) {
          oldVnode.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-variable constant_">SSR_ATTR</span>)
          hydrating = <span class="hljs-literal">true</span>
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(hydrating)) {
          <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hydrate</span>(oldVnode, vnode, insertedVnodeQueue)) {
            <span class="hljs-title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, <span class="hljs-literal">true</span>)
            <span class="hljs-keyword">return</span> oldVnode
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
            <span class="hljs-title function_">warn</span>(
              <span class="hljs-string">'The client-side rendered virtual DOM tree is not matching '</span> +
              <span class="hljs-string">'server-rendered content. This is likely caused by incorrect '</span> +
              <span class="hljs-string">'HTML markup, for example nesting block-level elements inside '</span> +
              <span class="hljs-string">'&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing '</span> +
              <span class="hljs-string">'full client-side render.'</span>
            )
          }
        }
        <span class="hljs-comment">// either not server-rendered, or hydration failed.</span>
        <span class="hljs-comment">// create an empty node and replace it</span>
        oldVnode = <span class="hljs-title function_">emptyNodeAt</span>(oldVnode)
      }

      <span class="hljs-comment">// replacing existing element</span>
      <span class="hljs-keyword">const</span> oldElm = oldVnode.<span class="hljs-property">elm</span>
      <span class="hljs-keyword">const</span> parentElm = nodeOps.<span class="hljs-title function_">parentNode</span>(oldElm)

      <span class="hljs-comment">// create new node</span>
      <span class="hljs-title function_">createElm</span>(
        vnode,
        insertedVnodeQueue,
        <span class="hljs-comment">// extremely rare edge case: do not insert if old element is in a</span>
        <span class="hljs-comment">// leaving transition. Only happens when combining transition +</span>
        <span class="hljs-comment">// keep-alive + HOCs. (#4590)</span>
        oldElm.<span class="hljs-property">_leaveCb</span> ? <span class="hljs-literal">null</span> : parentElm,
        nodeOps.<span class="hljs-title function_">nextSibling</span>(oldElm)
      )

      <span class="hljs-comment">// update parent placeholder node element, recursively</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(vnode.<span class="hljs-property">parent</span>)) {
        <span class="hljs-keyword">let</span> ancestor = vnode.<span class="hljs-property">parent</span>
        <span class="hljs-keyword">const</span> patchable = <span class="hljs-title function_">isPatchable</span>(vnode)
        <span class="hljs-keyword">while</span> (ancestor) {
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cbs.<span class="hljs-property">destroy</span>.<span class="hljs-property">length</span>; ++i) {
            cbs.<span class="hljs-property">destroy</span>[i](ancestor)
          }
          ancestor.<span class="hljs-property">elm</span> = vnode.<span class="hljs-property">elm</span>
          <span class="hljs-keyword">if</span> (patchable) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cbs.<span class="hljs-property">create</span>.<span class="hljs-property">length</span>; ++i) {
              cbs.<span class="hljs-property">create</span>[i](emptyNode, ancestor)
            }
            <span class="hljs-comment">// #6513</span>
            <span class="hljs-comment">// invoke insert hooks that may have been merged by create hooks.</span>
            <span class="hljs-comment">// e.g. for directives that uses the "inserted" hook.</span>
            <span class="hljs-keyword">const</span> insert = ancestor.<span class="hljs-property">data</span>.<span class="hljs-property">hook</span>.<span class="hljs-property">insert</span>
            <span class="hljs-keyword">if</span> (insert.<span class="hljs-property">merged</span>) {
              <span class="hljs-comment">// start at index 1 to avoid re-invoking component mounted hook</span>
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; insert.<span class="hljs-property">fns</span>.<span class="hljs-property">length</span>; i++) {
                insert.<span class="hljs-property">fns</span>[i]()
              }
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">registerRef</span>(ancestor)
          }
          ancestor = ancestor.<span class="hljs-property">parent</span>
        }
      }

      <span class="hljs-comment">// destroy old node</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(parentElm)) {
        <span class="hljs-title function_">removeVnodes</span>([oldVnode], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(oldVnode.<span class="hljs-property">tag</span>)) {
        <span class="hljs-title function_">invokeDestroyHook</span>(oldVnode)
      }
    }
  }

  <span class="hljs-title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch)
  <span class="hljs-keyword">return</span> vnode.<span class="hljs-property">elm</span>
}
</code></pre>
<p>通过检查属性 <code>nodeType</code>（真实节点才有的属性），判断 <code>oldVnode</code> 是否为真实节点。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> isRealElement = <span class="hljs-title function_">isDef</span>(oldVnode.<span class="hljs-property">nodeType</span>)
<span class="hljs-keyword">if</span> (isRealElement) {
  <span class="hljs-comment">// ...</span>
  oldVnode = <span class="hljs-title function_">emptyNodeAt</span>(oldVnode)
}
</code></pre>
<p>很明显第一次的 <code>isRealElement</code> 是为 <code>true</code>，因此会调用 <code>emptyNodeAt</code> 将其转为 VNode：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">emptyNodeAt</span> (elm) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(nodeOps.<span class="hljs-title function_">tagName</span>(elm).<span class="hljs-title function_">toLowerCase</span>(), {}, [], <span class="hljs-literal">undefined</span>, elm)
}
</code></pre>
<p>接着会调用 <code>createElm</code> 方法，它就是将 VNode 转为真实 dom 的核心方法：</p>
<h3 data-id="heading-7">递归创建DOM节点（createElm）</h3>
<p><code>createElm</code> 是 VNode 转真实 DOM 的核心方法：</p>
<ol>
<li>若为组件 VNode，调用 <code>createComponent</code> 实例化组件并递归挂载。</li>
<li>若为普通元素，通过 <code>nodeOps.createElement</code> 创建真实节点，赋值给 <code>vnode.elm</code>。</li>
<li>递归调用 <code>createChildren</code> 处理子节点，将子节点插入当前节点（先子后父的插入顺序）。</li>
<li>调用 <code>insert</code> 方法将节点插入父容器（使用 <code>appendChild</code> 或 <code>insertBefore</code>）。</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createElm</span> (
  vnode,
  insertedVnodeQueue,
  parentElm,
  refElm,
  nested,
  ownerArray,
  index
) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(vnode.<span class="hljs-property">elm</span>) &amp;&amp; <span class="hljs-title function_">isDef</span>(ownerArray)) {
    <span class="hljs-comment">// This vnode was used in a previous render!</span>
    <span class="hljs-comment">// now it's used as a new node, overwriting its elm would cause</span>
    <span class="hljs-comment">// potential patch errors down the road when it's used as an insertion</span>
    <span class="hljs-comment">// reference node. Instead, we clone the node on-demand before creating</span>
    <span class="hljs-comment">// associated DOM element for it.</span>
    vnode = ownerArray[index] = <span class="hljs-title function_">cloneVNode</span>(vnode)
  }

  vnode.<span class="hljs-property">isRootInsert</span> = !nested <span class="hljs-comment">// for transition enter check</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">createComponent</span>(vnode, insertedVnodeQueue, parentElm, refElm)) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> data = vnode.<span class="hljs-property">data</span>
  <span class="hljs-keyword">const</span> children = vnode.<span class="hljs-property">children</span>
  <span class="hljs-keyword">const</span> tag = vnode.<span class="hljs-property">tag</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(tag)) {
    vnode.<span class="hljs-property">elm</span> = vnode.<span class="hljs-property">ns</span>
      ? nodeOps.<span class="hljs-title function_">createElementNS</span>(vnode.<span class="hljs-property">ns</span>, tag)
      : nodeOps.<span class="hljs-title function_">createElement</span>(tag, vnode)
    <span class="hljs-title function_">setScope</span>(vnode)

    <span class="hljs-comment">/* istanbul ignore if */</span>
    <span class="hljs-keyword">if</span> (__WEEX__) {
      <span class="hljs-comment">// ...</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">createChildren</span>(vnode, children, insertedVnodeQueue) <span class="hljs-comment">// 递归创建子节点</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(data)) {
        <span class="hljs-title function_">invokeCreateHooks</span>(vnode, insertedVnodeQueue)
      }
      <span class="hljs-title function_">insert</span>(parentElm, vnode.<span class="hljs-property">elm</span>, refElm)
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span> &amp;&amp; data &amp;&amp; data.<span class="hljs-property">pre</span>) {
    creatingElmInPre--
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(vnode.<span class="hljs-property">isComment</span>)) {
    vnode.<span class="hljs-property">elm</span> = nodeOps.<span class="hljs-title function_">createComment</span>(vnode.<span class="hljs-property">text</span>)
    <span class="hljs-title function_">insert</span>(parentElm, vnode.<span class="hljs-property">elm</span>, refElm) <span class="hljs-comment">// 插入父节点</span>
  } <span class="hljs-keyword">else</span> {
    vnode.<span class="hljs-property">elm</span> = nodeOps.<span class="hljs-title function_">createTextNode</span>(vnode.<span class="hljs-property">text</span>)
    <span class="hljs-title function_">insert</span>(parentElm, vnode.<span class="hljs-property">elm</span>, refElm)
  }
}
</code></pre>
<p>一开始会调用 <code>createComponent</code> 尝试创建组件类型的节点，如果成功会返回 <code>true</code>。在创建过程中也会调用 <code>$mount</code> 进行组件范围内的挂载，所以走的还是 <code>patch</code> 这套流程。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (<span class="hljs-title function_">createComponent</span>(vnode, insertedVnodeQueue, parentElm, refElm)) {
  <span class="hljs-keyword">return</span>
}
</code></pre>
<p>如果没有完成创建，代表该 VNode 对应的是真实节点，往下继续创建真实节点的逻辑。</p>
<pre><code class="hljs language-js" lang="js">vnode.<span class="hljs-property">elm</span> = vnode.<span class="hljs-property">ns</span>
  ? nodeOps.<span class="hljs-title function_">createElementNS</span>(vnode.<span class="hljs-property">ns</span>, tag)
  : nodeOps.<span class="hljs-title function_">createElement</span>(tag, vnode)
</code></pre>
<p>根据 <code>tag</code> 创建对应类型真实节点，赋值给 <code>vnode.elm</code>，它作为父节点容器，创建的子节点会被放到里面。</p>
<p>然后调用 <code>createChildren</code> 创建子节点：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createChildren</span> (vnode, children, insertedVnodeQueue) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children)) {
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
      <span class="hljs-title function_">checkDuplicateKeys</span>(children)
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; children.<span class="hljs-property">length</span>; ++i) {
      <span class="hljs-title function_">createElm</span>(children[i], insertedVnodeQueue, vnode.<span class="hljs-property">elm</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>, children, i)
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPrimitive</span>(vnode.<span class="hljs-property">text</span>)) {
    nodeOps.<span class="hljs-title function_">appendChild</span>(vnode.<span class="hljs-property">elm</span>, nodeOps.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-title class_">String</span>(vnode.<span class="hljs-property">text</span>)))
  }
}
</code></pre>
<p>内部进行遍历子节点数组，再次调用 <code>createElm</code> 创建节点，而上面创建的 <code>vnode.elm</code> 作为父节点传入。如此循环，直到没有子节点，就会创建文本节点插入到 <code>vnode.elm</code> 中。</p>
<p>执行完成后出来，会调用 <code>invokeCreateHooks</code>，它负责执行 dom 操作时的 <code>create</code> 钩子函数，同时将 VNode 加入到 <code>insertedVnodeQueue</code> 中：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">invokeCreateHooks</span> (vnode, insertedVnodeQueue) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cbs.<span class="hljs-property">create</span>.<span class="hljs-property">length</span>; ++i) {
    cbs.<span class="hljs-property">create</span>[i](emptyNode, vnode)
  }
  i = vnode.<span class="hljs-property">data</span>.<span class="hljs-property">hook</span> <span class="hljs-comment">// Reuse variable</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(i)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(i.<span class="hljs-property">create</span>)) i.<span class="hljs-title function_">create</span>(emptyNode, vnode)
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(i.<span class="hljs-property">insert</span>)) insertedVnodeQueue.<span class="hljs-title function_">push</span>(vnode)
  }
}
</code></pre>
<h3 data-id="heading-8">插入到父节点</h3>
<p>最后一步就是调用 <code>insert</code> 方法将节点插入到父节点：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">insert</span> (parent, elm, ref) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(parent)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(ref)) {
      <span class="hljs-keyword">if</span> (nodeOps.<span class="hljs-title function_">parentNode</span>(ref) === parent) {
        nodeOps.<span class="hljs-title function_">insertBefore</span>(parent, elm, ref)
      }
    } <span class="hljs-keyword">else</span> {
      nodeOps.<span class="hljs-title function_">appendChild</span>(parent, elm)
    }
  }
}
</code></pre>
<p>可以看到 Vue 是通过递归调用 <code>createElm</code> 来创建节点树的。同时也说明最深的子节点会先调用 <code>insert</code> 插入节点。所以整个节点树的插入顺序是 “先子后父”。插入节点方法就是原生 dom 的方法 <code>insertBefore</code> 和 <code>appendChild</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(parentElm)) {
  <span class="hljs-title function_">removeVnodes</span>([oldVnode], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
}
</code></pre>
<p><code>createElm</code> 流程走完后，构建完成的节点树已经插入到页面上了。其实 Vue 在初始化渲染页面时，并不是把原来的根节点 <code>app</code> 给真正替换掉，而是在其后面插入一个新的节点，接着再把旧节点给移除掉。</p>
<p>所以在 <code>createElm</code> 之后会调用 <code>removeVnodes</code> 来移除旧节点，它里面同样是调用的原生 dom 方法 <code>removeChild</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch)
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">invokeInsertHook</span> (vnode, queue, initial) {
  <span class="hljs-comment">// delay insert hooks for component root nodes, invoke them after the</span>
  <span class="hljs-comment">// element is really inserted</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(initial) &amp;&amp; <span class="hljs-title function_">isDef</span>(vnode.<span class="hljs-property">parent</span>)) {
    vnode.<span class="hljs-property">parent</span>.<span class="hljs-property">data</span>.<span class="hljs-property">pendingInsert</span> = queue
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; queue.<span class="hljs-property">length</span>; ++i) {
      queue[i].<span class="hljs-property">data</span>.<span class="hljs-property">hook</span>.<span class="hljs-title function_">insert</span>(queue[i])
    }
  }
}
</code></pre>
<p>在 <code>patch</code> 的最后就是调用 <code>invokeInsertHook</code> 方法，触发节点插入的钩子函数。</p>
<p>至此整个页面渲染的流程完毕。</p>
<h3 data-id="heading-9">完成渲染</h3>
<ul>
<li>触发 <code>mounted</code> 生命周期钩子（所有子组件挂载完成后），页面渲染完毕。</li>
</ul>
<h2 data-id="heading-10">二、更新渲染流程（数据变化时）</h2>
<p>当响应式数据变化时，触发渲染 Watcher 的更新，重新执行 <code>updateComponent</code>，流程如下：</p>
<ol>
<li>触发 <code>beforeUpdate</code> 生命周期钩子。</li>
<li>重新调用 <code>vm._render()</code> 生成新 VNode。</li>
<li>调用 <code>vm._update()</code>，通过 <code>patch</code> 对比新旧 VNode（<code>sameVnode</code> 检查）：
<ul>
<li>若为同一节点，调用 <code>patchVnode</code> 对比并更新差异（属性、文本、子节点等）。</li>
<li>若为不同节点，直接创建新节点并替换旧节点。</li>
</ul>
</li>
<li>触发 <code>updated</code> 生命周期钩子，完成更新。</li>
</ol>
<h2 data-id="heading-11">三、总结</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f13cbd2135024957b1bd8674cc7e1691~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2ViR2lybA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764233610&amp;x-signature=AU%2Bg%2Fud%2BXASNruVu97%2FRJtDTyyo%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>初始化调用<code>$mount</code>挂载组件。
-<code> _render</code>开始构建<code>VNode</code>，核心方法为<code>createElement</code>，一般会创建普通的<code>VNode</code>，遇到组件就创建组件类型的<code>VNode</code>，否则就是未知标签的<code>VNode</code>,构建完成传递给<code>_update</code>。</li>
<li><code>patch</code>阶段根据<code>VNode</code>创建真实节点树，核心方法为<code>createElm</code>,首选遇到组件类型的<code>VNode</code>,内部会执行<code>$mount</code>,再走一遍相同的流程。普通节点类型则创建一个真实的节点，如果它有子节点开始递归调用<code>createElm</code>，使用<code>insert</code>插入子节点，直到没有子节点就填充内容节点。</li>
<li>最后递归完成后，同样也是使用<code>insert</code>将整个节点树插入到页面中，再将旧的根节点移除。</li>
</ul>
<blockquote>
<ol>
<li><strong>初始化渲染</strong>：<code>new Vue()</code> → <code>_init</code> → <code>$mount</code> → <code>mountComponent</code> → <code>_render</code>（生成 VNode） → <code>_update</code>（<code>patch</code> 生成真实 DOM）。</li>
<li><strong>更新渲染</strong>：数据变化 → 渲染 Watcher 触发 → 重新生成 VNode → <code>patch</code> 对比更新 DOM。</li>
<li>核心思想：通过 VNode 抽象 DOM，减少直接操作 DOM 的开销，通过 Diff 算法高效更新差异。</li>
</ol>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Wappalyzer 原型链漏洞问题完整解决过程]]></title>    <link>https://juejin.cn/post/7574619023804776486</link>    <guid>https://juejin.cn/post/7574619023804776486</guid>    <pubDate>2025-11-20T08:50:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023804776486" data-draft-id="7574639741149200435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Wappalyzer 原型链漏洞问题完整解决过程"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-20T08:50:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="范特东南西北风"/> <meta itemprop="url" content="https://juejin.cn/user/3452905249580024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Wappalyzer 原型链漏洞问题完整解决过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3452905249580024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    范特东南西北风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:50:42.000Z" title="Thu Nov 20 2025 08:50:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Wappalyzer 原型链漏洞问题完整解决过程</h2>
<h3 data-id="heading-1">背景</h3>
<p>在生产环境中，使用 <strong>Wappalyzer</strong> 检测到项目使用了 lodash 版本 <strong>4.17.10</strong>（显示为 4.17.10），但项目的 <code>package.json</code> 中明确声明了 lodash 版本为 <strong>4.17.21</strong>。为了解决这个问题，查阅资料后，借助claude code以及gpt-5 完成了此次漏洞修复。</p>
<p>可以看我其他博客，教你怎么用这些工具融入vscode进行开发。</p>
<h4 data-id="heading-2">初始状态</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.14"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>问题</strong>: 为什么 Wappalyzer 检测到的是旧版本 4.17.10？</p>
<hr/>
<h3 data-id="heading-3">阶段一：配置 npm-force-resolutions 统一依赖版本</h3>
<h4 data-id="heading-4">问题分析</h4>
<p>虽然项目直接依赖了 lodash 4.17.21，但项目的<strong>嵌套依赖</strong>（dependencies 的 dependencies）可能使用了不同版本的 lodash，导致最终构建产物中包含多个 lodash 版本。</p>
<h4 data-id="heading-5">解决方案：使用 npm-force-resolutions</h4>
<p><code>npm-force-resolutions</code> 可以强制所有嵌套依赖使用指定版本，确保整个依赖树中只有一个 lodash 版本。</p>
<h4 data-id="heading-6">步骤 1: 安装 npm-force-resolutions</h4>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev npm-force-resolutions
</code></pre>
<h4 data-id="heading-7">步骤 2: 在 package.json 中添加 resolutions 字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"npm-force-resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.10"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>说明</strong>:</p>
<ul>
<li><code>resolutions</code> 字段指定所有 lodash 依赖（包括嵌套依赖）统一使用 4.17.21 版本</li>
<li>npm 旧版本不原生支持 <code>resolutions</code>，需要配合工具使用</li>
</ul>
<h4 data-id="heading-8">步骤 3: 创建 preinstall 脚本</h4>
<p>创建文件 <code>scripts/force-resolutions.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);

<span class="hljs-keyword">const</span> lockFile = <span class="hljs-string">'./package-lock.json'</span>;

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(lockFile)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'package-lock.json 不存在，先生成锁文件...'</span>);
    <span class="hljs-comment">// 忽略生命周期脚本，防止 preinstall 自己被触发</span>
    <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npm install --package-lock-only'</span>, {
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-attr">env</span>: { ...process.<span class="hljs-property">env</span>, <span class="hljs-attr">npm_config_ignore_scripts</span>: <span class="hljs-string">'true'</span> }
    });
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行 npm-force-resolutions 修改 lock 文件...'</span>);
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npx npm-force-resolutions'</span>, { <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span> });
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'preinstall 脚本执行失败：'</span>, err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<h4 data-id="heading-9">步骤 4: 在 package.json 中配置 preinstall 钩子</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/force-resolutions.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service serve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>:</p>
<ol>
<li>每次运行 <code>npm install</code> 前，自动执行 <code>preinstall</code> 钩子</li>
<li>脚本检查并生成 <code>package-lock.json</code></li>
<li>运行 <code>npx npm-force-resolutions</code> 修改锁文件，将所有 lodash 依赖版本统一替换为 4.17.21</li>
<li><code>npm install</code> 根据修改后的锁文件安装依赖</li>
</ol>
<h4 data-id="heading-10">步骤 5: 清理并重新安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除旧的依赖和锁文件</span>
<span class="hljs-built_in">rm</span> -rf node_modules
<span class="hljs-built_in">rm</span> package-lock.json

<span class="hljs-comment"># 重新安装（会自动触发 preinstall 钩子）</span>
npm install
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">bot-mb-manage@1.0.0 preinstall</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">node scripts/force-resolutions.js</span>

package-lock.json 不存在，先生成锁文件...
执行 npm-force-resolutions 修改 lock 文件...
✔ Applied resolutions!

added 1523 packages in 2m
</code></pre>
<h4 data-id="heading-11">步骤 6: 验证依赖版本</h4>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">ls</span> lodash
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">bot-mb-<span class="hljs-symbol">manage@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span> D:\bot\product\mb-manager-web
├─┬ element-<span class="hljs-symbol">ui@</span><span class="hljs-number">2.15</span><span class="hljs-number">.8</span>
│ └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
├── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span>
└─┬ <span class="hljs-meta">@riophae</span>/vue-<span class="hljs-symbol">treeselect@</span><span class="hljs-number">0.4</span><span class="hljs-number">.0</span>
  └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
</code></pre>
<p>✅ <strong>此时所有 npm 依赖中的 lodash 版本已统一为 4.17.21</strong></p>
<h4 data-id="heading-12">步骤 7: 构建并部署</h4>
<pre><code class="hljs language-bash" lang="bash">npm run build
</code></pre>
<p>构建成功后，部署到生产环境，使用 Wappalyzer 再次检测...</p>
<hr/>
<h3 data-id="heading-13">阶段二：发现问题仍然存在</h3>
<h4 data-id="heading-14">问题现象</h4>
<p>部署后，<strong>Wappalyzer 仍然检测到 lodash 4.17.10</strong>！</p>
<h4 data-id="heading-15">疑惑</h4>
<ul>
<li>✅ <code>npm ls lodash</code> 显示所有依赖都是 4.17.21</li>
<li>✅ <code>package-lock.json</code> 中搜索 "4.17.10" 无结果</li>
<li>❓ 那么旧版本是从哪里来的？</li>
</ul>
<hr/>
<h3 data-id="heading-16">阶段三：深度排查 - 发现 Element UI 内嵌代码</h3>
<h4 data-id="heading-17">排查步骤 1: 检查 node_modules 中的所有 lodash</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找所有 lodash package.json 文件</span>
find node_modules -name <span class="hljs-string">"package.json"</span> -path <span class="hljs-string">"*/lodash/package.json"</span>
</code></pre>
<p><strong>发现</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/lodash/package.json                    ← 版本 4.17.21 ✓
node_modules/element-ui/node_modules/lodash/...     ← (不存在)
</code></pre>
<p>所有通过 npm 安装的 lodash 确实都是 4.17.21。</p>
<h4 data-id="heading-18">排查步骤 2: 搜索 Element UI 源码</h4>
<p>根据网上资料，有人提到 Element UI 可能使用了 lodash 的 <code>safeGet</code> 方法：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Element UI 目录中搜索 lodash 相关代码</span>
grep -r <span class="hljs-string">"lodash"</span> node_modules/element-ui/lib/
</code></pre>
<p><strong>关键发现</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<h4 data-id="heading-19">排查步骤 3: 检查可疑文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看文件大小</span>
<span class="hljs-built_in">ls</span> -lh node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-css" lang="css">-rw-r<span class="hljs-attr">--r--</span> <span class="hljs-number">1</span> user <span class="hljs-number">197121</span> <span class="hljs-number">497.8</span>K Nov <span class="hljs-number">15</span> <span class="hljs-number">10</span>:<span class="hljs-number">23</span> lodash.js
</code></pre>
<p>⚠️ <strong>异常</strong>: 一个 utils 工具文件竟然有 497.8KB！</p>
<h4 data-id="heading-20">排查步骤 4: 读取文件内容</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">head</span> -20 node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p><strong>关键内容</strong>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@license</span>
 * Lodash &lt;https://lodash.com/&gt;
 * Copyright OpenJS Foundation and other contributors &lt;https://openjsf.org/&gt;
 * Released under MIT license &lt;https://lodash.com/license&gt;
 * Based on Underscore.js 1.8.3 &lt;http://underscorejs.org/LICENSE&gt;
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors
 */</span>
;(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {

  <span class="hljs-comment">/** Used as a safe reference for `undefined` in pre-ES5 environments. */</span>
  <span class="hljs-keyword">var</span> <span class="hljs-literal">undefined</span>;

  <span class="hljs-comment">/** Used as the semantic version number. */</span>
  <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.10'</span>;    <span class="hljs-comment">// ← 找到了！</span>
</code></pre>
<h4 data-id="heading-21">🎯 问题根源确认</h4>
<p><strong>Element UI 在其构建产物中内嵌了完整的 lodash 4.17.10 源代码！</strong></p>
<p>这解释了为什么：</p>
<ul>
<li><code>npm ls lodash</code> 显示所有依赖都是 4.17.21（因为这只检查 npm 依赖）</li>
<li><code>npm-force-resolutions</code> 无法解决问题（因为这不是 npm 依赖，是内嵌代码）</li>
<li>Wappalyzer 检测到 4.17.10（因为它分析的是最终构建产物）</li>
</ul>
<h4 data-id="heading-22">验证不同版本的 Element UI</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查当前版本（假设是 2.15.14）</span>
npm list element-ui
<span class="hljs-comment"># element-ui@2.15.14</span>

<span class="hljs-comment"># 检查是否存在内嵌 lodash</span>
<span class="hljs-built_in">ls</span> node_modules/element-ui/lib/utils/lodash.js
<span class="hljs-comment"># 存在 ✓</span>

<span class="hljs-comment"># 尝试安装旧版本 2.15.8</span>
npm install element-ui@2.15.8

<span class="hljs-comment"># 再次检查</span>
<span class="hljs-built_in">ls</span> node_modules/element-ui/lib/utils/lodash.js
<span class="hljs-comment"># ls: cannot access 'node_modules/element-ui/lib/utils/lodash.js': No such file or directory</span>
</code></pre>
<p>✅ <strong>发现</strong>: Element UI <strong>2.15.8</strong> 及之前的版本不包含内嵌 lodash 文件！</p>
<hr/>
<h3 data-id="heading-23">阶段四：评估降级风险</h3>
<h4 data-id="heading-24">对比版本差异</h4>
<p>查询 Element UI 官方 GitHub Changelog，2.15.8 到 2.15.14 的主要变更：</p>








































<table><thead><tr><th>版本</th><th>发布时间</th><th>主要变更</th></tr></thead><tbody><tr><td><strong>2.15.9</strong></td><td>2022-06-02</td><td>修复 Table、FormItem、Cascader bug；优化 DatePicker &amp; Cascader 下拉动画</td></tr><tr><td><strong>2.15.10</strong></td><td>2022-09-13</td><td>DatePicker 新增 <code>months</code> 和 <code>years</code> type 支持；修复 Loading、Tree bug</td></tr><tr><td><strong>2.15.11</strong></td><td>2022-11-15</td><td><strong>新增 Statistics 组件</strong>；Progress 新增 <code>defineBackColor</code>、<code>textColor</code> 属性；Web Types 支持</td></tr><tr><td><strong>2.15.12</strong></td><td>2022-11-16</td><td>修复 Statistic 千分位 bug</td></tr><tr><td><strong>2.15.13</strong></td><td>2023-02-12</td><td>修复 Statistics slot 显示 bug；<strong>Statistics 使用本地化 lodash</strong></td></tr><tr><td><strong>2.15.14</strong></td><td>2023-08-24</td><td>Table 新增高亮选中行功能；优化 Statistics 文档和代码</td></tr></tbody></table>
<h4 data-id="heading-25">检查项目是否使用新特性</h4>
<p>根据 Changelog，2.15.9+ 版本的主要新特性包括：</p>
<ul>
<li><strong>Statistics 组件</strong>（2.15.11 新增）</li>
<li><strong>DatePicker 的 <code>months</code>/<code>years</code> type</strong>（2.15.10 新增）</li>
<li><strong>Progress 的 <code>defineBackColor</code>/<code>textColor</code> 属性</strong>（2.15.11 新增）</li>
</ul>
<h5 data-id="heading-26">方法一：Git Bash（推荐，Windows 安装 Git 后自带）</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查是否使用了 Statistics 组件</span>
grep -r <span class="hljs-string">"el-statistics\|el-statistic"</span> src/ || <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 无结果 - 未使用 Statistics 组件"</span>

<span class="hljs-comment"># 检查 DatePicker 的 months/years 类型</span>
grep -r <span class="hljs-string">'type="months"\|type="years"'</span> src/ || <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 无结果 - 未使用 DatePicker months/years 类型"</span>

<span class="hljs-comment"># 检查 Progress 的新属性</span>
grep -r <span class="hljs-string">"defineBackColor\|textColor"</span> src/ | grep -i progress || <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 无结果 - 未使用 Progress 新属性"</span>
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">✓ 无结果 - 未使用 Statistics 组件
✓ 无结果 - 未使用 DatePicker months/years 类型
✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<h5 data-id="heading-27">方法二：Windows PowerShell</h5>
<pre><code class="hljs language-powershell" lang="powershell"># 检查是否使用了 Statistics 组件
$result = Get-ChildItem -Path src -Recurse -Include *.vue,*.js | Select-String -Pattern "el-statistics|el-statistic"
if ($result) { $result } else { "✓ 无结果 - 未使用 Statistics 组件" }

# 检查 DatePicker 的 months/years 类型
$result = Get-ChildItem -Path src -Recurse -Include *.vue,*.js | Select-String -Pattern 'type="months"|type="years"'
if ($result) { $result } else { "✓ 无结果 - 未使用 DatePicker months/years 类型" }

# 检查 Progress 的新属性
$result = Get-ChildItem -Path src -Recurse -Include *.vue,*.js | Select-String -Pattern "defineBackColor|textColor"
if ($result) { $result } else { "✓ 无结果 - 未使用 Progress 新属性" }
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">✓ 无结果 - 未使用 Statistics 组件
✓ 无结果 - 未使用 DatePicker months/years 类型
✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<h5 data-id="heading-28">方法三：Windows CMD</h5>
<pre><code class="hljs language-cmd" lang="cmd">REM 检查 Statistics 组件
findstr /s /i "el-statistics el-statistic" src\*.vue src\*.js &gt;nul 2&gt;&amp;1 &amp;&amp; echo 找到匹配 || echo ✓ 无结果 - 未使用 Statistics 组件

REM 检查 DatePicker 的 months/years 类型
findstr /s "type=\"months\" type=\"years\"" src\*.vue src\*.js &gt;nul 2&gt;&amp;1 &amp;&amp; echo 找到匹配 || echo ✓ 无结果 - 未使用 DatePicker months/years 类型

REM 检查 Progress 的新属性
findstr /s /i "defineBackColor textColor" src\*.vue src\*.js &gt;nul 2&gt;&amp;1 &amp;&amp; echo 找到匹配 || echo ✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">✓ 无结果 - 未使用 Statistics 组件
✓ 无结果 - 未使用 DatePicker months/years 类型
✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<hr/>
<p><strong>结论</strong>: 所有检测均显示"无结果"，说明项目<strong>未使用</strong>任何 2.15.9+ 版本的新特性，降级到 2.15.8 <strong>无风险</strong>。</p>
<hr/>
<h3 data-id="heading-29">阶段五：实施降级方案</h3>
<h4 data-id="heading-30">步骤 1: 修改 package.json</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.8"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 从 2.15.14 降级</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-31">步骤 2: 清理并重新安装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除旧版本</span>
<span class="hljs-built_in">rm</span> -rf node_modules/element-ui
<span class="hljs-built_in">rm</span> package-lock.json

<span class="hljs-comment"># 重新安装（preinstall 钩子会自动执行）</span>
npm install
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">bot-mb-manage@1.0.0 preinstall</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">node scripts/force-resolutions.js</span>

执行 npm-force-resolutions 修改 lock 文件...
✔ Applied resolutions!

added 1523 packages in 1m
</code></pre>
<h4 data-id="heading-32">步骤 3: 验证修复</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 验证 Element UI 版本</span>
npm list element-ui
<span class="hljs-comment"># element-ui@2.15.8 ✓</span>

<span class="hljs-comment"># 2. 验证 lodash 版本</span>
npm list lodash
<span class="hljs-comment"># 所有依赖均为 4.17.21 ✓</span>

<span class="hljs-comment"># 3. 验证内嵌文件不存在</span>
<span class="hljs-built_in">ls</span> node_modules/element-ui/lib/utils/lodash.js
<span class="hljs-comment"># ls: cannot access '...': No such file or directory ✓</span>
</code></pre>
<h4 data-id="heading-33">步骤 4: 构建测试</h4>
<pre><code class="hljs language-bash" lang="bash">npm run build
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet">...
Build complete. The dist directory <span class="hljs-built_in">is</span> ready <span class="hljs-keyword">to</span> be deployed.
✨  Done <span class="hljs-keyword">in</span> <span class="hljs-number">45.23</span>s
</code></pre>
<p>✅ <strong>构建成功，无错误！</strong></p>
<hr/>
<h3 data-id="heading-34">最终验证</h3>
<h4 data-id="heading-35">1. 本地验证</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查依赖树</span>
npm <span class="hljs-built_in">ls</span> lodash
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">bot-mb-<span class="hljs-symbol">manage@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span> D:\bot\product\mb-manager-web
├─┬ element-<span class="hljs-symbol">ui@</span><span class="hljs-number">2.15</span><span class="hljs-number">.8</span>
│ └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
├── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span>
└─┬ crypto-<span class="hljs-symbol">js@</span><span class="hljs-number">4.1</span><span class="hljs-number">.1</span>
  └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
</code></pre>
<p>✅ 所有 lodash 依赖统一为 4.17.21</p>
<h4 data-id="heading-36">2. 生产环境验证</h4>
<ol>
<li>部署构建产物到生产环境</li>
<li>使用 <strong>Wappalyzer</strong> 检测页面依赖</li>
<li>确认 lodash 版本显示为 <strong>4.17.21</strong> ✓</li>
<li>功能测试通过 ✓</li>
</ol>
<hr/>
<h3 data-id="heading-37">完整配置文件</h3>
<h4 data-id="heading-38">package.json</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bot-mb-manage"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/force-resolutions.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service serve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.8"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.7.14"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"npm-force-resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.10"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vue/cli-service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.5.11"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-39">scripts/force-resolutions.js</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);

<span class="hljs-keyword">const</span> lockFile = <span class="hljs-string">'./package-lock.json'</span>;

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(lockFile)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'package-lock.json 不存在，先生成锁文件...'</span>);
    <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npm install --package-lock-only'</span>, {
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-attr">env</span>: { ...process.<span class="hljs-property">env</span>, <span class="hljs-attr">npm_config_ignore_scripts</span>: <span class="hljs-string">'true'</span> }
    });
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行 npm-force-resolutions 修改 lock 文件...'</span>);
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npx npm-force-resolutions'</span>, { <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span> });
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'preinstall 脚本执行失败：'</span>, err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-40">其他可选方案</h3>
<h4 data-id="heading-41">方案二：使用 patch-package 修补 Element UI（适合需要保持最新版本的场景）</h4>
<p>如果项目必须使用 Element UI 2.15.9+ 的新特性，可以使用 <code>patch-package</code> 工具修补 node_modules 中的内嵌 lodash 文件。</p>
<h5 data-id="heading-42">什么是 patch-package？</h5>
<p><code>patch-package</code> 允许你修改 node_modules 中的第三方包，并生成补丁文件。每次 <code>npm install</code> 后会自动应用这些补丁。</p>
<h5 data-id="heading-43">完整操作步骤</h5>
<h6 data-id="heading-44">步骤 1: 安装 patch-package</h6>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev patch-package postinstall-postinstall
</code></pre>
<p><strong>说明</strong>:</p>
<ul>
<li><code>patch-package</code>: 核心工具，用于创建和应用补丁</li>
<li><code>postinstall-postinstall</code>: 确保补丁在 <code>npm install</code> 后正确应用（尤其是 Windows 环境）</li>
</ul>
<h6 data-id="heading-45">步骤 2: 修改 package.json 添加 postinstall 脚本</h6>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/force-resolutions.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"patch-package"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service serve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>: 每次 <code>npm install</code> 完成后，会自动运行 <code>patch-package</code> 应用补丁文件。</p>
<h6 data-id="heading-46">步骤 3: 修改 Element UI 内嵌的 lodash 版本号</h6>
<p><strong>方法一：手动修改（推荐，精确控制）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用编辑器打开文件</span>
code node_modules/element-ui/lib/utils/lodash.js

<span class="hljs-comment"># 或使用 PowerShell 替换（仅修改版本号）</span>
(Get-Content node_modules\element-ui\lib\utils\lodash.js) -replace <span class="hljs-string">"VERSION='4\.17\.10'"</span>,<span class="hljs-string">"VERSION='4.17.21'"</span> | Set-Content node_modules\element-ui\lib\utils\lodash.js

<span class="hljs-comment"># 或使用 Git Bash 替换</span>
sed -i <span class="hljs-string">"s/VERSION='4\.17\.10'/VERSION='4.17.21'/g"</span> node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p>找到第 14 行附近：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/** Used as the semantic version number. */</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.10'</span>;    <span class="hljs-comment">// ← 修改这里</span>
</code></pre>
<p>改为：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/** Used as the semantic version number. */</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.21'</span>;    <span class="hljs-comment">// ← 修改后</span>
</code></pre>
<p><strong>方法二：完全替换（更彻底，但需要测试）</strong></p>
<p>如果想完全替换内嵌的 lodash，可以用项目中的 lodash 4.17.21 覆盖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 备份原文件</span>
<span class="hljs-built_in">cp</span> node_modules/element-ui/lib/utils/lodash.js node_modules/element-ui/lib/utils/lodash.js.bak

<span class="hljs-comment"># 复制项目的 lodash（需要先构建 lodash）</span>
<span class="hljs-built_in">cp</span> node_modules/lodash/lodash.js node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p>⚠️ <strong>警告</strong>: 完全替换可能导致 Element UI 内部功能异常，建议只修改版本号。</p>
<h6 data-id="heading-47">步骤 4: 生成补丁文件</h6>
<pre><code class="hljs language-bash" lang="bash">npx patch-package element-ui
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet">patch-package <span class="hljs-number">8.0</span>.<span class="hljs-number">0</span>
• Creating temporary folder
• Installing element-ui@<span class="hljs-number">2.15</span>.<span class="hljs-number">14</span> <span class="hljs-keyword">with</span> npm
• Diffing your files <span class="hljs-keyword">with</span> clean files
✔ Created file patches/element-ui+<span class="hljs-number">2.15</span>.<span class="hljs-number">14</span>.patch

💡 element-ui <span class="hljs-built_in">is</span> <span class="hljs-keyword">on</span> GitHub! <span class="hljs-keyword">To</span> draft an issue based <span class="hljs-keyword">on</span> your patch run

    npx patch-package element-ui --create-issue
</code></pre>
<p>这会在项目根目录创建 <code>patches/element-ui+2.15.14.patch</code> 文件。</p>
<h6 data-id="heading-48">步骤 5: 查看生成的补丁文件</h6>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Git Bash / Linux / macOS</span>
<span class="hljs-built_in">cat</span> patches/element-ui+2.15.14.patch

<span class="hljs-comment"># Windows PowerShell</span>
Get-Content patches\element-ui+2.15.14.patch

<span class="hljs-comment"># Windows CMD</span>
<span class="hljs-built_in">type</span> patches\element-ui+2.15.14.patch
</code></pre>
<p><strong>补丁文件内容示例</strong>:</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">diff --git a/node_modules/element-ui/lib/utils/lodash.js b/node_modules/element-ui/lib/utils/lodash.js</span>
<span class="hljs-comment">index 1234567..abcdefg 100644</span>
<span class="hljs-comment">--- a/node_modules/element-ui/lib/utils/lodash.js</span>
<span class="hljs-comment">+++ b/node_modules/element-ui/lib/utils/lodash.js</span>
<span class="hljs-meta">@@ -11,7 +11,7 @@</span>
   var undefined;

   /** Used as the semantic version number. */
<span class="hljs-deletion">-  var VERSION='4.17.10';</span>
<span class="hljs-addition">+  var VERSION='4.17.21';</span>

   /** Used as references for various `Number` constants. */
   var MAX_SAFE_INTEGER = 9007199254740991;
</code></pre>
<h6 data-id="heading-49">步骤 6: 提交补丁文件到 Git</h6>
<pre><code class="hljs language-bash" lang="bash">git add patches/
git commit -m <span class="hljs-string">"fix: 添加 element-ui lodash 版本修复补丁"</span>
</code></pre>
<p><strong>重要</strong>: 补丁文件必须提交到版本控制系统，团队其他成员才能应用相同的修复。</p>
<h6 data-id="heading-50">步骤 7: 验证补丁生效</h6>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除 node_modules 测试自动应用</span>
<span class="hljs-built_in">rm</span> -rf node_modules
npm install

<span class="hljs-comment"># 验证版本号已修改</span>
<span class="hljs-comment"># Git Bash</span>
<span class="hljs-built_in">head</span> -20 node_modules/element-ui/lib/utils/lodash.js | grep VERSION

<span class="hljs-comment"># PowerShell</span>
Get-Content node_modules\element-ui\lib\utils\lodash.js -Head 20 | Select-String VERSION
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.21'</span>;    <span class="hljs-comment">// ✓ 已修改</span>
</code></pre>
<h6 data-id="heading-51">步骤 8: 构建并验证</h6>
<pre><code class="hljs language-bash" lang="bash">npm run build

<span class="hljs-comment"># 部署后使用 Wappalyzer 检测，应显示 lodash 4.17.21</span>
</code></pre>
<h5 data-id="heading-52">补丁维护注意事项</h5>
<h6 data-id="heading-53">1. Element UI 版本升级时</h6>
<p>每次升级 Element UI 版本后，需要重新生成补丁：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 升级 Element UI</span>
npm install element-ui@2.15.15

<span class="hljs-comment"># 重新修改文件</span>
<span class="hljs-comment"># ... 按照步骤 3 修改 ...</span>

<span class="hljs-comment"># 删除旧补丁</span>
<span class="hljs-built_in">rm</span> patches/element-ui+2.15.14.patch

<span class="hljs-comment"># 生成新补丁</span>
npx patch-package element-ui

<span class="hljs-comment"># 新补丁文件名: patches/element-ui+2.15.15.patch</span>
</code></pre>
<h6 data-id="heading-54">2. 团队协作</h6>
<p><strong>新成员加入项目时</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆项目后执行</span>
npm install

<span class="hljs-comment"># patch-package 会自动应用 patches/ 目录下的所有补丁</span>
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">&gt; postinstall
&gt; patch-<span class="hljs-keyword">package</span>

patch-<span class="hljs-keyword">package</span> <span class="hljs-number">8.0</span><span class="hljs-number">.0</span>
Applying patches...
element-<span class="hljs-symbol">ui@</span><span class="hljs-number">2.15</span><span class="hljs-number">.14</span> ✔
</code></pre>
<h6 data-id="heading-55">3. CI/CD 环境配置</h6>
<p>确保 CI/CD 流程中 <code>npm install</code> 后会自动应用补丁：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/build.yml 示例</span>
<span class="hljs-attr">steps:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
    <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>  <span class="hljs-comment"># 或 npm install</span>
    <span class="hljs-comment"># postinstall 钩子会自动运行 patch-package</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Verify</span> <span class="hljs-string">patch</span> <span class="hljs-string">applied</span>
    <span class="hljs-attr">run:</span> <span class="hljs-string">grep</span> <span class="hljs-string">"VERSION='4.17.21'"</span> <span class="hljs-string">node_modules/element-ui/lib/utils/lodash.js</span>
</code></pre>
<h5 data-id="heading-56">方案优缺点总结</h5>





















<table><thead><tr><th>方面</th><th>说明</th></tr></thead><tbody><tr><td><strong>优点</strong></td><td>• 可以保持使用最新版 Element UI<br/>• 修改精确可控<br/>• 团队成员自动同步修复</td></tr><tr><td><strong>缺点</strong></td><td>• 需要维护补丁文件<br/>• Element UI 每次升级都需重新生成补丁<br/>• 补丁可能与新版本冲突</td></tr><tr><td><strong>适用场景</strong></td><td>• 必须使用 Element UI 2.15.9+ 新特性<br/>• 团队有完善的 CI/CD 流程<br/>• 愿意承担补丁维护成本</td></tr></tbody></table>
<h5 data-id="heading-57">常见问题</h5>
<p><strong>Q: 补丁文件丢失怎么办？</strong></p>
<ul>
<li>补丁文件在 <code>patches/</code> 目录，必须提交到 Git</li>
<li>如果丢失，按照步骤 3-4 重新生成即可</li>
</ul>
<p><strong>Q: npm install 后补丁没有应用？</strong></p>
<ul>
<li>检查 package.json 中是否有 <code>"postinstall": "patch-package"</code></li>
<li>Windows 环境确保安装了 <code>postinstall-postinstall</code></li>
<li>手动运行 <code>npx patch-package</code> 应用补丁</li>
</ul>
<p><strong>Q: Element UI 升级后报错？</strong></p>
<ul>
<li>新版本可能内部结构变化，补丁无法应用</li>
<li>需要重新修改文件并生成新补丁</li>
<li>或考虑降级 Element UI 到稳定版本</li>
</ul>
<hr/>
<h4 data-id="heading-58">方案三：Webpack 插件替换（不推荐）</h4>
<p>使用 <code>NormalModuleReplacementPlugin</code> 在构建时替换内嵌的 lodash：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vue.config.js</span>
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">configureWebpack</span>: {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">NormalModuleReplacementPlugin</span>(
        <span class="hljs-regexp">/element-ui[/\\]lib[/\\]utils[/\\]lodash/</span>,
        <span class="hljs-string">'lodash'</span>
      )
    ]
  }
};
</code></pre>
<p><strong>缺点</strong>:</p>
<ul>
<li>可能破坏 Element UI 的内部逻辑</li>
<li>需要大量测试验证兼容性</li>
<li>不推荐使用</li>
</ul>
<hr/>
<h3 data-id="heading-59">问题总结</h3>
<h4 data-id="heading-60">问题演进</h4>
<ol>
<li><strong>初始问题</strong>: Wappalyzer 检测到 lodash 4.17.10，但 package.json 声明的是 4.17.21</li>
<li><strong>第一步尝试</strong>: 配置 <code>npm-force-resolutions</code> 统一嵌套依赖版本</li>
<li><strong>问题持续</strong>: npm 依赖已统一，但 Wappalyzer 仍检测到旧版本</li>
<li><strong>深度排查</strong>: 发现 Element UI 2.15.14 内嵌了完整的 lodash 4.17.10 源代码</li>
<li><strong>最终解决</strong>: 降级到 Element UI 2.15.8（不包含内嵌 lodash）</li>
</ol>
<h4 data-id="heading-61">根本原因</h4>
<p><strong>Element UI 2.15.14</strong> 在构建产物中直接嵌入了 lodash 4.17.10 的完整源代码（~497KB），而不是通过 npm 依赖管理。这导致：</p>
<ul>
<li>npm 工具无法检测和控制该版本</li>
<li><code>npm-force-resolutions</code> 无法修改内嵌代码</li>
<li>最终构建产物包含已知漏洞的旧版本 lodash</li>
</ul>
<h4 data-id="heading-62">解决方案对比</h4>





























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>推荐度</th></tr></thead><tbody><tr><td><strong>降级 Element UI</strong></td><td>彻底解决问题，无需额外配置</td><td>无法使用 2.15.9+ 新特性</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>Webpack 插件替换</td><td>保持最新版本</td><td>可能破坏 Element UI 内部逻辑</td><td>⭐⭐</td></tr><tr><td>patch-package 修补</td><td>保持最新版本</td><td>需要维护补丁，升级复杂</td><td>⭐⭐</td></tr></tbody></table>
<h4 data-id="heading-63">关键经验</h4>
<ol>
<li><strong>npm-force-resolutions 只能管理 npm 依赖</strong>，无法处理第三方库内嵌的代码</li>
<li><strong>Wappalyzer 检测的是最终构建产物</strong>，比 npm 依赖检查更准确</li>
<li><strong>第三方库可能内嵌依赖</strong>，升级时需要检查构建产物内容</li>
<li><strong>降级方案需要评估风险</strong>，通过 Changelog 和代码检索确认影响范围</li>
</ol>
<hr/>
<h3 data-id="heading-64">预防措施</h3>
<h4 data-id="heading-65">1. 定期安全检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 npm 依赖漏洞</span>
npm audit

<span class="hljs-comment"># 检查生产构建产物</span>
<span class="hljs-comment"># 使用 Wappalyzer 或 webpack-bundle-analyzer</span>
npm run build --report
</code></pre>
<h4 data-id="heading-66">2. 依赖升级审查流程</h4>
<ul>
<li>查阅 Changelog，了解变更内容</li>
<li>检查是否引入内嵌依赖（特别是 lib/utils 目录）</li>
<li>在测试环境充分验证后再部署生产</li>
</ul>
<h4 data-id="heading-67">3. 锁定关键依赖版本</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.8"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 不使用 ^，锁定版本</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span>      <span class="hljs-comment">// 锁定版本，避免意外升级</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-68">4. 监控构建产物大小</h4>
<p>异常的文件大小增长可能意味着内嵌了不必要的依赖。</p>
<hr/>
<h3 data-id="heading-69">参考命令</h3>
<h4 data-id="heading-70">依赖检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看某个包的所有版本</span>
npm <span class="hljs-built_in">ls</span> &lt;package-name&gt;

<span class="hljs-comment"># 查看依赖树（显示嵌套关系）</span>
npm <span class="hljs-built_in">ls</span> --all

<span class="hljs-comment"># 查找 node_modules 中的文件</span>
find node_modules -name <span class="hljs-string">"*.js"</span> -path <span class="hljs-string">"*/&lt;keyword&gt;/*"</span>

<span class="hljs-comment"># 搜索文件内容</span>
grep -r <span class="hljs-string">"关键词"</span> node_modules/&lt;package-name&gt;/
</code></pre>
<h4 data-id="heading-71">清理与重装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 完全清理</span>
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 清理 npm 缓存</span>
npm cache clean --force

<span class="hljs-comment"># 重新安装</span>
npm install
</code></pre>
<h4 data-id="heading-72">Git Bash vs PowerShell</h4>

























<table><thead><tr><th>命令</th><th>Git Bash</th><th>PowerShell</th></tr></thead><tbody><tr><td>查找文件</td><td><code>find . -name "*.js"</code></td><td><code>Get-ChildItem -Recurse -Filter "*.js"</code></td></tr><tr><td>搜索内容</td><td><code>grep -r "keyword" src/</code></td><td><code>Select-String -Path src\* -Pattern "keyword" -Recurse</code></td></tr><tr><td>检查文件存在</td><td><code>ls file.js</code></td><td><code>Test-Path file.js</code></td></tr></tbody></table>
<hr/>
<p><strong>文档生成时间</strong>: 2025-11-19
<strong>问题状态</strong>: ✅ 已解决
<strong>验证状态</strong>: ✅ 生产环境验证通过</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于浏览器自动化的 Cookie 获取与复用实践]]></title>    <link>https://juejin.cn/post/7574614157955072034</link>    <guid>https://juejin.cn/post/7574614157955072034</guid>    <pubDate>2025-11-20T08:57:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574614157955072034" data-draft-id="7574601160981331983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于浏览器自动化的 Cookie 获取与复用实践"/> <meta itemprop="keywords" content="自动化运维"/> <meta itemprop="datePublished" content="2025-11-20T08:57:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户778537183696"/> <meta itemprop="url" content="https://juejin.cn/user/1264901457184346"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于浏览器自动化的 Cookie 获取与复用实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1264901457184346/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户778537183696
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:57:11.000Z" title="Thu Nov 20 2025 08:57:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文只围绕三个问题展开：</p>
<ol>
<li>如何稳定地获取浏览器中的 Cookie（以及相关会话状态）</li>
<li>如何在后续脚本中复用这份 Cookie，实现免登录访问</li>
<li>为什么这种方式在技术上是可行的（底层原理是什么）</li>
</ol>
<hr/>
<h2 data-id="heading-0">一、如何获取 Cookie（认证采集脚本）</h2>
<p>思路是：启动一个有界面的浏览器实例，让用户手动完成一次真实登录，然后由脚本在合适的时机导出当前会话状态并落盘。</p>
<p>下面是一个最小可用的“认证采集脚本”示例（Node.js + Playwright）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { firefox } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"playwright"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTH_DIR</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"auth"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTH_FILE</span> = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable constant_">AUTH_DIR</span>, <span class="hljs-string">"auth-state.json"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BROWSER_EXECUTABLE</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"camoufox"</span>, <span class="hljs-string">"camoufox.exe"</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureDir</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(dir)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(dir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">captureAuth</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">ensureDir</span>(<span class="hljs-variable constant_">AUTH_DIR</span>);

  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>({
    <span class="hljs-attr">headless</span>: <span class="hljs-literal">false</span>,                      <span class="hljs-comment">// 必须有界面，用户需要手动登录</span>
    <span class="hljs-attr">executablePath</span>: <span class="hljs-variable constant_">BROWSER_EXECUTABLE</span>,   <span class="hljs-comment">// 如需指定自带浏览器，可配置此路径</span>
  });

  <span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>();
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">newPage</span>();

  <span class="hljs-comment">// 打开登录入口页面，用户在页面中完成登录</span>
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">"https://example.com/login"</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"请在新打开的浏览器中完成登录，然后回到终端按 Enter 继续..."</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> process.<span class="hljs-property">stdin</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">"data"</span>, resolve));

  <span class="hljs-comment">// 导出当前上下文的完整会话状态（包含 Cookies / Storage）</span>
  <span class="hljs-keyword">const</span> storageState = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">storageState</span>();

  fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-variable constant_">AUTH_FILE</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(storageState, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), <span class="hljs-string">"utf-8"</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`认证状态已写入: <span class="hljs-subst">${AUTH_FILE}</span>`</span>);

  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-title function_">captureAuth</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<p>关键点说明：</p>
<ul>
<li>
<p><strong>上下文级别会话</strong>：<br/>
<code>browser.newContext()</code> 创建的是独立的浏览器上下文，类似一个轻量级“用户配置目录”，其 Cookies、本地存储等和其他上下文隔离。</p>
</li>
<li>
<p><strong>人工登录 + 自动导出</strong>：<br/>
登录动作完全由用户在真实页面中完成，脚本只负责在用户确认后调用 <code>context.storageState()</code> 导出状态。</p>
</li>
<li>
<p><strong>会话状态文件化</strong>：<br/>
<code>storageState</code> 是一个普通 JS 对象，序列化为 <code>auth/auth-state.json</code> 后，就形成一个可长期复用的认证文件。</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、如何复用 Cookie（业务脚本）</h2>
<p>有了认证文件之后，业务脚本只需要在创建浏览器上下文时，把这份状态注入进去，新的上下文就会继承原来的 Cookie 和存储数据。</p>
<p>下面是一个使用同一认证文件的业务脚本示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { firefox } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"playwright"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTH_FILE</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"auth"</span>, <span class="hljs-string">"auth-state.json"</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadStorageState</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-variable constant_">AUTH_FILE</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`认证文件不存在: <span class="hljs-subst">${AUTH_FILE}</span>，请先运行采集脚本生成`</span>);
  }
  <span class="hljs-keyword">const</span> raw = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-variable constant_">AUTH_FILE</span>, <span class="hljs-string">"utf-8"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(raw);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> storageState = <span class="hljs-title function_">loadStorageState</span>();

  <span class="hljs-comment">// 业务脚本中通常可以使用无头模式</span>
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>({ <span class="hljs-attr">headless</span>: <span class="hljs-literal">true</span> });

  <span class="hljs-comment">// 关键点：在创建 context 的时候注入 storageState</span>
  <span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>({ storageState });
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">newPage</span>();

  <span class="hljs-comment">// 此处直接访问需要登录态的页面</span>
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">"https://example.com/protected"</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"当前页标题:"</span>, <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">title</span>());

  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<p>复用过程的本质是：<strong>不再从空上下文开始，而是用一份“预先持久化”的会话状态初始化上下文</strong>。</p>
<hr/>
<h2 data-id="heading-2">三、为什么这样做可行</h2>
<p>上面的流程之所以能工作，核心依赖三个技术点：</p>
<ol>
<li>HTTP Cookie 的工作机制</li>
<li>浏览器上下文（Browser Context）对会话状态的封装方式</li>
<li>自动化框架对“会话导出 / 会话注入”的支持（<code>storageState</code> 机制）</li>
</ol>
<p>下面按这三个层次拆开说明。</p>
<h3 data-id="heading-3">3.1 HTTP Cookie 与会话状态</h3>
<p>在 Web 体系中，服务端识别一个“已登录用户”的典型方式是：</p>
<ol>
<li>用户在登录页面输入账号密码，发起登录请求；</li>
<li>服务端校验成功后，返回一个或多个包含会话信息的 <code>Set-Cookie</code> 响应头，例如：</li>
</ol>
<pre><code class="hljs language-http" lang="http">Set-Cookie: SESSION_ID=abcdef; Path=/; HttpOnly; Secure
</code></pre>
<ol start="3">
<li>浏览器将这些 Cookie 存入其 Cookie 存储中，并在后续访问同一域名（符合作用域和路径规则）时，自动携带这些 Cookie：</li>
</ol>
<pre><code class="hljs language-http" lang="http">Cookie: SESSION_ID=abcdef
</code></pre>
<ol start="4">
<li>服务端根据 Cookie 中的会话标识（如 <code>SESSION_ID</code>）从自身会话存储中查找用户身份与权限，从而判断请求来自哪个登录用户。</li>
</ol>
<p>因此，只要浏览器中持有与服务端会话对应的 Cookie 集合，并在后续请求中按同样的规则携带这些 Cookie，服务端就会认为这是同一个“已登录会话”。</p>
<h3 data-id="heading-4">3.2 浏览器上下文与会话隔离</h3>
<p>现代自动化框架（如 Playwright）抽象了一个“浏览器上下文”（Browser Context）的概念：</p>
<ul>
<li>每个上下文拥有独立的 Cookie 存储、本地存储、会话存储等；</li>
<li>同一浏览器实例下的多个上下文相互隔离，互不共享会话状态；</li>
<li>上下文可以看作一个轻量级的“浏览器用户配置路径”。</li>
</ul>
<p>以 Playwright 为例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>();
<span class="hljs-keyword">const</span> contextA = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>(); <span class="hljs-comment">// 上下文 A</span>
<span class="hljs-keyword">const</span> contextB = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>(); <span class="hljs-comment">// 上下文 B</span>

<span class="hljs-comment">// A 中登录，不会影响 B</span>
</code></pre>
<p>这意味着：只要我们能把某一个上下文的 Cookie 和相关存储完整导出，并在未来用相同的结构去创建新上下文，就能“克隆”这个上下文的会话状态。</p>
<h3 data-id="heading-5">3.3 <code>storageState()</code>：会话导出的抽象</h3>
<p>自动化框架提供了一个关键 API，用于导出当前上下文的会话状态，例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> storageState = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">storageState</span>();
</code></pre>
<p>这个 <code>storageState</code> 通常包含如下信息：</p>
<ul>
<li>当前上下文中所有 Cookie（包含 name / value / domain / path / expires / secure / httpOnly 等字段）</li>
<li>按 origin 组织的 localStorage / sessionStorage 等数据</li>
<li>框架自身需要记录的与存储相关的元信息</li>
</ul>
<p>从数据结构上看，它只是一个普通的 JavaScript 对象，可以安全地序列化为 JSON 文件并持久化：</p>
<pre><code class="hljs language-javascript" lang="javascript">fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-string">"auth-state.json"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(storageState, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
</code></pre>
<h3 data-id="heading-6">3.4 <code>newContext({ storageState })</code>：会话注入的抽象</h3>
<p>在另一个脚本（或同一脚本的后续阶段），框架支持通过 <code>storageState</code> 初始化新的上下文：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> restoredState = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">"auth-state.json"</span>, <span class="hljs-string">"utf-8"</span>));

<span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>({
  <span class="hljs-attr">storageState</span>: restoredState,
});
</code></pre>
<p>本质上，这一步执行了两件事情：</p>
<ol>
<li>将 <code>restoredState.cookies</code> 写入新上下文的 Cookie 存储区；</li>
<li>将 <code>restoredState.origins</code> 对应的数据写入到各个 origin 的本地存储空间中。</li>
</ol>
<p>完成这一步之后，从新上下文发出的所有网络请求，将自动带上与原上下文完全一致的 Cookie 集合，因此在服务端看来：</p>
<ul>
<li>这就是一个已经登录过的浏览器实例；</li>
<li>只要服务端的会话未过期，所有需要登录态的接口都可以直接访问。</li>
</ul>
<h3 data-id="heading-7">3.5 为什么不需要在脚本中“模拟登录”</h3>
<p>由于浏览器上下文的会话状态是可序列化和可恢复的，认证采集脚本只需要在“已经登录成功”的时刻做一次导出即可。</p>
<p>从那一刻起：</p>
<ul>
<li>登录页面、登录表单、验证码、二次认证等流程全部被“折叠”进一次操作；</li>
<li>业务脚本无需再实现这段重复且高耦合的逻辑，只需要依赖认证文件即可。</li>
</ul>
<p>这在工程上带来的好处是非常明显的：</p>
<ul>
<li>登录流程的维护成本从“散落在每个脚本中”变为“集中在一个工具脚本中”；</li>
<li>自动化任务本身完全与认证细节解耦，职责清晰；</li>
<li>对于风控敏感系统，可以降低频繁模拟登录的触发风险。</li>
</ul>
<hr/>
<h2 data-id="heading-8">四、写在最后</h2>
<p>在此基础上，可以按需进一步扩展诸如多账号管理、有效期检测、安全加密等能力，但本质仍然基于同一技术原理：<strong>会话状态是可序列化、可持久化、可注入的新上下文的</strong>。</p>
<p>关注 <strong>【松哥AI自动化】</strong> 公众号，每周获取深度技术解析，从源码角度彻底理解各种工具的实现原理。更重要的是，遇到技术难题时，直接联系我！我会根据你的具体情况，提供最适合的解决方案和技术指导。</p>
<p>上期回顾：（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqrIH4SkI6w8iZDEpZe8yRw" target="_blank" title="https://mp.weixin.qq.com/s/qrIH4SkI6w8iZDEpZe8yRw" ref="nofollow noopener noreferrer">我为什么认为未来的自动化应该是：人提需求，AI生成工作流，AI工具执行</a>）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS App进入后台时会发生什么]]></title>    <link>https://juejin.cn/post/7574614157955088418</link>    <guid>https://juejin.cn/post/7574614157955088418</guid>    <pubDate>2025-11-20T09:00:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574614157955088418" data-draft-id="7574614157955006498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS App进入后台时会发生什么"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2025-11-20T09:00:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="songgeb"/> <meta itemprop="url" content="https://juejin.cn/user/3122268752587006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS App进入后台时会发生什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3122268752587006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    songgeb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:00:23.000Z" title="Thu Nov 20 2025 09:00:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>根据官方文档(<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fuikit%2Fextending-your-app-s-background-execution-time" target="_blank" title="https://developer.apple.com/documentation/uikit/extending-your-app-s-background-execution-time" ref="nofollow noopener noreferrer">Extending your app’s background execution time</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fuikit%2Fmanaging-your-app-s-life-cycle" target="_blank" title="https://developer.apple.com/documentation/uikit/managing-your-app-s-life-cycle" ref="nofollow noopener noreferrer">Managing your app’s life cycle</a>)显示</p>
<blockquote>
<p>文档查阅时间为2025-11-20</p>
</blockquote>
<ul>
<li>正常情况下，App先进入<code>Background</code>状态，紧接着（时间长短取决于是否通过<code>beginBackgroundTask</code>方法发起任务，但总体都很短）进入<code>Suspended</code></li>
<li>进入后台时<code>applicationDidEnterBackground</code>会执行，同时进入<code>Background</code>状态，该方法会有5s时间执行其中的任务</li>
<li><code>applicationDidEnterBackground</code>之后，如果没有<code>beginBackgroundTask</code>发起的后台任务，则很快就会进入<code>Suspended</code>状态</li>
<li>进入<code>Suspended</code>状态，App还会在内存中</li>
<li><code>Background</code>和<code>Suspended</code>状态的不同点是
<ul>
<li><code>Background</code>状态下，是可以执行短暂的后台任务</li>
<li><code>Suspended</code>状态下，App代码便不会再执行，收不到任何通知，而且系统可以根据（未其他App腾出内存空间）需要将App终止掉</li>
</ul>
</li>
<li>即使通过<code>beginBackgroundTask</code>开启后台任务也不过最多有30s的执行时间，仅适合执行一些非常重要的任务，比如将一些严重影响用户体验的数据写入磁盘，用作后续状态恢复</li>
<li>如果希望申请更多后台任务执行时间，则需要依赖<code>Background Tasks</code>框架</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cad98a74f3ff40d69fb528a1c0c035d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc29uZ2dlYg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764234023&amp;x-signature=hfYM%2F%2BU70HXFBlrlhbY8yQg7CKM%3D" alt="b0d3522d-c62b-49e2-9f48-01b0a4046b11.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 3.38 版本更新：客户端开发者需要关注这三点？]]></title>    <link>https://juejin.cn/post/7574615024293117978</link>    <guid>https://juejin.cn/post/7574615024293117978</guid>    <pubDate>2025-11-20T09:01:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574615024293117978" data-draft-id="7574620713228927027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 3.38 版本更新：客户端开发者需要关注这三点？"/> <meta itemprop="keywords" content="Flutter,客户端"/> <meta itemprop="datePublished" content="2025-11-20T09:01:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员老刘"/> <meta itemprop="url" content="https://juejin.cn/user/662360127965769"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 3.38 版本更新：客户端开发者需要关注这三点？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/662360127965769/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员老刘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:01:39.000Z" title="Thu Nov 20 2025 09:01:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>哈喽，我是老刘</strong></p>
<p>作为一个以Flutter为主要技术栈并且使用了差不多7年的开发者，其实老刘对Flutter版本更新的关注程度比很多人想象中要底很多。</p>
<p>本质上是因为在我的团队里对Flutter版本更新这件事会采用非常谨慎的策略。</p>
<p>我们的产品功能极少依赖最新版本的某个新组件，同时除非有非常严重的bug要解决，也不会急于升级到新版本。</p>
<p>但是Flutter 3.38版本我觉得各位开发者还是有必要关注一下的。</p>
<p>从Flutter本身的功能来看没有特别重大的更新，但是对于Android和iOS原生系统的要求来说，这个版本还是非常重要的。</p>
<hr/>
<h2 data-id="heading-0">要点解读</h2>
<h3 data-id="heading-1">一、Dart 语言更新：Dot shorthands 默认开启</h3>
<p>Dot shorthands 是 Dart 3.6 中引入的“点速记”语法，允许在枚举或静态常量上下文中省略前缀，仅写 <code>.xxx</code>，编译器自动补全类型。</p>
<ul>
<li>适用场景：枚举值、静态常量（如 <code>MainAxisAlignment.start</code> → <code>.start</code>）。</li>
<li>开启条件：Flutter 3.38 默认启用，无需额外配置。</li>
</ul>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-comment">// With shorthands</span>
Column(
  mainAxisAlignment: .start,
  crossAxisAlignment: .center,
  children: [ <span class="hljs-comment">/* ... */</span> ],
),

<span class="hljs-comment">// Without shorthands</span>
Column(
  mainAxisAlignment: MainAxisAlignment.start,
  crossAxisAlignment: CrossAxisAlignment.center,
  children: [ <span class="hljs-comment">/* … */</span> ],
),
</code></pre>
<p>最主要的作用是减少样板代码，提升可读性。</p>
<h3 data-id="heading-2">二、Web 开发增强</h3>
<ul>
<li>
<p>web_dev_config.yaml 配置开发服务器：</p>
<p>可设置 host/port/HTTPS 证书/headers，以及代理规则（将指定路径转发到后端）</p>
</li>
<li>
<p>Web 热重载增强：</p>
<ul>
<li>-d web-server 模式下默认开启 Web 热重载，并支持多个浏览器同时连接</li>
<li>可用 --no-web-experimental-hot-reload 暂时禁用（后续版本会移除该禁用选项）</li>
</ul>
</li>
</ul>
<p>Flutter最近几个小版本更新都在持续优化Web开发的部分，可见近期团队的重点一部分放在这里。</p>
<p>不过Flutter的web和常规的web开发两者应用场景还是有区别的，开发者做技术选型时一定要根据实际场景考虑。</p>
<h3 data-id="heading-3">三、Framework优化</h3>
<h4 data-id="heading-4">OverlayPortal 新能力</h4>
<p>可将子 Widget 渲染到任意 Overlay（如 root overlay），并通过 overlayChildLayoutBuilder 精细控制位置。</p>
<p>感觉适合弹窗、气泡、提示、对话框等复杂浮层的灵活布局。</p>
<h4 data-id="heading-5">Windows 桌面增强</h4>
<p>可访问已连接显示器列表（PlatformDispatcher.displays），查询分辨率、刷新率、设备像素比、物理尺寸等属性。</p>
<p>这次的桌面增强也属于是完善桌面的功能完备性的一个组成部分。</p>
<p>Flutter的桌面端多窗口还没有完整的实现，但是能看到各个细节在不停的补充进来。</p>
<p>对桌面端有需要的开发者目前仍然建议优先选择其它技术栈，但是可以持续关注Flutter的桌面端多窗口功能的进展。</p>
<h3 data-id="heading-6">四、其它更新</h3>
<p>Flutter 3.38 修复了 issue #173770：在 Android 端退出 Activity 销毁时出现的严重内存泄漏。该缺陷自 3.29.0 引入，影响所有 Flutter 应用。</p>
<hr/>
<h2 data-id="heading-7">升级提示</h2>
<p>Flutter 3.38 从功能上看没有特别重大的更新，但是对Android和iOS原生来说都有比较重要的 影响。</p>
<ul>
<li>
<p>Android：默认 NDK 版本升级为 r28，满足Google Play 16 KB 页面大小兼容性要求。</p>
</li>
<li>
<p>iOS：提供了对 UIScene 生命周期的支持。</p>
<p>老刘在文章结尾的官方链接部分也有给出UIScene 生命周期的官方迁移指南。</p>
</li>
</ul>
<p>因此，虽然从功能上看没有升级的必要，但是从原生的角度来说，确实是建议升级的。</p>
<p>根据我们一贯的升级核心原则：<strong>2~3个月观察期，别当小白鼠</strong></p>
<p>新版本发布后的前两三个月是“真人实验期”，严重问题通常在这段时间集中暴露。</p>
<p>等社区反馈、官方 issue 修复进度、第三方插件兼容性稳定后，再将其提升为主力版本。</p>
<p>老刘也会在每个月发布的《Flutter版本选择指南》中更新 Flutter 3.38 版本的最新情况。</p>
<p>历史链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDsP4g_9HKAkOlfcyTGKmCw" target="_blank" title="https://mp.weixin.qq.com/s/DsP4g_9HKAkOlfcyTGKmCw" ref="nofollow noopener noreferrer">Flutter版本选择指南：避坑3.27，3.35基本稳定 | 2025年10月</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9JHDVD2wSVtXkv8UxUr-qg" target="_blank" title="https://mp.weixin.qq.com/s/9JHDVD2wSVtXkv8UxUr-qg" ref="nofollow noopener noreferrer">Flutter版本选择指南：避坑3.27 | 2025年9月</a></li>
</ul>
<hr/>
<h2 data-id="heading-8">总结</h2>
<p>Flutter 3.38 从功能本身来说并非“重大升级”，更像是常规迭代与体验优化（Web 开发流程、桌面细节、语法易用性）。</p>
<p>但是不管是Android端的16k页面大小兼容还是iOS端的UIScene生命周期迁移，都对客户端的开发有比较重要的影响。</p>
<p>因此建议将 3.38 设为候选版本，等待2–3 个月观察窗口。没有重大问题后再提升为日常主力版本。</p>
<h2 data-id="heading-9">官方链接</h2>
<ul>
<li>
<p>Release Notes（3.38.0）：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Frelease-notes%2Frelease-notes-3.38.0" target="_blank" title="https://docs.flutter.dev/release/release-notes/release-notes-3.38.0" ref="nofollow noopener noreferrer">docs.flutter.dev/release/rel…</a></p>
</blockquote>
<p>（官方版本更新内容与变更说明）［来源：Flutter Docs］</p>
</li>
<li>
<p>Breaking Changes &amp; Migration：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes" target="_blank" title="https://docs.flutter.dev/release/breaking-changes" ref="nofollow noopener noreferrer">docs.flutter.dev/release/bre…</a></p>
</blockquote>
</li>
</ul>
<p>（所有破坏性变更与迁移指南索引）［来源：Flutter Docs］</p>
<ul>
<li>UIScene 生命周期迁移（iOS 必读）：
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate" ref="nofollow noopener noreferrer">docs.flutter.dev/release/bre…</a></p>
</blockquote>
</li>
</ul>
<p>（苹果要求采用 UIScene 生命周期，需按此迁移）［来源：Flutter Docs］</p>
<ul>
<li>
<p>What's New（文档站新增内容）：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fwhats-new" target="_blank" title="https://docs.flutter.dev/release/whats-new" ref="nofollow noopener noreferrer">docs.flutter.dev/release/wha…</a></p>
</blockquote>
</li>
</ul>
<p>（该页明确本次版本重点并指向相关指南）［来源：Flutter Docs］</p>
<ul>
<li>
<p>官方技术博客（3.38 总览）：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.flutter.dev%2Fwhats-new-in-flutter-3-38-3f7b258f7228" target="_blank" title="https://blog.flutter.dev/whats-new-in-flutter-3-38-3f7b258f7228" ref="nofollow noopener noreferrer">blog.flutter.dev/whats-new-i…</a></p>
</blockquote>
</li>
</ul>
<p>（本次版本的特性、工具链要求与已知问题）［来源：Flutter Blog］</p>
<blockquote>
<p>如果看到这里的同学对客户端或者Flutter开发感兴趣，欢迎联系老刘，我们互相学习。</p>
<p>私信免费领老刘整理的《Flutter开发手册》，覆盖90%应用开发场景。</p>
<p>可以作为Flutter学习的知识地图。</p>
<p>—— laoliu_dev</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何上架 App Store？从开发准备到构建上传的全流程技术指南]]></title>    <link>https://juejin.cn/post/7574584245152464947</link>    <guid>https://juejin.cn/post/7574584245152464947</guid>    <pubDate>2025-11-20T07:08:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574584245152464947" data-draft-id="7574625040659431474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何上架 App Store？从开发准备到构建上传的全流程技术指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:08:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS开发上架哦"/> <meta itemprop="url" content="https://juejin.cn/user/3336394949004844"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何上架 App Store？从开发准备到构建上传的全流程技术指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3336394949004844/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS开发上架哦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:08:46.000Z" title="Thu Nov 20 2025 07:08:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上架 App Store 对许多开发者来说并不是技术难点，而是流程复杂度带来的心理负担。
证书、IPA、截图、权限声明、审核问卷，每一项都可能成为绊脚石。</p>
<p>如果你正在寻找一份真正干净、能直接执行的“如何上架 App Store 的技术手册”，下面的内容能让整个流程从混乱变得可控。</p>
<p>本文从工程视角出发，拆分整个上架过程，覆盖准备、构建、上传、审核四类任务，让团队成员能清晰分工、减少返工、快速完成上架。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、上架前的基础条件：哪些是非准备不可的？</strong></h2>
<p>上架 App Store 必须具备以下两个核心条件：</p>
<h3 data-id="heading-1"><strong>1. Apple Developer Program（付费开发者账号）</strong></h3>
<ul>
<li>年费 99 美元</li>
<li>支持创建证书、描述文件</li>
<li>可进入 App Store Connect 管理应用
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a1531a158d04e2fadc2ec8f6d1d0d38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=rc1LApvV1njbuvelIq06UBulxf8%3D" alt="账号" loading="lazy"/></li>
</ul>
<h3 data-id="heading-2"><strong>2. App Store Connect 创建应用项目</strong></h3>
<p>在浏览器中创建以下信息：</p>
<ul>
<li>App 名称</li>
<li>主要语言</li>
<li>Bundle ID</li>
<li>应用类别</li>
<li>SKU（内部编号）</li>
</ul>
<p>这是整个上架流程的入口。</p>
<hr/>
<h2 data-id="heading-3"><strong>二、构建前的技术准备：证书、描述文件与权限信息</strong></h2>
<p>技术人员需要准备三项核心内容：</p>
<h3 data-id="heading-4"><strong>（1）App ID（Bundle ID）</strong></h3>
<p>格式：<code>com.company.appname</code></p>
<h3 data-id="heading-5"><strong>（2）发布证书（Distribution Certificate）</strong></h3>
<p>用于给 App Store 版本 IPA 签名。</p>
<h3 data-id="heading-6"><strong>（3）App Store 描述文件（Provisioning Profile）</strong></h3>
<p>包含 App ID + 证书信息。</p>
<p>这三项必须对应，否则 IPA 无法上传。</p>
<h3 data-id="heading-7"><strong>如何获得证书？</strong></h3>
<p>如果你在 macOS 上，可以通过 Xcode 或钥匙串助手生成。
但如果你的团队使用 Windows 或 Linux，可以使用开心上架（Appuploader）跨平台生成方式：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bb6f805d1c64bcf91b70d71c80b3526~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=%2BznrVuQrY7GFV8e5HCJc3ZbRZMQ%3D" alt="证书" loading="lazy"/></p>
<p>输出的证书可以在多个电脑共享，实现团队协作。</p>
<hr/>
<h2 data-id="heading-8"><strong>三、构建 IPA：不同技术栈、不同构建路径</strong></h2>
<p>要上架 App Store，必须准备 IPA 包。不同开发方式构建方式如下：</p>
<h3 data-id="heading-9"><strong>1. 原生 iOS（Swift / Objective-C）</strong></h3>
<ul>
<li>只能使用 Xcode → Archive → Export</li>
<li>必须在 macOS 上执行
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ce3552d49b7420c973c1c8cf2cefbbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=ip7t5Ddf1awIAnNp%2FsKA4m5uXBk%3D" alt="xcode打包" loading="lazy"/></li>
</ul>
<h3 data-id="heading-10"><strong>2. uni-app / HBuilderX</strong></h3>
<ul>
<li>使用云打包生成 IPA</li>
<li>不依赖本地 Mac，是 Windows 团队常用方式</li>
</ul>
<h3 data-id="heading-11"><strong>3. Flutter</strong></h3>
<p>常见构建方案：</p>
<ul>
<li>Codemagic</li>
<li>Bitrise</li>
<li>GitHub Actions（Mac Runner）</li>
</ul>
<h3 data-id="heading-12"><strong>4. React Native / Ionic / Capacitor</strong></h3>
<p>可使用对应的云构建服务或 CI。</p>
<p>构建成功后会得到一个经过签名的 IPA 文件，即可进入“上传阶段”。</p>
<hr/>
<h2 data-id="heading-13"><strong>四、如何把 IPA 上传到 App Store？（关键步骤）</strong></h2>
<p>这一步是整个上架流程中最直接影响结果的步骤。</p>
<h3 data-id="heading-14"><strong>官方方式（仅 macOS）</strong></h3>





















<table><thead><tr><th>工具</th><th>说明</th></tr></thead><tbody><tr><td>Xcode Organizer</td><td>能上传构建</td></tr><tr><td>Transporter</td><td>支持拖拽上传 IPA</td></tr><tr><td>altool</td><td>已弃用</td></tr></tbody></table>
<p>如果团队中有人拥有 Mac，可以使用这些方式。</p>
<hr/>
<h3 data-id="heading-15"><strong>开心上架（Appuploader）跨平台上传（Windows / Linux / macOS 全系统通用）</strong></h3>
<p>这是许多团队的主要解决方案，尤其是跨平台项目。</p>
<p>示例命令：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./dist/app.ipa
</code></pre>
<p>参数含义：</p>

























<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>-u</td><td>Apple ID</td></tr><tr><td>-p</td><td>App 专用密码（非登陆密码）</td></tr><tr><td>-c</td><td>上传通道（2 = 新协议）</td></tr><tr><td>-f</td><td>指定 IPA 文件路径</td></tr></tbody></table>
<p>上传成功后，构建会出现在：</p>
<ul>
<li><strong>TestFlight（供测试人员下载）</strong></li>
<li><strong>App Store Connect → 构建版本列表</strong></li>
</ul>
<p>跨平台上传适合：</p>
<ul>
<li>无 Mac 环境的团队</li>
<li>自动化发布</li>
<li>CI/CD 流程集成</li>
<li>多地协作团队</li>
</ul>
<p>图像化管理界面：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41d1947cae8c4047b765d00fc01ccd26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=xtMxbohi0elFvDrhJAX0F8joZ24%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-16"><strong>五、如何填写 App Store Connect 信息？（非技术但必须完善）</strong></h2>
<p>上传后，还需要配置 App 信息，否则无法提交审核。</p>
<p>包括：</p>
<h3 data-id="heading-17"><strong>（1）截图（必须项）</strong></h3>
<p>每个版本必须上传：</p>
<ul>
<li>iPhone 6.5 英寸</li>
<li>iPhone 5.5 英寸</li>
<li>若支持 iPad，需要 iPad 12.9 / 10.5 截图</li>
</ul>
<p>截图必须是真实界面，不允许生成式或手机壳模板。</p>
<h3 data-id="heading-18"><strong>（2）应用信息</strong></h3>
<p>包括：</p>
<ul>
<li>简介</li>
<li>详细描述</li>
<li>关键词</li>
<li>支持 URL</li>
<li>隐私政策 URL</li>
</ul>
<h3 data-id="heading-19"><strong>（3）权限用途说明</strong></h3>
<p>所有需要权限的功能必须在 Info.plist 中说明原因，例如：</p>
<ul>
<li>相机</li>
<li>麦克风</li>
<li>相册</li>
<li>定位</li>
</ul>
<p>缺失任何一项都可能被拒审。</p>
<hr/>
<h2 data-id="heading-20"><strong>六、提交审核前的关键检查（减少被拒几率）</strong></h2>
<p>为了避免“反复被拒”，提交审核前建议检查：</p>
<h3 data-id="heading-21"><strong>1. App 真机是否闪退？</strong></h3>
<p>冷启动必须稳定。</p>
<h3 data-id="heading-22"><strong>2. 权限是否全部有用途说明？</strong></h3>
<p>缺一项都会被拒绝。</p>
<h3 data-id="heading-23"><strong>3. 登录流程是否顺畅？</strong></h3>
<p>审核会真实操作 App。</p>
<h3 data-id="heading-24"><strong>4. 是否存在类似网页支付的违规行为？</strong></h3>
<p>苹果对支付机制非常敏感。</p>
<h3 data-id="heading-25"><strong>5. 截图是否真实？</strong></h3>
<p>虚假截图是常见拒审理由。</p>
<p>只要做到这些，审核通常比较顺利。</p>
<hr/>
<h2 data-id="heading-26"><strong>七、审核通过后：选择发布时间</strong></h2>
<p>苹果审核通过后，你可以选择：</p>
<ul>
<li><strong>立即发布</strong></li>
<li><strong>指定时间发布</strong></li>
<li><strong>手动发布</strong></li>
</ul>
<p>而如果你事先启用了 TestFlight，可以让 QA 或测试用户提前体验。</p>
<hr/>
<h2 data-id="heading-27"><strong>如何上架 App Store，其实是“流程工程”</strong></h2>
<p>从技术链路来看，上架流程可以归纳为三类准备：</p>
<h3 data-id="heading-28"><strong>1. 身份类准备（账号 + 证书）</strong></h3>
<p>确保你的 App 能被苹果识别。</p>
<h3 data-id="heading-29"><strong>2. 应用类准备（IPA + 签名）</strong></h3>
<p>确保应用能上传、能运行、能被测试。</p>
<h3 data-id="heading-30"><strong>3. 内容类准备（截图 + 信息 + 权限）</strong></h3>
<p>确保审核顺利通过。</p>
<p>一旦你把这三类内容系统化管理，上架 App Store 就不再是一件麻烦事，而是一套可以复用的工程流程。
上架参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.applicationloader.net%2Ftutorial%2Fzh%2F1%2F1.html" target="_blank" title="https://www.applicationloader.net/tutorial/zh/1/1.html" ref="nofollow noopener noreferrer">www.applicationloader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RevenueCat 接入 Google Play 订阅全流程详解（2025 最新）]]></title>    <link>https://juejin.cn/post/7574382900860633115</link>    <guid>https://juejin.cn/post/7574382900860633115</guid>    <pubDate>2025-11-20T07:10:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574382900860633115" data-draft-id="7574615024292216858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RevenueCat 接入 Google Play 订阅全流程详解（2025 最新）"/> <meta itemprop="keywords" content="Android,Flutter,Google"/> <meta itemprop="datePublished" content="2025-11-20T07:10:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RevenueCat 接入 Google Play 订阅全流程详解（2025 最新）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:10:15.000Z" title="Thu Nov 20 2025 07:10:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-16.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-16.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc00ada7291a4b41b7733abd66d1271d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=VEIk8W%2FcimoofjrWPgJqVMJQxnc%3D" alt="" loading="lazy"/></a></p>
<p>在移动应用的订阅变现方案中，<strong>RevenueCat</strong> 已经成为开发者最常用的后台服务之一。它帮我们解决了：</p>
<ul>
<li>Google/Apple 订阅验证</li>
<li>用户权益统一管理</li>
<li>Webhook &amp; 分析</li>
<li>价格、Offer、订阅组管理</li>
<li>跨平台（iOS + Android）统一 SDK</li>
</ul>
<p>本文将从零开始，带你完成 <strong>Google Play + RevenueCat</strong> 的完整接入流程，避免你踩坑。</p>
<h2 data-id="heading-0">一、准备工作</h2>
<p>在开始前，你需要准备以下内容：</p>
<p>项目</p>
<p>描述</p>
<p>Google Play Console 开发者账号</p>
<p>已完成注册、缴费</p>
<p>已上传至少一个 build（内部测试也行）</p>
<p>才能启用应用产品区</p>
<p>RevenueCat 账号</p>
<p>免费版即可</p>
<p>Google Cloud Platform (GCP) 账号</p>
<p>用于生成 Service Account JSON</p>
<p>App 内已准备订阅 UI</p>
<p>可后续接 RevenueCat SDK</p>
<h2 data-id="heading-1">二、在 Google Play Console 创建订阅产品</h2>
<p>注意：Google Play 必须先上传一个 APK/AAB 后，才会解锁订阅页面。</p>
<h3 data-id="heading-2">1. 进入订阅页面</h3>
<p>路径：</p>
<pre><code class="hljs language-csharp" lang="csharp">Monetize <span class="hljs-keyword">with</span> play → Products → Subscriptions
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F248462e4-54a3-4e62-a11a-9589e543a0c3.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/248462e4-54a3-4e62-a11a-9589e543a0c3.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f52ffd5a74b343f1a7aee3675f6c3841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=iBhm3DooUiF5f5NOVcIuYGZf6MI%3D" alt="" loading="lazy"/></a></p>
<p>如果你第一次使用，会看到：</p>
<blockquote>
<p>“Your app doesn’t have any subscriptions yet”</p>
</blockquote>
<p>点击 <strong>Create subscription</strong>。</p>
<h3 data-id="heading-3">2. 创建订阅产品</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-11.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-11.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fae4cfaeb44744f6bc38783692b6c04d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=BlPhxxH7w7%2FRfSMu%2FAvIWrv7V3U%3D" alt="" loading="lazy"/></a></p>
<p>推荐格式：</p>
<p>项目</p>
<p>示例</p>
<p><strong>Product ID</strong></p>
<p>linguadiary_monthly_1</p>
<p><strong>Base Plan ID</strong></p>
<p>monthly</p>
<p><strong>Duration</strong></p>
<p>P1M（一个月）</p>
<p><strong>Price</strong></p>
<p>$4.99（示例）</p>
<p>再创建一个年订阅：</p>
<p>项目</p>
<p>示例</p>
<p><strong>Product ID</strong></p>
<p>linguadiary_yearly_12</p>
<p><strong>Base Plan ID</strong></p>
<p>yearly</p>
<p><strong>Duration</strong></p>
<p>P1Y（1年）</p>
<h3 data-id="heading-4">3. 添加税务 &amp; 国家分发</h3>
<p>必要，不然订阅无法售卖。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-12.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-12.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/520d8ffb521942689efbaf671ad17671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=0YCehc6dmfj1KxM8%2B31EK%2F13OxQ%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-5">三、在 Google Cloud Platform 生成 Service Account JSON（最关键）</h2>
<p>这是 RevenueCat 用来验证 Google Play 订阅的关键文件。</p>
<h3 data-id="heading-6">1. 进入 GCP 控制台</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.google.com%2F" target="_blank" title="https://console.cloud.google.com/" ref="nofollow noopener noreferrer">console.cloud.google.com</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fb0dff8b7-23a8-405a-b3ae-0b8edf360fda.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/b0dff8b7-23a8-405a-b3ae-0b8edf360fda.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e1dbbe3df94452bac01b505926462ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=LGCVVMAnoK2vyJ7vRJaaKK3dipk%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-7">2. 确保与 Google Play 绑定同一个项目</h3>
<p>Play Console 的 <strong>API access</strong> 会告诉你当前使用的 “GCP 项目”。</p>
<p>进入同名项目即可。</p>
<h3 data-id="heading-8">3. 创建 Service Account</h3>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">IAM <span class="hljs-operator">&amp;</span> Admin → Service Accounts → <span class="hljs-keyword">Create</span> Service Account
</code></pre>
<p>填写：</p>
<ul>
<li>名称：revenuecat-play-service</li>
<li>Role（权限）：必须勾选 <strong>Service Account Admin</strong> + <strong>Pub/Sub Admin</strong></li>
</ul>
<p>👉 缺权限会导致错误：<br/>
<strong>Your Google service account credentials do not have permissions to access the Google Cloud Pub/Sub API</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fbd5c3b9f-67fc-43ce-9982-103d422cdf5c.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/bd5c3b9f-67fc-43ce-9982-103d422cdf5c.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dac0f1a0d24f4d60a00d86c7ef1e3371~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=4lZC8CO%2BQ0ws7d8jfDXAzzNYna8%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-9">4. 创建 JSON 密钥并下载</h3>
<p>在 Service Account → Keys → Add Key → <strong>JSON</strong></p>
<p>会下载一个：</p>
<pre><code class="hljs">xxxx-revenuecat.json
</code></pre>
<p>这是要上传到 RevenueCat 的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F5d72fdfa-fa15-4128-9e63-fbd4fca3db56.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/5d72fdfa-fa15-4128-9e63-fbd4fca3db56.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ad0e797fdae43fc81a82a9ef6f72f79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=nQEvijjBnJuGZpNFiNg%2BCJKce8k%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-10">四、在 Google Play Console 授权这个 Service Account</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fb2262bc3-2b1b-4e24-9930-f89a83a0ef69.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/b2262bc3-2b1b-4e24-9930-f89a83a0ef69.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/941ad2bfff054eeeb8d069cb7201b18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=wmhRnBL0u8muGYmVqwAEHzzpEy8%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-11">五、在 RevenueCat 绑定 Google Play</h2>
<p>进入：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-13.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-13.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5ed67bbbfa4f2184e04a9e4c0fde04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=3rxJt4NFI2%2B5u8p13rcogfBfgy4%3D" alt="" loading="lazy"/></a></p>
<pre><code class="hljs">RevenueCat → Projects → Apps → （你的 Android App）
</code></pre>
<p>选择：</p>
<h4 data-id="heading-12">1. Add Store → Google Play</h4>
<p>上传你刚才下载的 JSON。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fe2213ad5-6ea8-4e64-8459-07beceff83fa.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/e2213ad5-6ea8-4e64-8459-07beceff83fa.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cca80b67ccc465db014919644bcb424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=moMYgiSxQdigNV88786c8r%2Blt2A%3D" alt="" loading="lazy"/></a></p>
<h4 data-id="heading-13">2. 在 RevenueCat 创建产品</h4>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">Products → <span class="hljs-keyword">New</span> Product
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F80912ef5-a22a-4192-b44c-9cd5165ca4d6.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/80912ef5-a22a-4192-b44c-9cd5165ca4d6.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce8e4fa051c24ee4a034ecacee4b6b81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=xaLuQbNWJNxkHFXJSaN2F6%2FommI%3D" alt="" loading="lazy"/></a></p>
<p>填写：</p>
<ul>
<li>Product ID（必须与 Google Play 完全一致）</li>
<li>Offering（可添加 default）</li>
</ul>
<p>RevenueCat 会自动同步 Google Play 价格、时长、Offer。</p>
<h2 data-id="heading-14">六、在 App 内实现 RevenueCat SDK（Flutter 示例）</h2>
<pre><code class="hljs language-ini" lang="ini">import 'package:purchases_flutter/purchases_flutter.dart'<span class="hljs-comment">;</span>

void main() async {
  await Purchases.configure(PurchasesConfiguration(
    "public_sdk_key_google",
  ))<span class="hljs-comment">;</span>
}

// 获取订阅产品
final <span class="hljs-attr">offerings</span> = await Purchases.get<span class="hljs-literal">Off</span>erings()<span class="hljs-comment">;</span>
final <span class="hljs-attr">package</span> = <span class="hljs-literal">off</span>erings.current?.availablePackages.first<span class="hljs-comment">;</span>

// 购买
await Purchases.purchasePackage(package)<span class="hljs-comment">;</span>

// 查询是否是 Pro
final <span class="hljs-attr">info</span> = await Purchases.getCustomerInfo()<span class="hljs-comment">;</span>
final <span class="hljs-attr">isPro</span> = info.entitlements.all[<span class="hljs-string">"pro"</span>]?.isActive ?? <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-15">七、常见问题（踩坑大全）</h2>
<h3 data-id="heading-16">1. RevenueCat 报错：CONFIGURATION_ERROR</h3>
<p>原因：</p>
<ul>
<li>Google Play 本地化语言没填</li>
<li>Base Plan 没启用</li>
<li>未发布</li>
<li>Service Account 权限不够</li>
<li>Google Play 未启用 API access 授权</li>
<li>Google Cloud Pub/Sub 未开</li>
</ul>
<h3 data-id="heading-17">2. 看到 These products are not found</h3>
<p>原因：</p>
<ul>
<li>Product ID 不一致（大小写不一致都不行）</li>
<li>Google Play 未发布（Draft 状态）</li>
<li>未勾选国家/地区</li>
<li>Base Plan 没启用（must be Active）</li>
</ul>
<p>所有东西都准备好了，结果还是查不出来产品，一定进去这个菜单开启bill</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-14.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-14.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37d2ebc013ab42ed8165437eee565a90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=70XCAIj8EpfZGkJiJT%2F4H6ouotA%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-18">3. SDK 一直加载不到 Offerings</h3>
<p>原因：</p>
<ul>
<li>RevenueCat 未成功读取 Google Play</li>
<li>服务账号 JSON 权限不足</li>
<li>App 没有开网络</li>
</ul>
<h2 data-id="heading-19">八、测试订阅（免费）</h2>
<ol>
<li>在 Google Play → License Testing 添加 Gmail 测试账户</li>
<li>删掉 app</li>
<li>登录测试 Gmail</li>
<li>从 Closed Testing 下载你 app</li>
<li>购买会显示价格 0 或 $0.01</li>
</ol>
<h2 data-id="heading-20">九、发布正式版本</h2>
<p>当订阅正常工作 →<br/>
发布 app →<br/>
RevenueCat 负责自动验证所有付款 →<br/>
你只专注展示订阅 UI 和权益即可。</p>
<h2 data-id="heading-21">结语</h2>
<p>接入 Google Play 的订阅最容易踩坑在：</p>
<ul>
<li>API access 权限不完整</li>
<li>Service Account JSON 权限缺失</li>
<li>Google Play 本地化没填</li>
<li>Base plan 未激活</li>
<li>RevenueCat 未正确绑定应用</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 高级特性详解]]></title>    <link>https://juejin.cn/post/7574530224852713478</link>    <guid>https://juejin.cn/post/7574530224852713478</guid>    <pubDate>2025-11-20T06:44:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574530224852713478" data-draft-id="7574530224852697094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 高级特性详解"/> <meta itemprop="keywords" content="前端,TypeScript"/> <meta itemprop="datePublished" content="2025-11-20T06:44:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小前端_我自坚强"/> <meta itemprop="url" content="https://juejin.cn/user/2335811609826423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 高级特性详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2335811609826423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小前端_我自坚强
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:44:25.000Z" title="Thu Nov 20 2025 06:44:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 高级特性详解</h2>
<h3 data-id="heading-1">引言</h3>
<p>TypeScript 是 JavaScript 的超集，为 JavaScript 添加了静态类型检查和面向对象编程的能力。随着前端应用日益复杂，TypeScript 的高级特性变得越来越重要。本文将深入探讨 TypeScript 的几个核心高级特性，帮助开发者更好地理解和运用这些强大功能。</p>
<h3 data-id="heading-2">一、泛型编程(Generic Programming)</h3>
<h4 data-id="heading-3">1.1 泛型基础概念</h4>
<p>泛型(Generic)是 TypeScript 中最强大的特性之一，它允许我们创建可重用的组件，这些组件可以处理不同类型的数据而不丢失类型安全性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基础泛型函数</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
    <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-comment">// 使用泛型函数</span>
<span class="hljs-keyword">let</span> output1 = identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"myString"</span>);
<span class="hljs-keyword">let</span> output2 = identity&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">42</span>);
<span class="hljs-keyword">let</span> output3 = <span class="hljs-title function_">identity</span>(<span class="hljs-string">"myString"</span>); <span class="hljs-comment">// 类型推断</span>
</code></pre>
<h4 data-id="heading-4">1.2 泛型约束</h4>
<p>有时候我们需要对泛型参数施加一定的约束，确保传入的类型具有某些特定的属性或方法。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义约束接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> {
    <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 使用 extends 关键字添加约束</span>
<span class="hljs-keyword">function</span> loggingIdentity&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arg.<span class="hljs-property">length</span>); <span class="hljs-comment">// 现在我们知道它有 .length 属性</span>
    <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-title function_">loggingIdentity</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// 正确，字符串有 length 属性</span>
<span class="hljs-title function_">loggingIdentity</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// 正确，数组有 length 属性</span>
<span class="hljs-comment">// loggingIdentity(3); // 错误，数字没有 length 属性</span>
</code></pre>
<h4 data-id="heading-5">1.3 泛型类</h4>
<p>泛型也可以应用于类，使类能够处理多种类型的值。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericNumber</span>&lt;T&gt; {
    <span class="hljs-attr">zeroValue</span>: T;
    <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">x: T, y: T</span>) =&gt;</span> T;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">zeroValue: T, addFn: (x: T, y: T) =&gt; T</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">zeroValue</span> = zeroValue;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">add</span> = addFn;
    }
}

<span class="hljs-keyword">let</span> myGenericNumber = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>, <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myGenericNumber.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)); <span class="hljs-comment">// 15</span>

<span class="hljs-keyword">let</span> stringNumeric = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">""</span>, <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stringNumeric.<span class="hljs-title function_">add</span>(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>)); <span class="hljs-comment">// "helloworld"</span>
</code></pre>
<h4 data-id="heading-6">1.4 泛型接口</h4>
<p>泛型接口可以描述那些跨越多种类型的通用调用签名。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">GenericIdentityFn</span>&lt;T&gt; {
    (<span class="hljs-attr">arg</span>: T): T;
}

<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
    <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">myIdentity</span>: <span class="hljs-title class_">GenericIdentityFn</span>&lt;<span class="hljs-built_in">number</span>&gt; = identity;
</code></pre>
<h4 data-id="heading-7">1.5 多个泛型参数</h4>
<p>函数和类可以接受多个泛型参数，提供更多灵活性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> swap&lt;T, U&gt;(<span class="hljs-attr">tuple</span>: [T, U]): [U, T] {
    <span class="hljs-keyword">return</span> [tuple[<span class="hljs-number">1</span>], tuple[<span class="hljs-number">0</span>]];
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">swap</span>([<span class="hljs-string">"hello"</span>, <span class="hljs-number">123</span>])); <span class="hljs-comment">// [123, "hello"]</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyValuePair</span>&lt;<span class="hljs-title class_">TKey</span>, <span class="hljs-title class_">TValue</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">key</span>: <span class="hljs-title class_">TKey</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">TValue</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key: TKey, value: TValue</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
    
    <span class="hljs-title function_">getKey</span>(): <span class="hljs-title class_">TKey</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>;
    }
    
    <span class="hljs-title function_">getValue</span>(): <span class="hljs-title class_">TValue</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
    }
}
</code></pre>
<h4 data-id="heading-8">1.6 泛型参数默认值</h4>
<p>TypeScript 允许为泛型参数指定默认类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultGeneric</span>&lt;T = <span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: T;
    
    <span class="hljs-title function_">setValue</span>(<span class="hljs-params">value: T</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
    
    <span class="hljs-title function_">getValue</span>(): T {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
    }
}

<span class="hljs-keyword">let</span> defaultGeneric = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultGeneric</span>(); <span class="hljs-comment">// T 默认为 string</span>
<span class="hljs-keyword">let</span> explicitGeneric = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultGeneric</span>&lt;<span class="hljs-built_in">number</span>&gt;(); <span class="hljs-comment">// 显式指定 T 为 number</span>
</code></pre>
<h4 data-id="heading-9">1.7 泛型条件约束</h4>
<p>结合条件类型，我们可以创建更加灵活的泛型约束。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 只有当 T 是 string 或 number 时才允许</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringOrNumberOnly</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> ? T : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">function</span> processValue&lt;T&gt;(<span class="hljs-attr">value</span>: <span class="hljs-title class_">StringOrNumberOnly</span>&lt;T&gt;): <span class="hljs-title class_">StringOrNumberOnly</span>&lt;T&gt; {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-title function_">processValue</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// OK</span>
<span class="hljs-title function_">processValue</span>(<span class="hljs-number">42</span>); <span class="hljs-comment">// OK</span>
<span class="hljs-comment">// processValue(true); // Error: Type 'boolean' does not satisfy the constraint 'never'</span>
</code></pre>
<h3 data-id="heading-10">二、条件类型和映射类型</h3>
<h4 data-id="heading-11">2.1 条件类型基础</h4>
<p>条件类型允许我们在类型层面进行条件判断，这是 TypeScript 类型系统的强大功能。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基本条件类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// true</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 更实用的例子</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MessageOf</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">message</span>: <span class="hljs-built_in">unknown</span> } ? T[<span class="hljs-string">'message'</span>] : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Email</span> {
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">EmailMessageContents</span> = <span class="hljs-title class_">MessageOf</span>&lt;<span class="hljs-title class_">Email</span>&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DogMessageContents</span> = <span class="hljs-title class_">MessageOf</span>&lt;<span class="hljs-title class_">Dog</span>&gt;; <span class="hljs-comment">// never</span>
</code></pre>
<h4 data-id="heading-12">2.2 分配条件类型</h4>
<p>当条件类型的检查类型是裸类型参数(naked type parameter)时，它会在联合类型上进行分配。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ToArray</span>&lt;<span class="hljs-title class_">Type</span>&gt; = <span class="hljs-title class_">Type</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-title class_">Type</span>[] : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">StrArrOrNumArr</span> = <span class="hljs-title class_">ToArray</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// string[] | number[]</span>

<span class="hljs-comment">// 如果想阻止这种行为，可以用方括号包裹类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ToArrayNonDist</span>&lt;<span class="hljs-title class_">Type</span>&gt; = [<span class="hljs-title class_">Type</span>] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">any</span>] ? <span class="hljs-title class_">Type</span>[] : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">StrArrOrNumArr2</span> = <span class="hljs-title class_">ToArrayNonDist</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// (string | number)[]</span>
</code></pre>
<h4 data-id="heading-13">2.3 infer 关键字</h4>
<p>infer 关键字允许我们在条件类型中推断类型变量。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 推断函数返回类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Func</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Func</span>&gt;; <span class="hljs-comment">// number</span>

<span class="hljs-comment">// 推断数组元素类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ElementType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer U)[] ? U : T;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Arr</span> = <span class="hljs-title class_">ElementType</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NotArr</span> = <span class="hljs-title class_">ElementType</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// string</span>

<span class="hljs-comment">// 推断 Promise 的值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? U : T;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseValue</span> = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string</span>
</code></pre>
<h4 data-id="heading-14">2.4 预定义的条件类型</h4>
<p>TypeScript 内置了一些有用的条件类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Exclude&lt;UnionType, ExcludedMembers&gt; - 从联合类型中排除某些成员</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T0</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span>, <span class="hljs-string">"a"</span>&gt;; <span class="hljs-comment">// "b" | "c"</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T1</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span>, <span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span>&gt;; <span class="hljs-comment">// "c"</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T2</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>), <span class="hljs-title class_">Function</span>&gt;; <span class="hljs-comment">// string | number</span>

<span class="hljs-comment">// Extract&lt;Type, Union&gt; - 从联合类型中提取某些成员</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T3</span> = <span class="hljs-title class_">Extract</span>&lt;<span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span>, <span class="hljs-string">"a"</span> | <span class="hljs-string">"f"</span>&gt;; <span class="hljs-comment">// "a"</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T4</span> = <span class="hljs-title class_">Extract</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>, <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number | boolean</span>

<span class="hljs-comment">// NonNullable&lt;Type&gt; - 从类型中排除 null 和 undefined</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T5</span> = <span class="hljs-title class_">NonNullable</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>&gt;; <span class="hljs-comment">// string | number</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T6</span> = <span class="hljs-title class_">NonNullable</span>&lt;<span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>&gt;; <span class="hljs-comment">// string[]</span>

<span class="hljs-comment">// Parameters&lt;Type&gt; - 获取函数参数类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T7</span> = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// []</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T8</span> = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-function">(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// [string]</span>

<span class="hljs-comment">// ConstructorParameters&lt;Type&gt; - 获取构造函数参数类型</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">public</span> age: <span class="hljs-built_in">number</span></span>) {}
}

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T9</span> = <span class="hljs-title class_">ConstructorParameters</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Person</span>&gt;; <span class="hljs-comment">// [string, number]</span>

<span class="hljs-comment">// InstanceType&lt;Type&gt; - 获取构造函数实例类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T10</span> = <span class="hljs-title class_">InstanceType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Person</span>&gt;; <span class="hljs-comment">// Person</span>

<span class="hljs-comment">// Required&lt;Type&gt; - 将所有属性设为必需</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
    a?: <span class="hljs-built_in">number</span>;
    b?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T11</span> = <span class="hljs-title class_">Required</span>&lt;<span class="hljs-title class_">Props</span>&gt;; <span class="hljs-comment">// { a: number; b: string; }</span>

<span class="hljs-comment">// Partial&lt;Type&gt; - 将所有属性设为可选</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T12</span> = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Props</span>&gt;; <span class="hljs-comment">// { a?: number; b?: string; }</span>

<span class="hljs-comment">// Readonly&lt;Type&gt; - 将所有属性设为只读</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T13</span> = <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Props</span>&gt;; <span class="hljs-comment">// { readonly a?: number; readonly b?: string; }</span>

<span class="hljs-comment">// Pick&lt;Type, Keys&gt; - 从类型中选择特定属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T14</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">Props</span>, <span class="hljs-string">"a"</span>&gt;; <span class="hljs-comment">// { a?: number; }</span>

<span class="hljs-comment">// Omit&lt;Type, Keys&gt; - 从类型中省略特定属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T15</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">Props</span>, <span class="hljs-string">"a"</span>&gt;; <span class="hljs-comment">// { b?: string; }</span>

<span class="hljs-comment">// Record&lt;Keys, Type&gt; - 创建属性为 Keys，值为 Type 的对象类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T16</span> = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-string">'x'</span> | <span class="hljs-string">'y'</span>, <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// { x: number; y: number; }</span>
</code></pre>
<h4 data-id="heading-15">2.5 映射类型</h4>
<p>映射类型是一种从旧类型创建新类型的泛型类型，它使用 PropertyKey 的联合来遍历键以创建类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基本映射类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OptionsFlags</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span>]: <span class="hljs-built_in">boolean</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">FeatureFlags</span> = {
    <span class="hljs-attr">darkMode</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">newUserProfile</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">FeatureOptions</span> = <span class="hljs-title class_">OptionsFlags</span>&lt;<span class="hljs-title class_">FeatureFlags</span>&gt;;
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   darkMode: boolean;</span>
<span class="hljs-comment">//   newUserProfile: boolean;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 使用 readonly 和 ? 修饰符</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CreateMutable</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    -<span class="hljs-keyword">readonly</span> [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span>]: <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">LockedAccount</span> = {
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnlockedAccount</span> = <span class="hljs-title class_">CreateMutable</span>&lt;<span class="hljs-title class_">LockedAccount</span>&gt;;
<span class="hljs-comment">// { id: string; name: string; }</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Concrete</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span>]-?: <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">MaybeUser</span> = {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
    name?: <span class="hljs-built_in">string</span>;
    age?: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = <span class="hljs-title class_">Concrete</span>&lt;<span class="hljs-title class_">MaybeUser</span>&gt;;
<span class="hljs-comment">// { id: string; name: string; age: number; }</span>
</code></pre>
<h4 data-id="heading-16">2.6 Key Remapping via as</h4>
<p>TypeScript 4.1 引入了 key remapping，允许我们在映射类型中转换键名：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Getters</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`get<span class="hljs-subst">${Capitalize&lt;<span class="hljs-built_in">string</span> &amp; Property&gt;}</span>`</span>]: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>]
};

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">location</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">LazyPerson</span> = <span class="hljs-title class_">Getters</span>&lt;<span class="hljs-title class_">Person</span>&gt;;
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   getName: () =&gt; string;</span>
<span class="hljs-comment">//   getAge: () =&gt; number;</span>
<span class="hljs-comment">//   getLocation: () =&gt; string;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 通过模板字面量类型过滤键</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">RemoveKindField</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-title class_">Property</span>, <span class="hljs-string">"kind"</span>&gt;]: <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>]
};

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"circle"</span>;
    <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">KindlessCircle</span> = <span class="hljs-title class_">RemoveKindField</span>&lt;<span class="hljs-title class_">Circle</span>&gt;;
<span class="hljs-comment">// { radius: number; }</span>
</code></pre>
<h4 data-id="heading-17">2.7 深层映射类型</h4>
<p>创建深层映射类型来处理嵌套对象：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 深度 Partial</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepPartial</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepPartial</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">NestedObject</span> = {
    <span class="hljs-attr">a</span>: {
        <span class="hljs-attr">b</span>: {
            <span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span>;
        };
        <span class="hljs-attr">d</span>: <span class="hljs-built_in">string</span>;
    };
    <span class="hljs-attr">e</span>: <span class="hljs-built_in">boolean</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PartialNested</span> = <span class="hljs-title class_">DeepPartial</span>&lt;<span class="hljs-title class_">NestedObject</span>&gt;;
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   a?: {</span>
<span class="hljs-comment">//     b?: {</span>
<span class="hljs-comment">//       c?: number;</span>
<span class="hljs-comment">//     };</span>
<span class="hljs-comment">//     d?: string;</span>
<span class="hljs-comment">//   };</span>
<span class="hljs-comment">//   e?: boolean;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 深度 Required</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepRequired</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]-?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepRequired</span>&lt;T[P]&gt; : T[P];
};
</code></pre>
<h3 data-id="heading-18">三、装饰器模式(Decorator Pattern)</h3>
<h4 data-id="heading-19">3.1 装饰器基础</h4>
<p>装饰器是一种特殊类型的声明，可以被附加到类声明、方法、访问符、属性或参数上。装饰器使用 @expression 形式，expression 求值后必须为一个函数，它会在运行时被调用。</p>
<p>注意：装饰器目前还是实验性特性，需要在 tsconfig.json 中启用：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"experimentalDecorators"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"emitDecoratorMetadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-20">3.2 类装饰器</h4>
<p>类装饰器应用于类构造函数，可以用来监视、修改或替换类定义。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 类装饰器函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sealed</span>(<span class="hljs-params">constructor: <span class="hljs-built_in">Function</span></span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>(constructor);
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>(constructor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
}

<span class="hljs-meta">@sealed</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter</span> {
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
    
    <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span>;
    }
}

<span class="hljs-comment">// 替换类构造函数的装饰器</span>
<span class="hljs-keyword">function</span> classDecorator&lt;T <span class="hljs-keyword">extends</span> {<span class="hljs-title function_">new</span>(...<span class="hljs-attr">args</span>:<span class="hljs-built_in">any</span>[]):{}}&gt;(<span class="hljs-attr">constructor</span>:T) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> constructor {
        newProperty = <span class="hljs-string">"new property"</span>;
        hello = <span class="hljs-string">"override"</span>;
    }
}

<span class="hljs-meta">@classDecorator</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter2</span> {
    property = <span class="hljs-string">"property"</span>;
    <span class="hljs-attr">hello</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">m: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hello</span> = m;
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Greeter2</span>(<span class="hljs-string">"world"</span>));
</code></pre>
<h4 data-id="heading-21">3.3 方法装饰器</h4>
<p>方法装饰器应用于方法的属性描述符，可以用来监视、修改或替换方法定义。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">enumerable</span>(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        descriptor.<span class="hljs-property">enumerable</span> = value;
    };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter3</span> {
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
    
    <span class="hljs-meta">@enumerable</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span>;
    }
}
</code></pre>
<h4 data-id="heading-22">3.4 访问器装饰器</h4>
<p>访问器装饰器应用于访问器的属性描述符，可以用来监视、修改或替换访问器的定义。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">configurable</span>(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        descriptor.<span class="hljs-property">configurable</span> = value;
    };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">_x</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-attr">_y</span>: <span class="hljs-built_in">number</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_x</span> = x;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_y</span> = y;
    }
    
    <span class="hljs-meta">@configurable</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">x</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_x</span>; }
    
    <span class="hljs-meta">@configurable</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">y</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_y</span>; }
}
</code></pre>
<h4 data-id="heading-23">3.5 属性装饰器</h4>
<p>属性装饰器应用于类的属性声明，不能用来改变一个属性的声明或实现，但可以用来监视一个属性在类中的访问。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">formatString: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-comment">// 存储格式信息，可以在其他地方使用</span>
        <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
        
        <span class="hljs-keyword">const</span> <span class="hljs-attr">descriptor</span>: <span class="hljs-title class_">PropertyDescriptor</span> = {
            <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                <span class="hljs-keyword">return</span> value;
            },
            <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">newVal</span>) {
                value = formatString.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'{0}'</span>, newVal);
            },
            <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
        };
        
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyKey, descriptor);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter4</span> {
    <span class="hljs-meta">@format</span>(<span class="hljs-string">"Hello, {0}"</span>)
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
}

<span class="hljs-keyword">const</span> greeter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Greeter4</span>(<span class="hljs-string">"World"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeter.<span class="hljs-property">greeting</span>); <span class="hljs-comment">// "Hello, World"</span>
</code></pre>
<h4 data-id="heading-24">3.6 参数装饰器</h4>
<p>参数装饰器应用于类构造函数或方法的参数，参数装饰器只能用来监视一个方法的参数是否被传入。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">required</span>(<span class="hljs-params">target: <span class="hljs-built_in">Object</span>, propertyKey: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">symbol</span>, parameterIndex: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-comment">// 可以记录哪些参数是必需的</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Parameter <span class="hljs-subst">${parameterIndex}</span> is required for method <span class="hljs-subst">${propertyKey.toString()}</span>`</span>);
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter5</span> {
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
    
    <span class="hljs-title function_">greet</span>(<span class="hljs-params"><span class="hljs-meta">@required</span> name: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello "</span> + name + <span class="hljs-string">", "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span>;
    }
}
</code></pre>
<h4 data-id="heading-25">3.7 装饰器工厂</h4>
<p>装饰器工厂是可以传参的装饰器，返回一个装饰器函数。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">level: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyName: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        <span class="hljs-keyword">const</span> method = descriptor.<span class="hljs-property">value</span>;
        
        descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${level}</span>] Calling <span class="hljs-subst">${propertyName}</span> with`</span>, args);
            <span class="hljs-keyword">const</span> result = method.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${level}</span>] Method <span class="hljs-subst">${propertyName}</span> returned`</span>, result);
            <span class="hljs-keyword">return</span> result;
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-meta">@log</span>(<span class="hljs-string">'DEBUG'</span>)
    <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">return</span> a + b;
    }
    
    <span class="hljs-meta">@log</span>(<span class="hljs-string">'INFO'</span>)
    <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">return</span> a * b;
    }
}

<span class="hljs-keyword">const</span> calc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();
calc.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [DEBUG] Calling add with [2, 3]</span>
                <span class="hljs-comment">// [DEBUG] Method add returned 5</span>
</code></pre>
<h4 data-id="heading-26">3.8 复合装饰器</h4>
<p>多个装饰器可以应用在一个声明上，它们会按照特定顺序求值和应用。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">first</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"first(): factory evaluated"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"first(): called"</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">second</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"second(): factory evaluated"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"second(): called"</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-meta">@first</span>()
    <span class="hljs-meta">@second</span>()
    <span class="hljs-title function_">method</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-comment">// 输出顺序：</span>
<span class="hljs-comment">// first(): factory evaluated</span>
<span class="hljs-comment">// second(): factory evaluated</span>
<span class="hljs-comment">// second(): called</span>
<span class="hljs-comment">// first(): called</span>
</code></pre>
<h3 data-id="heading-27">四、模块声明和类型增强</h3>
<h4 data-id="heading-28">4.1 模块声明基础</h4>
<p>TypeScript 允许你为现有的 JavaScript 库编写声明文件，以便在 TypeScript 项目中获得类型安全。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 声明全局变量</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">var</span> <span class="hljs-attr">$</span>: <span class="hljs-title class_">JQueryStatic</span>;

<span class="hljs-comment">// 声明全局函数</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;

<span class="hljs-comment">// 声明全局对象</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">MyApp</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> {
        <span class="hljs-attr">apiUrl</span>: <span class="hljs-built_in">string</span>;
        <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>;
    }
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">config: Config</span>): <span class="hljs-built_in">void</span>;
}
</code></pre>
<h4 data-id="heading-29">4.2 模块声明</h4>
<p>当你需要为外部库提供类型信息时，可以创建声明文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// myLibrary.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"myLibrary"</span> {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> {
        timeout?: <span class="hljs-built_in">number</span>;
        retries?: <span class="hljs-built_in">number</span>;
    }
    
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, options?: Options</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cancel</span>(<span class="hljs-params">token: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">import</span> { request, <span class="hljs-title class_">Options</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"myLibrary"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">Options</span> = {
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">retries</span>: <span class="hljs-number">3</span>
};

<span class="hljs-title function_">request</span>(<span class="hljs-string">"https://api.example.com/data"</span>, options);
</code></pre>
<h4 data-id="heading-30">4.3 通配符模块声明</h4>
<p>当你需要为一组模块提供声明时，可以使用通配符：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 为所有 .css 文件提供声明</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.css"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">content</span>: { [<span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> };
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> content;
}

<span class="hljs-comment">// 为所有图片文件提供声明</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.png"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> value;
}

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.jpg"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> value;
}

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.svg"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> value;
}
</code></pre>
<h4 data-id="heading-31">4.4 类型增强(Augmenting)</h4>
<p>TypeScript 允许你扩展现有类型，添加新的属性或方法。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 扩展全局 Window 接口</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> {
        <span class="hljs-attr">myCustomProperty</span>: <span class="hljs-built_in">string</span>;
        <span class="hljs-title function_">myCustomFunction</span>(): <span class="hljs-built_in">void</span>;
    }
}

<span class="hljs-comment">// 扩展已有接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Array</span>&lt;T&gt; {
    groupBy&lt;U&gt;(<span class="hljs-attr">keySelector</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> U): <span class="hljs-title class_">Map</span>&lt;U, T[]&gt;;
}

<span class="hljs-comment">// 实现扩展的方法</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">groupBy</span> = <span class="hljs-keyword">function</span>&lt;T, U&gt;(<span class="hljs-attr">keySelector</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> U): <span class="hljs-title class_">Map</span>&lt;U, T[]&gt; {
    <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;U, T[]&gt;();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> key = <span class="hljs-title function_">keySelector</span>(item);
        <span class="hljs-keyword">const</span> collection = map.<span class="hljs-title function_">get</span>(key);
        <span class="hljs-keyword">if</span> (!collection) {
            map.<span class="hljs-title function_">set</span>(key, [item]);
        } <span class="hljs-keyword">else</span> {
            collection.<span class="hljs-title function_">push</span>(item);
        }
    });
    <span class="hljs-keyword">return</span> map;
};
</code></pre>
<h4 data-id="heading-32">4.5 模块增强(Module Augmentation)</h4>
<p>你可以扩展现有模块的类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// observable.d.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Observable</span>&lt;T&gt; {
    <span class="hljs-title function_">subscribe</span>(<span class="hljs-attr">observer</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 扩展 Observable 模块</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./observable"</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"./observable"</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observable</span>&lt;T&gt; {
        map&lt;R&gt;(<span class="hljs-attr">project</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> R): <span class="hljs-title class_">Observable</span>&lt;R&gt;;
        <span class="hljs-title function_">filter</span>(<span class="hljs-attr">predicate</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Observable</span>&lt;T&gt;;
    }
}

<span class="hljs-comment">// 实现扩展的方法</span>
<span class="hljs-title class_">Observable</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">project</span>) {
    <span class="hljs-comment">// 实现 map 方法</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observable</span>(<span class="hljs-comment">/* ... */</span>);
};

<span class="hljs-title class_">Observable</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">filter</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">predicate</span>) {
    <span class="hljs-comment">// 实现 filter 方法</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observable</span>(<span class="hljs-comment">/* ... */</span>);
};
</code></pre>
<h4 data-id="heading-33">4.6 声明合并(Declaration Merging)</h4>
<p>TypeScript 允许将多个同名声明合并为一个声明：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 接口合并</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Box</span> {
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Box</span> {
    <span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">box</span>: <span class="hljs-title class_">Box</span> = {<span class="hljs-attr">height</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">scale</span>: <span class="hljs-number">10</span>};

<span class="hljs-comment">// 命名空间合并</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Animals</span> {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Zebra</span> { }
}

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Animals</span> {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Legged</span> { <span class="hljs-attr">numberOfLegs</span>: <span class="hljs-built_in">number</span>; }
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> { }
}

<span class="hljs-comment">// 合并后的 Animals 包含 Zebra, Legged, Dog</span>
</code></pre>
<h3 data-id="heading-34">五、类型推导和类型守卫</h3>
<h4 data-id="heading-35">5.1 类型推导基础</h4>
<p>TypeScript 编译器会根据赋值表达式和其他上下文自动推断类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基础类型推导</span>
<span class="hljs-keyword">let</span> x = <span class="hljs-number">3</span>; <span class="hljs-comment">// 推导为 number</span>
<span class="hljs-keyword">let</span> y = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">null</span>]; <span class="hljs-comment">// 推导为 (number | null)[]</span>

<span class="hljs-comment">// 最佳通用类型</span>
<span class="hljs-keyword">let</span> zoo = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rhino</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Elephant</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Snake</span>()];
<span class="hljs-comment">// 推导为 (Rhino | Elephant | Snake)[]</span>

<span class="hljs-comment">// 上下文类型推导</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onmousedown</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">mouseEvent</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mouseEvent.<span class="hljs-property">button</span>); <span class="hljs-comment">// 正确，推导为 MouseEvent</span>
    <span class="hljs-comment">// console.log(mouseEvent.foo); // 错误，MouseEvent 没有 foo 属性</span>
};
</code></pre>
<h4 data-id="heading-36">5.2 控制流类型分析</h4>
<p>TypeScript 3.7 引入了更精确的控制流类型分析：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">x: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">"string"</span>) {
        x; <span class="hljs-comment">// 推导为 string</span>
        x.<span class="hljs-title function_">toUpperCase</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">"number"</span>) {
        x; <span class="hljs-comment">// 推导为 number</span>
        x.<span class="hljs-title function_">toFixed</span>();
    } <span class="hljs-keyword">else</span> {
        x; <span class="hljs-comment">// 推导为 boolean</span>
        x.<span class="hljs-title function_">valueOf</span>();
    }
}

<span class="hljs-comment">// 数组类型守卫</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isStringArray</span>(<span class="hljs-params">arr: <span class="hljs-built_in">unknown</span>[]</span>): arr is <span class="hljs-built_in">string</span>[] {
    <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"string"</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processArray</span>(<span class="hljs-params">arr: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isStringArray</span>(arr)) {
        arr; <span class="hljs-comment">// 推导为 string[]</span>
        arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">toUpperCase</span>());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 处理混合数组</span>
    }
}
</code></pre>
<h4 data-id="heading-37">5.3 类型守卫(Type Guards)</h4>
<p>类型守卫是一些表达式，它们在运行时检查以确保在某个作用域内的类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// typeof 类型守卫</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params">value: <span class="hljs-built_in">string</span>, padding: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">"number"</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">" "</span>.<span class="hljs-title function_">repeat</span>(padding) + value;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">"string"</span>) {
        <span class="hljs-keyword">return</span> padding + value;
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Expected string or number, got '<span class="hljs-subst">${padding}</span>'.`</span>);
}

<span class="hljs-comment">// instanceof 类型守卫</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> {
    <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {}
    <span class="hljs-title function_">layEggs</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span> {
    <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {}
    <span class="hljs-title function_">layEggs</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">animal: Bird | Fish</span>) {
    <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Bird</span>) {
        animal.<span class="hljs-title function_">fly</span>();
    } <span class="hljs-keyword">else</span> {
        animal.<span class="hljs-title function_">swim</span>();
    }
}

<span class="hljs-comment">// in 操作符类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Car</span> {
    <span class="hljs-attr">engine</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Bicycle</span> {
    <span class="hljs-attr">pedals</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">inspectVehicle</span>(<span class="hljs-params">vehicle: Car | Bicycle</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"engine"</span> <span class="hljs-keyword">in</span> vehicle) {
        vehicle; <span class="hljs-comment">// 推导为 Car</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vehicle.<span class="hljs-property">engine</span>);
    } <span class="hljs-keyword">else</span> {
        vehicle; <span class="hljs-comment">// 推导为 Bicycle</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vehicle.<span class="hljs-property">pedals</span>);
    }
}
</code></pre>
<h4 data-id="heading-38">5.4 自定义类型守卫</h4>
<p>你可以创建自己的类型守卫函数来细化类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 用户定义的类型守卫</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isFish</span>(<span class="hljs-params">pet: Fish | Bird</span>): pet is <span class="hljs-title class_">Fish</span> {
    <span class="hljs-keyword">return</span> (pet <span class="hljs-keyword">as</span> <span class="hljs-title class_">Fish</span>).<span class="hljs-property">swim</span> !== <span class="hljs-literal">undefined</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSmallPet</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Fish</span> | <span class="hljs-title class_">Bird</span> {
    <span class="hljs-comment">// 返回 Fish 或 Bird 的实现</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fish</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>();
}

<span class="hljs-keyword">let</span> pet = <span class="hljs-title function_">getSmallPet</span>();

<span class="hljs-keyword">if</span> (<span class="hljs-title function_">isFish</span>(pet)) {
    pet.<span class="hljs-title function_">swim</span>();
} <span class="hljs-keyword">else</span> {
    pet.<span class="hljs-title function_">fly</span>();
}

<span class="hljs-comment">// 更复杂的类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">privileges</span>: <span class="hljs-built_in">string</span>[];
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">startDate</span>: <span class="hljs-title class_">Date</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnknownEmployee</span> = <span class="hljs-title class_">Employee</span> | <span class="hljs-title class_">Admin</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isAdmin</span>(<span class="hljs-params">employee: UnknownEmployee</span>): employee is <span class="hljs-title class_">Admin</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"privileges"</span> <span class="hljs-keyword">in</span> employee;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">printEmployeeInformation</span>(<span class="hljs-params">emp: UnknownEmployee</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Name: "</span> + emp.<span class="hljs-property">name</span>);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isAdmin</span>(emp)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Privileges: "</span> + emp.<span class="hljs-property">privileges</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">", "</span>));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Start Date: "</span> + emp.<span class="hljs-property">startDate</span>);
    }
}
</code></pre>
<h4 data-id="heading-39">5.5 可辨识联合(Discriminated Unions)</h4>
<p>通过共同的可辨识字段来区分不同类型的联合类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Square</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"square"</span>;
    <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rectangle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"rectangle"</span>;
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"circle"</span>;
    <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <span class="hljs-title class_">Square</span> | <span class="hljs-title class_">Rectangle</span> | <span class="hljs-title class_">Circle</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">s: Shape</span>) {
    <span class="hljs-keyword">switch</span> (s.<span class="hljs-property">kind</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"square"</span>:
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">size</span> * s.<span class="hljs-property">size</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"rectangle"</span>:
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">width</span> * s.<span class="hljs-property">height</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"circle"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * s.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>;
        <span class="hljs-attr">default</span>:
            <span class="hljs-comment">// 穷尽性检查</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = s;
            <span class="hljs-keyword">return</span> _exhaustiveCheck;
    }
}

<span class="hljs-comment">// 添加新形状时，编译器会报错，提醒你处理新情况</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Triangle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"triangle"</span>;
    <span class="hljs-attr">base</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// type Shape = Square | Rectangle | Circle | Triangle;</span>
<span class="hljs-comment">// 上述代码会导致编译错误，因为 area 函数没有处理 triangle 情况</span>
</code></pre>
<h4 data-id="heading-40">5.6 类型谓词(Type Predicates)</h4>
<p>类型谓词是返回类型为 type is TypeName 的函数，用于类型守卫：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 数组类型谓词</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isStringArray</span>(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span></span>): value is <span class="hljs-built_in">string</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value) &amp;&amp; value.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"string"</span>);
}

<span class="hljs-comment">// 对象类型谓词</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isUser</span>(<span class="hljs-params">obj: <span class="hljs-built_in">unknown</span></span>): obj is <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">return</span> (
        <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"object"</span> &amp;&amp;
        obj !== <span class="hljs-literal">null</span> &amp;&amp;
        <span class="hljs-string">"id"</span> <span class="hljs-keyword">in</span> obj &amp;&amp;
        <span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> obj &amp;&amp;
        <span class="hljs-string">"email"</span> <span class="hljs-keyword">in</span> obj &amp;&amp;
        <span class="hljs-keyword">typeof</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span>).<span class="hljs-property">id</span> === <span class="hljs-string">"number"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span>).<span class="hljs-property">name</span> === <span class="hljs-string">"string"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span>).<span class="hljs-property">email</span> === <span class="hljs-string">"string"</span>
    );
}

<span class="hljs-comment">// 使用类型谓词</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data: <span class="hljs-built_in">unknown</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isStringArray</span>(data)) {
        <span class="hljs-comment">// data 被推导为 string[]</span>
        data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">toUpperCase</span>());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isUser</span>(data)) {
        <span class="hljs-comment">// data 被推导为 User</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User: <span class="hljs-subst">${data.name}</span> (<span class="hljs-subst">${data.email}</span>)`</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Unknown data type"</span>);
    }
}
</code></pre>
<h4 data-id="heading-41">5.7 类型断言(Type Assertions)</h4>
<p>虽然不是类型推导的一部分，但类型断言是 TypeScript 中重要的类型操作：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 尖括号语法</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-string">"this is a string"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (&lt;<span class="hljs-built_in">string</span>&gt;someValue).<span class="hljs-property">length</span>;

<span class="hljs-comment">// as 语法（推荐）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">someValue2</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-string">"this is a string"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">strLength2</span>: <span class="hljs-built_in">number</span> = (someValue2 <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>).<span class="hljs-property">length</span>;

<span class="hljs-comment">// 非空断言操作符</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fixed</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span></span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">postprocess</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-keyword">return</span> name.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + name.<span class="hljs-title function_">substr</span>(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-comment">// name 可能为 null，但我们确定它不为 null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">postprocess</span>(name!);
}

<span class="hljs-comment">// 类型断言 vs 类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-title function_">meow</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAnimal</span>(<span class="hljs-params">animal: Cat | Dog</span>) {
    <span class="hljs-comment">// 类型断言（不安全）</span>
    (animal <span class="hljs-keyword">as</span> <span class="hljs-title class_">Cat</span>).<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// 如果 animal 是 Dog，会运行时报错</span>
    
    <span class="hljs-comment">// 类型守卫（安全）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"meow"</span> <span class="hljs-keyword">in</span> animal) {
        animal.<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// 安全调用</span>
    }
}
</code></pre>
<h3 data-id="heading-42">总结</h3>
<p>TypeScript 的高级特性为我们提供了强大的类型系统和编程能力：</p>
<ol>
<li><strong>泛型编程</strong>让我们能够编写高度可重用且类型安全的代码</li>
<li><strong>条件类型和映射类型</strong>提供了强大的类型变换能力</li>
<li><strong>装饰器模式</strong>允许我们以声明式的方式增强类和成员的行为</li>
<li><strong>模块声明和类型增强</strong>使我们能够为现有库添加类型信息并扩展类型</li>
<li><strong>类型推导和类型守卫</strong>让 TypeScript 能够在运行时保持类型安全</li>
</ol>
<p>掌握这些高级特性不仅能提高代码质量和开发效率，还能让我们写出更加健壮和易于维护的应用程序。随着 TypeScript 生态的不断发展，这些特性将在现代前端开发中发挥越来越重要的作用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript中的LHS和RHS查询机制详解]]></title>    <link>https://juejin.cn/post/7574448424999354404</link>    <guid>https://juejin.cn/post/7574448424999354404</guid>    <pubDate>2025-11-20T06:58:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574448424999354404" data-draft-id="7574451949326024745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript中的LHS和RHS查询机制详解"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-11-20T06:58:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UIUV"/> <meta itemprop="url" content="https://juejin.cn/user/1036168457093483"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript中的LHS和RHS查询机制详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1036168457093483/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UIUV
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:58:26.000Z" title="Thu Nov 20 2025 06:58:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript中的LHS和RHS查询机制详解</h2>
<p>JavaScript中的LHS（Left-Hand Side）和RHS（Right-Hand Side）查询机制是理解变量作用域和赋值行为的关键。这两种查询方式在引擎内部处理变量引用时表现出截然不同的行为模式，直接影响代码的执行结果和错误处理  。<strong>LHS查询的核心目的是寻找变量的存储位置以便赋值，而RHS查询则是为了获取变量的值进行使用</strong>  。这种差异在不同模式（严格模式与非严格模式）下尤为明显，且在实际开发中可能导致各种难以追踪的错误。</p>
<h3 data-id="heading-1">一、LHS和RHS的基本定义与行为</h3>
<p>LHS查询发生在需要为变量赋值的场景，其目标是找到变量的存储位置。例如在表达式<code>a = 2;</code>中，引擎会对<code>a</code>进行LHS查询，目的是找到可以存储值<code>2</code>的位置。如果<code>a</code>尚未被声明，且当前处于非严格模式，JavaScript引擎会自动在全局作用域中创建一个名为<code>a</code>的变量并赋值。这种机制虽然提供了一定的灵活性，但也可能导致隐式全局变量污染，增加代码维护难度  。</p>
<p>相比之下，RHS查询的目的是获取变量的值。例如在表达式<code>console.log(a);</code>中，引擎会对<code>a</code>进行RHS查询，以获取其当前值。如果<code>a</code>未被声明，RHS查询失败时，在非严格模式下会返回<code>undefined</code>，而在严格模式下则会抛出<code>ReferenceError</code>错误  。这种差异使得RHS查询失败会直接导致程序中断，而LHS查询失败则可能产生意外的全局变量。</p>
<p>在作用域链查找过程中，LHS和RHS查询遵循相似的路径，但处理结果不同。两种查询都从当前执行作用域开始，沿着作用域链逐级向上查找，直到全局作用域  。当LHS查询失败时，非严格模式会"兜底"创建全局变量；而RHS查询失败时，无论哪种模式都不会创建变量，只是返回<code>undefined</code>或抛出错误  。</p>
<h3 data-id="heading-2">二、严格模式与非严格模式下的行为差异</h3>
<p>JavaScript的严格模式（通过<code>"use strict";</code>声明）对LHS和RHS查询的行为产生了显著影响。下表对比了两种模式下查询失败的处理方式：</p>




















<table><thead><tr><th>查询类型</th><th>非严格模式</th><th>严格模式</th></tr></thead><tbody><tr><td>LHS查询失败</td><td>隐式创建全局变量</td><td>抛出<code>ReferenceError</code></td></tr><tr><td>RHS查询失败</td><td>返回<code>undefined</code></td><td>抛出<code>ReferenceError</code></td></tr></tbody></table>
<p>在非严格模式下，LHS查询失败会自动创建全局变量，这可能导致变量名冲突和难以追踪的错误  。例如以下代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
  x = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询x失败，非严格模式下创建全局变量</span>
}
<span class="hljs-title function_">bar</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x);  <span class="hljs-comment">// 输出10</span>
</code></pre>
<p>而在严格模式下，同样的代码会抛出错误：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
   <span class="hljs-string">"use strict"</span>;
   x = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询x失败，严格模式下抛出错误</span>
 }
 <span class="hljs-title function_">bar</span>();      <span class="hljs-comment">// ReferenceError: x is not defined</span>
</code></pre>
<p><strong>严格模式下，无论是LHS还是RHS查询失败，都会立即抛出<code>ReferenceError</code>错误</strong>  ，这使得代码错误更容易被发现和修复。在非严格模式下，LHS查询失败可能导致全局变量意外创建，而RHS查询失败则可能返回<code>undefined</code>导致后续逻辑错误。</p>
<p>ES6引入的<code>let</code>和<code>const</code>关键字在严格模式下表现更为严格。使用<code>let</code>或<code>const</code>声明的变量在严格模式下不会被提升到作用域顶部，且无法在声明前访问，这进一步减少了LHS查询失败的可能性  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta"> "use strict"</span>;
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// ReferenceError: a is not defined</span>
 <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
</code></pre>
<h3 data-id="heading-3">三、LHS和RHS查询的典型应用场景</h3>
<p>LHS和RHS查询不仅出现在简单的赋值操作中，还广泛存在于JavaScript的各类语法结构中。</p>
<p><strong>变量赋值与声明</strong>是最直接的LHS应用场景。无论是使用<code>var</code>、<code>let</code>还是<code>const</code>声明变量，引擎都会进行LHS查询以确定存储位置。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询a，RHS查询10</span>
<span class="hljs-keyword">let</span> b = a + <span class="hljs-number">5</span>;  <span class="hljs-comment">// RHS查询a，LHS查询b</span>
</code></pre>
<p><strong>函数参数传递</strong>本质上也是LHS查询。当函数被调用时，参数会被赋值给函数的形参，这一过程相当于隐式进行LHS查询  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">num</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);  <span class="hljs-comment">// RHS查询num</span>
}
<span class="hljs-title function_">foo</span>(<span class="hljs-number">100</span>);  <span class="hljs-comment">// LHS查询num，RHS查询foo</span>
</code></pre>
<p><strong>对象属性操作</strong>同样遵循LHS和RHS规则。当访问对象属性时，如果属性不存在且处于非严格模式，会返回<code>undefined</code>；如果尝试给未声明的对象属性赋值，则会创建该属性  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {};
obj.<span class="hljs-property">x</span> = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询obj.x，创建属性x</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">y</span>);  <span class="hljs-comment">// RHS查询obj.y，返回undefined</span>
</code></pre>
<p><strong>解构赋值</strong>是ES6中LHS查询的复杂应用场景。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> {a, b} = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>};  <span class="hljs-comment">// RHS查询右边的对象，LHS查询a和b</span>
<span class="hljs-keyword">const</span> [x, y] = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>];           <span class="hljs-comment">// RHS查询右边的数组，LHS查询x和y</span>
</code></pre>
<p>如果解构的源对象中不存在某些属性，LHS查询会失败，但不会创建全局变量，而是让对应的解构变量保持<code>undefined</code>（在非严格模式下）  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> {a, b} = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>};  <span class="hljs-comment">// LHS查询b失败，b为undefined</span>
</code></pre>
<h3 data-id="heading-4">四、实际开发中的常见问题与解决方案</h3>
<p>在实际JavaScript开发中，LHS和RHS查询机制可能导致多种常见问题。</p>
<p><strong>隐式全局变量污染</strong>是非严格模式下LHS查询失败的主要风险  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span>环境污染示例() {
  data = <span class="hljs-string">"污染数据"</span>;  <span class="hljs-comment">// LHS查询失败，非严格模式下创建全局变量</span>
}
环境污染示例();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);  <span class="hljs-comment">// 输出"污染数据"，可能覆盖其他同名全局变量</span>
</code></pre>
<p>这种问题在大型应用中尤为危险，可能导致难以追踪的变量覆盖或命名冲突。解决方案是使用严格模式，或在使用变量前显式声明  。</p>
<p>RHS查询失败导致的意外<code>undefined</code>是另一个常见问题。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-variable constant_">RHS</span>查询失败示例() {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a + b);  <span class="hljs-comment">// RHS查询a和b失败，返回undefined，导致计算错误</span>
  a = <span class="hljs-number">10</span>;                 <span class="hljs-comment">// LHS查询a失败，非严格模式下创建全局变量</span>
  b = <span class="hljs-number">20</span>;                 <span class="hljs-comment">// LHS查询b失败，非严格模式下创建全局变量</span>
}
<span class="hljs-variable constant_">RHS</span>查询失败示例();  <span class="hljs-comment">// 输出NaN，然后a和b变为全局变量</span>
</code></pre>
<p><strong>严格模式下的错误暴露</strong>虽然提高了代码健壮性，但也会导致更多运行时错误。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta"> "use strict"</span>;
 <span class="hljs-keyword">function</span>严格模式错误示例() {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// ReferenceError: a is not defined</span>
   a = <span class="hljs-number">10</span>;            <span class="hljs-comment">// ReferenceError: a is not defined</span>
 }
严格模式错误示例();
</code></pre>
<p>这种情况下，未声明变量的任何使用都会立即失败，有助于开发者早期发现潜在问题。</p>
<p><strong>对象原型链上的LHS/RHS查询</strong>可能引发更复杂的行为。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span>原型链查询示例() {
  <span class="hljs-keyword">const</span> obj = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>};
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">b</span>);  <span class="hljs-comment">// RHS查询obj.b，返回undefined</span>
  obj.<span class="hljs-property">b</span> = <span class="hljs-number">2</span>;              <span class="hljs-comment">// LHS查询obj.b，创建属性b</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">b</span>);  <span class="hljs-comment">// RHS查询obj.b，返回2</span>
}
原型链查询示例();
</code></pre>
<p>在原型链中，属性查找会从对象自身开始，然后沿着原型链向上查找  。LHS查询在对象自身上失败时，会尝试在原型链上查找可写属性，若找不到则抛出错误（严格模式）或创建自身属性（非严格模式）。</p>
<h3 data-id="heading-5">五、调试与错误处理技巧</h3>
<p>理解LHS和RHS查询机制有助于更有效地调试JavaScript代码。</p>
<p><strong>通过错误类型判断查询类型</strong>是基础技巧。当遇到<code>ReferenceError</code>时，通常表明是RHS查询失败（变量未定义）或严格模式下的LHS查询失败  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// RHS查询失败</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(未定义变量);  <span class="hljs-comment">// ReferenceError: 未定义变量 is not defined</span>

 <span class="hljs-comment">// 严格模式下的LHS查询失败</span>
 <span class="hljs-string">"use strict"</span>;
 未定义变量 = <span class="hljs-number">10</span>;  <span class="hljs-comment">// ReferenceError: 未定义变量 is not defined</span>
</code></pre>
<p><strong>使用开发者工具的控制台</strong>可以快速定位查询失败的位置。当代码抛出<code>ReferenceError</code>时，浏览器开发者工具或Node.js的调试器会显示错误发生的行号和变量名，帮助开发者快速修复问题。</p>
<p><strong>作用域链可视化</strong>有助于理解变量查找过程。例如，在Chrome开发者工具中，可以在Scope Variables面板查看当前作用域的变量，理解LHS和RHS查询如何沿着作用域链查找变量。</p>
<p><strong>变量声明检查</strong>是预防查询失败的有效手段。在编写代码时，应确保所有在LHS或RHS查询中使用的变量都已显式声明，或使用<code>let</code>、<code>const</code>等ES6变量声明方式，减少意外查询失败的可能性。</p>
<h3 data-id="heading-6">六、TypeScript中的LHS/RHS查询机制</h3>
<p>TypeScript作为JavaScript的超集，通过静态类型检查增强了对LHS和RHS查询的控制。</p>
<p><strong>TypeScript严格模式</strong>（通过<code>tsconfig.json</code>中的<code>"strict": true</code>配置）与JavaScript严格模式有相似之处，但更侧重于类型安全  。例如，未声明变量在TypeScript严格模式下会直接导致编译错误，而非运行时错误：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// TypeScript严格模式下的RHS查询失败</span>
 <span class="hljs-keyword">function</span>类型检查示例() {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// error TS2304: Cannot find name 'a'.</span>
 }
</code></pre>
<p><strong>显式类型声明</strong>有助于避免查询失败。TypeScript要求所有变量在使用前必须有类型声明，这与LHS查询需要变量存在存储位置的机制相呼应  ：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// 显式声明变量</span>
 <span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// RHS查询a会返回undefined，但类型安全</span>
 a = <span class="hljs-number">10</span>;          <span class="hljs-comment">// LHS查询a成功</span>
</code></pre>
<p><strong>解构赋值与默认值</strong>是TypeScript中处理查询失败的推荐方式。通过为解构变量提供默认值，可以避免RHS查询失败导致的问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// 解构赋值与默认值</span>
 <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Data</span> {
   <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;
   b?: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// 可选属性</span>
 }
 <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Data</span> = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>};
 <span class="hljs-keyword">const</span> {a, b = <span class="hljs-number">2</span>} = data;  <span class="hljs-comment">// RHS查询b失败时使用默认值2</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b);  <span class="hljs-comment">// 输出1 2</span>
</code></pre>
<p><strong>TypeScript的类型推导</strong>可以辅助理解LHS和RHS查询的类型行为。例如，解构赋值中的变量类型会根据源对象的类型自动推导：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// 类型推导</span>
 <span class="hljs-keyword">const</span> obj = {<span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>};
 <span class="hljs-keyword">const</span> {name, age} = obj;  <span class="hljs-comment">// name推导为string，age推导为number</span>
</code></pre>
<h3 data-id="heading-7">七、最佳实践与编码建议</h3>
<p>基于对LHS和RHS查询机制的理解，以下是JavaScript开发的最佳实践建议。</p>
<p><strong>始终使用严格模式</strong>是避免隐式全局变量和提高代码健壮性的首要措施。在文件顶部或函数内部添加<code>"use strict";</code>指令，使LHS查询失败时抛出错误，而非创建全局变量  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta"> "use strict"</span>;
 <span class="hljs-comment">// 此处未声明变量的任何使用都会立即失败</span>
</code></pre>
<p><strong>显式声明所有变量</strong>可以避免查询失败。使用<code>let</code>或<code>const</code>代替<code>var</code>，并确保在使用前声明变量  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 显式声明变量</span>
 <span class="hljs-keyword">function</span>显式声明示例() {
   <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
   <span class="hljs-keyword">const</span> b = <span class="hljs-number">20</span>;
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a + b);
 }
</code></pre>
<p><strong>解构赋值时提供默认值</strong>可以避免RHS查询失败导致的<code>undefined</code>值  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 解构赋值与默认值</span>
 <span class="hljs-keyword">function</span>解构赋值示例(obj) {
   <span class="hljs-keyword">const</span> {x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>} = obj;  <span class="hljs-comment">// RHS查询x和y失败时使用默认值</span>
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x + y);
 }
解构赋值示例({<span class="hljs-attr">x</span>: <span class="hljs-number">1</span>});  <span class="hljs-comment">// 输出1</span>
解构赋值示例({});        <span class="hljs-comment">// 输出0</span>
</code></pre>
<p><strong>使用ES6块级作用域</strong>可以限制变量的可见范围，减少意外查询失败的可能性  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 块级作用域</span>
 <span class="hljs-keyword">function</span>块级作用域示例() {
   <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
     <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
     <span class="hljs-keyword">const</span> b = <span class="hljs-number">20</span>;
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a + b);
   }
   <span class="hljs-comment">// 此处无法访问a和b，避免变量污染</span>
 }
</code></pre>
<p><strong>使用TypeScript增强类型安全</strong>可以在编译阶段发现潜在的查询失败问题  ：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// TypeScript类型检查</span>
 <span class="hljs-keyword">function</span>类型安全示例(<span class="hljs-attr">data</span>: {<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>}) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">a</span>);  <span class="hljs-comment">// RHS查询data.a，类型安全</span>
 }
 <span class="hljs-comment">// 类型不匹配时会报错</span>
类型安全示例({<span class="hljs-attr">b</span>: <span class="hljs-number">2</span>});  <span class="hljs-comment">// error TS2345: Argument of type '{ b: number; }' is not compatible with parameter type '{ a: number; }'.</span>
</code></pre>
<p><strong>避免在函数内部声明变量</strong>，特别是在循环等复杂结构中，可以减少变量提升和查询失败的风险  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 避免函数内部声明变量</span>
 <span class="hljs-keyword">function</span>避免声明示例() {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);  <span class="hljs-comment">// ReferenceError: i is not defined（严格模式下）</span>
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);
   }
 }
</code></pre>
<h3 data-id="heading-8">八、总结与展望</h3>
<p>LHS和RHS查询机制是JavaScript变量处理的核心，理解它们有助于编写更健壮的代码。<strong>在非严格模式下，LHS查询失败会创建全局变量，而RHS查询失败会返回<code>undefined</code>；在严格模式下，两者都会抛出<code>ReferenceError</code></strong>  。这种差异使得严格模式成为现代JavaScript开发的标配。</p>
<p>随着JavaScript和TypeScript的发展，LHS和RHS查询机制的影响正在逐渐减弱。ES6引入的<code>let</code>、<code>const</code>和块级作用域减少了变量提升和查询失败的风险；TypeScript的静态类型检查则在编译阶段就暴露了潜在的问题。然而，理解这些底层机制仍然是深入掌握JavaScript的关键。</p>
<p>未来，随着更多ES规范的落地，LHS和RHS查询机制可能会进一步优化。例如，ES提案中的"do表达式"和"顶层等待"等语法可能会改变变量查询的方式，但核心的LHS/RHS差异仍将存在。因此，掌握这些基本概念对于长期从事JavaScript开发的人员至关重要。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-Vben-Admin 从入门到实战：后端开发的前端探索之旅]]></title>    <link>https://juejin.cn/post/7574600119750066186</link>    <guid>https://juejin.cn/post/7574600119750066186</guid>    <pubDate>2025-11-20T07:27:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574600119750066186" data-draft-id="7574584245152596019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-Vben-Admin 从入门到实战：后端开发的前端探索之旅"/> <meta itemprop="keywords" content="前端,后端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-20T07:27:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shepherd"/> <meta itemprop="url" content="https://juejin.cn/user/3415500769991869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-Vben-Admin 从入门到实战：后端开发的前端探索之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3415500769991869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shepherd
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:27:11.000Z" title="Thu Nov 20 2025 07:27:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 概述：一名后端工程师的前端初体验</h2>
<p>作为一名深耕后端多年的Java工程师，一直围绕着Spring全家桶、微服务、中间件和分布式架构等后端技术栈。前端世界对我而言，虽说感觉并不陌生，但总是带着一层神秘面纱，知识点零散，理解停留在表面。</p>
<p>直到某天，我在GitHub上偶然发现了<strong>Vue-Vben-Admin</strong>——这个拥有超过30k⭐️的热门前端脚手架，瞬间吸引了我的注意。它基于Vue3、TypeScript和Vite等前沿技术栈，提供了一套能够<strong>快速搭建企业级管理后台</strong>的前端解决方案。</p>
<p><strong>为什么Vue-Vben-Admin如此火爆？</strong></p>
<p>🔥 <strong>技术栈前沿</strong> - 采用Vue3+TypeScript+Vite，这些都是当前前端生态中最新、最热门的技术组合</p>
<p>🔥 <strong>开箱即用</strong> - 内置企业级项目所需的各种功能：权限管理、多种布局、主题切换、丰富示例，应有尽有</p>
<p>🔥 <strong>代码规范</strong> - 严格的代码规范和类型检查，让后端开发者也能写出高质量的前端代码</p>
<p>🔥 <strong>性能优异</strong> - 基于Vite的快速冷启动和热更新，开发体验流畅</p>
<p>🔥 <strong>多UI库支持</strong> - 支持Ant Design Vue、Element Plus、Naive等主流UI库，灵活选择不再受限</p>
<p>平心而论，就技术选型、代码规范、功能完备性以及开箱即用的体验而言，Vue-Vben-Admin 足以媲美甚至超越许多互联网公司自研的后台管理系统。</p>
<h2 data-id="heading-1">2.环境搭建：三分钟搞定快速启动</h2>
<p><strong>环境要求</strong></p>
<p>在启动项目前，你需要确保你的环境满足以下要求：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen" target="_blank" title="https://nodejs.org/en" ref="nofollow noopener noreferrer">Node.js</a> 20.15.0 及以上版本，推荐使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSchniz%2Ffnm" target="_blank" title="https://github.com/Schniz/fnm" ref="nofollow noopener noreferrer">fnm</a> 、 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnvm-sh%2Fnvm" target="_blank" title="https://github.com/nvm-sh/nvm" ref="nofollow noopener noreferrer">nvm</a> 或者直接使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fcli%2Fenv" target="_blank" title="https://pnpm.io/cli/env" ref="nofollow noopener noreferrer">pnpm</a> 进行版本管理。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2F" target="_blank" title="https://git-scm.com/" ref="nofollow noopener noreferrer">Git</a> 任意版本。</li>
</ul>
<p>验证你的环境是否满足以上要求，你可以通过以下命令查看版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 出现相应 node LTS版本即可</span>
node -v
<span class="hljs-comment"># 出现相应 git 版本即可</span>
git -v
</code></pre>
<p><strong>下载代码</strong></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/vbenjs/vue-vben-admin.git
</code></pre>
<p><strong>安装依赖</strong></p>
<p>在你的代码目录内打开终端，并执行以下命令:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> vue-vben-admin
​
<span class="hljs-comment"># 使用项目指定的pnpm版本进行依赖安装</span>
npm i -g corepack
​
<span class="hljs-comment"># 安装依赖</span>
pnpm install
</code></pre>
<p><strong>运行项目</strong></p>
<p>执行以下命令运行项目:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动项目</span>
pnpm dev
</code></pre>
<p>此时，你会看到类似如下的输出，选择你需要运行的项目：</p>
<pre><code class="hljs language-sql" lang="sql">│
◆  <span class="hljs-keyword">Select</span> the app you need <span class="hljs-keyword">to</span> run [dev]:
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>web<span class="hljs-operator">-</span>antd
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>web<span class="hljs-operator">-</span>ele
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>web<span class="hljs-operator">-</span>naive
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>docs
│  ● <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>playground
└
</code></pre>
<p>现在，你可以在浏览器访问 <code>http://localhost:5555</code> 查看项目。登录之后系统界面如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1d8940a3fd54d4bbff8be7d429ebd8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hlcGhlcmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228431&amp;x-signature=dLaPZo%2F8AauxYiPTeUH293DkMMI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3.快速上手：后端思维理解前端架构</h2>
<h3 data-id="heading-3">3.1 项目结构解析（后端视角）</h3>
<p>Vue-Vben-Admin的目录结构对后端开发者非常友好：</p>
<pre><code class="hljs language-bash" lang="bash">src
├── api          <span class="hljs-comment"># 接口层，类似后端的Controller</span>
├── layouts      <span class="hljs-comment"># 布局组件，相当于页面模板</span>
├── router       <span class="hljs-comment"># 路由配置，类似Spring中的RequestMapping</span>
├── store        <span class="hljs-comment"># 状态管理，类比后端的缓存机制</span>
├── locales      <span class="hljs-comment"># 多语言配置</span>
├── views        <span class="hljs-comment"># 页面组件，相当于MVC中的View</span>
└── main.ts      <span class="hljs-comment"># 应用入口文件，类似Spring Boot的启动类</span>
</code></pre>
<p><strong>核心概念后端化理解：</strong></p>
<ul>
<li><strong>路由 (router/)</strong> ：核心是<code>routes.ts</code>和路由守卫(<code>guard/</code>)。权限路由通过后端返回的菜单数据动态生成，类似Spring Security的权限控制</li>
<li><strong>状态管理 (store/)</strong> ：使用Pinia管理用户信息、权限状态等全局数据，类似Redis缓存机制</li>
<li><strong>布局 (layouts/)</strong> ：定义页面整体框架，通过修改布局组件改变应用样式，类似Thymeleaf模板</li>
<li><strong>请求封装 (api/)</strong> ：基于Axios封装，统一处理请求拦截、响应拦截和错误处理，类似Spring的拦截器</li>
</ul>
<h3 data-id="heading-4">3.2 实战：开发一个测试页面</h3>
<p><strong>第一步：创建页面组件 (<code>src/views/test/index.vue</code>)</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
​
<span class="hljs-comment">// 响应式数据（类似Java中的POJO对象）</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'张三'</span>);
<span class="hljs-keyword">const</span> age = <span class="hljs-title function_">ref</span>(<span class="hljs-number">18</span>);
​
<span class="hljs-comment">// 方法定义（类似Service层方法）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeName</span>(<span class="hljs-params"/>) {
  name.<span class="hljs-property">value</span> = <span class="hljs-string">'李四'</span>; <span class="hljs-comment">// 注意：操作ref对象需要.value</span>
}
​
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeAge</span>(<span class="hljs-params"/>) {
  age.<span class="hljs-property">value</span> += <span class="hljs-number">1</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"person"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>姓名：{{ name }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>年龄：{{ age }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeName"</span>&gt;</span>修改名字<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeAge"</span>&gt;</span>修改年龄<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.person</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background-color</span>: skyblue;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
}
​
<span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>第二步：配置路由 (<code>/router/routes/modules/test.ts</code>)</strong></p>
<pre><code class="hljs language-css" lang="css">import type { RouteRecordRaw } <span class="hljs-selector-tag">from</span> 'vue-router';
import { $t } <span class="hljs-selector-tag">from</span> '#/locales';
​
const routes: RouteRecordRaw[] = [
  {
    name: <span class="hljs-string">'Test'</span>,
    path: <span class="hljs-string">'/test'</span>,
    redirect: <span class="hljs-string">'/test/index'</span>,
    meta: {
      <span class="hljs-attribute">icon</span>: <span class="hljs-string">'mdi:home'</span>,
      title: $<span class="hljs-built_in">t</span>(<span class="hljs-string">'page.test.title'</span>),
    },
    children: [
      {
        name: <span class="hljs-string">'TestIndex'</span>,
        path: <span class="hljs-string">'/test/index'</span>,
        component: () =&gt; <span class="hljs-built_in">import</span>(<span class="hljs-string">'#/views/test/index.vue'</span>),
        meta: {
          <span class="hljs-attribute">icon</span>: <span class="hljs-string">'mdi:home'</span>,
          title: $<span class="hljs-built_in">t</span>(<span class="hljs-string">'page.test.index'</span>),
        },
      },
    ],
  },
];
​
export default routes;
</code></pre>
<p><strong>第三步：配置多语言 (<code>/locales/langs/zh-CN/page.json</code>)</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"测试菜单"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"测试页面"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>效果展示：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d8631eaf1d43a493144aa5ea051523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hlcGhlcmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228431&amp;x-signature=FLSvkUZhPfJgNY7dpMAHGSH%2FdrA%3D" alt="" loading="lazy"/></p>
<p>简单三步，一个功能完整的页面就开发完成了！虽然界面简单，但包含了Vue3的核心概念：响应式数据、事件处理、组件化开发。</p>
<h2 data-id="heading-5">4. 总结：为什么推荐后端工程师学习Vue-Vben-Admin？</h2>
<p>Vue-Vben-Admin确实是一个优秀的中后台解决方案，特别适合以下场景：</p>
<p>🚀 <strong>快速开发需求</strong> - 需要快速搭建中后台管理系统的项目</p>
<p>💼 <strong>企业级应用</strong> - 追求代码规范和质量的企业级项目开发</p>
<p>🔄 <strong>后端转全栈</strong> - 后端工程师需要参与前端开发的场景</p>
<p>🎯 <strong>技术栈升级</strong> - 团队希望采用现代化前端技术栈</p>
<p><strong>作为后端开发者的学习价值：</strong></p>
<ol start="0">
<li><strong>理解前端工程化</strong> - 学习现代前端项目的构建、打包、部署流程</li>
<li><strong>掌握组件化思维</strong> - 理解前端组件化开发模式，对微服务架构设计也有启发</li>
<li><strong>拓宽技术视野</strong> - 了解前后端分离架构的全貌，更好地进行API设计</li>
<li><strong>提升竞争力</strong> - 全栈开发能力在当前就业市场极具竞争力</li>
</ol>
<p><strong>学习建议：</strong></p>
<ul>
<li>先从模仿现有页面开始，理解代码结构</li>
<li>重点学习Vue3的Composition API和TypeScript</li>
<li>结合后端知识，理解前后端数据交互流程</li>
<li>多动手实践，遇到问题查阅官方文档</li>
</ul>
<h2 data-id="heading-6">5. 最后</h2>
<p>从后端视角学习前端，最大的障碍不是技术本身，而是思维方式的转变。Vue-Vben-Admin通过良好的项目结构和完善的文档，大大降低了后端开发者的学习门槛。</p>
<p>如果你也是后端开发者，想要拓展前端技能，或者需要快速搭建一个企业级管理后台，<strong>Vue-Vben-Admin</strong>绝对值得一试。它不仅能解决实际项目需求，更能帮你打开前端世界的大门，向全栈开发迈出坚实的一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NAS、对象存储与 JuiceFS：百亿量化基金的存储选型实践]]></title>    <link>https://juejin.cn/post/7574600119750017034</link>    <guid>https://juejin.cn/post/7574600119750017034</guid>    <pubDate>2025-11-20T07:18:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574600119750017034" data-draft-id="7574625040659546162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NAS、对象存储与 JuiceFS：百亿量化基金的存储选型实践"/> <meta itemprop="keywords" content="后端,运维"/> <meta itemprop="datePublished" content="2025-11-20T07:18:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JuiceFS"/> <meta itemprop="url" content="https://juejin.cn/user/2665636828032446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NAS、对象存储与 JuiceFS：百亿量化基金的存储选型实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2665636828032446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JuiceFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:18:19.000Z" title="Thu Nov 20 2025 07:18:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在量化投资领域，存储系统的性能与可扩展性是支撑高效研究与计算任务的关键基础。JuiceFS 已广泛应用于多家头部百亿级量化私募机构，在回测与模型训练等核心环节中支撑高性能、低成本、可弹性扩展的存储体系。</p>
<p>本文将分享量化机构在存储层面临的核心挑战以及 JuiceFS 的应对方案，并通过三个典型案例，分别聚焦成本优化、元数据性能提升与平滑上云这三类需求。</p>
<h2 data-id="heading-0">01 量化行业的数据类型与存储挑战</h2>
<p>首先我们先来了解下量化行业使用数据的模式。量化投研中的编程语言和数据处理工具种类繁多，包括 Python、R、Java、MATLAB 和 Conda 等，同时，所涉及的数据类型也非常丰富，如 CSV、Parquet、TXT、Excel 和 HDF 等。这要求存储平台具备灵活性，能够支持各种数据格式并高效存储。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e91d38c209374424b699a21daa439e8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=9GEtCqT2ocLsQkBnwv%2BY7htT4Do%3D" alt="" loading="lazy"/></p>
<p>在量化投资中，数据的使用呈现出明显的“读多写少”特征。研究员频繁地从统一的数据源中读取数据，而数据的写入和更新相对较少。各类行情数据、因子数据等通常被集中存储，供所有研究员共享读取。无论是因子研究还是交易策略开发，基础数据都会被反复访问和使用。因此，存储系统必须具备高效的读取性能，以支持快速的数据访问和分析需求。</p>
<p>这种数据使用模式在量化研究的核心任务——回测（Backtesting）中也得到了充分体现。在典型的回测流程中，研究员多次读取历史行情数据，构建因子、生成交易信号并验证策略表现。稳定且预测能力强的因子会被纳入因子库，作为投资决策的重要依据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0feb5e55b4341b3b6dd36422e6e417b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=Yfb19HNveqzg3JCMGadT%2BO5gtjg%3D" alt="" loading="lazy"/></p>
<p>由此，存储系统面临着一系列挑战，主要体现在以下几个方面：</p>
<p><strong>首先，能够处理多样化的编程语言与数据处理工具</strong>。</p>
<p><strong>量化投研的另一个挑战是容量要求低而性能要求高</strong>。虽然存储容量需求通常在几十 TB 至几百 TB，但对存储系统的性能要求极高，特别是在吞吐量和 IOPS 上。由于量化任务涉及大量的机器学习和深度学习计算，存储系统必须提供高效的顺序读吞吐量和快速的随机读 IOPS，才能支持数据的快速处理和分析。</p>
<p><strong>云环境的适应性也成为量化投研存储的一个关键要求</strong>。随着越来越多的量化团队开始使用公有云或混合云 构建技术平台，存储系统需要具备高可用性、弹性扩展性以及灵活的资源管理能力，以满足动态存储需求，并能够根据计算需求快速调整存储资源。</p>
<p><strong>与此同时，Kubernetes 已成为量化投研领域中资源编排的主流解决方案</strong>，因此存储系统需要能够与 Kubernetes 良好集成，支持 CSI 驱动。这一集成不仅提升了平台的灵活性和可扩展性，还使得存储系统能够在云环境中更高效地管理资源。</p>
<p><strong>最后，数据安全与权限控制是量化研究团队的核心需求</strong>。在量化投研过程中，因子数据、交易策略等敏感信息的保护至关重要。存储系统必须提供强大的模块化访问权限管理机制，保障数据的隐私与安全性。此外，随着越来越多的数据存储转向云环境，数据加密、审计和合规管理等功能成为必须提供的安全措施，以确保敏感数据在云上安全存储和访问。</p>
<h2 data-id="heading-1">02 主流存储方案利弊分析： NAS vs 对象存储 vs JuiceFS</h2>
<h3 data-id="heading-2">NAS</h3>
<p>许多量化团队在初期往往会选择一种 “开箱即用” 的方式来搭建存储系统，最常见的就是基于传统协议的 NAS（Network Attached Storage），使用 NFS 或 Samba 协议进行访问。在数据规模普遍处于几十 TB 到几百 TB 的情况下，很多私有机房采用 NAS 架构即可满足需求，部署简单、管理方便、成本在可控范围内。然而，这种方案在实践中也暴露出一些明显的问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b604501d266484696ce61b4bb70feb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=mqp9iHrHkD5ot4dfTwTnbfh2%2BiI%3D" alt="" loading="lazy"/></p>
<p>首先是成本问题。如果希望在 IDC 线下机房中获得较高的存储性能，通常必须使用全闪存 NAS 系统。全闪虽然性能更好，但价格昂贵，整体投资较大。而混闪架构（SSD 与 HDD 混合）在高并发访问场景下往往性能不足，特别是在多个研究员同时读取数据时，IO 吞吐容易成为瓶颈。</p>
<p>其次，云上 NAS 的性能受限于容量绑定。在公有云环境中，许多厂商的 NAS 或并行文件系统（如部分 PFS 产品）会将吞吐量与购买的容量直接绑定。也就是说，如果一个量化团队只需要 100 TB 的存储容量，但其回测和策略计算需要达到较高的吞吐或 IOPS，例如聚合每秒 50GB 以上读或者每秒上百万次操作，就必须“超配”购买到 PB 级容量才能满足性能需求。这种模式显然会带来资源浪费与成本上升。</p>
<p>第三个问题是协议层面导致的性能瓶颈。NAS 协议依赖内核客户端进行数据交互，当负载高时，由于数据与元数据通过同一通道传输（NFS4.2 前），容易在高并发读写下形成拥堵，从而引发性能下降甚至出现延迟抖动。这种情况虽然不是每次都会出现，但在量化研究高峰期或集中回测阶段极易暴露。</p>
<p><strong>综上所述，虽然 NAS 系统具备“即插即用”、部署简便、兼容性好的优点，但其在成本、性能扩展性以及高并发访问效率方面仍存在明显短板</strong>。</p>
<h3 data-id="heading-3">对象存储</h3>
<p>对象存储也是量化行业会考虑的低成本的解决方案，尽管对象存储的单次请求延迟较高，但它在处理大吞吐量的顺序读写时表现较好。许多研究员对其业务代码进行了改造，避免使用随机读写，而是将数据聚合成适合顺序读取的格式，再通过内存进行随机操作。这种做法虽然有效，但也存在一些问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c51700364b4ccab0f06957e879359e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=Lx8xTwPXGjBZ9EU1MvYezwbOARI%3D" alt="" loading="lazy"/></p>
<p>首先，对象存储只能通过 S3 协议进行访问。对于已经使用 POSIX 挂载点的应用，迁移到对象存储时需要对代码进行改造，这对原有系统有一定的侵入性。此外，对象存储原生缺乏元数据管理，由于其扁平结构，I/O 操作的响应速度较慢，尤其是文件重命名等操作。如果需要更改文件名，实际上需要删除原文件并复制新的文件，这在性能上表现较差。</p>
<p>其次，对象存储上的文件不可变（immutable），这意味着如果要修改数据（例如在 Parquet 文件中添加一列），只能通过创建一个新的文件来实现，而不能直接在原文件上修改。这种不可变特性在一些场景下，如数据库文件可能导致很大的不便。</p>
<p>此外，频繁读取对象存储会产生额外的流出费用，这对于量化行业高频读写的需求来说，可能会造成较高的成本。同时，虽然对象存储在大吞吐量下表现不错，但它的性能完全依赖于存储系统本身，在高并发访问下可能仍然无法满足量化研究对速度和实时性的要求。</p>
<h3 data-id="heading-4">JuiceFS</h3>
<p>JuiceFS 是一款基于对象存储的分布式文件系统，兼容 POSIX ，能够同时管理结构化与非结构化数据，为量化研究提供统一、高性能的数据存储平台。系统支持 CSI 驱动，能与 Kubernetes 深度结合，同时具备云原生特性，可灵活部署在公有云、私有云或混合云环境中。</p>
<p>JuiceFS 采用数据与元数据分离的架构。数据被切分成小块存储在对象存储中，元数据则由独立引擎管理并缓存在内存中。这种设计显著提升了访问性能，使文件元数据操作（如重命名、查找，获取文件属性等）无需频繁访问底层存储，从而实现高吞吐量、低延迟和高 IOPS 的性能表现。</p>
<p>在安全与权限方面，JuiceFS 提供基于 Token 和 POSIX ACL 的访问控制机制，并支持数据传输与存储加密。更重要的是，对象存储与缓存中的数据均采用分块存放方式，从架构层面进一步提升了数据的安全性与合规性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e29aade08215450fa7f49863eef9f07a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=fvHqPNtHwXII8NWH6Ku2zFjGO84%3D" alt="" loading="lazy"/></p>
<p>实际操作时，用户通过下载并安装 JuiceFS 的二进制文件，并使用 <code>juicefs mount</code> 命令将其挂载到本地系统上。一旦挂载完成，用户的业务就能通过 POSIX 挂载点进行访问，操作方式与本机文件系统类似，方便与现有的应用兼容。</p>
<p>这样的架构在量化行业中的应用带来了多个显著的优势：</p>
<ol>
<li><strong>高吞吐量与高 IOPS 支持</strong>：量化投研中的数据使用模式大多是“读多写少”，尤其是回测、因子研究等任务，需要频繁地读取大量数据。JuiceFS 的切块存储和高效的多级数据缓存能够提供 高吞吐量和高 IOPS 支持，满足量化研究对数据访问的苛刻要求。</li>
<li><strong>弹性扩展与降本</strong>：量化研究常常面临动态的存储需求，JuiceFS 天生具备 弹性扩展 能力，能够根据需求动态调整存储和缓存资源。通过将对象存储作为底层存储架构，结合 分布式缓存，JuiceFS 可以显著降低存储成本，避免了全闪存储的高昂开销。</li>
<li><strong>数据安全</strong>：在量化投研中，因子数据和交易策略等属于核心资产，其安全性至关重要。JuiceFS 通过数据切块与加密机制有效保障数据安全。尤其是对于对上云仍存顾虑的机构，这一分块加密策略能显著降低数据泄露风险——即便部分数据被截获，攻击者也无法在缺乏元数据的情况下还原原始内容，从而确保敏感信息的安全与合规。</li>
<li><strong>云环境兼容性</strong>：随着云计算和公有云的普及，量化投研逐步向云环境迁移。JuiceFS 支持跨云同步，能够在多云或混合云环境中高效运行，为量化研究提供了更大的灵活性和可扩展性。</li>
</ol>
<p>对于线下部署的量化企业，JuiceFS 同样是可行且高效的选择。传统线下存储多采用混闪或机械硬盘，性能往往难以满足量化研究的高并发需求。JuiceFS 通过充分利用业务机器的本地缓存盘和高效的缓存机制，在低成本下即可实现接近全闪的性能，显著降低硬件投入。同时，其运维管理简单、稳定性高，客户反馈表明系统运行可靠、维护负担较轻。</p>
<h2 data-id="heading-5">03 案例</h2>
<h3 data-id="heading-6">案例 1 - 提升对象存储性能，整体降本增效</h3>
<p>为了进一步降低存储成本，该企业选择将数据迁移至对象存储。在回测业务中，他们原先使用的是一个自研的接口，通过 S3 API 直接访问 Amazon S3 对象存储。由于他们的业务主要是写入大块数据并进行顺序读取，这种存储模式即使没有缓存也能够勉强运行。尽管如此，这种做法仍然存在一些明显的弊端。</p>
<p>首先，使用 S3 API 对业务代码产生了侵入性，意味着如果 API 出现问题，业务代码的调试和维护将变得非常困难。此外，该 API 没有实现缓存，仅做了协议转换，一定程度上性能也有上限。由于这些原因，业务团队并不希望长期依赖这种模式。</p>
<p>为了改善这一状况，该企业决定迁移到 JuiceFS 企业版。迁移之后，业务代码不再依赖于 S3 API，JuiceFS 作为富客户端直接挂载在业务机器上。通过这种方式，业务代码几乎没有受到侵入，开发人员可以继续按原有方式编译和运行代码。同时，业务机器上的 NVMe 硬盘被用作分布式缓存，这有效优化了数据访问效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7096dc2d0414b17a2ab3205c7191030~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=aPEY%2FFsLx4mvgyJKxyCp64wnVfI%3D" alt="" loading="lazy"/></p>
<p>使用 JuiceFS 带来了显著的性能改进，客户得以在低成本的对象存储上实现高性能读写：首先，本地缓存避免了重复访问远程存储，显著降低读取延迟；其次，JuiceFS 的切块与预读机制充分利用了对象存储带宽，使单文件读取也能达到系统性能上限。整体上，迁移后的系统在性能和维护便利性上均有明显提升。</p>
<p>客户的神经网络训练任务同样从 JuiceFS 的优化中获益。在训练过程中，系统需要读取约 10 万个文件（每个约 24MB），并在随机打散后反复读取。未使用缓存时，每轮训练都需重新加载所有文件，产生巨大的网络流量。而引入 JuiceFS 后，首次读取的数据会自动缓存到本地，后续训练可直接从缓存池中获取，大幅减少带宽占用并显著提升整体训练效率，完全满足客户训练使用对存储的需求。</p>
<h3 data-id="heading-7">案例 2 - 业务对元数据要求极高</h3>
<p>客户主要将 JuiceFS 用于回测业务。该客户从外部购买行情数据，通常是 CSV 格式，并将其存储在目录中。不同于其他客户将数据进行聚合，这个客户将原始数据直接存放在文件夹内，造成了更大的数据访问负担。每个股票的历史行情数据被分开存储，每个文件代表一支股票一年的数据，这些文件按月和年分布在不同目录下。<strong>每次需要读取某一日期的行情数据时，必须随机读取并处理约 6000 个文件，然后将这些文件按顺序排列。为了支持回测，这些数据被用来启动数百台虚拟机，进行 4000 至 6000 个回测任务</strong>。</p>
<p>这一过程中，随机读取大量文件对存储系统造成了巨大的负担，尤其是在高并发读写的场景下，元数据的访问效率严重影响了整体性能。这个客户原本使用 JuiceFS 社区版，并结合云上 Redis 服务来缓存部分数据。虽然 Redis 提供了良好的性能，但它的 QPS 上限为 50 万个，这对于该客户的高并发回测任务来说已经无法满足需求。当回测任务达到 12,000 个时，Redis 的性能达到了瓶颈，导致整个系统变得非常缓慢，回测任务无法顺利完成。</p>
<p>为了解决这个问题，客户尝试使用 JuiceFS 企业版。企业版的元数据服务在性能上有了显著的提升，特别是在处理大量元数据请求时，企业版可支持更高的并发量。企业版的元数据服务采用了基于目录树结构的管理方式，并且提供了一个更加高效的请求处理服务。客户不再需要通过 KV 存储方式请求多个操作，而是通过简单的请求告知元数据系统读取文件。<strong>企业版元数据请求的单次处理效率约为社区版的 6 倍，因此在执行相同业务时，所需 QPS 仅为社区版的六分之一，整体执行效率更高</strong>。</p>
<p>除此之外JuiceFS 企业版还提供更强力的元数据客户端缓存机制：大量只读请求（如 <code>getattr</code>、<code>lookup</code>）可直接命中缓存，显著降低了对元数据服务的访问压力。如下图所示，系统共处理约 50 万 QPS 的只读元数据请求，其中仅约 4 万实际落到元数据服务端。再加上企业版元数据服务本身的高效处理能力，整体系统能够在高并发场景下保持稳定运行，CPU 使用率仅约 40%，客户能够稳定支持多达 12,000 个回测任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/556a434734004ca0ba436fd1718de331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=RnJ4G4EQ2BSy0sLJG1qOMUIusnQ%3D" alt="" loading="lazy"/></p>
<p>从这个案例我们可以看到，JuiceFS 企业版在量化行业中能够有效应对高并发读写、高 IOPS 和大量 元数据请求 的挑战。即使在没有对业务场景进行优化的情况下，JuiceFS 依然能够高效处理这些暴力操作的需求，满足量化行业对数据访问速度和响应能力的苛刻要求。</p>
<h3 data-id="heading-8">案例 3 - 云 NAS 不满足 IOPS 要求</h3>
<p>在这个案例中，客户面临的是将业务迁移到云端时的云存储性能问题。他们最初选择了使用云 NAS 来支持存储需求，但很快发现，随着业务的扩展，云 NAS 的性能无法满足 IOPS 要求。在使用云 NAS 的过程中，客户的 120 台机器就已经将普通型云 NAS 的 IOPS 上限打满，而即使使用极速型云 NAS（提供约 20 万 IOPS），性能仍然不能完全满足需求。</p>
<p>为了应对这一瓶颈，客户决定切换到 JuiceFS。通过 JuiceFS 的分布式缓存，客户能够聚合更多的 IOPS 性能。理论上，5 台缓存机器可以提供每台 20 万 IOPS，再加上本地硬盘的支持，最终可以提供 超过 100 万的 IOPS。通过这种方式，客户可以灵活组合缓存资源，按需扩展存储性能。</p>
<p><strong>在极限场景下，客户能够达到 7.5 GB 的吞吐量和近 300 万 IOPS，这足以应对大规模的随机读写场景</strong>。具体来说，客户能够通过增加网络带宽来提升吞吐量，而通过增加缓存节点数量来提高 IOPS 性能。每个缓存节点大约可以提供 10 万至 20 万 IOPS，客户还可以根据需要通过挂载更多的硬盘或利用内存来扩展容量。这样，客户可以根据业务的实际需求，自由组合和调整缓存池的能力，确保系统的性能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d68a3deedfb24ad1a370c1319adfe03b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=IH%2BKK0VsWGoE%2BrF4S6SzOpOaU9U%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">04 小结</h2>
<p>结合前文多个实际案例，可以总结出量化研究在存储层面的几个显著特点：</p>
<p>首先，量化业务的数据容量相对较小，但对性能要求极高。JuiceFS 通过数据与元数据分离及缓存机制显著提升访问效率，即使在无缓存的情况下，也能依靠预读和数据切块上传机制充分利用带宽，确保高性能的数据处理能力。</p>
<p>其次，JuiceFS 的数据切块与加密机制提升了云上存储的安全性。数据被切分并加密后存储，即便部分数据被窃取，攻击者也无法在缺乏元数据的情况下还原文件。这种设计特别适合保护量化因子、交易策略等敏感数据。</p>
<p>随着量化业务逐步向云端迁移，JuiceFS 提供了一种平衡性能与成本的技术路径。它在对象存储的基础上实现了高性能访问与统一管理，满足公有云与混合云环境下的多样化计算需求，为量化机构构建可扩展、可靠的数据基础设施。</p>
<p>我们希望本文中的一些实践经验，能为正在面临类似问题的开发者提供参考，如果有其他疑问欢迎加入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjuicefs.com%2Fzh-cn%2F" target="_blank" title="https://juicefs.com/zh-cn/" ref="nofollow noopener noreferrer">JuiceFS 社区</a>与大家共同交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI深夜放大招！Codex-Max上线，与Gemini 3巅峰对决]]></title>    <link>https://juejin.cn/post/7574581079626989574</link>    <guid>https://juejin.cn/post/7574581079626989574</guid>    <pubDate>2025-11-20T07:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079626989574" data-draft-id="7574530224852992006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI深夜放大招！Codex-Max上线，与Gemini 3巅峰对决"/> <meta itemprop="keywords" content="人工智能,资讯"/> <meta itemprop="datePublished" content="2025-11-20T07:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="算家计算"/> <meta itemprop="url" content="https://juejin.cn/user/1426490793396571"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI深夜放大招！Codex-Max上线，与Gemini 3巅峰对决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1426490793396571/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    算家计算
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:27:22.000Z" title="Thu Nov 20 2025 07:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>两大AI巨头同时发力，两大编程助手谁强谁弱？</p>
</blockquote>
<p>昨天，Gemini 3刚刚发布，就在AI领域掀起了不小的波澜。热度还没消退，昨晚OpenAI紧跟着推出了旗下最强编程模型——GPT-5.1-Codex-Max。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f5d110ac00b42f4a080b25408d30adc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=DBweMhiC1mUmCmN3IeaMdbGKAdQ%3D" alt="图片" loading="lazy"/></p>
<p>两大AI巨头接连出牌，让这场模型之争陡然升温。</p>
<p>那么，这款新发布的GPT-5.1-Codex-Max与Gemini 3究竟有何不同？</p>
<p><strong>性能表现</strong></p>
<p>GPT-5.1-Codex-Max被OpenAI称为“代理性”编码模型，其核心优势在于处理那些需要长时间专注的复杂工程任务。根据OpenAI的介绍，该模型在内部测试中能够持续工作超过24小时，处理诸如修复测试失败、迭代实现等任务。</p>
<p>这种持久作战能力得益于一项名为“压缩”的技术。当模型的上下文窗口被填满时，它会自动压缩会话历史，保留关键信息并丢弃不重要的细节，从而在数百万个token的跨度中保持对核心任务的跟踪。</p>
<p>这种机制使得GPT-5.1-Codex-Max成为首个能够在多个上下文窗口中以这种方式本地训练的模型。</p>
<p>在性能表现上，GPT-5.1-Codex-Max在SWE-Bench Verified测试中达到了77.9%的得分，在SWE-Lancer IC SWE测评中更是达到79.9%。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6391f699c5149d0883074b877cc5b72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=LQPciDdWnl2ZoCc0fWCH09OrWGM%3D" alt="图片" loading="lazy"/></p>
<p>它在保持质量的同时，比前代模型减少了30%的“思考token”使用量，在现实任务中的运行速度也快了27%至42%。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c0e36fc4ab462db3b521fef889ee40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=2ltuqSyimb5ZlTPQuUyH5%2FWVXs8%3D" alt="图片" loading="lazy"/></p>
<p><strong>Gemini 3的全方位挑战</strong></p>
<p>谷歌的Gemini 3则呈现出不同的优势特点。根据官方测试数据，Gemini 3在多项基准测试中表现出色，在GPQA Diamond上达到91.9%的分数，展示了博士级别的推理能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca55f5ad88f84e2fa0340493b884e02e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=mKHFOefUCOA4QSbHEE2X9%2FcwrfE%3D" alt="图片" loading="lazy"/></p>
<p>Gemini 3的亮点在于其生成式体验功能，能够直接在浏览器中构建动画和交互式UI界面来解释复杂概念。比如，它可以生成完全交互式的利率计算器，包含滑块、可编辑文本字段、彩色表格等丰富的网页元素。</p>
<p>谷歌还增强了Gemini 3的代理能力，使其能够处理多步骤命令。例如，你可以要求聊天机器人为你的下一次旅行预订车辆，它不仅会查看电子邮件，还会通过模拟浏览器浏览互联网，从租赁机构找到可用车辆。</p>
<p>从两者的特性来看，OpenAI选择了深度专业化的路线，专门针对编程任务优化，尤其是那些需要长时间专注的复杂工作。而谷歌则采取了全面发展的策略，使Gemini 3在推理、多模态理解和交互体验上都有出色表现。</p>
<p>目前，GPT-5.1-Codex-Max现已向ChatGPT Plus、Pro、Team、Edu和Enterprise用户开放。使用限制因订阅类型而异，Plus用户每5小时可发送45至225条本地消息和10至60条云任务，而Pro用户则享有更多容量。</p>
<p>Gemini 3也遵循类似的免费增值模式，几乎所有功能都向免费用户开放，但高级功能需要订阅。</p>
<p>对于注重成本效益的开发者，GPT-5.1-Codex-Max在效率上的提升可能带来长期收益。思考token减少30%意味着在处理复杂任务时能够更快地获得结果，同时可能降低使用成本。</p>
<p>对于开发者社区而言，这种竞争最终将带来更好的工具和更高的工作效率。随着这些AI助手不断进化，它们将承担越来越多繁琐和耗时的编程任务，让我们能够专注于真正需要人类创造力和判断力的工作。</p>
<p>两款顶级AI编程助手你挺谁？欢迎在评论区交流讨论！</p>
<p>写在最后：如果您正在进行AI领域的创业或研究，却受困于高昂的算力成本或高并发下的推理稳定性等问题，欢迎留言或私信我们，找到您的降本增效突破口~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[缓存穿透、缓存击穿和缓存雪崩，傻傻分不清楚？]]></title>    <link>https://juejin.cn/post/7574529034672750627</link>    <guid>https://juejin.cn/post/7574529034672750627</guid>    <pubDate>2025-11-20T07:38:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574529034672750627" data-draft-id="7574601160980807695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="缓存穿透、缓存击穿和缓存雪崩，傻傻分不清楚？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:38:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            缓存穿透、缓存击穿和缓存雪崩，傻傻分不清楚？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:38:36.000Z" title="Thu Nov 20 2025 07:38:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>对于从事后端开发的同学来说，<code>缓存</code>已经变成的项目中必不可少的技术之一。</p>
<p>没错，缓存能给我们系统显著的提升性能。但如果你使用不好，或者缺乏相关经验，它也会带来很多意想不到的问题。</p>
<p>今天我们一起聊聊如果在项目中引入了缓存，可能会给我们带来的下面这三大问题。看看你中招了没？</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.susan.net.cn%3Frefer%3Djuejin" title="https://link.juejin.cn/?target=http%3A%2F%2Fwww.susan.net.cn%3Frefer%3Djuejin" target="_blank">最近准备面试的小伙伴，可以看一下这个宝藏网站（Java突击队）：www.susan.net.cn，里面：面试八股文、场景设计题、面试真题、7个项目实战、工作内推什么都有</a>。</p>
<h2 data-id="heading-1">1. 缓存穿透问题</h2>
<p>大部分情况下，加缓存的目的是：为了减轻数据库的压力，提升系统的性能。</p>
<h3 data-id="heading-2">1.1 我们是如何用缓存的？</h3>
<p>一般情况下，如果有用户请求过来，先查缓存，如果缓存中存在数据，则直接返回。如果缓存中不存在，则再查数据库，如果数据库中存在，则将数据放入缓存，然后返回。如果数据库中也不存在，则直接返回失败。</p>
<p>流程图如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bfde6b557c2461eacb27cb7c4e00642~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=WpzjNN6bGgnOCQgkd1DB6S3htqg%3D" alt="" loading="lazy"/>
上面的这张图小伙们肯定再熟悉不过了，因为大部分缓存都是这样用的。</p>
<h3 data-id="heading-3">1.2 什么是缓存穿透？</h3>
<p>但如果出现以下这两种特殊情况，比如：</p>
<ol>
<li>用户请求的id在缓存中不存在。</li>
<li>恶意用户伪造不存在的id发起请求。</li>
</ol>
<p>这样的用户请求导致的结果是：每次从缓存中都查不到数据，而需要查询数据库，同时数据库中也没有查到该数据，也没法放入缓存。也就是说，每次这个用户请求过来的时候，都要查询一次数据库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b1ffdae55f4c189b1658d1b2b251b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=yVrEuT3qtWbmNW1zZQE0CloCHMo%3D" alt="" loading="lazy"/>
图中标红的箭头表示每次走的路线。</p>
<p>很显然，缓存根本没起作用，好像被<code>穿透</code>了一样，每次都会去访问数据库。</p>
<p>这就是我们所说的：<code>缓存穿透问题</code>。</p>
<p>如果此时穿透了缓存，而直接数据库的请求数量非常多，数据库可能因为扛不住压力而挂掉。呜呜呜。</p>
<p>那么问题来了，如何解决这个问题呢？</p>
<h3 data-id="heading-4">1.3 校验参数</h3>
<p>我们可以对用户id做检验。</p>
<p>比如你的合法id是15xxxxxx，以15开头的。如果用户传入了16开头的id，比如：16232323，则参数校验失败，直接把相关请求拦截掉。这样可以过滤掉一部分恶意伪造的用户id。</p>
<h3 data-id="heading-5">1.4 布隆过滤器</h3>
<p>如果数据比较少，我们可以把数据库中的数据，全部放到内存的一个map中。</p>
<p>这样能够非常快速的识别，数据在缓存中是否存在。如果存在，则让其访问缓存。如果不存在，则直接拒绝该请求。</p>
<p>但如果数据量太多了，有数千万或者上亿的数据，全都放到内存中，很显然会占用太多的内存空间。</p>
<p>那么，有没有办法减少内存空间呢？</p>
<p>答：这就需要使用<code>布隆过滤器</code>了。</p>
<p>布隆过滤器底层使用bit数组存储数据，该数组中的元素默认值是0。</p>
<p>布隆过滤器第一次初始化的时候，会把数据库中所有已存在的key，经过一些列的hash算法（比如：三次hash算法）计算，每个key都会计算出多个位置，然后把这些位置上的元素值设置成1。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf61315ec87643579c8c2a34f54eb3f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=EuTzyiucqyEzfiJvGOQLIoFJlrY%3D" alt="" loading="lazy"/>
之后，有用户key请求过来的时候，再用相同的hash算法计算位置。</p>
<ul>
<li>如果多个位置中的元素值都是1，则说明该key在数据库中已存在。这时允许继续往后面操作。</li>
<li>如果有1个以上的位置上的元素值是0，则说明该key在数据库中不存在。这时可以拒绝该请求，而直接返回。</li>
</ul>
<p>使用布隆过滤器确实可以解决缓存穿透问题，但同时也带来了两个问题：</p>
<ol>
<li>存在误判的情况。</li>
<li>存在数据更新问题。</li>
</ol>
<p>先看看为什么会存在误判呢？</p>
<p>上面我已经说过，初始化数据时，针对每个key都是通过多次hash算法，计算出一些位置，然后把这些位置上的元素值设置成1。</p>
<p>但我们都知道hash算法是会出现hash冲突的，也就是说不同的key，可能会计算出相同的位置。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9673a4fe872646be918cab90c3306ad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=Fu4bl9a6ubwp34D9vZE4eOeYK7g%3D" alt="" loading="lazy"/>
上图中的下标为2的位置就出现了hash冲突，key1和key2计算出了一个相同的位置。</p>
<p>如果有几千万或者上亿的数据，布隆过滤器中的hash冲突会非常明显。</p>
<p>如果某个用户key，经过多次hash计算出的位置，其元素值，恰好都被其他的key初始化成了1。此时，就出现了误判，原本这个key在数据库中是不存在的，但布隆过滤器确认为存在。</p>
<blockquote>
<p>如果布隆过滤器判断出某个key存在，可能出现误判。如果判断某个key不存在，则它在数据库中一定不存在。</p>
</blockquote>
<p>通常情况下，布隆过滤器的误判率还是比较少的。即使有少部分误判的请求，直接访问了数据库，但如果访问量并不大，对数据库影响也不大。</p>
<p>此外，如果想减少误判率，可以适当增加hash函数，图中用的3次hash，可以增加到5次。</p>
<p>其实，布隆过滤器最致命的问题是：如果数据库中的数据更新了，需要同步更新布隆过滤器。但它跟数据库是两个数据源，就可能存在数据不一致的情况。</p>
<p>比如：数据库中新增了一个用户，该用户数据需要实时同步到布隆过滤。但由于网络异常，同步失败了。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228059170faa4786b14e09f3491ee07c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=4XSs6%2FoMSQKC%2BJWaPDXEnpw%2Fhoc%3D" alt="" loading="lazy"/>
这时刚好该用户请求过来了，由于布隆过滤器没有该key的数据，所以直接拒绝了该请求。但这个是正常的用户，也被<code>拦截</code>了。</p>
<p>很显然，如果出现了这种正常用户被拦截了情况，有些业务是无法容忍的。所以，布隆过滤器要看实际业务场景再决定是否使用，它帮我们解决了缓存穿透问题，但同时了带来了新的问题。</p>
<h3 data-id="heading-6">1.5 缓存空值</h3>
<p>上面使用布隆过滤器，虽说可以过滤掉很多不存在的用户id请求。但它除了增加系统的复杂度之外，会带来两个问题：</p>
<ol>
<li>布隆过滤器存在误杀的情况，可能会把少部分正常用户的请求也过滤了。</li>
<li>如果用户信息有变化，需要实时同步到布隆过滤器，不然会有问题。</li>
</ol>
<p>所以，通常情况下，我们很少用布隆过滤器解决缓存穿透问题。其实，还有另外一种更简单的方案，即：<code>缓存空值</code>。</p>
<p>当某个用户id在缓存中查不到，在数据库中也查不到时，也需要将该用户id缓存起来，只不过值是空的。这样后面的请求，再拿相同的用户id发起请求时，就能从缓存中获取空数据，直接返回了，而无需再去查一次数据库。</p>
<p>优化之后的流程图如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd5c30e5ed9949e8b909d526185b8cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=%2B9UHK56pynaQ5IHbV7HMUKEaq6w%3D" alt="" loading="lazy"/>
关键点是不管从数据库有没有查到数据，都将结果放入缓存中，只是如果没有查到数据，缓存中的值是空的罢了。</p>
<h2 data-id="heading-7">2. 缓存击穿问题</h2>
<h3 data-id="heading-8">2.1 什么是缓存击穿？</h3>
<p>有时候，我们在访问热点数据时。比如：我们在某个商城购买某个热门商品。</p>
<p>为了保证访问速度，通常情况下，商城系统会把商品信息放到缓存中。但如果某个时刻，该商品到了过期时间失效了。</p>
<p>此时，如果有大量的用户请求同一个商品，但该商品在缓存中失效了，一下子这些用户请求都直接怼到数据库，可能会造成瞬间数据库压力过大，而直接挂掉。</p>
<p>流程图如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04a2fdb94e0c4d10ae51081d04f484ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=FXgh582Qvrud%2BFzyv80TGaRp%2B0c%3D" alt="" loading="lazy"/>
那么，如何解决这个问题呢？</p>
<h3 data-id="heading-9">2.2 加锁</h3>
<p>数据库压力过大的根源是，因为同一时刻太多的请求访问了数据库。</p>
<p>如果我们能够限制，同一时刻只有一个请求才能访问某个productId的数据库商品信息，不就能解决问题了？</p>
<p>答：没错，我们可以用<code>加锁</code>的方式，实现上面的功能。</p>
<p>伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
  <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(productId, requestId, <span class="hljs-string">"NX"</span>, <span class="hljs-string">"PX"</span>, expireTime);
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"OK"</span>.equals(result)) {
    <span class="hljs-keyword">return</span> queryProductFromDbById(productId);
  }
} <span class="hljs-keyword">finally</span>{
    unlock(productId,requestId);
}  
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
</code></pre>
<p>在访问数据库时加锁，防止多个相同productId的请求同时访问数据库。</p>
<p>然后，还需要一段代码，把从数据库中查询到的结果，又重新放入缓存中。办法挺多的，在这里我就不展开了。</p>
<h3 data-id="heading-10">2.3 自动续期</h3>
<p>出现缓存击穿问题是由于key过期了导致的。那么，我们换一种思路，在key快要过期之前，就自动给它续期，不就OK了？</p>
<p>答：没错，我们可以用job给指定key自动续期。</p>
<p>比如说，我们有个分类功能，设置的缓存过期时间是30分钟。但有个job每隔20分钟执行一次，自动更新缓存，重新设置过期时间为30分钟。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39a0e59c198541c583714f3261fe4e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=ePr1p96CQRAh7ek1gyEh56KkcAY%3D" alt="" loading="lazy"/>
这样就能保证，分类缓存不会失效。</p>
<p>此外，在很多请求第三方平台接口时，我们往往需要先调用一个获取token的接口，然后用这个token作为参数，请求真正的业务接口。一般获取到的token是有有效期的，比如24小时之后失效。</p>
<p>如果我们每次请求对方的业务接口，都要先调用一次获取token接口，显然比较麻烦，而且性能不太好。</p>
<p>这时候，我们可以把第一次获取到的token缓存起来，请求对方业务接口时从缓存中获取token。</p>
<p>同时，有一个job每隔一段时间，比如每隔12个小时请求一次获取token接口，不停刷新token，重新设置token的过期时间。</p>
<h3 data-id="heading-11">2.4 缓存不失效</h3>
<p>此外，对于很多热门key，其实是可以不用设置过期时间，让其永久有效的。</p>
<p>比如参与秒杀活动的热门商品，由于这类商品id并不多，在缓存中我们可以不设置过期时间。</p>
<p>在秒杀活动开始前，我们先用一个程序提前从数据库中查询出商品的数据，然后同步到缓存中，提前做<code>预热</code>。</p>
<p>等秒杀活动结束一段时间之后，我们再<code>手动删除</code>这些无用的缓存即可。</p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了不少的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h2 data-id="heading-12">3. 缓存雪崩问题</h2>
<h3 data-id="heading-13">3.1 什么是缓存雪崩？</h3>
<p>前面已经聊过缓存击穿问题了。</p>
<p>而缓存雪崩是缓存击穿的升级版，缓存击穿说的是某一个热门key失效了，而缓存雪崩说的是有多个热门key同时失效。看起来，如果发生缓存雪崩，问题更严重。</p>
<p>缓存雪崩目前有两种：</p>
<ol>
<li>有大量的热门缓存，同时失效。会导致大量的请求，访问数据库。而数据库很有可能因为扛不住压力，而直接挂掉。</li>
<li>缓存服务器down机了，可能是机器硬件问题，或者机房网络问题。总之，造成了整个缓存的不可用。</li>
</ol>
<p>归根结底都是有大量的请求，透过缓存，而直接访问数据库了。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32e50b8cd09f4ea1aa5c765a0c2bce8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=iv99KzyF%2FmH1AmmGuASFdpur8xc%3D" alt="" loading="lazy"/>
那么，要如何解决这个问题呢？</p>
<h3 data-id="heading-14">3.2 过期时间加随机数</h3>
<p>为了解决缓存雪崩问题，我们首先要尽量避免缓存同时失效的情况发生。</p>
<p>这就要求我们不要设置相同的过期时间。</p>
<p>可以在设置的过期时间基础上，再加个1~60秒的随机数。</p>
<pre><code class="hljs language-java" lang="java">实际过期时间 = 过期时间 + <span class="hljs-number">1</span>~<span class="hljs-number">60</span>秒的随机数
</code></pre>
<p>这样即使在高并发的情况下，多个请求同时设置过期时间，由于有随机数的存在，也不会出现太多相同的过期key。</p>
<h3 data-id="heading-15">3.3 高可用</h3>
<p>针对缓存服务器down机的情况，在前期做系统设计时，可以做一些高可用架构。</p>
<p>比如：如果使用了redis，可以使用哨兵模式，或者集群模式，避免出现单节点故障导致整个redis服务不可用的情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6a1a3d9cac54027b39ee55c94a208a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=V0keN00hh5d0iVAT4jQFTlSSKTY%3D" alt="" loading="lazy"/>
使用哨兵模式之后，当某个master服务下线时，自动将该master下的某个slave服务升级为master服务，替代已下线的master服务继续处理请求。</p>
<h3 data-id="heading-16">3.4 服务降级</h3>
<p>如果做了高可用架构，redis服务还是挂了，该怎么办呢？</p>
<p>这时候，就需要做服务降级了。</p>
<p>我们需要配置一些默认的兜底数据。</p>
<p>程序中有个全局开关，比如有10个请求在最近一分钟内，从redis中获取数据失败，则全局开关打开。后面的新请求，就直接从配置中心中获取默认的数据。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27420da1b5e84bb8ba5e6ce37117832d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=6ao5P2zrQcvFuKHzqgRwMf0767M%3D" alt="" loading="lazy"/>
当然，还需要有个job，每隔一定时间去从redis中获取数据，如果在最近一分钟内可以获取到两次数据（这个参数可以自己定），则把全局开关关闭。后面来的请求，又可以正常从redis中获取数据了。</p>
<p>需要特别说一句，该方案并非所有的场景都适用，需要根据实际业务场景决定。</p>
<h2 data-id="heading-17">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【SpringBoot】38 核心功能 - 高级特性- Spring Boot 中的应用启动过程详解]]></title>    <link>https://juejin.cn/post/7574608278421618724</link>    <guid>https://juejin.cn/post/7574608278421618724</guid>    <pubDate>2025-11-20T07:25:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574608278421618724" data-draft-id="7574530224853041158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【SpringBoot】38 核心功能 - 高级特性- Spring Boot 中的应用启动过程详解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:25:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【SpringBoot】38 核心功能 - 高级特性- Spring Boot 中的应用启动过程详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:25:23.000Z" title="Thu Nov 20 2025 07:25:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>SpringBoot应用的启动过程是一个复杂但设计精巧的流程，了解这个过程对于深入理解SpringBoot工作原理至关重要。本文将详细解析SpringBoot应用的完整[启动流程]。</p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>一、SpringApplication初始化阶段</h3>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 创建SpringApplication实例</h4>
<p>SpringBoot应用启动的第一步是创建<code>SpringApplication</code>实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>, args);
    }
}

<span class="hljs-variable constant_">AI</span>写代码java
运行
<span class="hljs-number">123456</span>
</code></pre>
<p>在<code>SpringApplication</code>的构造函数中，会进行以下关键操作：</p>
<pre><code class="hljs language-scss" lang="scss">public <span class="hljs-built_in">SpringApplication</span>(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) {
    <span class="hljs-comment">// 保存主配置类信息</span>
    this<span class="hljs-selector-class">.resourceLoader</span> = resourceLoader;
    this<span class="hljs-selector-class">.primarySources</span> = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));
    
    <span class="hljs-comment">// 判断应用类型：SERVLET、REACTIVE 或 NONE</span>
    this<span class="hljs-selector-class">.webApplicationType</span> = WebApplicationType<span class="hljs-selector-class">.deduceFromClasspath</span>();
    
    <span class="hljs-comment">// 获取并初始化BootstrapRegistryInitializer</span>
    this<span class="hljs-selector-class">.bootstrapRegistryInitializers</span> = new ArrayList&lt;&gt;(
        getSpringFactoriesInstances(BootstrapRegistryInitializer.class));
    
    <span class="hljs-comment">// 获取ApplicationContextInitializer</span>
    <span class="hljs-built_in">setInitializers</span>((Collection) <span class="hljs-built_in">getSpringFactoriesInstances</span>(
        ApplicationContextInitializer.class));
    
    <span class="hljs-comment">// 获取ApplicationListener</span>
    <span class="hljs-built_in">setListeners</span>((Collection) <span class="hljs-built_in">getSpringFactoriesInstances</span>(ApplicationListener.class));
    
    <span class="hljs-comment">// 推断主应用类</span>
    this<span class="hljs-selector-class">.mainApplicationClass</span> = <span class="hljs-built_in">deduceMainApplicationClass</span>();
}

AI写代码java
运行
<span class="hljs-number">12345678910111213141516171819202122</span>
</code></pre>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 加载SPI扩展组件</h4>
<p>SpringBoot通过<code>spring.factories</code>机制加载各种扩展组件：</p>
<ul>
<li><strong>BootstrapRegistryInitializer</strong>: 引导注册表初始化器</li>
<li><strong>ApplicationContextInitializer</strong>: 应用上下文初始化器</li>
<li><strong>ApplicationListener</strong>: 应用事件监听器</li>
</ul>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>二、应用运行阶段</h3>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 启动计时与引导上下文</h4>
<pre><code class="hljs language-ini" lang="ini">public ConfigurableApplicationContext run(String... args) {
    StopWatch <span class="hljs-attr">stopWatch</span> = new StopWatch()<span class="hljs-comment">;</span>
    stopWatch.start()<span class="hljs-comment">;</span>
    
    // 创建引导上下文
    DefaultBootstrapContext <span class="hljs-attr">bootstrapContext</span> = createBootstrapContext()<span class="hljs-comment">;</span>
    
    ConfigurableApplicationContext <span class="hljs-attr">context</span> = null<span class="hljs-comment">;</span>
    configureHeadlessProperty()<span class="hljs-comment">;</span>
    
    // 获取运行监听器
    SpringApplicationRunListeners <span class="hljs-attr">listeners</span> = getRunListeners(args)<span class="hljs-comment">;</span>
    listeners.starting(bootstrapContext, this.mainApplicationClass)<span class="hljs-comment">;</span>
}

AI写代码java
运行
1234567891011121314
</code></pre>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 环境准备</h4>
<p>环境准备阶段负责配置应用运行所需的[环境变量]和配置属性：</p>
<pre><code class="hljs language-scss" lang="scss">private ConfigurableEnvironment <span class="hljs-built_in">prepareEnvironment</span>(
        SpringApplicationRunListeners listeners,
        ApplicationArguments applicationArguments) {
    
    <span class="hljs-comment">// 创建适当类型的环境对象</span>
    ConfigurableEnvironment environment = <span class="hljs-built_in">getOrCreateEnvironment</span>();
    
    <span class="hljs-comment">// 配置环境：加载配置文件、命令行参数等</span>
    <span class="hljs-built_in">configureEnvironment</span>(environment, applicationArguments.getSourceArgs());
    
    <span class="hljs-comment">// 发布EnvironmentPrepared事件</span>
    listeners<span class="hljs-selector-class">.environmentPrepared</span>(bootstrapContext, environment);
    
    <span class="hljs-comment">// 将环境绑定到SpringApplication</span>
    <span class="hljs-built_in">bindToSpringApplication</span>(environment);
    
    return environment;
}

AI写代码java
运行
<span class="hljs-number">123456789101112131415161718</span>
</code></pre>
<blockquote>
<p><strong>环境配置过程</strong>：</p>
<ul>
<li>返回或者创建基础设施信息对象：<code>StandardServletEnvironment</code></li>
<li>配置环境信息对象</li>
<li>读取所有的配置源的配置属性值</li>
<li>绑定环境信息</li>
<li>监听器调用 <code>listener.environmentPrepared()</code>，通知所有监听器当前环境准备完成</li>
</ul>
</blockquote>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 创建IOC容器</h4>
<p>根据应用类型创建相应的ApplicationContext：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">protected</span> ConfigurableApplicationContext createApplicationContext() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.applicationContextFactory.create(<span class="hljs-keyword">this</span>.webApplicationType);
}

AI写代码java
运行
<span class="hljs-number">123</span>
</code></pre>
<blockquote>
<p><strong>根据项目类型创建容器</strong>：</p>
<ul>
<li>对于Servlet应用，会创建 <code>AnnotationConfigServletWebServerApplicationContext</code></li>
<li>对于Reactive应用，会创建 <code>AnnotationConfigReactiveWebServerApplicationContext</code></li>
<li>对于普通应用，会创建 <code>AnnotationConfigApplicationContext</code></li>
</ul>
</blockquote>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. 准备IOC容器</h4>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">prepareContext</span>(DefaultBootstrapContext bootstrapContext, 
                           ConfigurableApplicationContext context,
                           ConfigurableEnvironment environment, 
                           SpringApplicationRunListeners listeners,
                           ApplicationArguments applicationArguments, 
                           Banner printedBanner) {
    
    <span class="hljs-comment">// 设置环境</span>
    context<span class="hljs-selector-class">.setEnvironment</span>(environment);
    
    <span class="hljs-comment">// 应用上下文后置处理</span>
    <span class="hljs-built_in">postProcessApplicationContext</span>(context);
    
    <span class="hljs-comment">// 应用初始化器</span>
    <span class="hljs-built_in">applyInitializers</span>(context);
    
    <span class="hljs-comment">// 发布ApplicationContextInitialized事件</span>
    listeners<span class="hljs-selector-class">.contextPrepared</span>(context);
    
    <span class="hljs-comment">// 注册Bean定义</span>
    <span class="hljs-built_in">load</span>(context, sources.toArray(new Object[<span class="hljs-number">0</span>]));
    
    <span class="hljs-comment">// 发布ApplicationContextLoaded事件</span>
    listeners<span class="hljs-selector-class">.contextLoaded</span>(context);
}

AI写代码java
运行
<span class="hljs-number">12345678910111213141516171819202122232425</span>
</code></pre>
<blockquote>
<p><strong>准备ApplicationContext IOC容器的基本信息 prepareContext()</strong> ：</p>
<ul>
<li>保存环境信息</li>
<li>IOC容器的后置处理流程</li>
<li>应用初始化器：<code>applyInitializers</code></li>
<li>遍历所有的 <code>ApplicationContextInitializer</code>，调用 <code>initialize</code>，来对IOC容器进行初始化扩展功能</li>
<li>遍历所有的监听器调用 <code>contextPrepared</code>，通知所有的监听器contextPrepare</li>
<li>所有的监听器调用 <code>contextLoaded</code>，通知所有的监听器contextLoaded</li>
</ul>
</blockquote>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5. 刷新IOC容器</h4>
<p>这是SpringBoot启动过程中最核心的步骤：</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">refreshContext</span>(ConfigurableApplicationContext context) {
    <span class="hljs-comment">// 注册关闭钩子</span>
    if (this.registerShutdownHook) {
        shutdownHook<span class="hljs-selector-class">.registerApplicationContext</span>(context);
    }
    
    <span class="hljs-comment">// 执行刷新操作</span>
    <span class="hljs-built_in">refresh</span>(context);
}

AI写代码java
运行
<span class="hljs-number">123456789</span>
</code></pre>
<p>实际的刷新操作委托给Spring Framework的<code>refresh()</code>方法：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">refresh</span>(<span class="hljs-params">ApplicationContext applicationContext</span>) {
    applicationContext.<span class="hljs-title function_">refresh</span>();
}

<span class="hljs-variable constant_">AI</span>写代码java
运行
<span class="hljs-number">123</span>
</code></pre>
<p>在<code>refresh()</code>方法中会完成：</p>
<ul>
<li>BeanFactory的创建和配置</li>
<li>Bean的后置处理器注册</li>
<li>消息源、事件广播器等基础组件的初始化</li>
<li>Web服务器的创建和启动</li>
<li>单例Bean的实例化</li>
</ul>
<blockquote>
<p><strong>刷新IOC容器，refreshContext</strong>：</p>
<ul>
<li>创建容器中的所有组件（Spring注解）</li>
<li>启动内嵌的Web服务器（如Tomcat）</li>
<li>完成所有Bean的创建和依赖注入</li>
</ul>
</blockquote>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6. 容器刷新后处理</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">afterRefresh</span>(<span class="hljs-params">ConfigurableApplicationContext context,
                           ApplicationArguments args</span>) {
    <span class="hljs-comment">// 调用ApplicationRunner和CommandLineRunner</span>
}

<span class="hljs-variable constant_">AI</span>写代码java
运行
<span class="hljs-number">1234</span>
</code></pre>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7. 调用Runners</h4>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">callRunners</span>(ApplicationContext context, ApplicationArguments args) {
    List&lt;<span class="hljs-selector-tag">Object</span>&gt; runners = new ArrayList&lt;&gt;();
    
    <span class="hljs-comment">// 获取容器中的ApplicationRunner</span>
    runners<span class="hljs-selector-class">.addAll</span>(context.getBeansOfType(ApplicationRunner.class)<span class="hljs-selector-class">.values</span>());
    
    <span class="hljs-comment">// 获取容器中的CommandLineRunner  </span>
    runners<span class="hljs-selector-class">.addAll</span>(context.getBeansOfType(CommandLineRunner.class)<span class="hljs-selector-class">.values</span>());
    
    <span class="hljs-comment">// 合并所有runner并且按照@Order进行排序</span>
    AnnotationAwareOrderComparator<span class="hljs-selector-class">.sort</span>(runners);
    
    <span class="hljs-comment">// 遍历所有的runner，调用run方法</span>
    for (Object runner : new LinkedHashSet&lt;&gt;(runners)) {
        if (runner instanceof ApplicationRunner) {
            <span class="hljs-built_in">callRunner</span>((ApplicationRunner) runner, args);
        }
        if (runner instanceof CommandLineRunner) {
            <span class="hljs-built_in">callRunner</span>((CommandLineRunner) runner, args);
        }
    }
}

AI写代码java
运行
<span class="hljs-number">12345678910111213141516171819202122</span>
</code></pre>
<blockquote>
<p><strong>调用所有runners</strong>：</p>
<ul>
<li>获取容器中的 <code>ApplicationRunner</code></li>
<li>获取容器中的 <code>CommandLineRunner</code></li>
<li>合并所有runner并且按照Order进行排序</li>
<li>遍历所有的runner，调用run方法</li>
</ul>
</blockquote>
<h4 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8. 启动完成事件发布</h4>
<pre><code class="hljs language-lua" lang="lua">// 所有监听器调用listeners.started(context)，通知所有的监听器started
listeners.started(context);

// 调用所有监听器的<span class="hljs-built_in">running</span>方法listeners.<span class="hljs-built_in">running</span>(context)，通知所有的监听器<span class="hljs-built_in">running</span>  
listeners.<span class="hljs-built_in">running</span>(context);

AI写代码java
运行
<span class="hljs-number">12345</span>
</code></pre>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9. 异常处理</h4>
<p>在整个启动过程中，如果出现异常，会进行相应的处理：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 启动流程...</span>
} <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Throwable</span> ex) {
    <span class="hljs-comment">// 调用Listener的failed方法，通知所有的监听器启动失败</span>
    <span class="hljs-title function_ invoke__">handleRunFailure</span>(context, ex, listeners);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);
}

AI写代码java
运行
<span class="hljs-number">1234567</span>
</code></pre>
<blockquote>
<p><strong>异常处理机制</strong>：</p>
<ul>
<li>如果以上有异常，调用<code>Listener</code>的failed</li>
<li>调用所有监听器的running方法，如果running有问题，继续通知failed</li>
</ul>
</blockquote>
<h3 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>三、关键组件详解</h3>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 事件监听机制</h4>
<p>SpringBoot的启动过程通过事件监听机制实现了高度的扩展性：</p>
<ul>
<li><strong>ApplicationStartingEvent</strong>: 应用启动开始时发布</li>
<li><strong>ApplicationEnvironmentPreparedEvent</strong>: 环境准备完成后发布</li>
<li><strong>ApplicationContextInitializedEvent</strong>: 应用上下文初始化后发布</li>
<li><strong>ApplicationPreparedEvent</strong>: Bean定义加载完成后发布</li>
<li><strong>ApplicationStartedEvent</strong>: 应用启动完成后发布</li>
<li><strong>ApplicationReadyEvent</strong>: 应用准备就绪后发布</li>
<li><strong>ApplicationFailedEvent</strong>: 启动失败时发布</li>
</ul>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. Runner接口</h4>
<p><code>ApplicationRunner</code>和<code>CommandLineRunner</code>提供了在应用启动后执行特定代码的机制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Order(1)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplicationRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationRunner</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 应用启动后执行的逻辑</span>
        System.out.println(<span class="hljs-string">"ApplicationRunner执行完成"</span>);
    }
}

<span class="hljs-meta">@Component</span>  
<span class="hljs-meta">@Order(2)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 命令行参数处理逻辑</span>
        System.out.println(<span class="hljs-string">"CommandLineRunner执行完成"</span>);
    }
}

AI写代码java
运行
<span class="hljs-number">123456789101112131415161718192021</span>
</code></pre>
<h3 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>总结</h3>
<p>SpringBoot的启动过程是一个精心设计的流程，通过模块化的设计和事件驱动机制，实现了高度的可扩展性和灵活性。理解这个启动过程对于深入掌握SpringBoot框架、进行自定义扩展和故障排查都具有重要意义。</p>
<p>整个启动过程从创建SpringApplication实例开始，经过环境准备、容器创建、Bean加载、后置处理等多个阶段，最终完成应用的启动并对外提供服务。每个阶段都提供了相应的扩展点，允许开发者在适当的时机介入并添加自定义逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>