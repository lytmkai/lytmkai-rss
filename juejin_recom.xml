<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Docker 容器实现按顺序启动]]></title>    <link>https://juejin.cn/post/7584651851905597459</link>    <guid>https://juejin.cn/post/7584651851905597459</guid>    <pubDate>2025-12-17T23:22:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905597459" data-draft-id="7584714813365174310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker 容器实现按顺序启动"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T23:22:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="风象南"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker 容器实现按顺序启动
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    风象南
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T23:22:29.000Z" title="Wed Dec 17 2025 23:22:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发和运维中，我们会遇到这样的需求：<strong>多个 Docker 容器需要按特定顺序启动</strong>。例如，应用依赖数据库，消息队列依赖服务初始化等，如果顺序启动不当，可能导致容器无法正常运行或出现错误。</p>
<h2 data-id="heading-0">问题背景</h2>
<p>假设有三个服务：</p>
<p><strong>1.数据库服务（MySQL）</strong></p>
<p><strong>2.缓存服务（Redis）</strong></p>
<p><strong>3.应用服务（Spring Boot Web 应用）</strong></p>
<p>如果应用服务在数据库或缓存尚未就绪时启动，就会出现启动失败或报错。传统 Docker 启动方式（<code>docker run -d</code>）是异步启动的，无法保证顺序。</p>
<h2 data-id="heading-1">实现思路</h2>
<p>按顺序启动 Docker 容器，主要有以下几种方法：</p>
<p><strong>1.使用 Docker Compose <code>depends_on</code></strong></p>
<p><strong>2.在容器入口脚本中等待依赖就绪</strong></p>
<p><strong>3.使用外部脚本（Shell/Makefile）控制启动顺序</strong></p>
<h4 data-id="heading-2">1. Docker Compose <code>depends_on</code></h4>
<p>Docker Compose 提供了 <code>depends_on</code> 配置，可以指定启动依赖：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.9"</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3306:3306"</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6379:6379"</span>

  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">my-springboot-app:latest</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
</code></pre>
<p><strong>注意：</strong></p>
<ul>
<li><code>depends_on</code> 只保证 <strong>容器启动顺序</strong>，并不能保证依赖服务就绪。</li>
<li>如果数据库启动慢，应用服务可能仍然启动失败。</li>
</ul>
<h4 data-id="heading-3">2. 容器入口脚本等待依赖</h4>
<p>为解决“容器启动顺序不等于服务就绪”的问题，可以在应用容器的入口脚本中增加 <strong>依赖等待逻辑</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># wait-for.sh</span>

<span class="hljs-comment"># 等待 MySQL 启动</span>
until nc -z -v -w30 mysql 3306; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Waiting for MySQL..."</span>
  <span class="hljs-built_in">sleep</span> 3
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 等待 Redis 启动</span>
until nc -z -v -w30 redis 6379; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Waiting for Redis..."</span>
  <span class="hljs-built_in">sleep</span> 3
<span class="hljs-keyword">done</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"All dependencies are up. Starting application..."</span>
java -jar /app/my-springboot-app.jar
</code></pre>
<p>然后在 Dockerfile 中：</p>
<pre><code class="hljs language-perl" lang="perl">COPY <span class="hljs-keyword">wait</span>-for.sh /<span class="hljs-keyword">wait</span>-for.sh
RUN <span class="hljs-keyword">chmod</span> +<span class="hljs-keyword">x</span> /<span class="hljs-keyword">wait</span>-for.sh
ENTRYPOINT [<span class="hljs-string">"/wait-for.sh"</span>]
</code></pre>
<p>优点：</p>
<ul>
<li>可以保证服务依赖完全就绪后再启动应用</li>
<li>支持多层级依赖</li>
</ul>
<h4 data-id="heading-4">3. 外部脚本控制启动顺序</h4>
<p>如果不使用 Compose，也可以用 Shell 脚本控制容器按顺序启动：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

docker run -d --name mysql -e MYSQL_ROOT_PASSWORD=root mysql:8.0
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Waiting for MySQL..."</span>
<span class="hljs-built_in">sleep</span> 20  <span class="hljs-comment"># 简单等待，或使用健康检查循环</span>

docker run -d --name redis redis:7.0
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Waiting for Redis..."</span>
<span class="hljs-built_in">sleep</span> 10

docker run -d --name app --<span class="hljs-built_in">link</span> mysql --<span class="hljs-built_in">link</span> redis my-springboot-app:latest
</code></pre>
<p><strong>改进版</strong>：可以使用 <code>docker inspect</code> 检查容器健康状态，动态判断是否就绪，而不是固定 sleep 时间。</p>
<h4 data-id="heading-5">4. 健康检查 + Compose 等待策略</h4>
<p>在 Docker Compose 中可以使用 <code>healthcheck</code> 配合 <code>depends_on</code> 条件：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"mysqladmin"</span>, <span class="hljs-string">"ping"</span>, <span class="hljs-string">"-h"</span>, <span class="hljs-string">"localhost"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7.0</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"redis-cli"</span>, <span class="hljs-string">"ping"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">my-springboot-app:latest</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
      <span class="hljs-attr">redis:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
</code></pre>
<p>优点：</p>
<ul>
<li>自动等待依赖容器健康</li>
<li>避免硬编码 sleep 时间，提高启动可靠性</li>
</ul>
<h2 data-id="heading-6">总结</h2>
<p>按顺序启动 Docker 容器不仅仅是容器启动顺序问题，更重要的是 <strong>服务依赖就绪问题</strong>。</p>
<p>实际需要根据项目复杂度选择合适的启动策略</p>



































<table><thead><tr><th>方案</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>简单<code>depends_on</code></td><td>服务启动快、依赖简单的场景</td><td>配置简单，开箱即用</td><td>不保证服务就绪</td></tr><tr><td>健康检查 + <code>depends_on</code></td><td>生产环境、复杂依赖</td><td>可靠性高，自动化管理</td><td>需要配置健康检查</td></tr><tr><td>入口脚本等待</td><td>需要精细化控制</td><td>灵活可控，支持复杂逻辑</td><td>需要编写和维护脚本</td></tr><tr><td>外部脚本</td><td>特殊定制需求</td><td>完全自定义控制流程</td><td>维护成本高</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET struct 全解析：什么时候该用值类型？]]></title>    <link>https://juejin.cn/post/7584650673826201640</link>    <guid>https://juejin.cn/post/7584650673826201640</guid>    <pubDate>2025-12-17T23:21:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650673826201640" data-draft-id="7584711683772547072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET struct 全解析：什么时候该用值类型？"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-17T23:21:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET struct 全解析：什么时候该用值类型？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T23:21:42.000Z" title="Wed Dec 17 2025 23:21:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>struct</code> 是 值类型（<code>Value Type</code>），用于封装一组相关的数据。
与类（<code>class</code>）相比，结构体通常更轻量，适用于小型、短生命周期的对象。</p>
<p>⚡ 关键特点：</p>
<ul>
<li>
<p>存储在 栈（<code>stack</code>）上（也可能嵌套在堆中，但本质仍是值类型）。</p>
</li>
<li>
<p>按值传递（赋值/参数传递时会复制整个结构）。</p>
</li>
<li>
<p>无需垃圾回收（<code>GC</code>），生命周期由作用域决定。</p>
</li>
<li>
<p>可包含字段、属性、方法、构造函数、运算符重载等。</p>
</li>
</ul>
<h3 data-id="heading-1">基本语法</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Point
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Y;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y</span>)</span>
    {
        X = x;
        Y = y;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Move</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> dx, <span class="hljs-built_in">int</span> dy</span>)</span>
    {
        X += dx;
        Y += dy;
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-csharp" lang="csharp">Point p1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
p1.Move(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{p1.X}</span>, <span class="hljs-subst">{p1.Y}</span>"</span>); <span class="hljs-comment">// 4, 6</span>
</code></pre>
<h3 data-id="heading-2">内存模型与分配</h3>

























<table><thead><tr><th>分配场景</th><th>存储位置</th><th>说明</th></tr></thead><tbody><tr><td><strong>局部变量</strong></td><td>栈</td><td>最典型场景，生命周期由方法作用域决定</td></tr><tr><td><strong>作为类字段</strong></td><td>堆</td><td>包含在类对象内部，但值本身在堆内存中</td></tr><tr><td><strong>数组元素</strong></td><td>堆</td><td>数组本身在堆上，每个元素紧密排列</td></tr></tbody></table>
<p>即使 <code>struct</code> 位于堆中（例如类字段、数组元素），它仍然是值类型，操作时是按值复制。</p>
<h3 data-id="heading-3">与 class 的区别</h3>













































<table><thead><tr><th>特性</th><th><code>class</code>(引用类型)</th><th><code>struct</code>(值类型)</th></tr></thead><tbody><tr><td>内存分配</td><td>堆（GC 管理）</td><td>栈/堆中嵌入</td></tr><tr><td>传递方式</td><td>按引用传递（复制引用）</td><td>按值传递（复制整个对象）</td></tr><tr><td>默认构造函数</td><td>可定义无参/有参</td><td>系统提供无参构造，用户<strong>不能定义</strong></td></tr><tr><td>继承</td><td>支持继承/虚方法</td><td>不能继承，只能实现接口</td></tr><tr><td>空值（null）</td><td>可以为 null</td><td>不可为 null（除非 <code>Nullable&lt;T&gt;</code>）</td></tr><tr><td>装箱/拆箱</td><td>不涉及</td><td>赋值给 <code>object</code> 时会装箱</td></tr><tr><td>性能</td><td>分配慢（GC）</td><td>分配快，生命周期短时更高效</td></tr></tbody></table>
<h3 data-id="heading-4">构造函数与初始化</h3>
<h4 data-id="heading-5">默认构造函数</h4>
<ul>
<li>
<p>所有结构体都有一个隐式的无参构造函数，将所有字段初始化为 默认值（如 <code>0</code>、<code>null</code>）。</p>
</li>
<li>
<p>用户不能显式定义无参构造函数（<code>C# 10</code> 开始支持，但有限制）。</p>
</li>
</ul>
<h4 data-id="heading-6">自定义构造函数</h4>
<p>可以定义有参构造函数，但必须初始化所有字段。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y</span>)</span>
{
    X = x;          <span class="hljs-comment">// 必须全部赋值</span>
    Y = y;
}
</code></pre>
<h4 data-id="heading-7">结构体的成员</h4>
<p>结构体可以包含：</p>
<ul>
<li>
<p>字段（<code>Field</code>）</p>
</li>
<li>
<p>属性（<code>Property</code>）</p>
</li>
<li>
<p>方法（<code>Method</code>）</p>
</li>
<li>
<p>事件（<code>Event</code>）</p>
</li>
<li>
<p>运算符重载</p>
</li>
<li>
<p>静态成员</p>
</li>
<li>
<p>构造函数（但无参构造受限）</p>
</li>
</ul>
<p>不支持：</p>
<ul>
<li>
<p>继承其他类/结构体（只能实现接口）。</p>
</li>
<li>
<p>明确的析构函数（<code>~Destructor</code>）。</p>
</li>
</ul>
<h3 data-id="heading-8">值类型的特性</h3>
<h4 data-id="heading-9">按值传递</h4>
<p>结构体赋值时会复制整个值：</p>
<pre><code class="hljs language-csharp" lang="csharp">Point p1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
Point p2 = p1;   <span class="hljs-comment">// 复制</span>
p2.X = <span class="hljs-number">99</span>;
Console.WriteLine(p1.X); <span class="hljs-comment">// 1，不受 p2 修改影响</span>
</code></pre>
<h4 data-id="heading-10">装箱/拆箱</h4>
<p>赋值给 <code>object</code> 或接口时，会将结构体复制到堆中：</p>
<pre><code class="hljs language-csharp" lang="csharp">Point p = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-built_in">object</span> obj = p;      <span class="hljs-comment">// 装箱：复制到堆</span>
Point p2 = (Point)obj; <span class="hljs-comment">// 拆箱：从堆复制回栈</span>
</code></pre>
<p>装箱/拆箱会带来性能开销，应尽量避免频繁发生。</p>
<h4 data-id="heading-11">不可变结构体（Immutable struct）</h4>
<p>为了避免复制带来的副作用，结构体推荐设计为不可变：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">struct</span> Point
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Y { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y</span>)</span> =&gt; (X, Y) = (x, y);
}
</code></pre>
<h4 data-id="heading-12">实现接口</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IDrawable</span>
{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>()</span>;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Circle : IDrawable
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Radius { <span class="hljs-keyword">get</span>; }
    <span class="hljs-keyword">public</span> Point Center { <span class="hljs-keyword">get</span>; }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Circle</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> radius, Point center</span>)</span>
    {
        Radius = radius;
        Center = center;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">$"Drawing circle at <span class="hljs-subst">{Center}</span> with radius <span class="hljs-subst">{Radius}</span>"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Area =&gt; Math.PI * Radius * Radius;
}
</code></pre>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">struct</span> Rectangle : IEquatable&lt;Rectangle&gt;
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Width, Height;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params">Rectangle other</span>)</span>
    {
        <span class="hljs-keyword">return</span> Width == other.Width &amp;&amp; Height == other.Height;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">Equals</span>(<span class="hljs-params"><span class="hljs-built_in">object</span> obj</span>)</span> =&gt; obj <span class="hljs-keyword">is</span> Rectangle other &amp;&amp; Equals(other);
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetHashCode</span>()</span> =&gt; HashCode.Combine(Width, Height);
}

<span class="hljs-keyword">var</span> r1 = <span class="hljs-keyword">new</span> Rectangle { Width = <span class="hljs-number">10</span>, Height = <span class="hljs-number">20</span> };
<span class="hljs-keyword">var</span> r2 = <span class="hljs-keyword">new</span> Rectangle { Width = <span class="hljs-number">10</span>, Height = <span class="hljs-number">20</span> };
Console.WriteLine(r1.Equals(r2)); <span class="hljs-comment">// 输出: True</span>
</code></pre>
<h4 data-id="heading-13">运算符重载示例</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">struct</span> Point
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> X, Y;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> x, <span class="hljs-built_in">int</span> y</span>)</span>
    {
        X = x;
        Y = y;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Point <span class="hljs-keyword">operator</span> +(Point a, Point b)
    {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Point(a.X + b.X, a.Y + b.Y);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToString</span>()</span> =&gt; <span class="hljs-string">$"(<span class="hljs-subst">{X}</span>, <span class="hljs-subst">{Y}</span>)"</span>;
}

<span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> p2 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
<span class="hljs-keyword">var</span> sum = p1 + p2;
Console.WriteLine(sum); <span class="hljs-comment">// 输出: (4, 6)</span>
</code></pre>
<h3 data-id="heading-14">结构体的新特性</h3>
<h4 data-id="heading-15">readonly struct</h4>
<ul>
<li>
<p>表示完全不可变。</p>
</li>
<li>
<p>编译器强制所有字段为 <code>readonly</code>。</p>
</li>
<li>
<p>防止无意修改。</p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">struct</span> Vector
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">double</span> X;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">double</span> Y;
}
</code></pre>
<h4 data-id="heading-16">ref struct</h4>
<ul>
<li>
<p>只能在栈上分配。</p>
</li>
<li>
<p>用于高性能场景，如 <code>Span&lt;T&gt;</code>。</p>
</li>
</ul>
<h4 data-id="heading-17">record struct</h4>
<p>值类型的 记录类型，支持内建的值比较、<code>with</code> 表达式。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> X, <span class="hljs-built_in">int</span> Y</span>)</span>;
<span class="hljs-keyword">var</span> p1 = <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>);
<span class="hljs-keyword">var</span> p2 = p1 <span class="hljs-keyword">with</span> { X = <span class="hljs-number">3</span> }; <span class="hljs-comment">// 基于值的复制</span>
</code></pre>
<h3 data-id="heading-18">高级用法</h3>
<h4 data-id="heading-19">与模式匹配结合使用</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> RGBColor
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">byte</span> R;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">byte</span> G;
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">byte</span> B;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RGBColor</span>(<span class="hljs-params"><span class="hljs-built_in">byte</span> r, <span class="hljs-built_in">byte</span> g, <span class="hljs-built_in">byte</span> b</span>)</span>
    {
        R = r;
        G = g;
        B = b;
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Deconstruct</span>(<span class="hljs-params"><span class="hljs-keyword">out</span> <span class="hljs-built_in">byte</span> r, <span class="hljs-keyword">out</span> <span class="hljs-built_in">byte</span> g, <span class="hljs-keyword">out</span> <span class="hljs-built_in">byte</span> b</span>)</span>
    {
        r = R;
        g = G;
        b = B;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetColorName</span>(<span class="hljs-params">RGBColor color</span>)</span>
    {
        <span class="hljs-keyword">return</span> color <span class="hljs-keyword">switch</span>
        {
            (<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-string">"Red"</span>,
            (<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-string">"Green"</span>,
            (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>) =&gt; <span class="hljs-string">"Blue"</span>,
            (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>) =&gt; <span class="hljs-string">"White"</span>,
            (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) =&gt; <span class="hljs-string">"Black"</span>,
            _ =&gt; <span class="hljs-string">"Unknown"</span>
        };
    }
    
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        RGBColor red = <span class="hljs-keyword">new</span> RGBColor(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        Console.WriteLine(GetColorName(red)); <span class="hljs-comment">// 输出: Red</span>
    }
}
</code></pre>
<h3 data-id="heading-20">适用场景</h3>
<p>✅ 适合：</p>
<ul>
<li>
<p>轻量级、小数据对象（坐标、颜色、矩形、数值容器等）。</p>
</li>
<li>
<p>高性能计算（避免 <code>GC</code> 开销）。</p>
</li>
<li>
<p>频繁创建销毁的对象。</p>
</li>
</ul>
<p>❌ 不适合：</p>
<ul>
<li>
<p>对象非常大（复制开销高）。</p>
</li>
<li>
<p>需要继承层次。</p>
</li>
<li>
<p>需要引用语义（共享同一对象）。</p>
</li>
</ul>
<blockquote>
<p>如果类型大小超过 16 字节，且频繁传递，建议使用 <code>class</code> 而不是 <code>struct</code>。</p>
</blockquote>
<h3 data-id="heading-21">实战示例</h3>
<h4 data-id="heading-22">高性能点计算</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">struct</span> Point
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">double</span> X;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">double</span> Y;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Point</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> x, <span class="hljs-built_in">double</span> y</span>)</span> =&gt; (X, Y) = (x, y);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Distance</span>(<span class="hljs-params">Point other</span>)</span> =&gt;
        Math.Sqrt(Math.Pow(X - other.X, <span class="hljs-number">2</span>) + Math.Pow(Y - other.Y, <span class="hljs-number">2</span>));
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Demo</span>()</span>
{
    Point p1 = <span class="hljs-keyword">new</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
    Point p2 = <span class="hljs-keyword">new</span>(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>);
    Console.WriteLine(p1.Distance(p2)); <span class="hljs-comment">// 5</span>
}
</code></pre>
<ul>
<li>
<p>无 <code>GC</code> 压力。</p>
</li>
<li>
<p>值传递保证线程安全。</p>
</li>
</ul>
<h3 data-id="heading-23">总结</h3>













































<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>类型</td><td>值类型（Value Type）</td></tr><tr><td>内存分配</td><td>栈分配或嵌入堆中</td></tr><tr><td>继承</td><td>不能继承其他类/结构体，只能实现接口</td></tr><tr><td>构造函数</td><td>系统提供无参构造；用户可定义有参构造</td></tr><tr><td>默认初始化</td><td>所有字段自动初始化为默认值</td></tr><tr><td>传递方式</td><td>按值传递（复制整个对象）</td></tr><tr><td>典型场景</td><td>小型数据对象（Point、Color）、高性能计算</td></tr><tr><td>高级特性</td><td><code>readonly struct</code>、<code>ref struct</code>、<code>record struct</code></td></tr><tr><td>设计建议</td><td>尽量保持不可变，避免装箱，避免过大对象</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[10 个强大且值得掌握的 Linux 命令]]></title>    <link>https://juejin.cn/post/7584651851905630227</link>    <guid>https://juejin.cn/post/7584651851905630227</guid>    <pubDate>2025-12-17T23:58:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905630227" data-draft-id="7584651851905613843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="10 个强大且值得掌握的 Linux 命令"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T23:58:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            10 个强大且值得掌握的 Linux 命令
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T23:58:48.000Z" title="Wed Dec 17 2025 23:58:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">10 个强大且值得掌握的 Linux 命令</h2>
<h3 data-id="heading-1">引言：当终端开始“解决问题”</h3>
<p>很多人第一次真正感受到 Linux 的能力，是在终端里执行了一条自己并不完全理解的命令：按下回车后，问题被快速定位或直接消失。没有图形界面，没有向导，也没有额外解释，只有结果。</p>
<p>Linux 早已不再被视为“难用的系统”，但它仍然提供了不少底层工具：它们能把系统状态和执行细节直接摊开，让排障从“猜测”变成“证据”。</p>
<p>下面整理 10 个非常实用的 Linux 命令。它们并不是什么“危险技巧”，但很多人在第一次用对之后，都会意识到：</p>
<p>“原来问题还可以这样查。”</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-12%2F10-linux-commands-that-feel-illegal-to-know" target="_blank" title="https://catchadmin.com/post/2025-12/10-linux-commands-that-feel-illegal-to-know" ref="nofollow noopener noreferrer">原文链接 10 个强大且值得掌握的 Linux 命令</a></p>
<h3 data-id="heading-2">strace：跟踪系统调用</h3>
<p><code>strace</code> 用于实时跟踪进程的系统调用（system call）及其返回值。</p>
<pre><code class="hljs language-bash" lang="bash">strace -p 1234
</code></pre>
<p>当程序“莫名其妙”失败时，<code>strace</code> 往往能让你直接看到它卡在了哪一步：文件访问、网络调用、权限检查，以及具体的错误码。</p>
<p>为什么它很有用：</p>
<ul>
<li>能定位失败发生在哪个系统调用</li>
<li>能快速发现权限不足、路径不存在、依赖缺失等问题</li>
<li>让“它不工作”变成可复盘的具体原因</li>
</ul>
<h3 data-id="heading-3">lsof：查看文件/端口占用</h3>
<p>当你删除文件、释放端口或卸载目录时遇到占用问题，<code>lsof</code> 可以列出正在使用目标资源的进程。</p>
<pre><code class="hljs language-bash" lang="bash">lsof /path/to/file
</code></pre>
<p>为什么它很有用：</p>
<ul>
<li>能快速定位“到底是谁在占用”</li>
<li>排查端口占用、文件句柄泄漏时非常直接</li>
<li>适合用于线上排障与运维定位</li>
</ul>
<h3 data-id="heading-4">dd：底层数据复制/写入工具</h3>
<p><code>dd</code> 是一个非常底层的工具，用于按块读取/写入数据。它常用于制作镜像、数据迁移、备份与恢复。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/sda
</code></pre>
<p>上面这条命令会把设备写入全 0 数据。在生产环境中误用，可能导致数据不可恢复，因此务必确认 <code>of=</code> 指向的目标设备。</p>
<p>为什么它很有用：</p>
<ul>
<li>可以直接对块设备进行读写</li>
<li>适合做镜像制作、备份与恢复</li>
<li>使用门槛不高，但风险很高，需要严格确认参数</li>
</ul>
<h3 data-id="heading-5">nc（netcat）：网络调试与临时通信</h3>
<p><code>nc</code>（Netcat）是一个轻量但非常强大的网络工具，可用于监听端口、测试连通性、传输数据等。</p>
<pre><code class="hljs language-bash" lang="bash">nc -l 4444
</code></pre>
<p>一行命令，你就开了一个监听端口。再多敲几下，你能传文件、测端口、临时搭服务、排查网络问题。</p>
<p>为什么它很有用：</p>
<ul>
<li>一条命令即可快速启动监听或建立连接</li>
<li>适合用于端口调试、服务联调与简单数据传输</li>
<li>工具轻量，适用范围很广</li>
</ul>
<h3 data-id="heading-6">watch：周期性执行命令</h3>
<p>有些问题需要观察变化过程，而不是只看某一刻的结果。</p>
<pre><code class="hljs language-bash" lang="bash">watch -n 1 <span class="hljs-built_in">df</span> -h
</code></pre>
<p>每秒刷新一次，你能看到磁盘占用实时变化；也能用来盯 CPU、内存、文件变化……不用写脚本、不用装 agent。</p>
<p>为什么它很有用：</p>
<ul>
<li>可以把任何命令输出快速变成“实时刷新”的视图</li>
<li>不依赖额外监控系统，排查现场问题很方便</li>
<li>适合观察磁盘、内存、进程等随时间变化的指标</li>
</ul>
<h3 data-id="heading-7">xargs：把输出转换为参数</h3>
<p><code>xargs</code> 会把上一条命令的输出转换为另一个命令的参数，是常见的批处理工具。</p>
<pre><code class="hljs language-bash" lang="bash">find . -name <span class="hljs-string">"*.log"</span> | xargs <span class="hljs-built_in">rm</span>
</code></pre>
<p>为什么它很有用：</p>
<ul>
<li>很多批量操作可以用一行管道完成</li>
<li>适合清理、检索、批处理文件等场景</li>
<li>让命令行工具的组合能力发挥出来</li>
</ul>
<h3 data-id="heading-8">nohup：让进程在会话结束后继续运行</h3>
<p>当你希望某个任务在断开 SSH、退出终端后继续运行时，可以使用 <code>nohup</code>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">nohup</span> long_task &amp;
</code></pre>
<p>你断开连接，它照样跑完。没人需要守着它。</p>
<p>为什么它很有用：</p>
<ul>
<li>适合跑长任务或后台任务</li>
<li>不需要保持终端会话</li>
<li>常用于脚本化与自动化执行</li>
</ul>
<h3 data-id="heading-9">/proc：通过虚拟文件系统查看系统信息</h3>
<p>Linux 会通过 <code>/proc</code> 这个虚拟文件系统暴露大量内核与进程信息。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /proc/cpuinfo
</code></pre>
<p>为什么它很有用：</p>
<ul>
<li>系统状态和硬件信息可以直接读取</li>
<li>排查性能与资源问题时很常用</li>
<li>让很多“系统内部信息”变得可见</li>
</ul>
<h3 data-id="heading-10">rsync：增量同步工具</h3>
<p><code>rsync</code> 不只是复制文件，它会根据差异进行增量传输，并能保留权限等元数据。</p>
<pre><code class="hljs language-bash" lang="bash">rsync -av --delete <span class="hljs-built_in">source</span>/ dest/
</code></pre>
<p>它只传差异文件、保留权限，还能把目录镜像得很干净。</p>
<p>为什么它很有用：</p>
<ul>
<li>适合用于备份、部署、目录镜像等场景</li>
<li>传输效率高，尤其适合大目录同步</li>
<li>在工程实践中非常常见</li>
</ul>
<h3 data-id="heading-11">history | grep：检索历史命令</h3>
<p>当你忘记自己以前用过哪条命令时，可以直接在 shell 的历史记录里搜索。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">history</span> | grep ssh
</code></pre>
<p>为什么它很有用：</p>
<ul>
<li>能快速复用过去的命令</li>
<li>排查与运维时能节省大量时间</li>
<li>随着使用时间增长，命令历史会变成一份可检索的经验库</li>
</ul>
<h3 data-id="heading-12">Linux 的特点：直接、透明</h3>
<p>这些命令之所以让人印象深刻，主要是因为它们减少了中间层：你能更直接地看到系统发生了什么、哪个环节出了问题、当前资源到底被谁占用。</p>
<p>Linux 不会替你隐藏复杂度，但它会把关键细节以可验证的方式提供出来。掌握这些工具之后，很多问题不再需要猜。</p>
<h3 data-id="heading-13">结语</h3>
<p>你不需要背下所有命令，但需要知道“有哪些手段可以用”。当你逐渐熟悉这些工具，Linux 对你来说就不只是一个系统，而是一套高效、可控的工作方式.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从已损坏的备份中拯救数据]]></title>    <link>https://juejin.cn/post/7584722109583474731</link>    <guid>https://juejin.cn/post/7584722109583474731</guid>    <pubDate>2025-12-17T16:15:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584722109583474731" data-draft-id="7584695558158942249" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从已损坏的备份中拯救数据"/> <meta itemprop="keywords" content="后端,运维,前端工程化"/> <meta itemprop="datePublished" content="2025-12-17T16:15:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇的程序员"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870859614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从已损坏的备份中拯救数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870859614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇的程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T16:15:55.000Z" title="Wed Dec 17 2025 16:15:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/020d21aaca80490da6d4c4b1e8c3ffee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=LRG%2BqijNWJbDmxuIFa%2BAFUB6V8U%3D" alt="999" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>12月15号早上，一觉醒来，拿起手机看到我的邮箱收到了内网服务无法访问的告警邮件，本以为只是简单的服务卡死，将服务器重启后就去上班了。</p>
<p>后来，陆续有好友联系我说网站挂了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/254461b49e2f493ea63d61b390d359f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=PjIICfEbNNcZ8be1jUt0dr25zm0%3D" alt="iPhone镜像 2025-12-17 21.18.12" loading="lazy"/></p>
<h2 data-id="heading-1">定位问题</h2>
<p>晚上下班回家后，尝试将电脑断电重启，发现pve只能存活2分钟左右，然后整个系统卡死，无法进行任何操作。首先，我想到的是：会不会某个vm虚拟机或者ct容器影响到宿主机了。</p>
<p>因为系统只能存活几分钟，在执行禁用操作的时候，强制重启了好几次服务器。当所有的服务都停止启动后，卡死的问题依旧存在。</p>
<h3 data-id="heading-2">翻日志</h3>
<p>没辙了，这已经不是简单的软件问题了，只好翻日志，看报错信息了。</p>
<pre><code class="hljs language-bash" lang="bash">nvme nvme0: I/O <span class="hljs-built_in">timeout</span>, aborting
</code></pre>
<p>如上所示，日志中出现了好几条I/O超时消息，顿感不妙，该不会硬盘坏了吧....</p>
<h3 data-id="heading-3">找到原因</h3>
<p>找了一圈方案，大部分都说这个错误是nvme硬盘的通病，他有一个省电模式，在某些硬件+内核的组合下会导致控制器假死。</p>
<p>解决方案也很简单，找到GRUB的配置文件，关闭他的自动睡眠和省电模式，在pve中这个文件位于<code>/etc/default/grub</code>，打开这个文件后，找到GRUB_CMDLINE_LINUX_DEFAULT属性，添加两个值：</p>
<ul>
<li>nvme_core.default_ps_max_latency_us=0</li>
<li>pcie_aspm=off</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">GRUB_CMDLINE_LINUX_DEFAULT=<span class="hljs-string">"quiet nvme_core.default_ps_max_latency_us=0 pcie_aspm=off"</span>
</code></pre>
<p>保存文件后，执行：<code>update-grub</code> 命令，随后重启整个pve主机。</p>
<h2 data-id="heading-4">VM无法启动</h2>
<p>pve启动卡死的问题解决了，现在又有了新的问题。启动我那台跑了整个网站服务的vm虚拟机时，出现了如下所示的错误：</p>
<pre><code class="hljs language-bash" lang="bash">mount: mounting /dev/sda3 /dev/sda3 on /sysroot failed: No error information
Mounting root failed.
initramfs emergency recovery shell launched.
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bef0a009e7c54e97a734efba093492b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=5kHjIvyVoY0kBuGEu80LxYZcIN4%3D" alt="2222" loading="lazy"/></p>
<p>这下坏事了，linux的根分区无法挂载了😭，应该是刚才频繁的卡死，我不断的启动pve，容器不停的启动、强制终止导致盘里这块区域的数据受损了，处于半死不活状态了。</p>
<h2 data-id="heading-5">从备份中还原</h2>
<p>幸好我之前设置了vm容器的整机备份，连续备份并存储3天，全部放在了内网另一台机器的机械硬盘中，通过网络挂载到pve上的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/259b1621715e4078a5d7bf10a916920f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=QTaRGIU%2BLRPjr1DDEEYDuHRNq2Y%3D" alt="image-20251217224605905" loading="lazy"/></p>
<p>本以为一切都会很顺利，还原的时候出现了错误， zstd 解码时，发现压缩块损坏，导致还原失败。</p>
<pre><code class="hljs language-bash" lang="bash">_15-03_00_03.vma.zst : Decoding error (36) : Corrupted block detected vma: restore failed - short vma extent (2801635 &lt; 3801600) /bin/bash: line 1: 2131 Exit 1 zstd -q -d -c /mnt/pve/nfs_usb_4t/dump/vzdump-qemu-100-2025_12_15-03_00_03.vma.zst
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3cb240a7baa488495a09bb804edd210~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=6XZhjc%2FgPPA0zJl%2F4si2b2oJDbU%3D" alt="image-20251217225055348" loading="lazy"/></p>
<p>于是，我又尝试了另外两个备份，结果都无法还原，全部都是相同的错误。当初做备份的时候，想着我都整机备份了，而且保存了3天的备份，总不可能三个全坏吧。</p>
<pre><code class="hljs language-bash" lang="bash">progress 99% (<span class="hljs-built_in">read</span> 318901321728 bytes, duration 722 sec) 

_13-03_00_02.vma.zst : Decoding error (36) : Restored data doesn<span class="hljs-string">'t match checksum progress 100% (read 322122547200 bytes, duration 755 sec) total bytes read 322122547200, sparse bytes 196604751872 (61%) space reduction due to 4K zero blocks 0.414% temporary volume '</span><span class="hljs-built_in">local</span>:121/vm-121-disk-0.qcow2<span class="hljs-string">' sucessfuly removed no lock found trying to remove '</span>create<span class="hljs-string">' lock error before or during data restore, some or all disks were not completely restored. VM 121 state is NOT cleaned up. TASK ERROR: command '</span><span class="hljs-built_in">set</span> -o pipefail &amp;&amp; zstd -q -d -c /mnt/pve/nfs_usb_4t/dump/vzdump-qemu-100-2025_12_13-03_00_02.vma.zst | vma extract -v -r /var/tmp/vzdumptmp10764.fifo - /var/tmp/vzdumptmp10764<span class="hljs-string">' failed: exit code 1
</span></code></pre>
<p>现在狠狠的打脸了，我手里目前只有<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2Fpost%2F175" target="_blank" title="https://www.kaisir.cn/post/175" ref="nofollow noopener noreferrer">2023年11月迁移技术栈</a>时，那份docker compose的初始数据。相当于我丢失了2年的数据，这我是不能接受的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b96d82c24784138b59bfe769ff3d449~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=nvsnSQ1e2Fa%2FaipD0iiY6G5J17s%3D" alt="毀滅吧我累了- 毀滅吧我累了updated their profile picture." loading="lazy"/></p>
<p>折腾到这里，我一看时间，已经凌晨1:30了，明天还要上班，带着郁闷的心情去睡觉了。</p>
<h2 data-id="heading-6">强行提取数据</h2>
<p>睡醒后，不愿接受这个现实，想到改造的那个<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2Fenglish-study%2F" target="_blank" title="https://www.kaisir.cn/english-study/" ref="nofollow noopener noreferrer">练习英语单词的开源项目</a>，这1年多时间下来，平均的日活跃人数已经有40多个了，数据库存储8w多条单词数据了😑，太难受了😭</p>
<p>实在是想不到什么好法子了，只好在v站和朋友圈都发了<a href="https://link.juejin.cn?target=https%3A%2F%2Fv2ex.com%2Ft%2F1179127" target="_blank" title="https://v2ex.com/t/1179127" ref="nofollow noopener noreferrer">求助帖</a>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047d0a8774e846a3b8179b49a423e284~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=zijU5Uh9n6wJ5oSMeZBvbi8lnVI%3D" alt="IMG_0911" loading="lazy"/></p>
<h3 data-id="heading-7">找到方案</h3>
<p>在此，感谢v站老哥<a href="https://link.juejin.cn?target=https%3A%2F%2Fv2ex.com%2Fmember%2FDylanC" target="_blank" title="https://v2ex.com/member/DylanC" ref="nofollow noopener noreferrer">DylanC</a>，给了我一组关键词。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704da5ee37a4422cadf3a4f1f0711cbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=bkDvRfctNziStIGuzFg7qxPnBNA%3D" alt="image-20251217231654428" loading="lazy"/></p>
<p>晚上回家后，开始找资料，问GPT，经过一番折腾总算是把数据提取出来了。</p>
<h3 data-id="heading-8">跳过校验</h3>
<p>从上述的错误日志中能看出，我在还原的时候已经读了99%的数据了，只是文件的完整性校验过不了，我的vm虚拟机里一整个全是docker compose编排的服务（mysql、redis、java、nginx等），理论上是比较好找回的。</p>
<p>pve的定时备份采用的是vzdump服务，备份出来的产物是<code>.vma.zst</code>格式的，他的本质是：</p>
<ul>
<li>zstd 压缩</li>
<li>内部是 <code>vma</code> 归档</li>
<li>包含：
<ul>
<li><code>qemu-server.conf</code></li>
<li><code>disk-drive-scsi0.raw</code></li>
</ul>
</li>
</ul>
<p>知道这些后，我们先把网络存储中的备份文件拷贝到pve主机的<code>/var/lib/vz/dump</code>目录，执行下述命令，忽略校验，强行解压。</p>
<pre><code class="hljs language-bash" lang="bash">zstd -d -c --no-check vzdump-qemu-100-2025_12_13-03_00_02.vma.zst \
| vma extract -v - ./extract.partial
</code></pre>
<p>等待一段时间后，程序执行结束，你会发现报错依然存在，但是这不影响已经读取的数据，cd到./extract.partial目录，你应该能看到<code>xxx.conf</code>和<code>xxx.raw</code>文件，然后看下.raw后缀文件的空间占用，只要不是太小(占用&lt;1GB)，那么这份数据基本是没问题的，磁盘的 RAW 文件也算是被解出来了。</p>
<h3 data-id="heading-9">挂载RAW磁盘</h3>
<p>为了防止数据遭到破坏，我们需要做只读挂载，命令如下：</p>
<pre><code class="hljs language-bash" lang="bash">losetup -fP /var/lib/vz/dump/extract.partial/disk-drive-scsi0.raw
</code></pre>
<p>然后，执行命令查看结果。</p>
<pre><code class="hljs language-bash" lang="bash">losetup -a
lsblk
</code></pre>
<p>执行后，应该能看到类似<code>loop0</code>、<code>loop0p1</code>、<code>loop0p2</code>这样的数据，找到那块空间跟你在extract.partial目录下看到的空间差不多大小的盘。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43800309663e4cb1a587c6959ae4a61f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=cP27t8xeOooOtugnEjf9Lug3LmM%3D" alt="image-20251217234910684" loading="lazy"/></p>
<h3 data-id="heading-10">挂载分区</h3>
<p>首先，我们通过下述命令来创建一个挂载点：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /mnt/rescue
</code></pre>
<p>随后，尝试挂载分区（loop0p1、loop0p2....等），找你的根分区，如果你运气好，p1就挂载成功了，那就不需要挂载其他的了。</p>
<p>我的根分区是p3，那么我挂载p3即可。</p>
<pre><code class="hljs language-bash" lang="bash">mount -o ro,norecovery /dev/loop0p3 /mnt/rescue
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b71255c3aad04b29b8bf9c5d1fcbfb3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=XCw%2FxWGDhG96gOArVILwLcuVuWU%3D" alt="image-20251217235136772" loading="lazy"/></p>
<p>如果失败的话，代表它不是文件系统，需要继续尝试挂载其他分区，直到成功为止。</p>
<pre><code class="hljs language-bash" lang="bash">umount /mnt/rescue 2&gt;/dev/null
mount -o ro,norecovery /dev/loop0p2 /mnt/rescue
</code></pre>
<p>最后，查看挂载点里是否有你的数据。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> /mnt/rescue
</code></pre>
<p>不出意外的话，你应该能看到类似下图所示的内容。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbb59c826bef4dc28fb5498c75cacb71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766592955&amp;x-signature=3ioKB0V0gkPF%2F4xQ21vHVyTg1qU%3D" alt="image-20251217235434358" loading="lazy"/></p>
<p>文件成功恢复，接下来要做的就是把这些文件拷贝到安全的地方即可。</p>
<h2 data-id="heading-11">写在最后</h2>
<p>至此，文章就分享完毕了。</p>
<p>我是<strong>神奇的程序员</strong>，一位前端开发工程师。</p>
<p>如果你对我感兴趣，请移步我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2F" target="_blank" title="https://www.kaisir.cn/" ref="nofollow noopener noreferrer">个人网站</a>，进一步了解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀你以为你在写 React？其实你在“搭一套前端操作系统”]]></title>    <link>https://juejin.cn/post/7584712109171425306</link>    <guid>https://juejin.cn/post/7584712109171425306</guid>    <pubDate>2025-12-17T16:37:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584712109171425306" data-draft-id="7584657447803469850" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 🚀你以为你在写 React？其实你在“搭一套前端操作系统”"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2025-12-17T16:37:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白兰地空瓶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             🚀你以为你在写 React？其实你在“搭一套前端操作系统”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白兰地空瓶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T16:37:20.000Z" title="Wed Dec 17 2025 16:37:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">——从 Vite + React 架构出发，对照 Vue，彻底看懂现代前端工程化</h2>
<blockquote>
<p>👉 <em>“现代前端不是写页面，而是在设计一套「运行在浏览器里的应用架构」。”</em></p>
</blockquote>
<hr/>
<h2 data-id="heading-1">一、先说结论：React / Vue 早就不只是“框架”了</h2>
<p>很多人学 React / Vue 的路径是这样的：</p>
<blockquote>
<p>JSX / template → 组件 → 状态 → 路由 → API 请求<br/>
✋ 到此为止</p>
</blockquote>
<p><strong>但面试官想听的不是这个。</strong></p>
<p>他们更关心的是：</p>
<ul>
<li>你知不知道<strong>项目是怎么被“跑起来”的</strong></li>
<li>dev / test / production 在架构层面有什么区别</li>
<li>React 和 Vue 在“设计哲学”上的根本差异</li>
</ul>
<p>而你给的这套 <strong>Vite + React 架构材料</strong>，刚好是理解这一切的<strong>钥匙</strong>。</p>
<hr/>
<h2 data-id="heading-2">二、npm init vite：不是创建项目，是“选择一套世界观”</h2>
<pre><code class="hljs language-csharp" lang="csharp">npm <span class="hljs-keyword">init</span> vite
</code></pre>
<p>表面上看：<br/>
👉 创建一个 React / Vue 项目</p>
<p>实际上是：</p>
<blockquote>
<p><strong>你在选择一套“前端运行时 + 构建体系 + 模块规范”的组合</strong></p>
</blockquote>
<h3 data-id="heading-3">为什么是 Vite？</h3>
<p>一句话总结：</p>
<blockquote>
<p><strong>Vite = 为 ESM 而生的开发期引擎</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-4">🔥 Vite 做了什么？</h3>





















<table><thead><tr><th>传统工具（Webpack）</th><th>Vite</th></tr></thead><tbody><tr><td>打包后再启动 dev server</td><td><strong>先启动 server</strong></td></tr><tr><td>一切都是 bundle</td><td><strong>开发期不打包</strong></td></tr><tr><td>冷启动慢</td><td><strong>ESM 原生加载，冷启动极快</strong></td></tr></tbody></table>
<p>📌 <strong>关键点</strong> ：</p>
<blockquote>
<p><strong>Vite 在 dev 阶段几乎不做打包，而是把模块加载权交给浏览器。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、dev → test → production：这是“阶段”，不是环境变量</h2>
<blockquote>
<p><strong>dev → test → production</strong></p>
</blockquote>
<p>很多人理解成：</p>
<blockquote>
<p>换几个 <code>.env</code> 文件</p>
</blockquote>
<p>❌ 错</p>
<h3 data-id="heading-6">正确理解是：</h3>





















<table><thead><tr><th>阶段</th><th>核心目标</th></tr></thead><tbody><tr><td>dev</td><td>开发效率最大化</td></tr><tr><td>test</td><td>稳定性、可测试</td></tr><tr><td>production</td><td>性能、体积、安全</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-7">为什么 devDependencies 和 dependencies 要分开？</h3>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> -D vite stylus
npm <span class="hljs-selector-tag">i</span> react react-dom
</code></pre>
<p>这是<strong>工程级别的架构意识</strong>。</p>
<ul>
<li><code>devDependencies</code><br/>
👉 <strong>只在开发和构建阶段存在</strong></li>
<li><code>dependencies</code><br/>
👉 <strong>最终会进到用户浏览器</strong></li>
</ul>
<p>📌 <strong>一句面试金句</strong>：</p>
<blockquote>
<p>“依赖划分的本质，是在控制「哪些代码会进入最终产物」。”</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">四、React 项目结构，本质是“三权分立”</h2>
<p>你现在的 React 架构，其实非常清晰：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">src</span>/
 ├─ <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.jsx</span>        <span class="hljs-comment">// 应用入口</span>
 ├─ <span class="hljs-selector-tag">App</span><span class="hljs-selector-class">.jsx</span>         <span class="hljs-comment">// 应用壳</span>
 ├─ <span class="hljs-selector-tag">router</span>/         <span class="hljs-comment">// 路由系统</span>
 ├─ <span class="hljs-selector-tag">pages</span>/          <span class="hljs-comment">// 页面级组件</span>
 ├─ <span class="hljs-selector-tag">components</span>/     <span class="hljs-comment">// 通用组件</span>
 └─ <span class="hljs-selector-tag">styles</span>/         <span class="hljs-comment">// 全局样式</span>
</code></pre>
<p>这背后是一个非常经典的思想：</p>
<blockquote>
<p><strong>入口、调度、业务 —— 各司其职</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-9">1️⃣ main.jsx：应用启动器（Bootloader）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>))
  .<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>)
</code></pre>
<p>📌 它只干一件事：</p>
<blockquote>
<p><strong>把 React 应用“挂”到真实 DOM 上</strong></p>
</blockquote>
<p>对比 Vue：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">createApp</span>(App)<span class="hljs-selector-class">.mount</span>('#app')
</code></pre>
<p>👉 <strong>本质完全一致</strong>：<br/>
都是“把虚拟世界接管真实 DOM”</p>
<hr/>
<h3 data-id="heading-10">2️⃣ App.jsx：应用壳（Shell）</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">AppRoutes</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span>
</code></pre>
<p>📌 App 不是页面<br/>
👉 <strong>App 是“应用框架”</strong></p>
<p>它负责：</p>
<ul>
<li>路由接管</li>
<li>布局结构</li>
<li>全局样式</li>
<li>上下文（Context）</li>
</ul>
<hr/>
<h3 data-id="heading-11">3️⃣ pages：页面级组件 ≠ 普通组件</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">Home</span> = () =&gt; {
  const <span class="hljs-section">[repos, setRepos]</span> = useState(<span class="hljs-section">[]</span>)
}
</code></pre>
<p>📌 <strong>页面组件的特点</strong>：</p>
<ul>
<li>和路由一一对应</li>
<li>负责数据请求</li>
<li>负责业务编排</li>
</ul>
<p>👉 <strong>它们是“业务容器”，不是 UI 零件</strong></p>
<hr/>
<h2 data-id="heading-12">五、React Router：不是路由库，是“前端导航系统”</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
  <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
</code></pre>
<h3 data-id="heading-13">BrowserRouter vs HashRouter</h3>
<p>你写得非常关键：</p>
<pre><code class="hljs language-arduino" lang="arduino">BrowserRouter <span class="hljs-comment">// HTML5 history</span>
HashRouter    <span class="hljs-comment">// # 路由</span>
</code></pre>
<p>📌 面试这样说直接加分：</p>
<blockquote>
<p>“BrowserRouter 更接近后端路由，但依赖服务器支持；HashRouter 是前端自包含方案。”</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">六、useState + useEffect：不是 API，是“状态驱动模型”</h2>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[repos, setRepos]</span> = <span class="hljs-built_in">useState</span>([])
</code></pre>
<p>很多人背：</p>
<blockquote>
<p>useState 是响应式<br/>
useEffect 是副作用</p>
</blockquote>
<p>但<strong>架构层的理解是</strong>：</p>
<hr/>
<h3 data-id="heading-15">React 的核心模型</h3>
<blockquote>
<p><strong>UI = f(state)</strong></p>
</blockquote>
<ul>
<li>state 改变</li>
<li>UI 自动重新计算</li>
</ul>
<p>而 <code>useEffect</code> 的存在是因为：</p>
<blockquote>
<p><strong>有些逻辑不属于“渲染”本身</strong></p>
</blockquote>
<p>比如：</p>
<ul>
<li>请求数据</li>
<li>订阅事件</li>
<li>操作 DOM</li>
</ul>
<hr/>
<h3 data-id="heading-16">对比 Vue</h3>





















<table><thead><tr><th>Vue</th><th>React</th></tr></thead><tbody><tr><td>ref / reactive</td><td>useState</td></tr><tr><td>watch / onMounted</td><td>useEffect</td></tr><tr><td>模板自动追踪依赖</td><td><strong>手动声明依赖</strong></td></tr></tbody></table>
<p>📌 <strong>哲学差异</strong>：</p>
<blockquote>
<p>Vue：我帮你想<br/>
React：你来决定</p>
</blockquote>
<hr/>
<h2 data-id="heading-17">七、Vue = react + react-dom？这句话为什么对</h2>
<blockquote>
<p><strong>vue = react(core) + react-dom(component render dom)</strong></p>
</blockquote>
<p>这句话的本质是：</p>
<ul>
<li>React：<strong>只关心状态 → UI 的映射</strong></li>
<li>react-dom：<strong>把虚拟 UI 映射到浏览器</strong></li>
<li>Vue：<strong>两者合一，外加编译期优化</strong></li>
</ul>
<p>📌 所以才有：</p>
<ul>
<li>React Native</li>
<li>React Three Fiber</li>
<li>Vue 的模板编译优化</li>
</ul>
<hr/>
<h2 data-id="heading-18">🔚 写在最后</h2>
<blockquote>
<p><strong>当你真正理解架构时，你就不再纠结“用 React 还是 Vue”。</strong></p>
<p>因为你知道：<br/>
👉 框架只是语法<br/>
👉 架构才是能力</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别抽卡玄学：OpenAI GPT Image 1.5 到底强在哪？]]></title>    <link>https://juejin.cn/post/7584639987213484066</link>    <guid>https://juejin.cn/post/7584639987213484066</guid>    <pubDate>2025-12-17T15:26:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584639987213484066" data-draft-id="7584702863688269839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别抽卡玄学：OpenAI GPT Image 1.5 到底强在哪？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-17T15:26:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别抽卡玄学：OpenAI GPT Image 1.5 到底强在哪？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:26:12.000Z" title="Wed Dec 17 2025 15:26:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>就在2025年12月17日，OpenAI 没有任何预兆地扔下了一枚重磅炸弹：GPT Image 1.5 正式上线。</p>
<p>对于在这个圈子里摸爬滚打的人来说，这一次的更新不仅仅是版本号的数字跳动，更像是一种风向标的彻底转变。如果说以前用 AI 生图像是在玩“抽卡游戏”，赌的是概率和运气，那么 GPT Image 1.5 的出现，终于让这门技术开始像真正的 PhotoShop 笔刷一样，变得听话、可控了。</p>
<p>作为一名长期关注生成式 AI 的创作者，我第一时间上手体验了这款被 OpenAI 寄予厚望的旗舰模型，甚至对比了隔壁 Google 家的 Nano Banana Pro。下面聊聊这一天体验下来的真实感受。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-17_23.13.20-1024x561.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-17_23.13.20-1024x561.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae5945bf03aa4f1fb7195948ad803740~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589972&amp;x-signature=8fQ7EJdnl%2FOL6Ld5G9YUfr0RwN4%3D" alt="iShot_2025-12-17_23.13.20" loading="lazy"/></a></p>
<p><strong>不再是“改一处，乱一片”</strong></p>
<p>一直以来，AI 生图最大的痛点就是“不可控”。你让它给人物换件衣服，它可能顺便把脸给换了，甚至连背后的光影和构图都给你重塑一遍。但在 GPT Image 1.5 上，OpenAI 终于把“精准控制”这块硬骨头啃下来了。</p>
<p>新模型的最大亮点在于它对“指令遵循”的变态级理解。官方称之为“精准编辑”，实测下来确实惊艳。当你要求“去掉桌上的咖啡杯”或者“给模特换上红色毛衣”时，它能极其克制地只修改你指定的区域，而画面原本的光照逻辑、人物的神态、甚至复杂的背景纹理，都能保持惊人的一致性。</p>
<p>对于设计师来说，这意味着 AI 终于能进真正的生产工作流了。OpenAI 甚至透露已经和迪士尼达成了合作，这本身就是对模型“角色一致性”最大的背书。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-17_23.15.08-1024x574.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-17_23.15.08-1024x574.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c7ca260811e4c63a58331c52deb5eb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589972&amp;x-signature=yMfskc8RWxQToMh0R8ltEvQi%2FsI%3D" alt="iShot_2025-12-17_23.15.08" loading="lazy"/></a></p>
<p><strong>快了四倍，还便宜了</strong></p>
<p>在性能方面，OpenAI 这次也一点没藏着掖着。GPT Image 1.5 的生成速度比上一代快了整整 4 倍。</p>
<p>以前生成一张高质量大图，你可能得盯着进度条发呆好一会儿，思路很容易被打断。现在的体验是，这边的提示词刚敲完，那边的图几乎就即时刷出来了，而且支持多图并行生成。这种流畅感，对于灵感稍纵即逝的创意工作者来说，是无价的。</p>
<p>更有意思的是，API 的调用成本反而降低了 20%。降价提速，摆明了是要抢占商业应用的市场，尤其是电商海报、产品变体图这些原本需要大量人工修图的领域。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-17_23.15.47-914x1024.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-17_23.15.47-914x1024.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9859969b3b54559bbd8705084efe167~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589972&amp;x-signature=ovY3e9bYanYy2w0tO2z4nKYo6d0%3D" alt="iShot_2025-12-17_23.15.47" loading="lazy"/></a></p>
<p><strong>文字渲染的惊喜与遗憾</strong></p>
<p>这一代模型在处理图片内的文字排版上有了长足进步。以前 AI 生成的文字大多是一堆不可名状的鬼画符，但现在 GPT Image 1.5 处理密集型的小字体、制作信息图表甚至海报排版，都能做到清晰可读。</p>
<p>但这引出了它的一个明显短板——中文。</p>
<p>不得不吐槽，虽然它的英文文本渲染能力很强，但在中文生成上依然经常“翻车”，错字连篇是常态。如果你指望直接用它生成一张带完美中文标语的电商海报，目前恐怕还得配合后期手动修图。这一点上，它依然不够接地气。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-17_23.16.23-1024x925.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-17_23.16.23-1024x925.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e2d6634d480459d9583a2d4b8e2541f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589972&amp;x-signature=JkGEld4aqp%2B7kYtHy1GWgUg5ss8%3D" alt="iShot_2025-12-17_23.16.23" loading="lazy"/></a></p>
<p><strong>真实感：还有提升空间</strong></p>
<p>虽然 GPT Image 1.5 在听话程度上做到了极致，但在画面的“绝对真实感”上，我认为它略逊于 Google 的 Nano Banana Pro。</p>
<p>在部分实测中，GPT Image 1.5 的出图依然带有一种难以言喻的“AI 味”——画面很完美，光影很正确，但就是太干净了，缺少真实摄影中那种粗粝的质感。相比之下，Google 的竞品在模拟真实照片的颗粒感和随机性上，目前似乎仍略胜一筹。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-17_23.16.35-1024x947.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-17_23.16.35-1024x947.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec207a3bc5845cb93e926b24a9527fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589972&amp;x-signature=CfFA4%2FG7ee0AKFnvldxsyuov7Nw%3D" alt="iShot_2025-12-17_23.16.35" loading="lazy"/></a></p>
<p><strong>写在最后</strong></p>
<p>总的来说，GPT Image 1.5 是一款极具“工具属性”的产品。OpenAI 似乎想通了，不再单纯追求生成多么天马行空的艺术画作，而是转头去解决“怎么让 AI 更好用”这个问题。</p>
<p>全新的 ChatGPT “图像”专用界面也印证了这一点：预设滤镜、所见即所得的编辑栏，体验越来越像一个简易版的创意工作室。</p>
<p>如果你是需要稳定输出、精细控制画面的商业用户或设计师，GPT Image 1.5 绝对是目前的效率神器；但如果你追求的是极致的摄影真实感，或者必须处理大量中文文本，那你可能还需要再观望一下，或者结合其他工具一起使用。</p>
<p>AI 生图，终于从“玩具”走向了“工具”。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[测试 mcp]]></title>    <link>https://juejin.cn/post/7584639987213582370</link>    <guid>https://juejin.cn/post/7584639987213582370</guid>    <pubDate>2025-12-17T15:43:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584639987213582370" data-draft-id="7584689488769646627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="测试 mcp"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-17T15:43:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="青椒肉丝_"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            测试 mcp
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    青椒肉丝_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:43:47.000Z" title="Wed Dec 17 2025 15:43:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>测试 mcp</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[APM（一）：Skywalking 与 Easyearch 集成]]></title>    <link>https://juejin.cn/post/7584722109583392811</link>    <guid>https://juejin.cn/post/7584722109583392811</guid>    <pubDate>2025-12-17T15:45:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584722109583392811" data-draft-id="7584695558158843945" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="APM（一）：Skywalking 与 Easyearch 集成"/> <meta itemprop="keywords" content="数据库,云原生"/> <meta itemprop="datePublished" content="2025-12-17T15:45:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="极限实验室"/> <meta itemprop="url" content="https://juejin.cn/user/1258294223312599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            APM（一）：Skywalking 与 Easyearch 集成
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1258294223312599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    极限实验室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:45:24.000Z" title="Wed Dec 17 2025 15:45:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>SkyWalking 是一个开源的可观测性平台，用于收集、分析、聚合和可视化服务和云原生基础设施的数据。SkyWalking 提供了一种简单的方法，即使在云之间也能保持对分布式系统的清晰视图。它是一个现代的 APM，专门为云原生、基于容器的分布式系统设计。</p>
<p>SkyWalking 涵盖了云原生世界中所有的可观测性需求，包括：</p>
<ul>
<li>Tracing: SkyWalking 原生数据格式，以及 v1 和 v2 格式的 Zipkin 跟踪都得到支持。</li>
<li>Metrics: SkyWalking 支持成熟的指标格式，包括原生计量格式、OTEL 指标格式和 Telegraf 格式。SkyWalking 与服务网格平台（通常为 Istio 和 Envoy）集成，将可观测性构建到数据平面或控制平面。此外，SkyWalking 原生代理可以在指标模式下运行，从而显著提升性能。</li>
<li>Logging: 包括从磁盘收集或通过网络收集的日志。原生代理可以自动将追踪上下文与日志绑定，或使用 SkyWalking 通过文本内容绑定追踪和日志。</li>
<li>Profiling: Profiling 是一种强大的工具，帮助开发者从代码行角度理解应用程序的性能。SkyWalking 提供了内置于原生语言代理和独立的 eBPF 代理的剖析功能。</li>
<li>Event: 事件是一种特殊类型的数据，用于记录系统中的重要时刻，例如版本升级、配置变更等。将事件与指标关联有助于解释指标中的峰值或谷值，将事件与追踪和日志关联有助于排查根本原因。</li>
</ul>
<p>更详细的信息请大家移步 <a href="https://link.juejin.cn?target=https%3A%2F%2Fskywalking.apache.org%2F" target="_blank" title="https://skywalking.apache.org/" ref="nofollow noopener noreferrer">Skywalking</a> 官方网站。</p>
<h2 data-id="heading-1">测试环境</h2>
<p>本篇使用的 Skywalking 版本是 10.2.0 ，需要 Java 11/17/21。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Feasysearch.cn" target="_blank" title="https://easysearch.cn" ref="nofollow noopener noreferrer">Easyearch</a> 使用的版本是 1.14.1，需要开启 Elastic 兼容模式，具体操作参考<a href="https://link.juejin.cn?target=https%3A%2F%2Finfinilabs.cn%2Fblog%2F2025%2Ffilebeat-8-connect-eaysearch%2F" target="_blank" title="https://infinilabs.cn/blog/2025/filebeat-8-connect-eaysearch/" ref="nofollow noopener noreferrer">文档</a> 。</p>
<h2 data-id="heading-2">生成 Java 密钥库文件</h2>
<p>使用如下命令将 Easysearch 的 CA 证书（ca.crt）导入到一个新的 Java 密钥库文件（es_keystore.jks）中，以便 SkyWalking 能够信任由该 CA 颁发的所有证书。生产环境中使用请替换命令中的密码。</p>
<pre><code class="hljs language-plain" lang="plain">keytool -import -v -trustcacerts -file ca.crt -keystore es_keystore.jks -keypass changeit -storepass changeit
</code></pre>
<h2 data-id="heading-3">修改配置文件</h2>
<p>SkyWalking 后端服务配置文件为 config/application.yml，这也是与 Easyearch 集成时需要修改的文件。Skywalking 与 Easyearch 集成有两种通信方式：http 或 https。http 方式非常简单，留给大家自行探索。本篇采用 https 方式，这也是 Easysearch 初始化后默认对外服务的协议。</p>
<p>拷贝上面生成的密钥库文件到 Skywalking 的 home 目录下，修改 application.yml 的 storage 部分</p>
<pre><code class="hljs language-plain" lang="plain">storage:
  selector: ${SW_STORAGE:elasticsearch}
  banyandb:
    # Since 10.2.0, the banyandb configuration is separated to an independent configuration file: `bydb.yaml`.
  elasticsearch:
    namespace: ${SW_NAMESPACE:""}
    clusterNodes: ${SW_STORAGE_ES_CLUSTER_NODES:es1.infini.cloud:9200}
    protocol: ${SW_STORAGE_ES_HTTP_PROTOCOL:"https"}
    connectTimeout: ${SW_STORAGE_ES_CONNECT_TIMEOUT:3000}
    socketTimeout: ${SW_STORAGE_ES_SOCKET_TIMEOUT:30000}
    responseTimeout: ${SW_STORAGE_ES_RESPONSE_TIMEOUT:15000}
    numHttpClientThread: ${SW_STORAGE_ES_NUM_HTTP_CLIENT_THREAD:0}
    user: ${SW_ES_USER:"admin"}
    password: ${SW_ES_PASSWORD:"infiniyyds@2025"}
    trustStorePath: ${SW_STORAGE_ES_SSL_JKS_PATH:"../es_keystore.jks"}
    trustStorePass: ${SW_STORAGE_ES_SSL_JKS_PASS:"changeit"}
</code></pre>
<p>注意 clusterNodes 配置的是域名，需要在 Skywalking 的主机上用 /etc/hosts 解析成具体的地址，如果有多个 Easysearch 节点，可以用逗号分隔。</p>
<h2 data-id="heading-4">启动</h2>
<p>确保 Easysearch 启动完毕后，再启动 Skywalking。正常启动完成后，可访问 Skywalking 服务页面，默认端口 8080。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe31a5b115ff4fb7b7715f1b43de0715~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766591124&amp;x-signature=dU38PL3hatuLF7MOqB%2BywHF6vLM%3D" alt="" loading="lazy"/></p>
<p>正常连接后，Skywalking 会在 Easysearch 中创建很多 sw 开头的索引。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e1e6ebbc0dc4d689bc34fc7b0025aeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766591124&amp;x-signature=ZlwZDf1fS4yNCMbB79vCYCkb04g%3D" alt="" loading="lazy"/></p>
<p>OK，服务集成就到此完毕，后续我们将探索更多的 APM 内容。</p>
<h2 data-id="heading-5">关于 Easysearch</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7542ae07a8a74ff98fd2758290090392~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B6ZmQ5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766591124&amp;x-signature=I7EipEsj5Wc5FA%2Fn%2BZTWpwgMAwE%3D" alt="" loading="lazy"/></p>
<p>INFINI Easysearch 是一个分布式的搜索型数据库，实现非结构化数据检索、全文检索、向量检索、地理位置信息查询、组合索引查询、多语种支持、聚合分析等。Easysearch 可以完美替代 Elasticsearch，同时添加和完善多项企业级功能。Easysearch 助您拥有简洁、高效、易用的搜索体验。</p>
<p>官网文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.infinilabs.com%2Feasysearch" target="_blank" title="https://docs.infinilabs.com/easysearch" ref="nofollow noopener noreferrer">docs.infinilabs.com/easysearch</a></p>
<blockquote>
<p>作者：杨帆，极限科技（INFINI Labs）高级解决方案架构师、《老杨玩搜索》栏目 B 站 UP 主，拥有十余年金融行业服务工作经验，熟悉 Linux、数据库、网络等领域。目前主要从事 Easysearch、Elasticsearch 等搜索引擎的技术支持工作，服务国内私有化部署的客户。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI服务商切换太麻烦?一个AI Gateway搞定监控、缓存和故障转移(成本降40%)]]></title>    <link>https://juejin.cn/post/7584712109171359770</link>    <guid>https://juejin.cn/post/7584712109171359770</guid>    <pubDate>2025-12-17T15:48:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584712109171359770" data-draft-id="7584714813365288998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI服务商切换太麻烦?一个AI Gateway搞定监控、缓存和故障转移(成本降40%)"/> <meta itemprop="keywords" content="OpenAI,API,后端"/> <meta itemprop="datePublished" content="2025-12-17T15:48:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术更好说"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI服务商切换太麻烦?一个AI Gateway搞定监控、缓存和故障转移(成本降40%)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术更好说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:48:14.000Z" title="Wed Dec 17 2025 15:48:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d51415f7bca49dfa6ff6eb9f798aa93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5pu05aW96K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766591294&amp;x-signature=rt87muK4JZcRFBDDK4b3CbojyRA%3D" alt="2.jpg" loading="lazy"/>
凌晨两点,你被电话吵醒,客户说AI功能挂了。打开监控一看,OpenAI又双叒限流了。你赶紧打开代码,把所有<code>openai.chat.completions.create</code>改成Claude的API,结果发现Claude的请求格式完全不一样,<code>messages</code>要改成<code>anthropic.messages.create</code>,参数结构也不对...改到三点半终于上线,累得要死。
第二天早上,老板发来账单截图:"这个月AI费用怎么从500美元飙到8000美元了?!"你一脸懵,根本不知道钱都花哪了,哪个团队用得最多,有多少是重复请求...完全一团乱麻。
说实话,这种痛苦经历,只要做过AI应用的人都懂。多个AI服务商切来切去太麻烦,成本失控心里慌,服务挂了业务就炸,想想都头疼。
其实,你只需要一个<strong>AI Gateway</strong>,就能彻底解决这些问题。改一行代码,OpenAI、Claude、Gemini随便切;自动故障转移,主模型挂了秒切备用;智能缓存加监控,成本直接降40%。今天这篇文章,我手把手教你10分钟搭建自己的AI Gateway,从此告别半夜改代码的噩梦。</p>
<h2 data-id="heading-0">为什么需要AI Gateway?三个真实痛点</h2>
<h3 data-id="heading-1">痛点1:多服务商切换是噩梦</h3>
<p>你可能有这种经历:项目开始用的OpenAI GPT-4,后来发现Anthropic的Claude在某些任务上效果更好,于是想切过去试试。打开代码一看,整个人都不好了。
OpenAI是这样调用的:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({<span class="hljs-attr">apiKey</span>: <span class="hljs-string">'sk-xxx'</span>});
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"Hello"</span>}]
});
</code></pre>
<p>Claude是这样的:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> anthropic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Anthropic</span>({<span class="hljs-attr">apiKey</span>: <span class="hljs-string">'sk-ant-xxx'</span>});
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> anthropic.<span class="hljs-property">messages</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>,
  <span class="hljs-attr">max_tokens</span>: <span class="hljs-number">1024</span>,
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"Hello"</span>}]
});
</code></pre>
<p>看到没?连基础结构都不一样,还有一堆参数差异。如果你的代码里有几十个地方调用AI,改起来能崩溃。更惨的是,Google Gemini、Cohere、Azure OpenAI...每家API格式都不一样,这哪顶得住啊!
数据不会骗人:调研显示<strong>70%的AI应用都在用2个以上的模型服务商</strong>。为啥?不同模型擅长不同任务,GPT-4贵但效果好,Claude便宜点适合批量,Gemini免费额度高适合测试...你总得切换吧?但切换成本高到让人怀疑人生。</p>
<h3 data-id="heading-2">痛点2:成本黑洞无法控制</h3>
<p>说个真事:我朋友公司做了个AI客服,开始每月500美元,挺正常。突然某个月账单8000美元,老板直接炸了。查了半天才发现,是有个开发测试时忘了删日志,每次请求都调了两遍API,而且缓存没开,同样的问题重复问了无数次。
这就是没有统一监控的痛。你根本不知道:</p>
<ul>
<li><strong>每天花了多少钱?</strong> 等账单出来已经晚了</li>
<li><strong>哪个团队用得最猛?</strong> 产品那边在疯狂测试,你还被蒙在鼓里</li>
<li><strong>哪些请求最贵?</strong> GPT-4的长文本生成是大头,但你不知道</li>
<li><strong>有多少浪费?</strong> 40%的重复请求在烧钱,你看不见
某机构报告显示,企业AI支出同比增长<strong>300%</strong>,但其中有<strong>40%是重复请求造成的浪费</strong>。这钱花得多冤啊!</li>
</ul>
<h3 data-id="heading-3">痛点3:单点故障随时爆炸</h3>
<p>2024年OpenAI至少宕机了6次,平均每次2小时。如果你的服务完全依赖OpenAI,那就是:</p>
<ul>
<li>凌晨4点,告警炸了</li>
<li>客户投诉涌进来</li>
<li>你盯着OpenAI状态页面干着急</li>
<li>老板问你怎么回事,你说"OpenAI挂了,我也没办法"</li>
<li>老板:"那为啥不搞个备用的?"</li>
<li>你:"......"
没有容错机制就是这么被动。主模型一挂,业务跟着挂,完全没有Plan B。你说慌不慌?
其实,如果有个<strong>AI Gateway配置好自动故障转移(Fallback)</strong>,OpenAI挂了自动切换到Claude,Claude也挂了再切Gemini,整个过程秒级完成,用户甚至感觉不到。可用性直接从95%干到99.9%以上。</li>
</ul>
<h2 data-id="heading-4">AI Gateway核心功能全解析</h2>
<p>说了这么多痛点,那AI Gateway到底是咋解决的?其实它就像一个超级中间层,站在你的应用和各个AI服务商之间,帮你搞定所有脏活累活。</p>
<h3 data-id="heading-5">功能1:统一API入口 - 一套代码走天下</h3>
<p>这个功能简直太爽了。你还是用熟悉的OpenAI SDK写代码,但只需要改一行<code>baseURL</code>,就能调用Claude、Gemini、甚至200+种模型。
比如用Portkey Gateway,你的代码是这样:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'your-openai-key'</span>,
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:8787/v1"</span>,  <span class="hljs-comment">// 就改这一行!</span>
  <span class="hljs-attr">defaultHeaders</span>: {
    <span class="hljs-string">'x-portkey-provider'</span>: <span class="hljs-string">'openai'</span>  <span class="hljs-comment">// 想切Claude?改成'anthropic'就行</span>
  }
});
<span class="hljs-comment">// 后面代码一行不改</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"Hello"</span>}]
});
</code></pre>
<p>想切换到Claude?把<code>x-portkey-provider</code>改成<code>anthropic</code>,model改成<code>claude-3-5-sonnet-20241022</code>,完事!不用改任何业务逻辑,是不是超简单?
Cloudflare的方案也类似,只需要把baseURL指向他们的Gateway endpoint就行。这样一来,你随时可以在OpenAI、Anthropic、Google、Azure之间切换,再也不用改一堆代码了。</p>
<h3 data-id="heading-6">功能2:智能缓存省钱 - 重复问题不花钱</h3>
<p>这个功能是真省钱。原理很简单:AI Gateway会记住之前问过的问题和答案,如果有人又问了一遍,直接返回缓存结果,不调用API,不花token。
AI Gateway支持两种缓存:</p>
<ul>
<li><strong>精确缓存</strong>:问题文本完全一样才命中。比如你问了"什么是AI?",下次再问这6个字,直接返回缓存</li>
<li><strong>语义缓存</strong>:意思差不多就行。"什么是AI?"和"AI是什么?"是同一个意思,也能命中缓存
阿里云的数据显示,<strong>通义千问的缓存命中价格只有原价的40%</strong>。如果你的缓存命中率能做到50%,成本直接砍一半!
实际场景超级有用。比如客服机器人,用户经常问"怎么退货?""运费多少?",这些高频问题开启缓存后,成本能降60%以上。
不过要注意,实时性要求高的别用缓存。比如"今天天气怎么样?""最新新闻是啥?",这种问题缓存了就不对了。AI Gateway一般允许你配置缓存规则,哪些路径开缓存,缓存多久(TTL),都能自己定。</li>
</ul>
<h3 data-id="heading-7">功能3:自动故障转移(Fallback) - 主模型挂了秒切备用</h3>
<p>这个功能是稳定性保障。你可以配置多级Fallback策略,比如:</p>
<ol>
<li>先调OpenAI GPT-4,重试5次</li>
<li>如果还失败,自动切换到Claude 3.5 Sonnet</li>
<li>Claude也挂了,最后用Gemini Pro兜底
整个过程自动化,你的业务代码完全无感知。看个Portkey的配置示例:</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"retry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"strategy"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fallback"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-xxx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-ant-xxx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3-5-sonnet-20241022"</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gt5xxx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-pro"</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>只要在header里传这个配置,Gateway就会按照你设定的顺序自动Fallback。Cloudflare的Universal Endpoint也支持类似功能,一个请求里填多个provider,自动切换。
有了这个,可用性能从95%提升到<strong>99.9%以上</strong>。OpenAI宕机?不怕,自动切Claude。Claude限流?没事,Gemini顶上。用户根本察觉不到,稳得一批。</p>
<h3 data-id="heading-8">功能4:请求监控和成本分析 - 花钱心里有数</h3>
<p>AI Gateway会实时记录每个请求的关键指标:</p>
<ul>
<li><strong>QPS</strong>:每秒请求数,流量高峰一目了然</li>
<li><strong>Token消耗</strong>:每个模型用了多少token,实时统计</li>
<li><strong>成本</strong>:按不同模型的定价算出实际花费</li>
<li><strong>错误率</strong>:哪些请求失败了,什么原因
Cloudflare的监控面板特别强,除了基础的QPS和Error Rate,还有专门针对LLM的Token、Cost和Cache命中率面板。你能看到:</li>
<li>今天花了多少钱,趋势是涨是跌</li>
<li>哪个团队(消费者)用得最多</li>
<li>哪个模型最贵</li>
<li>缓存帮你省了多少钱
这下心里有数了吧?成本失控的问题彻底解决。你还能设置告警,比如"日消耗超100美元就通知我",预算超了第一时间知道。</li>
</ul>
<h3 data-id="heading-9">功能5:限流和权限管理 - 不让某个团队搞崩服务</h3>
<p>企业级场景必备功能。你可以给不同团队分配独立的API Key,每个Key有自己的配额和限流规则。
比如:</p>
<ul>
<li>研发团队:每天10万token额度,用GPT-4</li>
<li>测试团队:每天1万token额度,只能用GPT-3.5</li>
<li>产品团队:每天5万token额度,用Claude
这样一来,测试团队疯狂调用也不会把额度耗光,影响生产环境。每个团队用了多少,一清二楚。
高级一点的AI Gateway还支持<strong>敏感内容过滤</strong>,自动检测和拦截违规请求,保护数据安全。阿里云Higress就有这个能力,企业级安全管控都能搞定。</li>
</ul>
<h2 data-id="heading-10">三大主流方案对比:Cloudflare vs Portkey vs 阿里云</h2>
<p>市面上AI Gateway方案挺多,但主流的就这三家。咱们客观对比一下,帮你选出最适合的。</p>
<h3 data-id="heading-11">方案1:Cloudflare AI Gateway - 新手友好,上手最快</h3>
<p><strong>优势</strong>:</p>
<ul>
<li><strong>完全免费</strong>:所有Cloudflare账号都能用,不额外收费</li>
<li><strong>零部署</strong>:不用装任何东西,注册账号就能用</li>
<li><strong>一行代码接入</strong>:改个baseURL就行,5分钟搞定</li>
<li><strong>全球加速</strong>:靠Cloudflare的CDN网络,速度快
<strong>限制</strong>:</li>
<li>数据会经过Cloudflare的服务器(虽然他们承诺不看)</li>
<li>语义缓存还在计划中,目前只有精确缓存</li>
<li>支持的模型相对少,10+主流提供商
<strong>适合场景</strong>:</li>
<li>个人项目,快速验证想法</li>
<li>小团队,没有运维资源</li>
<li>对数据隐私要求不那么严格的场景
Cloudflare的数据很牛,自2023年9月beta版发布以来,已经代理了<strong>超过5亿个请求</strong>。证明确实好用,大家都在用。</li>
</ul>
<h3 data-id="heading-12">方案2:Portkey Gateway - 企业首选,功能最强</h3>
<p><strong>优势</strong>:</p>
<ul>
<li><strong>开源免费</strong>:GitHub上开源,私有部署完全可控</li>
<li><strong>支持超多模型</strong>:200+ LLM,基本你能想到的都支持</li>
<li><strong>性能爆表</strong>:官方数据比其他网关快9.9倍,安装后仅45kb</li>
<li><strong>功能最全</strong>:负载均衡、自动重试、指数退避、50+护栏规则全都有
<strong>部署方式</strong>:</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地运行超简单</span>
npx @portkey-ai/gateway
<span class="hljs-comment"># 你的AI Gateway现在运行在 http://localhost:8787</span>
</code></pre>
<p><strong>特色功能</strong>:</p>
<ul>
<li>支持语义缓存(DashVector向量缓存)</li>
<li>自动重试机制特别智能,结合指数退避策略</li>
<li>可以部署到Cloudflare Workers、Docker、Node.js、Replit等多种环境
<strong>适合场景</strong>:</li>
<li>中大型企业,有数据安全合规要求</li>
<li>需要私有化部署</li>
<li>想要最强大的功能和最高的性能</li>
</ul>
<h3 data-id="heading-13">方案3:阿里云Higress - 国内企业最佳</h3>
<p><strong>优势</strong>:</p>
<ul>
<li><strong>国内访问快</strong>:服务器在国内,延迟低</li>
<li><strong>深度集成</strong>:无缝对接阿里云百炼、PAI平台</li>
<li><strong>企业级稳定</strong>:阿里内部在用,支撑他们自己的AI应用</li>
<li><strong>MCP协议支持</strong>:支持API快速转MCP,适配最新标准
<strong>技术亮点</strong>:</li>
<li>三合一架构:容器网关 + 微服务网关 + AI网关</li>
<li>支持多云和私有化部署</li>
<li>专门针对国内大模型优化(通义、文心一言等)
<strong>适合场景</strong>:</li>
<li>已经在用阿里云的企业</li>
<li>需要混合云架构(本地+云端)</li>
<li>主要面向国内用户,延迟敏感</li>
</ul>
<h3 data-id="heading-14">三大方案对比表</h3>







































































<table><thead><tr><th>功能</th><th>Cloudflare</th><th>Portkey</th><th>Higress</th></tr></thead><tbody><tr><td><strong>部署方式</strong></td><td>云服务</td><td>开源/云服务</td><td>私有化/云</td></tr><tr><td><strong>价格</strong></td><td>免费</td><td>开源免费</td><td>按量付费</td></tr><tr><td><strong>支持模型数</strong></td><td>10+</td><td>200+</td><td>主流全覆盖</td></tr><tr><td><strong>语义缓存</strong></td><td>计划中</td><td>✅ 支持</td><td>✅ 支持</td></tr><tr><td><strong>私有部署</strong></td><td>❌</td><td>✅</td><td>✅</td></tr><tr><td><strong>国内访问</strong></td><td>一般</td><td>一般</td><td>⭐⭐⭐</td></tr><tr><td><strong>监控面板</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐</td></tr><tr><td><strong>上手难度</strong></td><td>超简单</td><td>简单</td><td>中等</td></tr><tr><td><strong>企业级功能</strong></td><td>基础</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td></tr><tr><td><strong>我的建议</strong>:</td><td/><td/><td/></tr></tbody></table>
<ul>
<li><strong>个人项目/快速测试</strong> → Cloudflare,5分钟上手,完全免费</li>
<li><strong>创业公司/中小企业</strong> → Portkey,开源免费,功能够用</li>
<li><strong>大型企业/已用阿里云</strong> → Higress,稳定可靠,服务有保障</li>
<li><strong>海外项目</strong> → Cloudflare或Portkey,别选国内的</li>
<li><strong>国内项目且延迟敏感</strong> → Higress,国内访问最快</li>
</ul>
<h2 data-id="heading-15">实战演练:10分钟搭建你的第一个AI Gateway</h2>
<p>光说不练假把式,咱们直接动手搞一个。我选<strong>Portkey</strong>做示范,因为它本地就能跑,不用注册账号,最快验证效果。</p>
<h3 data-id="heading-16">Step 1:一键部署Gateway(30秒)</h3>
<p>打开终端,运行:</p>
<pre><code class="hljs language-bash" lang="bash">npx @portkey-ai/gateway
</code></pre>
<p>看到这个提示就成功了:</p>
<pre><code class="hljs language-arduino" lang="arduino">🚀 AI Gateway running on http:<span class="hljs-comment">//localhost:8787</span>
</code></pre>
<p>就这么简单!你的AI Gateway已经在本地跑起来了。控制台访问 <code>http://localhost:8787/public/</code> 还能看到管理界面。</p>
<h3 data-id="heading-17">Step 2:配置多模型Fallback(2分钟)</h3>
<p>现在配置一个三级备份策略:OpenAI → Claude → Gemini。
创建一个配置文件 <code>gateway-config.json</code>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"retry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"strategy"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fallback"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的OpenAI Key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的Claude Key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的Google Key"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-pro"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>配置说明</strong>:</p>
<ul>
<li><code>retry.count: 5</code> → 主模型失败时重试5次</li>
<li><code>strategy.mode: "fallback"</code> → 使用故障转移模式</li>
<li><code>targets</code> → 按顺序尝试三个提供商</li>
</ul>
<h3 data-id="heading-18">Step 3:改造你的业务代码(1分钟)</h3>
<p>原来你的代码可能是这样:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'sk-xxx'</span>
});
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"写一首诗"</span>}]
});
</code></pre>
<p>现在只需要改3行:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'./gateway-config.json'</span>));
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'any-key'</span>,  <span class="hljs-comment">// 不重要了,配置文件里有真实的key</span>
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:8787/v1"</span>,  <span class="hljs-comment">// 👈 改这里</span>
  <span class="hljs-attr">defaultHeaders</span>: {
    <span class="hljs-string">'x-portkey-config'</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config)  <span class="hljs-comment">// 👈 加这个</span>
  }
});
<span class="hljs-comment">// 后面完全不用改!</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4"</span>,  <span class="hljs-comment">// 这个会被配置里的override_params覆盖</span>
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"写一首诗"</span>}]
});
</code></pre>
<p>就这样!现在你的代码已经有了三级容错能力。OpenAI挂了自动切Claude,完全无感知。</p>
<h3 data-id="heading-19">Step 4:测试Fallback效果(1分钟)</h3>
<p>故意让OpenAI失败,验证是否自动切换。把配置文件里OpenAI的api_key改成错误的:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-wrong-key"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 👈 故意写错</span>
  <span class="hljs-attr">"override_params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>运行代码,观察日志:</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Gateway</span>] OpenAI request failed: Invalid API Key
[<span class="hljs-meta">Gateway</span>] Retrying <span class="hljs-keyword">with</span> anthropic...
[<span class="hljs-meta">Gateway</span>] <span class="hljs-function">Success <span class="hljs-keyword">with</span> <span class="hljs-title">anthropic</span> (<span class="hljs-params">claude<span class="hljs-number">-3</span><span class="hljs-number">-5</span>-sonnet<span class="hljs-number">-20241022</span></span>)
</span></code></pre>
<p>看到没?Gateway检测到OpenAI失败后,自动重试了5次,然后切换到Claude,最终成功返回结果。整个过程自动化,你的代码完全不需要处理错误。</p>
<h3 data-id="heading-20">Step 5:开启缓存降低成本(2分钟)</h3>
<p>Portkey支持缓存,但需要配置。简化版可以用Redis:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 如果你有Redis,可以这样配置缓存</span>
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:8787/v1"</span>,
  <span class="hljs-attr">defaultHeaders</span>: {
    <span class="hljs-string">'x-portkey-config'</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config),
    <span class="hljs-string">'x-portkey-cache'</span>: <span class="hljs-string">'simple'</span>,  <span class="hljs-comment">// 开启简单缓存</span>
    <span class="hljs-string">'x-portkey-cache-force-refresh'</span>: <span class="hljs-string">'false'</span>
  }
});
</code></pre>
<p>第一次请求:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"什么是AI?"</span>}]
});
<span class="hljs-comment">// 调用真实API,耗时800ms,花费0.002美元</span>
</code></pre>
<p>第二次相同请求:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"什么是AI?"</span>}]
});
<span class="hljs-comment">// 命中缓存,耗时50ms,花费0美元</span>
</code></pre>
<p>看到效果了吧?速度快了16倍,成本直接省掉。高频问题越多,省得越多。</p>
<h3 data-id="heading-21">Step 6:查看监控数据(1分钟)</h3>
<p>访问 <code>http://localhost:8787/public/</code>,你能看到:</p>
<ul>
<li>总请求数和成功率</li>
<li>每个provider的调用次数</li>
<li>缓存命中率</li>
<li>错误日志
虽然Portkey本地版的监控面板比较简单,但够用了。如果你要更强大的监控,可以:</li>
<li>用Portkey Cloud(他们的托管版,免费额度够个人用)</li>
<li>换Cloudflare AI Gateway(监控面板超强)</li>
<li>自己对接Prometheus + Grafana</li>
</ul>
<h3 data-id="heading-22">完整示例代码</h3>
<p>把上面的整合起来,一个完整的例子:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">OpenAI</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'openai'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-comment">// 读取配置文件</span>
<span class="hljs-keyword">const</span> config = {
  <span class="hljs-string">"retry"</span>: {<span class="hljs-string">"count"</span>: <span class="hljs-number">5</span>},
  <span class="hljs-string">"strategy"</span>: {<span class="hljs-string">"mode"</span>: <span class="hljs-string">"fallback"</span>},
  <span class="hljs-string">"targets"</span>: [
    {
      <span class="hljs-string">"provider"</span>: <span class="hljs-string">"openai"</span>,
      <span class="hljs-string">"api_key"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_KEY</span>,
      <span class="hljs-string">"override_params"</span>: {<span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4"</span>}
    },
    {
      <span class="hljs-string">"provider"</span>: <span class="hljs-string">"anthropic"</span>,
      <span class="hljs-string">"api_key"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANTHROPIC_KEY</span>,
      <span class="hljs-string">"override_params"</span>: {<span class="hljs-string">"model"</span>: <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>}
    }
  ]
};
<span class="hljs-comment">// 初始化客户端</span>
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'placeholder'</span>,
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"http://localhost:8787/v1"</span>,
  <span class="hljs-attr">defaultHeaders</span>: {
    <span class="hljs-string">'x-portkey-config'</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config),
    <span class="hljs-string">'x-portkey-cache'</span>: <span class="hljs-string">'simple'</span>
  }
});
<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> client.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-4"</span>,  <span class="hljs-comment">// 实际模型由配置决定</span>
    <span class="hljs-attr">messages</span>: [{<span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: prompt}]
  });
  <span class="hljs-keyword">return</span> response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>;
}
<span class="hljs-comment">// 测试</span>
<span class="hljs-title function_">chat</span>(<span class="hljs-string">"用一句话解释AI Gateway"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
</code></pre>
<p>运行后,你会发现即使OpenAI失败,也能从Claude拿到回复,完全不影响业务。
<strong>实测数据</strong>:</p>
<ul>
<li><strong>部署时间</strong>:30秒(一行命令)</li>
<li><strong>改造成本</strong>:改3行代码,5分钟搞定</li>
<li><strong>成本降低</strong>:缓存命中率30%的情况下,成本降低<strong>约30%</strong></li>
<li><strong>可用性提升</strong>:从单模型95%提升到多模型<strong>99.5%以上</strong></li>
</ul>
<h2 data-id="heading-23">企业级最佳实践与避坑指南</h2>
<p>搭建AI Gateway只是第一步,要真正用好它,还得注意这些细节。这些都是实际踩过的坑,血泪教训啊!</p>
<h3 data-id="heading-24">最佳实践1:分环境管理 - 开发生产别混用</h3>
<p>这个坑我踩过。一开始图省事,开发测试生产都用一个Gateway配置,结果:</p>
<ul>
<li>测试团队在生产环境疯狂调用,把配额耗光</li>
<li>开发调试时改了配置,生产也跟着变,直接炸了</li>
<li>账单分不清哪些是测试,哪些是真实业务
<strong>正确做法</strong>:</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 根据环境变量切换配置</span>
<span class="hljs-keyword">const</span> config = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>
  ? productionConfig  <span class="hljs-comment">// 生产:用GPT-4 + Claude 3.5备份</span>
  : developmentConfig; <span class="hljs-comment">// 开发:用GPT-3.5省钱,甚至用本地模型</span>
<span class="hljs-comment">// 生产配置</span>
<span class="hljs-keyword">const</span> productionConfig = {
  <span class="hljs-string">"targets"</span>: [
    {<span class="hljs-string">"provider"</span>: <span class="hljs-string">"openai"</span>, <span class="hljs-string">"api_key"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">PROD_OPENAI_KEY</span>,
     <span class="hljs-string">"override_params"</span>: {<span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4"</span>}},
    {<span class="hljs-string">"provider"</span>: <span class="hljs-string">"anthropic"</span>, <span class="hljs-string">"api_key"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">PROD_ANTHROPIC_KEY</span>,
     <span class="hljs-string">"override_params"</span>: {<span class="hljs-string">"model"</span>: <span class="hljs-string">"claude-3-5-sonnet-20241022"</span>}}
  ]
};
<span class="hljs-comment">// 开发配置</span>
<span class="hljs-keyword">const</span> developmentConfig = {
  <span class="hljs-string">"targets"</span>: [
    {<span class="hljs-string">"provider"</span>: <span class="hljs-string">"openai"</span>, <span class="hljs-string">"api_key"</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DEV_OPENAI_KEY</span>,
     <span class="hljs-string">"override_params"</span>: {<span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>}}  <span class="hljs-comment">// 便宜的模型</span>
  ]
};
</code></pre>
<p>这样开发测试想怎么玩怎么玩,不影响生产。API Key也分开,安全又省钱。</p>
<h3 data-id="heading-25">最佳实践2:成本控制策略 - 不让账单失控</h3>
<p>没有成本控制就是烧钱。这几个策略必须上:
<strong>1. 为每个团队设置月度预算</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在Gateway配置里设置限额</span>
{
  <span class="hljs-string">"consumer"</span>: <span class="hljs-string">"product-team"</span>,
  <span class="hljs-string">"budget"</span>: {
    <span class="hljs-string">"monthly_limit_usd"</span>: <span class="hljs-number">1000</span>,  <span class="hljs-comment">// 每月最多1000美元</span>
    <span class="hljs-string">"alert_threshold"</span>: <span class="hljs-number">0.8</span>  <span class="hljs-comment">// 80%时告警</span>
  }
}
</code></pre>
<p><strong>2. 高频问题必须开缓存</strong>
统计你的请求,找出Top 10高频问题,全部开缓存。比如客服场景:</p>
<ul>
<li>"怎么退货?"</li>
<li>"运费多少?"</li>
<li>"发票怎么开?"
这些问题答案基本不变,缓存一周都没问题,能省60%以上的成本。
<strong>3. 定期审查Token消耗</strong>
每周看一次监控面板,找出Token消耗Top 10的请求:</li>
<li>有没有异常长的输入?(有人可能把整本书丢进去了)</li>
<li>哪些请求成本特别高?能不能优化prompt?</li>
<li>有没有重复请求?为啥没命中缓存?
我朋友公司发现有个请求每次都用8000 token,一查才知道prompt里包含了一堆不必要的例子。优化后降到2000 token,成本直接砍75%。</li>
</ul>
<h3 data-id="heading-26">最佳实践3:安全防护 - 别让敏感数据泄露</h3>
<p>这个特别重要,尤其企业场景。</p>
<p><strong>1. 敏感数据不要发外部API</strong>
配置内容过滤器,自动检测手机号、身份证、信用卡等敏感信息:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 伪代码,实际需要在Gateway层配置</span>
<span class="hljs-keyword">if</span> (request.<span class="hljs-property">content</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-variable constant_">PHONE_PATTERN</span>)) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">error</span>(<span class="hljs-string">"检测到敏感信息,请求已拦截"</span>);
}
</code></pre>
<p>Higress这类企业级网关都支持这个功能。</p>
<p><strong>2. API Key定期轮换</strong>
不要一个Key用到天荒地老。每3个月轮换一次,泄露了也能及时止损。用Secret Manager管理,别硬编码在代码里。</p>
<p><strong>3. 生产环境日志脱敏</strong>
Gateway的日志里别记录完整的用户输入,万一日志泄露就炸了:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 日志示例(脱敏后)</span>
{
  <span class="hljs-string">"request_id"</span>: <span class="hljs-string">"abc123"</span>,
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-string">"input_length"</span>: <span class="hljs-number">256</span>,  <span class="hljs-comment">// 只记录长度</span>
  <span class="hljs-string">"input_sample"</span>: <span class="hljs-string">"用户咨询关于...[已脱敏]"</span>,  <span class="hljs-comment">// 前10个字+脱敏</span>
  <span class="hljs-string">"cost"</span>: <span class="hljs-number">0.002</span>
}
</code></pre>
<h3 data-id="heading-27">避坑指南1:缓存滥用 - 实时数据别缓存</h3>
<p><strong>踩坑案例</strong>:某天用户投诉"你们的天气预报怎么总是不准?"一查,原来AI返回的天气信息被缓存了24小时,用户早上问是晴天,晚上下雨了还说晴天。
<strong>解决方案</strong>:
区分场景,设置缓存白名单:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cacheRules = {
  <span class="hljs-comment">// 可以缓存的路径</span>
  <span class="hljs-attr">cacheable</span>: [
    <span class="hljs-string">"/api/ai/faq"</span>,  <span class="hljs-comment">// 常见问题</span>
    <span class="hljs-string">"/api/ai/docs-summary"</span>  <span class="hljs-comment">// 文档总结</span>
  ],
  <span class="hljs-comment">// 禁止缓存的路径</span>
  <span class="hljs-attr">nocache</span>: [
    <span class="hljs-string">"/api/ai/realtime"</span>,  <span class="hljs-comment">// 实时数据</span>
    <span class="hljs-string">"/api/ai/news"</span>,  <span class="hljs-comment">// 新闻类</span>
    <span class="hljs-string">"/api/ai/personalized"</span>  <span class="hljs-comment">// 个性化内容</span>
  ]
};
</code></pre>
<p>或者设置很短的TTL:</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"cache"</span>: {
    <span class="hljs-string">"ttl"</span>: <span class="hljs-number">300</span>  <span class="hljs-comment">// 5分钟,适合准实时场景</span>
  }
}
</code></pre>
<h3 data-id="heading-28">避坑指南2:Fallback配置不当 - 备用模型能力要匹配</h3>
<p><strong>踩坑案例</strong>:为了省钱,配置了GPT-4 fallback到GPT-3.5。结果GPT-4偶尔限流时,自动切到GPT-3.5,生成质量暴跌,用户直接投诉"你们的AI怎么突然变傻了?"
<strong>解决方案</strong>:
备用模型选同级别的,不要降级:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3-5-sonnet"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// ✅ 同级别</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-pro"</span><span class="hljs-punctuation">}</span>  <span class="hljs-comment">// ✅ 同级别</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>不要这样:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"targets"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-3.5-turbo"</span><span class="hljs-punctuation">}</span>  <span class="hljs-comment">// ❌ 降级了</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果实在要降级备用,至少做个提示:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (response.<span class="hljs-property">provider</span> === <span class="hljs-string">'fallback_model'</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'当前使用备用模型,质量可能下降'</span>);
}
</code></pre>
<h3 data-id="heading-29">避坑指南3:监控指标不看 - 部署了等于没部署</h3>
<p><strong>常见问题</strong>:很多团队辛辛苦苦部署了Gateway,结果从来不看监控面板,等出问题了才发现早就有征兆。
<strong>解决方案</strong>:</p>
<ol>
<li><strong>设置周报自动发送</strong>
每周一早上自动发邮件,包含:
<ul>
<li>上周总请求数、成功率、成本</li>
<li>Token消耗Top 10</li>
<li>错误日志汇总</li>
<li>缓存命中率趋势</li>
</ul>
</li>
<li><strong>关键指标告警</strong>
必须配置的告警:
<ul>
<li>成本告警:日消耗超预算80%</li>
<li>错误率告警:失败率超5%</li>
<li>延迟告警:P99延迟超3秒</li>
<li>Fallback告警:备用模型调用超20%</li>
</ul>
</li>
<li><strong>每周Review会议</strong>
技术负责人每周花15分钟看一次数据,问三个问题:
<ul>
<li>有没有异常的成本增长?</li>
<li>哪些错误可以优化?</li>
<li>缓存命中率还能提升吗?
<strong>真实案例</strong>:某公司每周Review后发现,周三下午3-5点请求量特别大。一查是产品团队每周三开会,会上疯狂测试新功能。调整后让他们用开发环境测试,生产环境成本直接降30%。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-30">结论</h2>
<p>说了这么多,其实核心就三句话:</p>
<p><strong>第一</strong>,多AI服务商切换、成本失控、单点故障,这三个痛点只要做AI应用就避不开。你可以选择每次半夜起来改代码,也可以选择一次性把AI Gateway搭起来,从此高枕无忧。</p>
<p><strong>第二</strong>,AI Gateway不是什么高深技术,10分钟就能跑起来。Portkey一行命令,Cloudflare注册就能用,真没那么复杂。改3行代码,就能获得多模型Fallback、智能缓存、全局监控,成本降40%,可用性提升到99.9%,这买卖划算得不行。</p>
<p><strong>第三</strong>,部署只是开始,真正的价值在于<strong>持续优化</strong>。每周看一次监控数据,调整缓存策略,优化Fallback配置,清理无效请求...这些小动作积累下来,半年能帮你省几千甚至上万美元。
<strong>现在就行动</strong>:</p>
<ol>
<li><strong>今天就试试</strong>:花10分钟跑一个Portkey本地实例,感受一下有多简单</li>
<li><strong>小步快跑</strong>:先在一个小项目试点,成功了再推广到全公司</li>
<li><strong>养成习惯</strong>:每周一看一次监控面板,每月Review一次成本数据</li>
<li><strong>分享经验</strong>:评论区说说你用AI Gateway遇到的问题,咱们一起交流
别等了,多服务商切换的麻烦只会越来越多,成本只会越来越高。早一天部署AI Gateway,早一天省心省钱。试试吧,反正又不花钱,万一效果好呢?</li>
</ol>
<blockquote>
<p>原文首发<a href="https://link.juejin.cn?target=https%3A%2F%2Feastondev.com%2Fblog%2Fzh%2Fposts%2Fai%2F20251201-ai-gateway-guide%2F" target="_blank" title="https://eastondev.com/blog/zh/posts/ai/20251201-ai-gateway-guide/" ref="nofollow noopener noreferrer">自个人博客</a></p>
</blockquote>
<hr/>
<p><strong>参考资料</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cloudflare.com%2Fai-gateway-is-generally-available%2F" target="_blank" title="https://blog.cloudflare.com/ai-gateway-is-generally-available/" ref="nofollow noopener noreferrer">Cloudflare AI Gateway官方博客</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPortkey-AI%2Fgateway" target="_blank" title="https://github.com/Portkey-AI/gateway" ref="nofollow noopener noreferrer">Portkey Gateway GitHub仓库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fapi-gateway%2Fai-gateway%2Fproduct-overview%2Fwhat-is-an-ai-gateway" target="_blank" title="https://help.aliyun.com/zh/api-gateway/ai-gateway/product-overview/what-is-an-ai-gateway" ref="nofollow noopener noreferrer">阿里云AI网关文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fapi-gateway%2Fai-gateway%2Fuser-guide%2Fai-fallback" target="_blank" title="https://help.aliyun.com/zh/api-gateway/ai-gateway/user-guide/ai-fallback" ref="nofollow noopener noreferrer">AI Fallback配置指南</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用命令行工具 ogr2ogr 将 CSV 转换为 Shp 数据（二）]]></title>    <link>https://juejin.cn/post/7584659460246781971</link>    <guid>https://juejin.cn/post/7584659460246781971</guid>    <pubDate>2025-12-17T14:08:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584659460246781971" data-draft-id="7584659460246683667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用命令行工具 ogr2ogr 将 CSV 转换为 Shp 数据（二）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-17T14:08:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用命令行工具 ogr2ogr 将 CSV 转换为 Shp 数据（二）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T14:08:19.000Z" title="Wed Dec 17 2025 14:08:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>❝</p>
<p><strong>ogr2ogr</strong> 是一个数据转换工具，可用于在文件格式之间转换简单要素数据。它还可以在转换过程中执行各种操作，如空间或属性选择、减少属性集、设置输出坐标系，甚至在转换过程中重新投影特征。</p>
</blockquote>
<p>如有兴趣，可参阅文章：</p>
<p>GDAL 实现将 CSV 转换为 Shp 数据（一）[1]</p>
<p><code>ogr2ogr</code> 作为 <code>GDAL（Geospatial Data Abstraction Library）</code>库中的一个命令行工具，用于转换和处理地理空间数据。它可以读取多种矢量数据格式（如<code>Shapefile、GeoJSON、KML、GML、PostGIS</code>等），并进行格式转换、坐标转换、属性过滤、几何操作等。</p>
<h2 data-id="heading-1">1. 用户环境</h2>
<p>本文使用如下用户环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<p>ogr2ogr：<code>3.9.2</code></p>
<h2 data-id="heading-2">2. 验证 <code>ogr2ogr</code> 工具信息</h2>
<p>打开命令行终端，输入命令<code>ogr2ogr --version</code>查看版本信息。如果<code>ogr2ogr</code>正确安装并添加到环境变量，便会输出其版本号。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bcde0ff0b694f04b403e616ef3a2dda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766585298&amp;x-signature=w3A%2BVEV4BqPc9uXwvwjd7olLozc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">3. 将CSV转换为Shp数据</h2>
<p>原始CSV数据内容显示如下，具有四个字段，分别为“名称”、“地址”、“LATQ”代表纬度，“LNGQ”代表经度。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e09a8252eee246bf88d6e40199aba840~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766585298&amp;x-signature=Cx0Dju6rphS85zhxM%2FEsNphATt0%3D" alt="" loading="lazy"/></p>
<p>在命令行终端输入以下命令进行数据转换。</p>
<pre><code class="hljs language-ini" lang="ini">ogr2ogr -f "ESRI Shapefile" E:datatest_dataogr_transform.shp E:datatest_data景点.csv -oo <span class="hljs-attr">X_POSSIBLE_NAMES</span>=LNGQ,longitude,x,X -oo Y_POSSIBLE_NAMES=LATQ,latitude,y,Y  -a_srs EPSG:<span class="hljs-number">4326</span>
</code></pre>
<p>以下是<code>ogr2ogr</code>工具常用参数解释：</p>













































<table><thead><tr><th><strong>选项</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>-f "ESRI Shapefile"</code></td><td>指定输出格式，如“ESRI Shapefile”</td></tr><tr><td><code>-a_srs EPSG:4326</code></td><td>设置空间参考</td></tr><tr><td><code>-select "field1,field2"</code></td><td>选择特定字段</td></tr><tr><td><code>-where "value &gt; 100"</code></td><td>过滤条件</td></tr><tr><td><code>-lco ENCODING=UTF-8</code></td><td>设置字符编码</td></tr><tr><td><code>-oo AUTODETECT_TYPE=YES</code></td><td>自动检测字段类型</td></tr><tr><td><code>-oo SEPARATOR=TAB</code></td><td>设置分隔符（TAB/COMMA/SEMICOLON）</td></tr><tr><td><code>-oo X_POSSIBLE_NAMES</code></td><td>指定经度字段，可书写多个可能值</td></tr><tr><td><code>-oo Y_POSSIBLE_NAMES</code></td><td>指定纬度字段，可书写多个可能值</td></tr></tbody></table>
<h2 data-id="heading-4">4. 中文转换错误解决办法</h2>
<p>由于CSV文件中具有中文字段，直接进行转换工具会报错，无法创建中文字段。此时需要指定正确的字符编码。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2febbe5fca3b4ebba8cc0df3f921135b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766585298&amp;x-signature=p%2Bto2QQNgYCzhlS84sQIHCry8vM%3D" alt="" loading="lazy"/></p>
<p>在命令中添加<code>-lco ENCODING=UTF-8</code>选项以正确转换中文字符。</p>
<pre><code class="hljs language-ini" lang="ini">ogr2ogr -f "ESRI Shapefile" E:datatest_dataogr_transform.shp E:datatest_data景点.csv -oo <span class="hljs-attr">X_POSSIBLE_NAMES</span>=LNGQ,longitude,x,X -oo Y_POSSIBLE_NAMES=LATQ,latitude,y,Y -lco ENCODING=UTF-<span class="hljs-number">8</span> -a_srs EPSG:<span class="hljs-number">4326</span>
</code></pre>
<p>将CSV转换为Shp数据在ArcGIS中的显示结果。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ebf2d25306d4e3e8a7d26f0a9621d92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766585298&amp;x-signature=Qx7NkMkCfY%2Fr0TQTUTGoQARN83I%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">5. 常见字符编码</h2>
<p>以下是一些常见编码格式。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># UTF-8（推荐）</span>
-lco <span class="hljs-attr">ENCODING</span>=UTF-<span class="hljs-number">8</span>

<span class="hljs-comment"># 中文编码</span>
-lco <span class="hljs-attr">ENCODING</span>=GBK      <span class="hljs-comment"># 简体中文</span>
-lco <span class="hljs-attr">ENCODING</span>=BIG5     <span class="hljs-comment"># 繁体中文</span>
-lco <span class="hljs-attr">ENCODING</span>=GB2312   <span class="hljs-comment"># 简体中文旧版</span>

<span class="hljs-comment"># 其他编码</span>
-lco <span class="hljs-attr">ENCODING</span>=LATIN1
-lco <span class="hljs-attr">ENCODING</span>=ISO-<span class="hljs-number">8859</span>-<span class="hljs-number">1</span>
-lco <span class="hljs-attr">ENCODING</span>=CP1252
</code></pre>
<h2 data-id="heading-6">6. 数据转换事项</h2>
<p>使用<code>ogr2ogr</code>工具进行数据转换时如果所有的命令都写在一行，那么显示效果不仅不美观，也不具有可读性，所以可按照转换内容对其进行分行展示。在<code>windows</code>和<code>linux</code>系统中换行符略有差别。</p>
<p><code>windows</code>系统进行分行展示时使用符号"<code>^</code>"进行分隔：</p>
<pre><code class="hljs language-ini" lang="ini">ogr2ogr -f "ESRI Shapefile" "E:\datatest_data\ogr_transform5.shp" "E:\data\test_data\景点.csv" ^
-oo <span class="hljs-attr">X_POSSIBLE_NAMES</span>=LNGQ,longitude,x,X ^
-oo <span class="hljs-attr">Y_POSSIBLE_NAMES</span>=LATQ,latitude,y,Y ^
-lco <span class="hljs-attr">ENCODING</span>=UTF-<span class="hljs-number">8</span> ^
-a_srs EPSG:4326
</code></pre>
<p><code>linux</code>系统进行分行展示时使用符号"``"进行分隔</p>
<pre><code class="hljs language-ini" lang="ini">ogr2ogr -f "ESRI Shapefile" "E:\datatest_data\ogr_transform5.shp" "E:\data\test_data\景点.csv" ^
-oo <span class="hljs-attr">X_POSSIBLE_NAMES</span>=LNGQ,longitude,x,X ^
-oo <span class="hljs-attr">Y_POSSIBLE_NAMES</span>=LATQ,latitude,y,Y ^
-lco <span class="hljs-attr">ENCODING</span>=UTF-<span class="hljs-number">8</span> ^
-a_srs EPSG:4326
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面试官问"try-catch影响性能吗"，我用数据打脸]]></title>    <link>https://juejin.cn/post/7584653722593820724</link>    <guid>https://juejin.cn/post/7584653722593820724</guid>    <pubDate>2025-12-17T14:42:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584653722593820724" data-draft-id="7584650673825546280" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面试官问&quot;try-catch影响性能吗&quot;，我用数据打脸"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-17T14:42:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面试官问"try-catch影响性能吗"，我用数据打脸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T14:42:06.000Z" title="Wed Dec 17 2025 14:42:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">面试官问"try-catch影响性能吗"，我用数据打脸</h2>
<p>面试的时候被问到这个问题：<strong>try-catch 会影响性能吗？</strong></p>
<p>当时我有点懵，回答了一个模糊的"会有一点影响吧"。面试官追问：影响多大？什么情况下影响大？我就说不上来了。</p>
<p>回来之后认真研究了一下，发现这个问题的答案比想象中有意思。</p>
<h3 data-id="heading-1">先说结论</h3>
<p><strong>在现代 JavaScript 引擎中，try-catch 本身几乎不影响性能，但异常抛出是昂贵的操作。</strong></p>
<p>听起来有点绕？用人话说就是：</p>
<ul>
<li>代码外面套一层 try-catch → 基本没影响</li>
<li>代码里频繁 throw Error → 性能会很差</li>
</ul>
<p>下面用数据说话。</p>
<h3 data-id="heading-2">实测数据</h3>
<p>我写了个简单的测试：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> iterations = <span class="hljs-number">1000000</span>;

<span class="hljs-comment">// 测试1：不用 try-catch</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'无 try-catch'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(i);
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'无 try-catch'</span>);

<span class="hljs-comment">// 测试2：用 try-catch，但不抛异常</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'有 try-catch，不抛异常'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(i);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-comment">// 不会执行</span>
    }
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'有 try-catch，不抛异常'</span>);

<span class="hljs-comment">// 测试3：用 try-catch，每次都抛异常（注意迭代次数少很多）</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'有 try-catch，每次抛异常'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'test'</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-comment">// 处理异常</span>
    }
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'有 try-catch，每次抛异常'</span>);
</code></pre>
<p>结果（Node.js v20，M1 Mac）：</p>

























<table><thead><tr><th>场景</th><th>迭代次数</th><th>耗时</th></tr></thead><tbody><tr><td>无 try-catch</td><td>1,000,000</td><td>1.8ms</td></tr><tr><td>有 try-catch，不抛异常</td><td>1,000,000</td><td>1.2ms</td></tr><tr><td>有 try-catch，每次抛异常</td><td>10,000</td><td>13.9ms</td></tr></tbody></table>
<p><strong>有意思的是，加了 try-catch 反而更快了？</strong></p>
<p>是的，这可能是 V8 引擎的优化效果。但重点是：只要不抛异常，try-catch 的开销可以忽略不计。</p>
<p>而抛异常的场景呢？迭代次数少了100倍，耗时却多了10倍。换算一下，<strong>异常抛出比正常执行慢约1000倍</strong>。</p>
<h3 data-id="heading-3">为什么异常抛出这么慢？</h3>
<p>因为 JavaScript 引擎需要做三件事：</p>
<ol>
<li><strong>创建 Error 对象</strong> - 这个对象包含了错误信息</li>
<li><strong>捕获堆栈跟踪</strong> - 遍历调用栈，记录每一层的函数名、文件名、行号</li>
<li><strong>展开调用栈</strong> - 从抛出点一直往上找，直到找到匹配的 catch 块</li>
</ol>
<p>其中第 2 步最耗时。调用栈越深，捕获堆栈跟踪的开销越大。</p>
<h3 data-id="heading-4">什么时候该用 try-catch？</h3>
<p>记住一个原则：<strong>异常是用来处理异常情况的，不是用来控制正常流程的</strong>。</p>
<h4 data-id="heading-5">正确用法：处理真正的异常</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JSON 解析可能失败</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(userInput);
    <span class="hljs-title function_">processData</span>(data);
} <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-title function_">showError</span>(<span class="hljs-string">'输入的格式不对'</span>);
}

<span class="hljs-comment">// 网络请求可能失败</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
} <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-title function_">showError</span>(<span class="hljs-string">'网络连接失败'</span>);
}
</code></pre>
<p>这些场景下，异常是"意外情况"，不是每次都会发生。用 try-catch 完全没问题。</p>
<h4 data-id="heading-6">错误用法：用异常控制流程</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误示范：用异常来判断用户是否存在</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">findUser</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> database.<span class="hljs-title function_">query</span>(<span class="hljs-string">`SELECT * FROM users WHERE id = <span class="hljs-subst">${id}</span>`</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 用异常来返回"找不到"</span>
    }
}
</code></pre>
<p>如果大部分查询都找不到用户，那每次都会抛异常，性能会很差。</p>
<p>正确做法是先检查，再操作：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 正确做法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">findUser</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">const</span> result = database.<span class="hljs-title function_">query</span>(<span class="hljs-string">`SELECT * FROM users WHERE id = <span class="hljs-subst">${id}</span>`</span>);
    <span class="hljs-keyword">return</span> result || <span class="hljs-literal">null</span>;
}
</code></pre>
<h3 data-id="heading-7">循环里怎么用 try-catch？</h3>
<p>这是另一个常见问题。看两种写法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 写法1：try-catch 在循环内</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-title function_">processItem</span>(item);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'处理失败:'</span>, item);
    }
}

<span class="hljs-comment">// 写法2：try-catch 在循环外</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> items) {
        <span class="hljs-title function_">processItem</span>(item);
    }
} <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'处理失败:'</span>, e);
}
</code></pre>
<p><strong>性能上，两者差不多</strong>。因为只要不抛异常，try-catch 本身几乎没开销。</p>
<p>区别在于<strong>错误处理策略</strong>：</p>
<ul>
<li>写法1：某一项失败了，继续处理其他项</li>
<li>写法2：某一项失败了，整个循环终止</li>
</ul>
<p>根据业务需求选择，别纠结性能。</p>
<h3 data-id="heading-8">关于早期 V8 的问题</h3>
<p>网上有些老文章说"try-catch 会阻止 V8 优化"，这在早期版本确实存在。但在 V8 6.0+（Node.js 8.3+，Chrome 60+）之后，这个问题已经解决了。</p>
<p>所以如果你看到有人说"try-catch 会让函数无法被优化"，看看文章发布时间。2018 年之前的文章可以参考，但别太当真。</p>
<h3 data-id="heading-9">最佳实践总结</h3>
<ol>
<li><strong>放心用 try-catch</strong> - 现代引擎下，性能影响可以忽略</li>
<li><strong>异常是异常</strong> - 用于处理真正的错误情况，不是控制流程</li>
<li><strong>先检查，再操作</strong> - 能用 if 判断的，别用异常处理</li>
<li><strong>catch 里要做事</strong> - 空的 catch 块是代码坏味道</li>
<li><strong>错误要有上下文</strong> - catch 里记录足够的信息方便排查</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 最佳实践示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserData</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">if</span> (!userId) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 先检查，不用异常</span>
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>);
        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
            <span class="hljs-comment">// HTTP 错误，但不一定是异常</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`获取用户失败: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-comment">// 真正的异常：网络断开、JSON 解析失败等</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户数据异常:'</span>, {
            userId,
            <span class="hljs-attr">error</span>: e.<span class="hljs-property">message</span>,
            <span class="hljs-attr">stack</span>: e.<span class="hljs-property">stack</span>
        });
        <span class="hljs-keyword">throw</span> e;  <span class="hljs-comment">// 根据需要决定是否重新抛出</span>
    }
}
</code></pre>
<h3 data-id="heading-10">面试怎么答？</h3>
<p>下次再被问到这个问题，可以这样回答：</p>
<blockquote>
<p>try-catch 本身在现代 JavaScript 引擎中几乎没有性能开销。真正影响性能的是异常的抛出和捕获，因为需要创建 Error 对象和捕获堆栈跟踪。所以建议把 try-catch 用于处理真正的异常情况，而不是用来控制正常的程序流程。比如用户输入校验，应该用 if 判断而不是 try-catch。</p>
</blockquote>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第一章：信息化发展核心知识体系]]></title>    <link>https://juejin.cn/post/7584695558158762025</link>    <guid>https://juejin.cn/post/7584695558158762025</guid>    <pubDate>2025-12-17T14:47:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584695558158762025" data-draft-id="7584651851905286163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第一章：信息化发展核心知识体系"/> <meta itemprop="keywords" content="团队管理"/> <meta itemprop="datePublished" content="2025-12-17T14:47:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第一章：信息化发展核心知识体系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T14:47:06.000Z" title="Wed Dec 17 2025 14:47:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、信息的本质与特征</h2>
<h3 data-id="heading-1">1.1 信息科学定义</h3>
<p><strong>香农信息论</strong>：信息是用来消除随机不确定性的东西</p>
<ul>
<li><strong>单位</strong>：bit（比特）—信息量的度量单位</li>
<li><strong>核心关系</strong>：信息 = 负熵（有序度的度量）</li>
</ul>
<p><strong>深入理解</strong>：</p>
<ul>
<li>信息是不同于物质、能量的第三种存在形式</li>
<li>信息量越大，不确定性消除得越多</li>
<li>熵代表混乱度，信息代表有序度，两者互为相反</li>
</ul>
<h3 data-id="heading-2">1.2 信息11大特征详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[信息11大特征] --&gt; B[存在维度 3个]
    A --&gt; C[变化维度 2个]
    A --&gt; D[依存维度 2个]
    A --&gt; E[流动维度 2个]
    A --&gt; F[结构维度 2个]
    
    B --&gt; B1[客观性]
    B --&gt; B2[普遍性]
    B --&gt; B3[无限性]
    
    C --&gt; C1[动态性]
    C --&gt; C2[相对性]
    
    D --&gt; D1[依附性]
    D --&gt; D2[变换性]
    
    E --&gt; E1[传递性]
    E --&gt; E2[转化性]
    
    F --&gt; F1[层次性]
    F --&gt; F2[系统性]
</code></pre>
<h4 data-id="heading-3">存在维度（3个）</h4>
<ol>
<li>
<p><strong>客观性</strong></p>
<ul>
<li><strong>含义</strong>：信息反映客观事物的存在方式和运动状态</li>
<li><strong>举例</strong>：温度计读数反映实际温度，传感器数据反映设备状态</li>
<li><strong>重要性</strong>：确保信息的真实性和可靠性</li>
</ul>
</li>
<li>
<p><strong>普遍性</strong></p>
<ul>
<li><strong>含义</strong>：信息无处不在，物质存在即信息存在</li>
<li><strong>举例</strong>：自然界声、光、电信号，社会活动中的各种记录</li>
<li><strong>扩展</strong>：信息普遍存在决定了信息化建设的必要性</li>
</ul>
</li>
<li>
<p><strong>无限性</strong></p>
<ul>
<li><strong>含义</strong>：信息量无限，对同一事物的描述可以无限深入</li>
<li><strong>举例</strong>：一个人的信息可以从基本信息到DNA序列无限描述</li>
<li><strong>应用</strong>：大数据时代的理论基础</li>
</ul>
</li>
</ol>
<h4 data-id="heading-4">变化维度（2个）</h4>
<ol start="4">
<li>
<p><strong>动态性</strong></p>
<ul>
<li><strong>含义</strong>：信息随时间变化，具有时效性</li>
<li><strong>举例</strong>：股票价格、交通流量、天气预报</li>
<li><strong>管理</strong>：需要实时更新和维护</li>
</ul>
</li>
<li>
<p><strong>相对性</strong></p>
<ul>
<li><strong>含义</strong>：同一信息对不同主体价值不同</li>
<li><strong>举例</strong>：财务数据对财务部门和销售部门意义不同</li>
<li><strong>设计</strong>：信息系统需要考虑用户角色的差异性</li>
</ul>
</li>
</ol>
<h4 data-id="heading-5">依存维度（2个）</h4>
<ol start="6">
<li>
<p><strong>依附性</strong></p>
<ul>
<li><strong>含义</strong>：信息需要载体存在，不能独立存在</li>
<li><strong>举例</strong>：声音需要空气传播，文件需要存储介质</li>
<li><strong>类型</strong>：物理载体（纸张、磁盘）、电子载体（信号、代码）</li>
</ul>
</li>
<li>
<p><strong>变换性</strong></p>
<ul>
<li><strong>含义</strong>：信息形式可以转换，内容可以重组</li>
<li><strong>举例</strong>：文字转语音、数据转图表、视频压缩</li>
<li><strong>技术</strong>：编码、压缩、格式转换等技术基础</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">流动维度（2个）</h4>
<ol start="8">
<li>
<p><strong>传递性</strong></p>
<ul>
<li><strong>含义</strong>：信息可以在时间和空间上传递</li>
<li><strong>时间传递</strong>：存储、传承（如历史档案）</li>
<li><strong>空间传递</strong>：传播、扩散（如网络传输）</li>
<li><strong>技术</strong>：通信技术、存储技术的理论基础</li>
</ul>
</li>
<li>
<p><strong>转化性</strong></p>
<ul>
<li><strong>含义</strong>：信息可以转化为物质和能量</li>
<li><strong>举例</strong>：设计图→产品、知识→生产力</li>
<li><strong>价值</strong>：信息价值的最终体现</li>
</ul>
</li>
</ol>
<h4 data-id="heading-7">结构维度（2个）</h4>
<ol start="10">
<li>
<p><strong>层次性</strong></p>
<ul>
<li><strong>含义</strong>：信息具有分层结构</li>
<li><strong>层次</strong>：战略层→战术层→作业层信息</li>
<li><strong>举例</strong>：企业数据：战略规划→部门计划→执行记录</li>
</ul>
</li>
<li>
<p><strong>系统性</strong></p>
<ul>
<li><strong>含义</strong>：信息相互关联形成有机整体</li>
<li><strong>特点</strong>：整体性、关联性、协调性</li>
<li><strong>举例</strong>：ERP系统各模块数据紧密关联</li>
</ul>
</li>
</ol>
<p><strong>记忆口诀</strong>：</p>
<ul>
<li><strong>数字法</strong>：三二二二二（3存在+2变化+2依存+2流动+2结构）</li>
<li><strong>串联法</strong>：客普无限动，相依附变换，传递转化层系全</li>
</ul>
<h3 data-id="heading-8">1.3 信息质量7大属性详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[信息质量属性] --&gt; B[精确性]
    A --&gt; C[完整性]
    A --&gt; D[可靠性]
    A --&gt; E[及时性]
    A --&gt; F[经济性]
    A --&gt; G[可验证性]
    A --&gt; H[安全性]
</code></pre>
<h4 data-id="heading-9">详细解释：</h4>
<ol>
<li>
<p><strong>精确性</strong></p>
<ul>
<li><strong>定义</strong>：信息与实际情况的匹配程度</li>
<li><strong>衡量</strong>：误差范围、准确率</li>
<li><strong>举例</strong>：GPS定位精度±10米，传感器数据误差±0.5%</li>
</ul>
</li>
<li>
<p><strong>完整性</strong></p>
<ul>
<li><strong>定义</strong>：信息包含全部重要事实的程度</li>
<li><strong>维度</strong>：广度覆盖、深度挖掘</li>
<li><strong>举例</strong>：客户档案包含基本信息、交易记录、服务历史</li>
</ul>
</li>
<li>
<p><strong>可靠性</strong></p>
<ul>
<li><strong>定义</strong>：信息来源、采集、传输过程可信</li>
<li><strong>要素</strong>：来源权威性、方法科学性</li>
<li><strong>举例</strong>：官方统计数据 vs 网络传言</li>
</ul>
</li>
<li>
<p><strong>及时性</strong></p>
<ul>
<li><strong>定义</strong>：信息产生到获取的时间间隔</li>
<li><strong>要求</strong>：实时性、时效性</li>
<li><strong>举例</strong>：实时监控数据 vs 月度报告</li>
</ul>
</li>
<li>
<p><strong>经济性</strong></p>
<ul>
<li><strong>定义</strong>：获取信息的成本效益比</li>
<li><strong>考虑</strong>：时间成本、资金成本、机会成本</li>
<li><strong>平衡</strong>：质量与成本的权衡</li>
</ul>
</li>
<li>
<p><strong>可验证性</strong></p>
<ul>
<li><strong>定义</strong>：信息可以被证实或证伪的程度</li>
<li><strong>方法</strong>：交叉验证、追溯验证</li>
<li><strong>举例</strong>：带原始数据的实验报告</li>
</ul>
</li>
<li>
<p><strong>安全性</strong></p>
<ul>
<li><strong>定义</strong>：防止未授权访问的能力</li>
<li><strong>措施</strong>：加密、权限控制、审计</li>
<li><strong>分级</strong>：公开、内部、机密、绝密</li>
</ul>
</li>
</ol>
<p><strong>记忆口诀</strong>：精完可靠及经安验（精完可-可靠及-经安验）</p>
<h2 data-id="heading-10">二、信息系统核心概念详解</h2>
<h3 data-id="heading-11">2.1 信息系统六大组件</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[信息系统组件] --&gt; B[硬件]
    A --&gt; C[软件]
    A --&gt; D[数据库]
    A --&gt; E[网络]
    A --&gt; F[人员]
    A --&gt; G[规程]
</code></pre>
<h4 data-id="heading-12">组件详解：</h4>
<ol>
<li>
<p><strong>硬件</strong></p>
<ul>
<li><strong>内容</strong>：计算机、服务器、存储设备、网络设备</li>
<li><strong>作用</strong>：物理基础，提供计算、存储、通信能力</li>
<li><strong>趋势</strong>：云化、虚拟化</li>
</ul>
</li>
<li>
<p><strong>软件</strong></p>
<ul>
<li><strong>分类</strong>：系统软件（OS）、应用软件（ERP、CRM）</li>
<li><strong>作用</strong>：逻辑核心，实现业务功能</li>
<li><strong>开发</strong>：定制开发、套装软件</li>
</ul>
</li>
<li>
<p><strong>数据库</strong></p>
<ul>
<li><strong>作用</strong>：存储和管理数据</li>
<li><strong>类型</strong>：关系型（MySQL）、非关系型（MongoDB）</li>
<li><strong>管理</strong>：数据建模、备份恢复、性能优化</li>
</ul>
</li>
<li>
<p><strong>网络</strong></p>
<ul>
<li><strong>功能</strong>：数据传输和系统连接</li>
<li><strong>类型</strong>：局域网、广域网、互联网</li>
<li><strong>技术</strong>：TCP/IP、无线网络、5G</li>
</ul>
</li>
<li>
<p><strong>人员</strong></p>
<ul>
<li><strong>角色</strong>：系统用户、管理员、开发者</li>
<li><strong>技能</strong>：业务知识、技术能力</li>
<li><strong>管理</strong>：培训、考核、激励</li>
</ul>
</li>
<li>
<p><strong>规程</strong></p>
<ul>
<li><strong>内容</strong>：操作手册、管理制度、标准规范</li>
<li><strong>作用</strong>：确保系统有序运行</li>
<li><strong>制定</strong>：基于最佳实践，持续改进</li>
</ul>
</li>
</ol>
<p><strong>记忆</strong>：硬软数网人规（六位一体）</p>
<h3 data-id="heading-13">2.2 信息系统生命周期详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[规划] --&gt; B[分析]
    B --&gt; C[设计]
    C --&gt; D[实施]
    D --&gt; E[运维]
    E -.-&gt; A
</code></pre>
<h4 data-id="heading-14">五阶段详解：</h4>
<ol>
<li>
<p><strong>规划阶段</strong></p>
<ul>
<li><strong>任务</strong>：可行性研究、战略规划、资源计划</li>
<li><strong>产出</strong>：项目章程、可行性报告</li>
<li><strong>关键</strong>：回答"要不要做"</li>
</ul>
</li>
<li>
<p><strong>分析阶段</strong></p>
<ul>
<li><strong>任务</strong>：需求收集、分析、规格定义</li>
<li><strong>产出</strong>：需求规格说明书</li>
<li><strong>关键</strong>：回答"要做什么"</li>
</ul>
</li>
<li>
<p><strong>设计阶段</strong></p>
<ul>
<li><strong>任务</strong>：架构设计、详细设计、界面设计</li>
<li><strong>产出</strong>：系统设计文档</li>
<li><strong>关键</strong>：回答"怎么做"</li>
</ul>
</li>
<li>
<p><strong>实施阶段</strong></p>
<ul>
<li><strong>任务</strong>：编码、测试、部署、培训</li>
<li><strong>产出</strong>：可运行系统、用户手册</li>
<li><strong>关键</strong>：实际建设</li>
</ul>
</li>
<li>
<p><strong>运维阶段</strong></p>
<ul>
<li><strong>任务</strong>：维护、优化、升级、退役</li>
<li><strong>产出</strong>：运维报告、优化方案</li>
<li><strong>关键</strong>：持续价值</li>
</ul>
</li>
</ol>
<p><strong>五阶段口诀</strong>：规分设实维（规划→分析→设计→实施→运维）</p>
<h2 data-id="heading-15">三、信息化发展体系详解</h2>
<h3 data-id="heading-16">3.1 信息化四大内涵详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[信息化内涵] --&gt; B[信息网络体系]
    A --&gt; C[信息产业基础]
    A --&gt; D[社会运行环境]
    A --&gt; E[效用积累过程]
    
    B --&gt; B1[基础设施]
    C --&gt; C1[产业支撑]
    D --&gt; D1[政策环境]
    E --&gt; E1[价值实现]
</code></pre>
<h4 data-id="heading-17">内涵详解：</h4>
<ol>
<li>
<p><strong>信息网络体系</strong></p>
<ul>
<li><strong>内容</strong>：网络设施、信息系统、信息资源</li>
<li><strong>比喻</strong>：高速公路系统</li>
<li><strong>建设</strong>：5G、数据中心、云计算平台</li>
</ul>
</li>
<li>
<p><strong>信息产业基础</strong></p>
<ul>
<li><strong>内容</strong>：信息制造业、软件业、服务业</li>
<li><strong>比喻</strong>：汽车制造厂和驾驶员</li>
<li><strong>发展</strong>：芯片、操作系统、应用软件</li>
</ul>
</li>
<li>
<p><strong>社会运行环境</strong></p>
<ul>
<li><strong>内容</strong>：政策法规、标准规范、文化教育</li>
<li><strong>比喻</strong>：交通规则和驾驶文化</li>
<li><strong>完善</strong>：网络安全法、数据保护条例</li>
</ul>
</li>
<li>
<p><strong>效用积累过程</strong></p>
<ul>
<li><strong>内容</strong>：生产力提升、生活质量改善</li>
<li><strong>体现</strong>：经济增长、社会进步</li>
<li><strong>衡量</strong>：信息化发展指数</li>
</ul>
</li>
</ol>
<h3 data-id="heading-18">3.2 国家信息化六要素详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[信息技术应用] --&gt; B[信息资源]
    B --&gt; C[信息网络]
    C --&gt; A
    
    D[信息化人才] --&gt; A
    E[政策法规] --&gt; A
    F[标准规范] --&gt; A
</code></pre>
<h4 data-id="heading-19">六要素详解：</h4>
<ol>
<li>
<p><strong>信息技术应用</strong>（龙头）</p>
<ul>
<li><strong>地位</strong>：信息化建设的出发点和归宿</li>
<li><strong>领域</strong>：政务、企业、民生各个领域</li>
<li><strong>作用</strong>：体现建设效益</li>
</ul>
</li>
<li>
<p><strong>信息资源</strong>（核心）</p>
<ul>
<li><strong>地位</strong>：国家战略资源</li>
<li><strong>类型</strong>：政务数据、企业数据、个人数据</li>
<li><strong>开发</strong>：采集、整合、挖掘、利用</li>
</ul>
</li>
<li>
<p><strong>信息网络</strong>（手段）</p>
<ul>
<li><strong>地位</strong>：信息传输基础设施</li>
<li><strong>融合</strong>：电信网、广电网、互联网三网融合</li>
<li><strong>发展</strong>：5G、物联网、工业互联网</li>
</ul>
</li>
<li>
<p><strong>信息化人才</strong>（根本）</p>
<ul>
<li><strong>地位</strong>：所有工作的执行者</li>
<li><strong>培养</strong>：高等教育、职业培训</li>
<li><strong>结构</strong>：技术人才、管理人才、应用人才</li>
</ul>
</li>
<li>
<p><strong>政策法规</strong>（保障）</p>
<ul>
<li><strong>作用</strong>：规范信息化建设</li>
<li><strong>内容</strong>：法律法规、发展规划</li>
<li><strong>举例</strong>：《网络安全法》、《数据安全法》</li>
</ul>
</li>
<li>
<p><strong>标准规范</strong>（保障）</p>
<ul>
<li><strong>作用</strong>：确保互联互通</li>
<li><strong>内容</strong>：技术标准、管理规范</li>
<li><strong>制定</strong>：国家标准、行业标准</li>
</ul>
</li>
</ol>
<p><strong>六要素口诀</strong>：</p>
<ul>
<li><strong>应用龙头资源心，网络手段人才本，政策标准双保障</strong></li>
</ul>
<h3 data-id="heading-20">3.3 组织信息化四阶段详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[产品信息化] --&gt; B[产业信息化]
    B --&gt; C[社会生活信息化]
    C --&gt; D[国民经济信息化]
</code></pre>
<h4 data-id="heading-21">四阶段详解：</h4>
<ol>
<li>
<p><strong>产品信息化</strong></p>
<ul>
<li><strong>特点</strong>：产品智能化、嵌入式系统</li>
<li><strong>举例</strong>：智能家电、可穿戴设备</li>
<li><strong>目标</strong>：提升产品附加值</li>
</ul>
</li>
<li>
<p><strong>产业信息化</strong></p>
<ul>
<li><strong>特点</strong>：产业链数字化、企业间协同</li>
<li><strong>举例</strong>：工业互联网、供应链管理</li>
<li><strong>目标</strong>：优化资源配置</li>
</ul>
</li>
<li>
<p><strong>社会生活信息化</strong></p>
<ul>
<li><strong>特点</strong>：公共服务数字化、智慧生活</li>
<li><strong>举例</strong>：智慧城市、在线教育、远程医疗</li>
<li><strong>目标</strong>：改善民生服务</li>
</ul>
</li>
<li>
<p><strong>国民经济信息化</strong></p>
<ul>
<li><strong>特点</strong>：经济系统一体化、数据要素化</li>
<li><strong>举例</strong>：数字中国、国家大数据体系</li>
<li><strong>目标</strong>：提升国家竞争力</li>
</ul>
</li>
</ol>
<p><strong>演进逻辑</strong>：产品→产业→社会→国民经济</p>
<h3 data-id="heading-22">3.4 国家信息化三步走详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[2020年&lt;br/&gt;部分领先] --&gt; B[2025年&lt;br/&gt;基本自主]
    B --&gt; C[21世纪中叶&lt;br/&gt;全面引领]
</code></pre>
<h4 data-id="heading-23">战略详解：</h4>
<p><strong>第一步：2020年目标</strong></p>
<ul>
<li>关键技术部分达到国际先进水平</li>
<li>信息产业国际竞争力大幅提升</li>
<li>信息化成为驱动现代化的重要力量</li>
</ul>
<p><strong>第二步：2025年目标</strong></p>
<ul>
<li>建成国际领先的移动通信网络</li>
<li>突破核心关键技术瓶颈</li>
<li>培育具有国际竞争力的跨国企业</li>
</ul>
<p><strong>第三步：21世纪中叶目标</strong></p>
<ul>
<li>网络强国地位日益稳固</li>
<li>引领全球信息化发展</li>
<li>全面支撑社会主义现代化建设</li>
</ul>
<h2 data-id="heading-24">四、知识体系总结</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[信息化发展知识体系]
    
    A --&gt; B[信息基础]
    A --&gt; C[信息系统]
    A --&gt; D[信息化体系]
    A --&gt; E[发展趋势]
    
    B --&gt; B1[特征-11个]
    B1 --&gt; B11[客观性&lt;br&gt;普遍性&lt;br&gt;无限性]
    B1 --&gt; B12[动态性&lt;br&gt;相对性]
    B1 --&gt; B13[依附性&lt;br&gt;变换性]
    B1 --&gt; B14[传递性&lt;br&gt;转化性]
    B1 --&gt; B15[层次性&lt;br&gt;系统性]
    
    B --&gt; B2[质量-7个]
    B2 --&gt; B21[精确性&lt;br&gt;完整性&lt;br&gt;可靠性]
    B2 --&gt; B22[及时性&lt;br&gt;经济性]
    B2 --&gt; B23[安全性&lt;br&gt;可验证性]
    
    C --&gt; C1[组件-6个]
    C1 --&gt; C11[硬件&lt;br&gt;软件&lt;br&gt;数据库]
    C1 --&gt; C12[网络&lt;br&gt;人员&lt;br&gt;规程]
    
    C --&gt; C2[周期-5个]
    C2 --&gt; C21[规划&lt;br&gt;分析&lt;br&gt;设计]
    C2 --&gt; C22[实施&lt;br&gt;运维]
    
    D --&gt; D1[内涵-4个]
    D1 --&gt; D11[网络体系&lt;br&gt;产业基础]
    D1 --&gt; D12[运行环境&lt;br&gt;效用积累]
    
    D --&gt; D2[要素-6个]
    D2 --&gt; D21[应用&lt;br&gt;资源&lt;br&gt;网络]
    D2 --&gt; D22[人才&lt;br&gt;政策&lt;br&gt;标准]
    
    E --&gt; E1[组织-4阶]
    E1 --&gt; E11[产品&lt;br&gt;产业]
    E1 --&gt; E12[社会&lt;br&gt;国家]
    
    E --&gt; E2[战略-3步]
    E2 --&gt; E21[2020&lt;br&gt;2025]
    E2 --&gt; E22[2050]
</code></pre>
<h2 data-id="heading-25">知识点详细说明表</h2>



































<table><thead><tr><th>模块</th><th>核心内容</th><th>关键点</th><th>记忆方法</th></tr></thead><tbody><tr><td><strong>信息基础</strong></td><td>信息特征 + 质量属性</td><td>11大特征，7大属性</td><td>特征:三二二二二<br/>属性:精完可靠及经安验</td></tr><tr><td><strong>信息系统</strong></td><td>组件 + 生命周期</td><td>六组件，五阶段</td><td>组件:硬软数网人规<br/>阶段:规分设实维</td></tr><tr><td><strong>信息化体系</strong></td><td>内涵 + 要素</td><td>四内涵，六要素</td><td>内涵:网络/产业/环境/效用<br/>要素:口诀记忆</td></tr><tr><td><strong>发展趋势</strong></td><td>组织 + 国家</td><td>四阶段，三步走</td><td>阶段:产品→产业→社会→经济<br/>战略:2020→2025→2050</td></tr></tbody></table>
<h2 data-id="heading-26">核心逻辑关系图</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start[学习路径] --&gt; Step1[基础概念]
    Step1 --&gt;|信息本质| Step2[信息系统]
    Step2 --&gt;|技术支持| Step3[信息化建设]
    Step3 --&gt;|应用发展| Step4[发展趋势]
    Step4 --&gt; End[知识掌握]
    
    %% 详细内容
    subgraph Step1_Details[基础概念]
        S1A[信息特征]
        S1B[质量属性]
    end
    
    subgraph Step2_Details[信息系统]
        S2A[六组件]
        S2B[五阶段]
    end
    
    subgraph Step3_Details[信息化建设]
        S3A[四内涵]
        S3B[六要素]
    end
    
    subgraph Step4_Details[发展趋势]
        S4A[组织四阶段]
        S4B[国家三步走]
    end
    
    Step1 --&gt; Step1_Details
    Step2 --&gt; Step2_Details
    Step3 --&gt; Step3_Details
    Step4 --&gt; Step4_Details
</code></pre>
<h2 data-id="heading-27">记忆口诀总汇表</h2>













































<table><thead><tr><th>知识点</th><th>口诀</th><th>解释</th></tr></thead><tbody><tr><td><strong>信息11大特征</strong></td><td>三二二二二</td><td>3存在+2变化+2依存+2流动+2结构</td></tr><tr><td><strong>信息7大属性</strong></td><td>精完可靠及经安验</td><td>精确/完整/可靠/及时/经济/安全/可验证</td></tr><tr><td><strong>信息系统组件</strong></td><td>硬软数网人规</td><td>硬件/软件/数据库/网络/人员/规程</td></tr><tr><td><strong>生命周期阶段</strong></td><td>规分设实维</td><td>规划/分析/设计/实施/运维</td></tr><tr><td><strong>六要素模型</strong></td><td>应用龙头资源心，网络手段人才本，政策标准双保障</td><td>各要素定位关系</td></tr><tr><td><strong>组织四阶段</strong></td><td>产产社国</td><td>产品→产业→社会→国家</td></tr><tr><td><strong>国家三步走</strong></td><td>2020→2025→2050</td><td>时间节点与目标</td></tr></tbody></table>
<h2 data-id="heading-28">五、核心记忆口诀汇总</h2>
<h3 data-id="heading-29">1. 信息特征记忆</h3>
<p><strong>"三二二二二"分类法</strong></p>
<ul>
<li>3存在：客观、普遍、无限</li>
<li>2变化：动态、相对</li>
<li>2依存：依附、变换</li>
<li>2流动：传递、转化</li>
<li>2结构：层次、系统</li>
</ul>
<h3 data-id="heading-30">2. 质量属性记忆</h3>
<p><strong>"精完可靠及经安验"</strong></p>
<ul>
<li>精确性、完整性、可靠性</li>
<li>及时性、经济性</li>
<li>安全性、可验证性</li>
</ul>
<h3 data-id="heading-31">3. 信息系统记忆</h3>
<p><strong>"硬软数网人规"</strong>（六组件）
<strong>"规分设实维"</strong>（五阶段）</p>
<h3 data-id="heading-32">4. 六要素记忆</h3>
<p><strong>"应用龙头资源心，网络手段人才本，政策标准双保障"</strong></p>
<h3 data-id="heading-33">5. 四阶段记忆</h3>
<p><strong>"产产社国"</strong>（产品→产业→社会→国家）</p>
<h2 data-id="heading-34">六、考试重点与答题技巧</h2>
<h3 data-id="heading-35">高频考点</h3>
<ol>
<li><strong>信息特征</strong>：客观性、动态性、传递性必考</li>
<li><strong>生命周期</strong>：各阶段区别和联系</li>
<li><strong>六要素</strong>：各要素的定位和关系</li>
<li><strong>质量属性</strong>：7个属性的实际应用</li>
</ol>
<h3 data-id="heading-36">易混淆概念辨析</h3>
<ol>
<li>
<p><strong>信息 vs 数据</strong></p>
<ul>
<li>数据：原始事实（如：25℃）</li>
<li>信息：有意义的解释（如：温度适宜）</li>
</ul>
</li>
<li>
<p><strong>客观性 vs 普遍性</strong></p>
<ul>
<li>客观性：反映事实真实性</li>
<li>普遍性：存在广泛性</li>
</ul>
</li>
<li>
<p><strong>产品信息化 vs 产业信息化</strong></p>
<ul>
<li>产品：单个产品智能化</li>
<li>产业：整个产业链数字化</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Navigation 最佳实践]]></title>    <link>https://juejin.cn/post/7584652662328754226</link>    <guid>https://juejin.cn/post/7584652662328754226</guid>    <pubDate>2025-12-17T13:03:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584652662328754226" data-draft-id="7584742635483430922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Navigation 最佳实践"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-17T13:03:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Best_Jerry"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360106999"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Navigation 最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360106999/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Best_Jerry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:03:35.000Z" title="Wed Dec 17 2025 13:03:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DgoFpG25uoc8" target="_blank" title="https://www.youtube.com/watch?v=goFpG25uoc8" ref="nofollow noopener noreferrer">Type safe, multi-module best practices with Navigation Compose</a></p>
<p>了解使用 Navigation Compose 的最佳实践，以便您能以可在所有导航调用中维持类型安全的方式，在多个模块中展开导航图。</p>
<h2 data-id="heading-0">1. Define your screen as state in，events out</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a79b0980b9f94979b560ef634c5ff70d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=6ZimAl8DTJvDYYKbXrlmRInMOWY%3D" alt="image.png" loading="lazy"/></p>
<p>你的屏幕不应该在意你的数据是来自视图模型，还是只是你为单个测试创建的静态状态。它也不应该关心接收事件的对象是谁。</p>
<h2 data-id="heading-1">2. Split up your navigation graph</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f0f7c89e61a47f58096760002d8a8ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=Uze5wY2jcjii8gPA5bDF%2Buul1h8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fc4a971a8334c80a9ffa89114d433d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=z%2BIu0q%2Bp5bbJvJlU%2FG2HAgYduNw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3. Build only the public APIs you need</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d481c62f6f14047b638d1fceaae4b20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=ab0DUWCcipYKdK4%2F%2BBpGaCnd%2B%2FY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96b63663f1714399a8cc5e9534363cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=tlduCgL3mlXuG6vWOyRj%2BsKGOHk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5ce079422684139b7c0679457110f51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=%2BqbZRrUOFSinGdoAEyZLGBL8gZE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86ebec1c3b248f19f8fbd136b913238~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=%2BWC3a3Za9Ag%2BfeOr8g4TUGH%2F1Rs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fdb837429d1416e9bc521f3e76bff5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=fPgJF4Ca23iWQ8%2B4eO3VbNVsVTY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">4. Module structure -&gt; Graph structure</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cda362dec234547ac2c4abefeef09b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=FKCSHoxuEeN3yOOPRmFJXrLliPY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140261aeb8e445d9891dd5786ca9e6af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=gqXx0o0k3vtbP%2F9nc1I6JWWFnXM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92e525948c084dbcb31c07b655ac09cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581414&amp;x-signature=biXTnQALe9XBBTb3aq3AZIy9uIE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">5. Check out the Updated resources</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fnavigation%2Fdesign%2Ftype-safety%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/guide/navigation/design/type-safety?hl=zh-cn" ref="nofollow noopener noreferrer">Kotlin DSL 和 Navigation Compose 中的类型安全</a></p>
<p>NowInAndroid app: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fandroid%2Fnowinandroid" target="_blank" title="https://github.com/android/nowinandroid" ref="nofollow noopener noreferrer">github.com/android/now…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Turborepo 打造 Strapi 插件开发的极速全栈体验]]></title>    <link>https://juejin.cn/post/7584653722593689652</link>    <guid>https://juejin.cn/post/7584653722593689652</guid>    <pubDate>2025-12-17T13:05:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584653722593689652" data-draft-id="7584567736186699814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Turborepo 打造 Strapi 插件开发的极速全栈体验"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-17T13:05:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="知航驿站"/> <meta itemprop="url" content="https://juejin.cn/user/4125023356335576"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Turborepo 打造 Strapi 插件开发的极速全栈体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023356335576/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    知航驿站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:05:58.000Z" title="Wed Dec 17 2025 13:05:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">什么是Turborepo</h2>
<p>我在两三年前听到这个名词一直没搞懂，今天我借助AI+实践搞懂了这个架构，以及我们为什么要用它</p>
<p>在现代前端工程化中，"Monorepo" 已经成为了一个绕不开的热词。但很多开发者在初次接触时，容易把它和 "Multirepo" 甚至 "Turborepo" 混淆</p>
<h3 data-id="heading-1">1. Multirepo：各自为政的“独栋别墅”</h3>
<p><strong>Multirepo (Multiple Repositories)</strong> 是最传统的管理方式。</p>
<blockquote>
<p>🏠 <strong>比喻</strong>：你的前端团队住在 A 栋别墅，后端团队住在 B 栋别墅，UI 组件库团队住在 C 栋别墅。大家互不干扰，物理隔离。</p>
</blockquote>
<h4 data-id="heading-2">这种模式是怎样的？</h4>
<ul>
<li>每个项目都有<strong>独立</strong>的 Git 仓库（例如 <code>git/frontend</code>，<code>git/backend</code>）。</li>
<li>每个仓库有自己独立的配置（ESLint, TSConfig）。</li>
</ul>
<h4 data-id="heading-3">✅ 优点</h4>
<ul>
<li><strong>权限清晰</strong>：你可以只给新人开前端仓库的权限，他看不到后端的代码。</li>
<li><strong>体积小</strong>：<code>git clone</code> 很快，因为你只拉取了这一个项目的代码。</li>
</ul>
<h4 data-id="heading-4">❌ 痛点</h4>
<ul>
<li><strong>协作噩梦</strong>：当你修了一个 Bug，需要同时改动前端和后端代码时，你无法在一个 Commit 里完成。</li>
<li><strong>依赖地狱</strong>：如果你改了 <code>UI组件库</code> 的代码，你得先发个 npm 包，然后去前端项目里升级版本号，再 <code>npm install</code>……这一套流程下来，一下午就过去了。</li>
</ul>
<h6 data-id="heading-5">这种模式应该是目前大家所最常用的一种模式，这个主要是思维惯性与工具默认，早期的 CI/CD 工具（如 Jenkins）也更习惯于一个仓库对应一条流水线， 当你用 create-react-app 或 git init 时，默认就是创建一个仓库管一个项目</h6>
<hr/>
<h3 data-id="heading-6">2. Monorepo：欢聚一堂的“大平层”</h3>
<p>为了解决 Multirepo 的协作痛点，Google、Facebook 等大厂率先采用了 <strong>Monorepo (Monolithic Repository)</strong>。</p>
<blockquote>
<p>🏢 <strong>比喻</strong>：大家搬进了一栋巨大的大平层公寓。虽然每人还有自己的房间（目录），但都在同一个大门（Git 仓库）里进出。</p>
</blockquote>
<h4 data-id="heading-7">这种模式是怎样的？</h4>
<ul>
<li><strong>所有项目</strong>都在同一个 Git 仓库里（例如 <code>apps/web</code>，<code>apps/docs</code>，<code>packages/ui</code>）。</li>
<li>使用 Workspace（工作区）技术将它们在本地软链接起来。</li>
</ul>
<h4 data-id="heading-8">✅ 优点</h4>
<ul>
<li><strong>原子提交 (Atomic Commits)</strong>：你可以一次 Commit 同时修复前后端的 Bug，保证版本的一致性。</li>
<li><strong>代码共享零成本</strong>：你在 <code>packages/ui</code> 里改了按钮颜色，保存一下，<code>apps/web</code> 里立马生效，根本不需要发包！</li>
<li><strong>统一规范</strong>：大家共用一套配置，从此不再有“你用 2 空格缩进，我用 4 空格”的争吵。</li>
</ul>
<h4 data-id="heading-9">❌ 新的问题</h4>
<ul>
<li><strong>构建太慢了！</strong> 以前你只构建一个项目，现在仓库里有 10 个项目。如果每次改一行代码，CI（持续集成）都要把 10 个项目全跑一遍，那就要等到天荒地老</li>
</ul>
<p>在微服务架构流行之前（大概 2015 年以前），绝大多数项目（包括 JSP、ASP.NET、PHP）其实都是单体。那时候大家默认就是“一个仓库管所有代码”，根本不需要发明 Monorepo 这个词。后来，微服务和前后端分离流行起来了，大家把仓库拆散了（Multirepo）。再后来，大家发现拆太散了不好管，又把它们合并回来了，这时候为了区分“强耦合的单体”和“松耦合的多项目集合”，才强调了 Monorepo 这个概念</p>
<hr/>
<h3 data-id="heading-10">3. Turborepo：大平层的“智能管家”</h3>
<p>这时候，<strong>Turborepo</strong> 登场了。</p>
<p>很多人的误区在于：<em>“我要用 Turborepo 还是用 Monorepo？”</em>
<strong>这是一个错误的问题。</strong> Turborepo 不是 Monorepo 的替代品，而是它的<strong>加速器</strong>。</p>
<blockquote>
<p>🤖 <strong>比喻</strong>：Turborepo 是这栋大平层公寓配备的<strong>AI 智能管家</strong>。</p>
</blockquote>
<h4 data-id="heading-11">Turborepo 解决了什么？</h4>
<p>它专门解决 Monorepo “构建慢、任务乱” 的问题。</p>
<h5 data-id="heading-12">⚡️ 核心黑科技 1：任务编排 (Pipeline)</h5>
<p>它知道 <code>web</code> 应用依赖 <code>ui</code> 包。当你运行构建命令时，它会自动先构建 <code>ui</code>，而且能把互不相关的任务（比如 <code>lint</code> 和 <code>test</code>）利用多核 CPU <strong>并行执行</strong>。</p>
<h5 data-id="heading-13">⚡️ 核心黑科技 2：智能缓存 (Caching)</h5>
<p>这是 Turborepo 的杀手锏。当你运行构建时，它会先检查：“哎，这个文件之前构建过吗？输入变了吗？”</p>
<ul>
<li>如果没变：<strong>直接从缓存复制粘贴结果</strong>。时间消耗：<strong>几毫秒</strong>。</li>
<li>甚至支持<strong>云端缓存</strong>：你同事构建过的结果，你拉下来也能直接用！</li>
</ul>
<hr/>
<h4 data-id="heading-14">4. 项目实践</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fturborepo.com%2Fdocs%2Fgetting-started%2Finstallation" target="_blank" title="https://turborepo.com/docs/getting-started/installation" ref="nofollow noopener noreferrer">Turborepo官网</a></p>
<p>安装</p>
<pre><code class="hljs language-bash" lang="bash">pnpm dlx create-turbo@latest
</code></pre>
<p>以下是我工程目录</p>
<p>我们的目标目录结构如下：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-strapi-monorepo/
├── apps/
│   ├── backend/          <span class="hljs-comment"># Strapi v5 主程序</span>
│   └── docs/             <span class="hljs-comment"># VitePress 文档站</span>
├── packages/
│   ├── strapi-plugin-bag/ <span class="hljs-comment"># 我们的插件核心代码</span>
│   └── ui/               <span class="hljs-comment"># (可选) 共享 UI 组件库</span>
├── package.json
├── pnpm-workspace.yaml
└── turbo.json
</code></pre>
<p>这种结构清晰地分离了“宿主应用”和“插件包”，模拟了真实的 npm 包引用场景。</p>
<h4 data-id="heading-15">统一依赖管理 (Workspace)</h4>
<p>在根目录的 <code>pnpm-workspace.yaml</code> 中，我们将所有项目串联起来：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"apps/*"</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"packages/*"</span>
</code></pre>
<p>然后，在 <code>apps/backend/package.json</code> 中，我们可以直接引用本地插件，无需发包，无需 <code>npm link</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"strapi-plugin-bag"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:*"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这意味着，<code>strapi-plugin-bag</code> 的任何修改，对于 <code>backend</code> 来说都是实时可见的。</p>
<h4 data-id="heading-16">配置 turbo.json</h4>
<p>这是 Turborepo 的大脑。我们需要告诉它，Strapi 的构建产物在哪里，以及哪些任务需要并行。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://turborepo.com/schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-comment">// 依赖上游的 build (例如 backend 依赖插件先 build 完)</span>
      <span class="hljs-attr">"dependsOn"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"^build"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// 告诉 Turbo 哪些文件是产物，下次命中缓存直接恢复，不用真跑</span>
      <span class="hljs-attr">"outputs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dist/**"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"build/**"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">".next/**"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-comment">// 开发服务器不需要缓存，且需要持久化运行</span>
      <span class="hljs-attr">"cache"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"persistent"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>小技巧</strong>：Strapi 的产物在 <code>build/</code>，插件在 <code>dist/</code>，VitePress 在 <code>.vitepress/dist</code>。确保把这些目录都加到 <code>outputs</code> 里，Turbo 的缓存才能生效。</p>
<h4 data-id="heading-17">一键启动全栈环境</h4>
<p>在根目录运行：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm dev
</code></pre>
<p>Turborepo 会自动寻找所有子项目中的 <code>dev</code> 脚本并并行执行：</p>
<ul>
<li>✅ <strong>Backend</strong>: 启动 Strapi CMS (<code>http://localhost:1337</code>)</li>
<li>✅ <strong>Plugin</strong>: 开启 TypeScript 实时编译监听</li>
<li>✅ <strong>Docs</strong>: 启动 VitePress 文档 (<code>http://localhost:5173</code>)</li>
</ul>
<p>所有日志汇聚在一个终端，互不干扰，配合极好。</p>
<h4 data-id="heading-18">精准构建</h4>
<p>只想重新构建插件？不需要跑整个仓库：</p>
<pre><code class="hljs language-bash" lang="bash">turbo run build --filter=strapi-plugin-bag
</code></pre>
<p>Turbo 的 <code>--filter</code> 参数非常强大，支持依赖拓扑筛选。比如 <code>turbo run build --filter=backend...</code> 会自动先构建 backend 依赖的所有包（插件），然后再构建 backend，--filter=等于项目名字(在package.json)</p>
<h3 data-id="heading-19">📝 总结</h3>
<p>通过引入 Turborepo，我们将分散的 Strapi 插件开发流程整合成了一个有机的整体。</p>
<ul>
<li><strong>开发</strong>：<code>pnpm dev</code> 一键起飞。</li>
<li><strong>调试</strong>：Workspace 软链接让源码修改即时生效。</li>
<li><strong>文档</strong>：代码和文档同仓管理，版本同步更容易。</li>
</ul>
<p>如果你也在做 Strapi 插件开发，强烈推荐尝试这种架构，它会让你从繁琐的 <code>cd</code> 命令中解放出来，专注于代码本身。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ab86cdce434487bbea4507fbe1941d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6Iiq6am_56uZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766581558&amp;x-signature=ZNCrYEB0pUmRqYQKcZ3TaldJOHo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-20">总结：该怎么选？</h3>

























<table><thead><tr><th align="left">模式</th><th align="left">适用场景</th><th align="left">关键特点</th></tr></thead><tbody><tr><td align="left"><strong>Multirepo</strong></td><td align="left">团队完全隔离，技术栈无关，项目间几乎没有代码复用。</td><td align="left">简单，但协作成本高。</td></tr><tr><td align="left"><strong>Monorepo</strong></td><td align="left">全栈团队，前后端紧密协作，有公共组件库或工具库。</td><td align="left">协作爽，代码复用率高。</td></tr><tr><td align="left"><strong>Turborepo</strong></td><td align="left"><strong>只要你用了 Monorepo，就强烈建议用它！</strong></td><td align="left">让 Monorepo 快得飞起。</td></tr></tbody></table>
<p><strong>一句话总结：</strong>
Monorepo 是一种<strong>架构风格</strong>（把大家聚在一起），而 Turborepo 是<strong>工具</strong>（让大家聚在一起还能高效干活）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 JavaScript 可以单线程却能处理异步？]]></title>    <link>https://juejin.cn/post/7584650857070641161</link>    <guid>https://juejin.cn/post/7584650857070641161</guid>    <pubDate>2025-12-17T13:07:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650857070641161" data-draft-id="7584680708138827827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 JavaScript 可以单线程却能处理异步？"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-17T13:07:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天涯学馆"/> <meta itemprop="url" content="https://juejin.cn/user/3394916565129287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 JavaScript 可以单线程却能处理异步？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394916565129287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天涯学馆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:07:48.000Z" title="Wed Dec 17 2025 13:07:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天咱们聊一个前端最核心的机制：​<strong>​JavaScript 单线程却能处理异步操作的秘密——事件循环（Event Loop）​</strong>​。</p>
<p>你可能遇到过这种情况：用 <code>setTimeout</code> 延迟执行代码，或者用 <code>fetch</code> 发网络请求时，主线程并没有卡住，反而能继续执行后面的代码。明明 JS 是单线程的（同一时间只能做一件事），这是怎么做到的？</p>
<p>别急，我会用 ​<strong>​“底层机制+代码演示+流程拆解”​</strong>​ 的方式，带你彻底搞懂事件循环的运行原理。</p>
<h2 data-id="heading-0">前置知识：JS 单线程的本质</h2>
<h3 data-id="heading-1">什么是单线程？</h3>
<p>单线程指的是 ​<strong>​JavaScript 引擎（如 V8）的主线程同一时间只能执行一个任务​</strong>​。这意味着：</p>
<ul>
<li>所有同步代码必须按顺序执行，前一个任务没完成，后一个任务必须等待；</li>
<li>如果有一个任务耗时很长（比如死循环、大量计算），后面的任务会被“阻塞”（卡住）。</li>
</ul>
<p>​<strong>​举个栗子​</strong>​：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始'</span>);
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {  <span class="hljs-comment">// 死循环（耗时任务）</span>
  <span class="hljs-comment">// 主线程被卡死，后面的代码永远执行不到</span>
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'结束'</span>);  <span class="hljs-comment">// 永远不会输出</span>
</code></pre>
<p>这就是单线程的“缺陷”——容易阻塞。但 JS 又必须处理异步操作（比如网络请求、文件读取），否则早就被淘汰了。</p>
<h3 data-id="heading-2">为什么 JS 必须支持异步？</h3>
<p>因为浏览器需要处理大量“耗时但不阻塞主线程”的操作：</p>
<ul>
<li>网络请求（<code>fetch</code>、<code>XMLHttpRequest</code>）；</li>
<li>定时器（<code>setTimeout</code>、<code>setInterval</code>）；</li>
<li>事件监听（点击、滚动）；</li>
<li>文件操作（Node.js 中的 <code>fs</code> 模块）。</li>
</ul>
<p>如果这些操作都用同步方式执行，浏览器会直接“假死”（比如点一个按钮要等 3 秒才能响应）。所以 JS 必须设计一套机制，让这些耗时操作“在后台执行”，不阻塞主线程。</p>
<h2 data-id="heading-3">事件循环的核心角色：谁在“调度”任务？</h2>
<p>要理解事件循环，必须先明确 JS 运行时的几个核心“角色”：</p>






























<table><thead><tr><th>角色</th><th>职责</th><th>所属环境</th></tr></thead><tbody><tr><td>​<strong>​调用栈（Call Stack）​</strong>​</td><td>存储同步任务的执行上下文（函数调用链），按“后进先出”顺序执行</td><td>JS 引擎（V8）</td></tr><tr><td>​<strong>​Web APIs​</strong>​</td><td>浏览器提供的“后台线程能力”（如定时器、网络请求、DOM 事件监听）</td><td>浏览器（非 JS 引擎）</td></tr><tr><td>​<strong>​任务队列（Task Queue）​</strong>​</td><td>存储异步任务完成后的“回调函数”，等待事件循环调度执行</td><td>浏览器</td></tr><tr><td>​<strong>​事件循环（Event Loop）​</strong>​</td><td>不断检查调用栈是否为空，若为空则从任务队列中取出回调函数执行</td><td>浏览器</td></tr></tbody></table>
<p>​<strong>​一句话总结​</strong>​：<br/>
JS 主线程（调用栈）只负责执行同步代码；遇到异步操作（如 <code>setTimeout</code>），就交给 Web APIs 后台处理；Web APIs 完成任务后，把回调函数“丢”到任务队列；事件循环负责“盯着”调用栈，一旦调用栈空了，就从任务队列里“捞”回调函数来执行。</p>
<h2 data-id="heading-4">事件循环的执行流程（附代码演示）</h2>
<h3 data-id="heading-5">基础流程：同步任务 → 微任务 → 宏任务</h3>
<p>事件循环的执行顺序有一个核心规则：​<strong>​同步任务优先，微任务（Microtask）次之，宏任务（Macrotask）最后​</strong>​。</p>
<h4 data-id="heading-6">关键概念区分：</h4>
<ul>
<li>​<strong>​同步任务​</strong>​：直接在调用栈中执行的任务（如 <code>console.log</code>、普通函数调用）；</li>
<li>​<strong>​微任务​</strong>​：由 <code>Promise.then</code>、<code>MutationObserver</code> 等 API 产生的回调，优先级高于宏任务；</li>
<li>​<strong>​宏任务​</strong>​：由 <code>setTimeout</code>、<code>setInterval</code>、<code>I/O</code>、DOM 事件等 API 产生的回调，优先级低于微任务。</li>
</ul>
<h4 data-id="heading-7">代码演示 1：基础执行顺序</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1: 同步任务'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3: 宏任务（setTimeout）'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2: 微任务（Promise.then）'</span>);
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4: 微任务（另一个 Promise.then）'</span>);
  });
</code></pre>
<p>​<strong>​输出顺序​</strong>​：<code>1 → 2 → 4 → 3</code></p>
<p>​<strong>​执行流程拆解​</strong>​：</p>
<ol>
<li>
<p>​<strong>​执行同步任务​</strong>​：调用栈先执行 <code>console.log('1')</code>，输出 <code>1</code>；</p>
</li>
<li>
<p>​<strong>​处理异步任务​</strong>​：</p>
<ul>
<li>遇到 <code>setTimeout</code>，将其交给 Web APIs 的定时器线程处理（定时 0ms）；</li>
<li>遇到 <code>Promise.resolve().then()</code>，将其回调（第一个 <code>then</code>）加入微任务队列；</li>
</ul>
</li>
<li>
<p>​<strong>​同步任务执行完毕​</strong>​：调用栈清空；</p>
</li>
<li>
<p>​<strong>​执行微任务​</strong>​：事件循环检查微任务队列，按顺序执行两个 <code>then</code> 回调，输出 <code>2</code> 和 <code>4</code>；</p>
</li>
<li>
<p>​<strong>​执行宏任务​</strong>​：微任务队列清空后，事件循环检查宏任务队列，执行 <code>setTimeout</code> 的回调，输出 <code>3</code>。</p>
</li>
</ol>
<h3 data-id="heading-8">进阶流程：嵌套异步任务</h3>
<p>实际代码中，异步任务可能嵌套（比如 <code>setTimeout</code> 里又有 <code>Promise</code>），事件循环的处理逻辑依然遵循“同步→微任务→宏任务”的顺序，但需要注意​<strong>​每一轮事件循环只处理一个宏任务​</strong>​（除非宏任务队列为空）。</p>
<h4 data-id="heading-9">代码演示 2：嵌套异步任务</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'A: 同步任务'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'B: 宏任务（外层 setTimeout）'</span>);
  
  <span class="hljs-comment">// 嵌套的微任务</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'C: 微任务（外层 setTimeout 内的 then）'</span>);
  });
  
  <span class="hljs-comment">// 嵌套的宏任务</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'D: 宏任务（内层 setTimeout）'</span>);
  }, <span class="hljs-number">0</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 顶层的微任务</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'E: 微任务（顶层 then）'</span>);
});
</code></pre>
<p>​<strong>​输出顺序​</strong>​：<code>A → E → B → C → D</code></p>
<p>​<strong>​执行流程拆解​</strong>​：</p>
<ol>
<li>
<p>​<strong>​执行同步任务​</strong>​：输出 <code>A</code>；</p>
</li>
<li>
<p>​<strong>​处理异步任务​</strong>​：</p>
<ul>
<li>外层 <code>setTimeout</code> 交给定时器线程（0ms）；</li>
<li>顶层 <code>Promise.then</code> 回调加入微任务队列；</li>
</ul>
</li>
<li>
<p>​<strong>​同步任务结束​</strong>​：调用栈清空；</p>
</li>
<li>
<p>​<strong>​执行微任务​</strong>​：执行顶层 <code>then</code> 回调，输出 <code>E</code>；</p>
</li>
<li>
<p>​<strong>​第一轮事件循环结束​</strong>​，开始处理宏任务队列：</p>
<ul>
<li>取出外层 <code>setTimeout</code> 的回调执行，输出 <code>B</code>；</li>
<li>外层 <code>setTimeout</code> 回调中遇到新的 <code>Promise.then</code>，将其加入微任务队列；</li>
<li>外层 <code>setTimeout</code> 回调中遇到内层 <code>setTimeout</code>，交给定时器线程（0ms）；</li>
</ul>
</li>
<li>
<p>​<strong>​第一轮宏任务处理完毕​</strong>​，立即执行新产生的微任务：</p>
<ul>
<li>执行外层 <code>setTimeout</code> 内的 <code>then</code> 回调，输出 <code>C</code>；</li>
</ul>
</li>
<li>
<p>​<strong>​第二轮事件循环开始​</strong>​，处理宏任务队列：</p>
<ul>
<li>取出内层 <code>setTimeout</code> 的回调执行，输出 <code>D</code>。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">特殊场景：DOM 事件与异步</h3>
<p>DOM 事件（如点击、滚动）的回调属于宏任务，但它们的触发时机与事件循环密切相关。</p>
<h4 data-id="heading-11">代码演示 3：DOM 事件回调</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"btn"</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1: 同步任务'</span>);

  <span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'btn'</span>);
  btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3: DOM 事件回调（宏任务）'</span>);
    
    <span class="hljs-comment">// 事件回调中的微任务</span>
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4: 事件回调内的微任务'</span>);
    });
  });

  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2: 宏任务（setTimeout）'</span>);
  }, <span class="hljs-number">0</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>​<strong>​可能的输出顺序​</strong>​（取决于用户何时点击按钮）：</p>
<ul>
<li>如果用户在 <code>setTimeout</code> 回调执行前点击按钮：<code>1 → 3 → 4 → 2</code>；</li>
<li>如果用户在 <code>setTimeout</code> 回调执行后点击按钮：<code>1 → 2 → 3 → 4</code>。</li>
</ul>
<p>​<strong>​执行流程拆解​</strong>​：</p>
<ol>
<li>
<p>执行同步任务，输出 <code>1</code>；</p>
</li>
<li>
<p>注册 <code>setTimeout</code>（宏任务）和 <code>click</code> 事件监听（宏任务）；</p>
</li>
<li>
<p>若用户先点击按钮：</p>
<ul>
<li>点击事件触发，回调被加入宏任务队列；</li>
<li><code>setTimeout</code> 回调也被加入宏任务队列；</li>
<li>事件循环先处理 <code>click</code> 宏任务（因为先进入队列），输出 <code>3</code>；</li>
<li>执行 <code>click</code> 回调中的微任务，输出 <code>4</code>；</li>
<li>最后处理 <code>setTimeout</code> 宏任务，输出 <code>2</code>；</li>
</ul>
</li>
<li>
<p>若用户后点击按钮：</p>
<ul>
<li><code>setTimeout</code> 回调先被处理，输出 <code>2</code>；</li>
<li>然后处理 <code>click</code> 宏任务，输出 <code>3</code>；</li>
<li>最后执行 <code>click</code> 回调中的微任务，输出 <code>4</code>。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-12">为什么 JS 单线程还能“异步”？核心答案</h2>
<p>现在回到最初的问题：​<strong>​JS 单线程却能处理异步，本质原因是什么？​</strong>​</p>
<h3 data-id="heading-13">异步操作不由 JS 引擎主线程执行</h3>
<p>JS 引擎（如 V8）只负责执行同步代码和调度任务。像网络请求、定时器这些耗时操作，实际是由浏览器的其他线程（如网络线程、定时器线程）完成的。JS 主线程只需要“注册”异步任务（比如告诉定时器线程“3 秒后执行这个函数”），然后继续执行后面的同步代码。</p>
<h3 data-id="heading-14">事件循环负责“调度”异步回调</h3>
<p>当异步任务完成后（比如定时器到时间、网络请求返回数据），浏览器会将对应的回调函数放入任务队列。事件循环会不断检查调用栈是否为空：</p>
<ul>
<li>如果调用栈空了，就从任务队列中取出回调函数，交给调用栈执行；</li>
<li>如果调用栈不空（还在执行同步代码），事件循环就继续等待。</li>
</ul>
<h3 data-id="heading-15">微任务和宏任务的优先级设计</h3>
<p>通过区分微任务和宏任务，JS 可以更精细地控制异步回调的执行顺序。微任务（如 <code>Promise.then</code>）会在当前调用栈清空后立即执行（属于“本轮事件循环”），而宏任务（如 <code>setTimeout</code>）会在下一轮事件循环执行。这种设计保证了异步操作的高效调度。</p>
<h2 data-id="heading-16">事件循环的“隐藏阶段”：浏览器和 Node.js 的差异</h2>
<p>你可能不知道：​<strong>​浏览器和 Node.js 的事件循环实现完全不同​</strong>​！虽然核心目标一致（调度异步任务），但具体阶段划分和执行顺序差异很大。</p>
<h3 data-id="heading-17">浏览器的事件循环：聚焦“渲染”与“用户交互”</h3>
<p>浏览器的事件循环围绕 ​<strong>​“页面渲染”​</strong>​ 设计，核心目标是让用户界面流畅响应。它的执行流程可简化为以下步骤（简化版）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 执行调用栈中的同步任务 → 
<span class="hljs-bullet">2.</span> 执行所有微任务（Microtask Queue） → 
<span class="hljs-bullet">3.</span> 检查是否需要渲染（如距离上次渲染超过 16ms） → 
   a. 执行 UI 渲染（重排/重绘） → 
<span class="hljs-bullet">4.</span> 从宏任务队列（Macrotask Queue）中取出一个任务执行 → 
<span class="hljs-bullet">5.</span> 重复步骤 2~4（直到所有队列为空）
</code></pre>
<p>​<strong>​关键细节​</strong>​：</p>
<ul>
<li>​<strong>​渲染时机​</strong>​：浏览器默认以 ​<strong>​60Hz 刷新率​</strong>​（约 16ms/帧）渲染页面。如果同步任务执行时间超过 16ms，会导致“掉帧”（页面卡顿）。因此，事件循环会在每轮宏任务后检查是否需要渲染，避免长时间阻塞渲染。</li>
<li>​<strong>​宏任务的“公平性”​</strong>​：浏览器宏任务队列是“队列优先”（FIFO），但为了保证交互响应，用户触发的事件（如点击、滚动）的回调会被“插队”到队列头部，优先执行。</li>
</ul>
<p>​<strong>​代码演示：渲染与事件循环的关系​</strong>​</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始'</span>);

<span class="hljs-comment">// 同步任务：耗时 20ms（超过 16ms 渲染间隔）</span>
<span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">while</span> (performance.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">20</span>) {}

<span class="hljs-comment">// 宏任务：setTimeout</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout 执行'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 微任务：Promise.then</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Promise.then 执行'</span>);
});

<span class="hljs-comment">// 输出顺序：开始 → Promise.then → setTimeout 执行</span>
</code></pre>
<p>​<strong>​执行流程​</strong>​：</p>
<ul>
<li>同步任务耗时 20ms，导致页面无法在第 16ms 渲染（掉帧）；</li>
<li>同步任务结束后，先执行微任务（<code>Promise.then</code>）；</li>
<li>最后执行宏任务（<code>setTimeout</code>）。</li>
</ul>
<h3 data-id="heading-18">Node.js 的事件循环：聚焦“ I/O 与异步操作”</h3>
<p>Node.js 的事件循环是为 ​<strong>​服务器端高并发 I/O​</strong>​ 设计的，核心目标是高效处理大量异步 I/O 请求（如文件读写、数据库查询）。它的阶段划分更复杂，具体分为 6 个阶段（按执行顺序）：</p>








































<table><thead><tr><th>阶段</th><th>职责</th><th>对应的宏任务类型</th></tr></thead><tbody><tr><td>​<strong>​timers​</strong>​</td><td>执行 <code>setTimeout</code>、<code>setInterval</code> 的回调</td><td>定时器相关宏任务</td></tr><tr><td>​<strong>​I/O callbacks​</strong>​</td><td>处理上一轮未完成的 I/O 错误回调（如 TCP 连接错误）</td><td>系统级 I/O 错误回调</td></tr><tr><td>​<strong>​idle/prepare​</strong>​</td><td>内部使用，仅在 Node.js 启动时执行</td><td>无</td></tr><tr><td>​<strong>​poll​</strong>​</td><td>核心阶段：等待新的 I/O 事件（如文件读取完成、网络请求响应）</td><td>大部分 I/O 相关宏任务（除 <code>setImmediate</code>）</td></tr><tr><td>​<strong>​check​</strong>​</td><td>执行 <code>setImmediate</code> 的回调</td><td><code>setImmediate</code> 宏任务</td></tr><tr><td>​<strong>​close callbacks​</strong>​</td><td>执行关闭事件的回调（如 <code>socket.on('close')</code>）</td><td>连接关闭相关回调</td></tr></tbody></table>
<p>​<strong>​关键细节​</strong>​：</p>
<ul>
<li>​<strong>​<code>setImmediate</code> vs <code>setTimeout(0)</code>​</strong>​：
<ul>
<li><code>setImmediate</code> 的回调在 <code>check</code> 阶段执行（本轮事件循环的最后阶段）；</li>
<li><code>setTimeout(0)</code> 的回调在 <code>timers</code> 阶段执行（下一轮事件循环的开始阶段）。<br/>
因此，<code>setImmediate</code> 永远比 <code>setTimeout(0)</code> 先执行（在 Node.js 中）。</li>
</ul>
</li>
</ul>
<p>​<strong>​代码演示：Node.js 事件循环阶段​</strong>​</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// 阶段 1：timers（setTimeout）</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1: setTimeout（timers 阶段）'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-comment">// 阶段 4：poll（fs.readFile 是 I/O 操作）</span>
fs.<span class="hljs-title function_">readFile</span>(__filename, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2: fs.readFile 回调（poll 阶段）'</span>);
  
  <span class="hljs-comment">// 阶段 5：check（setImmediate）</span>
  <span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3: setImmediate（check 阶段）'</span>);
  });
  
  <span class="hljs-comment">// 阶段 1：timers（嵌套的 setTimeout）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4: 嵌套 setTimeout（timers 阶段）'</span>);
  }, <span class="hljs-number">0</span>);
});

<span class="hljs-comment">// 阶段 5：check（直接调用 setImmediate）</span>
<span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5: 顶层 setImmediate（check 阶段）'</span>);
});
</code></pre>
<p>​<strong>​输出顺序​</strong>​（每次运行可能略有不同，但 <code>setImmediate</code> 总在 <code>setTimeout(0)</code> 前）：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">1: setTimeout（timers 阶段）</span>
<span class="hljs-section">2: fs.readFile 回调（poll 阶段）</span>
<span class="hljs-section">3: setImmediate（check 阶段）</span>
<span class="hljs-section">5: 顶层 setImmediate（check 阶段）</span>
<span class="hljs-section">4: 嵌套 setTimeout（timers 阶段）</span>
</code></pre>
<h2 data-id="heading-19">宏任务与微任务的“细分家族”：你以为的“宏任务”可能不是真宏任务</h2>
<p>之前我们简单区分了宏任务和微任务，但实际上它们的“家族成员”各有不同。明确每个任务的来源，能帮你更精准地控制执行顺序。</p>
<h3 data-id="heading-20">宏任务（Macrotask）的常见类型</h3>
<p>宏任务是“需要等待当前调用栈和微任务队列清空后才能执行”的任务，常见来源包括：</p>



































<table><thead><tr><th>来源</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>​<strong>​定时器​</strong>​</td><td><code>setTimeout</code>、<code>setInterval</code></td><td>基于时间的延迟执行</td></tr><tr><td>​<strong>​I/O 操作​</strong>​</td><td><code>fs.readFile</code>（Node.js）、<code>fetch</code></td><td>网络请求、文件读写等异步 I/O</td></tr><tr><td>​<strong>​UI 渲染​</strong>​（浏览器）</td><td><code>requestAnimationFrame</code>（部分场景）</td><td>浏览器渲染帧的回调</td></tr><tr><td>​<strong>​事件监听​</strong>​</td><td><code>click</code>、<code>scroll</code> 等 DOM 事件回调</td><td>用户交互触发的回调</td></tr><tr><td>​<strong>​<code>setImmediate</code>​</strong>​（Node.js）</td><td><code>setImmediate(() =&gt; {})</code></td><td>Node.js 特有的“本轮事件循环结束后”执行</td></tr></tbody></table>
<h3 data-id="heading-21">微任务（Microtask）的常见类型</h3>
<p>微任务是“在当前调用栈清空后立即执行”的任务，优先级高于宏任务，常见来源包括：</p>






























<table><thead><tr><th>来源</th><th>示例</th><th>说明</th></tr></thead><tbody><tr><td>​<strong>​Promise 回调​</strong>​</td><td><code>Promise.then()</code>、<code>Promise.catch()</code></td><td>Promise 状态变为 <code>fulfilled</code> 或 <code>rejected</code> 后的回调</td></tr><tr><td>​<strong>​MutationObserver​</strong>​（浏览器）</td><td><code>new MutationObserver(callback)</code></td><td>监听 DOM 变化的回调</td></tr><tr><td>​<strong>​process.nextTick​</strong>​（Node.js）</td><td><code>process.nextTick(() =&gt; {})</code></td><td>Node.js 特有的“微任务队列优先级最高”的任务（比普通微任务更早执行）</td></tr><tr><td>​<strong>​async/await​</strong>​（本质是 Promise）</td><td><code>async function() { await ... }</code></td><td><code>await</code> 后的代码会被包装成微任务</td></tr></tbody></table>
<p>​<strong>​关键细节​</strong>​：</p>
<ul>
<li><code>async/await</code> 的底层是 Promise：<code>await</code> 会暂停函数执行，将后续代码包装成微任务，等待 Promise 解决后执行。</li>
<li><code>process.nextTick</code> 在 Node.js 中是“伪微任务”：它的优先级比普通微任务（如 <code>Promise.then</code>）更高，会在当前调用栈清空后​<strong>​立即执行​</strong>​（甚至在宏任务之前）。</li>
</ul>
<p>​<strong>​代码演示：Node.js 中 <code>process.nextTick</code> 的优先级​</strong>​</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1: setTimeout（宏任务）'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2: Promise.then（微任务）'</span>);
});

process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3: process.nextTick（伪微任务）'</span>);
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'结束'</span>);
</code></pre>
<p>​<strong>​输出顺序​</strong>​：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">开始</span> <span class="hljs-string">→</span> <span class="hljs-string">结束</span> <span class="hljs-string">→</span> <span class="hljs-attr">3:</span> <span class="hljs-string">process.nextTick</span> <span class="hljs-string">→</span> <span class="hljs-attr">2:</span> <span class="hljs-string">Promise.then</span> <span class="hljs-string">→</span> <span class="hljs-attr">1:</span> <span class="hljs-string">setTimeout</span>
</code></pre>
<h2 data-id="heading-22">调试工具：用 Chrome DevTools“看见”事件循环</h2>
<p>理论看懂了，但如何验证？推荐用 Chrome DevTools 的 ​<strong>​Performance 面板​</strong>​ 直接观察事件循环的执行过程。</p>
<h3 data-id="heading-23">步骤 1：打开 Performance 面板</h3>
<ol>
<li>按 <code>F12</code> 打开 DevTools；</li>
<li>点击 <code>Performance</code> 标签；</li>
<li>点击左上角的 <code>录制</code> 按钮（或按 <code>Ctrl+E</code>）开始记录。</li>
</ol>
<h3 data-id="heading-24">步骤 2：执行测试代码</h3>
<p>在控制台执行以下代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步任务'</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'宏任务（setTimeout）'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'微任务（Promise.then）'</span>);
});
</code></pre>
<h3 data-id="heading-25">步骤 3：分析记录结果</h3>
<p>停止录制后，Performance 面板会显示时间线。重点关注 ​<strong>​Main 线程​</strong>​ 的调用栈和任务队列：</p>
<ul>
<li>​<strong>​同步任务​</strong>​：显示为连续的调用栈（如 <code>console.log('同步任务')</code>）；</li>
<li>​<strong>​微任务​</strong>​：在调用栈清空后，显示为 <code>Promise.then</code> 的执行；</li>
<li>​<strong>​宏任务​</strong>​：在微任务执行后，显示为 <code>setTimeout</code> 的回调执行。</li>
</ul>
<p>​<strong>​截图示例​</strong>​（文字描述）：</p>
<ul>
<li>时间轴 0ms：开始执行同步任务；</li>
<li>时间轴 1ms：同步任务结束，调用栈清空；</li>
<li>时间轴 1ms：执行微任务（<code>Promise.then</code>）；</li>
<li>时间轴 2ms：微任务结束，开始执行宏任务（<code>setTimeout</code>）。</li>
</ul>
<h2 data-id="heading-26">实战避坑：事件循环的常见陷阱</h2>
<h3 data-id="heading-27">陷阱 1：定时器“延迟不准”</h3>
<p>你可能遇到过：<code>setTimeout(fn, 100)</code> 实际执行时间远大于 100ms。原因是 ​<strong>​同步任务耗时过长，阻塞了事件循环​</strong>​，导致定时器回调无法按时执行。</p>
<p>​<strong>​示例​</strong>​：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'定时器执行'</span>); <span class="hljs-comment">// 实际延迟可能远大于 100ms</span>
}, <span class="hljs-number">100</span>);

<span class="hljs-comment">// 同步任务耗时 1000ms</span>
<span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">1000</span>) {}
</code></pre>
<p>​<strong>​解决方案​</strong>​：</p>
<ul>
<li>避免在主线程执行耗时操作（如大数据计算）；</li>
<li>将耗时任务拆分为小任务（用 <code>setTimeout</code> 或 <code>requestIdleCallback</code> 分段执行）；</li>
<li>使用 Web Workers（浏览器）或 Worker Threads（Node.js）将任务放到后台线程。</li>
</ul>
<h3 data-id="heading-28">陷阱 2：微任务“堆积导致页面卡死”</h3>
<p>微任务会在当前调用栈清空后立即执行，如果微任务队列无限增长（如递归调用 <code>Promise.then</code>），会导致页面永远无法渲染（因为事件循环被微任务阻塞）。</p>
<p>​<strong>​示例​</strong>​：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">recursiveMicrotask</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'微任务执行'</span>);
    <span class="hljs-title function_">recursiveMicrotask</span>(); <span class="hljs-comment">// 递归添加微任务</span>
  });
}

<span class="hljs-title function_">recursiveMicrotask</span>();
</code></pre>
<p>​<strong>​现象​</strong>​：</p>
<ul>
<li>控制台会无限输出 <code>微任务执行</code>；</li>
<li>页面无法响应点击、滚动等交互（因为事件循环被微任务队列占满，无法执行渲染或事件回调）。</li>
</ul>
<p>​<strong>​解决方案​</strong>​：</p>
<ul>
<li>避免在微任务中递归调用自身；</li>
<li>限制微任务的数量（如设置最大递归次数）；</li>
<li>将部分任务转为宏任务（如用 <code>setTimeout</code> 包裹）。</li>
</ul>
<h3 data-id="heading-29">陷阱 3：Node.js 中 <code>setImmediate</code> 与 <code>setTimeout</code> 的“竞争”</h3>
<p>在 Node.js 中，<code>setImmediate</code> 和 <code>setTimeout(0)</code> 的执行顺序可能不稳定（取决于事件循环的启动时间）。</p>
<p>​<strong>​示例​</strong>​：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setTimeout（timers 阶段）'</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setImmediate（check 阶段）'</span>);
});
</code></pre>
<p>​<strong>​可能的输出​</strong>​：</p>
<ul>
<li>第一次运行：<code>setTimeout</code> 先执行（如果 <code>timers</code> 阶段的延迟接近 0）；</li>
<li>第二次运行：<code>setImmediate</code> 先执行（如果 <code>timers</code> 阶段没有其他任务）。</li>
</ul>
<p>​<strong>​解决方案​</strong>​：</p>
<ul>
<li>如果需要严格的执行顺序，避免依赖 <code>setImmediate</code> 和 <code>setTimeout(0)</code> 的顺序；</li>
<li>明确使用 <code>setImmediate</code> 表示“本轮事件循环结束后执行”，<code>setTimeout</code> 表示“延迟指定时间后执行”。</li>
</ul>
<h2 data-id="heading-30">常见误区与总结</h2>
<h3 data-id="heading-31">误区 1：JS 是多线程的？</h3>
<p>​<strong>​错误​</strong>​。JS 主线程是单线程的，但浏览器环境（如 Web APIs）是多线程的。JS 通过事件循环与这些线程协作，实现了“异步”的效果。</p>
<h3 data-id="heading-32">误区 2：<code>setTimeout(0)</code> 会立即执行？</h3>
<p>​<strong>​错误​</strong>​。<code>setTimeout(0)</code> 表示“将回调函数放入宏任务队列，等待当前调用栈和微任务队列清空后立即执行”，而不是立即执行。</p>
<h3 data-id="heading-33">误区 3：微任务比宏任务优先级高，所以会插队？</h3>
<p>​<strong>​正确​</strong>​。微任务队列的优先级高于宏任务队列，所以每轮事件循环会先清空微任务队列，再处理宏任务队列。</p>
<h2 data-id="heading-34">事件循环的“口诀”</h2>
<p>事件循环的核心是 ​<strong>​“协作式调度”​</strong>​：JS 主线程负责同步任务，异步任务交给其他线程处理，完成后通过回调函数“排队”，事件循环按优先级（微任务→宏任务）调度执行。</p>
<p>同步任务先执行，调用栈里排好队；<br/>
遇到异步交后台，Web APIs 帮你忙；<br/>
定时网络事件等，完成回调放队列；<br/>
微任务队列优先级，当前循环接着跑；<br/>
宏任务队列下一轮，事件循环来回跑；<br/>
单线程不阻塞住，异步全靠事件环。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【AI 编程实战】第 4 篇：一次完美 vs 五轮对话 - UnoCSS 配置的正确姿势]]></title>    <link>https://juejin.cn/post/7584472215976116239</link>    <guid>https://juejin.cn/post/7584472215976116239</guid>    <pubDate>2025-12-17T12:07:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215976116239" data-draft-id="7584633505104724020" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【AI 编程实战】第 4 篇：一次完美 vs 五轮对话 - UnoCSS 配置的正确姿势"/> <meta itemprop="keywords" content="前端,uni-app,AI编程"/> <meta itemprop="datePublished" content="2025-12-17T12:07:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HashTang"/> <meta itemprop="url" content="https://juejin.cn/user/1117561754756488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【AI 编程实战】第 4 篇：一次完美 vs 五轮对话 - UnoCSS 配置的正确姿势
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117561754756488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HashTang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:07:48.000Z" title="Wed Dec 17 2025 12:07:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><blockquote>
<p>很多教程告诉你"写好提示词就能让 AI 一次给出正确答案"，但现实是：<strong>你不可能一开始就知道所有细节</strong>。真正高效的 AI 协作，是在对话中逐步明确需求。这篇文章通过一个完整的 UnoCSS 配置案例，展示我和 TRAE SOLO 的<strong>真实交互过程</strong>——从模糊想法到完整方案，中间经历了哪些沟通和调整。</p>
<p>这是《<a href="https://juejin.cn/column/7579556047783624756" target="_blank" title="https://juejin.cn/column/7579556047783624756">AI 编程实战：TRAE SOLO 全栈开发指南</a>》专栏的第四篇文章，带你学会如何与 AI 正确的沟通协作。</p>
</blockquote>
<h2 data-id="heading-0">一、开篇：别被"完美提示词"骗了</h2>
<h3 data-id="heading-1">1.1 一个常见的误区</h3>
<p>网上很多 AI 教程会给你看这样的"完美提示词"：</p>
<pre><code class="hljs language-txt" lang="txt">帮我配置 UnoCSS，项目环境和需求如下：
【项目环境】UniApp + Vue3 + Vite，目标平台微信小程序
【功能需求】支持 attributify、@apply、图标、安全区适配
【已知问题】小程序 transform 类需要预设 CSS 变量
【输出要求】完整的 uno.config.ts 配置文件
</code></pre>
<p>然后告诉你："看，一次就能得到完美答案！"</p>
<p><strong>但问题是</strong>：</p>
<ul>
<li>你一开始怎么知道需要"安全区适配"？</li>
<li>你怎么知道"transform 类需要预设 CSS 变量"？</li>
<li>这些都是<strong>踩坑之后才知道的</strong></li>
</ul>
<h3 data-id="heading-2">1.2 真实的 AI 协作是什么样的</h3>
<p>真实的 AI 协作是一个<strong>渐进式对话</strong>的过程：</p>
<pre><code class="hljs language-txt" lang="txt">第 1 轮：我有个模糊的需求
    ↓
AI：给出初步方案 + 执行计划
    ↓
第 2 轮：我发现问题 / 补充细节
    ↓
AI：调整方案
    ↓
第 3 轮：遇到报错 / 样式不生效
    ↓
AI：排查问题 + 修复
    ↓
最终：得到完整可用的方案
</code></pre>
<p>接下来，我会完整展示和 TRAE SOLO 配置 UnoCSS 的<strong>真实对话过程</strong>。</p>
<h2 data-id="heading-3">二、第一轮对话：从模糊需求开始</h2>
<h3 data-id="heading-4">2.1 我的第一句话</h3>
<p>刚开始，我对 UnoCSS 的了解很有限，只知道它是"原子化 CSS"。我的第一句话很简单：</p>
<pre><code class="hljs language-txt" lang="txt">我：项目需要用 UnoCSS，帮我配置一下
</code></pre>
<h3 data-id="heading-5">2.2 TRAE SOLO 的响应：先给执行计划</h3>
<p>TRAE SOLO 没有直接开始写代码，而是先给出了<strong>执行计划</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，我来帮你配置 UnoCSS。在开始之前，我需要先了解一些信息：

📋 执行计划：
1. 分析项目结构，确定技术栈
2. 选择合适的 UnoCSS 预设
3. 生成配置文件
4. 配置 Vite 插件

🤔 我有几个问题：
1. 这是什么类型的项目？（Vue/React/UniApp）
2. 目标运行平台是什么？（Web/小程序/App）
3. 有没有特别想要的功能？（图标/attributify 模式等）

请告诉我这些信息，或者我可以先分析你的项目结构来判断。
</code></pre>
<p><strong>关键点</strong>：TRAE SOLO 主动<strong>询问上下文</strong>，而不是瞎猜。</p>
<h3 data-id="heading-6">2.3 我补充信息</h3>
<pre><code class="hljs language-txt" lang="txt">我：UniApp + Vue3 项目，主要跑微信小程序，也要支持 H5。
    功能的话，我也不太清楚，你看着配吧，常用的都加上。
</code></pre>
<h3 data-id="heading-7">2.4 TRAE SOLO 分析项目后给出方案</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：我分析了你的项目结构，发现：
- 框架：UniApp + Vue3 + Vite
- UI 库：已安装 wot-design-uni
- 目标：微信小程序 + H5

📋 更新执行计划：

1. 安装依赖
   - unocss
   - @uni-helper/unocss-preset-uni （UniApp 专用预设，必须）
   - @iconify-json/carbon （图标库，可选）

2. 创建 uno.config.ts，包含：
   - presetUni：小程序适配
   - presetAttributify：支持属性化写法
   - presetIcons：图标支持
   - transformerDirectives：支持 @apply 指令

3. 修改 vite.config.ts，添加 UnoCSS 插件

4. 在 main.ts 中引入 uno.css

是否按这个计划执行？或者你想调整什么？
</code></pre>
<h3 data-id="heading-8">2.5 我确认执行</h3>
<pre><code class="hljs language-txt" lang="txt">我：可以，就按这个来
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，开始执行...

✅ 正在安装依赖...
✅ 创建 uno.config.ts...
✅ 修改 vite.config.ts...
✅ 修改 main.ts...

配置完成！你可以这样使用：

&lt;view class="flex items-center gap-4 p-4 bg-white rounded-xl"&gt;
  &lt;text class="text-lg font-bold"&gt;Hello UnoCSS&lt;/text&gt;
&lt;/view&gt;

运行 pnpm dev:mp-weixin 试试看效果。
</code></pre>
<h2 data-id="heading-9">三、第二轮对话：遇到问题，继续沟通</h2>
<h3 data-id="heading-10">3.1 我发现样式不生效</h3>
<p>运行项目后，我发现部分样式不生效：</p>
<pre><code class="hljs language-txt" lang="txt">我：样式大部分生效了，但是 translate-x-2 这个类没效果，
    元素没有移动
</code></pre>
<h3 data-id="heading-11">3.2 TRAE SOLO 排查问题</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：让我检查一下...

我查看了生成的 CSS，发现 translate-x-2 生成的代码是：

transform: translateX(var(--un-translate-x));

问题在于：小程序环境没有预设 --un-translate-x 这个 CSS 变量。

在浏览器中，UnoCSS 会通过 :root 选择器预设这些变量，
但小程序不支持 :root 选择器。

🔧 修复方案：
在 uno.config.ts 中添加 preflights，手动为小程序元素预设变量。

是否需要我帮你修复？
</code></pre>
<h3 data-id="heading-12">3.3 我让它修复</h3>
<pre><code class="hljs language-txt" lang="txt">我：帮我修复吧
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，我来修改 uno.config.ts...

添加了以下配置：

preflights: [
  {
    layer: 'unocss-transform-fix',
    getCSS: () =&gt; `
page, view, text, image {
  --un-translate-x: 0;
  --un-translate-y: 0;
  --un-rotate: 0;
  --un-scale-x: 1;
  --un-scale-y: 1;
  /* ... 其他变量 */
}
`,
  },
],

✅ 已修复，重新运行项目试试。
</code></pre>
<h3 data-id="heading-13">3.4 我验证修复成功</h3>
<pre><code class="hljs language-txt" lang="txt">我：好了，translate 生效了
</code></pre>
<h2 data-id="heading-14">四、第三轮对话：追加新需求</h2>
<h3 data-id="heading-15">4.1 我想添加安全区适配</h3>
<p>开发过程中，我发现 iPhone 底部有安全区域遮挡内容：</p>
<pre><code class="hljs language-txt" lang="txt">我：iPhone 底部有个横条会挡住内容，UnoCSS 能处理这个吗？
</code></pre>
<h3 data-id="heading-16">4.2 TRAE SOLO 给出方案</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：这是 iPhone 的安全区域问题。可以通过自定义 UnoCSS 规则来解决。

📋 方案：
添加以下自定义规则：
- pb-safe：底部安全区内边距
- pt-safe：顶部安全区内边距（刘海屏）
- p-safe：四边安全区内边距

使用方式：
&lt;view class="pb-safe"&gt;底部内容会避开安全区&lt;/view&gt;

是否需要我添加这些规则？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：加上吧
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，在 uno.config.ts 的 rules 中添加：

rules: [
  ['pb-safe', { 'padding-bottom': 'env(safe-area-inset-bottom)' }],
  ['pt-safe', { 'padding-top': 'env(safe-area-inset-top)' }],
  ['p-safe', {
    padding: 'env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)',
  }],
],

✅ 已添加，现在可以使用 pb-safe 类了。
</code></pre>
<h2 data-id="heading-17">五、第四轮对话：优化开发体验</h2>
<h3 data-id="heading-18">5.1 我觉得类名太长了</h3>
<pre><code class="hljs language-txt" lang="txt">我：flex items-center justify-between 每次都要写这么长，
    有没有办法简化？
</code></pre>
<h3 data-id="heading-19">5.2 TRAE SOLO 介绍 shortcuts</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：可以用 UnoCSS 的 shortcuts 功能，把常用组合定义成短类名。

比如：
- center = flex justify-center items-center
- between = flex justify-between items-center

你想定义哪些快捷方式？或者我根据你的代码分析常用组合？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：你分析一下吧，看哪些用得多
</code></pre>
<h3 data-id="heading-20">5.3 TRAE SOLO 分析代码后给出建议</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：我扫描了你的代码，发现以下组合出现频率较高：

📊 使用频率分析：
1. flex items-center （出现 23 次）
2. flex items-center justify-between （出现 15 次）
3. flex items-center justify-center （出现 12 次）
4. flex flex-col （出现 8 次）
5. bg-white rounded-xl p-4 （出现 7 次）

🔧 建议添加的 shortcuts：

shortcuts: [
  { 'center': 'flex justify-center items-center' },
  { 'between': 'flex justify-between items-center' },
  { 'col': 'flex flex-col' },
  { 'card': 'bg-white rounded-xl p-4' },
],

是否按这个配置？或者你想调整？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：可以，就这样
</code></pre>
<h2 data-id="heading-21">六、第五轮对话：处理动态类名问题</h2>
<h3 data-id="heading-22">6.1 我遇到动态类名不生效</h3>
<pre><code class="hljs language-txt" lang="txt">我：我有个地方根据状态切换颜色：

    &lt;text :class="`text-${status}-500`"&gt;状态&lt;/text&gt;

    status 可能是 red、green、blue，但样式不生效
</code></pre>
<h3 data-id="heading-23">6.2 TRAE SOLO 解释原因并给方案</h3>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：这是 UnoCSS 的一个限制。

🔍 原因：
UnoCSS 在构建时静态扫描代码，`text-${status}-500` 这种
动态拼接的类名无法被识别，所以不会生成对应的 CSS。

🔧 解决方案有三种：

【方案一】对象语法（推荐）
&lt;text :class="{
  'text-red-500': status === 'red',
  'text-green-500': status === 'green',
  'text-blue-500': status === 'blue',
}"&gt;状态&lt;/text&gt;

【方案二】safelist 预声明
在 uno.config.ts 中添加：
safelist: ['text-red-500', 'text-green-500', 'text-blue-500']

【方案三】CSS 变量
&lt;text class="text-[var(--status-color)]"
      :style="{ '--status-color': statusColor }"&gt;
  状态
&lt;/text&gt;

你的场景用哪种方案比较合适？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：颜色就这三种，用方案二吧，简单
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，已添加到 safelist：

safelist: [
  'text-red-500',
  'text-green-500',
  'text-blue-500',
  'i-carbon-code', // 之前已有的图标
],

✅ 现在动态类名可以正常工作了。
</code></pre>
<h2 data-id="heading-24">七、最终配置：多轮对话的成果</h2>
<p>经过 5 轮对话，最终的 <code>uno.config.ts</code> 是这样的：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// uno.config.ts</span>
<span class="hljs-comment">// 这个配置是通过多轮对话逐步完善的，不是一次性写出来的</span>

<span class="hljs-keyword">import</span> { presetUni } <span class="hljs-keyword">from</span> <span class="hljs-string">'@uni-helper/unocss-preset-uni'</span>
<span class="hljs-keyword">import</span> {
  defineConfig,
  presetAttributify,
  presetIcons,
  transformerDirectives,
  transformerVariantGroup,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'unocss'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// 【第 1 轮】基础预设</span>
  <span class="hljs-attr">presets</span>: [
    <span class="hljs-title function_">presetUni</span>({
      <span class="hljs-attr">attributify</span>: {
        <span class="hljs-attr">prefixedOnly</span>: <span class="hljs-literal">true</span>,
      },
    }),
    <span class="hljs-title function_">presetIcons</span>({
      <span class="hljs-attr">scale</span>: <span class="hljs-number">1.2</span>,
      <span class="hljs-attr">warn</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">extraProperties</span>: {
        <span class="hljs-string">'display'</span>: <span class="hljs-string">'inline-block'</span>,
        <span class="hljs-string">'vertical-align'</span>: <span class="hljs-string">'middle'</span>,
      },
    }),
    <span class="hljs-title function_">presetAttributify</span>(),
  ],

  <span class="hljs-comment">// 【第 1 轮】转换器</span>
  <span class="hljs-attr">transformers</span>: [
    <span class="hljs-title function_">transformerDirectives</span>(),
    <span class="hljs-title function_">transformerVariantGroup</span>(),
  ],

  <span class="hljs-comment">// 【第 2 轮】修复小程序 transform 不生效</span>
  <span class="hljs-attr">preflights</span>: [
    {
      <span class="hljs-attr">layer</span>: <span class="hljs-string">'unocss-transform-fix'</span>,
      <span class="hljs-attr">getCSS</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">`
page, view, text, image {
  --un-translate-x: 0;
  --un-translate-y: 0;
  --un-translate-z: 0;
  --un-rotate: 0;
  --un-rotate-x: 0;
  --un-rotate-y: 0;
  --un-rotate-z: 0;
  --un-skew-x: 0;
  --un-skew-y: 0;
  --un-scale-x: 1;
  --un-scale-y: 1;
  --un-scale-z: 1;
}
`</span>,
    },
  ],

  <span class="hljs-comment">// 【第 3 轮】安全区适配</span>
  <span class="hljs-attr">rules</span>: [
    [<span class="hljs-string">'p-safe'</span>, {
      <span class="hljs-attr">padding</span>: <span class="hljs-string">'env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)'</span>,
    }],
    [<span class="hljs-string">'pt-safe'</span>, { <span class="hljs-string">'padding-top'</span>: <span class="hljs-string">'env(safe-area-inset-top)'</span> }],
    [<span class="hljs-string">'pb-safe'</span>, { <span class="hljs-string">'padding-bottom'</span>: <span class="hljs-string">'env(safe-area-inset-bottom)'</span> }],
  ],

  <span class="hljs-comment">// 【第 4 轮】常用快捷方式</span>
  <span class="hljs-attr">shortcuts</span>: [
    { <span class="hljs-string">'center'</span>: <span class="hljs-string">'flex justify-center items-center'</span> },
    { <span class="hljs-string">'between'</span>: <span class="hljs-string">'flex justify-between items-center'</span> },
    { <span class="hljs-string">'col'</span>: <span class="hljs-string">'flex flex-col'</span> },
    { <span class="hljs-string">'card'</span>: <span class="hljs-string">'bg-white rounded-xl p-4'</span> },
  ],

  <span class="hljs-comment">// 【第 5 轮】动态类名预声明</span>
  <span class="hljs-attr">safelist</span>: [
    <span class="hljs-string">'text-red-500'</span>,
    <span class="hljs-string">'text-green-500'</span>,
    <span class="hljs-string">'text-blue-500'</span>,
    <span class="hljs-string">'i-carbon-code'</span>,
  ],

  <span class="hljs-comment">// 【第 1 轮】主题配置</span>
  <span class="hljs-attr">theme</span>: {
    <span class="hljs-attr">colors</span>: {
      <span class="hljs-attr">primary</span>: <span class="hljs-string">'var(--wot-color-theme, #0957DE)'</span>,
    },
    <span class="hljs-attr">fontSize</span>: {
      <span class="hljs-string">'2xs'</span>: [<span class="hljs-string">'20rpx'</span>, <span class="hljs-string">'28rpx'</span>],
      <span class="hljs-string">'3xs'</span>: [<span class="hljs-string">'18rpx'</span>, <span class="hljs-string">'26rpx'</span>],
    },
  },
})
</code></pre>
<h2 data-id="heading-25">八、组件开发：同样是对话式协作</h2>
<h3 data-id="heading-26">8.1 开发回复卡片组件</h3>
<p>配置完成后，我开始开发业务组件。同样是对话式协作：</p>
<pre><code class="hljs language-txt" lang="txt">我：帮我写一个回复卡片组件，用来展示 AI 生成的回复。
    左边是语气标签（比如"高情商"），中间是回复文字，右边是复制按钮。
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：好的，我来帮你开发这个组件。

📋 执行计划：
1. 创建 ReplyCard.vue 组件
2. 定义 Props：tone（语气）、text（文本）
3. 定义 Events：copy（复制）
4. 使用 UnoCSS 原子类实现样式

🤔 几个问题：
1. 语气标签的颜色是固定的还是根据内容变化？
2. 复制按钮是图标还是文字？
3. 有没有设计稿可以参考？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：标签颜色根据语气类型自动变，用哈希算法分配吧。
    复制按钮用图标。设计稿没有，你自己设计一个好看的。
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：明白了，我来实现：

【设计方案】
- 卡片：白色背景、圆角、内边距
- 标签：小圆角、根据文字哈希分配 5 种颜色
- 文本：深灰色、支持多行
- 按钮：圆形点击区域、图标居中

开始生成代码...
</code></pre>
<h3 data-id="heading-27">8.2 TRAE SOLO 生成的组件</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- components/ReplyCard.vue --&gt;
&lt;template&gt;
  &lt;view class="flex items-center gap-2.5 bg-white rounded-xl p-4 pr-2"&gt;
    &lt;!-- 语气标签 --&gt;
    &lt;view
      v-show="!hideTag"
      class="text-xs font-bold rounded-sm px-2 py-1 flex-shrink-0"
      :style="{ backgroundColor: tagStyle.bg, color: tagStyle.text }"
    &gt;
      {{ tone }}
    &lt;/view&gt;

    &lt;!-- 回复文本 --&gt;
    &lt;view class="text-sm text-#1F2937 flex-1"&gt;
      {{ text }}
    &lt;/view&gt;

    &lt;!-- 复制按钮 --&gt;
    &lt;view
      class="w-9 h-9 center cursor-pointer"
      @click="$emit('copy', text)"
    &gt;
      &lt;image src="/static/images/home/copy.svg" mode="aspectFit" class="w-5 h-5" /&gt;
    &lt;/view&gt;
  &lt;/view&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { computed } from 'vue';

interface Props {
  tone: string;
  text: string;
  hideTag?: boolean;
}

const props = withDefaults(defineProps&lt;Props&gt;(), {
  hideTag: false,
});

defineEmits&lt;{
  copy: [text: string];
}&gt;();

// 5 种预设颜色
const COLORS = [
  { bg: '#F3E8FF', text: '#8B5CF6' },  // 紫色
  { bg: '#E6FFFA', text: '#319795' },  // 青色
  { bg: '#FFF5E6', text: '#F56500' },  // 橙色
  { bg: '#FFE4E6', text: '#E11D48' },  // 粉色
  { bg: '#E0F2FE', text: '#0284C7' },  // 蓝色
];

// 根据语气文字哈希分配颜色
const tagStyle = computed(() =&gt; {
  let hash = 0;
  for (let i = 0; i &lt; props.tone.length; i++) {
    hash = (hash + props.tone.charCodeAt(i)) % COLORS.length;
  }
  return COLORS[hash];
});
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-28">8.3 我提出修改意见</h3>
<pre><code class="hljs language-txt" lang="txt">我：不错，但我想加一个功能：有时候不需要显示标签，能不能加个 prop 控制？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：已经有了，就是 hideTag 这个 prop。

使用方式：
&lt;ReplyCard tone="高情商" text="回复内容" :hide-tag="true" /&gt;

设置 hide-tag 为 true 就会隐藏标签。
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：哦对，我没注意看。那再加个需求：复制成功后给个反馈
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：复制反馈建议在父组件处理，因为：
1. 卡片组件应该保持简单，只负责 UI
2. 复制逻辑和 toast 提示是业务逻辑，放父组件更合适

父组件这样用：

&lt;ReplyCard
  tone="高情商"
  text="回复内容"
  @copy="handleCopy"
/&gt;

const handleCopy = async (text: string) =&gt; {
  await copyText(text);
  toast.success('已复制');
};

你觉得这样合理吗？还是希望把 toast 放在组件内部？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">我：你说得对，放父组件更好
</code></pre>
<h2 data-id="heading-29">九、核心经验：与 AI 协作的正确姿势</h2>
<h3 data-id="heading-30">9.1 不要追求"一次完美"</h3>





















<table><thead><tr><th>错误做法</th><th>正确做法</th></tr></thead><tbody><tr><td>花 30 分钟写一个"完美提示词"</td><td>花 1 分钟说出需求，让 AI 提问</td></tr><tr><td>一次性想清楚所有细节</td><td>边做边发现问题，逐步完善</td></tr><tr><td>把 AI 当执行工具</td><td>把 AI 当协作伙伴，可以对话</td></tr></tbody></table>
<h3 data-id="heading-31">9.2 让 AI 先给执行计划</h3>
<p>每次提需求后，让 AI 先给出<strong>执行计划</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">我：[需求描述]

AI：📋 执行计划：
    1. xxx
    2. xxx
    3. xxx

    🤔 有几个问题：
    1. xxx？
    2. xxx？

    确认后我开始执行。
</code></pre>
<p><strong>好处</strong>：</p>
<ul>
<li>确保 AI 理解正确</li>
<li>发现遗漏的需求</li>
<li>可以在执行前调整方向</li>
</ul>
<h3 data-id="heading-32">9.3 遇到问题时提供上下文</h3>
<p><strong>❌ 错误方式</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">我：样式不生效
</code></pre>
<p><strong>✅ 正确方式</strong>：</p>
<pre><code class="hljs language-txt" lang="txt">我：translate-x-2 这个类在小程序里不生效，但在 H5 正常。
    我看了生成的 CSS，是 transform: translateX(var(--un-translate-x))。
    是不是变量没定义？
</code></pre>
<h3 data-id="heading-33">9.4 让 AI 解释它的方案</h3>
<p>当 AI 给出方案时，追问原理：</p>
<pre><code class="hljs language-txt" lang="txt">我：为什么要用 preflights？直接写 CSS 不行吗？
</code></pre>
<pre><code class="hljs language-txt" lang="txt">TRAE SOLO：preflights 是 UnoCSS 的预设样式注入机制，和直接写 CSS 的区别：

1. preflights 会被注入到所有生成的 CSS 之前，确保优先级正确
2. 可以通过 layer 控制加载顺序
3. 统一管理，修改时只需要改配置文件

直接写 CSS 也可以，但需要确保加载顺序正确，否则可能被覆盖。
</code></pre>
<p><strong>好处</strong>：理解原理后，下次遇到类似问题可以自己判断。</p>
<h2 data-id="heading-34">十、总结：对话式协作 &gt; 完美提示词</h2>
<h3 data-id="heading-35">10.1 本文的核心观点</h3>
<ol>
<li><strong>不要追求"一次完美的提示词"</strong>，真实的 AI 协作是多轮对话</li>
<li><strong>让 AI 先给执行计划</strong>，确认后再执行</li>
<li><strong>遇到问题时提供上下文</strong>，帮助 AI 定位问题</li>
<li><strong>追问原理</strong>，理解 AI 的方案，下次才能举一反三</li>
</ol>
<h3 data-id="heading-36">10.2 5 轮对话完成的工作</h3>



































<table><thead><tr><th>轮次</th><th>需求</th><th>成果</th></tr></thead><tbody><tr><td>第 1 轮</td><td>基础配置</td><td>presets、transformers、theme</td></tr><tr><td>第 2 轮</td><td>修复 transform 问题</td><td>preflights</td></tr><tr><td>第 3 轮</td><td>安全区适配</td><td>自定义 rules</td></tr><tr><td>第 4 轮</td><td>简化常用类名</td><td>shortcuts</td></tr><tr><td>第 5 轮</td><td>动态类名支持</td><td>safelist</td></tr></tbody></table>
<h3 data-id="heading-37">10.3 下一篇预告</h3>
<p><strong>《【AI 编程实战】第 5 篇：Pinia 状态管理不会写？让 AI 手把手教你最佳实践》</strong></p>
<p>下一篇继续展示对话式协作，教你：</p>
<ul>
<li>如何让 AI 设计 Store 结构</li>
<li>状态持久化的对话过程</li>
<li>用户登录态管理的多轮沟通</li>
</ul>
<hr/>
<blockquote>
<p>与 AI 协作的关键不是"写出完美提示词"，而是<strong>学会和 AI 对话</strong>。</p>
<p>如果这篇文章对你有帮助，请点赞、收藏！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[想偷懒购买现成的应用，结果一更新就遇到了4.3a！]]></title>    <link>https://juejin.cn/post/7584680708138745907</link>    <guid>https://juejin.cn/post/7584680708138745907</guid>    <pubDate>2025-12-17T12:36:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708138745907" data-draft-id="7584650673825202216" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="想偷懒购买现成的应用，结果一更新就遇到了4.3a！"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2025-12-17T12:36:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            想偷懒购买现成的应用，结果一更新就遇到了4.3a！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:36:04.000Z" title="Wed Dec 17 2025 12:36:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>对于Appstore来说，除了开发者自行研发产品之外。也可以通过AppStore留下的后门，<strong>转让功能</strong>！</p>
<p>今天就简单聊聊，一位粉丝因为产品上架不顺利，所以反手买了同类型的竞品。</p>
<h3 data-id="heading-1">交易背景</h3>
<p>某粉丝因为自己制作的工具产品遭遇了3.2f封号的洗礼，又想快速抢回自己的市场，所以<code>自以为聪明的购买了一套AppStore线上的产品</code>。</p>
<p>出发点本身没有问题，确实是解决问题最快的方式，但是忽略几个关键的信息内容：</p>
<ul>
<li>老包App上架、迭代时间</li>
<li>账号潜在风险</li>
</ul>
<h3 data-id="heading-2">老包上架时间</h3>
<p>购买的老包上架时间为2020年06月17日，最近一次迭代时间为2021年11月17日。历时更新了13个版本，无论是从包本身还是版本迭代周期，其实产品本身肯定是健康的。<code>毕竟活了将近5年的产品，账号的权重和产品的权重，无需多言</code>。</p>
<p>那为什么把这点单独提出来，是因为<code>最近迭代更新的时间</code>。</p>
<p>在2021年的时候，<code>苹果审核的算法肯定是今非昔比</code>。这种情况不亚于，<strong>用前朝的剑斩本朝的官</strong>。</p>
<p>直白来讲，之前更新顺利是因为苹果查的不严，竞品不多。在这种背景下，产品是健硕。无论是当时的用户交互还是UI设计，肯定是符合当下苹果开发者准则。</p>
<p>但时至今日，那很难说了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84934b6b2f3b419383e36f23f062d93d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766579764&amp;x-signature=UJfPK%2BFY4A1cNBuOMG0C%2BO5E2JQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">账号潜在风险</h3>
<p>交易的账号有几款产品，但是粉丝只需要其中一款。那么问题来了，之后的事情没有人可以担保不发生意外。</p>
<p><strong>首先就是关联风险，这种App转让的行为是强关联。</strong> 买过来的产品继续当良民最好一些隔离措施，但是不表明卖家一直可以健健康康。如果卖家一旦出现不可控的违规行为，<code>那么买过来的产品到底能活多久？是一个大大问号</code>！</p>
<p>客观来说非要转让产品，<strong>除非打包一起买</strong>，不然多增加变量。</p>
<p>不过话说回来，这种成本又被间接性拉高，同时未必卖家愿意。</p>
<h3 data-id="heading-4">4.3a破局</h3>
<p>粉丝在遭遇了2次4.3a后，一时间乱了阵脚。主动在后台留言咨询，请求付费破局。在了解到整个事件来龙去脉后，<code>耗时7天工作日，成功完成App迭代工作</code>。</p>
<p>主要协助解决了<strong>API接口处理，内购订阅功能，3.2f老包版本功能植入</strong>。</p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-5">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FV2F4BaEYh5HfeUUHm1tI6Q" target="_blank" title="https://mp.weixin.qq.com/s/V2F4BaEYh5HfeUUHm1tI6Q" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（代码篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FLs3su8fmMckTocPwMmFaNQ" target="_blank" title="https://mp.weixin.qq.com/s/Ls3su8fmMckTocPwMmFaNQ" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（ASO篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Charles Proxy 抓包]]></title>    <link>https://juejin.cn/post/7584650421124513833</link>    <guid>https://juejin.cn/post/7584650421124513833</guid>    <pubDate>2025-12-17T12:36:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124513833" data-draft-id="7584650421124464681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Charles Proxy 抓包"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-17T12:36:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="louisgeek"/> <meta itemprop="url" content="https://juejin.cn/user/1099167357208151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Charles Proxy 抓包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167357208151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    louisgeek
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:36:34.000Z" title="Wed Dec 17 2025 12:36:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android Charles Proxy 抓包</h2>
<ul>
<li>抓包工具 Charles Proxy，是一款跨平台的 HTTP/HTTPS 代理服务器与网络封包分析工具，核心是通过拦截转发网络请求实现抓包、调试与模拟，广泛用于移动开发、Web 开发与接口联调</li>
<li>可以实现弱网模拟、Mock 数据、压力测试等场景</li>
<li>可以通过安装 Charles 根证书来解决 HTTPS 抓包问题（HTTPS 请求显示 unknown）</li>
</ul>
<h3 data-id="heading-1">启动代理服务​</h3>
<ul>
<li>Charles 启动后，会自动配置系统代理（默认端口：8888），此时电脑的所有网络请求访问都会经过 Charles 转发，可在 Charles 窗口查看请求记录（比如访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.example.com%25EF%25BC%258C%25E7%2594%25B1%25E4%25BA%258E" target="_blank" title="https://api.example.com%EF%BC%8C%E7%94%B1%E4%BA%8E" ref="nofollow noopener noreferrer">api.example.com，由于</a> HTTPS 请求是加密的，默认无法查看内容，需要额外安装 Charles 根证书）</li>
<li>可以通过菜单 Proxy -&gt; Windows proxy 取消勾选来关闭这个系统代理</li>
</ul>
<h3 data-id="heading-2">配置手机代理</h3>
<ul>
<li>通过 Charles 菜单的 Help -&gt; Local IP Addresses 功能可以查看电脑的 IP（选中后可以用 Ctrl + C 进行复制），或通过操作系统设置自行查看</li>
<li>通过 Charles 菜单的 Proxy -&gt; Proxy Settings 设置监听端口（默认端口：8888）</li>
<li>手机上设置代理：设置 -&gt; WLAN 设置 -&gt; 连上指定的 Wifi（需要确保与电脑在同一局域网） -&gt; 网络详情 -&gt; 代理 -&gt; 选择手动 -&gt; 主机名填入电脑的 IP，端口填入 8888 后保存</li>
</ul>
<h3 data-id="heading-3">HTTPS 请求抓包</h3>
<ul>
<li>通过 Charles 菜单的 Proxy -&gt; SSL Proxying Settings -&gt; 勾选 Enable SSL Proxying 来开启 SSL 代理，选中对应标签页，在下方点击 + 号添加一条规则，Host 填写目标域名（比如输入通配符 *，代理所有 HTTPS 请求），Port 输入 443（HTTPS 默认端口），也可以根据需要添加特定域名（比如 *.example.com）</li>
<li>如果抓包电脑端的请求，通过菜单的 Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate，按照向导来安装根证书</li>
<li>如果抓包手机端的请求，手机上通过浏览器访问 chls.pro/ssl 网址（Charles 提供的证书下载地址，可以通过 Charles 菜单的 Help -&gt; SSL Proxying -&gt; Install Charles Root Certificate on a Mobile Device or Remote Browser 查看信息），下载并安装 Charles  根证书，打开手机设置 -&gt; 安全 -&gt; 更多安全设置 -&gt; 加密与凭据 -&gt; 安装证书（从存储设备安装） -&gt; CA 证书 -&gt; 在本地 SD 存储中找到已下载的证书文件</li>
<li>也可以通过 Charles 菜单的 Help -&gt; SSL Proxying -&gt; Save Charles Root Certificate，将证书保存为 .cer 文件（记得切换文件类型），自行进行手动导入。最终 Charles 里如果能看到请求的明文内容，就说明所有必需的配置都设置成功了</li>
<li>安卓从 Android 7.0（API 24）开始，出于安全考虑引入了安全机制，系统默认不再信任用户安装的 CA 证书，这意味着像 Charles、Fiddler 等抓包工具的 HTTPS 证书，会被 App 拒绝，导致无法抓包，解决方案就是修改 App 的 AndroidManifest.xml 中配置的网络安全配置文件，指定在调试模式下信任用户证书</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MyApplication"</span>
    <span class="hljs-attr">android:networkSecurityConfig</span>=<span class="hljs-string">"@xml/network_security_config"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 其他配置 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
</code></pre>
<p>network_security_config.xml</p>
<pre><code class="hljs language-xml" lang="xml">&lt;​?xml version="1.0" encoding="utf-8"?&gt;
<span class="hljs-tag">&lt;<span class="hljs-name">network-security-config</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- debug 调试模式下信任证书（为了 Charles/Fiddler 抓包），此配置仅在 debug 版本生效（android:debuggable="true"），release 版本会自动失效，确保发布版本的安全性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">debug-overrides</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">trust-anchors</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 信任系统预装的证书 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"system"</span> /&gt;</span>
            <span class="hljs-comment">&lt;!-- 信任用户安装的证书 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">certificates</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"user"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">trust-anchors</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">debug-overrides</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">network-security-config</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">模拟弱网环境</h3>
<ul>
<li>用于测试应用在恶劣网络下的表现​，通过 Charles 菜单的 Proxy -&gt; Throttling settings 勾选 Enable Throttling 启用限流（节流）功能，可精准模拟 3G、4G 等弱网环境，提供了常见的网络预设模板供快速选择</li>
</ul>
<h3 data-id="heading-5">修改请求与响应</h3>
<ul>
<li>Mock 数据，右键点击请求，选择 Breakpoints 设置断点，当请求发送时，Charles 会暂停，可修改请求头或参数后点执行继续，当响应到来时，Charles 会暂停，修改返回的 JSON 等数据后点执行继续</li>
</ul>
<h3 data-id="heading-6">重复发送请求</h3>
<ul>
<li>右键点击请求，选择 Repeat 立即重复发送一次请求，选择 Repeat Advanced 可设置 Iterations 重复次数、Concurrency 并发量、Delay 延迟等参数后再进行执行，可以用于模拟压力测试</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[有了开源的 MySQL，为什么还要选择 PostgreSQL？]]></title>    <link>https://juejin.cn/post/7584742635484594186</link>    <guid>https://juejin.cn/post/7584742635484594186</guid>    <pubDate>2025-12-17T12:47:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635484594186" data-draft-id="7584657447802961946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="有了开源的 MySQL，为什么还要选择 PostgreSQL？"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-12-17T12:47:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮皮林551"/> <meta itemprop="url" content="https://juejin.cn/user/2447981921436084"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            有了开源的 MySQL，为什么还要选择 PostgreSQL？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447981921436084/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮皮林551
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:47:37.000Z" title="Wed Dec 17 2025 12:47:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近年来，随着信创推进与数据库自主可控需求提升，PostgreSQL 凭借其开源、稳定、功能强大的特性，已成为国产数据库创新的首选技术底座。</p>
<p>国内多家头部科技企业纷纷基于 PostgreSQL 深度定制，打造出满足自身业务需求的分布式、云原生或 HTAP 数据库系统。</p>
<p>1.腾讯云 TDSQL PG 版（开源代号：TBase） <code>https://github.com/Tencent/TBase</code></p>
<ul>
<li>引入 GTM 全局事务管理器 + 分布式协调，实现跨 shard 事务。</li>
</ul>
<p>2.阿里云 PolarDB for PostgreSQL</p>
<ul>
<li>重构存储层，实现“一写多读共享存储”，秒级扩容只读节点。</li>
</ul>
<p>3.华为云 GaussDB(for openGauss) —— 部分兼容 PG 生态 <code>https://opengauss.org</code></p>
<ul>
<li>加入列存储引擎、AI 优化器，支持 HTAP。</li>
</ul>
<p>4.杭州易景数通 openHalo <code>https://github.com/HaloTech-Co-Ltd/openHalo</code></p>
<blockquote>
<p>“</p>
<p>那么，为什么这些大厂不选择同样流行的 MySQL，而是纷纷押注 PostgreSQL？这背后，是 PostgreSQL 在多个关键技术维度上的显著优势。</p>
</blockquote>
<h3 data-id="heading-0"><strong>为什么已经有了开源的MySQL还要使用PgSQL呢？</strong></h3>
<p>因为在MySQL使用中有关键的短板，而PgSQL能显著改善。</p>
<h4 data-id="heading-1"><strong>1. MySQL 的数据类型不够丰富</strong></h4>
<p>问题本质：</p>
<p>MySQL 的核心数据类型相对基础，虽然满足大多数业务需求，但在处理复杂场景时显得“力不从心”。</p>
<p>比如：</p>
<ul>
<li><strong>数组类型：</strong>  PostgreSQL 支持 ARRAY，可以存储多个值在一个字段中。</li>
<li><strong>范围类型：</strong>  int4range, tsrange 等，用于表示时间区间、价格区间等。</li>
<li><strong>复合类型：</strong>  自定义结构体（如 POINT(x,y)），直接建模现实世界对象。</li>
<li><strong>JSONB 类型：</strong>  不仅支持 JSON 存储，还能索引、查询、更新，性能远超普通 JSON 字段。</li>
</ul>
<h4 data-id="heading-2"><strong>2. MySQL 不支持序列概念（Sequence）</strong></h4>
<p>MySQL 5.7+ 已经支持 SEQUENCE，但它是通过 <code>AUTO_INCREMENT + 3088413</code> 模拟实现的。</p>
<p>更关键的是：MySQL 缺少真正的独立序列对象（像 Oracle 或 PostgreSQL 那样），无法脱离表单独使用。</p>
<p>举个例子：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- PostgreSQL 中创建独立序列 </span>
<span class="hljs-keyword">CREATE</span> SEQUENCE order_seq <span class="hljs-keyword">START</span> <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span> INCREMENT <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
<span class="hljs-comment">-- 使用序列生成 ID </span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders (id, name) <span class="hljs-keyword">VALUES</span> (nextval(<span class="hljs-string">'order_seq'</span>), <span class="hljs-string">'test'</span>);
</code></pre>
<p>而MySQL：</p>
<pre><code class="hljs language-ini" lang="ini">-- 必须绑定到某张表的 AUTO_INCREMENT 
ALTER TABLE orders <span class="hljs-attr">AUTO_INCREMENT</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
-- 或者用变量模拟 
SET @<span class="hljs-attr">next_id</span> = <span class="hljs-number">3088413</span> + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>不能跨表共享序列。</li>
<li>分布式环境下难以保证唯一性（除非配合 Redis 等中间件）。</li>
</ul>
<h4 data-id="heading-3"><strong>3. 使用 MySQL 时，网上比较好用的扩展功能插件不多</strong></h4>
<p>PostgreSQL 的生态优势在于其强大的 扩展机制 ，例如：</p>
<ul>
<li><code>TimescaleDB</code>：    时序数据库（自动分区、压缩）</li>
<li><code>pg_trgm</code>:    模糊匹配、相似度搜索</li>
<li><code>Citus</code>:  分布式数据库扩展</li>
<li><code>pg_stat_statements</code>:SQL执行统计监控</li>
</ul>
<blockquote>
<p>“</p>
<p>PostgreSQL 是“可编程数据库”，你可以把整个系统当作一个“应用平台”来扩展；而 MySQL 更像是一个“执行引擎”。</p>
</blockquote>
<h4 data-id="heading-4"><strong>4. MySQL 的性能优化监控工具不是很多，定位问题的成本比较高</strong></h4>
<p><strong>MySQL 的监控短板：</strong></p>
<ul>
<li><strong>官方工具较少：</strong>  虽有 <code>Performance Schema</code> 和 <code>slow_query_log</code>，但配置复杂，解读困难。</li>
<li><strong>缺乏可视化集成：</strong>  不像 PgAdmin 或 DBeaver 提供直观的执行计划、锁等待视图。</li>
<li><strong>诊断依赖经验：</strong>  很多问题需要手动分析日志、查看 <code>SHOW PROCESSLIST</code>、<code>EXPLAIN</code> 等。</li>
</ul>
<p><strong>PostgreSQL 的优势：</strong></p>
<ul>
<li>内置 <code>pg_stat_activity</code>, <code>pg_stat_statements</code>, <code>pg_locks</code> 等丰富的统计视图。</li>
<li>支持 <code>EXPLAIN ANALYZE</code>，能显示真实执行时间和行数。</li>
<li>第三方工具成熟：如 <code>PgAdmin</code>, <code>pg_stat_monitor</code>, <code>Prometheus + Grafana</code> 集成良好。</li>
<li>开源社区活跃，文档齐全，调试资源丰富。</li>
</ul>
<h4 data-id="heading-5"><strong>5.MySQL 主从复制的问题：</strong></h4>
<ul>
<li><strong>异步复制为主：</strong>  默认是异步复制，存在延迟风险。</li>
<li><strong>无强一致性保障：</strong>  主库宕机后，从库可能丢失部分事务。</li>
<li><strong>GTID 机制虽好，但易出错：</strong>  GTID（Global Transaction Identifier）解决了部分问题，但配置不当会导致复制中断。</li>
<li><strong>半同步复制（semi-sync）需额外配置：</strong>  非默认启用，且对网络要求高。</li>
</ul>
<p><strong>PostgreSQL 的解决方案：</strong></p>
<ul>
<li><strong>流复制（Streaming Replication） ：</strong>  支持异步/同步模式。</li>
<li><strong>逻辑复制（Logical Replication） ：</strong>  可以按表复制，甚至跨版本迁移。</li>
<li><strong>WAL（Write-Ahead Logging）机制成熟：</strong>  确保数据持久性和一致性。</li>
<li><strong>支持同步复制（Synchronous Replication） ：</strong>  主库等待至少一个备库确认后再提交事务，实现 零数据丢失。</li>
</ul>
<blockquote>
<p>“</p>
<p>MySQL 的复制更像是“备份机制”；而 PostgreSQL 的复制更接近“高可用架构”的一部分。</p>
</blockquote>
<h4 data-id="heading-6"><strong>6. MySQL 虽然开源，but，不够彻底</strong></h4>
<p>“不够彻底”体现在哪里？</p>






























<table><thead><tr><th>维度</th><th>MySQL</th><th>PostgreSQL</th></tr></thead><tbody><tr><td><strong>许可证</strong></td><td>GPL + 商业许可（Oracle 控制）</td><td>BSD-like，完全自由</td></tr><tr><td><strong>企业版 vs 社区版</strong></td><td>企业版包含高级功能（如审计、加密）</td><td>社区版即完整版，无功能阉割</td></tr><tr><td><strong>源码透明度</strong></td><td>Oracle 掌控核心开发，社区贡献受限</td><td>全球开发者共同维护，开放透明</td></tr><tr><td><strong>长期稳定性</strong></td><td>Oracle 有时会调整路线（如收购 Sun 后影响）</td><td>由基金会主导，不受单一公司控制</td></tr></tbody></table>
<p>举个例子：</p>
<ul>
<li>MySQL 8.0 的某些新特性（如窗口函数）直到 8.0 才引入，而 PostgreSQL 早已支持。</li>
<li>Oracle 为了推动商业产品，可能会故意放缓社区版的功能迭代。</li>
</ul>
<blockquote>
<p>“</p>
<p>PostgreSQL是真正的开源——用户驱动、技术优先、长期稳定</p>
</blockquote>
<h4 data-id="heading-7"><strong>7. PostgreSQL 的 MVCC 实现和 MySQL 不大一样。</strong></h4>
<p>MVCC（多版本并发控制）原理简述：</p>




















<table><thead><tr><th>数据库</th><th>版本管理方式</th><th>优点</th></tr></thead><tbody><tr><td>PostgreSQL</td><td><strong>每行存储多个版本</strong>，旧版本保留在堆中，直到被清理</td><td>读写完全隔离，支持可串行化快照隔离</td></tr><tr><td>MySQL</td><td><strong>只保留当前版本</strong>，旧版本在 undo log 中暂存</td><td>读取更快，但长事务可能导致回滚段膨胀</td></tr></tbody></table>
<p><strong>具体表现：</strong></p>
<ul>
<li>在 PostgreSQL 中，即使你在写数据，别人也可以读取“之前的状态”。</li>
<li>在 MySQL 中，如果事务未提交，其他事务看到的是“脏读”或“不可重复读”（取决于隔离级别）。</li>
</ul>
<h5 data-id="heading-8"><strong>补充：</strong></h5>
<p>尽管 PostgreSQL 在功能上更强大，但 MySQL 依然在特定场景下具有不可替代的优势，并被广泛使用。</p>
<h5 data-id="heading-9"><strong>MySQL 的五大核心优势：</strong></h5>





























<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td><strong>1. 极简部署与运维</strong></td><td>配置文件少，默认参数合理，适合快速上线。</td></tr><tr><td><strong>2. 读性能优异</strong></td><td>InnoDB 缓冲池 + 主从复制，轻松支撑高并发读（如首页、商品列表）。</td></tr><tr><td><strong>3. 成熟的 Web 生态</strong></td><td>WordPress、Laravel、Django（默认支持）、Drupal 等均原生适配 MySQL。</td></tr><tr><td><strong>4. 云厂商深度优化</strong></td><td>阿里云 RDS、AWS RDS、腾讯云 CDB 对 MySQL 的自动调优、备份、监控极为成熟。</td></tr><tr><td><strong>5. 社区资源丰富</strong></td><td>CSDN、Stack Overflow、知乎上问题多、答案全，新手友好。</td></tr></tbody></table>
<h3 data-id="heading-10"><strong>结语</strong></h3>
<p>PostgreSQL 与 MySQL 并非简单的谁更好，而是谁更适合。对于追求长期演进、复杂数据模型和强一致性的系统，PostgreSQL 是更坚实的基础；而对于快速上线、读多写少的 Web 应用，MySQL 依然是高效之选。而国产数据库的崛起，正是站在 PostgreSQL 的肩膀上，走出了一条自主创新之路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Akamai Cloud客户案例 | IPPRA的简洁、经济、易用的云计算服务]]></title>    <link>https://juejin.cn/post/7584680708138418227</link>    <guid>https://juejin.cn/post/7584680708138418227</guid>    <pubDate>2025-12-17T11:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708138418227" data-draft-id="7584657447802601498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Akamai Cloud客户案例 | IPPRA的简洁、经济、易用的云计算服务"/> <meta itemprop="keywords" content="人工智能,云计算"/> <meta itemprop="datePublished" content="2025-12-17T11:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Akamai Cloud客户案例 | IPPRA的简洁、经济、易用的云计算服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:16:24.000Z" title="Wed Dec 17 2025 11:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>"我们必须快速获取数据，并具备在紧迫时间内管理此类项目所需的一切条件。这就是为什么让Linode（现属Akamai）协助我们变得如此重要。"</p>
<p>——俄克拉荷马大学IPPRA研究院副主任 Joe Ripberger 博士</p>
</blockquote>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251217_blogarticles236" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251217_blogarticles236" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p>
<hr/>
<p>要理解并应对社会风险，提升社区与社会的韧性，离不开海量数据和强大基础设施的支持。公共政策研究与分析研究院（IPPRA）便是最好的例证——作为全球顶尖的风险研究机构，该院致力于研究自然、科技及人为因素引发的风险，并开展相关教学与公众推广。IPPRA坐落于俄克拉荷马大学，汇聚政策、心理、传播、工程等跨领域专家，结合前沿建模技术，共同探索帮助社区增强风险应对能力的更优路径。</p>
<p>Joe Ripberger和Matthew Henderson是推动IPPRA使命的核心成员，他们的工作正让世界变得更安全。"我们研究各类风险，从能源安全、核武器等国家安全议题，到自然灾害等公共健康风险，"IPPRA研究院副主任Ripberger介绍道。</p>
<p>自该研究在俄克拉荷马大学启动以来，IPPRA的职责范围和应对的风险场景不断扩展。从最初专注于风险与危机管理，如今已发展成为跨学科研究机构，研究人员曾与美国国家科学基金会、国家海洋和大气管理局及能源部等全球关键科研组织合作。</p>
<p>研究院的部分工作包括与国家气象局合作设计调查问卷，分析人们如何接收、理解不同天气预警信息并采取防护行动。研究人员通过分析收集的数据，在地方和区域层面构建精准的危险天气系统社区预警机制。</p>
<p>另一项研究则关注新冠疫情中的公众认知与错误信息。2020年3月，IPPRA团队开始分析数百万条疫情相关社交媒体帖子，并与全国性调查数据交叉比对，通过数据集对比深入解析错误信息与个人疫情认知对行为决策的影响。</p>
<p>这些关键且及时的研究成果，既帮助政策制定者理解准确健康信息对行为的正向引导作用，也为其评估错误信息导致负面健康后果的行为影响提供了衡量依据。</p>
<p><strong><strong>简洁、经济、易用的云计算服务</strong></strong></p>
<p>面对如此规模的研究项目，IPPRA研究团队需要可靠的云基础设施合作伙伴来处理海量信息。正因如此，Ripberger、Henderson及其团队与Linode（现属Akamai）已保持逾十年合作。</p>
<p>借助灵活可扩展的数据存储架构和便捷的信息获取能力，IPPRA团队在持续收集数据的同时能够无缝呈现研究成果。这种能力使研究人员得以通过数据构建重要合作关系，并始终保持研究完整性。</p>
<p>"这正是Linode（现属Akamai）多年来对我们至关重要的原因之一，"研究院研究支持与整合副主任Henderson强调，"我们大量项目需要在线上线下灵活切换，必须确保快速响应能力。"</p>
<p>对于需在物理防火墙后运行的工作负载，IPPRA采用云基础设施与本地资源混合的部署模式。</p>
<p>Akamai（原Linode）以符合研究院预算规划的固定价格提供云计算服务，持续赋能IPPRA的前沿研究。Ripberger指出，在学术领域，成本预判往往直接决定项目能否立项："实现可靠的成本预估，赋予我们推进项目的充足信心。计算资源绝不能超支，因为我们根本无法承担赤字运营。"</p>
<p>随着IPPRA研究团队持续探索全球社区风险应对新路径，Henderson和Ripberger深信，与Akamai的合作将始终助力这个具有前瞻思维的团队保持这项宝贵研究的领先优势。</p>
<p><strong><strong>关于IPPRA</strong></strong></p>
<p>IPPRA团队通过融合公共政策学术研究与物理工程科学，致力于构建合作伙伴关系并开展前沿研究。其工作聚焦解决复杂公共政策问题，创造贯通自然、科技与社会系统的机遇，从而提升人类福祉，优化社会选择基础设施，增强社会韧性。</p>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251217_blogarticles236_end" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251217_blogarticles236_end" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nop入门：增加DSL模型解析器]]></title>    <link>https://juejin.cn/post/7584653722593525812</link>    <guid>https://juejin.cn/post/7584653722593525812</guid>    <pubDate>2025-12-17T11:26:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584653722593525812" data-draft-id="7584472215976067087" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nop入门：增加DSL模型解析器"/> <meta itemprop="keywords" content="后端,架构,Spring Boot"/> <meta itemprop="datePublished" content="2025-12-17T11:26:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nop入门：增加DSL模型解析器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:26:22.000Z" title="Wed Dec 17 2025 11:26:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nop平台为开发自定义DSL（Domain Specific Language，领域特定语言）提供了一系列基础设施，核心机制是通过XDef元模型（Nop平台的元模型语言）定义XML格式的语法结构，然后自动根据XDef生成AST（Abstract Syntax Tree，抽象语法树）节点类，并实现解析器、
生成器、验证器等工具。具体介绍参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FgEvFblzpQghOfr9qzVRydA" target="_blank" title="https://mp.weixin.qq.com/s/gEvFblzpQghOfr9qzVRydA" ref="nofollow noopener noreferrer">XDef：一种面向演化的元模型及其构造哲学</a>。</p>
<p>虽然XDef元模型语言采用XML语法格式，但这并不意味着Nop平台中的DSL只能使用XML格式表达。实际上，根据<strong>可逆计算理论</strong>, 同一信息结构具有多种表达形式，这些表达形式之间可以自动进行可逆转换。</p>
<p>本文将介绍如何为DSL引入Markdown语法格式，并演示如何实现Markdown与XML/JSON之间的双向转换。</p>
<p>为了更好地理解如何扩展DSL加载器，我们首先需要了解Nop平台的核心模块结构：</p>
<h2 data-id="heading-0">1. nop-kernel核心模块</h2>
<p>Nop平台内置了丰富的模块，但用于支持DSL定义和实现的核心部分（也是可逆计算理论的实现核心）完全集中在<code>nop-kernel</code>目录下。该目录包含以下关键子模块：</p>
<ol>
<li><strong>nop-dependencies</strong>: 统一管理Nop平台使用的外部第三方依赖库版本</li>
<li><strong>nop-api-core</strong>: 提供各类注解以及<code>ApiRequest</code>/<code>ApiResponse</code>等框架级别的DTO定义</li>
<li><strong>nop-commons</strong>: 包含各种工具类（Utility Helpers）</li>
<li><strong>nop-core</strong>: 实现虚拟文件系统、XML/JSON等基础格式解析器和反射机制</li>
<li><strong>nop-javac</strong>: 对Java内置JavaC编译器的封装</li>
<li><strong>nop-dataset</strong>: 封装<code>IRecordInput</code>/<code>IDataSet</code>接口，统一处理各类列表数据和表格数据</li>
<li><strong>nop-xdefs</strong>: 集中存放Nop平台内置的所有XDef元模型</li>
<li><strong>nop-xlang</strong>: 实现Xpl模板语言、XScript脚本语言以及Delta合并算法</li>
<li><strong>nop-antlr4</strong>: 为XScript脚本语言提供antlr4扩展和封装支持</li>
<li><strong>nop-codegen</strong>: 提供<code>XCodeGenerator</code>代码生成器</li>
<li><strong>nop-record-mapping</strong>: 实现异构对象映射模型，用于辅助实现Markdown结构与一般模型对象之间的双向映射</li>
<li><strong>nop-markdown</strong>: 为Markdown格式的DSL解析提供额外封装，包含一个简易的Markdown解析器</li>
<li><strong>nop-kernel-cli</strong>: 演示用的命令行工具，提供<code>convert</code>（模型格式转换）和<code>gen</code>（模板驱动代码生成）两个指令</li>
</ol>
<ul>
<li>其中，<code>nop-kernel-cli</code>模块下的<code>demo</code>目录包含了DSL自定义解析器和自定义代码生成模板的示例</li>
</ul>
<p>了解了核心模块结构后，接下来我们将学习如何为DSL注册自定义加载器：</p>
<h2 data-id="heading-1">2. 注册加载器</h2>
<p>在Nop平台中，所有DSL文件格式都对应一个唯一的文件类型(fileType)。
全局模型加载器<code>ResourceComponentManager</code>在加载文件时会根据文件类型动态确定使用的加载器。</p>
<p>因此，为了给<code>orm.xml</code>这种文件定义DSL加载器，需要编写<code>/nop/core/registry/orm.register-model.xml</code></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/register-model.xdef"</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span>
       <span class="hljs-attr">name</span>=<span class="hljs-string">"orm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">loaders</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 为XML/JSON/YAML格式注册内置加载器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xdsl-loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.xml"</span> <span class="hljs-attr">schemaPath</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xdsl-loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.json"</span> <span class="hljs-attr">schemaPath</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xdsl-loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.yaml"</span> <span class="hljs-attr">schemaPath</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- 为Markdown格式注册自定义加载器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.md"</span> <span class="hljs-attr">mappingName</span>=<span class="hljs-string">"orm.Md_to_OrmModel"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"io.nop.record_mapping.md.MarkdownDslResourceLoaderFactory"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">loaders</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">model</span>&gt;</span>
</code></pre>
<p>上述配置文件定义了ORM模型的加载器注册信息：</p>
<ul>
<li><code>xdsl-loader</code>：用于配置XML/JSON/YAML格式的模型加载器。Nop平台内置了<code>DslJsonResourceLoader</code>和<code>DslXmlResourceLoader</code>，它们会根据文件类型自动选择合适的解析器。</li>
<li><code>loader</code>：用于定义扩展加载器，可支持自定义文件格式。
<ul>
<li><code>fileType</code>：指定文件类型标识符</li>
<li><code>mappingName</code>：指定用于解析的映射规则名称</li>
<li><code>class</code>：指定加载器工厂类的实现路径，需实现<code>IResourceObjectLoaderFactory</code>或<code>IResourceObjectLoader</code>接口</li>
</ul>
</li>
</ul>
<p>以下是相关接口的定义：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 资源对象加载器工厂接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IResourceObjectLoaderFactory</span>&lt;T&gt; {
    IResourceObjectLoader&lt;T&gt; <span class="hljs-title function_">newResourceObjectLoader</span><span class="hljs-params">(ComponentModelConfig config, Map&lt;String, Object&gt; attributes)</span>;
}

<span class="hljs-comment">// 资源对象加载器接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IResourceObjectLoader</span>&lt;T&gt; {
  T <span class="hljs-title function_">loadObjectFromResource</span><span class="hljs-params">(IResource resource)</span>;
}

<span class="hljs-comment">// 资源对象保存器接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IResourceObjectSaver</span>&lt;T&gt; {
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveObjectToResource</span><span class="hljs-params">(IResource resource, T obj)</span>;
}
</code></pre>
<p>MarkdownDslResourceLoaderFactory返回的MarkdownDslResourceLoader实现了如下四个接口</p>
<ul>
<li><code>IResourceObjectLoader</code>: 解析资源文件得到模型对象</li>
<li><code>IResourceObjectSaver</code>: 将模型对象保存到资源文件中</li>
<li><code>IResourceDslNodeLoader</code>: 解析资源文件得到XNode（Nop平台中通用的DSL抽象语法树节点，用于统一表示不同格式的DSL结构）</li>
<li><code>IResourceDslNodeSaver</code>: 将XNode保存到资源文件中</li>
</ul>
<p>除了<code>IResourceObjectLoader</code>接口之外，其他三个接口都是可选的。实现这些接口后，就可以支持双向转换功能。</p>
<p>注册完加载器后，我们需要定义Markdown与模型对象之间的映射规则。这正是<code>RecordMapping</code>机制的用武之地：</p>
<h2 data-id="heading-2">3. 基于Mapping模型的Markdown解析和生成</h2>
<p><code>RecordMapping</code>是Nop平台内置的对象映射机制，用于定义两个异构Java对象之间的相互映射规则，支持字段映射、类型转换、表达式计算等功能。
在RecordMapping格式的基础上补充<code>md:format</code>等扩展字段信息，就可以实现MarkdownSection对象与DSL模型对象之间的映射。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/record/record-mappings.xdef"</span>
             <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"md"</span> <span class="hljs-attr">x:dump</span>=<span class="hljs-string">"true"</span>&gt;</span>


  <span class="hljs-comment">&lt;!-- 定义从Markdown到ORM模型的映射规则 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_OrmModel"</span> <span class="hljs-attr">md:titleField</span>=<span class="hljs-string">"displayName"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">fields</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 直接映射displayName字段 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"displayName"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"displayName"</span>/&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射extends字段，并指定别名 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"x:extends"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"extends"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Extends"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"string"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射实体定义，使用Md_to_EntityModel作为子项映射规则 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"entities"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"实体定义"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Entities"</span> <span class="hljs-attr">keyProp</span>=<span class="hljs-string">"name"</span>
             <span class="hljs-attr">itemMapping</span>=<span class="hljs-string">"Md_to_EntityModel"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">fields</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 定义从Markdown到实体模型的映射规则 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_EntityModel"</span> <span class="hljs-attr">md:titleField</span>=<span class="hljs-string">"name"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">fields</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 映射对象名，使用表达式生成完整类名 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"对象名"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Object Name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"class-name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">valueExpr</span>&gt;</span>
          value?.$fullClassName(rootRecord['ext:entityPackageName'])
        <span class="hljs-tag">&lt;/<span class="hljs-name">valueExpr</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射表名，设置为必填字段 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"tableName"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"表名"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Table Name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"prop-name"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射中文名，设置为必填字段 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"displayName"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"中文名"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Chinese Name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"string"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射字段列表，指定为表格格式 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"columns"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"字段列表"</span> <span class="hljs-attr">keyProp</span>=<span class="hljs-string">"name"</span>
             <span class="hljs-attr">alias</span>=<span class="hljs-string">"Column List"</span> <span class="hljs-attr">itemMapping</span>=<span class="hljs-string">"Md_to_ColumnModel"</span> <span class="hljs-attr">md:format</span>=<span class="hljs-string">"table"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射关联列表，指定为表格格式 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"relations"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"关联列表"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Relation List"</span>
             <span class="hljs-attr">itemMapping</span>=<span class="hljs-string">"Md_to_RelationModel"</span> <span class="hljs-attr">md:format</span>=<span class="hljs-string">"table"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">fields</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<p>Nop平台通过<code>MappingBasedMarkdownParser</code>和<code>MappingBasedMarkdownGenerator</code>根据Mapping模型配置实现解析与生成功能：</p>
<ul>
<li><code>md:titleField</code>: 用于指定标题对应的解析字段</li>
<li><code>md:format</code>: 指定字段对应的Markdown格式，目前支持<code>table|code</code>，分别对应表格格式和代码块格式</li>
</ul>
<p>我们约定了简单的Markdown编码规则：</p>
<ol>
<li>每个section只能是List/Table/CodeBlock等几种格式</li>
<li>通过子section实现复杂对象，标题对应属性名</li>
<li>若section对应于List，则每个子section对应一个对象，此时section的标题对应对象的titleField</li>
</ol>
<p>以下是一个完整的Markdown格式ORM模型示例：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># AI模型管理</span>

<span class="hljs-bullet">-</span> extends:  demo.orm.md

<span class="hljs-section">## gen-extends</span>
<span class="hljs-code">```xml
&lt;orm-gen:DefaultPostExtends xpl:lib="/xlib/orm-gen.xlib"/&gt;
```</span>

<span class="hljs-section">## 5 实体定义</span>

<span class="hljs-section">### 5.1 NopAiProject</span>

<span class="hljs-bullet">-</span> 表名: nop<span class="hljs-emphasis">_ai_</span>project
<span class="hljs-bullet">-</span> 类名: NopAiProject
<span class="hljs-bullet">-</span> 中文名: AI项目
<span class="hljs-bullet">-</span> 备注: 存储AI项目基本信息

<span class="hljs-section">#### 5.1.1 字段列表</span>

|编号|标签|主键|非空|字段名|属性名|显示|中文名|英文名|数据域|标准域|类型|长度|小数位数|字典|备注|缺省值|控件|根节点级别|
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | seq | true | true | id | id | X | 主键 |  |  |  | VARCHAR | 36 |  |  |  |  |  |  |
| 2 |  | false | true | language | language |  | 项目语言 |  |  |  | VARCHAR | 4 |  | ai/project<span class="hljs-emphasis">_language | 项目使用的编程语言类型：JAVA, PYTHON等 |  |  |  |
| 3 |  | false | true | name | name |  | 项目名称 |  |  |  | VARCHAR | 100 |  |  |  |  |  |  |
| 4 |  | false | false | prototype_</span>id | prototypeId |  | 模板项目ID |  |  |  | VARCHAR | 36 |  |  |  |  |  |  |
| 5 |  | false | false | project<span class="hljs-emphasis">_dir | projectDir |  | 项目目录 |  |  |  | VARCHAR | 400 |  |  | 项目在文件系统中的存储路径，例如：/data/projects/order-system |  | textarea |  |

</span></code></pre>
<p>上述Markdown文件解析后得到的XML格式如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">orm</span> <span class="hljs-attr">ext:mavenArtifactId</span>=<span class="hljs-string">"nop-ai"</span> <span class="hljs-attr">ext:entityPackageName</span>=<span class="hljs-string">"io.nop.ai.dao.entity"</span> <span class="hljs-attr">ext:allowIdAsColName</span>=<span class="hljs-string">"true"</span>
     <span class="hljs-attr">ext:basePackageName</span>=<span class="hljs-string">"io.nop.ai"</span> <span class="hljs-attr">ext:appName</span>=<span class="hljs-string">"nop-ai"</span> <span class="hljs-attr">ext:registerShortName</span>=<span class="hljs-string">"true"</span>
     <span class="hljs-attr">ext:mavenGroupId</span>=<span class="hljs-string">"io.github.entropy-cloud"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span>
     <span class="hljs-attr">xmlns:ext</span>=<span class="hljs-string">"ext"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"AI模型管理"</span>
     <span class="hljs-attr">xmlns:ui</span>=<span class="hljs-string">"ui"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entities</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">entity</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"io.nop.ai.dao.entity.NopAiProject"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"AI项目"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"io.nop.ai.dao.entity.NopAiProject"</span>
            <span class="hljs-attr">registerShortName</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">"nop_ai_project"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">columns</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"主键"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"36"</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"1"</span>
                <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span> <span class="hljs-attr">tagSet</span>=<span class="hljs-string">"seq"</span> <span class="hljs-attr">ui:show</span>=<span class="hljs-string">"X"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"language"</span> <span class="hljs-attr">comment</span>=<span class="hljs-string">"项目使用的编程语言类型：JAVA, PYTHON等"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"项目语言"</span>
                <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span>
                <span class="hljs-attr">name</span>=<span class="hljs-string">"language"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>
                <span class="hljs-attr">ext:dict</span>=<span class="hljs-string">"ai/project_language"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"项目名称"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"3"</span>
                <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"prototype_id"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"模板项目ID"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prototypeId"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"36"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"4"</span>
                <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"project_dir"</span> <span class="hljs-attr">comment</span>=<span class="hljs-string">"项目在文件系统中的存储路径，例如：/data/projects/order-system"</span>
                <span class="hljs-attr">displayName</span>=<span class="hljs-string">"项目目录"</span>
                <span class="hljs-attr">name</span>=<span class="hljs-string">"projectDir"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>
                <span class="hljs-attr">ui:control</span>=<span class="hljs-string">"textarea"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">columns</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>存储AI项目基本信息<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">entity</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">entities</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">orm</span>&gt;</span>
</code></pre>
<p>可以看到，Markdown中定义的字段列表（表格格式）被正确转换为XML中的<code>&lt;columns&gt;</code>节点，包括字段名称、数据类型、约束条件等信息都被准确映射。</p>
<p>完成了加载器注册和映射规则定义后，我们就可以使用<code>nop-kernel-cli</code>工具进行实际的模型转换和代码生成操作了：</p>
<h2 data-id="heading-3">4. 通过元编程自动生成反向映射</h2>
<p>Nop平台提供了强大的元编程能力，可以根据已定义的正向映射自动生成反向映射配置。例如，当我们定义了从Markdown到ORM模型的映射<code>Md_to_OrmModel</code>后，系统可以自动生成从ORM模型到Markdown的反向映射<code>OrmModel_to_Md</code>。</p>
<h3 data-id="heading-4">4.1 自动生成反向映射的配置</h3>
<p>通过在RecordMapping配置中添加<code>record-mapping-gen:GenReverseMappings</code>扩展，系统会自动为所有正向映射生成对应的反向映射：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/record/record-mappings.xdef"</span>
             <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"md"</span> <span class="hljs-attr">x:dump</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:post-extends</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"/nop/record/xlib/record-mapping-gen.xlib"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">record-mapping-gen:GenReverseMappings</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:post-extends</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 正向映射配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_OrmModel"</span> <span class="hljs-attr">...</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 正向映射规则 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 系统会自动生成OrmModel_to_Md反向映射 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<p>执行后，系统会自动生成名为<code>OrmModel_to_Md</code>的反向映射，其字段映射关系与<code>Md_to_OrmModel</code>相反，确保数据可以在两种格式之间无损转换。</p>
<h3 data-id="heading-5">4.2 差量修正反向映射配置</h3>
<p>自动生成的反向映射可能无法完全满足所有需求，这时可以在当前文件中添加差量修正部分来微调配置。根据可逆计算理论，差量定义与全量定义格式完全一致。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/record/record-mappings.xdef"</span>
             <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"md"</span> <span class="hljs-attr">x:dump</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:post-extends</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"/nop/record/xlib/record-mapping-gen.xlib"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">record-mapping-gen:GenReverseMappings</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:post-extends</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 正向映射配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_OrmModel"</span> <span class="hljs-attr">...</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 正向映射规则 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"EntityModel_to_Md"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">fields</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"对象名"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">valueExpr</span>&gt;</span>
                    value?.$removePackageName(sourceRoot['ext:entityPackageName']);
                <span class="hljs-tag">&lt;/<span class="hljs-name">valueExpr</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"类名"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">valueExpr</span>&gt;</span>
                    value?.$removePackageName(sourceRoot['ext:entityPackageName']);
                <span class="hljs-tag">&lt;/<span class="hljs-name">valueExpr</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">fields</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">5. 使用nop-kernel-cli执行模型转换和代码生成</h2>
<p>完成DSL加载器配置后，可以使用<code>nop-kernel-cli</code>工具执行模型格式转换和代码生成操作。以下是常用命令示例：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">将XML格式的ORM模型转换为Markdown格式</span>
java -jar nop-kernel-cli.jar convert demo.orm.xml -o=demo.orm.md
<span class="hljs-meta prompt_">
# </span><span class="bash">将Markdown格式的ORM模型转换回XML格式</span>
java -jar nop-kernel-cli.jar convert demo.orm.md -o=demo.orm.xml
<span class="hljs-meta prompt_">
# </span><span class="bash">基于Markdown格式的ORM模型生成代码</span>
java -jar nop-kernel-cli.jar gen demo.orm.md -t=/nop/templates/orm -o=target
</code></pre>
<p>通过上述命令，我们可以实现不同格式DSL模型之间的双向转换，以及基于这些模型的代码生成，充分体现了Nop平台的灵活性和可逆计算理论的实践价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（15）Netty的线程模型是什么？它有哪些线程池类型？]]></title>    <link>https://juejin.cn/post/7584633505105690676</link>    <guid>https://juejin.cn/post/7584633505105690676</guid>    <pubDate>2025-12-17T11:55:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105690676" data-draft-id="7584653722593558580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（15）Netty的线程模型是什么？它有哪些线程池类型？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T11:55:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（15）Netty的线程模型是什么？它有哪些线程池类型？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:55:55.000Z" title="Wed Dec 17 2025 11:55:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的线程模型是基于事件循环的，它使用了一种称为"Reactor"模式的设计模式。在Netty中，所有的I/O操作都是异步的，通过事件驱动的方式进行处理。</p>
<p>Netty的线程模型主要由两个部分组成：EventLoopGroup和EventLoop。</p>
<ol>
<li>
<p>EventLoopGroup：
EventLoopGroup是一个线程池，负责管理一组EventLoop。它可以有多个EventLoop，并且可以选择使用不同的线程池类型。EventLoopGroup通常用于处理连接的接受和建立，并将连接分配给EventLoop进行处理。</p>
</li>
<li>
<p>EventLoop：
EventLoop是一个单独的线程，负责处理事件和执行任务。每个EventLoop都绑定到一个特定的线程，并且只能在绑定的线程上执行任务。EventLoop通过事件循环（Event Loop）来处理事件，包括接收数据、处理数据、发送数据和定时任务等。</p>
</li>
</ol>
<p>Netty提供了不同类型的线程池，可以根据实际需求选择合适的线程池类型。以下是一些常见的线程池类型：</p>
<ol>
<li>NioEventLoopGroup：基于Java NIO的线程池，适用于TCP和UDP传输。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
</code></pre>
<ol start="2">
<li>OioEventLoopGroup：基于Java IO的线程池，适用于阻塞I/O。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OioEventLoopGroup</span>();
</code></pre>
<ol start="3">
<li>EpollEventLoopGroup：基于Linux epoll的线程池，适用于高性能的TCP传输。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EpollEventLoopGroup</span>();
</code></pre>
<ol start="4">
<li>KQueueEventLoopGroup：基于BSD kqueue的线程池，适用于高性能的TCP传输。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KQueueEventLoopGroup</span>();
</code></pre>
<p>通过选择合适的线程池类型，可以充分利用底层操作系统的特性和优化，提高Netty应用程序的性能和可扩展性。</p>
<p>以下是一个使用NioEventLoopGroup的示例代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

<span class="hljs-keyword">try</span> {
    <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
    b.group(group)
            .channel(NioServerSocketChannel.class)
            .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyChannelInitializer</span>())
            .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
            .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

    <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
    f.channel().closeFuture().sync();
} <span class="hljs-keyword">finally</span> {
    group.shutdownGracefully();
}
</code></pre>
<p>在上面的示例中，我们创建了一个NioEventLoopGroup，并将其作为参数传递给ServerBootstrap。通过调用bind()方法来绑定端口，并最终调用closeFuture()方法来关闭服务器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（16）Netty的零拷贝机制是什么？它如何提高性能？]]></title>    <link>https://juejin.cn/post/7584633505105707060</link>    <guid>https://juejin.cn/post/7584633505105707060</guid>    <pubDate>2025-12-17T11:57:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105707060" data-draft-id="7584653722593574964" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（16）Netty的零拷贝机制是什么？它如何提高性能？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T11:57:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（16）Netty的零拷贝机制是什么？它如何提高性能？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:57:25.000Z" title="Wed Dec 17 2025 11:57:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的零拷贝（Zero-copy）机制是一种优化技术，用于在数据传输过程中减少数据拷贝的次数，从而提高性能和降低CPU开销。</p>
<p>传统的I/O操作中，数据通常需要从内核空间（Kernel Space）拷贝到用户空间（User Space），然后再进行处理或发送。这个过程涉及了多次数据拷贝，会增加CPU的负载和内存带宽的消耗。</p>
<p>Netty的零拷贝机制通过使用操作系统提供的特性来避免数据拷贝，从而提高性能。具体来说，Netty使用了以下两种技术来实现零拷贝：</p>
<ol>
<li>零拷贝文件传输：
Netty通过FileRegion接口，实现了零拷贝的文件传输。当需要将文件从一个地方传输到另一个地方时，Netty可以直接将文件描述符传递给操作系统，而不需要将文件的内容拷贝到用户空间。这样可以避免数据在内核空间和用户空间之间的多次拷贝。</li>
</ol>
<p>以下是一个示例代码，演示了如何使用零拷贝实现文件传输：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"path/to/file"</span>);
<span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">raf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(file, <span class="hljs-string">"r"</span>);

<span class="hljs-type">FileChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> raf.getChannel();
<span class="hljs-type">long</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> file.length();

ctx.write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFileRegion</span>(channel, position, count));
</code></pre>
<p>在上面的示例中，我们创建了一个FileRegion对象，并将其写入到Channel中进行传输。通过使用DefaultFileRegion，Netty可以直接传递文件描述符给操作系统，而不需要进行数据拷贝。</p>
<ol start="2">
<li>零拷贝内存传输：
Netty通过使用Direct Memory（直接内存）来实现零拷贝的内存传输。直接内存是一种在堆外分配的内存，可以直接与操作系统进行交互。在Netty中，通过使用ByteBuf的零拷贝特性，可以在内存之间直接传输数据，而不需要进行额外的拷贝操作。</li>
</ol>
<p>以下是一个示例代码，演示了如何使用零拷贝实现内存传输：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> Unpooled.directBuffer();
buffer.writeBytes(<span class="hljs-string">"Hello, Netty!"</span>.getBytes());

ctx.write(buffer);
</code></pre>
<p>在上面的示例中，我们创建了一个Direct Buffer（直接缓冲区），并将数据写入到其中。通过使用Direct Buffer，Netty可以直接将数据传递给操作系统，而不需要进行数据拷贝。</p>
<p>通过使用零拷贝机制，Netty可以减少数据拷贝的次数，降低CPU的负载和内存带宽的消耗，从而提高性能和吞吐量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SIGGRAPH Asia 2025：摩尔线程赢图形顶会3DGS挑战赛大奖，自研LiteGS全面开源]]></title>    <link>https://juejin.cn/post/7584680708138238003</link>    <guid>https://juejin.cn/post/7584680708138238003</guid>    <pubDate>2025-12-17T10:13:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708138238003" data-draft-id="7584657447802322970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SIGGRAPH Asia 2025：摩尔线程赢图形顶会3DGS挑战赛大奖，自研LiteGS全面开源"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-17T10:13:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SIGGRAPH Asia 2025：摩尔线程赢图形顶会3DGS挑战赛大奖，自研LiteGS全面开源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:13:02.000Z" title="Wed Dec 17 2025 10:13:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>12 月 17 日，在香港举办的全球图形学领域备受瞩目的顶级学术盛会 SIGGRAPH Asia 2025 上，摩尔线程在 3D Gaussian Splatting Reconstruction Challenge（3DGS 重建挑战赛）中凭借自研技术 LiteGS 出色的算法实力和软硬件协同优化能力，斩获大赛银奖，再次证明摩尔线程在新一代图形渲染技术上的深度积累与学术界的高度认可。 <br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552761f19ba8419ea2beff725acdc12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=pM4u98HZlG9SL7%2FzNTPJk5H45NI%3D" alt="图片" loading="lazy"/></p>
<p>3DGS：下一代图形渲染的范式革命</p>
<p>开启 AI 加速的高效渲染时代</p>
<p>3D Gaussian Splatting（3DGS，三维高斯溅射）是 2023 年提出的一项革命性 3D 场景表示与渲染技术，以可参数化的 3D 高斯分布为核心，实现了画质、效率与资源占用之间的卓越平衡。与传统 NeRF 相比，3DGS 在保持逼真渲染质量的前提下，将渲染效率提升数百至上千倍，并在光线追踪、VR/AR 实时渲染、多模态融合等方向展现出极强的适应性与扩展性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4eeed73d7754990ac9f6e0aaefb87d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=2OaB681wVkDQ3OvHibY6R28HILo%3D" alt="图片" loading="lazy"/></p>
<p>（* 上图仅作示意）</p>
<p>作为近年来快速发展的神经渲染技术，3DGS 不仅在三维重建与实时渲染等方向展现出卓越优势，也在更广泛的 AI 场景中具备潜在的基础价值。尤其是在具身智能（Embodied AI）等需要智能体理解并与真实环境交互的前沿领域，高质量、低延迟的三维环境建模至关重要。3DGS 以其高保真场景显示、快速优化能力和轻量级结构，为构建准确的世界模型提供了可靠支撑，有助于提升路径规划、环境感知和复杂操作任务的能力。随着 AI 技术向 “理解并操作真实世界” 方向不断延展，3DGS 正逐渐成为具身智能训练场景中的关键基础技术之一。</p>
<p>正因其对未来图形学技术路线的关键意义，3DGS 已成为全球学术界与产业界竞相投入的研究方向，受到 SIGGRAPH Asia 等权威机构的高度关注。</p>
<p>极致挑战：60 秒高质量重建</p>
<p>推动 3DGS 技术走向实用化临界点</p>
<p>本次竞赛为参赛团队设置了极具挑战性的任务：参赛者需在 60 秒内，基于主办方提供的真实终端视频序列（10–30 秒）、存在误差的相机轨迹以及终端 SLAM 点云，在极短时间内完成完整的 3DGS 高质量重建。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c87bd05ae60410fb50149c244a46757~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=Co0Jp%2FpxKOR9ok4R7hBofNFz7xQ%3D" alt="图片" loading="lazy"/></p>
<p>主办方以 PSNR（重建质量）与重建速度为综合评价指标，力求在完全公开、公正的条件下得出权威排名。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eedccefa71ee427f9abc0630b033e777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=5j3TzDmRvXcUkirjJX2Cfz1M3SA%3D" alt="图片" loading="lazy"/></p>
<p>目前 3D Gaussian Splatting Reconstruction Challenge（3DGS 重建挑战赛）的结果及数据集已向全球公开，相关资料可在 SIGGRAPH Asia 官方网站获取。</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgaplab.cuhk.edu.cn%2Fprojects%2FgsRaceSIGA2025%2F" target="_blank" title="https://gaplab.cuhk.edu.cn/projects/gsRaceSIGA2025/" ref="nofollow noopener noreferrer">gaplab.cuhk.edu.cn/projects/gs…</a></p>
<p>摩尔线程的技术答卷</p>
<p>以全栈能力实现精度与速度的极致平衡</p>
<p>摩尔线程 AI 团队以参赛编号 “MT-AI” 进入决赛阶段，在重建精度与效率两项指标上取得均衡且亮眼的表现：</p>
<ul>
<li>
<p>平均 PSNR：27.58（位列前三）</p>
</li>
<li>
<p>重建耗时：34 秒（显著领先多数队伍）</p>
</li>
</ul>
<p>凭借行业领先的 3DGS 算法构建能力与软硬件协同优化优势，摩尔线程最终获得二等奖（银牌）的优秀成绩。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14c21f2c651c4cb2a502b5c1e9f9fdfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=TvuSIf9svVQczJwsj24Ydswa7OU%3D" alt="图片" loading="lazy"/></p>
<p>开放协作</p>
<p>摩尔线程开源 3DGS 基础库 LiteGS</p>
<p>作为一种新兴的场景表示与新视角合成技术，3DGS 凭借高渲染质量与实时渲染速度，在计算机图形学与视觉领域实现了显著突破。该技术通过数以百万计的各向异性三维高斯基元来表示三维场景，以实现逼真的渲染效果，并在自动驾驶、虚拟现实、数字孪生等领域展现出巨大潜力。然而，尽管 3DGS 的渲染速度极快，其训练过程却往往需要数十分钟甚至数小时，成为制约其广泛应用的主要瓶颈。现有优化方案往往仅从单一层面入手，难以系统性地解决训练过程中的性能制约。</p>
<p>为此，摩尔线程自主研发了 3DGS 基础库 LiteGS，首次实现了从底层 GPU 系统、中层数据管理到高层算法设计的全链路协同优化：</p>
<ul>
<li>
<p>在 GPU 系统层面，摩尔线程创新提出基于 “One Warp Per Tile” 原则的 “Warp-Based Raster” 新范式，将梯度聚合简化为一次 Warp 内归约，并结合扫描线算法与混合精度策略，大幅降低梯度计算开销，同时实现高效的像素级统计能力；</p>
</li>
<li>
<p>在数据管理层，引入 “聚类-剔除-压缩” 流水线，借助 Morton 编码以极低开销对高斯基元进行动态空间重排，显著提升数据局部性，减少缓存失效与 Warp 分支；</p>
</li>
<li>
<p>在算法设计层，摒弃原有模糊的度量指标，采用更为鲁棒的像素不透明度梯度方差作为致密化的核心判据，精准识别欠拟合区域，其轻量化计算直接受益于底层光栅化器的高效统计支持。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c35476dc45384f6d9226d698423f5856~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=hLqvscMt4e5iWsb5sOIKKqAc0%2Bg%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e750b1047f04fb793352e5629ec9049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=ze1820j4peW2QXedZq1nQFvmmpQ%3D" alt="图片" loading="lazy"/></p>
<p>通过系统与算法的协同优化，LiteGS 在训练效率与重建质量上均实现显著领先，树立了该领域新的性能标杆。</p>
<ul>
<li>
<p>在达到与当前质量最优方案同等水平时，LiteGS 可获得高达 10.8 倍的训练加速，且参数量减少一半以上。</p>
</li>
<li>
<p>在相同参数量下，LiteGS 在 PSNR 指标上超出主流方案 0.2–0.4 dB，训练时间缩短 3.8 至 7 倍。</p>
</li>
<li>
<p>针对轻量化模型，LiteGS 仅需原版 3DGS 约 10% 的训练时间与 20% 的参数量，即可实现同等质量，展现出卓越的工程实用性与技术前瞻性。</p>
</li>
</ul>
<p>目前，LiteGS 已在 GitHub 平台全面开源，以推动三维重建与渲染技术的开放协作与持续演进。</p>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMooreThreads%2FLiteGS" target="_blank" title="https://github.com/MooreThreads/LiteGS" ref="nofollow noopener noreferrer">github.com/MooreThread…</a></p>
<p>摩尔线程此次在国际图形学顶会赛事上的获奖，不止是一次竞赛胜利，更是准确把握全球技术发展趋势并引领未来图形计算技术方向的战略体现。作为图形学领域未来发展的重要方向，3DGS 技术对算法与硬件协同提出了极高要求。摩尔线程通过创新的算法设计、深度优化的自研硬件以及高效的软硬件协同，在本次赛事中展现了卓越的综合能力。这一成就，印证了摩尔线程在图形智能计算领域技术路径的前瞻性与工程可行性，并体现了公司将前沿研究快速转化为实践成果的强大执行力。</p>
<p>2025 年 12 月 20 日 - 21 日，摩尔线程将于首届 MUSA 开发者大会设立技术专题，深入探讨 3DGS 等图形智能技术如何塑造未来，赋能具身智能等前沿领域，诚邀您共同关注与探讨。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI推出全新ChatGPT Images，奥特曼亮出腹肌搞宣传]]></title>    <link>https://juejin.cn/post/7584742635484069898</link>    <guid>https://juejin.cn/post/7584742635484069898</guid>    <pubDate>2025-12-17T10:11:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635484069898" data-draft-id="7584742635484037130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI推出全新ChatGPT Images，奥特曼亮出腹肌搞宣传"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-17T10:11:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI推出全新ChatGPT Images，奥特曼亮出腹肌搞宣传
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:11:42.000Z" title="Wed Dec 17 2025 10:11:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你刚刚打开 X 并且正好关注了 OpenAI 和山姆・奥特曼，那么你可能会看到这样的照片：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84b05c34cc2f4c329d320db475d4fe96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=tTTEJECbSpycA7SpUdztvXog%2FmE%3D" alt="图片" loading="lazy"/></p>
<p>是的，确实有点辣眼睛。就连 OpenAI 官方号也忍不住吐槽（其实是刷热度）：sam.</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cad5ad4ed9d46daadb5ddbcd97e0e8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=Mr7M3EgDVOI080GjC8Uia9sednw%3D" alt="图片" loading="lazy"/></p>
<p>而在评论区，更是一片吐槽和调侃：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bbe7a10715c4712807afb103cf6ea64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=dtF%2F5JPmC9Js8tJw9QynrLjgfEA%3D" alt="图片" loading="lazy"/></p>
<p>但不管怎么说，热度是有了。</p>
<p>实际上，山姆・奥特曼之所以发这样一张辣眼睛的图片，正是为 OpenAI 刚刚推出的全新 ChatGPT Images 造势。而且这也不是唯一一张基于奥特曼照片改的图。OpenAI 官方号还专门单独特地发了一张这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c21d5949c894830bef36aba0c3c0fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=W05tQuK3RpP8VPiJDsP5TWdZqRA%3D" alt="图片" loading="lazy"/></p>
<p>而且以身入局的 OpenAI 大佬还不止他一个。OpenAI 首席研究官 Mark Chen 和 OpenAI 总裁 Greg Brockman 都贡献了自己的照片。比如下面即是其官方博客分享的修图对话记录：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50f6ad55c3240f89beb682eb9ce9c3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=jGnHoW1B7GqGrb%2FASxR6hqEjE70%3D" alt="长图滚动查看" loading="lazy"/>上下滑动查看</p>
<p>新版 ChatGPT Images</p>
<p>ChatGPT Images 的新版本由 OpenAI 全新的旗舰图像生成模型驱动。该公司表示：「现在，无论你是从零开始创作还是编辑照片，都能得到你脑海中构想的画面。它能在进行精准编辑的同时保持细节完好，图像生成速度更是提升了 4 倍。」</p>
<p>其核心特性是：精准编辑，保留关键细节。</p>
<p>现在，当用户要求对上传的图片进行编辑时，模型能更可靠地遵循用户的意图。按 OpenAI 的说法是「细致入微到每一个小细节」，比如仅改变用户要求的部分，同时在输入、输出和后续编辑中保持光影、构图和人物外观等元素的一致性。</p>
<p>这能解锁很多潜在用例，比如更实用的照片编辑、更逼真的服装和发型试穿，还是保留原始图像精髓的风格滤镜和概念转换。</p>
<p>编辑功能</p>
<p>OpenAI 表示：该模型擅长各种类型的编辑，包括添加、删减、组合、融合和置换。</p>
<p>下面是一个从生成到各种编辑的示例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58e42fa63c4b486a93adda66d7769243~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=S%2Bfbc811o4bG%2Bosq335eMb1Ai3k%3D" alt="长图滚动查看" loading="lazy"/></p>
<p>创意转换</p>
<p>该模型还具备 transformation 功能，即可以改变和添加元素（如文本和布局）来实现想法，同时保留重要细节。OpenAI 表示，这些转换既适用于简单的概念，也适用于复杂的概念，并且可以通过新版 ChatGPT Images 功能中的预设风格和创意轻松尝试 —— 无需手动编写提示词。</p>
<p>比如，你可以将一张日常照片转换成电影海报。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46125a89a79f4f06b6d6942ec41695a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=jUGRDSfw%2Brkts643EYZl8Zko94E%3D" alt="图片" loading="lazy"/></p>
<p>或制作一张戴珍珠耳环的奥特曼。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e7eb3e8ae3d47618fbc36f008497953~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=f%2FcYb6x7GpdKqvAaSIrvvF4zZEw%3D" alt="图片" loading="lazy"/></p>
<p>遵循指令</p>
<p>OpenAI 称：「与我们的初始版本相比，该模型能更可靠地遵循指令。这不仅实现了更精准的编辑，还能处理更复杂的原始构图，按预期保留元素之间的关系。」下面给出了一个对比示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c50096c0ffa4115b68963675e1861cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=ujtYhphYGb9yainbQFa791TGf24%3D" alt="图片" loading="lazy"/></p>
<p>文本渲染</p>
<p>该模型在文本渲染方面又迈进了一步，能够处理更密集、更小的文本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61105c618a1642588228aa7e2519d09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=MI4GElIJMxzkkZnNV5wOSTLiuUE%3D" alt="长图滚动查看" loading="lazy"/></p>
<p>其他质量改进</p>
<p>该模型还在其他维度上进行了改进，使得输出结果能更直接地投入使用，例如渲染许多小尺寸的人脸以及提升输出结果的自然程度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1651ecefa0804391b0349885da78499d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=ujPlpFAa62BJh6Vhw6L%2FvqjtWdw%3D" alt="图片" loading="lazy"/></p>
<p>全新的创作空间</p>
<p>另外，OpenAI 还在 ChatGPT 中推出了全新的「Images」（图片）功能，「旨在让图像生成体验更加令人愉悦 —— 不仅能激发灵感，还能让创意探索变得毫不费力。」</p>
<p>用户可通过移动应用的侧边栏和 chatgpt.com 访问，让图像的探索和尝试变得更快、更简单。它包含了数十种预设滤镜和提示词以快速激发灵感，并会定期更新以反映新兴趋势。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37980b8a9648476898be8f28de849bfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=iohd53uf39BsJEb5jip25XU3Ie4%3D" alt="图片" loading="lazy"/></p>
<p>可用性</p>
<p>全新的 Images 模型于今日起向所有 ChatGPT 用户推出，并通过 API 以 GPT Image 1.5 的形式提供。与 GPT Image 1 相比，GPT Image 1.5 的图像输入和输出价格降低了 20%，因此用户可以在预算不变的情况下生成和迭代更多图像。</p>
<p>ChatGPT 中全新的 Images 体验也于今日向大多数用户开放，商业版（Business）和企业版（Enterprise）的访问权限将在稍后推出。</p>
<p>OpenAI 表示：「我们相信，我们仍处于图像生成所能实现的可能性的开端。今天的更新是向前迈出的有意义的一步，未来还将有更多功能推出，从更细粒度的编辑到跨语言的更丰富、更详细的输出。」</p>
<p>结语</p>
<p>最后，我们也使用一个同样的提示词，简单测试对比了 ChatGPT Images 与谷歌的 Nano Banana Pro。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c09530327164ebd89acb7ffee50b85c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=05Gr0A%2BXipvc30CWUCeFvm4N9wQ%3D" alt="图片" loading="lazy"/></p>
<p>ChatGPT Images 的结果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd8926f0ede74544b82dd987817c4f99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=twXowkatk3pICSto%2FlLGYykOeuM%3D" alt="图片" loading="lazy"/></p>
<p>Nano Banana Pro 的结果</p>
<p>看起来，至少在这个特定案例中，ChatGPT Images 的结果更加符合我们的指令。</p>
<p>综合来看，在这场 AI 生图之战中，OpenAI 此次发布的 ChatGPT Images 标志着竞争的维度正在变化：从单纯的「模型能力」转向了综合的「产品体验」。OpenAI 这一次甚至没有放出任何量化的基准测试结果！</p>
<p>同时，Sam Altman 亲自下场自黑虽然充满了硅谷式的幽默，但其背后的信号非常清晰：OpenAI 正在极力降低用户的心理门槛。通过推出独立的「Images」入口、预设风格滤镜以及极大幅度的降价，OpenAI 试图将图像生成从一种需要精心调试提示词的专业技能，变成一种像发推特一样简单的日常交互。</p>
<p>你看好 ChatGPT Images 吗？</p>
<p>参考链接</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Findex%2Fnew-chatgpt-images-is-here%2F" target="_blank" title="https://openai.com/index/new-chatgpt-images-is-here/" ref="nofollow noopener noreferrer">openai.com/index/new-c…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FOpenAI%2Fstatus%2F2000990989629161873" target="_blank" title="https://x.com/OpenAI/status/2000990989629161873" ref="nofollow noopener noreferrer">x.com/OpenAI/stat…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter运行iOS26真机的两个问题]]></title>    <link>https://juejin.cn/post/7584633505105313844</link>    <guid>https://juejin.cn/post/7584633505105313844</guid>    <pubDate>2025-12-17T10:14:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105313844" data-draft-id="7584379805899817012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter运行iOS26真机的两个问题"/> <meta itemprop="keywords" content="Flutter,iOS"/> <meta itemprop="datePublished" content="2025-12-17T10:14:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="往来凡尘"/> <meta itemprop="url" content="https://juejin.cn/user/3553229180502071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter运行iOS26真机的两个问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3553229180502071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    往来凡尘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:14:59.000Z" title="Wed Dec 17 2025 10:14:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Debug编译崩溃</h2>
<blockquote>
<p>../../../flutter/third_party/dart/runtime/vm/virtual_memory_posix.cc: 428: error: mprotect failed: 13 (Permission denied)</p>
</blockquote>
<blockquote>
<p>在iOS上Dart不管是JIT运行还是进行hotload的时候，都需要涉及代码在内存从RW变成RX的调整，而这在Flutter低版本是通过<code>mprotect</code>完成，而这在iOS 26被禁止了</p>
</blockquote>
<p>所以Flutter在Debug模式下真机运行iOS 26设备就崩溃了。如果确实需要在iOS 26上真机调试，方案如下：</p>
<ol>
<li>目前测试最新的3.38.5版本可以正常在Debug模式运行iOS 26设备。</li>
<li>如果不能升级Flutter版本，只能暂时使用Release或Profile模式运行(修改iOS项目Scheme,设置run-&gt;Build Configuration)</li>
</ol>
<h2 data-id="heading-1">二、Flutter适配UIScene</h2>
<p>当我的iOS 26的设备正常运行后，发现Xcode控制台有一行打印：</p>
<blockquote>
<p><code>UIScene</code> lifecycle will soon be required. Failure to adopt will result in an assert in the future.</p>
</blockquote>
<p>强制使用UIScene不然未来就可能触发断言，太可怕了😱那就顺便做了吧。</p>
<p>Flutter<code>最低版本</code>：</p>
<pre><code class="hljs language-dart" lang="dart">environment:
  sdk: ^<span class="hljs-number">3.10</span><span class="hljs-number">.0</span>
  flutter: <span class="hljs-string">"&gt;=3.38.0"</span>
</code></pre>
<p><strong>方案一：</strong> 自动化迁移，适合iOS <code>AppDelegate</code>文件没有大量定制化修改,在项目终端运行命令：</p>
<pre><code class="hljs language-sh" lang="sh">flutter config --enable-uiscene-migration
</code></pre>
<p>迁移成功后，会在构建日志中看到 <strong>"Finished migration to UIScene lifecycle"</strong> 的提示，否则工具会给出警告，并提示你手动迁移。</p>
<p><strong>方案二：</strong> 手动迁移</p>
<ol>
<li><code>AppDelegate</code>移除window生命周期相关的方法，使用<code>UIScene lifecycle</code>的对应方法，保留<code>application(_:didFinishLaunchingWithOptions:)</code>方法，移除所有创建和设置<code>window</code>的代码</li>
<li><code>AppDelegate</code>类遵循协议：<code>FlutterImplicitEngineDelegate</code>，并在<code>didInitializeImplicitFlutterEngine</code>方法中注册插件，并将创建Method Channels或Platform Views的逻辑都迁移到此处，因为在<code>didFinishLaunchingWithOptions</code>执行时，<code>FlutterViewController</code>可能还不存在</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Flutter
<span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">@main</span>
<span class="hljs-keyword">@objc</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDelegate</span>: <span class="hljs-title class_">FlutterAppDelegate</span>, <span class="hljs-title class_">FlutterImplicitEngineDelegate</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(
    <span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>, 
    <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>
  ) -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
  
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didInitializeImplicitFlutterEngine</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">engineBridge</span>: <span class="hljs-keyword">any</span> <span class="hljs-type">FlutterImplicitEngineBridge</span>) {
        <span class="hljs-type">GeneratedPluginRegistrant</span>.register(with: engineBridge.pluginRegistry)
        <span class="hljs-comment">// Channel、Platform Views</span>
    }
}
</code></pre>
<ol start="3">
<li>创建<code>SceneDelegate.swift</code>文件，基础定义如下：</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> Flutter

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SceneDelegate</span>: <span class="hljs-title class_">FlutterSceneDelegate</span> {
}
</code></pre>
<ol start="4">
<li><code>info.plist</code>添加<code>Application Scene Manifest</code>相关key：</li>
</ol>
<pre><code class="hljs language-XML" lang="XML"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIApplicationSceneManifest<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIApplicationSupportsMultipleScenes<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">false</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneConfigurations<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIWindowSceneSessionRoleApplication<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneConfigurationName<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Default Configuration<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneDelegateClassName<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>$(PRODUCT_MODULE_NAME).SceneDelegate<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneStoryboardFile<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
</code></pre>
<p>key缺失可能会导致启动黑屏或控制台打印xxxkey缺失，其中key：</p>
<ul>
<li>UISceneConfigurationName：<code>Default Configuration</code>或<code>flutter</code>均可</li>
<li>UISceneDelegateClassName：<code>FlutterSceneDelegate</code>或<code>$(PRODUCT_MODULE_NAME).SceneDelegate</code>均可</li>
</ul>
<p>到此基础配置就完成了，恭喜你demo项目可以正常运行了，如果你的项目其他定制化修改还需要迁移，详细可以参考下面的<code>Flutter Docs</code>。</p>
<h3 data-id="heading-2">参考链接</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate%23if-you-cant-directly-make-flutterscenedelegate-a-subclass" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate#if-you-cant-directly-make-flutterscenedelegate-a-subclass" ref="nofollow noopener noreferrer">Flutter Docs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Ftechnotes%2Ftn3187-migrating-to-the-uikit-scene-based-life-cycle" target="_blank" title="https://developer.apple.com/documentation/technotes/tn3187-migrating-to-the-uikit-scene-based-life-cycle" ref="nofollow noopener noreferrer">Apple Docs</a></li>
<li><a href="https://juejin.cn/post/7565733796269981738" target="_blank" title="https://juejin.cn/post/7565733796269981738">iOS 26 开始强制 UIScene</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[是个公司都在用AI Agent，但大家真的用明白了吗？？| MEET2026圆桌论坛]]></title>    <link>https://juejin.cn/post/7584408254820483107</link>    <guid>https://juejin.cn/post/7584408254820483107</guid>    <pubDate>2025-12-17T10:19:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254820483107" data-draft-id="7584472215975788559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="是个公司都在用AI Agent，但大家真的用明白了吗？？| MEET2026圆桌论坛"/> <meta itemprop="keywords" content="AI编程,AIGC"/> <meta itemprop="datePublished" content="2025-12-17T10:19:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            是个公司都在用AI Agent，但大家真的用明白了吗？？| MEET2026圆桌论坛
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:19:48.000Z" title="Wed Dec 17 2025 10:19:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读29分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“每个人每天使用最高频的三个 APP 中有两个是 Agent 时，才意味着 AI Agent 进入新发展阶段。”</p>
<p>“一个好 Agent 的衡量指标，包括可控性、可解释性以及持续稳定执行任务的能力。”</p>
<p>“多数 Agent 存在负毛利问题，完成任务的代价高于用户支付意愿，这对创业者来说是巨大挑战。”</p>
<p>……</p>
<p>在量子位 MEET2026 智能未来大会的<strong>圆桌环节</strong>，三位来自产业一线的嘉宾围绕 <strong>AI Agent 的革新进程</strong>展开深入讨论。他们分别是：</p>
<ul>
<li>
<p>联汇科技 CEO 兼首席科学家赵天成博士</p>
</li>
<li>
<p>小宿科技联合创始人兼 CEO 杜知恒先生</p>
</li>
<li>
<p>蚂蚁集团平台体验技术部负责人徐达峰先生</p>
</li>
</ul>
<p>2025 年普遍被视为 “Agent 元年”。从客服、理赔等相对标准化的场景开始，Agent 已经完成了初步落地，并验证了技术可行性与阶段性价值。</p>
<p>但真正的难题才刚刚显现——</p>
<p>如何让 Agent 同时跑通技术、产品与商业三条曲线，形成可持续的正向闭环，仍是摆在整个行业面前的共同挑战。</p>
<p>而在这场圆桌讨论中，三位嘉宾从产品形态、技术演进与商业现实等多个维度出发，分享了他们对 Agent 下一程的判断。</p>
<p>透过这些观点，我们或可窥见 Agent 从技术概念走向规模应用的关键路径，以及产业先行者们在探索中所面临的思考与抉择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d43778f4e8c43e0a10943928136ac2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=dfLK7hyJH%2Fo%2B7PIRrE9UUmIEVDI%3D" alt="" loading="lazy"/></p>
<p>本次圆桌环节由量子位智库首席分析师刘萌媛主持。在不改变原意的基础上，本文对内容进行了编辑整理。希望能够给你带来更多的启发与思考。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下到场参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">话题要点</h2>
<ul>
<li>
<p>目前在 AI Agent 及相关领域重点从事哪些工作？</p>
</li>
<li>
<p>各自落地效果最好的案例是什么？</p>
</li>
<li>
<p>真正好用的 AI Agent 产品应该关注哪些指标？</p>
</li>
<li>
<p>未来还有哪些对于 AI Agent 发展比较关键的卡点？</p>
</li>
<li>
<p>AI Agent 的下一步关键演进方向是什么？进入新阶段的标志性节点是什么？</p>
</li>
</ul>
<p><em>以下为圆桌对话全文：</em></p>
<h2 data-id="heading-1">圆桌实录</h2>
<p><strong>量子位</strong>：</p>
<p>无论是在前面各位嘉宾的演讲中，还是在整个 2025 年的讨论里，相信大家已经多次听到 “AI Agent” 这一关键词。</p>
<p>无论是技术迭代还是产品涌现，AI Agent 确实屡屡让人眼前一亮。今天，我们将从更加理性、务实的角度来探讨：<strong>千行百业距离广泛应用 AI Agent 究竟还有多远？</strong></p>
<p>为此，我们邀请到三位嘉宾，他们分别代表 AI Agent 产业链上不同领域的最前沿产品与技术，来为大家带来切实的分享。</p>
<p><strong>首先，请三位嘉宾简要介绍一下自己，以及目前在 AI Agent 相关领域所从事的工作</strong>。</p>
<p><strong>赵天成</strong>：</p>
<p>大家好，我是来自联汇科技的赵天成。在过去的五年里，我们团队一直在做的事情是：</p>
<p>第一，研发信号终端侧的多模态模型；</p>
<p>第二，探索如何让智能体从在虚拟世界做 PPT、写写画画，走向物理世界，真正操控终端设备，也就是实现所谓的 <strong>“物理智能体”</strong>。</p>
<p>目前我们在两个方向做了很多工作，一是致力于让多模态智能体本地化运行，不完全依赖云端强大算力。例如，让它在端侧设备_（如 AI PC）_上，甚至在飞机等无网络环境中，也能高效处理海量多模态数据，并转化为真正实用、能帮用户解决实际问题的智能体。</p>
<p>更进一步，我们致力于将无人机、机器人、摄像头等具备真正执行能力的智能终端串联起来，形成协同工作的智能体网络。这是一个非常有意思的课题。目前大家熟悉的智能体，或许更多体现在处理工作流或特定查询场景中。<strong>而我们探索的是更系统的物理联动</strong>。</p>
<p>举个例子，一个智能摄像头探测到火灾，它可以自动通知另一个终端——比如一台配备灭火装置的机器狗。机器狗收到指令后前往现场扑灭火情，并在任务完成后返回基地，自动生成一份报告给管理员，说明 “火灾已发生并被扑灭，问题已解决”。</p>
<p>这样一个从感知、决策、执行到反馈的完整闭环，能否通过智能体流畅地串联与调度，从而实现智能体从数字世界走向物理世界的跨越？这正是我们团队过去两年来持续深耕的核心方向。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f00532be7d44eaa82c1fc60a1a60e86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=cXbwz58Wo%2F0vjap38hDGDLRxWZU%3D" alt="" loading="lazy"/></p>
<p><strong>徐达峰</strong>：</p>
<p>大家好，我是来自蚂蚁平台体验技术团队的徐达峰。我们目前主要聚焦在两个方向：</p>
<p><strong>一是重构软件的研发方式</strong>。我们正在构建一套完整的智能研发体系——WeaveFox，其中包含 WeaveFox-Coder、Vibe-Coding、Spec-Coding 等模块，并打造了面向工程体系的 Coding-Agent 基础设施和软件工程 - Agent 基础设施。</p>
<p>我们的核心目标，不仅仅是 “让模型能够写代码”，更是要将多模态生成代码、任务自动拆解、工具链智能协同等能力，真正融入到生产环境中。我们致力于让 AI 从辅助工具，转变为研发体系的原生能力，从而推动整个工程链路实现更高水平的自动化。</p>
<p><strong>二是致力于将多智能体能力带给大众用户</strong>。</p>
<p>为此，我们推出了 “蚂蚁百宝箱” 以及“百宝箱超级智能体”。我们的愿景是将其打造成一个“通用 Agent 平台”——无需任何代码依赖，也不要求使用者具备技术背景，真正做到开箱即用。用户只需用自然语言描述需求，就能轻松构建并发布属于自己的智能体应用。</p>
<p>无论是内容创作类的需求，如生成文案、制作 PPT、撰写报告、设计网页，还是通过多 Agent 协作完成更复杂的工作流任务，都可以通过这个平台实现。我们的目标，是将 AI 智能体从高门槛的 “专业工具”，转变为人人都能用起来的 “工具箱”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d55c3d4ee31b4c618eac4d1e4cfd8a63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=1oZImH%2FnZ0Cr72B9lpjEWbKD9NQ%3D" alt="" loading="lazy"/></p>
<p><strong>杜知恒</strong>：</p>
<p>我是杜知恒，小宿科技打造的是<strong>面向 Agent 的一站式基础设施平台</strong>。</p>
<p>我们认为，其中尤为重要的一个产品是为 Agent 设计的搜索引擎。这里我们也呼应一下蚂蚁的观点：我们相信，优秀的 Agent 能够胜任人类可以完成的工作。</p>
<p>过去，搜索引擎和信息获取一直是人们工作、学习乃至日常生活中最主要的信息获取工具。我们提供的正是一个多语言、全球化的搜索引擎工具，专门服务于 Agent。</p>
<p>除了搜索能力，我们还提供模型服务、AI 沙盒等多样化的 Agent 工具集，致力于为大家打造一站式的 Agent Infra 平台。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ed1f23e7d0406398f65667f72d8cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=M0Lw48N2wuStv%2BwAratKkyP6XTY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">各自落地效果最好的案例是什么？</h4>
<p><strong>量子位</strong>：</p>
<p>在三位做的 Agent 相关的产品里面，效果最好的 Agent 落地案例是什么？能否结合具体数据和观众分享一下，让大家对 Agent 落地价值有更直观的感受？</p>
<p><strong>赵天成</strong>：</p>
<p>今年有两个点带来的 ROI_（投资回报率）_提升还是非常明显的。</p>
<p>第一个是有了<strong>多模态</strong>。今年的确是 VLM_（视觉语言大模型）_大幅度成熟的一年，之前大家用 ChatGPT、GPT-4 比较多，今年 GPT-4o、Gemini 3 这些新出来的多模态模型对于图像和视频的理解能力其实有质的飞跃。</p>
<p>有了这个能力之后，我们的智能体可以算是打开了新的窗户。之前 Agent 只能处理文本，要做图片任务还需要一段描述，再给到模型去理解执行，现在有了端到端模型之后，直接给视频、给扫描件、给一张图片甚至混合在一起都可以直接做（任务），很多以前不敢想的场景瞬间打开。</p>
<p>我们在多模态领域扎根很久，之前就在做很多探索，今年的确感受到建模本身的提升，多模态能力可以让我们的智能体即使在数字空间场景中，也可以做很多以前不可能做到的事情。</p>
<p>第二个是有了<strong>执行智能体</strong>。以前的 AI 即使可以理解视频、理解图像，也只能给你一个提醒 “这边发生事故赶快修复”、“这边有问题赶快派人去吧”，现在有了执行智能体，无论是操控机械臂还是执行其他操作，现场就能直接解决问题。</p>
<p>这对于用户来说，投资回报率和价值完全不在一个量级，比如以前一个终端最多付一千块钱，有了智能执行端之后愿意付十万块钱，这是一百倍的本身价值的提升。</p>
<p>智能体核心逻辑在于<strong>结果即服务</strong>，提供的是一个结果，这个结果的价值定义了产品有多大的能力边界，一个是帮你看着，提醒你赶快灭火吧；第二个是直接告诉你已经帮你把火扑灭了，比人扑的更快一些，这个对客户来说价值是 100 倍的提升，这也是为什么我们非常笃定地相信<strong>多模态 + 执行</strong>是智能体在后续发展中非常重要的板块和体现。</p>
<p><strong>杜知恒</strong>：</p>
<p>过去这一年 Agent 进化还是很明显的，从大家只会用 Chatbot 到真正开始用 AI 做各种各样的任务、工作，包括陪伴式的娱乐、学习。</p>
<p>我观察到在这几个场景中，Agent 能做越来越多智能化的工作。</p>
<p>第一个就是刚才说的做 PPT、写产品文档，包括 Coding，在核心工作流中 Agent 开始能交付实习生水平的结果，这是过去一年中 Agent 领域非常明显的进步和进化。</p>
<p>另外可以看到，各种各样的垂类软件正在越来越多地采用 AI 技术，无论是客服系统、数据平台还是其他各类软件工具。我的观察是，上一代 SaaS 公司正在快速引入 AI 能力，这显著提升了它们服务客户的效率与质量。</p>
<p><strong>徐达峰</strong>：</p>
<p>前面老师提到智能客服，还有端到端多模态 + 执行，我补充一个 Coding Agent 能力方面的个人观察。</p>
<p>Coding Agent 已经从<strong>写一段代码进化为跑一段流程</strong>。在 WeaveFox 的实践中，Agent 能看懂设计稿、理解上下文和组件规范，然后自动生成可上线代码。过去通常需要工程师在 IDE 中花半天时间调试，现在 Agent 几十秒就能跑完。而且这是在多个规模化项目里，我们稳定看到了 3~5 倍的效率提升。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f36425066d5141feb4546069166fc804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=2vQ8H9oE3ABPQNCRxPenBQ%2B6p%2FM%3D" alt="" loading="lazy"/></p>
<p>这说明，<strong>只要工具链和上下文足够清晰，Agent 的能力是可以被 “工程化复制” 的</strong>。</p>
<h4 data-id="heading-3">真正好用的 AI Agent 产品应该关注哪些指标？</h4>
<p><strong>量子位</strong>：</p>
<p>今天邀请到的三位嘉宾在 AI Agent 里面处于不同的生态位，小宿处于基础设施层，另外两位老师偏向于产品层，请各位在不同的生态位上定义真的好用、或者有价值的 AI Agent 产品，你们觉得现在更应该关注哪些指标？有哪些指标大家没有关注？下一步应该在哪些方面投入更多技术和精力呢？</p>
<p><strong>杜知恒</strong>：</p>
<p>我的观点还是一样的，（如果 AI）能更像人一样，交付一个从高中生到大学生到博士生能交付的结果，这就是好场景。</p>
<p>企业愿意为这类 AI 支付更高成本，背后的逻辑很明确：过去，大家把 AI 当作普通软件看待，关注点局限在软件订阅费的高低；而现在，大家会将其价值与实习生、全职员工的人力价值做对比。</p>
<p>即便目前存在<strong>堆砌 Token 完成任务</strong>的争议，包括我们公司在内，许多企业在高频使用 AI 进行代码编写（Coding）、撰写产品需求文档（PRD）、搭建各类工作流以优化效率的过程中，通过 AI 节省的人工成本，也远远超过了在 Token 上投入的费用，即使 Claude Code 很贵。</p>
<p>我觉得我们内部对 Agent 可用性最主要的评判标准，就是<strong>它能不能在特定场景交付一个相对完整的结果</strong>。</p>
<p>Agent 在中国被叫智能体，但其实我觉得 <strong>“代理人”</strong> 这个翻译是更好的，一个 Agent 不能给你交付结果，你肯定不会花钱雇他，包括 Coding 这些场景在内，AI 越来越能够真正交付结果。</p>
<p>现在 Coding 还有抽卡的情况，但即使是抽卡抽三次性价比依然很高。</p>
<p><strong>赵天成</strong>：</p>
<p>我们从时间上来看，有两方面是整个业界要慢慢接受和改变的，因为智能体跟以前信息化系统和纯粹软件还是不太一样的。</p>
<p>第一个是之前很多人说做 AI 原生的 Agent，我们发现以前软件系统有很多 UI 式、表单式结构，很多时候 AI 就是把表单的某些环节换成模型，这是比较方便的方式，但也有很多时候换汤不换药，还是原来的工作流做的事情。</p>
<p>其实可以把一个环节彻底用 Agent 代替，这时候可能会有一些更加创新型的产品并落地应用，这样才真正能把智能体的优势发挥出来，而不是受限于很条条框框的地方，只能做以前一些环节的替代。大家（才）会接受智能体可以真正替代一个流程一个环节，真正用 AI 的方式做这个事情。</p>
<p>第二个是 Agent 本身是可以进化的，在以往的 AI 应用中，包括我们的不少甲方客户在内，很多人会陷入一种认知误区：认为采购 AI 本质上就是采购一套算法，并且对算法的准确率、召回率有明确要求，若初始阶段无法达到既定指标，就不会验收。</p>
<p>但实际上，Agent 的价值体现在实际应用过程中，Context_（上下文信息）_会不断丰富，它自身具备记忆能力，再结合用户给出的反馈，会逐渐熟悉用户的业务流程，最终真正帮用户解决实际问题。然而当前许多场景下，用户并不能接受这种渐进式优化的模式，他们往往期望一步到位，要求 AI 在初始阶段就达到 95% 的准确率。</p>
<p>这就陷入了 “鸡生蛋还是蛋生鸡” 的矛盾问题。如果用户不使用 AI、不提供反馈、不补充 Context，不给 AI 学习和适应的机会，AI 自然无法达到理想的使用效果；可用户又因 AI 初始效果未达预期而不愿启用，形成了恶性循环。</p>
<p>不过这种情况也在逐渐改变，越来越多人也正在接受，说明大家用豆包、用 GPT，已经习惯了越聊越聪明的交互模式，慢慢（把它）变成自己想要的数字员工。</p>
<p>这个可进化性也是我们内部衡量智能体的非常重要的指标。假如一个智能体做出来就是这样了，你再跟它聊它都不会有变化，那就不是好的智能体，如果通过一天、一周、一个月使用变得更加个性化了，就是好的智能体。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00476deb3e5f436b99118fe51f2e4e71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=8EiEmBNIo4OUQH9E0Z7NhLzXazM%3D" alt="" loading="lazy"/></p>
<p><strong>量子位</strong>：</p>
<p>我想再追问一下赵总，您刚刚提到用 Agent 彻底替代某一部分工作流，或者某一部分工作场景，那让你畅想一下在未来 6 个月或者一年之内，您觉得会有哪些行业或者场景率先有可能被彻底改变工作流呢？</p>
<p><strong>赵天成</strong>：</p>
<p>假如是 6 个月的时间，在那些失败结果没有那么灾难性的地方，相关问题或许可以得到彻底解决。（这些场景的容错空间相对较大），AI 一次没做好，大不了再做一次，而且如果做三次的成本，比我自己干整个过程的成本还是低很多，那这类工作就可以被替换掉。</p>
<p><strong>量子位</strong>：</p>
<p>也就是说结果不够致命，有一点容错空间的任务基本可以实现 AI 替代人。</p>
<p>那么徐总，蚂蚁目前在做的这些产品，包括您刚才提到的 Coding Agent，以及面向群众的产品，从您的角度来说，一款 AI Agent 产品最值得关注的指标是什么呢？</p>
<p><strong>徐达峰</strong>：</p>
<p>在我看来，判断一款 Agent 是否优秀，可以从以下几个角度界定标准，比如可控性、可解释性，乃至于稳定性，这是基础要求，在此就不赘述了。</p>
<p>需要明确的是，Agent 一定是基于某一类特定任务去设计的，很多场景里，任务本身就是开放型问题、还存在各种例外情况，模型也不可能 100% 完美解决所有问题。所以我认为优秀的标准是<strong>看 Agent 产品有没有设计人机协作的流程</strong>。</p>
<p>企业真正需要的不是 “永不犯错”，而是犯错时能暴露不确定性，是否具有回滚的能力，能不能回溯回去找到问题。另外在这个过程中，在出现问题后，能顺畅地将任务交由人工接管。</p>
<p>也就是说，它要像一位可靠的同事，而不是像一名（缺乏协作性的）天才小学生。如果没有如上指标，即便效果再惊艳，也很难真正落地，我觉得这是一个好的 Agent 的标准指标。</p>
<p><strong>量子位</strong>：</p>
<p>如果把刚刚给赵总的问题再抛给您，目前您涉及的所有用户场景里，未来 6 个月，您觉得哪一个是被改写最彻底的？</p>
<p><strong>徐达峰</strong>：</p>
<p>彻底不敢谈。我认为<strong>软件工程</strong>可能仍会面临较大的冲击和变革。</p>
<p>这主要是因为其工具链相对成熟，有上一代数字基建作为基础，且任务本身偏向结构化。</p>
<p>同时，进一步自动化的收益非常高。这些因素共同作用，将推动整个流程越来越自动化，通过辅助编码和自动化流程，研发团队也会更容易接受。因此，我认为是软件工程。</p>
<p><strong>量子位</strong>：</p>
<p>我们把这个问题换一个方向问杜总，您作为基础设施层的代表，您认为基础设施层究竟是如何影响不同 AI Agent 产品最终呈现的任务水平呢？能否结合小宿或其他具体案例，为我们解析一下具体的影响链路？</p>
<p><strong>杜知恒</strong>：</p>
<p>其实我们很难直接影响到 Agent 本身，更多是客户基于自身场景对基础设施提出更高要求，我们去响应和满足。</p>
<p>回到搜索本身，从 ToC 时代到 ToAgent 时代，三十年来它的核心标准——<strong>相关性、权威性、时效性</strong>，本质上没有改变。变化的是这些标准的重要程度。</p>
<p>过去，用户搜索时前三条结果必须吸引点击，所以相关性是最重要的指标。（但仅有相关性还不够）即使内容相关但质量很差，排到前面用户接受的概率，也比展示不相关信息要低得多。</p>
<p>但对于 AI 而言，调用搜索的核心原因在于消除信息幻觉与获取时效内容。</p>
<p>对 AI Agent 来说，搜索的首要要求是<strong>权威性——信息必须准确、全面</strong>。即便在前十条结果中，哪怕极端情况下有两条不相关，也远比 “十条看似相关、却缺乏精准性和时效性的信息” 要好，后者带来的后果反而更加灾难性。</p>
<h4 data-id="heading-4">未来还有哪些对于 AI Agent 发展比较关键的卡点？</h4>
<p><strong>量子位</strong>：</p>
<p>我们刚刚几个问题都聊的是 Agent 今天有怎么样的成就和价值，那我们现在从批判的角度聊一聊。</p>
<p>首先想问一下，从各位的角度来看，除了现在常说的推理大模型，或者语言大模型，还有哪些对于 AI Agent 未来发展比较关键的卡点？</p>
<p>既可以是技术方面，也可以是生态运营方面的，不知道各位是怎么看待这个问题的？</p>
<p><strong>赵天成</strong>：</p>
<p>我最近比较关注的是智能体的<strong>双脑架构</strong>。</p>
<p>刚才提到的代码生成这些创新都是用大语言模型做快速的处理，但是到我们这种物理场景之后，有时候你逃不掉，必须做双脑架构。</p>
<p>什么叫双脑？比如大语言模型给出一个指令，说无人机几点几分到这个地方去，但是在飞行过程中怎么飞？假如还是依赖云端语言模型思考的话，这个飞机干脆不要飞了，每飞 5 米就要想一想再飞一下，不太现实。</p>
<p>所以必须在端侧要有快速的、类似于小脑的模型做飞行这一块的执行，这个就跟常规的 MCP 模式还不太一样，以往云端模型调用工具，可能只是完成一次搜索、查询或简单指令下发；但在双脑架构里，云端大脑调用的不是普通工具，而是要驱动端侧小脑模型，让它把飞机飞过去。</p>
<p>这其实和目前主流智能体架构有区别，跟学术界研究的问题也不太一样。这里面得有一个框架，方便把各种小脑和大脑集成在一起，真正形成一个指挥官和类似于行动单元的组合的形态。</p>
<p>这个是我们近期一直在看的点，因为现在的确碰到了这样的现实问题，而且需要解决这些问题。</p>
<p><strong>徐达峰</strong>：</p>
<p>我可以补充一个企业视角下的观点，Agent 如果要在企业中落地，可能还会有一些挑战。尤其是大规模用在企业端时，首当其冲的可能是会面临访问核心资产数据，以及隐私和安全审计问题。</p>
<p>怎么样能够让这样的 Agent 可以被安全地运行？它访问数据是否有权限？能不能被审计？这些都是关键命题。</p>
<p>**以往很多流程设计更多是针对常规系统和人类操作场景设计的，很少有为 Agent 设计的，这是很关键的基础设施的缺漏。**这样的安全基础设施建立起来之后，才可能会为 Agent 大规模落地铺好前提。</p>
<p>面向 Agent 的设计，很可能是权限体系的重新设计和重塑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1bbc086ccb6437fa355c9978b810f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=6cT8uGoodjlSQLJamAy%2F8LvsaVo%3D" alt="" loading="lazy"/></p>
<p><strong>杜知恒</strong>：</p>
<p>我也说一个非常现实的问题，我们看 Agent，特别是 ToC 的 Agent 最大的挑战就是成本和 ROI 的问题。</p>
<p>因为即使当下的 Agent 可以帮你完成一些任务，但其实它完成任务所付出的代价和用户愿意付的成本还是有一个很明显的差距，目前市场上绝大多数的 Agent 都是以负毛利在运营，这在长期看来是一个很大的挑战，因为你很难在一个负毛利商业模式下做大规模的用户渗透。</p>
<p>除非像蚂蚁、字节这样的巨头，可以为获取客户长期承担非常大规模的亏损，这个对于大部分的 Agent 创业者来说可能也是一个挑战。所以核心问题就是怎么能把商业模式跑通，能够把用掉的 Token 和工具的钱赚回来？</p>
<p>对于一个基础设施提供方来说，对客户健康度的判断很重要，如果我的客户都很赚钱，那我大概率收取的价格是比较合理且可持续的，如果所有人都在亏钱，或者说大家都是期待下一轮的融资再来付今天用的基础设施的钱，（那么整个生态的健康度就会存疑），对于我们来说也非常关心这个问题。</p>
<p><strong>量子位</strong>：</p>
<p>有关产品线的 ROI，也想再问一下徐总，您刚刚提到咱们有做一些面向大众普惠型的产品，像刚刚提到收费方面的问题，会不会从您的角度来看，为了让大众使用 AI Agent 的产品，除了技术上要达成一些目标，是不是还有其他的要素也需要注意的？</p>
<p><strong>徐达峰</strong>：</p>
<p>说一点个人的粗浅判断。</p>
<p>首先，使用门槛在产品设计上必须足够低，不能预设用户具备专业知识背景，更不能假定他们本身就懂代码。现实中，这样的前提不太可能成立。</p>
<p>其次，更高频的使用场景，可能集中在文案、PPT 等内容创作上，其本质是信息的聚合、创作过程的协助，以及后续内容排版等工作。这类场景天然更适合大众用户。</p>
<p>此外，还会出现许多新的特色玩法。比如蚂蚁最近发布的 “灵光” 产品，就是一款很有意思的 App，用户可以用它制作小游戏、小应用，实用性很强。大致会是这类产品设计方向。</p>
<h4 data-id="heading-5">Agent 的下一步关键演进方向是什么？</h4>
<p><strong>量子位</strong>：</p>
<p>众所周知，2025 年已被视为 AI Agent 的元年。那么，元年之后下一个关键的演进方向是什么？刚才赵总提到了 “双端” 和“多模态”，我们想请各位具体展望一下，对于 Agent 而言，下一步的关键方向是什么？</p>
<p><strong>赵天成</strong>：</p>
<p>虽然 2025 年被称为 “智能体元年”，但可能现实生活中还没有那么多智能体。<strong>今年更像是 iPhone 1 的阶段，距离真正成熟、普及的 iPhone 4，还有很多要做的事情</strong>。</p>
<p>就我个人在 C 端的使用体验而言，日常可能会用一个类似豆包的智能体，来替代部分搜索类工作，我觉得已经达到了 “可用” 的水平。但如果是下一轮融资的 PPT，让智能体来完成，即便是现在最好的智能体也做不到，这仍然需要我自己完成大量策略层面的思考，才能有比较好的结果。</p>
<p>所以在我看来，即使是目前定义已经相当成熟的智能体，在可靠性和实际效果上，依然有大量提升空间。</p>
<p>这种提升可能来自基础模型能力的增强，也可能来自工程化能力的改进，也可能正如前面几位所提到的，是多个层面的共同进步。</p>
<p>只有这些条件都到位，智能体才能真正把哪怕是 “做 PPT” 这样看似简单的功能，提升到一个全民都能够使用的水平——这是第一个方面。</p>
<p>第二个方面，是我们自己正在做的事情。我们一直相信，如果未来的 AI 只停留在替代一部分数字化工作，那一定是不够的。它最终必须能够替代部分蓝领工作，走向现实世界，帮我们在物理世界干活。</p>
<p>（而要实现这一点），需要解决的问题依然非常多，包括前面多位老师提到的 VLA、世界模型等，这些很可能都是不可或缺的组成部分，只有在它们被有效拼合之后，智能体才有可能真正走向物理世界。</p>
<p>在这里有两个关键问题。第一，未来是否会一直是 “大语言模型 + 其他模型” 的组合形式？短期来看大概率如此，但从长期看并不一定——完全有可能被一种全新的架构彻底取代，这并非不可能。其实早两年我们看待大语言模型时，也曾觉得这条路径不太可能，但现在它已经成为主流。</p>
<p>第二，还是可靠性的问题。（当智能体进入物理世界），可靠性就变得更加严肃，不能说一下子把桌子砸了，那会是灾难性的后果——在电脑里最多是误删文件，虽然也很严重，但相比之下还是要轻一些。</p>
<p>因此我认为，<strong>可靠性是所有智能体真正成为 “每个人每天都在使用” 的工具之前，必须解决的核心问题之一</strong>。</p>
<p><strong>杜知恒</strong>：</p>
<p>我可能更多是从商业视角来看这个问题。对于 2026 年，我有几个基本预期。</p>
<p><strong>第一会是巨头的大规模下场</strong>。</p>
<p>无论是在 B 端还是 C 端，都会出现真正意义上的重投入，去争夺 DAU、ARR 和核心客户。2025 年我们已经看到，超大规模投入主要来自字节的豆包，BAT 其他几家以及蚂蚁更多是在下半年才逐渐发力。</p>
<p>我认为到明年，这一趋势会变得非常清晰且激烈——所有 Tier 1、Tier 2 的传统大型互联网公司，都会在 Agent 方向上加大投入，围绕 “入口” 展开竞争。</p>
<p>第二个预期也由此引出：在这种大规模投入的推动下，<strong>AI 的整体渗透率会显著提升</strong>。</p>
<p>包括现场各位的手机和电脑，其 AI 含量也都会大幅上升。头部 Agent 会开始真正进入二线、三线城市，被非专业用户广泛使用，甚至包括我们父母这一代人，也会逐步开始接受和使用。</p>
<p>因此，在我看来，Agent 的大规模渗透将是 2026 年我比较期待的事情。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59bc58cf760a48308c6d273dc743013a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=9ROruT724lkIc7YmK0KfRo5d8IU%3D" alt="" loading="lazy"/></p>
<p><strong>徐达峰</strong>：</p>
<p>如果说未来一年的 Agent 的话，我可能会分几个层次看。</p>
<p><strong>第一层次是数据和算法，再上层是模型能力</strong>，可以看到，这两层的技术能力呈现慢慢收敛的趋势。<strong>第三层是 Agent 的框架，以及和系统交互和集成</strong>，无论是 C 端还是 B 端，都可以看到有更多的数据管控、权限管控、接入集成等多方面的实践。</p>
<p>另外再往上延伸至产品侧与行业应用层面。目前可以看到越来越明显的趋势。</p>
<p>除了能解决一些日常小工具类的任务，或者一些小型的效率场景，也可以看到有一些 Killer App（现象级应用）出现。这类应用往往会锚定泛娱乐赛道，给用户提供很多情绪价值，甚至慢慢 App 扩展到智能硬件上，这些是能看到的趋势。</p>
<p>当然，也期待 2026 年这样的趋势逐步爆发，可以给大家带来更多的 AI Agent 在各行业，各领域的体验。</p>
<h4 data-id="heading-6">AI Agent 进入新发展阶段的标志节点</h4>
<p><strong>量子位</strong>：</p>
<p>最后一个问题，再替公众朋友们试图向三位嘉宾询问一下不确定中的确定性。</p>
<p>像刚刚提到，不管是从技术需要的基础设施，还是未来的产品形态，其实都有可能还有很多新的内容出现。</p>
<p>如果从三位嘉宾的角度来看，有没有哪个节点是你们觉得如果看到了就意味着 AI Agent 已经进入新的发展阶段了，不是像现在这样只是从无到有，而是真正彻底改写，而且普惠大众的，有没有哪个标志性的节点是各位现在最期待的？</p>
<p><strong>杜知恒</strong>：</p>
<p>可能是我妈妈开始用 Manus 开始画 PPT 或者做一个什么事情的时候开始。</p>
<p>我觉得当前 Agent 的渗透率虽然看起来如火如荼，但是在三、四线城市和人们日常生活中还是一个超级低的状态。</p>
<p>可能我自己的观察指标是身边的年长，或者非技术行业的人真正开始在用一些 Agent，改变他的生活方式，或者提升他的生活体验。</p>
<p><strong>赵天成</strong>：</p>
<p>我觉得就是当你每天最高频使用的三个 APP 里面有两个是 Agent，到那天可能就差不多了。</p>
<p><strong>徐达峰</strong>：</p>
<p>我比较赞同赵天成老师的看法，如果你每天用的软件都已经是 Agent，那就已经产生质变了。</p>
<p><strong>量子位</strong>：</p>
<p>确实，今年我们看到很多 Agent 产品出现，无论是现场和线上的观众可以多去尝试尝试不断出现的新的 Agent 产品，看这些产品能不能带来一些新的收获和新的价值。</p>
<p>再次感谢三位嘉宾今天来到圆桌，跟我们从一线视角聊一聊 AI Agent 还需要进步的地方，以及现在明确能够带给我们的价值，谢谢大家。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Starrocks + Hive 】BitMap + 物化视图 实战记录]]></title>    <link>https://juejin.cn/post/7584659460245880851</link>    <guid>https://juejin.cn/post/7584659460245880851</guid>    <pubDate>2025-12-17T10:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584659460245880851" data-draft-id="7584443518036951103" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Starrocks + Hive 】BitMap + 物化视图 实战记录"/> <meta itemprop="keywords" content="大数据"/> <meta itemprop="datePublished" content="2025-12-17T10:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小C806"/> <meta itemprop="url" content="https://juejin.cn/user/2596377122057817"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Starrocks + Hive 】BitMap + 物化视图 实战记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2596377122057817/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小C806
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:17:50.000Z" title="Wed Dec 17 2025 10:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">BitMap 简单介绍</h2>
<p>高效的数据结构（bit数组），使用二进制位（0或1）来简洁地表示信息，适用于处理海量数据（大规模整数）的去重、查询和统计。</p>
<p><em><strong>更优的Bitmap - RoaringBitmap</strong></em></p>
<p>将32位整数分成高16位(计算桶的索引位置)和低16位（实际存放数据的桶），使用桶来存储。Container有三种类型：ArrayContainer、BitmapContainer和RunContainer</p>
<p><strong>使用要求:</strong></p>
<p>字段为 int 类型:
连续性越好，性能越高</p>
<p><strong>示例:</strong></p>
<p>单位关系: (1byte = 8bit) 1 int = 4byte</p>
<p>bitmap 实际空间: 99999999 / 8 / 1024 /1024 = 11.92 M</p>
<p>RoaringBitmap 实际空间:  2<em>2 + 2</em>2 = 8 byte
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceb44d4f833c449e8b2f182827474c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=%2FrXfWGvXNdc%2Bw8oWewChOL3lOJQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-1">在Hive 和 Starrocks 联合使用</h2>
<p><em><strong>使用场景:</strong></em></p>
<p>大量数据精确去重场景: 热门网站 pv pu , 用户画像圈人等场景</p>
<ul>
<li>bitmap 索引加速(starrocks 使用较多)</li>
<li>hive 中使用（包括spark）</li>
<li>hive中原生不支持 bitmap，一般需要自己构建UDF将数据转成bitmap格式，然后存储为 binary 类型。</li>
</ul>
<h2 data-id="heading-2">UDF 构建</h2>
<p>在新版本的starrocks中，有官方提高的 <strong>hive-udf.jar</strong> 包可以支持 hive bitmap的使用;</p>
<p>jar 包地址</p>
<blockquote>
<p>fe/hive-udf/hive-udf-1.0.0.jar</p>
</blockquote>
<p><strong>使用场景</strong></p>
<ul>
<li>原始数据量大，需要导入 starrocks 构建bitmap类型字段，直接导入会导致 SR 集群<strong>负载高</strong>，希望在 hive 中构建完成再导入。</li>
<li>导出 starrocks 中的 bitmap 至 hive，提供其他场景使用</li>
</ul>
<p><strong>支持的 hive bitmap udf 函数:</strong></p>
<p>具体参考: <code>https://docs.starrocks.io/zh/docs/3.5/sql-reference/sql-functions/hive_bitmap_udf/#%E6%94%AF%E6%8C%81%E7%94%9F%E6%88%90%E7%9A%84-hive-bitmap-udf-%E5%87%BD%E6%95%B0</code></p>
<p><strong>常用以下：</strong></p>
<ul>
<li>bitmapAgg ：将数据列转成 bitmap 类型，性能好</li>
<li>bitmapcount：统计bitmap中的数据值</li>
<li>bitmapunion: 求一组bitmap的并集一般联合 bitmapcount 使用, 效果类时 count distinct</li>
</ul>
<p><em><strong>使用前提(对象列必须为 整数类型):</strong></em></p>
<p>非整数字符串数据需要构建<strong>全局字典表</strong>进行映射</p>
<p><strong>构建方式:</strong></p>
<ol>
<li>hive 中处理</li>
</ol>
<pre><code class="hljs language-sql" lang="sql">

<span class="hljs-comment">-- 字典表</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> prd_tmp.dict_test (id string,load_date string, id_int <span class="hljs-type">bigint</span>) <span class="hljs-keyword">using</span> orc;
 
<span class="hljs-comment">-- 数据写入 or 更新</span>
<span class="hljs-keyword">with</span>
  max_id_int <span class="hljs-keyword">as</span> (
  <span class="hljs-keyword">select</span> ifnull(<span class="hljs-built_in">max</span>(id_int),<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> max_id_int <span class="hljs-keyword">from</span> prd_tmp.dict_test
  )
  ,
  new_data <span class="hljs-keyword">as</span> (
<span class="hljs-keyword">select</span>
  sale_ordr_doc
  ,date_format(<span class="hljs-built_in">CURRENT_TIMESTAMP</span>(),<span class="hljs-string">'yyyyMMdd'</span>) load_date
  ,(<span class="hljs-built_in">row_number</span>() <span class="hljs-keyword">over</span>(<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> sale_ordr_doc )) <span class="hljs-operator">+</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> max_id_int) id_int
  <span class="hljs-keyword">from</span> prd_dwd.ordr_detl  t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2 <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span> t2.id <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">and</span> t1.stat_date <span class="hljs-operator">=</span> <span class="hljs-string">'20251213'</span>
  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sale_ordr_doc limit <span class="hljs-number">100</span>
)
 
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> prd_tmp.dict_test
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> new_data


</code></pre>
<p><strong>效果如下:</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62be12a251bc42afaedf15c5040a3f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=oW1FmFwOFDgmDLlAIL7uQMEbHSA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol start="2">
<li>Starrocks 中处理</li>
</ol>
<p>Starrocks 3.0 + 版本支持，<strong>auto_increment</strong> 可简化全局字典构建流程</p>
<p>详情：<code>https://docs.starrocks.io/zh/docs/sql-reference/sql-statements/table_bucket_part_index/auto_increment/</code></p>
<p>使用注意事项：<code>https://docs.starrocks.io/zh/docs/sql-reference/sql-statements/table_bucket_part_index/auto_increment/#%E5%8D%95%E8%B0%83%E6%80%A7%E4%BF%9D%E8%AF%81</code></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 构建带自增的主键表，主键为需要替换的ID</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> test_tbl1
(
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    number <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT
)
<span class="hljs-keyword">PRIMARY</span> KEY (id)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(id)
PROPERTIES("replicated_storage" <span class="hljs-operator">=</span> "true");
</code></pre>
<h2 data-id="heading-3">hive 中使用bitmap UDF查询</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 将 hive-udf.jar 上传至hdfs目录, 这里假如上传至 /tmp 目录</span>
<span class="hljs-comment">-- 2. 链接hive或者spark</span>
 
<span class="hljs-comment">-- 3. 注册jar</span>
<span class="hljs-keyword">add</span> jar hdfs:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>hive<span class="hljs-operator">-</span>udf.jar;
 
<span class="hljs-comment">-- 4. 创建函数</span>
<span class="hljs-keyword">create</span> temporary <span class="hljs-keyword">function</span> bitmap_count <span class="hljs-keyword">as</span> <span class="hljs-string">'com.starrocks.hive.udf.UDFBitmapCount'</span>;
<span class="hljs-keyword">create</span> temporary <span class="hljs-keyword">function</span> bitmap_agg <span class="hljs-keyword">as</span> <span class="hljs-string">'com.starrocks.hive.udf.UDAFBitmapAgg'</span>;
 
<span class="hljs-comment">-- 5. bitmap 函数去重查询</span>
<span class="hljs-keyword">select</span> bitmap_count(bitmap_agg(id_int)) <span class="hljs-keyword">from</span>
  (<span class="hljs-keyword">select</span>
  t1.sale_ordr_doc,
  t2.id_int
  <span class="hljs-keyword">from</span>
  ordr_detl t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2 <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span> t1.dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'20250710'</span> <span class="hljs-keyword">and</span> t1.dt<span class="hljs-operator">&lt;=</span><span class="hljs-string">'20251210'</span> ) a ;
 
 
<span class="hljs-comment">-- 6. 不使用bitmap 函数去重查询 (也可以不关联 prd_tmp.dict_test ，直接count原表的 id，这里为了验证 id_int 的数据量是否准确，所以保持一致 )</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> id_int) <span class="hljs-keyword">from</span>
  (<span class="hljs-keyword">select</span>
  t1.sale_ordr_doc,
  t2.id_int
  <span class="hljs-keyword">from</span>
  ordr_detl t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2 <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span>  t1.stat_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'20250710'</span> <span class="hljs-keyword">and</span> t1.stat_date<span class="hljs-operator">&lt;=</span><span class="hljs-string">'20251210'</span> ) a ;
</code></pre>
<p>两者执行DAG和耗时如下: 左边为不使用 bitmap，右边为使用 bitmap, 耗时方面有所提升 （<em><code>为什么: 因为 【bitmap_agg(id_int)】过程为将查询的 int_id 构建为bitmap , 也存在性能损耗</code></em>）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7df0c8c8c0fe4fff89b75c0216a4f0c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=t8e1OciF%2BVLIUGktSiHeAqCm5NI%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b206071a6804ea8a53388653487c932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=CoW8NUaAHIBGlGjkdQru7CVSqwU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>对比下来，速度有一定提升，主要差别体现在执行计划上, 使用bitmap是，少了一段 shuffle 过程, 在数据的交换上也比count distinct 上小一个量级，<strong>在资源上有一定的节省</strong>。</p>
<h2 data-id="heading-4">Starrocks 中使用</h2>
<p>方式 ：</p>
<ul>
<li>在hive中根据使用场景构建完bitmap后导入starrocks</li>
<li>直接在starrocks中使用明细数据在物化视图中使用</li>
</ul>
<p>两者根据场景选择，第一种适用于查询场景固定且数据量巨大，可以降低starrocks的集群负载，</p>
<p>第二种属于直接在starrocks中进行计算构建，集群负载比第一种场景要高。</p>
<p><em><strong>hive中构建导入</strong></em></p>
<p>某个商品的订单数:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 构建 hive bitmap 表</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> prd_tmp.bitmap_goods_ordr_test(
goods_code <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>),
bitmap_col <span class="hljs-type">binary</span>) <span class="hljs-keyword">using</span> orc;
 
<span class="hljs-comment">-- 数据写入</span>
 
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> prd_tmp.bitmap_goods_ordr_test
<span class="hljs-keyword">select</span>
  t1.goods_code
  ,bitmap_agg(t2.id_int) <span class="hljs-keyword">as</span> bitmap_col
  <span class="hljs-keyword">from</span>
  ordr_detl t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2
  <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span>  t2.id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">and</span> t1.stat_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'20250710'</span> <span class="hljs-keyword">and</span> t1.stat_date<span class="hljs-operator">&lt;=</span><span class="hljs-string">'20251210'</span>
  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> t1.goods_code
 
<span class="hljs-comment">-- sr 建表</span>
 <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> bitmap_goods_ordr_test(
goods_code <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>), bitmap_col bitmap bitmap_union)
aggregate key(goods_code) 
distributed <span class="hljs-keyword">by</span> hash(goods_code);
 
<span class="hljs-comment">-- 数据写入 方式有很多种这里使用 broker load</span>
LOAD LABEL rpt_db.bitmap_goods_ordr_test_1
(
    data infile("hdfs://xxxx:8020/warehouse/tablespace/managed/hive/prd_tmp.db/bitmap_goods_ordr_test/*")
    <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> bitmap_goods_ordr_test
    format <span class="hljs-keyword">as</span> "orc"
)
<span class="hljs-keyword">WITH</span> BROKER
(
    "username" <span class="hljs-operator">=</span> "hdfs"
)
 
<span class="hljs-comment">-- starrocks 数据查询</span>
<span class="hljs-comment">-- bitmap_to_string(bitmap_col) 将 bitmap 转成字符串</span>
<span class="hljs-comment">-- bitmap_count 计算bitmap中的id个数</span>
 
<span class="hljs-keyword">select</span>  goods_code,bitmap_to_string(bitmap_col) <span class="hljs-keyword">as</span> c2,bitmap_count(bitmap_col) <span class="hljs-keyword">as</span> cnt 
<span class="hljs-keyword">from</span> bitmap_goods_ordr_test <span class="hljs-keyword">where</span> goods_code <span class="hljs-keyword">in</span> (<span class="hljs-string">'1000310'</span>,<span class="hljs-string">'1000324'</span>,<span class="hljs-string">'1000330'</span>);
</code></pre>
<p>c2 为转换后的 int 类型的订单ID
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4e56cbb620544dea29806ffaddc9773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=XsjPhZywdh3CtW3WJJVdoJjl6F8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>Starrocks 中使用构建使用</strong></p>
<ul>
<li>创建明细表</li>
<li>创建字典表</li>
<li>替换或者关联字典表使用</li>
<li>使用 dit_mapping 函数， <code>版本 3.x 之后且不支持存算分离部署方式</code>
结合物化视图</li>
</ul>
<pre><code class="hljs language-sql" lang="sql">
```<span class="hljs-keyword">sql</span>
<span class="hljs-comment">-- 创建明细表</span>
 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> ordr_detl (
store_code string,
goods_code string,
sale_ordr_doc string ,
int_sale_ordr_doc <span class="hljs-type">bigint</span> ,
dt <span class="hljs-type">date</span>
)
ENGINE<span class="hljs-operator">=</span>OLAP
DUPLICATE KEY(store_code,goods_code,sale_ordr_doc,dt)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span>(`dt`)()
 DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(`store_code`) BUCKETS <span class="hljs-number">10</span>
PROPERTIES (
 "replication_num" <span class="hljs-operator">=</span> "3",
 "dynamic_partition.enable" <span class="hljs-operator">=</span> "true",
 "dynamic_partition.time_unit" <span class="hljs-operator">=</span> "DAY",
 "dynamic_partition.time_zone" <span class="hljs-operator">=</span> "Asia/Shanghai",
 "dynamic_partition.start" <span class="hljs-operator">=</span> "-180",
 "dynamic_partition.end" <span class="hljs-operator">=</span> "1",
 "dynamic_partition.prefix" <span class="hljs-operator">=</span> "p",
 "dynamic_partition.replication_num" <span class="hljs-operator">=</span> "3",
 "dynamic_partition.buckets" <span class="hljs-operator">=</span> "3",
 "in_memory" <span class="hljs-operator">=</span> "false"
);
 
<span class="hljs-comment">-- 示例查询</span>
<span class="hljs-keyword">select</span> stsc_mon , phmc_code , <span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> sale_ordr_doc)
<span class="hljs-keyword">from</span> ordr_detl <span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-07-01'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>  phmc_code,stsc_mon;
 
 
<span class="hljs-keyword">select</span> stsc_mon , phmc_code , bitmap_count(bitmap_union(to_bitmap(int_sale_ordr_doc)))
<span class="hljs-keyword">from</span> ordr_detl <span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-07-01'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>  phmc_code,stsc_mon;
</code></pre>
<p>耗时对比: 上述为 bitmap ， 下述为 count distinct <code>修正这里的耗时仅作为参考，bitmap_union(to_bitmap(int_sale_ordr_doc) ) 代表需要从整数构建成bitmap类型的过程，当基数较大时耗费的时间和CPU会很长，从而导致耗时比distinct更长，所以一般将该部分放在物化视图中进行构建，查询时之间使用</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d4a8f55f8554f40a263df5b61401971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=J133DJaFEw5o8ajBidC4nNPN49A%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在查询资源消耗上 bitmap 有很大的节省. [图片太大无法上传]</p>
<p><strong>使用场景分析</strong></p>
<ul>
<li>需要实时分析的场景+数据量较大的count去重分析+查询灵活多变：一般建议使用明细模型+物化视图+bitmap进行处理 灵活处理。</li>
<li>固定场景+离线分析：可以使用hive进行离线计算后导入使用，及预计算。</li>
</ul>
<h2 data-id="heading-5">物化视图</h2>
<p>分为<strong>同步物化视图</strong>和<strong>异步物化视图</strong></p>
<ul>
<li>同步物化视图
<ul>
<li>仅支持单表</li>
<li>同步刷新，无需人工操作</li>
<li>仅支持基于 default catalog 的单表构建</li>
<li>支持的聚合函数: min, max, hll_union, percentile_union, count, sum, bitmap_union</li>
</ul>
</li>
<li>异步物化视图
<ul>
<li>支持多表关联</li>
<li>异步更新，手动刷新</li>
<li>支持多表构建：Default catalog、external catalog (v2.5)、已有异步物化视图(v2.5)、已有视图（v3.1）</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 定义查询场景</span>
<span class="hljs-keyword">select</span> dt,phmc_code,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> int_sale_ordr_doc) ordr_cnt
<span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code ;
 
<span class="hljs-comment">-- 构建物化视图</span>
<span class="hljs-keyword">CREATE</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> store_ordr_cnt <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">select</span> dt,phmc_code,bitmap_union(to_bitmap(int_sale_ordr_doc))  ordr_cnt
<span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code ;
 
<span class="hljs-comment">-- 查看物化视图构建状态</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">ALTER</span> MATERIALIZED <span class="hljs-keyword">VIEW</span>
 
<span class="hljs-comment">-- 取消正在构建的物化视图 12090 为 job ID 使用 【SHOW ALTER MATERIALIZED VIEW】 获取</span>
CANCEL <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">ROLLUP</span> <span class="hljs-keyword">FROM</span>  ordr_detl  (<span class="hljs-number">12090</span>);
 
<span class="hljs-comment">-- 删除构建完成的物化视图</span>
 
<span class="hljs-keyword">DROP</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> store_amt;
</code></pre>
<p>构建状态：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80c8c4088bb54a7d962e96eded56f496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=nfrYfgmxuojhpvrS4bdXvCdHjIs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>之前的查询计划：【使用原表作为查询底表】
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9cbc3694ea64e4e8852b866bf4f3636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=8mEt4Y%2B%2Feiwiw0Unjnj%2FjgYE2nM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>构建完成后再次执行查看执行计划:【<strong>使用物化视图作为底表查询</strong>】</p>
<p>备注 在执行sql  SR 会根据已有的物化视图自动改写查询，如果匹配中有可用的物化视图则会</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> dt,phmc_code,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> int_sale_ordr_doc) ordr_cnt
<span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code ;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab46e2ee209451b85f79621c1340838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=5wv1c74GYbwNBw3FAaJvwLvRxVM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>查看表结构会发现多出一个物化视图相关的信息：【DESC ordr_detl_flag ALL】
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ce84d0c0263487395a25d0c920f0a7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=BR%2FtzB5xkBY3kK2zrVSGYoVs2sU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-6">异步物化视图</h2>
<ul>
<li>多表关联</li>
<li>手动调用、定时任务、或者自动触发刷新</li>
<li>支持部分分区刷新</li>
<li>支持更多的聚合算子</li>
</ul>
<p><strong>使用场景</strong>：</p>
<p><strong>数仓环境</strong>:</p>
<ul>
<li>加速重复聚合查询：大量可重复使用的子查询，占用大量资源</li>
<li>周期性多表关联查询：多表关联形成宽表，可以避免手动关联调度任务，设置定期刷新规则</li>
<li>数仓分层</li>
<li>湖仓加速：查询数据湖可能因为网络延迟或者对象存储吞吐限制变慢，构建物化视图固化</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询示例 </span>
<span class="hljs-keyword">select</span> dt,phmc_code,ordr_sour_code ,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> sale_ordr_doc) ordr_cnt <span class="hljs-keyword">from</span> dwb_sd_so_ordr_detl_flag_d
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code,ordr_sour_code
 
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(`order_id`)
<span class="hljs-keyword">CREATE</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> order_mv
REFRESH ASYNC <span class="hljs-keyword">START</span>(<span class="hljs-string">'2022-09-01 10:00:00'</span>) <span class="hljs-keyword">EVERY</span> (<span class="hljs-type">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>)
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">select</span> dt,phmc_code,ordr_sour_code ,bitmap_union(to_bitmap(int_sale_ordr_doc)) ordr_cnt <span class="hljs-keyword">from</span> dwb_sd_so_ordr_detl_flag_d
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code,ordr_sour_code
</code></pre>
<p>查看异步视图执行状态：</p>
<p>查看 tasks 表中的最新任务 <code>select * from information_schema.tasks order by CREATE_TIME desc limit 1;</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33d7b2eebe39434b9907dca519791830~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=z70UpOTl85vdvyQzd6D1uAzNHUQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>查看 在 task_runs 表中的执行状态 <code>select * from information_schema.task_runs where task_name='mv-10647552' order by CREATE_TIME;</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d08f439409ba4ef988b9eb756075e906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=H5skegcsILu%2FmbhGxzBhQFewKTQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>手动刷新异步视图 <code>REFRESH MATERIALIZED VIEW order_mv;</code></p>
<p><strong>实际使用:</strong></p>
<p>基于 异步视图 order_mv 测试</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询语句在 ordr_mv 的子集中 SR 自动改写使用了 物化视图</span>
 
<span class="hljs-keyword">select</span> phmc_code,ordr_sour_code,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> int_sale_ordr_doc) ordr_cnt <span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-10-01'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> phmc_code,ordr_sour_code
</code></pre>
<p>explain 如下:  count distinct 也转成了 bitmap 操作</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aef22c5941b44227b51e7555c3a0faf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=SjzwexWnZSdUiV%2FxAY9PqjjQO%2B8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>可以将物化视图看成一张物理表，索引、分区、分桶等优化操作都可执行，具体参考官网 ： <code>https://docs.starrocks.io/zh/docs/3.5/sql-reference/sql-statements/materialized_view/CREATE_MATERIALIZED_VIEW/</code></strong></p>
<h2 data-id="heading-7">性能虽好合理使用：</h2>
<p><strong>优点：</strong></p>
<ul>
<li>提升响应速度，优化查询性能</li>
<li>优化任务分层逻辑</li>
</ul>
<p><strong>不足：</strong></p>
<ul>
<li>人工配置，维护成本高</li>
<li>异步视图，定时刷新，难以保证数据的强一致性</li>
<li>过多的物化视图导致集群压力过大，维护困难</li>
<li>物化视图空间换时间，存储成本增加</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Google全链路赋能出海：3人团队调度千个智能体，可成独角兽｜MEET2026]]></title>    <link>https://juejin.cn/post/7584639987212845090</link>    <guid>https://juejin.cn/post/7584639987212845090</guid>    <pubDate>2025-12-17T10:20:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584639987212845090" data-draft-id="7584633505105362996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Google全链路赋能出海：3人团队调度千个智能体，可成独角兽｜MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-17T10:20:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Google全链路赋能出海：3人团队调度千个智能体，可成独角兽｜MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:20:41.000Z" title="Wed Dec 17 2025 10:20:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>未来应该是智能体之间自主协同，解决复杂问题、自动化工作流程、自主下达任务，创建一种全新的商业模式。</p>
</blockquote>
<p>在量子位 MEET2026 智能未来大会上 Google Cloud 大中华区企业与中国初创业务负责人 Dennis Yue 分享了一个与技术本身同样重要的命题：AI 智能体作为新的生产力单元，正在为初创企业的出海逻辑注入新的内涵。</p>
<p>这不仅是对技术趋势的判断，也是对创业范式转移的思考。当 3 到 10 人的团队可以调度成百上千个智能体，当智能体与智能体之间能够跨企业自主通信，创业公司的边界、人效比、商业模式都将被重新定义。</p>
<p>在 Dennis 看来，<strong>智能体赛道才刚刚开始，未来一两年会经历剧烈变化，这也是中国初创企业出海的重大机遇窗口</strong>。</p>
<p>面对这一机遇与挑战，谷歌推出了 AI 驱动的一体化解决方案，全链路赋能初创企业高效出海。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3245d5434cce433ea8a0d74b5fa84630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571640&amp;x-signature=n0fQ5B9z0CjNXxX82g3JmW8hKrw%3D" alt="" loading="lazy"/></p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点</h2>
<ul>
<li>
<p>初创企业在全球化过程中面临不同侧重点与挑战，Google 的全链路生态在每一阶段都可以为初创企业助力，赋能高效出海。</p>
</li>
<li>
<p>Gemini 3 是一次真正的突破，在多个权威榜单中排名第一，标志着从 “辅助工具” 向“自主智能体”的跨越。</p>
</li>
<li>
<p>谷歌主导推出了 A2A 协议（Agent-to-Agent Protocol，智能体间通信协议），旨在打通跨企业、跨系统的智能体协同。</p>
</li>
<li>
<p>商业模式正在从 SaaS 按月订阅转向 Outcome-based 按结果付费，这是智能体时代的底层逻辑变化。</p>
</li>
<li>
<p>3 到 10 人的初创团队完全可能通过调度大量智能体成长为独角兽，但需要重视数据壁垒、行业深度集成以及法律合规。</p>
</li>
</ul>
<h2 data-id="heading-1">初创出海的五个阶段与 Google 全链路解决方案</h2>
<p>在演讲开篇，Dennis 系统梳理了初创企业出海的五个阶段，以及谷歌在每个阶段能够提供的支持。</p>
<p>第一阶段是萌芽与战略规划期。 创始人刚刚有了初步想法，需要进行大量信息收集和竞品分析。Dennis 观察到，很多创始人会使用 Gemini 进行市场调研，因为它储存了海量资料，能够辅助完成从市场洞察到 MVP（最小可行产品）的整个流程。</p>
<p>第二阶段是产品推出期。 当第一个产品成型并准备推向市场时，Google Cloud 平台可以提供稳定的云基础设施支撑。</p>
<p>第三阶段是首个市场验证期。 找到第一批客户是从 0 到 1 破局的关键，此时 Google Ads 团队可以帮助初创公司，通过高效的广告渠道触达目标客户群体。</p>
<p>第四阶段是多市场扩张期。 当第一个市场站稳脚跟、准备拓展第二个市场时，Google Play、Google AdMob/AdSense、Google Maps 等产品都可以提供协同支持。</p>
<p>第五阶段是 IPO 成熟期。 公司进入持续迭代和规模化增长阶段，谷歌的数据分析工具和周边服务可以助力企业完成上市前的最后冲刺。</p>
<p>Dennis 还谈到了大模型领域的共同难题：幻觉（Hallucination，即模型生成不准确或虚构的信息）。</p>
<p>解决路径包括更好的模型训练、更好的工程化实践、以及引导客户侧进行更好的上下文工程。配合 Gemini 本身强大的原生推理能力，幻觉问题正在逐步得到缓解。</p>
<p>Dennis 认为，未来一年整个 AI 领域会继续快速演进。对于初创公司而言，无论产品是刚刚起步还是已经上路，都应该认真思考如何将智能体协同、上下文工程、按结果付费等新概念融入自身业务。 </p>
<p>“我认为 AI 智能体才刚刚开始，未来一两年变化会非常大。如果通过智能体这个赛道出海，现在是值得认真考虑的时机。”</p>
<p>Google 全链路生态，高效驱动出海创业增长，欢迎扫描文末二维码，了解更多 Google 出海解决方案。</p>
<h2 data-id="heading-2">Gemini 的进化：从初具雏形到全面领先</h2>
<p>谈及对中国出海初创企业的赋能，Dennis 回顾了 Gemini 的成长历程。</p>
<p>两年多前，谷歌将 Google Brain 与 DeepMind 两大 AI 团队合并，在极短时间内推出了 Gemini 1。</p>
<p>Gemini 1 作为第一个原生多模态模型，已经开始帮助一批初创公司开展业务。</p>
<p>到了 1.5 和 2 版本，Gemini 经历了质的提升，推理能力、理解能力和问题解决能力都有了显著增强。<strong>而 2025 年 11 月发布的 Gemini 3，则全面超越了前两代产品</strong>。这一版本基于此前迭代积累的经验进行了重构，在多个权威评测榜单中拿下第一名，引发了行业媒体的广泛报道。</p>
<p>为什么 Gemini 3 是一次突破？Dennis 认为，这几年 AI 发展出了两条路径：一条是智能体（Agent），另一条是代理式 AI（Agentic AI）。他在与初创公司的交流中发现，已经有团队成功地将智能体产品化，转化为真实的 ARR（年度经常性收入）和 ACV（年度合同价值）。</p>
<p><strong>智能体不再是概念，而是具备真实变现能力的应用。</strong></p>
<h2 data-id="heading-3">A2A 协议：打通智能体之间的 “语言”</h2>
<p>当单个企业内部的智能体逐渐成熟，一个更棘手的问题浮出水面：不同企业的智能体之间如何有效通信？</p>
<p>企业内部的智能体相对容易连接，通过编写提示词（Prompt）或配置工作流就能实现协同。<strong>但当一个企业的智能体需要与另一个企业的智能体对话时，就缺乏统一的标准和协议。</strong></p>
<p>为此，谷歌主导推出了 A2A 协议（Agent-to-Agent Protocol）。这一协议的核心目标是让智能体之间能够自主协同、自主下达任务、自主执行工作流程。</p>
<p>可以想象这样一幅图景：每一个节点代表企业内部不同部门的智能体，或者代表不同企业的智能体，甚至是企业外部的第三方智能体。如果为每个智能体定义好功能层面的 API（应用程序接口），这些 API 就可以被复用，智能体之间就能跨界协同。在特定场景或问题面前，它们可以自主请求其他智能体提供方案，再通过 AI 算法做出最优选择。</p>
<p><strong>A2A 协议不是谷歌的独角戏。</strong> 埃森哲、Salesforce、麦肯锡等全球顶级咨询公司，SAP 等传统 ERP 厂商，以及众多知名科技公司都已开始拥抱这一协议。谷歌正在推动将 A2A 全球化，让智能体之间的通信基于统一标准进行。</p>
<p>除了通信协议，商业世界还需要解决信任和支付问题。为此，谷歌又提出了 AP2 协议（Agent Payment Protocol，智能体支付协议）。这一协议已获得传统金融机构和新兴金融科技公司的广泛支持，目标是让智能体之间的交易不被锁定在某个单一支付系统中，而是基于多方共识形成高信任度的支付网络。</p>
<h2 data-id="heading-4">商业模式之变：从 SaaS 订阅到按结果付费</h2>
<p>Dennis 在与大量创业者交流后观察到，智能体时代正在催生商业模式的根本性变化。</p>
<p>**旧生态的典型形态是 SaaS（软件即服务）：**B2B 公司以按月订阅的方式，帮助企业解决特定功能需求。这更像是一个助手模式，帮你写邮件、帮你安排会议，按时间收费。</p>
<p>**新生态的核心逻辑是 Outcome-based（按结果付费）：**智能体不仅帮你写邮件，还帮你成功约到客户、安排好视频会议。你为最终结果付费，而不是为过程中的动作付费。这种模式已经开始在市场上出现，甚至逐渐成为竞争中的差异化卖点。</p>
<p>这种转变带来了一个令人振奋的可能性：**3 到 10 人的初创公司可以成长为独角兽。**因为在智能体时代，每个员工都可以调度十个、一百个、甚至一千个智能体。繁重的执行工作由智能体完成，人类专注于战略决策和系统优化。</p>
<p>但 Dennis 也提醒，新模式下的护城河正在发生变化。以往，漂亮的 UI（用户界面）和良好的用户体验是竞争壁垒；现在，<strong>真正的护城河来自与传统行业的深度集成，以及独有的专有数据。</strong></p>
<p>同时，智能体自主决策也带来了新的风险：如果智能体犯错，赔偿责任如何界定？不同国家对此有不同的法律规定。这是初创公司在出海时必须认真考量的问题。</p>
<h2 data-id="heading-5">Gemini 3 的三大能力与工程化思维</h2>
<p>在技术层面，Dennis 介绍了 Gemini 3 的几个关键能力。</p>
<p><strong>第一是超长上下文窗口，支持 100 万 Token。</strong></p>
<p>过去大家关注的是 Prompt Engineering（提示词工程），现在更重要的是 Context Engineering（上下文工程）。如果丢给智能体的信息未经整理和结构化处理，即便模型再强大，输出的结果也不会足够智能。</p>
<p><strong>第二是原生多模态能力。</strong></p>
<p>Gemini 3 可以像理解文字一样理解视频、图像和语音，且清晰度和准确度大幅提升。</p>
<p><strong>第三是 Function Calling（精准工具调用）能力。</strong></p>
<p>这让智能体开始 “长出手脚”，能够调用外部工具和服务。配合 Vertex AI、Agent Builder 等工程化平台，开发者可以构建更加智能、更加专业化的智能体。</p>
<p>Dennis 特别强调，Gemini 3 是我们迄今为止最安全的模型，并且接受了 Google AI 模型中最全面的一套安全评估。</p>
<p>对 Google 全链路出海解决方案感兴趣的中国出海初创企业可以扫码进一步了解。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[改了CSS刷新没反应-你可能不懂HTTP缓存]]></title>    <link>https://juejin.cn/post/7584650421124333609</link>    <guid>https://juejin.cn/post/7584650421124333609</guid>    <pubDate>2025-12-17T10:24:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124333609" data-draft-id="7584443518037033023" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="改了CSS刷新没反应-你可能不懂HTTP缓存"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-17T10:24:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            改了CSS刷新没反应-你可能不懂HTTP缓存
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:24:20.000Z" title="Wed Dec 17 2025 10:24:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">改了 CSS 刷新没反应？你可能不懂 HTTP 缓存</h2>
<p>做前端的应该都遇到过这种情况：明明改了 CSS，浏览器里看到的还是旧样式。网上搜一下，告诉你"清缓存"，Ctrl+F5 一刷新就好了。</p>
<p>但问题是：</p>
<ul>
<li>缓存到底是怎么工作的？</li>
<li>为什么有时候会用缓存，有时候不会？</li>
<li>Network 面板里的 <code>(disk cache)</code> 和 <code>304 Not Modified</code> 有什么区别？</li>
</ul>
<p>今天把这个问题彻底搞清楚。</p>
<h3 data-id="heading-1">HTTP 缓存的两层机制</h3>
<p>浏览器缓存分两层：<strong>强缓存</strong>和<strong>协商缓存</strong>。</p>
<p>简单说：</p>
<ul>
<li><strong>强缓存</strong>：直接用本地缓存，不问服务器</li>
<li><strong>协商缓存</strong>：问一下服务器"我这个还能用吗？"服务器说"能"，就用缓存</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">浏览器想请求资源
    │
    ▼
检查本地缓存
    │
    ├── 有缓存且没过期 → 强缓存命中 → 返回 <span class="hljs-number">200</span> (<span class="hljs-keyword">from</span> cache)
    │
    └── 没缓存 / 过期了
            │
            ▼
        发请求给服务器，带上验证信息
            │
            ├── 服务器说没变 → 协商缓存命中 → 返回 <span class="hljs-number">304</span>
            │
            └── 服务器说变了 → 返回 <span class="hljs-number">200</span> + 新资源
</code></pre>
<h3 data-id="heading-2">强缓存：完全不发请求</h3>
<p>强缓存命中时，浏览器直接从本地拿资源，Network 面板会显示：</p>
<ul>
<li><strong>Size</strong> 列：<code>(disk cache)</code> 或 <code>(memory cache)</code></li>
<li><strong>Time</strong> 列：<code>0ms</code> 或很小的数字</li>
</ul>
<p>控制强缓存的响应头：</p>
<pre><code class="hljs language-http" lang="http"># 方式1：Cache-Control（推荐）
Cache-Control: max-age=31536000

# 方式2：Expires（老方式，优先级低于 Cache-Control）
Expires: Wed, 21 Oct 2025 07:28:00 GMT
</code></pre>
<p><code>max-age=31536000</code> 意思是"这个资源 31536000 秒（一年）内有效"。</p>
<h4 data-id="heading-3">memory cache vs disk cache</h4>
<p>两者区别：</p>























<table><thead><tr><th>类型</th><th>存储位置</th><th>速度</th><th>什么时候用</th></tr></thead><tbody><tr><td>memory cache</td><td>内存</td><td>最快</td><td>当前会话、小文件、频繁访问的资源</td></tr><tr><td>disk cache</td><td>硬盘</td><td>稍慢</td><td>跨会话、大文件</td></tr></tbody></table>
<p>关了浏览器 Tab，memory cache 就没了，disk cache 还在。</p>
<h3 data-id="heading-4">协商缓存：问一下服务器</h3>
<p>当强缓存过期（或被设置为 <code>no-cache</code>），浏览器会发请求给服务器验证资源是否变化。</p>
<p>有两种验证方式：</p>
<h4 data-id="heading-5">方式1：ETag / If-None-Match（推荐）</h4>
<p>基于内容哈希：</p>
<pre><code class="hljs language-http" lang="http"># 第一次请求，服务器返回
HTTP/1.1 200 OK
ETag: "abc123"
Cache-Control: no-cache

# 后续请求，浏览器带上 If-None-Match
GET /style.css HTTP/1.1
If-None-Match: "abc123"

# 如果内容没变，服务器返回
HTTP/1.1 304 Not Modified
ETag: "abc123"

# 如果内容变了，服务器返回
HTTP/1.1 200 OK
ETag: "xyz789"
[新的文件内容]
</code></pre>
<h4 data-id="heading-6">方式2：Last-Modified / If-Modified-Since</h4>
<p>基于修改时间：</p>
<pre><code class="hljs language-http" lang="http"># 第一次请求，服务器返回
HTTP/1.1 200 OK
Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT

# 后续请求，浏览器带上 If-Modified-Since
GET /style.css HTTP/1.1
If-Modified-Since: Wed, 21 Oct 2024 07:28:00 GMT

# 如果文件没改过，服务器返回 304
</code></pre>
<h4 data-id="heading-7">ETag vs Last-Modified</h4>
<p>优先用 ETag，因为 Last-Modified 有问题：</p>
<ol>
<li><strong>精度只到秒</strong> - 1 秒内改多次，检测不到</li>
<li><strong>时间可能不准</strong> - 服务器时间、部署时间等问题</li>
<li><strong>只看时间不看内容</strong> - 文件内容没变但时间变了，也会重新下载</li>
</ol>
<h3 data-id="heading-8">不同资源该用什么策略？</h3>
<h4 data-id="heading-9">静态资源（JS/CSS/图片）</h4>
<pre><code class="hljs language-http" lang="http">Cache-Control: max-age=31536000, immutable
</code></pre>
<p>配合文件名哈希：<code>app.abc123.js</code></p>
<p>内容变了 → 文件名变了 → 请求新文件，老文件继续用缓存。</p>
<p>这是现代前端打包工具（Webpack、Vite）的标准做法。</p>
<h4 data-id="heading-10">HTML 文件</h4>
<pre><code class="hljs language-http" lang="http">Cache-Control: no-cache
ETag: "page-v1"
</code></pre>
<p><code>no-cache</code> 不是"不缓存"，而是"每次都要验证"。HTML 文件要保证用户能拿到最新版本，否则会引用旧的 JS/CSS 文件名。</p>
<h4 data-id="heading-11">API 接口</h4>
<p>根据数据特性选择：</p>
<pre><code class="hljs language-http" lang="http"># 几乎不变的数据（如配置）
Cache-Control: max-age=3600

# 实时性要求高的数据
Cache-Control: no-cache

# 敏感数据（不要缓存）
Cache-Control: no-store
</code></pre>
<p><code>no-store</code> 才是真正的"不缓存"，连验证都不做。</p>
<h3 data-id="heading-12">常见问题排查</h3>
<h4 data-id="heading-13">改了文件，浏览器没反应</h4>
<p>原因：强缓存还没过期。</p>
<p>解决方案：</p>
<ol>
<li><strong>开发环境</strong> - 打开 DevTools，勾选 "Disable cache"</li>
<li><strong>生产环境</strong> - 用文件名哈希，别用 <code>?v=1.0</code> 这种</li>
</ol>
<h4 data-id="heading-14">用了 ?v=1.0 还是不行</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/css/style.css?v=1.0"</span>&gt;</span>
</code></pre>
<p>问题：有些 CDN 会忽略查询参数，或者浏览器缓存策略不一致。</p>
<p>正确做法：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/css/style.abc123.css"</span>&gt;</span>
</code></pre>
<p>让打包工具自动生成哈希，内容变了文件名才变。</p>
<h4 data-id="heading-15">CDN 缓存了旧文件</h4>
<p>部署了新版本，但用户还是拿到旧文件。</p>
<p>原因：CDN 节点还在缓存期内。</p>
<p>解决方案：</p>
<ol>
<li>部署时清除 CDN 缓存</li>
<li>用文件名哈希（CDN 会认为是新文件）</li>
</ol>
<h3 data-id="heading-16">Nginx 配置参考</h3>
<pre><code class="hljs language-nginx" lang="nginx"># 静态资源长期缓存
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# HTML 文件协商缓存
location ~* \.html$ {
    add_header Cache-Control "no-cache";
    etag on;
}

# API 不缓存
location /api/ {
    add_header Cache-Control "no-store";
}
</code></pre>
<h3 data-id="heading-17">快速判断缓存类型</h3>
<p>打开 DevTools Network 面板：</p>






























<table><thead><tr><th>看到什么</th><th>缓存类型</th><th>含义</th></tr></thead><tbody><tr><td>200 + <code>(disk cache)</code></td><td>强缓存</td><td>从硬盘读取</td></tr><tr><td>200 + <code>(memory cache)</code></td><td>强缓存</td><td>从内存读取</td></tr><tr><td>304 Not Modified</td><td>协商缓存</td><td>服务器说没变</td></tr><tr><td>200 + 正常大小</td><td>无缓存</td><td>重新下载</td></tr></tbody></table>
<h3 data-id="heading-18">一句话总结</h3>
<ul>
<li><strong>强缓存</strong>：不问服务器，直接用。适合长期不变的静态资源。</li>
<li><strong>协商缓存</strong>：问服务器，没变就用缓存。适合需要保持最新的内容。</li>
<li><strong>文件名哈希</strong>：解决缓存更新问题的银弹。</li>
</ul>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快速构建企业 AI 开放平台，HiMarket 重磅升级]]></title>    <link>https://juejin.cn/post/7584659460245930003</link>    <guid>https://juejin.cn/post/7584659460245930003</guid>    <pubDate>2025-12-17T10:26:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584659460245930003" data-draft-id="7584443518163615780" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快速构建企业 AI 开放平台，HiMarket 重磅升级"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-12-17T10:26:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快速构建企业 AI 开放平台，HiMarket 重磅升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:26:26.000Z" title="Wed Dec 17 2025 10:26:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文作者：赵恒、岛风、文想、彦林、于怀2025 是 Agent 元年，企业开始大规模落地 Agent，都会遇到多 Agent 管理，多 MCP 工具管理，多模型管理问题，如何查找和选择合适的 Agent/MCP/Model？哪些高频场景可以快速让所有人参与？多个团队如何协同，权限如何管理，成本如何分摊？</p>
<p>为了解决这些挑战，阿里巴巴升级 AI 开放平台 HiMarket，基于阿里巴巴内部 IdeaLAB，扩展 AI 开放平台的能力，推出 v0.5.0 版本，<strong>提供 Agent/MCP/Model 市场能力，提供基于 Chat 的高频使用场景，提供账号权限管理和成本分摊能力。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e4cc6dcce1d44e98ccea2903f4ae066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=YnmhmYVYmj3CQjedUd2ghxprgKk%3D" alt="BB584FD1-A8C3-4F31-8338-910BA4BB8499.png" loading="lazy"/></p>
<h2 data-id="heading-0">HiMarket 是什么</h2>
<p>HiMarket 是开源的 AI 开放平台，帮助企业快速构建 Agent 市场，释放 AI 创新潜能。对企业全员提供高频 AI 场景，释放 AI 创新潜能；为开发者提供 Agent 市场/MCP 市场/Model 市场，提升研发效能；为维护者提供 AI 治理能力，提升 AI 把控力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c71ab916fc4141f993a7cc3153e7abe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=rrV0ugC%2BY0pL4JiE53I7VPQ05nI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">使用场景</h2>
<h3 data-id="heading-2">AI 场景（面对企业员工）</h3>
<p>HiMarket 提供了 HiChat 能力，通过 Chat 模式替代搜索，做市场调研和产品调研，生成运营图片等工作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5d77eb3517f49b08e35f2601e412d05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=T1UXNe2dc45bRyjV8XeQl2TbJkw%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>企业全员 AI 使用入口</strong>：通过 HiMarket AI 开放平台，同时解决了员工不知道用哪些模型，企业如何管控员工用模型的两个问题；全员可以通过这个入口进行使用 AI 模型能力，企业可以进行整体安全合规审核，保证企业和员工使用 AI 范围安全可控。</li>
<li><strong>多模型对比</strong>：可以选择多个模型市场的模型，输入一次对比多个模型，快速直接对比模型返回内容差异，选取最优内容。</li>
<li><strong>会话历史记录</strong>：方便员工管理历史会话记录，可以快速基于历史信息进行对话回溯，并且计划后续基于对话可以形成知识点，知识点可以进行横向传递，提升数据共享效率。</li>
<li><strong>联网搜索</strong>：通过体验中心可以支持配置联网搜索能力，配置 Higress AI 网关联网搜索能力之后，所有模型都可以支持联网搜索，AI 网关会把对应搜索内容传递给模型使用摘取，扩大实时数据能力。</li>
<li><strong>支持关联 MCP 工具</strong>：体验中心聊天框支持关联 MCP 市场，可以实时快速的使用 MCP 能力，可以快速体验验证 MCP 本身能力情况，并且支持企业原本 API 快速配置化转换成 MCP 协议，结合模型做快速验证。</li>
</ul>
<h3 data-id="heading-3">AI 市场（面对开发者）</h3>
<p>HiMarket 支持构建涵盖 Agent、MCP Server、Model 的完整 AI 市场，让企业的各类 AI 资源不再分散，而是以标准化方式汇聚在一个平台上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5b53549f1f54eda87997e9280a31483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=ARsw05IOiqCHoLgl5JdSfii%2F0yg%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>Agent 市场</strong>：支持将复杂的 AI Agent 应用打包上架，可对接 AgentScope 等 Agent 开发平台，例如通过 AgentScope 构建的 Agent 可一键注册到 HiMarket，其他开发者订阅后即可直接使用，无需从零搭建；支持跨框架、跨语言的 agent 一键发布到 Agent 市场。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4207d39a8b064864aee33fecfa09bc01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=VBf8dWb0FNEsacYKcRWCLnAzIss%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>MCP 市场</strong>：支持接入不同平台的 MCP Server，并支持将外部 API 转换为标准化的 MCP Server，开发者订阅后，即可让 AI 应用轻松调用外部能力。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc913cb2745434e8ee8b3c925978091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=FwANgRUj77A0%2FMihW%2FsW4dmuOD4%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>模型市场</strong>：支持公有云模型及企业自研私有模型的快速接入，平台以 Higress 作为模型服务的网关代理，提供内容安全、Token 限流等防护能力，保障模型服务对外开放的安全合规。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d9888e1541243b7838c754a4edeb0ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=gc9jrg9vzRuEXk1zBm%2FAOwPff9E%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>AI 资产生命周期管理</strong>：管理员将资源接入平台，配置访问策略和使用文档，发布上架；开发者在门户浏览、订阅、获取调用凭证即可订阅使用。</li>
</ul>
<h3 data-id="heading-4">AI 治理（面对 AI 维护者）</h3>
<p>HiMarket 实现了对 AI 资源的集中式治理，提供全方位的安全管控和协作能力：</p>
<ul>
<li><strong>安全合规保障</strong>：通过 Higress 网关统一管控所有 AI 资源的访问，支持内容安全检测、敏感信息过滤、访问权限控制，确保企业 AI 能力对外开放时符合安全合规要求。</li>
<li><strong>高效协作共享</strong>：打破团队间的“能力孤岛”，一个模型或工具接入后，可被多个部门订阅复用，避免重复采购和重复开发。</li>
<li><strong>降低使用门槛</strong>：开发者无需逐一对接不同厂商的 API，HiMarket 提供统一的协议标准和开箱即用的调用凭证，大幅降低接入成本，让团队更专注于业务创新而非基础设施搭建。</li>
</ul>
<h2 data-id="heading-5">产品优势</h2>
<h3 data-id="heading-6">企业级能力</h3>
<p>HiMarket 内置完善的企业级管理能力，确保 AI 资源的安全开放与高效运营。</p>
<ul>
<li><strong>产品管理</strong>：管理员可为不同 API 产品配置独立的认证鉴权和可见性策略，同时提供流量控制、IP 白名单等防护能力，保障服务安全稳定。</li>
<li><strong>观测分析</strong>：提供管理员视角的全局观测大盘，展示 AI API 的调用趋势、热门产品排行、异常流量预警等，支持按时间、产品类型、开发者等维度进行多维分析，为企业运营优化提供数据依据。</li>
<li><strong>计量计费</strong>：支持基于 Token、调用次数等多种计量模式，自动统计资源消耗并生成账单明细，既能服务企业内部的成本核算，也能支撑对外商业化运营。</li>
<li><strong>版本管理</strong>：支持 API 产品的多版本并行，管理员可以发布新版本、维护旧版本并平滑迁移用户，通过版本对比、灰度发布、快速回滚等功能，确保产品迭代的安全稳定。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2d59b45cba94fd2910f81d2fa8c24a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=2x9bm4MpE2iLfGSr4IwAjrv16ic%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">丰富观测能力</h3>
<p>观测分析（目前 v0.5.0 版本依赖阿里云商业化 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsls%3Fspm%3Da1z389.11499242.0.0.65452413PLWe13%26utm_content%3Dg_1000408139" target="_blank" title="https://www.aliyun.com/product/sls?spm=a1z389.11499242.0.0.65452413PLWe13&amp;utm_content=g_1000408139" ref="nofollow noopener noreferrer">SLS</a>，开源版本的观测分析实现计划在后续版本中提供）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/518f976e75e04e21a4678c55609f05d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=z72oV2gq5252xG7MbIbGsBuoFjg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">灵活扩展能力</h3>
<p>为了能够快速对接企业现有的系统，HiMarket 提供了灵活的定制能力，包括：</p>
<ul>
<li><strong>门户品牌</strong>：管理员可为门户配置自定义域名、Logo、主题色、布局样式等元素，并灵活配置首页模块、产品分类、推荐栏等功能区域。</li>
<li><strong>身份认证</strong>：支持内置账号密码和企业 OIDC 认证方式，可与企业 SSO、IDaaS 等身份系统无缝集成，实现统一的用户管理和身份认证。</li>
<li><strong>审批流程</strong>：开发者注册、凭证申请、API 订阅等关键流程可灵活配置自动或人工审批。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/752c1b918c074137993e97043f8d5e89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=ddBJO9VG5%2F7jt70v%2BlVhT1Ee47Y%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">快速体验</h2>
<p>HiMarket 提供多种部署方式，满足不同场景需求：</p>
<ul>
<li>本地快速体验：HiMarket 本地部署指南 <strong>[</strong> <strong>1]</strong> 。</li>
<li>Docker Compose 部署：HiMarket Docker 部署指南 <strong>[</strong> <strong>2]</strong> 。</li>
<li>Kubernetes 部署：HiMarket Helm 部署指南 <strong>[</strong> <strong>3]</strong> 。</li>
</ul>
<h3 data-id="heading-10">一键部署，开箱即用的完整方案</h3>
<p>HiMarket、Higress、Nacos 三大组件自动编排部署，无需人工干预。部署过程自动完成示例 MCP Server 的注册、配置和发布，让你在部署完成后即可体验 HiMarket 能力市场。无论是 Docker Compose 还是 Kubernetes 部署，均只需一条命令：</p>
<pre><code class="hljs language-bash" lang="bash">./deploy.sh install
</code></pre>
<p>部署脚本会自动完成以下所有工作：</p>
<ul>
<li><strong>核心组件部署</strong>：自动拉起 MySQL、Nacos 配置中心、Higress 网关服务</li>
<li><strong>应用本体部署</strong>：部署 HiMarket 全套服务（管理后台、开发者门户、后端服务）</li>
<li><strong>智能初始化</strong>：自动创建管理员账号、配置示例 MCP Server、发布演示 API 产品</li>
<li><strong>即开即用</strong>：部署完成后即可访问管理后台和开发者门户，无需任何手动配置</li>
</ul>
<p>方案支持灵活的场景适配：</p>
<ul>
<li>支持使用内置 MySQL 或对接已有数据库</li>
<li>支持使用阿里云商业化 MSE 服务和 AI 网关服务</li>
<li>支持 ./deploy.sh himarket-only<code> </code>仅部署 HiMarket 本体</li>
</ul>
<p>详细步骤请参考：HiMarket Docker 一键部署指南 <strong>[</strong> <strong>4]</strong> ，HiMarket Helm 一键部署指南 <strong>[</strong> <strong>5]</strong> 。</p>
<h2 data-id="heading-11">HiMarket Roadmap 规划</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41ef995213464ff4bd5b237faf2b6176~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=9V3OWgQipWNfEeJaPdTulSW9aVc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">欢迎共建</h2>
<p>HiMarket 是多个开源社区共同发起的开源项目，核心参与者包括阿里云、蚂蚁数科、高德、淘天等团队，面向开源可以助力企业快速构建 AI 开放平台，提供开箱即用的能力。</p>
<p>特别感谢淘天 IdeaLAB 团队为 HiMarket 提供的基础，期待更多企业一起参与共建～</p>
<p>HiMarket 仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2FHiMarket" target="_blank" title="https://github.com/higress-group/HiMarket" ref="nofollow noopener noreferrer">github.com/higress-gro…</a><br/>
基于 HiMarket 实现的 MCP 金融级市场：<a href="https://link.juejin.cn?target=https%3A%2F%2Fantdigital.com%2Fproducts%2FMCP" target="_blank" title="https://antdigital.com/products/MCP" ref="nofollow noopener noreferrer">antdigital.com/products/MC…</a></p>
<p>HiMarket 钉钉社区群（2 群）：163370001036</p>
<p>入群链接（复制到浏览器打开）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fqr.dingtalk.com%2Faction%2Fjoingroup%3Fcode%3Dv1%2Ck1%2Cd%2BMJWsDVtfHq6XanvQEUxsVX3vVL1m%2B7DWfkoUkYxVM%3D%26_dt_no_comment%3D1%26origin%3D11" target="_blank" title="https://qr.dingtalk.com/action/joingroup?code=v1,k1,d+MJWsDVtfHq6XanvQEUxsVX3vVL1m+7DWfkoUkYxVM=&amp;_dt_no_comment=1&amp;origin=11" ref="nofollow noopener noreferrer">qr.dingtalk.com/action/join…</a></p>
<p><strong>推荐文章：</strong></p>
<p>《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU4NzU0MDIzOQ%3D%3D%26mid%3D2247520193%26idx%3D1%26sn%3Dcb69fc4c4e061fc0065e1f245f55bbed%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247520193&amp;idx=1&amp;sn=cb69fc4c4e061fc0065e1f245f55bbed&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AgentScope Java v1.0 发布，让 Java 开发者轻松构建企业级 Agentic 应用</a>》</p>
<p><strong>相关链接：</strong></p>
<p>[1] HiMarket 本地部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2FREADME.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/README.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[2] HiMarket Docker 部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fdocker%2FDocker%25E9%2583%25A8%25E7%25BD%25B2%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/docker/Docker%E9%83%A8%E7%BD%B2%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[3] HiMarket Helm 部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fhelm%2FHelm%25E9%2583%25A8%25E7%25BD%25B2%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/helm/Helm%E9%83%A8%E7%BD%B2%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[4] HiMarket Docker 一键部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fdocker%2FDocker%25E9%2583%25A8%25E7%25BD%25B2%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/docker/Docker%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[5] HiMarket Helm 一键部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fhelm%2FHelm%25E9%2583%25A8%25E7%25BD%25B2%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/helm/Helm%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 DataWorks 中一键部署大模型，即刻用于数据集成和数据开发]]></title>    <link>https://juejin.cn/post/7584633505105444916</link>    <guid>https://juejin.cn/post/7584633505105444916</guid>    <pubDate>2025-12-17T10:43:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105444916" data-draft-id="7584633505105412148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 DataWorks 中一键部署大模型，即刻用于数据集成和数据开发"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-17T10:43:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 DataWorks 中一键部署大模型，即刻用于数据集成和数据开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:43:08.000Z" title="Wed Dec 17 2025 10:43:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 AI 应用快速落地的今天，越来越多企业希望将大模型能力融入数据处理流程——无论是文本分析、智能摘要，还是 RAG 知识库构建。但传统模式下，模型部署依赖专业 MLOps 团队，需自行搭建推理环境、配置 GPU 资源、维护服务稳定性，门槛高、周期长、成本重。</p>
<p>现在，阿里云 <strong>DataWorks 发布大模型服务能力</strong>，基于 <strong>Serverless 资源组</strong>，支持用户 <strong>一键部署主流大模型</strong>，并可在 <strong>数据集成和数据开发任务中直接调用模型 API</strong>，实现“部署—集成—使用”全流程闭环，真正让数据工程师也能轻松玩转大模型！</p>
<p><img src="https://static001.geekbang.org/infoq/b7/b7d9d38118d77f6bef7b12ee83eb1538.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">三步完成模型部署，零代码上手</h2>
<p>通过 DataWorks 大模型服务管理功能，您只需三个步骤即可完成模型上线：</p>
<ol>
<li>
<p><strong>选择模型</strong> 支持通义千问 Qwen3 系列、DeepSeek 系列等多种主流模型，涵盖生成、推理、向量化等场景。</p>
</li>
<li>
<p><strong>一键部署</strong> 在控制台点击“部署”，选择目标 <strong>Serverless 资源组</strong> 和 GPU 规格（如 vGPU-1/4、vGPU-1），系统自动完成镜像拉取、服务启动与健康检查。</p>
</li>
<li>
<p><strong>获取调用地址</strong> 部署成功后，自动生成标准 OpenAPI 接口地址和鉴权 Token，可用于后续任务调用。</p>
</li>
</ol>
<p><img src="https://static001.geekbang.org/infoq/21/21954c17748c0bb90aa8d7c75f4b83cc.png" alt="" loading="lazy"/></p>
<p><em>大模型部署页面</em></p>
<p>整个过程 <strong>无需关注底层资源调度、容器编排或网络配置</strong>，真正做到“点一下，就可用”，大幅降低大模型落地门槛。</p>
<h2 data-id="heading-1">核心优势</h2>
<p><img src="https://static001.geekbang.org/infoq/35/350b5a1610e02f6f1128735628ec6693.png" alt="" loading="lazy"/></p>
<p>得益于底层资源优化与轻量化推理引擎，对于参数规模较小的模型（如 Qwen-Turbo、Embedding 模型），在 Serverless 资源组上的 <strong>平均推理延迟显著降低，性能提升近 10 倍</strong>，特别适合高频、低延迟的在线推理场景。</p>
<h2 data-id="heading-2">一键开启数据集成与开发的大模型应用</h2>
<p>目前支持在数据集成、数据开发中调用大模型，实现对数据的智能处理。</p>
<h3 data-id="heading-3">数据集成中调用</h3>
<p>在单表离线同步任务中，可使用大模型服务对同步中的数据进行<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Foffline-synchronization-task-ai-auxiliary-processing" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/offline-synchronization-task-ai-auxiliary-processing" ref="nofollow noopener noreferrer">AI辅助处理</a>。</p>
<p><img src="https://static001.geekbang.org/infoq/5d/5d0552e369f5436e0d3caa4e5f1fcb17.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">数据开发中调用</h3>
<h4 data-id="heading-5">方式1、大模型节点调用大语言模型</h4>
<p>DataWorks 新版数据开发 Data Studio 提供专属的大模型节点，支持通过可视化配置方式直接调用已部署的生成类或向量类大模型。用户无需编写代码，只需选择目标模型、输入提示词（Prompt）并设置参数，即可完成文本生成、摘要提取或文本向量化等任务，适用于快速验证模型效果和构建轻量级 AI 流程。</p>
<p><img src="https://static001.geekbang.org/infoq/27/27b9ee04aa350f0795e8a1dc60799f69.gif" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">方式2、Shell 节点调用大语言模型</h4>
<p>用户可在 Shell 节点中通过 curl 命令调用大模型服务 API，实现对生成模型或向量模型的灵活调用。例如，发送自然语言请求获取模型回复，或将文本传入 Embedding 模型生成向量。该方式适合熟悉命令行操作的开发者，结合调度配置可实现自动化任务执行。</p>
<h4 data-id="heading-7">方式3、Python节点调用大语言模型</h4>
<p>通过 Python 节点，用户可使用 requests 等库编写脚本，以编程方式调用大模型服务。支持流式输出处理、自定义解析逻辑和复杂业务封装，适用于写诗、报告生成、结构化输出等需要精细控制的场景。需基于自定义镜像安装必要依赖后运行，并可集成至完整数据链路中。</p>
<p>接下来举个🌰展示如何在Python节点通过调用大语言模型完成写诗指令。</p>
<ol>
<li>当前示例依赖Python的<code>requests</code>库，请参考以下主要参数，基于DataWorks官方镜像创建<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Fcustom-image" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/custom-image" ref="nofollow noopener noreferrer">自定义镜像</a>安装该依赖环境。</li>
</ol>
<p><img src="https://static001.geekbang.org/infoq/4d/4d163cb955199f76f1fdaa7ce5007cba.png" alt="" loading="lazy"/></p>
<p>2. <a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Fnode-development-of-data-studio%2F%2313d1ad442e1tc" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/node-development-of-data-studio/#13d1ad442e1tc" ref="nofollow noopener noreferrer">创建Python节点</a>，在Python节点添加如下示例代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">def</span> <span class="hljs-title function_">stream_print_response</span>():
    httpUrl = <span class="hljs-string">"http://ms-xxxx.cn-beijing.dataworks-model.aliyuncs.com"</span>
    apikey = <span class="hljs-string">"DW-ms-xxxx"</span>
    url = httpUrl + <span class="hljs-string">"/v1/completions"</span>
    headers = {
        <span class="hljs-string">"Authorization"</span>: apikey,
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    }
    data = {
        <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"请写一篇关于春天的诗"</span>,
        <span class="hljs-string">"stream"</span>: <span class="hljs-literal">True</span>,
        <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">512</span>
    }

    <span class="hljs-keyword">try</span>:
        response = requests.post(url, headers=headers, json=data, stream=<span class="hljs-literal">True</span>)
        response.raise_for_status()

        full_text = <span class="hljs-string">""</span>  <span class="hljs-comment"># 累积完整回复，防止丢失</span>
        buffer = <span class="hljs-string">""</span>     <span class="hljs-comment"># 用于处理不完整的 JSON 行（可选）</span>

        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response.iter_lines():
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:
                <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 跳过空行</span>

            line_str = line.decode(<span class="hljs-string">'utf-8'</span>).strip()
            <span class="hljs-comment"># print(f"[DEBUG] 收到行: {line_str}")  # 调试用</span>

            <span class="hljs-keyword">if</span> line_str.startswith(<span class="hljs-string">"data:"</span>):
                data_str = line_str[<span class="hljs-number">5</span>:].strip()  <span class="hljs-comment"># 去掉 "data: "</span>

                <span class="hljs-keyword">if</span> data_str == <span class="hljs-string">"[DONE]"</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[流式响应结束]"</span>)
                    <span class="hljs-keyword">break</span>

                <span class="hljs-comment"># 尝试解析 JSON</span>
                <span class="hljs-keyword">try</span>:
                    parsed = json.loads(data_str)
                    choices = parsed.get(<span class="hljs-string">"choices"</span>, [])
                    <span class="hljs-keyword">if</span> choices:
                        delta_text = choices[<span class="hljs-number">0</span>].get(<span class="hljs-string">"text"</span>, <span class="hljs-string">""</span>)
                        <span class="hljs-keyword">if</span> delta_text:
                            <span class="hljs-comment"># 累积到完整文本</span>
                            full_text += delta_text

                            <span class="hljs-comment"># 逐字打印新增的字符</span>
                            <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> delta_text:
                                <span class="hljs-built_in">print</span>(char, end=<span class="hljs-string">''</span>, flush=<span class="hljs-literal">True</span>)
                                sys.stdout.flush()
                                time.sleep(<span class="hljs-number">0.03</span>)  <span class="hljs-comment"># 打字机效果</span>

                <span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
                    <span class="hljs-comment"># print(f"[警告] JSON 解析失败: {e}, 原文: {data_str}")</span>
                    <span class="hljs-keyword">continue</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n\n[完整回复长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(full_text)}</span> 字]"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ 完整内容]:\n<span class="hljs-subst">{full_text}</span>"</span>)

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f" 请求失败: <span class="hljs-subst">{e}</span>"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f" 其他错误: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    stream_print_response()
</code></pre>
<p><strong>说明</strong>：请将代码中以<code>http</code>开头的大模型服务调用地址和以<code>DW</code>开头的Token信息替换为您的实际值。</p>
<p>3. 编辑节点内容后，在节点编辑页面右侧的<strong>调试配置</strong>中，选择已完成网络连通配置的资源组和<code>步骤1</code>中安装了<code>requests</code>库的自定义<strong>镜像</strong>。</p>
<p>4. 单击<strong>运行</strong>节点，即可调用已部署的服务模型执行相关命令。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PF4J 日志类冲突与 JVM 类加载机制]]></title>    <link>https://juejin.cn/post/7584651851904811027</link>    <guid>https://juejin.cn/post/7584651851904811027</guid>    <pubDate>2025-12-17T10:48:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851904811027" data-draft-id="7584650421124366377" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PF4J 日志类冲突与 JVM 类加载机制"/> <meta itemprop="keywords" content="JVM,后端"/> <meta itemprop="datePublished" content="2025-12-17T10:48:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jaising666"/> <meta itemprop="url" content="https://juejin.cn/user/2418581311850301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PF4J 日志类冲突与 JVM 类加载机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2418581311850301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jaising666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:48:34.000Z" title="Wed Dec 17 2025 10:48:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文从 JVM 类加载机制出发，分析 PF4J 插件框架的类加载原理，并通过 ClickHouse 插件的实际案例解释类加载冲突的根本原因和解决方案。</p>
<h2 data-id="heading-0">JVM 类加载机制（Java 8）</h2>
<h3 data-id="heading-1">为什么需要类加载机制</h3>
<p><strong>类加载机制的核心价值</strong>：</p>
<ol>
<li><strong>动态性</strong>：Java 程序在运行时才加载需要的类，而不是启动时加载所有类</li>
<li><strong>安全性</strong>：通过类加载器验证字节码，防止恶意代码执行</li>
<li><strong>隔离性</strong>：不同类加载器提供独立的命名空间，避免类冲突</li>
<li><strong>扩展性</strong>：支持自定义类加载器，实现插件化架构</li>
</ol>
<p><strong>解决的核心问题</strong>：</p>
<ul>
<li><strong>内存优化</strong>：按需加载，减少内存占用</li>
<li><strong>版本管理</strong>：同一 JVM 中可以存在同一类的多个版本</li>
<li><strong>安全控制</strong>：限制类的加载来源和权限</li>
<li><strong>模块化</strong>：支持复杂应用的模块化部署</li>
</ul>
<h3 data-id="heading-2">类加载器层次结构</h3>
<pre><code class="hljs language-java" lang="java">Bootstrap <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(启动类加载器)</span>
    ↓
Extension <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(扩展类加载器)</span> 
    ↓
Application <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(应用类加载器)</span>
    ↓
Custom <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(自定义类加载器)</span>
</code></pre>
<h4 data-id="heading-3">1. Bootstrap ClassLoader</h4>
<ul>
<li><strong>职责</strong>：加载 JVM 核心类库（如 <code>java.lang.*</code>、<code>java.util.*</code> 等）</li>
<li><strong>实现</strong>：C++ 实现，Java 中表现为 null</li>
<li><strong>加载路径</strong>：<code>$JAVA_HOME/jre/lib/rt.jar</code> 等核心 jar 包</li>
</ul>
<h4 data-id="heading-4">2. Extension ClassLoader</h4>
<ul>
<li><strong>职责</strong>：加载 Java 扩展库</li>
<li><strong>实现</strong>：<code>sun.misc.Launcher$ExtClassLoader</code></li>
<li><strong>加载路径</strong>：<code>$JAVA_HOME/jre/lib/ext/</code> 目录下的 jar 包</li>
</ul>
<h4 data-id="heading-5">3. Application ClassLoader</h4>
<ul>
<li><strong>职责</strong>：加载应用程序类路径（classpath）下的类</li>
<li><strong>实现</strong>：<code>sun.misc.Launcher$AppClassLoader</code></li>
<li><strong>加载路径</strong>：<code>-cp</code> 参数指定的路径、当前目录下的类</li>
</ul>
<h3 data-id="heading-6">双亲委托模型</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve) <span class="hljs-keyword">throws</span> ClassNotFoundException {
    <span class="hljs-comment">// 1. 检查类是否已被加载</span>
    Class&lt;?&gt; c = findLoadedClass(name);
    <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 委托给父类加载器</span>
            <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) {
                c = parent.loadClass(name, <span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> {
                c = findBootstrapClassOrNull(name);
            }
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            <span class="hljs-comment">// 3. 父类加载器无法加载时，自己尝试加载</span>
            c = findClass(name);
        }
    }
    <span class="hljs-keyword">return</span> c;
}
</code></pre>
<p><strong>委托流程</strong>：</p>
<ol>
<li>检查类是否已加载</li>
<li>委托父类加载器加载</li>
<li>父类加载器失败时，自己加载</li>
<li>都失败则抛出 <code>ClassNotFoundException</code></li>
</ol>
<h3 data-id="heading-7">类加载器特性</h3>
<h4 data-id="heading-8">1. 唯一性</h4>
<p>同一个类加载器不会重复加载同一个类。</p>
<h4 data-id="heading-9">2. 可见性</h4>
<p>子类加载器可以看到父类加载器加载的类，反之不行。</p>
<h4 data-id="heading-10">3. 隔离性</h4>
<p>不同类加载器加载的同名类被 JVM 视为不同类型，每个类加载器都有独立的命名空间，类的完整标识是：<code>类加载器 + 类全名</code>。</p>
<h2 data-id="heading-11">PF4J 类加载架构</h2>
<h3 data-id="heading-12">类加载器扩展层次</h3>
<pre><code class="hljs language-css" lang="css">Bootstrap ClassLoader
    ↓
Extension ClassLoader  
    ↓
Application ClassLoader (主应用)
    ↓
PluginClassLoader (插件<span class="hljs-selector-tag">A</span>)    PluginClassLoader (插件<span class="hljs-selector-tag">B</span>)
    ↓                           ↓
Plugin <span class="hljs-selector-tag">A</span> Classes            Plugin <span class="hljs-selector-tag">B</span> Classes
</code></pre>
<p>PF4J 在标准 JVM 类加载器基础上，为每个插件创建独立的 <code>PluginClassLoader</code>：</p>
<ol>
<li><strong>插件隔离</strong>：每个插件拥有独立的类加载器和命名空间</li>
<li><strong>委托机制</strong>：继承双亲委托模型，优先使用主应用的类</li>
<li><strong>依赖共享</strong>：插件可访问主应用类，但插件间相互隔离</li>
</ol>
<h3 data-id="heading-13">PluginClassLoader 实现原理</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">URLClassLoader</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-comment">// 1. 检查类缓存</span>
        Class&lt;?&gt; loadedClass = findLoadedClass(name);
        <span class="hljs-keyword">if</span> (loadedClass != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> loadedClass;
        }
        
        <span class="hljs-comment">// 2. 委托给父类加载器（遵循双亲委托）</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.loadClass(name, resolve);
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            <span class="hljs-comment">// 3. 从插件jar中加载</span>
            <span class="hljs-keyword">return</span> findClass(name);
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-comment">// 从插件jar包中查找并定义类</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.findClass(name);
    }
}
</code></pre>
<p><strong>加载策略</strong>：</p>
<ol>
<li>优先使用主应用已加载的类（避免重复加载核心库）</li>
<li>主应用无法提供时，从插件 jar 中加载</li>
<li>保持插件间的类隔离</li>
</ol>
<h2 data-id="heading-14">类加载冲突案例分析</h2>
<h3 data-id="heading-15">问题现象</h3>
<p>在 ClickHouse 插件中出现以下异常：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">java.lang.LinkageError: loader constraint violation: 
<span class="hljs-keyword">when</span> resolving method <span class="hljs-string">"org.slf4j.impl.StaticLoggerBinder.getLoggerFactory()Lorg/slf4j/ILoggerFactory;"</span> 
the <span class="hljs-keyword">class</span> <span class="hljs-title class_">loader</span> (instance of org/pf4j/PluginClassLoader) of the current <span class="hljs-keyword">class</span>, org/slf4j/LoggerFactory, 
and the <span class="hljs-keyword">class</span> <span class="hljs-title class_">loader</span> (instance of sun/misc/Launcher$AppClassLoader) <span class="hljs-keyword">for</span> the method<span class="hljs-string">'s defining class, 
org/slf4j/impl/StaticLoggerBinder, have different Class objects for the type org/slf4j/ILoggerFactory 
used in the signature
</span></code></pre>
<h3 data-id="heading-16">冲突原理分析</h3>
<h4 data-id="heading-17">1. 类加载器隔离导致的问题</h4>
<pre><code class="hljs language-markdown" lang="markdown">主应用 (AppClassLoader)
├── slf4j-api-1.7.30.jar
│   ├── org.slf4j.LoggerFactory
│   └── org.slf4j.ILoggerFactory
└── logback-classic-1.2.3.jar
<span class="hljs-code">    └── ch.qos.logback.classic.Logger
</span>
ClickHouse插件 (PluginClassLoader)
├── clickhouse-jdbc-0.3.2.jar
└── slf4j-api-1.7.25.jar  ← 版本冲突！
<span class="hljs-code">    ├── org.slf4j.LoggerFactory
    └── org.slf4j.ILoggerFactory
</span></code></pre>
<h4 data-id="heading-18">2. 类型不匹配分析</h4>
<p><strong>冲突场景</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ClickHouse 插件代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClickHousePlugin</span> {
    <span class="hljs-comment">// LoggerFactory 来自 PluginClassLoader (slf4j-1.7.25)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ClickHousePlugin.class);
}
</code></pre>
<p><strong>调用链分析</strong>：</p>
<ol>
<li><code>LoggerFactory.getLogger()</code> → <code>getILoggerFactory()</code></li>
<li><code>getILoggerFactory()</code> → <code>StaticLoggerBinder.getLoggerFactory()</code></li>
<li><code>StaticLoggerBinder</code> 由 AppClassLoader 加载（主应用 logback）</li>
<li>返回 AppClassLoader 中的 <code>ILoggerFactory</code> 实例</li>
<li>但调用方期望 PluginClassLoader 中的 <code>ILoggerFactory</code> 类型</li>
<li>JVM 类型检查失败 → <code>LinkageError</code></li>
</ol>
<p><strong>根本原因</strong>：同一接口的不同版本被不同类加载器加载，JVM 无法进行类型转换。</p>
<h4 data-id="heading-19">3. LinkageError 详解</h4>
<p><strong>JVM 类型约束</strong>：
JVM 要求方法签名中的所有类型必须由相同类加载器加载，或存在可见性关系。</p>
<p><strong>违反约束的调用链</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">PluginClassLoader<span class="hljs-selector-class">.LoggerFactory</span> (slf4j-<span class="hljs-number">1.7</span>.<span class="hljs-number">25</span>)
    ↓ 调用方法
AppClassLoader<span class="hljs-selector-class">.StaticLoggerBinder</span> (logback-<span class="hljs-number">1.2</span>.<span class="hljs-number">3</span>)  
    ↓ 返回类型
AppClassLoader<span class="hljs-selector-class">.ILoggerFactory</span> (slf4j-<span class="hljs-number">1.7</span>.<span class="hljs-number">30</span>)
    ↓ 类型检查
PluginClassLoader期望的ILoggerFactory (slf4j-<span class="hljs-number">1.7</span>.<span class="hljs-number">25</span>) ← 类型不匹配
</code></pre>
<p><strong>JVM 检查逻辑</strong>：</p>
<ol>
<li>方法调用时检查参数和返回值类型</li>
<li>发现 <code>ILoggerFactory</code> 存在两个不同的 Class 对象</li>
<li>无法确定类型兼容性</li>
<li>抛出 <code>LinkageError</code> 保证类型安全</li>
</ol>
<h2 data-id="heading-20">解决方案：exclude 配置</h2>
<h3 data-id="heading-21">配置方式</h3>
<p>在 ClickHouse 插件的 <code>build.gradle</code> 中添加：</p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('ru.yandex.clickhouse:clickhouse-jdbc:0.3.2') {
        exclude group: 'org.slf4j'  // 排除 SLF4J 依赖
    }
    // 其他依赖...
}
</code></pre>
<h3 data-id="heading-22">解决原理</h3>
<h4 data-id="heading-23">1. 依赖排除机制</h4>
<pre><code class="hljs language-gradle" lang="gradle">// 排除冲突依赖
exclude group: 'org.slf4j'
</code></pre>
<p><strong>依赖树变化</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">修改前：
ClickHouse 插件 (PluginClassLoader)
├── clickhouse-jdbc-<span class="hljs-number">0.3</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.jar</span>
│   └── slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-selector-class">.25</span><span class="hljs-selector-class">.jar</span>  ← 冲突源
└── 其他依赖

修改后：
ClickHouse 插件 (PluginClassLoader)  
├── clickhouse-jdbc-<span class="hljs-number">0.3</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.jar</span> (无 slf4j 依赖)
└── 其他依赖
</code></pre>
<h4 data-id="heading-24">2. 类加载委托生效</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 插件中的日志调用</span>
LoggerFactory.getLogger(ClickHousePlugin.class)
    ↓
<span class="hljs-comment">// PluginClassLoader 中无 LoggerFactory</span>
<span class="hljs-comment">// 根据双亲委托，向上查找</span>
AppClassLoader.loadClass(<span class="hljs-string">"org.slf4j.LoggerFactory"</span>)
    ↓  
<span class="hljs-comment">// 统一使用主应用的 SLF4J 实现</span>
<span class="hljs-comment">// 所有相关类都来自 AppClassLoader</span>
<span class="hljs-comment">// 类型一致，调用成功</span>
</code></pre>
<h4 data-id="heading-25">3. 统一命名空间</h4>
<pre><code class="hljs language-scss" lang="scss">解决后的类加载结构：
AppClassLoader (统一命名空间)
├── org<span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.LoggerFactory</span>
├── org<span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.ILoggerFactory</span>
├── ch<span class="hljs-selector-class">.qos</span><span class="hljs-selector-class">.logback</span><span class="hljs-selector-class">.classic</span><span class="hljs-selector-class">.StaticLoggerBinder</span>  
└── ch<span class="hljs-selector-class">.qos</span><span class="hljs-selector-class">.logback</span><span class="hljs-selector-class">.classic</span><span class="hljs-selector-class">.LoggerContext</span>

插件通过委托机制共享主应用的日志实现
</code></pre>
<h2 data-id="heading-26">最佳实践</h2>
<h3 data-id="heading-27">1. 依赖管理策略</h3>
<pre><code class="hljs language-gradle" lang="gradle">// 推荐：排除常见的日志框架
dependencies {
    implementation('third-party-library:1.0.0') {
        exclude group: 'org.slf4j'
        exclude group: 'ch.qos.logback'
        exclude group: 'log4j'
        exclude group: 'commons-logging'
    }
}
</code></pre>
<h3 data-id="heading-28">2. 类加载冲突预防规范</h3>
<h4 data-id="heading-29">依赖作用域对比</h4>













































<table><thead><tr><th>作用域</th><th>编译时</th><th>运行时</th><th>测试时</th><th>打包</th><th>说明</th></tr></thead><tbody><tr><td>implementation</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>完整依赖</td></tr><tr><td>compileOnly</td><td>✓</td><td>✗</td><td>✗</td><td>✗</td><td>编译时依赖，类似provided</td></tr><tr><td>runtimeOnly</td><td>✗</td><td>✓</td><td>✓</td><td>✓</td><td>运行时依赖</td></tr><tr><td>testImplementation</td><td>✗</td><td>✗</td><td>✓</td><td>✗</td><td>测试依赖</td></tr></tbody></table>
<h4 data-id="heading-30">最佳实践配置</h4>
<pre><code class="hljs language-gradle" lang="gradle">// 最佳实践：既支持独立调试，又避免冲突
dependencies {
    // 1. 主应用 API（编译时需要，运行时由主应用提供）
    compileOnly project(':plugin-api')
    
    // 2. 主应用基础设施（编译时需要，运行时由主应用提供）
    compileOnly 'org.slf4j:slf4j-api:1.7.30'
    compileOnly 'com.fasterxml.jackson.core:jackson-core:2.12.3'
    compileOnly 'org.apache.commons:commons-lang3:3.12.0'
    
    // 3. 插件特有依赖（会打包到插件中，需要排除冲突）
    implementation('ru.yandex.clickhouse:clickhouse-jdbc:0.3.2') {
        exclude group: 'org.slf4j'
        exclude group: 'com.fasterxml.jackson.core'
        exclude group: 'org.apache.commons'
    }
    
    // 4. 测试和调试依赖（完整依赖，支持独立运行）
    testImplementation project(':plugin-api')
    testImplementation 'org.slf4j:slf4j-api:1.7.30'
    testImplementation 'ch.qos.logback:logback-classic:1.2.3'
    testImplementation 'com.fasterxml.jackson.core:jackson-core:2.12.3'
    testImplementation 'org.apache.commons:commons-lang3:3.12.0'
}

// 插件打包（只包含 implementation 依赖）
jar {
    archiveClassifier = 'plugin'
    
    manifest {
        attributes(
            'Plugin-Class': 'com.idss.plugin.impl.ClickHousePlugin',
            'Plugin-Id': 'clickhouse-plugin',
            'Plugin-Version': version
        )
    }
}
</code></pre>
<h3 data-id="heading-31">4. JVM 类加载诊断工具</h3>
<h4 data-id="heading-32">使用 -verbose:class 参数</h4>
<p>JVM 提供了内置的类加载跟踪功能：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动应用时添加 verbose 参数</span>
java -verbose:class -jar your-application.jar

<span class="hljs-comment"># 或者更详细的类加载信息</span>
java -verbose:class -XX:+TraceClassLoading -jar your-application.jar
</code></pre>
<p><strong>输出示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">[<span class="hljs-title class_">Loaded</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">LoggerFactory</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/app/</span>lib/slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-number">.30</span>.<span class="hljs-property">jar</span>]
[<span class="hljs-title class_">Loaded</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">ILoggerFactory</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/app/</span>lib/slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-number">.30</span>.<span class="hljs-property">jar</span>]
[<span class="hljs-title class_">Loaded</span> ch.<span class="hljs-property">qos</span>.<span class="hljs-property">logback</span>.<span class="hljs-property">classic</span>.<span class="hljs-property">Logger</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/app/</span>lib/logback-classic-<span class="hljs-number">1.2</span><span class="hljs-number">.3</span>.<span class="hljs-property">jar</span>]
[<span class="hljs-title class_">Loaded</span> com.<span class="hljs-property">idss</span>.<span class="hljs-property">plugin</span>.<span class="hljs-property">impl</span>.<span class="hljs-property">ClickHousePlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/plugins/</span>clickhouse-plugin.<span class="hljs-property">jar</span>]
</code></pre>
<h4 data-id="heading-33">使用 jcmd 工具</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取进程 ID</span>
jps

<span class="hljs-comment"># 查看类加载器层次</span>
jcmd &lt;pid&gt; VM.classloader_stats

<span class="hljs-comment"># 查看已加载的类</span>
jcmd &lt;pid&gt; VM.class_hierarchy
</code></pre>
<h4 data-id="heading-34">使用 JConsole/VisualVM</h4>
<p>通过 JMX 监控类加载情况：</p>
<ul>
<li>连接到目标 JVM 进程</li>
<li>查看"类"标签页</li>
<li>监控类加载数量和卸载情况</li>
</ul>
<h2 data-id="heading-35">相同版本依赖的情况分析</h2>
<h3 data-id="heading-36">场景：插件和主应用使用相同版本 SLF4J</h3>
<p>假设主应用和 ClickHouse 插件都使用 <code>slf4j-api-1.7.30</code>：</p>
<pre><code class="hljs language-scss" lang="scss">主应用 (AppClassLoader)
├── slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-selector-class">.30</span><span class="hljs-selector-class">.jar</span>
└── logback-classic-<span class="hljs-number">1.2</span><span class="hljs-selector-class">.3</span><span class="hljs-selector-class">.jar</span>

ClickHouse 插件 (PluginClassLoader)  
├── clickhouse-jdbc-<span class="hljs-number">0.3</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.jar</span>
└── slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-selector-class">.30</span><span class="hljs-selector-class">.jar</span>  ← 相同版本
</code></pre>
<h3 data-id="heading-37">是否还会有冲突？</h3>
<p><strong>答案：仍然会有 LinkageError！</strong></p>
<p><strong>原因分析</strong>：</p>
<ol>
<li><strong>类加载器隔离依然存在</strong>：即使版本相同，PluginClassLoader 仍会加载自己的 SLF4J 类</li>
<li><strong>JVM 类型检查机制</strong>：JVM 比较的是 Class 对象的身份，而不是类的内容</li>
<li><strong>不同命名空间</strong>：两个类加载器创建了两个不同的 <code>ILoggerFactory</code> Class 对象</li>
</ol>
<p><strong>冲突流程</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 插件中的调用</span>
PluginClassLoader.LoggerFactory.getLogger()  <span class="hljs-comment">// slf4j-1.7.30 (插件版本)</span>
    ↓
AppClassLoader.StaticLoggerBinder.getLoggerFactory()  <span class="hljs-comment">// logback 实现</span>
    ↓  
返回 AppClassLoader.ILoggerFactory 实例  <span class="hljs-comment">// slf4j-1.7.30 (主应用版本)</span>
    ↓
类型检查: PluginClassLoader.ILoggerFactory != AppClassLoader.ILoggerFactory
    ↓
LinkageError: 不同 Class 对象
</code></pre>
<h3 data-id="heading-38">验证代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SameVersionConflictDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 模拟两个类加载器加载相同版本的类</span>
        URL[] urls = {<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"slf4j-api-1.7.30.jar"</span>).toURI().toURL()};
        
        <span class="hljs-comment">// 设置 parent 为 null，打破双亲委派</span>
        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">loader1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLClassLoader</span>(urls, <span class="hljs-literal">null</span>);
        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">loader2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLClassLoader</span>(urls, <span class="hljs-literal">null</span>);
        
        Class&lt;?&gt; class1 = loader1.loadClass(<span class="hljs-string">"org.slf4j.ILoggerFactory"</span>);
        Class&lt;?&gt; class2 = loader2.loadClass(<span class="hljs-string">"org.slf4j.ILoggerFactory"</span>);
        
        System.out.println(<span class="hljs-string">"相同版本，不同类加载器:"</span>);
        System.out.println(<span class="hljs-string">"Class1: "</span> + class1);
        System.out.println(<span class="hljs-string">"Class2: "</span> + class2);
        System.out.println(<span class="hljs-string">"是否相等: "</span> + (class1 == class2)); <span class="hljs-comment">// false!</span>
        System.out.println(<span class="hljs-string">"类加载器1: "</span> + class1.getClassLoader());
        System.out.println(<span class="hljs-string">"类加载器2: "</span> + class2.getClassLoader());
    }
}
</code></pre>
<p><strong>输出结果</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">相同版本，不同类加载器:
Class1: <span class="hljs-keyword">interface</span> <span class="hljs-title class_">org</span>.<span class="hljs-title">slf4j</span>.<span class="hljs-title">ILoggerFactory</span>
Class2: <span class="hljs-keyword">interface</span> <span class="hljs-title class_">org</span>.<span class="hljs-title">slf4j</span>.<span class="hljs-title">ILoggerFactory</span>
是否相等: <span class="hljs-literal">false</span>
类加载器<span class="hljs-number">1</span>: java.net.<span class="hljs-symbol">URLClassLoader@</span>232204a1
类加载器<span class="hljs-number">2</span>: java.net.<span class="hljs-symbol">URLClassLoader@</span>677327b6
</code></pre>
<h3 data-id="heading-39">关键结论</h3>
<p><strong>版本相同不等于类型相同</strong>！JVM 的类型系统基于以下规则：</p>
<pre><code class="hljs language-java" lang="java">类的完整标识 = 类加载器实例 + 类的全限定名
</code></pre>
<p>即使是完全相同的字节码，被不同类加载器加载后也是不同的类型。</p>
<h2 data-id="heading-40">其他常见冲突场景</h2>
<h3 data-id="heading-41">1. Jackson 序列化框架冲突</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('some-library:1.0.0') {
        exclude group: 'com.fasterxml.jackson.core'
        exclude group: 'com.fasterxml.jackson.databind'
    }
}
</code></pre>
<h3 data-id="heading-42">2. Apache Commons 冲突</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('some-library:1.0.0') {
        exclude group: 'commons-lang'
        exclude group: 'commons-io'
        exclude group: 'commons-collections'
    }
}
</code></pre>
<h3 data-id="heading-43">3. Spring 框架冲突</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('some-library:1.0.0') {
        exclude group: 'org.springframework'
    }
}
</code></pre>
<h2 data-id="heading-44">类加载冲突的本质</h2>
<h3 data-id="heading-45">冲突根源</h3>
<ol>
<li><strong>类加载器隔离</strong>：JVM 将不同类加载器的同名类视为不同类型（即使版本相同）</li>
<li><strong>跨类加载器调用</strong>：方法调用跨越类加载器边界时的类型不匹配</li>
<li><strong>JVM 类型安全</strong>：严格的类型检查机制防止类型混淆</li>
</ol>
<p><strong>重要认知</strong>：冲突的根本原因不是版本差异，而是类加载器隔离！</p>
<h3 data-id="heading-46">解决策略</h3>
<ol>
<li><strong>依赖排除</strong>：移除插件中的冲突依赖，统一使用主应用版本</li>
<li><strong>委托机制</strong>：利用双亲委托让插件使用主应用的类</li>
<li><strong>命名空间统一</strong>：确保相关类都在同一类加载器的命名空间中</li>
</ol>
<h2 data-id="heading-47">总结</h2>
<p><strong>JVM 类加载机制</strong>为 Java 提供了强大的模块化能力，但也带来了复杂的类型安全约束。<strong>PF4J 插件框架</strong>在此基础上实现了插件隔离，但需要 careful 处理共享依赖。</p>
<p><strong>核心原则</strong>：</p>
<ul>
<li>理解双亲委托模型的工作机制</li>
<li>识别类加载器边界和可见性规则</li>
<li>通过依赖管理避免类型冲突</li>
<li>利用委托机制实现依赖共享</li>
</ul>
<p>通过 <code>exclude</code> 配置解决 SLF4J 冲突，本质上是将插件的日志依赖委托给主应用，确保所有相关类都在 AppClassLoader 的统一命名空间中，从而避免 JVM 的类型安全检查失败。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零搭建使用 Open-AutoGML 搜索附近的美食]]></title>    <link>https://juejin.cn/post/7584650421124382761</link>    <guid>https://juejin.cn/post/7584650421124382761</guid>    <pubDate>2025-12-17T10:49:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124382761" data-draft-id="7584640225645051967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零搭建使用 Open-AutoGML 搜索附近的美食"/> <meta itemprop="keywords" content="人工智能,Android"/> <meta itemprop="datePublished" content="2025-12-17T10:49:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Exploring"/> <meta itemprop="url" content="https://juejin.cn/user/2172290705131016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零搭建使用 Open-AutoGML 搜索附近的美食
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290705131016/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Exploring
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:49:17.000Z" title="Wed Dec 17 2025 10:49:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 环境配置</h2>
<p>下载项目库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a> ，
使用 Open-AutoGML 需要安装以下开发环境：</p>
<ul>
<li>python 环境</li>
<li>ADB 调试工具</li>
<li>ADB Keyboard(用于文本输入)</li>
<li>模型部署（可以使用 BigModel 三方模型）</li>
</ul>
<h3 data-id="heading-1">1.1. Python 环境搭建</h3>
<p>检查 python 环境。建议使用 Python 3.10 及以上版本。</p>
<pre><code class="hljs">python3 -V
</code></pre>
<p>这里建议使用虚拟环境创建对应的环境。可以使用 Poetry 或 Python 自带的虚拟环境管理。这里使用 Python 自带的虚拟环境管理。</p>
<ul>
<li>创建虚拟环境：python3 -m venv 环境名</li>
<li>激活虚拟环境：source 环境名/bin/activate</li>
<li>删除旧环境：rm -rf venv</li>
<li>用python3.9创建新环境：python3.9 -m venv venv</li>
<li>退出环境：deactivate</li>
</ul>
<p>安装示例如下：</p>
<pre><code class="hljs language-sql" lang="sql">➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) python3<span class="hljs-number">.10</span> <span class="hljs-operator">-</span>m venv venv3<span class="hljs-number">.10</span>
➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) source venv3<span class="hljs-number">.10</span><span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>activate
(venv3<span class="hljs-number">.10</span>) ➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) 
</code></pre>
<p>这样我们就进入了创建的3.14虚拟环境。</p>
<h3 data-id="heading-2">1.2. ADB 调试工具</h3>
<p>这里可以参照 Android 官方 ADB 指令的下载与安装文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftools%2Freleases%2Fplatform-tools%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/tools/releases/platform-tools?hl=zh-cn" ref="nofollow noopener noreferrer">developer.android.com/tools/relea…</a></p>
<p>adb 安装完毕后，可打开终端命令行来检查一下是否成功。</p>
<pre><code class="hljs language-arduino" lang="arduino">➜  ~ adb devices
List of devices attached
<span class="hljs-number">2212</span>d99e	device
</code></pre>
<h3 data-id="heading-3">1.3. ADB Keyboard(用于文本输入)</h3>
<p>下载 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FADBKeyboard.apk" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/ADBKeyboard.apk" ref="nofollow noopener noreferrer">安装包</a> 并在对应的安卓设备中进行安装。 注意，安装完成后还需要到 <code>设置-输入法</code> 或者 <code>设置-键盘列表</code> 中启用 <code>ADB Keyboard</code> 才能生效(或使用命令<code>adb shell ime enable com.android.adbkeyboard/.AdbIME</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FREADME.md%23how-to-use" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/README.md#how-to-use" ref="nofollow noopener noreferrer">How-to-use</a>)。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866b2c19d59a44eaa4b398d93c04a811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=QyYmAvYasAAz63gcLA1GSzgl31E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">1.4. 安装项目依赖</h3>
<p>将 Open-AutoGML（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a>）项目下载到本地后，进入该项目对应的环境。执行以下指令：</p>
<pre><code class="hljs language-erlang" lang="erlang">pip install -r requirements.txt 
pip install -e .
</code></pre>
<h3 data-id="heading-5">1.5. 启动模型服务</h3>
<p>你可以选择自行部署模型服务，或使用第三方模型服务商。如果机器资源比较大，可以选择自行部署模型服务。这里我选择使用<strong>智谱 BigModel。</strong></p>
<ul>
<li>文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fapi%2Fintroduction" target="_blank" title="https://docs.bigmodel.cn/cn/api/introduction" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/api/intr…</a></li>
<li><code>--base-url</code>: <code>https://open.bigmodel.cn/api/paas/v4</code></li>
<li><code>--model</code>: <code>autoglm-phone</code></li>
<li><code>--apikey</code>: 在智谱平台申请你的 API Key</li>
</ul>
<p>使用示例：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 使用智谱 BigModel</span>
python main.py --base-url <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/open.bigmodel.cn/api</span><span class="hljs-regexp">/paas/v</span>4 --model <span class="hljs-string">"autoglm-phone"</span> --apikey <span class="hljs-string">"your-bigmodel-api-key"</span> <span class="hljs-string">"打开美团搜索附近的火锅店"</span>
</code></pre>
<h4 data-id="heading-6">1.5.1. 验证 apiKey</h4>
<p>我们在智谱AI开放平台申请 apikey 后可以参照 API 使用文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fapi%2Fintroduction" target="_blank" title="https://docs.bigmodel.cn/cn/api/introduction" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/api/intr…</a>）来验证是否可用。</p>
<p>使用 curl 指令输入：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">curl -X POST <span class="hljs-string">"https://open.bigmodel.cn/api/paas/v4/chat/completions"</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-H <span class="hljs-string">"Authorization: Bearer YOUR_API_KEY"</span> \
-d <span class="hljs-comment">'{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
    <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个有用的AI助手。"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好，请介绍一下自己。"</span>
        }
    ],
    <span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>,
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">true</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p>输出类似下面的内容时说明可用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fca7d48b6c16488eae3d33227edaa029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=VmYVS0qQte7xx9%2Blwskm9VVsBHI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">2. 实操用智谱 AI 帮我点外卖</h2>
<p>在完成环境安装后，我们来进行一次火锅的搜索。在工程项目目录中执行：</p>
<pre><code class="hljs language-css" lang="css"> python <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span> <span class="hljs-attr">--base-url</span> https://open.bigmodel.cn/api/paas/v4 --model <span class="hljs-string">"autoglm-phone"</span> --apikey <span class="hljs-string">"apikey"</span> <span class="hljs-string">"打开美团搜索附近的火锅店"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0019ec9625eb452c8185e5ea1027c87c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=kKBrvzqQ%2BjctNtwH0z2t3tejpS4%3D" alt="desktop1.gif" loading="lazy"/></p>
<h2 data-id="heading-8">3. 常见错误</h2>
<h3 data-id="heading-9">3.1. ERROR: No matching distribution found for Pillow&gt;=12.0.0</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">ERROR:</span> No matching distribution found <span class="hljs-keyword">for</span> Pillow&gt;=<span class="hljs-number">12.0</span>.<span class="hljs-number">0</span>
<span class="hljs-symbol">WARNING:</span> You are <span class="hljs-keyword">using</span> pip version <span class="hljs-number">21.1</span>.<span class="hljs-number">2</span>; however, version <span class="hljs-number">25.3</span> <span class="hljs-built_in">is</span> available.
You should consider upgrading via the <span class="hljs-comment">'/Users/dengshiwei/Documents/AI/Open-AutoGLM/venv/bin/python -m pip install --upgrade pip' command.</span>
</code></pre>
<p>使用的 python3.14 版本，在安装依赖时找不到 Pillow &gt;= 12.0.0 的版本，解决方法时降低到 python 版本到 3.10。这里可以使用 pyenv 来管理本地多个 python 版本。</p>
<pre><code class="hljs language-sql" lang="sql">brew <span class="hljs-keyword">update</span>
brew install pyenv
pyenv install <span class="hljs-number">3.10</span><span class="hljs-number">.14</span>
进入到项目，切换对应的 python 版本：pyenv <span class="hljs-keyword">local</span> <span class="hljs-number">3.10</span><span class="hljs-number">.14</span>
</code></pre>
<h3 data-id="heading-10">3.2. 键盘没效果</h3>
<p>我本地已经展示安装了键盘，但是运行 main.py 时还是提示找不到。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8498eef71b564b82a86e530ae71446b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=VIo%2BI6cp5a2DPuumTXqUJOc%2BKbQ%3D" alt="" loading="lazy"/></p>
<p>这里的原因是源码中的检测方法遇到手机权限的问题。</p>
<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-attr">result</span> = subprocess.run(
          <span class="hljs-section">["adb", "shell", "ime", "list", "-s"]</span>,
          <span class="hljs-attr">capture_output</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">text</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">timeout</span>=<span class="hljs-number">10</span>,
      )
</code></pre>
<p>本质上是 <code>adb shell ime list -s</code> 指令，但是很多手机都没权限了。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">java.lang.SecurityException:</span> <span class="hljs-string">uid</span> <span class="hljs-number">2000 </span><span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">have</span> <span class="hljs-string">android.permission.WRITE_SECURE_SETTINGS.</span>
</code></pre>
<p>这里可以改为：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">result</span> = subprocess.run(
    <span class="hljs-section">["adb", "shell", "settings", "get", "secure", "enabled_input_methods"]</span>,
    <span class="hljs-attr">capture_output</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">text</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">timeout</span>=<span class="hljs-number">3</span>,
)
</code></pre>
<p>后续我会提交一个 MR 来兼容一下这个问题。</p>
<h2 data-id="heading-11">4. 体验感受</h2>
<p>使用 <strong>智谱 BigModel 的模型情况下，</strong> 环境的搭建还是比较方便的，能够很快把开发环境搭建完成。如果是本地部署模型会比较耗费时间。总体来看还是比较智能的，能够操作挺多 App 的，还需要继续体验，但是目前感觉要商业化这个耗时还得继续优化，我执行了一个搜索火锅的指令，大概整体耗时在35s左右，跟中兴的 AI 手机体验比，耗时还有点多。持续进步吧。</p>
<p>#AutoGLM #智谱AI #OpenAutoGLM</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解锁Git隐藏力量：从熟练到大师的高级命令指南]]></title>    <link>https://juejin.cn/post/7583912899389521963</link>    <guid>https://juejin.cn/post/7583912899389521963</guid>    <pubDate>2025-12-16T00:14:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389521963" data-draft-id="7583910637958742035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解锁Git隐藏力量：从熟练到大师的高级命令指南"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-16T00:14:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小马写码"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解锁Git隐藏力量：从熟练到大师的高级命令指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小马写码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:14:36.000Z" title="Tue Dec 16 2025 00:14:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾对Git感到畏惧，认为它仅仅是一个复杂的版本控制工具？对于许多开发者而言，Git的日常使用仅限于<code>add</code>、<code>commit</code>和<code>push</code>这几个基础命令。然而，在这看似简单的界面之下，隐藏着一个强大而优雅的版本控制系统，等待着我们去探索和掌握。</p>
<p>本文将带你超越Git的基础操作，深入那些能够显著提升工作效率、解决复杂问题的高级命令和技巧，让你从Git使用者蜕变为Git大师。</p>
<h2 data-id="heading-0">一、时光旅行者：精准操控提交历史</h2>
<h3 data-id="heading-1">交互式变基：重写历史的能力</h3>
<pre><code class="hljs language-bash" lang="bash">git rebase -i HEAD~5
</code></pre>
<p>这个命令会打开一个交互式界面，允许你重新排序、合并、编辑或删除最近的5个提交。这不仅仅是整理提交历史的美容工具，更是保持项目历史清晰可读的关键。</p>
<p><strong>实用场景</strong>：将多个琐碎的提交合并成一个逻辑完整的提交，使代码审查更加高效。</p>
<h3 data-id="heading-2">引用日志：找回丢失的提交</h3>
<pre><code class="hljs language-bash" lang="bash">git reflog
</code></pre>
<p>当你意外地执行了<code>git reset --hard</code>或删除了分支，<code>reflog</code>就是你的时光机。它记录了仓库中所有的HEAD移动历史，让你能够找回看似"丢失"的提交。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 找回丢失的提交</span>
git reflog
<span class="hljs-comment"># 找到对应的提交哈希</span>
git checkout &lt;commit-hash&gt;
</code></pre>
<h2 data-id="heading-3">二、侦探模式：深入代码变更分析</h2>
<h3 data-id="heading-4">二分查找：快速定位问题引入点</h3>
<pre><code class="hljs language-bash" lang="bash">git bisect start
git bisect bad HEAD
git bisect good v1.0
</code></pre>
<p>当你在数百个提交中寻找引入bug的那个特定提交时，<code>git bisect</code>可以自动化这个过程。Git会智能地引导你在提交历史中进行二分查找，大大缩短问题定位时间。</p>
<h3 data-id="heading-5">高级日志筛选：精准过滤提交历史</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找特定作者在特定时间范围内的提交</span>
git <span class="hljs-built_in">log</span> --author=<span class="hljs-string">"John"</span> --since=<span class="hljs-string">"2023-01-01"</span> --until=<span class="hljs-string">"2023-06-30"</span>

<span class="hljs-comment"># 查找包含特定字符串的提交</span>
git <span class="hljs-built_in">log</span> -S <span class="hljs-string">"functionName"</span> --oneline

<span class="hljs-comment"># 可视化分支拓扑结构</span>
git <span class="hljs-built_in">log</span> --graph --oneline --all --decorate
</code></pre>
<h2 data-id="heading-6">三、工作流优化：提升日常效率</h2>
<h3 data-id="heading-7">储藏区的高级用法</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 储藏时添加描述</span>
git stash push -m <span class="hljs-string">"正在修复登录功能"</span>

<span class="hljs-comment"># 应用特定储藏</span>
git stash apply stash@{2}

<span class="hljs-comment"># 创建新分支并应用储藏</span>
git stash branch feature-login-fix stash@{1}
</code></pre>
<p>储藏不仅仅是临时保存更改，结合描述和分支创建，它可以成为上下文切换的强大工具。</p>
<h3 data-id="heading-8">提交修正：完善最近的提交</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改最近的提交信息</span>
git commit --amend

<span class="hljs-comment"># 添加文件到最近的提交</span>
git add forgotten_file.js
git commit --amend --no-edit
</code></pre>
<p><code>--amend</code>选项允许你修改最近的提交，而不是创建一个新的提交，保持历史整洁。</p>
<h2 data-id="heading-9">四、高级合并与冲突解决</h2>
<h3 data-id="heading-10">使用ours/theirs策略</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在合并冲突时，选择特定版本</span>
git checkout --ours conflicted-file.js
git checkout --theirs conflicted-file.js
</code></pre>
<p>当处理复杂合并冲突时，这些命令可以快速选择保留当前分支或合并分支的版本。</p>
<h3 data-id="heading-11">重新应用合并</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 放弃当前合并尝试，重新开始</span>
git merge --abort

<span class="hljs-comment"># 使用特定策略重新合并</span>
git merge -X patience feature-branch
</code></pre>
<p><code>-X patience</code>选项使用更智能的差异算法，在处理复杂重构时特别有用。</p>
<h2 data-id="heading-12">五、钩子与自定义：自动化工作流</h2>
<p>Git钩子位于<code>.git/hooks</code>目录中，允许你在特定事件发生时执行脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例：提交前检查代码格式</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># pre-commit hook</span>
<span class="hljs-keyword">if</span> ! npm run lint; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"代码格式检查失败，请修复后再提交"</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</code></pre>
<p>通过自定义钩子，你可以集成代码检查、测试运行、提交信息验证等自动化流程。</p>
<h2 data-id="heading-13">六、性能优化与维护</h2>
<h3 data-id="heading-14">垃圾回收与优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理不必要的文件并优化本地仓库</span>
git gc --aggressive --prune=now

<span class="hljs-comment"># 重新打包对象以提高效率</span>
git repack -a -d --depth=250 --window=250
</code></pre>
<p>对于大型仓库，定期执行这些维护命令可以显著提升Git性能。</p>
<h3 data-id="heading-15">部分克隆：处理巨型仓库</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只克隆最近的历史</span>
git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/large-repo.git

<span class="hljs-comment"># 按需获取特定目录</span>
git <span class="hljs-built_in">clone</span> --filter=blob:none --sparse https://github.com/large-repo.git
<span class="hljs-built_in">cd</span> large-repo
git sparse-checkout <span class="hljs-built_in">set</span> src/core
</code></pre>
<h2 data-id="heading-16">结语：从工具使用者到流程设计者</h2>
<p>正如我们所见，Git远不止于基础版本控制。这些高级命令和技巧将你从被动的工具使用者转变为主动的版本控制流程设计者。当你掌握了<code>reflog</code>的恢复能力、<code>bisect</code>的侦探技巧、交互式变基的历史重塑能力时，Git不再是一个需要小心应对的复杂系统，而是你开发工作流的自然延伸。</p>
<p>真正掌握Git的高级功能意味着你能以更少的努力完成更多工作，在团队协作中提供更多价值，并在面对复杂版本控制场景时保持从容。开始尝试这些命令，将它们融入你的日常工作中，你将会发现一个更高效、更可控的开发体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个看似“送分”的需求为何翻车？——前端状态机实战指南]]></title>    <link>https://juejin.cn/post/7584071941025497103</link>    <guid>https://juejin.cn/post/7584071941025497103</guid>    <pubDate>2025-12-16T10:55:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584071941025497103" data-draft-id="7583799807594201122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个看似“送分”的需求为何翻车？——前端状态机实战指南"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-16T10:55:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端一小卒"/> <meta itemprop="url" content="https://juejin.cn/user/1943592286564045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个看似“送分”的需求为何翻车？——前端状态机实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592286564045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端一小卒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T10:55:02.000Z" title="Tue Dec 16 2025 10:55:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>源码太枯燥？一个人啃不动？关注公众号-「前端小卒」，让我做你的源码领读人。这里没有晦涩的说教，只有清晰的 <strong>Vue 3 &amp; React 19</strong> 源码拆解。积跬步以至千里，<strong>小卒也能进阶为大将</strong>，我们一起过河！♟️</p>
</blockquote>
<p>故事的开始总是惊人的相似。</p>
<p>上个月，需求评审会上，收到了产品经理的一个需求：“做一个扫码支付弹窗。逻辑很简单：打开弹窗获取二维码，然后每隔 2 秒轮询一次接口，扫码成功就跳转，30 秒超时就让用户刷新”</p>
<p>一拍脑袋，凭经验判断，需求不难。作为一名熟练的“React工程师”，我极其自信地敲下代码，开始写需求代码。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 加载二维码中</span>
<span class="hljs-keyword">const</span> [isPolling, setIsPolling] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 轮询接口中</span>
<span class="hljs-keyword">const</span> [isError, setIsError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);     <span class="hljs-comment">// 出错了</span>
<span class="hljs-keyword">const</span> [retryCount, setRetryCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);   <span class="hljs-comment">// 重试次数</span>
<span class="hljs-comment">// ...后面还有一堆 useEffect 和 useRef 用来存定时器ID</span>
</code></pre>
<p>当时的我还未意识到，这几个state给我带来了好几个bug单。</p>
<h2 data-id="heading-0">隐形的“状态爆炸”</h2>
<p>正式提测之后，我就陆陆续续收到了好几个bug单。</p>
<p>“大佬，我就在网络卡顿的时候多点了几下‘刷新’，页面就乱了”</p>
<p>浏览器的Network 面板上，几十个轮询请求在并发执行。UI 界面上，“正在加载”的转圈动画和“网络错误”的红字提示竟然同时存在，甚至还能点击“重试”按钮！！！</p>
<p>按照我的逻辑，<code>isLoading</code> 为 <code>true</code> 时，<code>isError</code> 肯定得是 <code>false</code> 啊。我明明写了 <code>setLoading(true); setError(false)</code>，为啥会出现这种问题！</p>
<p><strong>为什么会失控？</strong></p>
<p>问题的根源就在于试图用线性的逻辑，去对抗非线性的现实。</p>
<p>当 <code>isLoading</code>、<code>isPolling</code>、<code>isError</code> 三个布尔值混在一起时，理论上它们能组合出 2^3=8 种状态。而在真实的业务逻辑中，合法的状态可能只有 3 种（加载中、轮询中、失败）。那么<strong>剩下的那 5 种“不可能存在的状态”，一不小心没处理就会存在大量的缺陷。</strong></p>
<p>我们花费 80% 的时间，不是在写业务，而是在写防御代码，去堵那些因为逻辑漏洞而产生的混沌状态。</p>
<p>面对那坨膨胀且脆弱的代码，再进行修修补补已经无济于事，必须要大刀阔斧式的推倒重来，和PM和运营沟通，需求进行延期，代码打回去重写。</p>
<p>解决此类问题的最佳方案，不是更高超的 <code>if-else</code> 技巧，而是一个经典的数学模型——<strong>有限状态机</strong> 。它的核心理念是：<strong>系统在任何时刻只能处于一种状态，且状态的流转是确定的。</strong></p>
<h2 data-id="heading-1">引入有限状态机 (FSM)</h2>
<h3 data-id="heading-2">绘制状态流转图</h3>
<p>在写代码之前，我先画了一张图。这才是逻辑的核心：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a5e676a636492fa064b0e5d1417ea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LiA5bCP5Y2S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766487301&amp;x-signature=bhvOGCRnUe0UJ6YFfe0nvs14GVQ%3D" alt="svgviewer-png-output (52).png" loading="lazy"/></p>
<p>流程图清晰的展示出来：</p>
<ul>
<li>只有在 <code>FAILURE</code> 或 <code>IDLE</code> 状态下，才允许发起 <code>FETCH</code>。</li>
<li>在 <code>LOADING</code> 状态下，无论用户怎么点击，都不会触发多余的请求。</li>
</ul>
<h3 data-id="heading-3">引入useReducer</h3>
<p>React 的 <code>useReducer</code> 是实现状态机的绝佳工具，通过它可以将状态管理收敛到一个纯函数中。</p>
<p><strong>定义状态与事件</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 状态枚举，只有这五种状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STATES</span> = {
  <span class="hljs-attr">IDLE</span>: <span class="hljs-string">'idle'</span>,
  <span class="hljs-attr">LOADING</span>: <span class="hljs-string">'loading'</span>,
  <span class="hljs-attr">POLLING</span>: <span class="hljs-string">'polling'</span>,
  <span class="hljs-attr">SUCCESS</span>: <span class="hljs-string">'success'</span>,
  <span class="hljs-attr">FAILURE</span>: <span class="hljs-string">'failure'</span>,
};

<span class="hljs-comment">// 事件枚举：用户或系统能做的动作</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EVENTS</span> = {
  <span class="hljs-attr">FETCH</span>: <span class="hljs-string">'FETCH'</span>,      <span class="hljs-comment">// 触发获取</span>
  <span class="hljs-attr">RESOLVE</span>: <span class="hljs-string">'RESOLVE'</span>,  <span class="hljs-comment">// 成功拿到二维码</span>
  <span class="hljs-attr">REJECT</span>: <span class="hljs-string">'REJECT'</span>,    <span class="hljs-comment">// 失败</span>
  <span class="hljs-attr">DONE</span>: <span class="hljs-string">'DONE'</span>,        <span class="hljs-comment">// 支付完成</span>
  <span class="hljs-attr">TIMEOUT</span>: <span class="hljs-string">'TIMEOUT'</span>,  <span class="hljs-comment">// 超时</span>
};
</code></pre>
<p><strong>编写 Reducer</strong></p>
<p>这里使用双重 Switch 结构：先判断<strong>当前处于什么状态</strong>，再判断<strong>发生了什么事件</strong>。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> machineReducer = (state, event) =&gt; {
  <span class="hljs-keyword">switch</span> (state.status) {
    <span class="hljs-keyword">case</span> STATES.IDLE:
    <span class="hljs-keyword">case</span> STATES.FAILURE:
      <span class="hljs-comment">// 只有在空闲或失败时，才允许发起 FETCH</span>
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.FETCH) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.LOADING, <span class="hljs-type">error</span>: null };
      }
      <span class="hljs-keyword">return</span> state; <span class="hljs-comment">// 其他事件直接忽略！</span>

    <span class="hljs-keyword">case</span> STATES.LOADING:
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.RESOLVE) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.POLLING, qrCode: event.data };
      }
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.REJECT) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.FAILURE, <span class="hljs-type">error</span>: event.<span class="hljs-type">error</span> };
      }
      <span class="hljs-comment">// 🔥 重点：这里没有处理 'FETCH' 事件。</span>
      <span class="hljs-comment">// 这意味着：在 Loading 状态下，无论用户怎么狂点按钮，代码都不会有任何反应！</span>
      <span class="hljs-keyword">return</span> state;

    <span class="hljs-keyword">case</span> STATES.POLLING:
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.DONE) <span class="hljs-keyword">return</span> { ...state, status: STATES.SUCCESS };
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.TIMEOUT) <span class="hljs-keyword">return</span> { ...state, status: STATES.FAILURE, <span class="hljs-type">error</span>: <span class="hljs-string">'超时'</span> };
      <span class="hljs-keyword">return</span> state;

    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};
</code></pre>
<p><strong>组件层调用（分离副作用）</strong></p>
<p>现在，组件层的代码变得异常清爽。我们只需要根据状态去渲染 UI，并利用 <code>useEffect</code> 处理轮询副作用。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">PaymentModal</span> = () =&gt; {
  const <span class="hljs-section">[state, dispatch]</span> = useReducer(machineReducer, { status: STATES.IDLE })<span class="hljs-comment">;</span>

  // 业务动作：只负责派发意图，不负责判断逻辑
  const <span class="hljs-attr">handleFetch</span> = () =&gt; {
    dispatch({ type: EVENTS.FETCH })<span class="hljs-comment">;</span>
    api.getQrCode()
      .then(<span class="hljs-attr">data</span> =&gt; dispatch({ type: EVENTS.RESOLVE, data }))
      .catch(<span class="hljs-attr">err</span> =&gt; dispatch({ type: EVENTS.REJECT, error: err }))<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  // 副作用管理：由状态驱动轮询
  useEffect(() =&gt; {
    let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">state.status</span> === STATES.POLLING) {
      <span class="hljs-attr">timer</span> = setInterval(async () =&gt; {
        const <span class="hljs-attr">res</span> = await api.checkStatus()<span class="hljs-comment">;</span>
        if (res.success) dispatch({ type: EVENTS.DONE })<span class="hljs-comment">;</span>
      }, 2000)<span class="hljs-comment">;</span>
    }
    return () =&gt; clearInterval(timer)<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[state.status]</span>)<span class="hljs-comment">; // 状态变了，副作用自动清理或重启</span>

  return (
    &lt;div&gt;
      {<span class="hljs-attr">state.status</span> === STATES.LOADING &amp;&amp; &lt;Spinner /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.POLLING &amp;&amp; &lt;QRCode img={state.qrCode} /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.FAILURE &amp;&amp; &lt;ErrorView <span class="hljs-literal">on</span>Retry={handleFetch} /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.SUCCESS &amp;&amp; &lt;SuccessView /&gt;}
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>看懂了吗？我们不再修补漏洞，通过清晰的定义状态和触发事件，收敛业务代码复杂度，消除可能产生的bug。</p>
<hr/>
<h2 data-id="heading-4">深度解析状态机</h2>
<p>写到这里，可能很多同学会问： <strong>“这不就是 Switch-Case 吗？为什么要叫它状态机？”</strong> 我们需要把视角拉高，从理论层面彻底理解它，以便应对更复杂的场景。</p>
<h3 data-id="heading-5">什么是有限状态机</h3>
<p>有限状态机不是一种代码写法，而是一个数学模型。它由五个要素组成：</p>
<ul>
<li><strong>有限的状态</strong> ：比如红绿灯只有红、黄、绿，不可能出现“红绿”。</li>
<li><strong>有限的事件</strong> ：比如“倒计时结束”、“按下按钮”。</li>
<li><strong>转换规则</strong> ：即 <code>状态 A + 事件 B -&gt; 状态 C</code>。</li>
<li><strong>初始状态</strong> 。</li>
<li><strong>最终状态</strong> 。</li>
</ul>
<p>它的核心理念就是：<strong>系统在任何时刻只能处于一种状态，且状态的流转是确定的。</strong></p>
<h3 data-id="heading-6">为什么前端需要它</h3>
<p>前端早已不是“展示页面”那么简单了，我们是在浏览器里跑 APP。以下场景如果不以状态机思维去写，迟早会崩：</p>
<ul>
<li><strong>多媒体播放器</strong>： 你以为只有 <code>Play</code> 和 <code>Pause</code>？错。 还有 <code>Buffering</code>（缓冲中）、<code>Seeking</code>（拖拽进度条中）、<code>Ended</code>（播放结束）、<code>Error</code>（加载失败）这些场景。</li>
<li><strong>复杂的表单向导</strong> ： 第一步 -&gt; 第二步 -&gt; 第三步。 用户在第二步点了“上一步”，数据怎么存？在第三步提交失败了，退回哪一步？</li>
<li><strong>TCP/WebSocket 连接管理</strong>： <code>Connecting</code> -&gt; <code>Connected</code> -&gt; <code>Reconnecting</code> -&gt; <code>Disconnected</code>。 如果在 <code>Reconnecting</code> 期间用户手动点了“断开”，应该去哪？</li>
<li><strong>Canvas 游戏/交互可视化</strong>： 拖拽模式、绘图模式、选中模式。</li>
</ul>
<p>读到这里，你可能已经热血沸腾，准备把项目里的所有组件都重写一遍。</p>
<p><strong>且慢。</strong></p>
<p>软件工程的核心在于权衡，如果需求仅仅是控制一个模态框的显示与隐藏，引入状态机只会增加无谓的代码复杂度。</p>
<p>那么，在实际业务开发中，我们应该依据哪些标准来判定是否需要引入状态机？当你的组件出现以下三种特征之一时，就可以结合业务适当的考虑重构了。</p>
<h3 data-id="heading-7">存在多个需要“手动同步”的boolean变量</h3>
<p>这是最显著的信号。检查一下你的组件 State 定义，如果出现了两个及以上的boolean，且彼此之间存在逻辑关联，就需要警惕，<strong>当你需要维护多个布尔值变量的同步关系时，状态机是更优解</strong>。</p>
<p>例如：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 典型的高风险代码</span>
const <span class="hljs-selector-attr">[isLoading, setLoading]</span> = <span class="hljs-built_in">useState</span>(false);
const <span class="hljs-selector-attr">[isError, setError]</span> = <span class="hljs-built_in">useState</span>(false);
const <span class="hljs-selector-attr">[hasData, setHasData]</span> = <span class="hljs-built_in">useState</span>(false);
</code></pre>
<p>在这种结构下，开发者需要时刻警惕变量间的同步问题。比如在 <code>setLoading(true)</code> 时，必须记得同时重置 <code>setError(false)</code>。这种依赖“人为细心”来维护的代码，随着迭代周期的拉长，几乎必然会产生 Bug。</p>
<h3 data-id="heading-8">业务逻辑要求状态必须“互斥”</h3>
<p>在很多场景下，业务状态在逻辑上是完全排他的。</p>
<p>比如开头的“扫码轮询”场景：一个请求不可能既在“进行中”又“已失败”。然而，如果使用分散的布尔值控制，代码层面是允许 <code>{ isLoading: true, isError: true }</code> 这种非法组合存在的。</p>
<p>这种逻辑上的“排他性”如果不能在代码结构上得到强制保证，就会导致 UI 渲染出错（例如 Loading 动画和错误提示重叠显示）。所以如果UI展示依赖于严格互斥的状态（如 Promise 的 Pending/Resolved/Rejected），请尽可能的使用状态机强制约束。</p>
<h3 data-id="heading-9">状态流转路径有严格限制</h3>
<p>简单的业务状态流转是自由的，而复杂的业务往往是有向图。</p>
<p>以“退款流程”为例：</p>
<ul>
<li>✅ 合法路径：<code>申请中</code> -&gt; <code>审核通过</code> -&gt; <code>打款中</code></li>
<li>❌ 非法路径：<code>申请中</code> -&gt; <code>打款中</code>（跳过审核）</li>
</ul>
<p>如果使用传统的 <code>if-else</code> 来防御非法跳转，代码中会充斥着大量 <code>if (status === 'AUDIT_PASS')</code> 这样的防御性判断。而状态机可以通过配置 <code>transitions</code>，天然地禁止了所有未定义的跳转路径。</p>
<p>所以当业务逻辑不仅仅关乎“当前是什么状态”，更关乎“当前状态允许变更为哪些状态”时，可以考虑引入状态机。</p>
<h3 data-id="heading-10">技术选型对照表</h3>
<p>在开始写代码前，可以参考下表进行决策：</p>

























<table><thead><tr><th><strong>业务场景特征</strong></th><th><strong>推荐方案</strong></th></tr></thead><tbody><tr><td>简单的开/关状态 (Toggle)</td><td><code>useState(boolean)</code></td></tr><tr><td>简单的互斥状态 (Loading/Success/Error)</td><td>字符串枚举 (String Enum)</td></tr><tr><td><strong>状态复杂，且存在特定的流转规则</strong></td><td><strong>状态机 (Reducer / XState)</strong></td></tr><tr><td><strong>涉及定时器、重试、取消等异步竞态问题</strong></td><td><strong>状态机 (推荐)</strong></td></tr></tbody></table>
<p>记住，工具是为了解决复杂度而生的。简单留给 <code>useState</code>，复杂留给状态机。</p>
<h2 data-id="heading-11">限制即自由</h2>
<p>写烂代码的本质，往往是我们试图在混乱中保留过多的“自由度”。而优秀架构的本质，通常在于<strong>限制</strong>。正如那句话说的：「<strong>喜欢就会放肆，但爱就是克制</strong>」</p>
<p>状态机严格规定了什么状态下能做什么事，这种克制提高了我们的前端稳定性。</p>
<p><strong>最后送给所有的前端的一句话：</strong></p>
<blockquote>
<p>所有的 Bug，本质上都是 <strong>“非法的状态”或“错误的转换”</strong>。</p>
<p>TypeScript 帮我们在编译时静态地规避了非法类型，而状态机则帮我们在运行时动态地管理状态流转。</p>
<p>TypeScript + State Machine = 前端逻辑的绝对防御。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信小程序真机预览-数字不等宽如何解决]]></title>    <link>https://juejin.cn/post/7584650857070051337</link>    <guid>https://juejin.cn/post/7584650857070051337</guid>    <pubDate>2025-12-17T09:55:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650857070051337" data-draft-id="7584742635483529226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信小程序真机预览-数字不等宽如何解决"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-17T09:55:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="人生_何处_不相逢"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036976285"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信小程序真机预览-数字不等宽如何解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036976285/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    人生_何处_不相逢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:55:41.000Z" title="Wed Dec 17 2025 09:55:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h4 data-id="heading-0"><strong>数字显示不等宽</strong></h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa06a35eb6fe4196aed98801878d1b37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=3zXRONF6Pdr3LsINcE18a903n9A%3D" alt="image.png" loading="lazy"/></p>
<p><strong>你按照设计稿， 把右侧时间设置了同一个字号， 以为就是100%还原了UI设计，还心里小小得意🤔</strong></p>
<p><strong>真机预览你发现</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e97b9d23f0b44679f19d53a31693a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=WWrqgV205ODyhCMXcRW5IOAesFU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>哎呦我去</strong>，我猜你肯定区检查了字体大小，肯定也预览了好几遍，才确认这个情况确实不是字体大小不一样导致的</p>
<p>😂😂😂 其实是因为 <code>0</code> 和 <code>1</code> 与其它数字宽度不一致导致的</p>
<p>那解决方法肯定是 <strong>设置一个等宽字体</strong> 但是那么多等宽字体 <strong>到底应该选择那个字体？</strong></p>
<p>选择的不对，就会造成下面的效果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b5796ff319e4786b3fc54d4890fdb37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=sX%2F%2FwSH36ggY7f71Qag7wX%2FspfA%3D" alt="image.png" loading="lazy"/></p>
<p>或者这样</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4395107f11f4853a8165fa1f34b3ae3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=naE%2FFV1antOI1%2BStGw0dE31p3Hc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>如果你也出现上述问题，你不妨设置</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">font-family</span>: Helvetica Neue;
</code></pre>
<p>这个试试看，你会得到以下结果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93017b3d83704a3fa27d6927c7a0c933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=H%2Bk9DfgO87dFlaGeK8qB5%2FFiixA%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>好了，最后希望大家都不要踩坑，愿所有bug的解决方法 都可以百度到 谢谢</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter使用package_info_plus库获取应用信息的教程]]></title>    <link>https://juejin.cn/post/7583910637958807571</link>    <guid>https://juejin.cn/post/7583910637958807571</guid>    <pubDate>2025-12-16T00:40:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637958807571" data-draft-id="7583577045578530842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter使用package_info_plus库获取应用信息的教程"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2025-12-16T00:40:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter使用package_info_plus库获取应用信息的教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:40:41.000Z" title="Tue Dec 16 2025 00:40:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 简介</h2>
<p>在 Flutter 应用开发中，获取应用自身的信息（如应用名称、版本号、包名等）是一项常见需求，这些信息可用于展示在关于页面、用于统计分析或实现特定业务逻辑。<code>package_info_plus</code> 插件是 Flutter 生态中获取应用元数据的最佳选择，支持多平台且使用简单。本文将详细介绍如何使用该插件获取各类应用信息。</p>
<p><code>package_info_plus</code> 是一个跨平台插件，用于获取应用的包信息和元数据，它是 <code>package_info</code> 插件的升级版，由 Flutter Community 维护。</p>
<p><strong>核心特点</strong>：</p>
<ul>
<li>支持 iOS、Android、Web、Windows、macOS 和 Linux 多平台</li>
<li>能够获取应用名称、包名、版本号、构建号等关键信息</li>
<li>用法简单，API 直观</li>
<li>与最新的 Flutter 版本保持兼容</li>
</ul>
<p><strong>可获取的主要信息</strong>：</p>
<ul>
<li>应用名称（应用商店中显示的名称）</li>
<li>包名/应用 ID（如 com.example.myapp）</li>
<li>版本名称（如 1.0.0）</li>
<li>版本号/构建号（如 1）</li>
<li>应用签名（部分平台）</li>
</ul>
<h2 data-id="heading-1">2. 安装与配置</h2>
<p>在项目的 <code>pubspec.yaml</code> 文件中添加 <code>package_info_plus</code> 依赖：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">package_info_plus:</span> <span class="hljs-string">^4.0.0</span>  <span class="hljs-comment"># 使用最新版本</span>
</code></pre>
<p>运行以下命令安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub get
</code></pre>
<h3 data-id="heading-2">2.1. 平台特定配置</h3>
<p><code>package_info_plus</code> 在大多数平台上无需额外配置即可使用，但某些平台可能需要注意以下事项：</p>
<p><strong>Web 平台</strong>：
需要在 <code>web/index.html</code> 中添加一些元数据，插件会从这里读取信息：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 其他头部内容 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"application-name"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"你的应用名称"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"version"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1.0.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"build-number"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"package"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"com.example.myapp"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p><strong>其他平台</strong>：
Android、iOS、Windows、macOS 和 Linux 平台不需要额外配置，插件会自动从各自的配置文件中读取信息。</p>
<h2 data-id="heading-3">3. 基本使用方法</h2>
<p>在需要使用的 Dart 文件中导入 <code>package_info_plus</code>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;
</code></pre>
<h3 data-id="heading-4">3.1. 获取应用信息</h3>
<p><code>package_info_plus</code> 提供了一个 <code>PackageInfo</code> 类，通过它可以获取所有应用信息。获取过程是异步的，通常使用 <code>await</code> 关键字：</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; getAppInfo() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-built_in">String</span> appName = packageInfo.appName;
  <span class="hljs-built_in">String</span> packageName = packageInfo.packageName;
  <span class="hljs-built_in">String</span> version = packageInfo.version;
  <span class="hljs-built_in">String</span> buildNumber = packageInfo.buildNumber;
  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'应用名称: <span class="hljs-subst">$appName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'包名: <span class="hljs-subst">$packageName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'版本号: <span class="hljs-subst">$version</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'构建号: <span class="hljs-subst">$buildNumber</span>'</span>);
}
</code></pre>
<h3 data-id="heading-5">3.2. 详细信息说明</h3>
<p><code>PackageInfo</code> 类提供的主要属性：</p>








































<table><thead><tr><th>属性</th><th>说明</th><th>平台支持</th></tr></thead><tbody><tr><td><code>appName</code></td><td>应用的用户可见名称</td><td>所有平台</td></tr><tr><td><code>packageName</code></td><td>应用的唯一标识符（Android 的包名，iOS 的 Bundle ID 等）</td><td>所有平台</td></tr><tr><td><code>version</code></td><td>应用的版本名称（如 1.0.0）</td><td>所有平台</td></tr><tr><td><code>buildNumber</code></td><td>应用的构建号或版本代码（通常是整数）</td><td>所有平台</td></tr><tr><td><code>buildSignature</code></td><td>应用的签名信息</td><td>Android 特有</td></tr><tr><td><code>installerStore</code></td><td>应用的安装来源商店</td><td>Android 特有</td></tr></tbody></table>
<h2 data-id="heading-6">4. 实战示例</h2>
<p>下面是一个完整的示例，创建一个展示应用信息的"关于"页面：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboutPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> AboutPage({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;AboutPage&gt; createState() =&gt; _AboutPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AboutPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AboutPage</span>&gt; </span>{
  <span class="hljs-keyword">late</span> Future&lt;PackageInfo&gt; _packageInfoFuture;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    <span class="hljs-comment">// 初始化时获取应用信息</span>
    _packageInfoFuture = PackageInfo.fromPackageInfo();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'关于我们'</span>),
      ),
      body: FutureBuilder&lt;PackageInfo&gt;(
        future: _packageInfoFuture,
        builder: (context, snapshot) {
          <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.waiting) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: CircularProgressIndicator());
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snapshot.hasError) {
            <span class="hljs-keyword">return</span> Center(child: Text(<span class="hljs-string">'获取应用信息失败: <span class="hljs-subst">${snapshot.error}</span>'</span>));
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!snapshot.hasData) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: Text(<span class="hljs-string">'无法获取应用信息'</span>));
          }

          PackageInfo packageInfo = snapshot.data!;

          <span class="hljs-keyword">return</span> SingleChildScrollView(
            padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16.0</span>),
            child: Column(
              children: [
                <span class="hljs-comment">// 应用图标</span>
                <span class="hljs-keyword">const</span> CircleAvatar(
                  radius: <span class="hljs-number">60</span>,
                  child: Icon(Icons.android, size: <span class="hljs-number">60</span>), <span class="hljs-comment">// 实际项目中替换为应用图标</span>
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// 应用名称</span>
                Text(
                  packageInfo.appName,
                  style: Theme.of(context).textTheme.headlineMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
                
                <span class="hljs-comment">// 版本信息</span>
                Text(
                  <span class="hljs-string">'版本: <span class="hljs-subst">${packageInfo.version}</span> (<span class="hljs-subst">${packageInfo.buildNumber}</span>)'</span>,
                  style: Theme.of(context).textTheme.titleMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// 详细信息列表</span>
                _buildInfoItem(<span class="hljs-string">'包名'</span>, packageInfo.packageName),
                <span class="hljs-keyword">if</span> (packageInfo.buildSignature.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'应用签名'</span>, packageInfo.buildSignature),
                <span class="hljs-keyword">if</span> (packageInfo.installerStore != <span class="hljs-keyword">null</span> &amp;&amp; packageInfo.installerStore!.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'安装来源'</span>, packageInfo.installerStore!),
                
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">32</span>),
                
                <span class="hljs-comment">// 版权信息</span>
                <span class="hljs-keyword">const</span> Text(
                  <span class="hljs-string">'© 2023 你的公司名称. 保留所有权利.'</span>,
                  style: TextStyle(color: Colors.grey),
                ),
              ],
            ),
          );
        },
      ),
    );
  }

  <span class="hljs-comment">// 构建信息项</span>
  Widget _buildInfoItem(<span class="hljs-built_in">String</span> label, <span class="hljs-built_in">String</span> value) {
    <span class="hljs-keyword">return</span> Padding(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(vertical: <span class="hljs-number">8.0</span>),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            <span class="hljs-string">'<span class="hljs-subst">$label</span>: '</span>,
            style: <span class="hljs-keyword">const</span> TextStyle(
              fontWeight: FontWeight.bold,
              width: <span class="hljs-number">100</span>,
            ),
          ),
          Expanded(
            child: Text(value),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>这个示例创建了一个完整的"关于"页面，包含以下功能：</p>
<ul>
<li>使用 <code>FutureBuilder</code> 处理异步获取应用信息的过程</li>
<li>展示加载状态、错误状态和成功状态</li>
<li>显示应用名称、图标、版本号等基本信息</li>
<li>根据平台特性选择性展示签名和安装来源信息</li>
</ul>
<h2 data-id="heading-7">5. 高级应用场景</h2>
<p>下面是一些高级的应用场景，例如：</p>
<h3 data-id="heading-8">5.1. 版本更新检查</h3>
<p>可以使用获取到的版本号实现版本更新检查功能：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VersionChecker</span> </span>{
  <span class="hljs-comment">// 假设这是从服务器获取的最新版本号</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> _latestVersion = <span class="hljs-string">"1.1.0"</span>;
  
  Future&lt;<span class="hljs-built_in">bool</span>&gt; isUpdateAvailable() <span class="hljs-keyword">async</span> {
    PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
    <span class="hljs-keyword">return</span> _compareVersions(packageInfo.version, _latestVersion) &lt; <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-comment">// 版本号比较工具方法</span>
  <span class="hljs-built_in">int</span> _compareVersions(<span class="hljs-built_in">String</span> current, <span class="hljs-built_in">String</span> latest) {
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; currentParts = current.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; latestParts = latest.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    
    <span class="hljs-built_in">int</span> maxLength = max(currentParts.length, latestParts.length);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; maxLength; i++) {
      <span class="hljs-built_in">int</span> currentPart = i &lt; currentParts.length ? currentParts[i] : <span class="hljs-number">0</span>;
      <span class="hljs-built_in">int</span> latestPart = i &lt; latestParts.length ? latestParts[i] : <span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">if</span> (currentPart &lt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">if</span> (currentPart &gt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">void</span> checkForUpdates() <span class="hljs-keyword">async</span> {
  VersionChecker checker = VersionChecker();
  <span class="hljs-built_in">bool</span> hasUpdate = <span class="hljs-keyword">await</span> checker.isUpdateAvailable();
  <span class="hljs-keyword">if</span> (hasUpdate) {
    <span class="hljs-comment">// 显示更新提示</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"有新版本可用！"</span>);
  }
}
</code></pre>
<h3 data-id="heading-9">5.2. 应用使用统计</h3>
<p>结合设备信息和应用信息，可以实现应用使用统计：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:device_info_plus/device_info_plus.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; trackAppUsage() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  DeviceInfoPlugin deviceInfo = DeviceInfoPlugin();
  
  <span class="hljs-built_in">String</span> trackingInfo = <span class="hljs-string">'''
  应用信息:
  - 名称: <span class="hljs-subst">${packageInfo.appName}</span>
  - 版本: <span class="hljs-subst">${packageInfo.version}</span>
  - 包名: <span class="hljs-subst">${packageInfo.packageName}</span>
  
  设备信息:
  '''</span>;
  
  <span class="hljs-keyword">if</span> (Platform.isAndroid) {
    AndroidDeviceInfo androidInfo = <span class="hljs-keyword">await</span> deviceInfo.androidInfo;
    trackingInfo += <span class="hljs-string">'- 设备: <span class="hljs-subst">${androidInfo.brand}</span> <span class="hljs-subst">${androidInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- 系统版本: Android <span class="hljs-subst">${androidInfo.version.release}</span>'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Platform.isIOS) {
    IosDeviceInfo iosInfo = <span class="hljs-keyword">await</span> deviceInfo.iosInfo;
    trackingInfo += <span class="hljs-string">'- 设备: <span class="hljs-subst">${iosInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- 系统版本: iOS <span class="hljs-subst">${iosInfo.systemVersion}</span>'</span>;
  }
  
  <span class="hljs-comment">// 实际项目中，这里会将统计信息发送到服务器</span>
  <span class="hljs-built_in">print</span>(trackingInfo);
}
</code></pre>
<h3 data-id="heading-10">5.3. 动态配置应用行为</h3>
<p>根据应用版本动态配置应用行为：</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; configureAppBehavior() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-comment">// 根据不同版本启用不同功能</span>
  <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.0.'</span>)) {
    <span class="hljs-comment">// v1.0.x 版本的配置</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'配置基础功能'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.1.'</span>)) {
    <span class="hljs-comment">// v1.1.x 版本的配置</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'配置高级功能'</span>);
  }
  
  <span class="hljs-comment">// 根据构建号启用测试功能</span>
  <span class="hljs-built_in">int</span> buildNumber = <span class="hljs-built_in">int</span>.tryParse(packageInfo.buildNumber) ?? <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (buildNumber &gt;= <span class="hljs-number">100</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'启用beta功能'</span>);
  }
}
</code></pre>
<h2 data-id="heading-11">6. 注意事项</h2>
<ul>
<li><strong>异步处理</strong>
<ul>
<li><code>PackageInfo.fromPackageInfo()</code> 是异步方法，必须正确处理异步操作</li>
<li>建议在应用启动时获取一次应用信息并缓存，避免重复获取</li>
<li>使用 <code>FutureBuilder</code> 或状态管理工具（如 Provider、Bloc）处理 UI 渲染</li>
</ul>
</li>
<li><strong>平台差异</strong>
<ul>
<li>不同平台上的信息可能有所不同，尤其是 <code>buildSignature</code> 和 <code>installerStore</code> 等平台特定属性</li>
<li>Web 平台需要手动配置元数据，其他平台则自动读取</li>
<li>处理平台特定属性时，应先检查其是否存在或不为空</li>
</ul>
</li>
<li><strong>版本号管理</strong>
<ul>
<li>保持 <code>pubspec.yaml</code>、AndroidManifest.xml 和 Info.plist 中的版本信息同步</li>
<li>建立清晰的版本号命名规则（如语义化版本 主版本.次版本.修订号）</li>
<li>构建号应随每次构建递增，用于区分不同构建</li>
</ul>
</li>
<li><strong>性能考虑</strong>
<ul>
<li>应用信息不会频繁变化，无需多次获取</li>
<li>建议在应用初始化阶段获取并存储在全局状态中</li>
<li>避免在 UI 渲染关键路径中获取应用信息</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">7. 常见问题解决</h2>
<ul>
<li><strong>信息不准确或未更新</strong>
<ul>
<li>确保所有平台的配置文件都已更新版本信息</li>
<li>运行 <code>flutter clean</code> 清理缓存后重新构建</li>
<li>对于 Web 平台，检查 <code>index.html</code> 中的元数据是否正确</li>
</ul>
</li>
<li><strong>某些属性为空</strong>
<ul>
<li>某些属性（如 <code>installerStore</code>）仅在特定条件下才有值</li>
<li>检查是否在正确的平台上访问平台特定属性</li>
<li>Web 平台需要手动配置所有属性</li>
</ul>
</li>
<li><strong>构建错误</strong>
<ul>
<li>确保使用的 <code>package_info_plus</code> 版本与 Flutter 版本兼容</li>
<li>检查是否正确导入了包</li>
<li>尝试更新插件到最新版本</li>
</ul>
</li>
</ul>
<h2 data-id="heading-13">8. 总结</h2>
<p><code>package_info_plus</code> 是 Flutter 开发中获取应用元数据的实用工具，它提供了简单直观的 API，支持多平台，能够满足大多数应用对获取自身信息的需求。</p>
<p>合理利用应用信息可以提升用户体验，简化开发流程，并为应用的统计分析提供支持。更多详细信息可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fpackage_info_plus" target="_blank" title="https://pub.dev/packages/package_info_plus" ref="nofollow noopener noreferrer">官方文档</a>。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7582808491582619684" target="_blank" title="https://juejin.cn/post/7582808491582619684">Flutter输入框TextField的属性与实战用法全面解析+示例</a></li>
<li><a href="https://juejin.cn/post/7581693431740448831" target="_blank" title="https://juejin.cn/post/7581693431740448831">Flutter自定义日历table_calendar完全指南+案例</a></li>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微前端架构（二）：封装与实现]]></title>    <link>https://juejin.cn/post/7584059298697216041</link>    <guid>https://juejin.cn/post/7584059298697216041</guid>    <pubDate>2025-12-16T09:53:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584059298697216041" data-draft-id="7584273076645658630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微前端架构（二）：封装与实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T09:53:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码农胖大海"/> <meta itemprop="url" content="https://juejin.cn/user/4195392102086967"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微前端架构（二）：封装与实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4195392102086967/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码农胖大海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T09:53:19.000Z" title="Tue Dec 16 2025 09:53:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>很荣幸由我设计并实现了公司自研的微前端框架，目前该框架已在多个业务项目中广泛应用。</p>
<p>本文是我结合内部培训、产品文档及相关实践梳理而成的总结，旨在对微前端技术体系进行系统性的整理与沉淀。</p>
<p>本篇是系列文章的第二篇，分享一些关于微前端的封装和实践。</p>
<h2 data-id="heading-1">二、产品简介</h2>
<p>XX微前端是基于qiankun和公司权限管理系统实现的微前端架构解决方案，旨在帮助大家能更简单、无痛地构建一个生产可用微前端架构系统。</p>
<p>它在XX基础模板的基础上，兼容适配了XX已有的用户认证、权限控制、埋点功能，并集成了一系列微前端能力，包括应用加载、应用通信、应用隔离、应用缓存等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e50befbb384003b8bef3f838d65c8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5Yac6IOW5aSn5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766483598&amp;x-signature=8HU6uvvSZjKSWFtic1y4ktT865U%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">三、核心封装与实现</h2>
<h3 data-id="heading-3">3.1 应用缓存</h3>
<p>在主应用中使用<code> v-show </code>指令控制子应用容器，以实现子应用的切换与缓存。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 子应用容器 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in apps"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"app-container"</span>
    <span class="hljs-attr">v-show</span>=<span class="hljs-string">"currentAppName &amp;&amp; currentAppName === item.name"</span>
    <span class="hljs-attr">:id</span>=<span class="hljs-string">"`container-${item.name}`"</span>
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.name"</span>
  &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">3.2 应用加载</h3>
<p>采用qiankun的loadMicroApp实现多标签页场景下的应用加载。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d26fe558168249ea826cb799b21543a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5Yac6IOW5aSn5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766483598&amp;x-signature=kqJvHzuSWkteh5vz7Brv8kSX81Y%3D" alt="image.png" loading="lazy"/></p>
<p>核心逻辑说明：监听路由变化=》根据路由匹配子应用=》loadMicroApp手动加载子应用，给挂载到指定容器。</p>
<pre><code class="hljs language-vue" lang="vue">// 1. 监听路由变化
watch: {
    $route: {
      immediate: false,
      handler(route) {
        this.openMicroApp(route);
      }
    }
  },
// 2. 根据路由信息获取菜单数据及子应用信息
const resource = getMenuByRoute(route);
subApp = resource &amp;&amp; this.getAppById(resource.rootResourceId);
// 2.1 菜单资源数据映射关系
{
  id: item.resourceId, // web应用资源id
  name: item.resourceCode, // web应用资源编码
  entry: item.resourceUrl // web应用基础路径
}
// 3. 调用loadMicroApp加载子应用
const { name, entry } = subApp;
const appInstances = loadMicroApp({
  name,
  entry,
  container: `#container-${name}`,
  props: {}
});
</code></pre>
<p>以上代码是简化后的示意代码，实际实现中还包含有对容器节点、路由、loading等细节的处理。</p>
<h3 data-id="heading-5">3.3 应用通信</h3>
<h4 data-id="heading-6">3.3.1 基于props</h4>
<p>qiankun的<code>loadMicroApp</code> 方法支持通过props配置选项，传递数据或者方法给子应用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 主应用定义并通过props.data传递</span>
<span class="hljs-keyword">const</span> mainAppName = <span class="hljs-string">'app-main'</span>
<span class="hljs-keyword">const</span> appInstances = <span class="hljs-title function_">loadMicroApp</span>({
  name,
  entry,
  <span class="hljs-attr">container</span>: <span class="hljs-string">`#container-<span class="hljs-subst">${name}</span>`</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: {
      mainAppName
    }
  }
});

<span class="hljs-comment">// 2. 子应用接收</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-title function_">render</span>(props);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { data = {}, container } = props || {};
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">mainAppName</span>)
}
</code></pre>
<h4 data-id="heading-7">3.3.2 基于window</h4>
<p>通过挂载全局属性和方法，供其他应用使用。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 主应用定义</span>
window.<span class="hljs-variable">$mainAxxxxxxx</span> = <span class="hljs-built_in">initAxxxxxxx</span>(router);

<span class="hljs-comment">// 2. 子应用通过window调用</span>
window.<span class="hljs-variable">$mainAxxxxxxx</span><span class="hljs-selector-class">.xxx</span>();
</code></pre>
<h4 data-id="heading-8">3.3.3 基于事件</h4>
<p>框架选用Node.js的EventEmitter，由主应用集成并对外提供event-bus基于事件总线的应用间通信能力。包含事件的注册、派发和移除功能。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 主应用实例化事件对象</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventEmitter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'events'</span>;
<span class="hljs-keyword">const</span> eventBus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();
<span class="hljs-comment">// 2. 监听事件</span>
eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-function">(<span class="hljs-params">params1, params2</span>) =&gt;</span> {
  <span class="hljs-comment">// ...do some things</span>
});
<span class="hljs-comment">// 3. 传递实例给子应用</span>
<span class="hljs-title function_">loadMicroApp</span>({
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: {
      eventBus
    }
  }
});

<span class="hljs-comment">// 4. 子应用接收并派发事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { data = {}, container } = props || {};
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">eventBus</span>) {
    data.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event1'</span>, params1, params2);
  }
}
<span class="hljs-comment">// 5. 子应用也可以 监听其他应用派发的事件</span>
data.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'xxx'</span>,xxx)
</code></pre>
<p>注意事项：</p>
<ul>
<li>在绝大多数情况下，不鼓励使用全局的事件总线在组件之间进行通信。虽然在短期内往往是最简单的解决方案，但从长期来看，它维护起来总是令人头疼。可以用，但不建议大量使用。</li>
<li>删除在其他地方添加的监听器是不好的做法，特别是当 <code>EventEmitter</code> 实例是由其他组件或模块（例如套接字或文件流）创建时。存在较大风险隐患。</li>
</ul>
<h4 data-id="heading-9">3.3.4 基于vuex</h4>
<p>通过共享主应用store, 可以快速将基座的vuex注册到微应用自己的vuex实例上。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 主应用定义并通过props传递store</span>
<span class="hljs-keyword">import</span> qiankunCommonStore from <span class="hljs-string">'@/store/modules/common'</span>;
loadMicroApp({
  name,
  entry,
  container: `#container-${name}`,
  props: {
    <span class="hljs-keyword">data</span>: {
      store: qiankunCommonStore,
    }
  }
});
<span class="hljs-comment">// 2. 子应用store注册到自己的vuex实例上</span>
function render(props) {
  <span class="hljs-keyword">const</span> { <span class="hljs-keyword">data</span> = {}, container } = props || {};
  <span class="hljs-keyword">if</span> (store &amp;&amp; store.hasModule &amp;&amp; <span class="hljs-keyword">data</span>.store) {
    store.registerModule(<span class="hljs-string">'mainAppStore'</span>, <span class="hljs-keyword">data</span>.store);
  }
}
<span class="hljs-comment">// 3.1 使用：取值</span>
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">this</span>.$store.state.mainAppStore.userInfo
<span class="hljs-comment">// 3.2 使用：赋值</span>
<span class="hljs-keyword">this</span>.$store.commit(<span class="hljs-string">'mainAppStore/setUserInfo'</span>, { ...<span class="hljs-keyword">this</span>.userInfo, newData: <span class="hljs-string">'home-new-data'</span> });
</code></pre>
<h4 data-id="heading-10">3.3.5 基于initGlobalState</h4>
<p>qiankun提供的基于全局状态的通信方式。模板中未集成，如需使用，可参看<a href="https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fapi%23initglobalstatestate" target="_blank" title="https://qiankun.umijs.org/zh/api#initglobalstatestate" ref="nofollow noopener noreferrer">qiankun文档</a>自行扩展。</p>
<p>未集成的原因是，作者并<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Fqiankun%2Fdiscussions%2F1378%23discussioncomment-1475671" target="_blank" title="https://github.com/umijs/qiankun/discussions/1378#discussioncomment-1475671" ref="nofollow noopener noreferrer">不推荐该API</a>并计划在未来版本中移除。</p>
<p>globalState 不是合理的微前端通信方案，会加剧应用之间的耦合.。 -- qiankun官方issues</p>
<h3 data-id="heading-11">3.4 应用跳转</h3>
<h4 data-id="heading-12">3.4.1 应用内跳转</h4>
<p>调用自身路由router的方法</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onJump</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
    path,
    query
  });
},
</code></pre>
<h4 data-id="heading-13">3.4.2 应用间跳转</h4>
<p>使用主应用路由方法</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onJumpOther</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$root</span>.<span class="hljs-property">mainAppRouter</span>.<span class="hljs-title function_">push</span>({
    path,
    query
  });
},
</code></pre>
<h3 data-id="heading-14">3.5 应用隔离</h3>
<h4 data-id="heading-15">3.5.1 js沙箱</h4>
<p>众所周知javaScript的全局作用域存在命名冲突、变量污染等风险，为了解决该问题，qiankun借助 ES6 的 proxy ，创建js代理沙箱，实现了应用间环境的隔离。</p>
<p>qiankun已有实现，默认为开启状态。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://juejin.cn/post/6846687602439897101#heading-21" target="_blank" title="https://juejin.cn/post/6846687602439897101#heading-21">蚂蚁金服体验技术部 qiankun 的核心贡献者 - 方涣的分享</a></li>
</ul>
<h4 data-id="heading-16">3.5.2 样式隔离</h4>
<p>为了确保不同组件或模块之间的样式不会相互影响，从而提高代码的可维护性和可复用性。qiankun提供有两种样式隔离方案，strictStyleIsolation和experimentalStyleIsolation。</p>
<p>qiankun默认开启strictStyleIsolation严格的样式隔离模式。这种模式下 qiankun 会为每个微应用的容器包裹上一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FWeb_Components%2FUsing_shadow_DOM" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM" ref="nofollow noopener noreferrer">shadow dom</a> 节点，从而确保微应用的样式不会对全局造成影响。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fapi%23loadmicroappapp-configuration" target="_blank" title="https://qiankun.umijs.org/zh/api#loadmicroappapp-configuration" ref="nofollow noopener noreferrer">loadMicroApp.sandbox配置说明</a></li>
</ul>
<h4 data-id="heading-17">3.5.3 本地存储隔离</h4>
<p>为了防止各微应用间操作本地存储时，数据覆盖、误删除等问题，框架封装并集成了本地存储功能模块。原理是在基座运行时，覆写localStorage、sessionStorage方法，给本地存储的<code>key</code> 统一加上前缀。</p>
<p>我们对此封装了一个组件，代码 和API就不赘述了，这里仅分享，在去覆写的时候遇到的一个卡点问题和解决方案。</p>
<p>问题描述：修改Storage接口的原型方法后，乾坤无法隔离， 导致所有应用（包括主应用）的相关方法均被修改。</p>
<p>解决方案：在引入qiankun之前删除window.localStorage，随后再重新声明，此时的window.localStorage是隔离的，在主子应用分别定义，互不影响。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 主应用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>;
<span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>;
<span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> = {
 <span class="hljs-title function_">getItem</span>(<span class="hljs-params">...ags</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"this"</span>, <span class="hljs-variable language_">this</span>);
   <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span>.<span class="hljs-title function_">getItem</span>(...ags);
},
};

<span class="hljs-comment">// 子应用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> = {
 <span class="hljs-title function_">getItem</span>(<span class="hljs-params">key, ...ags</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"insub"</span>);
   <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`app-vue<span class="hljs-subst">${key}</span>`</span>, ...ags);
},
};
</code></pre>
<p>原理是qiankun的沙箱（proxySandBox），会从window对象拷贝不可配置的属性并filter掉，不走proxy代理，比如location、localStorage等。现在咱们在qiankun沙箱逻辑执行前，把localStorage属性移除，它拷贝不到，后面咱们再加上的localStorage就会走proxy然后被隔离起来。</p>
<h3 data-id="heading-18">3.6 权限控制</h3>
<p>整体策略是，各微应用分别进行权限控制，谁的页面谁管控。</p>
<p>在微前端场景下，由于各微应用的路由监听的是同一url，当url切换时，所有微应用的路由守卫都会触发。需要对不是自己应用路由放行。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">// 微前端运行时的路由守卫
<span class="hljs-keyword">function</span> microAppHook(<span class="hljs-keyword">to</span>, <span class="hljs-keyword">from</span>, <span class="hljs-keyword">next</span>){
  <span class="hljs-keyword">const</span> isAppNameMatched = <span class="hljs-keyword">to</span>.meta.appName ? <span class="hljs-keyword">to</span>.meta.appName === appName : <span class="hljs-literal">true</span>,
    isNotMyRoute = !<span class="hljs-keyword">to</span>.path || !<span class="hljs-keyword">to</span>.name || !isAppNameMatched;
  <span class="hljs-keyword">if</span> (isNotMyRoute) {
    // 非当前应用路由，跳过处理
    <span class="hljs-keyword">next</span>();
    <span class="hljs-keyword">return</span>;
  }
  // 权限控制：白名单、角色菜单权限判断
  <span class="hljs-keyword">if</span> (hasPermission(<span class="hljs-keyword">to</span>) || hasPermission(<span class="hljs-keyword">to</span>, <span class="hljs-literal">false</span>)) {
    <span class="hljs-keyword">next</span>();
  }<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">next</span>({path: <span class="hljs-comment">'/404', replace: true});</span>
  }
}
</code></pre>
<h2 data-id="heading-19">四、后续改进</h2>
<ol>
<li>
<p>性能提升</p>
<ol>
<li>内存占用高：在低版本火狐浏览器内存占用经常性超过2G，页面卡顿明显</li>
<li>加载速度慢：超过5M的子应用资源，请求和加载长达3-5秒</li>
</ol>
</li>
<li>
<p>简化路由、菜单资源的处理</p>
<ol>
<li>当前关于菜单资源的处理较复杂且不灵活，有较大提升空间</li>
</ol>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 项目docker分层镜像构建案例]]></title>    <link>https://juejin.cn/post/7583980250734608447</link>    <guid>https://juejin.cn/post/7583980250734608447</guid>    <pubDate>2025-12-16T06:04:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250734608447" data-draft-id="7583980250734592063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 项目docker分层镜像构建案例"/> <meta itemprop="keywords" content="Spring Boot,Docker,CI/CD"/> <meta itemprop="datePublished" content="2025-12-16T06:04:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="昵称为空C"/> <meta itemprop="url" content="https://juejin.cn/user/1267096172897005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 项目docker分层镜像构建案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1267096172897005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    昵称为空C
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T06:04:51.000Z" title="Tue Dec 16 2025 06:04:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：本文主要介绍<code>Spring Boot</code>项目的<code>docker</code>镜像分层构建，分为外部依赖和内部依赖和项目<code>classes</code>依赖，让<code>docker</code>构建的时候，可以使用之前的缓存，加快构建速度和测试环境镜像拉取速度。</p>
<h2 data-id="heading-0">为什么使用分层 Docker 镜像？</h2>
<p>传统的 Docker 镜像构建方式会将整个应用程序 JAR/WAR 文件复制到一个层中。当你修改代码时，整个层都会失效，导致 Docker 必须重新构建整个应用程序层，即使只是做了微小的代码更改。</p>
<p>通过我们的分层方法，我们将以下内容分离：</p>
<ol>
<li>外部依赖（第三方库）</li>
<li>内部依赖（公司特定库）</li>
<li>应用程序代码（实际业务逻辑）</li>
</ol>
<p>这样，当你修改代码时，只需要重新构建应用程序代码层，而依赖层可以从缓存中重用。</p>
<h2 data-id="heading-1">Maven 插件配置详解</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-external-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/external<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-internal-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/internal<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 如果使用预览特性 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">compilerArgs</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>--enable-preview<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">compilerArgs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">release</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">release</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">工作原理</h2>
<h3 data-id="heading-3">1. Maven 依赖分离插件配置详解</h3>
<p>我们的 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">pom.xml</a> 使用 <code>maven-dependency-plugin</code> 在构建过程中分离依赖。该插件包含两个执行配置：</p>
<h4 data-id="heading-4">外部依赖复制配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-external-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/external<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
</code></pre>
<p>配置参数说明：</p>
<ul>
<li><code>&lt;id&gt;</code>: 执行的唯一标识符</li>
<li><code>&lt;phase&gt;</code>: 绑定到 Maven 生命周期的 package 阶段</li>
<li><code>&lt;goals&gt;</code>: 执行的目标是 copy-dependencies</li>
<li><code>&lt;configuration&gt;</code>: 配置详情</li>
</ul>

<ul>
<li>
<ul>
<li><code>&lt;outputDirectory&gt;</code>: 输出目录，<code>${project.build.directory}</code> 是 target 目录</li>
<li><code>&lt;includeScope&gt;</code>: 包含作用域为 compile 的依赖</li>
<li><code>&lt;excludeGroupIds&gt;</code>: 排除 groupId 为 cn.hutool 的依赖（将其视为内部依赖）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">内部依赖复制配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-internal-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/internal<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
</code></pre>
<p>配置参数说明：</p>
<ul>
<li><code>&lt;id&gt;</code>: 执行的唯一标识符</li>
<li><code>&lt;phase&gt;</code>: 同样绑定到 Maven 生命周期的 package 阶段</li>
<li><code>&lt;goals&gt;</code>: 执行的目标也是 copy-dependencies</li>
<li><code>&lt;configuration&gt;</code>: 配置详情</li>
</ul>

<ul>
<li>
<ul>
<li><code>&lt;outputDirectory&gt;</code>: 输出目录为 target/lib/internal</li>
<li><code>&lt;includeScope&gt;</code>: 包含作用域为 compile 的依赖</li>
<li><code>&lt;includeGroupIds&gt;</code>: 只包含 groupId 为 cn.hutool 的依赖（作为内部依赖处理）</li>
</ul>
</li>
</ul>
<p>通过这两个执行配置，Maven 会在 package 阶段自动将依赖分别复制到对应的目录中：</p>
<ul>
<li><code>target/lib/external/</code> - 第三方依赖（排除了 cn.hutool）</li>
<li><code>target/lib/internal/</code> - 内部/公司特定依赖（只有 cn.hutool）</li>
<li><code>target/classes/</code> - 编译后的应用程序代码</li>
</ul>
<h3 data-id="heading-6">2. 分层 Dockerfile 详解</h3>
<p>我们的 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Dockerfile</a> 通过首先复制依赖来利用 Docker 层缓存：</p>
<pre><code class="hljs language-bash" lang="bash">FROM eclipse-temurin:21-jre-alpine
WORKDIR /app

<span class="hljs-comment"># 1. 复制外部依赖（很少更改）</span>
COPY target/lib/external/*.jar ./lib/external/

<span class="hljs-comment"># 2. 复制内部依赖（偶尔更改）</span>
COPY target/lib/internal/*.jar ./lib/internal/

<span class="hljs-comment"># 3. 复制应用程序类（经常更改）</span>
COPY target/classes ./classes

EXPOSE 8080

ENV CUSTOM_OPTS=<span class="hljs-string">"-Xms256m -Xmx768m"</span>
ENV JAVA_OPTS=<span class="hljs-string">"--enable-preview -XX:+UseSerialGC"</span>
ENTRYPOINT [<span class="hljs-string">"sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"java <span class="hljs-variable">$CUSTOM_OPTS</span> <span class="hljs-variable">$JAVA_OPTS</span> -cp /app/classes:/app/lib/external/*:/app/lib/internal/* com.example.layer.Sp3LayerApplication"</span>]
</code></pre>
<p>Dockerfile 配置说明：</p>
<ul>
<li><code>FROM eclipse-temurin:21-jre-alpine</code>: 使用轻量级的 Alpine Linux 上的 Temurin JDK 21 运行时环境</li>
<li><code>WORKDIR /app</code>: 设置工作目录为 /app</li>
<li><code>COPY target/lib/external/*.jar ./lib/external/</code>: 将外部依赖复制到镜像中，这是最稳定的层</li>
<li><code>COPY target/lib/internal/*.jar ./lib/internal/</code>: 将内部依赖复制到镜像中，这层比外部依赖更可能变化</li>
<li><code>COPY target/classes ./classes</code>: 将应用程序类文件复制到镜像中，这层最容易发生变化</li>
<li><code>EXPOSE 8080</code>: 暴露应用程序端口</li>
<li><code>ENV</code> 指令设置 JVM 参数：</li>
</ul>

<ul>
<li>
<ul>
<li><code>CUSTOM_OPTS</code>: 自定义 JVM 参数，设置初始堆内存和最大堆内存</li>
<li><code>JAVA_OPTS</code>: Java 虚拟机选项，启用预览特性和使用串行垃圾收集器</li>
</ul>
</li>
</ul>

<ul>
<li><code>ENTRYPOINT</code>: 定义容器启动时执行的命令，使用类路径包含所有依赖和应用程序类</li>
</ul>
<p>类路径说明：<br/>
<code>-cp /app/classes:/app/lib/external/*:/app/lib/internal/*</code> 指定了类路径的顺序：</p>
<ol>
<li><code>/app/classes</code>: 应用程序编译后的类文件优先级最高</li>
<li><code>/app/lib/external/*</code>: 外部依赖次之</li>
<li><code>/app/lib/internal/*</code>: 内部依赖最后</li>
</ol>
<p>这种顺序确保了应用程序类可以覆盖依赖中的同名类（如果需要的话），并且保证了正确的类加载顺序。</p>
<h3 data-id="heading-7">3. 构建过程详解</h3>
<h4 data-id="heading-8">Maven 构建生命周期集成</h4>
<p>当执行 <code>mvn package</code> 命令时，Maven 会按照以下顺序执行构建阶段：</p>
<ol>
<li><code>validate</code> - 验证项目正确性</li>
<li><code>compile</code> - 编译源代码</li>
<li><code>test</code> - 运行测试</li>
<li><code>package</code> - 打包应用程序</li>
</ol>
<p>在 <code>package</code> 阶段，<code>maven-dependency-plugin</code> 会自动执行我们配置的两个依赖复制任务：</p>
<ol>
<li>首先执行 <code>copy-external-dependencies</code>，将外部依赖复制到 <code>target/lib/external/</code></li>
<li>然后执行 <code>copy-internal-dependencies</code>，将内部依赖复制到 <code>target/lib/internal/</code></li>
<li>同时，Maven 默认会将编译后的类文件放在 <code>target/classes/</code> 目录中</li>
</ol>
<h4 data-id="heading-9">完整构建步骤</h4>
<ol>
<li>清理并打包应用程序：</li>
</ol>
<pre><code class="hljs language-go" lang="go">mvn clean <span class="hljs-keyword">package</span>
</code></pre>
<p>此命令会触发依赖分离过程，生成三个目录：</p>
<ul>
<li>
<ul>
<li><code>target/classes/</code> - 应用程序编译后的类文件</li>
<li><code>target/lib/external/</code> - 外部依赖 JAR 文件</li>
<li><code>target/lib/internal/</code> - 内部依赖 JAR 文件</li>
</ul>
</li>
</ul>
<ol start="2">
<li>构建 Docker 镜像：</li>
</ol>
<pre><code class="hljs language-erlang" lang="erlang">docker build -t sp3-layer .
</code></pre>
<p>Docker 构建过程会按顺序创建四个层：</p>
<ul>
<li>
<ul>
<li>基础镜像层（eclipse-temurin:21-jre-alpine）</li>
<li>外部依赖层（COPY target/lib/external/*.jar）</li>
<li>内部依赖层（COPY target/lib/internal/*.jar）</li>
<li>应用程序类层（COPY target/classes）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">构建优化效果</h4>
<p>由于 Docker 的层缓存机制：</p>
<ul>
<li>当只修改应用程序代码时，只有最后一层需要重建</li>
<li>当添加新的外部依赖时，需要重建外部依赖层及其后的所有层</li>
<li>当添加新的内部依赖时，需要重建内部依赖层和应用程序类层</li>
<li>只有基础镜像变更时，才需要完全重建</li>
</ul>
<h2 data-id="heading-11">优势</h2>
<ol>
<li><strong>更快的构建速度</strong>：代码更改时只需重新构建应用程序代码层</li>
<li><strong>更小的传输量</strong>：推送到注册中心时，只传输更改的层</li>
<li><strong>更好的缓存效果</strong>：依赖层在各个构建之间缓存并重用</li>
<li><strong>减少带宽消耗</strong>：在 CI/CD 流水线中减少数据传输</li>
</ol>
<h2 data-id="heading-12">版本更新工作流程</h2>
<ol>
<li>在应用程序中进行代码更改</li>
<li>运行 <code>mvn clean package</code> 仅重新编译更改的代码</li>
<li>运行 <code>docker build -t sp3-layer:v2 .</code> 构建新镜像</li>
<li>只有 <code>target/classes</code> 层会被重新构建</li>
<li>只将更改的层推送到容器注册中心</li>
</ol>
<h2 data-id="heading-13">配置自定义指南</h2>
<p>要将此配置应用于其他项目，您需要根据项目的依赖结构调整配置：</p>
<h3 data-id="heading-14">修改依赖分组</h3>
<p>如果您有不同的内部依赖，需要修改 <code>excludeGroupIds</code> 和 <code>includeGroupIds</code> 配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 外部依赖配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>com.yourcompany,org.another.internal.group<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 内部依赖配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>com.yourcompany,org.another.internal.group<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
</code></pre>
<h2 data-id="heading-15">最佳实践</h2>
<ol>
<li><strong>顺序很重要</strong>：首先复制不经常更改的层</li>
<li><strong>最小化层数</strong>：只分离实际在不同频率下更改的内容</li>
<li><strong>多阶段构建</strong>：考虑与多阶段构建结合使用以获得更小的最终镜像</li>
<li><strong>缓存失效</strong>：了解 Docker 的层缓存机制以最大化收益</li>
</ol>
<p>这种方法可以显著减少 CI/CD 流水线中的构建时间，并在部署更新时最小化网络传输。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。]]></title>    <link>https://juejin.cn/post/7583969283790061622</link>    <guid>https://juejin.cn/post/7583969283790061622</guid>    <pubDate>2025-12-16T02:43:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583969283790061622" data-draft-id="7583984122235027498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-16T02:43:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:43:56.000Z" title="Tue Dec 16 2025 02:43:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>逛逛在 11 月发了一篇文章，盘点了 GitHub 上 AI 操纵手机的开源项目。</p>
<p>获得了 3 万多阅读，3000 多人转发收藏：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd8410fb07046d8b8a6f6db0a62988d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=gPXulglpgqrxG9q4eQbYdwXMbEE%3D" alt="图片" loading="lazy"/></p>
<p>没想到那篇文章发布 5 天后，豆包就官宣推出了 AI 手机，紧接着智谱 AI 就开源了 AutoGLM 模型。</p>
<p>我又搜罗了几个 AI 操作手机的开源项目，再加上我之前发的那篇。整个 GitHub 上关于 AI 控制手机的项目算是被逛逛搜刮干净了。</p>
<p>欢迎收藏转发👏</p>
<h2 data-id="heading-0">01、智谱开源：Open-AutoGLM</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da34e068012e4bc0bd7c51154d930bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=WbikuqLDP0%2FID5RLuXWW92pCQrk%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>这个开源项目太顶了，不到一周就 1.3 万的 Star 了。</p>
<p>基于这个开源框架，就能让 AI 可以<strong>像人眼一样看手机屏幕</strong>，然后像人手一样去点击。</p>
<p>你给它一个任务，比如：帮我总结下长春的景点，到高德地图上收藏一下这几个景点，特别是具体看看博物馆门票价格，再去12306上订一张上午十点从北京去长春的高铁票，把相关信息整理好给我。</p>
<p>AutoGLM 会先把手机屏幕截个图，模型会分析截图，通过视觉定位找到当前要点击哪个按钮或者做啥操作。</p>
<p>并通过 ADB（Android Debug Bridge）工具，直接向手机发送点击、滑动、输入文字的指令。</p>
<p>最终这样一步步模拟人看手机、操纵手机的行为，完成你给的任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64e6aa6b09424c75b4fdaa5772bc82e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=wpzrBWk26HX97tTekzAskgdwF8s%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/zai-org/Open-AutoGLM</span>
</code></pre>
<p>而且这个开源可以本地部署，而且如果你有显卡，大约需要 24GB+ 显存，你可以把这个 Agent 跑在本地。</p>
<p>隐私数据，比如聊天记录、支付画面啥的不上传到云端也能自动化的你的安卓手机了。</p>
<p>如何使用</p>
<p>你可以使用Claude Code，配置 GLM Coding Plan 后，输入以下提示词，快速部署本项目。 </p>
<pre><code class="hljs language-bash" lang="bash">访问文档，为我安装 AutoGLM ：https://raw.githubusercontent.com/zai-org/Open-AutoGLM/refs/heads/main/README.md
</code></pre>
<h2 data-id="heading-1">02、通过 MCP 控制手机：DroidMind</h2>
<p><strong>DroidMind 这个开源项目的的核心逻辑是不自己训练一个新模型，而是做一个</strong> <strong>超级适配器</strong>。</p>
<p>它通过 MCP 协议，把你的 <strong>Android 手机</strong>直接挂载到 <strong>Claude Desktop</strong>、<strong>Cursor</strong> 或者 Claude <strong>Code</strong> 上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b02d0991fb2a43488648ebd3373427ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=ZyI3vsHOF6tLB5rtRPlXnQvddEM%3D" alt="图片" loading="lazy"/></p>
<p>你不需要运行一个沉重的本地模型。</p>
<p>你直接用最聪明的 <strong>Claude 或 Gemini</strong>，通过 DroidMind 这个翻译官，直接操控你的安卓手机。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8675948f544464986d155332699dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=l4ZxsDMfoe0IMphZqUryM7iUZSI%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/hyperb1iss/DroidMind</span>
</code></pre>
<h2 data-id="heading-2">03、微软开源：UFO</h2>
<p>这个叫 UFO 的开源项目其实是微软开源的 AI 操作 Windows 系统的开源项目。</p>
<p>只不过 11 月推出的 UFO³ Galaxy 已经演变成了一个<strong>跨设备、跨平台的编排框架。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b417d760183748f090dae85f029b2531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=xJbKxU1sIV9N1HQhBISkQzbImJA%3D" alt="图片" loading="lazy"/><strong>UFO³ Galaxy</strong> 涉及到操纵 <strong>Android 手机设备</strong>的部分是这次更新的核心亮点之一。它也是通过引入 <strong>MCP 架构来实现的，这使得 UFO 不再局限于 Windows，而是能像指挥官一样控制安卓手机。</strong><br/>
<strong><strong><strong><strong>UFO³ Galaxy</strong> 是一个</strong>多设备编排系统</strong>。它的核心理念包含两个部分。</strong></p>
<ul>
<li>Galaxy (星系)：整个控制中枢，负责分发任务。</li>
<li>Constellation (星座)：它将一个复杂的用户指令，比如把手机上的刚拍的照片传到电脑并用 Photoshop 编辑，拆解成一个 DAG（有向无环图）。</li>
</ul>
<p>Windows 电脑、Linux 服务器、<strong>Android 手机</strong> 等都作为独立的节点接入这个网络。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd0c8f3f4526455695729b40dc244788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=9pxL%2FnAnkqzhnRzTDxKoFdSNlZ4%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/microsoft/UFO</span>
</code></pre>
<h2 data-id="heading-3">04、字节开源：UI-TARS</h2>
<p>字节跳动开源的一个基于视觉-语言模型（VLM）的 GUI 智能体（Agent）项目。</p>
<p>它的核心目标是让 AI 像人类一样，通过视觉识别屏幕和操作鼠标/键盘/触控，直接控制手机、计算机或网页。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b02bf798394c6796467a71a90fecc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=7O9xIgwUtSHFyzxOZb7Vh80wWtI%3D" alt="图片" loading="lazy"/><strong>安卓手机设备操纵，</strong> UI-TARS 采用了一种<strong>端到端、纯视觉驱动、基于 ADB</strong> 的控制方案。</p>
<p>也是截取手机屏幕画面，把截图输入给视觉模型，模型结合用户的指令分析屏幕上的元素，决定下一步做什么。</p>
<p>最后模型输出具体的动作指令，转化为底层的 Android ADB 命令发送给手机执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1610839b4d4f7b88f7c69b7653c7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=PIk7p7%2BqJx7i1I4rR5t9UmhPEPA%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/bytedance/UI-TARS</span>
</code></pre>
<p>另外之前发布的另外一个盘点 AI 控制手机开源项目的链接如下，感兴趣的可以去看看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxNjg4NDEzNA%3D%3D%26mid%3D2247529132%26idx%3D1%26sn%3D0b45b857cfd67f9144472f2017f46a14%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxNjg4NDEzNA==&amp;mid=2247529132&amp;idx=1&amp;sn=0b45b857cfd67f9144472f2017f46a14&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">5 个 AI 操纵手机的 GitHub 项目，牛逼了。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零到一：打造企业级 Vue 3 高性能表格组件的设计哲学与实践]]></title>    <link>https://juejin.cn/post/7584472215975690255</link>    <guid>https://juejin.cn/post/7584472215975690255</guid>    <pubDate>2025-12-17T09:52:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215975690255" data-draft-id="7584408254820384803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零到一：打造企业级 Vue 3 高性能表格组件的设计哲学与实践"/> <meta itemprop="keywords" content="前端,Vue.js,架构"/> <meta itemprop="datePublished" content="2025-12-17T09:52:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大象的鼻子那么长"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零到一：打造企业级 Vue 3 高性能表格组件的设计哲学与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大象的鼻子那么长
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 融会贯通" title="VIP.4 融会贯通" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:52:27.000Z" title="Wed Dec 17 2025 09:52:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文将深入剖析一个企业级 Vue 3 表格组件的架构设计、性能优化策略与工程化实践，涵盖 Composition API 深度应用、响应式系统优化、TypeScript 类型体操等核心技术点。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在企业级 B 端应用开发中，表格组件堪称"兵家必争之地"——它承载着数据展示、交互操作、状态管理等核心职责，其设计质量直接影响着整个系统的用户体验与可维护性。</p>
<p>本文将以笔者主导设计的 <code>CmcCardTable</code> 组件为例，系统性地阐述：</p>
<ul>
<li>🎯 <strong>架构设计</strong>：如何运用 Composition API 实现关注点分离</li>
<li>⚡ <strong>性能优化</strong>：响应式系统的精细化调优策略</li>
<li>🔒 <strong>类型安全</strong>：TypeScript 在复杂组件中的深度实践</li>
<li>🧪 <strong>工程质量</strong>：可测试性设计与单元测试最佳实践</li>
</ul>
<hr/>
<h2 data-id="heading-1">一、架构设计：Composables 模式的深度实践</h2>
<h3 data-id="heading-2">1.1 从"上帝组件"到"关注点分离"</h3>
<p>传统的表格组件往往会演变成一个庞大的"上帝组件"（God Component），动辄数千行代码，维护成本极高。我们采用 <strong>Composables 模式</strong> 将表格的核心功能解耦为独立的组合式函数：</p>
<pre><code class="hljs language-bash" lang="bash">src/components/CmcCardTable/
├── CmcCardTable.vue          <span class="hljs-comment"># 主组件（视图层）</span>
├── composables/
│   ├── useTableSelection.ts  <span class="hljs-comment"># 选择状态管理</span>
│   ├── useTableExpand.ts     <span class="hljs-comment"># 展开/折叠逻辑</span>
│   ├── useTableSort.ts       <span class="hljs-comment"># 排序功能</span>
│   └── useTableLayout.ts     <span class="hljs-comment"># 布局计算</span>
├── types.ts                  <span class="hljs-comment"># 类型定义</span>
└── SubRowGrid.vue            <span class="hljs-comment"># 子行网格组件</span>
</code></pre>
<p>这种架构带来的收益：</p>






























<table><thead><tr><th>维度</th><th>传统方案</th><th>Composables 方案</th></tr></thead><tbody><tr><td>单文件代码量</td><td>3000+ 行</td><td>主组件 &lt; 800 行</td></tr><tr><td>可测试性</td><td>需要挂载整个组件</td><td>可独立单元测试</td></tr><tr><td>复用性</td><td>难以复用</td><td>可跨组件复用</td></tr><tr><td>认知负载</td><td>高</td><td>低（单一职责）</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 Composable 的设计原则</h3>
<p>以 <code>useTableSelection</code> 为例，一个优秀的 Composable 应遵循以下原则：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSelection.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseTableSelectionOptions</span> {
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">TableRow</span>[]&gt;
  <span class="hljs-attr">rowKey</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">selectionMode</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">SelectionMode</span>&gt;
  <span class="hljs-attr">selectedRowKeys</span>: <span class="hljs-title class_">Ref</span>&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;
  reserveSelection?: <span class="hljs-built_in">boolean</span>
  selectable?: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>  <span class="hljs-comment">// 🆕 行级选择控制</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseTableSelectionReturn</span> {
  <span class="hljs-attr">internalSelectedKeys</span>: <span class="hljs-title class_">Ref</span>&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;
  <span class="hljs-attr">selectionState</span>: <span class="hljs-title class_">ComputedRef</span>&lt;{
    <span class="hljs-attr">isAllSelected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">isIndeterminate</span>: <span class="hljs-built_in">boolean</span>
  }&gt;
  <span class="hljs-attr">isRowSelected</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">isRowSelectable</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">handleRowSelect</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow, selected: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">handleSingleSelect</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">handleSelectAll</span>: <span class="hljs-function">(<span class="hljs-params">selected: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">clearSelection</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">getAllSelectedRows</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">TableRow</span>[]
}
</code></pre>
<p><strong>设计要点</strong>：</p>
<ol>
<li><strong>显式的输入/输出接口</strong>：通过 TypeScript 接口明确定义 Options 和 Return，消除隐式依赖</li>
<li><strong>响应式数据作为参数</strong>：传入 <code>Ref</code> 而非原始值，保持响应式链路</li>
<li><strong>纯函数式设计</strong>：无副作用，所有状态变更都是显式的</li>
</ol>
<hr/>
<h2 data-id="heading-4">二、响应式系统的精细化优化</h2>
<h3 data-id="heading-5">2.1 shallowRef vs ref：内存与性能的权衡</h3>
<p>在处理大数据量表格时，响应式系统的开销不容忽视。我们采用分层的响应式策略：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 反模式：深层响应式导致不必要的依赖追踪</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">ref</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// ✅ 优化方案：使用 shallowRef 减少响应式开销</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// 更新时手动触发响应</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSelection</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, row: TableRow</span>) {
  <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(selectedRowsMap.<span class="hljs-property">value</span>)
  newMap.<span class="hljs-title function_">set</span>(key, row)
  selectedRowsMap.<span class="hljs-property">value</span> = newMap  <span class="hljs-comment">// 触发响应式更新</span>
}
</code></pre>
<p><strong>性能对比</strong>（1000 行数据场景）：</p>




















<table><thead><tr><th>方案</th><th>内存占用</th><th>批量选择耗时</th></tr></thead><tbody><tr><td>ref + Map</td><td>~2.4MB</td><td>~45ms</td></tr><tr><td>shallowRef + Map</td><td>~1.8MB</td><td>~12ms</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 Computed 依赖的精准控制</h3>
<p><code>computed</code> 的依赖追踪是自动的，但这也可能导致"过度追踪"问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 反模式：整个 data 数组变化都会触发重计算</span>
<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> allKeys = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-comment">// ...</span>
})

<span class="hljs-comment">// ✅ 优化方案：只追踪必要的依赖</span>
<span class="hljs-keyword">const</span> selectableRows = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> 
  data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> <span class="hljs-title function_">isRowSelectable</span>(row, index))
)

<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> selectableKeys = selectableRows.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-keyword">const</span> selectedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(internalSelectedKeys.<span class="hljs-property">value</span>)
  
  <span class="hljs-keyword">const</span> selectedCount = selectableKeys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> selectedSet.<span class="hljs-title function_">has</span>(key)).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> totalSelectable = selectableKeys.<span class="hljs-property">length</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">isAllSelected</span>: totalSelectable &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount === totalSelectable,
    <span class="hljs-attr">isIndeterminate</span>: selectedCount &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount &lt; totalSelectable,
  }
})
</code></pre>
<h3 data-id="heading-7">2.3 Watch 的防抖与节流策略</h3>
<p>对于高频变化的数据源，直接 watch 可能导致性能问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableExpand.ts</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> data.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>,  <span class="hljs-comment">// 👈 只监听长度变化，而非整个数组</span>
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (defaultExpandAll.<span class="hljs-property">value</span>) {
      <span class="hljs-title function_">initializeExpandedKeys</span>()
    }
  },
  { <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span> }  <span class="hljs-comment">// 👈 在 DOM 更新后执行，避免重复计算</span>
)
</code></pre>
<hr/>
<h2 data-id="heading-8">三、TypeScript 类型体操：从"能用"到"好用"</h2>
<h3 data-id="heading-9">3.1 泛型约束与条件类型</h3>
<p>为了让 API 更加智能，我们使用了条件类型来约束参数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableColumn</span>&lt;T = <span class="hljs-title class_">TableRow</span>&gt; {
  <span class="hljs-attr">key</span>: keyof T | <span class="hljs-built_in">string</span>
  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>
  width?: <span class="hljs-built_in">string</span>
  flex?: <span class="hljs-built_in">string</span>
  align?: <span class="hljs-string">'left'</span> | <span class="hljs-string">'center'</span> | <span class="hljs-string">'right'</span>
  sortable?: <span class="hljs-built_in">boolean</span>
  
  <span class="hljs-comment">// 条件渲染函数</span>
  render?: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span>, row: T, column: TableColumn&lt;T&gt;</span>) =&gt;</span> <span class="hljs-built_in">string</span>
  
  <span class="hljs-comment">// 行操作项（支持静态配置和动态函数）</span>
  actionItems?: <span class="hljs-title class_">ActionItem</span>[] | (<span class="hljs-function">(<span class="hljs-params">row: T</span>) =&gt;</span> <span class="hljs-title class_">ActionItem</span>[])
}

<span class="hljs-comment">// 使用泛型约束行数据类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRow</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">orderNo</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span> | <span class="hljs-string">'confirmed'</span> | <span class="hljs-string">'shipped'</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>&lt;<span class="hljs-title class_">OrderRow</span>&gt;[] = [
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'status'</span>,  <span class="hljs-comment">// ✅ IDE 自动补全，类型安全</span>
    <span class="hljs-attr">label</span>: <span class="hljs-string">'状态'</span>,
    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> statusMap[value <span class="hljs-keyword">as</span> <span class="hljs-title class_">OrderRow</span>[<span class="hljs-string">'status'</span>]]
  }
]
</code></pre>
<h3 data-id="heading-10">3.2 事件类型的完整定义</h3>
<p>为组件事件提供完整的类型定义，让使用方获得最佳的开发体验：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义强类型的 emit 接口</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableEmits</span> {
  <span class="hljs-string">'update:selectedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]]
  <span class="hljs-string">'update:expandedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]]
  <span class="hljs-string">'selection-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">selectedRowKeys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]
  }]
  <span class="hljs-string">'select'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">row</span>: <span class="hljs-title class_">TableRow</span>
    <span class="hljs-attr">selected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
  <span class="hljs-string">'select-all'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">selected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">selectionChanges</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
  <span class="hljs-string">'sort-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">column</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
    <span class="hljs-attr">order</span>: <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> | <span class="hljs-literal">null</span>
    <span class="hljs-attr">sortState</span>: <span class="hljs-title class_">SortState</span>
  }]
  <span class="hljs-string">'expand-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">row</span>: <span class="hljs-title class_">TableRow</span>
    <span class="hljs-attr">expanded</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">expandedRows</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
}

<span class="hljs-comment">// 组件中使用</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;<span class="hljs-title class_">TableEmits</span>&gt;()
</code></pre>
<h3 data-id="heading-11">3.3 Props 的智能默认值</h3>
<p>利用 TypeScript 的类型推导，实现带默认值的 Props 定义：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(
  defineProps&lt;{
    data?: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>[]
    rowKey?: <span class="hljs-built_in">string</span>
    selectionMode?: <span class="hljs-title class_">SelectionMode</span>
    selectable?: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
    reserveSelection?: <span class="hljs-built_in">boolean</span>
    defaultExpandAll?: <span class="hljs-built_in">boolean</span>
  }&gt;(),
  {
    <span class="hljs-attr">data</span>: <span class="hljs-function">() =&gt;</span> [],
    <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
    <span class="hljs-attr">selectionMode</span>: <span class="hljs-string">'none'</span>,
    <span class="hljs-attr">selectable</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 默认所有行可选</span>
    <span class="hljs-attr">reserveSelection</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">defaultExpandAll</span>: <span class="hljs-literal">false</span>,
  }
)
</code></pre>
<hr/>
<h2 data-id="heading-12">四、高级特性实现剖析</h2>
<h3 data-id="heading-13">4.1 跨分页选择保持（Reserve Selection）</h3>
<p>在分页场景下，如何保持用户的选择状态是一个经典问题。我们的解决方案：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 Map 存储选中行的完整数据，而非仅存储 key</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// 数据变化时的处理策略</span>
<span class="hljs-title function_">watch</span>(data, <span class="hljs-function">(<span class="hljs-params">newData</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!reserveSelection) {
    <span class="hljs-comment">// 非保留模式：清除不在新数据中的选中项</span>
    <span class="hljs-keyword">const</span> newDataKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(newData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey]))
    <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;()
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, row] <span class="hljs-keyword">of</span> selectedRowsMap.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">if</span> (newDataKeys.<span class="hljs-title function_">has</span>(key)) {
        newMap.<span class="hljs-title function_">set</span>(key, row)
      }
    }
    selectedRowsMap.<span class="hljs-property">value</span> = newMap
  }
  <span class="hljs-comment">// 保留模式：Map 中的数据不会被清除，即使该行不在当前页</span>
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">false</span> })

<span class="hljs-comment">// 获取所有选中行数据（跨分页）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllSelectedRows</span>(<span class="hljs-params"/>): <span class="hljs-title class_">TableRow</span>[] {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(selectedRowsMap.<span class="hljs-property">value</span>.<span class="hljs-title function_">values</span>())
}
</code></pre>
<p><strong>核心思想</strong>：将选中行的完整数据存储在 Map 中，而非仅存储 key。这样即使数据源（当前页）不包含某些选中行，我们依然可以获取其完整信息。</p>
<h3 data-id="heading-14">4.2 部分行禁用选择（Selectable）</h3>
<p>业务场景中常需要根据行数据动态禁用选择，我们通过 <code>selectable</code> 函数实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 判断行是否可选择
 * <span class="hljs-doctag">@description</span> 支持业务自定义禁用逻辑
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isRowSelectable</span>(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">if</span> (!selectable) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">selectable</span>(row, index)
}

<span class="hljs-comment">// 全选逻辑需要排除不可选行</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSelectAll</span>(<span class="hljs-params">selected: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> selectableRows = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> 
    <span class="hljs-title function_">isRowSelectable</span>(row, index)
  )
  
  <span class="hljs-keyword">if</span> (selected) {
    <span class="hljs-comment">// 只选中可选的行</span>
    selectableRows.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = row[rowKey]
      <span class="hljs-keyword">if</span> (!internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(key)) {
        internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(key)
        selectedRowsMap.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(key, row)
      }
    })
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 只取消可选行的选中状态</span>
    <span class="hljs-keyword">const</span> selectableKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(selectableRows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey]))
    internalSelectedKeys.<span class="hljs-property">value</span> = internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> !selectableKeys.<span class="hljs-title function_">has</span>(key)
    )
  }
}

<span class="hljs-comment">// 计算全选状态时只考虑可选行</span>
<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> selectableRows = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> 
    <span class="hljs-title function_">isRowSelectable</span>(row, index)
  )
  <span class="hljs-keyword">const</span> selectableKeys = selectableRows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-keyword">const</span> selectedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(internalSelectedKeys.<span class="hljs-property">value</span>)
  
  <span class="hljs-keyword">const</span> selectedCount = selectableKeys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> selectedSet.<span class="hljs-title function_">has</span>(key)).<span class="hljs-property">length</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">isAllSelected</span>: selectableKeys.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount === selectableKeys.<span class="hljs-property">length</span>,
    <span class="hljs-attr">isIndeterminate</span>: selectedCount &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount &lt; selectableKeys.<span class="hljs-property">length</span>,
  }
})
</code></pre>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;CmcCardTable
    v-model:selected-row-keys="selectedKeys"
    :data="tableData"
    :columns="columns"
    selection-mode="multiple"
    :selectable="(row) =&gt; row.status !== 'locked'"
  /&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-15">4.3 远程排序与本地排序的统一抽象</h3>
<p>支持本地排序和远程排序两种模式，通过配置切换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSort.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTableSort</span>(<span class="hljs-params">options: UseTableSortOptions</span>) {
  <span class="hljs-keyword">const</span> { data, defaultSort, remoteSort, onSortChange } = options
  
  <span class="hljs-comment">// 当前排序状态</span>
  <span class="hljs-keyword">const</span> sortState = shallowRef&lt;<span class="hljs-title class_">SortState</span>&gt;({
    <span class="hljs-attr">column</span>: defaultSort?.<span class="hljs-property">column</span> ?? <span class="hljs-literal">null</span>,
    <span class="hljs-attr">order</span>: defaultSort?.<span class="hljs-property">order</span> ?? <span class="hljs-literal">null</span>,
  })
  
  <span class="hljs-comment">// 排序后的数据</span>
  <span class="hljs-keyword">const</span> sortedData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 远程排序模式：直接返回原数据，排序由后端处理</span>
    <span class="hljs-keyword">if</span> (remoteSort?.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    }
    
    <span class="hljs-comment">// 本地排序模式</span>
    <span class="hljs-keyword">if</span> (!sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span> || !sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span>) {
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    }
    
    <span class="hljs-keyword">return</span> [...data.<span class="hljs-property">value</span>].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> aVal = a[sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>!]
      <span class="hljs-keyword">const</span> bVal = b[sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>!]
      <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">compareValues</span>(aVal, bVal)
      <span class="hljs-keyword">return</span> sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'desc'</span> ? -result : result
    })
  })
  
  <span class="hljs-comment">// 切换排序</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleSort</span>(<span class="hljs-params">column: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> newOrder = <span class="hljs-title function_">getNextSortOrder</span>(sortState.<span class="hljs-property">value</span>, column)
    sortState.<span class="hljs-property">value</span> = { <span class="hljs-attr">column</span>: newOrder ? column : <span class="hljs-literal">null</span>, <span class="hljs-attr">order</span>: newOrder }
    
    <span class="hljs-comment">// 触发事件，交由父组件处理（远程排序时调用接口）</span>
    onSortChange?.({
      <span class="hljs-attr">column</span>: sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>,
      <span class="hljs-attr">order</span>: sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span>,
      <span class="hljs-attr">sortState</span>: sortState.<span class="hljs-property">value</span>,
    })
  }
  
  <span class="hljs-keyword">return</span> { sortState, sortedData, toggleSort }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">五、工程化实践：可测试性设计</h2>
<h3 data-id="heading-17">5.1 Composable 的单元测试</h3>
<p>得益于 Composables 的独立性，我们可以脱离组件进行单元测试：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSelection.test.ts</span>
<span class="hljs-keyword">import</span> { describe, it, expect, vi } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useTableSelection } <span class="hljs-keyword">from</span> <span class="hljs-string">'../useTableSelection'</span>

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'useTableSelection'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">createTestData</span> = (<span class="hljs-params"/>) =&gt; [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'locked'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
  ]

  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'selectable 部分禁用'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'全选时应只选中可选行'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = ref&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;([])
      
      <span class="hljs-keyword">const</span> { handleSelectAll, internalSelectedKeys } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">selectable</span>: <span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>,  <span class="hljs-comment">// 只有 active 可选</span>
      })
      
      <span class="hljs-title function_">handleSelectAll</span>(<span class="hljs-literal">true</span>)
      
      <span class="hljs-comment">// 应只选中 id=1 和 id=3（status='active'）</span>
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-title function_">toEqual</span>([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>])
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toContain</span>(<span class="hljs-number">2</span>)
    })
    
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'isIndeterminate 应只基于可选行计算'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>])  <span class="hljs-comment">// 选中一个可选行</span>
      
      <span class="hljs-keyword">const</span> { selectionState } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">selectable</span>: <span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>,
      })
      
      <span class="hljs-comment">// 可选行有 2 个（id=1,3），选中了 1 个，应为半选状态</span>
      <span class="hljs-title function_">expect</span>(selectionState.<span class="hljs-property">value</span>.<span class="hljs-property">isIndeterminate</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
      <span class="hljs-title function_">expect</span>(selectionState.<span class="hljs-property">value</span>.<span class="hljs-property">isAllSelected</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    })
  })
  
  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'reserveSelection 跨分页保留'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'应保留不在当前页的选中数据'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">99</span>])  <span class="hljs-comment">// 99 不在当前数据中</span>
      
      <span class="hljs-keyword">const</span> { internalSelectedKeys, getAllSelectedRows } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">reserveSelection</span>: <span class="hljs-literal">true</span>,
      })
      
      <span class="hljs-comment">// key 99 应被保留</span>
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-number">99</span>)
    })
  })
})
</code></pre>
<h3 data-id="heading-18">5.2 测试覆盖率与质量保障</h3>
<p>我们为核心 Composables 编写了全面的单元测试：</p>
<pre><code class="hljs language-scss" lang="scss">✓ useTableSelection<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span> (<span class="hljs-number">25</span> tests)
✓ useTableExpand<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>    (<span class="hljs-number">27</span> tests)
✓ useTableSort<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>      (<span class="hljs-number">22</span> tests)
✓ useTableLayout<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>    (<span class="hljs-number">31</span> tests)

Total: <span class="hljs-number">105</span> tests passed
</code></pre>
<p>测试用例覆盖：</p>
<ul>
<li>✅ 正常流程</li>
<li>✅ 边界条件（空数据、重复操作等）</li>
<li>✅ 模式切换（单选/多选/禁用）</li>
<li>✅ 响应式同步</li>
<li>✅ 事件触发</li>
</ul>
<hr/>
<h2 data-id="heading-19">六、API 设计的艺术：向 Element Plus 学习</h2>
<h3 data-id="heading-20">6.1 Props 命名的一致性</h3>
<p>我们在 API 设计上尽量与 Element Plus 保持一致，降低用户的学习成本：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Element Plus Table --&gt;
&lt;el-table
  :data="tableData"
  :row-key="rowKey"
  :default-sort="{ prop: 'date', order: 'descending' }"
  @selection-change="handleSelectionChange"
  @sort-change="handleSortChange"
&gt;
  &lt;el-table-column type="selection" /&gt;
  &lt;el-table-column type="index" /&gt;
  &lt;el-table-column type="expand" /&gt;
&lt;/el-table&gt;

&lt;!-- CmcCardTable（风格一致） --&gt;
&lt;CmcCardTable
  :data="tableData"
  :row-key="rowKey"
  :default-sort="{ column: 'date', order: 'desc' }"
  @selection-change="handleSelectionChange"
  @sort-change="handleSortChange"
  :columns="[
    { key: 'selection', type: 'selection' },
    { key: 'index', type: 'index' },
    { key: 'expand', type: 'expand' },
  ]"
/&gt;
</code></pre>
<h3 data-id="heading-21">6.2 渐进式的功能启用</h3>
<p>通过 Props 开关式地启用功能，保持 API 的简洁性：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 最简用法 --&gt;
&lt;CmcCardTable :data="data" :columns="columns" /&gt;

&lt;!-- 启用选择 --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
/&gt;

&lt;!-- 启用选择 + 部分禁用 --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
  :selectable="row =&gt; row.status === 'active'"
/&gt;

&lt;!-- 启用选择 + 跨分页保留 + 部分禁用 --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
  reserve-selection
  :selectable="row =&gt; row.status === 'active'"
/&gt;
</code></pre>
<hr/>
<h2 data-id="heading-22">七、性能优化清单</h2>



































<table><thead><tr><th>优化点</th><th>技术手段</th><th>效果</th></tr></thead><tbody><tr><td>减少响应式开销</td><td>shallowRef 替代 ref</td><td>内存降低 25%</td></tr><tr><td>避免重复计算</td><td>computed 缓存</td><td>渲染性能提升 40%</td></tr><tr><td>精准依赖追踪</td><td>拆分细粒度 computed</td><td>减少无效更新</td></tr><tr><td>大列表渲染</td><td>CSS Grid 布局</td><td>重排性能提升</td></tr><tr><td>事件处理</td><td>事件委托</td><td>减少监听器数量</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">八、进阶优化：突破性能瓶颈</h2>
<h3 data-id="heading-24">8.1 虚拟滚动支持：突破万级数据渲染</h3>
<p>当表格需要渲染数千甚至上万行数据时，传统的 v-for 渲染会导致严重的性能问题。我们实现了 <code>useVirtualScroll</code> composable 来解决这个问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useVirtualScroll.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useVirtualScroll</span>(<span class="hljs-params">options: UseVirtualScrollOptions</span>) {
  <span class="hljs-keyword">const</span> { data, itemHeight, containerHeight, overscan = <span class="hljs-number">5</span> } = options
  
  <span class="hljs-comment">// 当前滚动位置</span>
  <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
  
  <span class="hljs-comment">// 计算可见范围（起始和结束索引）</span>
  <span class="hljs-keyword">const</span> visibleRange = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop.<span class="hljs-property">value</span> / itemHeight)
    <span class="hljs-keyword">const</span> end = start + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight / itemHeight)
    
    <span class="hljs-comment">// 应用 overscan（预渲染额外行数）</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">start</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, start - overscan),
      <span class="hljs-attr">end</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(data.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>, end + overscan)
    }
  })
  
  <span class="hljs-comment">// 只渲染可见范围内的数据</span>
  <span class="hljs-keyword">const</span> virtualItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { start, end } = visibleRange.<span class="hljs-property">value</span>
    <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(start, end + <span class="hljs-number">1</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, i</span>) =&gt;</span> ({
      <span class="hljs-attr">data</span>: item,
      <span class="hljs-attr">index</span>: start + i,
      <span class="hljs-attr">offsetTop</span>: (start + i) * itemHeight
    }))
  })
  
  <span class="hljs-keyword">return</span> { virtualItems, visibleRange, onScroll, ... }
}
</code></pre>
<p><strong>性能对比</strong>（渲染 10,000 行数据）：</p>

























<table><thead><tr><th>指标</th><th>普通渲染</th><th>虚拟滚动</th></tr></thead><tbody><tr><td>首屏时间</td><td>~3200ms</td><td>~45ms</td></tr><tr><td>DOM 节点数</td><td>10,000+</td><td>~30</td></tr><tr><td>内存占用</td><td>~50MB</td><td>~2MB</td></tr></tbody></table>
<h3 data-id="heading-25">8.2 WeakMap vs Map：内存管理的深层思考</h3>
<p>在 <code>selectedRowsMap</code> 的实现中，我们选择了 <code>Map</code> 而非 <code>WeakMap</code>，这是经过深思熟虑的决定：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 当前方案：使用 shallowRef + Map</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// ❓ 为什么不用 WeakMap？</span>
<span class="hljs-comment">// const selectedRowsMap = shallowRef(new WeakMap&lt;TableRow, boolean&gt;())</span>
</code></pre>
<p><strong>不选择 WeakMap 的原因</strong>：</p>






























<table><thead><tr><th>特性</th><th>Map</th><th>WeakMap</th></tr></thead><tbody><tr><td>键类型</td><td>任意类型</td><td>仅对象</td></tr><tr><td>可枚举</td><td>✅ 支持</td><td>✖️ 不支持</td></tr><tr><td>size 属性</td><td>✅ 有</td><td>✖️ 无</td></tr><tr><td>GC 回收</td><td>手动管理</td><td>自动回收</td></tr></tbody></table>
<p><strong>关键问题</strong>：</p>
<ol>
<li>我们需要用 <code>rowKey</code>（字符串/数字）作为键，WeakMap 只接受对象作为键</li>
<li>我们需要遍历所有选中行（<code>getAllSelectedRows</code>），WeakMap 不可枚举</li>
<li>我们需要知道选中数量，WeakMap 没有 <code>size</code> 属性</li>
</ol>
<p><strong>内存泄漏防护</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 通过 shallowRef 包装，确保随组件生命周期管理</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>())

<span class="hljs-comment">// 组件卸载时，shallowRef 的引用释放，Map 自然被 GC 回收</span>
<span class="hljs-comment">// 无需手动清理</span>
</code></pre>
<h3 data-id="heading-26">8.3 Vue 3.4 defineModel：简化双向绑定</h3>
<p>Vue 3.4 稳定版引入的 <code>defineModel</code> 宏可以大幅简化双向绑定的代码：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ Vue 3.4 之前的写法</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{ <span class="hljs-attr">selectedRowKeys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[] }&gt;()
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{ <span class="hljs-string">'update:selectedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]] }&gt;()

<span class="hljs-comment">// 需要手动同步</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">selectedRowKeys</span>, <span class="hljs-function">(<span class="hljs-params">newKeys</span>) =&gt;</span> {
  internalSelectedKeys.<span class="hljs-property">value</span> = [...newKeys]
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSelection</span>(<span class="hljs-params">keys: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]</span>) {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:selectedRowKeys'</span>, keys)
}

<span class="hljs-comment">// ✅ Vue 3.4+ 使用 defineModel</span>
<span class="hljs-keyword">const</span> selectedRowKeys = defineModel&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;(<span class="hljs-string">'selectedRowKeys'</span>, {
  <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
})

<span class="hljs-keyword">const</span> expandedRowKeys = defineModel&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;(<span class="hljs-string">'expandedRowKeys'</span>, {
  <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
})

<span class="hljs-comment">// 直接修改即可触发更新，无需手动 emit</span>
selectedRowKeys.<span class="hljs-property">value</span> = [...newKeys]
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>减少约 60% 的模板代码</li>
<li>自动处理 props 和 emit 的同步</li>
<li>更直观的双向绑定语义</li>
</ul>
<h3 data-id="heading-27">8.4 Vue Vapor Mode：无虚拟 DOM 的未来</h3>
<p>Vue 3.6 alpha 引入了实验性的 <strong>Vapor Mode</strong>，它完全跳过虚拟 DOM，直接生成 DOM 操作代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 启用 Vapor Mode：只需添加 vapor 关键字 --&gt;
&lt;script setup vapor&gt;
import { ref } from 'vue'
const count = ref(0)
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="count++"&gt;{{ count }}&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p><strong>Vapor Mode 的优势</strong>：</p>
<ul>
<li>🚀 更小的包体积（无 VDOM 运行时）</li>
<li>⚡ 更快的渲染（无 diff/patch 开销）</li>
<li>📊 更低的内存占用</li>
</ul>
<p><strong>兼容性设计</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// CmcCardTable 的 Vapor Mode 兼容性设计</span>
<span class="hljs-keyword">import</span> { vaporInteropPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 在 VDOM 应用中使用 Vapor 组件</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-title function_">use</span>(vaporInteropPlugin)  <span class="hljs-comment">// 启用互操作插件</span>
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

<span class="hljs-comment">// CmcCardTable 可以渐进式迁移到 Vapor Mode</span>
<span class="hljs-comment">// 1. 将性能关键的子组件转为 Vapor</span>
<span class="hljs-comment">// 2. 与现有 VDOM 组件无缝共存</span>
</code></pre>
<p><strong>迁移指南</strong>：</p>






























<table><thead><tr><th>特性</th><th>支持状态</th><th>说明</th></tr></thead><tbody><tr><td>Composition API</td><td>✅ 完全支持</td><td>唯一支持的 API 风格</td></tr><tr><td>Options API</td><td>✖️ 不支持</td><td>需迁移到 Composition API</td></tr><tr><td><code>&lt;Transition&gt;</code></td><td>✖️ 暂不支持</td><td>后续版本支持</td></tr><tr><td>Element Plus</td><td>✅ 支持</td><td>需配合 vaporInteropPlugin</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-28">九、总结与展望</h2>
<p>通过 <code>CmcCardTable</code> 组件的设计实践，我们验证了以下技术方案的可行性：</p>
<ol>
<li><strong>Composables 模式</strong> 是组织复杂组件逻辑的最佳实践</li>
<li><strong>分层响应式策略</strong> 能显著提升大数据量场景下的性能</li>
<li><strong>完备的类型定义</strong> 是提升开发体验的关键</li>
<li><strong>可测试性设计</strong> 应贯穿组件开发的始终</li>
<li><strong>虚拟滚动</strong> 是突破大数据量渲染瓶颈的关键技术</li>
</ol>
<p><strong>已完成的优化</strong>：</p>
<ul>
<li>✅ 虚拟滚动 <code>useVirtualScroll</code> composable</li>
<li>✅ <code>shallowRef</code> + <code>Map</code> 内存管理优化</li>
<li>✅ 部分行禁用选择 <code>selectable</code> 支持</li>
</ul>
<p><strong>未来计划</strong>：</p>
<ul>
<li>🔮 迁移到 Vue 3.4 <code>defineModel</code> 简化双向绑定</li>
<li>🔮 探索 Vapor Mode 零虚拟 DOM 方案</li>
<li>🔮 实现列的拖拽排序与宽度调整</li>
<li>🔮 支持动态行高的虚拟滚动</li>
</ul>
<hr/>
<h2 data-id="heading-29">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Freusability%2Fcomposables.html" target="_blank" title="https://vuejs.org/guide/reusability/composables.html" ref="nofollow noopener noreferrer">Vue 3 Composition API 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2F" target="_blank" title="https://vueuse.org/" ref="nofollow noopener noreferrer">VueUse - Collection of Vue Composition Utilities</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felement-plus%2Felement-plus" target="_blank" title="https://github.com/element-plus/element-plus" ref="nofollow noopener noreferrer">Element Plus Table 源码</a></li>
</ul>
<hr/>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞收藏 ⭐️，你的支持是我持续输出的动力！</p>
<p>有任何问题欢迎在评论区交流讨论 💬</p>
</blockquote>
<p><strong>关于作者</strong>：专注于企业级 Vue 3 应用开发，热衷于组件设计与性能优化。</p>
<hr/>
<p><em>本文首发于掘金，转载请注明出处。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解ThreadLocal]]></title>    <link>https://juejin.cn/post/7583892482599321615</link>    <guid>https://juejin.cn/post/7583892482599321615</guid>    <pubDate>2025-12-16T01:26:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482599321615" data-draft-id="7583955708317696000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解ThreadLocal"/> <meta itemprop="keywords" content="Java,Android,源码"/> <meta itemprop="datePublished" content="2025-12-16T01:26:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="愤怒的代码"/> <meta itemprop="url" content="https://juejin.cn/user/4125023358426190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解ThreadLocal
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023358426190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    愤怒的代码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:26:52.000Z" title="Tue Dec 16 2025 01:26:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>ThreadLocal</code> 是 Java 提供的一个机制，但在 Android 开发，尤其是在理解 <code>Looper</code> 和性能优化时，它扮演着至关重要的角色。</p>
<h3 data-id="heading-0">0x00. <code>ThreadLocal</code> 的核心作用和设计目标</h3>
<h4 data-id="heading-1">核心作用：线程局部变量</h4>
<p><code>ThreadLocal</code> 顾名思义，是<strong>线程的局部变量</strong>。它为每个使用该变量的线程都提供了一个独立的、隔离的变量副本。</p>
<ul>
<li><strong>隔离性：</strong> 当多个线程访问同一个 <code>ThreadLocal</code> 实例时，每个线程看到和操作的都是自己的变量副本，彼此之间互不干扰。</li>
<li><strong>线程安全：</strong> 由于每个线程都有自己的副本，因此天然解决了多线程访问共享变量时的同步问题，<strong>无需使用 <code>synchronized</code> 等锁机制</strong>，从而提升了并发性能。</li>
</ul>
<blockquote>
<p><strong>注意：</strong> <code>ThreadLocal</code> 本身不存储数据，它只是一个访问键（Key）。数据存储在每个线程内部的一个名为 <code>ThreadLocalMap</code> 的结构中。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">0x01. <code>ThreadLocal</code> 的底层原理：<code>ThreadLocalMap</code></h3>
<p>要理解 <code>ThreadLocal</code> 的机制，关键在于理解 <code>Thread</code> 对象内部的一个隐秘字段：</p>
<ol>
<li>
<p><strong>数据存储在哪？</strong></p>
<ul>
<li>每个 <code>java.lang.Thread</code> 对象内部都有一个特殊的成员变量，叫做 <code>ThreadLocal.ThreadLocalMap</code>（注意，这个 Map 是 <code>ThreadLocal</code> 的内部类，但它属于 <code>Thread</code> 实例）。</li>
<li>当你调用 <code>ThreadLocal.set(value)</code> 时，数据实际上是以 <code>(thisThreadLocalInstance, value)</code> 的形式存入了当前线程的 <code>ThreadLocalMap</code> 中。</li>
</ul>
</li>
<li>
<p><strong><code>ThreadLocalMap</code> 的结构：</strong></p>
<ul>
<li><code>ThreadLocalMap</code> 并不是一个普通的 <code>HashMap</code>。它的键（Key）是**弱引用（Weak Reference）**指向 <code>ThreadLocal</code> 对象本身，值（Value）是你要存储的数据。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">0x02. <code>ThreadLocal</code> 在 Android 源码中的应用</h3>
<hr/>
<p><code>ThreadLocal</code> 最著名的应用就是实现 Android 的<strong>消息循环机制</strong>：</p>
<h4 data-id="heading-4">A. 实现 <code>Looper</code> 的单例特性</h4>
<p>我们知道，一个线程只能有一个 <code>Looper</code>。<code>ThreadLocal</code> 是如何保证这一点的？</p>
<ul>
<li>
<p>在 <code>Looper</code> 类中，有一个静态的 <code>ThreadLocal</code> 变量：</p>
<p><code>Looper</code>中定义了 <code>sThreadLocal</code> 静态变量</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;Looper&gt;();
</code></pre>
</li>
<li>
<p><strong><code>Looper.prepare()</code> 的逻辑：</strong></p>
<ol>
<li>调用 <code>sThreadLocal.get()</code> 检查当前线程是否已有 <code>Looper</code>。</li>
<li>如果发现当前线程已经有了 <code>Looper</code>（即 <code>get()</code> 不为空），则抛出异常，强制保证单例。</li>
<li>如果没有，则创建一个新的 <code>Looper</code> 实例，并通过 <code>sThreadLocal.set(newLooper)</code> 将其存入当前线程的 <code>ThreadLocalMap</code> 中。</li>
</ol>
</li>
</ul>
<p>通过这种方式，<code>Looper</code> 机制完美地利用了 <code>ThreadLocal</code> 的隔离性，实现了<strong>线程内的单例</strong>。</p>
<p><code>Looper</code> 代码片段</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">()</span> {
    prepare(<span class="hljs-literal">true</span>);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
    <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Only one Looper may be created per thread"</span>);
    }
    sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
    <span class="hljs-comment">// 获取当前线程实例</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// 从当前线程中获取 ThreadLocalMap</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
        map.set(<span class="hljs-built_in">this</span>, value); <span class="hljs-comment">// ThreadLocal 当作key 把value 保存在 map 中</span>
    <span class="hljs-keyword">else</span>
        createMap(t, value);
}

</code></pre>
<p><code>ThreadLocal</code>代码片段</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 获取当前线程实例</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// 从当前线程中获取 ThreadLocalMap 对象</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// this 就是 ThreadLocal，它是一个 Key</span>
        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
            <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
            <span class="hljs-keyword">return</span> result;
        }
    }
    <span class="hljs-keyword">return</span> setInitialValue();
}

<span class="hljs-comment">// 从 Thread 实例中获取 threadLocals 对象</span>
ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> {
    <span class="hljs-keyword">return</span> t.threadLocals;
}

</code></pre>
<h4 data-id="heading-5">B. 性能优化：避免参数传递</h4>
<p><code>ThreadLocal</code> 可以用来在同一线程内的不同方法或模块之间共享数据，而无需层层传递参数。</p>
<ul>
<li>例如，在一个复杂的 IO 操作流程中，你可以把数据库连接对象存入 <code>ThreadLocal</code>，流程中任何地方都可以直接 <code>get()</code> 拿到，避免了方法签名膨胀。</li>
</ul>
<hr/>
<h3 data-id="heading-6">0x03. 内存泄露风险</h3>
<p>使用 <code>ThreadLocal</code> <strong>最危险的陷阱是内存泄露</strong>，尤其是在 Android 这种长生命周期的环境（如主线程）中。</p>
<h4 data-id="heading-7">A. 风险分析</h4>
<ol>
<li>
<p><strong><code>ThreadLocalMap</code> 的键是弱引用 (<code>WeakReference&lt;ThreadLocal&gt;</code>)。</strong></p>
</li>
<li>
<p><strong><code>ThreadLocalMap</code> 的值是强引用 (<code>Value</code>)。</strong></p>
</li>
<li>
<p>如果线程一直存活（例如主线程），但外部没有引用指向 <code>ThreadLocal</code> 实例，那么：</p>
<ul>
<li>外部的 <code>ThreadLocal</code> 对象会被 GC 回收（因为是弱引用）。</li>
<li><strong>但存储在 <code>ThreadLocalMap</code> 里的 Value 仍然被 Map 强引用，无法被回收。</strong></li>
<li>键（Key）变成了 <code>null</code>，值（Value）还在，导致内存泄露。</li>
</ul>
</li>
</ol>
<p><code>ThreadLocalMap</code>源码片段中可以看到它的 <code>Entry</code> 是一个弱引用</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalMap</span> {

    <span class="hljs-comment">/**
     * The entries in this hash map extend WeakReference, using
     * its main ref field as the key (which is always a
     * ThreadLocal object).  Note that null keys (i.e. entry.get()
     * == null) mean that the key is no longer referenced, so the
     * entry can be expunged from table.  Such entries are referred to
     * as "stale entries" in the code that follows.
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; {
        <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span>
        Object value;

        Entry(ThreadLocal&lt;?&gt; k, Object v) {
            <span class="hljs-built_in">super</span>(k);
            value = v;
        }
    }
    ....
}    
</code></pre>
<h4 data-id="heading-8">B. 解决方案</h4>
<p>为了避免内存泄露，<strong>使用完 <code>ThreadLocal</code> 后，务必调用 <code>ThreadLocal.remove()</code> 方法手动清除存储在 Map 中的 Value。</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// 错误示例：可能导致内存泄露</span>
<span class="hljs-keyword">val</span> localData = ThreadLocal&lt;HeavyObject&gt;()
localData.<span class="hljs-keyword">set</span>(HeavyObject()) 
<span class="hljs-comment">// ... 使用 localData ...</span>
<span class="hljs-comment">// 忘记调用 remove()</span>

<span class="hljs-comment">// 正确做法：</span>
<span class="hljs-keyword">val</span> localData = ThreadLocal&lt;HeavyObject&gt;()
<span class="hljs-keyword">try</span> {
    localData.<span class="hljs-keyword">set</span>(HeavyObject()) 
    <span class="hljs-comment">// ... 使用 localData ...</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 保证在任何情况下都执行清除操作</span>
    localData.remove() 
}
</code></pre>
<h3 data-id="heading-9">0x04. 总结</h3>
<ul>
<li><strong>作用：</strong> 为每个线程提供独立的变量副本，实现线程安全。</li>
<li><strong>原理：</strong> 数据存储在每个线程内部的 <code>ThreadLocalMap</code> 中。</li>
<li><strong>应用：</strong> Android 中用于实现 <code>Looper</code> 的线程内单例。</li>
<li><strong>风险：</strong> 必须调用 <code>remove()</code>，否则可能导致内存泄露。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 pnpm + Workspaces 构建 Monorepo 的完整指南]]></title>    <link>https://juejin.cn/post/7583970267132821510</link>    <guid>https://juejin.cn/post/7583970267132821510</guid>    <pubDate>2025-12-16T02:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132821510" data-draft-id="7583980250733232191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 pnpm + Workspaces 构建 Monorepo 的完整指南"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T02:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 pnpm + Workspaces 构建 Monorepo 的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:05:01.000Z" title="Tue Dec 16 2025 02:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心概念：pnpm Workspace</h2>
<p>pnpm 内置了对 Monorepo（单一代码仓库）的原生支持，通过 <strong>Workspace（工作区）</strong> ​ 机制实现。Workspace 允许你在一个仓库中管理多个相互关联但独立的项目（包），并智能地处理它们之间的依赖关系。</p>
<h2 data-id="heading-1">二、将普通仓库转变为 Monorepo 的步骤</h2>
<h3 data-id="heading-2">步骤 1：初始化项目结构</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 创建项目根目录</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-monorepo
cd <span class="hljs-keyword">my</span>-monorepo

<span class="hljs-comment"># 初始化根目录 package.json</span>
pnpm init
</code></pre>
<h3 data-id="heading-3">步骤 2：配置根目录 package.json</h3>
<p>修改根目录的 <code>package.json</code>，关键配置如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-monorepo"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-regexp">//</span> 必须设置为 <span class="hljs-literal">true</span>，避免误发布到 npm
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"pnpm -r run dev"</span>,      <span class="hljs-regexp">//</span> -r 表示递归执行所有子包
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"pnpm -r run build"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"pnpm -r run test"</span>
  },
  <span class="hljs-string">"keywords"</span>: [],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>
}
</code></pre>
<p><strong>重要说明</strong>：</p>
<ul>
<li><code>"private": true</code>是必须的，确保整个 Monorepo 不会被意外发布</li>
<li>可以移除 <code>main</code>、<code>test</code>等字段，因为根目录通常不包含业务代码</li>
</ul>
<h3 data-id="heading-4">步骤 3：创建 pnpm-workspace.yaml 配置文件</h3>
<p>在根目录创建 <code>pnpm-workspace.yaml</code>文件，这是 pnpm Workspace 的核心配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  <span class="hljs-comment"># packages 目录下的所有直接子目录</span>
  - <span class="hljs-string">'packages/*'</span>
  
  <span class="hljs-comment"># apps 目录下的所有直接子目录</span>
  - <span class="hljs-string">'apps/*'</span>
  
  <span class="hljs-comment"># components 目录下的所有层级子目录</span>
  - <span class="hljs-string">'components/**'</span>
  
  <span class="hljs-comment"># 排除包含 test 的目录</span>
  - <span class="hljs-string">'!**/test/**'</span>
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>packages/*</code>：匹配 <code>packages</code>目录下的所有一级子目录</li>
<li><code>apps/*</code>：匹配 <code>apps</code>目录下的所有一级子目录</li>
<li><code>components/**</code>：匹配 <code>components</code>目录下的所有层级子目录</li>
<li><code>!**/test/**</code>：排除所有包含 <code>test</code>的目录</li>
</ul>
<p>pnpm 中的两种配置方式</p>
<h4 data-id="heading-5">方式一：使用 <code>package.json</code>的 <code>workspaces</code>字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"apps/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-6">方式二：使用 <code>pnpm-workspace.yaml</code>文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除包含 test 的目录</span>
</code></pre>
<h4 data-id="heading-7">两种方式的优先级与兼容性</h4>
<ol>
<li>
<p><strong>pnpm 的读取顺序</strong>：</p>
<ul>
<li>优先读取 <code>pnpm-workspace.yaml</code></li>
<li>如果不存在，则读取 <code>package.json</code>中的 <code>workspaces</code>字段</li>
<li>如果两者都存在，<strong><code>pnpm-workspace.yaml</code>优先级更高</strong>​</li>
</ul>
</li>
<li>
<p><strong>推荐使用 <code>pnpm-workspace.yaml</code>的原因</strong>：</p>
<ul>
<li><strong>更丰富的配置选项</strong>：支持排除模式（<code>!**/test/**</code>）</li>
<li><strong>更好的可读性</strong>：YAML 格式更适合复杂配置</li>
<li><strong>工具兼容性</strong>：明确标识为 pnpm 工作区</li>
<li><strong>未来扩展性</strong>：pnpm 的新功能会优先在 YAML 配置中支持</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">步骤 4：创建子项目结构</h3>
<p>典型的 Monorepo 目录结构如下：</p>
<pre><code class="hljs language-csharp" lang="csharp">my-monorepo/
├── pnpm-workspace.yaml
├── package.json
├── pnpm-<span class="hljs-keyword">lock</span>.yaml
├── packages/
│   ├── shared-utils/     <span class="hljs-meta"># 共享工具库</span>
│   │   ├── package.json
│   │   └── src/
│   ├── ui-components/    <span class="hljs-meta"># UI 组件库</span>
│   │   ├── package.json
│   │   └── src/
│   └── core-lib/         <span class="hljs-meta"># 核心库</span>
│       ├── package.json
│       └── src/
├── apps/
│   ├── web-app/          <span class="hljs-meta"># 前端应用</span>
│   │   ├── package.json
│   │   └── src/
│   └── mobile-app/       <span class="hljs-meta"># 移动应用</span>
│       ├── package.json
│       └── src/
└── docs/                 <span class="hljs-meta"># 文档</span>
</code></pre>
<h3 data-id="heading-9">步骤 5：配置子项目的 package.json</h3>
<p>每个子项目都需要有自己的 <code>package.json</code>，关键配置如下： <strong>示例：共享工具库 (packages/shared-utils/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@my-monorepo/shared-utils"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/index.d.ts"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc"</span>,
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"tsc --watch"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<p><strong>示例：前端应用 (apps/web-app/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"web-app"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"preview"</span>: <span class="hljs-string">"vite preview"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,  <span class="hljs-regexp">//</span> 关键：引用本地包
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"@types/react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-10">三、关键配置详解</h2>
<h3 data-id="heading-11">1. workspace:* 协议</h3>
<p>这是 pnpm Workspace 的核心特性，用于声明对本地其他包的依赖：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,      <span class="hljs-regexp">//</span> 使用最新版本
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:^1.0.0"</span>, <span class="hljs-regexp">//</span> 指定版本范围
    <span class="hljs-string">"@my-monorepo/core-lib"</span>: <span class="hljs-string">"workspace:../packages/core-lib"</span> // 相对路径
  }
}
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>建立本地包之间的软链接，无需发布到 npm</li>
<li>修改本地包时，依赖它的项目能立即看到变化</li>
<li>确保所有包使用同一份依赖，避免重复安装</li>
</ul>
<h3 data-id="heading-12">2. 依赖安装与管理</h3>
<h4 data-id="heading-13">在根目录安装全局依赖（所有包共享）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安装到根目录，所有包共享</span>
pnpm <span class="hljs-keyword">add</span> typescript -w
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> typescript --workspace-root
</code></pre>
<h4 data-id="heading-14">为特定包安装依赖</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 为 web-app 安装 react</span>
pnpm <span class="hljs-keyword">add</span> react --filter web-app
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> react -F web-app

<span class="hljs-meta"># 为多个包安装依赖</span>
pnpm <span class="hljs-keyword">add</span> axios --filter <span class="hljs-string">"web-app"</span> --filter <span class="hljs-string">"mobile-app"</span>
</code></pre>
<h4 data-id="heading-15">安装本地包依赖</h4>
<pre><code class="hljs language-sql" lang="sql"># 在 web<span class="hljs-operator">-</span>app 中安装 shared<span class="hljs-operator">-</span>utils
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>monorepo<span class="hljs-operator">/</span>shared<span class="hljs-operator">-</span>utils <span class="hljs-comment">--filter web-app</span>
</code></pre>
<h3 data-id="heading-16">3. 脚本执行</h3>
<h4 data-id="heading-17">在所有包中执行相同脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归执行所有包的 build 脚本</span>
pnpm -r run build

<span class="hljs-comment"># 递归执行所有包的 test 脚本</span>
pnpm -r run <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-18">在特定包中执行脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 仅在 web-app 中执行 dev 脚本</span>
pnpm --filter web-app run dev

<span class="hljs-comment"># 使用包名（package.json 中的 name）</span>
pnpm -F @my-monorepo/shared-utils run build
</code></pre>
<h2 data-id="heading-19">四、完整示例：Vue 项目 Monorepo</h2>
<h3 data-id="heading-20">项目结构</h3>
<pre><code class="hljs language-lua" lang="lua">vue-monorepo/
├── pnpm-workspace.yaml
├── <span class="hljs-built_in">package</span>.json
├── packages/
│   ├── ui-lib/          # UI 组件库
│   │   ├── <span class="hljs-built_in">package</span>.json
│   │   ├── src/
│   │   └── vite.<span class="hljs-built_in">config</span>.ts
│   └── utils/           # 工具函数库
│       ├── <span class="hljs-built_in">package</span>.json
│       └── src/
└── apps/
    ├── admin/           # 后台管理系统
    │   ├── <span class="hljs-built_in">package</span>.json
    │   └── src/
    └── portal/          # 门户网站
        ├── <span class="hljs-built_in">package</span>.json
        └── src/
</code></pre>
<h3 data-id="heading-21">pnpm-workspace.yaml</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">packages:</span>
  - <span class="hljs-comment">'packages/*'</span>
  - <span class="hljs-comment">'apps/*'</span>
</code></pre>
<h3 data-id="heading-22">根目录 package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run lint"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-23">包间依赖示例 (apps/admin/package.json)</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@vue-monorepo/ui-lib"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"@vue-monorepo/utils"</span>: <span class="hljs-string">"workspace:*"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-24">五、最佳实践与注意事项</h2>
<h3 data-id="heading-25">1. 命名规范</h3>
<ul>
<li>根项目：使用项目总名称，如 <code>my-monorepo</code></li>
<li>子包：使用作用域名称，如 <code>@my-monorepo/ui-components</code></li>
<li>应用：使用描述性名称，如 <code>web-app</code>、<code>admin-console</code></li>
</ul>
<h3 data-id="heading-26">2. 依赖管理</h3>
<ul>
<li>公共依赖（如 TypeScript、ESLint）安装在根目录</li>
<li>业务依赖安装在各自包中</li>
<li>使用 <code>pnpm-lock.yaml</code>确保依赖一致性</li>
</ul>
<h3 data-id="heading-27">3. 版本控制</h3>
<ul>
<li>提交 <code>pnpm-lock.yaml</code>到版本控制系统</li>
<li>考虑使用 Changesets 或 Lerna 进行版本管理和发布</li>
</ul>
<h3 data-id="heading-28">4. 性能优化</h3>
<ul>
<li>pnpm 使用硬链接和符号链接，节省磁盘空间</li>
<li>所有包共享同一份依赖，安装速度快</li>
<li>支持过滤命令，只构建需要的包</li>
</ul>
<h3 data-id="heading-29">5. CI/CD 集成</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions 示例</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-30">六、常见问题解决</h2>
<h3 data-id="heading-31">1. 幽灵依赖问题</h3>
<p>确保所有依赖都在 <code>package.json</code>中明确声明，避免直接引用 <code>node_modules</code>中的未声明包。</p>
<h3 data-id="heading-32">2. 循环依赖检测</h3>
<p>使用 <code>pnpm why &lt;package-name&gt;</code>检查依赖关系，避免包之间的循环依赖。</p>
<h3 data-id="heading-33">3. 包找不到错误</h3>
<p>如果出现 <code>no matches found</code>错误，检查：</p>
<ul>
<li>包名是否正确（包括作用域）</li>
<li>包是否在 <code>pnpm-workspace.yaml</code>配置的目录中</li>
<li>包是否有正确的 <code>name</code>字段</li>
</ul>
<h3 data-id="heading-34">4. 跨包类型引用</h3>
<p>对于 TypeScript 项目，配置 <code>tsconfig.json</code>中的 <code>paths</code>：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@my-monorepo/*"</span>: [<span class="hljs-string">"packages/*/src"</span>]
    }
  }
}
</code></pre>
<h2 data-id="heading-35">总结</h2>
<p>通过 pnpm + Workspaces 构建 Monorepo 的主要优势包括：</p>
<ol>
<li><strong>依赖共享</strong>：所有包共享同一份依赖，节省磁盘空间和安装时间</li>
<li><strong>原子提交</strong>：跨包变更可以一次性提交，保持一致性</li>
<li><strong>本地链接</strong>：使用 <code>workspace:*</code>协议，本地开发无需发布到 npm</li>
<li><strong>精细控制</strong>：支持按包过滤的命令执行</li>
<li><strong>统一管理</strong>：集中的 CI/CD 和代码质量检查</li>
</ol>
<p>这种架构特别适合中大型项目、微前端架构、组件库开发等场景，能显著提升开发效率和代码复用性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎯 Rect 中鼠标移动拾取元素可行性架构分析]]></title>    <link>https://juejin.cn/post/7583952017674190899</link>    <guid>https://juejin.cn/post/7583952017674190899</guid>    <pubDate>2025-12-16T01:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674190899" data-draft-id="7583933107689701439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎯 Rect 中鼠标移动拾取元素可行性架构分析"/> <meta itemprop="keywords" content="前端,架构,React.js"/> <meta itemprop="datePublished" content="2025-12-16T01:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎯 Rect 中鼠标移动拾取元素可行性架构分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:46:15.000Z" title="Tue Dec 16 2025 01:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧠 一、背景：什么是拾取（Picking）？</h2>
<p>“拾取”是指<strong>从用户交互的二维输入（鼠标、触控）映射到图形对象</strong>的过程。</p>
<p>想象你在一个可视化编辑器中移动鼠标指针——当光标悬浮在某个矩形（Rect）上，它高亮、变色、提示“我被选中了”，这就是 <em>拾取系统</em> 在背后施展魔法。✨</p>
<p>在二维场景中，拾取方案通常分三类：</p>





























<table><thead><tr><th>模式</th><th>原理</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>几何拾取</td><td>在逻辑层判断 <code>(x,y)</code> 与各对象边界关系</td><td>精确、轻量</td><td>大量元素时耗性能</td></tr><tr><td>GPU颜色拾取（Color Picking）</td><td>每个对象渲染唯一颜色，对鼠标点取色</td><td>准确、独立于形状复杂度</td><td>需额外渲染缓冲区</td></tr><tr><td>空间索引拾取（QuadTree / BVH）</td><td>建立空间数据结构加速命中查找</td><td>高效、可扩展</td><td>实现复杂度高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">🔬 二、可行性架构核心要点</h2>
<h3 data-id="heading-2">（1）数据层：结构化管理 Rect 元素</h3>
<p>首先要有“<strong>可索引、可快速命中</strong>”的数据结构。<br/>
假设每个矩形元素都有如下属性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rect</span> {
  <span class="hljs-keyword">constructor</span>(id, x, y, width, height) {
    <span class="hljs-keyword">this</span>.id = id;
    <span class="hljs-keyword">this</span>.bounds = { x, y, width, height };
    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">"normal"</span>; <span class="hljs-comment">// normal, hover, selected</span>
  }

  contains(px, py) {
    <span class="hljs-keyword">return</span> (
      px &gt;= <span class="hljs-keyword">this</span>.bounds.x &amp;&amp;
      px &lt;= <span class="hljs-keyword">this</span>.bounds.x + <span class="hljs-keyword">this</span>.bounds.width &amp;&amp;
      py &gt;= <span class="hljs-keyword">this</span>.bounds.y &amp;&amp;
      py &lt;= <span class="hljs-keyword">this</span>.bounds.y + <span class="hljs-keyword">this</span>.bounds.height
    );
  }
}
</code></pre>
<p>在小规模下，我们可直接线性扫描，但在数千个Rect场景中，这会让GPU哭泣 😭。</p>
<hr/>
<h3 data-id="heading-3">（2）空间层：区域加速结构设计</h3>
<p>为解决性能问题，可引入 <strong>QuadTree（四叉树）</strong> 进行空间划分。</p>
<p><strong>原理</strong>：</p>
<ul>
<li>将画布平面递归划分为四个象限，每个象限存储矩形对象集合。</li>
<li>鼠标移动时，只查询当前象限节点。</li>
<li>空间复杂度：O(n)，查询复杂度：平均 O(log n)。</li>
</ul>
<p>伪代码演示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadTree</span> {
  <span class="hljs-keyword">constructor</span>(boundary, capacity) {
    <span class="hljs-keyword">this</span>.boundary = boundary;  <span class="hljs-comment">// 当前节点矩形区域</span>
    <span class="hljs-keyword">this</span>.capacity = capacity;  <span class="hljs-comment">// 一个节点最多的元素数</span>
    <span class="hljs-keyword">this</span>.rects = [];
    <span class="hljs-keyword">this</span>.divided = <span class="hljs-literal">false</span>;
  }

  insert(rect) { <span class="hljs-comment">/* ...根据边界分裂插入逻辑... */</span> }

  query(point) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.boundary.contains(point)) <span class="hljs-keyword">return</span> [];
    let found = [];
    <span class="hljs-keyword">for</span> (let r of <span class="hljs-keyword">this</span>.rects) {
      <span class="hljs-keyword">if</span> (r.contains(point.x, point.y)) found.push(r);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.divided) {
      found.push(...<span class="hljs-keyword">this</span>.northwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.northeast.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southeast.query(point));
    }
    <span class="hljs-keyword">return</span> found;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">（3）事件层：鼠标移动拾取流逻辑</h3>
<p>核心逻辑架构如下：</p>
<pre><code class="hljs language-scss" lang="scss">mousemove
   ↓
拾取管理器 (PickManager)
   ↓
空间查询 (QuadTree.query)
   ↓
检测命中对象 (Rect.contains)
   ↓
状态同步 (hover / leave / select)
   ↓
渲染层重新绘制目标区域
</code></pre>
<p>完整简化实现：</p>
<pre><code class="hljs language-ini" lang="ini">canvas.addEventListener("mousemove", (e) =&gt; {
  const <span class="hljs-attr">mouse</span> = { x: e.<span class="hljs-literal">off</span>setX, y: e.<span class="hljs-literal">off</span>setY }<span class="hljs-comment">;</span>
  const <span class="hljs-attr">hitRects</span> = quadTree.query(mouse)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">newHover</span> = hitRects[<span class="hljs-number">0</span>] || null<span class="hljs-comment">;</span>
  if (currentHover !== newHover) {
    if (currentHover) <span class="hljs-attr">currentHover.state</span> = <span class="hljs-string">"normal"</span><span class="hljs-comment">;</span>
    if (newHover) <span class="hljs-attr">newHover.state</span> = <span class="hljs-string">"hover"</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">currentHover</span> = newHover<span class="hljs-comment">;</span>
    render()<span class="hljs-comment">; // 局部或全局重绘</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p>这样一来，我们实现了：</p>
<ul>
<li>✅ <strong>实时拾取</strong></li>
<li>✅ <strong>高效区域查询</strong></li>
<li>✅ <strong>状态分离与渲染解耦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-5">（4）渲染层：Canvas / WebGL 混合优化</h3>
<p>对于 Canvas 2D 场景，通常直接 redraw。<br/>
对于复杂 WebGL 场景，可采用双通道：</p>
<ol>
<li>主通道绘制可视内容；</li>
<li>拾取通道（off-screen buffer）绘制唯一颜色 ID；</li>
<li>鼠标事件时，通过 <code>gl.readPixels</code> 获取点击像素颜色 -&gt; 反查对象 ID。</li>
</ol>
<p>这种方案在大型交互式图形系统（如 Mapbox、Three.js）中用途极广。🌍</p>
<hr/>
<h2 data-id="heading-6">🧩 三、性能可行性分析</h2>



































<table><thead><tr><th align="left">指标</th><th align="left">几何拾取</th><th align="left">四叉树加速</th><th align="left">GPU颜色拾取</th></tr></thead><tbody><tr><td align="left">查询复杂度</td><td align="left">O(n)</td><td align="left">O(log n)</td><td align="left">O(1)</td></tr><tr><td align="left">渲染性能</td><td align="left">高CPU占用</td><td align="left">中等</td><td align="left">高GPU开销</td></tr><tr><td align="left">延迟</td><td align="left">极低</td><td align="left">低</td><td align="left">取决于颜色缓冲同步</td></tr><tr><td align="left">适用场景</td><td align="left">少量对象</td><td align="left">大量矩形元素</td><td align="left">复杂场景（3D/WebGL）</td></tr></tbody></table>
<p>结论：</p>
<blockquote>
<p>✅ 对于 Web 端二维 Rect 编辑器或设计工具，<strong>QuadTree + 几何拾取混合方案</strong> 是可行且优雅的架构选择。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">⚙️ 四、工程优化建议 🧪</h2>
<ol>
<li><strong>事件节流（throttle）</strong><br/>
避免每次 <code>mousemove</code> 都触发完整查询，可在 16ms（约60Hz）节流执行。</li>
<li><strong>局部重绘（Dirty Rect）</strong><br/>
只重绘状态变化区域，提升渲染性能。</li>
<li><strong>命中缓存（Hover Cache）</strong><br/>
若连续多帧命中同一元素，不重复查询，降低开销。</li>
<li><strong>交互优先级分层</strong><br/>
针对UI层、图形层分别拾取，按z-index排序命中结果。</li>
</ol>
<hr/>
<h2 data-id="heading-8">🪶 五、哲学层小结：拾取，不只是拾取</h2>
<p>“拾取”看似一个计算几何问题，实则是一次<strong>人与空间的映射关系重建</strong>。</p>
<p>当你从一块平面中精准捕捉一个矩形，背后是：</p>
<ul>
<li>一颗QuadTree在飞速判断区块；</li>
<li>一次GPU在色彩世界编码ID；</li>
<li>一份人机交互的默契在闪光。</li>
</ul>
<blockquote>
<p>工程的浪漫，藏在每一次 <code>mousemove</code> 中。💫</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🧭 总结</h2>






























<table><thead><tr><th>模块</th><th>关键技术</th><th>工程要点</th></tr></thead><tbody><tr><td>数据层</td><td>Rect 对象结构化</td><td>定义边界与状态</td></tr><tr><td>空间层</td><td>QuadTree or 网格划分</td><td>加速查询性能</td></tr><tr><td>事件层</td><td>MouseMove + 状态机</td><td>处理 hover/leave</td></tr><tr><td>渲染层</td><td>局部刷新 / GPU解码</td><td>平衡性能和准确性</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyi-vue2集成DMN规则引擎实现Dish出餐决策]]></title>    <link>https://juejin.cn/post/7583983152324247578</link>    <guid>https://juejin.cn/post/7583983152324247578</guid>    <pubDate>2025-12-16T04:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152324247578" data-draft-id="7584014975242059786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyi-vue2集成DMN规则引擎实现Dish出餐决策"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T04:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyi-vue2集成DMN规则引擎实现Dish出餐决策
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:43:11.000Z" title="Tue Dec 16 2025 04:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>DMN决策引擎的核心价值在于将复杂的业务决策逻辑从程序代码中剥离出来，通过标准化的模型进行可视化管理和执行。它在实战中的应用非常广泛，特别是在需要频繁调整业务规则、追求流程自动化与智能化的场景中。<br/>
具体应用场景有:
<strong>金融与风控</strong>​: 信贷审批、金融风险评估、反洗钱检查、
<strong>供应链与生产​</strong>: 保险定价、供应链管理、生产调度
<strong>营销与客户服务​</strong>: 客户分群、精准营销
<strong>其他创新场景​</strong>: 教育分班、智能餐饮</p>
<p>今天我们以一个经典的案例<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">智能餐饮</a>来讲解实战中的用法。</p>
<h3 data-id="heading-1">决策规则</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895052af95564d8eb2271ef4c89a6d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=3JR18VYKX7I108Jf45SMZ1JZ%2Fxo%3D" alt="dmn-dish.png" loading="lazy"/>
请点击这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">Dish</a>查询规则建模，以下我们拆解一下这个DMN规则表的含义。</p>
<pre><code class="hljs language-text" lang="text">这个Dish决策表规则是根据当前的气温(tempeature)和日期类型(dayType)决策上什么餐食。主要有三个决策表构成， 核心是Dish-Decision表。
Season Dicision和Guest Count 以输出结果传递给Dish Decision决策表。

Season Dicision规则描述:
tempeature&gt;30, 得到season: Summary
tempeature&lt;10, 得到season: Winter
tempeature=[10..30] 得到season: Spring

Guest Count规则描述:
dayType="Weekday",  客人数量(guestCount): 4 
dayType="Holiday",  客人数量(guestCount): 10
dayType="Weekend",  客人数量(guestCount): 15


Dish-Decision规则描述: 
season=winter, guestCount&lt;=8, desiredDish='Spareribs'
season=winter, guestCount&gt;8, desiredDish='Pasta'
season=Summer, guestCount&gt;10, desiredDish='Light salad'
season=Summer, guestCount&lt;=10, desiredDish='Beans salad'
season=Spring, guestCount&lt;10, desiredDish='Stew'
season=Spring, guestCount&gt;=10, desiredDish='Steak'

</code></pre>
<h3 data-id="heading-2">流程建模</h3>
<ul>
<li>需求描述</li>
</ul>
<pre><code class="hljs language-text" lang="text">我们现在模拟一个流程， 用户输入当天的气温和日期类型(工作日，假期，周末)， 系统决策提供什么类型的餐食。
</code></pre>
<ul>
<li>模型结构</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b5e4bba9b64ed3a2d5ba644641d5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=HGn2I1TjLQywUdfRu%2F5VzkKOv%2Bg%3D" alt="dmn-model.png" loading="lazy"/></p>
<ul>
<li>模型定义</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bpmn:definitions</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:bpmn</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:dc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:camunda</span>=<span class="hljs-string">"http://camunda.org/schema/1.0/bpmn"</span> <span class="hljs-attr">xmlns:di</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Definitions_1"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://bpmn.io/schema/bpmn"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Process_8887"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐决策"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_1i7sxll"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:startEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1rzb9vm"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Event_1i7sxll"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"就餐信息"</span> <span class="hljs-attr">camunda:assignee</span>=<span class="hljs-string">"${startUser}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formData</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temperature"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"气温"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"long"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dayType"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"日期"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">camunda:formData</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:userTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0v0zyja"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_08c0387"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:businessRuleTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"决策规则"</span> <span class="hljs-attr">camunda:resultVariable</span>=<span class="hljs-string">"desiredDish"</span> <span class="hljs-attr">camunda:decisionRef</span>=<span class="hljs-string">"dish-decision"</span> <span class="hljs-attr">camunda:mapDecisionResult</span>=<span class="hljs-string">"singleEntry"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:businessRuleTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1ajvk92"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐程序"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${dishTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0x2ftot"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:endEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0r2ykge"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Event_0x2ftot"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:process</span>&gt;</span>
  
<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:definitions</span>&gt;</span>

</code></pre>
<ul>
<li>运行结果</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b57d32b97c49bab66cb8ed12b30c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=0Npis5NkpVMvANRwGD7kQ7tUMYo%3D" alt="dmn-demo.png" loading="lazy"/></p>
<pre><code class="hljs language-text" lang="text">运行结果解释：
用户输入的气温15度，根据Season Dicision可以得到是=Spring
用户输入的日期类型weekday, 根据Guest Count可以得到客人数量=4

根据season=spring, guestCount=4，根据Dish Decision可以得到=stew 

完全符合预期！
</code></pre>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">若依工作流</a>点击顶部，演示系统立即体验!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VS Code 1.107 更新：多智能体协同与开发体验升级]]></title>    <link>https://juejin.cn/post/7584307642999537707</link>    <guid>https://juejin.cn/post/7584307642999537707</guid>    <pubDate>2025-12-16T11:13:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584307642999537707" data-draft-id="7584287969214070803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VS Code 1.107 更新：多智能体协同与开发体验升级"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T11:13:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VS Code 1.107 更新：多智能体协同与开发体验升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:13:08.000Z" title="Tue Dec 16 2025 11:13:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 年 12 月 10 日，微软正式发布了 VS Code 1.107 版本，这次更新堪称年度最重磅！<strong>多智能体协同开发</strong>成为核心亮点，彻底重构了开发者与 AI 协作的模式。想象一下，你可以同时部署多个 AI 助手分工合作：一个负责代码审查，一个处理单元测试，还有一个在后台默默重构 legacy 代码——这不再是科幻场景！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d52455df60c84e1f86b5d74f160b2dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=eNiPuTrnir8zmc9yYe7V5ZexRlY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">多智能体协同：开发效率的革命性突破</h2>
<h3 data-id="heading-1">Agent HQ：你的 AI 团队指挥中心</h3>
<p>VS Code 1.107 引入了全新的 <strong>Agent HQ</strong> 概念，将所有智能体统一管理。现在，GitHub Copilot 不再是孤军奋战，你可以创建、配置多个自定义智能体，并让它们协同完成复杂任务。</p>
<p>最惊艳的是 <strong>会话管理功能</strong>！所有智能体会话都整合到聊天视图中，你能一目了然地看到每个任务的状态、进度和文件更改统计。右键点击会话，还能选择在编辑器标签页或新窗口中打开，灵活度拉满。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cf7048587a944f4871619e7940eb0db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=3yONxuXphV23qvW%2F%2FInRYHVFjNo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">背景智能体：让 AI 在后台默默干活</h3>
<p><strong>背景智能体</strong> 彻底改变了工作流！以前用 Copilot 时，你必须等待它完成当前任务才能继续工作。现在，只需点击 <strong>Continue in</strong> 按钮，就能将任务无缝转移到后台智能体，自己继续专注于其他编码工作。</p>
<p>更厉害的是 <strong>Git 工作树隔离</strong> 技术！每个背景智能体都能在独立的 Git 工作树中运行，多个智能体同时修改代码也不会冲突。完成后，你可以一键将更改合并回主工作区，简直是多任务处理的终极解决方案！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/597edcc556e942c685e12af746a53c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=ley2Th5PgZStx67vL9F2T8YHUWA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">组织级智能体共享：团队协作新范式</h3>
<p>对于企业用户，1.107 版本带来了 <strong>组织级智能体共享</strong>（实验性功能）。管理员可以在 GitHub 组织级别定义智能体，团队成员无需手动导入就能直接使用。启用方法很简单：</p>
<ul>
<li>打开设置 <code>github.copilot.chat.customAgents.showOrganizationAndEnterpriseAgents</code></li>
<li>将其设为 <code>true</code></li>
</ul>
<p>从此，团队知识库、编码规范、最佳实践都能通过自定义智能体轻松传承，新人上手速度至少提升 50%！</p>
<h2 data-id="heading-4">聊天体验升级：AI 交互更自然</h2>
<h3 data-id="heading-5">语言模型管理：一键切换你的 "AI 大脑"</h3>
<p>面对越来越多的 AI 模型选择，VS Code 新增了 <strong>语言模型编辑器</strong>。在这里，你可以：</p>
<ul>
<li>查看所有可用模型的能力、上下文长度和计费信息</li>
<li>按提供商、能力（工具调用、视觉、智能体）筛选</li>
<li>隐藏不常用模型，让界面更清爽</li>
</ul>
<p>只需按下 <code>Ctrl+Shift+P</code> 并输入 <strong>Chat: Manage Language Models</strong>，就能打开这个强大的管理中心。</p>
<h3 data-id="heading-6">动态内容抓取：连 SPA 网站也能轻松解析</h3>
<p><code>#fetch</code> 工具现在支持 <strong>动态网页内容抓取</strong>！无论是 React、Vue 构建的单页应用，还是 Jira 这样的动态系统，都能准确获取内容。AI 现在能直接分析你公司的内部文档系统，回答问题不再局限于本地代码！</p>
<h3 data-id="heading-7">敏感文件编辑：安全与便捷的完美平衡</h3>
<p>修改 <code>package.json</code> 或 <code>settings.json</code> 这类敏感文件时，VS Code 会自动显示 <strong>差异对比视图</strong>，让你清晰看到每一处变更。再也不用担心 AI 误改配置导致项目崩溃了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d09085ede19746aba3d4ca78bf7ac859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=Cl9QvjzYaYeW1hVQhVwlO93C3FQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">编辑器体验优化：细节之处见真章</h2>
<h3 data-id="heading-9">按需悬停提示：告别干扰，专注编码</h3>
<p>终于可以告别烦人的自动悬停提示了！在设置中将 <code>editor.hover.enabled</code> 设为 <code>onKeyboardModifier</code>，悬停信息只会在按住特定修饰键时才显示。默认情况下：</p>
<ul>
<li>如果多光标修饰键是 <code>Ctrl/Cmd</code>，则按住 <code>Alt</code> 显示悬停</li>
<li>如果多光标修饰键是 <code>Alt</code>，则按住 <code>Ctrl</code> 显示悬停</li>
</ul>
<p>这个小改进，却能让编码专注度提升一个档次！</p>
<h3 data-id="heading-10">TypeScript 7.0 预览：原生重构，性能飞跃</h3>
<p>VS Code 1.107 带来了 <strong>TypeScript 7.0 预览支持</strong>！这个完全用原生代码重写的版本，性能提升堪称革命性。目前已支持自动导入、重命名和引用代码透镜，安装 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarketplace.visualstudio.com%2Fitems%3FitemName%3DTypeScriptTeam.native-preview" target="_blank" title="https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.native-preview" ref="nofollow noopener noreferrer">TypeScript (Native Preview)</a> 扩展即可体验。</p>
<p>根据微软官方数据，TypeScript 7.0 的类型检查速度比 5.0 快 <strong>3-5 倍</strong>，大型项目的编译时间将大幅缩短！</p>
<h2 data-id="heading-11">终端增强：命令行效率倍增</h2>
<h3 data-id="heading-12">终端输出捕获：历史命令随时回溯</h3>
<p>现在，聊天中的终端命令输出会完整保存在 <code>xterm.js</code> 终端中，即使终端已关闭也能随时查看。这意味着你可以：</p>
<ul>
<li>对比不同命令的执行结果</li>
<li>追溯智能体运行的脚本输出</li>
<li>分享完整的错误信息给同事</li>
</ul>
<h3 data-id="heading-13">一键允许所有命令：信任智能体，解放双手</h3>
<p>在聊天中运行终端命令时，新增了 <strong>Allow All Commands in this Session</strong> 选项。启用后，当前会话中的所有终端命令都会自动批准，无需反复确认。对于信任的智能体，这能节省大量交互时间！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/101390277e4a45e084db64c5abb4fbba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=PHDwOisPS0GAyIAcTOLs9k4%2FqFM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-14">企业级特性：安全与管理并重</h2>
<h3 data-id="heading-15">智能体工具权限控制：精细管理 AI 能力</h3>
<p>企业管理员现在可以通过 <code>chat.tools.eligibleForAutoApproval</code> 设置，精确控制哪些智能体工具允许自动批准。对于 <code>runTask</code> 这类高危操作，可以强制要求人工确认，安全性大大提升！</p>
<h3 data-id="heading-16">GitHub 企业策略支持：云端开发无缝衔接</h3>
<p>使用 GitHub Codespaces 的团队，现在能自动应用企业策略。无论是 MCP 注册表配置还是智能体权限，都能在云端开发环境中保持一致，开发体验无缝衔接。</p>
<h2 data-id="heading-17">总结：AI 驱动开发的未来已来</h2>
<p>VS Code 1.107 版本通过 <strong>多智能体协同</strong>、<strong>背景任务处理</strong> 和 <strong>组织级智能体共享</strong>，将 AI 辅助开发推向了新阶段。它不仅是工具的升级，更是开发范式的转变——从 "开发者使用 AI" 到 "开发者指挥 AI 团队"。</p>
<p>最令人兴奋的是，这仅仅是开始。随着 TypeScript 7.0 的成熟和更多 AI 能力的整合，VS Code 正在朝着 "开发者思维放大器" 的方向快速进化。</p>
<p>立即通过 <strong>帮助 &gt; 检查更新</strong> 升级到 1.107 版本，或访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2F" target="_blank" title="https://code.visualstudio.com/" ref="nofollow noopener noreferrer">VS Code 官网</a> 下载最新安装包，体验这场开发效率的革命！</p>
<blockquote>
<p><strong>提示</strong>：想抢先体验未来功能？可以安装 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Finsiders%2F" target="_blank" title="https://code.visualstudio.com/insiders/" ref="nofollow noopener noreferrer">Insiders 版本</a>，每天获取最新更新！</p>
</blockquote>
<p>Happy Coding！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能开发环境下的 Diagram-as-Code 实践：MCP Mermaid 技术链路拆解]]></title>    <link>https://juejin.cn/post/7584094504630665225</link>    <guid>https://juejin.cn/post/7584094504630665225</guid>    <pubDate>2025-12-16T05:19:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584094504630665225" data-draft-id="7583991680749568027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能开发环境下的 Diagram-as-Code 实践：MCP Mermaid 技术链路拆解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T05:19:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Undoom"/> <meta itemprop="url" content="https://juejin.cn/user/4158824111150512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能开发环境下的 Diagram-as-Code 实践：MCP Mermaid 技术链路拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4158824111150512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Undoom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:19:07.000Z" title="Tue Dec 16 2025 05:19:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在软件工程、系统架构设计以及日常的项目管理中，图表（Diagrams）是信息传递的核心载体。传统的绘图方式往往需要借助 Visio、Draw.io 等图形化工具，通过繁琐的拖拽操作来完成。而 Mermaid.js 的出现，将“绘图”转变为“编写代码”，实现了图表的文本化与版本控制化。</p>
<p>随着大语言模型（LLM）的兴起，Model Context Protocol (MCP) 应运而生，它作为一种通用协议，连接了 AI 模型与外部工具。本文将详细拆解如何在蓝耘（Lanyun）MCP 广场中获取 Mermaid 服务，并将其集成到 Trae 编辑器中，通过自然语言指令自动生成专业的 Mermaid 图表代码。</p>
<h2 data-id="heading-1">第一阶段：MCP 服务的发现与获取</h2>
<p>MCP 协议的核心在于将工具标准化。在开始集成之前，首先需要在服务供应平台找到对应的工具模块。</p>
<h3 data-id="heading-2">1.1 服务搜索与定位</h3>
<p>在蓝耘 MCP 广场的搜索界面，通过输入关键词 <code>MCP Mermaid</code>，可以快速定位到目标工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f13cf4ecc614c88a2a0462351efa870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=sScaZnF3S%2BJ3wC9ovFNoyHQ0vl4%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了搜索结果页面。可以看到界面中央清晰地列出了搜索到的 <code>MCP Mermaid</code> 卡片。这一步是整个流程的起点，意味着我们不仅仅是在寻找一个绘图工具，而是在寻找一个可以被 AI 调用的标准接口（Interface）。该卡片不仅显示了名称，通常还会包含该工具的版本信息、简要描述以及部署状态。</p>
<h3 data-id="heading-3">1.2 托管状态与配置生成</h3>
<p>点击进入工具详情页后，会发现该 MCP 服务呈现“托管”状态。这是一个关键的技术细节。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f9e962f55d143b19b499a163f369f40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=wPzfgwEt4GrmeodgDqYYcO7ihMg%3D" alt="image.png" loading="lazy"/></p>
<p>如上图所示，界面显示了“这一款 mcp 已经被蓝耘给托管了”的信息。在传统的 MCP 部署中，用户通常需要在本地环境安装 Node.js 或 Python 运行时，并通过命令行（CLI）启动服务。而“托管”意味着服务运行在云端服务器上，用户无需消耗本地计算资源，也无需处理复杂的依赖安装问题。</p>
<p>界面右侧提供了“生成体验的 json 代码”按钮。这个 JSON 配置文件是连接本地编辑器（客户端）与云端 MCP 服务（服务端）的凭证。</p>
<h3 data-id="heading-4">1.3 配置代码的对比与选择</h3>
<p>在配置环节，通常存在两种模式：本地运行模式和远程 SSE 模式。</p>
<p><strong>官方提供的本地运行 JSON 代码：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mcp-mermaid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"mcp-mermaid"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这段代码使用了 <code>npx</code> 命令，意味着它依赖用户本地的 npm 环境来动态下载并执行 <code>mcp-mermaid</code> 包。这种方式虽然灵活，但要求本地具备相应的开发环境，且受限于本地网络状况。</p>
<p><strong>蓝耘提供的托管 JSON 代码（推荐）：</strong></p>
<p>为了简化流程，我们选择蓝耘提供的基于 SSE（Server-Sent Events）的配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"MCP Mermaid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sse"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://d885cc9e62854df8b41f70b4caedd399.mcp.lanyun.net:8088/sse/MCP Mermaid"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294da1d190434d3eb678f344cbe83a18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=4oPD0ZeRa5wmvOqhdTE0wVRhGEg%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了实际获取到的 JSON 配置块。这里有两个关键字段需要解析：</p>
<ol>
<li><strong><code>type</code>: "sse"</strong>：指明了通信协议采用 Server-Sent Events。这是一种允许服务器主动向客户端推送数据的 HTTP 连接方式，非常适合 LLM 流式输出的场景。</li>
<li><strong><code>url</code></strong>：指向了蓝耘云平台的具体端口（8088）和路径。这个 URL 是服务的唯一访问入口，包含了身份验证或会话标识的哈希字符串。</li>
</ol>
<h2 data-id="heading-5">第二阶段：Trae 编辑器中的集成与配置</h2>
<p>获取配置信息后，下一步是在开发环境 Trae 中进行注册。Trae 是一款支持 MCP 协议的现代 IDE，允许用户通过修改配置文件来扩展 AI 的能力。</p>
<h3 data-id="heading-6">2.1 手动添加 MCP 服务</h3>
<p>打开 Trae 的设置或配置文件编辑界面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac863df8ae1441fea18aad3a1dc04ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=SeeEsZhFq2SXshlvWSCCiFCmzho%3D" alt="image.png" loading="lazy"/></p>
<p>如上图所示，用户将之前复制的 JSON 代码块精准地粘贴到了 <code>mcpServers</code> 对象中。Trae 会读取这个配置文件，解析出服务的名称（MCP Mermaid）、类型（sse）以及连接地址。这一步相当于为 IDE 安装了一个新的“驱动程序”，使其具备了生成图表的能力。</p>
<h3 data-id="heading-7">2.2 服务加载状态验证</h3>
<p>配置保存后，IDE 会尝试与远程服务器建立连接。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c9147a410de4423bff69fe70b237020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=CG27N1N6YSUZP0UplCr73Cdo7SE%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了服务加载成功的状态。通常在界面上会有一个指示灯变为绿色，或者显示“Connected”/“已连接”字样。这表明 Trae 已经成功通过 HTTP 协议握手连接到了蓝耘托管的 Mermaid 服务端，随时准备接受指令。</p>
<h3 data-id="heading-8">2.3 创建专属智能体</h3>
<p>为了更好地管理上下文，建议创建一个专门用于绘图的智能体（Agent）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab49bc311b84ea9806218c07d504df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=GTinXF4PesCSFAKwJrZuf%2BISxM8%3D" alt="image.png" loading="lazy"/></p>
<p>在上图的操作界面中，用户勾选了刚刚添加的 <code>MCP Mermaid</code> 服务。这意味着该智能体在处理用户输入时，拥有了调用 Mermaid 工具的权限。通过这种方式，可以将通用的聊天功能与专业的绘图功能进行隔离，确保生成的代码更加纯粹和专业。</p>
<h2 data-id="heading-9">第三阶段：核心场景实战测试</h2>
<p>环境搭建完毕后，进入核心的实战测试阶段。我们将通过五个不同维度的测试用例，验证 AI 如何将自然语言转化为标准的 Mermaid 语法，并解析每一类图表的结构逻辑。</p>
<h3 data-id="heading-10">3.1 流程图（Flowchart）：逻辑判断与路径控制</h3>
<p><strong>测试场景</strong>：用户登录系统流程。
<strong>输入指令</strong>：“请帮我画一个用户登录系统的流程图：用户输入账号密码 -&gt; 系统验证。如果验证成功，跳转首页；如果验证失败，提示错误并返回登录页。”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82e2c8a441094e96a5518809cce17a4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=KSocmNThb1kM%2F5xFnD9D9ZG%2BeNs%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了 Trae 根据指令生成的流程图预览。可以看到，图表清晰地表达了条件分支逻辑。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD;
    A[用户输入账号密码] --&gt; B[系统验证];
    B --&gt;|验证成功| C[跳转首页];
    B --&gt;|验证失败| D[提示错误并返回登录页];
</code></pre>
<ul>
<li><strong><code>graph TD;</code></strong>：声明这是一个从上到下（Top-Down）的图表。</li>
<li><strong>节点定义</strong>：<code>A[...]</code> 使用方括号定义了矩形节点。</li>
<li><strong>连接线</strong>：<code>--&gt;</code> 表示带箭头的实线。</li>
<li><strong>条件标注</strong>：<code>|验证成功|</code> 是连接线上的文本标签，清晰地展示了逻辑判断的结果导向。</li>
</ul>
<p>该图表准确地捕捉了业务逻辑中的“顺序执行”与“条件分支”两个核心要素。</p>
<h3 data-id="heading-11">3.2 时序图（Sequence Diagram）：对象交互与时间顺序</h3>
<p><strong>测试场景</strong>：网购下单全过程。
<strong>输入指令</strong>：生成一个网购的时序图。参与者包括用户、商城前端、后端API、支付网关。展示点击下单到返回结果的全过程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba60e7d65e7d4da8a10de7e7b275cc39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=5EtCGgTDgGODxRMvwmTx8MddCXI%3D" alt="image.png" loading="lazy"/></p>
<p>上图呈现了各个系统组件之间的垂直生命线以及水平的消息传递。这种图表对于理解分布式系统中的调用链路至关重要。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant 用户
    participant 商城前端
    participant 后端API
    participant 支付网关

    用户-&gt;&gt;商城前端: 点击下单
    商城前端-&gt;&gt;后端API: 发起下单请求
    后端API-&gt;&gt;支付网关: 调用支付接口
    支付网关--&gt;&gt;后端API: 返回支付成功结果
    后端API--&gt;&gt;商城前端: 返回下单成功结果
    商城前端--&gt;&gt;用户: 显示支付成功
</code></pre>
<ul>
<li><strong><code>participant</code></strong>：显式声明了参与交互的对象，确保它们在图中按顺序排列。</li>
<li><strong><code>-&gt;&gt;</code></strong>：实线箭头，表示同步请求或异步消息的发送。</li>
<li><strong><code>--&gt;&gt;</code></strong>：虚线箭头，表示响应消息的返回。</li>
</ul>
<p>AI 生成的代码完美遵循了请求-响应（Request-Response）模式，清晰地展示了数据流如何在前端、后端与第三方服务之间流转。</p>
<h3 data-id="heading-12">3.3 甘特图（Gantt Chart）：项目进度与时间管理</h3>
<p><strong>测试场景</strong>：两周周期的项目开发计划。
<strong>输入指令</strong>：包含需求分析（2天）、原型设计（2天）、代码开发（6天）、测试与修复（3天）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f666eee87e842b68b4d625a8683d85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=A94Ie7R%2BS5AsqlztyYQgmX0au0U%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了项目的时间轴视图。甘特图是项目经理进行排期和资源可视化的首选工具。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title 项目开发甘特图
    dateFormat  YYYY-MM-DD
    section 项目阶段
    需求分析       :done,    des1, 2025-12-07, 2d
    原型设计       :active,  des2, 2025-12-09, 2d
    代码开发       :         des3, 2025-12-11, 6d
    测试与修复     :         des4, 2025-12-17, 3d
</code></pre>
<ul>
<li><strong><code>dateFormat</code></strong>：定义了日期的解析格式。</li>
<li><strong><code>section</code></strong>：将任务分组，这里统一在“项目阶段”下。</li>
<li><strong>任务状态</strong>：<code>done</code> 表示已完成，<code>active</code> 表示进行中，空白表示未开始。</li>
<li><strong>时间跨度</strong>：<code>2d</code>、<code>6d</code> 等后缀准确定义了任务持续的时长。</li>
</ul>
<p>Mermaid 自动计算了各个任务的起始和结束日期，直观地反映了任务间的依赖关系（虽然此例中为线性依赖）。</p>
<h3 data-id="heading-13">3.4 类图（Class Diagram）：面向对象结构设计</h3>
<p><strong>测试场景</strong>：学校管理系统的数据模型。
<strong>输入指令</strong>：包含学生、老师、课程三个类，定义多对多和一对多关系，以及基本属性和方法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d66378386be249aaa7153e18f619f776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=WVgGfV6XRLq2Cc97Y7fd6jKCj1s%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了标准的 UML 类图结构。每个矩形框代表一个类，分为类名、属性、方法三层结构。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class 学生 {
        +String 姓名
        +int 学号
        +void 注册课程()
        +void 查看课程()
    }

    class 老师 {
        +String 姓名
        +int 工号
        +void 添加课程()
        +void 查看课程()
    }

    class 课程 {
        +String 课程名称
        +String 课程编号
        +void 添加学生()
        +void 查看学生()
    }

    学生 "*" -- "*" 课程 : 选修
    老师 "1" -- "*" 课程 : 教授
</code></pre>
<ul>
<li><strong>可见性修饰符</strong>：<code>+</code> 表示 Public（公开）属性或方法。</li>
<li><strong>数据类型</strong>：明确标注了 <code>String</code>、<code>int</code> 等类型。</li>
<li><strong>关系基数</strong>：<code>"*"</code> 代表多（Many），<code>"1"</code> 代表一（One）。</li>
<li><strong>关联描述</strong>：<code>: 选修</code> 和 <code>: 教授</code> 对类之间的关系进行了语义化说明。</li>
</ul>
<p>这张图不仅展示了静态结构，还规范了系统的业务规则（例如一个老师可以教授多门课程）。</p>
<h3 data-id="heading-14">3.5 思维导图（Mindmap）：知识结构与发散思维</h3>
<p><strong>测试场景</strong>：人工智能学习路径规划。
<strong>输入指令</strong>：中心节点 AI，分支包含机器学习、深度学习、编程语言、数学基础及其子节点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/768f1ec6b406480b845046e3c9da23c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=CNVJ7zNOrBk02XmGcA39%2Bmcv9dI%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了以 AI 为核心的辐射状知识图谱。思维导图非常适合用于头脑风暴、知识梳理和层级展示。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
    root((AI))
        机器学习
            监督学习
            无监督学习
        深度学习
            CNN
            RNN
            Transformer
        编程语言
            Python
            C++
        数学基础
</code></pre>
<ul>
<li><strong><code>root((AI))</code></strong>：定义了中心根节点，双括号使其呈现圆形。</li>
<li><strong>缩进层级</strong>：Mermaid 的思维导图语法依赖缩进来表示层级关系，无需复杂的箭头定义，这使得代码极具可读性。</li>
</ul>
<p>通过这种结构，复杂的知识体系被可视化为层级分明的树状结构，便于记忆和理解。</p>
<h2 data-id="heading-15">总结与展望</h2>
<p>通过上述流程，我们完整体验了从 MCP 服务的搜索、配置，到在 IDE 中通过自然语言生成五种不同类型图表的全过程。</p>
<p>这一方案的优势在于：</p>
<ol>
<li><strong>低门槛</strong>：用户无需学习繁杂的 Mermaid 语法，只需描述需求。</li>
<li><strong>高效率</strong>：蓝耘托管服务免去了本地环境搭建的成本，开箱即用。</li>
<li><strong>可维护性</strong>：生成的图表本质上是文本代码，可以随项目源码一起进行版本控制（Git），便于后续的修改和迭代。</li>
</ol>
<p>MCP Mermaid 不仅是一个绘图工具，更是 AI 辅助工程化（AI4SE）的一个典型切面。它展示了如何通过标准协议将大模型的理解能力转化为实际的生产力工具。对于开发者、产品经理以及系统架构师而言，掌握这一工作流将显著提升文档编写与技术沟通的效率。</p>
<p>如果您对这一技术栈感兴趣，可以通过以下链接注册并体验蓝耘平台提供的服务：
<code>https://console.lanyun.net/#/register?promoterCode=0131</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣]]></title>    <link>https://juejin.cn/post/7584243498528227328</link>    <guid>https://juejin.cn/post/7584243498528227328</guid>    <pubDate>2025-12-16T11:54:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584243498528227328" data-draft-id="7584286241487945768" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-16T11:54:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="围巾哥萧尘"/> <meta itemprop="url" content="https://juejin.cn/user/1222312659548446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1222312659548446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    围巾哥萧尘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:54:52.000Z" title="Tue Dec 16 2025 11:54:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f522bac8244f48a38fa79d6e75159325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=tP7boZEFa9zEoekgbfYDLPum%2BLo%3D" alt="708d8a2df5a594e775fe485ab6d4431568bbd20c.jpg@672w_378h_1c.webp" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftraeb7l0znrj.vercel.app%2F" target="_blank" title="https://traeb7l0znrj.vercel.app/" ref="nofollow noopener noreferrer">traeb7l0znrj.vercel.app/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1fAqhBGErL%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1fAqhBGErL/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">视频操作：🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 使用PyeChart创建一个HTML格式的子母饼图案例 | @围巾哥萧尘🧣</a></p>
<p><strong>摘要</strong></p>
<p>今天主要利用 TRAE的国内版本 高效实现特定可视化需求，即使用Python的<code>PyeChart</code>库生成THML格式子母品图的实践流程。通过输入结构化的需求描述和对应的范例，我们实现了快速代码生成与图样制作。实际的操作发现，明确的需求描述及其范例是显著加速实现进程的关键因素。</p>
<p><strong>关键词：</strong> 子母品图, HTML, Python, <code>PyeChart</code>, 提示词优化, AI辅助</p>
<h3 data-id="heading-1">1. 研究背景与需求分析</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc9dcbd74024126afff561f7f6a1978~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=6bJM0N9vMgeOB8f%2F4%2ByH99kamUw%3D" alt="截屏2025-12-16 19.32.00.png" loading="lazy"/></p>
<p>今天一个小伙伴提出了一个明确的可视化需求，即需要绘制一张<strong>子母饼图</strong>，要求以 <strong>HTML 格式</strong>输出，并需通过 <strong>Python 的 PyeChart</strong>完成实现。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5c515bbbae485fa8eeb5ec99038246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=9wMnxadB%2Bl2Yb7IEmTBoE7XStWY%3D" alt="截屏2025-12-16 19.21.00.png" loading="lazy"/></p>
<p>该需求的关键优势在于，她不仅提供了需求点，还提供了<strong>对应的范例</strong>。这种双重确认极大地提高了后续操作的效率，因为在操作时它的效率会很高一点。</p>
<p>虽然基础需求清晰，但在实际操作中，仍需要对需求进行优化，以确保最终生成的品图能够与需求完全一致。</p>
<h3 data-id="heading-2">2. AI驱动的方法论与执行流程</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bac1669f4ed948a6af8e4584adeab18a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=fMVdCwUAcwpHZM5dEPFCpMHCD%2BI%3D" alt="截屏2025-12-16 17.39.00.png" loading="lazy"/></p>
<p>利用“TRAE的国内版本”工具 作为AI驱动的代码生成平台。</p>
<h4 data-id="heading-3">2.1 提示词构建与工具启用</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/202d4a1862f64116af32ce95b5efced5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=vygzvUYuYNkSTSHYmECkwn1Z1Kg%3D" alt="50.gif" loading="lazy"/></p>
<p>我向TRAE提供了<strong>需求分析和范例图片，以及我的制作需求</strong>，通过对应的提示词，完成对应的网页制作。启用了 <strong>plan 功能</strong>，完成项目梳理。</p>
<h4 data-id="heading-4">2.2 结构化执行步骤的自动生成</h4>
<p>TRAE在接收到提示词后，根据需求分析自动生成了一套实现步骤。这些步骤覆盖了从数据准备到基础视图生成的全过程。</p>
<p><strong>表 1：AI工具自动生成的图样实现步骤</strong></p>



































<table><thead><tr><th align="left">序号</th><th align="left">步骤环节</th><th align="left">关键操作描述</th><th align="left">引用</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">数据与文档准备</td><td align="left">完成文档的一个数据准备工作</td><td align="left"/></tr><tr><td align="left">2</td><td align="left">库安装与配置</td><td align="left">安装 <code>PyeChart</code> 库并重启该 <code>PyeChart</code> 库</td><td align="left"/></tr><tr><td align="left">3</td><td align="left">TODO list步骤</td><td align="left">工具提供了五步的操作步骤</td><td align="left"/></tr><tr><td align="left">4</td><td align="left">网页可视化生成</td><td align="left">生成文档，实现字母视图并启动网页</td><td align="left"/></tr></tbody></table>
<h4 data-id="heading-5">2.3 结果验证</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acd352c2008342eb918e18106fcf6ea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=SNfpKKsNEhTITA%2Fbgcu8GjbwAzM%3D" alt="截屏2025-12-16 17.39.11.png" loading="lazy"/></p>
<p>程序启动后，即可在浏览器当中去完成图样的制作，实现网页的速度非常快。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f66193105549bb87ae38c147a781ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=MYjOVXSNJFkgzpgRnNs8HVSm0gI%3D" alt="截屏2025-12-16 19.43.54.png" loading="lazy"/></p>
<p>国内版本没有部署按钮，使用国际版的TRAE完成网页的部署。</p>
<h3 data-id="heading-6">3. 结果、讨论与优化建议</h3>
<h4 data-id="heading-7">3.1 效率与清晰性</h4>
<p>实践证明，<strong>拥有清晰的需求点和对应的范例</strong>是加速实现过程的关键因素。当需求描述清晰、分析到位时，工具能够更快地生成基础视线。</p>
<h4 data-id="heading-8">3.2 复杂布局的实现挑战</h4>
<p>尽管基础实现速度快，但如果要实现如“左边当图，右边当图，中间加这个线的描述的图片”的复杂精细化布局，则需要对<strong>提示词完成更进一步的描述优化</strong>。</p>
<h4 data-id="heading-9">3.3 提示词优化与外部工具辅助</h4>
<p>为了获得更理想的效果，如果用户在自我表述或描述所需图样时遇到困难，可以借鉴外部工具进行辅助分析。例如，可以利用谷歌的 <strong>Gemini</strong>，让它去分析目标图样，进而给出对应的<strong>图描述的提示词</strong>，这能有效提升描述的精确度和加快效果。</p>
<h3 data-id="heading-10">4. 结论</h3>
<p>利用“TRAE国内版”工具和清晰的需求文档，成功完成了基于Python <code>PyeChart</code>库的HTML格式字母饼图制作和分享。在代码实现场景中，<strong>你对问题的清晰描述和分析</strong>是获得良好效果的基石。</p>
<p>如果你有一个清晰需求并附带一个清晰的范例，那么在实现需求的过程中速度上就会更快。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>