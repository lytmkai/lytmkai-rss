<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[SpringBoot 3.2 æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥ï¼š7ä¸ªè®©ä½ çš„åº”ç”¨æé€Ÿ50%çš„å…³é”®æŠ€å·§]]></title>    <link>https://juejin.cn/post/7576077034742824994</link>    <guid>https://juejin.cn/post/7576077034742824994</guid>    <pubDate>2025-11-24T04:16:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7576077034742824994" data-draft-id="7575413146923221007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2 æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥ï¼š7ä¸ªè®©ä½ çš„åº”ç”¨æé€Ÿ50%çš„å…³é”®æŠ€å·§"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T04:16:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2 æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥ï¼š7ä¸ªè®©ä½ çš„åº”ç”¨æé€Ÿ50%çš„å…³é”®æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T04:16:54.000Z" title="Mon Nov 24 2025 04:16:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2 æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥ï¼š7ä¸ªè®©ä½ çš„åº”ç”¨æé€Ÿ50%çš„å…³é”®æŠ€å·§</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>SpringBoot ä½œä¸º Java ç”Ÿæ€ä¸­æœ€æµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ä¹‹ä¸€ï¼Œå…¶æ˜“ç”¨æ€§å’Œå¼€ç®±å³ç”¨çš„ç‰¹æ€§æ·±å—å¼€å‘è€…å–œçˆ±ã€‚ç„¶è€Œï¼Œéšç€åº”ç”¨è§„æ¨¡çš„æ‰©å¤§å’Œä¸šåŠ¡å¤æ‚åº¦çš„æå‡ï¼Œæ€§èƒ½é—®é¢˜é€æ¸æˆä¸ºå¼€å‘è€…å…³æ³¨çš„ç„¦ç‚¹ã€‚SpringBoot 3.2 åœ¨æ€§èƒ½æ–¹é¢åšäº†å¤šé¡¹æ”¹è¿›ï¼Œä½†å¦‚ä½•å……åˆ†åˆ©ç”¨è¿™äº›ç‰¹æ€§å¹¶è¿›ä¸€æ­¥ä¼˜åŒ–åº”ç”¨ï¼Œä»ç„¶æ˜¯è®¸å¤šå¼€å‘è€…çš„æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ <strong>7 ä¸ªå…³é”®æŠ€å·§</strong>ï¼Œæ¶µç›–ä»ä»£ç ä¼˜åŒ–åˆ°åŸºç¡€è®¾æ–½è°ƒä¼˜çš„å…¨æ–¹ä½å®è·µï¼Œå¸®åŠ©ä½ å°† SpringBoot åº”ç”¨çš„æ€§èƒ½æå‡ <strong>50% ç”šè‡³æ›´å¤š</strong>ã€‚æ— è®ºä½ æ˜¯æ­£åœ¨è¿ç§»åˆ° SpringBoot 3.2ï¼Œè¿˜æ˜¯å¸Œæœ›ä¼˜åŒ–ç°æœ‰åº”ç”¨ï¼Œè¿™äº›æŠ€å·§éƒ½èƒ½ä¸ºä½ æä¾›åˆ‡å®å¯è¡Œçš„æŒ‡å¯¼ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸»ä½“</h2>
<h3 data-id="heading-3">1. <strong>å¯ç”¨ SpringBoot 3.2 çš„æ–°ç‰¹æ€§ï¼šè™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰</strong></h3>
<p>Java 21 å¼•å…¥äº†è™šæ‹Ÿçº¿ç¨‹ï¼ˆProject Loomï¼‰ï¼Œè€Œ SpringBoot 3.2 å¯¹å…¶æä¾›äº†åŸç”Ÿæ”¯æŒã€‚è™šæ‹Ÿçº¿ç¨‹å¯ä»¥æ˜¾è‘—å‡å°‘çº¿ç¨‹åˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œç‰¹åˆ«é€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚</p>
<h4 data-id="heading-4"><strong>å¦‚ä½•å¯ç”¨ï¼Ÿ</strong></h4>
<pre><code class="hljs language-properties" lang="properties">spring.threads.virtual.enabled=true
</code></pre>
<h4 data-id="heading-5"><strong>é€‚ç”¨åœºæ™¯</strong></h4>
<ul>
<li>I/Oå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€HTTPè¯·æ±‚ï¼‰ã€‚</li>
<li>é«˜å¹¶å‘å¾®æœåŠ¡åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-6"><strong>æ³¨æ„äº‹é¡¹</strong></h4>
<ul>
<li>CPUå¯†é›†å‹ä»»åŠ¡å¯èƒ½ä¸ä¼šå—ç›Šäºè™šæ‹Ÿçº¿ç¨‹ã€‚</li>
<li>JDKå¿…é¡»å‡çº§è‡³21æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">2. <strong>ä¼˜åŒ– JVM å‚æ•°ï¼šé€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†å™¨</strong></h3>
<p>JVMçš„åƒåœ¾æ”¶é›†ç­–ç•¥ç›´æ¥å½±å“åº”ç”¨çš„ååé‡å’Œå»¶è¿Ÿã€‚SpringBooté»˜è®¤ä½¿ç”¨G1 GCï¼ˆGarbage-Firstï¼‰ï¼Œä½†åœ¨ä¸åŒè´Ÿè½½ä¸‹å¯èƒ½éœ€è¦è°ƒæ•´æˆ–æ›´æ¢GCç­–ç•¥ã€‚</p>
<h4 data-id="heading-8"><strong>æ¨èé…ç½®</strong></h4>
<ul>
<li><strong>ä½å»¶è¿Ÿåœºæ™¯ï¼ˆå¦‚é‡‘èäº¤æ˜“ç³»ç»Ÿï¼‰</strong>: ZGCæˆ–Shenandoah GC</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">java -jar your-app.jar -XX:+UseZGC -Xmx4g -Xms4g
</code></pre>
<ul>
<li><strong>é«˜ååé‡åœºæ™¯ï¼ˆå¦‚æ‰¹å¤„ç†ä»»åŠ¡ï¼‰</strong>: G1 GCæˆ–Parallel GC</li>
</ul>
<h4 data-id="heading-9"><strong>å…³é”®è°ƒä¼˜ç‚¹</strong></h4>
<ul>
<li><code>MaxGCPauseMillis</code>ï¼šæ§åˆ¶æœ€å¤§åœé¡¿æ—¶é—´ï¼ˆé»˜è®¤200msï¼‰ã€‚</li>
<li><code>InitiatingHeapOccupancyPercent</code>ï¼šè§¦å‘GCçš„å †å ç”¨ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤45%ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-10">3. <strong>åˆ©ç”¨ GraalVM Native Image ï¼ˆAOTç¼–è¯‘ï¼‰å‡å°‘å¯åŠ¨æ—¶é—´å’Œå†…å­˜å ç”¨</strong></h3>
<p>GraalVM Native Imageå¯ä»¥å°†SpringBootåº”ç”¨ç¼–è¯‘ä¸ºæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæå¤§é™ä½å¯åŠ¨æ—¶é—´å’Œå†…å­˜æ¶ˆè€—ï¼ˆé€šå¸¸å‡å°‘50%ä»¥ä¸Šï¼‰ã€‚Spring Boot3.2å¯¹GraalVMçš„æ”¯æŒæ›´åŠ æˆç†Ÿã€‚</p>
<h4 data-id="heading-11"><strong>å®ç°æ­¥éª¤</strong></h4>
<p>1.æ·»åŠ ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.experimental<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.11.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>2.ç”ŸæˆNativeé•œåƒ:</p>
<pre><code class="hljs language-bash" lang="bash">mvn spring-boot:build-image -DskipTests
</code></pre>
<h4 data-id="heading-12"><strong>ä¼˜ç¼ºç‚¹åˆ†æ</strong></h4>
<p>âœ…Â ä¼˜åŠ¿ï¼šæå¿«çš„å¯åŠ¨é€Ÿåº¦ï¼ˆæ¯«ç§’çº§ï¼‰ã€æ›´ä½çš„å†…å­˜å ç”¨ã€‚<br/>
âŒÂ é™åˆ¶ï¼šåå°„/åŠ¨æ€ä»£ç†éœ€è¦é¢å¤–é…ç½®ã€è°ƒè¯•å¤æ‚åº¦è¾ƒé«˜ã€‚</p>
<hr/>
<h3 data-id="heading-13">4. <strong>åˆç†è®¾è®¡ç¼“å­˜ç­–ç•¥ï¼šé¿å…é‡å¤è®¡ç®—ä¸I/Oå¼€é”€</strong></h3>
<p>ç¼“å­˜æ˜¯æå‡æ€§èƒ½çš„é“¶å¼¹ä¹‹ä¸€ï¼Œä½†é”™è¯¯çš„ä½¿ç”¨ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–å†…å­˜æ³„æ¼ã€‚SpringBootæä¾›äº†å¤šç§ç¼“å­˜æŠ½è±¡ï¼ˆCaffeineã€Redisç­‰ï¼‰ã€‚</p>
<h4 data-id="heading-14"><strong>æœ€ä½³å®è·µå»ºè®®</strong></h4>
<p>1.<strong>å¤šçº§ç¼“å­˜æ¶æ„</strong>: Local Cache + Redisåˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Cacheable(value = "userCache", key = "#id")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-comment">// DBæŸ¥è¯¢é€»è¾‘...</span>
}
</code></pre>
<p>2.<strong>é¿å…ç¼“å­˜å‡»ç©¿</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Cacheable(cacheNames="users", sync=true)</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> { ... }
</code></pre>
<hr/>
<p>###5.<strong>æ•°æ®åº“è®¿é—®å±‚ä¼˜åŒ–ï¼šJPA/Hibernateè°ƒä¼˜</strong></p>
<p>æ•°æ®åº“é€šå¸¸æ˜¯æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨,ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ä¼˜åŒ–ç‚¹:</p>
<p>#####a)å¯ç”¨HibernateäºŒçº§ç¼“å­˜:</p>
<pre><code class="hljs language-properties" lang="properties">spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.provider_class=org.ehcache.jsr107.EhcacheCachingProvider
</code></pre>
<p>#####b)æ‰¹é‡å¤„ç†N+1æŸ¥è¯¢é—®é¢˜:</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Bad: </span>
List&lt;User&gt; users = userRepository<span class="hljs-selector-class">.findAll</span>();
users<span class="hljs-selector-class">.forEach</span>(u -&gt; System.out.println(u.getOrders())); <span class="hljs-comment">// N+1 queries!</span>

<span class="hljs-comment">// Good:</span>
<span class="hljs-keyword">@Query</span>(<span class="hljs-string">"SELECT u FROM User u JOIN FETCH u.orders"</span>)
List&lt;User&gt; findAllWithOrders();
</code></pre>
<hr/>
<p>###6.<strong>HTTP/2ä¸è¿æ¥æ± é…ç½®</strong></p>
<p>ç½‘ç»œä¼ è¾“æ•ˆç‡å¯¹å¾®æœåŠ¡è‡³å…³é‡è¦:</p>
<p>#####a)å¼ºåˆ¶å¯ç”¨HTTP/2(éœ€TLS):</p>
<pre><code class="hljs language-properties" lang="properties">server.http2.enabled=true
</code></pre>
<p>#####b)WebClientè¿æ¥æ± é…ç½®(é€‚ç”¨äºReactiveåº”ç”¨):</p>
<pre><code class="hljs language-scss" lang="scss">HttpClient<span class="hljs-selector-class">.create</span>()
          <span class="hljs-selector-class">.option</span>(ChannelOption.CONNECT_TIMEOUT_MILLIS,<span class="hljs-number">5000</span>)
          <span class="hljs-selector-class">.doOnConnected</span>(c-&gt;c.addHandlerLast(new ReadTimeoutHandler(<span class="hljs-number">10</span>)));
</code></pre>
<hr/>
<p>###7.<strong>ç›‘æ§ä¸æŒç»­ä¼˜åŒ–:ä½¿ç”¨Micrometer+Actuator</strong></p>
<p>æ²¡æœ‰åº¦é‡å°±æ²¡æœ‰ä¼˜åŒ–.Spring Boot Actuatoræä¾›ä¸°å¯Œçš„ç›‘æ§ç«¯ç‚¹:</p>
<p>#####æ ¸å¿ƒæŒ‡æ ‡é‡‡é›†é…ç½®:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">management.endpoints.web.exposure.include</span>=health,metrics,prometheus

<span class="hljs-comment"># Prometheusç¤ºä¾‹æ ¼å¼è¾“å‡º:</span>
http_server_requests_seconds_count{<span class="hljs-attr">uri</span>=<span class="hljs-string">"/api/users"</span>,status=<span class="hljs-string">"200"</span>}<span class="hljs-number">42</span>`
</code></pre>
<p>é€šè¿‡Grafanaä»ªè¡¨ç›˜å¯ç›´è§‚å‘ç°æ€§èƒ½ç“¶é¢ˆ.</p>
<hr/>
<p>##æ€»ç»“</p>
<p>æœ¬æ–‡ä»‹ç»çš„7å¤§æŠ€å·§ä»JVMåº•å±‚åˆ°æ¶æ„å±‚é¢å…¨æ–¹ä½è¦†ç›–äº†Spring Bootæ€§èƒ½ä¼˜åŒ–çš„å…³é”®è·¯å¾„:</p>
<p>1ï¸âƒ£åˆ©ç”¨è™šæ‹Ÿçº¿ç¨‹å¤„ç†é«˜å¹¶å‘IO<br/>
2ï¸âƒ£ç²¾ç»†è°ƒèŠ‚JVMå‚æ•°<br/>
3ï¸âƒ£åŸç”Ÿç¼–è¯‘æŠ€æœ¯é™æœ¬å¢æ•ˆ<br/>
4ï¸âƒ£æ™ºèƒ½ç¼“å­˜å‡è½»åç«¯å‹åŠ›<br/>
5ï¸âƒ£ORMå±‚æ·±åº¦è°ƒä¼˜<br/>
6ï¸âƒ£ç½‘ç»œä¼ è¾“åè®®å‡çº§<br/>
7ï¸âƒ£å»ºç«‹å¯è§‚æµ‹æ€§ä½“ç³»</p>
<p>å®é™…åº”ç”¨ä¸­éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯ç»„åˆæ­é…è¿™äº›ç­–ç•¥.A/Bæµ‹è¯•æ˜¯éªŒè¯æ•ˆæœçš„æœ€ä½³æ–¹å¼.Spring Bootçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒæä¾›äº†å……åˆ†çš„çµæ´»æ€§è®©å¼€å‘è€…å¯ä»¥åœ¨"çº¦å®šä¼˜äºé…ç½®"çš„åŸºç¡€ä¸Šè¿›è¡Œæ·±åº¦å®šåˆ¶.</p>
<p>çœŸæ­£çš„æè‡´æ€§èƒ½æ¥æºäºå¯¹æ¯ä¸ªæŠ€æœ¯ç»„ä»¶çš„æ·±åˆ»ç†è§£ä¸åˆç†è¿ç”¨,å¸Œæœ›æœ¬æŒ‡å—èƒ½å¸®åŠ©æ‚¨çš„åº”ç”¨çªç ´æ€§èƒ½ç“¶é¢ˆ!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker æ•°æ®æŒä¹…åŒ–å®Œå…¨æŒ‡å—ï¼šå››ç§æŒ‚è½½æ–¹å¼è¯¦è§£ä¸å®æˆ˜]]></title>    <link>https://juejin.cn/post/7575751471842295844</link>    <guid>https://juejin.cn/post/7575751471842295844</guid>    <pubDate>2025-11-24T03:43:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575751471842295844" data-draft-id="7575651989985935414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker æ•°æ®æŒä¹…åŒ–å®Œå…¨æŒ‡å—ï¼šå››ç§æŒ‚è½½æ–¹å¼è¯¦è§£ä¸å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T03:43:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker æ•°æ®æŒä¹…åŒ–å®Œå…¨æŒ‡å—ï¼šå››ç§æŒ‚è½½æ–¹å¼è¯¦è§£ä¸å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:43:03.000Z" title="Mon Nov 24 2025 03:43:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Docker å®¹å™¨åŒ–éƒ¨ç½²ä¸­ï¼Œæ•°æ®æŒä¹…åŒ–æ˜¯è‡³å…³é‡è¦çš„ä¸€ç¯ã€‚æœ¬æ–‡åŸºäºæ‚¨æä¾›çš„ docker-compose.yml æ–‡ä»¶å’Œå®é™…é¡¹ç›®åœºæ™¯ï¼Œè¯¦ç»†è§£æå››ç§ä¸»è¦çš„ Docker æŒ‚è½½æ–¹å¼ï¼š<strong>ç»‘å®šæŒ‚è½½</strong>ã€<strong>å‘½åå·æŒ‚è½½</strong>ã€<strong>åŒ¿åå·æŒ‚è½½</strong>å’Œ<strong>ç›®å½•æŒ‚è½½</strong>ï¼Œå¹¶é€šè¿‡ RocketMQ å¾®æœåŠ¡é¡¹ç›®è¿›è¡Œå®æˆ˜æ¼”ç¤ºã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å››ç§æŒ‚è½½æ–¹å¼æ¦‚è¿°</h2>
<h3 data-id="heading-1">1.1 æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”</h3>








































<table><thead><tr><th>æŒ‚è½½ç±»å‹</th><th>ç®¡ç†æ–¹å¼</th><th>æŒä¹…åŒ–</th><th>å¯è§æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>ç»‘å®šæŒ‚è½½</strong>â€‹</td><td>ç”¨æˆ·ç®¡ç†</td><td>æ˜¯</td><td>å®¿ä¸»æœºå¯è§</td><td>é…ç½®æ–‡ä»¶ã€å¼€å‘ç¯å¢ƒ</td></tr><tr><td><strong>å‘½åå·æŒ‚è½½</strong>â€‹</td><td>Docker ç®¡ç†</td><td>æ˜¯</td><td>Docker ç®¡ç†</td><td>æ•°æ®åº“æ•°æ®ã€ç”Ÿäº§ç¯å¢ƒ</td></tr><tr><td><strong>åŒ¿åå·æŒ‚è½½</strong>â€‹</td><td>Docker è‡ªåŠ¨</td><td>ä¸´æ—¶</td><td>éšè—</td><td>ç¼“å­˜ã€ä¸´æ—¶æ•°æ®</td></tr><tr><td><strong>ç›®å½•æŒ‚è½½</strong>â€‹</td><td>ç”¨æˆ·ç®¡ç†</td><td>æ˜¯</td><td>å®¿ä¸»æœºå¯è§</td><td>æ—¥å¿—ã€å…±äº«æ•°æ®</td></tr></tbody></table>
<h3 data-id="heading-2">1.2 åœ¨é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨</h3>
<p>æ ¹æ®æ‚¨çš„ docker-compose.yml æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># ç»‘å®šæŒ‚è½½ - é…ç½®æ–‡ä»¶ï¼ˆé‡ç‚¹åˆ†æï¼‰</span>
<span class="hljs-attr">rmqbroker:</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">./broker.conf:/opt/rocketmq/conf/broker.conf</span>

<span class="hljs-comment"># å‘½åå·æŒ‚è½½ - æ•°æ®åº“æ•°æ®</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>
<span class="hljs-attr">mongo:</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">mongo_data:/data/db</span>

<span class="hljs-comment"># ç›®å½•æŒ‚è½½ - åº”ç”¨æ—¥å¿—</span>
<span class="hljs-attr">my-springboot-app:</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/home/spring/logs</span>

<span class="hljs-comment"># åŒ¿åå·æŒ‚è½½ - rmqnamesrvï¼ˆæ— æ˜¾å¼é…ç½®ï¼‰</span>
</code></pre>
<h2 data-id="heading-3">äºŒã€ç»‘å®šæŒ‚è½½ (Bind Mounts) æ·±åº¦è§£æï¼šé…ç½®ç®¡ç†çš„ç»ˆæè§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-4">2.1 æŠ€æœ¯åŸç†ä¸å››å¤§æ ¸å¿ƒä¼˜åŠ¿</h3>
<p>ç»‘å®šæŒ‚è½½æ˜¯<strong>ç›´æ¥å°†å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿè·¯å¾„æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨</strong>çš„æŒ‚è½½æ–¹å¼ã€‚</p>
<h4 data-id="heading-5">âœ… é…ç½®å¤–éƒ¨åŒ– - é…ç½®ä¸é•œåƒåˆ†ç¦»</h4>
<pre><code class="hljs language-bash" lang="bash">rmqbroker:
  volumes:
    - ./broker.conf:/opt/rocketmq/conf/broker.conf
</code></pre>
<p><strong>å®ç°åŸç†ï¼š</strong></p>
<ul>
<li>é…ç½®æ–‡ä»¶å®Œå…¨ç‹¬ç«‹äº Docker é•œåƒ</li>
<li>é•œåƒä¿æŒçº¯å‡€ï¼Œä¸åŒ…å«ç¯å¢ƒç‰¹å®šé…ç½®</li>
<li>åŒä¸€é•œåƒå¯é€‚é…ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰</li>
</ul>
<p><strong>å®æˆ˜ä»·å€¼ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®</span>
config/
â”œâ”€â”€ dev/
â”‚   â””â”€â”€ broker.conf    <span class="hljs-comment"># å¼€å‘ç¯å¢ƒé…ç½®</span>
â”œâ”€â”€ <span class="hljs-built_in">test</span>/
â”‚   â””â”€â”€ broker.conf    <span class="hljs-comment"># æµ‹è¯•ç¯å¢ƒé…ç½®</span>
â””â”€â”€ prod/
    â””â”€â”€ broker.conf    <span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒé…ç½®</span>

<span class="hljs-comment"># é€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢é…ç½®</span>
docker compose -f docker-compose.yml -f docker-compose.dev.yml up
</code></pre>
<h4 data-id="heading-6">âœ… å®æ—¶ç¼–è¾‘ - å®¿ä¸»æœºä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ</h4>
<p><strong>æŠ€æœ¯å®ç°ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å®¿ä¸»æœºç¼–è¾‘é…ç½®æ–‡ä»¶</span>
vim broker.conf
<span class="hljs-comment"># ä¿®æ”¹ï¼šbrokerRole = SYNC_MASTER</span>

<span class="hljs-comment"># 2. å®¹å™¨å†…å®æ—¶åŒæ­¥ï¼ˆæ— éœ€é‡å¯ï¼‰</span>
docker compose <span class="hljs-built_in">exec</span> rmqbroker <span class="hljs-built_in">cat</span> /opt/rocketmq/conf/broker.conf
<span class="hljs-comment"># ç«‹å³çœ‹åˆ°ï¼šbrokerRole = SYNC_MASTER</span>

<span class="hljs-comment"># 3. çƒ­é‡è½½é…ç½®ï¼ˆéƒ¨åˆ†æœåŠ¡æ”¯æŒï¼‰</span>
docker compose <span class="hljs-built_in">exec</span> rmqbroker sh -c <span class="hljs-string">"kill -HUP 1"</span>
</code></pre>
<p><strong>å¼€å‘æ•ˆç‡æå‡ï¼š</strong></p>
<ul>
<li>å¼€å‘é˜¶æ®µï¼šé¿å…é‡å¤æ„å»ºé•œåƒ</li>
<li>è°ƒè¯•é˜¶æ®µï¼šå¿«é€ŸéªŒè¯é…ç½®å˜æ›´</li>
<li>è¿ç»´é˜¶æ®µï¼šç´§æ€¥é…ç½®ä¿®å¤</li>
</ul>
<h4 data-id="heading-7">âœ… ç‰ˆæœ¬æ§åˆ¶ - é…ç½®æ–‡ä»¶å¯çº³å…¥ Git ç®¡ç†</h4>
<p><strong>Git é›†æˆæ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶</span>
git add broker.conf docker-compose.yml
git commit -m <span class="hljs-string">"feat: update rocketmq broker configuration"</span>

<span class="hljs-comment"># é…ç½®å˜æ›´è¿½è¸ª</span>
git <span class="hljs-built_in">log</span> --oneline --follow broker.conf
<span class="hljs-comment"># è¾“å‡ºï¼ša1b2c3d ä¼˜åŒ–Brokerå†…å­˜é…ç½®</span>
<span class="hljs-comment">#       e4f5g6h åˆå§‹Brokeré…ç½®</span>

<span class="hljs-comment"># åˆ†æ”¯ç­–ç•¥ç®¡ç†</span>
git checkout feature/new-cluster
<span class="hljs-comment"># ä¿®æ”¹é…ç½®æµ‹è¯•æ–°åŠŸèƒ½</span>
</code></pre>
<p><strong>.gitignore é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># å¿½ç•¥ç”Ÿæˆçš„æ–‡ä»¶</span>
<span class="hljs-string">logs/</span>
<span class="hljs-string">data/</span>
<span class="hljs-string">tmp/</span>

<span class="hljs-comment"># ä¿ç•™é…ç½®æ–‡ä»¶</span>
<span class="hljs-type">!broker.conf</span>
<span class="hljs-type">!application.yml</span>

<span class="hljs-comment"># å¿½ç•¥æœ¬åœ°è¦†ç›–é…ç½®</span>
<span class="hljs-string">broker.conf.local</span>
<span class="hljs-string">application-*.yml</span>
</code></pre>
<h4 data-id="heading-8">âœ… ç¯å¢ƒé€‚é… - ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®</h4>
<p><strong>å¤šç¯å¢ƒé…ç½®ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.override.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">rmqbroker:</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config/dev/broker.conf:/opt/rocketmq/conf/broker.conf</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">JAVA_OPTS=-Xmx512m</span> <span class="hljs-string">-Xms512m</span>

<span class="hljs-comment"># docker-compose.prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">rmqbroker:</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config/prod/broker.conf:/opt/rocketmq/conf/broker.conf</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">JAVA_OPTS=-Xmx2g</span> <span class="hljs-string">-Xms2g</span>
</code></pre>
<p><strong>ç¯å¢ƒç‰¹å®šé…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># config/dev/broker.confï¼ˆå¼€å‘ç¯å¢ƒï¼‰</span>
<span class="hljs-attr">brokerRole</span> = ASYNC_MASTER
<span class="hljs-attr">flushDiskType</span> = ASYNC_FLUSH
<span class="hljs-attr">autoCreateTopicEnable</span> = <span class="hljs-literal">true</span>

<span class="hljs-comment"># config/prod/broker.confï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰  </span>
<span class="hljs-attr">brokerRole</span> = SYNC_MASTER
<span class="hljs-attr">flushDiskType</span> = SYNC_FLUSH
<span class="hljs-attr">autoCreateTopicEnable</span> = <span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-9">2.2 é¡¹ç›®å®æˆ˜ï¼šRocketMQ Broker é…ç½®ç»‘å®šçš„å®Œæ•´å·¥ä½œæµ</h3>
<p><strong>broker.conf é…ç½®æ–‡ä»¶å†…å®¹ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># RocketMQ Broker é…ç½® - å¤–éƒ¨åŒ–é…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">brokerClusterName</span> = <span class="hljs-variable">${CLUSTER_NAME:-DefaultCluster}</span>
<span class="hljs-attr">brokerName</span> = broker-<span class="hljs-variable">${BROKER_ID:-a}</span>
<span class="hljs-attr">brokerId</span> = <span class="hljs-variable">${BROKER_ID:-0}</span>

<span class="hljs-comment"># æ¶ˆæ¯å­˜å‚¨é…ç½®</span>
<span class="hljs-attr">deleteWhen</span> = <span class="hljs-number">04</span>
<span class="hljs-attr">fileReservedTime</span> = <span class="hljs-number">48</span>
<span class="hljs-attr">mapedFileSizeCommitLog</span> = <span class="hljs-number">1073741824</span>

<span class="hljs-comment"># é«˜å¯ç”¨é…ç½®</span>
<span class="hljs-attr">brokerRole</span> = <span class="hljs-variable">${BROKER_ROLE:-ASYNC_MASTER}</span>
<span class="hljs-attr">flushDiskType</span> = <span class="hljs-variable">${FLUSH_DISK_TYPE:-ASYNC_FLUSH}</span>

<span class="hljs-comment"># å¼€å‘ç¯å¢ƒç‰¹ä¾›</span>
<span class="hljs-attr">autoCreateTopicEnable</span> = <span class="hljs-variable">${AUTO_CREATE_TOPIC:-true}</span>
<span class="hljs-attr">autoCreateSubscriptionGroup</span> = <span class="hljs-variable">${AUTO_CREATE_SUBSCRIPTION:-true}</span>

<span class="hljs-comment"># åŠ¨æ€è·å–NameServeråœ°å€</span>
<span class="hljs-attr">namesrvAddr</span> = <span class="hljs-variable">${NAMESRV_ADDR:-rmqnamesrv:9876}</span>
</code></pre>
<p><strong>å®Œæ•´çš„é…ç½®ç®¡ç†æµæ°´çº¿ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># config-pipeline.sh - é…ç½®ç®¡ç†å®Œæ•´å·¥ä½œæµ</span>

<span class="hljs-comment"># 1. é…ç½®éªŒè¯</span>
<span class="hljs-function"><span class="hljs-title">validate_config</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ” éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•..."</span>
    docker compose config -q
    <span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®"</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âŒ é…ç½®æ–‡ä»¶å­˜åœ¨é”™è¯¯"</span>
        <span class="hljs-built_in">exit</span> 1
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 2. é…ç½®å·®å¼‚åŒ–æ£€æŸ¥</span>
<span class="hljs-function"><span class="hljs-title">check_config_diff</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ“Š æ£€æŸ¥é…ç½®å˜æ›´..."</span>
    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">"broker.conf.last"</span> ]; <span class="hljs-keyword">then</span>
        diff -u broker.conf.last broker.conf || <span class="hljs-literal">true</span>
    <span class="hljs-keyword">fi</span>
    <span class="hljs-built_in">cp</span> broker.conf broker.conf.last
}

<span class="hljs-comment"># 3. å®‰å…¨æ‰«æ</span>
<span class="hljs-function"><span class="hljs-title">security_scan</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ”’ é…ç½®æ–‡ä»¶å®‰å…¨æ‰«æ..."</span>
    <span class="hljs-comment"># æ£€æŸ¥æ•æ„Ÿä¿¡æ¯</span>
    <span class="hljs-keyword">if</span> grep -q <span class="hljs-string">"password|secret|key"</span> broker.conf; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âš ï¸  å‘ç°å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯ï¼Œè¯·ç¡®è®¤å·²è„±æ•"</span>
    <span class="hljs-keyword">fi</span>
}

<span class="hljs-comment"># 4. é…ç½®éƒ¨ç½²</span>
<span class="hljs-function"><span class="hljs-title">deploy_config</span></span>() {
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸš€ éƒ¨ç½²é…ç½®æ–‡ä»¶..."</span>
    docker compose restart rmqbroker
    <span class="hljs-built_in">sleep</span> 5
    docker compose logs rmqbroker --<span class="hljs-built_in">tail</span>=20
}

<span class="hljs-comment"># æ‰§è¡Œå®Œæ•´æµæ°´çº¿</span>
validate_config
check_config_diff  
security_scan
deploy_config
</code></pre>
<h3 data-id="heading-10">2.3 é…ç½®ç»‘å®šçš„é«˜çº§ç‰¹æ€§</h3>
<h4 data-id="heading-11">é…ç½®æ¨¡æ¿ä¸å˜é‡æ›¿æ¢</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä½¿ç”¨ envsubst è¿›è¡Œé…ç½®æ¨¡æ¿åŒ–</span>
cat &gt; broker.conf.template &lt;&lt; 'EOF'
<span class="hljs-attr">brokerClusterName</span> = <span class="hljs-variable">${CLUSTER_NAME}</span>
<span class="hljs-attr">brokerName</span> = broker-<span class="hljs-variable">${BROKER_ID}</span>
<span class="hljs-attr">namesrvAddr</span> = <span class="hljs-variable">${NAMESRV_ADDR}</span>
EOF

<span class="hljs-comment"># ç”Ÿæˆç¯å¢ƒç‰¹å®šé…ç½®</span>
export <span class="hljs-attr">CLUSTER_NAME</span>=ProductionCluster
export <span class="hljs-attr">BROKER_ID</span>=a
export <span class="hljs-attr">NAMESRV_ADDR</span>=rmqnamesrv:<span class="hljs-number">9876</span>

envsubst &lt; broker.conf.template &gt; broker.conf
</code></pre>
<h4 data-id="heading-12">é…ç½®åŠ å¯†ä¸å®‰å…¨</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ ansible-vault åŠ å¯†æ•æ„Ÿé…ç½®</span>
ansible-vault encrypt broker-secrets.conf

<span class="hljs-comment"># åœ¨ CI/CD ä¸­è§£å¯†</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$VAULT_PASSWORD</span> | ansible-vault decrypt \
  --output broker.conf \
  broker-secrets.conf
</code></pre>
<h2 data-id="heading-13">ä¸‰ã€å‘½åå·æŒ‚è½½ (Named Volumes) æ·±åº¦è§£æ</h2>
<h3 data-id="heading-14">3.1 æŠ€æœ¯åŸç†</h3>
<p>å‘½åå·æ˜¯ <strong>Docker ç®¡ç†çš„æŒä¹…åŒ–å­˜å‚¨å·</strong>ï¼Œå…·æœ‰å”¯ä¸€çš„åç§°ï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ã€‚</p>
<h3 data-id="heading-15">3.2 é¡¹ç›®å®æˆ˜ï¼šRedis å’Œ MongoDB æ•°æ®æŒä¹…åŒ–</h3>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">redis:</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>

<span class="hljs-attr">mongo:</span>
  <span class="hljs-attr">volumes:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">mongo_data:/data/db</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">mongo_config:/data/configdb</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">redis_data:</span>
  <span class="hljs-attr">mongo_data:</span>
  <span class="hljs-attr">mongo_config:</span>
</code></pre>
<p><strong>å®æˆ˜æ“ä½œï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æŸ¥çœ‹å‘½åå·ä¿¡æ¯</span>
docker volume <span class="hljs-built_in">ls</span>
docker volume inspect rocket-demo_redis_data

<span class="hljs-comment"># 2. æ•°æ®æŒä¹…åŒ–éªŒè¯</span>
<span class="hljs-comment"># å†™å…¥æµ‹è¯•æ•°æ®</span>
docker compose <span class="hljs-built_in">exec</span> redis redis-cli -a 123456 <span class="hljs-built_in">set</span> test_key <span class="hljs-string">"hello_redis"</span>

<span class="hljs-comment"># é‡å¯æœåŠ¡éªŒè¯æ•°æ®æŒä¹…åŒ–</span>
docker compose restart redis
docker compose <span class="hljs-built_in">exec</span> redis redis-cli -a 123456 get test_key

<span class="hljs-comment"># 3. å¤‡ä»½å‘½åå·æ•°æ®</span>
docker run --<span class="hljs-built_in">rm</span> -v rocket-demo_redis_data:/source -v $(<span class="hljs-built_in">pwd</span>)/backup:/backup alpine \
  tar czf /backup/redis_backup_$(<span class="hljs-built_in">date</span> +%Y%m%d).tar.gz -C /source .
</code></pre>
<p><strong>å‘½åå·å®é™…è·¯å¾„ï¼š</strong></p>
<p>æ ¹æ®æ‚¨çš„å›¾ç‰‡ä¿¡æ¯ï¼Œå‘½åå·å­˜å‚¨åœ¨ Docker é»˜è®¤è·¯å¾„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/var/lib/docker/volumes/rocket-demo_redis_data/_data
/var/lib/docker/volumes/rocket-demo_mongo_data/_data
</code></pre>
<h3 data-id="heading-16">3.3 ç®¡ç†å‘½ä»¤å¤§å…¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºå‘½åå·</span>
docker volume create my_volume

<span class="hljs-comment"># æŸ¥çœ‹å·è¯¦æƒ…</span>
docker volume inspect volume_name

<span class="hljs-comment"># å¤‡ä»½å·æ•°æ®</span>
docker run --<span class="hljs-built_in">rm</span> -v volume_name:/source -v $(<span class="hljs-built_in">pwd</span>):/backup alpine \
  tar czf /backup/backup.tar.gz -C /source .

<span class="hljs-comment"># æ¢å¤å·æ•°æ®</span>
docker run --<span class="hljs-built_in">rm</span> -v volume_name:/target -v $(<span class="hljs-built_in">pwd</span>):/backup alpine \
  tar xzf /backup/backup.tar.gz -C /target

<span class="hljs-comment"># æ¸…ç†æœªä½¿ç”¨å·</span>
docker volume prune
</code></pre>
<h2 data-id="heading-17">å››ã€åŒ¿åå·æŒ‚è½½ (Anonymous Volumes) æ·±åº¦è§£æ</h2>
<h3 data-id="heading-18">4.1 æŠ€æœ¯åŸç†</h3>
<p>åŒ¿åå·æ˜¯ <strong>Docker è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†çš„ä¸´æ—¶å·</strong>ï¼Œæ²¡æœ‰æŒ‡å®šåç§°ï¼Œé€šå¸¸ç”¨äºå®¹å™¨è¿è¡Œæ—¶æ•°æ®ã€‚</p>
<h3 data-id="heading-19">4.2 é¡¹ç›®å®æˆ˜ï¼šRocketMQ NameServer çš„åŒ¿åå·</h3>
<p><strong>é…ç½®åˆ†æï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">rmqnamesrv:</span>
  <span class="hljs-comment"># æ²¡æœ‰é…ç½® volumesï¼Œä½¿ç”¨åŒ¿åå·</span>
</code></pre>
<p><strong>æ ¹æ®æ‚¨çš„å›¾ç‰‡ä¿¡æ¯åˆ†æï¼š</strong></p>
<p>ä» <code>docker inspect rmqnamesrv</code>è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨ä½¿ç”¨åŒ¿åå·å­˜å‚¨è¿è¡Œæ—¶æ•°æ®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/var/lib/docker/containers/8fbef265e72791e4aa229079f5e5820929546bebd9fd5beabdf53458fbfae99c/
</code></pre>
<p><strong>å®æˆ˜éªŒè¯ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æŸ¥çœ‹åŒ¿åå·æŒ‚è½½ç‚¹</span>
docker inspect rmqnamesrv | grep -A 10 -B 5 Mounts

<span class="hljs-comment"># 2. éªŒè¯æ•°æ®éæŒä¹…åŒ–</span>
<span class="hljs-comment"># æŸ¥çœ‹å½“å‰å­˜å‚¨çŠ¶æ€</span>
docker compose <span class="hljs-built_in">exec</span> rmqnamesrv <span class="hljs-built_in">du</span> -sh /home/rocketmq/store

<span class="hljs-comment"># é‡å¯æœåŠ¡ï¼ˆæ•°æ®å¯èƒ½ä¸¢å¤±ï¼‰</span>
docker compose restart rmqnamesrv
</code></pre>
<h3 data-id="heading-20">4.3 åŒ¿åå·çš„å®é™…è·¯å¾„ç»“æ„</h3>
<pre><code class="hljs language-ini" lang="ini">/var/lib/docker/containers/<span class="hljs-section">[å®¹å™¨ID]</span>/
â”œâ”€â”€ mounts/           <span class="hljs-comment"># æŒ‚è½½ç‚¹ç›®å½•</span>
â”œâ”€â”€ resolv.conf       <span class="hljs-comment"># DNSé…ç½®</span>
â”œâ”€â”€ hosts             <span class="hljs-comment"># ä¸»æœºæ–‡ä»¶</span>
â”œâ”€â”€ hostname          <span class="hljs-comment"># ä¸»æœºå</span>
â””â”€â”€ <span class="hljs-section">[å®¹å™¨ID]</span>-json.log <span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶</span>
</code></pre>
<h2 data-id="heading-21">äº”ã€ç›®å½•æŒ‚è½½ (Directory Mounts) æ·±åº¦è§£æ</h2>
<h3 data-id="heading-22">5.1 æŠ€æœ¯åŸç†</h3>
<p>ç›®å½•æŒ‚è½½æ˜¯ç»‘å®šæŒ‚è½½çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œä¸“é—¨ç”¨äº<strong>æŒ‚è½½æ•´ä¸ªç›®å½•è€Œéå•ä¸ªæ–‡ä»¶</strong>ã€‚</p>
<h3 data-id="heading-23">5.2 é¡¹ç›®å®æˆ˜ï¼šSpringBoot åº”ç”¨æ—¥å¿—ç›®å½•</h3>
<p><strong>é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">my-springboot-app:
  volumes:
    - ./logs:/home/spring/logs
</code></pre>
<p><strong>ç›®å½•ç»“æ„è§„åˆ’ï¼š</strong></p>
<pre><code class="hljs language-lua" lang="lua">rocket-demo/
â”œâ”€â”€ logs/                           # æ—¥å¿—æ ¹ç›®å½•
â”‚   â”œâ”€â”€ application/               # åº”ç”¨æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ springboot-app.<span class="hljs-built_in">log</span>
â”‚   â”‚   â””â”€â”€ <span class="hljs-built_in">error</span>.<span class="hljs-built_in">log</span>
â”‚   â””â”€â”€ rocketmqlogs/              # RocketMQ å®¢æˆ·ç«¯æ—¥å¿—
â”‚       â”œâ”€â”€ rocketmq_client.<span class="hljs-built_in">log</span>
â”‚       â””â”€â”€ rocketmq_app.<span class="hljs-built_in">log</span>
â””â”€â”€ docker-compose.yml
</code></pre>
<p><strong>å®æˆ˜æ“ä½œï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. åˆ›å»ºæ—¥å¿—ç›®å½•ç»“æ„</span>
<span class="hljs-built_in">mkdir</span> -p logs/application logs/rocketmqlogs
<span class="hljs-built_in">chmod</span> 755 logs logs/application logs/rocketmqlogs

<span class="hljs-comment"># 2. éªŒè¯æ—¥å¿—å†™å…¥</span>
docker compose logs my-springboot-app
<span class="hljs-built_in">ls</span> -la logs/application/

<span class="hljs-comment"># 3. æ—¥å¿—è½®è½¬é…ç½®ï¼ˆåœ¨å®¿ä¸»æœºè®¾ç½®ï¼‰</span>
<span class="hljs-built_in">cat</span> &gt; /etc/logrotate.d/rocket-demo &lt;&lt; <span class="hljs-string">EOF
/root/rocket-demo/logs/application/*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    copytruncate
}
EOF</span>
</code></pre>
<h3 data-id="heading-24">5.3 æƒé™ç®¡ç†æœ€ä½³å®è·µ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è®¾ç½®æ­£ç¡®çš„ç›®å½•æƒé™</span>
sudo <span class="hljs-built_in">chown</span> -R 1000:1000 logs/    <span class="hljs-comment"># 1000 æ˜¯å®¹å™¨å†…åº”ç”¨ç”¨æˆ·çš„UID</span>
sudo <span class="hljs-built_in">chmod</span> -R 755 logs/

<span class="hljs-comment"># åœ¨ Dockerfile ä¸­ç¡®ä¿ç”¨æˆ·ä¸€è‡´æ€§</span>
<span class="hljs-comment"># FROM openjdk:8-jdk-alpine</span>
<span class="hljs-comment"># RUN adduser -D -u 1000 spring</span>
<span class="hljs-comment"># USER spring</span>
</code></pre>
<h2 data-id="heading-25">å…­ã€é…ç½®æ–‡ä»¶ç»‘å®šçš„å››å¤§ä¼˜åŠ¿æ·±åº¦å®æˆ˜</h2>
<h3 data-id="heading-26">6.1 âœ… é…ç½®å¤–éƒ¨åŒ–çš„ä¼ä¸šçº§å®è·µ</h3>
<p><strong>é…ç½®ä¸­å¿ƒæ¶æ„ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">config-center/
â”œâ”€â”€ <span class="hljs-keyword">base</span>/                 <span class="hljs-meta"># åŸºç¡€é…ç½®</span>
â”‚   â”œâ”€â”€ broker-<span class="hljs-keyword">base</span>.conf
â”‚   â””â”€â”€ application-<span class="hljs-keyword">base</span>.yml
â”œâ”€â”€ environments/         <span class="hljs-meta"># ç¯å¢ƒé…ç½®</span>
â”‚   â”œâ”€â”€ dev/
â”‚   â”œâ”€â”€ test/
â”‚   â””â”€â”€ prod/
â””â”€â”€ templates/           <span class="hljs-meta"># é…ç½®æ¨¡æ¿</span>
    â””â”€â”€ broker.conf.tpl
</code></pre>
<p><strong>åŠ¨æ€é…ç½®æ³¨å…¥ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># docker-compose.yml æ”¯æŒç¯å¢ƒå˜é‡æ³¨å…¥</span>
rmqbroker:
  volumes:
    - ./config/<span class="hljs-variable">${ENV:-dev}</span>/broker.conf:/opt/rocketmq/conf/broker.conf
  environment:
    - ENV=<span class="hljs-variable">${ENV:-dev}</span>
    - CLUSTER_NAME=<span class="hljs-variable">${CLUSTER_NAME:-DefaultCluster}</span>
</code></pre>
<h3 data-id="heading-27">6.2 âœ… å®æ—¶ç¼–è¾‘çš„å¼€å‘æ•ˆç‡æå‡</h3>
<p><strong>å¼€å‘è°ƒè¯•å·¥ä½œæµï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># dev-watch.sh - å¼€å‘ç¯å¢ƒé…ç½®ç›‘å¬å’Œçƒ­é‡è½½</span>

<span class="hljs-comment"># ç›‘å¬é…ç½®æ–‡ä»¶å˜åŒ–</span>
inotifywait -m -e modify broker.conf |
<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> path action file; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ”§ æ£€æµ‹åˆ°é…ç½®å˜æ›´: <span class="hljs-variable">$file</span>"</span>
    
    <span class="hljs-comment"># éªŒè¯é…ç½®è¯­æ³•</span>
    <span class="hljs-keyword">if</span> docker compose <span class="hljs-built_in">exec</span> rmqbroker <span class="hljs-built_in">test</span> -f /opt/rocketmq/conf/broker.conf; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… é…ç½®æ–‡ä»¶å·²åŒæ­¥åˆ°å®¹å™¨"</span>
        
        <span class="hljs-comment"># å°è¯•çƒ­é‡è½½</span>
        docker compose <span class="hljs-built_in">exec</span> rmqbroker sh -c <span class="hljs-string">"pkill -HUP java"</span> 2&gt;/dev/null &amp;&amp; \
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"ğŸ”¥ é…ç½®çƒ­é‡è½½æˆåŠŸ"</span> || \
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"âš ï¸  éœ€è¦é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-28">6.3 âœ… ç‰ˆæœ¬æ§åˆ¶çš„å®Œæ•´ Git ç­–ç•¥</h3>
<p><strong>Git åˆ†æ”¯ç­–ç•¥ï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># é…ç½®ç®¡ç†çš„ Git å·¥ä½œæµ</span>
git flow feature start broker-config-optimization

<span class="hljs-meta"># 1. åœ¨ç‰¹æ€§åˆ†æ”¯ä¿®æ”¹é…ç½®</span>
vim broker.conf
git <span class="hljs-keyword">add</span> broker.conf
git commit -m <span class="hljs-string">"feat: ä¼˜åŒ–Brokerå†…å­˜é…ç½®"</span>

<span class="hljs-meta"># 2. ä»£ç å®¡æŸ¥ååˆå¹¶</span>
git flow feature finish broker-config-optimization

<span class="hljs-meta"># 3. æ ‡ç­¾å‘å¸ƒ</span>
git tag -a v1<span class="hljs-number">.2</span><span class="hljs-number">.0</span>-config -m <span class="hljs-string">"ç‰ˆæœ¬1.2.0é…ç½®ä¼˜åŒ–"</span>
</code></pre>
<p><strong>.gitattributes é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># é…ç½®æ–‡ä»¶çš„åˆå¹¶ç­–ç•¥</span>
broker.conf <span class="hljs-attr">merge</span>=union
*.conf <span class="hljs-attr">diff</span>=config

<span class="hljs-comment"># æ•æ„Ÿé…ç½®æ¨¡æ¿</span>
broker.conf.example text <span class="hljs-attr">eol</span>=lf
</code></pre>
<h3 data-id="heading-29">6.4 âœ… ç¯å¢ƒé€‚é…çš„å®Œæ•´æ–¹æ¡ˆ</h3>
<p><strong>ç¯å¢ƒé…ç½®çŸ©é˜µï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># config-matrix.yml</span>
<span class="hljs-attr">environments:</span>
  <span class="hljs-attr">dev:</span>
    <span class="hljs-attr">broker_role:</span> <span class="hljs-string">ASYNC_MASTER</span>
    <span class="hljs-attr">auto_create_topic:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">memory:</span> <span class="hljs-string">512m</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">broker_role:</span> <span class="hljs-string">SYNC_MASTER</span>  
    <span class="hljs-attr">auto_create_topic:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">memory:</span> <span class="hljs-string">1g</span>
  <span class="hljs-attr">prod:</span>
    <span class="hljs-attr">broker_role:</span> <span class="hljs-string">SYNC_MASTER</span>
    <span class="hljs-attr">auto_create_topic:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">memory:</span> <span class="hljs-string">2g</span>
</code></pre>
<p><strong>é…ç½®ç”Ÿæˆè„šæœ¬ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># generate-config.sh - å¤šç¯å¢ƒé…ç½®ç”Ÿæˆ</span>

ENV=<span class="hljs-variable">${1:-dev}</span>
CONFIG_MATRIX=<span class="hljs-string">"config-matrix.yml"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"ç”Ÿæˆ <span class="hljs-variable">$ENV</span> ç¯å¢ƒé…ç½®..."</span>

<span class="hljs-comment"># ä»çŸ©é˜µä¸­æå–é…ç½®</span>
BROKER_ROLE=$(yq <span class="hljs-built_in">eval</span> <span class="hljs-string">".environments.<span class="hljs-variable">$ENV</span>.broker_role"</span> <span class="hljs-variable">$CONFIG_MATRIX</span>)
AUTO_TOPIC=$(yq <span class="hljs-built_in">eval</span> <span class="hljs-string">".environments.<span class="hljs-variable">$ENV</span>.auto_create_topic"</span> <span class="hljs-variable">$CONFIG_MATRIX</span>)

<span class="hljs-comment"># ç”Ÿæˆé…ç½®æ–‡ä»¶</span>
<span class="hljs-built_in">cat</span> &gt; config/<span class="hljs-variable">$ENV</span>/broker.conf &lt;&lt; <span class="hljs-string">EOF
# è‡ªåŠ¨ç”Ÿæˆé…ç½® - $ENV ç¯å¢ƒ
brokerRole = $BROKER_ROLE
autoCreateTopicEnable = $AUTO_TOPIC
flushDiskType = ASYNC_FLUSH
namesrvAddr = rmqnamesrv:9876
EOF</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… <span class="hljs-variable">$ENV</span> ç¯å¢ƒé…ç½®ç”Ÿæˆå®Œæˆ"</span>
</code></pre>
<h2 data-id="heading-30">ä¸ƒã€ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ</h2>
<h3 data-id="heading-31">7.1 æŒ‚è½½æ–¹å¼é€‰æ‹©æŒ‡å—</h3>









































<table><thead><tr><th>æ•°æ®ç±»å‹</th><th>æ¨èæŒ‚è½½æ–¹å¼</th><th>ç†ç”±</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>åº”ç”¨é…ç½®</strong>â€‹</td><td>ç»‘å®šæŒ‚è½½</td><td>å››å¤§ä¼˜åŠ¿å®Œç¾å¥‘åˆé…ç½®ç®¡ç†</td><td><code>./config:/app/config</code></td></tr><tr><td><strong>æ•°æ®åº“æ•°æ®</strong>â€‹</td><td>å‘½åå·</td><td>Docker ç®¡ç†ã€å¤‡ä»½æ–¹ä¾¿</td><td><code>db_data:/var/lib/mysql</code></td></tr><tr><td><strong>æ—¥å¿—æ–‡ä»¶</strong>â€‹</td><td>ç›®å½•æŒ‚è½½</td><td>å®æ—¶æŸ¥çœ‹ã€æ—¥å¿—æ”¶é›†</td><td><code>./logs:/app/logs</code></td></tr><tr><td><strong>ä¸´æ—¶ç¼“å­˜</strong>â€‹</td><td>åŒ¿åå·</td><td>è‡ªåŠ¨æ¸…ç†ã€æ€§èƒ½å¥½</td><td>ä¸é…ç½® volumes</td></tr><tr><td><strong>æ•æ„Ÿæ•°æ®</strong>â€‹</td><td>å‘½åå· + åŠ å¯†</td><td>å®‰å…¨éš”ç¦»</td><td><code>encrypted_volume:/secrets</code></td></tr></tbody></table>
<h3 data-id="heading-32">7.2 é…ç½®æ–‡ä»¶ç»‘å®šçš„å®‰å…¨åŠ å›º</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. é…ç½®æ–‡ä»¶æƒé™æ§åˆ¶</span>
<span class="hljs-built_in">chmod</span> 600 broker.conf                    <span class="hljs-comment"># åªå…è®¸æ‰€æœ‰è€…è¯»å†™</span>
<span class="hljs-built_in">chown</span> root:root broker.conf             <span class="hljs-comment">#  root ç”¨æˆ·æ‰€æœ‰æƒ</span>
setfacl -m u:spring:r broker.conf       <span class="hljs-comment"># å®¹å™¨ç”¨æˆ·åªè¯»æƒé™</span>

<span class="hljs-comment"># 2. é…ç½®åŠ å¯†å­˜å‚¨</span>
ansible-vault encrypt broker.conf       <span class="hljs-comment"># Ansible Vault åŠ å¯†</span>
gpg --encrypt --recipient devops@company.com broker.conf  <span class="hljs-comment"># GPG åŠ å¯†</span>

<span class="hljs-comment"># 3. é…ç½®å®Œæ•´æ€§éªŒè¯</span>
<span class="hljs-built_in">sha256sum</span> broker.conf &gt; broker.conf.sha256
<span class="hljs-comment"># éƒ¨ç½²å‰éªŒè¯</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(cat broker.conf.sha256)</span> broker.conf"</span> | <span class="hljs-built_in">sha256sum</span> -c
</code></pre>
<p><strong>å¥½çš„é…ç½®ç®¡ç†æ˜¯æˆåŠŸéƒ¨ç½²çš„åŸºçŸ³</strong>ï¼Œåˆç†è¿ç”¨è¿™äº›æŒ‚è½½ç­–ç•¥ï¼Œå°†æå¤§æå‡æ‚¨çš„ DevOps æ•ˆç‡å’Œç³»ç»Ÿå¯é æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JDK å·¥å…·å­¦ä¹ ç³»åˆ—ï¼ˆäº”ï¼‰ï¼šæ·±å…¥ç†è§£ javapã€å­—èŠ‚ç ä¸å¸¸é‡æ± ]]></title>    <link>https://juejin.cn/post/7575718948298096691</link>    <guid>https://juejin.cn/post/7575718948298096691</guid>    <pubDate>2025-11-24T03:04:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575718948298096691" data-draft-id="7575412016405823498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JDK å·¥å…·å­¦ä¹ ç³»åˆ—ï¼ˆäº”ï¼‰ï¼šæ·±å…¥ç†è§£ javapã€å­—èŠ‚ç ä¸å¸¸é‡æ± "/> <meta itemprop="keywords" content="Java,JVM"/> <meta itemprop="datePublished" content="2025-11-24T03:04:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—¥æœˆæ˜Ÿè¾°Ace"/> <meta itemprop="url" content="https://juejin.cn/user/2225067264583453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JDK å·¥å…·å­¦ä¹ ç³»åˆ—ï¼ˆäº”ï¼‰ï¼šæ·±å…¥ç†è§£ javapã€å­—èŠ‚ç ä¸å¸¸é‡æ± 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2225067264583453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—¥æœˆæ˜Ÿè¾°Ace
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:04:10.000Z" title="Mon Nov 24 2025 03:04:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JDK å·¥å…·å­¦ä¹ ç³»åˆ—ï¼ˆäº”ï¼‰ï¼šæ·±å…¥ç†è§£ javapã€JVM å­—èŠ‚ç ä¸å¸¸é‡æ± </h2>
<h3 data-id="heading-1">ç›®å½•</h3>
<ol>
<li><a href="#%E5%89%8D%E8%A8%80" title="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li>
<li><a href="#java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%9E%B6%E6%9E%84%E4%B8%8E%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B" title="#java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%9E%B6%E6%9E%84%E4%B8%8E%E6%89%A7%E8%A1%8C%E6%A8%A1%E5%9E%8B">Java è™šæ‹Ÿæœºæ¶æ„ä¸æ‰§è¡Œæ¨¡å‹</a>
<ul>
<li><a href="#jvm-%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84" title="#jvm-%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84">JVM çš„æ•´ä½“æ¶æ„</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E6%A0%88%E7%9A%84%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E" title="#%E5%9F%BA%E4%BA%8E%E6%A0%88%E7%9A%84%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E">åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“</a></li>
<li><a href="#jvm-%E7%9A%84%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84" title="#jvm-%E7%9A%84%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84">JVM çš„å†…å­˜ç»“æ„</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%AF%94%E7%89%B9%E5%AD%97%E8%8A%82%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81" title="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E6%AF%94%E7%89%B9%E5%AD%97%E8%8A%82%E4%B8%8E%E5%AD%97%E8%8A%82%E7%A0%81">åŸºç¡€æ¦‚å¿µï¼šæ¯”ç‰¹ã€å­—èŠ‚ä¸å­—èŠ‚ç </a>
<ul>
<li><a href="#%E6%AF%94%E7%89%B9bit%E4%B8%8E%E5%AD%97%E8%8A%82byte" title="#%E6%AF%94%E7%89%B9bit%E4%B8%8E%E5%AD%97%E8%8A%82byte">æ¯”ç‰¹ï¼ˆbitï¼‰ä¸å­—èŠ‚ï¼ˆbyteï¼‰</a></li>
<li><a href="#%E5%AD%97%E8%8A%82%E7%A0%81bytecode" title="#%E5%AD%97%E8%8A%82%E7%A0%81bytecode">å­—èŠ‚ç ï¼ˆBytecodeï¼‰</a></li>
<li><a href="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84" title="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">å­—èŠ‚ç æ–‡ä»¶ç»“æ„</a></li>
</ul>
</li>
<li><a href="#jvm-%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B" title="#jvm-%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B">JVM å­—èŠ‚ç çš„æ‰§è¡Œæµç¨‹</a>
<ul>
<li><a href="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E7%9A%84%E6%A0%BC%E5%BC%8F" title="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E7%9A%84%E6%A0%BC%E5%BC%8F">å­—èŠ‚ç æŒ‡ä»¤çš„æ ¼å¼</a></li>
<li><a href="#%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8" title="#%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8">æ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨</a></li>
<li><a href="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90" title="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90">å­—èŠ‚ç æ‰§è¡Œçš„å®é™…ä¾‹å­</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3" title="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3">å¸¸é‡æ± æœºåˆ¶è¯¦è§£</a>
<ul>
<li><a href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E7%B1%BB%E5%9E%8B" title="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E7%B1%BB%E5%9E%8B">å¸¸é‡æ± çš„ä½œç”¨ä¸ç±»å‹</a></li>
<li><a href="#%E5%AD%97%E8%8A%82%E7%A0%81%E4%B8%8E%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E5%85%B3%E7%B3%BB" title="#%E5%AD%97%E8%8A%82%E7%A0%81%E4%B8%8E%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E5%85%B3%E7%B3%BB">å­—èŠ‚ç ä¸å¸¸é‡æ± çš„å…³ç³»</a></li>
<li><a href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E5%AE%9E%E9%99%85%E5%86%85%E5%AE%B9%E4%B8%8E%E5%BC%95%E7%94%A8" title="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E7%9A%84%E5%AE%9E%E9%99%85%E5%86%85%E5%AE%B9%E4%B8%8E%E5%BC%95%E7%94%A8">å¸¸é‡æ± çš„å®é™…å†…å®¹ä¸å¼•ç”¨</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%91%BD%E4%BB%A4javap-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90" title="#%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7%E4%B8%8E%E5%91%BD%E4%BB%A4javap-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">å®ç”¨å·¥å…·ä¸å‘½ä»¤ï¼šjavap æ·±åº¦è§£æ</a>
<ul>
<li><a href="#javap-%E7%9A%84%E5%AE%98%E6%96%B9%E8%AF%B4%E6%98%8E" title="#javap-%E7%9A%84%E5%AE%98%E6%96%B9%E8%AF%B4%E6%98%8E">javap çš„å®˜æ–¹è¯´æ˜</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8-javap-%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%8F%82%E6%95%B0" title="#%E5%B8%B8%E7%94%A8-javap-%E5%91%BD%E4%BB%A4%E4%B8%8E%E5%8F%82%E6%95%B0">å¸¸ç”¨ javap å‘½ä»¤ä¸å‚æ•°</a></li>
<li><a href="#javap-%E8%BE%93%E5%87%BA%E8%AF%A6%E8%A7%A3%E4%B8%8E%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90" title="#javap-%E8%BE%93%E5%87%BA%E8%AF%A6%E8%A7%A3%E4%B8%8E%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90">javap è¾“å‡ºè¯¦è§£ä¸æ¡ˆä¾‹åˆ†æ</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B8%E8%A7%81%E7%96%91%E9%97%AE%E4%B8%8E%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90" title="#%E5%B8%B8%E8%A7%81%E7%96%91%E9%97%AE%E4%B8%8E%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90">å¸¸è§ç–‘é—®ä¸æ·±å…¥è§£æ</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%B0%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E5%85%A8%E6%B5%81%E7%A8%8B%E8%BF%BD%E8%B8%AA" title="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%B0%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84%E5%85%A8%E6%B5%81%E7%A8%8B%E8%BF%BD%E8%B8%AA">å®æˆ˜æ¡ˆä¾‹ï¼šä»æºç åˆ°å­—èŠ‚ç çš„å…¨æµç¨‹è¿½è¸ª</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE" title="#%E6%80%BB%E7%BB%93%E4%B8%8E%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE">æ€»ç»“ä¸å­¦ä¹ å»ºè®®</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" title="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ol>
<hr/>
<h3 data-id="heading-2">å‰è¨€</h3>
<p>åœ¨æ·±å…¥å­¦ä¹  Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰å’Œ JDK å·¥å…·çš„è¿‡ç¨‹ä¸­ï¼Œç†è§£å­—èŠ‚ã€å­—èŠ‚ç ã€å¸¸é‡æ± ä»¥åŠ JVM çš„æ ˆå¼æ¶æ„ï¼Œæ˜¯æŒæ¡ Java æ€§èƒ½è°ƒä¼˜ã€åº•å±‚åŸç†å’Œæ’æŸ¥å¤æ‚é—®é¢˜çš„åŸºç¡€ã€‚æœ¬æ–‡ç»“åˆå®é™…å­¦ä¹ è¿‡ç¨‹ã€å·¥å…·è¾“å‡ºå’Œå¸¸è§ç–‘é—®ï¼Œç³»ç»Ÿæ¢³ç†ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå¸®åŠ©ä½ å»ºç«‹ä»æºç åˆ°å­—èŠ‚ç å†åˆ° JVM æ‰§è¡Œçš„å®Œæ•´è®¤çŸ¥é“¾è·¯ã€‚</p>
<hr/>
<h3 data-id="heading-3">Java è™šæ‹Ÿæœºæ¶æ„ä¸æ‰§è¡Œæ¨¡å‹</h3>
<h4 data-id="heading-4">JVM çš„æ•´ä½“æ¶æ„</h4>
<p>JVM ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong>ç±»åŠ è½½å­ç³»ç»Ÿ</strong>ï¼šè´Ÿè´£åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–ç±»ã€‚</li>
<li><strong>è¿è¡Œæ—¶æ•°æ®åŒº</strong>ï¼šåŒ…æ‹¬æ–¹æ³•åŒºã€å †ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€ç¨‹åºè®¡æ•°å™¨ç­‰ã€‚</li>
<li><strong>æ‰§è¡Œå¼•æ“</strong>ï¼šè´Ÿè´£å­—èŠ‚ç çš„è§£é‡Šæ‰§è¡Œæˆ–å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰ã€‚</li>
<li><strong>æœ¬åœ°æ–¹æ³•æ¥å£</strong>ï¼šä¸æœ¬åœ°ï¼ˆC/C++ï¼‰åº“äº¤äº’ã€‚</li>
</ul>
<h4 data-id="heading-5">åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“</h4>
<p>JVM çš„æŒ‡ä»¤é›†æ˜¯**åŸºäºæ ˆï¼ˆStack-basedï¼‰**çš„ï¼Œè€Œä¸æ˜¯åŸºäºå¯„å­˜å™¨ã€‚å…¶ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ‰€æœ‰æ“ä½œéƒ½å›´ç»•æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰è¿›è¡Œã€‚</li>
<li>æŒ‡ä»¤é€šå¸¸æ˜¯â€œå¼¹å‡ºæ“ä½œæ•°ã€æ‰§è¡Œæ“ä½œã€ç»“æœå…¥æ ˆâ€ã€‚</li>
<li>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯è·¨å¹³å°æ€§å¼ºï¼ŒæŒ‡ä»¤é›†ç®€å•ï¼Œä¾¿äºè§£é‡Šæ‰§è¡Œã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;
</code></pre>
<p>å¯¹åº”å­—èŠ‚ç ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">iload_1   <span class="hljs-comment">// å°† a å‹å…¥æ ˆ</span>
iload_2   <span class="hljs-comment">// å°† b å‹å…¥æ ˆ</span>
iadd      <span class="hljs-comment">// å¼¹å‡º aã€bï¼Œç›¸åŠ åç»“æœå…¥æ ˆ</span>
istore_3  <span class="hljs-comment">// å¼¹å‡ºç»“æœï¼Œå­˜å…¥ c</span>
</code></pre>
<h4 data-id="heading-6">JVM çš„å†…å­˜ç»“æ„</h4>
<ul>
<li><strong>æ“ä½œæ•°æ ˆ</strong>ï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶éƒ½æœ‰ç‹¬ç«‹çš„æ“ä½œæ•°æ ˆï¼Œä¸´æ—¶å­˜æ”¾è®¡ç®—è¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚</li>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼šå­˜æ”¾æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚</li>
<li><strong>å †</strong>ï¼šå­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚</li>
<li><strong>æ–¹æ³•åŒº</strong>ï¼šå­˜æ”¾ç±»å…ƒæ•°æ®ã€å¸¸é‡æ± ã€é™æ€å˜é‡ç­‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">åŸºç¡€æ¦‚å¿µï¼šæ¯”ç‰¹ã€å­—èŠ‚ä¸å­—èŠ‚ç </h3>
<h4 data-id="heading-8">æ¯”ç‰¹ï¼ˆbitï¼‰ä¸å­—èŠ‚ï¼ˆbyteï¼‰</h4>
<ul>
<li><strong>æ¯”ç‰¹ï¼ˆbitï¼‰</strong>ï¼šæœ€å°çš„æ•°æ®å•ä½ï¼Œ0 æˆ– 1ã€‚</li>
<li><strong>å­—èŠ‚ï¼ˆbyteï¼‰</strong>ï¼š8 ä¸ªæ¯”ç‰¹ç»„æˆï¼Œè®¡ç®—æœºæœ€å°çš„å¯»å€å•ä½ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆç”¨å­—èŠ‚è€Œä¸æ˜¯æ¯”ç‰¹ï¼Ÿ</strong></p>
<ul>
<li>ç°ä»£è®¡ç®—æœºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿä»¥å­—èŠ‚ä¸ºæœ€å°å¯»å€å•ä½ï¼Œä¾¿äºå­˜å‚¨å’Œè¯»å–ã€‚</li>
</ul>
<h4 data-id="heading-9">å­—èŠ‚ç ï¼ˆBytecodeï¼‰</h4>
<ul>
<li>Java æºç ç¼–è¯‘åç”Ÿæˆçš„ <code>.class</code> æ–‡ä»¶å³ä¸ºå­—èŠ‚ç æ–‡ä»¶ã€‚</li>
<li>å­—èŠ‚ç æ˜¯ä¸€ç§ä¸­é—´ä»£ç ï¼ŒJVM è§£é‡Šæˆ– JIT ç¼–è¯‘åæ‰§è¡Œã€‚</li>
</ul>
<h4 data-id="heading-10">å­—èŠ‚ç æ–‡ä»¶ç»“æ„</h4>
<p><code>.class</code> æ–‡ä»¶ç»“æ„åŒ…æ‹¬ï¼š</p>
<ul>
<li>é­”æ•°ï¼ˆMagic Numberï¼‰</li>
<li>ç‰ˆæœ¬å·</li>
<li><strong>å¸¸é‡æ± ï¼ˆConstant Poolï¼‰</strong></li>
<li>è®¿é—®æ ‡å¿—</li>
<li>ç±»/çˆ¶ç±»ä¿¡æ¯</li>
<li>å­—æ®µè¡¨</li>
<li>æ–¹æ³•è¡¨</li>
<li>å±æ€§è¡¨</li>
</ul>
<hr/>
<h3 data-id="heading-11">JVM å­—èŠ‚ç çš„æ‰§è¡Œæµç¨‹</h3>
<h4 data-id="heading-12">å­—èŠ‚ç æŒ‡ä»¤çš„æ ¼å¼</h4>
<ul>
<li>æ¯æ¡æŒ‡ä»¤ç”± 1 å­—èŠ‚æ“ä½œç ï¼ˆopcodeï¼‰+ è‹¥å¹²æ“ä½œæ•°ï¼ˆoperandï¼‰ç»„æˆã€‚</li>
<li>æŒ‡ä»¤é•¿åº¦ä¸ä¸€ï¼Œå¯¼è‡´å­—èŠ‚ç åç§»é‡ï¼ˆoffsetï¼‰ä¸è¿ç»­ã€‚</li>
</ul>
<h4 data-id="heading-13">æ“ä½œæ•°æ ˆä¸å±€éƒ¨å˜é‡è¡¨</h4>
<ul>
<li><strong>æ“ä½œæ•°æ ˆ</strong>ï¼šæ–¹æ³•æ‰§è¡Œæ—¶ç”¨äºä¸´æ—¶å­˜æ”¾æ•°æ®å’Œæ“ä½œç»“æœã€‚</li>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼šå­˜æ”¾æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼ŒæŒ‰ç´¢å¼•è®¿é—®ã€‚</li>
</ul>
<h4 data-id="heading-14">å­—èŠ‚ç æ‰§è¡Œçš„å®é™…ä¾‹å­</h4>
<p><strong>Java ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
    <span class="hljs-keyword">return</span> a + b;
}
</code></pre>
<p><strong>javap -c -v è¾“å‡ºï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">0: iload_1</span>
<span class="hljs-section">1: iload_2</span>
<span class="hljs-section">2: iadd</span>
<span class="hljs-section">3: ireturn</span>
</code></pre>
<ul>
<li><code>iload_1</code>ï¼šå°†ç¬¬ 1 ä¸ªæœ¬åœ°å˜é‡ï¼ˆaï¼‰åŠ è½½åˆ°æ“ä½œæ•°æ ˆ</li>
<li><code>iload_2</code>ï¼šå°†ç¬¬ 2 ä¸ªæœ¬åœ°å˜é‡ï¼ˆbï¼‰åŠ è½½åˆ°æ“ä½œæ•°æ ˆ</li>
<li><code>iadd</code>ï¼šå¼¹å‡ºæ ˆé¡¶ä¸¤ä¸ª int ç›¸åŠ ï¼Œç»“æœå…¥æ ˆ</li>
<li><code>ireturn</code>ï¼šè¿”å› int ç±»å‹ç»“æœ</li>
</ul>
<hr/>
<h3 data-id="heading-15">å¸¸é‡æ± æœºåˆ¶è¯¦è§£</h3>
<h4 data-id="heading-16">å¸¸é‡æ± çš„ä½œç”¨ä¸ç±»å‹</h4>
<ul>
<li>å¸¸é‡æ± æ˜¯ <code>.class</code> æ–‡ä»¶ä¸­çš„ä¸€å¼ â€œè¡¨â€ï¼Œå­˜å‚¨ç±»ã€æ–¹æ³•ã€å­—æ®µçš„ç¬¦å·å¼•ç”¨ã€å­—ç¬¦ä¸²å­—é¢é‡ã€æ•°å€¼å¸¸é‡ç­‰ã€‚</li>
<li>å¸¸é‡æ± é¡¹ç±»å‹åŒ…æ‹¬ï¼š
<ul>
<li><code>CONSTANT_Class</code>ï¼šç±»æˆ–æ¥å£å¼•ç”¨</li>
<li><code>CONSTANT_Fieldref</code>ï¼šå­—æ®µå¼•ç”¨</li>
<li><code>CONSTANT_Methodref</code>ï¼šæ–¹æ³•å¼•ç”¨</li>
<li><code>CONSTANT_String</code>ï¼šå­—ç¬¦ä¸²å­—é¢é‡</li>
<li><code>CONSTANT_Integer</code>ã€<code>CONSTANT_Float</code>ã€<code>CONSTANT_Long</code>ã€<code>CONSTANT_Double</code>ï¼šæ•°å€¼å¸¸é‡</li>
<li><code>CONSTANT_NameAndType</code>ï¼šåç§°å’Œæè¿°ç¬¦</li>
</ul>
</li>
</ul>
<h4 data-id="heading-17">å­—èŠ‚ç ä¸å¸¸é‡æ± çš„å…³ç³»</h4>
<ul>
<li>å­—èŠ‚ç æŒ‡ä»¤å¦‚ <code>ldc #2</code>ã€<code>invokevirtual #5</code> ç­‰ï¼Œåé¢çš„æ•°å­—æ˜¯å¸¸é‡æ± çš„ç´¢å¼•ã€‚</li>
<li>JVM é€šè¿‡å¸¸é‡æ± ç´¢å¼•æ‰¾åˆ°å®é™…çš„ç±»åã€æ–¹æ³•åã€å­—ç¬¦ä¸²ç­‰ä¿¡æ¯ï¼Œå®ç°ç¬¦å·å¼•ç”¨åˆ°ç›´æ¥å¼•ç”¨çš„è½¬æ¢ã€‚</li>
</ul>
<h4 data-id="heading-18">å¸¸é‡æ± çš„å®é™…å†…å®¹ä¸å¼•ç”¨</h4>
<p><strong>javap -v è¾“å‡ºç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Constant</span> <span class="hljs-selector-tag">pool</span>:
   <span class="hljs-selector-id">#1</span> = <span class="hljs-selector-tag">Methodref</span>          <span class="hljs-selector-id">#2</span>.<span class="hljs-selector-id">#3</span>         <span class="hljs-comment">// java/lang/Object."&lt;init&gt;":()V</span>
   <span class="hljs-selector-id">#2</span> = <span class="hljs-selector-tag">Class</span>              <span class="hljs-selector-id">#4</span>            <span class="hljs-comment">// java/lang/Object</span>
   <span class="hljs-selector-id">#3</span> = <span class="hljs-selector-tag">NameAndType</span>        <span class="hljs-selector-id">#5</span>:<span class="hljs-selector-id">#6</span>         <span class="hljs-comment">// "&lt;init&gt;":()V</span>
   <span class="hljs-selector-id">#4</span> = <span class="hljs-selector-tag">Utf8</span>               <span class="hljs-selector-tag">java</span>/<span class="hljs-selector-tag">lang</span>/<span class="hljs-selector-tag">Object</span>
   <span class="hljs-selector-id">#5</span> = <span class="hljs-selector-tag">Utf8</span>               &lt;<span class="hljs-selector-tag">init</span>&gt;
   <span class="hljs-selector-id">#6</span> = <span class="hljs-selector-tag">Utf8</span>               ()<span class="hljs-selector-tag">V</span>
</code></pre>
<ul>
<li><code>#1</code> æ˜¯æ–¹æ³•å¼•ç”¨ï¼ŒæŒ‡å‘ <code>#2</code>ï¼ˆç±»ï¼‰å’Œ <code>#3</code>ï¼ˆåç§°å’Œç±»å‹ï¼‰ã€‚</li>
<li><code>#4</code>ã€<code>#5</code>ã€<code>#6</code> æ˜¯ UTF-8 å­—ç¬¦ä¸²ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-19">å®ç”¨å·¥å…·ä¸å‘½ä»¤ï¼šjavap æ·±åº¦è§£æ</h3>
<h4 data-id="heading-20">javap çš„å®˜æ–¹è¯´æ˜</h4>
<blockquote>
<p>javap - disassemble one or more class files</p>
</blockquote>
<p><code>javap</code> æ˜¯ JDK è‡ªå¸¦çš„å­—èŠ‚ç åç¼–è¯‘å·¥å…·ï¼Œå¯ç”¨äºåˆ†æ <code>.class</code> æ–‡ä»¶ç»“æ„ã€å­—èŠ‚ç æŒ‡ä»¤å’Œå¸¸é‡æ± å†…å®¹ã€‚</p>
<h4 data-id="heading-21">å¸¸ç”¨ javap å‘½ä»¤ä¸å‚æ•°</h4>
<ul>
<li><code>javap -c ç±»å</code>ï¼šåç¼–è¯‘å­—èŠ‚ç </li>
<li><code>javap -v ç±»å</code>ï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¸¸é‡æ± </li>
<li><code>javap -c -v ç±»å</code>ï¼šåŒæ—¶æ˜¾ç¤ºå­—èŠ‚ç å’Œå¸¸é‡æ± </li>
<li><code>javap -l ç±»å</code>ï¼šæ˜¾ç¤ºè¡Œå·å’Œæœ¬åœ°å˜é‡è¡¨</li>
<li><code>javap -s ç±»å</code>ï¼šæ˜¾ç¤ºæ–¹æ³•ç­¾å</li>
</ul>
<h4 data-id="heading-22">javap è¾“å‡ºè¯¦è§£ä¸æ¡ˆä¾‹åˆ†æ</h4>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Demo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, JVM!"</span>;
        System.out.println(s);
    }
}
</code></pre>
<p><strong>javap -c -v Demo è¾“å‡ºç‰‡æ®µï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">public</span> <span class="hljs-string">static</span> <span class="hljs-string">void</span> <span class="hljs-string">main(java.lang.String[]);</span>
  <span class="hljs-attr">Code:</span>
     <span class="hljs-attr">0:</span> <span class="hljs-string">ldc</span>           <span class="hljs-comment">#2                  // String Hello, JVM!</span>
     <span class="hljs-attr">2:</span> <span class="hljs-string">astore_1</span>
     <span class="hljs-attr">3:</span> <span class="hljs-string">getstatic</span>     <span class="hljs-comment">#3                  // Field java/lang/System.out:Ljava/io/PrintStream;</span>
     <span class="hljs-attr">6:</span> <span class="hljs-string">aload_1</span>
     <span class="hljs-attr">7:</span> <span class="hljs-string">invokevirtual</span> <span class="hljs-comment">#4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
    <span class="hljs-attr">10:</span> <span class="hljs-string">return</span>
</code></pre>
<ul>
<li><code>ldc #2</code>ï¼šå°†å¸¸é‡æ± ç¬¬ 2 é¡¹ï¼ˆå­—ç¬¦ä¸²ï¼‰åŠ è½½åˆ°æ ˆ</li>
<li><code>getstatic #3</code>ï¼šè·å–å¸¸é‡æ± ç¬¬ 3 é¡¹ï¼ˆSystem.outï¼‰</li>
<li><code>invokevirtual #4</code>ï¼šè°ƒç”¨å¸¸é‡æ± ç¬¬ 4 é¡¹çš„æ–¹æ³•ï¼ˆprintlnï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-23">å¸¸è§ç–‘é—®ä¸æ·±å…¥è§£æ</h3>
<h4 data-id="heading-24">1. ä¸ºä»€ä¹ˆ JVM é‡‡ç”¨åŸºäºæ ˆçš„æ¶æ„ï¼Ÿ</h4>
<ul>
<li>è·¨å¹³å°æ€§å¼ºï¼ŒæŒ‡ä»¤é›†ç®€å•ï¼Œä¾¿äºè§£é‡Šæ‰§è¡Œã€‚</li>
<li>ä¸ä¾èµ–åº•å±‚ç¡¬ä»¶å¯„å­˜å™¨ï¼Œé€‚åˆå¤šç§ CPU æ¶æ„ã€‚</li>
</ul>
<h4 data-id="heading-25">2. å­—èŠ‚ç åç§»é‡ä¸ºä»€ä¹ˆä¸æ˜¯è¿ç»­çš„ï¼Ÿ</h4>
<ul>
<li>æ¯æ¡æŒ‡ä»¤é•¿åº¦ä¸åŒï¼Œåç§»é‡è¡¨ç¤ºæŒ‡ä»¤åœ¨å­—èŠ‚æµä¸­çš„èµ·å§‹ä½ç½®ï¼Œéè¿ç»­æ˜¯æ­£å¸¸ç°è±¡ã€‚</li>
</ul>
<h4 data-id="heading-26">3. ä¸ºä»€ä¹ˆç”¨å­—èŠ‚ï¼ˆbyteï¼‰è€Œä¸æ˜¯æ¯”ç‰¹ï¼ˆbitï¼‰å­˜å‚¨ï¼Ÿ</h4>
<ul>
<li>è®¡ç®—æœºç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿä»¥å­—èŠ‚ä¸ºæœ€å°å¯»å€å•ä½ï¼Œä¾¿äºå­˜å‚¨å’Œè¯»å–ã€‚</li>
</ul>
<h4 data-id="heading-27">4. å¸¸é‡æ± å’Œå­—èŠ‚ç çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>å­—èŠ‚ç é€šè¿‡å¸¸é‡æ± ç´¢å¼•é—´æ¥å¼•ç”¨ç±»ã€æ–¹æ³•ã€å­—æ®µã€å­—ç¬¦ä¸²ç­‰ï¼Œå¸¸é‡æ± æ˜¯å­—èŠ‚ç çš„â€œå­—å…¸â€ã€‚</li>
</ul>
<h4 data-id="heading-28">5. å¦‚ä½•é€šè¿‡ javap è¿½è¸ªæºç åˆ°å­—èŠ‚ç çš„æ˜ å°„ï¼Ÿ</h4>
<ul>
<li>ä½¿ç”¨ <code>javap -c -l</code> å¯æŸ¥çœ‹å­—èŠ‚ç ä¸æºç è¡Œå·ã€æœ¬åœ°å˜é‡è¡¨çš„å¯¹åº”å…³ç³»ï¼Œä¾¿äºè°ƒè¯•å’Œæ€§èƒ½åˆ†æã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-29">å®æˆ˜æ¡ˆä¾‹ï¼šä»æºç åˆ°å­—èŠ‚ç çš„å…¨æµç¨‹è¿½è¸ª</h3>
<p><strong>1. ç¼–å†™ Java æºç </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
}
</code></pre>
<p><strong>2. ç¼–è¯‘ç”Ÿæˆ .class æ–‡ä»¶</strong></p>
<pre><code class="hljs language-shell" lang="shell">javac Calculator.java
</code></pre>
<p><strong>3. ä½¿ç”¨ javap åˆ†æå­—èŠ‚ç </strong></p>
<pre><code class="hljs language-shell" lang="shell">javap -c -v Calculator
</code></pre>
<p><strong>4. ç»“åˆå¸¸é‡æ± å’Œå­—èŠ‚ç ç†è§£æ‰§è¡Œæµç¨‹</strong></p>
<ul>
<li>é€šè¿‡ <code>iload_1</code>ã€<code>iload_2</code>ã€<code>iadd</code>ã€<code>ireturn</code> ç†è§£åŠ æ³•çš„æ ˆå¼æ‰§è¡Œè¿‡ç¨‹ã€‚</li>
<li>é€šè¿‡ <code>ldc #n</code>ã€<code>invokevirtual #n</code> ç†è§£å¸¸é‡æ± å¼•ç”¨çš„è§£ç è¿‡ç¨‹ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-30">æ€»ç»“ä¸å­¦ä¹ å»ºè®®</h3>
<ul>
<li>JVM çš„æ ˆå¼æ¶æ„å’Œå­—èŠ‚ç æ‰§è¡Œæœºåˆ¶æ˜¯ Java è·¨å¹³å°å’Œé«˜å®‰å…¨æ€§çš„åŸºç¡€ã€‚</li>
<li>å¸¸é‡æ± æœºåˆ¶æå¤§æå‡äº†ç¬¦å·å¼•ç”¨çš„çµæ´»æ€§å’Œè¿è¡Œæ—¶æ•ˆç‡ã€‚</li>
<li>æŒæ¡ <code>javap</code> ç­‰å·¥å…·ï¼Œæœ‰åŠ©äºæºç çº§è°ƒè¯•ã€æ€§èƒ½åˆ†æå’Œåº•å±‚åŸç†å­¦ä¹ ã€‚</li>
<li>å»ºè®®å¤šç»“åˆå®é™…ä»£ç ã€å·¥å…·è¾“å‡ºå’Œå®˜æ–¹æ–‡æ¡£ï¼Œåå¤å®è·µã€æ·±å…¥ç†è§£ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-31">å‚è€ƒèµ„æ–™</h3>
<ul>
<li>ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºã€‹</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2Fspecs%2Fjvms%2Fse17%2Fhtml%2Findex.html" target="_blank" title="https://docs.oracle.com/javase/specs/jvms/se17/html/index.html" ref="nofollow noopener noreferrer">The JavaÂ® Virtual Machine Specification</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fjava%2Fjavase%2F17%2Fdocs%2Fspecs%2Fman%2Fjavap.html" target="_blank" title="https://docs.oracle.com/en/java/javase/17/docs/specs/man/javap.html" ref="nofollow noopener noreferrer">JDK å®˜æ–¹æ–‡æ¡£ - javap</a></li>
</ul>
<hr/>
<p>å¦‚éœ€è¿›ä¸€æ­¥æ¢è®¨ï¼Œæ¬¢è¿ç•™è¨€äº¤æµï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§è¯­è¨€æ¨¡å‹æ˜¯æ€ä¹ˆè®­ç»ƒå‡ºæ¥çš„ï¼Ÿä¸€ç¯‡å…¥é—¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575112613778702370</link>    <guid>https://juejin.cn/post/7575112613778702370</guid>    <pubDate>2025-11-23T22:11:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575112613778702370" data-draft-id="7575162322241011712" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§è¯­è¨€æ¨¡å‹æ˜¯æ€ä¹ˆè®­ç»ƒå‡ºæ¥çš„ï¼Ÿä¸€ç¯‡å…¥é—¨æŒ‡å—"/> <meta itemprop="keywords" content="LLM,æœºå™¨å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-11-23T22:11:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§è¯­è¨€æ¨¡å‹æ˜¯æ€ä¹ˆè®­ç»ƒå‡ºæ¥çš„ï¼Ÿä¸€ç¯‡å…¥é—¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T22:11:50.000Z" title="Sun Nov 23 2025 22:11:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ChatGPTã€Claudeè¿™äº›å¤§æ¨¡å‹åˆ°åº•æ˜¯æ€ä¹ˆè®­ç»ƒå‡ºæ¥çš„ï¼Ÿçœ‹ç€å®ƒä»¬èƒ½å†™æ–‡ç« ã€å†™ä»£ç ã€å›ç­”é—®é¢˜ï¼ŒèƒŒåçš„è®­ç»ƒè¿‡ç¨‹å…¶å®ä¹Ÿæ²¡é‚£ä¹ˆç¥ç§˜ã€‚ä»Šå¤©å°±ç”¨æœ€ç›´ç™½çš„æ–¹å¼èŠèŠè¿™ä¸ªæµç¨‹ã€‚</p>
<h2 data-id="heading-0">æ•´ä½“æµç¨‹é•¿å•¥æ ·</h2>
<p>å¤§æ¨¡å‹è®­ç»ƒå¯ä»¥åˆ†æˆå››ä¸ªä¸»è¦é˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µè§£å†³ä¸åŒçš„é—®é¢˜ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[æµ·é‡æ–‡æœ¬æ•°æ®] --&gt; B[é¢„è®­ç»ƒ Pre-training]
    B --&gt; C[åŸºåº§æ¨¡å‹ Base Model]
    C --&gt; D[ç›‘ç£å¾®è°ƒ SFT]
    D --&gt; E[æŒ‡ä»¤å¾®è°ƒæ¨¡å‹]
    E --&gt; F[è®­ç»ƒå¥–åŠ±æ¨¡å‹ RM]
    F --&gt; G[å¼ºåŒ–å­¦ä¹  RLHF]
    G --&gt; H[æœ€ç»ˆäº§å“æ¨¡å‹]
    
    style B fill:#667eea,color:#fff
    style D fill:#764ba2,color:#fff
    style F fill:#f093fb,color:#fff
    style G fill:#4facfe,color:#fff
</code></pre>
<p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p>
<ol>
<li>é¢„è®­ç»ƒ - è®©æ¨¡å‹å­¦ä¼š"è¯´è¯"</li>
<li>å¾®è°ƒ - æ•™å®ƒæ€ä¹ˆåšäº‹</li>
<li>å¥–åŠ±å»ºæ¨¡ - å‘Šè¯‰å®ƒä»€ä¹ˆæ˜¯å¥½çš„å›ç­”</li>
<li>å¼ºåŒ–å­¦ä¹  - è®©å®ƒè‡ªå·±ä¼˜åŒ–</li>
</ol>
<p>å¬èµ·æ¥æŒºæ¸…æ¥šçš„å¯¹å§ï¼Ÿä½†æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ä¸å°‘é—¨é“ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šé¢„è®­ç»ƒï¼ˆPre-trainingï¼‰</h2>
<p>é¢„è®­ç»ƒå°±æ˜¯è®©æ¨¡å‹çœ‹æµ·é‡çš„æ–‡æœ¬ï¼Œè‡ªå·±å­¦ä¹ è¯­è¨€è§„å¾‹ã€‚è¿™ä¸ªé˜¶æ®µæ¨¡å‹ä¼šå­¦ä¹ è¯æ±‡ã€è¯­æ³•ã€å¸¸è¯†ï¼Œç”šè‡³ä¸€äº›æ¨ç†èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-2">æ•°æ®è§„æ¨¡æœ‰å¤šå¤§ï¼Ÿ</h3>
<p>çœ‹çœ‹å‡ ä¸ªä¸»æµæ¨¡å‹çš„è®­ç»ƒæ•°æ®é‡ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[GPT-3&lt;br/&gt;300B tokens] --&gt; B[LLaMA&lt;br/&gt;1.4T tokens]
    B --&gt; C[LLaMA 2&lt;br/&gt;2T tokens]
    C --&gt; D[LLaMA 3&lt;br/&gt;15T tokens]
    
    style A fill:#e8f4f8
    style B fill:#d1e7f0
    style C fill:#b8dae8
    style D fill:#9fcde0
</code></pre>
<p>15ä¸‡äº¿ä¸ªtokenæ˜¯ä»€ä¹ˆæ¦‚å¿µï¼Ÿå¤§æ¦‚ç›¸å½“äº7500ä¸‡æœ¬ä¹¦ã€‚æ•°æ®é‡è¶Šå¤§ï¼Œæ¨¡å‹å­¦åˆ°çš„çŸ¥è¯†å°±è¶Šä¸°å¯Œã€‚</p>
<h3 data-id="heading-3">è®­ç»ƒç›®æ ‡ï¼šé¢„æµ‹ä¸‹ä¸€ä¸ªè¯</h3>
<p>é¢„è®­ç»ƒçš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼šç»™æ¨¡å‹ä¸€å¥è¯çš„å‰åŠéƒ¨åˆ†ï¼Œè®©å®ƒé¢„æµ‹ä¸‹ä¸€ä¸ªè¯æ˜¯ä»€ä¹ˆã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é¢„è®­ç»ƒçš„æœ¬è´¨</span>
input_text = <span class="hljs-string">"ä»Šå¤©å¤©æ°”çœŸ"</span>
<span class="hljs-comment"># æ¨¡å‹è¦é¢„æµ‹ï¼šå¥½ / å·® / å†· / çƒ­ ...</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">next_token_prediction</span>(<span class="hljs-params">context</span>):
    <span class="hljs-comment"># è®¡ç®—æ¯ä¸ªå¯èƒ½è¯çš„æ¦‚ç‡</span>
    probabilities = model(context)
    next_token = argmax(probabilities)
    <span class="hljs-keyword">return</span> next_token
</code></pre>
<p>é€šè¿‡ä¸æ–­é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼Œæ¨¡å‹é€æ¸å­¦ä¼šäº†è¯­è¨€çš„è§„å¾‹ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦äººå·¥æ ‡æ³¨ï¼Œå®Œå…¨æ˜¯è‡ªç›‘ç£å­¦ä¹ ã€‚</p>
<h3 data-id="heading-4">è®­ç»ƒæˆæœ¬</h3>
<p>é¢„è®­ç»ƒçš„æˆæœ¬æ˜¯æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­æœ€é«˜çš„ã€‚LLaMA 3è®­ç»ƒèŠ±äº†å‡ äº¿äººæ°‘å¸ï¼Œç”¨äº†å‡ åƒå¼ GPUè·‘äº†å‡ ä¸ªæœˆã€‚</p>
<h2 data-id="heading-5">ç¬¬äºŒæ­¥ï¼šç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰</h2>
<p>é¢„è®­ç»ƒå®Œä¹‹åï¼Œæ¨¡å‹è™½ç„¶å­¦ä¼šäº†è¯­è¨€ï¼Œä½†è¿˜ä¸çŸ¥é“æ€ä¹ˆæ­£ç¡®å›ç­”é—®é¢˜ã€‚è¿™æ—¶å€™å°±éœ€è¦å¾®è°ƒã€‚</p>
<h3 data-id="heading-6">å¾®è°ƒåœ¨åšä»€ä¹ˆï¼Ÿ</h3>
<p>ç»™æ¨¡å‹å‡†å¤‡ä¸€äº›æ ‡å‡†çš„é—®ç­”å¯¹ï¼Œæ•™å®ƒæ€ä¹ˆå›ç­”å„ç§é—®é¢˜ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># SFTçš„è®­ç»ƒæ•°æ®æ ¼å¼</span>
training_data = [
    {
        <span class="hljs-string">"instruction"</span>: <span class="hljs-string">"è¯·è§£é‡Šä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ "</span>,
        <span class="hljs-string">"response"</span>: <span class="hljs-string">"æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§è®©è®¡ç®—æœºä»æ•°æ®ä¸­å­¦ä¹ æ¨¡å¼çš„æŠ€æœ¯..."</span>
    },
    {
        <span class="hljs-string">"instruction"</span>: <span class="hljs-string">"ç”¨Pythonå†™ä¸€ä¸ªå†’æ³¡æ’åº"</span>,
        <span class="hljs-string">"response"</span>: <span class="hljs-string">"def bubble_sort(arr):\n    n = len(arr)\n    ..."</span>
    }
]

<span class="hljs-comment"># è®­ç»ƒæ—¶çš„ç›®æ ‡</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">sft_loss</span>(<span class="hljs-params">model, instruction, response</span>):
    predicted = model(instruction)
    <span class="hljs-comment"># è®©æ¨¡å‹è¾“å‡ºå°½å¯èƒ½æ¥è¿‘æ ‡å‡†ç­”æ¡ˆ</span>
    loss = cross_entropy(predicted, response)
    <span class="hljs-keyword">return</span> loss
</code></pre>
<h3 data-id="heading-7">æ•°æ®é‡å¯¹æ¯”</h3>
<p>é¢„è®­ç»ƒç”¨äº†ä¸‡äº¿çº§åˆ«çš„æ•°æ®ï¼Œä½†å¾®è°ƒåªéœ€è¦å‡ åä¸‡æ¡é«˜è´¨é‡çš„é—®ç­”å¯¹ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">pie title è®­ç»ƒæ•°æ®é‡å¯¹æ¯”
    "é¢„è®­ç»ƒæ•°æ®" : 99.9
    "å¾®è°ƒæ•°æ®" : 0.1
</code></pre>
<p>ä¸ºä»€ä¹ˆå·®è¿™ä¹ˆå¤šï¼Ÿå› ä¸ºé¢„è®­ç»ƒå­¦çš„æ˜¯è¯­è¨€çš„é€šç”¨èƒ½åŠ›ï¼Œè€Œå¾®è°ƒå­¦çš„æ˜¯å…·ä½“ä»»åŠ¡çš„æ ¼å¼ã€‚å°±åƒå­¦ä¼šäº†ä¸­æ–‡ï¼Œå†å­¦æ€ä¹ˆå†™æ–‡ç« å°±å¿«å¤šäº†ã€‚</p>
<h3 data-id="heading-8">å‡ ä¸ªè¦æ³¨æ„çš„åœ°æ–¹</h3>
<ol>
<li>
<p><strong>æ•°æ®è´¨é‡å¾ˆé‡è¦</strong>ï¼š100æ¡é«˜è´¨é‡æ•°æ®æ¯”1000æ¡ä½è´¨é‡æ•°æ®æ•ˆæœå¥½å¾—å¤šã€‚é«˜è´¨é‡æ„å‘³ç€å›ç­”å‡†ç¡®ã€å®Œæ•´ã€æœ‰ç»“æ„ã€‚</p>
</li>
<li>
<p><strong>ä»»åŠ¡å¤šæ ·æ€§</strong>ï¼šè¦è¦†ç›–é—®ç­”ã€æ€»ç»“ã€ä»£ç ã€ç¿»è¯‘å„ç§åœºæ™¯ï¼Œä¸èƒ½åªè®­ç»ƒä¸€ç§ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><strong>æ ¼å¼ç»Ÿä¸€</strong>ï¼šæœ€å¥½æœ‰æ¸…æ™°çš„æ¨¡æ¿ï¼Œæ¯”å¦‚ç»Ÿä¸€ç”¨"é—®é¢˜+å›ç­”"çš„æ ¼å¼ã€‚</p>
</li>
</ol>
<h2 data-id="heading-9">ç¬¬ä¸‰æ­¥ï¼šè®­ç»ƒå¥–åŠ±æ¨¡å‹ï¼ˆRMï¼‰</h2>
<p>è¿™ä¸€æ­¥æ˜¯è®­ç»ƒæµç¨‹ä¸­æ¯”è¾ƒå·§å¦™çš„è®¾è®¡ã€‚</p>
<h3 data-id="heading-10">ä¸ºä»€ä¹ˆéœ€è¦å¥–åŠ±æ¨¡å‹ï¼Ÿ</h3>
<p>åŒä¸€ä¸ªé—®é¢˜å¯èƒ½æœ‰å¤šä¸ªå¥½ç­”æ¡ˆï¼Œä¹Ÿæœ‰å¾ˆå¤šä¸å¥½çš„ç­”æ¡ˆã€‚æ€ä¹ˆè®©æ¨¡å‹çŸ¥é“å“ªä¸ªç­”æ¡ˆæ›´å¥½ï¼Ÿ</p>
<p>ç›´æ¥æ‰“åˆ†å¤ªä¸»è§‚äº†ï¼Œæ‰€ä»¥å°±è®­ç»ƒä¸€ä¸ªä¸“é—¨çš„å¥–åŠ±æ¨¡å‹æ¥è¯„åˆ¤ç­”æ¡ˆçš„è´¨é‡ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[åŒä¸€ä¸ªé—®é¢˜] --&gt; B[ç­”æ¡ˆA]
    A --&gt; C[ç­”æ¡ˆB]
    A --&gt; D[ç­”æ¡ˆC]
    
    B --&gt; E[äººç±»æ ‡æ³¨:&lt;br/&gt;A &gt; C &gt; B]
    C --&gt; E
    D --&gt; E
    
    E --&gt; F[è®­ç»ƒå¥–åŠ±æ¨¡å‹]
    F --&gt; G[å¯ä»¥ç»™ä»»ä½•ç­”æ¡ˆæ‰“åˆ†]
    
    style E fill:#f093fb,color:#fff
    style F fill:#667eea,color:#fff
</code></pre>
<h3 data-id="heading-11">æ€ä¹ˆè®­ç»ƒå¥–åŠ±æ¨¡å‹ï¼Ÿ</h3>
<p>æ ¸å¿ƒæ˜¯æ”¶é›†äººç±»çš„åå¥½æ•°æ®ã€‚ç»™æ ‡æ³¨å‘˜çœ‹ä¸¤ä¸ªç­”æ¡ˆï¼Œè®©ä»–é€‰å“ªä¸ªæ›´å¥½ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¥–åŠ±æ¨¡å‹çš„è®­ç»ƒ</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">train_reward_model</span>(<span class="hljs-params">question, answer_a, answer_b, human_preference</span>):
    score_a = reward_model(question, answer_a)
    score_b = reward_model(question, answer_b)
    
    <span class="hljs-keyword">if</span> human_preference == <span class="hljs-string">"A"</span>:
        <span class="hljs-comment"># Aåº”è¯¥å¾—åˆ†æ›´é«˜</span>
        loss = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, score_b - score_a + margin)
    <span class="hljs-keyword">else</span>:
        loss = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, score_a - score_b + margin)
    
    <span class="hljs-keyword">return</span> loss
</code></pre>
<p>è¿™ä¸ªè®¾è®¡å¾ˆèªæ˜ï¼šä¸éœ€è¦ç»™ç­”æ¡ˆæ‰“ç»å¯¹åˆ†æ•°ï¼Œåªéœ€è¦æ¯”è¾ƒç›¸å¯¹å¥½åã€‚æ ‡æ³¨èµ·æ¥ç®€å•å¤šäº†ã€‚</p>
<h3 data-id="heading-12">äººç±»åå¥½æ•°æ®</h3>
<p>è¿™éƒ¨åˆ†æ•°æ®é‡ä¸å¤§ï¼Œä¸€èˆ¬å°±å‡ ä¸‡æ¡ã€‚ä½†è´¨é‡è¦æ±‚å¾ˆé«˜ï¼Œå› ä¸ºè¿™ç›´æ¥å†³å®šäº†æ¨¡å‹çš„ä»·å€¼è§‚å’Œå›ç­”é£æ ¼ã€‚</p>
<h2 data-id="heading-13">ç¬¬å››æ­¥ï¼šå¼ºåŒ–å­¦ä¹ ï¼ˆRLHFï¼‰</h2>
<p>æœ€åä¸€æ­¥æ˜¯ç”¨å¼ºåŒ–å­¦ä¹ æ¥ä¼˜åŒ–æ¨¡å‹ã€‚RLHFå°±æ˜¯"ä»äººç±»åé¦ˆä¸­å¼ºåŒ–å­¦ä¹ "ã€‚</p>
<h3 data-id="heading-14">RLHFçš„æ ¸å¿ƒæ€æƒ³</h3>
<p>è®©æ¨¡å‹ä¸æ–­å°è¯•ç”Ÿæˆç­”æ¡ˆï¼Œç”¨å¥–åŠ±æ¨¡å‹æ‰“åˆ†ï¼Œç„¶åè°ƒæ•´ç­–ç•¥ï¼Œè¿½æ±‚æ›´é«˜çš„åˆ†æ•°ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[ç”¨æˆ·é—®é¢˜] --&gt; B[æ¨¡å‹ç”Ÿæˆå›ç­”]
    B --&gt; C[å¥–åŠ±æ¨¡å‹æ‰“åˆ†]
    C --&gt; D{åˆ†æ•°é«˜å—?}
    D --&gt;|é«˜| E[å¢å¼ºè¿™ç§å›ç­”æ–¹å¼]
    D --&gt;|ä½| F[æŠ‘åˆ¶è¿™ç§å›ç­”æ–¹å¼]
    E --&gt; B
    F --&gt; B
    
    style C fill:#667eea,color:#fff
    style E fill:#27ae60,color:#fff
    style F fill:#e74c3c,color:#fff
</code></pre>
<p>è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼è®­ç»ƒã€‚å›ç­”å¥½äº†å°±é¼“åŠ±ï¼Œå›ç­”ä¸å¥½å°±çº æ­£ã€‚æ¨¡å‹é€æ¸å­¦ä¼šä»€ä¹ˆæ ·çš„å›ç­”èƒ½è·å¾—é«˜åˆ†ã€‚</p>
<h3 data-id="heading-15">PPOç®—æ³•</h3>
<p>RLHFç”¨çš„æ˜¯PPOï¼ˆè¿‘ç«¯ç­–ç•¥ä¼˜åŒ–ï¼‰ç®—æ³•ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæ¯æ¬¡æ›´æ–°ç­–ç•¥çš„æ—¶å€™ï¼Œä¸è¦æ”¹å¾—å¤ªçŒ›ï¼Œä¿æŒç¨³å®šã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># PPOçš„ç®€åŒ–ç‰ˆæœ¬</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ppo_update</span>(<span class="hljs-params">model, question, old_answer, reward</span>):
    new_answer = model(question)
    
    <span class="hljs-comment"># è®¡ç®—ç­–ç•¥æ¯”å€¼</span>
    ratio = prob(new_answer) / prob(old_answer)
    
    <span class="hljs-comment"># Clipé˜²æ­¢å˜åŒ–å¤ªå¤§</span>
    clipped_ratio = clip(ratio, <span class="hljs-number">1</span>-epsilon, <span class="hljs-number">1</span>+epsilon)
    
    <span class="hljs-comment"># é€‰è¾ƒå°çš„é‚£ä¸ª</span>
    loss = -<span class="hljs-built_in">min</span>(ratio * reward, clipped_ratio * reward)
    
    <span class="hljs-keyword">return</span> loss
</code></pre>
<p>Clipæœºåˆ¶æ˜¯ä¸ºäº†é˜²æ­¢ç­–ç•¥çªå˜ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™ã€‚</p>
<h3 data-id="heading-16">RLHFçš„è¿­ä»£å¾ªç¯</h3>
<p>RLHFä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè€Œæ˜¯æŒç»­è¿›è¡Œçš„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[å½“å‰æ¨¡å‹] --&gt; B[ç”Ÿæˆå›ç­”]
    B --&gt; C[å¥–åŠ±æ¨¡å‹è¯„åˆ†]
    C --&gt; D[PPOæ›´æ–°]
    D --&gt; A
    
    E[æ”¶é›†æ–°çš„äººç±»åé¦ˆ] --&gt; F[æ›´æ–°å¥–åŠ±æ¨¡å‹]
    F --&gt; C
    
    style A fill:#667eea,color:#fff
    style D fill:#764ba2,color:#fff
    style F fill:#f093fb,color:#fff
</code></pre>
<p>ChatGPTå°±æ˜¯è¿™æ ·ä¸æ–­è¿­ä»£ä¼˜åŒ–çš„ã€‚ç”¨æˆ·çš„æ¯ä¸ªåé¦ˆæœ€ç»ˆéƒ½ä¼šç”¨æ¥æ”¹è¿›æ¨¡å‹ã€‚</p>
<h2 data-id="heading-17">æ•°æ®å’Œæˆæœ¬</h2>
<h2 data-id="heading-18">æ•°æ®å’Œæˆæœ¬</h2>
<p>è®­ç»ƒå¤§æ¨¡å‹éœ€è¦å¤šå°‘é’±ï¼Ÿçœ‹çœ‹ä¸åŒè§„æ¨¡æ¨¡å‹çš„æˆæœ¬å¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph å°æ¨¡å‹7B
        A1[ç¡¬ä»¶: 8å¡A100] --&gt; B1[æ—¶é—´: 1-2å‘¨]
        B1 --&gt; C1[æˆæœ¬: å‡ ä¸‡äººæ°‘å¸]
    end
    
    subgraph ä¸­æ¨¡å‹70B
        A2[ç¡¬ä»¶: 64å¡A100] --&gt; B2[æ—¶é—´: 1-2ä¸ªæœˆ]
        B2 --&gt; C2[æˆæœ¬: å‡ ç™¾ä¸‡]
    end
    
    subgraph å¤§æ¨¡å‹175B+
        A3[ç¡¬ä»¶: å‡ åƒå¡A100] --&gt; B3[æ—¶é—´: 3-6ä¸ªæœˆ]
        B3 --&gt; C3[æˆæœ¬: æ•°äº¿äººæ°‘å¸]
    end
    
    style C1 fill:#27ae60,color:#fff
    style C2 fill:#f39c12,color:#fff
    style C3 fill:#e74c3c,color:#fff
</code></pre>
<p>LLaMA 3.1çš„è®­ç»ƒæˆæœ¬ä¼°è®¡åœ¨5-10äº¿äººæ°‘å¸ï¼ŒGPT-4å¯èƒ½æ›´è´µã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰å¤§å…¬å¸æ‰èƒ½è®­ç»ƒé¡¶çº§æ¨¡å‹ã€‚</p>
<h3 data-id="heading-19">æ•°æ®å‡†å¤‡çš„æŒ‘æˆ˜</h3>
<p>æ•°æ®å‡†å¤‡æ˜¯æœ€è€—æ—¶çš„ç¯èŠ‚ï¼š</p>
<ol>
<li><strong>é¢„è®­ç»ƒæ•°æ®</strong>ï¼šè¦å»é‡ã€è¿‡æ»¤ä½è´¨é‡å†…å®¹ã€å»é™¤æœ‰å®³ä¿¡æ¯</li>
<li><strong>å¾®è°ƒæ•°æ®</strong>ï¼šéœ€è¦äººå·¥ç¼–å†™æˆ–ç­›é€‰ï¼Œè´¨é‡æ§åˆ¶å¾ˆéš¾</li>
<li><strong>åå¥½æ•°æ®</strong>ï¼šæ ‡æ³¨å‘˜è¦ç†è§£ä»»åŠ¡ï¼Œè¿˜è¦ä¿æŒä¸€è‡´æ€§</li>
</ol>
<h2 data-id="heading-20">ä¸»æµæ¨¡å‹å¯¹æ¯”</h2>
<p>ç°åœ¨å¼€æºå’Œé—­æºçš„å¤§æ¨¡å‹è¶Šæ¥è¶Šå¤šï¼Œçœ‹çœ‹å‡ ä¸ªä¸»æµçš„ï¼š</p>









































<table><thead><tr><th>æ¨¡å‹</th><th>å‚æ•°é‡</th><th>è®­ç»ƒæ•°æ®</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>GPT-3.5</td><td>175B</td><td>æœªå…¬å¼€</td><td>æœ€æ—©æµè¡Œçš„å¯¹è¯æ¨¡å‹</td></tr><tr><td>GPT-4</td><td>æœªå…¬å¼€</td><td>æœªå…¬å¼€</td><td>å¤šæ¨¡æ€ï¼Œæ€§èƒ½æœ€å¼º</td></tr><tr><td>LLaMA 3</td><td>8B/70B/405B</td><td>15T tokens</td><td>å¼€æºï¼Œæ€§èƒ½æ¥è¿‘GPT-4</td></tr><tr><td>Claude</td><td>æœªå…¬å¼€</td><td>æœªå…¬å¼€</td><td>é•¿ä¸Šä¸‹æ–‡ï¼Œå®‰å…¨æ€§å¥½</td></tr><tr><td>Qwen</td><td>7B/14B/72B</td><td>3T tokens</td><td>ä¸­æ–‡å‹å¥½</td></tr></tbody></table>
<p>é€‰æ‹©å»ºè®®ï¼š</p>
<ul>
<li><strong>è¿½æ±‚æ€§èƒ½</strong>ï¼šGPT-4æˆ–Claude 3.5</li>
<li><strong>ä¸­æ–‡åœºæ™¯</strong>ï¼šQwenæˆ–ChatGLM</li>
<li><strong>ç§æœ‰éƒ¨ç½²</strong>ï¼šLLaMA 3</li>
<li><strong>èµ„æºå—é™</strong>ï¼š7Bå°æ¨¡å‹ + å¾®è°ƒ</li>
</ul>
<h2 data-id="heading-21">å‡ ç‚¹ç†è§£</h2>
<h3 data-id="heading-22">1. æ•°æ®æ˜¯æ ¸å¿ƒèµ„äº§</h3>
<p>é¢„è®­ç»ƒç”¨äº†15ä¸‡äº¿tokenï¼Œä½†å¾®è°ƒå¯èƒ½åªè¦å‡ åä¸‡æ¡ã€‚å¥–åŠ±æ¨¡å‹çš„äººç±»åå¥½æ•°æ®æ›´æ˜¯åªæœ‰å‡ ä¸‡æ¡ã€‚</p>
<p><strong>é«˜è´¨é‡çš„äººç±»åé¦ˆæ•°æ®æ˜¯æ ¸å¿ƒç«äº‰åŠ›ã€‚</strong> è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å…¬å¸èƒ½ä¿æŒé¢†å…ˆçš„é‡è¦åŸå› ã€‚</p>
<h3 data-id="heading-23">2. è®­ç»ƒæ˜¯æŒç»­çš„è¿‡ç¨‹</h3>
<p>RLHFä¸æ˜¯è®­ç»ƒå®Œå°±ç»“æŸäº†ã€‚ChatGPTæ¯å‘¨éƒ½åœ¨æ›´æ–°ï¼Œä¸æ–­æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œä¼˜åŒ–æ¨¡å‹ã€‚</p>
<p>æ¨¡å‹éƒ¨ç½²åçš„è¿è¥ç»´æŠ¤ï¼Œå¯èƒ½æ¯”åˆå§‹è®­ç»ƒè¿˜é‡è¦ã€‚</p>
<h3 data-id="heading-24">3. å¯¹é½æ˜¯ä¸ªå¤§æŒ‘æˆ˜</h3>
<p>æœ€éš¾çš„ä¸æ˜¯è®©AIå˜èªæ˜ï¼Œè€Œæ˜¯è®©AIçš„ç›®æ ‡å’Œäººç±»ä¸€è‡´ã€‚RLHFæ˜¯ç›®å‰æœ€å¥½çš„å¯¹é½æ–¹æ¡ˆï¼Œä½†è¿˜ä¸å®Œç¾ã€‚</p>
<p>æœ‰æ—¶å€™æ¨¡å‹ä¼šè¿‡åº¦è¿åˆï¼Œæœ‰æ—¶å€™åˆä¼šäº§ç”Ÿä¸å½“è¾“å‡ºã€‚è¿™ä¸ªå¹³è¡¡ä¸€ç›´åœ¨æ¢ç´¢ã€‚</p>
<h2 data-id="heading-25">å®è·µå»ºè®®</h2>
<p>æ ¹æ®ä¸åŒè§’è‰²ï¼Œç»™ä¸€äº›å®é™…åº”ç”¨çš„å»ºè®®ï¼š</p>
<p><strong>å¦‚æœä½ æ˜¯ç ”ç©¶è€…</strong>ï¼š</p>
<ul>
<li>ä»å°æ¨¡å‹ï¼ˆ7Bï¼‰å¼€å§‹å®éªŒï¼Œæˆæœ¬å¯æ§</li>
<li>é‡ç‚¹ç ”ç©¶RLHFå’Œå¯¹é½é—®é¢˜ï¼Œè¿™æ˜¯æ ¸å¿ƒéš¾ç‚¹</li>
<li>å…³æ³¨DPOç­‰æ–°èŒƒå¼</li>
</ul>
<p><strong>å¦‚æœä½ æ˜¯ä¼ä¸š</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆç”¨APIï¼ˆGPT-4/Claudeï¼‰ï¼Œæˆæœ¬å’Œæ•ˆæœæœ€ä¼˜</li>
<li>æ•°æ®æ•æ„Ÿçš„è¯ï¼Œè€ƒè™‘ç§æœ‰éƒ¨ç½²LLaMA</li>
<li>ç§¯ç´¯è‡ªå·±çš„æ ‡æ³¨æ•°æ®ï¼Œè¿™æ˜¯é•¿æœŸèµ„äº§</li>
</ul>
<p><strong>å¦‚æœä½ æ˜¯å¼€å‘è€…</strong>ï¼š</p>
<ul>
<li>å­¦ä¹ Prompt Engineeringï¼Œè¿™æ˜¯æœ€å¿«ä¸Šæ‰‹çš„æ–¹å¼</li>
<li>æŒæ¡å¾®è°ƒæŠ€æœ¯ï¼Œèƒ½è§£å†³å¾ˆå¤šå®šåˆ¶åŒ–é—®é¢˜</li>
<li>äº†è§£RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ï¼Œè¡¥å……æ¨¡å‹çŸ¥è¯†</li>
</ul>
<h2 data-id="heading-26">å†™åœ¨æœ€å</h2>
<p>å¤§æ¨¡å‹è®­ç»ƒæ˜¯ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œæ¶‰åŠæ•°æ®ã€ç®—æ³•ã€å·¥ç¨‹ã€æˆæœ¬ç­‰å¤šä¸ªæ–¹é¢ã€‚ä»é¢„è®­ç»ƒåˆ°RLHFï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰è‡ªå·±çš„æŒ‘æˆ˜ã€‚</p>
<p>ç°åœ¨å¼€æºæ¨¡å‹è¶Šæ¥è¶Šå¤šï¼Œä¸ªäººå¼€å‘è€…ä¹Ÿæœ‰æœºä¼šå‚ä¸åˆ°è¿™ä¸ªé¢†åŸŸã€‚æ— è®ºæ˜¯ç ”ç©¶ã€åº”ç”¨è¿˜æ˜¯åˆ›ä¸šï¼Œéƒ½æœ‰å¾ˆå¤šæœºä¼šã€‚</p>
<p>ä½ åœ¨ç”¨å¤§æ¨¡å‹åšä»€ä¹ˆé¡¹ç›®ï¼Ÿè®­ç»ƒæˆ–å¾®è°ƒè¿‡ç¨‹ä¸­é‡åˆ°è¿‡ä»€ä¹ˆé—®é¢˜ï¼Ÿå¯¹æ–‡ç« é‡Œçš„å†…å®¹æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµè®¨è®ºï¼Œä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph1.0æ™ºèƒ½ä½“å¼€å‘ï¼šé€‰æ‹©API]]></title>    <link>https://juejin.cn/post/7575457788663808052</link>    <guid>https://juejin.cn/post/7575457788663808052</guid>    <pubDate>2025-11-24T02:02:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575457788663808052" data-draft-id="7575412016405364746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph1.0æ™ºèƒ½ä½“å¼€å‘ï¼šé€‰æ‹©API"/> <meta itemprop="keywords" content="LangChain,Agent,Python"/> <meta itemprop="datePublished" content="2025-11-24T02:02:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCode"/> <meta itemprop="url" content="https://juejin.cn/user/1282499717900794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph1.0æ™ºèƒ½ä½“å¼€å‘ï¼šé€‰æ‹©API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1282499717900794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:02:03.000Z" title="Mon Nov 24 2025 02:02:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>LangGraphæä¾›ä¸¤ç§ä¸åŒçš„APIç”¨äºæ„å»ºæ™ºèƒ½ä½“å·¥ä½œæµï¼šGraph APIå’ŒFunctional APIã€‚è¿™ä¸¤ç§ API å…±äº«ç›¸åŒçš„åº•å±‚è¿è¡Œæ—¶ç¯å¢ƒï¼Œä¸”å¯åœ¨åŒä¸€åº”ç”¨ä¸­æ­é…ä½¿ç”¨ï¼Œä½†å®ƒä»¬é’ˆå¯¹ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œå¼€å‘åå¥½è®¾è®¡ã€‚
æœ¬æ–‡æ—¨åœ¨å¸®åŠ©å¼€å‘è€…æ ¹æ®è‡ªèº«å…·ä½“éœ€æ±‚ï¼Œäº†è§£ä½•æ—¶åº”ä½¿ç”¨å“ªç§APIã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å¿«é€Ÿå†³ç­–æŒ‡å—</h2>
<p>å½“ä½ éœ€è¦ä»¥ä¸‹åŠŸèƒ½æ—¶ï¼Œä½¿ç”¨å›¾ APIï¼ˆGraph APIï¼‰ï¼š</p>
<ul>
<li>ç”¨äºè°ƒè¯•å’Œæ–‡æ¡£è®°å½•çš„å¤æ‚å·¥ä½œæµå¯è§†åŒ–</li>
<li>æ”¯æŒå¤šèŠ‚ç‚¹å…±äº«æ•°æ®çš„æ˜¾å¼çŠ¶æ€ç®¡ç†</li>
<li>åŒ…å«å¤šä¸ªå†³ç­–ç‚¹çš„æ¡ä»¶åˆ†æ”¯</li>
<li>åç»­éœ€åˆå¹¶çš„å¹¶è¡Œæ‰§è¡Œè·¯å¾„</li>
<li>å¯é€šè¿‡å¯è§†åŒ–å‘ˆç°è¾…åŠ©ç†è§£çš„å›¢é˜Ÿåä½œåœºæ™¯</li>
</ul>
<p>å½“ä½ éœ€è¦ä»¥ä¸‹åŠŸèƒ½æ—¶ï¼Œä½¿ç”¨å‡½æ•°å¼ APIï¼ˆFunctional APIï¼‰ï¼š</p>
<ul>
<li>å¯¹ç°æœ‰è¿‡ç¨‹å¼ä»£ç çš„æ”¹åŠ¨æœ€å°åŒ–</li>
<li>æ ‡å‡†æ§åˆ¶æµï¼ˆif/else æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ã€å‡½æ•°è°ƒç”¨ï¼‰</li>
<li>æ— éœ€æ˜¾å¼çŠ¶æ€ç®¡ç†çš„å‡½æ•°ä½œç”¨åŸŸçŠ¶æ€</li>
<li>æ›´å°‘æ¨¡æ¿ä»£ç ï¼ˆboilerplateï¼‰çš„å¿«é€ŸåŸå‹å¼€å‘</li>
<li>ä»…å«ç®€å•åˆ†æ”¯é€»è¾‘çš„çº¿æ€§å·¥ä½œæµ</li>
</ul>
<h2 data-id="heading-1">äºŒã€è¯¦ç»†å¯¹æ¯”</h2>
<h3 data-id="heading-2">2.1 ä½•æ—¶ä½¿ç”¨å›¾ APIï¼ˆGraph APIï¼‰</h3>
<p>å›¾APIé‡‡ç”¨å£°æ˜å¼æ–¹æ³•ï¼ˆdeclarative approachï¼‰ï¼Œé€šè¿‡å®šä¹‰èŠ‚ç‚¹ï¼ˆnodesï¼‰ã€è¾¹ï¼ˆedgesï¼‰å’Œå…±äº«çŠ¶æ€ï¼ˆshared stateï¼‰æ¥åˆ›å»ºå¯è§†åŒ–çš„å›¾ç»“æ„ï¼ˆvisual graph structureï¼‰ã€‚</p>
<h4 data-id="heading-3">1. å¤æ‚å†³ç­–æ ‘ä¸åˆ†æ”¯é€»è¾‘</h4>
<p>å½“ä½ çš„å·¥ä½œæµåŒ…å«å¤šä¸ªä¾èµ–äºä¸åŒæ¡ä»¶çš„å†³ç­–ç‚¹ï¼ˆdecision pointsï¼‰æ—¶ï¼Œå›¾ API èƒ½è®©è¿™äº›åˆ†æ”¯æ¸…æ™°å¯è§ï¼Œä¸”æ˜“äºå¯è§†åŒ–å‘ˆç°ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Graph API: Clear visualization of decision paths</span>
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    messages: <span class="hljs-built_in">list</span>
    current_tool: <span class="hljs-built_in">str</span>
    retry_count: <span class="hljs-built_in">int</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_continue</span>(<span class="hljs-params">state</span>):
    <span class="hljs-keyword">if</span> state[<span class="hljs-string">"retry_count"</span>] &gt; <span class="hljs-number">3</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>
    <span class="hljs-keyword">elif</span> state[<span class="hljs-string">"current_tool"</span>] == <span class="hljs-string">"search"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"process_search"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"call_llm"</span>

workflow = StateGraph(AgentState)
workflow.add_node(<span class="hljs-string">"call_llm"</span>, call_llm_node)
workflow.add_node(<span class="hljs-string">"process_search"</span>, search_node)
workflow.add_conditional_edges(<span class="hljs-string">"call_llm"</span>, should_continue)
</code></pre>
<h4 data-id="heading-4">2. è·¨å¤šä¸ªç»„ä»¶çš„çŠ¶æ€ç®¡ç†</h4>
<p>å½“ä½ éœ€è¦åœ¨å·¥ä½œæµçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´å…±äº«å¹¶åè°ƒçŠ¶æ€æ—¶ï¼Œå›¾ APIï¼ˆGraph APIï¼‰çš„æ˜¾å¼çŠ¶æ€ç®¡ç†ï¼ˆexplicit state managementï¼‰æœºåˆ¶å°†å‘æŒ¥é‡è¦ä½œç”¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Multiple nodes can access and modify shared state</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkflowState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    user_input: <span class="hljs-built_in">str</span>
    search_results: <span class="hljs-built_in">list</span>
    generated_response: <span class="hljs-built_in">str</span>
    validation_status: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_node</span>(<span class="hljs-params">state</span>):
    <span class="hljs-comment"># Access shared state</span>
    results = search(state[<span class="hljs-string">"user_input"</span>])
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"search_results"</span>: results}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">validation_node</span>(<span class="hljs-params">state</span>):
    <span class="hljs-comment"># Access results from previous node</span>
    is_valid = validate(state[<span class="hljs-string">"generated_response"</span>])
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"validation_status"</span>: <span class="hljs-string">"valid"</span> <span class="hljs-keyword">if</span> is_valid <span class="hljs-keyword">else</span> <span class="hljs-string">"invalid"</span>}
</code></pre>
<h4 data-id="heading-5">3. å¸¦åŒæ­¥æœºåˆ¶çš„å¹¶è¡Œå¤„ç†</h4>
<p>å½“ä½ éœ€è¦å¹¶è¡Œè¿è¡Œå¤šä¸ªæ“ä½œï¼Œéšåå†åˆå¹¶å®ƒä»¬çš„ç»“æœæ—¶ï¼Œå›¾ APIï¼ˆGraph APIï¼‰èƒ½è‡ªç„¶åœ°å¤„ç†è¿™ä¸€éœ€æ±‚ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Parallel processing of multiple data sources</span>
workflow.add_node(<span class="hljs-string">"fetch_news"</span>, fetch_news)
workflow.add_node(<span class="hljs-string">"fetch_weather"</span>, fetch_weather)
workflow.add_node(<span class="hljs-string">"fetch_stocks"</span>, fetch_stocks)
workflow.add_node(<span class="hljs-string">"combine_data"</span>, combine_all_data)

<span class="hljs-comment"># All fetch operations run in parallel</span>
workflow.add_edge(START, <span class="hljs-string">"fetch_news"</span>)
workflow.add_edge(START, <span class="hljs-string">"fetch_weather"</span>)
workflow.add_edge(START, <span class="hljs-string">"fetch_stocks"</span>)

<span class="hljs-comment"># Combine waits for all parallel operations to complete</span>
workflow.add_edge(<span class="hljs-string">"fetch_news"</span>, <span class="hljs-string">"combine_data"</span>)
workflow.add_edge(<span class="hljs-string">"fetch_weather"</span>, <span class="hljs-string">"combine_data"</span>)
workflow.add_edge(<span class="hljs-string">"fetch_stocks"</span>, <span class="hljs-string">"combine_data"</span>)
</code></pre>
<h4 data-id="heading-6">4. å›¢é˜Ÿå¼€å‘ä¸æ–‡æ¡£ç¼–åˆ¶</h4>
<p>å›¾ APIï¼ˆGraph APIï¼‰çš„å¯è§†åŒ–ç‰¹æ€§ï¼Œä½¿å¾—å›¢é˜Ÿæ›´æ˜“äºç†è§£ã€è®°å½•å’Œç»´æŠ¤å¤æ‚çš„å·¥ä½œæµã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Clear separation of concerns - each team member can work on different nodes</span>
workflow.add_node(<span class="hljs-string">"data_ingestion"</span>, data_team_function)
workflow.add_node(<span class="hljs-string">"ml_processing"</span>, ml_team_function)
workflow.add_node(<span class="hljs-string">"business_logic"</span>, product_team_function)
workflow.add_node(<span class="hljs-string">"output_formatting"</span>, frontend_team_function)
</code></pre>
<h3 data-id="heading-7">2.2 ä½•æ—¶ä½¿ç”¨å‡½æ•°å¼ APIï¼ˆFunctional APIï¼‰</h3>
<p>å‡½æ•°å¼ API é‡‡ç”¨å‘½ä»¤å¼æ–¹æ³•ï¼ˆimperative approachï¼‰ï¼Œå¯å°†LangGraphåŠŸèƒ½é›†æˆåˆ°æ ‡å‡†çš„è¿‡ç¨‹å¼ä»£ç ä¸­ã€‚</p>
<h4 data-id="heading-8">1. å¯¹ç°æœ‰è¿‡ç¨‹å¼ä»£ç çš„æ”¹åŠ¨æœ€å°åŒ–</h4>
<p>å½“ä½ å·²æ‹¥æœ‰ä½¿ç”¨æ ‡å‡†æ§åˆ¶æµï¼ˆstandard control flowï¼‰çš„ä»£ç ï¼Œä¸”å¸Œæœ›é€šè¿‡æœ€å°‘çš„é‡æ„ï¼ˆminimal refactoringï¼‰ä¸ºå…¶æ·»åŠ  LangGraph åŠŸèƒ½æ—¶ï¼Œé€‚åˆä½¿ç”¨å‡½æ•°å¼ APIã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Functional API: Minimal changes to existing code</span>
<span class="hljs-keyword">from</span> langgraph.func <span class="hljs-keyword">import</span> entrypoint, task

<span class="hljs-meta">@task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_user_input</span>(<span class="hljs-params">user_input: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-comment"># Existing function with minimal changes</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"processed"</span>: user_input.lower().strip()}

<span class="hljs-meta">@entrypoint(<span class="hljs-params">checkpointer=checkpointer</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">workflow</span>(<span class="hljs-params">user_input: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-comment"># Standard Python control flow</span>
    processed = process_user_input(user_input).result()

    <span class="hljs-keyword">if</span> <span class="hljs-string">"urgent"</span> <span class="hljs-keyword">in</span> processed[<span class="hljs-string">"processed"</span>]:
        response = handle_urgent_request(processed).result()
    <span class="hljs-keyword">else</span>:
        response = handle_normal_request(processed).result()

    <span class="hljs-keyword">return</span> response
</code></pre>
<h4 data-id="heading-9">2. å…·æœ‰ç®€å•é€»è¾‘çš„çº¿æ€§å·¥ä½œæµ</h4>
<p>å½“ä½ çš„å·¥ä½œæµä»¥é¡ºåºæ‰§è¡Œä¸ºä¸»ï¼Œä¸”ä»…åŒ…å«ç®€å•çš„æ¡ä»¶é€»è¾‘æ—¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@entrypoint(<span class="hljs-params">checkpointer=checkpointer</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">essay_workflow</span>(<span class="hljs-params">topic: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-comment"># Linear flow with simple branching</span>
    outline = create_outline(topic).result()

    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(outline[<span class="hljs-string">"points"</span>]) &lt; <span class="hljs-number">3</span>:
        outline = expand_outline(outline).result()

    draft = write_draft(outline).result()

    <span class="hljs-comment"># Human review checkpoint</span>
    feedback = interrupt({<span class="hljs-string">"draft"</span>: draft, <span class="hljs-string">"action"</span>: <span class="hljs-string">"Please review"</span>})

    <span class="hljs-keyword">if</span> feedback == <span class="hljs-string">"approve"</span>:
        final_essay = draft
    <span class="hljs-keyword">else</span>:
        final_essay = revise_essay(draft, feedback).result()

    <span class="hljs-keyword">return</span> {<span class="hljs-string">"essay"</span>: final_essay}
</code></pre>
<h4 data-id="heading-10">3. å¿«é€ŸåŸå‹å¼€å‘</h4>
<p>å½“ä½ å¸Œæœ›å¿«é€Ÿæµ‹è¯•æƒ³æ³•ï¼Œä¸”ä¸æƒ³æ‰¿æ‹…å®šä¹‰çŠ¶æ€æ¨¡å¼ï¼ˆstate schemasï¼‰å’Œå›¾ç»“æ„ï¼ˆgraph structuresï¼‰çš„é¢å¤–å¼€é”€æ—¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@entrypoint(<span class="hljs-params">checkpointer=checkpointer</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">quick_prototype</span>(<span class="hljs-params">data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-comment"># Fast iteration - no state schema needed</span>
    step1_result = process_step1(data).result()
    step2_result = process_step2(step1_result).result()

    <span class="hljs-keyword">return</span> {<span class="hljs-string">"final_result"</span>: step2_result}
</code></pre>
<h4 data-id="heading-11">4. å‡½æ•°ä½œç”¨åŸŸå†…çš„çŠ¶æ€ç®¡ç†</h4>
<p>å½“ä½ çš„çŠ¶æ€å¤©ç„¶é€‚åˆé™å®šåœ¨å•ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸå†…ï¼Œä¸”æ— éœ€è¿›è¡Œå¤§èŒƒå›´å…±äº«æ—¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_document</span>(<span class="hljs-params">document: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-comment"># Local state management within function</span>
    sections = extract_sections(document)
    summaries = [summarize(section) <span class="hljs-keyword">for</span> section <span class="hljs-keyword">in</span> sections]
    key_points = extract_key_points(summaries)

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"sections"</span>: <span class="hljs-built_in">len</span>(sections),
        <span class="hljs-string">"summaries"</span>: summaries,
        <span class="hljs-string">"key_points"</span>: key_points
    }

<span class="hljs-meta">@entrypoint(<span class="hljs-params">checkpointer=checkpointer</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">document_processor</span>(<span class="hljs-params">document: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    analysis = analyze_document(document).result()
    <span class="hljs-comment"># State is passed between functions as needed</span>
    <span class="hljs-keyword">return</span> generate_report(analysis).result()
</code></pre>
<h2 data-id="heading-12">ä¸‰ã€ç»„åˆä½¿ç”¨ä¸¤ç§API</h2>
<p>ä½ å¯ä»¥åœ¨åŒä¸€ä¸ªåº”ç”¨ä¸­åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§ APIã€‚å½“ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†æœ‰ä¸åŒéœ€æ±‚æ—¶ï¼Œè¿™ç§æ–¹å¼ä¼šéå¸¸å®ç”¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph
<span class="hljs-keyword">from</span> langgraph.func <span class="hljs-keyword">import</span> entrypoint

<span class="hljs-comment"># Complex multi-agent coordination using Graph API</span>
coordination_graph = StateGraph(CoordinationState)
coordination_graph.add_node(<span class="hljs-string">"orchestrator"</span>, orchestrator_node)
coordination_graph.add_node(<span class="hljs-string">"agent_a"</span>, agent_a_node)
coordination_graph.add_node(<span class="hljs-string">"agent_b"</span>, agent_b_node)

<span class="hljs-comment"># Simple data processing using Functional API</span>
<span class="hljs-meta">@entrypoint()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">data_processor</span>(<span class="hljs-params">raw_data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    cleaned = clean_data(raw_data).result()
    transformed = transform_data(cleaned).result()
    <span class="hljs-keyword">return</span> transformed

<span class="hljs-comment"># Use the functional API result in the graph</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">orchestrator_node</span>(<span class="hljs-params">state</span>):
    processed_data = data_processor.invoke(state[<span class="hljs-string">"raw_data"</span>])
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"processed_data"</span>: processed_data}
</code></pre>
<h2 data-id="heading-13">å››ã€APIé—´çš„è¿ç§»</h2>
<h3 data-id="heading-14">4.1 ä»å‡½æ•°å¼APIè¿ç§»è‡³å›¾API</h3>
<p>å½“ä½ çš„å‡½æ•°å¼å·¥ä½œæµå˜å¾—å¤æ‚æ—¶ï¼Œå¯æŒ‰ä»¥ä¸‹æ–¹å¼è¿ç§»è‡³å›¾ APIï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Before: Functional API</span>
<span class="hljs-meta">@entrypoint(<span class="hljs-params">checkpointer=checkpointer</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">complex_workflow</span>(<span class="hljs-params">input_data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    step1 = process_step1(input_data).result()

    <span class="hljs-keyword">if</span> step1[<span class="hljs-string">"needs_analysis"</span>]:
        analysis = analyze_data(step1).result()
        <span class="hljs-keyword">if</span> analysis[<span class="hljs-string">"confidence"</span>] &gt; <span class="hljs-number">0.8</span>:
            result = high_confidence_path(analysis).result()
        <span class="hljs-keyword">else</span>:
            result = low_confidence_path(analysis).result()
    <span class="hljs-keyword">else</span>:
        result = simple_path(step1).result()

    <span class="hljs-keyword">return</span> result

<span class="hljs-comment"># After: Graph API</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkflowState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    input_data: <span class="hljs-built_in">dict</span>
    step1_result: <span class="hljs-built_in">dict</span>
    analysis: <span class="hljs-built_in">dict</span>
    final_result: <span class="hljs-built_in">dict</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_analyze</span>(<span class="hljs-params">state</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">"analyze"</span> <span class="hljs-keyword">if</span> state[<span class="hljs-string">"step1_result"</span>][<span class="hljs-string">"needs_analysis"</span>] <span class="hljs-keyword">else</span> <span class="hljs-string">"simple_path"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">confidence_check</span>(<span class="hljs-params">state</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">"high_confidence"</span> <span class="hljs-keyword">if</span> state[<span class="hljs-string">"analysis"</span>][<span class="hljs-string">"confidence"</span>] &gt; <span class="hljs-number">0.8</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"low_confidence"</span>

workflow = StateGraph(WorkflowState)
workflow.add_node(<span class="hljs-string">"step1"</span>, process_step1_node)
workflow.add_conditional_edges(<span class="hljs-string">"step1"</span>, should_analyze)
workflow.add_node(<span class="hljs-string">"analyze"</span>, analyze_data_node)
workflow.add_conditional_edges(<span class="hljs-string">"analyze"</span>, confidence_check)
<span class="hljs-comment"># ... add remaining nodes and edges</span>
</code></pre>
<h3 data-id="heading-15">4.2 ä»å›¾APIè¿ç§»è‡³å‡½æ•°å¼API</h3>
<p>å½“å¯¹äºç®€å•çš„çº¿æ€§æµç¨‹è€Œè¨€ï¼Œä½ çš„å›¾ç»“æ„å˜å¾—è¿‡äºå¤æ‚æ—¶</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Before: Over-engineered Graph API</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    <span class="hljs-built_in">input</span>: <span class="hljs-built_in">str</span>
    step1: <span class="hljs-built_in">str</span>
    step2: <span class="hljs-built_in">str</span>
    result: <span class="hljs-built_in">str</span>

<span class="hljs-comment"># After: Simplified Functional API</span>
<span class="hljs-meta">@entrypoint(<span class="hljs-params">checkpointer=checkpointer</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_workflow</span>(<span class="hljs-params">input_data: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    step1 = process_step1(input_data).result()
    step2 = process_step2(step1).result()
    <span class="hljs-keyword">return</span> finalize_result(step2).result()
</code></pre>
<h2 data-id="heading-16">äº”ã€æ€»ç»“</h2>
<p>å½“ä½ éœ€è¦å¯¹å·¥ä½œæµç»“æ„è¿›è¡Œæ˜¾å¼æ§åˆ¶ã€å¤„ç†å¤æ‚åˆ†æ”¯ã€å®ç°å¹¶è¡Œå¤„ç†ï¼Œæˆ–å¸Œæœ›å€ŸåŠ©å›¢é˜Ÿåä½œä¼˜åŠ¿æ—¶ï¼Œè¯·é€‰æ‹©å›¾APIï¼ˆGraph APIï¼‰ã€‚
å½“ä½ å¸Œæœ›ä»¥æœ€å°‘çš„æ”¹åŠ¨ä¸ºç°æœ‰ä»£ç æ·»åŠ LangGraphåŠŸèƒ½ã€å¤„ç†ç®€å•çš„çº¿æ€§å·¥ä½œæµï¼Œæˆ–éœ€è¦å¿«é€ŸåŸå‹å¼€å‘èƒ½åŠ›æ—¶ï¼Œè¯·é€‰æ‹©å‡½æ•°å¼APIï¼ˆFunctional APIï¼‰ã€‚
ä¸¤ç§ API å‡æä¾›ç›¸åŒçš„LangGraphæ ¸å¿ƒåŠŸèƒ½ï¼ˆåŒ…æ‹¬æŒä¹…åŒ–ã€æµå¼å¤„ç†ã€äººæœºååŒã€å†…å­˜ç®¡ç†ï¼‰ï¼Œä½†é‡‡ç”¨ä¸åŒçš„èŒƒå¼è¿›è¡Œå°è£…ï¼Œä»¥é€‚é…ä¸åŒçš„å¼€å‘é£æ ¼å’Œä½¿ç”¨åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆAIæ“…é•¿HTMLå´æç ¸JSONï¼Ÿæˆ‘ä»¬ç”¨ä¸€ä¸ªâ€œå¤å¤â€æŠ€æœ¯è§£å†³äº†å®ƒ]]></title>    <link>https://juejin.cn/post/7575457788664332340</link>    <guid>https://juejin.cn/post/7575457788664332340</guid>    <pubDate>2025-11-24T03:06:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575457788664332340" data-draft-id="7575563462047170595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆAIæ“…é•¿HTMLå´æç ¸JSONï¼Ÿæˆ‘ä»¬ç”¨ä¸€ä¸ªâ€œå¤å¤â€æŠ€æœ¯è§£å†³äº†å®ƒ"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-24T03:06:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‘¡è„åŸæŠ€æœ¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868332765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆAIæ“…é•¿HTMLå´æç ¸JSONï¼Ÿæˆ‘ä»¬ç”¨ä¸€ä¸ªâ€œå¤å¤â€æŠ€æœ¯è§£å†³äº†å®ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868332765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‘¡è„åŸæŠ€æœ¯å›¢é˜Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:06:46.000Z" title="Mon Nov 24 2025 03:06:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ï¼Œæˆ‘ä»¬å›¢é˜Ÿåœ¨è°ƒæŸ¥å¼€å‘AIè¾…åŠ©åŠŸèƒ½ï¼Œéœ€è¦æ¨¡å‹ç”Ÿæˆå†…éƒ¨é…ç½®ï¼ˆJSONå…ƒæ•°æ®ï¼‰æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªä»¤äººå›°æƒ‘çš„æ‚–è®ºï¼šå¸‚é¢ä¸Šçš„AIæ¨¡å‹å¯ä»¥è½»æ¾ç”Ÿæˆç»“æ„å®Œæ•´ã€æ ·å¼ç¾è§‚çš„HTMLé¡µé¢ï¼Œä½†å½“æˆ‘ä»¬éœ€è¦å®ƒç”Ÿæˆå·¥å…·æ‰€éœ€çš„JSONé…ç½®æ—¶ï¼Œç»“æœå´æƒ¨ä¸å¿ç¹ã€‚è¿™ç›´æ¥å½±å“äº†AIè¾…åŠ©å¼€å‘åŠŸèƒ½çš„å¯é æ€§ã€‚</p>
<h2 data-id="heading-0">é—®é¢˜çš„å‘ç°ï¼šä»â€œå®Œç¾â€åˆ°â€œç ´ç¢â€çš„å¯¹æ¯”</h2>
<p>æˆ‘ä»¬å¯¹AIç”ŸæˆHTMLçš„èƒ½åŠ›å°è±¡æ·±åˆ»ã€‚åªéœ€ç®€å•çš„æç¤ºï¼ŒAIå°±èƒ½ç”Ÿæˆç»“æ„å®Œæ•´ã€å¯ç”¨çš„é¡µé¢ä»£ç ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿ä½¿ç”¨æ´»å­—æ ¼ä½ä»£ç å¼€å‘å¹³å°<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è¿™æ˜¯ä¸€ä¸ªç”±AIç”Ÿæˆçš„ç¤ºä¾‹é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>ä½†å½“ç›®æ ‡è½¬å‘ç”Ÿæˆå†…éƒ¨ä½¿ç”¨çš„JSONé…ç½®æ—¶ï¼Œæƒ…å†µæ€¥è½¬ç›´ä¸‹ï¼š</p>
<pre><code class="hljs language-JSON" lang="JSON">'''json<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"components"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"container"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-comment">/* ... æ›´å¤šå†…å®¹ ... */</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-comment">// è‡´å‘½é”™è¯¯ï¼šç¼ºå°‘é—­åˆçš„æ‹¬å·ã€å¤šä½™çš„é€—å·æˆ–å¼•å·ç¼ºå¤±</span>
</code></pre>
<p>ç±»ä¼¼çš„ç»“æ„é”™è¯¯å±‚å‡ºä¸ç©·ï¼Œ<strong>å¯¼è‡´</strong>JSONè§£æå™¨ç«‹å³æŠ¥é”™ï¼ŒåŠŸèƒ½å½»åº•ä¸­æ–­ã€‚</p>
<h2 data-id="heading-1">æ·±å…¥åˆ†æï¼šä¸ºä»€ä¹ˆAIå¯¹HTMLå’ŒJSONåŒºåˆ«å¯¹å¾…ï¼Ÿ</h2>
<h3 data-id="heading-2">1.å®¹é”™æ€§çš„æ ¹æœ¬å·®å¼‚ï¼šè­¦å¯Ÿä¸ä¿å§†</h3>
<p><strong>HTML</strong>ï¼šå®½å®¹çš„ä¿å§†</p>
<ul>
<li>æµè§ˆå™¨æ˜¯å¤©ç„¶çš„â€œé”™è¯¯ä¿®å¤å™¨â€ã€‚ç¼ºå¤±é—­åˆæ ‡ç­¾ï¼Ÿå±æ€§æœªåŠ å¼•å·ï¼Ÿæµè§ˆå™¨ä¼šå°½åŠ›ä¿®å¤å¹¶æ­£å¸¸æ¸²æŸ“ã€‚</li>
<li><strong>ç»“æœå¯¼å‘ï¼š</strong> åªè¦é¡µé¢çœ‹èµ·æ¥æ­£å¸¸ï¼Œå¾®å°çš„è¯­æ³•é”™è¯¯å¯ä»¥è¢«å¿½ç•¥ã€‚</li>
</ul>
<p><strong>JSON</strong>ï¼šä¸¥æ ¼çš„è­¦å¯Ÿ</p>
<ul>
<li>JSONè§£æå™¨æ˜¯â€œé›¶å®¹å¿çš„è¯­æ³•è­¦å¯Ÿâ€ã€‚</li>
<li>ä¸€ä¸ªå¤šä½™çš„é€—å·ã€ç¼ºå¤±çš„åŒå¼•å·éƒ½ä¼šå¯¼è‡´è§£æå¤±è´¥ã€‚</li>
<li><strong>éé»‘å³ç™½ï¼š</strong> è¦ä¹ˆå®Œå…¨æ­£ç¡®ï¼Œè¦ä¹ˆå½»åº•å¤±è´¥ã€‚</li>
</ul>
<h3 data-id="heading-3">2.AIå·¥ä½œæ–¹å¼çš„å±€é™æ€§ï¼šæ¦‚ç‡è€Œéç²¾ç¡®</h3>
<p>å¤§å‹è¯­è¨€æ¨¡å‹æœ¬è´¨ä¸Šæ˜¯åŸºäºæ¦‚ç‡çš„æ–‡æœ¬ç”Ÿæˆå™¨ï¼Œè€Œä¸æ˜¯ç²¾ç¡®çš„ä»£ç ç¼–è¯‘å™¨ï¼š</p>
<ul>
<li><strong>HTML</strong>ç”Ÿæˆï¼š å³ä½¿ä¸­é—´æœ‰é”™è¯¯ï¼Œæ¨¡å‹å¯ä»¥é ä¸Šä¸‹æ–‡â€œè’™â€å¯¹ä¸‹ä¸€ä¸ªæ ‡ç­¾ï¼Œæœ€ç»ˆç»“æœå¯èƒ½ä»ç„¶å¯ç”¨ã€‚</li>
<li><strong>JSON</strong>ç”Ÿæˆï¼š å¿…é¡»ä»ç¬¬ä¸€ä¸ª<code>{</code>åˆ°æœ€åä¸€ä¸ª<code>}</code>å®Œç¾æ— ç¼ºã€‚AIç”Ÿæˆä¸­çš„å¾®å°é”™è¯¯éƒ½ä¼šåœ¨è§£ææ—¶è¢«æ”¾å¤§ã€‚</li>
</ul>
<h3 data-id="heading-4">3.è®­ç»ƒæ•°æ®çš„åå¥½ä¸ç»“æ„â€œé”šç‚¹â€</h3>
<p>AIåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ¥è§¦äº†å¤§é‡çš„HTMLä»£ç ï¼Œè¿™äº›ä»£ç æ‹¥æœ‰æ¸…æ™°ã€ç¨³å®šçš„ç»“æ„ã€‚æ›´å…³é”®çš„æ˜¯ï¼ŒXMLå’ŒHTMLéƒ½æœ‰<strong>å¼ºåˆ¶æ€§çš„é—­åˆæ ‡ç­¾</strong>ï¼ˆå¦‚<code>&lt;tag&gt;</code>å¿…é¡»å¯¹åº”<code>&lt;/tag&gt;</code>ï¼‰ï¼Œä¸ºAIæä¾›äº†æ˜ç¡®çš„<strong>ç»“æ„â€œ<strong>é”šç‚¹</strong>â€</strong>ï¼Œå¸®åŠ©æ¨¡å‹ç»´æŒå±‚çº§å®Œæ•´æ€§ã€‚JSONç¼ºä¹è¿™ç§è‡ªæ£€æœºåˆ¶ã€‚</p>
<h2 data-id="heading-5">çªç ´æ€§å‘ç°ï¼šè¢«é—å¿˜çš„â€œè€å…µâ€â€”â€”XMLçš„æ„å¤–å¤å…´</h2>
<p>åœ¨å°è¯•äº†å„ç§å¤æ‚çš„JSONæ ¡æ­£æ–¹æ¡ˆåï¼Œæˆ‘ä»¬æƒ³åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼â€œå¤å¤â€çš„è§£å†³æ–¹æ¡ˆï¼šè®©AIç”ŸæˆXMLè€Œä¸æ˜¯JSONã€‚</p>
<p>ç»“æœä»¤äººæƒŠå–œï¼šAIç”Ÿæˆçš„XMLç»“æ„æ­£ç¡®ç‡å¤§å¹…æå‡ï¼</p>
<pre><code class="hljs language-Plain" lang="Plain">&lt;page&gt;
  &lt;container&gt;
    &lt;header&gt;æ¬¢è¿ä½¿ç”¨æ´»å­—æ ¼ä½ä»£ç å¼€å‘å¹³å°&lt;/header&gt;
    &lt;main&gt;è¿™æ˜¯ä¸€ä¸ªç”±AIç”Ÿæˆçš„ç¤ºä¾‹é¡µé¢&lt;/main&gt;
  &lt;/container&gt;&lt;/page&gt;
</code></pre>
<h3 data-id="heading-6">ä¸ºä»€ä¹ˆXMLæ•ˆæœæ›´å¥½ï¼Ÿ</h3>
<ol>
<li><strong>ä¸HTML</strong>çš„é«˜åº¦ç›¸ä¼¼æ€§ï¼š XMLå’ŒHTMLå…±äº«ç›¸åŒçš„æ ‡ç­¾è¯­æ³•ï¼ŒAIå¯¹è¿™ç§æ¨¡å¼çš„æŒæ¡ç¨‹åº¦è¿œè¶…JSONã€‚</li>
<li><strong>æ˜ç¡®çš„â€œ<strong>é”šç‚¹â€æœºåˆ¶ï¼š æ¯ä¸ª<code>&lt;tag&gt;</code>éƒ½æœ‰å¯¹åº”çš„<code>&lt;/tag&gt;</code>ï¼Œä¸ºAIæä¾›äº†æ¸…æ™°ã€ä¸å¯æˆ–ç¼ºçš„</strong>é—­åˆé”šç‚¹</strong>ï¼Œæå¤§åœ°å¸®åŠ©æ¨¡å‹ç»´æŒç»“æ„å®Œæ•´æ€§ã€‚</li>
<li><strong>çº¿æ€§ç”Ÿæˆ</strong>æ›´ç¬¦åˆAIæ€ç»´ï¼š AIå¯ä»¥è‡ªç„¶åœ°æŒ‰é¡ºåºå¤„ç†ï¼šå¼€æ ‡ç­¾ â†’ å†…å®¹ â†’ é—­æ ‡ç­¾ã€‚è¿™æ˜¯ä¸€ç§æ›´â€œè‡ªç„¶â€çš„æ–‡æœ¬ç”Ÿæˆæµç¨‹ã€‚</li>
</ol>
<h2 data-id="heading-7">æˆ‘ä»¬çš„â€œXMLä¸­è½¬ç­–ç•¥â€</h2>
<p>æœ‰æ²¡æœ‰å’ŒHTMLç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥JSONèƒ½åŠ›ç±»ä¼¼çš„æŠ€æœ¯ï¼Ÿç­”æ¡ˆå°±æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹XMLã€‚äºæ˜¯æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„æµç¨‹ï¼Œå°†AIæ“…é•¿ç”Ÿæˆçš„ç»“æ„ï¼ˆXMLï¼‰è½¬åŒ–ä¸ºæˆ‘ä»¬éœ€è¦çš„é…ç½®ç»“æ„ï¼ˆJSONï¼‰ã€‚</p>
<h3 data-id="heading-8">ç¬¬ä¸€æ­¥ï¼šè®©AIç”ŸæˆXML</h3>
<p>æˆ‘ä»¬è¦æ±‚AIæ ¹æ®ç”¨æˆ·éœ€æ±‚ç”Ÿæˆç›®æ ‡é…ç½®çš„XMLè¡¨ç¤º</p>
<h3 data-id="heading-9">ç¬¬äºŒæ­¥ï¼šå†…éƒ¨è½»é‡çº§è½¬æ¢</h3>
<p>æˆ‘ä»¬è®©äº§å“æ”¯æŒå¯¼å…¥XMLï¼Œç„¶ååœ¨äº§å“å†…éƒ¨å°†è‡ªå·±çš„æ ‡å‡†åŠŸèƒ½å¯¼å‡ºä¸ºç›®æ ‡JSONæ ¼å¼ã€‚æˆ‘ä»¬ä¸ä¾èµ–AIæ¥å¤„ç†JSONçš„ä¸¥æ ¼è¯­æ³•ï¼Œè€Œæ˜¯ä¾èµ–å†…éƒ¨å·¥å…·æ¥è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚</p>
<h3 data-id="heading-10">ç¬¬ä¸‰æ­¥ï¼šéªŒè¯å’Œä¼˜åŒ–</h3>
<ul>
<li>XMLè§£æå™¨æœ¬èº«èƒ½å¿«é€Ÿè‡ªåŠ¨æ£€æµ‹ç»“æ„é”™è¯¯ï¼Œå¸®åŠ©å®šä½é—®é¢˜ã€‚</li>
<li>åœ¨è½¬æ¢è¿‡ç¨‹ä¸­è¿›è¡Œä¸¥æ ¼çš„æ•°æ®éªŒè¯ã€‚</li>
</ul>
<h2 data-id="heading-11">æ€§èƒ½ä¸æ•ˆæœï¼šæ•°æ®ä¸ä¼šè¯´è°</h2>
<p>åœ¨æˆ‘ä»¬è¿›è¡Œçš„æµ‹è¯•ä¸­ï¼ŒXMLä¸­è½¬ç­–ç•¥å¸¦æ¥äº†è´¨çš„é£è·ƒï¼š</p>

























<table><thead><tr><th>æŒ‡æ ‡</th><th>ç›´æ¥ç”ŸæˆJSON</th><th>é€šè¿‡XMLä¸­è½¬</th></tr></thead><tbody><tr><td>ç»“æ„æ­£ç¡®ç‡</td><td>65-75%</td><td>92-98%</td></tr><tr><td>é”™è¯¯å®šä½éš¾åº¦</td><td>å›°éš¾</td><td>å®¹æ˜“</td></tr><tr><td>å¯é æ€§</td><td>ä½</td><td>æé«˜</td></tr></tbody></table>
<h2 data-id="heading-12">ç»“è®ºä¸å¯ç¤º</h2>
<p>é€šè¿‡å¼•å…¥XMLä½œä¸ºAIç”Ÿæˆçš„ä¸­é—´æ ¼å¼ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†JSONç”Ÿæˆä¸å¯é çš„é¡½ç–¾ã€‚</p>
<p>è¿™ä¸ªæ¡ˆä¾‹å‘Šè¯‰æˆ‘ä»¬ï¼š<strong>æŠ€æœ¯é€‰å‹ä¸åº”ç›²ç›®è¿½æ±‚æ–°æ½®ï¼Œè€Œåº”é€‰æ‹©æœ€é€‚åˆAIâ€œå¿ƒæ™ºæ¨¡å‹â€çš„å·¥å…·ã€‚</strong> XMLè™½ç„¶åœ¨ç°ä»£ç¼–ç¨‹ä¸­ä¸å†æ—¶é«¦ï¼Œä½†åœ¨â€œä¸AIåä½œç”Ÿæˆç»“æ„åŒ–æ•°æ®â€è¿™ä¸€ç‰¹å®šåœºæ™¯ä¸‹ï¼Œå®ƒå±•ç°äº†æ¯”JSONæ›´é«˜çš„å¯é æ€§ã€‚</p>
<p>å®è·µè¯æ˜ï¼š<strong>åœ¨AIç”Ÿæˆå†…éƒ¨é…ç½®çš„åœºæ™¯ä¸­ï¼ŒXMLç¡®å®æ¯”</strong>JSON<strong>æ›´åŠ å¯é ã€‚</strong> è¿™ä¸€â€œå¤å¤â€çš„è§£å†³æ–¹æ¡ˆä¸ºæ‰€æœ‰é¢ä¸´AIç»“æ„åŒ–æ•°æ®ç”ŸæˆæŒ‘æˆ˜çš„å¼€å‘è€…æä¾›äº†æ–°çš„æ€è·¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»å–æ°´åˆ°å­¦ä¼š Android ASM æ’æ¡©]]></title>    <link>https://juejin.cn/post/7575751471841853476</link>    <guid>https://juejin.cn/post/7575751471841853476</guid>    <pubDate>2025-11-24T03:05:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575751471841853476" data-draft-id="7573890735579103242" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»å–æ°´åˆ°å­¦ä¼š Android ASM æ’æ¡©"/> <meta itemprop="keywords" content="Android,Android Studio,Kotlin"/> <meta itemprop="datePublished" content="2025-11-24T03:05:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="bqliang"/> <meta itemprop="url" content="https://juejin.cn/user/941602739853453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»å–æ°´åˆ°å­¦ä¼š Android ASM æ’æ¡©
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/941602739853453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    bqliang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:05:39.000Z" title="Mon Nov 24 2025 03:05:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»34åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>é¦–å…ˆï¼Œè€æ‰‹è¯·ç»•é“ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c7b00566ac04c648712d727552d918a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=KKsvMK8If%2F3oY9y0H6MhVzL9MUY%3D" alt="header" loading="lazy"/></p>
<p>å¾ˆä¹…å‰ç‚¹å¼€äº†ä¸€ç¯‡ ASM çš„æ–‡ç« ï¼Œå¾ˆé•¿ï¼Œä¸å°‘é™Œç”Ÿçš„æœ¯è¯­ï¼Œå¯¹å½¼æ—¶çš„æˆ‘æ¥è¯´æœ‰ç‚¹å¤æ‚ï¼Œå¤§æ¦‚ç¿»äº†ç¿»åï¼šå™¢ï¼Œä¸€ä¸ªå¯ä»¥ä¿®æ”¹å­—èŠ‚ç çš„ä¸œè¥¿ã€‚å‰å®³ï¼ä½†åæ­£æˆ‘ç”¨ä¸ä¸Šï¼Œä¾¿å…³æ‰äº†é¡µé¢ï¼Œå¾€åæˆ‘å¯¹ ASM çš„è®¤è¯†ä¸€ç›´åœç•™äºæ­¤ã€‚</p>
<p>åæ¥ï¼Œå·¥ä½œå­¦ä¹ ä¸­å¸¸å¬åˆ°</p>
<ul>
<li>Transform æ¥å£åºŸå¼ƒï¼ˆå°¤å…¶æ˜¯ AGP å‡çº§ 7.0 é‚£ä¼šï¼‰</li>
<li>æ— ç—•åŸ‹ç‚¹</li>
<li>æ’æ¡©</li>
</ul>
<p>ä¸€ç›´å¬è¯´è¿™äº›è¯ï¼Œä½†å´ä¸æ˜æ‰€ä»¥ã€‚å¥½å§ï¼Œæ˜¯æ—¶å€™å­¦ä¹ ä¸€ä¸‹äº†ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯"æ’æ¡©"ä¸ "AOP"ï¼Ÿ</h2>
<p>å½“æˆ‘å¤§æ¦‚çŸ¥é“ ASM æ˜¯ä¸€ä¸ªä¿®æ”¹å­—èŠ‚ç çš„å·¥å…·åï¼Œæœ€è®©æˆ‘å¥½å¥‡çš„ä¸æ˜¯æ€ä¹ˆå»ä½¿ç”¨å®ƒï¼Œåå€’æ˜¯å¤§é‡å‡ºç°åœ¨ç›¸å…³æ–‡ç« é‡Œçš„ä¸¤ä¸ªè¯â€”â€”â€œæ’æ¡©â€ã€â€œAOP åˆ‡é¢ç¼–ç¨‹â€ã€‚</p>
<p>æˆ‘ä¸€ç›´éƒ½æœ‰ä¸ªç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¿®æ”¹å­—èŠ‚ç å«ä½œâ€œæ’æ¡©â€è€Œä¸æ˜¯â€œæ’ç â€ï¼ŸAOP åˆ‡é¢ç¼–ç¨‹åˆæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<h3 data-id="heading-1">æ’æ¡© Instrumentation</h3>
<p>"æ’æ¡©" å¯¹åº”çš„è‹±æ–‡æ˜¯ "Instrumentation"ï¼Œè¿™ä¸ªè¯æ˜¯ Instrument çš„å˜ä½“/è¡ç”Ÿè¯ã€‚</p>
<p>"Instrument" æ˜¯â€œä»ªå™¨â€ã€â€œä»ªè¡¨â€çš„æ„æ€ï¼ˆæ¯”å¦‚é£æœºé©¾é©¶èˆ±é‡Œçš„å„ç§ä»ªè¡¨ç›˜ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09455fda9310403daeb1b2083dd52249~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=T0i2ssOaUr2Lqn4lXFUzJSQmDdQ%3D" alt="instrumentation.png" loading="lazy"/></p>
<p>è‡³äº "Instrumentation"ï¼Œå…¶æœ¬æ„æ˜¯â€œ<strong>ç»™â€¦â€¦è£…ä¸Šä»ªå™¨</strong>â€è¿™ä¸ªåŠ¨ä½œã€‚æ¯”å¦‚ç»™å·¥å‚çš„ç®¡é“è£…ä¸Šå‹åŠ›è®¡å’Œæ¸©åº¦è®¡ï¼Œä»¥ä¾¿äºç›‘æ§å®ƒçš„è¿è¡ŒçŠ¶æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš "Instrumentation"ã€‚</p>
<p>è¿™ä¸ªè¯è¢«è½¯ä»¶è¡Œä¸šå€Ÿç”¨è¿‡æ¥ï¼Œæ„æ€æ˜¯ï¼šç»™â€œç¨‹åºâ€è£…ä¸Šâ€œç›‘æ§ä»ªå™¨â€ï¼ˆä¹Ÿå°±æ˜¯é¢å¤–çš„ä»£ç ï¼‰ï¼Œä»¥ä¾¿ç›‘æ§å®ƒçš„è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>é‚£â€œæ’æ¡©â€åˆè¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p>
<ul>
<li>â€œæ’â€ï¼šæ’å…¥ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¿®æ”¹å­—èŠ‚ç å°±æ˜¯æŠŠä»£ç â€œæ’â€è¿›å…¥ï¼›</li>
<li>â€œæ¡©â€ï¼šæ¡©å­ï¼Œæœ¨æ¡©ï¼Œå…¶å®å°±æ˜¯ä¸Šé¢â€œä»ªå™¨â€çš„éšå–»ï¼Œåœ¨ç¼–ç¨‹é‡ŒæŒ‡çš„æ˜¯æˆ‘ä»¬æ’å…¥çš„ä»£ç ã€‚</li>
</ul>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ç°åœ¨æ˜¯ä¸€ä¸ªåœŸæœ¨å·¥ç¨‹å¸ˆï¼Œè¦æµ‹é‡ä¸€æ¡æ²³æµçš„å‡ ä¸ªå…³é”®ç‚¹çš„æ°´ä½å˜åŒ–ï¼Œæˆ–è€…è¦æ ‡è®°ä¸€å—åœ°çš„é‡è¦åæ ‡ã€‚ä½ ä¼šåœ¨è¿™äº›å…³é”®ç‚¹â€œæ’å…¥ä¸€ä¸ªä¸ªâ€œæ¡©å­â€ï¼ˆæµ‹é‡æ¡© / æ ‡è®°æ¡©ï¼‰ã€‚</p>
<p>åœ¨è½¯ä»¶å·¥ç¨‹é‡Œï¼Œæˆ‘ä»¬çš„â€œæ²³æµâ€å°±æ˜¯ç¨‹åºçš„æ‰§è¡Œæµã€‚æˆ‘ä»¬æƒ³è¦ç›‘æ§çš„â€œå…³é”®ç‚¹â€ä¸€èˆ¬æ˜¯ï¼š</p>
<ul>
<li>æ–¹æ³•å‡º/å…¥å£</li>
<li>ä¸€ä¸ªå¾ªç¯çš„å†…éƒ¨</li>
<li>å¼‚å¸¸è¢«æŠ›å‡ºçš„åœ°æ–¹</li>
</ul>
<p>æˆ‘ä»¬æ’å…¥çš„ä»£ç ï¼Œå°±åƒä¸€ä¸ªä¸ªâ€œæ¡©å­â€ï¼Œè¢«å®‰æ’åœ¨è¿™äº›å…³é”®ç‚¹ä¸Šï¼Œèµ·åˆ°â€œæµ‹é‡â€æˆ–â€œæ ‡è®°â€çš„ä½œç”¨ï¼ˆæ¯”å¦‚ï¼šè®°å½•æ–¹æ³•è€—æ—¶ã€æ‰“å°æ—¥å¿—ã€ä¸ŠæŠ¥åˆ†ææ•°æ®ï¼‰ã€‚</p>
<hr/>
<p>é‚£å¦‚æœæˆ‘ç–¯äº†ï¼Œæˆ‘éè¦ç”¨ä¹¦å†™å­—èŠ‚ç çš„æ–¹å¼æ¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæ‰‹æœºå·ï¼Œè¿™ä¸ªè¿‡ç¨‹ç®—ä¸ç®—â€œæ’æ¡©â€ï¼Ÿä»å¹¿ä¹‰ä¸Šè¯´ï¼Œç®—ã€‚ä½† "æ’æ¡©" è¿™ä¸ªè¯ï¼Œå®ƒä¾§é‡å¼ºè°ƒçš„æ˜¯æ’å…¥ä»£ç çš„â€œç›®çš„â€ã€‚"æ’æ¡©" æ’å…¥çš„ä»£ç ï¼ˆé‚£ä¸ªâ€œæ¡©â€ï¼‰ï¼Œå…¶ç›®çš„ä¸æ˜¯ä¸ºäº†å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ˜¯ä¸ºäº†ï¼š</p>
<ul>
<li>ç›‘æ§ (Monitoring): æ¯”å¦‚ APM é‡Œçš„æ€§èƒ½ç›‘æ§ï¼›</li>
<li>è°ƒè¯• (Debugging): æ¯”å¦‚æ‰“å°æ—¥å¿—ï¼›</li>
<li>åˆ†æ (Analytics): æ¯”å¦‚åŸ‹ç‚¹ä¸ŠæŠ¥ï¼›</li>
<li>æ§åˆ¶ (Control): æ¯”å¦‚åœ¨æ–¹æ³•æ‰§è¡Œå‰è¿›è¡Œæƒé™æ£€æŸ¥ï¼ˆAOP çš„ä¸€ç§ä½“ç°ï¼‰ï¼›</li>
</ul>
<p>æ‰€ä»¥ï¼Œ"æ’æ¡©" ç‰¹æŒ‡é‚£äº›ä¸ºäº†â€œç›‘æ§å’Œæµ‹é‡â€è€Œæ’å…¥çš„éä¸šåŠ¡ä»£ç ã€‚</p>
<h3 data-id="heading-2">AOP åˆ‡é¢ç¼–ç¨‹</h3>
<p>AOP å³â€œé¢å‘åˆ‡é¢ç¼–ç¨‹â€ï¼Œå®ƒæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œå°±åƒ OOP é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€æ ·ã€‚</p>
<p>æˆ‘ä»¬å…ˆä¸çº ç»“äºâ€œåˆ‡é¢â€è¿™ä¸ªè¯ï¼Œå®ƒå¬èµ·æ¥å’Œâ€œæ’æ¡©â€ä¸€æ ·æŠ½è±¡ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å¾ˆå¸¸è§çš„â€œç—›ç‚¹â€ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œé¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œå°è£…ã€ç»§æ‰¿ã€å¤šæ€â€ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†æ•°æ®ï¼ˆå±æ€§ï¼‰å’Œæ“ä½œè¿™äº›æ•°æ®çš„é€»è¾‘ï¼ˆæ–¹æ³•ï¼‰â€œå°è£…â€åˆ°ä¸€ä¸ªâ€œç±»â€ï¼ˆClassï¼‰é‡Œã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸‹é¢å®šä¹‰ä¸€ä¸ª <code>Person</code> ç±»ï¼Œå®ƒå°è£…äº† <code>name</code> å±æ€§å’Œ <code>eat()</code> æ–¹æ³•ã€‚ç„¶åå†å®šä¹‰ä¸€ä¸ª <code>Student</code> ç±»ï¼Œå®ƒç»§æ‰¿è‡ª <code>Person</code> ç±»ï¼Œå¹¶å°è£…äº† <code>study()</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-keyword">val</span> name: String) {
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"<span class="hljs-variable">$name</span> æ­£åœ¨åƒé¥­..."</span>)
    Thread.sleep(<span class="hljs-number">100</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿåƒé¥­è€—æ—¶</span>
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(name: String, <span class="hljs-keyword">val</span> studentId: String) : Person(name) {
  <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">study</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"<span class="hljs-variable">$name</span> æ­£åœ¨å­¦ä¹ ..."</span>)
    Thread.sleep(<span class="hljs-number">200</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿå­¦ä¹ è€—æ—¶</span>
  }
}
</code></pre>
<p><code>Person</code> å’Œ <code>Student</code> ä¹‹é—´å½¢æˆäº†ä¸€æ¡æ¸…æ™°çš„å‚ç›´ç»§æ‰¿é“¾ã€‚<code>Student</code> æ˜¯ä¸€ä¸ª <code>Person</code>ï¼Œå®ƒåœ¨ <code>Person</code> çš„åŸºç¡€ä¸Šâ€œå‚ç›´â€åœ°æ„å»ºäº†æ›´å…·ä½“çš„åŠŸèƒ½ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒOOP å¸®æˆ‘ä»¬æŠŠç³»ç»Ÿæ‹†åˆ†æˆäº†å¾ˆå¤šä¸ªâ€œå‚ç›´â€çš„æ¨¡å—ï¼ˆ<code>User</code> æ¨¡å—ã€<code>Order</code> æ¨¡å—...ï¼‰ã€‚æ¯ä¸ªæ¨¡å—å„å¸å…¶èŒï¼Œç®¡ç†å¥½è‡ªå·±çš„æ•°æ®å’Œä¸šåŠ¡é€»è¾‘å³å¯ã€‚</p>
<p>è¿™åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ OK çš„ï¼Œä½†æ€»æœ‰ä¸€äº›â€œä¸åˆç¾¤â€çš„é€»è¾‘ï¼Œå®ƒä»¬å¾ˆéš¾è¢«å½’ç±»åˆ°æŸä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡æ¨¡å—é‡Œã€‚å‡è®¾äº§å“ç»ç†è¦æ±‚æˆ‘ä»¬ä¸ºè¿™ä¸¤ä¸ªï¼ˆå°†æ¥å¯èƒ½è¿˜æœ‰å‡ ç™¾ä¸ªï¼‰æ–¹æ³•æ·»åŠ è€—æ—¶ç›‘æ§ã€‚</p>
<p>ä¸å€ŸåŠ© AOP æˆ‘ä»¬å¾ˆå¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">open class Person(val name: String) {
  fun eat() {
<span class="hljs-addition">+   val startTime = System.currentTimeMillis()</span>
    println("$name æ­£åœ¨åƒé¥­...")
    Thread.sleep(100) // æ¨¡æ‹Ÿåƒé¥­è€—æ—¶
<span class="hljs-addition">+   val duration = System.currentTimeMillis() - startTime</span>
<span class="hljs-addition">+   Log.d("PERF", "eat() è€—æ—¶: ${duration}ms")</span>
  }
}

class Student(name: String, val studentId: String) : Person(name) {
  fun study() {
<span class="hljs-addition">+   val startTime = System.currentTimeMillis()</span>
    println("$name æ­£åœ¨å­¦ä¹ ...")
    Thread.sleep(200) // æ¨¡æ‹Ÿå­¦ä¹ è€—æ—¶
<span class="hljs-addition">+   val duration = System.currentTimeMillis() - startTime</span>
<span class="hljs-addition">+   Log.d("PERF", "study() è€—æ—¶: ${duration}ms")</span>
  }
}
</code></pre>
<p>â€œè€—æ—¶ç›‘æ§â€è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒå¹¶ä¸å±äº <code>Person</code> / <code>Student</code> çš„æ ¸å¿ƒä¸šåŠ¡ï¼Œä½†å®ƒå´åƒç‰›çš®ç™£ä¸€æ ·ï¼Œä¾µå…¥å¹¶æ•£è½åœ¨äº†å„ä¸ªä¸šåŠ¡æ¨¡å—ä¸­ã€‚è¿™å¯¼è‡´äº†ï¼š</p>
<ol>
<li>ä»£ç é‡å¤ï¼šæ¯ä¸ªæ–¹æ³•é‡Œéƒ½æœ‰ä¸€å¥—å‡ ä¹ä¸€æ ·çš„æ¨¡æ¿ä»£ç ã€‚</li>
<li>ç»´æŠ¤å›°éš¾ï¼šå¦‚æœç°åœ¨æƒ³æŠŠæ—¥å¿—ä» <code>Log.d</code> æ”¹æˆä¸ŠæŠ¥åˆ°æœåŠ¡å™¨ï¼Œå¾—å»ä¿®æ”¹æ‰€æœ‰åœ°æ–¹ã€‚</li>
<li>é€»è¾‘æ±¡æŸ“ï¼š<code>eat</code> æ–¹æ³•çš„æ ¸å¿ƒèŒè´£æœ¬åº”åªæ˜¯â€œåƒâ€ï¼Œç°åœ¨å´è¢«è¿«â€œå…³å¿ƒâ€è‡ªå·±æ˜¯å¦‚ä½•è¢«ç›‘æ§çš„ã€‚</li>
</ol>
<p>å¦‚æœæŠŠé¢å‘å¯¹è±¡ OOP æƒ³è±¡æˆç›–å¤§æ¥¼ï¼Œ<code>Person</code> æ˜¯ 1 æ¥¼ï¼Œ<code>Student</code> æ˜¯ 2 æ¥¼...ï¼ˆåŒä¸€ç‰‡åœŸåœ°ä¸Šè¿˜æœ‰å„ç§å…¶ä»–å¤§æ¥¼ï¼‰ å®ƒä»¬éƒ½æ˜¯â€œå‚ç›´â€çš„åŠŸèƒ½å•å…ƒã€‚é‚£ä¹ˆâ€œæ€§èƒ½ç›‘æ§â€ã€â€œæ—¥å¿—æ‰“å°â€ã€â€œæƒé™æ ¡éªŒâ€è¿™äº›åŠŸèƒ½ï¼Œå°±åƒæ˜¯å¤§æ¥¼çš„â€œæ°´ç”µâ€æˆ–â€œæ¶ˆé˜²â€ç³»ç»Ÿã€‚å®ƒä»¬éœ€è¦â€œæ¨ªè·¨â€æ‰€æœ‰æ¥¼å±‚ï¼Œè´¯ç©¿åˆ°æ¯ä¸€ä¸ªæˆ¿é—´ã€‚è¿™ç§â€œæ¨ªè·¨â€å¤šä¸ªâ€œå‚ç›´â€æ¨¡å—çš„é€šç”¨åŠŸèƒ½ï¼Œå°±è¢«ç§°ä¸º â€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€ï¼ˆCross-Cutting Concernsï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/808756289efc462ba3c1b700db79acf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=hjUOrjDGi8l2r5eu8XJK10pwr8M%3D" alt="AOP_2.png" loading="lazy"/></p>
<p>è€Œ AOP çš„æ ¸å¿ƒæ€æƒ³ï¼Œå°±æ˜¯æŠŠè¿™äº›â€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€ä»ä¸šåŠ¡é€»è¾‘ä¸­â€œæŠ½ç¦»â€å‡ºå»ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚</p>
<p>AOP å…è®¸æˆ‘ä»¬å°†è¿™äº›â€œæ¨ªåˆ‡é€»è¾‘â€å®šä¹‰åœ¨ä¸€ä¸ªç‹¬ç«‹çš„åœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹å°±å«â€œåˆ‡é¢â€ï¼ˆAspectï¼‰ï¼Œå®ƒå°±åƒæ˜¯æ•´æ ‹å¤§æ¥¼çš„â€œé›†ä¸­å¼é…ç”µç®±â€æˆ–â€œæ—¥å¿—ä¸­å¿ƒâ€ã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦å†å®šä¹‰ä¸€ä¸ªâ€œè§„åˆ™â€ï¼ˆæ¯”å¦‚â€œæ‰€æœ‰ä»¥ <code>load</code> å¼€å¤´çš„æ–¹æ³•â€æˆ–â€œæ‰€æœ‰è¢« <code>@LogTime</code> æ³¨è§£çš„æ–¹æ³•â€ï¼‰ï¼ŒAOP æ¡†æ¶å°±ä¼šè‡ªåŠ¨æŠŠè¿™ä¸ªâ€œåˆ‡é¢â€é‡Œçš„é€»è¾‘â€œç»‡å…¥â€åˆ°ç¬¦åˆè§„åˆ™çš„é‚£äº›â€œå…³é”®ç‚¹â€ï¼ˆæ¯”å¦‚æ–¹æ³•æ‰§è¡Œå‰ / åï¼‰ã€‚</p>
<hr/>
<p>å¦‚æœä½ å†™è¿‡ Pythonï¼Œé‡Œé¢çš„è£…é¥°å™¨ï¼ˆDecoratorï¼‰å°±æ˜¯ AOP æ€æƒ³çš„ä¸€ä¸ªç›´è§‚ä½“ç°ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬è¦å®ç°â€œæ‰“å°æ–¹æ³•è€—æ—¶â€è¿™ä¸ªåˆ‡é¢é€»è¾‘ï¼Œç”¨Python è£…é¥°å™¨æ¥å®ç°å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªâ€œè£…é¥°å™¨â€ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•° (log_time)</span>
<span class="hljs-comment"># å®ƒæ¥æ”¶å¦ä¸€ä¸ªå‡½æ•° (func) ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„â€œåŒ…è£…åâ€çš„å‡½æ•° (wrapper)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">log_time</span>(<span class="hljs-params">func</span>):  <span class="hljs-comment"># å‚æ•° func ä¸ºè¢«è£…é¥°çš„å‡½æ•°  </span>
  <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):      
    start = time.perf_counter()  <span class="hljs-comment"># è®°å½•å¼€å§‹æ—¶é—´</span>
    
    result = func(*args, **kwargs)  <span class="hljs-comment"># è°ƒç”¨è¢«è£…é¥°çš„å‡½æ•°, å³åŸå§‹çš„ä¸šåŠ¡é€»è¾‘å‡½æ•°</span>
    
    end = time.perf_counter()  <span class="hljs-comment"># è®°å½•ç»“æŸæ—¶é—´</span>
    cost = (end - start) * <span class="hljs-number">1000</span>  <span class="hljs-comment"># è®¡ç®—è€—æ—¶ï¼Œå•ä½æ¯«ç§’</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f'execute <span class="hljs-subst">{func.__name__}</span> took <span class="hljs-subst">{cost:<span class="hljs-number">.4</span>f}</span> ms'</span>) <span class="hljs-comment"># æ‰“å°è€—æ—¶</span>
    <span class="hljs-keyword">return</span> result  <span class="hljs-comment"># è¿”å›ç»“æœ</span>
  
  <span class="hljs-keyword">return</span> wrapper  <span class="hljs-comment"># è¿”å›åŒ…è£…å‡½æ•°</span>
  
  
<span class="hljs-meta">@log_time </span><span class="hljs-comment"># è¯­æ³•ç³–ï¼Œè¿™ç­‰ä»·äº: add = log_time(add), åˆ‡é¢é€»è¾‘åœ¨è¿™é‡Œè¢«"ç»‡å…¥"</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
  <span class="hljs-keyword">return</span> a + b
  
  
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:  
  <span class="hljs-built_in">print</span>(add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)) <span class="hljs-comment"># è°ƒç”¨æ—¶ï¼Œæ‰§è¡Œçš„å·²ç»æ˜¯è¢« "wrapper" åŒ…è£…è¿‡çš„å‡½æ•°äº†</span>

<span class="hljs-comment"># è¾“å‡ºï¼š</span>
<span class="hljs-comment"># execute add took 0.0008 ms</span>
<span class="hljs-comment"># 3</span>
</code></pre>
<p>é€šè¿‡è£…é¥°å™¨ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡æ–¹æ³• <code>add()</code> å†…éƒ¨ä¿ç•™äº†çº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘ã€‚å®ƒå¯¹è‡ªå·±è¢«â€œç›‘æ§â€è¿™ä»¶äº‹å®Œå…¨æ— æ„ŸçŸ¥ï¼Œæ˜¯ AOP æ¡†æ¶ï¼ˆè¿™é‡ŒæŒ‡ Python çš„è£…é¥°å™¨è¯­æ³•ï¼‰åœ¨å¤–éƒ¨å¸®æˆ‘ä»¬å®Œæˆäº†â€œç»‡å…¥â€å·¥ä½œã€‚</p>
<hr/>
<h3 data-id="heading-3">AOP ä¸â€œæ’æ¡©â€çš„å…³ç³»</h3>
<ul>
<li>
<p><strong>AOP (é¢å‘åˆ‡é¢)ï¼š</strong> ä¸€ç§<strong>ç¼–ç¨‹æ€æƒ³</strong>ï¼Œç›®çš„æ˜¯è§£è€¦â€œæ ¸å¿ƒä¸šåŠ¡â€å’Œâ€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€ã€‚</p>
</li>
<li>
<p><strong>æ’æ¡© (Instrumentation)ï¼š</strong> å®ç° AOP æ€æƒ³çš„ä¸€ç§ä¸»è¦<strong>æŠ€æœ¯æ‰‹æ®µ</strong>ï¼ˆå³åœ¨ç‰¹å®šç‚¹æ’å…¥æ¢é’ˆä»£ç ï¼‰ã€‚</p>
</li>
<li>
<p><strong>ASMï¼š</strong> ä¸€ä¸ªï¼ˆåœ¨ Java/Kotlin é¢†åŸŸï¼‰ç”¨æ¥æ‰§è¡Œâ€œæ’æ¡©â€çš„<strong>å…·ä½“å·¥å…·</strong>ï¼Œèƒ½ç›´æ¥æ“ä½œå­—èŠ‚ç ã€‚</p>
</li>
</ul>
<p>åœ¨ Java/Kotlin é¢†åŸŸï¼Œæˆ‘ä»¬æ²¡æœ‰ Python è£…é¥°å™¨é‚£ä¹ˆçµæ´»çš„è¯­æ³•ã€‚ä¸ºäº†åœ¨ä¸ä¿®æ”¹ä¸šåŠ¡ä»£ç çš„å‰æä¸‹ï¼Œå®ç° AOP åˆ‡é¢ç¼–ç¨‹ï¼ŒæŠŠâ€œåˆ‡é¢â€é€»è¾‘ï¼ˆæ¯”å¦‚æƒé™æ£€æŸ¥ã€è€—æ—¶ç»Ÿè®¡ï¼‰â€œç»‡å…¥â€åˆ°ä¸šåŠ¡æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æœ€å¥½çš„åŠæ³•å°±æ˜¯åœ¨ç¼–è¯‘æœŸå»ä¿®æ”¹ <code>.class</code> æ–‡ä»¶çš„å­—èŠ‚ç ã€‚è€Œ ASM å°±æ˜¯ä¸€ä¸ªèƒ½æ–¹ä¾¿ä¿®æ”¹å­—èŠ‚ç çš„å·¥å…·ï¼Œå®ƒèƒ½æ‰¾åˆ°ç›®æ ‡æ–¹æ³•ï¼ˆæ¯”å¦‚ <code>loadUserData</code>ï¼‰ï¼Œåœ¨å®ƒçš„å­—èŠ‚ç å¼€å¤´å’Œç»“å°¾ï¼Œâ€œæ’å…¥â€ç”¨äºè®¡æ—¶çš„â€œæ¡©â€ï¼ˆä¹Ÿå°±æ˜¯é‚£äº› <code>startTime</code> å’Œ <code>Log.d</code> å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ï¼‰ã€‚</p>
<h2 data-id="heading-4">ä»€ä¹ˆæ˜¯ ASM</h2>
<p>ASM æ˜¯ä¸€ä¸ªé€šç”¨çš„ Java å­—èŠ‚ç æ“ä½œå’Œåˆ†ææ¡†æ¶ã€‚å®ƒå…è®¸ä½ åŠ¨æ€åœ°è¯»å–ã€ä¿®æ”¹å’Œç”Ÿæˆ Java å­—èŠ‚ç ï¼ˆ<code>.class</code> æ–‡ä»¶ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/832580e3cded40ffa714ba673aadae1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=tBab8ZmEVQL7%2BFuzxMYgaVZgL6c%3D" alt="ASM_can_do.png" loading="lazy"/></p>
<h2 data-id="heading-5">å‰ç½®çŸ¥è¯†</h2>
<p>åŸºç¡€ä¸ç‰¢ï¼Œåœ°åŠ¨å±±æ‘‡ã€‚</p>
<p>æ—¢ç„¶ ASM æ˜¯ç”¨æ¥ä¿®æ”¹å­—èŠ‚ç ï¼ˆ<code>.class</code> æ–‡ä»¶ï¼‰çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šå¾—å…ˆäº†è§£ <code>.class</code> æ–‡ä»¶æ˜¯åœ¨å“ªä¸ªé˜¶æ®µç”Ÿæˆçš„ï¼Œä»¥åŠå­—èŠ‚ç çš„æ ¼å¼ã€‚</p>
<p>å¦‚æœä¸çŸ¥é“ <code>.class</code> æ–‡ä»¶ä½•æ—¶ç”Ÿæˆï¼Œæˆ‘ä»¬å°±ä¸çŸ¥é“å»å“ªé‡Œâ€œæ‹¦æˆªâ€å®ƒï¼›å¦‚æœä¸çŸ¥é“å­—èŠ‚ç æ ¼å¼ï¼Œé‚£ä¹ˆå³ä½¿æ–‡ä»¶æ‘†åœ¨é¢å‰ï¼Œæˆ‘ä»¬ä¹Ÿæ— ä»ä¸‹æ‰‹ä¿®æ”¹ã€‚</p>
<h3 data-id="heading-6">Java ç¼–è¯‘è¿‡ç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/756095ef5bd14631998ee92233d3e341~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=hJUdIa4BiMy%2FuTVAzXrxiwbqQuU%3D" alt="How Compilation Works in Java.png" loading="lazy"/></p>
<p>æˆ‘ä»¬å†™çš„ java ä»£ç æ˜¯æ”¾åœ¨ <code>.java</code> æ–‡ä»¶é‡Œï¼Œè¿™äº›æ–‡ä»¶ä¼šç»è¿‡ Javac è¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆBytecodeï¼‰ä¹Ÿå°±æ˜¯ <code>.class</code> æ–‡ä»¶ï¼Œæ‰§è¡Œæ—¶ <code>.class</code> æ–‡ä»¶ç»ç”± JVM è™šæ‹Ÿæœºè¢«ç¿»è¯‘æˆæœºå™¨ç ã€‚</p>
<h3 data-id="heading-7">Android æ‰“åŒ…æµç¨‹</h3>
<p>å†æ¥çœ‹çœ‹ apk çš„æ‰“åŒ…æµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c171b01eec35454089953e030e659b12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=%2FlfmkyuLG4ZpqlQZaxDna9tAtrg%3D" alt="Android æ‰“åŒ…æµç¨‹.png" loading="lazy"/></p>
<ol>
<li>
<p>aapt2 ç¼–è¯‘èµ„æºç”Ÿæˆ <code>R.java</code> å’Œ resources.arscï¼›</p>
</li>
<li>
<p>kotlinc/javac ç¼–è¯‘æºç  <code>.kt</code>/<code>.java</code> ç”Ÿæˆ <code>.class</code> æ–‡ä»¶ï¼›</p>
</li>
<li>
<p>R8 (æˆ– d8) å¯¹ <code>.class</code> æ–‡ä»¶è¿›è¡Œæ··æ·†ã€ä¼˜åŒ–ï¼Œå¹¶è½¬æ¢ä¸º <code>.dex</code> æ–‡ä»¶ï¼›</p>
</li>
<li>
<p>apkbuilder å°† .dexã€.arscã€AndroidManifest.xml ç­‰æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªæœªç­¾åçš„ <code>.apk</code> (ZIP åŒ…)ï¼›</p>
</li>
<li>
<p>jarsigner ä½¿ç”¨ç§é’¥å¯¹ APK è¿›è¡Œç­¾åï¼Œç”Ÿæˆå¯å®‰è£…çš„ APK æ–‡ä»¶ï¼›</p>
</li>
<li>
<p>zipalign å¯¹ APK åŒ…è¿›è¡Œå†…å­˜å¯¹é½ä¼˜åŒ–ï¼›</p>
</li>
</ol>
<blockquote>
<p>æˆ‘åœ¨ç½‘ä¸Šæœä¸Šé¢çš„æµç¨‹å›¾ï¼Œæ‰¾åˆ°æœ€æ—©çš„ä¸€å¼ æ˜¯ 11 å¹´å‰ï¼Œå½¼æ—¶ 2014 å¹´è¿˜æ˜¯ Android 4.4w å’Œ Android 5.0 Lollipop çš„æ—¶ä»£ï¼Œè€Œæˆ‘è¿˜åœ¨è¯»åˆä¸­ã€‚</p>
<p>æ—¶è¿‡å¢ƒè¿ï¼ŒAndroid çš„æ‰“åŒ…æµç¨‹ä¹Ÿåœ¨å˜åŒ–ï¼Œdex ç¼–è¯‘å™¨ä» dx åˆ° d8 å†åˆ° r8ã€‚å…¶æ¬¡ï¼Œåœ¨ Android 7.0+ åï¼Œå¿…é¡»æ”¹ç”¨ V2+ ç­¾åï¼Œæ‰“åŒ…æ—¶å¿…é¡»å…ˆ Zipalign å¯¹é½å† Apksigner ç­¾åï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æœ€åä¸¤ä¸ªæ­¥éª¤äº’ç›¸è°ƒæ¢ã€‚</p>
</blockquote>
<p>è¯æ‰¯è¿œäº†ï¼Œæœ¬æ–‡ä¸»è¦æ˜¯è®¨è®º ASM ä¿®æ”¹å­—èŠ‚ç ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ï¼Œåœ¨ apk æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œjavac / kotlinc ç¼–è¯‘å™¨å·¥ä½œåã€DEX ç¼–è¯‘å™¨å·¥ä½œå‰ï¼Œå°±æ˜¯æˆ‘ä»¬ä¿®æ”¹å­—èŠ‚ç è¿›è¡Œæ’æ¡©çš„æ—¶æœºã€‚</p>
<h3 data-id="heading-8">åˆè¯†å­—èŠ‚ç </h3>
<p>ä¸ºäº†è®¤è¯†å­—èŠ‚ç ï¼Œæˆ‘ä»¬é¦–å…ˆå†™ä¸€ä¸ªç®€å•çš„ <code>add()</code> å‡½æ•°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Utils.kt</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(a: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span> {
  <span class="hljs-keyword">return</span> a + b
}
</code></pre>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ IDE é‡Œç›´æ¥é€šè¿‡ Tools -&gt; Kotlin -&gt; Show Kotlin Bytecode æ¥æ–¹ä¾¿åœ°æŸ¥çœ‹æ–‡ä»¶å¯¹åº”çš„å­—èŠ‚ç ï¼Œä¸è¿‡ä¸ºäº†èƒ½è®©å¤§å®¶å¯¹æ•´ä¸ªè¿‡ç¨‹æœ‰æ›´å¥½çš„è®¤è¯†ï¼Œæ‰€ä»¥ä¸‹é¢ä¼šä¸€æ­¥ä¸€æ­¥æ‰‹æ•²å‘½ä»¤ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆç”¨ kotlinc å°†å…¶ç¼–è¯‘ä¸º <code>.class</code> æ–‡ä»¶ï¼Œå› ä¸º Kotlinc æ˜¯ä¸ IDE æ†ç»‘çš„ï¼Œåœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œè·¯å¾„æ˜¯ï¼š
<code>C:\Program Files\Android\Android Studio\plugins\Kotlin\kotlinc\bin\kotlinc</code></p>
<p>æˆ‘ä»¬å…ˆåˆ‡æ¢ï¼ˆ<code>cd</code>ï¼‰åˆ° Kotlin ç¼–è¯‘å™¨çš„ bin ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> <span class="hljs-string">'C:\Program Files\Android\Android Studio\plugins\Kotlin\kotlinc\bin'</span>
</code></pre>
<p>ç„¶åä½¿ç”¨ <code>kotlinc xxx.kt</code> å‘½ä»¤ç¼–è¯‘ <code>.kt</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">.\kotlinc Utils.kt -d KotlinBytecode
</code></pre>
<blockquote>
<p>è¿™é‡Œå»ºè®®åŠ ä¸Š -d æŒ‡å®šè¾“å‡ºç›®å½•</p>
</blockquote>
<pre><code class="hljs language-scss" lang="scss">â”‚
â””â”€KotlinBytecode
    â”œâ”€com
    â”‚  â””â”€example
    â”‚      â””â”€helloworld (å¯¹åº”çš„åŒ…è·¯å¾„)
    â”‚              UtilsKt<span class="hljs-selector-class">.class</span>
    â”‚
    â””â”€META-INF (åŒ…å«æ¨¡å—ä¿¡æ¯)
            <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.kotlin_module</span>
</code></pre>
<p>å› ä¸º <code>add()</code> å‡½æ•°ç›´æ¥å†™åœ¨ <code>Utils.kt</code> æ–‡ä»¶é‡Œï¼ŒKotlin é»˜è®¤ä¼šåœ¨æ–‡ä»¶ååé¢åŠ ä¸Š <code>Kt</code> æ¥ç”Ÿæˆç±»ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„å°±æ˜¯ <code>UtilsKt.class</code> æ–‡ä»¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7063563750046cc912ff7effb47a508~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=fOX49V7XDKOOzkAOE5%2FB50nfLJQ%3D" alt="hex.png" loading="lazy"/></p>
<blockquote>
<p><code>.class</code> æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯éµå¾ªã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹ç‰¹å®šæ ¼å¼ç¼–ç çš„æœºå™¨æŒ‡ä»¤ï¼ˆç§°ä¸ºå­—èŠ‚ç ï¼ŒBytecodeï¼‰å’Œå…¶ä»–å…ƒæ•°æ®ã€‚éœ€è¦ä½¿ç”¨ä¸“é—¨çš„å·¥å…·ï¼ˆå¦‚åå…­è¿›åˆ¶ç¼–è¾‘å™¨æˆ–Â <code>javap</code>Â åæ±‡ç¼–å™¨ï¼‰æ‰èƒ½æŸ¥çœ‹å…¶å†…å®¹ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f387b7b5cd04423983cc65189d40f52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=t9r1jWp21L979DBgrylNS5YK3Oc%3D" alt="class file overview.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de3b519fee8e45218207b0723e7167f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=BaoUHePqB4OZo4Qir5SuK0p2Xl0%3D" alt="ClassFile ç»“æ„.png" loading="lazy"/>
æ¯”å¦‚ï¼Œ<code>.class</code>Â æ–‡ä»¶æ ¼å¼è§„èŒƒè§„å®šï¼Œæ¯ä¸ªÂ <code>.class</code>Â æ–‡ä»¶çš„å¼€å¤´éƒ½å¿…é¡»æ˜¯è¢«ç§°ä¸ºÂ â€œé­”æ•°â€ï¼ˆMagic Numberï¼‰çš„å›ºå®šå››ä¸ªå­—èŠ‚ã€‚è¿™ä¸ªé­”æ•°æ˜¯Â <code>0xCAFEBABE</code>ï¼ˆ16 è¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚</p>
</blockquote>
<p>å³ä½¿ç”¨ 16 è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€Â <code>.class</code>Â æ–‡ä»¶ï¼Œä¹Ÿéå¸¸éš¾ä»¥é˜…è¯»å’Œç†è§£ï¼Œæƒ³è¦ä»¥æ›´ç›´è§‚çš„æ–¹å¼é˜…è¯» <code>.class</code> æ–‡ä»¶ï¼Œå¯ä»¥åˆ©ç”¨ JDK è‡ªå¸¦ <code>javap</code>ï¼ˆJava Class File Disassemblerï¼‰å·¥å…·ï¼Œå®ƒç”¨äºåæ±‡ç¼– <code>.class</code> æ–‡ä»¶ï¼Œæ˜¯æŸ¥çœ‹å­—èŠ‚ç çš„æ ‡å‡†å·¥å…·ã€‚</p>
<p>æˆ‘ä»¬å…ˆ cd åˆ° <code>.class</code> æ–‡ä»¶çš„æ‰€åœ¨ç›®å½•ï¼Œç„¶åä½¿ç”¨ <code>javap</code> å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">javap -c .\UtilsKt.class
</code></pre>
<p><code>-c</code>ï¼ˆdisassemble codeï¼‰å‚æ•°è¡¨ç¤ºæŸ¥çœ‹å­—èŠ‚ç æŒ‡ä»¤</p>
<p>æ‰§è¡Œå‘½ä»¤ä¼šæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">Compiled from <span class="hljs-string">"Utils.kt"</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">com</span>.example.helloworld.UtilsKt {
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span>;
    Code:
       <span class="hljs-number">0</span>: iload_0
       <span class="hljs-number">1</span>: iload_1
       <span class="hljs-number">2</span>: iadd
       <span class="hljs-number">3</span>: ireturn
}
</code></pre>
<p>è¦ç†è§£ä¸Šé¢çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—ç†è§£æ ˆå¸§ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ ˆï¼Œæ¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå°±ä¼šå¾€è¿™ä¸ªæ ˆæ”¾å…¥ä¸€ä¸ªæ ˆå¸§ï¼ˆæ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºçš„ç»“æ„ï¼Œæ‰€ä»¥è°ƒç”¨æœ€æ·±æ–¹æ³•çš„æ ˆå¸§å¤„åœ¨æ ˆé¡¶ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/143fbac509754494abe210e5ffcd56ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=JX76hEpMkWmxgOkgHvoXeInCzBs%3D" alt="æ ˆå¸§.png" loading="lazy"/></p>
<p>æ¯ä¸ªæ ˆå¸§éƒ½å­˜å‚¨ç€ï¼š</p>
<ul>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼›</li>
<li><strong>æ“ä½œæ•°æ ˆ</strong>ï¼›</li>
<li>åŠ¨æ€é“¾æ¥ï¼›</li>
<li>æ–¹æ³•è¿”å›åœ°å€ï¼›</li>
</ul>
<p>æˆ‘ä»¬å†æŠŠ <code>javap</code> çš„è¾“å‡ºè´´ä¸€éï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">com</span>.example.helloworld.UtilsKt {
  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-type">int</span>, <span class="hljs-type">int</span>)</span></span>;
    Code:
       <span class="hljs-number">0</span>: iload_0
       <span class="hljs-number">1</span>: iload_1
       <span class="hljs-number">2</span>: iadd
       <span class="hljs-number">3</span>: ireturn
}
</code></pre>
<p>å±€éƒ¨å˜é‡è¡¨åƒä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼Œå¯¹äºæˆ‘ä»¬çš„ <code>add()</code> æ–¹æ³•ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸ºï¼š<code>[ 0: a, 1: b ]</code> (ç´¢å¼• 0 å­˜çš„æ˜¯å‚æ•° <code>a</code>ï¼Œç´¢å¼• 1 å­˜çš„æ˜¯å‚æ•° <code>b</code>)</p>
<blockquote>
<p>å¦‚æœæ˜¯éé™æ€æ–¹æ³•ï¼Œå±€éƒ¨å˜é‡è¡¨çš„ç´¢å¼• 0 ä½ç½®æ˜¯ class å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯ <code>this</code>ã€‚</p>
</blockquote>
<p>æ“ä½œæ•°æ ˆ (Operand Stack) æ˜¯ä¸€ä¸ªåè¿›å…ˆå‡º (LIFO) çš„æ ˆï¼Œç”¨äºæ‰§è¡Œè®¡ç®—ã€‚å­—èŠ‚ç æŒ‡ä»¤ï¼ˆæ¯”å¦‚ iaddï¼‰ä¼šä»è¿™ä¸ªæ ˆä¸­å¼¹å‡º (pop) æ•°æ®ï¼Œè®¡ç®—åï¼Œå†æŠŠç»“æœå‹å…¥ (push) æ ˆé¡¶ã€‚åˆå§‹æ—¶æ“ä½œæ•°æ ˆä¸ºç©ºï¼š<code>[ ]</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å½“ä¸€æ¬¡ JVMï¼Œä¸€æ­¥ä¸€æ­¥æ‰§è¡Œ <code>add(int, int)</code> æ–¹æ³•çš„å­—èŠ‚ç ï¼š</p>
<ol>
<li>
<p><code>iload_0</code></p>
<ul>
<li>å«ä¹‰: i ä»£è¡¨ integer (æ•´æ•°)ï¼Œload ä»£è¡¨åŠ è½½ã€‚0 æ˜¯ä¸€ä¸ªç®€å†™ï¼Œä»£è¡¨ç´¢å¼• 0ã€‚</li>
<li>åŠ¨ä½œ: ä»å±€éƒ¨å˜é‡è¡¨çš„ç´¢å¼• 0 å¤„åŠ è½½ä¸€ä¸ªæ•´æ•°ï¼ˆä¹Ÿå°±æ˜¯å‚æ•° aï¼‰ï¼Œå¹¶å°†å…¶å‹å…¥æ“ä½œæ•°æ ˆã€‚</li>
<li>æ ˆå¸§çŠ¶æ€ï¼š
<ul>
<li>å±€éƒ¨å˜é‡è¡¨: <code>[ a, b ]</code></li>
<li>æ“ä½œæ•°æ ˆ: <code>[ a ]</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>iload_1</code>ï¼šä¸ä¸Šä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<ul>
<li>æ ˆå¸§çŠ¶æ€ï¼š
<ul>
<li>å±€éƒ¨å˜é‡è¡¨: <code>[ a, b ]</code></li>
<li>æ“ä½œæ•°æ ˆ: <code>[ a, b ]</code> (b åœ¨æ ˆé¡¶)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>iadd</code></p>
<ul>
<li>å«ä¹‰ï¼š<code>i</code> (integer) + <code>add</code> (ç›¸åŠ )</li>
<li>åŠ¨ä½œ: ä»æ“ä½œæ•°æ ˆé¡¶éƒ¨å¼¹å‡ºä¸¤ä¸ªæ•´æ•°ï¼ˆå…ˆå¼¹å‡º <code>b</code>ï¼Œå†å¼¹å‡º <code>a</code>ï¼‰ï¼Œå°†å®ƒä»¬ç›¸åŠ ï¼Œç„¶åæŠŠç»“æœï¼ˆå‡è®¾ä¸º <code>c</code>ï¼‰ å‹å›æ“ä½œæ•°æ ˆã€‚</li>
<li>æ ˆå¸§çŠ¶æ€ï¼š
<ul>
<li>å±€éƒ¨å˜é‡è¡¨ï¼š<code>[ a, b ]</code></li>
<li>æ“ä½œæ•°æ ˆï¼š<code>[ c ]</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>ireturn</code></p>
<ul>
<li>å«ä¹‰ï¼š<code>i</code> (integer) + <code>return</code> (è¿”å›)</li>
<li>åŠ¨ä½œï¼šä»æ“ä½œæ•°æ ˆé¡¶éƒ¨å¼¹å‡ºä¸€ä¸ªæ•´æ•°ï¼ˆä¹Ÿå°±æ˜¯ a + b çš„ç»“æœï¼‰ï¼Œå¹¶å°†å…¶ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ã€‚åŒæ—¶ï¼Œå½“å‰æ ˆå¸§è¢«é”€æ¯ã€‚</li>
<li>æ ˆå¸§çŠ¶æ€ï¼šè¢«é”€æ¯</li>
</ul>
</li>
</ol>
<p>ä»¥ä¸Šå°±æ˜¯å­—èŠ‚ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå°±å¥½åƒä¸€å¥—åŸºäºæ ˆçš„åº•å±‚æ±‡ç¼–è¯­è¨€ã€‚<code>iload</code>ã€<code>iadd</code>ã€<code>ireturn</code> è¿™äº›è¢«ç§°ä¸ºâ€œåŠ©è®°ç¬¦â€ï¼Œå®ƒä»¬æ¯ä¸€ä¸ªéƒ½å¯¹åº”ä¸€ä¸ª 16 è¿›åˆ¶çš„â€œæ“ä½œç â€ï¼ˆæ¯”å¦‚ <code>iload_0</code> å¯¹åº” <code>0x1a</code>ï¼‰ã€‚<code>.class</code> æ–‡ä»¶é‡Œå­˜çš„å°±æ˜¯è¿™äº›äºŒè¿›åˆ¶çš„æ“ä½œç ï¼Œè€Œ <code>javap</code> å¸®æˆ‘ä»¬åç¼–è¯‘æˆäº†æ›´æ˜“è¯»çš„åŠ©è®°ç¬¦ã€‚</p>
<hr/>
<p>å¥½äº†ï¼Œæˆªè‡³ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“äº†ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆæ’æ¡©ï¼šä¸ºäº†å®ç° AOPï¼Œåˆ†ç¦»â€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€ï¼›</li>
<li>æ’æ¡©æ—¶æœºï¼šåœ¨ <code>.class</code> æ–‡ä»¶ç”Ÿæˆåï¼Œ<code>.dex</code> æ–‡ä»¶ç”Ÿæˆå‰ï¼›</li>
<li>æ’æ¡©åŸç†ï¼šä¿®æ”¹ <code>.class</code> æ–‡ä»¶çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li>
</ul>
<p>ä¸‹ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šæ€ä¹ˆæ”¹ï¼Ÿ</p>
<p>æˆ‘ä»¬æ€»ä¸èƒ½ç”¨ 16 è¿›åˆ¶ç¼–è¾‘å™¨å»æ‰‹åŠ¨ä¿®æ”¹ <code>.class</code> æ–‡ä»¶å§ï¼Ÿï¼ˆè¾ƒçœŸèµ·æ¥å¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†çœŸæ²¡è¿™ä¸ªå¿…è¦ï¼‰æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´é«˜çº§ã€æ›´æŠ½è±¡çš„å·¥å…·æ¥å¸®æˆ‘ä»¬è§£æå’Œä¿®æ”¹å­—èŠ‚ç ã€‚</p>
<p>å¸‚é¢ä¸Šä¸»æµçš„å­—èŠ‚ç æ“ä½œåº“æœ‰ï¼š</p>
<ul>
<li><strong>Javassist</strong>: æä¾›äº†æ›´é«˜çº§åˆ«çš„ APIã€‚æ”¯æŒç”¨ç±»ä¼¼ Java æºç çš„å­—ç¬¦ä¸²ï¼ˆå¦‚ <code>System.out.println("hello");</code>ï¼‰æ¥æ’å…¥ä»£ç ï¼Œå®ƒä¼šå¸®ä½ ç¼–è¯‘æˆå­—èŠ‚ç ã€‚ä¸Šæ‰‹ç®€å•ï¼Œä½†çµæ´»æ€§å’Œæ€§èƒ½ç¨å·®ã€‚</li>
<li><strong>ASM</strong>: æä¾›äº†æ›´åº•å±‚çš„ APIã€‚å®ƒä¸è®¤è¯† Java æºç ï¼Œå®ƒåªè®¤è¯† <code>iload</code>ã€<code>iadd</code> è¿™æ ·çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚éœ€æ‰‹åŠ¨å»â€œæ‹¼â€å‡ºè¿™äº›æŒ‡ä»¤ã€‚æ›´éš¾ï¼Œä½†æ€§èƒ½é«˜ã€çµæ´»æ€§å¼ºã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4048c88ec1e4cfb95b9ff17a09955f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=uydyAivXcAGyUHvuQ9nB2%2FjrDBw%3D" alt="ASM_and_Javassist.png" loading="lazy"/></p>
<p>åœ¨ Android é¢†åŸŸï¼ŒASM å‡ ä¹æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚å› ä¸ºåœ¨ Android æ‰“åŒ…è¿‡ç¨‹ä¸­ä¼šéå†æˆç™¾ä¸Šåƒä¸ª <code>.class</code> æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹æ€§èƒ½çš„è¦æ±‚æ˜¯æè‡´çš„ã€‚ASM å‡ ä¹å°±æ˜¯å­—èŠ‚ç çš„â€œæ¬è¿å·¥â€ï¼Œéå¸¸çš„è½»é‡ï¼Œæ²¡æœ‰å¤šä½™çš„æŠ½è±¡å’Œè½¬æ¢ã€‚</p>
<h2 data-id="heading-9">ASM æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<p>é‚£ä¹ˆï¼Œç›¸æ¯”äºæ‰‹åŠ¨ç¼–è¾‘ 16 è¿›åˆ¶æ–‡ä»¶ï¼ŒASM æ˜¯å¦‚ä½•è®©æˆ‘ä»¬ä¼˜é›…åœ°ä¿®æ”¹ <code>.class</code> æ–‡ä»¶çš„å‘¢ï¼Ÿ</p>
<p>ASM æä¾›äº†ä¸¤å¥— API æ¥æ“ä½œå­—èŠ‚ç ï¼Œå®ƒä»¬å„æœ‰ä¼˜åŠ£ï¼š</p>
<ol>
<li>
<p><strong>Tree API</strong>ï¼šé¢å‘å¯¹è±¡çš„æ–¹å¼ï¼Œå…ˆæŠŠæ•´ä¸ª <code>.class</code> æ–‡ä»¶çš„å†…å®¹è¯»å…¥å†…å­˜ï¼Œæ„å»ºæˆä¸€ä¸ªâ€œæ ‘â€çŠ¶ç»“æ„ï¼Œæˆ‘ä»¬é€šè¿‡æ“ä½œè¿™æ£µâ€œæ ‘â€çš„èŠ‚ç‚¹æ¥ä¿®æ”¹å­—èŠ‚ç ã€‚</p>
</li>
<li>
<p><strong>Core API</strong>ï¼šåŸºäºäº‹ä»¶æµçš„æ–¹å¼ï¼Œåƒ SAX è§£æ XML ä¸€æ ·ï¼Œé€è¡Œæ‰«æ <code>.class</code> æ–‡ä»¶ï¼Œåœ¨æ‰«æåˆ°ç‰¹å®šç»“æ„ï¼ˆå¦‚â€œæ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•â€ã€â€œæ‰¾åˆ°ä¸€æ¡æŒ‡ä»¤â€ï¼‰æ—¶è§¦å‘å›è°ƒï¼Œæˆ‘ä»¬åœ¨å›è°ƒé‡Œè¿›è¡Œä¿®æ”¹ã€‚</p>
</li>
</ol>
<h3 data-id="heading-10">Tree API</h3>
<p>æˆ‘ä»¬å…ˆä»æ›´å®¹æ˜“ç†è§£çš„ Tree API è®²èµ·ã€‚</p>
<p>ç›¸ä¿¡åœ¨åº§çš„æ¯ä¸ª Android å¼€å‘è€…éƒ½ç”¨è¿‡ Gson è§£æ <code>.json</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"UtilsKt"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"superName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"java/lang/Object"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"methods"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"add"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"desc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"(II)I"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä½¿ç”¨ Gson æ—¶ï¼Œå®ƒä¼šæŠŠæ•´ä¸ª JSON å­—ç¬¦ä¸²è¯»å…¥å†…å­˜ï¼Œè½¬æ¢æˆä¸€ä¸ª <code>JsonObject</code> æˆ–å¯¹åº”çš„æ•°æ®ç±»ã€‚éšåæˆ‘ä»¬å°±å¯ä»¥åƒæ“ä½œä¸€ä¸ªæ™®é€šçš„ Kotlin/Java å¯¹è±¡ä¸€æ ·ï¼Œéšæ„åœ°è¯»å–ã€ä¿®æ”¹ã€æ·»åŠ æˆ–åˆ é™¤å®ƒçš„ä»»ä½•å±æ€§ï¼Œæ¯”å¦‚ <code>jsonObject.remove("superName")</code>ã€‚</p>
<p>ASM çš„ Tree API ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„æ€è·¯ã€‚ç”±äº<code>.class</code> æ–‡ä»¶æ˜¯ä¸€ä¸ªéµå¾ªä¸¥æ ¼è§„èŒƒçš„äºŒè¿›åˆ¶ç»“æ„ã€‚Tree API ä¼šæŠŠæ•´ä¸ª <code>.class</code> æ–‡ä»¶çš„å­—èŠ‚æµå®Œæ•´åœ°è¯»å…¥å†…å­˜ï¼Œç„¶åæ„å»ºå‡ºä¸€ä¸ªå®Œæ•´çš„â€œå¯¹è±¡æ ‘â€æ¥è¡¨ç¤ºè¿™ä¸ªç±»ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬ä¸Šé¢é‚£ä¸ª <code>UtilsKt.class</code> å—ï¼Ÿå¦‚æœç”¨ Tree API æŠŠå®ƒåŠ è½½åˆ°å†…å­˜é‡Œï¼Œç»“æ„å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">ClassNode (ç±»: UtilsKt)
 |
 +<span class="hljs-comment">-- name: "UtilsKt" (ç”±æ–‡ä»¶å Utils.kt è‡ªåŠ¨ç”Ÿæˆ)</span>
 |
 +<span class="hljs-comment">-- superName: "java/lang/Object"</span>
 |
 +<span class="hljs-comment">-- access: public final (å…¬å…±ä¸”ä¸å¯ç»§æ‰¿)</span>
 |
 +<span class="hljs-comment">-- fields (å­—æ®µåˆ—è¡¨): (æ— )</span>
 |
 +<span class="hljs-comment">-- methods (æ–¹æ³•åˆ—è¡¨):</span>
 Â  Â  |
 Â  Â  +<span class="hljs-comment">-- MethodNode (æ–¹æ³•: &lt;init&gt;)</span>
 Â  Â  | Â  |
Â  Â   | Â  +<span class="hljs-comment">-- access: private (ç§æœ‰æ„é€ å‡½æ•°ï¼Œé˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–)</span>
Â  Â Â  |
Â  Â Â  +<span class="hljs-comment">-- MethodNode (æ–¹æ³•: add)</span>
Â  Â Â  Â  Â  |
Â  Â Â  Â  Â  +<span class="hljs-comment">-- access: public static final (å…¬å…±ã€é™æ€ã€æœ€ç»ˆ)</span>
Â  Â   Â  Â  Â  Â  |
Â  Â   Â  Â  Â  Â  +<span class="hljs-comment">-- descriptor: "(II)I" (æè¿°ç¬¦ï¼šæ¥æ”¶ä¸¤ä¸ªIntï¼Œè¿”å›ä¸€ä¸ªInt)</span>
Â  Â   Â  Â  Â  Â  |
Â  Â   Â  Â  Â  Â  +<span class="hljs-comment">-- instructions (æŒ‡ä»¤åˆ—è¡¨):</span>
Â  Â   Â  Â  Â  Â  Â  Â  |
Â  Â   Â  Â  Â  Â  Â  Â  +<span class="hljs-comment">-- InsnNode (æŒ‡ä»¤: [ILOAD_0]) (åŠ è½½ç¬¬ 0 ä¸ªå‚æ•° 'a' åˆ°æ ˆé¡¶)</span>
Â  Â   Â  Â  Â  Â  Â  Â  +<span class="hljs-comment">-- InsnNode (æŒ‡ä»¤: [ILOAD_1]) (åŠ è½½ç¬¬ 1 ä¸ªå‚æ•° 'b' åˆ°æ ˆé¡¶)</span>
Â  Â   Â  Â  Â  Â  Â  Â  +<span class="hljs-comment">-- InsnNode (æŒ‡ä»¤: [IADD]) Â  Â (å°†æ ˆé¡¶ä¸¤ä¸ª Int ç›¸åŠ ï¼Œç»“æœæ”¾å›æ ˆé¡¶)</span>
Â  Â   Â  Â  Â  Â  Â  Â  +<span class="hljs-comment">-- InsnNode (æŒ‡ä»¤: [IRETURN]) (è¿”å›æ ˆé¡¶çš„ Int ç»“æœ)</span>
</code></pre>
<p>ç°åœ¨è¦å¯¹ <code>add()</code> æ–¹æ³•æ’å…¥è€—æ—¶ç»Ÿè®¡çš„åˆ‡é¢é€»è¾‘ï¼Œæˆ‘ä»¬è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯å»ä¿®æ”¹å¯¹åº”çš„ MethodNode é‡Œçš„ instructions åˆ—è¡¨ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p>
<ol>
<li>åœ¨ <code>methodNode.instructions</code> çš„æœ€å‰é¢ï¼ˆinsertï¼‰æ’å…¥â€œè·å–å¼€å§‹æ—¶é—´å¹¶å­˜å…¥å±€éƒ¨å˜é‡â€çš„æŒ‡ä»¤ã€‚</li>
<li>éå† <code>methodNode.instructions</code>ï¼Œæ‰¾åˆ°æ‰€æœ‰â€œè¿”å›â€æŒ‡ä»¤ï¼ˆæ¯”å¦‚ <code>IRETURN</code>ï¼‰ï¼Œåœ¨è¿™äº›æŒ‡ä»¤ä¹‹å‰ï¼ˆinsertBeforeï¼‰æ’å…¥â€œè®¡ç®—è€—æ—¶å¹¶æ‰“å°æ—¥å¿—â€çš„æŒ‡ä»¤ã€‚</li>
</ol>
<blockquote>
<p>åœ¨è¿™é‡Œå…ˆç»™å„ä½æ–°æ‰‹æ‰“ä¸ªé¢„é˜²é’ˆï¼Œâ€œæ’å…¥å­—èŠ‚ç â€è¯´èµ·æ¥å®¹æ˜“ï¼Œå†™èµ·æ¥åšèµ·æ¥éš¾ã€‚æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å»â€œæ‹¼â€å‡ºä»£ç å¯¹åº”çš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤ã€‚
ä»¥ <code>val start = System.currentTimeMillis()</code> ä¸ºä¾‹ï¼Œå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li><code>INVOKESTATIC java/lang/System.currentTimeMillis ()J</code>ï¼šè°ƒç”¨é™æ€æ–¹æ³•ï¼Œå¹¶å°† <code>long</code> ç±»å‹çš„è¿”å›å€¼å‹å…¥æ“ä½œæ•°æ ˆï¼›</li>
<li><code>LSTORE_2</code>ï¼šå°†æ ˆé¡¶çš„ <code>long</code> å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ç¬¬ 2 ä¸ªæ§½ä½ï¼ˆç¬¬ 0ã€1 ä¸ªåˆ†åˆ«æ˜¯ <code>a</code> å’Œ <code>b</code>ï¼‰ã€‚</li>
</ol>
<p>è€Œ <code>Log.d(...)</code> è¿™è¡Œä»£ç åˆ™æ›´ä¸ºå¤æ‚ï¼Œæ¶‰åŠ String çš„æ‹¼æ¥ï¼Œå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤æœ‰åå‡ æ¡ï¼ˆæ¯”å¦‚ <code>NEW</code>ã€<code>DUP</code>ã€<code>LDC</code>ã€<code>INVOKEVIRTUAL</code>...ï¼‰é™¤äº†è¦ç¡®ä¿è¿™äº›æŒ‡ä»¤å‡†ç¡®æ— è¯¯ï¼Œè¿˜å¾—æ‰‹åŠ¨ç®¡ç†å¥½å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ï¼Œå› ä¸ºæ²¡æœ‰ä¿®æ”¹å‰ï¼Œè¿™ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨åªæœ‰ 2 ä¸ªæ§½ä½ï¼Œæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦æ˜¯ 2ï¼Œä½†æ˜¯æ’å…¥äº†æ–°çš„å­—èŠ‚ç åå°±ä¸ä¸€æ ·äº†ï¼Œå¦‚æœä¸ä¿®æ­£å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„æœ€å¤§æ·±åº¦ï¼ŒJVM åœ¨æ ¡éªŒ <code>.class</code> æ–‡ä»¶æ—¶å°±ä¼šç›´æ¥å´©æºƒã€‚</p>
</blockquote>
<blockquote>
<p>å‰é¢æˆ‘ä»¬å­¦ä¼šäº†ç”¨ <code>javap -c xxx.classs</code> å‘½ä»¤æ¥æŸ¥çœ‹ class æ–‡ä»¶ä¸­çš„ Java å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒä¼šæ˜¾ç¤ºç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ä»¥åŠæ¯ä¸ªæ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤åˆ—è¡¨ã€‚å¦‚æœæˆ‘ä»¬æƒ³æŸ¥çœ‹ <code>.class</code> æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ <code>-v</code> å‚æ•°ï¼ˆverboseï¼‰ï¼Œå®ƒä¼šè¾“å‡ºæ˜¾ç¤ºï¼šç±»å…ƒæ•°æ®ã€å¸¸é‡æ± ã€æ–¹æ³•å…ƒæ•°æ®ï¼ˆå¦‚å †æ ˆå¤§å°ã€å±€éƒ¨å˜é‡è¡¨å¤§å°ã€å‚æ•°æ•°é‡ï¼‰ç­‰ç­‰æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a1d6e505564411f91907c647ee59cc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=NtegTfj7VXVaY8kEAynyPw8uabM%3D" alt="javap-v.png" loading="lazy"/></p>
<p>è¿™å¥— Tree API çš„ä¼˜ç‚¹æ˜¯ç›´è§‚ï¼Œç¬¦åˆé¢å‘å¯¹è±¡çš„æ€ç»´ã€‚å¢åˆ æ”¹æŸ¥å°±åƒæ“ä½œ <code>List</code> ä¸€æ ·ç®€å•ï¼Œé€‚åˆéœ€è¦è¿›è¡Œå¤æ‚ã€å…¨å±€æ€§ä¿®æ”¹çš„åœºæ™¯ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šå†…å­˜é»‘æ´ï¼Œéœ€è¦æŠŠ <code>.class</code> æ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯éƒ½åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯ä¸ä¼šé‡‡ç”¨è¿™è¿™å¥— API çš„ï¼Œåœ¨ Android çš„ç¼–è¯‘æµç¨‹ä¸­ï¼ŒAGP éœ€è¦éå†æˆç™¾ä¸Šåƒä¸ª <code>.class</code> æ–‡ä»¶ã€‚å¦‚æœæ¯å¤„ç†ä¸€ä¸ªæ–‡ä»¶éƒ½è¦å…ˆæŠŠå®ƒä»¬å…¨éƒ¨è¯»å…¥å†…å­˜ï¼Œæ„å»ºæˆä¸€ä¸ªå·¨å¤§çš„ ClassNode å¯¹è±¡æ ‘ï¼Œç„¶åå†åºåˆ—åŒ–å›ç£ç›˜ï¼Œå†…å­˜å ç”¨å’Œ I/O å¼€é”€å°†ä¸å®¹ä¹è§‚ï¼Œå¯¹æœ¬å°±æ¼«é•¿çš„ç¼–è¯‘è¿‡ç¨‹æ— ç–‘æ˜¯é›ªä¸ŠåŠ éœœã€‚</p>
<h3 data-id="heading-11">Core API</h3>
<p>å¦‚æœè¯´ Tree API æ˜¯æŠŠæ•´æœ¬ä¹¦èƒŒä¸‹æ¥å†ä¿®æ”¹ï¼Œé‚£ä¹ˆ Core API å°±æ˜¯è¾¹è¯»è¾¹æ”¹ã€‚</p>
<p>Core API åŸºäº Visitor Patternï¼ˆè®¿é—®è€…æ¨¡å¼ï¼‰ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„æ¨¡å‹ï¼ˆå°±åƒ XML è§£æä¸­çš„ SAXï¼‰ã€‚å®ƒä¸éœ€è¦æŠŠæ•´ä¸ªç±»åŠ è½½åˆ°å†…å­˜é‡Œï¼Œè€Œæ˜¯é€šè¿‡â€œæµâ€çš„å½¢å¼ï¼Œéå† .class æ–‡ä»¶ï¼Œæ¯é‡åˆ°ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆç±»å¤´ã€å­—æ®µã€æ–¹æ³•ã€æ³¨è§£ï¼‰ï¼Œå°±è§¦å‘ä¸€ä¸ªäº‹ä»¶å›è°ƒã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ClassReader] --&gt;|è§£æå­—èŠ‚ç | B(ClassVisitor æˆ‘ä»¬å†™çš„æ’æ¡©é€»è¾‘)
    B --&gt;|ä¿®æ”¹/é€ä¼ äº‹ä»¶| C[ClassWriter]
    C --&gt;|ç”Ÿæˆå­—èŠ‚ç | D[æ–°çš„.classæ–‡ä»¶]
</code></pre>
<p>å®ƒä»¬çš„åä½œå…³ç³»å°±åƒä¸€æ¡æµæ°´çº¿ï¼Œä¹Ÿå°±æ˜¯è´£ä»»é“¾æ¨¡å¼</p>
<p>æ€ä¹ˆå»ç†è§£è¿™é‡Œé¢çš„â€œè®¿é—®è€…æ¨¡å¼â€å‘¢ï¼Ÿä½ å¯ä»¥æŠŠè¿™ä¸ªè¿‡ç¨‹æƒ³è±¡æˆæœ‰ä¸€ä¸ªå¯¼æ¸¸ï¼ˆClassReaderï¼‰å¸¦é¢†æˆ‘ä»¬ï¼ˆClassVisitorï¼‰å‚è§‚æˆ¿å­ï¼ˆ<code>.class</code>ï¼‰ï¼Œé™¤äº†ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè£…ä¿®å…¬å¸çš„è´Ÿè´£äººï¼ˆClassWriterï¼‰åœ¨æ—è¾¹ã€‚</p>
<ol>
<li>
<p>ClassReaderï¼ˆå¯¼æ¸¸ï¼‰å¸¦æˆ‘ä»¬èµ°åˆ°ä¸»å§é—¨å£ï¼Œå¼€å§‹å¿µï¼šâ€œç°åœ¨æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå« addï¼Œå‚æ•°æ˜¯ 2 ä¸ª int...â€</p>
</li>
<li>
<p>ClassVisitorï¼ˆè®¿é—®è€… / æ¸¸å®¢ï¼‰å¬åˆ°åï¼Œå¯ä»¥åŸå°ä¸åŠ¨åœ°ä¼ ç»™ ClassWriterï¼ˆè£…ä¿®å…¬å¸çš„è´Ÿè´£äººï¼‰ï¼Œä¹Ÿå¯ä»¥å¤¹å¸¦ç§è´§ï¼šâ€œç°åœ¨æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå« addï¼Œå‚æ•°æ˜¯ 3 ä¸ª intâ€</p>
</li>
<li>
<p>ClassWriterï¼ˆè£…ä¿®å…¬å¸çš„è´Ÿè´£äººï¼‰å¬åˆ°ä»€ä¹ˆå°±è®°ä¸‹æ¥ï¼Œæœ€åæ‹¼æˆæ–°çš„ <code>.class</code> æ–‡ä»¶ã€‚</p>
</li>
</ol>
<p>å‡è®¾æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»§æ‰¿ <code>ClassVisitor</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClassVisitor</span>(nextVisitor: ClassVisitor) : ClassVisitor(Opcodes.ASM9, nextVisitor) {

Â  <span class="hljs-comment">// è®¿é—®åˆ°"ç±»"</span>
Â  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visit</span><span class="hljs-params">(version: <span class="hljs-type">Int</span>, access: <span class="hljs-type">Int</span>, name: <span class="hljs-type">String</span>?, signature: <span class="hljs-type">String</span>?, superName: <span class="hljs-type">String</span>?, interfaces: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">String</span>&gt;?)</span></span> {
Â  Â  <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œä¿®æ”¹ç±»åã€çˆ¶ç±»ç­‰</span>
Â  Â  <span class="hljs-keyword">super</span>.visit(version, access, name, signature, superName, interfaces)

Â  }

Â  <span class="hljs-comment">// å½“æ‰«æåˆ°æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒ</span>
Â  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitMethod</span><span class="hljs-params">(access: <span class="hljs-type">Int</span>, name: <span class="hljs-type">String</span>?, descriptor: <span class="hljs-type">String</span>?, signature: <span class="hljs-type">String</span>?, exceptions: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">String</span>&gt;?)</span></span>: MethodVisitor {
Â  Â  <span class="hljs-keyword">val</span> originalMethodVisitor = <span class="hljs-keyword">super</span>.visitMethod(access, name, descriptor, signature, exceptions)
Â  Â  <span class="hljs-keyword">if</span> (name == <span class="hljs-string">"add"</span>) {
Â  Â  Â  <span class="hljs-comment">// å¦‚æœæ˜¯æˆ‘ä»¬è¦ä¿®æ”¹çš„ add æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨è¿™é‡Œå†™æŒ‡ä»¤</span>
Â  Â  Â  <span class="hljs-comment">// è€Œæ˜¯è¦è¿”å›ä¸€ä¸ªæ–°çš„ MethodVisitor å¯¹è±¡ï¼Œç”±å®ƒå»å¤„ç†æ–¹æ³•å†…éƒ¨çš„ç»†èŠ‚</span>
Â  Â  Â  <span class="hljs-keyword">return</span> MyMethodVisitor(originalMethodVisitor)
Â  Â  }

Â  Â  <span class="hljs-keyword">return</span> originalMethodVisitor
Â  }
}
</code></pre>
<p>è¯·æ³¨æ„ <code>ClassVisitor</code> åªè´Ÿè´£â€œç±»â€å±‚é¢çš„äº‹ï¼ˆæ¯”å¦‚ç±»åã€å­—æ®µåˆ—è¡¨ã€æ–¹æ³•åˆ—è¡¨ï¼‰ã€‚å½“å®ƒå‘ç°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼ˆ<code>visitMethod()</code>ï¼‰ï¼Œå®ƒä¸ä¼šç›´æ¥å¤„ç†æ–¹æ³•ä½“å†…çš„ä»£ç ï¼Œè€Œæ˜¯è¦æ±‚ä½ è¿”å›ä¸€ä¸ª <strong><code>MethodVisitor</code></strong>ã€‚ä¹Ÿå°±æ˜¯ï¼šå¦‚æœä½ æƒ³æ”¹æ–¹æ³•é‡Œçš„ä»£ç ï¼Œå¾—å†æ´¾ä¸€ä¸ªå°å¼Ÿï¼ˆMethodVisitorï¼‰è¿›å»ã€‚è¿™ä¸ª <code>MethodVisitor</code> é‡Œçš„å›è°ƒæ›´åŠ ç»†è‡´ï¼š</p>
<ul>
<li><code>visitAnnotation(descriptor: String, visible: Boolean)</code>ï¼šè®¿é—®æ–¹æ³•æ³¨è§£ï¼›</li>
<li><code>visitParameter(name: String, access: Int)</code>ï¼šè®¿é—®æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ï¼›</li>
<li><code>visitCode()</code>ï¼šæ–¹æ³•ä½“çš„å¼€å§‹ï¼›</li>
<li><code>visitVarInsn(opcode: Int, varIndex: Int)</code>ï¼šè®¿é—®å±€éƒ¨å˜é‡ï¼›</li>
<li>...</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMethodVisitor</span>(nextMv: MethodVisitor) : MethodVisitor(Opcodes.ASM9, nextMv) {
  <span class="hljs-comment">// æ–¹æ³•å¼€å§‹æ‰§è¡Œæ—¶</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitCode</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">super</span>.visitCode()
    <span class="hljs-comment">// æ’å…¥ï¼šSystem.currentTimeMillis()...</span>
  }

  <span class="hljs-comment">// é‡åˆ°æ¯æ¡æŒ‡ä»¤æ—¶</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitInsn</span><span class="hljs-params">(opcode: <span class="hljs-type">Int</span>)</span></span> { 
    <span class="hljs-keyword">if</span> (opcode == Opcodes.IRETURN) {
      <span class="hljs-comment">// åœ¨ return ä¹‹å‰æ’å…¥è€—æ—¶è®¡ç®—ä»£ç ...</span>
    }
    <span class="hljs-keyword">super</span>.visitInsn(opcode)
  }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/686d378473a34fa98f59320d09dd457f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=JoUXXicZRQ4oIjjVHfIADLK%2B3as%3D" alt="Core_API_Details.png" loading="lazy"/></p>
<p>ç›¸æ¯”äº Tree APIï¼ŒCore API çš„ä¼˜ç‚¹æ˜¯å†…å­˜å ç”¨ä½ã€é€Ÿåº¦å¿«ã€‚ç¼ºç‚¹å°±æ˜¯å®ç°å¤æ‚ï¼Œæœ‰ç‚¹åäººç±»ï¼Œä½œä¸ºå¼€å‘è€…è¦æ—¶åˆ»æ¸…æ¥šå½“å‰â€œæµâ€åˆ°äº†å“ªé‡Œã€‚å¦‚æœæƒ³è·å–ä¸Šä¸‹æ–‡ï¼ˆæ¯”å¦‚åœ¨æ–¹æ³•ç»“å°¾æƒ³çŸ¥é“æ–¹æ³•å¼€å¤´å®šä¹‰çš„æŸä¸ªå˜é‡å€¼ï¼‰ï¼Œå¾—è‡ªå·±æƒ³åŠæ³•ç”¨å˜é‡å­˜èµ·æ¥ï¼Œä¸åƒ Tree API é‚£æ ·å¯ä»¥éšæ„å›å¤´çœ‹ã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/274ffd9dc45548f5afab581e6b5b3388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=9Q%2FunJYDrqHcKIuLxvLTJWHhUuE%3D" alt="Tree_VS_Core.png" loading="lazy"/></p>
<p>Tree API å°±åƒæ˜¯ç”¨ Word æ‰“å¼€æ–‡æ¡£ï¼Œä½ å¯ä»¥éšæ„ç¿»é¡µã€æŸ¥æ‰¾ã€æ›¿æ¢ï¼Œé€‚åˆåšå¤æ‚çš„å…¨ç±»åˆ†æï¼Œä½†è´¹å†…å­˜ï¼› Core API å°±åƒæ˜¯å¬å½•éŸ³å¸¦ï¼Œå¬ä¸€å¥æ”¹ä¸€å¥ï¼Œè¿‡äº†å°±æ²¡äº†ï¼Œé€‚åˆåšé«˜æ•ˆçš„æœºæ¢°åŒ–ä¿®æ”¹ï¼ˆæ¯”å¦‚ç»Ÿä¸€åŠ æ—¥å¿—ã€åŸ‹ç‚¹ï¼‰ã€‚</p>
<h2 data-id="heading-12">å®è·µ</h2>
<p>æˆ‘ä»¬ä»"æ’æ¡©"å’Œ"AOP"è¿™ä¸¤ä¸ªè¯å¼€å§‹è®²èµ·ï¼Œç„¶åç®€å•äº†è§£äº† Java ç¼–è¯‘è¿‡ç¨‹å’Œ apk æ‰“åŒ…æµç¨‹ï¼Œè¿˜å­¦äº†ç‚¹ JVM å­—èŠ‚ç çš„çŸ¥è¯†ï¼Œæœ€åæ¢è®¨äº† ASM æ˜¯å¦‚ä½•ä¿®æ”¹å­—èŠ‚ç çš„ã€‚</p>
<p>æ‰€æœ‰çš„ç†è®ºçŸ¥è¯†éƒ½å­¦äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯çœŸåˆ€çœŸæªçš„å®æ“ç¯èŠ‚äº†ã€‚æˆ‘ä»¬æ¥å†™ä¸€ä¸ª AOP åˆ‡é¢ç¼–ç¨‹çš„ Hello Worldï¼šå‡½æ•°è€—æ—¶æ‰“å°ã€‚</p>
<p>æˆ‘ä»¬çš„ç›®æ ‡å¾ˆç®€å•ï¼šç»™è¢«æ³¨è§£çš„æ–¹æ³•è‡ªåŠ¨åŠ ä¸Šè®¡æ—¶ä»£ç ï¼Œå¹¶åœ¨ Logcat ä¸­æ‰“å°å‡ºæ¥ã€‚</p>
<hr/>
<h3 data-id="heading-13">1. å®šä¹‰æ ‡è®°ï¼š@LogTime</h3>
<p>æˆ‘ä»¬å…ˆåœ¨ <code>:app</code> æ¨¡å—æ–°å»ºä¸€ä¸ªæ³¨è§£ç±» <code>LogTime</code>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// app/src/main/java/com/example/aop/LogTime.kt</span>

<span class="hljs-meta">@Retention(AnnotationRetention.BINARY)</span> <span class="hljs-comment">// é‡è¦ï¼šå¿…é¡»ä¿ç•™åˆ°å­—èŠ‚ç é˜¶æ®µï¼Œå¦åˆ™ ASM è¯»ä¸åˆ°</span>
<span class="hljs-meta">@Target(AnnotationTarget.FUNCTION)</span> <span class="hljs-comment">// ä½œç”¨åœ¨å‡½æ•°ä¸Š</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogTime</span>()
</code></pre>
<p>ç„¶åï¼Œæ‰¾ä¸ªâ€œå—å®³è€…â€æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨ <code>MainActivity</code> é‡Œå†™ä¸€ä¸ªæ¨¡æ‹Ÿè€—æ—¶æ“ä½œçš„æ–¹æ³•ï¼Œå¹¶æ‰“ä¸Šæ ‡è®°ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// app/src/main/java/com/example/aop/MainActivity.kt</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {  
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {  
    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)  
    doSomeHeavyWork()  
  }  
  
  <span class="hljs-meta">@LogTime</span> <span class="hljs-comment">// æ‰“ä¸Šæ ‡è®°</span>
  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doSomeHeavyWork</span><span class="hljs-params">()</span></span> {  
    Thread.sleep(<span class="hljs-number">100</span>) <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶ 100ms</span>
  }
}
</code></pre>
<p>å¦‚æœä¸æ’æ¡©ï¼Œè¿™æ®µä»£ç è¿è¡Œèµ·æ¥é™æ‚„æ‚„çš„ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©å®ƒè‡ªåŠ¨åå‡ºç±»ä¼¼ <code>MainActivity.doSomeHeavyWork execution time: 100 ms</code> çš„æ—¥å¿—ã€‚</p>
<h3 data-id="heading-14">2. æ­å»ºå·¥ç¨‹ï¼šComposite Build</h3>
<p>æ—¢ç„¶è¦å¯¹å­—èŠ‚ç ä¸‹æ‰‹ï¼Œæˆ‘ä»¬é¦–å…ˆå¾—ææ¸…æ¥šâ€œæˆ˜åœºâ€åœ¨å“ªã€‚</p>
<p>æ™®é€šçš„ä¸šåŠ¡ä»£ç ï¼ˆæ¯”å¦‚ MainActivityï¼‰æ˜¯è¿è¡Œåœ¨ç”¨æˆ·çš„ Android æ‰‹æœºä¸Šçš„ï¼›è€Œæˆ‘ä»¬ç°åœ¨è¦å†™çš„æ’æ¡©ä»£ç ï¼Œæ˜¯ç”¨æ¥ä¿®æ”¹å­—èŠ‚ç çš„ï¼Œå®ƒéœ€è¦è¿è¡Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ˆä¹Ÿå°±æ˜¯ä½ çš„å¼€å‘ç”µè„‘ä¸Šï¼‰ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠè¿™éƒ¨åˆ†ä»£ç ç›´æ¥å†™åœ¨ <code>:app</code> æ¨¡å—é‡Œã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½ä»‹å…¥ Android æ„å»ºæµç¨‹ã€åœ¨ <code>.class</code> ç”Ÿæˆåç”± Gradle è‡ªåŠ¨è°ƒç”¨çš„ä¸œè¥¿â€”â€”æ²¡é”™ï¼Œå°±æ˜¯ Gradle æ’ä»¶ã€‚</p>
<hr/>
<p>Gradle æ’ä»¶çš„ä»£ç å¿…é¡»ç‹¬ç«‹äº <code>:app</code> æ¨¡å—å­˜åœ¨ã€‚åœ¨ Android å·¥ç¨‹é‡Œï¼Œè¦å­˜æ”¾è¿™ç§â€œæ„å»ºé€»è¾‘ï¼ˆBuild Logicï¼‰â€ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š</p>
<ul>
<li><code>:buildSrc</code>ï¼š è¿™æ˜¯ä»¥å‰æœ€å¸¸ç”¨çš„æ–¹æ¡ˆã€‚åªè¦åœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªå« <code>buildSrc</code> çš„æ–‡ä»¶å¤¹ï¼ŒGradle å°±ä¼šè‡ªåŠ¨æŠŠå®ƒè¯†åˆ«ä¸ºæ’ä»¶å·¥ç¨‹ã€‚
<ul>
<li>ä¼˜ç‚¹ï¼šé›¶é…ç½®</li>
<li>ç¼ºç‚¹ï¼š<code>:buildSrc</code> è¢«è§†ä¸ºæ„å»ºè„šæœ¬çš„ä¸€éƒ¨åˆ†ã€‚åªè¦æ”¹åŠ¨äº† <code>:buildSrc</code> é‡Œçš„ä»»ä½•ä¸€è¡Œä»£ç ï¼ŒGradle å°±ä¼šè®¤ä¸ºæ•´ä¸ªé¡¹ç›®çš„æ„å»ºé€»è¾‘å˜äº†ï¼Œä»è€Œå¼ºåˆ¶è®©æ‰€æœ‰æ¨¡å—ï¼ˆ<code>:app</code>, <code>:lib</code>...ï¼‰æ‰§è¡Œå…¨é‡é‡æ–°ç¼–è¯‘ã€‚</li>
</ul>
</li>
<li>Composite Buildï¼ˆå¤åˆæ„å»ºï¼‰ï¼š è¿™æ˜¯ Gradle å®˜æ–¹ç›®å‰æ¨èçš„ç°ä»£åŒ–æ–¹æ¡ˆã€‚ å®ƒå…è®¸ä½ æŠŠæ’ä»¶ä½œä¸ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„é¡¹ç›®ï¼ˆProjectï¼‰æ¥å¼€å‘ï¼Œç„¶åé€šè¿‡ <code>includeBuild</code> çš„æ–¹å¼â€œæŒ‚è½½â€åˆ°ä¸»é¡¹ç›®ä¸Šã€‚
<ul>
<li>ä¼˜ç‚¹ï¼šå®Œå…¨è§£è€¦ã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de58daf9dae440b8a6e12ce8159f49d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYnFsaWFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558339&amp;x-signature=Ymv7KzGY3Jder%2FWBTcEhwtoYFT0%3D" alt="drop_buildSrc.png" loading="lazy"/></p>
<p>ä½œä¸º 2025 å¹´çš„ Android å¼€å‘è€…ï¼Œæˆ‘ä»¬å½“ç„¶é€‰æ‹© Composite Build æ¥ç¼–å†™ Gradle æ’ä»¶ã€‚</p>
<p>æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ <code>build-logic</code>ï¼ˆåå­—å¯ä»¥éšæ„ï¼‰ï¼Œè¿™å°±ç›¸å½“äºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„â€œå¤–åŒ…å·¥ç¨‹â€ã€‚</p>
<p>å°±åƒæˆ‘ä»¬åˆ›å»º Android é¡¹ç›®ä¸€æ ·ï¼Œä¸€ä¸ªæ ¹é¡¹ç›®é‡Œé¢åŒ…å«ä¸€ä¸ª <code>:app</code> æ¨¡å—ï¼Œæˆ‘ä»¬çš„å¤–åŒ…å·¥ç¨‹é¡¹ç›®ï¼ˆbuild-loginï¼‰é‡Œé¢ä¹Ÿåº”è¯¥æœ‰ä¸€ä¸ªæ’ä»¶æ¨¡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬å†ç»§ç»­åˆ›å»ºä¸¤çº§å­ç›®å½• <code>/plugin/timing</code>ï¼Œè¿™ä¸ª <code>timing</code> ç›®å½•å°±æ˜¯æˆ‘ä»¬æ’ä»¶æ¨¡å—ã€‚</p>
<pre><code class="hljs language-diff" lang="diff">.
  â”œâ”€â”€ app/                   &lt;-- app æ¨¡å—ç›®å½•
  â”œâ”€â”€ gradle/
<span class="hljs-addition">+ â”œâ”€â”€ build-logic/           &lt;-- å¤åˆæ„å»ºçš„æ ¹ç›®å½•</span>
<span class="hljs-addition">+ â”‚   â””â”€â”€ plugin/</span>
<span class="hljs-addition">+ â”‚       â””â”€â”€ timing/        &lt;-- æ’ä»¶æ¨¡å—ç›®å½•</span>
  â”œâ”€â”€ build.gradle.kts       &lt;-- æ ¹é¡¹ç›®çš„æ„å»ºè„šæœ¬
  â””â”€â”€ settings.gradle.kts    &lt;-- æ ¹é¡¹ç›®çš„è®¾ç½®è„šæœ¬
</code></pre>
<p>OKï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„"å¤–åŒ…"å·¥ç¨‹é¡¹ç›®ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™ä¸ªé¡¹ç›®å’Œä¸»é¡¹ç›®æ²¡æœ‰ä»»ä½•å…³è”ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸»é¡¹ç›® <code>settings.gradle.kts</code> é‡Œä½¿ç”¨ <code>includeBuild()</code> å‘Šè¯‰ Gradleï¼šå˜¿ï¼Œè¿™ä¸ª <code>build-logic</code> æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Projectï¼Œé‡Œé¢åŒ…å«ä¸€äº›æ„å»ºé€»è¾‘ï¼Œåœ¨ç¼–è¯‘ä¸»é¡¹ç›®é‡Œçš„ä»»ä½•æ¨¡å—ä¹‹å‰ï¼Œè¯·ä½ å…ˆç¼–è¯‘ <code>build-logic</code> è¿™ä¸ªé¡¹ç›®ã€‚</p>
<pre><code class="hljs language-diff" lang="diff">// settings.gradle.kts

pluginManagement {  
<span class="hljs-addition">+  includeBuild("build-logic")</span>
   repositories { ... }  
}  
  
dependencyResolutionManagement { ... }  
  
rootProject.name = "AopExample"  
  
include(":app") // åŒ…å« app å­æ¨¡å—
</code></pre>
<p>è™½ç„¶å¤åˆæ„å»ºï¼ˆ<code>build-logic</code>ï¼‰ä»æ–‡ä»¶ç»“æ„ä¸Šçœ‹ï¼Œå­˜åœ¨äºä¸»é¡¹ç›®å†…éƒ¨ï¼Œä½†æ˜¯å¤åˆæ„å»ºæ˜¯å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ Project çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æˆ‘æŠŠ <code>build-logic/</code> æ–‡ä»¶å¤¹å•ç‹¬æ‹¿å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥ build èµ·æ¥ï¼Œä¸éœ€è¦ä¾èµ–ä¸»é¡¹ç›®ã€‚æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œé‚£ä¹ˆåº”è¯¥æœ‰è‡ªå·±çš„ <code>settings.gradle.kts</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">.
  â”œâ”€â”€ app/                     &lt;-- app æ¨¡å—ç›®å½•
  â”œâ”€â”€ gradle/
  â”œâ”€â”€ build-logic/             &lt;-- å¤åˆæ„å»ºçš„æ ¹ç›®å½•
<span class="hljs-addition">+ â”‚   â”œâ”€â”€ settings.gradle.kts  &lt;-- ç®¡ç† build-logic å†…éƒ¨çš„æ¨¡å—</span>
  â”‚   â””â”€â”€ plugin/
  â”‚       â””â”€â”€ timing/          &lt;-- æ’ä»¶æ¨¡å—ç›®å½•
  â”œâ”€â”€ build.gradle.kts         &lt;-- æ ¹é¡¹ç›®çš„æ„å»ºè„šæœ¬
  â””â”€â”€ settings.gradle.kts      &lt;-- æ ¹é¡¹ç›®çš„è®¾ç½®è„šæœ¬
</code></pre>
<p>å†…å®¹å’Œä¸»é¡¹ç›®çš„ <code>settings.gradle.kts</code> æ˜¯ç±»ä¼¼çš„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build-logic/settings.gradle.kts</span>

pluginManagement {  
    repositories {  
        gradlePluginPortal()  
        google()  
    }  
}  
  
dependencyResolutionManagement {  
    repositories {  
        google {  
            content {  
                includeGroupByRegex(<span class="hljs-string">"com\\.android.*"</span>)  
                includeGroupByRegex(<span class="hljs-string">"com\\.google.*"</span>)  
                includeGroupByRegex(<span class="hljs-string">"androidx.*"</span>)  
            }  
        }  
        mavenCentral()  
    }
}  
  
rootProject.name = <span class="hljs-string">"build-logic"</span> <span class="hljs-comment">// è¿™ä¸ª"å¤–åŒ…å·¥ç¨‹"çš„åå­—</span>
include(<span class="hljs-string">":plugin:timing"</span>) <span class="hljs-comment">// å·¥ç¨‹é‡ŒåŒ…å«çš„æ¨¡å—</span>
</code></pre>
<p>æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ <code>build.gradle.kts</code> æ–‡ä»¶ï¼Œ<code>:app</code> å¦‚æ­¤ï¼Œæ’ä»¶æ¨¡å— <code>:plugin:timing</code> ä¹Ÿä¸ä¾‹å¤–ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">.
  â”œâ”€â”€ app/                           &lt;-- app æ¨¡å—ç›®å½•
  â”œâ”€â”€ gradle/
  â”œâ”€â”€ build-logic/                   &lt;-- å¤åˆæ„å»ºçš„æ ¹ç›®å½•
  â”‚   â”œâ”€â”€ settings.gradle.kts        &lt;-- ç®¡ç† build-logic å†…éƒ¨çš„æ¨¡å—
  â”‚   â””â”€â”€ plugin/
  â”‚       â””â”€â”€ timing/                &lt;-- æ’ä»¶æ¨¡å—ç›®å½•
<span class="hljs-addition">+ â”‚           â””â”€â”€â”€ build.gradle.kts  &lt;-- æ’ä»¶çš„æ„å»ºè„šæœ¬</span>
  â”œâ”€â”€ build.gradle.kts               &lt;-- æ ¹é¡¹ç›®çš„æ„å»ºè„šæœ¬
  â””â”€â”€ settings.gradle.kts            &lt;-- æ ¹é¡¹ç›®çš„è®¾ç½®è„šæœ¬
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build-logic/plugin/timing/build.gradle.kts</span>

plugins { `kotlin-dsl` }  
  
java {  
  sourceCompatibility = JavaVersion.VERSION_17  
  targetCompatibility = JavaVersion.VERSION_17  
}  
  
kotlin { compilerOptions { jvmTarget = JvmTarget.JVM_17 } }  
  
dependencies {  
  <span class="hljs-comment">// AGP APIï¼Œç”¨äºè®¿é—® androidComponents æ‰©å±•</span>
  <span class="hljs-comment">// å¼ºçƒˆå»ºè®®ä¸ AGP gradle ç‰ˆæœ¬ä¿æŒä¸€è‡´</span>
  implementation(<span class="hljs-string">"com.android.tools.build:gradle-api:8.13.1"</span>)  
  <span class="hljs-comment">// ASM æ ¸å¿ƒåº“: æ“ä½œå­—èŠ‚ç çš„åŸºç¡€</span>
  implementation(<span class="hljs-string">"org.ow2.asm:asm:9.9"</span>)  
  <span class="hljs-comment">// ASM å·¥å…·åº“ï¼Œæä¾›äº†ä¸€äº›æ–¹ä¾¿çš„é€‚é…å™¨ç±»  </span>
  implementation(<span class="hljs-string">"org.ow2.asm:asm-commons:9.9"</span>)  
}  

<span class="hljs-comment">// æ³¨å†Œ Gradle æ’ä»¶</span>
<span class="hljs-comment">// TimingPlugin æˆ‘ä»¬åœ¨åé¢ä¼šå®ç°</span>
gradlePlugin {  
  plugins {  
    register(<span class="hljs-string">"TimingPlugin"</span>) {  
      id = <span class="hljs-string">"timing-plugin"</span> <span class="hljs-comment">// æ’ä»¶ ID</span>
      implementationClass = <span class="hljs-string">"com.example.asm.timing.TimingPlugin"</span> <span class="hljs-comment">// æ’ä»¶çš„å…¥å£ç±»</span>
    }  
  }  
}
</code></pre>
<h3 data-id="heading-15">3. æ ¸å¿ƒæ‰‹æœ¯ï¼šç¼–å†™ MethodVisitor</h3>
<p>å¥½ï¼Œæ¶å­æ­å¥½äº†ï¼Œç°åœ¨è¿›å…¥æœ€æ ¸å¿ƒçš„éƒ¨åˆ†â€”â€”å†™å­—èŠ‚ç ã€‚</p>
<p>æˆ‘ä»¬è¦ä¿®æ”¹çš„æ˜¯æ–¹æ³•ï¼ˆMethodï¼‰ï¼Œæ‰€ä»¥æ ¸å¿ƒé€»è¾‘è‚¯å®šåœ¨ <code>MethodVisitor</code> é‡Œã€‚</p>
<pre><code class="hljs language-diff" lang="diff">.
  â”œâ”€â”€ app/                           &lt;-- app æ¨¡å—ç›®å½•
  â”œâ”€â”€ gradle/
  â”œâ”€â”€ build-logic/                   &lt;-- å¤åˆæ„å»ºçš„æ ¹ç›®å½•
  â”‚   â”œâ”€â”€ settings.gradle.kts        &lt;-- ç®¡ç† build-logic å†…éƒ¨çš„æ¨¡å—
  â”‚   â””â”€â”€ plugin/
  â”‚       â””â”€â”€ timing/                &lt;-- æ’ä»¶æ¨¡å—ç›®å½•
  â”‚           â”œâ”€â”€â”€ build.gradle.kts  &lt;-- æ’ä»¶çš„æ„å»ºè„šæœ¬
<span class="hljs-addition">+ â”‚           â””â”€â”€ src/ </span>
<span class="hljs-addition">+ â”‚               â””â”€â”€ main/kotlin/com/example/asm/timing/ </span>
<span class="hljs-addition">+ â”‚                   â””â”€â”€ TimingMethodVisitor.kt</span>
  â”œâ”€â”€ build.gradle.kts               &lt;-- æ ¹é¡¹ç›®çš„æ„å»ºè„šæœ¬
  â””â”€â”€ settings.gradle.kts            &lt;-- æ ¹é¡¹ç›®çš„è®¾ç½®è„šæœ¬
</code></pre>
<p>ç›´æ¥ç”¨ <code>MethodVisitor</code> ä¼šæ¯”è¾ƒç—›è‹¦ï¼Œè¿˜å¾—è‡ªå·±åˆ¤æ–­å“ªé‡Œæ˜¯æ–¹æ³•ç»“æŸã€‚å¹¸è¿çš„æ˜¯ï¼Œ<code>asm-commons</code> åº“æä¾›äº†ä¸€ä¸ªç¥å™¨ï¼š<code>AdviceAdapter</code>ï¼Œå®ƒæ˜¯ <code>MethodVisitor</code> çš„å­ç±»ï¼Œè´´å¿ƒåœ°æä¾›äº† <code>onMethodEnter()</code>ï¼ˆæ–¹æ³•è¿›å…¥æ—¶ï¼‰å’Œ <code>onMethodExit()</code>ï¼ˆæ–¹æ³•é€€å‡ºæ—¶ï¼‰è¿™ä¸¤ä¸ªå›è°ƒã€‚æˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸¤ä¸ªåœ°æ–¹â€œå¡«ç©ºâ€å°±è¡Œäº†ã€‚</p>
<p>è¿™éƒ¨åˆ†ä»£ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œä¸è¿‡æ¯ä¸€è¡Œéƒ½æœ‰æ³¨é‡Šï¼Œæˆ‘å°±ä¸å•°å—¦å¤ªå¤šäº†ï¼Œæœ‰äº†å‰é¢çš„å‰ç½®çŸ¥è¯†ï¼Œç›¸ä¿¡å¤§å®¶éƒ½èƒ½çœ‹æ‡‚ï¼Œå…¶å®å°±æ˜¯æŠŠ Java ä»£ç â€œç¿»è¯‘â€æˆç­‰ä»·çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build-logic/plugin/timing/src/main/kotlin/com/example/asm/timing/TimingMethodVisitor.kt</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TimingMethodVisitor</span>(  
    api: <span class="hljs-built_in">Int</span>,  
    methodVisitor: MethodVisitor,  
    access: <span class="hljs-built_in">Int</span>,  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> methodName: String?,  
    descriptor: String?,  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> className: String,  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logTag: String  
) : AdviceAdapter(api, methodVisitor, access, methodName, descriptor) {  
  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> hasLogTimeAnnotation = <span class="hljs-literal">false</span>  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> startTimeLocalVarIndex: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>  
  
    <span class="hljs-comment">// 1. è®¿é—®æ–¹æ³•çš„æ³¨è§£  </span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitAnnotation</span><span class="hljs-params">(descriptor: <span class="hljs-type">String</span>?, visible: <span class="hljs-type">Boolean</span>)</span></span>: AnnotationVisitor? {  
        <span class="hljs-keyword">if</span> (descriptor == <span class="hljs-string">"Lcom/example/aop/LogTime;"</span>) { <span class="hljs-comment">// é€šè¿‡æè¿°ç¬¦åˆ¤æ–­æ³¨è§£  </span>
            hasLogTimeAnnotation = <span class="hljs-literal">true</span>  
        }  
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.visitAnnotation(descriptor, visible)  
    }  
  
    <span class="hljs-comment">// 2. åœ¨æ–¹æ³•è¿›å…¥æ—¶è¢«è°ƒç”¨  </span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMethodEnter</span><span class="hljs-params">()</span></span> {  
        <span class="hljs-keyword">super</span>.onMethodEnter()  
        <span class="hljs-keyword">if</span> (hasLogTimeAnnotation) {  
            <span class="hljs-comment">// newLocal() æ˜¯ä¸€ä¸ªä¾¿æ·æ–¹æ³•, ä¼šåœ¨å½“å‰æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ä¿ç•™ä¸€ä¸ªæ–°çš„æ§½ä½, è¿”å›å±€éƒ¨å˜é‡ç´¢å¼•  </span>
            startTimeLocalVarIndex = newLocal(Type.LONG_TYPE <span class="hljs-comment">/* æŒ‡å®šæ–°å±€éƒ¨å˜é‡çš„æ•°æ®ç±»å‹ */</span>)  
  
            <span class="hljs-comment">// è°ƒç”¨é™æ€æ–¹æ³• System.currentTimeMillis()            // mv æ˜¯ MethodVisitor, åœ¨çˆ¶ç±»ä¸­å®šä¹‰çš„  </span>
            mv.visitMethodInsn( <span class="hljs-comment">// visitMethodInsn æ–¹æ³•ç”¨äºæ·»åŠ ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æŒ‡ä»¤  </span>
                <span class="hljs-comment">/* opcode = */</span> INVOKESTATIC,      <span class="hljs-comment">// Invoke Static: JVM å­—èŠ‚ç æŒ‡ä»¤ï¼Œå®ƒå‘Šè¯‰ JVM å»è°ƒç”¨ä¸€ä¸ª staticï¼ˆé™æ€ï¼‰æ–¹æ³•  </span>
                <span class="hljs-comment">/* owner = */</span> <span class="hljs-string">"java/lang/System"</span>, <span class="hljs-comment">// æ‹¥æœ‰è¯¥æ–¹æ³•çš„ç±»çš„å†…éƒ¨åç§°  </span>
                <span class="hljs-comment">/* name = */</span> <span class="hljs-string">"currentTimeMillis"</span>, <span class="hljs-comment">// æƒ³è¦è°ƒç”¨çš„æ–¹æ³•çš„åç§°  </span>
                <span class="hljs-comment">/* descriptor = */</span> <span class="hljs-string">"()J"</span>,         <span class="hljs-comment">// æ–¹æ³•æè¿°ç¬¦, () è¡¨ç¤ºè¯¥æ–¹æ³•æ²¡æœ‰å‚æ•°, J è¡¨ç¤ºæ–¹æ³•çš„è¿”å›å€¼ç±»å‹æ˜¯ long (J æ˜¯ long çš„ JVM ç±»å‹ç­¾å)  </span>
                <span class="hljs-comment">/* isInterface = */</span> <span class="hljs-literal">false</span>         <span class="hljs-comment">// æŒ‡ç¤º ownerï¼ˆå³ java/lang/Systemï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£  </span>
            )  
  
            <span class="hljs-comment">// å°†ä¸Šä¸€æ­¥çš„ç»“æœï¼ˆæ—¶é—´æˆ³ï¼‰å­˜å…¥æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„å±€éƒ¨å˜é‡ä¸­  </span>
            mv.visitVarInsn( <span class="hljs-comment">// æ­¤æ–¹æ³•ç”¨äºæ·»åŠ ä¸€ä¸ªä¸å±€éƒ¨å˜é‡äº¤äº’çš„æŒ‡ä»¤ï¼ˆå¦‚åŠ è½½æˆ–å­˜å‚¨ï¼‰  </span>
                <span class="hljs-comment">/* opcode = */</span> LSTORE,        <span class="hljs-comment">// LSTORE æ˜¯ä¸€ä¸ªå¤åˆæŒ‡ä»¤: STORE è¡¨ç¤ºâ€œå­˜å‚¨â€, ä¼šä»æ“ä½œæ•°æ ˆçš„æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªå€¼, L è¡¨ç¤º long                /* varIndex = */ startTimeLocalVarIndex // å±€éƒ¨å˜é‡ç´¢å¼•, æŒ‡å®šè¦å­˜å‚¨åˆ°å“ªä¸€ä¸ªå±€éƒ¨å˜é‡æ§½ä½  </span>
            )  
        }  
    }  
  
    <span class="hljs-comment">// 3. åœ¨æ–¹æ³•é€€å‡ºæ—¶è¢«è°ƒç”¨ (æ— è®ºæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯å¼‚å¸¸æŠ›å‡º)  </span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onMethodExit</span><span class="hljs-params">(opcode: <span class="hljs-type">Int</span>)</span></span> {  
        <span class="hljs-keyword">if</span> (hasLogTimeAnnotation) {  
            <span class="hljs-comment">/**  
             * ä»¥ä¸‹éƒ¨åˆ†çš„ç­‰æ•ˆä»£ç æ˜¯ï¼š  
             * long endTime = System.currentTimeMillis();  
             * long duration = endTime - startTime;             * String msg = new StringBuilder()  
             *         .append("MyClass.myMethod execution time: ")  
             *         .append(duration)             *         .append(" ms")             *         .toString();             * Log.d(logTag, msg);  
             */</span>  
            <span class="hljs-comment">// å†æ¬¡è°ƒç”¨ System.currentTimeMillis() è·å–ç»“æŸæ—¶é—´, ä¸å†èµ˜è¿°  </span>
            mv.visitMethodInsn(INVOKESTATIC, <span class="hljs-string">"java/lang/System"</span>, <span class="hljs-string">"currentTimeMillis"</span>, <span class="hljs-string">"()J"</span>, <span class="hljs-literal">false</span>)  
            <span class="hljs-comment">// åŠ è½½æ–¹æ³•å¼€å§‹æ—¶å­˜å‚¨çš„æ—¶é—´æˆ³  </span>
            mv.visitVarInsn(LLOAD, startTimeLocalVarIndex)  
            <span class="hljs-comment">// è®¡ç®—å·®å€¼ (ç»“æŸæ—¶é—´ - å¼€å§‹æ—¶é—´)  </span>
            mv.visitInsn(LSUB)  
            <span class="hljs-comment">// å°†å·®å€¼ï¼ˆlongç±»å‹ï¼‰å­˜å…¥ä¸€ä¸ªæ–°çš„å±€éƒ¨å˜é‡  </span>
            <span class="hljs-keyword">val</span> durationLocalVarIndex = newLocal(Type.LONG_TYPE)  
            mv.visitVarInsn(LSTORE, durationLocalVarIndex)  
  
  
            <span class="hljs-comment">// å‡†å¤‡æ‰“å°æ—¥å¿—  </span>
            mv.visitLdcInsn(logTag) <span class="hljs-comment">// LDC (Load Constant) åŠ è½½ä¸€ä¸ªå¸¸é‡åˆ°æ“ä½œæ•°æ ˆçš„æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String)]  </span>
  
            mv.visitTypeInsn( <span class="hljs-comment">// è®¿é—®ä¸â€œç±»å‹â€ç›¸å…³çš„æŒ‡ä»¤  </span>
                <span class="hljs-comment">/* opcode = */</span> NEW,                    <span class="hljs-comment">// NEW  </span>
                <span class="hljs-comment">/* type = */</span> <span class="hljs-string">"java/lang/StringBuilder"</span> <span class="hljs-comment">// è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹  </span>
            ) <span class="hljs-comment">// åœ¨å †ä¸Šåˆ†é…ä¸€ä¸ª StringBuilder å¯¹è±¡ï¼Œå¹¶å°†å…¶å¼•ç”¨ï¼ˆåœ°å€ï¼‰æ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit)]  </span>
  
            mv.visitInsn(DUP) <span class="hljs-comment">// DUP (Duplicate) å¤åˆ¶æ ˆé¡¶å…ƒç´   </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit), sb_ref(uninit)]  </span>
  
            mv.visitMethodInsn(  
                <span class="hljs-comment">/* opcode = */</span> INVOKESPECIAL,            <span class="hljs-comment">// invoke special ç‰¹æ®Šè°ƒç”¨ï¼Œç”¨äºæ„é€ å‡½æ•°ã€super è°ƒç”¨å’Œ private æ–¹æ³•  </span>
                <span class="hljs-comment">/* owner = */</span> <span class="hljs-string">"java/lang/StringBuilder"</span>, <span class="hljs-comment">// æ‹¥æœ‰è¯¥æ–¹æ³•çš„ç±»çš„å†…éƒ¨åç§°  </span>
                <span class="hljs-comment">/* name = */</span> <span class="hljs-string">"&lt;init&gt;"</span>,                   <span class="hljs-comment">// æ„é€ å‡½æ•°çš„å›ºå®šåç§°  </span>
                <span class="hljs-comment">/* descriptor = */</span> <span class="hljs-string">"()V"</span>,                <span class="hljs-comment">// æè¿°ç¬¦ã€‚() è¡¨ç¤ºæ— å‚æ•°ï¼ŒV è¡¨ç¤º void è¿”å›  </span>
                <span class="hljs-comment">/* isInterface = */</span> <span class="hljs-literal">false</span>                <span class="hljs-comment">// // æŒ‡ç¤º ownerï¼ˆå³ java/lang/StringBuilderï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£  </span>
            )  
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit)]  </span>
  
            mv.visitLdcInsn(<span class="hljs-string">"<span class="hljs-variable">$className</span>.<span class="hljs-variable">$methodName</span> execution time: "</span>) <span class="hljs-comment">// åŠ è½½å¸¸é‡, å°†æ—¥å¿—æ¶ˆæ¯çš„å‰ç¼€ï¼ˆä¸€ä¸ª Stringï¼‰æ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit), æ—¥å¿—æ¶ˆæ¯å‰ç¼€(String)]  </span>
  
            mv.visitMethodInsn(  
                <span class="hljs-comment">/* opcode = */</span> INVOKEVIRTUAL,                                       <span class="hljs-comment">// invoke virtual: è™šæ‹Ÿè°ƒç”¨ï¼Œç”¨äºæ‰€æœ‰å®ä¾‹æ–¹æ³•  </span>
                <span class="hljs-comment">/* owner = */</span> <span class="hljs-string">"java/lang/StringBuilder"</span>,                            <span class="hljs-comment">// æ‹¥æœ‰è¯¥æ–¹æ³•çš„ç±»çš„å†…éƒ¨åç§°  </span>
                <span class="hljs-comment">/* name = */</span> <span class="hljs-string">"append"</span>,                                              <span class="hljs-comment">// æ–¹æ³•å  </span>
                <span class="hljs-comment">/* descriptor = */</span> <span class="hljs-string">"(Ljava/lang/String;)Ljava/lang/StringBuilder;"</span>, <span class="hljs-comment">// æè¿°ç¬¦, å‚æ•°ç±»å‹ä¸º String, è¿”å›ç±»å‹ä¸º StringBuilder                /* isInterface = */ false                                           // æŒ‡ç¤º ownerï¼ˆå³ java/lang/StringBuilderï¼‰æ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£  </span>
            ) <span class="hljs-comment">// è°ƒç”¨ append(String)ã€‚å®ƒä¼šæ¶ˆè€—æ ˆé¡¶çš„ æ—¥å¿—æ¶ˆæ¯å‰ç¼€(String) å’Œ sb_ref(init), ä¸è¿‡å®ƒä¼šè¿”å›ä¸€ä¸ª StringBuilder, ç„¶åå°†ç»“æœæ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit)]  </span>
  
            mv.visitVarInsn(LLOAD, durationLocalVarIndex) <span class="hljs-comment">// åŠ è½½è€—æ—¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit), è€—æ—¶(long)]  </span>
  
            mv.visitMethodInsn(INVOKEVIRTUAL, <span class="hljs-string">"java/lang/StringBuilder"</span>, <span class="hljs-string">"append"</span>, <span class="hljs-string">"(J)Ljava/lang/StringBuilder;"</span>, <span class="hljs-literal">false</span>)  
            <span class="hljs-comment">// è°ƒç”¨ append(long)ã€‚å®ƒä¼šæ¶ˆè€—æ ˆé¡¶çš„ è€—æ—¶(long) å’Œ sb_ref(init), ä¸è¿‡å®ƒä»ç„¶è¿”å›ä¸€ä¸ª StringBuilder, ç„¶åå°†ç»“æœæ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit)]  </span>
  
            mv.visitLdcInsn(<span class="hljs-string">" ms"</span>) <span class="hljs-comment">// åŠ è½½å¸¸é‡, å°†æ—¥å¿—æ¶ˆæ¯çš„åç¼€ï¼ˆä¸€ä¸ª Stringï¼‰æ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit), æ—¥å¿—æ¶ˆæ¯åç¼€(String)]  </span>
  
            mv.visitMethodInsn(INVOKEVIRTUAL, <span class="hljs-string">"java/lang/StringBuilder"</span>, <span class="hljs-string">"append"</span>, <span class="hljs-string">"(Ljava/lang/String;)Ljava/lang/StringBuilder;"</span>, <span class="hljs-literal">false</span>)  
            <span class="hljs-comment">// è°ƒç”¨ append(String)ã€‚å®ƒä¼šæ¶ˆè€—æ ˆé¡¶çš„ æ—¥å¿—æ¶ˆæ¯åç¼€(String) å’Œ sb_ref(init), ä¸è¿‡å®ƒä»ç„¶è¿”å›ä¸€ä¸ª StringBuilder, ç„¶åå°†ç»“æœæ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), sb_ref(uninit)]  </span>
  
            mv.visitMethodInsn(INVOKEVIRTUAL, <span class="hljs-string">"java/lang/StringBuilder"</span>, <span class="hljs-string">"toString"</span>, <span class="hljs-string">"()Ljava/lang/String;"</span>, <span class="hljs-literal">false</span>)  
            <span class="hljs-comment">// è°ƒç”¨ toString()ã€‚å®ƒä¼šæ¶ˆè€—æ ˆé¡¶çš„ sb_ref(init), ç„¶åå°†ç»“æœæ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [æ—¥å¿—Tag(String), æ—¥å¿—æ¶ˆæ¯(String)]  </span>
  
            mv.visitMethodInsn(INVOKESTATIC, <span class="hljs-string">"android/util/Log"</span>, <span class="hljs-string">"d"</span>, <span class="hljs-string">"(Ljava/lang/String;Ljava/lang/String;)I"</span>, <span class="hljs-literal">false</span>)  
            <span class="hljs-comment">// è°ƒç”¨ Log.d(tag, msg)ã€‚å®ƒä¼šæ¶ˆè€—æ ˆé¡¶çš„ æ—¥å¿—æ¶ˆæ¯(String) å’Œ æ—¥å¿—Tag(String), ç„¶åå°†ç»“æœ(å†™å…¥çš„å­—èŠ‚æ•°)æ¨å…¥æ ˆé¡¶  </span>
            <span class="hljs-comment">// æ­¤æ—¶çš„æ“ä½œæ•°æ ˆ: [result(int)]  </span>
  
            <span class="hljs-comment">// Log.d è¿”å›äº†ä¸€ä¸ª intï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒå®ƒã€‚å¦‚æœä¸å¼¹å‡ºå®ƒï¼Œè¿™ä¸ª int å€¼ä¼šç•™åœ¨æ ˆä¸Šï¼Œå½“åŸå§‹çš„ RETURN æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œ  </span>
            <span class="hljs-comment">// ä¼šå¯¼è‡´æ ˆå¸§é”™è¯¯ (StackMapFrameError)ã€‚POP ç”¨æ¥æ¸…ç†æ ˆï¼Œç¡®ä¿æ ˆåœ¨æˆ‘ä»¬çš„ä»£ç æ‰§è¡Œå®Œæ¯•åæ˜¯å¹²å‡€çš„  </span>
            mv.visitInsn(POP) <span class="hljs-comment">// Log.d è¿”å› intï¼Œéœ€è¦å¼¹å‡º  </span>
        }  
        <span class="hljs-keyword">super</span>.onMethodExit(opcode) <span class="hljs-comment">// è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯å°†åŸå§‹çš„é€€å‡ºæŒ‡ä»¤ï¼ˆå¦‚ RETURNï¼‰å†™å›æ–¹æ³•ä¸­, ä¸è¦å¿˜è®°ï¼ï¼ï¼  </span>
    }  
}
</code></pre>
<p>å†™è¿™éƒ¨åˆ†ä»£ç çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—è‡ªå·±å°±åƒä¸€ä¸ªæ— æƒ…å †æ ˆæœºï¼šâ€œæŠŠè¿™ä¸ªå‹å…¥æ ˆï¼ŒæŠŠé‚£ä¸ªå¼¹å‡ºæ¥â€¦â€¦â€ã€‚æ²¡é”™ï¼Œè¿™å°±æ˜¯å †æ ˆæœºçš„é­…åŠ›ï¼ˆå™©æ¢¦ï¼‰ã€‚</p>
<h3 data-id="heading-16">4. ç»„è£…æµæ°´çº¿ï¼šClassVisitor ä¸ Factory</h3>
<p>æœ‰äº†å¤„ç†æ–¹æ³•çš„ <code>MethodVisitor</code>ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªâ€œå¯¼æ¸¸â€ <code>ClassVisitor</code> æ¥æŠŠå„ä¸ªæ–¹æ³•é¢†ç»™å®ƒï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build-logic/plugin/timing/src/main/kotlin/com/example/asm/timing/TimingClassVisitor.kt</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TimingClassVisitor</span>(  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiVersion: <span class="hljs-built_in">Int</span>,  
    nextClassVisitor: ClassVisitor,  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> className: String,  
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> logTag: String,  
) : ClassVisitor(apiVersion, nextClassVisitor) {  
  
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visitMethod</span><span class="hljs-params">(  
      access: <span class="hljs-type">Int</span>,  
      name: <span class="hljs-type">String</span>?,  
      descriptor: <span class="hljs-type">String</span>?,  
      signature: <span class="hljs-type">String</span>?,  
      exceptions: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">out</span> <span class="hljs-type">String</span>&gt;?,  
  )</span></span>: MethodVisitor {  
    <span class="hljs-comment">// å…ˆè·å–åŸå§‹çš„ MethodVisitor    </span>
    <span class="hljs-keyword">val</span> originalMethodVisitor = <span class="hljs-keyword">super</span>.visitMethod(access, name, descriptor, signature, exceptions)
    <span class="hljs-comment">// ç”¨æˆ‘ä»¬çš„ TimingMethodVisitor åŒ…è£¹åŸå§‹çš„ MethodVisitor</span>
    <span class="hljs-comment">// è¿™æ ·ï¼Œå½“ ASM éå†æŒ‡ä»¤æ—¶ï¼Œä¼šå…ˆç»è¿‡æˆ‘ä»¬çš„ MethodVisitorï¼Œå†ä¼ ç»™åŸå§‹çš„ MethodVisitor</span>
    <span class="hljs-keyword">return</span> TimingMethodVisitor(  
        apiVersion,  
        originalMethodVisitor,  
        access,  
        name,  
        descriptor,  
        className,  
        logTag,  
    )  
  }  
}
</code></pre>
<p>å°±å¥½æ¯”æˆ‘ä»¬ä¸èƒ½ç›´æ¥å®ä¾‹åŒ– ViewModelï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ç›´æ¥åˆ›å»º ClassVisitorï¼Œå¿…é¡»é€šè¿‡ä¸€ä¸ª Factory å·¥å‚ç±»æ¥åˆ›å»º ClassVisitorã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build-logic/plugin/timing/src/main/kotlin/com/example/asm/timing/TimingClassVisitorFactory.kt</span>

<span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimingClassVisitorFactory</span> :  
    <span class="hljs-type">AsmClassVisitorFactory</span>&lt;<span class="hljs-type">TimingClassVisitorFactory.Parameters</span>&gt; {
    <span class="hljs-comment">// æ³›å‹ç”¨äºæŒ‡å®šè¿™ä¸ªå·¥å‚ç±»å¯ä»¥æ¥å—çš„å‚æ•°ç±»å‹</span>
    <span class="hljs-comment">// å¦‚æœä¸éœ€è¦æ¥å—å‚æ•°ï¼Œå¯ä»¥è®¾ç½®ä¸º InstrumentationParameters.None</span>
  
  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Parameters</span> : <span class="hljs-type">InstrumentationParameters</span> {  
    <span class="hljs-meta">@get:Input</span> 
    <span class="hljs-keyword">val</span> logTag: Property&lt;String&gt;  
  }  
  
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createClassVisitor</span><span class="hljs-params">(  
      classContext: <span class="hljs-type">ClassContext</span>,  
      nextClassVisitor: <span class="hljs-type">ClassVisitor</span>,  
  )</span></span>: ClassVisitor {
    <span class="hljs-comment">// è·å–å¤–éƒ¨ä¼ è¿›æ¥çš„ tag</span>
    <span class="hljs-keyword">val</span> tag: String = parameters.<span class="hljs-keyword">get</span>().logTag.getOrElse(<span class="hljs-string">"Timing"</span>)
  
    <span class="hljs-keyword">return</span> TimingClassVisitor(  
        apiVersion = instrumentationContext.apiVersion.<span class="hljs-keyword">get</span>(),  
        nextClassVisitor = nextClassVisitor,  
        className = classContext.currentClassData.className,  
        logTag = tag, 
    )  
  }  
  
  <span class="hljs-comment">// è¿‡æ»¤é€»è¾‘ï¼šåœ¨è¿™ä¸ªæ–¹æ³•é‡Œå†³å®šå“ªäº›ç±»éœ€è¦è¢«â€œæ’æ¡©â€ </span>
  <span class="hljs-comment">// ä¸ºäº†æ€§èƒ½ï¼Œè¿™é‡Œåªæ‰«æ com.example.aop åŒ…ä¸‹çš„ç±»</span>
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isInstrumentable</span><span class="hljs-params">(classData: <span class="hljs-type">ClassData</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {  
    <span class="hljs-keyword">return</span> classData.className.startsWith(<span class="hljs-string">"com.example.aop"</span>)  
  }  
}
</code></pre>
<pre><code class="hljs language-diff" lang="diff">.
  â”œâ”€â”€ app/                           &lt;-- app æ¨¡å—ç›®å½•
  â”œâ”€â”€ gradle/
  â”œâ”€â”€ build-logic/                   &lt;-- å¤åˆæ„å»ºçš„æ ¹ç›®å½•
  â”‚   â”œâ”€â”€ settings.gradle.kts        &lt;-- ç®¡ç† build-logic å†…éƒ¨çš„æ¨¡å—
  â”‚   â””â”€â”€ plugin/
  â”‚       â””â”€â”€ timing/                &lt;-- æ’ä»¶æ¨¡å—ç›®å½•
  â”‚           â”œâ”€â”€â”€ build.gradle.kts  &lt;-- æ’ä»¶çš„æ„å»ºè„šæœ¬
  â”‚           â””â”€â”€ src/ 
  â”‚               â””â”€â”€ main/kotlin/com/example/asm/timing/ 
<span class="hljs-addition">+ â”‚                   â”œâ”€â”€ TimingClassVisitorFactory.kt</span>
<span class="hljs-addition">+ â”‚                   â”œâ”€â”€ TimingClassVisitor.kt</span>
  â”‚                   â””â”€â”€ TimingMethodVisitor.kt
  â”œâ”€â”€ build.gradle.kts               &lt;-- æ ¹é¡¹ç›®çš„æ„å»ºè„šæœ¬
  â””â”€â”€ settings.gradle.kts            &lt;-- æ ¹é¡¹ç›®çš„è®¾ç½®è„šæœ¬
</code></pre>
<h3 data-id="heading-17">5. æ’ä»¶å…¥å£</h3>
<p>æœ€åä¸€æ­¥ï¼Œç¼–å†™ Gradle æ’ä»¶å…¥å£ç±» <code>TimingPlugin</code>ï¼ŒæŠŠæ‰€æœ‰ä¸œè¥¿ä¸²èµ·æ¥ï¼Œå¹¶æŒ‚è½½åˆ° Android çš„æ„å»ºæµç¨‹ä¸­ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">.
  â”œâ”€â”€ app/                           &lt;-- app æ¨¡å—ç›®å½•
  â”œâ”€â”€ gradle/
  â”œâ”€â”€ build-logic/                   &lt;-- å¤åˆæ„å»ºçš„æ ¹ç›®å½•
  â”‚   â”œâ”€â”€ settings.gradle.kts        &lt;-- ç®¡ç† build-logic å†…éƒ¨çš„æ¨¡å—
  â”‚   â””â”€â”€ plugin/
  â”‚       â””â”€â”€ timing/                &lt;-- æ’ä»¶æ¨¡å—ç›®å½•
  â”‚           â”œâ”€â”€â”€ build.gradle.kts  &lt;-- æ’ä»¶çš„æ„å»ºè„šæœ¬
  â”‚           â””â”€â”€ src/ 
  â”‚               â””â”€â”€ main/kotlin/com/example/asm/timing/ 
<span class="hljs-addition">+ â”‚                   â”œâ”€â”€ TimingPlugin.kt</span>
  â”‚                   â”œâ”€â”€ TimingClassVisitorFactory.kt
  â”‚                   â”œâ”€â”€ TimingClassVisitor.kt
  â”‚                   â””â”€â”€ TimingMethodVisitor.kt
  â”œâ”€â”€ build.gradle.kts               &lt;-- æ ¹é¡¹ç›®çš„æ„å»ºè„šæœ¬
  â””â”€â”€ settings.gradle.kts            &lt;-- æ ¹é¡¹ç›®çš„è®¾ç½®è„šæœ¬
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// build-logic/plugin/timing/src/main/kotlin/com/example/asm/timing/TimingPlugin.kt</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TimingPlugin</span> : <span class="hljs-type">Plugin</span>&lt;<span class="hljs-type">Project</span>&gt; {  
  
  <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Extension</span> {  
    <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">val</span> logTag: Property&lt;String&gt;
    
    <span class="hljs-keyword">init</span> {  
      logTag.convention(<span class="hljs-string">"Timing"</span>) <span class="hljs-comment">// é»˜è®¤çš„ LogTag</span>
    }
  }  
  
  <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">apply</span><span class="hljs-params">(project: <span class="hljs-type">Project</span>)</span></span> {  
    <span class="hljs-comment">// // å®šä¹‰ DSL æ‰©å±•ï¼šå…è®¸ç”¨æˆ·åœ¨ build.gradle ä¸­é…ç½® </span>
    <span class="hljs-comment">// timing { </span>
    <span class="hljs-comment">//   logTag = "xxx" </span>
    <span class="hljs-comment">// }</span>
    <span class="hljs-keyword">val</span> extension: TimingPlugin.Extension = 
        project.extensions.create(<span class="hljs-string">"timing"</span>, TimingPlugin.Extension::<span class="hljs-keyword">class</span>.java)
  
    <span class="hljs-comment">// è·å– Android ç»„ä»¶æ‰©å±•</span>
    <span class="hljs-keyword">val</span> androidComponents: AndroidComponentsExtension&lt;*, *, *&gt; = 
        project.extensions.getByType(AndroidComponentsExtension::<span class="hljs-keyword">class</span>.java)
    <span class="hljs-comment">// å¯¹æ‰€æœ‰çš„ Variant (Debug/Release...) è¿›è¡Œæ“ä½œ</span>
    androidComponents.onVariants { variant -&gt;  
      <span class="hljs-comment">// æ³¨å†Œ ASM è½¬æ¢</span>
      variant.instrumentation.transformClassesWith(
          TimingClassVisitorFactory::<span class="hljs-keyword">class</span>.java, <span class="hljs-comment">// æˆ‘ä»¬çš„ ClassVisitor å·¥å‚ç±»</span>
          InstrumentationScope.PROJECT, <span class="hljs-comment">// ä½œç”¨èŒƒå›´ï¼šæ•´ä¸ªé¡¹ç›®ï¼ˆä¸åŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰</span>
      ) { parameters: TimingClassVisitorFactory.Parameters -&gt;
          <span class="hljs-comment">// å°† DSL ä¸­çš„é…ç½®ä¼ ç»™ Factory</span>
          parameters.logTag.<span class="hljs-keyword">set</span>(extension.logTag)
      }
      
      <span class="hljs-comment">// é‡è¦ï¼šå› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å­—èŠ‚ç ï¼ˆå¢åŠ äº†å±€éƒ¨å˜é‡å’Œå †æ ˆæ“ä½œï¼‰ï¼Œ </span>
      <span class="hljs-comment">// éœ€è¦è®© AGP å¸®æˆ‘ä»¬é‡æ–°è®¡ç®—æ ˆå¸§ï¼ˆStackMapFramesï¼‰ï¼Œå¦åˆ™æ ¡éªŒ class æ–‡ä»¶ä¼šå¤±è´¥  </span>
      variant.instrumentation.setAsmFramesComputationMode(
          <span class="hljs-comment">// ä»…é‡æ–°è®¡ç®—è¢«"æ’æ¡©"äº†çš„æ–¹æ³•çš„æ ˆå¸§</span>
          FramesComputationMode.COMPUTE_FRAMES_FOR_INSTRUMENTED_METHODS 
      )
    }  
  }  
}
</code></pre>
<h3 data-id="heading-18">6. è§è¯å¥‡è¿¹</h3>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ° <code>:app</code> æ¨¡å—ï¼Œåº”ç”¨æˆ‘ä»¬åˆšåˆšå†™å¥½çš„æ’ä»¶ã€‚</p>
<pre><code class="hljs language-diff" lang="diff">// app/build.gradle.kts

plugins {  
   alias(libs.plugins.android.application)  
   alias(libs.plugins.kotlin.android)  
   alias(libs.plugins.kotlin.compose)  
<span class="hljs-addition">+  id("timing-plugin")  </span>
}

<span class="hljs-addition">+ timing {</span>
<span class="hljs-addition">+   logTag = "LogTime" </span>
<span class="hljs-addition">+ }</span>
</code></pre>
<p>Sync ä¸€ä¸‹ Gradleï¼Œç„¶åç‚¹å‡» Run è¿è¡Œ Appã€‚</p>
<p>å½“ App å¯åŠ¨æ—¶ï¼Œå¯ä»¥æŠŠ Logcat è¿‡æ»¤å™¨è®¾ä¸ºä½ è®¾ç½®çš„ tagã€‚ä½ ä¼šæƒŠå–œåœ°å‘ç°ï¼š</p>
<pre><code class="hljs language-text" lang="text">D/...: com.example.aop.MainActivity.doSomeHeavyWork execution time: 103 ms
</code></pre>
<p>å®ƒå·¥ä½œäº†ï¼æˆ‘ä»¬åœ¨æ²¡æœ‰ä¿®æ”¹ <code>doSomeHeavyWork()</code> æºç çš„æƒ…å†µä¸‹ï¼Œå‡­ç©ºè®©å®ƒæ‹¥æœ‰äº†è‡ªæˆ‘è®¡æ—¶çš„èƒ½åŠ›ã€‚è¿™å°±æ˜¯ ASM æ’æ¡©çš„é­”åŠ›ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬åœ¨ <code>MethodVisitor</code> é‡Œæ‰‹å†™æŒ‡ä»¤çš„è¿‡ç¨‹æœ‰ç‚¹åƒæ˜¯åœ¨ç”¨é•Šå­ç»£èŠ±ï¼Œä½†ä¸€æ—¦ä½ æŒæ¡äº†è¿™å¥—é€»è¾‘ï¼Œä½ å°±å¯ä»¥åšå¾ˆå¤šæ›´é«˜çº§çš„äº‹æƒ…ã€‚</p>
<p>ASM æ˜¯ä¸€æŠŠæ‰‹æœ¯åˆ€ï¼Œç”¨å¾—å¥½ï¼Œå®ƒæ˜¯ä¼˜åŒ–å’Œæ²»ç†ä»£ç çš„ç¥å™¨ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æˆä¸ºä½ å­—èŠ‚ç æ¢ç´¢ä¹‹æ—…çš„èµ·ç‚¹ï¼Œè€Œä¸æ˜¯ç»ˆç‚¹ã€‚</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbqliang%2FAsmExample" target="_blank" title="https://github.com/bqliang/AsmExample" ref="nofollow noopener noreferrer">æ–‡ç« å®Œæ•´ä»£ç </a></li>
</ul>
<h2 data-id="heading-19">å‚è€ƒé“¾æ¥</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fc6E5UlI1N%2Farticle%2Fdetails%2F131118310" target="_blank" title="https://blog.csdn.net/c6E5UlI1N/article/details/131118310" ref="nofollow noopener noreferrer">ASMä»å…¥é—¨åˆ°ç²¾é€š</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.unlogged.io%2Fpost%2Fclass-file-api-not-your-everyday-java-api" target="_blank" title="https://www.unlogged.io/post/class-file-api-not-your-everyday-java-api" ref="nofollow noopener noreferrer">Class File API: Not Your Everyday Java API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fxie.infoq.cn%2Farticle%2F46ccb9380c6e876e84b204ecc" target="_blank" title="https://xie.infoq.cn/article/46ccb9380c6e876e84b204ecc" ref="nofollow noopener noreferrer">æ‰‹æŠŠæ‰‹å¸¦ä½ å®æˆ˜ AGP 7.x ASM å­—èŠ‚ç æ’æ¡©</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.jsçš„"è€ä¼™è®¡"ï¼šExpressæ¡†æ¶å…¥é—¨è®°]]></title>    <link>https://juejin.cn/post/7575651989985984566</link>    <guid>https://juejin.cn/post/7575651989985984566</guid>    <pubDate>2025-11-24T03:07:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575651989985984566" data-draft-id="7575937594350141483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.jsçš„&quot;è€ä¼™è®¡&quot;ï¼šExpressæ¡†æ¶å…¥é—¨è®°"/> <meta itemprop="keywords" content="å‰ç«¯,Node.js"/> <meta itemprop="datePublished" content="2025-11-24T03:07:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‡Œå·çºª"/> <meta itemprop="url" content="https://juejin.cn/user/3817120538318798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.jsçš„"è€ä¼™è®¡"ï¼šExpressæ¡†æ¶å…¥é—¨è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817120538318798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‡Œå·çºª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:07:15.000Z" title="Mon Nov 24 2025 03:07:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="darcula">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#bababa}.hljs-emphasis,.hljs-strong{color:#a8a8a2}.hljs-bullet,.hljs-link,.hljs-literal,.hljs-number,.hljs-quote,.hljs-regexp{color:#6896ba}.hljs-code,.hljs-selector-class{color:#a6e22e}.hljs-emphasis{font-style:italic}.hljs-attribute,.hljs-keyword,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-variable{color:#cb7832}.hljs-params{color:#b9b9b9}.hljs-string{color:#6a8759}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-selector-attr,.hljs-selector-id,.hljs-selector-pseudo,.hljs-subst,.hljs-symbol,.hljs-template-tag,.hljs-template-variable,.hljs-type{color:#e0c46c}.hljs-comment,.hljs-deletion,.hljs-meta{color:#7f7f7f}</style><p>è¿˜è®°å¾—æˆ‘ç¬¬ä¸€æ¬¡ç”¨Node.jså†™åç«¯æ—¶çš„çª˜å¢ƒï¼šæƒ³å¤„ç†ä¸€ä¸ªç®€å•çš„GETè¯·æ±‚ï¼Œç¿»äº†åŠå¤©æ–‡æ¡£æ‰å‡‘å‡ºå‡ åè¡Œä»£ç ï¼Œè¿˜å› ä¸ºæ²¡å¤„ç†å¥½è¯·æ±‚å¤´æŠ¥äº†ä¸€å †é”™ã€‚ç›´åˆ°å‰è¾ˆæ‰”ç»™æˆ‘ä¸€å¥"è¯•è¯•Express"ï¼Œæˆ‘æ‰å‘ç°åç«¯å¼€å‘åŸæ¥èƒ½è¿™ä¹ˆçœå¿ƒã€‚è¿™ä¸ªåœ¨Node.jsç”Ÿæ€é‡Œæ´»è·ƒäº†åå‡ å¹´çš„"è€ä¼™è®¡"ï¼Œè‡³ä»Šä»æ˜¯æ•°ç™¾ä¸‡å¼€å‘è€…çš„å…¥é—¨é¦–é€‰â€”â€”ä¸æ˜¯å› ä¸ºå®ƒå¤šæ–°æ½®ï¼Œè€Œæ˜¯å› ä¸ºå®ƒæŠŠå¤æ‚çš„Webå¼€å‘é€»è¾‘ï¼Œæ¢³ç†å¾—åƒå¥¶èŒ¶é‡Œçš„çç ä¸€æ ·æ¸…æ™°ã€‚</p>
<h2 data-id="heading-0">å…ˆææ‡‚ï¼šExpressåˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>å¦‚æœæŠŠNode.jsæ¯”ä½œä¸€è¾†èƒ½è·‘çš„æ±½è½¦ï¼Œé‚£Expresså°±æ˜¯ä¸€å¥—ç°æˆçš„æ“æ§ç³»ç»Ÿã€‚å®ƒæ˜¯åŸºäºNode.jsçš„è½»é‡çº§Webæ¡†æ¶ï¼Œæ²¡æœ‰ç»™æ±½è½¦æ¢å¼•æ“ï¼Œåªæ˜¯æŠŠæ–¹å‘ç›˜ã€æ²¹é—¨ã€åˆ¹è½¦éƒ½è®¾è®¡å¾—é¡ºæ‰‹åˆå¥½æ‡‚ã€‚ä½ ä¸ç”¨å†ä»é›¶æ­å»ºHTTPæœåŠ¡å™¨ï¼Œä¸ç”¨æ‰‹åŠ¨è§£æè¯·æ±‚å‚æ•°ï¼Œè¿™äº›é‡å¤åˆç¹ççš„å·¥ä½œï¼ŒExpresséƒ½å¸®ä½ å°è£…æˆäº†ç®€å•çš„APIã€‚</p>
<p>æœ‰äººè¯´å®ƒæ˜¯"Node.jsçš„äº‹å®æ ‡å‡†æ¡†æ¶"ï¼Œè¿™è¯ä¸€ç‚¹ä¸å¤¸å¼ ã€‚GitHubä¸Š43k+çš„æ˜Ÿæ ‡ï¼Œæ¯å‘¨è¶…1000ä¸‡æ¬¡çš„npmä¸‹è½½é‡ï¼Œè¿˜æœ‰StackOverflowä¸Šç™¾ä¸‡æ¡ç›¸å…³é—®é¢˜ï¼Œéƒ½è¯æ˜äº†å®ƒçš„åœ°ä½ã€‚å°±åƒPostmançš„æ—©æœŸåŸå‹ã€å¾ˆå¤šå°ç¨‹åºçš„åç«¯æ¥å£ï¼Œéƒ½æ˜¯ç”¨å®ƒæ­èµ·æ¥çš„ã€‚å®ƒå°±åƒç¼–ç¨‹ç•Œçš„"ç™½è¡¬è¡«"ï¼Œçœ‹ä¼¼æ™®é€šå´ç™¾æ­å®ç”¨ï¼Œä¸ç®¡æ˜¯å°demoè¿˜æ˜¯ä¸­å‹ç³»ç»Ÿéƒ½èƒ½holdä½ã€‚</p>
<p>ä½†å®ƒä¹Ÿä¸æ˜¯å®Œç¾çš„â€”â€”ç‰ˆæœ¬æ›´æ–°æ…¢ï¼Œv4ä»2014å¹´ç”¨åˆ°ç°åœ¨ï¼Œv5çš„æ­£å¼ç‰ˆè¿Ÿè¿Ÿä¸è§è¸ªå½±ï¼›é¢å¯¹Fastifyè¿™äº›åèµ·ä¹‹ç§€ï¼Œæ€§èƒ½ä¹Ÿæ˜¾å¾—æœ‰äº›åƒåŠ›ã€‚å¯å°±åƒè€æ‰‹è‰ºä¸€æ ·ï¼Œå®ƒçš„ç¨³å®šã€èµ„æ–™å¤šã€å…¥é—¨é—¨æ§›ä½ï¼Œä»æ˜¯æ–°æ‰‹ç»•ä¸å¼€çš„é€‰æ‹©ã€‚</p>
<h2 data-id="heading-1">ä¸Šæ‰‹å®æ“ï¼šä»"Hello World"å¼€å§‹</h2>
<p>åˆ«è¢«"æ¡†æ¶"ä¸¤ä¸ªå­—å“åˆ°ï¼Œç”¨Expresså†™ç¬¬ä¸€ä¸ªç¨‹åºï¼Œæ¯”æ³¡ä¸€æ¯é€Ÿæº¶å’–å•¡è¿˜ç®€å•ã€‚å‰ææ˜¯ä½ å·²ç»è£…å¥½äº†Node.jsï¼Œæ¥ä¸‹æ¥è·Ÿç€æ­¥éª¤èµ°ï¼Œ5åˆ†é’Ÿå°±èƒ½çœ‹åˆ°æˆæœã€‚</p>
<h3 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šæ­å»ºé¡¹ç›®ç¯å¢ƒ</h3>
<p>å…ˆåœ¨ç”µè„‘ä¸Šå»ºä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚å«"my-first-express"ï¼Œç„¶åæ‰“å¼€ç»ˆç«¯è¿›å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚ä¾æ¬¡è¾“å…¥ä¸‹é¢ä¸¤æ¡å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">npm <span class="hljs-keyword">init</span> -y  <span class="hljs-meta"># åˆå§‹åŒ–é¡¹ç›®ï¼Œç”Ÿæˆpackage.jsonæ–‡ä»¶</span>
npm install express  <span class="hljs-meta"># å®‰è£…Expressæ¡†æ¶</span>
</code></pre>
<p>ç¬¬ä¸€æ¡å‘½ä»¤ä¼šå¸®ä½ åˆ›å»ºé¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œ"-y"è¡¨ç¤ºå…¨éƒ¨ç”¨é»˜è®¤è®¾ç½®ï¼Œä¸ç”¨æŒ¨ä¸ªç¡®è®¤ï¼›ç¬¬äºŒæ¡å‘½ä»¤åˆ™æ˜¯æŠŠExpressä¸‹è½½åˆ°é¡¹ç›®é‡Œï¼Œå°±åƒç»™æ‰‹æœºè£…APPä¸€æ ·ã€‚</p>
<h3 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šå†™æ ¸å¿ƒä»£ç </h3>
<p>åœ¨æ–‡ä»¶å¤¹é‡Œæ–°å»ºä¸€ä¸ªå«"app.js"çš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„æ ¸å¿ƒä»£ç æ–‡ä»¶ã€‚æŠŠä¸‹é¢è¿™æ®µä»£ç å¤åˆ¶è¿›å»ï¼Œæˆ‘ä¼šé€è¡Œç»™ä½ è§£é‡Šï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. æŠŠExpressæ¡†æ¶"è¯·"è¿›æ¥</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-comment">// 2. åˆ›å»ºä¸€ä¸ªExpressåº”ç”¨å®ä¾‹ï¼Œå°±åƒæ‰“å¼€äº†ä¸€ä¸ªæœåŠ¡çª—å£</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()
<span class="hljs-comment">// 3. å®šä¹‰æœåŠ¡å™¨è¦ç›‘å¬çš„ç«¯å£ï¼Œ3000æ˜¯å¼€å‘å¸¸ç”¨ç«¯å£</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">3000</span>

<span class="hljs-comment">// 4. å®šä¹‰è·¯ç”±ï¼šå½“æœ‰äººè®¿é—®æ ¹è·¯å¾„"/"æ—¶ï¼Œè¿”å›"Hello World!"</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Hello World! è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªExpressåº”ç”¨'</span>)
})

<span class="hljs-comment">// 5. å¯åŠ¨æœåŠ¡å™¨ï¼Œå¼€å§‹ç›‘å¬3000ç«¯å£</span>
app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨è·‘èµ·æ¥å•¦ï¼è®¿é—®åœ°å€ï¼šhttp://localhost:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<p>è¿™é‡Œçš„å…³é”®æ˜¯"è·¯ç”±"â€”â€”å®ƒå°±åƒé¤å…é‡Œçš„ç‚¹é¤ç³»ç»Ÿï¼Œå®¢äººç‚¹äº†é±¼é¦™è‚‰ä¸ï¼ˆè®¿é—®"/"è·¯å¾„ï¼‰ï¼Œå¨æˆ¿å°±æŒ‰èœå•åšå¯¹åº”çš„èœï¼ˆè¿”å›æŒ‡å®šå†…å®¹ï¼‰ã€‚reqæ˜¯å®¢äººçš„éœ€æ±‚ï¼ˆè¯·æ±‚ä¿¡æ¯ï¼‰ï¼Œresæ˜¯å¨æˆ¿çš„å›åº”ï¼ˆå“åº”å†…å®¹ï¼‰ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå¯¹è±¡å°±èƒ½å®Œæˆå‰åç«¯çš„å¯¹è¯ã€‚</p>
<h3 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡ï¼Œè§è¯æˆæœ</h3>
<p>åœ¨ç»ˆç«¯è¾“å…¥è¿™æ¡å‘½ä»¤ï¼š</p>
<pre><code class="hljs">node app.js
</code></pre>
<p>å¦‚æœçœ‹åˆ°"æœåŠ¡å™¨è·‘èµ·æ¥å•¦ï¼"çš„æç¤ºï¼Œå°±è¯´æ˜æˆåŠŸäº†ã€‚ç°åœ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥"<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a>" ï¼Œé¡µé¢ä¸Šä¼šæ¸…æ™°åœ°æ˜¾ç¤ºæˆ‘ä»¬å†™çš„é‚£å¥è¯ã€‚æ˜¯ä¸æ˜¯æ¯”ç›´æ¥ç”¨Node.jsåŸç”Ÿä»£ç ç®€å•å¤ªå¤šï¼Ÿ</p>
<p>å¯¹äº†ï¼Œè¦æ˜¯æƒ³æ”¹å“åº”å†…å®¹ï¼Œç›´æ¥ä¿®æ”¹res.send()é‡Œçš„å­—ç¬¦ä¸²å°±è¡Œï¼›æƒ³åœæ­¢æœåŠ¡ï¼Œåœ¨ç»ˆç«¯æŒ‰Ctrl+Cå°±å¥½ã€‚</p>
<h2 data-id="heading-5">æ ¸å¿ƒæŠ€èƒ½ï¼šææ‡‚è·¯ç”±å’Œä¸­é—´ä»¶</h2>
<p>å­¦ä¼šHello Worldåªæ˜¯åˆšè¿›é—¨ï¼ŒExpressçš„çµé­‚å…¶å®æ˜¯è·¯ç”±å’Œä¸­é—´ä»¶ã€‚æŒæ¡è¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œä½ å°±èƒ½æ­å»ºçœŸæ­£èƒ½ç”¨çš„åç«¯æœåŠ¡äº†ã€‚</p>
<h3 data-id="heading-6">1. è·¯ç”±ï¼šç»™ä¸åŒè¯·æ±‚åˆ†å¥½å·¥</h3>
<p>å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªæ ¹è·¯å¾„ã€‚æ¯”å¦‚åšä¸€ä¸ªåšå®¢ï¼Œéœ€è¦æœ‰æ–‡ç« åˆ—è¡¨ã€æ–‡ç« è¯¦æƒ…ã€æäº¤è¯„è®ºç­‰åŠŸèƒ½ï¼Œè¿™å°±éœ€è¦å®šä¹‰å¤šä¸ªè·¯ç”±ã€‚</p>
<p>åœ¨app.jsé‡Œç»§ç»­æ·»åŠ è¿™äº›ä»£ç ï¼Œå°±èƒ½å®ç°ä¸åŒè·¯å¾„çš„è®¿é—®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ–‡ç« åˆ—è¡¨é¡µé¢ï¼ŒGETè¯·æ±‚</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/articles'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'è¿™æ˜¯æ–‡ç« åˆ—è¡¨ï¼Œæœ‰10ç¯‡æ–‡ç« '</span>)
})

<span class="hljs-comment">// å•ç¯‡æ–‡ç« è¯¦æƒ…ï¼Œè·¯å¾„é‡Œçš„:idæ˜¯åŠ¨æ€å‚æ•°</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/articles/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// é€šè¿‡req.paramsè·å–åŠ¨æ€å‚æ•°</span>
  <span class="hljs-keyword">const</span> articleId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`è¿™æ˜¯ç¬¬<span class="hljs-subst">${articleId}</span>ç¯‡æ–‡ç« çš„è¯¦æƒ…`</span>)
})

<span class="hljs-comment">// æäº¤è¯„è®ºï¼ŒPOSTè¯·æ±‚</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/comments'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'è¯„è®ºæäº¤æˆåŠŸï¼'</span>)
})
</code></pre>
<p>ç°åœ¨è®¿é—®"<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000%2Farticles%2F5" target="_blank" title="http://localhost:3000/articles/5" ref="nofollow noopener noreferrer">http://localhost:3000/articles/5</a>" ï¼Œä¼šæ˜¾ç¤º"è¿™æ˜¯ç¬¬5ç¯‡æ–‡ç« çš„è¯¦æƒ…"ï¼›è®¿é—®"/articles"ä¼šæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œè·¯ç”±åŒ¹é…æ˜¯æŒ‰é¡ºåºæ¥çš„ï¼Œè¦æ˜¯æŠŠåŠ¨æ€è·¯ç”±å†™åœ¨å›ºå®šè·¯ç”±å‰é¢ï¼Œå¯èƒ½ä¼šå‡ºç°åŒ¹é…é”™è¯¯ï¼Œè¿™ç‚¹ä¸€å®šè¦è®°ç‰¢ã€‚</p>
<p>å¦‚æœè·¯ç”±å¤ªå¤šï¼Œéƒ½å †åœ¨app.jsé‡Œä¼šå¾ˆä¹±ã€‚è¿™æ—¶å€™å¯ä»¥ç”¨express.Router()åšæ¨¡å—åŒ–æ‹†åˆ†ï¼ŒæŠŠè·¯ç”±å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå°±åƒæŠŠä¸åŒç§‘ç›®ç¬”è®°åˆ†å¼€è®°ä¸€æ ·ï¼Œæ¸…æ™°åˆå¥½ç»´æŠ¤ã€‚</p>
<h3 data-id="heading-7">2. ä¸­é—´ä»¶ï¼šè¯·æ±‚çš„"ä¸­è½¬ç«™"</h3>
<p>ä¸­é—´ä»¶æ˜¯Expressæœ€ç²¾å¦™çš„è®¾è®¡ï¼Œæˆ‘æ›´æ„¿æ„å«å®ƒ"è¯·æ±‚çš„åŠ å·¥å‚"ã€‚æ¯”å¦‚æ±¡æ°´å¤„ç†éœ€è¦è¿‡æ»¤ã€æ²‰æ·€ã€æ¶ˆæ¯’ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸­é—´ä»¶å°±æ˜¯å¤„ç†è¯·æ±‚çš„è¿™äº›æ­¥éª¤â€”â€”åœ¨è¯·æ±‚åˆ°è¾¾æœ€ç»ˆè·¯ç”±å‰ï¼Œå…ˆåšä¸€äº›é¢„å¤„ç†ï¼Œæ¯”å¦‚éªŒè¯ç™»å½•ã€è®°å½•æ—¥å¿—ã€è§£æå‚æ•°ç­‰ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬åšä¸€ä¸ªæ—¥å¿—ä¸­é—´ä»¶ï¼Œè®°å½•æ¯æ¬¡è¯·æ±‚çš„æ—¶é—´å’Œè·¯å¾„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰æ—¥å¿—ä¸­é—´ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">logger</span> = (<span class="hljs-params">req, res, next</span>) =&gt; {
  <span class="hljs-keyword">const</span> time = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleString</span>()
  <span class="hljs-keyword">const</span> path = req.<span class="hljs-property">path</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${time}</span>] æœ‰äººè®¿é—®äº†ï¼š<span class="hljs-subst">${path}</span>`</span>)
  <span class="hljs-comment">// å¿…é¡»è°ƒç”¨next()ï¼Œå¦åˆ™è¯·æ±‚ä¼šå¡åœ¨ä¸­é—´ä»¶é‡Œ</span>
  <span class="hljs-title function_">next</span>()
}

<span class="hljs-comment">// æ³¨å†Œå…¨å±€ä¸­é—´ä»¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šç»è¿‡å®ƒ</span>
app.<span class="hljs-title function_">use</span>(logger)
</code></pre>
<p>æŠŠè¿™æ®µä»£ç æ”¾åœ¨è·¯ç”±å®šä¹‰ä¹‹å‰ï¼Œå†å¯åŠ¨æœåŠ¡è®¿é—®ä»»æ„è·¯å¾„ï¼Œç»ˆç«¯å°±ä¼šæ˜¾ç¤ºè®¿é—®æ—¶é—´å’Œè·¯å¾„ã€‚è¿™é‡Œçš„next()ç‰¹åˆ«é‡è¦ï¼Œå°±åƒæ¥åŠ›èµ›çš„äº¤æ¥æ£’ï¼ŒæŠŠè¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–è·¯ç”±ï¼Œè¦æ˜¯å¿˜äº†å†™ï¼Œè¯·æ±‚å°±ä¼š"è¿·è·¯"ã€‚</p>
<p>ä¸­é—´ä»¶è¿˜èƒ½åšå¾ˆå¤šäº‹ï¼Œæ¯”å¦‚èº«ä»½éªŒè¯â€”â€”åªæœ‰ç™»å½•çš„ç”¨æˆ·æ‰èƒ½è®¿é—®æŸäº›è·¯ç”±ã€‚ä¸è¿‡è¿™é‡Œæœ‰ä¸ªå‘ï¼šè¦æ˜¯æŠŠä¸­é—´ä»¶æŒ‚è½½åœ¨æ ¹è·¯å¾„"/"ï¼Œå®ƒä¼šä½œç”¨äºæ‰€æœ‰è¯·æ±‚ï¼Œå¯èƒ½å¯¼è‡´è®¿é—®é¦–é¡µéƒ½éœ€è¦ç™»å½•ã€‚è§£å†³åŠæ³•æ˜¯ç»™è·¯ç”±åˆ†ä¸ªä¸“å±è·¯å¾„ï¼Œæ¯”å¦‚æŠŠéœ€è¦éªŒè¯çš„è·¯ç”±éƒ½æ”¾åœ¨"/admin"ä¸‹é¢ï¼Œåªç»™è¿™ä¸ªè·¯å¾„æŒ‚è½½éªŒè¯ä¸­é—´ä»¶ã€‚</p>
<h2 data-id="heading-8">æœ€åï¼šExpressçš„å­¦ä¹ è·¯å¾„</h2>
<p>å¦‚æœä½ åˆšå…¥é—¨ï¼Œä¸ç”¨æ€¥ç€è¿½æ±‚å¤æ‚åŠŸèƒ½ï¼ŒæŒ‰è¿™ä¸ªæ­¥éª¤å­¦å°±å¥½ï¼š</p>
<ol>
<li>å…ˆæŒæ¡åŸºç¡€è·¯ç”±ï¼ˆGET/POSTï¼‰å’Œresçš„å¸¸ç”¨æ–¹æ³•ï¼ˆsend/json/renderï¼‰ï¼›</li>
<li>å­¦ä¹ ä¸­é—´ä»¶çš„ä½¿ç”¨ï¼Œæ¯”å¦‚è§£æJSONè¯·æ±‚ä½“çš„express.json()ã€å¤„ç†é™æ€æ–‡ä»¶çš„express.static()ï¼›</li>
<li>å°è¯•è·¯ç”±æ¨¡å—åŒ–ï¼ŒæŠŠä»£ç æ‹†åˆ†æˆä¸åŒæ–‡ä»¶ï¼›</li>
<li>ç»“åˆæ•°æ®åº“ï¼ˆæ¯”å¦‚MongoDBï¼‰ï¼Œå®ç°æ•°æ®çš„å¢åˆ æ”¹æŸ¥ï¼›</li>
<li>æœ€åå­¦ä¹ é”™è¯¯å¤„ç†ï¼Œè®©ä½ çš„æœåŠ¡æ›´å¥å£®ã€‚</li>
</ol>
<p>Expresså°±åƒä¸€ä½è¯ä¸å¤šä½†ç»éªŒä¸°å¯Œçš„è€å¸ˆå‚…ï¼Œå®ƒä¸ä¼šå¼ºè¿«ä½ ç”¨æŸç§å›ºå®šæ¨¡å¼ï¼Œè€Œæ˜¯ç»™ä½ è¶³å¤Ÿçš„è‡ªç”±å»å‘æŒ¥ã€‚è™½ç„¶ç°åœ¨æœ‰Fastifyã€Koaè¿™äº›æ›´ç°ä»£çš„æ¡†æ¶ï¼Œä½†æŠŠExpresså­¦æ‰å®ï¼Œå°±åƒæ‰“å¥½ç¼–ç¨‹çš„åœ°åŸºï¼Œä»¥åå†å­¦å…¶ä»–æ¡†æ¶ä¼šè½»æ¾å¾ˆå¤šã€‚</p>
<p>åˆ«å†çŠ¹è±«äº†ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œæ•²ä¸‹é‚£è¡Œnpm install expressï¼Œå¼€å¯ä½ çš„åç«¯å¼€å‘ä¹‹æ—…å§ã€‚æ¯•ç«Ÿï¼Œæœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼Œå°±æ˜¯åŠ¨æ‰‹å»åšã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3+ts å°è£…ä¸€ä¸ªé€šç”¨æµç¨‹å¤ç”¨å·¥å…·å‡½æ•°]]></title>    <link>https://juejin.cn/post/7575458028255166507</link>    <guid>https://juejin.cn/post/7575458028255166507</guid>    <pubDate>2025-11-23T16:01:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575458028255166507" data-draft-id="7565324922907852835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3+ts å°è£…ä¸€ä¸ªé€šç”¨æµç¨‹å¤ç”¨å·¥å…·å‡½æ•°"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,è®¾è®¡"/> <meta itemprop="datePublished" content="2025-11-23T16:01:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="inCBle"/> <meta itemprop="url" content="https://juejin.cn/user/2313807346271560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3+ts å°è£…ä¸€ä¸ªé€šç”¨æµç¨‹å¤ç”¨å·¥å…·å‡½æ•°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313807346271560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    inCBle
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:01:50.000Z" title="Sun Nov 23 2025 16:01:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">ä¸šåŠ¡èƒŒæ™¯</h2>
<blockquote>
<p>æˆ‘ä»¬åšåå°ç®¡ç†ç³»ç»Ÿçš„æ—¶å€™ï¼Œé€šå¸¸ä¼šæœ‰å¾ˆå¤šé‡å¤çš„é¡µé¢é€»è¾‘ï¼Œé‡å¤çš„æ§åˆ¶æµç¨‹éœ€è¦åšï¼Œæœ€å¸¸è§çš„ä¾‹å­åº”è¯¥ä¾¿æ˜¯ç¡®è®¤åˆ é™¤ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a52011b19e047c3bef660b4437a07e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5DQmxl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518510&amp;x-signature=V%2BNGGDuV9YSwzCLdnah4vmwkS7g%3D" alt="eIMScreenShot20251106150026855.jpg" loading="lazy"/></p>
<h3 data-id="heading-1">åŸºæœ¬ä½¿ç”¨</h3>
<p>ä»¥ <code>element-plus</code> ä¸¾ä¾‹ï¼Œå¤§å®¶é€šå¸¸éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDelete</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">"ç¡®å®šè¦åˆ é™¤è¿™æ¡æ•°æ®å—?"</span>, <span class="hljs-string">"æç¤º"</span>, {
      <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">"ç¡®å®š"</span>,
      <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">"å–æ¶ˆ"</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">"warning"</span>,
    });

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"è¯·æ±‚å‚æ•°ï¼š"</span>, id);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">api</span>();
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"åˆ é™¤æˆåŠŸ"</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
  }
};

</code></pre>
<h3 data-id="heading-2">é‡å¤å†—ä½™ä»£ç </h3>
<p>è¿™ç§æ–¹å¼ä¹ä¸€çœ‹æ²¡å•¥é—®é¢˜ï¼Œä½†åœ¨å®é™…ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå¹¶ä¸æ˜¯åªæœ‰ä¸€ä¸ªåˆ é™¤çš„ä¸šåŠ¡æµç¨‹ã€‚ä¹Ÿè®¸è¿˜ä¼šå­˜åœ¨ <strong>æ”¯ä»˜</strong>ã€<strong>å‘å¸ƒ</strong>ã€<strong>ä¿®æ”¹çŠ¶æ€</strong> ç­‰ç­‰æµç¨‹ç¡®è®¤æ“ä½œã€‚æ­¤æ—¶æˆ‘ä»¬çš„ä»£ç ä¹Ÿè®¸å°±ä¼šæ¼”å˜æˆ</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDelete</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">"ç¡®å®šè¦åˆ é™¤è¿™æ¡æ•°æ®å—ï¼Ÿ"</span>, <span class="hljs-string">"æç¤º"</span>, {
      <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">"ç¡®å®š"</span>,
      <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">"å–æ¶ˆ"</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">"warning"</span>,
    });
    
    <span class="hljs-comment">// åˆ é™¤ä¸­...</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePayment</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">"æ˜¯å¦ç¡®è®¤æ”¯ä»˜å½“å‰è®¢å•ï¼Ÿ"</span>, <span class="hljs-string">"æç¤º"</span>, {
      <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">"ç¡®å®š"</span>,
      <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">"å–æ¶ˆ"</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">"warning"</span>,
    });
    
    <span class="hljs-comment">// æ”¯ä»˜ä¸­...</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUpdateStatus</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(<span class="hljs-string">"æ˜¯å¦ç¡®è®¤ä¿®æ”¹å½“å‰æ•°æ®çŠ¶æ€ï¼Ÿ"</span>, <span class="hljs-string">"æç¤º"</span>, {
      <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">"ç¡®å®š"</span>,
      <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">"å–æ¶ˆ"</span>,
      <span class="hljs-attr">type</span>: <span class="hljs-string">"warning"</span>,
    });
    
    <span class="hljs-comment">// ä¿®æ”¹çŠ¶æ€...</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
  }
};

</code></pre>
<h3 data-id="heading-3">createConfirmFlow å‡½æ•°å°è£…</h3>
<p>å†™åˆ°è¿™é‡Œå¤§å®¶å°±ä¼šå‘ç°ï¼Œæ•´ä¸ªé¡¹ç›®ä¸­ä¼šæœ‰å¤§é‡ç±»ä¼¼è¿™ç§ç»“æ„çš„é‡å¤ä»£ç ï¼Œèªæ˜çš„å°ä¼™ä¼´å·²ç»å¼€å§‹å¯¹è¿™æ®µä»£ç è¿›è¡Œæå–å°è£…ä¼˜åŒ–äº†ã€‚äºæ˜¯ä¼šå¾—åˆ°ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessageBox</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">ElMessageBoxOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-plus"</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">CallBack</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; | <span class="hljs-built_in">void</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">createConfirmFlow</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">
  callback: CallBack,
  options?: ElMessageBoxOptions
</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">CallBack</span>&gt;) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(options.<span class="hljs-property">message</span>, options);
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">callback</span>(...args);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    }
  };
};

</code></pre>
<blockquote>
<p>æ­¤æ—¶ä½¿ç”¨ <strong>createConfirmFlow</strong> æ¥åˆ›å»ºæµç¨‹å¤„ç†å‡½æ•°å°±ä¼šå˜å¾—æ— æ¯”ç®€æ´</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ›å»ºåˆ é™¤æµç¨‹</span>
<span class="hljs-keyword">const</span> handleDelete = <span class="hljs-title function_">createConfirmFlow</span>(
  <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// æ‰§è¡Œä¿®æ”¹çŠ¶æ€çš„é€»è¾‘...</span>
  },
  { <span class="hljs-attr">message</span>: <span class="hljs-string">"ç¡®å®šè¦åˆ é™¤è¿™æ¡æ•°æ®å—ï¼Ÿ"</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">"æç¤º"</span> }
);

<span class="hljs-comment">// åˆ›å»ºæ”¯ä»˜æµç¨‹</span>
<span class="hljs-keyword">const</span> handlePayment = <span class="hljs-title function_">createConfirmFlow</span>(
  <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// æ‰§è¡Œä¿®æ”¹çŠ¶æ€çš„é€»è¾‘...</span>
  },
  { <span class="hljs-attr">message</span>: <span class="hljs-string">"æ˜¯å¦ç¡®è®¤æ”¯ä»˜å½“å‰è®¢å•ï¼Ÿ"</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">"æç¤º"</span> }
);

<span class="hljs-comment">// åˆ›å»ºæ›´æ–°çŠ¶æ€æµç¨‹</span>
<span class="hljs-keyword">const</span> handleUpdateStatus = <span class="hljs-title function_">createConfirmFlow</span>(
  <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-comment">// æ‰§è¡Œä¿®æ”¹çŠ¶æ€çš„é€»è¾‘...</span>
  },
  { <span class="hljs-attr">message</span>: <span class="hljs-string">"æ˜¯å¦ç¡®è®¤ä¿®æ”¹å½“å‰æ•°æ®çŠ¶æ€ï¼Ÿ"</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">"æç¤º"</span> }
);

</code></pre>
<h3 data-id="heading-4">ä¸šåŠ¡åœºæ™¯æ€è€ƒ</h3>
<p>åŸºæœ¬ä½¿ç”¨åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ã€‚ä½†æ˜¯åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä¹ æƒ¯å¯¹ä¸šåŠ¡éœ€æ±‚åšä¸€ä¸ªå¤§è‡´çš„æµç¨‹æ¢³ç†ï¼Œä»¥ä¾¿ä¼˜åŒ–è‡ªå·±çš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±çš„ä¸€äº›æƒ³æ³•ã€‚</p>
<h4 data-id="heading-5">æ”¯ä»˜å‰ç½®éªŒè¯</h4>
<p>æˆ‘æƒ³å¤§å¤šæ•°äººç¬¬ä¸€ååº”åº”è¯¥å°±æ˜¯åœ¨æµç¨‹å¤„ç†å‡½æ•°ä¸­æ”¯ä»˜æ¥å£è¯·æ±‚å‰éªŒè¯ä¸€æ¬¡å³å¯ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-keyword">const</span> handlePayment = <span class="hljs-title function_">createConfirmFlow</span>(
  <span class="hljs-keyword">async</span> (row) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å‘èµ·æ”¯ä»˜"</span>, row);

    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">validate</span>()) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥ï¼Œæ— æ³•æ”¯ä»˜"</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥"</span>);
    }

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">api</span>();
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸ"</span>);
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"æ”¯ä»˜æç¤º"</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`æ€»ä»·ä¸º ï¿¥188 æ˜¯å¦ç¡®è®¤æ”¯ä»˜ï¼Ÿ`</span>,
  }
);

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/807dc74267434dffb1584857af5834fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5DQmxl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518510&amp;x-signature=PsjFmGYuDOyl%2BN7ygei2AbfbkjQ%3D" alt="åŠ¨ç”».gif" loading="lazy"/></p>
<blockquote>
<p>æˆ‘ä»¬ä¼šå‘ç°è™½ç„¶éªŒè¯å‡½æ•°ç¡®å®æˆåŠŸæ‹¦æˆªäº†åç»­æ¥å£è¯·æ±‚çš„æ“ä½œï¼Œä½†æ˜¯ç¡®è®¤æ¡†å´å…³é—­äº†ã€‚æˆ‘è®¤ä¸ºè¿™æ ·çš„äº¤äº’æµç¨‹æ˜¯æ¯”è¾ƒæ„å¤–çš„ï¼Œæ—¢ç„¶æ˜¯å¤±è´¥çš„è¯æˆ‘æœŸæœ›çš„æ˜¯è¿™ä¸ªç¡®è®¤çª—å£èƒ½ä¿æŒæ˜¾ç¤ºã€‚ç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨å…³é—­å³å¯ã€‚
å½“ç„¶äº†ï¼Œè¿™ä¸ªå±äºå°é—®é¢˜ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åº”è¯¥æ˜¯ä¼šå¿½ç•¥ä¸ç®¡ï¼Œæ¯ä¸ªäººçš„çœ‹æ³•ä¸ä¸€ã€‚æˆ‘è¿™é‡Œåªå½“æ˜¯æŠ›ç –å¼•ç‰ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè€ƒè™‘ã€‚</p>
</blockquote>
<h5 data-id="heading-6">è§£å†³æ–¹æ¡ˆ</h5>
<p>è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼ŒElMessage ä¸ºæˆ‘ä»¬æä¾›äº† <strong>beforeClose</strong> å‡½æ•°æ¥å¤„ç†å…³é—­å‰çš„æƒ…å†µï¼Œåªéœ€è¦å°†éªŒè¯å‡½æ•°æå–åˆ° <strong>beforeClos</strong> ä¸­å³å¯ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-keyword">const</span> handlePayment = <span class="hljs-title function_">createConfirmFlow</span>(
  <span class="hljs-keyword">async</span> (row) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å‘èµ·æ”¯ä»˜"</span>, row);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">api</span>();
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸ"</span>);
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"æ”¯ä»˜æç¤º"</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`æ€»ä»·ä¸º ï¿¥188 æ˜¯å¦ç¡®è®¤æ”¯ä»˜ï¼Ÿ`</span>,
    <span class="hljs-attr">beforeClose</span>: <span class="hljs-keyword">async</span> (action, instance, done) =&gt; {
      <span class="hljs-keyword">if</span> (action === <span class="hljs-string">"confirm"</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å…ˆå¹²ç‚¹åˆ«çš„"</span>);
        instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">true</span>;
        instance.<span class="hljs-property">confirmButtonText</span> = <span class="hljs-string">"æ”¯ä»˜ä¸­..."</span>;
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);

        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">validate</span>()) {
          <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥ï¼Œæ— æ³•æ”¯ä»˜"</span>);
          instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">false</span>;
          instance.<span class="hljs-property">confirmButtonText</span> = <span class="hljs-string">"OK"</span>;
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥"</span>);
        }
      }

      <span class="hljs-title function_">done</span>();
    },
  }
);
</code></pre>
<blockquote>
<p>è¿™æ ·å°±è¾¾åˆ°æˆ‘æƒ³è¦çš„æ•ˆæœäº†</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0c8f2f3d01e40089c38c638285f82d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5DQmxl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518510&amp;x-signature=QTDZbcrE1B1Crbc%2FjIYNCwO9sbQ%3D" alt="åŠ¨ç”».gif" loading="lazy"/></p>
<h4 data-id="heading-7">åŠ¨æ€çš„ message</h4>
<p>è¿˜æ˜¯æ”¯ä»˜ä¸ºä¾‹ï¼Œè·å–è®¢å•ä¸­çš„å•†å“æ•°é‡è·Ÿä»·æ ¼ï¼Œè®¡ç®—åèµ‹å€¼ç»™ <strong>message</strong> åå†åˆ›å»ºæµç¨‹å¤„ç†å‡½æ•°æ‰“å¼€å¼¹çª—ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-comment">// row =&gt; { id: 2, name: "æå››", quantity: 10, unitPrice: 88.0, ...... }</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePayment</span> = (<span class="hljs-params">row: User</span>) =&gt; {
  <span class="hljs-keyword">const</span> execute = <span class="hljs-title function_">createConfirmFlow</span>(
    <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å‘èµ·æ”¯ä»˜"</span>, row.<span class="hljs-property">quantity</span> * row.<span class="hljs-property">unitPrice</span>);
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">api</span>();
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸ"</span>);
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"æ”¯ä»˜æç¤º"</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">`æ€»ä»·ä¸º ï¿¥<span class="hljs-subst">${row.quantity * row.unitPrice}</span> æ˜¯å¦ç¡®è®¤æ”¯ä»˜ï¼Ÿ`</span>,
      <span class="hljs-attr">beforeClose</span>: <span class="hljs-keyword">async</span> (action, instance, done) =&gt; {
        <span class="hljs-keyword">if</span> (action === <span class="hljs-string">"confirm"</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å…ˆå¹²ç‚¹åˆ«çš„"</span>);
          instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">true</span>;
          instance.<span class="hljs-property">confirmButtonText</span> = <span class="hljs-string">"æ”¯ä»˜ä¸­..."</span>;
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);

          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span>) {
            <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥ï¼Œæ— æ³•æ”¯ä»˜"</span>);
            instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">false</span>;
            instance.<span class="hljs-property">confirmButtonText</span> = <span class="hljs-string">"OK"</span>;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥"</span>);
          }
        }

        <span class="hljs-title function_">done</span>();
      },
    }
  );

  <span class="hljs-title function_">execute</span>();
};

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ab4f1b9fa514e0d88be463fbbab515f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5DQmxl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518510&amp;x-signature=ZulrNgDBG1YOmiNBbs8MiiDQVcg%3D" alt="åŠ¨ç”».gif" loading="lazy"/></p>
<h4 data-id="heading-8">è‡ªå®šä¹‰ message</h4>
<p>è‡ªå®šä¹‰ <strong>message</strong> å®é™…ä¸Šè·Ÿ <strong>ElMessageBox</strong> ä¸€æ ·ï¼Œç»™ <strong>message</strong> å‚æ•°ä¼ å…¥ä¸€ä¸ª <strong>VNode</strong> å³å¯ã€‚è¿˜æ˜¯ä»¥ä¸Šé¢æ”¯ä»˜çš„ä¾‹å­æ‰©å±•ä¸€ä¸‹ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePayment</span> = (<span class="hljs-params">row: User</span>) =&gt; {
 <span class="hljs-comment">// + ä½¿ç”¨ h åˆ›å»ºä¸€ä¸ª VNode</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title class_">MessageVNode</span> = <span class="hljs-title function_">h</span>(<span class="hljs-string">"p"</span>, [
    <span class="hljs-string">"æ€»ä»·ä¸º"</span>,
    <span class="hljs-title function_">h</span>(
      <span class="hljs-string">"strong"</span>,
      { <span class="hljs-attr">style</span>: <span class="hljs-string">"color: red;"</span> },
      <span class="hljs-string">` ï¿¥<span class="hljs-subst">${row.quantity * row.unitPrice}</span> `</span>
    ),
    <span class="hljs-string">"æ˜¯å¦ç¡®è®¤æ”¯ä»˜ï¼Ÿ"</span>,
  ]);

  <span class="hljs-keyword">const</span> execute = <span class="hljs-title function_">createConfirmFlow</span>(
    <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å‘èµ·æ”¯ä»˜"</span>, row.<span class="hljs-property">quantity</span> * row.<span class="hljs-property">unitPrice</span>);
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">api</span>();
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ”¯ä»˜æˆåŠŸ"</span>);
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"æ”¯ä»˜æç¤º"</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-title class_">MessageVNode</span>, <span class="hljs-comment">// å°†åˆ›å»ºçš„ VNode ä¼ ç»™ message</span>
      <span class="hljs-attr">beforeClose</span>: <span class="hljs-keyword">async</span> (action, instance, done) =&gt; {
        <span class="hljs-keyword">if</span> (action === <span class="hljs-string">"confirm"</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å…ˆå¹²ç‚¹åˆ«çš„"</span>);
          instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">true</span>;
          instance.<span class="hljs-property">confirmButtonText</span> = <span class="hljs-string">"æ”¯ä»˜ä¸­..."</span>;
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">3000</span>);

          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span>) {
            <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥ï¼Œæ— æ³•æ”¯ä»˜"</span>);
            instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">false</span>;
            instance.<span class="hljs-property">confirmButtonText</span> = <span class="hljs-string">"OK"</span>;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"éªŒè¯å¤±è´¥"</span>);
          }
        }

        <span class="hljs-title function_">done</span>();
      },
    }
  );

  <span class="hljs-title function_">execute</span>();
};

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbabd133fc1549c380589a922d91c502~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5DQmxl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518510&amp;x-signature=wH9pE3kfOxr9hxPveTddUFKJUWU%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">è‡ªå®šä¹‰ç¡®è®¤ç»„ä»¶</h4>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ç¡®è®¤æµç¨‹å†…éƒ¨å°è£…çš„ç»„ä»¶ä¸ä¸€å®šé€‚ç”¨æ‰€æœ‰ä¸šåŠ¡éœ€è¦ï¼Œä¹Ÿè®¸åœ¨åŒæ ·çš„æµç¨‹ä¸­ï¼Œä¼šæœ‰ä¸åŒçš„ <strong>UI</strong> å±•ç¤ºæ•ˆæœï¼Œä¹Ÿè®¸éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„ç¡®è®¤ç»„ä»¶ã€‚æ‰€ä»¥ä¸ºäº†æˆ‘ä»¬å°è£…çš„è¿™ä¸ªæµç¨‹å¤ç”¨å·¥å…·å‡½æ•°èƒ½å¤Ÿæ”¯æŒè‡ªå®šä¹‰çš„ <strong>UI</strong> ç»„ä»¶ï¼Œæˆ‘éœ€è¦å¯¹ä»–åšä»¥ä¸‹æ‰©å±•ã€‚</p>
<blockquote>
<p>éœ€è¦èƒ½æ‰©å±•è‡ªå®šä¹‰ç»„ä»¶çš„åŠŸèƒ½ä¹‹å‰ï¼Œéœ€è¦æŠ½è±¡ä¸€äº›å…¬å…±éƒ¨åˆ†ï¼Œå¹¶ä¸”çº¦æŸè‡ªå®šä¹‰ç»„ä»¶å¿…é¡»å…·å¤‡çš„ç‰¹æ€§ï¼Œäº¤ç»™æˆ‘ä»¬å°è£…å¥½çš„å‡½æ•°ä½¿ç”¨ã€‚</p>
</blockquote>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. å£°æ˜è‡ªå®šä¹‰ç»„ä»¶å¿…é¡»å…·å¤‡çš„ç‰¹æ€§</span>
<span class="hljs-comment">// Message å‚è€ƒ ElMessagebox çš„ç±»å‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Message</span> = <span class="hljs-built_in">string</span> | <span class="hljs-title class_">VNode</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">VNode</span>);
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CallBack</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; | <span class="hljs-built_in">void</span>;

<span class="hljs-comment">// å£°æ˜é…ç½®ç±»å‹ï¼Œç»§æ‰¿ ElMessageBoxOptions çš„ç±»å‹ä½œä¸ºåŸºæœ¬é…ç½®ï¼Œå¹¶æ‰©å±•æˆ‘ä»¬è‡ªå·±çš„å¿…é¡»çš„ç±»å‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConfirmFlowOptions</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElMessageBoxOptions</span> {
  message?: <span class="hljs-title class_">Message</span>;
  title?: <span class="hljs-built_in">string</span>;
  <span class="hljs-title class_">CustomComponent</span>?: <span class="hljs-title class_">CustomConfirmMessage</span> | <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
}

<span class="hljs-comment">// è¿™ä¸ªæ˜¯è‡ªå®šä¹‰ç»„ä»¶çš„ç±»å‹æ ‡æ³¨ï¼Œå¿…é¡»è¦å®ç° confirm å‡½æ•°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CustomConfirmMessage</span> {
  <span class="hljs-attr">confirm</span>: <span class="hljs-function">(<span class="hljs-params">
    message: ElMessageBoxOptions[<span class="hljs-string">"message"</span>],
    options?: ConfirmFlowOptions
  </span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;;
}

<span class="hljs-comment">// è¾…åŠ©æ ¡éªŒè‡ªå®šä¹‰ç»„ä»¶æ˜¯å¦å­˜åœ¨ confirm å‡½æ•°</span>
<span class="hljs-keyword">const</span> isConfirmMessage = (<span class="hljs-attr">obj</span>: <span class="hljs-built_in">unknown</span>): obj is <span class="hljs-title class_">CustomConfirmMessage</span> =&gt;
  <span class="hljs-title function_">isObject</span>(obj) &amp;&amp; !<span class="hljs-title function_">isNull</span>(obj) &amp;&amp; <span class="hljs-string">"confirm"</span> <span class="hljs-keyword">in</span> obj &amp;&amp; <span class="hljs-title function_">isFunction</span>(obj.<span class="hljs-property">confirm</span>);

<span class="hljs-comment">// è·å–è‡ªå®šä¹‰ç»„ä»¶æ„é€ å™¨ï¼Œæ ¸å¿ƒç›®çš„ä¹Ÿæ˜¯ä¸ºäº†è°ƒç”¨ confirm </span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getMessageConstructor</span> = (<span class="hljs-params">options: ConfirmFlowOptions = {}</span>) =&gt; {
  <span class="hljs-keyword">const</span> { <span class="hljs-title class_">CustomComponent</span> } = options;

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isConfirmMessage</span>(<span class="hljs-title class_">CustomComponent</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">CustomComponent</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessageBox</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createConfirmFlow</span> = (<span class="hljs-params">
  callback: CallBack,
  options?: ConfirmFlowOptions
</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">CallBack</span>&gt;) =&gt; {
    <span class="hljs-comment">// + è·å–æµç¨‹ç¡®è®¤ç»„ä»¶</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ConfirmMessage</span> = <span class="hljs-title function_">getMessageConstructor</span>(options);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">ConfirmMessage</span>.<span class="hljs-title function_">confirm</span>(options?.<span class="hljs-property">message</span>, options);
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">callback</span>(...args);
      <span class="hljs-comment">// ä¿®æ”¹çŠ¶æ€...</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    }
  };
};

</code></pre>
<blockquote>
<p>ä¸Šè¿°ä»£ç æè¿°äº†è‡ªå®šä¹‰ç»„ä»¶å¿…é¡»å…·å¤‡çš„å‡½æ•°ï¼Œå¹¶ä¸”ç»Ÿä¸€äº†æ·»åŠ äº† <strong>getMessageConstructor</strong> å‡½æ•°æ¥è·å–æ¶ˆæ¯ç»„ä»¶ã€‚å¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯é»˜è®¤çš„ <strong>ElMessageBox</strong></p>
</blockquote>
<ul>
<li>ä¸‹é¢æˆ‘å†™ä¸€ä¸ªåŸºæœ¬çš„è‡ªå®šä¹‰å¼¹çª—ç¡®è®¤ç»„ä»¶æ¥æ¼”ç¤ºè¿™ä¸ªè‡ªå®šä¹‰ <strong>ui</strong> ç»„ä»¶çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
</ul>
<ol>
<li>å…ˆåˆ›å»ºä¸€ä¸ª <strong>CustomConfirmDialog.vue</strong>ç»„ä»¶</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"visible"</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"40%"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ message }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">footer</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"cancel"</span>&gt;</span>å–æ¶ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"confirm"</span>&gt;</span>
        {{ confirmText || "ç¡®å®š" }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { getCurrentInstance, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">Action</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./customConfirmDialog"</span>;

<span class="hljs-keyword">const</span> props = defineProps&lt;{
  title?: string;
  message?: string;
  confirmText?: string;
  beforeClose?: <span class="hljs-title class_">Function</span>;
}&gt;();

<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  (<span class="hljs-attr">e</span>: <span class="hljs-string">"action"</span>, <span class="hljs-attr">action</span>: <span class="hljs-title class_">Action</span>): <span class="hljs-keyword">void</span>;
}&gt;();

<span class="hljs-keyword">const</span> root = <span class="hljs-title function_">getCurrentInstance</span>();

<span class="hljs-keyword">const</span> visible = <span class="hljs-title function_">defineModel</span>({ <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span> });
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">confirm</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> props.<span class="hljs-property">beforeClose</span>?.(<span class="hljs-string">"confirm"</span>, root?.<span class="hljs-property">exposed</span> || {}, <span class="hljs-function">() =&gt;</span> {
    visible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  });
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"action"</span>, <span class="hljs-string">"confirm"</span>);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">cancel</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> props.<span class="hljs-property">beforeClose</span>?.(<span class="hljs-string">"cancel"</span>, root?.<span class="hljs-property">exposed</span> || {}, <span class="hljs-function">() =&gt;</span> {
    visible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  });
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">"action"</span>, <span class="hljs-string">"cancel"</span>);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">open</span> = (<span class="hljs-params"/>) =&gt; {
  visible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">close</span> = (<span class="hljs-params"/>) =&gt; {
  visible.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
};

<span class="hljs-title function_">defineExpose</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(
    {
      open,
      close,
      <span class="hljs-attr">confirmButtonLoading</span>: loading.<span class="hljs-property">value</span>,
    },
    {
      <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, key, receiver</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver);
      },
      <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">target, key, value, receiver</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, key, value, receiver);
        <span class="hljs-keyword">if</span> (key === <span class="hljs-string">"confirmButtonLoading"</span>) {
          loading.<span class="hljs-property">value</span> = value;
        }

        <span class="hljs-keyword">return</span> result;
      },
    }
  )
);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

</code></pre>
<ol start="2">
<li>æ·»åŠ ä¸€ä¸ª <strong>customConfirmDialog.ts</strong> å°†å¼¹çª—ç»„ä»¶æŒ‰å‘½ä»¤å¼å¼¹çª—çš„æ–¹å¼ä½¿ç”¨ <strong>confirm</strong> æ¥åˆ›å»ºã€‚</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">CustomConfirmDialogConstructor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./CustomConfirmDialog.vue"</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ConfirmFlowOptions</span>, <span class="hljs-title class_">CustomConfirmMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ElMessageBoxOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-plus"</span>;
<span class="hljs-keyword">import</span> {
  createVNode,
  render,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">AppContext</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">ComponentInternalInstance</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Action</span> = <span class="hljs-string">"confirm"</span> | <span class="hljs-string">"cancel"</span>;

<span class="hljs-keyword">const</span> instanceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;
  <span class="hljs-title class_">ComponentInternalInstance</span>,
  {
    <span class="hljs-attr">options</span>: <span class="hljs-built_in">any</span>;
    <span class="hljs-attr">resolve</span>: <span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">reject</span>: <span class="hljs-function">(<span class="hljs-params">reason?: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  }
&gt;();

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomConfirmDialog</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CustomConfirmMessage</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">confirm</span>(<span class="hljs-params">
    message: ElMessageBoxOptions[<span class="hljs-string">"message"</span>],
    options?: ConfirmFlowOptions,
    appContext?: AppContext
  </span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> instance = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createInstance</span>({ message, ...options }, appContext);

      instanceMap.<span class="hljs-title function_">set</span>(instance, { options, resolve, reject });
    });
  }

  <span class="hljs-title function_">createInstance</span>(<span class="hljs-params">options: ConfirmFlowOptions, appContext?: AppContext</span>) {
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>);

    <span class="hljs-keyword">const</span> instance = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initInstance</span>(options, container, appContext)!;
    instance.<span class="hljs-property">exposed</span>?.<span class="hljs-title function_">open</span>();

    <span class="hljs-keyword">return</span> instance;
  }

  <span class="hljs-title function_">initInstance</span>(<span class="hljs-params">
    props: <span class="hljs-built_in">any</span>,
    container: HTMLElement,
    appContext: AppContext | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>
  </span>) {
    <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">CustomConfirmDialogConstructor</span>, props);

    vnode.<span class="hljs-property">appContext</span> = appContext;

    <span class="hljs-title function_">render</span>(vnode, container);

    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(container.<span class="hljs-property">firstElementChild</span>!);

    <span class="hljs-keyword">return</span> vnode.<span class="hljs-property">component</span>;
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomConfirmDialog</span>();

</code></pre>
<ol start="3">
<li>é¡µé¢ä½¿ç”¨éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CustomConfirmDialog</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./CustomConfirmDialog"</span>;
<span class="hljs-keyword">import</span> { createConfirmFlow } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/utils/business"</span>;

<span class="hljs-comment">// è‡ªå®šä¹‰ç¡®è®¤ç»„ä»¶</span>
<span class="hljs-keyword">const</span> handleSensitiveOp = <span class="hljs-title function_">createConfirmFlow</span>(
  <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">api</span>();
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">"æ“ä½œæˆåŠŸ"</span>);
  },
  {
    <span class="hljs-title class_">CustomComponent</span>: <span class="hljs-title class_">CustomConfirmDialog</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">"æ­¤æ“ä½œåŒ…å«æ•æ„Ÿæ•°æ®ä¿®æ”¹ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ"</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">"æ•æ„Ÿæ“ä½œç¡®è®¤"</span>,
    <span class="hljs-attr">beforeClose</span>: <span class="hljs-keyword">async</span> (action, instance, done) =&gt; {
      <span class="hljs-keyword">if</span> (action === <span class="hljs-string">"confirm"</span>) {
        instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">2000</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span>
        instance.<span class="hljs-property">confirmButtonLoading</span> = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-title function_">done</span>();
    },
  }
);

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13a534c3c04648bf94abc72a955125f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5DQmxl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518510&amp;x-signature=s8uBCXSHnR6%2FJoXt0O9J%2B5R6R5A%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>å®Œå…¨æ²¡æœ‰é—®é¢˜ã€‚è‡³æ­¤ä¹Ÿå°±å®Œæˆäº†è¿™æ ·ä¸€ä¸ªæµç¨‹å¤ç”¨çš„å·¥å…·å‡½æ•°ã€‚</p>
</blockquote>
<h2 data-id="heading-10">confirmFlow å‡½æ•°å®Œæ•´ä»£ç </h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessageBox</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">ElMessageBoxOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-plus"</span>;
<span class="hljs-keyword">import</span> { isFunction, isNull, isObject } <span class="hljs-keyword">from</span> <span class="hljs-string">"lodash-es"</span>;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">VNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Message</span> = <span class="hljs-built_in">string</span> | <span class="hljs-title class_">VNode</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">VNode</span>);
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CallBack</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; | <span class="hljs-built_in">void</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConfirmFlowOptions</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElMessageBoxOptions</span> {
  message?: <span class="hljs-title class_">Message</span>;
  title?: <span class="hljs-built_in">string</span>;
  <span class="hljs-title class_">CustomComponent</span>?: <span class="hljs-title class_">CustomConfirmMessage</span> | <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;
  [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">any</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CustomConfirmMessage</span> {
  <span class="hljs-attr">confirm</span>: <span class="hljs-function">(<span class="hljs-params">
    message: ElMessageBoxOptions[<span class="hljs-string">"message"</span>],
    options?: ConfirmFlowOptions
  </span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;;
}

<span class="hljs-keyword">const</span> isConfirmMessage = (<span class="hljs-attr">obj</span>: <span class="hljs-built_in">unknown</span>): obj is <span class="hljs-title class_">CustomConfirmMessage</span> =&gt;
  <span class="hljs-title function_">isObject</span>(obj) &amp;&amp; !<span class="hljs-title function_">isNull</span>(obj) &amp;&amp; <span class="hljs-string">"confirm"</span> <span class="hljs-keyword">in</span> obj &amp;&amp; <span class="hljs-title function_">isFunction</span>(obj.<span class="hljs-property">confirm</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getMessageConstructor</span> = (<span class="hljs-params">options: ConfirmFlowOptions = {}</span>) =&gt; {
  <span class="hljs-keyword">const</span> { <span class="hljs-title class_">CustomComponent</span> } = options;

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isConfirmMessage</span>(<span class="hljs-title class_">CustomComponent</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">CustomComponent</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-title class_">ElMessageBox</span>;
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">createConfirmFlow</span> = (<span class="hljs-params">
  callback: CallBack,
  options?: ConfirmFlowOptions
</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">CallBack</span>&gt;) =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">ConfirmMessage</span> = <span class="hljs-title function_">getMessageConstructor</span>(options);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">ConfirmMessage</span>.<span class="hljs-title function_">confirm</span>(options?.<span class="hljs-property">message</span>, options);
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">callback</span>(...args);
      <span class="hljs-comment">// ä¿®æ”¹çŠ¶æ€...</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">if</span> (error === <span class="hljs-string">"cancel"</span>) <span class="hljs-keyword">return</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
    }
  };
};

</code></pre>
<h2 data-id="heading-11">æ€»ç»“ &amp; é—®é¢˜</h2>
<ol>
<li>ç¤ºä¾‹ä¸­çš„è‡ªå®šä¹‰å‘½ä»¤å¼å¼¹çª—ç»„ä»¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ²¡æœ‰å¸è½½ç»„ä»¶ï¼Œæ¯æ¬¡è°ƒç”¨ <strong>confirm</strong> æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>dialog</strong> è€Œæ—§çš„æœªé”€æ¯ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥åˆ†äº«ä¸€ä¸‹è¯¥å¦‚ä½•å¤„ç†ï¼Œæˆ–æŒ‡æ­£ä¸€ä¸‹æˆ‘æ˜¯å¦å†™çš„æœ‰é—®é¢˜ã€‚æˆ‘ç”¨ <strong>render(null,container)</strong> è·Ÿ <strong>container.remove()</strong> ä¹Ÿæ— æ³•é”€æ¯ã€‚</li>
<li>å¤§å®¶ä¼šå‘ç°å®é™…ä¸Šå°è£…ä¸€ä¸ªè¿™æ ·çš„æµç¨‹å¤„ç†å‡½æ•°å¹¶ä¸æ˜¯éš¾äº‹ï¼Œéš¾çš„æ˜¯æˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­æ˜¯å¦èƒ½å¤Ÿæƒ³åˆ°è¿™äº›ä»£ç ä¼˜åŒ–çš„æ–¹å¼ã€‚æˆ‘ä¹Ÿæ˜¯çœ‹åˆ°äº†å…¶ä»–å¤§ä½¬çš„åˆ†äº«æ‰å­¦åˆ°äº†è¿™äº›çŸ¥è¯†å¹¶åº”ç”¨åœ¨äº†å®é™…å·¥ä½œä¸­ã€‚å¦‚æœ‰é—®é¢˜å¤§å®¶ä¸€èµ·è®¨è®ºå­¦ä¹ ã€‚åç»­æˆ‘è¿˜ä¼šå‡ºä¸€ä¸ªé€šç”¨çš„é”™è¯¯æµç¨‹å¤„ç†å‡½æ•°è·Ÿè¿™ä¸ªæ˜¯ç±»ä¼¼çš„ã€‚</li>
<li>å¤§å®¶å¦‚æœæœ‰ä¸€äº›å·¥ä½œä¸­æ¯”è¾ƒå®ç”¨çš„ä¸€äº›ç¼–ç æ€ç»´ç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·åˆ†äº«å‡ºæ¥å­¦ä¹ å­¦ä¹ ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Œè…¾è®¯äº‘NoSQLã€æŠ€æœ¯ä¹‹ MongoDB ç¯‡:MongoDB å­˜å‚¨å¼•æ“å¤‡ä»½æ€§èƒ½70%æå‡å†…å¹•æ­ç§˜]]></title>    <link>https://juejin.cn/post/7575751471841869860</link>    <guid>https://juejin.cn/post/7575751471841869860</guid>    <pubDate>2025-11-24T03:06:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575751471841869860" data-draft-id="7575937594350026795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Œè…¾è®¯äº‘NoSQLã€æŠ€æœ¯ä¹‹ MongoDB ç¯‡:MongoDB å­˜å‚¨å¼•æ“å¤‡ä»½æ€§èƒ½70%æå‡å†…å¹•æ­ç§˜"/> <meta itemprop="keywords" content="æ•°æ®åº“,NoSQL"/> <meta itemprop="datePublished" content="2025-11-24T03:06:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è…¾è®¯äº‘æ•°æ®åº“"/> <meta itemprop="url" content="https://juejin.cn/user/3227821871466094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Œè…¾è®¯äº‘NoSQLã€æŠ€æœ¯ä¹‹ MongoDB ç¯‡:MongoDB å­˜å‚¨å¼•æ“å¤‡ä»½æ€§èƒ½70%æå‡å†…å¹•æ­ç§˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821871466094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è…¾è®¯äº‘æ•°æ®åº“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:06:15.000Z" title="Mon Nov 24 2025 03:06:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0cd903f8a5347a798f6b608a180da52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=W9YE8r%2BcI9PAYKrbmVSEEOigFzk%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<blockquote>
<p>åœ¨éç»“æ„åŒ–æ•°æ®çˆ†ç‚¸å¼å¢é•¿çš„ä»Šå¤©ï¼ŒMongoDB å‡­å€Ÿå…¶çµæ´»çš„æ–‡æ¡£æ¨¡å‹ä¸åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„æˆä¸ºæ¸¸æˆè¡Œä¸šé«˜å¹¶å‘åœºæ™¯çš„é¦–é€‰æ•°æ®åº“ã€‚ç„¶è€Œï¼Œåœ¨å¤§æ–‡æ¡£åœºæ™¯ï¼Œoplog çš„å¤‡ä»½å’Œå›æ¡£é•¿æœŸå­˜åœ¨æ•ˆç‡ç“¶é¢ˆâ€”â€”ä¼ ç»Ÿå¤‡ä»½æ–¹å¼éœ€å…¨é‡æ‹·è´æ•°æ®ç›®å½•ï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚åŸºäºä»¥ä¸Šä¸šåŠ¡ç—›ç‚¹ï¼Œè…¾è®¯äº‘ NoSQL ä¸å†…æ ¸å›¢é˜Ÿæ·±å…¥è§£æ WiredTiger å­˜å‚¨å¼•æ“åŸç†ï¼Œæ–°å¢ exclude_target åŠŸèƒ½ï¼Œé€šè¿‡æ™ºèƒ½è¯†åˆ«å¹¶è·³è¿‡å†—ä½™çš„æ— ç”¨ oplog.wt æ–‡ä»¶ï¼Œå®ç°å¤‡ä»½è€—æ—¶ã€å­˜å‚¨æˆæœ¬åŠç½‘ç»œå¸¦å®½çš„70%ç¼©å‡ï¼Œä¸ºæ¸¸æˆã€ç”µå•†ç­‰é«˜å¹¶å‘åœºæ™¯æä¾›æ›´é«˜æ•ˆçš„è¿ç»´æ”¯æŒã€‚</p>
<p>ä½œè€…ï¼šè…¾è®¯äº‘NoSQLå›¢é˜Ÿ-æ¨äºšæ´²ã€å°¹è¶…</p>
</blockquote>
<p>çº¿ä¸Šæœ‰éƒ¨åˆ† MongoDB ä¸šåŠ¡ï¼Œå› å…¶ä¸šåŠ¡ç‹¬ç‰¹æ€§äº§ç”Ÿäº†æµ·é‡çš„éç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚æ¸¸æˆæ—¥å¿—ã€ç”¨æˆ·è¡Œä¸ºè®°å½•ç­‰ï¼‰ï¼Œå¸¸é¢ä¸´æ–‡æ¡£å¤§ã€æ›´æ–°å†™å…¥é¢‘ç¹çš„æŒ‘æˆ˜ã€‚ä¸ºäº†å­˜å‚¨è¶³å¤Ÿçš„oplog ï¼Œè¿ç»´äººå‘˜å¾€å¾€éœ€è¦å°† oplog size è®¾ç½®å¾—æ¯”è¾ƒå¤§ï¼Œç”šè‡³è¿œè¿œè¶…è¿‡äº†ä¸šåŠ¡æ•°æ®æœ¬èº«çš„å¤§å°ã€‚MongoDB ç‰©ç†å¤‡ä»½åŸºäº wiredTiger å­˜å‚¨ backup åŠŸèƒ½å®ç°ï¼Œè¯¥åŠŸèƒ½ä¸»è¦æ‹·è´æ•°æ®ç›®å½•ä¸­çš„æ‰€æœ‰ wt æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç”¨æˆ·æ•°æ®æ–‡ä»¶ã€oplog ã€ç³»ç»Ÿ wt æ–‡ä»¶ç­‰ã€‚</p>
<p>æ•°æ®ç›®å½•ä¸­æ‰€æœ‰ wt æ–‡ä»¶è¶Šå¤§ï¼Œå®¢æˆ·çš„ç‰©ç†å¤‡ä»½åŠå›æ¡£æ—¶é—´ä¹Ÿå°±è¶Šé•¿ï¼Œä¸‹é¢ä»¥æŸæ ¸å¿ƒæ¸¸æˆä¸šåŠ¡ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œè¯¥ä¸šåŠ¡å¯¹åº”å®ä¾‹ä¸åŒ wt æ–‡ä»¶æ•°æ®é‡æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p><strong><strong>â—</strong>Â çœŸå®ä¸šåŠ¡æ•°æ®å¤§å°ï¼š230G</strong></p>
<p><strong><strong>â—</strong> Admin ã€config ç­‰ç³»ç»Ÿæ•°æ®å¤§å°ï¼š&lt; 1G</strong></p>
<p><strong><strong>â—</strong> Oplog å¤§å°(oplog.rs è¡¨)ï¼š 515G</strong></p>
<p>ä»ä¸Šé¢çš„ç»Ÿè®¡å¯ä»¥çœ‹å‡ºï¼Œoplog æ•°æ®å¤§å°å æ¯”çº¦70%ã€‚ç”±äºç¤¾åŒº MongoDB å­˜å‚¨å¼•æ“çš„ backup ç‰©ç†å¤‡ä»½åŠŸèƒ½å¿…é¡»å¯¹æ•°æ®ç›®å½•æ‰€æœ‰æ–‡ä»¶åšå¤‡ä»½ï¼Œå›æ¡£æ‰ä¼šæˆåŠŸï¼Œè¿™æ„å‘³ç€æ¯æ¬¡å¤‡ä»½éƒ½æœ‰å¤§é‡èµ„æºæµªè´¹åœ¨é‡å¤å¤‡ä»½ oplog ä¸Šï¼Œå¯¼è‡´å¤‡ä»½å’Œå›æ¡£æ—¶é—´è¿‡é•¿ï¼Œå­˜å‚¨æˆæœ¬å’Œç½‘ç»œå¸¦å®½æ¶ˆè€—å·¨å¤§ã€‚</p>
<p>åŸºäºä»¥ä¸Šçš„ä¸šåŠ¡ç—›ç‚¹ï¼Œè…¾è®¯äº‘å¯¹ MongoDB å­˜å‚¨å¼•æ“çš„ backup åšäº†ä¸€æ¬¡æ·±å…¥åˆ†æåŠä¼˜åŒ–ï¼ŒåŸºäº wiredTiger å­˜å‚¨å¼•æ“ backup æ–°å¢ exclude_target åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å¯ä»¥å¿½ç•¥å¤‡ä»½æŒ‡å®š wt æ–‡ä»¶ï¼ŒåŒæ—¶å¯ä»¥åšåˆ°åªåŸºäºç”¨æˆ·æ•°æ®æ–‡ä»¶æ­£å¸¸å¯åŠ¨ mongoDB ï¼Œä»è€Œç¡®ä¿å›æ¡£æˆåŠŸã€‚</p>
<p><strong>è…¾è®¯äº‘ MongoDB ä¼˜åŒ–åçš„ç‰©ç†å¤‡ä»½å›æ¡£ç›´æ¥å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡:</strong></p>
<p><strong><strong>â—</strong> Â å¤‡ä»½è€—æ—¶ï¼šå‡å°‘70%</strong></p>
<p><strong><strong>â—</strong> Â å›æ¡£è€—æ—¶ï¼šå‡å°‘70%</strong></p>
<p><strong><strong>â—</strong> Â å­˜å‚¨æˆæœ¬ï¼šèŠ‚çœ70%</strong></p>
<p><strong><strong>â—</strong> ç½‘ç»œå¸¦å®½å ç”¨ï¼šå‡å°‘70%</strong></p>
<h2 data-id="heading-0"><strong>1 è…¾è®¯äº‘ç‰©ç†å¤‡ä»½å›æ¡£åŸç†</strong></h2>
<p>è…¾è®¯äº‘ MongoDB ç‰©ç†å¤‡ä»½åŸºäº wiredTiger å­˜å‚¨å¼•æ“çš„ hotbackup åŠŸèƒ½å®ç°ï¼Œè¯¥åŠŸèƒ½åº•å±‚ä»¥ checkpoint æ£€æµ‹ç‚¹å®ç°èŠ‚ç‚¹çš„å®Œæ•´æ•°æ®å¿«ç…§ã€‚ç‰©ç†å¤‡ä»½æœŸé—´ï¼Œä¼šé€šè¿‡ç‰©ç†æ‹·è´çš„æ–¹å¼æ‹·è´æ•´ä¸ªæ•°æ®ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å­˜å…¥è…¾è®¯äº‘ cos å¯¹è±¡å­˜å‚¨ï¼Œæ•°æ®æ–‡ä»¶è¶Šå¤§ï¼Œæ•´ä¸ªå…¨é‡å¤‡ä»½è€—æ—¶å°±ä¼šè¶Šé•¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3527b2bbb51d4da6bc3f70ea6dc14215~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=SZtEtnm0B7x8BL97xjI4TXHAjP0%3D" alt="image.png" loading="lazy"/></p>
<p>åŒç†ï¼Œå½“å¯¹æ•´ä¸ªå®ä¾‹è¿›è¡Œæ•´å®ä¾‹å›æ¡£çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä» cos ä¸‹è½½å‰é¢å¤‡ä»½çš„æ‰€æœ‰ wt æ•°æ®æ–‡ä»¶ï¼Œæ€»æ–‡ä»¶è¶Šå¤§ï¼Œä¸‹è½½ä¹Ÿä¼šè¶Šè€—æ—¶ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b623ce96972449ecb75ad94ac4698c6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=rWSEDkgCwdxHQzcqsL%2FKqhQ6qlA%3D" alt="image.png" loading="lazy"/></p>
<p>ä»ä¸Šé¢çš„å¤‡ä»½å’Œå›æ¡£æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œå…¨é‡ç‰©ç†å¤‡ä»½çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æ‹·è´ oplog.wt åˆ° cos , ä¸‹è½½çš„æ—¶å€™ä¹Ÿéœ€è¦ä» cos ä¸‹è½½è¿™ä¸ª oplog.wt æ–‡ä»¶ã€‚</p>
<p>Oplog.wt ç‰©ç†æ–‡ä»¶ä¸­å­˜å‚¨çš„æ˜¯å†å²å¢é‡æ•°æ®ï¼Œä¸»è¦ç”¨äºä¸»ä»æ•°æ®åŒæ­¥å’Œå¢é‡é€»è¾‘å¤‡ä»½ã€‚å›æ¡£ä» cos ä¸‹è½½å®Œå…¨é‡ç‰©ç†å¤‡ä»½æ•°æ®åˆ°3ä¸ªèŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡è¿™3ä¸ªèŠ‚ç‚¹æ„å»ºå‰¯æœ¬é›†ä¸€è‡´çŠ¶æ€ï¼Œè¿™äº›ç”¨æˆ·æ•°æ®è¡¨ .wt+ å…¶ä»–å†…éƒ¨è¡¨ .wt å¯ä»¥å†³å®šè¿™ä¸ªå…¨é‡ä¸€è‡´çŠ¶æ€ï¼Œå› æ­¤ oplog.wt å¯¹æ„å»ºå‰¯æœ¬é›†æ˜¯æ— ç”¨æ•°æ®ã€‚</p>
<p>æ­¤å¤–è…¾è®¯äº‘ MongoDB å›¢é˜Ÿä¹Ÿä¼šé€»è¾‘å®æ—¶å¤‡ä»½ oplog.rs è¡¨ä¸­çš„å¢é‡æ•°æ®åˆ° cos å¯¹è±¡å­˜å‚¨ï¼Œé€šè¿‡ä¸Šé¢å®ä¾‹æ„å»ºå®Œçš„ä¸€è‡´çŠ¶æ€ +oplog.rs å¢é‡æ•°æ®çš„é€»è¾‘å›æ”¾å¯ä»¥ä¿è¯å¿«é€Ÿæ¢å¤æ•°æ®åˆ°ä»»æ„æ—¶é—´ç‚¹ã€‚é€šè¿‡ oplog.rs è¡¨å®æ—¶é€»è¾‘å¤‡ä»½çš„æ•°æ®å®é™…ä¸Šå’Œç‰©ç† oplog.wt æ–‡ä»¶ä¸­çš„å†…å®¹æ˜¯é‡å¤çš„ï¼Œoplog.rs é€»è¾‘å¤‡ä»½çš„æ•°æ®åŒ…å«äº† oplog.wt ä¸­çš„æ•°æ®ï¼Œå› æ­¤å†ä¸€æ¬¡è¯æ˜ oplog.wt æ˜¯é‡å¤çš„æ— ç”¨wtæ–‡ä»¶ã€‚</p>
<p>è¯´æ˜ï¼šä¸ºäº†ä¾¿äºç†è§£ï¼Œè¿™é‡Œç›´æ¥ç”¨è¡¨å .wt æ¥è¡¨ç¤ºè¯¥è¡¨å¯¹åº”ç£ç›˜ä¸Šçš„ wt æ–‡ä»¶ï¼Œå®é™…ä¸Šè¡¨å¯¹åº”çš„ wt æ–‡ä»¶ååœ¨ mongo server å±‚åšäº†ä¸€æ¬¡è½¬æ¢ã€‚å®é™…å¯¹åº”å…³ç³»å¯ä»¥é€šè¿‡ db. è¡¨å .stats().wi redTiger.uri è·å–ï¼Œä»¥ oplog.wt ä¸ºä¾‹ï¼Œå®ƒå¯¹åº”ç£ç›˜çš„æ–‡ä»¶è·¯å¾„å¦‚ä¸‹:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c46aacaa43af466aa210325ab73e8e51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=OVUXdVcuxVZEm328YfLklyN5uQA%3D" alt="image.png" loading="lazy"/>
æœ¬æ–‡åŸºäºä»¥ä¸ŠèƒŒæ™¯ï¼Œé€šè¿‡ MongoDB å†…æ ¸æ”¯æŒå¿½ç•¥ oplog.wt çš„å¤‡ä»½å’Œå›æ¡£ï¼Œä»è€Œè®©è¯¥æ¸¸æˆæ ¸å¿ƒå®¢æˆ·çš„å…¨é‡å¤‡ä»½å›æ¡£æ—¶é—´æé€Ÿ70%ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9535960692cc4b8aabe1cf7def550446~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=uhhGSV5C9JtAiD1f6iTZYqroc7A%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2 wiredTiger å­˜å‚¨å¼•æ“æ•°æ®æŒä¹…åŒ–åŠæ¢å¤åŸç†</h2>
<p>wiredTiger å­˜å‚¨å¼•æ“çš„ hotbackup åŠŸèƒ½ä»¥ wt çš„ checkpoint æ£€æµ‹ç‚¹ä¸ºåŸºç¡€ã€‚å•èŠ‚ç‚¹æ•…éšœæ¢å¤é™¤äº†ä¾èµ– checkpoint ï¼ŒåŒæ—¶ä¹Ÿä¾èµ– WALÂ ã€‚</p>
<h3 data-id="heading-2">2.1 WAL</h3>
<p>å…ˆç®€å•äº†è§£ä¸‹ WAL çš„ä¸€äº›ç†è®ºè¯´æ˜ï¼Œ WALï¼ˆé¢„å†™æ—¥å¿—ç³»ç»Ÿï¼Œï¼ˆ Write-ahead logging ï¼Œç¼©å†™ WAL ï¼‰ï¼‰æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ**å®ç°äº‹åŠ¡æŒä¹…æ€§ä¸æ•…éšœæ¢å¤çš„æ ¸å¿ƒæœºåˆ¶ï¼Œé€šè¿‡â€œå…ˆè®°å½•æ—¥å¿—åä¿®æ”¹æ•°æ®â€çš„åŸåˆ™ç¡®ä¿äº‹åŠ¡åŸå­æ€§å’Œæ•°æ®ä¸€è‡´æ€§ã€‚</p>
<h4 data-id="heading-3">2.1.1 ä¸ºä»€ä¹ˆéœ€è¦ WAL</h4>
<p>å‡è®¾ä»¥ä¸‹åœºæ™¯ï¼šå½“ç”¨æˆ·å†™æ•°æ®åˆ° MongoDB æ—¶å†…å­˜å¾ˆå……è¶³ï¼Œæ‰€æœ‰çš„ KV æ•°æ®ä¼šå­˜å‚¨åœ¨ wiredTiger å­˜å‚¨å¼•æ“çš„ B+ tree ä¸­ï¼Œå†™å…¥10æ¡æ™®é€š KV æ•°æ®åï¼Œå› æ­¤ wt çš„ dirty æŒ‡æ ‡å¾ˆä½ï¼Œå› æ­¤ä¸ä¼šè§¦å‘ B+ tree çš„ page evict æ“ä½œï¼Œå†™å…¥å†…å­˜åå°±ä¼šè¿”å›å®¢æˆ·ç«¯OK ï¼Œæ­¤æ—¶ B+ tree çš„æ•°æ®å…¨éƒ¨åœ¨å†…å­˜ä¸­ï¼Œè¿˜æ²¡æœ‰æŒä¹…åŒ–ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b93775f0a1343d0bf39821a77d57107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=Zi%2FGace%2B4%2F%2FLRtfDrIQwKLRPIoA%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚æœè¿™æ—¶å€™æœºå™¨æ•…éšœæˆ–è€… mongod æ•…éšœèŠ‚ç‚¹æŒ‚æ‰äº†ï¼Œé‡å¯èŠ‚ç‚¹åï¼Œç”±äºæ•°æ®æ²¡æœ‰æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå› æ­¤é‡å¯åæ•°æ®å°±ä¼šä¸¢å¤±ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12d89c61ca942199f87c59b482d1b6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=WCTCagxB3aYsf%2FlYb6BW6179VeU%3D" alt="image.png" loading="lazy"/></p>
<p>åŸºäºä»¥ä¸ŠèƒŒæ™¯ï¼Œå› æ­¤å°±æœ‰äº† WAL æ¨¡å—çš„å­˜åœ¨ï¼Œåœ¨æ•°æ®å†™å…¥åˆ° B+ tree å‰ï¼Œä¼šæå‰å†™ WAL æ—¥å¿—ï¼Œæ¯ä¸ªå†™äº‹ç‰©å¯¹åº”ä¸€ä¸ªå®Œæ•´ wal æ—¥å¿—ï¼Œè¿™æ ·å½“æœåŠ¡å™¨å¼‚å¸¸é‡å¯æˆ–è€…è¿›ç¨‹é‡å¯çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡ WAL é¡ºåºå›æ”¾è¿™äº›æ—¥å¿—å®Œæˆæ•°æ®æ¢å¤ã€‚Mongod çš„ WAL æ•°æ®å­˜å‚¨åœ¨ journal ç›®å½•ä¸­ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bc4b235186645af8e66fd5ac6df7cb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=MbpjT%2F4hPnyQUNs1L4uzMPvJ3jA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">2.1.2 å¦‚æœåªæœ‰ WAL ä¼šæœ‰ä»€ä¹ˆé—®é¢˜</h4>
<p>å‡è®¾åªä¾èµ– wal è¿›è¡Œå¼‚å¸¸æ•°æ®æ¢å¤ï¼Œå°†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<p><strong>â— æ•°æ®æ¢å¤æ…¢</strong></p>
<p>Wal çš„æ¢å¤æµç¨‹ï¼šé¡ºåºè¯»å–æ¯ä¸€ä¸ª WiredTigerLog.xx æ–‡ä»¶ï¼Œç„¶åè¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹ä¸€è¡Œä¸€è¡Œè¿›è¡Œå›æ”¾ï¼Œå¦‚æœ journal ç›®å½•ä¸­ WiredTigerLog.xx æ–‡ä»¶å¾ˆå¤šï¼Œé‚£ä¹ˆæ¢å¤é€Ÿåº¦å°±ä¼šè¶Šæ…¢ã€‚</p>
<p><strong>â— æ•°æ®æ”¾å¤§ä¸¥é‡</strong></p>
<p>å‡è®¾æˆ‘ä»¬åªæœ‰ä¸€æ¡æ•°æ®ï¼Œå¹¶ä¸”å¯¹è¿™æ¡æ•°æ® update äº†å‡ äº¿æ¬¡æ“ä½œï¼Œé‚£ä¹ˆ wal æ–‡ä»¶ä¸­ä¼šè®°å½•å‡ äº¿æ¬¡å˜æ›´è¿‡ç¨‹ï¼Œç£ç›˜å ç”¨ç©ºé—´ä¼šè†¨èƒ€å‡ äº¿å€ã€‚</p>
<p><strong>â— æ¶ˆè€—å¤§é‡æ–‡ä»¶å¥æŸ„</strong></p>
<p>Wiredtiger é»˜è®¤ WiredTigerLog.xx æ–‡ä»¶å¤§å°100Mï¼Œä¸ŠTæ•°æ®å°†ç”¨æ‰ä¸Šä¸‡ä¸ªæ–‡ä»¶å¥æŸ„ã€‚</p>
<h3 data-id="heading-5">2.2 Checkpoint</h3>
<p>ä¸ºäº†è§£å†³ WAL çš„ä»¥ä¸Šç—›ç‚¹ï¼Œå› æ­¤å¼•å…¥ checkpoint æœºåˆ¶ï¼ŒMongoDB çš„ checkpoint æ¨¡å—åŠŸèƒ½ä¸»è¦ç”± wiredTiger å­˜å‚¨å¼•æ“å®Œæˆã€‚</p>
<h4 data-id="heading-6">2.2.1 Checkpoint æ ¸å¿ƒåŸç†</h4>
<p>Checkpoint ä¸»è¦æŠŠå½“å‰ B+ tree ä¸­æ‰€æœ‰å¯è§è„ page æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œä»è€Œå®ç°ä¸€ä¸ªå®Œæ•´æ•°æ®å¿«ç…§ã€‚ä¸‹é¢ä»¥ä¸€ä¸ªå®Œæ•´çš„ checkpoint æµç¨‹ä¸ºä¾‹è¿›è¡Œè¯´æ˜(è¯´æ˜ï¼šä¸ºäº†ç®€åŒ–ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªæ–¹æ¡†æ¥ä»£è¡¨ä¸€ä¸ª page ï¼Œå®é™… B+ tree è¿™é‡Œè¿˜æ¶‰åŠrefç›¸å…³æ•°æ®ç»“æ„)ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf09173192f43a29a9a890b62ce356a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=1ycwRU7SInXNEwXq0KfoqERFK0s%3D" alt="image.png" loading="lazy"/></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾å½“å‰ç”¨æˆ·å†™å…¥æ•°æ®é‡ä¸å¤§ï¼Œå¹¶ä¸”æ²¡æœ‰è§¦å‘Â evict**Â ï¼Œé‚£ä¹ˆæ‰€æœ‰ç”¨æˆ·page æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ã€‚å½“åš checkpoint çš„æ—¶å€™ï¼Œcheckpoint çº¿ç¨‹ä¼šéå†æ•´ä¸ª b+ tree ä¸­çš„å¯è§ pageï¼Œç”±äºä¹‹å‰è¿™æ£µ tree ä¸­çš„æ‰€æœ‰ page éƒ½æ²¡æœ‰æŒä¹…åŒ–è¿‡ï¼Œå› æ­¤å¯¹ checkpoint çº¿ç¨‹æ¥è¯´è¿™äº› page éƒ½æ˜¯è„ page ã€‚æŒä¹…åŒ–åˆ°ç£ç›˜åçš„çŠ¶æ€å¤§ä½“å¦‚ä¸‹:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3796b05fc5c24012be29f78f578310ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=74Qhjxitk0bFJMqXxnpzzYmnglE%3D" alt="image.png" loading="lazy"/>
ç¬¬ä¸€æ¬¡ checkpoint å®Œæˆåï¼Œå‡è®¾æ›´æ–°äº† leaf_page_1 ä¸­çš„æ•°æ®ï¼Œç„¶å checkpoint çº¿ç¨‹è¿›è¡Œç¬¬äºŒæ¬¡ checkpoint æ“ä½œï¼Œè¿™æ—¶å€™çš„æ•°æ®åˆ†åˆ«çŠ¶æ€å¦‚ä¸‹å›¾:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1597170baab4cc6b9fc24ec00cbaff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=cabTtNDooFnyucEZlIqgkqQdaJs%3D" alt="image.png" loading="lazy"/></p>
<p>æœ€ç»ˆä¸¤æ¬¡ checkpoint åï¼Œcollection.wt ä¸­åŒ…å«äº†ä¸¤æ¬¡ checkpoint çš„å…¨éƒ¨ç”¨æˆ·æ•°æ®å’Œ ext å…ƒæ•°æ®ï¼Œæ¯ä¸ª checkpoint éƒ½å¯¹åº”ä¸€æ£µå®Œæ•´çš„ b+ treeï¼Œå‡è®¾ç¬¬ä¸€æ¬¡ checkpoint å¯¹åº” checkpoint_1ï¼Œç¬¬äºŒæ¬¡ checkpoint å¯¹åº” checkpoint_2, åˆ™ï¼š</p>
<p>Checkpoint_1 = leaf_page_1 + leaf_page_2 + internal_page_1 + leaf_page_3 + leaf_page_4 + internal_page_2 +root_page</p>
<p>Checkpoint_2 = leaf_page_1(new) + leaf_page_2 + internal_page_1(new) + leaf_page_3 + leaf_page_4 + internal_page_2 +root_page(new)</p>
<p>å½“èŠ‚ç‚¹é‡å¯åï¼Œé¦–å…ˆæ ¹æ® WiredTiger.wt å…ƒæ•°æ®è·å–ä¸‹å›¾ä¸­çš„ checkpoint ä¿¡æ¯ï¼Œè§£æ checkpint ä¿¡æ¯å°±å¯ä»¥è·å–åˆ°ç£ç›˜ä¸Šçš„ root pageï¼Œç„¶åå°±å¯ä»¥é€å±‚è·å–åˆ°æ•´é¢—b+ tree çš„æ‰€æœ‰ pageã€‚root page å°±æ˜¯é€šè¿‡ wiredTiger å¯åŠ¨æ—¶å€™è§£æWiredTiger.wt æ–‡ä»¶ä¸­çš„ checkpoint ä¿¡æ¯åœ°å€è·å–ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a54765f79ceb4ddeab100b0b81fda515~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=uVxMWSB%2BMul%2BsnjHcsKKL9z%2FQn0%3D" alt="image.png" loading="lazy"/>
è¿™é‡Œ checkpoint=(WiredTigerCheckpoint.1=</p>
<p>(addr="018181e4c6ff67d88281e41546bd168381e48372ae35808080e22fc0cfc0")çš„ addr æ˜¯ç¼–ç åçš„å­—ç¬¦ä¸²ï¼Œé€šè¿‡è§£ç è¿™ä¸ª addr å­—ç¬¦ä¸²å³å¯è§£æå‡º root page åœ¨ç£ç›˜ä¸­çš„ä½ç½®ä»¥åŠå…¶ä»– ext metaï¼Œä»è€Œå¯ä»¥åœ¨å†…å­˜ä¸­é‡æ–°æ„å»ºè¯¥ b+ treeã€‚Checkpoint è§£æåçš„å†…å®¹å¦‚ä¸‹:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c0503542d14485ca377189c282cd8c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=sUA8f1xMxNhJSdvuKG0OB2TmE2E%3D" alt="image.png" loading="lazy"/></p>
<p>wiredTiger ç›¸å…³ checkpoint é…ç½®ä¸»è¦æœ‰ä¸‹é¢ä¸¤ä¸ªå‚æ•°ï¼š</p>
<p>â— Checkpoint.log_size</p>
<p>å½“ä¸Šæ¬¡ checkpoint åï¼Œwalçš„log_size å¢åŠ åˆ°é…ç½®çš„æŒ‡å®šå¤§å°ï¼Œåˆ™ä¼šè§¦å‘wiredTiger çš„ checkpoint server çº¿ç¨‹åš checkpoint æ“ä½œã€‚</p>
<p>â— Checkpoint.wait</p>
<p>å¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ»¡è¶³ log_size çš„å¤§å°ï¼Œå½“ç¦»ä¸Šæ¬¡ checkpoint æ—¶é—´è¾¾åˆ° wait å€¼ï¼Œä¹Ÿä¼šè§¦å‘ checkpoint server çº¿ç¨‹åš checkpoint æ“ä½œã€‚</p>
<p>MongoDB æ²¡æœ‰å¯ç”¨ wiredTiger è‡ªå¸¦çš„ checkpoint serverÂ </p>
<p>çº¿ç¨‹åš checkpoint æ“ä½œï¼Œè€Œæ˜¯ Mongo server å±‚åˆ›å»ºäº†ä¸€ä¸ª checkpoint çº¿ç¨‹å®šæœŸè¿›è¡Œ checkpoint æ“ä½œï¼Œcheckpoint å‘¨æœŸé»˜è®¤60ç§’ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ storage.syncPeriodSecså‚æ•°è¿›è¡Œä¿®æ”¹ã€‚</p>
<h4 data-id="heading-7">2.2.2 Checkpoint + WAL ç»“åˆä¼˜åŠ¿</h4>
<p>å‰é¢çš„ checkpoint åˆ†æå¯ä»¥çœ‹å‡ºï¼ŒèŠ‚ç‚¹é‡å¯çš„æ—¶å€™å¯ä»¥æ¢å¤åˆ°ä¸Šä¸€æ¬¡å¼€å§‹åšcheckpoint æ—¶å€™çš„å…¨é‡æ•°æ®å¿«ç…§ï¼Œç„¶åä»è¿™ä¸ª checkpoint æ—¶é—´ç‚¹å›æ”¾å¯¹åº” WAL æ–‡ä»¶ä¸­çš„æ—¥å¿—å³å¯æ¢å¤æ•°æ®åˆ°èŠ‚ç‚¹å¼‚å¸¸æ—¶é—´ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc8edfd0fe01420396b391b5c6dda035~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=Hqb0gRixdPJY8X6LvvEqKyXJnSo%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸€æ¬¡ checkpoint å®Œæˆåï¼Œæœ¬æ¬¡ checkpoint æ—¶é—´ç‚¹ä¹‹å‰çš„ WAL å·²ç»æ²¡ç”¨äº†ï¼Œå› æ­¤å¯ä»¥ç›´æ¥åˆ é™¤ã€‚æœ€ç»ˆèŠ‚ç‚¹é‡å¯åçš„æ•°æ®æ¢å¤ä»¥æœ€è¿‘ä¸€æ¬¡ checkpoint å…¨é‡å¿«ç…§+checkpoint æ—¶é—´ç‚¹ä»¥åçš„ WAL æ–‡ä»¶æ¥æ¢å¤å•æœºæ•°æ®ï¼Œå…¶ä¸­ï¼š</p>
<p>â— å…¨é‡æ•°æ®</p>
<p>é€šè¿‡ checkpoint æ—¶é—´ç‚¹çš„å¿«ç…§ï¼Œé€šè¿‡ WiredTiger.wt å…ƒæ•°æ®æ–‡ä»¶ä¸­çš„ checkpoint=(WiredTigerCheckpoint.1=(addr="018181e4c6ff67d88281e41546bd168381e48372ae35808080e22fc0cfc0")å³å¯è·å– checkpoint å¼€å§‹æ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®ã€‚</p>
<p>â— å¢é‡æ•°æ®</p>
<p>å¢é‡æ•°æ®å¯ä»¥é€šè¿‡ checkpoint æ—¶é—´ç‚¹å¯¹åº”çš„ WAL æ–‡ä»¶å›æ”¾æ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„ WiredTigerLog.n-1 å’Œ WiredTigerLog.nã€‚</p>
<p>é€šè¿‡ checkpoint+WAL çš„ç»“åˆï¼Œå½»åº•è§£å†³äº†ä¹‹å‰åªæœ‰ WAL è®¾è®¡æ—¶å€™çš„æ¢å¤æ…¢ã€æ•°æ®é‡æ”¾å¤§ã€å¥æŸ„è€—å…‰ç­‰é—®é¢˜ã€‚</p>
<h2 data-id="heading-8">3 wiredTiger å­˜å‚¨å¼•æ“ hotbackup æ ¸å¿ƒåŸç†åŠå…¶ä¼˜åŒ–</h2>
<h3 data-id="heading-9">3.1 wiredTiger å­˜å‚¨å¼•æ“ hotbackup æ ¸å¿ƒåŸç†</h3>
<p>hotbackup ä¸»è¦æ˜¯å®Œæˆç‰©ç† wt æ–‡ä»¶çš„å®Œæ•´ä¸€è‡´æ€§æ‹·è´ï¼Œæ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·±çš„checkpoint.addr (è¿™é‡Œé¢ä¿å­˜äº† root åŠå…¶ä»– ext meta )ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨WiredTiger.wt å…ƒæ•°æ®æ–‡ä»¶ä¸­ã€‚</p>
<p>é€šè¿‡ WiredTiger.wt ä¸­çš„ checkpoint.addr ä¿¡æ¯å¯ä»¥é€æ­¥åœ¨æ¢å¤æ•´ä¸ª B+ tree å±‚çº§ç»“æ„ã€‚é™¤äº†è¿™ä¸ªå…³é”®ä¿¡æ¯å¤–ï¼Œè¿™é‡Œè¿˜æ¶‰åŠåˆ°å¾ˆå¤šå…¶ä»–çš„å…ƒæ•°æ®é…ç½®ï¼Œä¾‹å¦‚åˆ›å»ºè¡¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šä»¥ä¸‹å‚æ•°:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6779e058ccef452db0a56873439fbcd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=s%2F3AFhjOaGtKhBzXiLdtnAo7PTY%3D" alt="image.png" loading="lazy"/></p>
<p>åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œå¦‚æœä¿®æ”¹äº† typeã€prefix_compression å’Œ value_format çš„é»˜è®¤é…ç½®ï¼Œåˆ™ wiredTiger.wt ä¸­ä¼šä¿å­˜è¿™äº›è¡¨çš„å…ƒæ•°æ®ï¼Œè¿™äº›å…ƒæ•°æ®å¿…é¡»å’Œåˆ›å»ºè¡¨æ—¶å€™ä¿æŒä¸€è‡´ï¼Œå¦åˆ™èŠ‚ç‚¹é‡å¯ä¼šå¤±è´¥ã€‚</p>
<p>æ­¤å¤–ï¼Œé™¤äº†ä¸Šé¢çš„å…ƒæ•°æ®å¤–ï¼Œè¿˜éœ€è¦å¤‡ä»½ schema é…ç½®å…ƒæ•°æ®ï¼Œå¹¶å­˜å‚¨è¡¨åå’Œè¿™äº›å…ƒæ•°æ®é…ç½®çš„å¯¹åº”å…³ç³»ã€‚æ‰€æœ‰è¿™äº›å…ƒæ•°æ®é…ç½®å®Œå…¨ä¸€è‡´åï¼Œå°±å¯ä»¥é€šè¿‡å…ƒæ•°æ®åŠ è½½è¡¨å¯¹åº” wt æ–‡ä»¶ï¼Œç„¶åä»å…ƒæ•°æ®æ–‡ä»¶ä¸­çš„ checkpoint.addr ä¿¡æ¯è¯»å– root åœ°å€ï¼Œæœ€ç»ˆç”¨æˆ·æ•°æ®ä¹Ÿå°±æ„å»ºåˆ° B+ tree ç»“æ„ä¸­ã€‚</p>
<p>æ•´ä¸ª backup ä»£ç å®ç°ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p>â— backup cursor ç”Ÿæˆé˜¶æ®µ</p>
<p>è¿™ä¸ªæ­¥éª¤ä¸»è¦å®Œæˆ schema é…ç½®ç”Ÿæˆã€ç¡®å®šéœ€è¦æ‹·è´çš„ç‰©ç†æ–‡ä»¶åŠ å…¥Â cursor**Â çš„ list bufferã€è®¾ç½® backup æ ‡è¯†ç­‰ã€‚</p>
<p>â— backup cursor éå†é˜¶æ®µ</p>
<p>è¿™ä¸ªæ­¥éª¤ä¸»è¦å‘ŠçŸ¥æˆ‘ä»¬éœ€è¦æ‹·è´å“ªäº›æ–‡ä»¶ï¼Œé€šè¿‡ backup cursor ç¡®å®šéœ€è¦æ‹·è´çš„æ–‡ä»¶åã€‚</p>
<p>lbackup cursor ç»“æŸé˜¶æ®µ</p>
<p>è¿™ä¸ªé˜¶æ®µä¸»è¦åŒ…æ‹¬èµ„æºå›æ”¶ï¼Œæ¸…ç† backup æ ‡è¯†ç­‰ã€‚</p>
<h4 data-id="heading-10">3.1.1 backup cursor ç”Ÿæˆé˜¶æ®µ(ä¹Ÿå¯ä»¥ç§°ä¸º begin é˜¶æ®µ)</h4>
<p>è¿™ä¸€é˜¶æ®µä¹Ÿå« begin é˜¶æ®µï¼Œbegin å¼€å§‹åä¼šç«‹é©¬è®¾ç½® backup æ ‡è¯†ï¼Œæ ‡æ˜å½“å‰æ­£åœ¨åšbackup æ“ä½œã€‚</p>
<p>è¯¥é˜¶æ®µä¼šä» WiredTiger.wt ä¸­è¯»å–æ‰€æœ‰" file:"ç›¸å…³çš„ wt æ–‡ä»¶åˆ—è¡¨ï¼Œè¿™äº›åˆ—è¡¨å¯¹åº”å…·ä½“çš„ wt æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯éœ€è¦æ‹·è´åˆ° cos å¯¹è±¡å­˜å‚¨çš„wtæ–‡ä»¶ï¼Œè¢«å­˜å‚¨åˆ° cursor list æ•°ç»„ä¸­ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7440007e52d941549dc536ef2222def0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=FTAejUDvNyP5pq84dXz6B28SLpA%3D" alt="image.png" loading="lazy"/></p>
<p>List æ˜¯æŒ‡é’ˆç»“æ„ï¼ŒæŒ‡å‘çš„å†…å®¹ä¸ºæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€ä¸ª elem ä»£è¡¨ä¸€ä¸ªéœ€è¦æ‹·è´çš„ wt æ–‡ä»¶ã€‚ç„¶åè·å–è¿™äº› wt æ–‡ä»¶çš„å…ƒæ•°æ®é…ç½®ä¿¡æ¯å­˜å…¥"WiredTiger.backup.tmp"æ–‡ä»¶ä¸­ï¼Œå½“æ‰€æœ‰çš„ wt æ–‡ä»¶ schemap é…ç½®åŠå…ƒæ•°æ®å†™å…¥ tmp æ–‡ä»¶å®Œæˆåï¼Œä¼š rename æ›´åä¸ºâ€œWiredTiger.backupï¼Œæœ€ç»ˆâ€œWiredTiger.backupâ€å†…å®¹å¤§ä½“å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dc7afbf3d0d414e951be44f5a3e10d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=RVQUJHMqFljIDuQq5QrXCvbSCp4%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-11">3.1.2 backup cursor éå†é˜¶æ®µ(ä¹Ÿå¯ä»¥ç§°ä¸ºwtæ–‡ä»¶æ•°æ®æ‹·è´é˜¶æ®µ)</h4>
<p>è¿™ä¸€é˜¶æ®µéå† list[]æ•°ç»„å³å¯è·å– list[]æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ª elemï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è·å–æ¯ä¸€ä¸ªéœ€è¦å¤‡ä»½çš„ wt ç‰©ç†æ–‡ä»¶ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d99ba97c8e164e41b089aa4dabfebcc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=hHlHS9Jv2QP6TAy2nVstFDj8qAo%3D" alt="image.png" loading="lazy"/>
è·å–åˆ°éœ€è¦å¤‡ä»½çš„ wt æ–‡ä»¶åï¼Œæ—è·¯æœåŠ¡å°±å¯ä»¥å¹¶å‘æ‹·è´ wt æ–‡ä»¶å­˜å‚¨åˆ°è…¾è®¯äº‘ cos å¯¹è±¡å­˜å‚¨ä¸­(åŒ…æ‹¬ WiredTiger.backup æ–‡ä»¶)ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a88c981fa0344e639d63624a020ff7f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=HG6XnpA2rU2s%2B%2BYp7JlyM6wzMD0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-12">3.1.3 backup cursor éå†é˜¶æ®µ(ä¹Ÿå¯ä»¥ç§°ä¸º wt æ–‡ä»¶æ•°æ®æ‹·è´é˜¶æ®µ)</h4>
<p>å½“ç‰©ç†æ–‡ä»¶æ‹·è´å®Œæˆåï¼Œbackup cursor å³å¯ close å®Œæˆèµ„æºé‡Šæ”¾ï¼ŒåŒæ—¶æ¸…ç†backup æ ‡è¯†ã€‚</p>
<h3 data-id="heading-13">3.2 backup æ•°æ®æ¢å¤ä¸»è¦å®ç°</h3>
<p>ä» cos ä¸‹è½½å¤‡ä»½çš„ wt æ–‡ä»¶åï¼Œwt åŠ è½½æµç¨‹ä¸»è¦å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb0674df247541bbad4c9aeb2eea099a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=AA1BjF4pgH6mn4NPBE0YA5lCnVw%3D" alt="image.png" loading="lazy"/></p>
<p>æ•°æ®æ¢å¤å®ç°ä¸»è¦æ˜¯è¯»å– WiredTiger.backup å†…å®¹ï¼Œç„¶åæ ¹æ®è¿™äº›å†…å®¹ç”ŸæˆWiredTiger.wt å…ƒæ•°æ®æ–‡ä»¶ï¼Œå…ƒæ•°æ®æ–‡ä»¶ç”Ÿæˆå®Œæ¯•åå°±å¯ä»¥å¼€å§‹æ­£å¼æ•°æ®åŠ è½½ï¼Œmongod å³å¯é€šè¿‡ WiredTiger.wt å…ƒæ•°æ®æ–‡ä»¶è·å–æ¯ä¸ªè¡¨çš„é…ç½®ä¿¡æ¯ï¼Œä»è€Œå®Œæˆ wt åŠ è½½å¯åŠ¨å·¥ä½œã€‚</p>
<h3 data-id="heading-14">3.3 å­˜å‚¨å¼•æ“ backup å‰”é™¤æŒ‡å®š wt æ–‡ä»¶æ ¸å¿ƒå®ç°åŠå…¶éªŒè¯</h3>
<h4 data-id="heading-15">3.3.1 backup å‰”é™¤æŒ‡å®š wt æ–‡ä»¶å®ç°</h4>
<p>ä»ä¸Šé¢çš„å¤‡ä»½å’Œæ¢å¤æ–¹å¼å¯ä»¥çœ‹å‡ºï¼ŒWiredTiger.backup ä¸­çš„å†…å®¹æ˜¯èŠ‚ç‚¹æ¢å¤çš„æ ¸å¿ƒå…³é”®å…ƒæ•°æ®ï¼Œwt å¯åŠ¨æ‰€éœ€çš„ WiredTiger.wt ä¸­çš„ schema é…ç½®å’Œå…ƒæ•°æ®å†…å®¹å…¨éƒ¨æ¥è‡ª WiredTiger.backup æ–‡ä»¶ï¼Œè€Œ WiredTiger.backup æ–‡ä»¶åœ¨ begin é˜¶æ®µå®Œæˆï¼Œå› æ­¤å¯ä»¥åœ¨ wt çš„ backup æ¥å£ä¸­å¢åŠ äº†ä¸€ä¸ª exclude_target å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„ä½œç”¨ä¸»è¦æ˜¯åœ¨ begin é˜¶æ®µæ’é™¤æŒ‡å®š wt æ–‡ä»¶ã€‚å‡è®¾å‰”é™¤çš„è¡¨ä¸º collection1, Hotback begin é˜¶æ®µå‰”é™¤ collection1 è¡¨åï¼ŒWiredTiger.backup æ–‡ä»¶ä¸­çš„å†…å®¹å°†ä¸å†åŒ…å« collection1 çš„ç›¸å…³å†…å®¹(è¿™é‡Œè…¾è®¯äº‘è‡ªå·±å¯¹ wiredTiger åšäº†ä¿®æ”¹)ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be171e013072445baa04decc3b150822~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=pCZYBIvlnKD6yDUjjS46%2B4doTyE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90bc31bf79f2435397127219577ea89f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=MdvWq%2BRdVVnwwjIInfWLmv1reRU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd1385408a694329a05507614d2611d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=AKwBYJj3nGI2Se9aSnTVBi8DyZM%3D" alt="image.png" loading="lazy"/></p>
<p>åŒç†ï¼Œå½“ cos ä¸‹è½½ wt æ–‡ä»¶æ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿå°±ä¸ä¼šä¸‹è½½ collection.wt æ–‡ä»¶ï¼Œä»è€Œä¹Ÿå°±æå‡äº†å›æ¡£ä¸‹è½½è€—æ—¶ã€‚</p>
<h4 data-id="heading-16">3.3.2 backup å‰”é™¤æŒ‡å®š wt æ–‡ä»¶éªŒè¯</h4>
<p>ä¸ºäº†éªŒè¯ backup æ–°å¢çš„ exclude_target åŠŸèƒ½æ˜¯å¦èƒ½æ­£å¸¸å¤‡ä»½å’Œå›æ¡£ï¼ŒæŒ‰ç…§wiredTiger å­˜å‚¨å¼•æ“ä»¥ä¸‹ demo æ­¥éª¤è¿›è¡ŒéªŒè¯ï¼Œç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥å¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™è¯´æ˜ backup å‰”é™¤æŒ‡å®š collection åŠŸèƒ½å®ç°æ²¡æœ‰é—®é¢˜ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šæ•°æ®å‡†å¤‡</p>
<p>æ–°å»º10ä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨å†™100æ¡æ•°æ®ï¼Œç„¶åä¸»åŠ¨æ‰§è¡Œä¸€æ¬¡ checkpointã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šexclude_target å‰”é™¤å…¶ä¸­ä¸€ä¸ªè¡¨(åªç‰©ç†å¤‡ä»½9ä¸ªè¡¨)è¿›è¡Œæ•°æ®å¤‡ä»½</p>
<p>è°ƒç”¨ä¿®æ”¹åçš„ backup åŠŸèƒ½ï¼Œç”Ÿæˆå¤‡ä»½æ•°æ®ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šåŠ è½½å¤‡ä»½æ•°æ®</p>
<p>ç”¨ç¬¬äºŒæ­¥ç”Ÿæˆçš„å¤‡ä»½æ•°æ®ï¼ŒåŠ è½½ wt æ–‡ä»¶ï¼Œç¡®å®šæ˜¯å¦å¯ä»¥åŠ è½½æˆåŠŸã€‚</p>
<p>ç¬¬å››æ­¥ï¼šéªŒè¯å¤‡ä»½æ•°æ®æ­£ç¡®æ€§</p>
<p>éªŒè¯å¤‡ä»½çš„9ä¸ªè¡¨ä¸­çš„å†…å®¹æ˜¯å¦å’Œå¤‡ä»½å‰çš„å†…å®¹å®Œå…¨ä¸€è‡´ã€‚</p>
<p>â— å‡†å¤‡æ•°æ®</p>
<p>æ•°æ®å‡†å¤‡é˜¶æ®µåˆ›å»º10ä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨å†™å…¥100æ¡æ•°æ®ï¼Œç›¸å…³æ ¸å¿ƒ demo ä»£ç å¦‚ä¸‹:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42e9991fec48498293f1004db4d4487b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=jxRg2c2KlQ60mp46QQ73c25ajBo%3D" alt="image.png" loading="lazy"/>
â— exclude_target å‰”é™¤å…¶ä¸­ä¸€ä¸ªè¡¨(åªå¤‡ä»½9ä¸ªè¡¨)è¿›è¡Œæ•°æ®å¤‡ä»½</p>
<p>ä¸Šä¸€æ­¥åˆ›å»ºäº†10ä¸ªè¡¨ï¼Œæ–°å¢ exclude_target å‚æ•°åŠŸèƒ½åï¼Œè¿™é‡Œ backup å¤‡ä»½å‰”é™¤å…¶ä¸­ä¸€ä¸ªè¡¨(collection_0), å› æ­¤ cursor next åªä¼šè·å–åˆ°9ä¸ªè¡¨ï¼Œä¸»è¦ demoå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/453f95b68ae34b39ac800aa72459440f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=6ZzxxIs%2BJRmiN4vRPht1C4TMduE%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™ä¸ª demo åœ¨ BACKUP_DIR ä¸­çš„å¤‡ä»½æ–‡ä»¶åªä¼šæœ‰9ä¸ªï¼Œä¹Ÿå°±æ˜¯ collection_1 â€“ collection_9ï¼Œç¬¦åˆé¢„æœŸã€‚</p>
<p>â— åŠ è½½ backup çš„å¤‡ä»½æ•°æ®</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ec28472c14d48bc886de135741245d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=gm7HnJAlduzClrk7YE2ddL%2Fl60Y%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡ŒéªŒè¯é€šè¿‡ï¼Œæ¯ä¸ªæ­¥éª¤ä¸ä¼šæŠ¥é”™ï¼Œæ•°æ®å¯ä»¥æ­£å¸¸åŠ è½½, éªŒè¯é€šè¿‡ã€‚</p>
<p>â— éªŒè¯å¤‡ä»½æ•°æ®æ­£ç¡®æ€§</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a85a6776f444aaf95b6613f72d1465b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=lpJTZrMZ78%2BemCzUIR8wahm%2BAu0%3D" alt="image.png" loading="lazy"/>
è¿™é‡ŒéªŒè¯é€šè¿‡ï¼Œæ¯ä¸ªæ­¥éª¤ä¸ä¼šæŠ¥é”™ï¼Œæ•°æ®å¯ä»¥æ­£å¸¸åŠ è½½ï¼Œå¹¶ä¸”èƒ½æ‰“å°å‡ºcollection_1-collection_9 è¿™9ä¸ªè¡¨ä¸­çš„KVæ•°æ®ï¼Œæ‰“å°çš„å†…å®¹ä¸å†™å…¥è¡¨ä¸­çš„å†…å®¹å®Œå…¨ä¸€è‡´ã€‚</p>
<p>ä»ä¸Šé¢çš„ demo éªŒè¯å¯ä»¥ç¡®è®¤ï¼Œå¿½ç•¥æŒ‡å®š wt å¤‡ä»½æ¢å¤éªŒè¯é€šè¿‡ï¼Œè¯´æ˜ä»å­˜å‚¨å¼•æ“ä¸€ä¾§éªŒè¯è¯¥æ–¹æ¡ˆæ²¡é—®é¢˜ã€‚</p>
<h2 data-id="heading-17">4 MongoDB server å±‚é€‚é…</h2>
<p>MongoDB æœåŠ¡å™¨æœ¬èº«ä¾èµ–ä¸€äº›å…ƒæ•°æ®æ–‡ä»¶æ¥ç®¡ç†æ‰€æœ‰æ•°æ®è¡¨ï¼Œå¦‚æœç›´æ¥å»æ‰ oplog.rs æ–‡ä»¶åï¼Œå¯åŠ¨æ—¶ä¼šå› æ‰¾ä¸åˆ°è¯¥æ–‡ä»¶è€ŒæŠ¥é”™ã€‚MongoDB server å±‚åŒæ ·é€šè¿‡ backup cursor(å¸¦ä¸Šæ–°å¢çš„ exclude_target=oplog.wt)è¿›è¡Œé€‚é…ã€‚</p>
<p>Server å±‚é€‚é…çš„æ—¶å€™å¯ä»¥å…ˆè·å– oplog.rs å¯¹åº”çš„ç£ç›˜ wt æ–‡ä»¶åï¼Œç„¶ååŠ å…¥exclude_target å‚æ•°ä¸­ï¼Œè·å– oplog.rs å¯¹åº”ç£ç›˜ wt æ–‡ä»¶åå¯ä»¥é€šè¿‡db.serverstatus().wiredTiger.uri è¿™ä¸ªæ¥å£è·å–ï¼Œserver å±‚ backup æ¥å£å¦‚ä¸‹:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06150a1f9e2b4af9a3f7ef1789942196~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=VNntrWubKgPexHEv1Jqa84umprE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4edbde53eee4d0e876033f52e4375f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=88YXgJbcVrUrJvrlcVNCbi96vwY%3D" alt="image.png" loading="lazy"/></p>
<p>Server é€‚é…è¯¥æ–°åŠŸèƒ½å¯åŠ¨ mongod èŠ‚ç‚¹ï¼Œå‘ç°å¯åŠ¨æŠ¥é”™ï¼Œæ— æ³•æ‰¾åˆ° oplog.rs å¯¹åº”çš„ wt æ–‡ä»¶ã€‚é€šè¿‡èµ°è¯»ä»£ç ï¼Œå¯ä»¥ç¡®è®¤è¯¥é—®é¢˜æ˜¯å› ä¸º mongod å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå¯¹ server å±‚ç®¡ç†çš„ wt å…ƒæ•°æ®åšäºŒæ¬¡æ£€æŸ¥(ä¸»è¦æ˜¯ _mdb_catalog.wt å’ŒsizeStorer.wt)ï¼Œè¿™ä¸¤ä¸ª wt æ–‡ä»¶å­˜å‚¨çš„æ˜¯ server å±‚ç”¨æ¥ç»´æŠ¤è¡¨ä¿¡æ¯ã€ç´¢å¼•ä¿¡æ¯ä»¥åŠæ¯ä¸ªè¡¨ count æ•°ã€‚</p>
<p>â— _mdb_catalog.wt Â æ–‡ä»¶ä¸­çš„æ•°æ®å†…å®¹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18584cbc96d644d28b2edb71774cd530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=0xV%2F8uF%2BPss6ahSIExbKNQH%2Btyw%3D" alt="image.png" loading="lazy"/></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ_mdb_catalog.wt å­˜å‚¨ç€è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ä»¥åŠè¯¥è¡¨åˆ›å»ºçš„ç´¢å¼•ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ç”± server å±‚å†™å…¥ wiredtiger å¼•æ“ã€‚</p>
<p>â— sizeStorer.wt æ–‡ä»¶ä¸­çš„æ•°æ®å†…å®¹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44f2676c30441e99129def29cb7c845~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5pWw5o2u5bqT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558475&amp;x-signature=OjBtYjuIqDliOvrzB%2FYgw8HjOPs%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡Œçš„ key ä¸€ä¸€å¯¹åº”ä¸€ä¸ªå…·ä½“çš„è¡¨ï¼Œæ¯ä¸ª value å­˜å‚¨è¯¥è¡¨ä¸­çš„æ•°æ®æ€»å¤§å°ä»¥åŠæ•°æ®æ¡æ•°ï¼ŒèŠ‚ç‚¹é‡å¯çš„æ—¶å€™ï¼Œè¡¨çš„ count å°±æ˜¯ä»è¿™ä¸ª wt æ–‡ä»¶è·å–çš„ã€‚</p>
<p>ç”±äº wiredTiger å¼•æ“ä¾§æˆ‘ä»¬é€šè¿‡ exclude_target åˆ é™¤äº† oplog.rs è¡¨å¯¹åº”çš„ wtæ–‡ä»¶ï¼Œä½†æ˜¯ mongo server ä¾§åœ¨ _mdb_catalog.wt å’Œ sizeStorer.wt ä¸¤ä¸ªæ–‡ä»¶ä¸­ç»´æŠ¤ç€è¡¨ã€ç´¢å¼•ã€æ•°æ®é‡ç›¸å…³å…ƒæ•°æ®ã€‚Mongod å¯åŠ¨çš„æ—¶å€™ä¼šåŠ è½½è¿™ä¸¤ä¸ª wt æ–‡ä»¶è·å–åˆ°å¯¹åº”çš„è¡¨ï¼Œç„¶åå»æ£€æŸ¥è¿™äº›è¡¨æ˜¯å¦å­˜åœ¨ã€‚ç”±äº wiredTiger å¼•æ“ä¾§åˆ é™¤äº†oplog.rs å¯¹åº”çš„ wt æ–‡ä»¶ï¼Œå› æ­¤ mongo server ä¾§æ£€æŸ¥ä¸é€šè¿‡ã€‚</p>
<p>è…¾è®¯äº‘ MongoDB å†…æ ¸é™¤äº†åœ¨ wiredTiger å­˜å‚¨å¼•æ“ä¾§é€šè¿‡ exclude_target åŠŸèƒ½æ–°å¢åŠŸèƒ½å‰”é™¤äº† oplog.rs è¡¨ï¼ŒåŒæ—¶ server ä¾§ä¿®å¤äº† mongo server ç»´æŠ¤çš„oplog.rs ç›¸å…³æ£€æŸ¥ï¼Œæœ€ç»ˆè§£å†³äº† wiredtiger å¼•æ“æµ‹å’Œ mongo server æµ‹å¯åŠ¨å¤±è´¥çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-18">5 ç»“è¯­</h2>
<blockquote>
<p>è…¾è®¯äº‘ MongoDB é€šè¿‡æ‰“é€ æœ‰ç‰¹è‰²çš„äº§å“åŠŸèƒ½ã€è¿›è¡Œæ·±åº¦çš„å†…æ ¸ä¼˜åŒ–å’Œåˆ›æ–°ï¼Œä»¥åŠæä¾›æ›´æè‡´çš„æœåŠ¡ï¼Œé€æ­¥æ„å»ºèµ·è‡ªèº«çš„å·®å¼‚åŒ–ä¼˜åŠ¿ï¼Œè‡´åŠ›äºä¸ºç”¨æˆ·å¸¦æ¥äº†ä¸šç•Œé¡¶çº§çš„çš„æ•°æ®åº“æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œæœªæ¥ï¼Œè…¾è®¯äº‘ MongoDB ä¹Ÿå°†åœ¨ä¸æ–­æå‡äº§å“æ€§èƒ½ä¸å¯é æ€§çš„åŒæ—¶ï¼Œåˆ‡å®ä¸ºå®¢æˆ·å¸¦æ¥æ›´ä¼˜çš„ç»æµæ•ˆç›Šä¸æ›´æµç•…çš„è¿ç»´ä½“éªŒã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React useTransition å…¨ç½‘æœ€é€šä¿—æ·±åº¦è®²è§£ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½è®©é¡µé¢â€œä¸å¡â€ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575751471841902628</link>    <guid>https://juejin.cn/post/7575751471841902628</guid>    <pubDate>2025-11-24T03:08:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575751471841902628" data-draft-id="7575367791274410022" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React useTransition å…¨ç½‘æœ€é€šä¿—æ·±åº¦è®²è§£ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½è®©é¡µé¢â€œä¸å¡â€ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-11-24T03:08:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤šå•¦Cæ¢¦a"/> <meta itemprop="url" content="https://juejin.cn/user/2640348698905129"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React useTransition å…¨ç½‘æœ€é€šä¿—æ·±åº¦è®²è§£ï¼šä¸ºä»€ä¹ˆå®ƒèƒ½è®©é¡µé¢â€œä¸å¡â€ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2640348698905129/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤šå•¦Cæ¢¦a
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:08:25.000Z" title="Mon Nov 24 2025 03:08:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<h2 data-id="heading-0">å‰è¨€ï¼šä¸ºä»€ä¹ˆä½ çš„é¡µé¢ä¼šâ€œå¡ä¸€ä¸‹â€ï¼Ÿ</h2>
<p>ä½ ä¸€å®šé‡åˆ°è¿‡è¿™ç§æƒ…å½¢ï¼š</p>
<ul>
<li>è¾“å…¥æ¡†ä¸€è¾“å…¥å†…å®¹ï¼Œé¡µé¢å¡é¡¿ 0.5 ç§’</li>
<li>åˆ‡æ¢ Tab æ—¶ï¼Œå†…å®¹åŒºåŸŸåŠ è½½å¾ˆä¹…ï¼ŒUIâ€œé¡¿äº†ä¸€ä¸‹â€</li>
<li>æœç´¢æ—¶ï¼Œåˆ—è¡¨æ•°æ®å¾ˆå¤šï¼Œç•Œé¢ç›´æ¥â€œå¡æ­»ä¸¤ç§’â€</li>
</ul>
</blockquote>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼š<br/>
â€œReact ä¸æ˜¯å·ç§°å¾ˆå¿«å—ï¼Ÿæ€ä¹ˆè¿˜å¡ï¼Ÿâ€</p>
<p>åŸå› å…¶å®å¾ˆç®€å•ï¼š</p>
<blockquote>
<p><strong>React ä¼šæŠŠæ‰€æœ‰çŠ¶æ€æ›´æ–°ä¸€æ¬¡æ€§åŒæ­¥åœ°æ¸²æŸ“ã€‚ä½ æ”¹äº† stateï¼Œå®ƒå°±èµ¶ç´§æ¸²æŸ“ï¼Œä¸ç®¡è¿™æ˜¯ä¸æ˜¯ç´§æ€¥çš„ã€‚</strong></p>
</blockquote>
<p>æ‰€ä»¥å¦‚æœä½ è¾“å…¥æ¡†è§¦å‘çš„æ¸²æŸ“å¾ˆé‡ï¼ˆæ¯”å¦‚åˆ—è¡¨ 5000 æ¡ï¼‰ï¼Œé‚£è¾“å…¥å°±ä¼šå¡ã€‚</p>
<p>ä¸ºäº†ç»™å¼€å‘è€…æ›´ç»†ç²’åº¦çš„æ§åˆ¶â€”â€”<br/>
React æä¾›äº† <strong>useTransition</strong>ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒç›®çš„å°±ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>è®©â€œä¸ç€æ€¥çš„æ›´æ–°ï¼Œé è¾¹ç«™â€ï¼Œä¼˜å…ˆä¿è¯â€œç€æ€¥çš„æ›´æ–°â€ä¸è¢«å¡ä½ã€‚</strong></p>
</blockquote>
<p>è¿™ä¸ªç†å¿µæ˜¯ React18 ä¹‹åâ€œå¹¶å‘ç‰¹æ€§â€çš„æ ¸å¿ƒä¹‹ä¸€ã€‚</p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€ç« ï¼šuseTransition åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<h3 data-id="heading-2">1. å®ƒä¸æ˜¯åŠ é€Ÿå™¨</h3>
<p>å®ƒä¸ä¼šè®©æ¸²æŸ“æ›´å¿«ï¼Œä¹Ÿä¸ä¼šå‡å°‘è®¡ç®—é‡ã€‚</p>
<h3 data-id="heading-3">2. å®ƒæ˜¯â€œä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦å™¨â€</h3>
<p>æŠŠæ›´æ–°åˆ†æˆä¸¤ç±»ï¼š</p>




















<table><thead><tr><th>ç±»å‹</th><th>ç¤ºä¾‹</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>ğŸ <strong>Urgentï¼ˆç´§æ€¥æ›´æ–°ï¼‰</strong></td><td>è¾“å…¥æ¡†è¾“å…¥ã€ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€åˆ‡æ¢è¾“å…¥æ³•</td><td>å¿…é¡»é©¬ä¸Šæ›´æ–°ï¼Œå¦åˆ™å¡é¡¿</td></tr><tr><td>ğŸ‰ <strong>Transitionï¼ˆè¿‡æ¸¡æ›´æ–°ï¼‰</strong></td><td>è¿‡æ»¤åˆ—è¡¨ã€åŠ è½½æ–°ç•Œé¢ã€åˆ‡æ¢å¤§è§†å›¾ï¼Œé•¿åˆ—è¡¨é‡æ–°æ¸²æŸ“</td><td>å¯ä»¥å»¶è¿Ÿï¼Œä¸æ€¥</td></tr></tbody></table>
<p>ç”¨æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[isPending, startTransition]</span> = <span class="hljs-built_in">useTransition</span>()

<span class="hljs-built_in">startTransition</span>(() =&gt; {
  <span class="hljs-comment">// è¿™é‡Œé¢çš„æ›´æ–°ä¼šè¢«æ ‡è®°ä¸ºâ€œéç´§æ€¥â€</span>
})
</code></pre>
<p>å› æ­¤ï¼ŒReact ä¼šï¼š</p>
<ul>
<li><strong>å…ˆå¤„ç†ç´§æ€¥æ›´æ–°ï¼ˆä¿æŒ UI æµç•…ï¼‰</strong></li>
<li><strong>å†â€œæ…¢æ…¢å¤„ç†â€è¿™äº›ä¸ç´§æ€¥çš„æ¸²æŸ“</strong></li>
</ul>
<p>è¿™å°±æ˜¯ â€œä¸å¡é¡¿â€ çš„æ ¹æœ¬åŸå› ã€‚</p>
<hr/>
<h2 data-id="heading-4">ğŸ§ª ç¬¬äºŒç« ï¼šæå…¶ç›´è§‚çš„å°ç™½ç¤ºä¾‹ï¼šä¸ºä»€ä¹ˆä¸å¡ï¼Ÿ</h2>
<p>å‡è®¾ä½ åšä¸€ä¸ªæœç´¢è¿‡æ»¤ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;input <span class="hljs-attr">value</span>={text} <span class="hljs-literal">on</span>Change={e =&gt; setText(e.target.value)} /&gt;
&lt;List <span class="hljs-attr">data</span>={filterBigList(text)} /&gt;
</code></pre>
<p><code>filterBigList(text)</code> ç‰¹åˆ«è€—æ—¶<br/>
ï¼ˆæ¯”å¦‚å‡ åƒæ¡æ•°æ®ï¼‰</p>
<p>é‚£ä¹ˆæ¯æ¬¡è¾“å…¥æ–‡å­—ï¼Œéƒ½ä¼šï¼š</p>
<ol>
<li>æ›´æ–° text</li>
<li>filter å¤§æ•°æ®åˆ—è¡¨</li>
<li>é‡æ–°æ¸²æŸ“å¤§åˆ—è¡¨</li>
</ol>
<p>ç»“æœå°±æ˜¯ï¼š</p>
<ul>
<li>è¾“å…¥æ³•å¡</li>
<li>é¡µé¢å¡</li>
<li>æ¸²æŸ“è·Ÿä¸ä¸Šç”¨æˆ·è¾“å…¥</li>
</ul>
<p>ç°åœ¨ç”¨ useTransitionï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = e =&gt; {
  <span class="hljs-keyword">const</span> v = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
  <span class="hljs-title function_">setText</span>(v);  <span class="hljs-comment">// ç´§æ€¥æ›´æ–°ï¼Œè¾“å…¥æ¡†åŠ¨ä½œå¿…é¡»é©¬ä¸Šåæ˜ </span>

  <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-title function_">setFiltered</span>(<span class="hljs-title function_">filterBigList</span>(v)); <span class="hljs-comment">// ä¸ç´§æ€¥</span>
  });
};
</code></pre>
<p>ç»“æœï¼š</p>
<ul>
<li>è¾“å…¥æ¡†ç«‹åˆ»æ›´æ–°ï¼ˆæµç•…ï¼‰</li>
<li>filter çš„è®¡ç®—è¢«å®‰æ’åœ¨ä½ä¼˜å…ˆçº§ï¼Œä¸é˜»å¡ UI</li>
<li>åˆ—è¡¨å…ˆæ˜¾ç¤ºæ—§çš„ï¼Œç­‰è®¡ç®—å®Œå†æ˜¾ç¤ºæ–°çš„</li>
</ul>
<hr/>
<h2 data-id="heading-5">âš¡ ç¬¬ä¸‰ç« ï¼šä¸ºä»€ä¹ˆ useTransition èƒ½åˆ†ç±»æ›´æ–°ï¼Ÿ</h2>
<p>å› ä¸º React18 æœ‰äº† <strong>å¯ä¸­æ–­æ¸²æŸ“ï¼ˆinterruptible renderingï¼‰</strong> ã€‚</p>
<p>ä»¥å‰ React æ˜¯åŒæ­¥æ¸²æŸ“ï¼š</p>
<blockquote>
<p>â€œä½ è®©æˆ‘æ¸²æŸ“ 5000 æ¡ï¼Ÿé‚£æˆ‘å¼€å§‹åšï¼Œç­‰æˆ‘åšå®Œæ‰èƒ½å“åº”ç”¨æˆ·è¾“å…¥ã€‚â€</p>
</blockquote>
<p>ç°åœ¨æ˜¯ï¼š</p>
<blockquote>
<p>â€œæˆ‘å…ˆæ¸²æŸ“ä½ è¿™ä¸€é”®çš„è¾“å…¥ï¼ˆç´§æ€¥ï¼‰ï¼Œè‡³äºä½ è¿‡æ»¤åˆ—è¡¨é‚£ç©æ„å„¿ï¼Œæˆ‘ç¨åå†å¼„ï¼Œä¸ç€æ€¥ã€‚â€</p>
</blockquote>
<p><strong>æ¸²æŸ“ä»»åŠ¡å¯è¢«æå‰æ‰“æ–­ï¼Œè¿™æ˜¯å¹¶å‘ç‰¹æ€§çš„æ ¸å¿ƒã€‚</strong></p>
<p>ä½ æŒ‰é”®çš„æ—¶å€™ï¼ŒReact è®¤ä¸ºâ€œè¾“å…¥å“åº”ä¼˜å…ˆäºæ¸²æŸ“å¤§åˆ—è¡¨â€ï¼Œæ‰€ä»¥å®ƒä¼šï¼š</p>
<ul>
<li>åœ â†’ æŠ›å¼ƒå½“å‰éç´§æ€¥æ¸²æŸ“</li>
<li>å…ˆåš â†’ è¾“å…¥æ¡†çš„ UI æ›´æ–°</li>
<li>å†åš â†’ éç´§æ€¥æ¸²æŸ“</li>
</ul>
<p>è¿™å°±æ˜¯ useTransition çš„é­”æ³•æ¥æºã€‚</p>
<hr/>
<h2 data-id="heading-6">ğŸ§© ç¬¬å››ç« ï¼šuseTransition çš„è¯¦ç»†ç”¨æ³•ä¸ API è§£æ</h2>
<h3 data-id="heading-7">4.1 åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[isPending, startTransition]</span> = <span class="hljs-built_in">useTransition</span>();
</code></pre>
<h4 data-id="heading-8">ğŸ¥ <code>startTransition(fn)</code></h4>
<p>æŠŠ fn å†…çš„çŠ¶æ€æ›´æ–°å˜æˆéç´§æ€¥ã€‚</p>
<h4 data-id="heading-9">ğŸ‹ <code>isPending</code></h4>
<p>è¡¨ç¤ºâ€œéç´§æ€¥æ›´æ–°æ­£åœ¨è¿›è¡Œä¸­â€ã€‚</p>
<p>å¸¸ç”¨æ¥æ˜¾ç¤º loadingï¼š</p>
<pre><code class="hljs language-css" lang="css">{isPending &amp;&amp; &lt;<span class="hljs-selector-tag">span</span>&gt;åŠ è½½ä¸­...&lt;/<span class="hljs-selector-tag">span</span>&gt;}
</code></pre>
<hr/>
<h3 data-id="heading-10">4.2 ç¤ºä¾‹å®Œæ•´ç‰ˆ</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [list, setList] = <span class="hljs-title function_">useState</span>(bigList);
  <span class="hljs-keyword">const</span> [isPending, startTransition] = <span class="hljs-title function_">useTransition</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = e =&gt; {
    <span class="hljs-keyword">const</span> v = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
    <span class="hljs-title function_">setQuery</span>(v);            <span class="hljs-comment">// åŒæ­¥æ›´æ–°è¾“å…¥æ¡†</span>

    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> filtered = bigList.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-title function_">includes</span>(v));
      <span class="hljs-title function_">setList</span>(filtered);    <span class="hljs-comment">// å¼‚æ­¥ã€å»¶è¿Ÿã€ä¸ç´§æ€¥</span>
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{query}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span>
      {isPending &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åŠ è½½ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      <span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{list}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h2 data-id="heading-11">ğŸ§¬ ç¬¬äº”ç« ï¼šä¸‰ç§æƒ…å†µä¸‹å¿…é¡»ç”¨ useTransition</h2>
<p>ä½ åªè¦çœ‹åˆ°ä¸‹é¢ä¸‰ç§æƒ…å†µï¼Œå°±åº”è¯¥è€ƒè™‘ useTransitionã€‚</p>
<hr/>
<h3 data-id="heading-12">5.1 æƒ…å†µä¸€ï¼šè¾“å…¥æ¡†å¯¼è‡´é¡µé¢å¡é¡¿ï¼ˆæœ€å¸¸è§ï¼‰</h3>
<p>åœºæ™¯ï¼šè¾“å…¥æ¡† â†’ è§¦å‘å¤§é‡æ¸²æŸ“ â†’ è¾“å…¥å¡é¡¿<br/>
è§£å†³ï¼šç”¨ useTransition æŠŠé‡æ¸²æŸ“ä¸¢åˆ°ä½ä¼˜å…ˆçº§ã€‚</p>
<hr/>
<h3 data-id="heading-13">5.2 æƒ…å†µäºŒï¼šTab åˆ‡æ¢å¯¼è‡´å¤§é¡µé¢æ¸²æŸ“</h3>
<p>æ¯”å¦‚åˆ‡æ¢ Tab ä¼šæ¸²æŸ“ä¸€ä¸ªå¾ˆå¤§çš„ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">startTransition</span>(() =&gt; {
  <span class="hljs-built_in">setSelectedTab</span>(tab)
})
</code></pre>
<p>ä½ ä¼šå‘ç° UI æµç•…å¾—åƒæ²¡äº‹ä¸€æ ·ã€‚</p>
<hr/>
<h3 data-id="heading-14">5.3 æƒ…å†µä¸‰ï¼šé•¿åˆ—è¡¨é‡æ–°æ¸²æŸ“</h3>
<p>é•¿åˆ—è¡¨ + è¿‡æ»¤ã€åˆ‡æ¢æ’åºã€åˆ‡æ¢è§†å›¾å¸ƒå±€</p>
<p>è¿™äº›éƒ½æ˜¯éç´§æ€¥æ›´æ–° â†’ å¿…ç”¨ useTransitionã€‚</p>
<hr/>
<h2 data-id="heading-15">ğŸ›‘ ç¬¬å…­ç« ï¼šuseTransition ä¸é€‚ç”¨çš„åœ°æ–¹ï¼ˆå®¹æ˜“è¸©å‘ï¼‰</h2>
<p>æœ‰äº›åœ°æ–¹ä½ ç»ä¸èƒ½ç”¨å®ƒï¼</p>
<hr/>
<h3 data-id="heading-16">âŒ 6.1 è¡¨å•çœŸå®å€¼ä¸èƒ½æ”¾åœ¨ transition å†…æ›´æ–°</h3>
<p>é”™è¯¯ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">startTransition</span>(() =&gt; {
  <span class="hljs-built_in">setInputValue</span>(x)
})
</code></pre>
<p>ç»“æœï¼š</p>
<ul>
<li>è¾“å…¥ä¼šå»¶è¿Ÿ</li>
<li>React æ•…æ„â€œæ…¢æ…¢æ›´æ–°â€</li>
</ul>
<p>æ­£ç¡®ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setInputValue</span>(x)
</code></pre>
<hr/>
<h3 data-id="heading-17">âŒ 6.2 ä¸èƒ½ç”¨äºå¿…é¡»ç«‹å³æ›´æ–°çš„ UI</h3>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>æäº¤è¡¨å•ç»“æœ</li>
<li>å¼¹å‡º Modal</li>
<li>æç¤ºé”™è¯¯ä¿¡æ¯</li>
</ul>
<p>è¿™äº›éƒ½å±äºâ€œç´§æ€¥æ›´æ–°â€ï¼Œä¸èƒ½å»¶è¿Ÿã€‚</p>
<hr/>
<h2 data-id="heading-18">ğŸ” ç¬¬ä¸ƒç« ï¼šæ·±å…¥åŸç†ï¼ˆå¯å½“é¢è¯•é¢˜ï¼‰</h2>
<p>é¢è¯•å®˜å¸¸é—®ï¼š</p>
<h4 data-id="heading-19">â“ useTransition æ˜¯å¦‚ä½•å®ç°â€œä½ä¼˜å…ˆçº§æ¸²æŸ“â€çš„ï¼Ÿ</h4>
<p>æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š</p>
<ol>
<li>startTransition å†…çš„æ›´æ–°ä¼šè¢«æ ‡è®°ä¸º <code>transition lane</code></li>
<li>React åœ¨è°ƒåº¦æ›´æ–°æ—¶ï¼Œä¼šæ ¹æ® Lane ä¼˜å…ˆçº§è°ƒåº¦</li>
<li>transition laneï¼ˆä½ä¼˜å…ˆçº§ï¼‰æ¸²æŸ“æ—¶ï¼Œå¯ä»¥è¢«æ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¸­æ–­</li>
<li>æ–°ä»»åŠ¡è¿›æ¥åï¼Œä½ä¼˜å…ˆçº§æ¸²æŸ“è¢«ä¸¢å¼ƒ</li>
<li>ç­‰ç´§æ€¥ä»»åŠ¡å®Œæˆåï¼Œå†ç»§ç»­ä½ä¼˜å…ˆçº§ä»»åŠ¡</li>
</ol>
<p>ä¹Ÿå°±æ˜¯ï¼š</p>
<blockquote>
<p>ä»»åŠ¡ä¼˜å…ˆçº§ + å¯ä¸­æ–­æ¸²æŸ“ + Lane æ¨¡å‹ = useTransition</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">â“ useTransition å’Œ useDeferredValue å·®åˆ«ï¼Ÿ</h3>
<p>éå¸¸é«˜é¢‘é¢è¯•é¢˜ï¼</p>

















<table><thead><tr><th>Hook</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong>useTransition</strong></td><td>æŠŠä¸€æ®µæ›´æ–°æ ‡è®°æˆä½ä¼˜å…ˆçº§</td></tr><tr><td><strong>useDeferredValue</strong></td><td>å»¶è¿Ÿä¸€ä¸ªå€¼ï¼Œä¸å½±å“å…¶ä½™ç»„ä»¶</td></tr></tbody></table>
<p>ä¾‹å­ï¼š</p>
<ul>
<li>æœç´¢æ¡†ï¼šç”¨ useDeferredValue</li>
<li>ç‚¹å‡» Tab åˆ‡æ¢å¤§é¡µé¢ï¼šç”¨ useTransition</li>
<li>æ¸²æŸ“å¤§åˆ—è¡¨ï¼šéƒ½èƒ½ç”¨ï¼Œä½†ä¸€èˆ¬ prefer Transition</li>
</ul>
<hr/>
<h2 data-id="heading-21">ğŸ’¥ ç¬¬å…«ç« ï¼šä½ è§è¿‡æœ€ç›´è§‚çš„ç¤ºä¾‹ï¼šæ²¡æœ‰ useTransition vs æœ‰ useTransition</h2>
<h3 data-id="heading-22">ğŸ® æ²¡ç”¨ useTransition</h3>
<p>ä½ å¿«é€Ÿæ‰“å­—ï¼š</p>
<ul>
<li>è¾“å…¥æ¡†å¡å¡å¡</li>
<li>CPU å æ»¡</li>
<li>è¾“å…¥å…‰æ ‡è·³åŠ¨å¡é¡¿</li>
</ul>
<h3 data-id="heading-23">ğŸ  ç”¨äº† useTransition</h3>
<p>ä½ å¿«é€Ÿæ‰“å­—ï¼š</p>
<ul>
<li>è¾“å…¥æ¡†å§‹ç»ˆæµç•…</li>
<li>åˆ—è¡¨ç¨ååŠ è½½</li>
<li>UI å®Œå…¨ä¸å¡</li>
</ul>
<p>è¿™å°±æ˜¯ <strong>ä¼˜å…ˆçº§è°ƒåº¦</strong> çš„å¨åŠ›ã€‚</p>
<hr/>
<h2 data-id="heading-24">ğŸ¯ ç¬¬ä¹ç« ï¼šuseTransition çš„æœ€ä½³å®è·µï¼ˆå¤§å‚å¸¸ç”¨å†™æ³•ï¼‰</h2>
<h4 data-id="heading-25">âœ” è¾“å…¥æ¡†é‡Œæ°¸è¿œåªæ”¾ç´§æ€¥æ›´æ–°</h4>
<h4 data-id="heading-26">âœ” å¤§è®¡ç®—/å¤§æ¸²æŸ“ä¸€å®šæ”¾ transition</h4>
<h4 data-id="heading-27">âœ” isPending åš loading å ä½</h4>
<h4 data-id="heading-28">âœ” åˆ—è¡¨å¤šæ—¶ï¼Œå¯æ­é…è™šæ‹Ÿåˆ—è¡¨ï¼ˆreact-windowï¼‰</h4>
<h4 data-id="heading-29">âœ” ä¸è¦è¿‡åº¦ä½¿ç”¨ï¼Œå¦åˆ™ UI ä¸åŒæ­¥åè€Œå¥‡æ€ª</h4>
<hr/>
<h2 data-id="heading-30">ğŸ ç»“å°¾æ€»ç»“ï¼ˆæœ€é¢è¯•çš„é‚£ä¸€å¥ï¼‰</h2>
<p>å¦‚æœé¢è¯•å®˜é—®ä½ ï¼š</p>
<blockquote>
<p>React18 çš„ useTransition æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
</blockquote>
<p>ä½ å¯ä»¥è¿™æ ·ç­”ï¼š</p>
<blockquote>
<p><strong>å®ƒæä¾›äº†ä¸€ç§æŠŠâ€œä¸ç´§æ€¥æ¸²æŸ“â€æ”¾åˆ°ä½ä¼˜å…ˆçº§æ‰§è¡Œçš„æ–¹å¼ï¼Œä¾èµ– React18 çš„å¹¶å‘ç‰¹æ€§å’Œå¯ä¸­æ–­æ¸²æŸ“æœºåˆ¶ï¼Œé€šè¿‡ startTransition åŒ…è£¹çš„æ›´æ–°å¯ä»¥è¢«ç´§æ€¥ä»»åŠ¡æ‰“æ–­ï¼Œä»è€Œä¿è¯ç”¨æˆ·äº¤äº’ï¼ˆå¦‚è¾“å…¥ã€ç‚¹å‡»ï¼‰ä¿æŒæµç•…ã€‚</strong></p>
</blockquote>
<p>ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>useTransition èƒ½è®© UI ä¿æŒæµç•…ï¼Œæ˜¯å› ä¸º React18 å¼•å…¥äº†å¹¶å‘æ›´æ–°æœºåˆ¶ï¼Œå…è®¸çŠ¶æ€æ›´æ–°æ ¹æ®ä¼˜å…ˆçº§è°ƒåº¦ã€‚è¢« startTransition åŒ…è£¹çš„æ›´æ–°å±äºä½ä¼˜å…ˆçº§ï¼Œæ¸²æŸ“å¯ä»¥è¢«ä¸­æ–­ã€ä¸¢å¼ƒæˆ–å»¶åæ‰§è¡Œï¼Œä»è€Œä¸é˜»å¡é«˜ä¼˜å…ˆçº§çš„ç”¨æˆ·è¾“å…¥ç­‰äº¤äº’ä»»åŠ¡ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Scala è®¿é—®æƒé™è¯¦è§£ï¼šprivateã€protected ä¸ private]]></title>    <link>https://juejin.cn/post/7575533124877762587</link>    <guid>https://juejin.cn/post/7575533124877762587</guid>    <pubDate>2025-11-24T02:05:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575533124877762587" data-draft-id="7575412016405479434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Scala è®¿é—®æƒé™è¯¦è§£ï¼šprivateã€protected ä¸ private"/> <meta itemprop="keywords" content="Scala,åç«¯,ç¼–ç¨‹è¯­è¨€"/> <meta itemprop="datePublished" content="2025-11-24T02:05:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»Šå¤©æ²¡æœ‰ç›"/> <meta itemprop="url" content="https://juejin.cn/user/1408937846645355"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Scala è®¿é—®æƒé™è¯¦è§£ï¼šprivateã€protected ä¸ private
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1408937846645355/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»Šå¤©æ²¡æœ‰ç›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:05:25.000Z" title="Mon Nov 24 2025 02:05:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¯¼å…¥</h2>
<p>åœ¨ Scala é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œè®¿é—®æƒé™æ§åˆ¶æ˜¯å°è£…æ€§çš„é‡è¦ä½“ç°ã€‚é€šè¿‡åˆç†çš„è®¿é—®æƒé™è®¾ç½®ï¼Œå¯ä»¥ä¿æŠ¤ç±»çš„å†…éƒ¨çŠ¶æ€ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æœ¬æ–‡å°†è¯¦ç»†è®²è§£ Scala ä¸­çš„ä¸‰ç§ä¸»è¦è®¿é—®æƒé™ï¼šprivateã€protected å’Œ private[this]ï¼Œå¹¶é€šè¿‡å…·ä½“ä»£ç ç¤ºä¾‹å±•ç¤ºå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å’ŒåŒºåˆ«ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€private è®¿é—®æƒé™</h2>
<h3 data-id="heading-2">å®šä¹‰</h3>
<p>private æ˜¯ Scala ä¸­æœ€ä¸¥æ ¼çš„è®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼Œç”¨äºé™åˆ¶æˆå‘˜åªèƒ½åœ¨ç‰¹å®šèŒƒå›´å†…è®¿é—®ã€‚</p>
<h3 data-id="heading-3">è¯­æ³•ç‰¹ç‚¹</h3>
<ul>
<li>åœ¨ç±»çš„å†…éƒ¨å¯ä»¥è®¿é—®</li>
<li>åœ¨ç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®</li>
<li>åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å¯ä»¥è®¿é—®</li>
</ul>
<h3 data-id="heading-4">ç¤ºä¾‹ï¼šprivate åŸºæœ¬ä½¿ç”¨</h3>
<h4 data-id="heading-5">ä»£ç </h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> level02

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">base3101</span> </span>{

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>(<span class="hljs-params">var name: <span class="hljs-type">String</span>, private var age: <span class="hljs-type">Int</span></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say</span></span>(): <span class="hljs-type">Unit</span> = {
      println(<span class="hljs-string">s"<span class="hljs-subst">${this.age}</span>"</span>) <span class="hljs-comment">//ï¼ˆ1ï¼‰åœ¨ç±»çš„å†…éƒ¨å¯ä»¥è®¿é—®ã€‚</span>
    }
  }

  <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Student</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span></span>(student: <span class="hljs-type">Student</span>): <span class="hljs-type">Unit</span> = {
      println(student.age) <span class="hljs-comment">//ï¼ˆ3ï¼‰åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å¯ä»¥è®¿é—®ã€‚</span>
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">"å°èŠ±"</span>, <span class="hljs-number">18</span>)
    s1.say()
    <span class="hljs-comment">// println(s1.age) // æŠ¥é”™ã€‚ï¼ˆ2ï¼‰åœ¨ç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®ã€‚</span>
    <span class="hljs-type">Student</span>.test(s1)
  }
}
</code></pre>
<h4 data-id="heading-6">ç»“æœå±•ç¤º</h4>
<pre><code class="hljs">18
18
</code></pre>
<h4 data-id="heading-7">ä»£ç åˆ†æ</h4>
<ul>
<li>åœ¨ <code>Student</code> ç±»çš„ <code>say</code> æ–¹æ³•ä¸­ï¼Œå¯ä»¥ç›´æ¥è®¿é—® <code>private var age</code>ï¼Œä½“ç°äº†"åœ¨ç±»çš„å†…éƒ¨å¯ä»¥è®¿é—®"</li>
<li>åœ¨ <code>main</code> æ–¹æ³•ä¸­ï¼Œæ³¨é‡Šæ‰çš„ <code>println(s1.age)</code> ä¼šç¼–è¯‘æŠ¥é”™ï¼Œä½“ç°äº†"åœ¨ç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®"</li>
<li>åœ¨ä¼´ç”Ÿå¯¹è±¡ <code>Student</code> çš„ <code>test</code> æ–¹æ³•ä¸­ï¼Œå¯ä»¥è®¿é—® <code>student.age</code>ï¼Œä½“ç°äº†"åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å¯ä»¥è®¿é—®"</li>
</ul>
<h2 data-id="heading-8">äºŒã€protected è®¿é—®æƒé™</h2>
<h3 data-id="heading-9">å®šä¹‰</h3>
<p>protected è®¿é—®æƒé™æ¯” private ç¨å®½æ¾ï¼Œé™¤äº†å…·å¤‡ private çš„è®¿é—®ç‰¹æ€§å¤–ï¼Œè¿˜å…è®¸åœ¨å­ç±»ä¸­è®¿é—®ã€‚</p>
<h3 data-id="heading-10">è¯­æ³•ç‰¹ç‚¹</h3>
<ul>
<li>åœ¨ç±»çš„å†…éƒ¨å¯ä»¥è®¿é—®</li>
<li>åœ¨ç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®</li>
<li>åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å¯ä»¥è®¿é—®</li>
<li>åœ¨å­ç±»ä¸­å¯ä»¥è®¿é—®ï¼ˆä¸ private çš„ä¸»è¦åŒºåˆ«ï¼‰</li>
</ul>
<h3 data-id="heading-11">ç¤ºä¾‹ï¼šprotected ä¸ç»§æ‰¿</h3>
<h4 data-id="heading-12">ä»£ç </h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> level02

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">base3102</span> </span>{

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>(<span class="hljs-params">var name: <span class="hljs-type">String</span>, private var age: <span class="hljs-type">Int</span>, protected var weight: <span class="hljs-type">Int</span></span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">say</span></span>(): <span class="hljs-type">Unit</span> = {
      println(<span class="hljs-string">s"<span class="hljs-subst">${this.age}</span>, <span class="hljs-subst">${this.weight}</span>"</span>) <span class="hljs-comment">//ï¼ˆ1ï¼‰åœ¨ç±»çš„å†…éƒ¨å¯ä»¥è®¿é—®ã€‚</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sayAge</span></span>():<span class="hljs-type">Unit</span> = {println(age)}

    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sayWeight</span></span>():<span class="hljs-type">Unit</span> = { println(weight) }
  }
  
  <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Student</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span></span>(student: <span class="hljs-type">Student</span>): <span class="hljs-type">Unit</span> = {
      println(student.weight) <span class="hljs-comment">//ï¼ˆ3ï¼‰åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å¯ä»¥è®¿é—®ã€‚</span>
    }
  }

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Major</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span>, weight: <span class="hljs-type">Int</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">Student</span>(<span class="hljs-params">name, age, weight</span>) </span>{
    <span class="hljs-comment">// åœ¨å­ç±»ä¸­é€šè¿‡ superæ¥è®¿é—®çˆ¶ç±»</span>
    <span class="hljs-comment">// sayAge()  // æŠ¥é”™ï¼ˆ4ï¼‰privateä¿®é¥°çš„ï¼Œåœ¨å­ç±»ä¸­æ— æ³•è®¿é—®ã€‚</span>
    sayWeight() <span class="hljs-comment">// æ­£å¸¸ï¼ˆ4ï¼‰protectedä¿®é¥°çš„ï¼Œåœ¨å­ç±»ä¸­å¯ä»¥è®¿é—®ã€‚</span>
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">"å°èŠ±"</span>, <span class="hljs-number">18</span>, <span class="hljs-number">100</span>)
    s1.say()
    <span class="hljs-comment">// println(s1.weight) // æŠ¥é”™ã€‚ï¼ˆ2ï¼‰åœ¨ç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®ã€‚</span>
    <span class="hljs-type">Student</span>.test(s1)
  }
}
</code></pre>
<h4 data-id="heading-13">ç»“æœå±•ç¤º</h4>
<pre><code class="hljs">18, 100
100
</code></pre>
<h4 data-id="heading-14">ä»£ç åˆ†æ</h4>
<ul>
<li><code>Student</code> ç±»ä¸­æœ‰ private çš„ <code>age</code>ã€protected çš„ <code>weight</code> å’Œ <code>sayWeight</code> æ–¹æ³•</li>
<li>åœ¨ <code>Major</code> å­ç±»ä¸­ï¼Œ<code>sayAge()</code> è°ƒç”¨ä¼šæŠ¥é”™ï¼Œå› ä¸º private æˆå‘˜åœ¨å­ç±»ä¸­ä¸å¯è®¿é—®</li>
<li><code>sayWeight()</code> è°ƒç”¨æ­£å¸¸æ‰§è¡Œï¼Œå› ä¸º protected æˆå‘˜åœ¨å­ç±»ä¸­å¯ä»¥è®¿é—®</li>
<li>åœ¨ <code>main</code> æ–¹æ³•ä¸­ç›´æ¥è®¿é—® <code>s1.weight</code> ä¼šæŠ¥é”™ï¼Œä½“ç°äº† protected æˆå‘˜åœ¨ç±»å¤–éƒ¨ä¸å¯è®¿é—®</li>
</ul>
<h2 data-id="heading-15">ä¸‰ã€private[this] è®¿é—®æƒé™</h2>
<h3 data-id="heading-16">å®šä¹‰</h3>
<p>private[this] æ˜¯ Scala ä¸­æœ€ä¸¥æ ¼çš„è®¿é—®æƒé™ï¼Œé™åˆ¶äº†æˆå‘˜åªèƒ½åœ¨å½“å‰å¯¹è±¡å®ä¾‹ä¸­è®¿é—®ã€‚</p>
<h3 data-id="heading-17">è¯­æ³•ç‰¹ç‚¹</h3>
<ul>
<li>åœ¨ç±»çš„å†…éƒ¨å¯ä»¥è®¿é—®</li>
<li>åœ¨ç±»çš„å¤–éƒ¨ä¸èƒ½è®¿é—®</li>
<li>åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­ä¸èƒ½è®¿é—®</li>
<li>åœ¨å­ç±»ä¸­ä¸èƒ½è®¿é—®</li>
</ul>
<h3 data-id="heading-18">ç¤ºä¾‹ï¼šprivate[this] çš„ä¸¥æ ¼é™åˆ¶</h3>
<h4 data-id="heading-19">ä»£ç </h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> level02

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">base3103</span> </span>{

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>(<span class="hljs-params">var name: <span class="hljs-type">String</span>, private var age: <span class="hljs-type">Int</span>, protected var weight: <span class="hljs-type">Int</span></span>) </span>{
    <span class="hljs-keyword">private</span>[<span class="hljs-keyword">this</span>] <span class="hljs-keyword">var</span> pwd = <span class="hljs-number">123</span> <span class="hljs-comment">// å¯†ç </span>
  }

  <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Student</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span></span>(student: <span class="hljs-type">Student</span>): <span class="hljs-type">Unit</span> = {
      println(student.age)     <span class="hljs-comment">// æ™®é€šçš„privateåœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­å¯ä»¥è®¿é—®</span>
      <span class="hljs-comment">// println(student.pwd) æŠ¥é”™ ï¼ˆ3ï¼‰åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­ï¼Œä¸èƒ½è®¿é—®private[this]</span>
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">"å°èŠ±"</span>, <span class="hljs-number">18</span>, <span class="hljs-number">100</span>)
    <span class="hljs-type">Student</span>.test(s1)
  }
}
</code></pre>
<h4 data-id="heading-20">ç»“æœå±•ç¤º</h4>
<pre><code class="hljs">18
</code></pre>
<h4 data-id="heading-21">ä»£ç åˆ†æ</h4>
<ul>
<li><code>pwd</code> å­—æ®µä½¿ç”¨ <code>private[this]</code> ä¿®é¥°ï¼Œåªèƒ½åœ¨å½“å‰å¯¹è±¡å®ä¾‹ä¸­è®¿é—®</li>
<li>åœ¨ä¼´ç”Ÿå¯¹è±¡ <code>Student</code> çš„ <code>test</code> æ–¹æ³•ä¸­ï¼Œå¯ä»¥è®¿é—®æ™®é€šçš„ <code>private var age</code></li>
<li>ä½†è®¿é—® <code>student.pwd</code> ä¼šç¼–è¯‘æŠ¥é”™ï¼Œä½“ç°äº† <code>private[this]</code> åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­ä¹Ÿä¸å¯è®¿é—®</li>
</ul>
<h2 data-id="heading-22">å››ã€æ¡ˆä¾‹</h2>
<h3 data-id="heading-23">ç¤ºä¾‹ï¼šä½¿ç”¨ private[this] ä¿æŠ¤è´¦æˆ·ä½™é¢</h3>
<h4 data-id="heading-24">ä»£ç </h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> level02

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">class18</span> </span>{

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bank</span>(<span class="hljs-params">private[this] var balance: <span class="hljs-type">Double</span></span>) </span>{
    <span class="hljs-comment">// å­˜é’±</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deposit</span></span>(amount: <span class="hljs-type">Double</span>): <span class="hljs-type">Unit</span> = {
      balance += amount
    }
    <span class="hljs-comment">// å–</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">withdraw</span></span>(amount: <span class="hljs-type">Double</span>): <span class="hljs-type">Unit</span> = {
      <span class="hljs-keyword">if</span> (balance &gt;= amount) {
        balance -= amount
      }
    }

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getBalance</span></span>(): <span class="hljs-type">Double</span> = balance
  }

  <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Bank</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">clear</span></span>(bank: <span class="hljs-type">Bank</span>): <span class="hljs-type">Unit</span> = {
      <span class="hljs-comment">// bank.balance = 0 // åœ¨ç¬¬11è¡Œï¼Œæ·»åŠ äº†private[this] ä¹‹åï¼Œå°±ä¸èƒ½å†ç›´æ¥è®¿é—®balanceå±æ€§</span>
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> bank = <span class="hljs-keyword">new</span> <span class="hljs-type">Bank</span>(<span class="hljs-number">100</span>)

    bank.deposit(<span class="hljs-number">1000</span>)
    bank.withdraw(<span class="hljs-number">200</span>)

    <span class="hljs-type">Bank</span>.clear(bank)
    println(bank.getBalance())
  }
}
</code></pre>
<h4 data-id="heading-25">ç»“æœå±•ç¤º</h4>
<pre><code class="hljs">900
</code></pre>
<h4 data-id="heading-26">ä»£ç åˆ†æ*</h4>
<ul>
<li><code>Bank</code> ç±»çš„ <code>balance</code> ä½¿ç”¨ <code>private[this]</code> ä¿®é¥°ï¼Œç¡®ä¿ä½™é¢åªèƒ½åœ¨å½“å‰å¯¹è±¡å®ä¾‹ä¸­è®¿é—®</li>
<li>é€šè¿‡å…¬å…±æ–¹æ³• <code>deposit</code>ã€<code>withdraw</code> å’Œ <code>getBalance</code> æ¥å®‰å…¨åœ°æ“ä½œå’ŒæŸ¥è¯¢ä½™é¢</li>
<li>åœ¨ä¼´ç”Ÿå¯¹è±¡ <code>Bank</code> çš„ <code>clear</code> æ–¹æ³•ä¸­ï¼Œç›´æ¥è®¾ç½® <code>bank.balance = 0</code> ä¼šç¼–è¯‘æŠ¥é”™</li>
<li>è¿™ç§è®¾è®¡ç¡®ä¿äº†è´¦æˆ·ä½™é¢çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å¤–éƒ¨ç›´æ¥ä¿®æ”¹</li>
</ul>
<h2 data-id="heading-27">æ€»ç»“</h2>
<p>Scala æä¾›äº†å¤šå±‚æ¬¡çš„è®¿é—®æƒé™æ§åˆ¶ï¼Œä»å®½æ¾åˆ°ä¸¥æ ¼ä¾æ¬¡ä¸ºï¼š</p>
<ol>
<li><strong>protected</strong> - å…è®¸ç±»å†…éƒ¨ã€ä¼´ç”Ÿå¯¹è±¡å’Œå­ç±»è®¿é—®</li>
<li><strong>private</strong> - å…è®¸ç±»å†…éƒ¨å’Œä¼´ç”Ÿå¯¹è±¡è®¿é—®</li>
<li><strong>private[this]</strong> - åªå…è®¸å½“å‰å¯¹è±¡å®ä¾‹è®¿é—®</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575651989986000950</link>    <guid>https://juejin.cn/post/7575651989986000950</guid>    <pubDate>2025-11-24T03:10:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575651989986000950" data-draft-id="7575937594350223403" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T03:10:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·34584828505"/> <meta itemprop="url" content="https://juejin.cn/user/3710177917545754"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3710177917545754/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·34584828505
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:10:55.000Z" title="Mon Nov 24 2025 03:10:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰å®šä¹‰äº†çº¿ç¨‹å¦‚ä½•é€šè¿‡å†…å­˜è¿›è¡Œäº¤äº’ï¼Œè§„å®šæ‰€æœ‰å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼Œçº¿ç¨‹æ“ä½œéœ€å°†å˜é‡åŠ è½½åˆ°å·¥ä½œå†…å­˜ï¼Œä¿®æ”¹åå†™å›ä¸»å†…å­˜ã€‚æ ¸å¿ƒæ˜¯è§£å†³å¤šçº¿ç¨‹å¹¶å‘æ—¶çš„åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ï¼Œé€šè¿‡ â€‹<code>â€‹volatileâ€‹</code>â€‹â€‹ã€â€‹<code>â€‹synchronizedâ€‹</code>â€‹â€‹ ç­‰å…³é”®å­—å’Œ â€‹<code>â€‹finalâ€‹</code>â€‹ ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h4 data-id="heading-0">ä¸€ã€JMM çš„æ ¸å¿ƒç›®æ ‡</h4>
<p>JMM çš„æ ¸å¿ƒç›®æ ‡æ˜¯ <strong>å®šä¹‰ç¨‹åºä¸­å˜é‡çš„è®¿é—®è§„åˆ™</strong>ï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶å‘æ—¶çš„ä¸‰å¤§æ ¸å¿ƒé—®é¢˜ï¼š</p>
<ol>
<li><strong>åŸå­æ€§</strong><br/>
æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚</li>
</ol>
<ul>
<li>ä¾‹ï¼šâ€‹<code>â€‹i++â€‹</code>â€‹ å¹¶éåŸå­æ“ä½œï¼ˆå®é™…åŒ…å«è¯»å–ã€åŠ  1ã€å†™å›ä¸‰æ­¥ï¼‰ï¼Œå¤šçº¿ç¨‹ä¸‹å¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±ã€‚</li>
<li>ä¿è¯æ–¹å¼ï¼šâ€‹<code>â€‹synchronizedâ€‹</code>â€‹ã€â€‹<code>â€‹Lockâ€‹</code>â€‹ã€â€‹<code>â€‹java.util.concurrent.atomicâ€‹</code>â€‹ åŸå­ç±»ã€‚</li>
</ul>
<ol start="2">
<li><strong>å¯è§æ€§</strong><br/>
æŒ‡ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹çš„å˜é‡å€¼ï¼Œèƒ½è¢«å…¶ä»–çº¿ç¨‹ç«‹å³æ„ŸçŸ¥åˆ°ã€‚</li>
</ol>
<ul>
<li>åŸå› ï¼šçº¿ç¨‹æ“ä½œå˜é‡æ—¶ï¼Œä¼šå…ˆå°†ä¸»å†…å­˜çš„å˜é‡åŠ è½½åˆ°è‡ªå·±çš„ <strong>å·¥ä½œå†…å­˜</strong>ï¼ˆCPU ç¼“å­˜ï¼‰ï¼Œä¿®æ”¹åä»…æ›´æ–°å·¥ä½œå†…å­˜ï¼ŒæœªåŠæ—¶å†™å›ä¸»å†…å­˜ï¼Œå¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»å–åˆ°æ—§å€¼ã€‚</li>
<li>ä¿è¯æ–¹å¼ï¼šâ€‹<code>â€‹volatileâ€‹</code>â€‹ï¼ˆå¼ºåˆ¶å†™å›ä¸»å†…å­˜å¹¶ invalidate å…¶ä»–çº¿ç¨‹çš„ç¼“å­˜ï¼‰ã€â€‹<code>â€‹synchronizedâ€‹</code>â€‹ã€â€‹<code>â€‹finalâ€‹</code>â€‹ã€‚</li>
</ul>
<ol start="3">
<li><strong>æœ‰åºæ€§</strong><br/>
æŒ‡ç¨‹åºæ‰§è¡Œçš„é¡ºåºä¸ä»£ç ç¼–å†™çš„é¡ºåºä¸€è‡´ã€‚</li>
</ol>
<ul>
<li>åŸå› ï¼šCPU ä¸ºä¼˜åŒ–æ€§èƒ½ä¼šè¿›è¡Œ <strong>æŒ‡ä»¤é‡æ’åº</strong>ï¼ˆå•çº¿ç¨‹ä¸‹ä¸å½±å“ç»“æœï¼Œä½†å¤šçº¿ç¨‹ä¸‹å¯èƒ½ç ´åä¾èµ–å…³ç³»ï¼‰ã€‚</li>
<li>ä¾‹ï¼šâ€‹<code>â€‹int a = 1; int b = 2;â€‹</code>â€‹ å¯èƒ½è¢«é‡æ’ä¸º â€‹<code>â€‹int b = 2; int a = 1;â€‹</code>â€‹ï¼Œè‹¥å¦ä¸€ä¸ªçº¿ç¨‹ä¾èµ– â€‹<code>â€‹aâ€‹</code>â€‹ å…ˆèµ‹å€¼ï¼Œåˆ™å¯èƒ½å‡ºé”™ã€‚</li>
<li>ä¿è¯æ–¹å¼ï¼šâ€‹<code>â€‹volatileâ€‹</code>â€‹ï¼ˆç¦æ­¢é‡æ’åºï¼‰ã€â€‹<code>â€‹synchronizedâ€‹</code>â€‹ã€â€‹<code>â€‹finalâ€‹</code>â€‹ï¼Œä»¥åŠ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ è§„åˆ™ã€‚</li>
</ul>
<h4 data-id="heading-1">äºŒã€JMM çš„å†…å­˜ç»“æ„æ¨¡å‹</h4>
<p>JMM æŠ½è±¡äº†çº¿ç¨‹ä¸å†…å­˜çš„äº¤äº’å…³ç³»ï¼Œå°†å†…å­˜åˆ†ä¸ºä¸¤ç±»ï¼š</p>




















<table><thead><tr><th>å†…å­˜ç±»å‹</th><th>ä½œç”¨</th><th>è®¿é—®æ–¹å¼</th></tr></thead><tbody><tr><td><strong>ä¸»å†…å­˜</strong></td><td>å­˜å‚¨æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å˜é‡ï¼ˆå®ä¾‹å˜é‡ã€é™æ€å˜é‡ï¼‰</td><td>çº¿ç¨‹éœ€é€šè¿‡å·¥ä½œå†…å­˜é—´æ¥è®¿é—®</td></tr><tr><td><strong>å·¥ä½œå†…å­˜</strong></td><td>æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ç§æœ‰å†…å­˜ï¼ˆCPU ç¼“å­˜ + å¯„å­˜å™¨ï¼‰</td><td>çº¿ç¨‹ç›´æ¥è¯»å†™ï¼Œé€Ÿåº¦å¿«</td></tr></tbody></table>
<h5 data-id="heading-2">çº¿ç¨‹æ“ä½œå˜é‡çš„æµç¨‹ï¼š</h5>
<ol>
<li>çº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–å˜é‡åˆ°å·¥ä½œå†…å­˜ï¼ˆ<strong>åŠ è½½ load</strong>ï¼‰ï¼›</li>
<li>çº¿ç¨‹åœ¨å·¥ä½œå†…å­˜ä¸­ä¿®æ”¹å˜é‡ï¼ˆ<strong>ä½¿ç”¨ use</strong>ï¼‰ï¼›</li>
<li>ä¿®æ”¹åçš„å˜é‡å†™å›ä¸»å†…å­˜ï¼ˆ<strong>å­˜å‚¨ store</strong>ï¼‰ã€‚</li>
</ol>
<p>âš ï¸ é—®é¢˜ï¼šå¤šçº¿ç¨‹å¹¶å‘æ—¶ï¼Œè‹¥å¤šä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŒä¸€å˜é‡ï¼Œå¯èƒ½å‡ºç°â€œå·¥ä½œå†…å­˜æ•°æ®ä¸ä¸€è‡´â€ï¼ˆå¦‚çº¿ç¨‹ A ä¿®æ”¹å˜é‡åæœªå†™å›ï¼Œçº¿ç¨‹ B ä»è¯»å–æ—§å€¼ï¼‰ã€‚</p>
<h4 data-id="heading-3">ä¸‰ã€JMM çš„æ ¸å¿ƒä¿éšœæœºåˆ¶</h4>
<p>JMM é€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¿è¯åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ï¼š</p>
<h5 data-id="heading-4">1. â€‹<code>â€‹volatileâ€‹</code>â€‹ å…³é”®å­—</h5>
<ul>
<li><strong>å¯è§æ€§</strong>ï¼šçº¿ç¨‹ä¿®æ”¹ â€‹<code>â€‹volatileâ€‹</code>â€‹ å˜é‡åï¼Œä¼šç«‹å³å†™å›ä¸»å†…å­˜ï¼›å…¶ä»–çº¿ç¨‹è¯»å–æ—¶ï¼Œä¼šå¼ºåˆ¶ä»ä¸»å†…å­˜åŠ è½½æœ€æ–°å€¼ï¼ˆ invalidate æœ¬åœ°ç¼“å­˜ï¼‰ã€‚</li>
<li><strong>æœ‰åºæ€§</strong>ï¼šç¦æ­¢ â€‹<code>â€‹volatileâ€‹</code>â€‹ å˜é‡å‰åçš„æŒ‡ä»¤é‡æ’åºï¼ˆé€šè¿‡å†…å­˜å±éšœå®ç°ï¼‰ã€‚</li>
<li>âŒ ä¸ä¿è¯åŸå­æ€§ï¼šä¾‹ â€‹<code>â€‹volatile int i = 0; i++â€‹</code>â€‹ ä»å¯èƒ½å‡ºç°å¹¶å‘é—®é¢˜ï¼ˆéœ€ç»“åˆåŸå­ç±»æˆ–é”ï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-5">2. â€‹<code>â€‹synchronizedâ€‹</code>â€‹ å…³é”®å­—</h5>
<ul>
<li><strong>åŸå­æ€§</strong>ï¼šä¿è¯åŒæ­¥å—å†…çš„æ“ä½œæ˜¯åŸå­çš„ï¼ˆåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰ã€‚</li>
<li><strong>å¯è§æ€§</strong>ï¼šçº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šå°†å·¥ä½œå†…å­˜çš„ä¿®æ”¹å†™å›ä¸»å†…å­˜ï¼›çº¿ç¨‹è·å–é”æ—¶ï¼Œä¼šä»ä¸»å†…å­˜åŠ è½½æœ€æ–°å˜é‡å€¼ã€‚</li>
<li><strong>æœ‰åºæ€§</strong>ï¼šåŒæ­¥å—å†…çš„æŒ‡ä»¤ç¦æ­¢é‡æ’åºï¼ˆé”çš„è·å–å’Œé‡Šæ”¾ç›¸å½“äºå†…å­˜å±éšœï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-6">3. â€‹<code>â€‹finalâ€‹</code>â€‹ å…³é”®å­—</h5>
<ul>
<li><strong>å¯è§æ€§</strong>ï¼šâ€‹<code>â€‹finalâ€‹</code>â€‹ å˜é‡åˆå§‹åŒ–åï¼Œå…¶å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼ˆåŸºæœ¬ç±»å‹ï¼‰æˆ–å¼•ç”¨ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ï¼ˆå¼•ç”¨ç±»å‹ï¼‰ï¼Œä¸”åˆå§‹åŒ–å®Œæˆåç«‹å³å¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼ˆç¦æ­¢é‡æ’åºåˆå§‹åŒ–è¿‡ç¨‹ï¼‰ã€‚</li>
<li>ä¾‹ï¼šâ€‹<code>â€‹final int a = 10;â€‹</code>â€‹ å…¶ä»–çº¿ç¨‹è¯»å– â€‹<code>â€‹aâ€‹</code>â€‹ æ—¶ï¼Œä¸€å®šèƒ½çœ‹åˆ° â€‹<code>â€‹10â€‹</code>â€‹ï¼Œä¸ä¼šå‡ºç°â€œåŠåˆå§‹åŒ–â€çŠ¶æ€ã€‚</li>
</ul>
<h5 data-id="heading-7">4. â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ è§„åˆ™ï¼ˆJMM çš„æ ¸å¿ƒï¼‰</h5>
<p>â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ æ˜¯ JMM å®šä¹‰çš„ <strong>å…ˆè¡Œå‘ç”Ÿå…³ç³»</strong>ï¼Œç”¨äºåˆ¤æ–­å¤šçº¿ç¨‹æ“ä½œçš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚è‹¥æ“ä½œ A â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ æ“ä½œ Bï¼Œåˆ™ A çš„ç»“æœå¯¹ B å¯è§ï¼Œä¸” A çš„æ‰§è¡Œé¡ºåºåœ¨ B ä¹‹å‰ã€‚</p>
<p>å¸¸ç”¨ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ è§„åˆ™ï¼š</p>
<ol>
<li><strong>ç¨‹åºé¡ºåºè§„åˆ™</strong>ï¼šåŒä¸€çº¿ç¨‹å†…ï¼Œä»£ç æŒ‰ç¼–å†™é¡ºåºæ‰§è¡Œï¼ˆå‰åºæ“ä½œ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ åç»­æ“ä½œï¼‰ã€‚</li>
<li><strong>volatile è§„åˆ™</strong>ï¼šâ€‹<code>â€‹volatileâ€‹</code>â€‹ å˜é‡çš„å†™æ“ä½œ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ åç»­çš„è¯»æ“ä½œã€‚</li>
<li><strong>é”è§„åˆ™</strong>ï¼šé”çš„é‡Šæ”¾æ“ä½œ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ åç»­çš„è·å–é”æ“ä½œã€‚</li>
<li><strong>çº¿ç¨‹å¯åŠ¨è§„åˆ™</strong>ï¼šâ€‹<code>â€‹Thread.start()â€‹</code>â€‹ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ çº¿ç¨‹å†…çš„ä»»ä½•æ“ä½œã€‚</li>
<li><strong>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™</strong>ï¼šçº¿ç¨‹å†…çš„æ‰€æœ‰æ“ä½œ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼ˆå¦‚ â€‹<code>â€‹Thread.join()â€‹</code>â€‹ å®Œæˆï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-8">å››ã€JMM çš„å®é™…åº”ç”¨åœºæ™¯</h4>
<p>JMM æ˜¯å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ï¼Œæ‰€æœ‰ Java å¹¶å‘å·¥å…·ï¼ˆå¦‚ â€‹<code>â€‹ThreadPoolExecutorâ€‹</code>â€‹ã€â€‹<code>â€‹ConcurrentHashMapâ€‹</code>â€‹ï¼‰éƒ½ä¾èµ– JMM ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h5 data-id="heading-9">å…¸å‹åœºæ™¯ï¼š</h5>
<ol>
<li><strong>çŠ¶æ€æ ‡å¿—ä½</strong>ï¼šç”¨ â€‹<code>â€‹volatile boolean flagâ€‹</code>â€‹ ä½œä¸ºçº¿ç¨‹ä¸­æ–­æˆ–çŠ¶æ€åˆ‡æ¢çš„æ ‡å¿—ï¼ˆä¿è¯å¯è§æ€§å’Œæœ‰åºæ€§ï¼‰ã€‚</li>
<li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼šåŒé‡æ£€æŸ¥é”å•ä¾‹ï¼ˆâ€‹<code>â€‹volatileâ€‹</code>â€‹ ç¦æ­¢å®ä¾‹åˆå§‹åŒ–çš„é‡æ’åºï¼Œé¿å…æ‹¿åˆ°â€œåŠåˆå§‹åŒ–â€å¯¹è±¡ï¼‰ã€‚</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance; <span class="hljs-comment">// volatile å…³é”®</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span>()</span> {}
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title">getInstance</span>()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) { <span class="hljs-comment">// ç¬¬ä¸€æ¬¡æ£€æŸ¥</span>
            synchronized (Singleton.<span class="hljs-keyword">class</span>) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) { <span class="hljs-comment">// ç¬¬äºŒæ¬¡æ£€æŸ¥</span>
                    instance = <span class="hljs-keyword">new</span> Singleton(); <span class="hljs-comment">// ç¦æ­¢é‡æ’åº</span>
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
}
</code></pre>
<ol>
<li><strong>å¹¶å‘æ•°æ®æ›´æ–°</strong>ï¼šç”¨ â€‹<code>â€‹synchronizedâ€‹</code>â€‹ æˆ– â€‹<code>â€‹Lockâ€‹</code>â€‹ ä¿è¯å¤šçº¿ç¨‹æ›´æ–°å…±äº«å˜é‡çš„åŸå­æ€§å’Œå¯è§æ€§ã€‚</li>
</ol>
<h4 data-id="heading-10">æ€»ç»“</h4>
<p>JMM çš„æ ¸å¿ƒæ˜¯ <strong>è§£å†³å¤šçº¿ç¨‹å¹¶å‘æ—¶çš„å†…å­˜å¯è§æ€§ã€åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜</strong>ï¼Œé€šè¿‡æŠ½è±¡ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜çš„äº¤äº’ï¼Œä»¥åŠ â€‹<code>â€‹volatileâ€‹</code>â€‹ã€â€‹<code>â€‹synchronizedâ€‹</code>â€‹ã€â€‹<code>â€‹finalâ€‹</code>â€‹ å’Œ â€‹<code>â€‹happens-beforeâ€‹</code>â€‹ è§„åˆ™ï¼Œä¸º Java å¹¶å‘ç¼–ç¨‹æä¾›ç»Ÿä¸€çš„å†…å­˜æ¨¡å‹è§„èŒƒã€‚ç†è§£ JMM æ˜¯æŒæ¡å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day15 | Javaå†…éƒ¨ç±»è¯¦è§£]]></title>    <link>https://juejin.cn/post/7575533124878352411</link>    <guid>https://juejin.cn/post/7575533124878352411</guid>    <pubDate>2025-11-24T03:11:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575533124878352411" data-draft-id="7575742632333426738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day15 | Javaå†…éƒ¨ç±»è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯,Java,Java EE"/> <meta itemprop="datePublished" content="2025-11-24T03:11:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‡’æƒ°èœ—ç‰›"/> <meta itemprop="url" content="https://juejin.cn/user/615342556327752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day15 | Javaå†…éƒ¨ç±»è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/615342556327752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‡’æƒ°èœ—ç‰›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:11:15.000Z" title="Mon Nov 24 2025 03:11:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto;border:3px solid rgba(62,175,124,.2)}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-weight:700;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:6px;border:2px solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c}.markdown-body a:active,.markdown-body a:hover{border-bottom:1.5px solid #3eaf7c}.markdown-body a:before{content:"â‡²"}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(62,175,124,.2)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:.5rem solid;border-color:#42b983;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none}.markdown-body ul li:before{content:"â€¢";margin-right:4px;color:#3eaf7c}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯å†…éƒ¨ç±»</h2>
<p>å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªç±»å†…éƒ¨çš„ç±»ï¼Œå®ƒå¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ˆåŒ…æ‹¬ç§æœ‰æˆå‘˜ï¼‰ï¼Œæ˜¯å®ç°å°è£…ã€å›è°ƒå’Œé«˜å†…èšè®¾è®¡çš„æ ¸å¿ƒè¯­æ³•ã€‚</p>
<p>Javaé‡Œé¢ä¸ä»…å¯ä»¥åœ¨æ–‡ä»¶é‡Œå®šä¹‰ç±»ï¼Œè¿˜å¯ä»¥åœ¨ç±»é‡ŒåµŒå¥—ç±»ï¼Œè¿™ç§å°±æ˜¯å†…éƒ¨ç±»ã€‚</p>
<p>è¿™ç§è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä¸€äº›å®é™…é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<p>æŸä¸ªç±»åªä¸ºå¦ä¸€ä¸ªç±»æœåŠ¡æ—¶ï¼Œä¸æš´éœ²å®ƒçš„å­˜åœ¨ï¼›</p>
<p>è¡¨è¾¾é€»è¾‘æ›´ç´§è€¦çš„åä½œå…³ç³»ï¼›</p>
<p>å®ç°æ›´ä¼˜é›…çš„å›è°ƒã€è§‚å¯Ÿè€…ã€è¿­ä»£å™¨ç­‰æ¨¡å¼ï¼›</p>
<p>ä»£æ›¿å¤šç»§æ‰¿å¸¦æ¥çš„å¤æ‚æ€§ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day15;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Outer
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/5/29 9:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æˆ‘æ˜¯Outer"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showName</span><span class="hljs-params">()</span> {
            System.out.println(name);
        }
    }
}
</code></pre>
<p>ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼ŒOuteræ˜¯å®šä¹‰çš„ä¸€ä¸ªæ™®é€šç±»ï¼ŒInneræ˜¯åœ¨Outerç±»ä¸­ï¼ˆç±»å®šä¹‰å¤§æ‹¬å·å†…ï¼‰å®šä¹‰çš„ä¸€ä¸ªå†…éƒ¨ç±»ã€‚</p>
<p>ç¼–è¯‘é¡¹ç›®ï¼ˆIDEAä¸­ä½¿ç”¨å¿«æ·é”®Ctrl + F9ï¼‰,ç„¶åæ‰¾åˆ°å¯¹åº”å­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classï¼‰ã€‚</p>
<p>é¡¹ç›®å­—èŠ‚ç æ–‡ä»¶è¾“å‡ºè·¯å¾„ä¸€èˆ¬åœ¨é¡¹ç›®ä¸­æœ‰ä¸ªé»˜è®¤è·¯å¾„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ã€‚</p>
<p>ä½¿ç”¨å¿«æ·é”®Ctrl + Shift + Alt + Sæ‰“å¼€é¡¹ç›®ç»“æ„--&gt;Compiler outputè®¾ç½®çš„è·¯å¾„å°±æ˜¯ç¼–è¯‘åæ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03cf98ce1ff745799c312d9286e4ceb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558675&amp;x-signature=OFJjxjaY%2F5mM89azajWkeidvdec%3D" alt="" loading="lazy"/></p>
<p>ç„¶åæ ¹æ®åŒ…åï¼Œç±»åï¼Œæ‰¾åˆ°å¯¹åº”çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1aa44f7a2c23486b97ddae43baf000f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558675&amp;x-signature=Tyk2NBN1mOEg7UR1m4EE7EQioSU%3D" alt="" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå­—èŠ‚ç æ–‡ä»¶ï¼ŒOuter.classå’ŒOuter$Inner.classã€‚</p>
<p>è¿™ç§å‘½åæ–¹å¼æ˜¯ç¼–è¯‘å™¨å†³å®šçš„ã€‚</p>
<p>æ³¨æ„ä¸‹é¢è¿™ç§å½¢å¼å¹¶ä¸æ˜¯å†…éƒ¨ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day15;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Outer
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/5/29 9:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æˆ‘æ˜¯Outer"</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {
    
}
</code></pre>
<p>ç¼–è¯‘åçš„ç»“æœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/989b0e011cac4706b890af5b377be0c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558675&amp;x-signature=AHUKKrxQouKY0Q%2B255QzDi2HVeY%3D" alt="" loading="lazy"/></p>
<p>è¿™ç§å½¢å¼åªæ˜¯åœ¨åŒä¸€ä¸ªæºæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼Œä¸å­˜åœ¨åµŒå¥—çš„å…³ç³»ï¼Œç›¸äº’ç‹¬ç«‹ã€‚</p>
<h2 data-id="heading-1">äºŒã€å››ç§å†…éƒ¨ç±»</h2>
<h3 data-id="heading-2">2.1 æˆå‘˜å†…éƒ¨ç±»</h3>
<p>ç¬¬ä¸€ç« çš„æ¡ˆä¾‹å…¶å®å°±æ˜¯æˆå‘˜å†…éƒ¨ç±»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day15;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Outer
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/5/29 9:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æˆ‘æ˜¯Outer"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showName</span><span class="hljs-params">()</span> {
            System.out.println(name);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Outer</span> <span class="hljs-variable">outer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>();
        Outer.<span class="hljs-type">Inner</span> <span class="hljs-variable">inner</span> <span class="hljs-operator">=</span> outer.<span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>();
        inner.showName();
    }
}
</code></pre>
<p>Innerå’ŒOuterå­˜åœ¨ç»‘å®šå…³ç³»ï¼ŒInnerå¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰å­—æ®µã€‚</p>
<p>å†…éƒ¨ç±»ç¼–è¯‘åçš„æ–‡ä»¶åOuter$Inner.classã€‚</p>
<blockquote>
<p>æˆå‘˜å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼Œå¦‚æœç”Ÿå‘½å‘¨æœŸä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´å¤–éƒ¨ç±»æ— æ³•è¢«GCã€‚</p>
</blockquote>
<h3 data-id="heading-3">2.2 é™æ€å†…éƒ¨ç±»</h3>
<p>é™æ€å†…éƒ¨ç±»ä¸ä¾èµ–å¤–éƒ¨ç±»å®ä¾‹ã€‚</p>
<p>åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚</p>
<p>åœ¨é›†åˆæ¡†æ¶ä¸­å¸¸è§ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d46b27caf4e44a958750e8067b338766~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558675&amp;x-signature=vv7HnVtKiFWdH1IdGWnekOHjGx4%3D" alt="" loading="lazy"/></p>
<p>ä¸Šå›¾æ˜¯HashMapçš„æºä»£ç ï¼ŒNodeç±»å°±æ˜¯HashMapä¸­å®šä¹‰çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚</p>
<h3 data-id="heading-4">2.3 å±€éƒ¨å†…éƒ¨ç±»</h3>
<p>å±€éƒ¨å†…éƒ¨ç±»å®šä¹‰åœ¨æ–¹æ³•é‡Œï¼Œä½œç”¨åŸŸä»…é™æ–¹æ³•å†…éƒ¨ã€‚</p>
<p>å¯ä»¥è®¿é—®æ–¹æ³•é‡Œçš„finalæˆ–effectively finalå˜é‡ã€‚</p>
<p>ç”¨äºå°è£…ä¸´æ—¶çš„å°é€»è¾‘å—ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day15;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Outer2
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/5/29 10:12
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">great</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Greater</span> {
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHi</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"ä½ å¥½ "</span> + name);
            }
        }
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Greater</span>().sayHi();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Outer2</span> <span class="hljs-variable">outer2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer2</span>();
        outer2.great(<span class="hljs-string">"æ‡’æƒ°èœ—ç‰›"</span>);
    }
}
</code></pre>
<blockquote>
<p>Java 8+ï¼Œæ–¹æ³•å‚æ•°/å±€éƒ¨å˜é‡ä¸éœ€è¦æ˜¾å¼åŠ finalï¼Œåªè¦æ²¡è¢«ä¿®æ”¹ï¼Œç¼–è¯‘å™¨ä¼šéšå¼å¤„ç†æˆfinalï¼ˆeffectively finalï¼‰</p>
</blockquote>
<h3 data-id="heading-5">2.4 åŒ¿åå†…éƒ¨ç±»</h3>
<p>åŒ¿åå†…éƒ¨ç±»å°±æ˜¯æ²¡æœ‰åå­—çš„å†…éƒ¨ç±»ã€‚</p>
<p>ä¸»è¦ç”¨äºå¿«é€Ÿå®ç°æ¥å£æˆ–æŠ½è±¡ç±»ã€‚</p>
<p>åœ¨äº‹ä»¶ç›‘å¬ã€çº¿ç¨‹åˆ›å»ºç­‰åœºæ™¯ä¸­å¸¸è§ã€‚</p>
<p>åŒ¿åå†…éƒ¨ç±»ä¸èƒ½æœ‰æ„é€ æ–¹æ³•ï¼Œä¹Ÿä¸èƒ½å®ç°å¤šä¸ªæ¥å£ã€‚</p>
<p>å¦‚æœä½ å†™è¿‡çº¿ç¨‹ç›¸å…³çš„ä»£ç ï¼Œä½ åº”è¯¥è§è¿‡è¿™æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day15;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Outer3
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/5/29 10:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"è·‘çº¿ç¨‹ä»»åŠ¡"</span>);
            }
        };
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task).start();
    }
}
</code></pre>
<p>å…¶å®è¿™æ®µä»£ç ä¸­taskçš„åˆ›å»ºç­‰ä»·äºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnonymousRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"è·‘çº¿ç¨‹ä»»åŠ¡"</span>);
    }
}
<span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnonymousRunnable</span>();
</code></pre>
<p>ä¸Šä¸‹ä¸€å¯¹æ¯”ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒåŒ¿åå†…éƒ¨ç±»å°±æ˜¯é€‚ç”¨äºå¿«é€Ÿåˆ›å»ºçº¿ç¨‹ä»»åŠ¡ä¸”å®ç°ç®€å•çš„åœºæ™¯ã€‚</p>
<p>å•çº¯çš„åˆ›å»ºä¸€ä¸ªç®€å•çš„çº¿ç¨‹ä»»åŠ¡ï¼Œæˆ‘ä»¬æ²¡å¿…è¦å†å»å†™ä¸ªå…·ä½“çš„ç±»æ¥å®ç°Runnableæ¥å£ï¼Œå†åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>åœ¨ç¼–è¯‘åçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ï¼Œä¼šå‡ºç°Outer3$1.classæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åç¼–è¯‘åï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/259913d7e2444623b91505f59082e3f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558675&amp;x-signature=lZYNUcCXlE9pfag0cgGP0%2B5gbrc%3D" alt="" loading="lazy"/></p>
<p>å…¶å®å°±æ˜¯ç­‰ä»·ä»£ç çš„é€»è¾‘ã€‚</p>
<p>Java 8+å¼•å…¥Lambdaè¡¨è¾¾å¼åï¼Œä»£ç å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–æˆï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.lazy.snail.day15;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@ClassName</span> Outer3
 * <span class="hljs-doctag">@Description</span> TODO
 * <span class="hljs-doctag">@Author</span> lazysnail
 * <span class="hljs-doctag">@Date</span> 2025/5/29 10:21
 * <span class="hljs-doctag">@Version</span> 1.0
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> () -&gt; System.out.println(<span class="hljs-string">"è·‘çº¿ç¨‹ä»»åŠ¡"</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(task).start();
    }
}
</code></pre>
<p>Lambdaè¡¨è¾¾å¼çš„å†™æ³•ä¸ä¼šå†å‡ºç°Outer3$1.classè¿™æ ·çš„å­—èŠ‚ç ã€‚</p>
<p>åŒ¿åå†…éƒ¨ç±»çš„ç®€å•æ¼”è¿›è¿‡ç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cff8830d8004ce29e34e370ce4d7aca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oeS5oOw6JyX54mb:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558675&amp;x-signature=M7yxO1dkswv%2F9CjPgCKEpPT62nU%3D" alt="" loading="lazy"/></p>
<p>ä¸‹é¢æ˜¯Lambdaè¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»çš„å·®å¼‚æ€»ç»“ï¼š</p>






































































<table><thead><tr><th>ç‰¹æ€§</th><th>Lambdaè¡¨è¾¾å¼</th><th>åŒ¿åå†…éƒ¨ç±»</th></tr></thead><tbody><tr><td>æœ¬è´¨</td><td>å‡½æ•°å¼æ¥å£çš„ç®€æ´å®ç°</td><td>é©¬ä¸Šå°±åˆ›å»ºç±»å®ä¾‹</td></tr><tr><td>è¯­æ³•ç»“æ„</td><td>(params) -&gt; expression</td><td>new Interface() { æ–¹æ³•å®ç° }</td></tr><tr><td>ç¼–è¯‘æœºåˆ¶</td><td>ä½¿ç”¨invokedynamicæŒ‡ä»¤åŠ¨æ€ç”Ÿæˆ</td><td>ç”Ÿæˆç‹¬ç«‹.classæ–‡ä»¶ï¼ˆæ¯”å¦‚Outer3$1.classï¼‰</td></tr><tr><td>ä½œç”¨åŸŸ</td><td>å…±äº«å¤–å›´ä½œç”¨åŸŸ</td><td>æœ‰ç‹¬ç«‹ä½œç”¨åŸŸ</td></tr><tr><td>thiså…³é”®å­—</td><td>æŒ‡å‘å¤–å›´ç±»å®ä¾‹</td><td>æŒ‡å‘è‡ªèº«å®ä¾‹</td></tr><tr><td>å˜é‡æ•è·</td><td>å¯ä»¥æ•è·effectively finalå˜é‡ï¼ˆéšå¼finalï¼‰</td><td>éœ€æ˜¾å¼finalå˜é‡</td></tr><tr><td>å†…å­˜å ç”¨</td><td>è¾ƒå°ï¼ˆJVMçº§ä¼˜åŒ–ï¼‰</td><td>è¾ƒå¤§ï¼ˆç”Ÿæˆæ–°ç±»ï¼‰</td></tr><tr><td>æ–¹æ³•æ”¯æŒ</td><td>åªèƒ½å®ç°å•ä¸ªæŠ½è±¡æ–¹æ³•</td><td>å¯å®ç°å¤šæ–¹æ³•</td></tr><tr><td>æ„é€ å‡½æ•°</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒå®ä¾‹åˆå§‹åŒ–å—</td></tr><tr><td>æ¥å£ç±»å‹</td><td>ä»…é™å‡½æ•°å¼æ¥å£ï¼ˆå•ä¸€æŠ½è±¡æ–¹æ³•ï¼‰</td><td>æ”¯æŒä»»æ„æ¥å£/æŠ½è±¡ç±»</td></tr><tr><td>è°ƒè¯•ä¿¡æ¯</td><td>æ ˆè½¨è¿¹æ›´ç®€æ´</td><td>æœ‰å®Œæ•´ç±»åï¼ˆä½†åŒ¿åç±»åå¯è¯»æ€§å·®ï¼‰</td></tr><tr><td>å­—èŠ‚ç éªŒè¯</td><td>è¿è¡Œæ—¶æ ¡éªŒ</td><td>ç¼–è¯‘æ—¶æ ¡éªŒ</td></tr></tbody></table>
<h2 data-id="heading-6">ç»“è¯­</h2>
<p>å†…éƒ¨ç±»è¿™ç§è®¾è®¡è®©ç±»çš„å®šä¹‰ä¸å±€é™äºæ–‡ä»¶æˆ–åŒ…ï¼Œå¯ä»¥çµæ´»åµŒå¥—ï¼Œé…åˆä½œç”¨åŸŸã€è®¿é—®æ§åˆ¶ã€ç¼–è¯‘ç­–ç•¥ï¼Œä¸€èµ·æ„å»ºé«˜å†…èšã€ä½è€¦åˆçš„ç»“æ„ã€‚</p>
<p>åœ¨çœŸå®é¡¹ç›®å¼€å‘é‡Œï¼Œè¦ä¸è¦ä½¿ç”¨å†…éƒ¨ç±»ï¼Œå…³é”®åœ¨äºèƒ½ä¸èƒ½æå‡ä»£ç çš„å¯è¯»æ€§ä¸æ¨¡å—æ€§ã€‚</p>
<p>ä¸æ˜¯æ‰€æœ‰å†…éƒ¨ç±»éƒ½å€¼å¾—ä¿ç•™ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰é€»è¾‘éƒ½è¯¥å¤–ææˆç‹¬ç«‹ç±»ã€‚</p>
<p>å¦‚æœä½ æŠŠå†…éƒ¨ç±»å½“æˆè¯­æ³•ç³–ï¼Œé‚£å®ƒå°±æ˜¯ä¸ªå·¥å…·ï¼›</p>
<p>ä½†å¦‚æœä½ æŠŠå®ƒå½“ä½œç»“æ„è¡¨è¾¾åŠ›çš„ä¸€éƒ¨åˆ†ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ç§æ¶æ„è¯­è¨€ã€‚</p>
<p><strong>ä¸‹ä¸€ç¯‡é¢„å‘Š</strong></p>
<blockquote>
<p>Day16 | Javaå¼‚å¸¸æœºåˆ¶è¯¦è§£</p>
</blockquote>
<p>å¦‚æœä½ è§‰å¾—è¿™ç³»åˆ—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿å…³æ³¨ä¸“æ ï¼Œæˆ‘ä»¬ä¸€èµ·åšæŒä¸‹å»ï¼</p>
<p><strong>æ›´å¤šæ–‡ç« è¯·å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€Šæ‡’æƒ°èœ—ç‰›å·¥åŠã€‹</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlinä¸­çš„ç»§æ‰¿å’Œå§”æ‰˜]]></title>    <link>https://juejin.cn/post/7575757258833084442</link>    <guid>https://juejin.cn/post/7575757258833084442</guid>    <pubDate>2025-11-24T03:15:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575757258833084442" data-draft-id="7575757258833035290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlinä¸­çš„ç»§æ‰¿å’Œå§”æ‰˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T03:15:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å—é›¨åŒ—æ–—"/> <meta itemprop="url" content="https://juejin.cn/user/4059818590476286"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlinä¸­çš„ç»§æ‰¿å’Œå§”æ‰˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4059818590476286/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å—é›¨åŒ—æ–—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:15:04.000Z" title="Mon Nov 24 2025 03:15:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Kotlin ä¸­ï¼Œ<strong>ç»§æ‰¿ï¼ˆInheritanceï¼‰</strong> Â å’ŒÂ <strong>å§”æ‰˜ï¼ˆDelegationï¼‰</strong> Â æ˜¯ä¸¤ç§æ ¸å¿ƒçš„ä»£ç å¤ç”¨ä¸æ‰©å±•æœºåˆ¶ï¼ŒäºŒè€…è®¾è®¡ç›®æ ‡ä¸åŒï¼šç»§æ‰¿ä¾§é‡ã€Œç±»çš„å±‚çº§å…³ç³»ä¸åŠŸèƒ½ç»§æ‰¿ã€ï¼Œå§”æ‰˜ä¾§é‡ã€Œå¤ç”¨å·²æœ‰å®ç°ã€é¿å…ç»§æ‰¿è€¦åˆã€ã€‚ä¸‹é¢ç»“åˆè¯­æ³•ã€åœºæ™¯ã€åŒºåˆ«è¯¦ç»†è¯´æ˜ï¼š</p>
<h2 data-id="heading-0">ä¸€ã€ç»§æ‰¿ï¼ˆInheritanceï¼‰</h2>
<p>ç»§æ‰¿çš„æ ¸å¿ƒæ˜¯ã€Œå­ç±»æ‹¥æœ‰çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ã€ï¼Œéµå¾ªÂ <strong>å•ä¸€ç»§æ‰¿åŸåˆ™</strong>ï¼ˆä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼‰ï¼Œé€šè¿‡Â <code>:</code>Â è¯­æ³•å®ç°ã€‚</p>
<h3 data-id="heading-1">1. æ ¸å¿ƒè¯­æ³•ä¸è§„åˆ™</h3>
<ul>
<li>çˆ¶ç±»éœ€ç”¨Â <code>open</code>Â æ ‡è®°ï¼ˆé»˜è®¤Â <code>final</code>ï¼Œä¸å¯ç»§æ‰¿ï¼‰ï¼›</li>
<li>å­ç±»ç”¨Â <code>:</code>Â ç»§æ‰¿çˆ¶ç±»ï¼Œéœ€ä¼ é€’çˆ¶ç±»æ„é€ å‚æ•°ï¼›</li>
<li>é‡å†™çˆ¶ç±»æ–¹æ³• / å±æ€§éœ€ç”¨Â <code>override</code>Â å…³é”®å­—ï¼ˆçˆ¶ç±»æˆå‘˜éœ€Â <code>open</code>ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-2">2. ç¤ºä¾‹ï¼šç±»çš„ç»§æ‰¿</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¼€æ”¾çˆ¶ç±»ï¼ˆå…è®¸ç»§æ‰¿ï¼‰</span>
<span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-keyword">val</span> name: String) {
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"<span class="hljs-variable">$name</span> åœ¨è¿›é£Ÿ"</span>)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">breathe</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"<span class="hljs-variable">$name</span> åœ¨å‘¼å¸"</span>) <span class="hljs-comment">// é open æ–¹æ³•ï¼Œä¸å¯é‡å†™</span>
    }
}

<span class="hljs-comment">// å­ç±»ç»§æ‰¿çˆ¶ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>(name: String) : Animal(name) {
    <span class="hljs-comment">// é‡å†™çˆ¶ç±»çš„ open æ–¹æ³•</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">eat</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"<span class="hljs-variable">$name</span> åœ¨åƒéª¨å¤´"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> dog = Dog(<span class="hljs-string">"æ—ºè´¢"</span>)
    dog.eat()      <span class="hljs-comment">// è¾“å‡ºï¼šæ—ºè´¢ åœ¨åƒéª¨å¤´ï¼ˆé‡å†™åçš„æ–¹æ³•ï¼‰</span>
    dog.breathe()  <span class="hljs-comment">// è¾“å‡ºï¼šæ—ºè´¢ åœ¨å‘¼å¸ï¼ˆç»§æ‰¿çš„çˆ¶ç±»æ–¹æ³•ï¼‰</span>
    println(dog.name) <span class="hljs-comment">// è¾“å‡ºï¼šæ—ºè´¢ï¼ˆç»§æ‰¿çš„çˆ¶ç±»å±æ€§ï¼‰</span>
}
</code></pre>
<h3 data-id="heading-3">3. ç»§æ‰¿çš„æ ¸å¿ƒç‰¹ç‚¹</h3>
<ul>
<li><strong>is-a å…³ç³»</strong>ï¼šå­ç±»æ˜¯çˆ¶ç±»çš„ä¸€ç§ï¼ˆå¦‚Â <code>Dog</code>Â æ˜¯Â <code>Animal</code>Â çš„ä¸€ç§ï¼‰ï¼Œè¯­ä¹‰å¼ºè€¦åˆï¼›</li>
<li><strong>åŠŸèƒ½å¤ç”¨</strong>ï¼šç›´æ¥ç»§æ‰¿çˆ¶ç±»çš„éÂ <code>final</code>Â æˆå‘˜ï¼Œå­ç±»å¯é‡å†™æ‰©å±•ï¼›</li>
<li><strong>é™åˆ¶</strong>ï¼šå•ä¸€ç»§æ‰¿ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼‰ï¼Œæ˜“é€ æˆç±»å±‚çº§è‡ƒè‚¿ï¼ˆå¦‚å¤šå±‚ç»§æ‰¿ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-4">äºŒã€å§”æ‰˜ï¼ˆDelegationï¼‰</h2>
<p>å§”æ‰˜çš„æ ¸å¿ƒæ˜¯ã€Œå°†ç±»çš„éƒ¨åˆ†åŠŸèƒ½å§”æ‰˜ç»™å¦ä¸€ä¸ªç±»å®ç°ã€ï¼Œé€šè¿‡Â <code>by</code>Â å…³é”®å­—è¯­æ³•ç³–å®ç°ï¼Œæœ¬è´¨æ˜¯ã€Œç»„åˆä¼˜äºç»§æ‰¿ã€è®¾è®¡åŸåˆ™çš„ä½“ç°ã€‚</p>
<p>Kotlin åŸç”Ÿæ”¯æŒå§”æ‰˜ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™è½¬å‘ä»£ç ï¼ˆç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆï¼‰ï¼Œåˆ†ä¸ºÂ <strong>ç±»å§”æ‰˜</strong>Â å’ŒÂ <strong>å±æ€§å§”æ‰˜</strong>Â ä¸¤ç±»ï¼Œæ ¸å¿ƒæ˜¯ã€Œç±»å§”æ‰˜ã€ï¼ˆå¤ç”¨ç±»åŠŸèƒ½ï¼‰ã€‚</p>
<h3 data-id="heading-5">1. ç±»å§”æ‰˜ï¼ˆæ ¸å¿ƒåœºæ™¯ï¼‰</h3>
<h4 data-id="heading-6">è¯­æ³•ï¼š<code>class å­ç±» : æ¥å£ by å§”æ‰˜å®ä¾‹</code></h4>
<ul>
<li>å­ç±»å®ç°æŸä¸ªæ¥å£ï¼Œå°†æ¥å£çš„æ‰€æœ‰æ–¹æ³•å§”æ‰˜ç»™ä¸€ä¸ªã€Œå§”æ‰˜å®ä¾‹ã€ï¼›</li>
<li>å­ç±»å¯é€‰æ‹©æ€§é‡å†™æ¥å£æ–¹æ³•ï¼ˆè¦†ç›–å§”æ‰˜çš„å®ç°ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">ç¤ºä¾‹ï¼šç±»å§”æ‰˜å¤ç”¨åŠŸèƒ½</h4>
<p>éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªã€Œæ—¥å¿—é›†åˆã€ï¼Œå¤ç”¨Â <code>ArrayList</code>Â çš„å­˜å‚¨åŠŸèƒ½ï¼ŒåŒæ—¶åœ¨æ·»åŠ  / åˆ é™¤å…ƒç´ æ—¶æ‰“å°æ—¥å¿—ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. å®šä¹‰æ¥å£ï¼ˆæ˜ç¡®è¦å§”æ‰˜çš„åŠŸèƒ½ï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyCollection</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span>: <span class="hljs-built_in">Boolean</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">remove</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span>: <span class="hljs-built_in">Boolean</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">size</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span>
}

<span class="hljs-comment">// 2. å§”æ‰˜ç±»ï¼ˆå·²æœ‰å®ç°ï¼Œéœ€å¤ç”¨ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyArrayList</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">MyCollection</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> list = ArrayList&lt;T&gt;()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> list.add(element)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">remove</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> list.remove(element)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">size</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> list.size
    }
}

<span class="hljs-comment">// 3. ç›®æ ‡ç±»ï¼šé€šè¿‡å§”æ‰˜å¤ç”¨ MyArrayList çš„å®ç°ï¼Œæ·»åŠ æ—¥å¿—åŠŸèƒ½</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LogCollection</span>&lt;<span class="hljs-type">T</span>&gt; : <span class="hljs-type">MyCollection</span>&lt;<span class="hljs-type">T</span>&gt; <span class="hljs-title">by</span> <span class="hljs-title">MyArrayList</span>&lt;<span class="hljs-type">T</span>&gt;() {
    <span class="hljs-comment">// é€‰æ‹©æ€§é‡å†™ add æ–¹æ³•ï¼ˆè¦†ç›–å§”æ‰˜çš„å®ç°ï¼Œæ·»åŠ æ—¥å¿—ï¼‰</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        println(<span class="hljs-string">"æ·»åŠ å…ƒç´ ï¼š<span class="hljs-variable">$element</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.add(element) <span class="hljs-comment">// è°ƒç”¨å§”æ‰˜ç±»çš„ add æ–¹æ³•ï¼ˆMyArrayList çš„å®ç°ï¼‰</span>
    }

    <span class="hljs-comment">// é€‰æ‹©æ€§é‡å†™ remove æ–¹æ³•</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">remove</span><span class="hljs-params">(element: <span class="hljs-type">T</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        println(<span class="hljs-string">"åˆ é™¤å…ƒç´ ï¼š<span class="hljs-variable">$element</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.remove(element)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> collection = LogCollection&lt;String&gt;()
    collection.add(<span class="hljs-string">"Kotlin"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šæ·»åŠ å…ƒç´ ï¼šKotlin</span>
    collection.add(<span class="hljs-string">"Java"</span>)   <span class="hljs-comment">// è¾“å‡ºï¼šæ·»åŠ å…ƒç´ ï¼šJava</span>
    println(<span class="hljs-string">"é›†åˆå¤§å°ï¼š<span class="hljs-subst">${collection.size()}</span>"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šé›†åˆå¤§å°ï¼š2ï¼ˆå¤ç”¨å§”æ‰˜çš„ size æ–¹æ³•ï¼‰</span>
    collection.remove(<span class="hljs-string">"Java"</span>) <span class="hljs-comment">// è¾“å‡ºï¼šåˆ é™¤å…ƒç´ ï¼šJava</span>
}
</code></pre>
<h4 data-id="heading-8">å…³é”®è¯´æ˜ï¼š</h4>
<ul>
<li><code>LogCollection</code>Â å®ç°Â <code>MyCollection</code>Â æ¥å£ï¼Œä½†æœªæ‰‹åŠ¨å®ç°Â <code>add/remove/size</code>Â æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡Â <code>by MyArrayList&lt;T&gt;()</code>Â å°†è¿™äº›æ–¹æ³•å§”æ‰˜ç»™Â <code>MyArrayList</code>Â å®ä¾‹ï¼›</li>
<li>å­ç±»å¯é‡å†™æ¥å£æ–¹æ³•ï¼Œæ­¤æ—¶ä¼˜å…ˆæ‰§è¡Œå­ç±»çš„å®ç°ï¼ˆå¦‚Â <code>add</code>Â æ–¹æ³•çš„æ—¥å¿—é€»è¾‘ï¼‰ï¼Œå†é€šè¿‡Â <code>super.add(element)</code>Â è°ƒç”¨å§”æ‰˜ç±»çš„åŸå®ç°ï¼›</li>
<li>å§”æ‰˜æ˜¯ã€Œhas-a å…³ç³»ã€ï¼ˆ<code>LogCollection</code>Â åŒ…å«Â <code>MyArrayList</code>Â å®ä¾‹ï¼‰ï¼Œè¯­ä¹‰è€¦åˆå¼±ï¼Œçµæ´»æ€§é«˜ã€‚</li>
</ul>
<h3 data-id="heading-9">2. å±æ€§å§”æ‰˜ï¼ˆè¡¥å……åœºæ™¯ï¼‰</h3>
<p>å±æ€§å§”æ‰˜æ˜¯ã€Œå°†å±æ€§çš„ getter/setter é€»è¾‘å§”æ‰˜ç»™å¦ä¸€ä¸ªç±»ã€ï¼Œè¯­æ³•ï¼š<code>val/var å±æ€§å: ç±»å‹ by å§”æ‰˜å®ä¾‹</code>ï¼Œå¸¸ç”¨äºå¤ç”¨å±æ€§é€»è¾‘ï¼ˆå¦‚å»¶è¿Ÿåˆå§‹åŒ–ã€è§‚å¯Ÿå±æ€§å˜åŒ–ï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼šå»¶è¿Ÿåˆå§‹åŒ–ï¼ˆ<code>lazy</code>Â æ˜¯ Kotlin å†…ç½®çš„å±æ€§å§”æ‰˜ï¼‰</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å»¶è¿Ÿåˆå§‹åŒ–ï¼šåªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘</span>
<span class="hljs-keyword">val</span> expensiveData: String <span class="hljs-keyword">by</span> lazy {
    println(<span class="hljs-string">"åˆå§‹åŒ–æ•°æ®ï¼ˆè€—æ—¶æ“ä½œï¼‰"</span>)
    <span class="hljs-string">"è€—æ—¶è®¡ç®—åçš„ç»“æœ"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"å¼€å§‹è®¿é—®æ•°æ®"</span>)
    println(expensiveData) <span class="hljs-comment">// è¾“å‡ºï¼šåˆå§‹åŒ–æ•°æ®ï¼ˆè€—æ—¶æ“ä½œï¼‰â†’ è€—æ—¶è®¡ç®—åçš„ç»“æœ</span>
    println(expensiveData) <span class="hljs-comment">// è¾“å‡ºï¼šè€—æ—¶è®¡ç®—åçš„ç»“æœï¼ˆç›´æ¥å¤ç”¨å·²åˆå§‹åŒ–çš„å€¼ï¼‰</span>
}
</code></pre>
<h3 data-id="heading-10">3. å§”æ‰˜çš„æ ¸å¿ƒç‰¹ç‚¹</h3>
<ul>
<li><strong>has-a å…³ç³»</strong>ï¼šç›®æ ‡ç±»åŒ…å«å§”æ‰˜å®ä¾‹ï¼Œè¯­ä¹‰è€¦åˆå¼±ï¼ˆå¯çµæ´»æ›¿æ¢å§”æ‰˜å¯¹è±¡ï¼‰ï¼›</li>
<li><strong>å¤šå§”æ‰˜æ”¯æŒ</strong>ï¼šä¸€ä¸ªç±»å¯å®ç°å¤šä¸ªæ¥å£ï¼Œæ¯ä¸ªæ¥å£å§”æ‰˜ç»™ä¸åŒå®ä¾‹ï¼ˆé—´æ¥å®ç° â€œå¤šç»§æ‰¿â€ æ•ˆæœï¼Œæ— å•ä¸€ç»§æ‰¿é™åˆ¶ï¼‰ï¼›</li>
<li><strong>è§£è€¦</strong>ï¼šé¿å…ç»§æ‰¿å¸¦æ¥çš„ç±»å±‚çº§è‡ƒè‚¿ï¼Œå¤ç”¨å·²æœ‰å®ç°è€Œä¸ä¾èµ–çˆ¶ç±»å±‚çº§ï¼›</li>
<li><strong>çµæ´»æ‰©å±•</strong>ï¼šå¯é€‰æ‹©æ€§è¦†ç›–å§”æ‰˜çš„æ–¹æ³•ï¼Œä¿ç•™æ ¸å¿ƒå¤ç”¨ï¼Œæ‰©å±•é¢å¤–é€»è¾‘ã€‚</li>
</ul>
<h2 data-id="heading-11">ä¸‰ã€ç»§æ‰¿ vs å§”æ‰˜ï¼šæ ¸å¿ƒåŒºåˆ«ä¸é€‰æ‹©åœºæ™¯</h2>








































<table><thead><tr><th>ç»´åº¦</th><th>ç»§æ‰¿ï¼ˆInheritanceï¼‰</th><th>å§”æ‰˜ï¼ˆDelegationï¼‰</th></tr></thead><tbody><tr><td>è¯­ä¹‰å…³ç³»</td><td>is-aï¼ˆå­ç±»æ˜¯çˆ¶ç±»çš„ä¸€ç§ï¼‰</td><td>has-aï¼ˆç›®æ ‡ç±»åŒ…å«å§”æ‰˜å®ä¾‹ï¼‰</td></tr><tr><td>è€¦åˆç¨‹åº¦</td><td>å¼ºè€¦åˆï¼ˆå­ç±»ä¾èµ–çˆ¶ç±»å®ç°ï¼‰</td><td>å¼±è€¦åˆï¼ˆä»…ä¾èµ–æ¥å£ï¼Œå¯æ›¿æ¢å§”æ‰˜ï¼‰</td></tr><tr><td>ç»§æ‰¿é™åˆ¶</td><td>å•ä¸€ç»§æ‰¿ï¼ˆåªèƒ½æœ‰ä¸€ä¸ªç›´æ¥çˆ¶ç±»ï¼‰</td><td>æ”¯æŒå¤šå§”æ‰˜ï¼ˆå¤šä¸ªæ¥å£å¯å§”æ‰˜ç»™ä¸åŒå®ä¾‹ï¼‰</td></tr><tr><td>ç±»å±‚çº§å½±å“</td><td>æ˜“é€ æˆå±‚çº§è‡ƒè‚¿ï¼ˆå¤šå±‚ç»§æ‰¿ï¼‰</td><td>ä¸å½±å“ç±»å±‚çº§ï¼ˆæ‰å¹³åŒ–è®¾è®¡ï¼‰</td></tr><tr><td>åŠŸèƒ½å¤ç”¨æ–¹å¼</td><td>ç»§æ‰¿çˆ¶ç±»æ‰€æœ‰é final æˆå‘˜</td><td>å¤ç”¨å§”æ‰˜ç±»çš„æ¥å£å®ç°ï¼Œå¯é€‰æ‹©æ€§è¦†ç›–</td></tr><tr><td>çµæ´»æ€§</td><td>ä½ï¼ˆçˆ¶ç±»å˜æ›´å¯èƒ½å½±å“å­ç±»ï¼‰</td><td>é«˜ï¼ˆå¯åŠ¨æ€æ›¿æ¢å§”æ‰˜å®ä¾‹ï¼Œæ‰©å±•é€»è¾‘ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-12">é€‰æ‹©åŸåˆ™ï¼š</h3>
<ol>
<li>
<p>ç”¨Â <strong>ç»§æ‰¿</strong>Â çš„åœºæ™¯ï¼š</p>
<ul>
<li>å­ç±»ä¸çˆ¶ç±»å­˜åœ¨æ˜ç¡®çš„ã€Œis-aã€å…³ç³»ï¼ˆå¦‚Â <code>Dog</code>Â æ˜¯Â <code>Animal</code>ï¼‰ï¼›</li>
<li>éœ€è¦å¤ç”¨çˆ¶ç±»çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œä¸”å­ç±»éœ€èå…¥çˆ¶ç±»çš„ç±»å±‚çº§ï¼ˆå¦‚å¤šæ€åœºæ™¯ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>ç”¨Â <strong>å§”æ‰˜</strong>Â çš„åœºæ™¯ï¼š</p>
<ul>
<li>ä»…éœ€å¤ç”¨æŸä¸ªç±»çš„éƒ¨åˆ†åŠŸèƒ½ï¼ˆè€Œéå…¨éƒ¨ï¼‰ï¼›</li>
<li>é¿å…å•ä¸€ç»§æ‰¿é™åˆ¶ï¼ˆéœ€æ•´åˆå¤šä¸ªç±»çš„åŠŸèƒ½ï¼‰ï¼›</li>
<li>å¸Œæœ›é™ä½è€¦åˆï¼Œå…è®¸çµæ´»æ›¿æ¢å®ç°ï¼ˆå¦‚åˆ‡æ¢ä¸åŒçš„å­˜å‚¨æ–¹æ¡ˆã€æ—¥å¿—æ–¹æ¡ˆï¼‰ï¼›</li>
<li>ç±»å±‚çº§å·²å¤æ‚ï¼Œä¸æƒ³å†å¢åŠ ç»§æ‰¿æ·±åº¦ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-13">å››ã€è¿›é˜¶ï¼šå§”æ‰˜å®ç° â€œå¤šç»§æ‰¿â€ æ•ˆæœ</h2>
<p>ç”±äº Kotlin ç¦æ­¢ç±»çš„å¤šç»§æ‰¿ï¼Œä½†å§”æ‰˜æ”¯æŒå¤šæ¥å£å§”æ‰˜ï¼Œå¯é—´æ¥å®ç° â€œå¤šç»§æ‰¿â€ çš„åŠŸèƒ½æ•´åˆï¼š</p>
<p>ç¤ºä¾‹ï¼šä¸€ä¸ªç±»æ•´åˆä¸¤ä¸ªä¸åŒç±»çš„åŠŸèƒ½</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¥å£1ï¼šé£è¡ŒåŠŸèƒ½</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Flyable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span>
}

<span class="hljs-comment">// æ¥å£2ï¼šæ¸¸æ³³åŠŸèƒ½</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Swimmable</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">swim</span><span class="hljs-params">()</span></span>
}

<span class="hljs-comment">// å§”æ‰˜ç±»1ï¼šå®ç°é£è¡ŒåŠŸèƒ½</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> : <span class="hljs-type">Flyable</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"é¸Ÿç±»é£è¡Œ"</span>)
    }
}

<span class="hljs-comment">// å§”æ‰˜ç±»2ï¼šå®ç°æ¸¸æ³³åŠŸèƒ½</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span> : <span class="hljs-type">Swimmable</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">swim</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"é±¼ç±»æ¸¸æ³³"</span>)
    }
}

<span class="hljs-comment">// ç›®æ ‡ç±»ï¼šé€šè¿‡å¤šå§”æ‰˜æ•´åˆé£è¡Œå’Œæ¸¸æ³³åŠŸèƒ½</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> : <span class="hljs-type">Flyable</span> <span class="hljs-title">by</span> <span class="hljs-title">Bird</span>(), Swimmable <span class="hljs-keyword">by</span> Fish() {
    <span class="hljs-comment">// å¯é€‰ï¼šè¦†ç›–å§”æ‰˜çš„æ–¹æ³•</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span> {
        println(<span class="hljs-string">"é¸­å­ä½ç©ºé£è¡Œï¼ˆè¦†ç›–é¸Ÿç±»é£è¡Œï¼‰"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> duck = Duck()
    duck.fly()  <span class="hljs-comment">// è¾“å‡ºï¼šé¸­å­ä½ç©ºé£è¡Œï¼ˆè¦†ç›–é¸Ÿç±»é£è¡Œï¼‰</span>
    duck.swim() <span class="hljs-comment">// è¾“å‡ºï¼šé±¼ç±»æ¸¸æ³³ï¼ˆå¤ç”¨é±¼ç±»çš„å®ç°ï¼‰</span>
}
</code></pre>
<p>è¿™é‡ŒÂ <code>Duck</code>Â åŒæ—¶æ•´åˆäº†Â <code>Bird</code>Â çš„é£è¡ŒåŠŸèƒ½å’ŒÂ <code>Fish</code>Â çš„æ¸¸æ³³åŠŸèƒ½ï¼Œä¸”æ— éœ€ç»§æ‰¿è¿™ä¸¤ä¸ªç±»ï¼Œé¿å…äº†å¤šç»§æ‰¿çš„é—®é¢˜ã€‚</p>
<h2 data-id="heading-14">äº”ã€æ ¸å¿ƒæ€»ç»“</h2>
<ol>
<li>ç»§æ‰¿æ˜¯ã€Œå¼ºè€¦åˆçš„å±‚çº§å…³ç³»ã€ï¼Œé€‚åˆÂ <code>is-a</code>Â åœºæ™¯ï¼Œéµå¾ªå•ä¸€ç»§æ‰¿ï¼›</li>
<li>å§”æ‰˜æ˜¯ã€Œå¼±è€¦åˆçš„åŠŸèƒ½å¤ç”¨ã€ï¼Œé€‚åˆÂ <code>has-a</code>Â åœºæ™¯ï¼Œæ”¯æŒå¤šå§”æ‰˜ï¼Œçµæ´»æ€§æ›´é«˜ï¼›</li>
<li>Kotlin æ¨èã€Œç»„åˆï¼ˆå§”æ‰˜ï¼‰ä¼˜äºç»§æ‰¿ã€ï¼Œå‡å°‘ç±»å±‚çº§è‡ƒè‚¿ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§ï¼›</li>
<li>éœ€æ•´åˆå¤šä¸ªç±»çš„åŠŸèƒ½æ—¶ï¼Œç”¨ã€Œæ¥å£ + å¤šå§”æ‰˜ã€æ›¿ä»£å¤šç»§æ‰¿ï¼ˆé¿å…æ­§ä¹‰ä¸è€¦åˆï¼‰ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»Demoç†è§£Fiber]]></title>    <link>https://juejin.cn/post/7575413146923073551</link>    <guid>https://juejin.cn/post/7575413146923073551</guid>    <pubDate>2025-11-24T03:24:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146923073551" data-draft-id="7575742632333623346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»Demoç†è§£Fiber"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-11-24T03:24:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤èŒ—å‰ç«¯å›¢é˜Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3233040624266695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»Demoç†è§£Fiber
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dafcebf7c91d402abd52f072a32deba8~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="å¤èŒ—å‰ç«¯å›¢é˜Ÿ" class="title" data-v-d326b38e="">å¤èŒ—å‰ç«¯å›¢é˜Ÿ</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-11-24T03:24:39.000Z" title="Mon Nov 24 2025 03:24:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-11-24
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                é˜…è¯»1åˆ†é’Ÿ
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        å…³æ³¨
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @å¤èŒ—ç§‘æŠ€
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½œè€…ï¼šç®€å¯</p>
</blockquote>
<p>ç†è§£Fiberï¼Œå°±æ˜¯ç†è§£ç°ä»£Reactçš„çµé­‚ã€‚æœ¬æ–‡æœ¬æ–‡ä¸»è¦æ¢ç´¢2ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¸ºä»€ä¹ˆé¡µé¢çœ‹èµ·æ¥ä¼šå¡é¡¿ï¼Ÿ</li>
<li>Fiberæ˜¯æ€ä¹ˆè§£å†³å¡é¡¿çš„ï¼Ÿ</li>
</ol>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆé¡µé¢çœ‹èµ·æ¥ä¼šå¡é¡¿</h2>
<p>å¡é¡¿æ˜¯äººä¸»è§‚çš„æ„Ÿå—ï¼Œæ˜¯å¯¹ç”»é¢å‘ˆç°çš„æè¿°ï¼›ç ”ç©¶è¡¨æ˜ï¼š<strong>å¤§å¤šæ•°äººæ„ŸçŸ¥åˆ°ä¸å¡é¡¿çš„é¢‘ç‡åœ¨50Hzåˆ°60Hzä¹‹é—´ï¼Œç»¼åˆè€ƒé‡ä¸‹60fpsï¼ˆå¸§ç‡ï¼‰è¢«è§†ä¸ºæµç•…çš„åŸºå‡†ã€‚</strong></p>
<h3 data-id="heading-1"><strong>1.60Fps</strong></h3>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba961f36b5ed41898ef0c6ffb459b02b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<ul>
<li><strong>äººçœ¼æ„ŸçŸ¥</strong>: äººçœ¼å¯ä»¥æ„ŸçŸ¥å¤§çº¦50Hzè‡³60Hzçš„é¢‘ç‡ï¼Œè¾ƒé«˜çš„åˆ·æ–°ç‡å¯ä»¥å‡å°‘é—ªçƒæ„Ÿï¼Œä½¿ç”»é¢æ›´å¹³æ»‘ã€‚</li>
<li><strong>å¸§ç‡ä¸æµç•…åº¦</strong>: å¸§ç‡æŒ‡çš„æ˜¯æ¯ç§’æ˜¾ç¤ºçš„ç”»é¢æ•°é‡ï¼ˆfpsï¼‰ã€‚å¸§ç‡è¶Šé«˜ï¼Œæ„å‘³ç€æ¯ç§’æ˜¾ç¤ºçš„é™æ€å›¾åƒè¶Šå¤šï¼Œç»„åˆèµ·æ¥å°±è¶Šèƒ½æ¨¡æ‹Ÿå‡ºæµç•…çš„è¿åŠ¨ï¼Œç»™è§‚çœ‹è€…å¸¦æ¥æ›´æµç•…ã€æ›´é€¼çœŸçš„ä½“éªŒã€‚</li>
<li><strong>æ¸²æŸ“é—´éš”</strong>: å¸§ç‡å’Œæ¸²æŸ“é—´éš”æ˜¯äº’é€†çš„å…³ç³»ã€‚æ¸²æŸ“é—´éš”å¤§äº16.6msï¼ˆ1/60Hzï¼‰ï¼Œæ„å‘³ç€ç”»é¢ä¹‹é—´çš„è¿‡æ¸¡ä¼šä¸å¤Ÿè¿è´¯ï¼Œä»è€Œäº§ç”Ÿå¡é¡¿æ„Ÿã€‚</li>
</ul>
<h3 data-id="heading-2">2.æµè§ˆå™¨æ¸²æŸ“</h3>
<h4 data-id="heading-3"><strong>æµè§ˆå™¨æ¸²æŸ“çš„ä¸€æ¬¡å¾ªç¯</strong></h4>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2faefb0847242f9a0b0580668f359b4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-4"><strong>å‡ ä¸ªæµè§ˆå™¨æ¸²æŸ“é—®é¢˜</strong></h4>
<ul>
<li><strong>Q</strong>
<ol>
<li>æ¯ä¸€è½® Event Loop éƒ½ä¼šä¼´éšç€æ¸²æŸ“å—ï¼Ÿ</li>
<li>requestAnimationFrame åœ¨å“ªä¸ªé˜¶æ®µæ‰§è¡Œï¼Œåœ¨æ¸²æŸ“å‰è¿˜æ˜¯åï¼Ÿåœ¨ microTask çš„å‰è¿˜æ˜¯åï¼Ÿ</li>
<li>requestIdleCallback åœ¨å“ªä¸ªé˜¶æ®µæ‰§è¡Œï¼Ÿå¦‚ä½•å»æ‰§è¡Œï¼Ÿåœ¨æ¸²æŸ“å‰è¿˜æ˜¯åï¼Ÿåœ¨ microTask çš„å‰è¿˜æ˜¯åï¼Ÿ</li>
<li>resizeã€scroll è¿™äº›äº‹ä»¶æ˜¯ä½•æ—¶å»æ´¾å‘çš„ï¼Ÿ</li>
</ol>
</li>
<li><strong>A</strong>
<ol>
<li>äº‹ä»¶å¾ªç¯<strong>ä¸ä¸€å®š</strong>æ¯è½®éƒ½ä¼´éšç€é‡æ¸²æŸ“ï¼Œä½†æ˜¯å¦‚æœæœ‰å¾®ä»»åŠ¡ï¼Œä¸€å®šä¼šä¼´éšç€<strong>å¾®ä»»åŠ¡æ‰§è¡Œ</strong>ã€‚</li>
<li>requestAnimationFrameåœ¨é‡æ–°æ¸²æŸ“å±å¹•<strong>ä¹‹å‰</strong>æ‰§è¡Œï¼Œéå¸¸é€‚åˆç”¨æ¥åšåŠ¨ç”»ã€‚</li>
<li>requestIdleCallbackåœ¨æ¸²æŸ“å±å¹•<strong>ä¹‹å</strong>æ‰§è¡Œï¼Œå¹¶ä¸”æ˜¯å¦æœ‰ç©ºæ‰§è¡Œè¦çœ‹æµè§ˆå™¨çš„è°ƒåº¦ï¼Œå¦‚æœä½ ä¸€å®šè¦å®ƒåœ¨æŸä¸ªæ—¶é—´å†…æ‰§è¡Œï¼Œè¯·ä½¿ç”¨ timeoutå‚æ•°ã€‚</li>
<li>resizeå’Œscrolläº‹ä»¶å…¶å®è‡ªå¸¦èŠ‚æµï¼Œå®ƒåªåœ¨ Event Loop çš„æ¸²æŸ“é˜¶æ®µå»æ´¾å‘äº‹ä»¶åˆ° EventTarget ä¸Šã€‚</li>
</ol>
</li>
</ul>
<h4 data-id="heading-5">ä¸ºä»€ä¹ˆæµè§ˆå™¨å¡é¡¿</h4>
<ul>
<li>æµè§ˆå™¨çš„æ¸²æŸ“å’Œjsçš„æ‰§è¡Œæ˜¯äº’æ–¥çš„ï¼›
<ul>
<li>jså¯ä»¥æ“ä½œdomï¼Œå¦‚æœåœ¨æ¸²æŸ“çš„æ—¶å€™æ“ä½œäº†domï¼Œä¸çŸ¥é“ä»¥å“ªä¸ªä¸ºå‡†ï¼›</li>
</ul>
</li>
<li>ä¸€èˆ¬æµè§ˆå™¨çš„åˆ·æ–°ç‡ä¸º60hzï¼Œå³1ç§’é’Ÿåˆ·æ–°60æ¬¡ã€‚1000ms / 60hz = 16.6ms ï¼Œå¤§æ¦‚æ¯è¿‡16.6msæµè§ˆå™¨ä¼šæ¸²æŸ“ä¸€å¸§ç”»é¢ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡eventLoopéœ€è¦ä¿è¯åœ¨16.6mså†…å®Œæˆï¼›</li>
<li>åœ¨éœ€è¦è¿ç»­æ¸²æŸ“çš„æ—¶å€™ï¼Œå¦‚æœjsçš„æ‰§è¡Œè¶…è¿‡16.6msï¼Œå¯¼è‡´æŸ“é—´éš”å¤§äºäº†16.6msï¼Œå°±ä¼šå¯¼è‡´å¡é¡¿ï¼›</li>
</ul>
<h2 data-id="heading-6">äºŒã€Fiberæ˜¯æ€ä¹ˆè§£å†³å¡é¡¿çš„</h2>
<p>React Fiberçš„è§£å†³æ–¹æ¡ˆï¼š<strong>å¯ä¸­æ–­çš„å¼‚æ­¥æ¸²æŸ“ï¼Œ<strong>å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å°†ä¸å¯ä¸­æ–­çš„åŒæ­¥æ›´æ–°ï¼Œæ‹†è§£æˆå¯ä¸­æ–­çš„å¼‚æ­¥å·¥ä½œå•å…ƒ</strong>ï¼Œä¹Ÿå°±æ˜¯</strong>ä¸­æ–­å’Œé‡å¯ã€‚</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬ä¸€èµ·é€šè¿‡demoæ¥ç®€å•å®ç°Fiberï¼Œä»¥æ›´å¥½çš„ç†è§£Fiberï¼š</p>
<h3 data-id="heading-7">1.åŸç”Ÿreactä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;

<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#root"</span>);
<span class="hljs-keyword">const</span> element = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(
    <span class="hljs-string">'div'</span>,
    {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'div'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'div'</span>
    },
    <span class="hljs-string">'div  '</span>,
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h1'</span>, <span class="hljs-literal">null</span>,
        <span class="hljs-string">'h1'</span>,
        <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'p'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'p'</span>)
    ),
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h2'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'h2'</span>),
)

<span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(
    element,
    container
)
</code></pre>
<h4 data-id="heading-8">æ•ˆæœ</h4>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6b8218d8e9b4ae8ac37a56006021a04~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">2.è‡ªå·±å®ç°createElementå’Œrender</h3>
<h5 data-id="heading-10">createElement.js</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç›®æ ‡ï¼Ÿ
 * 1ã€åˆ›å»ºfiberèŠ‚ç‚¹
 */</span>
<span class="hljs-comment">/**
 * éœ€è¦æ¥æ”¶å“ªäº›å‚æ•°ï¼Ÿ
 */</span>
<span class="hljs-comment">/**
 * éœ€è¦åšä»€ä¹ˆå¤„ç†ï¼Ÿ
 * 1ã€è®¾ç½®typeå’Œpropsï¼Œpropså†…çš„children
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-params">type, props, ...children</span>) {
    <span class="hljs-keyword">return</span> {
        type,
        <span class="hljs-attr">props</span>: {
            ...props,
            <span class="hljs-attr">children</span>: children?.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> child === <span class="hljs-string">'object'</span> ? child : <span class="hljs-title function_">createTextElement</span>(child)
            })
        }
    }
}

<span class="hljs-comment">// åˆ›å»ºæ–‡æœ¬ç±»å‹çš„fiberèŠ‚ç‚¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createTextElement</span>(<span class="hljs-params">text</span>) {
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'TEXT_ELEMENT'</span>,
        <span class="hljs-attr">props</span>: {
            <span class="hljs-attr">nodeValue</span>: text,
            <span class="hljs-attr">children</span>: []
        }
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    createElement
}
</code></pre>
<h5 data-id="heading-11">render.js</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç›®æ ‡ï¼Ÿ
 * æŠŠfiberèŠ‚ç‚¹è½¬æ¢ä¸ºçœŸå®dom
 */</span>
<span class="hljs-comment">/**
 * åšå“ªäº›äº‹æƒ…ï¼Ÿ
 * 1ã€åˆ›å»ºdomèŠ‚ç‚¹
 * 2ã€æŠŠdomèŠ‚ç‚¹æŒ‚è½½åˆ°çœŸå®dom
 * 3ã€æŠŠå­èŠ‚ç‚¹ä¹Ÿåšä¸Šè¿°å¤„ç†
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">element, container</span>) {
    <span class="hljs-keyword">const</span> dom = element.<span class="hljs-property">type</span> === <span class="hljs-string">'TEXT_ELEMENT'</span>
        ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">''</span>)
        : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(element.<span class="hljs-property">type</span>)

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">isProperty</span> = key =&gt; key !== <span class="hljs-string">'children'</span>;
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(element?.<span class="hljs-property">props</span>)
        .<span class="hljs-title function_">filter</span>(isProperty)
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> dom[name] = element?.<span class="hljs-property">props</span>[name])


    element?.<span class="hljs-property">props</span>?.<span class="hljs-property">children</span>?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> <span class="hljs-title function_">render</span>(child, dom))

    container.<span class="hljs-title function_">appendChild</span>(dom)
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    render
}
</code></pre>
<h5 data-id="heading-12">æ‰§è¡Œ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createElement } <span class="hljs-keyword">from</span> <span class="hljs-string">'./createElement.js'</span>;
<span class="hljs-keyword">import</span> { render } <span class="hljs-keyword">from</span> <span class="hljs-string">'./render.js'</span>;

<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#root"</span>);

<span class="hljs-keyword">const</span> element = <span class="hljs-title function_">createElement</span>(
    <span class="hljs-string">'div'</span>,
    {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'div'</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'div'</span>
    },
    <span class="hljs-string">'div  '</span>,
    <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h1'</span>, <span class="hljs-literal">null</span>,
        <span class="hljs-string">'h1'</span>,
        <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'p'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'p'</span>)
    ),
    <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h2'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'h2'</span>),
)

<span class="hljs-title function_">render</span>(
    element,
    container
)
</code></pre>
<h5 data-id="heading-13">æ•ˆæœï¼ˆå’ŒåŸç”Ÿreactä¸€æ ·ï¼‰</h5>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/583f851b977149828103d2788c946fb6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h5 data-id="heading-14">è¿™æ ·å†™æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h5>
<ul>
<li>ä¸èƒ½ä¸­æ–­æ‰§è¡Œï¼Œå¯èƒ½jsæ‰§è¡Œå¤ªé•¿ï¼Œå¯¼è‡´å¡é¡¿</li>
</ul>
<h3 data-id="heading-15">3.ä¼˜åŒ–</h3>
<ul>
<li>æ€ä¹ˆå¯ä»¥ä¸­æ–­ã€é‡å¯æ‰§è¡Œå‘¢ï¼Ÿ
<ul>
<li>æ‹†åˆ†å·¥ä½œå•å…ƒ</li>
</ul>
</li>
<li>æ€ä¹ˆæ§åˆ¶æ¯æ¬¡jsæ‰§è¡Œæ—¶é—´ï¼Œä¸å ç”¨æ¸²æŸ“è¿›ç¨‹æ—¶é—´ï¼Ÿ
<ul>
<li>åœ¨eventLoopçš„å‰©ä½™æ—¶é—´æ‰§è¡Œjsï¼Œé‚£æˆ‘ä»¬å°±æƒ³åˆ°ä¸€ä¸ªAPIï¼šrequestIdleCallback (<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestIdleCallback" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/â€¦</a>) è¯¥æ–¹æ³•æ’å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨</li>
</ul>
</li>
<li>ä¼˜åŒ–æ€è·¯å›¾</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6ff2feb764c4316b17b6c8a01eabe67~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="ç”»æ¿" loading="lazy"/></p>
<h4 data-id="heading-16">ç¬¬ä¸€ç‰ˆä¼˜åŒ–årender.js</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®°å½•ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</span>
<span class="hljs-keyword">let</span> nextUnitOfWork = <span class="hljs-literal">null</span>;

<span class="hljs-comment">/**
 * è¦åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Ÿ
 * 1ã€åˆ¤æ–­æ˜¯å¦æœ‰å·¥ä½œå•å…ƒéœ€è¦æ‰§è¡Œ
 * 2ã€åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦ç©ºé—²
 * 3ã€å¦‚æœæœ‰å·¥ä½œå•å…ƒä¸”æµè§ˆå™¨ç©ºé—²ï¼Œæ‰§è¡Œå·¥ä½œå•å…ƒ
 * 4ã€ä¸€ä¸ªå·¥ä½œå•å…ƒæ‰§è¡Œå®Œæˆåè·å–ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ
 */</span>
<span class="hljs-comment">/**
 * ç©ºé—²æ—¶é—´æ‰§è¡Œå®Œåï¼Œäº¤ç»™æ¸²æŸ“è¿›ç¨‹ï¼Œå†æ€ä¹ˆé‡å¯ä¸‹ä¸€å·¥ä½œå•å…ƒçš„æ‰§è¡Œï¼Ÿ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoop</span>(<span class="hljs-params">deadline</span>) {
    <span class="hljs-keyword">let</span> shouldYield = <span class="hljs-literal">false</span>; <span class="hljs-comment">// è¡¨ç¤ºçº¿ç¨‹ç¹å¿™ï¼Œåº”è¯¥ä¸­æ–­æ¸²æŸ“</span>

    <span class="hljs-keyword">while</span> (nextUnitOfWork &amp;&amp; !shouldYield) {
        <span class="hljs-comment">/**
         * 1ã€æ‰§è¡Œå·¥ä½œå•å…ƒ
         * 2ã€è¿”å›ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ
         */</span>
        nextUnitOfWork = <span class="hljs-title function_">performUnitOfWork</span>(nextUnitOfWork);

        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç©ºä½™æ—¶é—´</span>
        shouldYield = deadline.<span class="hljs-title function_">timeRemaining</span>() &lt; <span class="hljs-number">1</span>;
    }

    <span class="hljs-comment">// é‡å¯ä¸‹ä¸€eventLopçš„å·¥ä½œå•å…ƒå¤„ç†æµç¨‹</span>
    <span class="hljs-title function_">requestIdleCallback</span>(workLoop);
}

<span class="hljs-comment">// åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œ</span>
<span class="hljs-title function_">requestIdleCallback</span>(workLoop);

<span class="hljs-comment">/**
 * æ€ä¹ˆæ ·æ‰§è¡Œæ‰§è¡Œå·¥ä½œå•å…ƒï¼Ÿ
 * 1ã€ä¸ºfiberèŠ‚ç‚¹åˆ›å»ºdomèŠ‚ç‚¹
 * 2ã€æŠŠåˆ›å»ºå¥½çš„domèŠ‚ç‚¹æŒ‚è½½åˆ°çœŸå®dom
 * 3ã€ä¸ºå½“å‰çš„fiberåˆ›å»ºä»–å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹çš„fiber
 * 4ã€å»ºç«‹çˆ¶å­å’Œå…„å¼Ÿå…³ç³»
 */</span>
<span class="hljs-comment">/**
 * æ€ä¹ˆæ ·è·å–ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒå¹¶è¿”å›ï¼Ÿ
 * 1ã€æˆ‘ä»¬fiberæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬æœ‰å“ªäº›æ–¹å¼éå†ä¸€æ£µæ ‘ï¼Ÿ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">performUnitOfWork</span>(<span class="hljs-params">fiber</span>) {
    <span class="hljs-comment">// æ–°å»ºDOMå…ƒç´ </span>
    <span class="hljs-keyword">if</span> (!fiber.<span class="hljs-property">dom</span>) {
        fiber.<span class="hljs-property">dom</span> = <span class="hljs-title function_">createDOM</span>(fiber);
    }
    <span class="hljs-keyword">if</span> (fiber.<span class="hljs-property">parent</span>) {
        fiber.<span class="hljs-property">parent</span>.<span class="hljs-property">dom</span>.<span class="hljs-title function_">appendChild</span>(fiber.<span class="hljs-property">dom</span>)
    }

    <span class="hljs-keyword">const</span> elements = fiber?.<span class="hljs-property">props</span>?.<span class="hljs-property">children</span>;
    <span class="hljs-keyword">let</span> prevSibling = <span class="hljs-literal">null</span>;
    elements.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">childrenElement, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newFiber = {
            <span class="hljs-attr">parent</span>: fiber,
            <span class="hljs-attr">props</span>: childrenElement.<span class="hljs-property">props</span>,
            <span class="hljs-attr">type</span>: childrenElement.<span class="hljs-property">type</span>,
            <span class="hljs-attr">dom</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">sibling</span>: <span class="hljs-literal">null</span>
        }

        <span class="hljs-comment">/**
         * åˆ›å»ºå¥½fiberèŠ‚ç‚¹åï¼Œæ€ä¹ˆå»ºç«‹çˆ¶å­å’Œå…„å¼ŸèŠ‚ç‚¹å…³ç³»ï¼Ÿ
         */</span>
        <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
            fiber.<span class="hljs-property">child</span> = newFiber
        } <span class="hljs-keyword">else</span> {
            prevSibling.<span class="hljs-property">sibling</span> = newFiber
        }

        prevSibling = newFiber
    })

    <span class="hljs-comment">// éå†å¤„ç†</span>
    <span class="hljs-keyword">if</span> (fiber.<span class="hljs-property">child</span>) {
        <span class="hljs-keyword">return</span> fiber.<span class="hljs-property">child</span>
    }
    <span class="hljs-keyword">let</span> nextFiber = fiber;
    <span class="hljs-keyword">while</span> (nextFiber) {
        <span class="hljs-keyword">if</span> (nextFiber.<span class="hljs-property">sibling</span>) {
            <span class="hljs-keyword">return</span>  nextFiber.<span class="hljs-property">sibling</span>
        }
        nextFiber = nextFiber.<span class="hljs-property">parent</span>
    }
}

<span class="hljs-comment">// åˆ›å»ºdomèŠ‚ç‚¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDOM</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-keyword">const</span> dom = element.<span class="hljs-property">type</span> === <span class="hljs-string">'TEXT_ELEMENT'</span>
        ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">''</span>)
        : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(element.<span class="hljs-property">type</span>)

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">isProperty</span> = key =&gt; key !== <span class="hljs-string">'children'</span>;
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(element?.<span class="hljs-property">props</span>)
        .<span class="hljs-title function_">filter</span>(isProperty)
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> dom[name] = element?.<span class="hljs-property">props</span>[name])

    <span class="hljs-keyword">return</span> dom;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">element, container</span>) {
    <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå·¥ä½œå•å…ƒ</span>
    nextUnitOfWork = {
        <span class="hljs-attr">dom</span>: container,
        <span class="hljs-attr">props</span>: {
            <span class="hljs-attr">children</span>: [element]
        }
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    render
}
</code></pre>
<h5 data-id="heading-17">Fiberæ ‘éå†æµç¨‹å›¾</h5>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6b3112aacac4cbbb53056af310ee07e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="ç”»æ¿" loading="lazy"/></p>
<h5 data-id="heading-18">ä¼˜åŒ–åçš„ç¬¬ä¸€ç‰ˆæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h5>
<ul>
<li>æ¯å¤„ç†ä¸€ä¸ªfiberèŠ‚ç‚¹ï¼Œéƒ½å®æ—¶æŒ‚è½½åˆ°äº†çœŸå®çš„domä¸Šé¢
<ul>
<li>æ“ä½œdomå¤ªé¢‘ç¹ï¼Œå¯¼è‡´é‡æ’é‡ç»˜ï¼›</li>
<li>å¦‚æœèŠ‚ç‚¹å¾ˆå¤šï¼Œé¡µé¢å±•ç¤ºä¼šæœ‰ä¸€ä¸ªé€æ­¥å‡ºç°çš„æ•ˆæœï¼›</li>
</ul>
</li>
</ul>
<h5 data-id="heading-19">æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h5>
<ul>
<li>å…ˆå¯¹æ‰€æœ‰å·¥ä½œå•å…ƒï¼Œæ‰€æœ‰fiberèŠ‚ç‚¹åˆ›å»ºå¥½domèŠ‚ç‚¹ï¼Œç­‰æ‰€æœ‰å·¥ä½œå•å…ƒå¤„ç†å®Œæˆåï¼Œä¸€æ¬¡æ€§æŒ‚è½½åˆ°çœŸå®dom</li>
</ul>
<h4 data-id="heading-20">ç¬¬äºŒç‰ˆä¼˜åŒ–årender.js</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</span>
<span class="hljs-keyword">let</span> nextUnitOfWork = <span class="hljs-literal">null</span>;
<span class="hljs-comment">// æ­£åœ¨è¿›è¡Œçš„æ¸²æŸ“ work in progress root</span>
<span class="hljs-keyword">let</span> wipRoot = <span class="hljs-literal">null</span>;

<span class="hljs-comment">/**
 * æ€ä¹ˆæ ·æ‰§è¡Œæ‰§è¡Œå·¥ä½œå•å…ƒï¼Ÿ
 * 1ã€ä¸ºfiberèŠ‚ç‚¹åˆ›å»ºdomèŠ‚ç‚¹
 * 2ã€æŠŠåˆ›å»ºå¥½çš„domèŠ‚ç‚¹æŒ‚è½½åˆ°çœŸå®dom
 * 3ã€ä¸ºå½“å‰çš„fiberåˆ›å»ºä»–å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹çš„fiber
 * 4ã€å»ºç«‹çˆ¶å­å’Œå…„å¼Ÿå…³ç³»
 */</span>
<span class="hljs-comment">/**
 * æ€ä¹ˆæ ·è·å–ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒå¹¶è¿”å›ï¼Ÿ
 * 1ã€æˆ‘ä»¬fiberæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬æœ‰å“ªäº›æ–¹å¼éå†ä¸€æ£µæ ‘ï¼Ÿ
 */</span>
<span class="hljs-comment">/**
 * ç»Ÿä¸€æäº¤æ¸²æŸ“ï¼Œä»€ä¹ˆæ—¶å€™æäº¤ï¼Ÿ
 * 1ã€æ²¡æœ‰ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ ä¸” æœ‰æ­£åœ¨è¿›è¡Œçš„æ¸²æŸ“
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoop</span>(<span class="hljs-params">deadline</span>) {
    <span class="hljs-comment">// shouldYield è¡¨ç¤ºçº¿ç¨‹ç¹å¿™ï¼Œåº”è¯¥ä¸­æ–­æ¸²æŸ“</span>
    <span class="hljs-keyword">let</span> shouldYield = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">while</span> (nextUnitOfWork &amp;&amp; !shouldYield) {
        <span class="hljs-keyword">debugger</span>
        nextUnitOfWork = <span class="hljs-title function_">performUnitOfWork</span>(nextUnitOfWork);
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç©ºä½™æ—¶é—´</span>
        shouldYield = deadline.<span class="hljs-title function_">timeRemaining</span>() &lt; <span class="hljs-number">1</span>;
    }

    <span class="hljs-comment">// ç»Ÿä¸€æäº¤æ¸²æŸ“</span>
    <span class="hljs-keyword">if</span> (!nextUnitOfWork &amp;&amp; wipRoot) {
        <span class="hljs-title function_">commitRoot</span>();
    }

    <span class="hljs-comment">// é‡å¯ä¸‹ä¸€eventLopçš„å·¥ä½œå•å…ƒå¤„ç†æµç¨‹</span>
    <span class="hljs-title function_">requestIdleCallback</span>(workLoop);
}

<span class="hljs-comment">// åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œ</span>
<span class="hljs-title function_">requestIdleCallback</span>(workLoop);

<span class="hljs-comment">/**
 * æ€ä¹ˆæ ·æ‰§è¡Œæ‰§è¡Œå·¥ä½œå•å…ƒï¼Ÿ
 * 1ã€ä¸ºfiberèŠ‚ç‚¹åˆ›å»ºdomèŠ‚ç‚¹
 * 2ã€æŠŠåˆ›å»ºå¥½çš„domèŠ‚ç‚¹æŒ‚è½½åˆ°çœŸå®dom
 * 3ã€ä¸ºå½“å‰çš„fiberåˆ›å»ºä»–å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹çš„fiber
 * 4ã€å»ºç«‹çˆ¶å­å’Œå…„å¼Ÿå…³ç³»
 */</span>
<span class="hljs-comment">/**
 * æ€ä¹ˆæ ·è·å–ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒå¹¶è¿”å›ï¼Ÿ
 * 1ã€æˆ‘ä»¬fiberæ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬æœ‰å“ªäº›æ–¹å¼éå†ä¸€æ£µæ ‘ï¼Ÿ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">performUnitOfWork</span>(<span class="hljs-params">fiber</span>) {
    <span class="hljs-comment">// æ–°å»ºDOMå…ƒç´ </span>
    <span class="hljs-keyword">if</span> (!fiber.<span class="hljs-property">dom</span>) {
        fiber.<span class="hljs-property">dom</span> = <span class="hljs-title function_">createDOM</span>(fiber);
    }

    <span class="hljs-keyword">const</span> elements = fiber?.<span class="hljs-property">props</span>?.<span class="hljs-property">children</span>;
    <span class="hljs-keyword">let</span> prevSibling = <span class="hljs-literal">null</span>;
    elements.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">childrenElement, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newFiber = {
            <span class="hljs-attr">parent</span>: fiber,
            <span class="hljs-attr">props</span>: childrenElement.<span class="hljs-property">props</span>,
            <span class="hljs-attr">type</span>: childrenElement.<span class="hljs-property">type</span>,
            <span class="hljs-attr">dom</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">sibling</span>: <span class="hljs-literal">null</span>
        }

        <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
            fiber.<span class="hljs-property">child</span> = newFiber
        } <span class="hljs-keyword">else</span> {
            prevSibling.<span class="hljs-property">sibling</span> = newFiber
        }

        prevSibling = newFiber
    })

    <span class="hljs-keyword">if</span> (fiber.<span class="hljs-property">child</span>) {
        <span class="hljs-keyword">return</span> fiber.<span class="hljs-property">child</span>
    }

    <span class="hljs-keyword">let</span> nextFiber = fiber;
    <span class="hljs-keyword">while</span> (nextFiber) {
        <span class="hljs-keyword">if</span> (nextFiber.<span class="hljs-property">sibling</span>) {
            <span class="hljs-keyword">return</span>  nextFiber.<span class="hljs-property">sibling</span>
        }
        nextFiber = nextFiber.<span class="hljs-property">parent</span>
    }
}

<span class="hljs-comment">// æ¸²æŸ“çœŸå®dom</span>
<span class="hljs-comment">// æŠŠæ­£åœ¨æ¸²æŸ“çš„æ ‡è®°æ¸…é™¤</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitRoot</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">commitWork</span>(wipRoot.<span class="hljs-property">child</span>);
    wipRoot = <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// æ¸²æŸ“æ‰€æœ‰çš„fiber</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitWork</span>(<span class="hljs-params">fiber</span>) {
    <span class="hljs-keyword">if</span> (!fiber) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> parentDom = fiber.<span class="hljs-property">parent</span>.<span class="hljs-property">dom</span>;
    parentDom.<span class="hljs-title function_">appendChild</span>(fiber.<span class="hljs-property">dom</span>)

    <span class="hljs-title function_">commitWork</span>(fiber.<span class="hljs-property">child</span>);
    <span class="hljs-title function_">commitWork</span>(fiber.<span class="hljs-property">sibling</span>);
}

<span class="hljs-comment">// åˆ›å»ºdomèŠ‚ç‚¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDOM</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-keyword">const</span> dom = element.<span class="hljs-property">type</span> === <span class="hljs-string">'TEXT_ELEMENT'</span>
        ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">''</span>)
        : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(element.<span class="hljs-property">type</span>)

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">isProperty</span> = key =&gt; key !== <span class="hljs-string">'children'</span>;
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(element?.<span class="hljs-property">props</span>)
        .<span class="hljs-title function_">filter</span>(isProperty)
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> dom[name] = element?.<span class="hljs-property">props</span>[name])

    <span class="hljs-keyword">return</span> dom;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">element, container</span>) {
    wipRoot = {
        <span class="hljs-attr">dom</span>: container,
        <span class="hljs-attr">props</span>: {
            <span class="hljs-attr">children</span>: [element]
        }
    }

    nextUnitOfWork = wipRoot
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    render
}
</code></pre>
<h5 data-id="heading-21">ä¼˜åŒ–åçš„ç¬¬äºŒç‰ˆè¿˜æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h5>
<ul>
<li>å¼€é”€å¾ˆå¤§ï¼Œé‡æ–°æ¸²æŸ“æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šå…¨å±€é‡æ–°æ¸²æŸ“</li>
</ul>
<h5 data-id="heading-22">æ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h5>
<ul>
<li>diffç®—æ³•</li>
</ul>
<h5 data-id="heading-23">diffæ–¹å¼</h5>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99bb6718f3c547c5ad2b224c30353c80~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="ç”»æ¿" loading="lazy"/></p>
<h4 data-id="heading-24">ç¬¬ä¸‰ç‰ˆä¼˜åŒ–årender.js</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸‹ä¸€ä¸ªå·¥ä½œå•å…ƒ</span>
<span class="hljs-keyword">let</span> nextUnitOfWork = <span class="hljs-literal">null</span>;
<span class="hljs-comment">// æ­£åœ¨è¿›è¡Œçš„æ¸²æŸ“ work in progress root</span>
<span class="hljs-keyword">let</span> wipRoot = <span class="hljs-literal">null</span>;
<span class="hljs-comment">// ä¸Šä¸€æ¬¡æ¸²æŸ“</span>
<span class="hljs-keyword">let</span> currentRoot = <span class="hljs-literal">null</span>
<span class="hljs-comment">// è¦åˆ é™¤çš„fiber</span>
<span class="hljs-keyword">let</span> deletion = [];

<span class="hljs-comment">// ä»»åŠ¡è°ƒåº¦</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoop</span>(<span class="hljs-params">deadline</span>) {
    <span class="hljs-keyword">let</span> shouldYield = <span class="hljs-literal">false</span>; <span class="hljs-comment">// shouldYield è¡¨ç¤ºçº¿ç¨‹ç¹å¿™ï¼Œåº”è¯¥ä¸­æ–­æ¸²æŸ“</span>
    <span class="hljs-keyword">while</span> (nextUnitOfWork &amp;&amp; !shouldYield) {
        nextUnitOfWork = <span class="hljs-title function_">performUnitOfWork</span>(nextUnitOfWork);
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç©ºä½™æ—¶é—´</span>
        shouldYield = deadline.<span class="hljs-title function_">timeRemaining</span>() &lt; <span class="hljs-number">1</span>;
    }

    <span class="hljs-comment">// ç»Ÿä¸€æäº¤æ¸²æŸ“</span>
    <span class="hljs-keyword">if</span> (!nextUnitOfWork &amp;&amp; wipRoot) {
        <span class="hljs-title function_">commitRoot</span>();
    }

    <span class="hljs-comment">// é‡å¯ä¸‹ä¸€eventLopçš„å·¥ä½œå•å…ƒå¤„ç†æµç¨‹</span>
    <span class="hljs-title function_">requestIdleCallback</span>(workLoop);
}

<span class="hljs-comment">// åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œ</span>
<span class="hljs-title function_">requestIdleCallback</span>(workLoop);


<span class="hljs-comment">// ä»¥å‰åœ¨è¿™åˆ›å»ºfiberèŠ‚ç‚¹ï¼Œåˆ›å»ºä»–å­èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹çš„fiberï¼Œå»ºç«‹å…³ç³»</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">performUnitOfWork</span>(<span class="hljs-params">fiber</span>) {
    <span class="hljs-comment">// æ–°å»ºDOMå…ƒç´ </span>
    <span class="hljs-keyword">if</span> (!fiber.<span class="hljs-property">dom</span>) {
        fiber.<span class="hljs-property">dom</span> = <span class="hljs-title function_">createDOM</span>(fiber);
    }

    <span class="hljs-keyword">const</span> elements = fiber?.<span class="hljs-property">props</span>?.<span class="hljs-property">children</span>;
    <span class="hljs-title function_">reconcileChildren</span>(fiber, elements)

    <span class="hljs-keyword">if</span> (fiber.<span class="hljs-property">child</span>) {
        <span class="hljs-keyword">return</span> fiber.<span class="hljs-property">child</span>
    }

    <span class="hljs-keyword">let</span> nextFiber = fiber;
    <span class="hljs-keyword">while</span> (nextFiber) {
        <span class="hljs-keyword">if</span> (nextFiber.<span class="hljs-property">sibling</span>) {
            <span class="hljs-keyword">return</span>  nextFiber.<span class="hljs-property">sibling</span>
        }
        nextFiber = nextFiber.<span class="hljs-property">parent</span>
    }
}

<span class="hljs-comment">// æ¸²æŸ“çœŸå®dom</span>
<span class="hljs-comment">// æŠŠæ­£åœ¨æ¸²æŸ“çš„æ ‡è®°æ¸…é™¤</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitRoot</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">commitWork</span>(wipRoot.<span class="hljs-property">child</span>);

    currentRoot = wipRoot;

    wipRoot = <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// æ¸²æŸ“æ‰€æœ‰çš„fiber</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitWork</span>(<span class="hljs-params">fiber</span>) {
    <span class="hljs-keyword">if</span> (!fiber) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> parentDom = fiber.<span class="hljs-property">parent</span>.<span class="hljs-property">dom</span>;

    <span class="hljs-keyword">const</span> hasFiberDom = !!fiber.<span class="hljs-property">dom</span>
    <span class="hljs-keyword">switch</span> (fiber.<span class="hljs-property">effectTag</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'PLACEMENT'</span>:
            hasFiberDom &amp;&amp; parentDom.<span class="hljs-title function_">append</span>(fiber.<span class="hljs-property">dom</span>);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'UPDATE'</span>:
            hasFiberDom &amp;&amp; <span class="hljs-title function_">updateDOM</span>(fiber.<span class="hljs-property">dom</span>, fiber.<span class="hljs-property">alternate</span>.<span class="hljs-property">props</span>, fiber.<span class="hljs-property">props</span>);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'DELETION'</span>:
            hasFiberDom &amp;&amp; parentDom.<span class="hljs-title function_">removeChild</span>(fiber.<span class="hljs-property">dom</span>);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
            <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-title function_">commitWork</span>(fiber.<span class="hljs-property">child</span>);
    <span class="hljs-title function_">commitWork</span>(fiber.<span class="hljs-property">sibling</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateDOM</span>(<span class="hljs-params">dom, prevProps, nextPorps</span>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">isEvent</span> = (<span class="hljs-params">key</span>) =&gt; key.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'on'</span>);
    <span class="hljs-comment">// åˆ é™¤å·²ç»æ²¡æœ‰çš„props</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(prevProps)
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> key != <span class="hljs-string">'children'</span> &amp;&amp; !<span class="hljs-title function_">isEvent</span>(key))
        <span class="hljs-comment">// ä¸åœ¨nextPropsä¸­</span>
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> !key <span class="hljs-keyword">in</span> nextPorps)
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
            <span class="hljs-comment">// æ¸…ç©ºå±æ€§</span>
            dom[key] = <span class="hljs-string">''</span>;
        });

    <span class="hljs-comment">// æ·»åŠ æ–°å¢çš„å±æ€§/ä¿®æ”¹å˜åŒ–çš„å±æ€§</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(nextPorps)
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> key !== <span class="hljs-string">'children'</span> &amp;&amp; !<span class="hljs-title function_">isEvent</span>(key))
        <span class="hljs-comment">// ä¸å†prevPropsä¸­</span>
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> !key <span class="hljs-keyword">in</span> prevProps || prevProps[key] !== nextPorps[key])
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
            dom[key] = nextPorps[key];
        });

    <span class="hljs-comment">// åˆ é™¤äº‹ä»¶å¤„ç†å‡½æ•°</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(prevProps)
        .<span class="hljs-title function_">filter</span>(isEvent)
        <span class="hljs-comment">// æ–°çš„å±æ€§æ²¡æœ‰ï¼Œæˆ–è€…æœ‰å˜åŒ–</span>
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> !key <span class="hljs-keyword">in</span> nextPorps || prevProps[key] !== nextPorps[key])
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> eventType = key.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">2</span>);
            dom.<span class="hljs-title function_">removeEventListener</span>(eventType, prevProps[key]);
        });

    <span class="hljs-comment">// æ·»åŠ æ–°çš„äº‹ä»¶å¤„ç†å‡½æ•°</span>
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(nextPorps)
        .<span class="hljs-title function_">filter</span>(isEvent)
        .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> prevProps[key] !== nextPorps[key])
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> eventType = key.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">2</span>);
            dom.<span class="hljs-title function_">addEventListener</span>(eventType, nextPorps[key]);
        });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDOM</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-keyword">const</span> dom = element.<span class="hljs-property">type</span> === <span class="hljs-string">'TEXT_ELEMENT'</span>
        ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-string">''</span>)
        : <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(element.<span class="hljs-property">type</span>)

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">isProperty</span> = key =&gt; key !== <span class="hljs-string">'children'</span>;
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(element?.<span class="hljs-property">props</span>)
        .<span class="hljs-title function_">filter</span>(isProperty)
        .<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> dom[name] = element?.<span class="hljs-property">props</span>[name])

    <span class="hljs-keyword">return</span> dom;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reconcileChildren</span>(<span class="hljs-params">wipFiber, elements</span>) {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// å¦‚æœæœ‰alternateï¼Œå°±è¿”å›å®ƒçš„childï¼Œæ²¡æœ‰ï¼Œå°±è¿”å›undefined</span>
    <span class="hljs-keyword">let</span> oldFiber = wipFiber.<span class="hljs-property">alternate</span> &amp;&amp; wipFiber.<span class="hljs-property">alternate</span>.<span class="hljs-property">child</span>;

    <span class="hljs-keyword">let</span> prevSibling = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// ä¸ºä»€ä¹ˆè¦ç”¨whileå‘¢ï¼Ÿ</span>
    <span class="hljs-comment">// éœ€è¦æŠŠoldFiberæ ‘å’Œæ–°fiberæ ‘éƒ½éå†å®Œ</span>
    <span class="hljs-comment">// å› ä¸ºå¯èƒ½oldFiberæ ‘æ¯”æ–°fiberæ ‘é•¿</span>
    <span class="hljs-keyword">while</span> (index &lt; elements.<span class="hljs-property">length</span> || oldFiber) {
        <span class="hljs-keyword">const</span> element = elements[index];
        <span class="hljs-keyword">const</span> sameType = oldFiber &amp;&amp; element &amp;&amp; oldFiber.<span class="hljs-property">type</span> === element.<span class="hljs-property">type</span>;

        <span class="hljs-keyword">let</span> newFiber = <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">if</span> (sameType) { <span class="hljs-comment">// æ›´æ–°</span>
            newFiber = {
                <span class="hljs-attr">type</span>: oldFiber.<span class="hljs-property">type</span>,
                <span class="hljs-attr">props</span>: element.<span class="hljs-property">props</span>,
                <span class="hljs-comment">// ç»§æ‰¿dom</span>
                <span class="hljs-attr">dom</span>: oldFiber.<span class="hljs-property">dom</span>,
                <span class="hljs-attr">parent</span>: wipFiber,
                <span class="hljs-attr">alternate</span>: oldFiber,
                <span class="hljs-attr">effectTag</span>: <span class="hljs-string">'UPDATE'</span>,
            };
        }
        <span class="hljs-keyword">if</span> (element &amp;&amp; !sameType) { <span class="hljs-comment">// æ–°å»º</span>
            newFiber = {
                <span class="hljs-attr">type</span>: element.<span class="hljs-property">type</span>,
                <span class="hljs-attr">props</span>: element.<span class="hljs-property">props</span>,
                <span class="hljs-attr">dom</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">parent</span>: wipFiber,
                <span class="hljs-attr">alternate</span>: <span class="hljs-literal">null</span>,
                <span class="hljs-attr">effectTag</span>: <span class="hljs-string">'PLACEMENT'</span>,
            };
        }
        <span class="hljs-keyword">if</span> (oldFiber &amp;&amp; !sameType) { <span class="hljs-comment">// åˆ é™¤</span>
            oldFiber.<span class="hljs-property">effectTag</span> = <span class="hljs-string">'DELETION'</span>;
            deletion.<span class="hljs-title function_">push</span>(oldFiber);
        }

        <span class="hljs-keyword">if</span> (oldFiber) { <span class="hljs-comment">// ä¸‹ä¸€ä¸ªoldFiber</span>
            oldFiber = oldFiber.<span class="hljs-property">sibling</span>;
        }

        <span class="hljs-comment">// ç¬¬ä¸€ä¸ªchildæ‰å¯ä»¥ä½œä¸ºchildï¼Œå…¶ä»–çš„å°±æ˜¯sibling</span>
        <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
            wipFiber.<span class="hljs-property">child</span> = newFiber;
        } <span class="hljs-keyword">else</span> {
            prevSibling.<span class="hljs-property">sibling</span> = newFiber;
        }

        prevSibling = newFiber;

        index++;
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">element, container</span>) {
    wipRoot = {
        <span class="hljs-attr">dom</span>: container,
        <span class="hljs-attr">props</span>: {
            <span class="hljs-attr">children</span>: [element]
        },
        <span class="hljs-attr">alternate</span>: currentRoot, <span class="hljs-comment">// è®°å½•è€çš„fiberæ ‘</span>
    }

    deletion = [];

    nextUnitOfWork = wipRoot
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    render
}
</code></pre>
<h2 data-id="heading-25">ä¸‰ã€æ€»ç»“</h2>
<p>æœ¬æ–‡åªç®€å•ä»‹ç»äº†Fiberå¯ä¸­æ–­ã€å¯æ¢å¤çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œå®é™…çš„Fiberè¿œä¸æ­¢è¿™ä¹ˆç®€å•ï¼Œæ¯”å¦‚è¿˜æœ‰ï¼š</p>
<ul>
<li>ä¼˜å…ˆçº§é©±åŠ¨çš„ä»»åŠ¡è°ƒåº¦ï¼ˆä¸ºä¸åŒç±»å‹çš„æ›´æ–°åˆ†é…äº†ä¼˜å…ˆçº§ã€‚ï¼‰
<ul>
<li>é«˜ä¼˜å…ˆçº§ï¼šç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€è¾“å…¥ï¼‰ã€åŠ¨ç”»ã€‚</li>
<li>ä½ä¼˜å…ˆçº§ï¼šå¤§æ•°æ®æ¸²æŸ“ã€ç½‘ç»œè¯·æ±‚è¿”å›ã€‚</li>
</ul>
</li>
<li>æ›´ç²¾ç»†çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</li>
</ul>
<p>å¦‚æœå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥è¿›ä¸€æ­¥æ·±å…¥äº†è§£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¼å®¹å‘½ä»¤è¡Œä¸ Android Studio çš„ JDK ç­–ç•¥ï¼šä»è¸©å‘åˆ°æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7575937594350665771</link>    <guid>https://juejin.cn/post/7575937594350665771</guid>    <pubDate>2025-11-24T03:40:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575937594350665771" data-draft-id="7575884229524979748" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¼å®¹å‘½ä»¤è¡Œä¸ Android Studio çš„ JDK ç­–ç•¥ï¼šä»è¸©å‘åˆ°æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-24T03:40:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«è½¦å¼ä½"/> <meta itemprop="url" content="https://juejin.cn/user/1345457960792808"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¼å®¹å‘½ä»¤è¡Œä¸ Android Studio çš„ JDK ç­–ç•¥ï¼šä»è¸©å‘åˆ°æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457960792808/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«è½¦å¼ä½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:40:48.000Z" title="Mon Nov 24 2025 03:40:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŒä¸€ Android é¡¹ç›®åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ <code>./gradlew assembleDebug</code> æ„å»ºæˆåŠŸï¼Œä½†åœ¨ Android Studio ä¸­åŒæ­¥æ—¶å´æŠ¥é”™ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Unsupported <span class="hljs-keyword">class</span> <span class="hljs-title class_">file</span> <span class="hljs-title">major</span> <span class="hljs-title">version</span> 65
...
Could not <span class="hljs-keyword">open</span> <span class="hljs-keyword">init</span> generic <span class="hljs-keyword">class</span> <span class="hljs-title class_">cache</span> ... <span class="hljs-title">D</span>:<span class="hljs-type">\tools\Java\jdk1.8.0_211\caches\8.0</span>
</code></pre>
<h2 data-id="heading-0">åŸå› åˆ†æ</h2>
<p>å‘½ä»¤è¡Œæ„å»ºé€šè¿‡ <code>gradle.properties</code> ä¸­çš„ <code>org.gradle.java.home</code> é…ç½®æ­£ç¡®ä½¿ç”¨ JDK 17ï¼Œè€Œ Android Studio é»˜è®¤ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡æˆ–åµŒå…¥å¼ JDKï¼Œæ„å¤–æ‹¾å–äº†æœºå™¨ä¸Šæ®‹ç•™çš„ JDK 8ï¼Œå¯¼è‡´ç‰ˆæœ¬ä¸å…¼å®¹ã€‚</p>
<h2 data-id="heading-1">è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-2">1. å›ºå®š Gradle JDK è·¯å¾„</h3>
<p>åœ¨ <code>gradle.properties</code> ä¸­æ˜ç¡®æŒ‡å®šï¼š</p>
<pre><code class="hljs language-bash" lang="bash">org.gradle.java.home=D:/tools/Java/jdk-17.0.2+8
</code></pre>
<h3 data-id="heading-3">2. é…ç½® Gradle Toolchain</h3>
<p>åœ¨æ ¹ <code>build.gradle</code> ä¸­å£°æ˜ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">java {
    toolchain {
        languageVersion.<span class="hljs-keyword">set</span>(JavaLanguageVersion.of(<span class="hljs-number">17</span>))
    }
}
</code></pre>
<h3 data-id="heading-4">3. ç»Ÿä¸€ IDE è®¾ç½®</h3>
<p>åœ¨ Android Studio ä¸­ï¼š</p>
<ul>
<li>æ‰“å¼€ <code>File &gt; Settings &gt; Build Tools &gt; Gradle</code></li>
<li>å°† Gradle JDK æŒ‡å‘é¡¹ç›®æŒ‡å®šçš„ JDK 17 è·¯å¾„</li>
<li>ç¡®ä¿ <code>.idea/gradle.xml</code> ä¸­é…ç½®æ­£ç¡®å¹¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶</li>
</ul>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>å‘½ä»¤è¡Œä¸ Android Studio çš„æ„å»ºå·®å¼‚ä¸»è¦æºäºç¯å¢ƒé…ç½®ä¸ä¸€è‡´ã€‚é€šè¿‡å°† JDK ç‰ˆæœ¬ä¿¡æ¯å†™å…¥é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å®ç°ç¯å¢ƒæ ‡å‡†åŒ–ï¼Œç¡®ä¿è·¨ç¯å¢ƒæ„å»ºçš„ä¸€è‡´æ€§ã€‚æ ¸å¿ƒåŸåˆ™æ˜¯ï¼š<strong>é…ç½®å³ä»£ç ï¼Œç¯å¢ƒä¹Ÿåº”è¯¥è¢«æ‰˜ç®¡</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter å¸ƒå±€ â†” Android XML å¸ƒå±€ å¯¹ç…§è¡¨ï¼ˆå«å¸¸ç”¨å±æ€§ï¼‰]]></title>    <link>https://juejin.cn/post/7575757258833281050</link>    <guid>https://juejin.cn/post/7575757258833281050</guid>    <pubDate>2025-11-24T03:43:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575757258833281050" data-draft-id="7575748159608569882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter å¸ƒå±€ â†” Android XML å¸ƒå±€ å¯¹ç…§è¡¨ï¼ˆå«å¸¸ç”¨å±æ€§ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T03:43:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="renxhui"/> <meta itemprop="url" content="https://juejin.cn/user/1292681403181944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter å¸ƒå±€ â†” Android XML å¸ƒå±€ å¯¹ç…§è¡¨ï¼ˆå«å¸¸ç”¨å±æ€§ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1292681403181944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    renxhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:43:29.000Z" title="Mon Nov 24 2025 03:43:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter å¸ƒå±€ â†” Android XML å¸ƒå±€ å¯¹ç…§è¡¨ï¼ˆå«å¸¸ç”¨å±æ€§ï¼‰</h2>
<blockquote>
<p>é¢å‘å¿«é€ŸæŸ¥é˜…ï¼šFlutter ç»„ä»¶ä¸ Android XML è§†å›¾/å®¹å™¨çš„ä¸€ä¸€å¯¹åº”ä¸å¸¸è§å±æ€§å¯¹ç…§ã€‚</p>
</blockquote>
<h3 data-id="heading-1">å¸ƒå±€å®¹å™¨</h3>




























































































































<table><thead><tr><th>Flutter</th><th>Android XML</th><th>ç”¨é€”/å¤‡æ³¨</th><th>Flutter å¸¸ç”¨å±æ€§</th><th>Android å¸¸ç”¨å±æ€§</th></tr></thead><tbody><tr><td>Container</td><td>FrameLayout / LinearLayout(å•å­é¡¹)</td><td>å•å­é¡¹å®¹å™¨ï¼ŒèƒŒæ™¯/åœ†è§’/å†…å¤–è¾¹è·</td><td>width, height, padding, margin, alignment, decoration(BoxDecoration: color, border, borderRadius, boxShadow)</td><td>layout_width/height, padding, margin, background, foreground, layout_gravity</td></tr><tr><td>Row</td><td>LinearLayout (horizontal)</td><td>æ°´å¹³æ’å¸ƒ</td><td>mainAxisAlignment, crossAxisAlignment, mainAxisSize, children</td><td>orientation="horizontal", gravity, layout_gravity</td></tr><tr><td>Column</td><td>LinearLayout (vertical)</td><td>å‚ç›´æ’å¸ƒ</td><td>mainAxisAlignment, crossAxisAlignment, mainAxisSize, children</td><td>orientation="vertical", gravity, layout_gravity</td></tr><tr><td>Expanded / Flexible</td><td>layout_weight</td><td>å æ®å‰©ä½™ç©ºé—´/æƒé‡</td><td>flex, fit (tight/loose)</td><td>layout_weight, weightSum</td></tr><tr><td>Stack</td><td>FrameLayout / RelativeLayout / ConstraintLayout</td><td>å±‚å å®šä½</td><td>alignment, fit, clipBehavior</td><td>FrameLayout: layout_gravityï¼›Relative/Constraint: å®šä½çº¦æŸ</td></tr><tr><td>Positioned</td><td>RelativeLayout/ConstraintLayout params</td><td>ç»å¯¹/ç›¸å¯¹å®šä½</td><td>left, right, top, bottom, width, height</td><td>layout_alignParent*, toStartOf/toEndOf, constraints</td></tr><tr><td>Align / Center</td><td>gravity / layout_gravity</td><td>çˆ¶å†…å¯¹é½</td><td>alignment(Alignment)</td><td>gravityï¼ˆçˆ¶ï¼‰ï¼Œlayout_gravityï¼ˆå­ï¼‰</td></tr><tr><td>Padding</td><td>View padding</td><td>å†…è¾¹è·</td><td>padding(EdgeInsets)</td><td>padding</td></tr><tr><td>SizedBox</td><td>layout_width/height</td><td>å›ºå®šå®½é«˜/ç•™ç™½</td><td>width, height</td><td>layout_width/heightï¼Œç©º View</td></tr><tr><td>Wrap</td><td>FlexboxLayout(æ”¯æŒåº“) / Flow</td><td>è‡ªåŠ¨æ¢è¡Œæµå¼å¸ƒå±€</td><td>direction, spacing, runSpacing, alignment</td><td>app:flexWrap, app:justifyContent, app:alignItemsï¼ˆFlexboxLayoutï¼‰</td></tr><tr><td>ListView</td><td>RecyclerView / ListView</td><td>å¯æ»šåŠ¨åˆ—è¡¨</td><td>builder, separated, itemExtent, physics</td><td>RecyclerView: adapter, layoutManagerï¼›ListView: divider, dividerHeight</td></tr><tr><td>GridView</td><td>RecyclerView + GridLayoutManager / GridView</td><td>ç½‘æ ¼</td><td>gridDelegate, crossAxisSpacing, mainAxisSpacing</td><td>spanCount(GridLayoutManager), verticalSpacing, horizontalSpacing</td></tr><tr><td>SingleChildScrollView</td><td>ScrollView / NestedScrollView</td><td>å•å­é¡¹æ»šåŠ¨</td><td>scrollDirection, physics</td><td>fillViewport, nestedScrollingEnabled</td></tr><tr><td>PageView</td><td>ViewPager2</td><td>åˆ†é¡µæ»‘åŠ¨</td><td>controller, pageSnapping</td><td>offscreenPageLimit, orientation</td></tr><tr><td>SafeArea</td><td>fitsSystemWindows</td><td>é€‚é…çŠ¶æ€æ /åˆ˜æµ·</td><td>minimum, top/bottom</td><td>android:fitsSystemWindows</td></tr><tr><td>AspectRatio</td><td>ConstraintLayout ratio</td><td>å®½é«˜æ¯”</td><td>aspectRatio</td><td>app:layout_constraintDimensionRatio</td></tr></tbody></table>
<h3 data-id="heading-2">å¸¸ç”¨ç»„ä»¶</h3>





































































































<table><thead><tr><th>Flutter</th><th>Android XML</th><th>Flutter å¸¸ç”¨å±æ€§</th><th>Android å¸¸ç”¨å±æ€§</th></tr></thead><tbody><tr><td>Text</td><td>TextView</td><td>style, maxLines, overflow, textAlign</td><td>textSize(sp), textColor, maxLines, ellipsize, gravity</td></tr><tr><td>Image</td><td>ImageView</td><td>image(Asset/Network/File), fit(BoxFit), colorBlendMode</td><td>src, scaleType, tint</td></tr><tr><td>Icon</td><td>ImageView(Vector)</td><td>size, color</td><td>srcCompat(vector), tint</td></tr><tr><td>ElevatedButton</td><td>Button (Material)</td><td>onPressed, style(elevation, shape, backgroundColor)</td><td>onClick, backgroundTint, textAllCaps</td></tr><tr><td>OutlinedButton</td><td>Button + shape drawable</td><td>onPressed, side, shape</td><td>background, stroke, ripple</td></tr><tr><td>TextButton</td><td>Button(flat)</td><td>onPressed, style</td><td>textColor, ripple</td></tr><tr><td>Switch</td><td>SwitchCompat</td><td>value, onChanged, activeColor</td><td>checked, onCheckedChange, thumbTint</td></tr><tr><td>Checkbox</td><td>CheckBox</td><td>value, onChanged, tristate</td><td>checked, buttonTint</td></tr><tr><td>Radio</td><td>RadioButton</td><td>value, groupValue, onChanged</td><td>checked, buttonTint</td></tr><tr><td>Slider</td><td>SeekBar</td><td>value, min/max, divisions, label</td><td>progress, max</td></tr><tr><td>TextField / TextFormField</td><td>EditText (+ TextInputLayout)</td><td>controller, decoration(hint, prefix/suffix), keyboardType, obscureText</td><td>hint, inputType, maxLines, imeOptions</td></tr><tr><td>CircularProgressIndicator</td><td>ProgressBar (indeterminate)</td><td>strokeWidth, value</td><td>style="?android:attr/progressBarStyleLarge", indeterminate</td></tr><tr><td>LinearProgressIndicator</td><td>ProgressBar (horizontal)</td><td>minHeight, value</td><td>style="?android:attr/progressBarStyleHorizontal"</td></tr><tr><td>Card</td><td>CardView</td><td>elevation, margin, shape</td><td>cardUseCompatPadding, cardCornerRadius, cardElevation</td></tr><tr><td>Divider</td><td>View(height=1dp)</td><td>thickness, indent, color</td><td>layout_height, background</td></tr></tbody></table>
<h3 data-id="heading-3">å±æ€§å¯¹ç…§ä¸è¦ç‚¹</h3>
<ul>
<li>
<p>å®½é«˜ä¸æƒé‡</p>
<ul>
<li>Flutter: <code>SizedBox</code> / <code>Container(width/height)</code> æˆ– <code>constraints</code>ï¼›ä¼¸å±•ç”¨ <code>Expanded(flex)</code> / <code>Flexible(flex)</code>ã€‚</li>
<li>Android: <code>layout_width/height = wrap_content | match_parent</code>ï¼›ä¼¸å±•ç”¨ <code>layout_weight</code>ï¼ˆé…åˆ <code>weightSum</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>å¯¹é½ä¸é‡åŠ›</p>
<ul>
<li>Flutter: è¡Œåˆ—ç”¨ <code>mainAxisAlignment</code> / <code>crossAxisAlignment</code>ï¼›å•å­é¡¹ç”¨ <code>Align(alignment)</code> / <code>Center</code>ã€‚</li>
<li>Android: çˆ¶å®¹å™¨å¯¹é½ <code>gravity</code>ï¼Œå­è§†å›¾åœ¨çˆ¶å†…çš„å¯¹é½ <code>layout_gravity</code>ã€‚</li>
</ul>
</li>
<li>
<p>é—´è·</p>
<ul>
<li>Flutter: <code>padding</code> / <code>margin</code>ï¼ˆ<code>Container(margin:)</code>ï¼‰æˆ– <code>SizedBox</code> é—´éš”ï¼›åˆ—è¡¨åˆ†éš”ç”¨ <code>Divider</code> / <code>ListView.separated</code>ã€‚</li>
<li>Android: <code>padding</code> / <code>layout_margin</code>ï¼›<code>LinearLayout</code> å¯ç”¨ <code>divider</code> / <code>showDividers</code>ã€‚</li>
</ul>
</li>
<li>
<p>å æ”¾ä¸å®šä½</p>
<ul>
<li>Flutter: <code>Stack</code> + <code>Positioned(top/left/right/bottom)</code>ï¼›å¤æ‚çº¦æŸå¯ç”¨ <code>LayoutBuilder</code> ç­‰ã€‚</li>
<li>Android: <code>FrameLayout</code> ç®€å•è¦†ç›–ï¼›<code>RelativeLayout/ConstraintLayout</code> ç²¾ç»†çº¦æŸï¼ˆå¦‚ ratioï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>åœ†è§’ã€è¾¹æ¡†ã€é˜´å½±</p>
<ul>
<li>Flutter: <code>BoxDecoration(borderRadius, border, boxShadow)</code>ï¼›å¡ç‰‡é˜´å½±ç”¨ <code>Card</code> æˆ– <code>Material(elevation)</code>ã€‚</li>
<li>Android: shape drawable <code>&lt;shape&gt;&lt;corners/&gt;&lt;stroke/&gt;&lt;/shape&gt;</code>ï¼›<code>elevation</code> / <code>cardElevation</code>ã€‚</li>
</ul>
</li>
<li>
<p>å›¾ç‰‡å¡«å……</p>
<ul>
<li>Flutter: <code>fit: BoxFit.cover / contain / fill</code>ã€‚</li>
<li>Android: <code>scaleType="centerCrop / fitCenter / fitXY"</code>ã€‚</li>
</ul>
</li>
<li>
<p>æ»šåŠ¨ä¸å¤ç”¨</p>
<ul>
<li>Flutter: <code>ListView.builder</code> / <code>GridView.builder</code> æŒ‰éœ€æ„å»ºã€‚</li>
<li>Android: <code>RecyclerView</code> + <code>Adapter/ViewHolder</code> å¤ç”¨ã€‚</li>
</ul>
</li>
<li>
<p>å¯è§æ€§</p>
<ul>
<li>Flutter: <code>Visibility</code>ï¼ˆgone/invisibleï¼‰ã€<code>Offstage</code>ï¼ˆä¸å¸ƒå±€ï¼‰ã€‚</li>
<li>Android: <code>visibility="visible|invisible|gone"</code>ã€‚</li>
</ul>
</li>
<li>
<p>ç‚¹å‡»åé¦ˆï¼ˆæ³¢çº¹ï¼‰</p>
<ul>
<li>Flutter: <code>InkWell</code> / <code>InkResponse</code>ï¼ˆéœ€æœ‰ <code>Material</code> ç¥–å…ˆï¼‰ã€‚</li>
<li>Android: <code>foreground="?attr/selectableItemBackgroundBorderless"</code> æˆ– <code>ripple</code>ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">è¯¦ç»†å±æ€§å¯¹ç…§ä¸è§£é‡Š</h3>
<h4 data-id="heading-5">1) å°ºå¯¸ä¸çº¦æŸï¼ˆSize &amp; Constraintsï¼‰</h4>









































<table><thead><tr><th>ç›®çš„</th><th>Flutter</th><th>Android XML</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å›ºå®šå®½é«˜</td><td><code>SizedBox(width, height)</code> / <code>Container(width, height)</code></td><td><code>layout_width/height</code> = å®šå€¼dp</td><td>Flutter ä¸­å®½é«˜ä¸ºé€»è¾‘åƒç´ ï¼ŒAndroid å¸¸ç”¨ dpï¼›æ³¨æ„ç»Ÿä¸€åº¦é‡ã€‚</td></tr><tr><td>è‡ªé€‚åº”å†…å®¹</td><td>é»˜è®¤ï¼ˆæœªè®¾ç½®å°ºå¯¸ï¼‰</td><td><code>wrap_content</code></td><td>å­å†…å®¹å†³å®šå¤§å°ã€‚</td></tr><tr><td>å æ»¡çˆ¶å®¹å™¨</td><td><code>SizedBox.expand()</code> / <code>Align(alignment).widthFactor/heightFactor</code></td><td><code>match_parent</code></td><td>Flutter å¤šé€šè¿‡çˆ¶å¸ƒå±€çº¦æŸï¼Œæˆ– <code>Expanded</code> å æ»¡ä¸»è½´å‰©ä½™ç©ºé—´ã€‚</td></tr><tr><td>æœ€å°/æœ€å¤§çº¦æŸ</td><td><code>ConstrainedBox/BoxConstraints</code></td><td>éœ€ä½¿ç”¨ ConstraintLayout æˆ–åœ¨ä»£ç ä¸­æµ‹é‡</td><td>Flutter æä¾›æ›´ç›´æ¥çš„æœ€å°/æœ€å¤§è¾¹ç•Œæ§åˆ¶ã€‚</td></tr><tr><td>æ¯”ä¾‹</td><td><code>AspectRatio(aspectRatio)</code></td><td><code>app:layout_constraintDimensionRatio="W:H"</code></td><td>Android éœ€ç”¨ ConstraintLayout çš„ ratioã€‚</td></tr></tbody></table>
<h4 data-id="heading-6">2) Flex/æƒé‡ï¼ˆRow/Column â†” LinearLayout weightï¼‰</h4>



































<table><thead><tr><th>æ¦‚å¿µ</th><th>Flutter</th><th>Android XML</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ä¸»è½´æ–¹å‘</td><td>Row(æ¨ª) / Column(ç«–)</td><td>LinearLayout orientation</td><td>ä¸€è‡´ã€‚</td></tr><tr><td>æƒé‡</td><td><code>Expanded(flex: n)</code> / <code>Flexible(flex: n)</code></td><td><code>layout_weight="n"</code>ï¼ˆé…åˆ <code>weightSum</code> å¯é€‰ï¼‰</td><td>å¤šä¸ªå­è§†å›¾æŒ‰æƒé‡åˆ†é…ä¸»è½´å‰©ä½™ç©ºé—´ã€‚</td></tr><tr><td>ä¸»è½´å¯¹é½</td><td><code>mainAxisAlignment</code> = start/end/center/spaceBetween/spaceAround/spaceEvenly</td><td><code>gravity</code>ï¼ˆå¯¹çˆ¶ï¼‰ï¼Œä¹Ÿå¯é æƒé‡å®ç°åˆ†å¸ƒ</td><td>Flutter å†…ç½®æ›´ä¸°å¯Œçš„åˆ†å¸ƒæ–¹å¼ã€‚</td></tr><tr><td>äº¤å‰è½´å¯¹é½</td><td><code>crossAxisAlignment</code> = start/end/center/stretch/baseline</td><td><code>gravity</code>ï¼ˆå¯¹å­ï¼‰+ <code>layout_gravity</code></td><td>Flutter çš„ <code>stretch</code> ç­‰ä»·äº Android å­è§†å›¾ <code>match_parent</code> ç»“åˆçˆ¶ gravityã€‚</td></tr></tbody></table>
<p>å¸¸è§æ˜ å°„ï¼š</p>
<ul>
<li><code>mainAxisAlignment.spaceBetween</code> â‰ˆ å­é¡¹å‡åŒ€åˆ†å¸ƒï¼Œé¦–å°¾è´´è¾¹ï¼›Android éœ€ç”¨ <code>weight</code> æˆ–çº¦æŸå®ç°ã€‚</li>
<li><code>crossAxisAlignment.stretch</code> â‰ˆ å­é¡¹äº¤å‰è½´æ‹‰ä¼¸ï¼›Android å­é¡¹ <code>match_parent</code>ã€‚</li>
</ul>
<h4 data-id="heading-7">3) å¯¹é½ï¼ˆAlignment â†” gravity/layout_gravityï¼‰</h4>



















































<table><thead><tr><th>Flutter Alignment</th><th>Android</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>Alignment.center</code></td><td><code>gravity="center"</code> æˆ–å­ <code>layout_gravity="center"</code></td><td>å±…ä¸­</td></tr><tr><td><code>Alignment.topLeft</code></td><td>`gravity="top</td><td>start"`</td><td>å·¦ä¸Š</td></tr><tr><td><code>Alignment.topRight</code></td><td>`gravity="top</td><td>end"`</td><td>å³ä¸Š</td></tr><tr><td><code>Alignment.bottomLeft</code></td><td>`gravity="bottom</td><td>start"`</td><td>å·¦ä¸‹</td></tr><tr><td><code>Alignment.bottomRight</code></td><td>`gravity="bottom</td><td>end"`</td><td>å³ä¸‹</td></tr><tr><td><code>Alignment.centerLeft</code></td><td>`gravity="center_vertical</td><td>start"`</td><td>å‚ç›´å±…ä¸­é å·¦</td></tr><tr><td><code>Alignment.centerRight</code></td><td>`gravity="center_vertical</td><td>end"`</td><td>å‚ç›´å±…ä¸­é å³</td></tr></tbody></table>
<p>çˆ¶å®¹å™¨æ•´ä½“å¯¹é½ç”¨ <code>gravity</code>ï¼Œå•ä¸ªå­è§†å›¾åœ¨çˆ¶å†…å¯¹é½ç”¨ <code>layout_gravity</code>ã€‚</p>
<h4 data-id="heading-8">4) é—´è·ï¼ˆPadding &amp; Marginï¼‰</h4>

























<table><thead><tr><th>Flutter</th><th>Android XML</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>Padding(padding: EdgeInsets.all(8))</code></td><td><code>padding="8dp"</code></td><td>å…¨éƒ¨è¾¹åŒå€¼</td></tr><tr><td><code>EdgeInsets.symmetric(horizontal: 8, vertical: 4)</code></td><td><code>paddingStart/End/Top/Bottom</code></td><td>æ°´å¹³/å‚ç›´å¯¹ç§°</td></tr><tr><td><code>Container(margin: ...)</code></td><td><code>layout_margin*</code></td><td>å¤–è¾¹è·åœ¨ Android ç”¨ <code>layout_margin</code> ç³»åˆ—å±æ€§</td></tr></tbody></table>
<p>å»ºè®®ï¼šç»Ÿä¸€ä½¿ç”¨ Android çš„ dp ä¸ Flutter çš„é€»è¾‘åƒç´ æ¢ç®—ï¼ˆä¸€èˆ¬ 1:1 è§†è§‰ç­‰æ•ˆï¼‰ã€‚</p>
<h4 data-id="heading-9">5) æ–‡æœ¬ï¼ˆText â†” TextViewï¼‰</h4>



































































<table><thead><tr><th>éœ€æ±‚</th><th>Flutter</th><th>Android XML</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å­—å·</td><td><code>style: TextStyle(fontSize: 16)</code></td><td><code>textSize="16sp"</code></td><td>Android ä½¿ç”¨ spï¼ŒFlutter é€»è¾‘åƒç´ æ¥è¿‘ sp è¯­ä¹‰</td></tr><tr><td>é¢œè‰²</td><td><code>TextStyle(color: Colors.red)</code></td><td><code>textColor</code></td><td/></tr><tr><td>å­—é‡</td><td><code>fontWeight: FontWeight.w600</code></td><td><code>textStyle="bold"</code> æˆ– <code>setTypeface</code></td><td>Android XML åŸç”Ÿæ”¯æŒæœ‰é™</td></tr><tr><td>è¡Œé«˜</td><td><code>height: 1.4</code></td><td><code>lineSpacingMultiplier="1.4"</code></td><td>Flutter è¡Œé«˜ä¸ºå€æ•°ï¼ˆç›¸å¯¹ fontSizeï¼‰</td></tr><tr><td>å­—é—´è·</td><td><code>letterSpacing: 0.5</code></td><td><code>android:letterSpacing="0.05"</code></td><td>Android ä¸º em å•ä½ï¼ˆ0.05â‰ˆ5%ï¼‰</td></tr><tr><td>è£…é¥°</td><td><code>decoration: TextDecoration.underline</code></td><td><code>paintFlags="underline"</code></td><td/></tr><tr><td>å¯¹é½</td><td><code>textAlign: center/left/right/justify</code></td><td>`gravity="center</td><td>start</td><td>end"`</td><td/></tr><tr><td>æº¢å‡ºçœç•¥</td><td><code>overflow: TextOverflow.ellipsis, maxLines: n</code></td><td><code>ellipsize="end", maxLines="n"</code></td><td>ä¸¤ç«¯çœç•¥/ä¸­é—´çœç•¥éœ€è¦è‡ªå®šä¹‰</td></tr><tr><td>è‡ªåŠ¨æ¢è¡Œ</td><td><code>softWrap: true</code></td><td>é»˜è®¤æ¢è¡Œ</td><td/></tr></tbody></table>
<h4 data-id="heading-10">6) å›¾ç‰‡å¡«å……ï¼ˆBoxFit â†” scaleTypeï¼‰</h4>



































<table><thead><tr><th>Flutter <code>BoxFit</code></th><th>Android <code>scaleType</code></th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td><code>contain</code></td><td><code>fitCenter</code></td><td>ç­‰æ¯”å®Œæ•´æ˜¾ç¤ºï¼Œå¯èƒ½ç•™ç™½</td></tr><tr><td><code>cover</code></td><td><code>centerCrop</code></td><td>ç­‰æ¯”è£å‰ªé“ºæ»¡ï¼Œå¯èƒ½æˆªæ–­</td></tr><tr><td><code>fill</code></td><td><code>fitXY</code></td><td>æ‹‰ä¼¸é“ºæ»¡ï¼Œå¯èƒ½å˜å½¢</td></tr><tr><td><code>fitWidth</code></td><td><code>fitStart/fitEnd</code> + å°ºå¯¸æ§åˆ¶</td><td>å®½åº¦å……æ»¡ï¼Œç­‰æ¯”ç¼©æ”¾</td></tr><tr><td><code>none</code></td><td><code>center</code></td><td>åŸå§‹å¤§å°ç½®ä¸­</td></tr></tbody></table>
<h4 data-id="heading-11">7) èƒŒæ™¯ã€åœ†è§’ã€è¾¹æ¡†ã€é˜´å½±</h4>



































<table><thead><tr><th>æ•ˆæœ</th><th>Flutter</th><th>Android XML</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>èƒŒæ™¯è‰²</td><td><code>Container(color)</code> æˆ– <code>decoration.color</code></td><td><code>background</code></td><td>Flutter å»ºè®®ä½¿ç”¨ <code>decoration</code></td></tr><tr><td>åœ†è§’</td><td><code>borderRadius: BorderRadius.circular(8)</code></td><td><code>&lt;shape&gt;&lt;corners android:radius="8dp"/&gt;&lt;/shape&gt;</code></td><td>Android é‡‡ç”¨ shape drawable</td></tr><tr><td>è¾¹æ¡†</td><td><code>border: Border.all(color, width)</code></td><td><code>&lt;stroke android:width="1dp" android:color="..."/&gt;</code></td><td/></tr><tr><td>é˜´å½±</td><td><code>boxShadow</code> / <code>Material(elevation)</code></td><td><code>elevation</code> / <code>cardElevation</code></td><td>Flutter çš„ <code>elevation</code> éœ€ Material è¯­ä¹‰</td></tr></tbody></table>
<h4 data-id="heading-12">8) å¯è§æ€§ä¸å ä½</h4>























<table><thead><tr><th>åœºæ™¯</th><th>Flutter</th><th>Android XML</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å ä½ä½†ä¸å¯è§</td><td><code>Visibility(visible: false, maintainSize: true)</code></td><td><code>visibility="invisible"</code></td><td>ä»å æ®ç©ºé—´</td></tr><tr><td>ä¸å ä½éšè—</td><td><code>Visibility(visible: false)</code> / <code>Offstage(offstage: true)</code></td><td><code>visibility="gone"</code></td><td>ä¸å‚ä¸å¸ƒå±€</td></tr></tbody></table>
<h4 data-id="heading-13">9) äº¤äº’ä¸æ‰‹åŠ¿</h4>





























<table><thead><tr><th>åŠŸèƒ½</th><th>Flutter</th><th>Android</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç‚¹å‡»</td><td><code>GestureDetector(onTap)</code> / <code>InkWell</code></td><td><code>android:onClick</code> æˆ– <code>setOnClickListener</code></td><td>Flutter çš„ <code>InkWell</code> æœ‰æ°´æ³¢çº¹åé¦ˆ</td></tr><tr><td>é•¿æŒ‰</td><td><code>onLongPress</code></td><td><code>setOnLongClickListener</code></td><td/></tr><tr><td>æ»‘åŠ¨</td><td><code>onPan*</code> / <code>onHorizontalDrag*</code></td><td><code>OnTouchListener</code> + GestureDetector</td><td>å¤æ‚æ‰‹åŠ¿ Flutter æ›´ä¾¿æ·</td></tr></tbody></table>
<h4 data-id="heading-14">10) æ»šåŠ¨ä¸æƒ¯æ€§</h4>























<table><thead><tr><th>éœ€æ±‚</th><th>Flutter</th><th>Android</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æƒ¯æ€§/ç‰©ç†</td><td><code>physics: BouncingScrollPhysics / ClampingScrollPhysics</code></td><td><code>OverScrollMode</code>, <code>EdgeEffect</code></td><td>iOS é£æ ¼å›å¼¹ç”¨ <code>Bouncing</code></td></tr><tr><td>åµŒå¥—æ»šåŠ¨</td><td><code>NestedScrollView</code>/Slivers</td><td><code>NestedScrollView</code></td><td>éƒ½æ”¯æŒ AppBar è”åŠ¨ç­‰é«˜çº§æ•ˆæœ</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-Konva ä½¿ç”¨ï¼ˆç¼©æ”¾ / è¿˜åŸ / æ‹–åŠ¨ï¼‰ ç¤ºä¾‹]]></title>    <link>https://juejin.cn/post/7575757258833379354</link>    <guid>https://juejin.cn/post/7575757258833379354</guid>    <pubDate>2025-11-24T03:55:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575757258833379354" data-draft-id="7575748159608586266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-Konva ä½¿ç”¨ï¼ˆç¼©æ”¾ / è¿˜åŸ / æ‹–åŠ¨ï¼‰ ç¤ºä¾‹"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-24T03:55:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¿å¹´"/> <meta itemprop="url" content="https://juejin.cn/user/2277843825591400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-Konva ä½¿ç”¨ï¼ˆç¼©æ”¾ / è¿˜åŸ / æ‹–åŠ¨ï¼‰ ç¤ºä¾‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825591400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¿å¹´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T03:55:49.000Z" title="Mon Nov 24 2025 03:55:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">Vue-Konva ä½¿ç”¨ï¼ˆç¼©æ”¾ / è¿˜åŸ / æ‹–åŠ¨ï¼‰ ç¤ºä¾‹ï¼ˆå½“å‰ç¤ºä¾‹ä¸ºvue3ç‰ˆæœ¬ï¼‰</h2>
<h3 data-id="heading-1">ç›®æ ‡</h3>
<ul>
<li>åœ¨ä¸€ä¸ª Vue å•æ–‡ä»¶ç»„ä»¶ä¸­ï¼Œå®Œæˆä»¥ä¸‹äº¤äº’ï¼š
<ul>
<li>é¼ æ ‡æ»šè½®ç›¸å¯¹æŒ‡é’ˆä½ç½®ç¼©æ”¾ï¼ˆå‘ä¸Šæ”¾å¤§ã€å‘ä¸‹ç¼©å°ï¼‰</li>
<li>æŒ‰é’®ï¼ˆæ”¯æŒé•¿æŒ‰ï¼‰å±…ä¸­æ”¾å¤§ / å±…ä¸­ç¼©å° / è¿˜åŸ</li>
<li>æŒ‰ä½ <code>Ctrl + å·¦é”®</code> æ‹–åŠ¨ç”»å¸ƒï¼ˆä»…åœ¨æ”¾å¤§åå¯æ‹–åŠ¨ï¼‰</li>
<li>ç¼©å°æ—¶å±…ä¸­æ˜¾ç¤ºã€ç¦æ­¢æ‹–åŠ¨</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">å®‰è£…ä¸æ³¨å†Œ</h3>
<ul>
<li>å®‰è£…ä¾èµ–ï¼ˆä»»é€‰åŒ…ç®¡ç†å™¨ï¼‰ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">npm i vue-konva konva
<span class="hljs-comment"># æˆ–</span>
pnpm add vue-konva konva
</code></pre>
<ul>
<li>æ³¨å†Œæ’ä»¶ï¼ˆä¸¤ç§æ–¹å¼ï¼‰ï¼š
<ul>
<li>å…¥å£å¤„å…¨å±€æ³¨å†Œï¼š</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueKonva</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-konva'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
<span class="hljs-comment">// ä½¿ç”¨ v- å‰ç¼€ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼š{ prefix: 'V' }</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueKonva</span>, { <span class="hljs-attr">prefix</span>: <span class="hljs-string">'V'</span> });
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<ul>
<li>ç»„ä»¶å†…è‡ªæ³¨å†Œï¼ˆåœ¨ç»„ä»¶ <code>setup</code> é˜¶æ®µæ³¨å†Œï¼Œç¡®ä¿é¦–å¸§æ¸²æŸ“å‰å®Œæˆï¼‰ï¼š</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// åœ¨ç»„ä»¶ setup é˜¶æ®µæ³¨å†Œï¼Œé¿å…é¦–æ¬¡æ¸²æŸ“å‰å‡ºç°æœªæ³¨å†Œé”™è¯¯</span>
<span class="hljs-keyword">import</span> { getCurrentInstance } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueKonva</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-konva'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">getCurrentInstance</span>()?.<span class="hljs-property">appContext</span>.<span class="hljs-property">app</span>;
app?.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueKonva</span>, { <span class="hljs-attr">prefix</span>: <span class="hljs-string">'V'</span> });
</code></pre>
<h3 data-id="heading-3">ç»„ä»¶ä¸äº‹ä»¶è¯´æ˜</h3>
<ul>
<li><code>VStage</code>ï¼šKonva <code>Stage</code> çš„ Vue å°è£…ï¼Œæ˜¯ç”»å¸ƒæ ¹å®¹å™¨ã€‚
<ul>
<li>äº‹ä»¶ï¼š<code>@wheel</code>ï¼ˆæ»šè½®ç¼©æ”¾ï¼‰ã€<code>@mousedown/@mousemove/@mouseup/@mouseleave</code>ï¼ˆå¹³ç§»æ‰‹åŠ¿ï¼‰</li>
</ul>
</li>
<li><code>VLayer</code>ï¼šKonva <code>Layer</code> çš„ Vue å°è£…ï¼Œæ˜¯çœŸæ­£çš„ <code>&lt;canvas&gt;</code> å±‚ï¼Œå¯æ”¾å¤šä¸ªå›¾å±‚ã€‚</li>
<li><code>VRect</code> / <code>VText</code> / <code>VImage</code> / <code>VTransformer</code>ï¼šKonva åŸºç¡€ä¸å˜æ¢ç»„ä»¶ã€‚</li>
</ul>
<h3 data-id="heading-4">äº¤äº’è®¾è®¡è¦ç‚¹</h3>
<ul>
<li>æŒ‡é’ˆç›¸å¯¹ç¼©æ”¾ï¼šé€šè¿‡è®°å½•æŒ‡é’ˆä½ç½® <code>pos</code>ï¼Œè®¡ç®—ç¼©æ”¾å‰æŒ‡é’ˆå¯¹åº”çš„ç”»å¸ƒåæ ‡ <code>mousePointTo</code>ï¼Œå†åç®—ç¼©æ”¾åç”»å¸ƒä½ç½®ï¼Œä½¿â€œç¼©æ”¾å›´ç»•æŒ‡é’ˆâ€å‘ç”Ÿã€‚</li>
<li>å±…ä¸­ç¼©æ”¾æŒ‰é’®ï¼šä»¥ç”»å¸ƒä¸­å¿ƒä¸ºç¼©æ”¾é”šç‚¹ï¼Œä¿è¯è§†è§‰ç¨³å®šã€‚</li>
<li>è¾¹ç•Œçº¦æŸï¼š
<ul>
<li>å½“ <code>scale &lt;= 1</code>ï¼ˆç¼©å°ï¼‰æ—¶ï¼Œå¼ºåˆ¶å±…ä¸­æ˜¾ç¤ºï¼Œç¦æ­¢å¹³ç§»ã€‚</li>
<li>å½“ <code>scale &gt; 1</code>ï¼ˆæ”¾å¤§ï¼‰æ—¶ï¼Œé™åˆ¶å¹³ç§»åœ¨å¯è§†èŒƒå›´å†…ï¼Œé¿å…å‡ºç°å¤§é¢ç§¯ç©ºç™½ã€‚</li>
</ul>
</li>
<li>Ctrl æ‹–åŠ¨ï¼šæŒ‰ä½ <code>Ctrl + å·¦é”®</code> æ—¶ï¼Œç¦ç”¨å…ƒç´ äº¤äº’ï¼ˆä¸å¯æ‹–åŠ¨ / ä¸å“åº”ç‚¹å‡»ï¼‰ï¼Œä¸“æ³¨äºç”»å¸ƒå¹³ç§»ã€‚</li>
</ul>
<h3 data-id="heading-5">å•æ–‡ä»¶ç»„ä»¶ç¤ºä¾‹ï¼ˆå¯ç›´æ¥ä½¿ç”¨ï¼‰</h3>
<blockquote>
<p>å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®ä¸­å³å¯è¿è¡Œã€‚è‹¥å·²åœ¨å…¥å£å¤„æ³¨å†Œäº† <code>VueKonva</code>ï¼Œç»„ä»¶å†…æ³¨å†Œå¯åˆ é™¤ã€‚</p>
</blockquote>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { getCurrentInstance, onMounted, onUnmounted, ref } from 'vue';
import VueKonva from 'vue-konva';

// ç»„ä»¶å†…è‡ªæ³¨å†Œ VueKonvaï¼ˆä½ ä¹Ÿå¯ä»¥åœ¨åº”ç”¨å…¥å£ç»Ÿä¸€æ³¨å†Œï¼‰
const app = getCurrentInstance()?.appContext.app;
app?.use(VueKonva, { prefix: 'V' });
// ç”»å¸ƒå°ºå¯¸ï¼ˆæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ï¼‰
const canvasSize = { width: 800, height: 600 };

// VStage çš„æ¨¡æ¿å¼•ç”¨ï¼Œç”¨äºè·å– Konva Stage å®ä¾‹
const stageRef = ref&lt;any&gt;(null);

// Ctrl + å·¦é”®å¹³ç§»ç›¸å…³çŠ¶æ€
const isPanning = ref(false); // æ˜¯å¦æ­£åœ¨å¹³ç§»
const panStartPointer = ref&lt;{ x: number, y: number } | null&gt;(null); // å¹³ç§»èµ·ç‚¹çš„æŒ‡é’ˆä½ç½®
const panStartStagePos = ref&lt;{ x: number, y: number } | null&gt;(null); // å¹³ç§»èµ·ç‚¹çš„ç”»å¸ƒä½ç½®
const isCtrlPressing = ref(false); // æ˜¯å¦æŒ‰ä½äº† Ctrl é”®ï¼ˆå½±å“å…ƒç´ äº¤äº’ä¸å…‰æ ‡ï¼‰

// è·å– Konva Stage å®ä¾‹
function getStage() {
  const node = stageRef.value?.getNode?.();
  return node ?? null;
}

// è¿ç»­ç¼©æ”¾æ¯”ä¾‹æ­¥è¿›ï¼ˆè¶Šæ¥è¿‘ 1 è¶Šå¹³æ»‘ï¼‰
const SCALE_STEP = 1.05;

// çº¦æŸç”»å¸ƒä½ç½®ï¼š
// - ç¼©æ”¾ â‰¤ 1 æ—¶ï¼Œå±…ä¸­æ˜¾ç¤ºï¼Œä¸å…è®¸æ¼‚ç§»
// - ç¼©æ”¾ &gt; 1 æ—¶ï¼Œé™åˆ¶åœ¨å¯è§†èŒƒå›´å†…ï¼Œé¿å…å‡ºç°ç©ºç™½
function clampStagePosition(stage: any) {
  const s = stage.scaleX();
  if (s &lt;= 1) {
    const cx = stage.width() * (1 - s) / 2;
    const cy = stage.height() * (1 - s) / 2;
    stage.position({ x: cx, y: cy });
    return;
  }
  const maxX = 0;
  const minX = stage.width() * (1 - s);
  const maxY = 0;
  const minY = stage.height() * (1 - s);
  const pos = stage.position();
  const clampedX = Math.min(maxX, Math.max(minX, pos.x));
  const clampedY = Math.min(maxY, Math.max(minY, pos.y));
  stage.position({ x: clampedX, y: clampedY });
}

// æŒ‡é’ˆç›¸å¯¹ç¼©æ”¾ï¼šä¿æŒæŒ‡é’ˆä¸‹çš„å†…å®¹ä¸ºç¼©æ”¾ä¸­å¿ƒ
// factor &gt; 1 æ”¾å¤§ï¼›factor &lt; 1 ç¼©å°
// doClamp = trueï¼ˆæ»šè½®ï¼‰ï¼šéœ€è¦è¾¹ç•Œçº¦æŸ
// doClamp = falseï¼ˆæŒ‰é’®ï¼‰ï¼šä¸ç«‹å³çº¦æŸï¼Œä½†å½“ç¼©å°åˆ° â‰¤1 æ—¶ä»éœ€å±…ä¸­
function zoomBy(factor: number, pointer?: { x: number, y: number }, doClamp = true) {
  const stage = getStage();
  if (!stage)
    return;

  const oldScale = stage.scaleX();
  const pos = pointer ?? stage.getPointerPosition() ?? { x: stage.width() / 2, y: stage.height() / 2 };

  // è®¡ç®—æŒ‡é’ˆç›¸å¯¹ç¼©æ”¾é”šç‚¹
  const mousePointTo = {
    x: (pos.x - stage.x()) / oldScale,
    y: (pos.y - stage.y()) / oldScale,
  };

  // åº”ç”¨ç¼©æ”¾
  const newScale = oldScale * factor;
  stage.scale({ x: newScale, y: newScale });

  // åç®—ç¼©æ”¾åçš„ä½ç½®ï¼Œä½¿ç¼©æ”¾ç›¸å¯¹é”šç‚¹
  const newPos = {
    x: pos.x - mousePointTo.x * newScale,
    y: pos.y - mousePointTo.y * newScale,
  };
  stage.position(newPos);

  // è¾¹ç•Œçº¦æŸç­–ç•¥
  if (doClamp) {
    clampStagePosition(stage);
  }
  else {
    if (newScale &lt;= 1)
      clampStagePosition(stage);
  }

  stage.batchDraw();
}

// æŒ‰é’®ï¼šä»ç”»å¸ƒä¸­å¿ƒæ”¾å¤§
function zoomIn() {
  const stage = getStage();
  if (!stage)
    return;
  zoomBy(SCALE_STEP, { x: stage.width() / 2, y: stage.height() / 2 }, false);
}

// æŒ‰é’®ï¼šä»ç”»å¸ƒä¸­å¿ƒç¼©å°
function zoomOut() {
  const stage = getStage();
  if (!stage)
    return;
  zoomBy(1 / SCALE_STEP, { x: stage.width() / 2, y: stage.height() / 2 }, false);
}

// é•¿æŒ‰ï¼šæ”¯æŒæŒ‰ä½æŒ‰é’®æŒç»­ç¼©æ”¾ï¼ŒçŸ­æŒ‰è§¦å‘ä¸€æ¬¡
const holdTimeout = ref&lt;number | null&gt;(null);
const holdInterval = ref&lt;number | null&gt;(null);
const holdAction = ref&lt;'in' | 'out' | null&gt;(null);
const HOLD_DELAY_MS = 250;     // é•¿æŒ‰åˆ¤å®šå»¶è¿Ÿ
const HOLD_INTERVAL_MS = 60;   // é•¿æŒ‰æ—¶çš„è¿ç»­è§¦å‘é—´éš”

function clearHoldTimers() {
  if (holdTimeout.value) {
    window.clearTimeout(holdTimeout.value);
    holdTimeout.value = null;
  }
  if (holdInterval.value) {
    window.clearInterval(holdInterval.value);
    holdInterval.value = null;
  }
}

function onPressStart(action: 'in' | 'out') {
  clearHoldTimers();
  holdAction.value = action;
  holdTimeout.value = window.setTimeout(() =&gt; {
    holdInterval.value = window.setInterval(() =&gt; {
      if (holdAction.value === 'in')
        zoomIn();
      else
        zoomOut();
    }, HOLD_INTERVAL_MS);
  }, HOLD_DELAY_MS);
}

function onPressEnd() {
  // çŸ­æŒ‰ï¼šå°šæœªè¿›å…¥é•¿æŒ‰å¾ªç¯æ—¶è§¦å‘ä¸€æ¬¡
  if (holdTimeout.value &amp;&amp; !holdInterval.value &amp;&amp; holdAction.value) {
    if (holdAction.value === 'in')
      zoomIn();
    else
      zoomOut();
  }
  clearHoldTimers();
  holdAction.value = null;
}

// è¿˜åŸï¼šç¼©æ”¾ä¸º 1ï¼Œä½ç½®å½’ä½ï¼ˆä¸­å¿ƒï¼‰
function resetZoom() {
  const stage = getStage();
  if (!stage)
    return;
  stage.scale({ x: 1, y: 1 });
  stage.position({ x: 0, y: 0 });
  stage.batchDraw();
}

// æ»šè½®ç¼©æ”¾ï¼šå‘ä¸Šæ”¾å¤§ï¼Œå‘ä¸‹ç¼©å°ï¼›ç›¸å¯¹æŒ‡é’ˆçš„ä½ç½®
function onWheel(e: any) {
  const stage = getStage();
  if (!stage)
    return;
  e.evt?.preventDefault?.();
  const direction = e.evt?.deltaY &gt; 0 ? (1 / SCALE_STEP) : SCALE_STEP;
  zoomBy(direction, stage.getPointerPosition() ?? undefined);
}

// Ctrl+å·¦é”®å¼€å§‹å¹³ç§»ï¼ˆä»…å½“ç¼©æ”¾ &gt; 1 æ—¶æœ‰æ•ˆï¼‰
function onStageMouseDown(e: any) {
  const stage = getStage();
  if (!stage)
    return;
  if (e.evt?.ctrlKey &amp;&amp; e.evt?.button === 0) {
    if (stage.scaleX() &lt;= 1)
      return;
    e.evt.preventDefault();
    isPanning.value = true;
    panStartPointer.value = stage.getPointerPosition() ?? null;
    const pos = stage.position();
    panStartStagePos.value = { x: pos.x, y: pos.y };
  }
}

// å¹³ç§»ä¸­ï¼šæ ¹æ®èµ·ç‚¹ä¸å½“å‰æŒ‡é’ˆè®¡ç®—åç§»ï¼Œå¹¶åšè¾¹ç•Œçº¦æŸ
function onStageMouseMove() {
  if (!isPanning.value)
    return;
  const stage = getStage();
  if (!stage)
    return;
  const pointer = stage.getPointerPosition();
  if (!pointer || !panStartPointer.value || !panStartStagePos.value)
    return;
  const dx = pointer.x - panStartPointer.value.x;
  const dy = pointer.y - panStartPointer.value.y;
  stage.position({ x: panStartStagePos.value.x + dx, y: panStartStagePos.value.y + dy });
  clampStagePosition(stage);
  stage.batchDraw();
}

// ç»“æŸå¹³ç§»ï¼Œé‡ç½®çŠ¶æ€
function onStageMouseUp() {
  isPanning.value = false;
  panStartPointer.value = null;
  panStartStagePos.value = null;
}

// è®°å½• Ctrl æŒ‰é”®çŠ¶æ€ï¼Œç”¨äºåˆ‡æ¢å…ƒç´ äº¤äº’ä¸å®¹å™¨é¼ æ ‡æ ·å¼
function onKeyDown(e: KeyboardEvent) {
  if (e.key === 'Control')
    isCtrlPressing.value = true;
}
function onKeyUp(e: KeyboardEvent) {
  if (e.key === 'Control')
    isCtrlPressing.value = false;
}

onMounted(() =&gt; {
  window.addEventListener('keydown', onKeyDown);
  window.addEventListener('keyup', onKeyUp);
});
onUnmounted(() =&gt; {
  window.removeEventListener('keydown', onKeyDown);
  window.removeEventListener('keyup', onKeyUp);
  clearHoldTimers();
});

// ç¤ºä¾‹å›¾å½¢é…ç½®ï¼ˆçŸ©å½¢&amp;æ–‡å­—ï¼‰
// Ctrl æŒ‰ä¸‹æ—¶ç¦ç”¨å…ƒç´ äº¤äº’ï¼ˆä¸å¯æ‹–åŠ¨/ä¸å¯ç‚¹å‡»ï¼‰ï¼Œä¸“æ³¨ç”»å¸ƒå¹³ç§»
const rectConfig = ref({
  x: canvasSize.width / 2 - 100,
  y: canvasSize.height / 2 - 50,
  width: 200,
  height: 100,
  fill: '#80c7ff',
  stroke: '#0ea5e9',
  strokeWidth: 1,
  draggable: true,
});
const textConfig = ref({
  x: canvasSize.width / 2 - 50,
  y: canvasSize.height / 2 + 70,
  text: 'Hello, Konva!',
  fontSize: 18,
  fill: '#334155',
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div class="konva-demo-container" :class="{ 'cursor-pointer': isCtrlPressing }"&gt;
    &lt;!-- å·¥å…·æ ï¼šå±…å·¦ä¸Šè§’ --&gt;
    &lt;div class="toolbar"&gt;
      &lt;button class="btn btn-outline"
              @mousedown="onPressStart('in')" @mouseup="onPressEnd" @mouseleave="onPressEnd"
              @touchstart.prevent="onPressStart('in')" @touchend="onPressEnd"&gt;
        ï¼‹ æ”¾å¤§
      &lt;/button&gt;
      &lt;button class="btn btn-outline"
              @mousedown="onPressStart('out')" @mouseup="onPressEnd" @mouseleave="onPressEnd"
              @touchstart.prevent="onPressStart('out')" @touchend="onPressEnd"&gt;
        ï¼ ç¼©å°
      &lt;/button&gt;
      &lt;button class="btn btn-secondary" @click="resetZoom"&gt;
        âŸ³ è¿˜åŸ
      &lt;/button&gt;
      &lt;span class="hint"&gt;æŒ‰ä½ Ctrl + å·¦é”®å¯æ‹–åŠ¨ç”»å¸ƒï¼ˆä»…æ”¾å¤§åå¯ç”¨ï¼‰&lt;/span&gt;
    &lt;/div&gt;

    &lt;!-- ç”»å¸ƒå®¹å™¨ï¼ˆKonvaï¼‰ --&gt;
    &lt;div class="stage-wrapper" :style="{ width: `${canvasSize.width}px`, height: `${canvasSize.height}px` }"&gt;
      &lt;VStage
        ref="stageRef"
        :config="{ width: canvasSize.width, height: canvasSize.height }"
        @wheel="onWheel"
        @mousedown="onStageMouseDown"
        @mousemove="onStageMouseMove"
        @mouseup="onStageMouseUp"
        @mouseleave="onStageMouseUp"
      &gt;
        &lt;VLayer&gt;
          &lt;!-- ç¤ºä¾‹çŸ©å½¢ï¼šCtrl æ—¶ç¦ç”¨äº¤äº’ --&gt;
          &lt;VRect :config="{ ...rectConfig, draggable: !isCtrlPressing, listening: !isCtrlPressing }" /&gt;
          &lt;!-- ç¤ºä¾‹æ–‡å­—ï¼ˆä¸æ‹–åŠ¨ï¼Œä»…å±•ç¤ºï¼‰ --&gt;
          &lt;VText :config="textConfig" /&gt;
        &lt;/VLayer&gt;
      &lt;/VStage&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.konva-demo-container {
  position: relative;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(90deg, #f0f0f0 1px, transparent 1px), linear-gradient(#f0f0f0 1px, transparent 1px);
  background-size: 20px 20px;
}

.toolbar {
  position: absolute;
  top: 16px;
  left: 16px;
  display: flex;
  gap: 8px;
  align-items: center;
  z-index: 10;
}

.btn {
  height: 32px;
  padding: 0 12px;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
  user-select: none;
}
.btn-outline {
  border: 1px solid #cbd5e1;
  background: #ffffff;
}
.btn-outline:hover {
  background: #f8fafc;
}
.btn-secondary {
  color: #0f172a;
  background: #e2e8f0;
  border: 1px solid #cbd5e1;
}
.hint {
  font-size: 12px;
  color: #64748b;
  margin-left: 8px;
}

.stage-wrapper {
  margin-top: 64px;
  border-radius: 8px;
  box-shadow: 0 4px 24px rgba(2, 6, 23, 0.08);
  background: #fff;
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-6">å¸¸è§é—®é¢˜ä¸ä¼˜åŒ–å»ºè®®</h3>
<ul>
<li>ä¸ºä»€ä¹ˆç¼©å°æ—¶ä¼šâ€œè·‘å·¦ä¸Šè§’â€ï¼Ÿ
<ul>
<li>æœªåšâ€œç¼©æ”¾ â‰¤ 1 çš„å±…ä¸­çº¦æŸâ€ä¼šå¯¼è‡´ä½ç½®å½’é›¶ï¼ˆå·¦ä¸Šè§’ï¼‰ã€‚æœ¬æ–‡ç¤ºä¾‹é€šè¿‡ <code>clampStagePosition</code> åœ¨ç¼©å°æ—¶å±…ä¸­ã€‚</li>
</ul>
</li>
<li>ä¸ºä»€ä¹ˆæ”¾å¤§åæ‹–åŠ¨ä¼šè¢«é™åˆ¶ï¼Ÿ
<ul>
<li>ä¸ºé¿å…å‡ºç°ç©ºç™½åŒºåŸŸï¼Œæ‹–åŠ¨èŒƒå›´ä¼šè¢«é™åˆ¶åœ¨å†…å®¹å¯è§†èŒƒå›´å†…ã€‚</li>
</ul>
</li>
<li>å¦‚ä½•è®©æŒ‰é’®ä¹ŸæŒ‰â€œæŒ‡é’ˆä½ç½®â€ç¼©æ”¾ï¼Ÿ
<ul>
<li>å°† <code>zoomIn/zoomOut</code> çš„ç¬¬äºŒä¸ªå‚æ•°æ¢æˆ <code>stage.getPointerPosition()</code> å³å¯ï¼Œä½†ä¹ æƒ¯ä¸ŠæŒ‰é’®ç”¨ç”»å¸ƒä¸­å¿ƒæ›´ç¨³å®šã€‚</li>
</ul>
</li>
<li>å…‰æ ‡åé¦ˆï¼ˆå¢å¼ºï¼‰ï¼š
<ul>
<li>å¯åœ¨ <code>Ctrl</code> æŒ‰ä¸‹æ—¶ç”¨ <code>cursor: grab</code>ï¼Œå¹³ç§»è¿‡ç¨‹ä¸­ç”¨ <code>cursor: grabbing</code> å¢å¼ºæ‰‹æ„Ÿã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">å‚è€ƒæ–‡æ¡£</h3>
<ul>
<li>Konva å®˜æ–¹ï¼ˆVueï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkonvajs.org%2Fdocs%2Fvue%2Findex.html" target="_blank" title="https://konvajs.org/docs/vue/index.html" ref="nofollow noopener noreferrer">konvajs.org/docs/vue/inâ€¦</a></li>
<li>æŒ‡é’ˆç›¸å¯¹ç¼©æ”¾ï¼ˆå®˜æ–¹ç¤ºä¾‹ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkonvajs.org%2Fdocs%2Fsandbox%2FZooming_Relative_To_Pointer.html" target="_blank" title="https://konvajs.org/docs/sandbox/Zooming_Relative_To_Pointer.html" ref="nofollow noopener noreferrer">konvajs.org/docs/sandboâ€¦</a></li>
<li>vue-konva READMEï¼ˆå‰ç¼€ / è·å– Stage å¼•ç”¨ï¼‰ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkonvajs%2Fvue-konva%2Fblob%2Fmaster%2FREADME.md" target="_blank" title="https://github.com/konvajs/vue-konva/blob/master/README.md" ref="nofollow noopener noreferrer">github.com/konvajs/vueâ€¦</a></li>
<li>StackOverflowï¼šé€šè¿‡ <code>ref</code> è·å– Stageï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F58411623%2Fkonvajs-vuejs-how-to-access-stage-width-in-vue" target="_blank" title="https://stackoverflow.com/questions/58411623/konvajs-vuejs-how-to-access-stage-width-in-vue" ref="nofollow noopener noreferrer">stackoverflow.com/questions/5â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575413146922352655</link>    <guid>https://juejin.cn/post/7575413146922352655</guid>    <pubDate>2025-11-24T01:38:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922352655" data-draft-id="7576077034741579810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-11-24T01:38:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3109843365802925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3109843365802925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:38:26.000Z" title="Mon Nov 24 2025 01:38:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸš€ <strong>é¦–å‘å®æˆ˜ï¼Spring AI + Qwen3 é˜¿é‡Œå¤§æ¨¡å‹æ¥å…¥ TARE é¡¹ç›® + TRAE SOLO å…¨æµç¨‹æŒ‡å—</strong></h2>
<blockquote>
<p>ğŸ§‘â€ğŸ’» ä½œè€…ï¼š# å¤©å¤©æ‘¸é±¼çš„javaå·¥ç¨‹å¸ˆ<br/>
ğŸ† é¡¹ç›®æŠ•ç¨¿ï¼šTRAE SOLO æŠ€æœ¯å¤§å¥–èµ›<br/>
ğŸ“Œ å…³é”®è¯ï¼šSpring AIã€Qwen3ã€å¤§æ¨¡å‹ã€TRAEã€TAREã€å…¬ä¼—å·æ¥å…¥ã€å…¨æ ˆå®è·µ</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ğŸ§  èƒŒæ™¯ï¼šå¤§æ¨¡å‹å¾ˆç«ï¼Œä½†æ¥å…¥ä¸šåŠ¡æ‰æ˜¯å…³é”®</h3>
<p>ä½œä¸ºä¸€åå†™äº† 8 å¹´ Java çš„å¼€å‘è€…ï¼Œæˆ‘å¯¹â€œæ–°æŠ€æœ¯â€ä¸€ç›´ä¿æŒè°¨æ…ä¹è§‚çš„æ€åº¦ã€‚å¤§æ¨¡å‹ç«äº†è¿™ä¹ˆä¹…ï¼Œä»æœ€å¼€å§‹å†™ç©å…·èŠå¤©åˆ°ç°åœ¨è½åœ°ä¸šåŠ¡ï¼Œ<strong>çœŸæ­£èƒ½è·‘åœ¨ç”Ÿäº§ç¯å¢ƒé‡Œçš„é¡¹ç›®ï¼Œè¿˜ä¸å¤šã€‚</strong></p>
<p>è¿™æ¬¡æˆ‘é€‰æ‹©ä»æˆ‘ä»¬å†…éƒ¨çš„ <strong>TARE é¡¹ç›®</strong> ä¸‹æ‰‹ï¼Œå°è¯•æŠŠ <strong>é˜¿é‡Œ Qwen3 å¤§æ¨¡å‹</strong> é€šè¿‡ <strong>Spring AI</strong> æ¥å…¥ç³»ç»Ÿï¼ŒåŒæ—¶é€šè¿‡ <strong>TRAE SOLO</strong> æ„å»ºä¸šåŠ¡æµç¨‹ UIï¼Œæœ€ç»ˆåšåˆ°ï¼š</p>
<blockquote>
<p><strong>ä»æ¨¡å‹æ¥å…¥ â¡ï¸ ä¸šåŠ¡é›†æˆ â¡ï¸ å…¬ä¼—å·å¯¹æ¥ï¼Œä¸€å¥—å®Œæ•´é—­ç¯æµç¨‹ã€‚</strong></p>
</blockquote>
<p>å¹¶å°†å…¶ä½œä¸ºå‚èµ›é¡¹ç›®ï¼Œæäº¤ç»™ <strong>TRAE SOLO æŠ€æœ¯å¤§å¥–èµ›</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2">ğŸ“¦ é¡¹ç›®ç›®æ ‡ï¼šä¸‰æ­¥èµ°</h3>
<h4 data-id="heading-3">âœ… Step 1ï¼šä½¿ç”¨ Spring AI æ¥å…¥é˜¿é‡Œ Qwen3 æ¨¡å‹</h4>
<h4 data-id="heading-4">âœ… Step 2ï¼šå°†æ¨¡å‹èƒ½åŠ›é›†æˆåˆ° TARE é¡¹ç›®ä¸­ï¼ˆè§„åˆ™ç”Ÿæˆã€ä»»åŠ¡å»ºè®®ï¼‰</h4>
<h4 data-id="heading-5">âœ… Step 3ï¼šé€šè¿‡ TRAE SOLO æ„å»ºå‰ç«¯é¡µé¢ï¼Œæ‰“é€šå…¬ä¼—å·æ¥å£ï¼Œå®ç°é—®ç­”æœåŠ¡</h4>
<hr/>
<h3 data-id="heading-6">ğŸ§° æŠ€æœ¯æ ˆé€‰å‹</h3>





























<table><thead><tr><th>æ¨¡å—</th><th>æŠ€æœ¯æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å¤§æ¨¡å‹æ¥å…¥</td><td>Spring AI + Qwen3 (é˜¿é‡Œé€šä¹‰åƒé—®)</td></tr><tr><td>åç«¯æ¡†æ¶</td><td>Spring Boot 3 + WebFlux</td></tr><tr><td>é¡µé¢ç¼–æ’</td><td>TRAE SOLOï¼ˆä½ä»£ç æ‹–æ‹½ UI + æ¥å£ç»‘å®šï¼‰</td></tr><tr><td>æ¶ˆæ¯å¹³å°</td><td>å¾®ä¿¡å…¬ä¼—å· + è‡ªå»ºæœåŠ¡è·¯ç”±</td></tr><tr><td>é¡¹ç›®æ¨¡å—</td><td>TAREï¼ˆæµç¨‹è‡ªåŠ¨åŒ–è§„åˆ™ç³»ç»Ÿï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-7">ğŸ›  å®æˆ˜ç»†èŠ‚æ‹†è§£</h3>
<hr/>
<h4 data-id="heading-8">âœ… ä¸€ã€Spring AI + Qwen3 æ¨¡å‹æ¥å…¥é…ç½®</h4>
<p>Spring AI ä½œä¸º Spring å®˜æ–¹æ¨å‡ºçš„å¤§æ¨¡å‹é›†æˆæ¡†æ¶ï¼Œæ¥å…¥é˜¿é‡Œ Qwen3 éå¸¸é¡ºæ»‘ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">ai:</span>
    <span class="hljs-attr">openai:</span>
      <span class="hljs-attr">base-url:</span> <span class="hljs-string">https://dashscope.aliyuncs.com/compatible-mode/v1</span>
      <span class="hljs-attr">api-key:</span> <span class="hljs-string">${ALI_API_KEY}</span>
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">OpenAiChatClient</span> <span class="hljs-title function_">chatClient</span>(<span class="hljs-params">OpenAiApi openAiApi</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAiChatClient</span>(openAiApi);
}
</code></pre>
<p><strong>æ¥å£å°è£…ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">public String <span class="hljs-built_in">askQwen</span>(String question) {
    ChatRequest request = ChatRequest<span class="hljs-selector-class">.builder</span>()
        <span class="hljs-selector-class">.model</span>("qwen-plus")
        <span class="hljs-selector-class">.messages</span>(List.of(ChatMessage.userMessage(question)))
        <span class="hljs-selector-class">.build</span>();

    ChatResponse response = chatClient<span class="hljs-selector-class">.call</span>(request);
    return response<span class="hljs-selector-class">.getResult</span>()<span class="hljs-selector-class">.getOutput</span>()<span class="hljs-selector-class">.getChoices</span>()<span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>)<span class="hljs-selector-class">.getMessage</span>()<span class="hljs-selector-class">.getContent</span>();
}
</code></pre>
<hr/>
<h4 data-id="heading-9">âœ… äºŒã€TARE é¡¹ç›®ä¸­å¼•å…¥æ¨¡å‹èƒ½åŠ›</h4>
<p>TARE æœ¬èº«æ˜¯ä¸€ä¸ªè§„åˆ™é©±åŠ¨çš„ä¸šåŠ¡å¼•æ“ï¼Œä¹‹å‰è§„åˆ™é…ç½®ä¸»è¦é äººå·¥è®¾ç½®ã€‚</p>
<p>è¿™æ¬¡æˆ‘æ–°å¢äº†ä¸€ä¸ªæ¨¡å—ï¼š <strong>â€œAI æ™ºèƒ½æ¨èè§„åˆ™â€</strong></p>
<h5 data-id="heading-10">ğŸ‘‡ ä½¿ç”¨æ–¹å¼ï¼š</h5>
<ol>
<li>ç”¨æˆ·åœ¨ TRAE é¡µé¢ä¸Šé€‰æ‹©â€œç”Ÿæˆè§„åˆ™å»ºè®®â€</li>
<li>è¾“å…¥ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚â€œå®¢æˆ·æŠ•è¯‰è‡ªåŠ¨åˆ†é…â€ï¼‰</li>
<li>åç«¯å°†åœºæ™¯æè¿°ä¼ ç»™ Qwen3</li>
<li>æ¨¡å‹è¿”å›è§„åˆ™è‰æ¡ˆï¼ˆJSON æ ¼å¼ï¼‰</li>
<li>ç”¨æˆ·å¯ä¸€é”®å¯¼å…¥è‡³ç°æœ‰æµç¨‹ä¸­</li>
</ol>
<h5 data-id="heading-11">ç¤ºä¾‹å¯¹è¯ï¼š</h5>
<blockquote>
<p>ç”¨æˆ·è¾“å…¥ï¼š<br/>
â€œæˆ‘æƒ³è‡ªåŠ¨å°† VIP æŠ•è¯‰åˆ†é…ç»™ä¸€çº¿å®¢æœï¼Œæ™®é€šå®¢æˆ·åˆ™è¿›å…¥æ™®é€šé˜Ÿåˆ—ã€‚â€</p>
</blockquote>
<blockquote>
<p>æ¨¡å‹è¿”å›ï¼š</p>
</blockquote>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"è§„åˆ™æ¡ä»¶"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”¨æˆ·ç­‰çº§ == VIP"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"æ‰§è¡ŒåŠ¨ä½œ"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»»åŠ¡åˆ†é…è‡³é«˜çº§å®¢æœç»„"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"å¦åˆ™"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä»»åŠ¡è¿›å…¥æ™®é€šå®¡æ ¸æµç¨‹"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ğŸ‘‰ ç”¨æˆ·ç‚¹å‡»â€œå¯¼å…¥â€åï¼Œè§„åˆ™è‡ªåŠ¨å†™å…¥ TARE æµç¨‹å¼•æ“ï¼Œå¹¶é€šè¿‡ TRAE é¡µé¢å®æ—¶ç”Ÿæ•ˆã€‚</strong></p>
<hr/>
<h4 data-id="heading-12">âœ… ä¸‰ã€TRAE SOLO é¡µé¢æ­å»ºä¸äº¤äº’ç»†èŠ‚</h4>
<h5 data-id="heading-13">é¡µé¢ç»“æ„ï¼š</h5>





















<table><thead><tr><th>åŒºåŸŸ</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>å·¦ä¾§å¯¼èˆª</td><td>è§„åˆ™ç®¡ç† / AIæ¨è / å†å²è®°å½•</td></tr><tr><td>ä¸­é—´ä¸»åŒº</td><td>è¡¨å•è¾“å…¥ + æ¨¡å‹è¿”å›å†…å®¹</td></tr><tr><td>å³ä¾§</td><td>JSON è§„åˆ™é¢„è§ˆ + ä¸€é”®å¯¼å…¥æŒ‰é’®</td></tr></tbody></table>
<h5 data-id="heading-14">æ ¸å¿ƒäº¤äº’ç»†èŠ‚ï¼š</h5>
<ul>
<li>ä½¿ç”¨ <strong>è¡¨å•ç»„ä»¶</strong> æ”¶é›†ç”¨æˆ·è¾“å…¥</li>
<li><strong>æŒ‰é’®äº‹ä»¶ç»‘å®š</strong> åç«¯æ¥å£ <code>/api/ai-suggest</code></li>
<li>æ¥æ”¶æ¨¡å‹è¿”å›å <strong>è‡ªåŠ¨å¡«å…¥å³ä¾§ JSON åŒºå—</strong></li>
<li>â€œå¯¼å…¥è§„åˆ™â€æŒ‰é’®è§¦å‘äº‹ä»¶ -&gt; è°ƒç”¨ <code>/api/rules/import</code></li>
</ul>
<h5 data-id="heading-15">TRAE é…ç½®äº®ç‚¹ï¼š</h5>
<ul>
<li>æ‰€æœ‰äº¤äº’æ— é¡»å†™å‰ç«¯ä»£ç ï¼Œä»…é€šè¿‡ <strong>äº‹ä»¶é…ç½® + æ•°æ®æºç»‘å®š</strong> å®Œæˆ</li>
<li>è§„åˆ™é¢„è§ˆåŒºä½¿ç”¨ <strong>ä»£ç é«˜äº®ç»„ä»¶</strong>ï¼Œæå‡å¯è¯»æ€§</li>
<li>å¯¼å…¥æˆåŠŸåè‡ªåŠ¨é€šçŸ¥ç”¨æˆ·å¹¶åˆ·æ–°æµç¨‹å›¾</li>
</ul>
<hr/>
<h4 data-id="heading-16">âœ… å››ã€å…¬ä¼—å·æ¥å…¥ï¼šæ¨¡å‹èƒ½åŠ›å¯¹å¤–å¼€æ”¾</h4>
<p>æˆ‘ä»¬è¿˜å°†æ¨¡å‹èƒ½åŠ›é€šè¿‡æ¥å£æš´éœ²ç»™å¾®ä¿¡å…¬ä¼—å·ï¼Œå®ç°ä¼ä¸šçº§å¯¹è¯å¼æœåŠ¡ã€‚</p>
<h5 data-id="heading-17">æ¥å…¥æ–¹æ¡ˆï¼š</h5>
<ul>
<li>ä½¿ç”¨å¾®ä¿¡å…¬ä¼—å·å¼€å‘è€…å¹³å°é…ç½®æ¶ˆæ¯è½¬å‘åœ°å€</li>
<li>åç«¯æ¥æ”¶ç”¨æˆ·æ–‡æœ¬æ¶ˆæ¯ï¼Œè½¬å‘è‡³ AI æ¥å£</li>
<li>è¿”å›æ¨¡å‹å›ç­”åå›å¤æ–‡æœ¬æ¶ˆæ¯</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/wx/msg"</span>)
public String <span class="hljs-built_in">handleMessage</span>(<span class="hljs-variable">@RequestBody</span> WxMessage message) {
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">reply</span> = <span class="hljs-selector-tag">askQwen</span>(message.<span class="hljs-built_in">getContent</span>());
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildWxTextResponse</span>(message, reply);
}
</code></pre>
<p><strong>å®é™…ç”¨ä¾‹ï¼š</strong><br/>
ç”¨æˆ·å‘é€â€œè¯·å¸®æˆ‘å†™ä¸€ä¸ªå®¢æˆ·æŠ•è¯‰åˆ†é…è§„åˆ™â€ï¼Œå…¬ä¼—å·è‡ªåŠ¨è¿”å› JSON æ ¼å¼å»ºè®®ï¼Œä¾›è¿è¥å‚è€ƒã€‚</p>
<hr/>
<h3 data-id="heading-18">ğŸ” æ€»ç»“ï¼šè¿™æ¬¡é›†æˆå¸¦ç»™æˆ‘çš„ä¸‰ç‚¹æ”¶è·</h3>
<h4 data-id="heading-19">1. <strong>æ¨¡å‹èƒ½åŠ›ä¸å†æ˜¯â€œç©å…·â€ï¼Œå¼€å§‹æˆä¸ºä¸šåŠ¡åŠ é€Ÿå™¨</strong></h4>
<p>å®ƒå¯ä»¥çœŸæ­£ä¸ºæˆ‘ä»¬èŠ‚çœé…ç½®æ—¶é—´ã€æä¾›å¯å‚è€ƒçš„ä¸šåŠ¡å»ºè®®ã€‚</p>
<h4 data-id="heading-20">2. <strong>TRAE SOLO è®©æˆ‘æŠŠåç«¯çš„èƒ½åŠ›å»¶ä¼¸åˆ°äº† UI å±‚</strong></h4>
<p>æˆ‘èƒ½æ§åˆ¶é¡µé¢ã€é…ç½®æµç¨‹ã€è°ƒç”¨æ¥å£ï¼Œ<strong>ä¸å†ä¾èµ–å‰ç«¯ï¼Œä¹Ÿä¸æ‹…å¿ƒäº¤äº’è½åœ°ä¸äº†ã€‚</strong></p>
<h4 data-id="heading-21">3. <strong>TARE é¡¹ç›®å› ä¸º AI + TRAE çš„ç»„åˆï¼Œç„•å‘äº†ç¬¬äºŒæ˜¥</strong></h4>
<p>åŸæœ¬åªèƒ½å†…éƒ¨ä½¿ç”¨çš„è§„åˆ™é…ç½®ç³»ç»Ÿï¼Œç°åœ¨å…·å¤‡äº†å¯¹å¤–æœåŠ¡çš„èƒ½åŠ›ã€‚</p>
<hr/>
<h3 data-id="heading-22">ğŸ“¢ å†™åœ¨æœ€åï¼šå…¨æ ˆä¸æ˜¯â€œå…¨éƒ½ä¼šâ€ï¼Œè€Œæ˜¯â€œå…¨èƒ½äº¤ä»˜â€</h3>
<p>æˆ‘ä»ç„¶æ˜¯ä¸€å Java å·¥ç¨‹å¸ˆï¼Œä½†ç°åœ¨æˆ‘èƒ½ï¼š</p>
<ul>
<li>æ¥å…¥å¤§æ¨¡å‹</li>
<li>æ­å»ºå‰ç«¯é¡µé¢</li>
<li>æ„å»ºä¸šåŠ¡æµç¨‹</li>
<li>å¯¹æ¥å…¬ä¼—å·æœåŠ¡</li>
</ul>
<p>è¿™ä¸æ˜¯å› ä¸ºæˆ‘å˜æˆäº†å…¨æ ˆï¼Œè€Œæ˜¯å› ä¸ºæˆ‘æœ‰äº†å¥½å·¥å…·ï¼Œæ¯”å¦‚ Spring AI å’Œ TRAE SOLOã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guava å¸¸ç”¨å·¥å…·åŒ…å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575112613779046434</link>    <guid>https://juejin.cn/post/7575112613779046434</guid>    <pubDate>2025-11-24T01:39:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575112613779046434" data-draft-id="7575533124877582363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Guava å¸¸ç”¨å·¥å…·åŒ…å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-11-24T01:39:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sinoçˆ±å­¦ä¹ "/> <meta itemprop="url" content="https://juejin.cn/user/1873223544473431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Guava å¸¸ç”¨å·¥å…·åŒ…å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223544473431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sinoçˆ±å­¦ä¹ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:39:50.000Z" title="Mon Nov 24 2025 01:39:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/593643ad991e40af9dd060ca64ebf2cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2lub-eIseWtpuS5oA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764554040&amp;x-signature=aVm6ZvOQJVBAWs5YibLQAg0QOYk%3D" alt="1763948312527.png" loading="lazy"/></p>
<p>Guava æ˜¯ Google å¼€æºçš„ Java æ ¸å¿ƒåº“ï¼Œæä¾›äº†ä¸°å¯Œçš„å·¥å…·ç±»å’Œé›†åˆæ¡†æ¶ï¼Œèƒ½å¤Ÿæå¤§æå‡å¼€å‘æ•ˆç‡ã€‚æœ¬æ–‡å°†ä»‹ç» Guava ä¸­æœ€å¸¸ç”¨çš„å·¥å…·åŒ…åŠå…¶å®é™…åº”ç”¨ã€‚</p>
<h2 data-id="heading-1">1. é›†åˆå·¥å…· (Collections)</h2>
<h3 data-id="heading-2">1.1 ä¸å¯å˜é›†åˆ</h3>
<p>ä¸å¯å˜é›†åˆçº¿ç¨‹å®‰å…¨ä¸”ä¸å¯ä¿®æ”¹ï¼Œé€‚åˆä½œä¸ºå¸¸é‡ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºä¸å¯å˜ List</span>
ImmutableList&lt;String&gt; list = ImmutableList.of(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

<span class="hljs-comment">// åˆ›å»ºä¸å¯å˜ Set</span>
ImmutableSet&lt;Integer&gt; set = ImmutableSet.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);

<span class="hljs-comment">// åˆ›å»ºä¸å¯å˜ Map</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.of(
    <span class="hljs-string">"Java"</span>, <span class="hljs-number">1</span>,
    <span class="hljs-string">"Python"</span>, <span class="hljs-number">2</span>,
    <span class="hljs-string">"Go"</span>, <span class="hljs-number">3</span>
);

<span class="hljs-comment">// ä½¿ç”¨ Builder æ„å»ºå¤æ‚é›†åˆ</span>
ImmutableList&lt;String&gt; complexList = ImmutableList.&lt;String&gt;builder()
    .add(<span class="hljs-string">"A"</span>)
    .add(<span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>)
    .addAll(Arrays.asList(<span class="hljs-string">"D"</span>, <span class="hljs-string">"E"</span>))
    .build();
</code></pre>
<h3 data-id="heading-3">1.2 Multiset - è®¡æ•°é›†åˆ</h3>
<p>Multiset å…è®¸å…ƒç´ é‡å¤ï¼Œå¹¶å¯ä»¥ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°ã€‚</p>
<pre><code class="hljs language-java" lang="java">Multiset&lt;String&gt; multiset = HashMultiset.create();
multiset.add(<span class="hljs-string">"apple"</span>);
multiset.add(<span class="hljs-string">"apple"</span>);
multiset.add(<span class="hljs-string">"banana"</span>);
multiset.add(<span class="hljs-string">"apple"</span>);

System.out.println(multiset.count(<span class="hljs-string">"apple"</span>));  <span class="hljs-comment">// è¾“å‡º: 3</span>
System.out.println(multiset.size());          <span class="hljs-comment">// è¾“å‡º: 4</span>

<span class="hljs-comment">// éå†ä¸é‡å¤å…ƒç´ </span>
<span class="hljs-keyword">for</span> (String element : multiset.elementSet()) {
    System.out.println(element + <span class="hljs-string">": "</span> + multiset.count(element));
}
</code></pre>
<h3 data-id="heading-4">1.3 Multimap - ä¸€é”®å¤šå€¼æ˜ å°„</h3>
<p>Multimap å…è®¸ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ã€‚</p>
<pre><code class="hljs language-java" lang="java">Multimap&lt;String, String&gt; multimap = ArrayListMultimap.create();
multimap.put(<span class="hljs-string">"Fruit"</span>, <span class="hljs-string">"Apple"</span>);
multimap.put(<span class="hljs-string">"Fruit"</span>, <span class="hljs-string">"Banana"</span>);
multimap.put(<span class="hljs-string">"Vegetable"</span>, <span class="hljs-string">"Carrot"</span>);

System.out.println(multimap.get(<span class="hljs-string">"Fruit"</span>));  <span class="hljs-comment">// è¾“å‡º: [Apple, Banana]</span>

<span class="hljs-comment">// è½¬æ¢ä¸ºæ™®é€š Map</span>
Map&lt;String, Collection&lt;String&gt;&gt; map = multimap.asMap();
</code></pre>
<h3 data-id="heading-5">1.4 BiMap - åŒå‘æ˜ å°„</h3>
<p>BiMap æä¾›é”®å€¼äº’æŸ¥çš„åŒå‘æ˜ å°„ã€‚</p>
<pre><code class="hljs language-java" lang="java">BiMap&lt;String, Integer&gt; biMap = HashBiMap.create();
biMap.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">1</span>);
biMap.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">2</span>);

<span class="hljs-comment">// æ­£å‘æŸ¥è¯¢</span>
System.out.println(biMap.get(<span class="hljs-string">"Alice"</span>));  <span class="hljs-comment">// è¾“å‡º: 1</span>

<span class="hljs-comment">// åå‘æŸ¥è¯¢</span>
System.out.println(biMap.inverse().get(<span class="hljs-number">1</span>));  <span class="hljs-comment">// è¾“å‡º: Alice</span>
</code></pre>
<h3 data-id="heading-6">1.5 Table - åŒé”®æ˜ å°„</h3>
<p>Table æä¾›è¡Œåˆ—å¼çš„åŒé”®æ˜ å°„ç»“æ„ã€‚</p>
<pre><code class="hljs language-java" lang="java">Table&lt;String, String, Integer&gt; table = HashBasedTable.create();
table.put(<span class="hljs-string">"2023"</span>, <span class="hljs-string">"Q1"</span>, <span class="hljs-number">100</span>);
table.put(<span class="hljs-string">"2023"</span>, <span class="hljs-string">"Q2"</span>, <span class="hljs-number">150</span>);
table.put(<span class="hljs-string">"2024"</span>, <span class="hljs-string">"Q1"</span>, <span class="hljs-number">120</span>);

<span class="hljs-comment">// è·å–å€¼</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> table.get(<span class="hljs-string">"2023"</span>, <span class="hljs-string">"Q1"</span>);  <span class="hljs-comment">// 100</span>

<span class="hljs-comment">// è·å–æŸä¸€è¡Œçš„æ‰€æœ‰æ•°æ®</span>
Map&lt;String, Integer&gt; row = table.row(<span class="hljs-string">"2023"</span>);  <span class="hljs-comment">// {Q1=100, Q2=150}</span>

<span class="hljs-comment">// è·å–æŸä¸€åˆ—çš„æ‰€æœ‰æ•°æ®</span>
Map&lt;String, Integer&gt; column = table.column(<span class="hljs-string">"Q1"</span>);  <span class="hljs-comment">// {2023=100, 2024=120}</span>
</code></pre>
<h2 data-id="heading-7">2. å­—ç¬¦ä¸²å·¥å…· (Strings)</h2>
<h3 data-id="heading-8">2.1 Joiner - è¿æ¥å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŸºæœ¬è¿æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>).join(Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>));
<span class="hljs-comment">// è¾“å‡º: A, B, C</span>

<span class="hljs-comment">// è·³è¿‡ null å€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">withoutNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .skipNulls()
    .join(<span class="hljs-string">"A"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
<span class="hljs-comment">// è¾“å‡º: A, B, C</span>

<span class="hljs-comment">// æ›¿æ¢ null å€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">replaceNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .useForNull(<span class="hljs-string">"N/A"</span>)
    .join(<span class="hljs-string">"A"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"B"</span>);
<span class="hljs-comment">// è¾“å‡º: A, N/A, B</span>

<span class="hljs-comment">// Map è¿æ¥</span>
Map&lt;String, String&gt; map = ImmutableMap.of(<span class="hljs-string">"name"</span>, <span class="hljs-string">"John"</span>, <span class="hljs-string">"age"</span>, <span class="hljs-string">"30"</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">mapStr</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">"&amp;"</span>).withKeyValueSeparator(<span class="hljs-string">"="</span>).join(map);
<span class="hljs-comment">// è¾“å‡º: name=John&amp;age=30</span>
</code></pre>
<h3 data-id="heading-9">2.2 Splitter - åˆ†å‰²å™¨</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŸºæœ¬åˆ†å‰²</span>
Iterable&lt;String&gt; parts = Splitter.on(<span class="hljs-string">','</span>).split(<span class="hljs-string">"A,B,C"</span>);

<span class="hljs-comment">// å»é™¤ç©ºç™½å­—ç¬¦</span>
Iterable&lt;String&gt; trimmed = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()
    .split(<span class="hljs-string">" A , B , C "</span>);

<span class="hljs-comment">// å¿½ç•¥ç©ºå­—ç¬¦ä¸²</span>
Iterable&lt;String&gt; noEmpty = Splitter.on(<span class="hljs-string">','</span>)
    .omitEmptyStrings()
    .split(<span class="hljs-string">"A,,B,C"</span>);

<span class="hljs-comment">// é™åˆ¶åˆ†å‰²æ•°é‡</span>
Iterable&lt;String&gt; limited = Splitter.on(<span class="hljs-string">','</span>)
    .limit(<span class="hljs-number">2</span>)
    .split(<span class="hljs-string">"A,B,C,D"</span>);
<span class="hljs-comment">// ç»“æœ: [A, B,C,D]</span>

<span class="hljs-comment">// åˆ†å‰² Map</span>
Map&lt;String, String&gt; kvMap = Splitter.on(<span class="hljs-string">'&amp;'</span>)
    .withKeyValueSeparator(<span class="hljs-string">'='</span>)
    .split(<span class="hljs-string">"name=John&amp;age=30"</span>);
</code></pre>
<h3 data-id="heading-10">2.3 Strings å·¥å…·ç±»</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// null è½¬ç©ºå­—ç¬¦ä¸²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> Strings.nullToEmpty(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// ""</span>

<span class="hljs-comment">// ç©ºå­—ç¬¦ä¸²è½¬ null</span>
<span class="hljs-type">String</span> <span class="hljs-variable">nullStr</span> <span class="hljs-operator">=</span> Strings.emptyToNull(<span class="hljs-string">""</span>);  <span class="hljs-comment">// null</span>

<span class="hljs-comment">// å­—ç¬¦ä¸²å¡«å……</span>
<span class="hljs-type">String</span> <span class="hljs-variable">padded</span> <span class="hljs-operator">=</span> Strings.padStart(<span class="hljs-string">"7"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'0'</span>);  <span class="hljs-comment">// "007"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">paddedEnd</span> <span class="hljs-operator">=</span> Strings.padEnd(<span class="hljs-string">"7"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'0'</span>); <span class="hljs-comment">// "700"</span>

<span class="hljs-comment">// é‡å¤å­—ç¬¦ä¸²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">repeated</span> <span class="hljs-operator">=</span> Strings.repeat(<span class="hljs-string">"ab"</span>, <span class="hljs-number">3</span>);  <span class="hljs-comment">// "ababab"</span>

<span class="hljs-comment">// å…¬å…±å‰ç¼€</span>
<span class="hljs-type">String</span> <span class="hljs-variable">prefix</span> <span class="hljs-operator">=</span> Strings.commonPrefix(<span class="hljs-string">"testing"</span>, <span class="hljs-string">"test"</span>);  <span class="hljs-comment">// "test"</span>

<span class="hljs-comment">// å…¬å…±åç¼€</span>
<span class="hljs-type">String</span> <span class="hljs-variable">suffix</span> <span class="hljs-operator">=</span> Strings.commonSuffix(<span class="hljs-string">"testing"</span>, <span class="hljs-string">"interesting"</span>);  <span class="hljs-comment">// "ting"</span>
</code></pre>
<h2 data-id="heading-11">3. ç¼“å­˜å·¥å…· (Cache)</h2>
<p>Guava Cache æä¾›æœ¬åœ°ç¼“å­˜åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¿‡æœŸç­–ç•¥ã€‚</p>
<pre><code class="hljs language-java" lang="java">LoadingCache&lt;String, String&gt; cache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">1000</span>)                          <span class="hljs-comment">// æœ€å¤§å®¹é‡</span>
    .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.MINUTES)    <span class="hljs-comment">// å†™å…¥åè¿‡æœŸ</span>
    .expireAfterAccess(<span class="hljs-number">5</span>, TimeUnit.MINUTES)    <span class="hljs-comment">// è®¿é—®åè¿‡æœŸ</span>
    .recordStats()                              <span class="hljs-comment">// å¯ç”¨ç»Ÿè®¡</span>
    .build(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, String&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(String key)</span> <span class="hljs-keyword">throws</span> Exception {
            <span class="hljs-keyword">return</span> loadFromDatabase(key);  <span class="hljs-comment">// ç¼“å­˜åŠ è½½é€»è¾‘</span>
        }
    });

<span class="hljs-comment">// ä½¿ç”¨ç¼“å­˜</span>
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> cache.get(<span class="hljs-string">"key"</span>);
} <span class="hljs-keyword">catch</span> (ExecutionException e) {
    e.printStackTrace();
}

<span class="hljs-comment">// æ‰‹åŠ¨æ”¾å…¥</span>
cache.put(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);

<span class="hljs-comment">// å¤±æ•ˆç¼“å­˜</span>
cache.invalidate(<span class="hljs-string">"key"</span>);

<span class="hljs-comment">// æŸ¥çœ‹ç»Ÿè®¡</span>
<span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> cache.stats();
System.out.println(<span class="hljs-string">"å‘½ä¸­ç‡: "</span> + stats.hitRate());
</code></pre>
<h2 data-id="heading-12">4. é›†åˆå·¥å…·ç±» (Lists, Sets, Maps)</h2>
<h3 data-id="heading-13">4.1 Lists å·¥å…·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º ArrayList</span>
List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

<span class="hljs-comment">// æŒ‡å®šå®¹é‡</span>
List&lt;String&gt; capacityList = Lists.newArrayListWithCapacity(<span class="hljs-number">100</span>);

<span class="hljs-comment">// åè½¬åˆ—è¡¨</span>
List&lt;String&gt; reversed = Lists.reverse(list);

<span class="hljs-comment">// åˆ†åŒº</span>
List&lt;List&lt;String&gt;&gt; partitions = Lists.partition(list, <span class="hljs-number">2</span>);
<span class="hljs-comment">// ç»“æœ: [[A, B], [C]]</span>

<span class="hljs-comment">// ç¬›å¡å°”ç§¯</span>
List&lt;List&lt;String&gt;&gt; cartesian = Lists.cartesianProduct(
    Lists.newArrayList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>),
    Lists.newArrayList(<span class="hljs-string">"1"</span>, <span class="hljs-string">"2"</span>)
);
<span class="hljs-comment">// ç»“æœ: [[A, 1], [A, 2], [B, 1], [B, 2]]</span>
</code></pre>
<h3 data-id="heading-14">4.2 Sets å·¥å…·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º HashSet</span>
Set&lt;String&gt; set1 = Sets.newHashSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
Set&lt;String&gt; set2 = Sets.newHashSet(<span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>);

<span class="hljs-comment">// å¹¶é›†</span>
Set&lt;String&gt; union = Sets.union(set1, set2);  <span class="hljs-comment">// [A, B, C, D]</span>

<span class="hljs-comment">// äº¤é›†</span>
Set&lt;String&gt; intersection = Sets.intersection(set1, set2);  <span class="hljs-comment">// [B, C]</span>

<span class="hljs-comment">// å·®é›†</span>
Set&lt;String&gt; difference = Sets.difference(set1, set2);  <span class="hljs-comment">// [A]</span>

<span class="hljs-comment">// å¯¹ç§°å·®é›†</span>
Set&lt;String&gt; symmetricDifference = Sets.symmetricDifference(set1, set2);  <span class="hljs-comment">// [A, D]</span>

<span class="hljs-comment">// å¹‚é›†</span>
Set&lt;Set&lt;String&gt;&gt; powerSet = Sets.powerSet(Sets.newHashSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>));
<span class="hljs-comment">// ç»“æœ: [[], [A], [B], [A, B]]</span>
</code></pre>
<h3 data-id="heading-15">4.3 Maps å·¥å…·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º HashMap</span>
Map&lt;String, Integer&gt; map = Maps.newHashMap();

<span class="hljs-comment">// ä» Set åˆ›å»º Map</span>
Set&lt;String&gt; keys = Sets.newHashSet(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);
Map&lt;String, String&gt; mapFromKeys = Maps.asMap(keys, key -&gt; key.toLowerCase());

<span class="hljs-comment">// è¿‡æ»¤ Map</span>
Map&lt;String, Integer&gt; filtered = Maps.filterKeys(map, key -&gt; key.startsWith(<span class="hljs-string">"A"</span>));

<span class="hljs-comment">// è½¬æ¢ Map å€¼</span>
Map&lt;String, String&gt; transformed = Maps.transformValues(map, value -&gt; <span class="hljs-string">"Value: "</span> + value);

<span class="hljs-comment">// å·®å¼‚æ¯”è¾ƒ</span>
MapDifference&lt;String, Integer&gt; diff = Maps.difference(map1, map2);
System.out.println(<span class="hljs-string">"ä»…åœ¨å·¦ä¾§: "</span> + diff.entriesOnlyOnLeft());
System.out.println(<span class="hljs-string">"ä»…åœ¨å³ä¾§: "</span> + diff.entriesOnlyOnRight());
System.out.println(<span class="hljs-string">"å€¼ä¸åŒ: "</span> + diff.entriesDiffering());
</code></pre>
<h2 data-id="heading-16">5. Optional - é¿å…ç©ºæŒ‡é’ˆ</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»º Optional</span>
Optional&lt;String&gt; optional = Optional.of(<span class="hljs-string">"Hello"</span>);
Optional&lt;String&gt; nullable = Optional.fromNullable(<span class="hljs-literal">null</span>);
Optional&lt;String&gt; absent = Optional.absent();

<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span>
<span class="hljs-keyword">if</span> (optional.isPresent()) {
    System.out.println(optional.get());
}

<span class="hljs-comment">// æä¾›é»˜è®¤å€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> nullable.or(<span class="hljs-string">"Default"</span>);

<span class="hljs-comment">// è½¬æ¢</span>
Optional&lt;Integer&gt; length = optional.transform(String::length);

<span class="hljs-comment">// ä¸ Java 8 Optional äº’è½¬</span>
java.util.Optional&lt;String&gt; javaOptional = optional.toJavaUtil();
Optional&lt;String&gt; guavaOptional = Optional.fromJavaUtil(javaOptional);
</code></pre>
<h2 data-id="heading-17">6. Preconditions - å‰ç½®æ¡ä»¶æ£€æŸ¥</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processUser</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age, List&lt;String&gt; roles)</span> {
    <span class="hljs-comment">// æ£€æŸ¥é null</span>
    Preconditions.checkNotNull(name, <span class="hljs-string">"å§“åä¸èƒ½ä¸ºç©º"</span>);
    
    <span class="hljs-comment">// æ£€æŸ¥å‚æ•°æ¡ä»¶</span>
    Preconditions.checkArgument(age &gt;= <span class="hljs-number">0</span> &amp;&amp; age &lt;= <span class="hljs-number">150</span>, 
        <span class="hljs-string">"å¹´é¾„å¿…é¡»åœ¨ 0-150 ä¹‹é—´ï¼Œå®é™…å€¼: %s"</span>, age);
    
    <span class="hljs-comment">// æ£€æŸ¥çŠ¶æ€</span>
    Preconditions.checkState(isInitialized, <span class="hljs-string">"æœåŠ¡æœªåˆå§‹åŒ–"</span>);
    
    <span class="hljs-comment">// æ£€æŸ¥ç´¢å¼•</span>
    Preconditions.checkElementIndex(<span class="hljs-number">0</span>, roles.size(), <span class="hljs-string">"è§’è‰²åˆ—è¡¨"</span>);
    
    <span class="hljs-comment">// æ£€æŸ¥ä½ç½®ç´¢å¼•</span>
    Preconditions.checkPositionIndex(<span class="hljs-number">1</span>, roles.size(), <span class="hljs-string">"è§’è‰²åˆ—è¡¨"</span>);
}
</code></pre>
<h2 data-id="heading-18">7. Objects å·¥å…·</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç©ºå€¼åˆ¤æ–­</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">isNull</span> <span class="hljs-operator">=</span> Objects.equal(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// å“ˆå¸Œç </span>
<span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> Objects.hashCode(obj1, obj2, obj3);

<span class="hljs-comment">// toString è¾…åŠ©</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> MoreObjects.toStringHelper(<span class="hljs-built_in">this</span>)
    .add(<span class="hljs-string">"name"</span>, name)
    .add(<span class="hljs-string">"age"</span>, age)
    .toString();
<span class="hljs-comment">// è¾“å‡º: ClassName{name=John, age=30}</span>

<span class="hljs-comment">// æ¯”è¾ƒé“¾</span>
<span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ComparisonChain.start()
    .compare(<span class="hljs-built_in">this</span>.name, other.name)
    .compare(<span class="hljs-built_in">this</span>.age, other.age)
    .result();
</code></pre>
<h2 data-id="heading-19">8. IO å·¥å…·</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¯»å–æ–‡ä»¶</span>
<span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> Files.asCharSource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"test.txt"</span>), Charsets.UTF_8).read();

<span class="hljs-comment">// å†™å…¥æ–‡ä»¶</span>
Files.asCharSink(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"output.txt"</span>), Charsets.UTF_8).write(<span class="hljs-string">"Hello World"</span>);

<span class="hljs-comment">// å¤åˆ¶æ–‡ä»¶</span>
Files.copy(sourceFile, targetFile);

<span class="hljs-comment">// ç§»åŠ¨æ–‡ä»¶</span>
Files.move(sourceFile, targetFile);

<span class="hljs-comment">// è¯»å–æ‰€æœ‰è¡Œ</span>
List&lt;String&gt; lines = Files.readLines(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"test.txt"</span>), Charsets.UTF_8);

<span class="hljs-comment">// å…³é—­æµ</span>
<span class="hljs-type">Closer</span> <span class="hljs-variable">closer</span> <span class="hljs-operator">=</span> Closer.create();
<span class="hljs-keyword">try</span> {
    <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> closer.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>));
    <span class="hljs-comment">// ä½¿ç”¨æµ</span>
} <span class="hljs-keyword">catch</span> (Throwable e) {
    <span class="hljs-keyword">throw</span> closer.rethrow(e);
} <span class="hljs-keyword">finally</span> {
    closer.close();
}
</code></pre>
<h2 data-id="heading-20">9. æ•°å­¦å·¥å…· (Math)</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ•´æ•°è¿ç®—</span>
<span class="hljs-type">int</span> <span class="hljs-variable">gcd</span> <span class="hljs-operator">=</span> IntMath.gcd(<span class="hljs-number">12</span>, <span class="hljs-number">18</span>);  <span class="hljs-comment">// æœ€å¤§å…¬çº¦æ•°: 6</span>
<span class="hljs-type">int</span> <span class="hljs-variable">mod</span> <span class="hljs-operator">=</span> IntMath.mod(-<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);   <span class="hljs-comment">// æ¨¡è¿ç®—: 1</span>
<span class="hljs-type">int</span> <span class="hljs-variable">pow</span> <span class="hljs-operator">=</span> IntMath.pow(<span class="hljs-number">2</span>, <span class="hljs-number">10</span>);   <span class="hljs-comment">// å¹‚è¿ç®—: 1024</span>

<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºè´¨æ•°</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">isPrime</span> <span class="hljs-operator">=</span> IntMath.isPrime(<span class="hljs-number">17</span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// é˜¶ä¹˜</span>
<span class="hljs-type">int</span> <span class="hljs-variable">factorial</span> <span class="hljs-operator">=</span> IntMath.factorial(<span class="hljs-number">5</span>);  <span class="hljs-comment">// 120</span>

<span class="hljs-comment">// äºŒé¡¹å¼ç³»æ•°</span>
<span class="hljs-type">int</span> <span class="hljs-variable">binomial</span> <span class="hljs-operator">=</span> IntMath.binomial(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 10</span>

<span class="hljs-comment">// æµ®ç‚¹æ•°æ¯”è¾ƒ</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">fuzzyEquals</span> <span class="hljs-operator">=</span> DoubleMath.fuzzyEquals(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0000001</span>, <span class="hljs-number">0.00001</span>);
</code></pre>
<h2 data-id="heading-21">10. RateLimiter - é™æµå™¨</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºé™æµå™¨ï¼šæ¯ç§’ 5 ä¸ªè®¸å¯</span>
<span class="hljs-type">RateLimiter</span> <span class="hljs-variable">limiter</span> <span class="hljs-operator">=</span> RateLimiter.create(<span class="hljs-number">5.0</span>);

<span class="hljs-comment">// è·å–è®¸å¯ï¼ˆé˜»å¡ï¼‰</span>
limiter.acquire();
processRequest();

<span class="hljs-comment">// è·å–å¤šä¸ªè®¸å¯</span>
limiter.acquire(<span class="hljs-number">3</span>);

<span class="hljs-comment">// å°è¯•è·å–è®¸å¯ï¼ˆéé˜»å¡ï¼‰</span>
<span class="hljs-keyword">if</span> (limiter.tryAcquire()) {
    processRequest();
} <span class="hljs-keyword">else</span> {
    rejectRequest();
}

<span class="hljs-comment">// å¸¦è¶…æ—¶çš„è·å–</span>
<span class="hljs-keyword">if</span> (limiter.tryAcquire(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) {
    processRequest();
}
</code></pre>
<h2 data-id="heading-22">Maven ä¾èµ–</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>32.1.3-jre<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h2 data-id="heading-23">æ€»ç»“</h2>
<p>Guava æä¾›äº†ä¸°å¯Œçš„å·¥å…·ç±»ï¼Œæ¶µç›–é›†åˆã€å­—ç¬¦ä¸²ã€ç¼“å­˜ã€IO ç­‰å¤šä¸ªæ–¹é¢ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡ Java å¼€å‘æ•ˆç‡ã€‚å»ºè®®åœ¨é¡¹ç›®ä¸­åˆç†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå‡å°‘é‡å¤é€ è½®å­ï¼Œæé«˜ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>å…³é”®ä¼˜åŠ¿ï¼š</p>
<ul>
<li>çº¿ç¨‹å®‰å…¨çš„ä¸å¯å˜é›†åˆ</li>
<li>å¼ºå¤§çš„é›†åˆæ‰©å±•ï¼ˆMultimapã€Tableã€BiMapï¼‰</li>
<li>ç®€æ´çš„å­—ç¬¦ä¸²å¤„ç†</li>
<li>é«˜æ€§èƒ½æœ¬åœ°ç¼“å­˜</li>
<li>å®Œå–„çš„å‰ç½®æ¡ä»¶æ£€æŸ¥</li>
<li>å®ç”¨çš„é™æµå’Œæ•°å­¦å·¥å…·</li>
</ul>
<p>é€šè¿‡æŒæ¡è¿™äº›å¸¸ç”¨å·¥å…·åŒ…ï¼Œä½ å¯ä»¥å†™å‡ºæ›´åŠ ç®€æ´ã€é«˜æ•ˆã€å¥å£®çš„ Java ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¬è¯´å‰ç«¯åˆæ­»äº†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575651989985820726</link>    <guid>https://juejin.cn/post/7575651989985820726</guid>    <pubDate>2025-11-24T02:40:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575651989985820726" data-draft-id="7575937594350010411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¬è¯´å‰ç«¯åˆæ­»äº†ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,ç¨‹åºå‘˜,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T02:40:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="suke"/> <meta itemprop="url" content="https://juejin.cn/user/404227777640397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¬è¯´å‰ç«¯åˆæ­»äº†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/404227777640397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    suke
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:40:56.000Z" title="Mon Nov 24 2025 02:40:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™å‡ å¤©åˆ· Xã€åˆ· Redditã€åˆ·å›½å†…æŠ€æœ¯ç¤¾åŒºï¼Œåªè¦ä½ ç¨å¾®ç‚¹å¼€çƒ­æ¦œï¼Œå°±ä¼šè¢«åŒä¸€å¥è¯ç²¾å‡†çˆ†å¤´ï¼š</p>
<p>â€œGemini 3 çœŸçš„æŠŠå‰ç«¯æ‰¬äº†ï¼Œè¿™æ¬¡æ˜¯éª¨ç°çº§åˆ«çš„æ‰¬ã€‚â€</p>
<p>â€œä¸€ä¸ª prompt ç›´æ¥å‡º 3D ä½“ç´ ç¼–è¾‘å™¨/è§†é¢‘å‰ªè¾‘è½¯ä»¶/ç”µå½±çº§ç™»é™†é¡µï¼Œå‰ç«¯å½»åº•æ²¡æ´»äº†ã€‚â€</p>
<p>â€œæˆ‘ç”¨ Gemini 3 ä¸‰åˆ†é’Ÿå†™äº†ä¸ªæ¯” CapCut è¿˜ä¸æ»‘çš„ç½‘é¡µç‰ˆå‰ªè¾‘å™¨ï¼Œç¨‹åºå‘˜å¯ä»¥å›å®¶æŠ±å­©å­äº†ã€‚â€</p>
<p>é…å›¾æ°¸è¿œæ˜¯é‚£ç§é«˜æ½®åˆ°å‘å…‰çš„ 4K 60fps æ¼”ç¤ºè§†é¢‘ï¼šä¸€ä¸ª prompt â†’ è¿›åº¦æ¡èµ°å®Œ â†’ å®Œç¾äº¤äº’åº”ç”¨è·ƒç„¶å±å¹•ï¼Œç‚¹èµå‡ ä¸‡ï¼Œè½¬å‘ç‹‚æ¬¢ï¼Œè¯„è®ºåŒºæ¸…ä¸€è‰²â€œå‰ç«¯å·²æ­»â€â€œæˆ‘å¤±ä¸šäº†â€â€œæ—¶ä»£æŠ›å¼ƒä½ è¿æ‹›å‘¼éƒ½ä¸æ‰“â€ã€‚</p>
<p>å…„å¼Ÿä»¬ï¼Œæˆ‘å¤ªç†Ÿè¿™ä¸ªå‰§æœ¬äº†ã€‚å‰ç«¯è¿™å‡ å¹´ï¼Œå¹³å‡æ¯ 9 ä¸ªæœˆå°±è¢«å…¬å¼€å¤„å†³ä¸€æ¬¡ã€‚</p>
<h4 data-id="heading-0">æˆ‘ä»¬çš„æ­»äº¡æ¸…å•ï¼ˆ2025 å¹´ 11 æœˆå®æ—¶æ›´æ–°ç‰ˆï¼‰</h4>
<ul>
<li>2010ï¼šWordPress æ¨¡æ¿ â†’ å‰ç«¯å†å’</li>
<li>2015ï¼šWebflow/No-Code â†’ å‰ç«¯ä¸‰å’</li>
<li>2023ï¼šGPT-4 ä¸€ä¸ª prompt è´ªåƒè›‡ â†’ å‰ç«¯å››å’</li>
<li>2024ï¼šClaude 3.5 Sonnet å· UI â†’ å‰ç«¯äº”å’</li>
<li>2025 å¹´ 11 æœˆ 18-21 æ—¥ï¼šGemini 3 è¿å‘ä¸‰å¤© demoï¼ˆä½“ç´ ç©å…·ç®±ã€ç½‘é¡µç‰ˆ CapCutã€èµ›åšé£ç™»é™†é¡µã€AI è§†é¢‘ç”Ÿæˆå·¥å…·â€¦â€¦ï¼‰â†’ å‰ç«¯è¿™ä¸‰å¤©æ­»äº† 114514 æ¬¡ï¼Œç›®å‰éª¨ç°å·²è¢« X ç”¨æˆ·æ‰¬åˆ°å¤ªå¹³æ´‹å¯¹å²¸å»äº†</li>
</ul>
<h4 data-id="heading-1">è¿™å‡ å¤©æœ€ç»å…¸çš„å‡ ä¸ªâ€œè‘¬ç¤¼ç°åœºâ€</h4>
<blockquote>
<ol>
<li>é‚£ä¸ª 3D Voxel Toy Boxï¼šä¸€ä¸ª prompt å‡ºæ¥ï¼Œå®æ—¶ç»˜ç”»ã€ç ´åã€å¯¼å‡º glTFï¼Œä¸æ»‘å¾—åƒ Unity å®˜æ–¹ demoã€‚è¯„è®ºåŒºç›´æ¥é«˜å‘¼â€œå‰ç«¯å·¥ç¨‹å¸ˆå¯ä»¥é›†ä½“è½¬è¡Œäº†â€ã€‚</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>é‚£ä¸ªç½‘é¡µç‰ˆè§†é¢‘ç¼–è¾‘å™¨ï¼šæ‹–æ‹½æ—¶é—´çº¿ã€AI è‡ªåŠ¨ç”Ÿæˆè§†é¢‘ã€TTSã€å­—å¹•ã€è½¬åœºå…¨æœ‰ã€‚ä½œè€…åœ¨ X ä¸Šå‘å¸–ï¼šâ€œä» 0 åˆ° 1 åªç”¨äº† 1.5 å°æ—¶ï¼Œæ„Ÿè°¢ Gemini 3ã€‚â€ åº•ä¸‹å›å¤â€œå‰ç«¯å·²æ­»â€â€œæˆ‘å“­æ­»â€â€œç¨‹åºå‘˜æœ«æ—¥â€ã€‚</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>é‚£ä¸ªç”µå½±çº§ç™»é™†é¡µï¼šæš—é»‘èµ›åšé£ã€3D ç²’å­èƒŒæ™¯ã€é¼ æ ‡è§†å·®ã€æ»šåŠ¨è§¦å‘åŠ¨ç”»ï¼Œå®Œç¾å“åº”å¼ï¼Œè¿ iPad æ¨ªç«–å±åˆ‡æ¢éƒ½ä¸æ»‘ã€‚ä½œè€…æ·¡å®šåœ°è¯´ï¼šâ€œå°±ä¸€ä¸ª promptï¼Œæ”¹äº†ä¸‰æ¬¡æè¿°ã€‚â€</li>
</ol>
</blockquote>
<p>ç„¶åè¿™å‡ å¤©ï¼Œæ—¶é—´çº¿å½»åº•æ²¦é™·ï¼š</p>
<ul>
<li>â€œä»¥åå…¬å¸åªéœ€è¦ä¸€ä¸ªä¼šå†™ prompt çš„äº§å“ç»ç†å°±è¡Œäº†ã€‚â€</li>
<li>â€œå‰ç«¯å²—ä½é¢„è®¡ 2026 å¹´æ¶ˆå¤±ã€‚â€</li>
<li>â€œå»ºè®®æ‰€æœ‰å¤§å‚ç«‹åˆ»è£æ‰ 90% çš„å‰ç«¯ã€‚â€</li>
</ul>
<p><strong>Gemini 3 ç¡®å®ç‰›é€¼</strong>ï¼Œè¿™å‡ å¤© X ä¸Šçš„å„ç§å®æµ‹æç¤ºè¯éƒ½è¯•äº†ä¸‹ï¼Œç”Ÿæˆçš„ä¸œè¥¿ç¡®å®ç‰›é€¼ï¼Œæˆ‘æŠŠå…¬å¸é¦–é¡µä¸¢ç»™å®ƒï¼Œè®©å®ƒâ€œé‡æ„å¾—æ›´ç°ä»£ä¸€ç‚¹â€ã€‚
<strong>20ç§’åï¼Œå®ƒç»™æˆ‘åäº†ä¸€ä¸ªç”µå½±çº§ç²’å­èƒŒæ™¯ + 3D å¡ç‰‡ + æ»šåŠ¨è§¦å‘åŠ¨ç”»çš„ç‰ˆæœ¬ï¼ŒLighthouse ç›´æ¥ 100/100/100/100ã€‚ã€‚ã€‚å¥¶å¥¶çš„è¿™æ¯”å¥½å¤šä¼˜ç§€å‰ç«¯å†™çš„ä¸çŸ¥é“å¥½å¤šå°‘å€ã€‚ã€‚</strong></p>
<p>ä½†é—®é¢˜æ¥äº†ï¼šä½ ä¸€ä¸ª prompt åšå‡ºæ¥çš„å®Œç¾ demoï¼Œæ˜å¤©ä¸Šçº¿çš„æ—¶å€™ï¼Œç”²æ–¹ä¼šå‘Šè¯‰ä½ ï¼š</p>
<p>â€œèƒŒæ™¯è¦é‚£ç§çœ‹ä¸è§çš„é»‘è‰²ï¼Œåƒæ·±å¤œemoä½†åˆæœ‰å¸Œæœ›çš„æ„Ÿè§‰ã€‚â€</p>
<p>â€œè¿™ä¸ªåŠ¨ç”»å†æ…¢ 0.2 ç§’ï¼Œç”¨æˆ·ä¼šè§‰å¾—æˆ‘ä»¬å…¬å¸å¾ˆç¨³é‡ã€‚â€</p>
<p>ä½ é—® Gemini 3 æ€ä¹ˆæ”¹ï¼Œå®ƒä¼šéå¸¸è®¤çœŸåœ°ç»™ä½ ç”Ÿæˆ 17 ç§ä¼˜é›…æ–¹æ¡ˆã€‚</p>
<p>ç„¶åä½ ä¸Šçº¿åå‘ç°ï¼š</p>
<ul>
<li>ç”²æ–¹ä¸æ»¡æ„ï¼Œè¿™é‡Œé‚£é‡Œæ€ä¹ˆæ ·æ€ä¹ˆæ ·ã€‚</li>
<li>ç”²æ–¹çš„æµè§ˆå™¨ CSS ä¸å…¼å®¹è€Œå¯¼è‡´çš„æ ·å¼æ··ä¹±ã€‚</li>
<li>æ–°çš„æ ·å¼å’Œé¡¹ç›®æ•´ä½“æ ·å¼å†²çªã€‚
è¿™æ—¶å€™ä½ è¿˜å¾—è‡ªå·±ä¸Šæ‰‹ï¼Œä¸€ä¸ªä¸ªå»ä¿®ã€å» hackã€å»åŠ ä¸€å † !important å’Œ anyã€‚</li>
</ul>
<p>æ­å–œä½ ï¼Œä½ åˆå›åˆ°äº†æœ€ç†Ÿæ‚‰çš„å‰ç«¯ç”Ÿæ´»ã€‚</p>
<h4 data-id="heading-2">2026 å¹´çš„æ–°å·¥ç§ï¼šAI æ“¦å±è‚¡å·¥ç¨‹å¸ˆ</h4>
<p>è¿™å‡ å¤©ç½‘ä¸Šæœ€çƒ­é—¨çš„æ¢—å°±æ˜¯â€œå‰ç«¯å·²æ­»â€ï¼Œä½†æ˜¯åªè¦ç”²æ–¹å­˜åœ¨ï¼Œå‰ç«¯åŒä»å°±æœ‰æ´»è·¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œé¢å¯¹è¿™å‡ å¤©é“ºå¤©ç›–åœ°çš„â€œGemini 3 æŠŠå‰ç«¯æ‰¬äº†â€è¨€è®ºï¼Œè¯·å„ä½å‰ç«¯åŒä»ä¿æŒå†·é™ã€‚æˆ‘ä»¬<strong>å‰ç«¯çš„çœŸæ­£æ ¸å¿ƒç«äº‰åŠ›ï¼Œä»æ¥ä¸æ˜¯å†™ä»£ç </strong>ã€‚</p>
<p><strong>åªè¦ç”²æ–¹ä¼šåŠå¤œæ”¹éœ€æ±‚ï¼Œåªè¦è¿˜æœ‰å®‰å“ç¢ç‰‡åŒ–ï¼Œåªè¦ CSS è¿˜å­˜åœ¨ï¼Œå‰ç«¯å°±æ­»ä¸äº†ã€‚</strong></p>
<p><strong>å‰ç«¯å·²æ­»ï¼Ÿä¸ï¼Œå‰ç«¯åªæ˜¯åˆè¢«æ‰¬äº†ä¸€æ¬¡éª¨ç°ï¼Œç„¶åç»§ç»­è´Ÿä¼¤åŠ ç­ï¼Œé¡ºä¾¿å¸® Gemini 3 æ“¦å±è‚¡ã€‚</strong></p>
<p><strong>å‰ç«¯ä¸‡å²ï¼ï¼ˆä¸‹æ¬¡ GPT-6 å‡ºæ¥å†ç»§ç»­æ­»ï¼‰</strong></p>
<h4 data-id="heading-3">é¦–å‘åœ°å€ï¼š</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fd_hh8qKdTkW8iBYux2yrVA" target="_blank" title="https://mp.weixin.qq.com/s/d_hh8qKdTkW8iBYux2yrVA" ref="nofollow noopener noreferrer">Gemini 3 å‘å¸ƒäº†ï¼Œæ­å–œå‰ç«¯ç¬¬ 10086 æ¬¡â€œç”±äºä¸å¯æŠ—åŠ›â€å®£å‘Šæ­»äº¡</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot æ•´åˆ Elasticsearch åŠå®æˆ˜åº”ç”¨]]></title>    <link>https://juejin.cn/post/7575413146922385423</link>    <guid>https://juejin.cn/post/7575413146922385423</guid>    <pubDate>2025-11-24T01:46:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922385423" data-draft-id="7575413146922369039" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot æ•´åˆ Elasticsearch åŠå®æˆ˜åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯,Java,Elasticsearch"/> <meta itemprop="datePublished" content="2025-11-24T01:46:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿç©ºç å­—"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot æ•´åˆ Elasticsearch åŠå®æˆ˜åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿç©ºç å­—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:46:12.000Z" title="Mon Nov 24 2025 01:46:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ¬¡å†…å®¹è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Spring Boot æ•´åˆ Elasticsearchï¼Œå¹¶æä¾›å‡ ä¸ªå®é™…åº”ç”¨æ¡ˆä¾‹ã€‚å†…å®¹æ¶µç›– Elasticsearch çš„åŸºæœ¬æ¦‚å¿µã€Spring Boot æ•´åˆæ­¥éª¤ã€å®æˆ˜åº”ç”¨ç¤ºä¾‹ä»¥åŠä¼˜åŒ–å»ºè®®ã€‚</p>
<h2 data-id="heading-0">1ã€Elasticsearch æ¦‚å¿µåŠä½œç”¨</h2>
<p><strong>Elasticsearch</strong> æ˜¯ä¸€ä¸ªåŸºäº Apache Lucene æ„å»ºçš„åˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ã€‚å®ƒä¸“é—¨ä¸ºå¤„ç†å¤§è§„æ¨¡æ•°æ®è€Œè®¾è®¡ï¼Œæä¾›è¿‘å®æ—¶çš„æœç´¢èƒ½åŠ›ï¼Œæ”¯æŒç»“æ„åŒ–ã€å…¨æ–‡ã€åœ°ç†ç©ºé—´ç­‰å¤šç§ç±»å‹çš„æŸ¥è¯¢ã€‚</p>
<p>æ ¸å¿ƒç‰¹æ€§ä¸ä½œç”¨åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>åˆ†å¸ƒå¼æ¶æ„</strong>ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œé€šè¿‡åˆ†ç‰‡ï¼ˆShardï¼‰å’Œå‰¯æœ¬ï¼ˆReplicaï¼‰æœºåˆ¶å®ç°é«˜å¯ç”¨ä¸è´Ÿè½½å‡è¡¡ã€‚</li>
<li><strong>è¿‘å®æ—¶æœç´¢</strong>ï¼šæ•°æ®ç´¢å¼•åå‡ ä¹ç«‹å³å¯æœï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿå“åº”çš„åœºæ™¯ã€‚</li>
<li><strong>å¼ºå¤§çš„å…¨æ–‡æœç´¢</strong>ï¼šåŸºäºå€’æ’ç´¢å¼•ï¼Œæ”¯æŒå¤æ‚çš„æŸ¥è¯¢ã€é«˜äº®æ˜¾ç¤ºã€æ¨¡ç³ŠåŒ¹é…ç­‰ã€‚</li>
<li><strong>æ•°æ®åˆ†æä¸èšåˆ</strong>ï¼šæä¾›ä¸°å¯Œçš„èšåˆåŠŸèƒ½ï¼ˆAggregationsï¼‰ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡å’Œåˆ†æã€‚</li>
<li><strong>å¤šç±»å‹æ•°æ®æ”¯æŒ</strong>ï¼šé™¤äº†æ–‡æœ¬ï¼Œè¿˜èƒ½å¤„ç†æ—¥å¿—ã€æŒ‡æ ‡ã€åœ°ç†ç©ºé—´æ•°æ®ç­‰ã€‚</li>
<li><strong>æ˜“ç”¨æ€§ä¸æ‰©å±•æ€§</strong>ï¼šæä¾› RESTful APIï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€é›†æˆï¼Œå¹¶æ‹¥æœ‰æ´»è·ƒçš„ç”Ÿæ€ç³»ç»Ÿã€‚</li>
</ul>
<p>Elasticsearch å¹¿æ³›åº”ç”¨äºç”µå•†æœç´¢ã€æ—¥å¿—åˆ†æã€å®æ—¶ç›‘æ§ã€æ•°æ®å¯è§†åŒ–ç­‰é¢†åŸŸã€‚</p>
<h2 data-id="heading-1">2ã€Spring Boot æ•´åˆ Elasticsearch</h2>
<h3 data-id="heading-2">2.1ã€ç¯å¢ƒå‡†å¤‡ä¸ä¾èµ–é…ç½®</h3>
<p>åœ¨ Spring Boot é¡¹ç›®ä¸­ï¼Œé¦–å…ˆéœ€è¦åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ  Elasticsearch ç›¸å…³ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>åœ¨ <code>application.properties</code> ä¸­é…ç½® Elasticsearch è¿æ¥ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.elasticsearch.rest.uris</span>=http://localhost:<span class="hljs-number">9200</span>
<span class="hljs-attr">spring.data.elasticsearch.repositories.enabled</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>å¦‚æœè¿æ¥ Elasticsearch é›†ç¾¤ï¼Œå¯ä»¥é…ç½®é›†ç¾¤åç§°å’ŒèŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.data.elasticsearch.cluster-name</span>=your-cluster-name
<span class="hljs-attr">spring.data.elasticsearch.cluster-nodes</span>=ip1:port1,ip2:port2
</code></pre>
<h3 data-id="heading-3">2.2ã€åˆ›å»º Elasticsearch å®ä½“ç±»</h3>
<p>ä½¿ç”¨ <code>@Document</code> æ³¨è§£å®šä¹‰ä¸€ä¸ªå®ä½“ç±»ï¼Œæ˜ å°„åˆ° Elasticsearch çš„ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Id</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">elasticsearch</span>.<span class="hljs-property">annotations</span>.<span class="hljs-property">Document</span>;

<span class="hljs-meta">@Document</span>(indexName = <span class="hljs-string">"articles"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Article</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> title;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> content;
    
    <span class="hljs-comment">// æ— å‚æ„é€ å™¨ã€æœ‰å‚æ„é€ å™¨ã€getterå’Œsetteræ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Article</span>() {}
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Article</span>(<span class="hljs-title class_">String</span> id, <span class="hljs-title class_">String</span> title, <span class="hljs-title class_">String</span> content) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content;
    }
    
    <span class="hljs-comment">// Getter å’Œ Setter æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getId</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> id; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setId</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> id</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id; }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getTitle</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> title; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setTitle</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> title</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title; }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getContent</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> content; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setContent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> content</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span> = content; }
}
</code></pre>
<h3 data-id="heading-4">2.3ã€åˆ›å»º Elasticsearch Repository</h3>
<p>åˆ›å»ºä¸€ä¸ªç»§æ‰¿ <code>ElasticsearchRepository</code> çš„æ¥å£ï¼Œç”¨äºæ•°æ®æ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArticleRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;Article, String&gt; {
    
    <span class="hljs-comment">// æ ¹æ®å†…å®¹è¿›è¡Œå…¨æ–‡æœç´¢</span>
    List&lt;Article&gt; <span class="hljs-title function_">findByContentContaining</span><span class="hljs-params">(String content)</span>;
    
    <span class="hljs-comment">// æ ¹æ®æ ‡é¢˜æœç´¢</span>
    List&lt;Article&gt; <span class="hljs-title function_">findByTitleContaining</span><span class="hljs-params">(String title)</span>;
}
</code></pre>
<h3 data-id="heading-5">2.4ã€æ§åˆ¶å™¨å±‚å®ç°</h3>
<p>åˆ›å»ºä¸€ä¸ª REST æ§åˆ¶å™¨æ¥å¤„ç†æœç´¢è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;

@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/articles"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">ArticleController</span> {
    
    <span class="hljs-variable">@Autowired</span>
    private ArticleRepository articleRepository;
    
    <span class="hljs-comment">// æœç´¢æ–‡ç« </span>
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/search"</span>)
    public List&lt;Article&gt; <span class="hljs-built_in">searchArticles</span>(<span class="hljs-variable">@RequestParam</span> String query) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">articleRepository</span><span class="hljs-selector-class">.findByContentContaining</span>(query);
    }
    
    <span class="hljs-comment">// æ·»åŠ æ–°æ–‡ç« </span>
    @<span class="hljs-selector-tag">PostMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Article</span> <span class="hljs-selector-tag">createArticle</span>(<span class="hljs-variable">@RequestBody</span> Article article) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">articleRepository</span><span class="hljs-selector-class">.save</span>(article);
    }
}
</code></pre>
<h2 data-id="heading-6">3ã€Elasticsearch å®æˆ˜åº”ç”¨æ¡ˆä¾‹</h2>
<h3 data-id="heading-7">3.1ã€æ¡ˆä¾‹ä¸€ï¼šç”µå•†å¹³å°å•†å“æœç´¢ä¸é«˜äº®æ˜¾ç¤º</h3>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šç”µå•†å¹³å°éœ€è¦ä¸ºç”¨æˆ·æä¾›é«˜æ•ˆçš„å•†å“æœç´¢åŠŸèƒ½ï¼Œåœ¨æµ·é‡æ•°æ®ä¸­å¿«é€Ÿè¿”å›åŒ¹é…ç»“æœï¼Œå¹¶é«˜äº®æ˜¾ç¤ºå…³é”®å­—ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>
<p><strong>åˆ›å»ºå•†å“ç´¢å¼•</strong>ï¼š
ä½¿ç”¨ Elasticsearch çš„ REST API åˆ›å»ºå•†å“ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">PUT /products
{
  <span class="hljs-string">"mappings"</span>: {
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"name"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> },
      <span class="hljs-string">"description"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span> },
      <span class="hljs-string">"price"</span>: { <span class="hljs-string">"type"</span>: <span class="hljs-string">"float"</span> }
    }
  }
}
</code></pre>
</li>
<li>
<p><strong>æ·»åŠ å•†å“æ•°æ®</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">POST /products/_doc/1
{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"åä¸º Mate 70"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Mate 70 æ‰‹æœºæ˜¯æ­è½½çº¯è¡€é¸¿è’™NEXT ç³»ç»Ÿçš„ç¬¬ä¸€æ¬¾æ——èˆ°æœº"</span>,
  <span class="hljs-string">"price"</span>: 6500
}
</code></pre>
</li>
<li>
<p><strong>å®ç°æœç´¢ä¸é«˜äº®</strong>ï¼š
åœ¨ Repository ä¸­å®šä¹‰å¤æ‚æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.annotations.Query;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> interface <span class="hljs-type">ProductRepository</span> extends <span class="hljs-type">ElasticsearchRepository</span>&lt;<span class="hljs-type">Product</span>, <span class="hljs-type">String</span>&gt; {
    
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"{<span class="hljs-subst">\"</span>multi_match<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>query<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>?0<span class="hljs-subst">\"</span>, <span class="hljs-subst">\"</span>fields<span class="hljs-subst">\"</span>: [<span class="hljs-subst">\"</span>name<span class="hljs-subst">\"</span>, <span class="hljs-subst">\"</span>description<span class="hljs-subst">\"</span>]}}"</span>)
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">Product</span>&gt; findByQuery(<span class="hljs-type">String</span> query);
}
</code></pre>
<p>ä½¿ç”¨ Elasticsearch çš„é«˜äº®æŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ElasticsearchRestTemplate</span> elasticsearchTemplate;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">SearchHit</span>&lt;<span class="hljs-title class_">Product</span>&gt;&gt; <span class="hljs-title function_">searchProductsWithHighlight</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> keyword</span>) {
        <span class="hljs-comment">// åˆ›å»ºæŸ¥è¯¢æ¡ä»¶</span>
        <span class="hljs-title class_">NativeSearchQuery</span> searchQuery = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()
            .<span class="hljs-title function_">withQuery</span>(<span class="hljs-title class_">QueryBuilders</span>.<span class="hljs-title function_">multiMatchQuery</span>(keyword, <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>))
            .<span class="hljs-title function_">withHighlightFields</span>(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.<span class="hljs-title class_">Field</span>(<span class="hljs-string">"name"</span>).<span class="hljs-title function_">preTags</span>(<span class="hljs-string">"&lt;em&gt;"</span>).<span class="hljs-title function_">postTags</span>(<span class="hljs-string">"&lt;/em&gt;"</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>.<span class="hljs-title class_">Field</span>(<span class="hljs-string">"description"</span>).<span class="hljs-title function_">preTags</span>(<span class="hljs-string">"&lt;em&gt;"</span>).<span class="hljs-title function_">postTags</span>(<span class="hljs-string">"&lt;/em&gt;"</span>)
            )
            .<span class="hljs-title function_">build</span>();
        
        <span class="hljs-title class_">SearchHits</span>&lt;<span class="hljs-title class_">Product</span>&gt; searchHits = elasticsearchTemplate.<span class="hljs-title function_">search</span>(searchQuery, <span class="hljs-title class_">Product</span>.<span class="hljs-property">class</span>);
        <span class="hljs-keyword">return</span> searchHits.<span class="hljs-title function_">getSearchHits</span>();
    }
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-8">3.2ã€æ¡ˆä¾‹äºŒï¼šæ—¥å¿—æ”¶é›†ä¸åˆ†æç³»ç»Ÿ</h3>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨æ—¥å¿—è¿›è¡Œé›†ä¸­ç®¡ç†ã€å®æ—¶ç›‘æ§ä¸åˆ†æï¼Œå¿«é€Ÿå®šä½ç³»ç»Ÿé”™è¯¯å’Œæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ä½¿ç”¨ ELK/EFK æŠ€æœ¯æ ˆ</strong>ï¼š</p>
<ul>
<li><strong>Filebeat/Logstash</strong>ï¼šæ”¶é›†åº”ç”¨æ—¥å¿—</li>
<li><strong>Elasticsearch</strong>ï¼šå­˜å‚¨å’Œç´¢å¼•æ—¥å¿—æ•°æ®</li>
<li><strong>Kibana</strong>ï¼šæ—¥å¿—å¯è§†åŒ–å’Œç›‘æ§</li>
</ul>
</li>
<li>
<p><strong>åˆ›å»ºæ—¥å¿—ç´¢å¼•</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Document</span>(indexName = <span class="hljs-string">"app-logs-#{T(java.time.LocalDate).now().toString()}"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppLog</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> id;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> level;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> message;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> logger;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> timestamp;
    <span class="hljs-comment">// ... å…¶ä»–å­—æ®µå’Œæ–¹æ³•</span>
}
</code></pre>
</li>
<li>
<p><strong>å®ç°æ—¥å¿—åˆ†æ</strong>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> interface <span class="hljs-type">LogRepository</span> extends <span class="hljs-type">ElasticsearchRepository</span>&lt;<span class="hljs-type">AppLog</span>, <span class="hljs-type">String</span>&gt; {
    
    <span class="hljs-comment">// ç»Ÿè®¡å„æ—¥å¿—çº§åˆ«çš„æ•°é‡</span>
    <span class="hljs-meta">@Query</span>(<span class="hljs-string">"{<span class="hljs-subst">\"</span>aggs<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>levels<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>terms<span class="hljs-subst">\"</span>: {<span class="hljs-subst">\"</span>field<span class="hljs-subst">\"</span>: <span class="hljs-subst">\"</span>level.keyword<span class="hljs-subst">\"</span>}}}}"</span>)
    <span class="hljs-type">AggregatedPage</span>&lt;<span class="hljs-type">AppLog</span>&gt; countByLevel();
    
    <span class="hljs-comment">// æ ¹æ®æ—¶é—´èŒƒå›´æŸ¥è¯¢æ—¥å¿—</span>
    <span class="hljs-type">List</span>&lt;<span class="hljs-type">AppLog</span>&gt; findByTimestampBetween(<span class="hljs-type">String</span> startTime, <span class="hljs-type">String</span> endTime);
}
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">3.3ã€æ¡ˆä¾‹ä¸‰ï¼šå¤æ‚æŸ¥è¯¢ä¸èšåˆåˆ†æ</h3>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šæ–°é—»åˆ†æå¹³å°éœ€è¦å¯¹å¤§é‡æ–‡ç« è¿›è¡Œå¤æ‚æŸ¥è¯¢å’Œå†…å®¹åˆ†æï¼Œä¾‹å¦‚ç»Ÿè®¡ç‰¹å®šå…³é”®è¯çš„å‡ºç°é¢‘ç‡ã€‚</p>
<p><strong>å®ç°æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>å¸ƒå°”æŸ¥è¯¢</strong>ï¼š
ç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> org.elasticsearch.index.query.QueryBuilders;
<span class="hljs-keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;

<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Article&gt; <span class="hljs-title">complexSearch</span><span class="hljs-params">(<span class="hljs-type">String</span> mustTerm, <span class="hljs-type">String</span> shouldTerm, <span class="hljs-type">String</span> mustNotTerm)</span> </span>{
    BoolQueryBuilder boolQuery = QueryBuilders.<span class="hljs-built_in">boolQuery</span>()
        .<span class="hljs-built_in">must</span>(QueryBuilders.<span class="hljs-built_in">matchQuery</span>(<span class="hljs-string">"title"</span>, mustTerm))
        .<span class="hljs-built_in">should</span>(QueryBuilders.<span class="hljs-built_in">matchQuery</span>(<span class="hljs-string">"content"</span>, shouldTerm))
        .<span class="hljs-built_in">mustNot</span>(QueryBuilders.<span class="hljs-built_in">matchQuery</span>(<span class="hljs-string">"status"</span>, mustNotTerm));
    
    NativeSearchQuery searchQuery = <span class="hljs-keyword">new</span> <span class="hljs-built_in">NativeSearchQueryBuilder</span>()
        .<span class="hljs-built_in">withQuery</span>(boolQuery)
        .<span class="hljs-built_in">build</span>();
    
    <span class="hljs-keyword">return</span> elasticsearchTemplate.<span class="hljs-built_in">search</span>(searchQuery, Article.<span class="hljs-keyword">class</span>).<span class="hljs-built_in">getContent</span>();
}
</code></pre>
</li>
<li>
<p><strong>èšåˆåˆ†æ</strong>ï¼š
ç»Ÿè®¡æ ‡ç­¾å‡ºç°é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">public void tagAggregation() {
    TermsAggregationBuilder <span class="hljs-attr">aggregation</span> = AggregationBuilders
        .terms("tags_aggregation")
        .field("tags.keyword")<span class="hljs-comment">;</span>
    
    NativeSearchQuery <span class="hljs-attr">searchQuery</span> = new NativeSearchQueryBuilder()
        .addAggregation(aggregation)
        .build()<span class="hljs-comment">;</span>
    
    SearchHits&lt;Article&gt; <span class="hljs-attr">searchHits</span> = elasticsearchTemplate.search(searchQuery, Article.class)<span class="hljs-comment">;</span>
    Terms <span class="hljs-attr">terms</span> = searchHits.getAggregations().get(<span class="hljs-string">"tags_aggregation"</span>)<span class="hljs-comment">;</span>
    
    for (Terms.Bucket bucket : terms.getBuckets()) {
        System.out.println("æ ‡ç­¾: " + bucket.getKey() + ", æ•°é‡: " + bucket.getDocCount())<span class="hljs-comment">;</span>
    }
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-10">4ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>
<ol>
<li>
<p><strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä¸ºå¸¸ç”¨å­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•æ˜ å°„</li>
<li>æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„åˆ†æå™¨</li>
</ul>
</li>
<li>
<p><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨è¿‡æ»¤å™¨ç¼“å­˜ç»“æœ</li>
<li>é™åˆ¶æ£€ç´¢èŒƒå›´ï¼Œé¿å…å…¨ç´¢å¼•æ‰«æ</li>
<li>ä½¿ç”¨åˆ†é¡µå‡å°‘è¿”å›æ•°æ®é‡</li>
</ul>
</li>
<li>
<p><strong>é›†ç¾¤ä¸åˆ†ç‰‡é…ç½®</strong>ï¼š</p>
<ul>
<li>æ ¹æ®æ•°æ®é‡å’Œç¡¬ä»¶é…ç½®åˆç†è®¾ç½®åˆ†ç‰‡æ•°é‡å’Œå‰¯æœ¬</li>
<li>ç›‘æ§èŠ‚ç‚¹è´Ÿè½½ï¼Œé¿å…çƒ­ç‚¹æ•°æ®é—®é¢˜</li>
</ul>
</li>
<li>
<p><strong>æ‰¹é‡æ“ä½œ</strong>ï¼š
å¯¹äºå¤§é‡æ•°æ®æ’å…¥å’Œæ›´æ–°ï¼Œä½¿ç”¨æ‰¹é‡æ“ä½œæé«˜æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class BulkOperationService {
    
    <span class="hljs-keyword">@Autowired</span>
    private ElasticsearchRestTemplate elasticsearchTemplate;
    
    public void <span class="hljs-built_in">bulkInsert</span>(List&lt;Article&gt; articles) {
        List&lt;IndexQuery&gt; queries = articles<span class="hljs-selector-class">.stream</span>()
            <span class="hljs-selector-class">.map</span>(article -&gt; new IndexQueryBuilder()
                <span class="hljs-selector-class">.withId</span>(article.getId())
                <span class="hljs-selector-class">.withObject</span>(article)
                <span class="hljs-selector-class">.build</span>())
            <span class="hljs-selector-class">.collect</span>(Collectors.toList());
        
        elasticsearchTemplate<span class="hljs-selector-class">.bulkIndex</span>(queries, BulkOptions.defaultOptions());
    }
}
</code></pre>
</li>
</ol>
<h2 data-id="heading-11">5ã€æ€»ç»“</h2>
<p>ä¸»è¦ä»‹ç»äº† Spring Boot ä¸ Elasticsearch çš„æ•´åˆæ–¹æ³•ï¼Œå¹¶é€šè¿‡ç”µå•†æœç´¢ã€æ—¥å¿—åˆ†æå’Œå¤æ‚æŸ¥è¯¢ä¸‰ä¸ªå®é™…æ¡ˆä¾‹å±•ç¤ºäº† Elasticsearch çš„åº”ç”¨ä»·å€¼ã€‚é€šè¿‡åˆç†çš„é…ç½®å’Œä¼˜åŒ–ï¼ŒElasticsearch èƒ½å¤Ÿä¸ºåº”ç”¨ç¨‹åºæä¾›å¼ºå¤§çš„æœç´¢å’Œæ•°æ®åˆ†æèƒ½åŠ›ï¼Œæ»¡è¶³å¤§æ•°æ®é‡ä¸‹çš„é«˜æ€§èƒ½éœ€æ±‚ã€‚</p>
<p>Elasticsearch çš„åˆ†å¸ƒå¼ç‰¹æ€§å’Œä¸°å¯Œçš„åŠŸèƒ½é›†ä½¿å…¶æˆä¸ºç°ä»£åº”ç”¨ä¸­ä¸å¯æˆ–ç¼ºçš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œåˆç†åˆ©ç”¨å…¶ç‰¹æ€§å¯ä»¥æ˜¾è‘—æå‡åº”ç”¨çš„æœç´¢ä½“éªŒå’Œæ•°æ®å¤„ç†èƒ½åŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2dbbcbf45674c1b9e09659e67e261bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764553572&amp;x-signature=jOsMMYx2SXY8DEubf45xxUyOcms%3D" alt="image.png" loading="lazy"/></p>
<p><strong>è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œæ—¢ç„¶çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œéšæ‰‹ç‚¹ä¸ªèµã€è½¬å‘ã€åœ¨çœ‹ä¸‰è¿å§ï¼Œæ„Ÿè°¢æ„Ÿè°¢ã€‚é‚£æˆ‘ä»¬ï¼Œä¸‹æ¬¡å†è§ã€‚</strong></p>
<p>æ‚¨çš„ä¸€é”®ä¸‰è¿ï¼Œæ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢</p>
<p>å±±æ°´æœ‰ç›¸é€¢ï¼Œæ¥æ—¥çš†å¯æœŸï¼Œè°¢è°¢é˜…è¯»ï¼Œæˆ‘ä»¬å†ä¼š</p>
<p>æˆ‘æ‰‹ä¸­çš„é‡‘ç®æ£’ï¼Œä¸Šèƒ½é€šå¤©ï¼Œä¸‹èƒ½æ¢æµ·</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python é«˜çº§ç‰¹æ€§dataclass]]></title>    <link>https://juejin.cn/post/7575456858428080174</link>    <guid>https://juejin.cn/post/7575456858428080174</guid>    <pubDate>2025-11-24T02:08:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575456858428080174" data-draft-id="7575469988737302537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python é«˜çº§ç‰¹æ€§dataclass"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-24T02:08:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GeekPMAlex"/> <meta itemprop="url" content="https://juejin.cn/user/2326992765334446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python é«˜çº§ç‰¹æ€§dataclass
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2326992765334446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GeekPMAlex
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:08:08.000Z" title="Mon Nov 24 2025 02:08:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python Dataclass ä¸­çš„ Getter ä¸ Setterï¼šä½ éœ€è¦çŸ¥é“çš„ä¸€åˆ‡</h2>
<p>åœ¨ Python ç¼–ç¨‹ä¸­ï¼Œ<code>dataclass</code> æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„è£…é¥°å™¨ï¼Œå®ƒèƒ½è‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆå¸¸è§çš„â€œæ ·æ¿ä»£ç â€ï¼ˆboilerplate codeï¼‰ï¼Œæ¯”å¦‚ <code>__init__</code>ã€<code>__repr__</code>ã€<code>__eq__</code> ç­‰æ–¹æ³•ã€‚ç„¶è€Œï¼Œå¾ˆå¤šåˆšæ¥è§¦ <code>dataclass</code> çš„å¼€å‘è€…ä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p><strong>â€œdataclass ä¼šè‡ªåŠ¨ç”Ÿæˆ getter å’Œ setter å—ï¼Ÿâ€</strong></p>
</blockquote>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¼š</strong>ã€‚</p>
<p>ä½†åˆ«æ‹…å¿ƒï¼Python çš„è®¾è®¡å“²å­¦æœ¬èº«å°±é¼“åŠ±ç›´æ¥è®¿é—®å±æ€§ï¼Œè€Œä¸æ˜¯åƒ Java é‚£æ ·å¼ºåˆ¶å°è£…ã€‚ä¸è¿‡ï¼Œå½“ä½ ç¡®å®éœ€è¦å¯¹å±æ€§çš„è¯»å†™è¿›è¡Œæ§åˆ¶æ—¶ï¼ˆæ¯”å¦‚æ•°æ®æ ¡éªŒã€æ ¼å¼è½¬æ¢ã€æ—¥å¿—è®°å½•ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>@property</code> è£…é¥°å™¨æ¥å®ç°ç±»ä¼¼ä¼ ç»Ÿ getter/setter çš„åŠŸèƒ½ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ç†è§£ dataclass ä¸­å±æ€§è®¿é—®çš„æœºåˆ¶ï¼Œå¹¶é€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä¼˜é›…åœ°å®ç°è‡ªå®šä¹‰ getter å’Œ setterã€‚</p>
<hr/>
<h3 data-id="heading-1">1. é»˜è®¤è¡Œä¸ºï¼šç›´æ¥è®¿é—®å±æ€§</h3>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æœ€ç®€å•çš„ dataclass æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    name: <span class="hljs-built_in">str</span>
    age: <span class="hljs-built_in">int</span>

<span class="hljs-comment"># åˆ›å»ºå®ä¾‹</span>
p = Person(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>)

<span class="hljs-comment"># ç›´æ¥è¯»å–ï¼ˆç›¸å½“äº getterï¼‰</span>
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># è¾“å‡º: Alice</span>

<span class="hljs-comment"># ç›´æ¥èµ‹å€¼ï¼ˆç›¸å½“äº setterï¼‰</span>
p.age = <span class="hljs-number">31</span>
<span class="hljs-built_in">print</span>(p.age)   <span class="hljs-comment"># è¾“å‡º: 31</span>
</code></pre>
<p>åœ¨ Python ä¸­ï¼Œ<strong>ç›´æ¥è®¿é—®å±æ€§æ˜¯æƒ¯ç”¨åšæ³•</strong>ã€‚è¿™ä¸ä»…ç®€æ´ï¼Œè€Œä¸”æ€§èƒ½æ›´å¥½ã€‚PEP 8 å’Œ Python ç¤¾åŒºæ™®éè®¤ä¸ºï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œå¦åˆ™ä¸éœ€è¦ä¸ºæ¯ä¸ªå­—æ®µéƒ½å†™ getter/setter æ–¹æ³•ã€‚</p>
<hr/>
<h3 data-id="heading-2">2. ä½•æ—¶éœ€è¦è‡ªå®šä¹‰ getter/setterï¼Ÿ</h3>
<p>è™½ç„¶ç›´æ¥è®¿é—®æ˜¯æ¨èæ–¹å¼ï¼Œä½†åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ§åˆ¶å±æ€§çš„è¯»å†™è¡Œä¸ºï¼š</p>
<ul>
<li>å¯¹è¾“å…¥å€¼è¿›è¡ŒéªŒè¯ï¼ˆå¦‚å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°ï¼‰</li>
<li>è‡ªåŠ¨æ ¼å¼åŒ–æ•°æ®ï¼ˆå¦‚å§“åè½¬å¤§å†™ï¼‰</li>
<li>å®ç°åªè¯»å±æ€§</li>
<li>è§¦å‘å‰¯ä½œç”¨ï¼ˆå¦‚è®°å½•æ—¥å¿—ã€æ›´æ–°ç¼“å­˜ï¼‰</li>
</ul>
<p>è¿™æ—¶ï¼Œ<code>@property</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<hr/>
<h3 data-id="heading-3">3. ä½¿ç”¨ <code>@property</code> å®ç°è‡ªå®šä¹‰ getter/setter</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å­—æ®µè®¾ä¸ºâ€œç§æœ‰â€ï¼ˆçº¦å®šä»¥ <code>_</code> å¼€å¤´ï¼‰ï¼Œç„¶åç”¨ <code>@property</code> æä¾›å—æ§çš„å…¬å…±æ¥å£ã€‚</p>
<h4 data-id="heading-4">ç¤ºä¾‹ï¼šå¸¦éªŒè¯å’Œæ ¼å¼åŒ–çš„ Person ç±»</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    _name: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># ç§æœ‰å­—æ®µï¼Œä¸ç›´æ¥æš´éœ²ç»™ç”¨æˆ·</span>
    _age: <span class="hljs-built_in">int</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""Getterï¼šè¿”å›å¤§å†™æ ¼å¼çš„å§“å"""</span>
        <span class="hljs-keyword">return</span> self._name.upper()

<span class="hljs-meta">    @name.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self, value: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""Setterï¼šç¡®ä¿å§“åéç©º"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> value <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> value.strip():
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å§“åä¸èƒ½ä¸ºç©º"</span>)
        self._name = value.strip()

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""Getterï¼šç›´æ¥è¿”å›å¹´é¾„"""</span>
        <span class="hljs-keyword">return</span> self._age

<span class="hljs-meta">    @age.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">age</span>(<span class="hljs-params">self, value: <span class="hljs-built_in">int</span></span>):
        <span class="hljs-string">"""Setterï¼šç¡®ä¿å¹´é¾„åˆæ³•"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">int</span>) <span class="hljs-keyword">or</span> value &lt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"å¹´é¾„å¿…é¡»æ˜¯éè´Ÿæ•´æ•°"</span>)
        self._age = value

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
p = Person(<span class="hljs-string">"alice"</span>, <span class="hljs-number">25</span>)
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># è¾“å‡º: ALICE</span>
<span class="hljs-built_in">print</span>(p.age)   <span class="hljs-comment"># è¾“å‡º: 25</span>

p.name = <span class="hljs-string">"bob"</span>
p.age = <span class="hljs-number">30</span>
<span class="hljs-built_in">print</span>(p.name)  <span class="hljs-comment"># è¾“å‡º: BOB</span>

<span class="hljs-comment"># å°è¯•éæ³•èµ‹å€¼</span>
<span class="hljs-comment"># p.age = -5  # æŠ›å‡º ValueError</span>
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šç”±äºæˆ‘ä»¬ä½¿ç”¨äº† <code>_name</code> å’Œ <code>_age</code> ä½œä¸º dataclass å­—æ®µï¼Œå®ƒä»¬ä»ç„¶ä¼šå‡ºç°åœ¨ <code>__init__</code> ä¸­ã€‚è¿™æ„å‘³ç€ç”¨æˆ·åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä»éœ€ä¼ å…¥è¿™äº›â€œç§æœ‰â€å­—æ®µã€‚è¿™æ˜¯ dataclass çš„ç‰¹æ€§ï¼Œä¹Ÿæ˜¯åˆç†çš„â€”â€”åˆå§‹åŒ–æ—¶çš„æ•°æ®åº”ç”±è°ƒç”¨è€…è´Ÿè´£åˆæ³•æ€§ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">4. åªè¯»å±æ€§ï¼šåªæœ‰ getterï¼Œæ²¡æœ‰ setter</h3>
<p>å¦‚æœä½ å¸Œæœ›æŸä¸ªå­—æ®µåœ¨åˆå§‹åŒ–åä¸å¯ä¿®æ”¹ï¼Œå¯ä»¥åªå®šä¹‰ <code>@property</code> è€Œä¸æä¾› setterï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    _<span class="hljs-built_in">id</span>: <span class="hljs-built_in">str</span>
    name: <span class="hljs-built_in">str</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">id</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-keyword">return</span> self._<span class="hljs-built_in">id</span>

<span class="hljs-comment"># ä½¿ç”¨</span>
u = User(<span class="hljs-string">"12345"</span>, <span class="hljs-string">"Charlie"</span>)
<span class="hljs-built_in">print</span>(u.<span class="hljs-built_in">id</span>)      <span class="hljs-comment"># æ­£å¸¸è¯»å–</span>
<span class="hljs-comment"># u.id = "67890" # æŠ¥é”™: AttributeError: can't set attribute</span>
</code></pre>
<p>è¿™æ ·å°±å®ç°äº†çœŸæ­£çš„åªè¯»å±æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-6">5. åˆå§‹åŒ–åå¤„ç†ï¼š<code>__post_init__</code></h3>
<p>æœ‰æ—¶ä½ åªæƒ³åœ¨å¯¹è±¡åˆ›å»ºååšä¸€æ¬¡æ ¡éªŒæˆ–è½¬æ¢ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡è®¿é—®éƒ½æ§åˆ¶ã€‚è¿™æ—¶å¯ä»¥ç”¨ <code>__post_init__</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass

<span class="hljs-meta">@dataclasses.dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span>:
    name: <span class="hljs-built_in">str</span>
    price: <span class="hljs-built_in">float</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__post_init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">if</span> self.price &lt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°"</span>)

<span class="hljs-comment"># ä½¿ç”¨</span>
p = Product(<span class="hljs-string">"Laptop"</span>, <span class="hljs-number">999.99</span>)  <span class="hljs-comment"># æ­£å¸¸</span>
<span class="hljs-comment"># p = Product("Phone", -100)   # æŠ›å‡ºå¼‚å¸¸</span>
</code></pre>
<p>è¿™ç§æ–¹å¼é€‚åˆä¸€æ¬¡æ€§æ ¡éªŒï¼Œä½†æ— æ³•é˜²æ­¢åç»­å¯¹ <code>price</code> çš„éæ³•èµ‹å€¼ã€‚å¦‚æœéœ€è¦æŒç»­ä¿æŠ¤ï¼Œè¿˜æ˜¯å¾—ç”¨ <code>@property</code>ã€‚</p>
<hr/>
<h3 data-id="heading-7">6. æœ€ä½³å®è·µå»ºè®®</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èåšæ³•</th></tr></thead><tbody><tr><td>æ™®é€šæ•°æ®å­˜å‚¨</td><td>ç›´æ¥ä½¿ç”¨ dataclass å­—æ®µï¼Œæ— éœ€ getter/setter</td></tr><tr><td>éœ€è¦éªŒè¯æˆ–è½¬æ¢</td><td>ä½¿ç”¨ <code>@property</code> + ç§æœ‰å­—æ®µ</td></tr><tr><td>åªè¯»å±æ€§</td><td>ä»…å®šä¹‰ <code>@property</code>ï¼Œä¸æä¾› setter</td></tr><tr><td>åˆå§‹åŒ–æ ¡éªŒ</td><td>ä½¿ç”¨ <code>__post_init__</code></td></tr><tr><td>é¿å…</td><td>æ‰‹åŠ¨ç¼–å†™ <code>get_name()</code> / <code>set_name()</code> æ–¹æ³•ï¼ˆè¿èƒŒ Python é£æ ¼ï¼‰</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">ç»“è¯­</h3>
<p>Python çš„ <code>dataclass</code> å¹¶ä¸è‡ªåŠ¨ç”Ÿæˆä¼ ç»Ÿçš„ getter å’Œ setterï¼Œä½†è¿™æ°æ°ä½“ç°äº† Python â€œæ˜¾å¼ä¼˜äºéšå¼â€ã€â€œç®€å•ä¼˜äºå¤æ‚â€çš„è®¾è®¡å“²å­¦ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç›´æ¥è®¿é—®å±æ€§å°±è¶³å¤Ÿäº†ï¼›å½“éœ€è¦é¢å¤–é€»è¾‘æ—¶ï¼Œ<code>@property</code> æä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚<strong>æ¯•ç«Ÿæˆ‘ä»¬éƒ½æ˜¯æˆå¹´äººâ€ï¼ˆ<em>Weâ€™re all consenting adults here</em>ï¼‰</strong></p>
<p>è®°ä½ï¼š<strong>ä¸è¦ä¸ºäº†å°è£…è€Œå°è£…</strong>ã€‚åªæœ‰åœ¨çœŸæ­£éœ€è¦æ§åˆ¶å±æ€§è®¿é—®è¡Œä¸ºæ—¶ï¼Œæ‰å¼•å…¥ getter/setterã€‚</p>
<hr/>
<p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpeps.python.org%2Fpep-0557%2F" target="_blank" title="https://peps.python.org/pep-0557/" ref="nofollow noopener noreferrer">PEP 557 â€“ Data Classes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Ffunctions.html%23property" target="_blank" title="https://docs.python.org/3/library/functions.html#property" ref="nofollow noopener noreferrer">Python Property Documentation</a></li>
</ul>
<p>å¦‚æœä½ æœ‰æ›´å¤æ‚çš„å±æ€§ç®¡ç†éœ€æ±‚ï¼ˆæ¯”å¦‚åŠ¨æ€è®¡ç®—å­—æ®µã€ä¾èµ–æ³¨å…¥ç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ç»“åˆ <code>pydantic</code> æˆ– <code>attrs</code> ç­‰ç¬¬ä¸‰æ–¹åº“ã€‚ä½†å¯¹å¤§å¤šæ•°åœºæ™¯æ¥è¯´ï¼Œ<code>dataclass + property</code> å·²ç»è¶³å¤Ÿå¼ºå¤§ä¸”æ¸…æ™°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringåŠ¨æ€ä»£ç†è¯¦è§£]]></title>    <link>https://juejin.cn/post/7575438636332449843</link>    <guid>https://juejin.cn/post/7575438636332449843</guid>    <pubDate>2025-11-24T02:35:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636332449843" data-draft-id="7575367791274229798" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringåŠ¨æ€ä»£ç†è¯¦è§£"/> <meta itemprop="keywords" content="Spring,Java"/> <meta itemprop="datePublished" content="2025-11-24T02:35:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringåŠ¨æ€ä»£ç†è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:35:47.000Z" title="Mon Nov 24 2025 02:35:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpringåŠ¨æ€ä»£ç†è¯¦è§£ï¼šä»åŸç†åˆ°å®æˆ˜</h2>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>åŠ¨æ€ä»£ç†æ˜¯Springæ¡†æ¶å®ç°AOPã€äº‹åŠ¡ç®¡ç†ã€å£°æ˜å¼ç¼“å­˜ç­‰æ ¸å¿ƒåŠŸèƒ½çš„åŸºçŸ³ã€‚ç†è§£åŠ¨æ€ä»£ç†çš„åŸç†å’Œä½¿ç”¨æ–¹å¼ï¼Œå¯¹äºæ·±å…¥æŒæ¡Springæ¡†æ¶è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†ä»ä»£ç†æ¨¡å¼çš„åŸºæœ¬æ¦‚å¿µå‡ºå‘ï¼Œè¯¦ç»†è®²è§£JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„å®ç°åŸç†ï¼Œä»¥åŠSpringå¦‚ä½•é€‰æ‹©å’Œä½¿ç”¨è¿™ä¸¤ç§ä»£ç†æ–¹å¼ã€‚</p>
<h3 data-id="heading-2">ä¸€ã€ä»£ç†æ¨¡å¼æ¦‚è¿°</h3>
<h4 data-id="heading-3">1.1 ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</h4>
<p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸ºç›®æ ‡å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">ä»£ç†æ¨¡å¼ç»“æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-built_in">Client</span>ï¼ˆå®¢æˆ·ç«¯ï¼‰                        â”‚
â”‚     â”‚                                    â”‚
â”‚     â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚   Proxy   â”‚ â† ä»£ç†å¯¹è±¡                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚        â”‚                                 â”‚
â”‚   ä»£ç†é€»è¾‘ï¼š                             â”‚
â”‚   - å‰ç½®å¤„ç†ï¼ˆæ—¥å¿—ã€æƒé™ç­‰ï¼‰             â”‚
â”‚   - è°ƒç”¨ç›®æ ‡æ–¹æ³•                         â”‚
â”‚   - åç½®å¤„ç†ï¼ˆç»“æœå¤„ç†ç­‰ï¼‰               â”‚
â”‚        â”‚                                 â”‚
â”‚        â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Target   â”‚ â† ç›®æ ‡å¯¹è±¡                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-4">1.2 é™æ€ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ¥å£
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> {
    User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span>;
}

<span class="hljs-comment">/**
 * ç›®æ ‡ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ·: "</span> + id);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, <span class="hljs-string">"User"</span> + id);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        System.out.println(<span class="hljs-string">"ä¿å­˜ç”¨æˆ·: "</span> + user.getUsername());
    }
}

<span class="hljs-comment">/**
 * é™æ€ä»£ç†ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-keyword">private</span> UserService target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserServiceProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// å‰ç½®å¢å¼º</span>
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•å¼€å§‹: findById"</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> target.findById(id);

        <span class="hljs-comment">// åç½®å¢å¼º</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•ç»“æŸï¼Œè€—æ—¶: "</span> + (endTime - startTime) + <span class="hljs-string">"ms"</span>);

        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•å¼€å§‹: save"</span>);
        target.save(user);
        System.out.println(<span class="hljs-string">"[é™æ€ä»£ç†] æ–¹æ³•ç»“æŸ"</span>);
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨é™æ€ä»£ç†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceProxy</span>(target);

        <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨</span>
        proxy.findById(<span class="hljs-number">1L</span>);
        proxy.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">"å¼ ä¸‰"</span>));
    }
}
</code></pre>
<p><strong>é™æ€ä»£ç†çš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªç›®æ ‡ç±»éƒ½éœ€è¦ä¸€ä¸ªä»£ç†ç±»</li>
<li>æ¥å£å¢åŠ æ–¹æ³•ï¼Œä»£ç†ç±»ä¹Ÿè¦ä¿®æ”¹</li>
<li>ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾</li>
</ul>
<h4 data-id="heading-5">1.3 åŠ¨æ€ä»£ç†</h4>
<p>åŠ¨æ€ä»£ç†åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†ç±»ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ä»£ç†ç±»ä»£ç ã€‚</p>
<pre><code class="hljs">é™æ€ä»£ç† vs åŠ¨æ€ä»£ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é™æ€ä»£ç†            â”‚  åŠ¨æ€ä»£ç†             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¼–è¯‘æ—¶åˆ›å»ºä»£ç†ç±»    â”‚  è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»      â”‚
â”‚  æ‰‹åŠ¨ç¼–å†™ä»£ç†ç±»      â”‚  è‡ªåŠ¨ç”Ÿæˆä»£ç†ç±»        â”‚
â”‚  æ¯ä¸ªç±»ä¸€ä¸ªä»£ç†      â”‚  ä¸€å¥—ä»£ç†é€»è¾‘å¤ç”¨      â”‚
â”‚  ç»´æŠ¤å›°éš¾            â”‚  çµæ´»æ˜“æ‰©å±•           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-6">äºŒã€JDKåŠ¨æ€ä»£ç†</h3>
<h4 data-id="heading-7">2.1 JDKåŠ¨æ€ä»£ç†åŸç†</h4>
<p>JDKåŠ¨æ€ä»£ç†åŸºäºæ¥å£å®ç°ï¼Œé€šè¿‡<code>java.lang.reflect.Proxy</code>ç±»å’Œ<code>InvocationHandler</code>æ¥å£æ¥åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">JDKåŠ¨æ€ä»£ç†åŸç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-number">1</span>. è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼ˆ<span class="hljs-variable">$Proxy0</span>ï¼‰          â”‚
â”‚  <span class="hljs-number">2</span>. ä»£ç†ç±»å®ç°ç›®æ ‡æ¥å£                   â”‚
â”‚  <span class="hljs-number">3</span>. ä»£ç†ç±»æŒæœ‰InvocationHandlerå¼•ç”¨      â”‚
â”‚  <span class="hljs-number">4</span>. è°ƒç”¨ä»£ç†æ–¹æ³•æ—¶ï¼Œè½¬å‘ç»™InvocationHandler
â”‚  <span class="hljs-number">5</span>. InvocationHandlerä¸­è°ƒç”¨ç›®æ ‡æ–¹æ³•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Interface    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
â”‚<span class="hljs-variable">$Proxy0</span>  â”‚      â”‚  Target   â”‚
â”‚(ä»£ç†ç±») â”‚      â”‚ (ç›®æ ‡ç±»)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚InvocationHandlerâ”‚
â”‚ (è°ƒç”¨å¤„ç†å™¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-8">2.2 JDKåŠ¨æ€ä»£ç†å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è‡ªå®šä¹‰InvocationHandler
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogInvocationHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LogInvocationHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// è·å–æ–¹æ³•ä¿¡æ¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> target.getClass().getSimpleName();

        <span class="hljs-comment">// å‰ç½®å¢å¼º</span>
        System.out.println(<span class="hljs-string">"[JDKä»£ç†] "</span> + className + <span class="hljs-string">"."</span> + methodName + <span class="hljs-string">"() å¼€å§‹æ‰§è¡Œ"</span>);
        System.out.println(<span class="hljs-string">"[JDKä»£ç†] å‚æ•°: "</span> + Arrays.toString(args));
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        Object result;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨ç›®æ ‡æ–¹æ³•</span>
            result = method.invoke(target, args);

            <span class="hljs-comment">// åç½®å¢å¼º</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            System.out.println(<span class="hljs-string">"[JDKä»£ç†] è¿”å›å€¼: "</span> + result);
            System.out.println(<span class="hljs-string">"[JDKä»£ç†] æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: "</span> + (endTime - startTime) + <span class="hljs-string">"ms"</span>);

        } <span class="hljs-keyword">catch</span> (InvocationTargetException e) {
            <span class="hljs-comment">// å¼‚å¸¸å¢å¼º</span>
            System.out.println(<span class="hljs-string">"[JDKä»£ç†] æ‰§è¡Œå¼‚å¸¸: "</span> + e.getTargetException().getMessage());
            <span class="hljs-keyword">throw</span> e.getTargetException();
        }

        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">/**
 * JDKåŠ¨æ€ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyFactory</span> {

    <span class="hljs-comment">/**
     * åˆ›å»ºä»£ç†å¯¹è±¡
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),    <span class="hljs-comment">// ç±»åŠ è½½å™¨</span>
            target.getClass().getInterfaces(),     <span class="hljs-comment">// ç›®æ ‡ç±»å®ç°çš„æ¥å£</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogInvocationHandler</span>(target)       <span class="hljs-comment">// è°ƒç”¨å¤„ç†å™¨</span>
        );
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨JDKåŠ¨æ€ä»£ç†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> JdkProxyFactory.createProxy(target);

        <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨</span>
        proxy.findById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"---"</span>);
        proxy.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">null</span>, <span class="hljs-string">"æå››"</span>));

        <span class="hljs-comment">// æ‰“å°ä»£ç†ç±»ä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»å®ç°çš„æ¥å£: "</span> + Arrays.toString(proxy.getClass().getInterfaces()));
    }
}
</code></pre>
<h4 data-id="heading-9">2.3 ç”Ÿæˆçš„ä»£ç†ç±»åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * JDKåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ï¼ˆåç¼–è¯‘ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">$Proxy0</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Proxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m1;  <span class="hljs-comment">// equals</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m2;  <span class="hljs-comment">// toString</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m3;  <span class="hljs-comment">// findById</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m4;  <span class="hljs-comment">// save</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Method m0;  <span class="hljs-comment">// hashCode</span>

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            m3 = Class.forName(<span class="hljs-string">"com.example.UserService"</span>)
                .getMethod(<span class="hljs-string">"findById"</span>, Long.class);
            m4 = Class.forName(<span class="hljs-string">"com.example.UserService"</span>)
                .getMethod(<span class="hljs-string">"save"</span>, User.class);
            <span class="hljs-comment">// ...</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchMethodError</span>(e.getMessage());
        }
    }

    <span class="hljs-keyword">public</span> $Proxy0(InvocationHandler h) {
        <span class="hljs-built_in">super</span>(h);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨InvocationHandlerçš„invokeæ–¹æ³•</span>
            <span class="hljs-keyword">return</span> (User) <span class="hljs-built_in">super</span>.h.invoke(<span class="hljs-built_in">this</span>, m3, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{id});
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(e);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-built_in">super</span>.h.invoke(<span class="hljs-built_in">this</span>, m4, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{user});
        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UndeclaredThrowableException</span>(e);
        }
    }
}
</code></pre>
<h4 data-id="heading-10">2.4 JDKä»£ç†çš„é™åˆ¶</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * JDKåŠ¨æ€ä»£ç†çš„é™åˆ¶
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkProxyLimitation</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>();

        <span class="hljs-comment">// ä»¥ä¸‹ä»£ç ä¼šæŠ›å‡ºå¼‚å¸¸</span>
        <span class="hljs-comment">// OrderService proxy = JdkProxyFactory.createProxy(orderService);</span>
        <span class="hljs-comment">// å› ä¸ºOrderServiceæ²¡æœ‰å®ç°ä»»ä½•æ¥å£</span>

        System.out.println(<span class="hljs-string">"JDKåŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£"</span>);
    }
}

<span class="hljs-comment">/**
 * æ²¡æœ‰å®ç°æ¥å£çš„ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºè®¢å•"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">ä¸‰ã€CGLIBåŠ¨æ€ä»£ç†</h3>
<h4 data-id="heading-12">3.1 CGLIBä»£ç†åŸç†</h4>
<p>CGLIBï¼ˆCode Generation Libraryï¼‰é€šè¿‡ç»§æ‰¿ç›®æ ‡ç±»çš„æ–¹å¼åˆ›å»ºä»£ç†ï¼Œä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚</p>
<pre><code class="hljs language-php" lang="php">CGLIBä»£ç†åŸç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-number">1</span>. è¿è¡Œæ—¶ç”Ÿæˆä»£ç†ç±»ï¼ˆç»§æ‰¿ç›®æ ‡ç±»ï¼‰       â”‚
â”‚  <span class="hljs-number">2</span>. é€šè¿‡ASMå­—èŠ‚ç æ“ä½œç”Ÿæˆå­ç±»           â”‚
â”‚  <span class="hljs-number">3</span>. ä»£ç†ç±»é‡å†™çˆ¶ç±»çš„é<span class="hljs-keyword">final</span>æ–¹æ³•          â”‚
â”‚  <span class="hljs-number">4</span>. æ–¹æ³•è°ƒç”¨æ—¶ï¼Œé€šè¿‡MethodInterceptoræ‹¦æˆªâ”‚
â”‚  <span class="hljs-number">5</span>. MethodInterceptorä¸­è°ƒç”¨çˆ¶ç±»æ–¹æ³•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Target       â”‚
â”‚  (ç›®æ ‡ç±»)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ <span class="hljs-keyword">extends</span>
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Target<span class="hljs-variable">$$CGLIB</span> â”‚
â”‚  (ä»£ç†ç±»)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚MethodInterceptorâ”‚
â”‚  (æ–¹æ³•æ‹¦æˆªå™¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-13">3.2 CGLIBä»£ç†å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è‡ªå®šä¹‰MethodInterceptor
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogMethodInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> obj       ä»£ç†å¯¹è±¡
     * <span class="hljs-doctag">@param</span> method    ç›®æ ‡æ–¹æ³•
     * <span class="hljs-doctag">@param</span> args      æ–¹æ³•å‚æ•°
     * <span class="hljs-doctag">@param</span> proxy     æ–¹æ³•ä»£ç†
     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {

        <span class="hljs-comment">// è·å–æ–¹æ³•ä¿¡æ¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> method.getDeclaringClass().getSimpleName();

        <span class="hljs-comment">// å‰ç½®å¢å¼º</span>
        System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] "</span> + className + <span class="hljs-string">"."</span> + methodName + <span class="hljs-string">"() å¼€å§‹æ‰§è¡Œ"</span>);
        System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] å‚æ•°: "</span> + Arrays.toString(args));
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        Object result;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼ˆç›®æ ‡æ–¹æ³•ï¼‰</span>
            result = proxy.invokeSuper(obj, args);

            <span class="hljs-comment">// åç½®å¢å¼º</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] è¿”å›å€¼: "</span> + result);
            System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] æ‰§è¡ŒæˆåŠŸï¼Œè€—æ—¶: "</span> + (endTime - startTime) + <span class="hljs-string">"ms"</span>);

        } <span class="hljs-keyword">catch</span> (Throwable e) {
            <span class="hljs-comment">// å¼‚å¸¸å¢å¼º</span>
            System.out.println(<span class="hljs-string">"[CGLIBä»£ç†] æ‰§è¡Œå¼‚å¸¸: "</span> + e.getMessage());
            <span class="hljs-keyword">throw</span> e;
        }

        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">/**
 * CGLIBä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyFactory</span> {

    <span class="hljs-comment">/**
     * åˆ›å»ºä»£ç†å¯¹è±¡
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Class&lt;T&gt; targetClass)</span> {
        <span class="hljs-comment">// åˆ›å»ºEnhancerå¯¹è±¡</span>
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();

        <span class="hljs-comment">// è®¾ç½®çˆ¶ç±»ï¼ˆç›®æ ‡ç±»ï¼‰</span>
        enhancer.setSuperclass(targetClass);

        <span class="hljs-comment">// è®¾ç½®å›è°ƒï¼ˆæ–¹æ³•æ‹¦æˆªå™¨ï¼‰</span>
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>());

        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="hljs-keyword">return</span> (T) enhancer.create();
    }

    <span class="hljs-comment">/**
     * å¸¦æ„é€ å‚æ•°åˆ›å»ºä»£ç†å¯¹è±¡
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(Class&lt;T&gt; targetClass,
                                    Class&lt;?&gt;[] argTypes, Object[] args)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(targetClass);
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>());

        <span class="hljs-keyword">return</span> (T) enhancer.create(argTypes, args);
    }
}

<span class="hljs-comment">/**
 * ç›®æ ‡ç±»ï¼ˆæ²¡æœ‰å®ç°æ¥å£ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, BigDecimal amount)</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºè®¢å•: ç”¨æˆ·="</span> + userId + <span class="hljs-string">", é‡‘é¢="</span> + amount);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(System.currentTimeMillis(), userId, amount);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(Long orderId)</span> {
        System.out.println(<span class="hljs-string">"å–æ¶ˆè®¢å•: "</span> + orderId);
    }

    <span class="hljs-comment">// finalæ–¹æ³•ä¸èƒ½è¢«ä»£ç†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"è¿™æ˜¯finalæ–¹æ³•ï¼Œä¸èƒ½è¢«ä»£ç†"</span>);
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨CGLIBä»£ç†
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆæ— éœ€ç›®æ ‡å¯¹è±¡å®ä¾‹ï¼‰</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> CglibProxyFactory.createProxy(OrderService.class);

        <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨</span>
        proxy.createOrder(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"99.99"</span>));
        System.out.println(<span class="hljs-string">"---"</span>);
        proxy.cancelOrder(<span class="hljs-number">1001L</span>);
        System.out.println(<span class="hljs-string">"---"</span>);

        <span class="hljs-comment">// finalæ–¹æ³•ä¸ä¼šè¢«ä»£ç†</span>
        proxy.finalMethod();

        <span class="hljs-comment">// æ‰“å°ä»£ç†ç±»ä¿¡æ¯</span>
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());
        System.out.println(<span class="hljs-string">"çˆ¶ç±»: "</span> + proxy.getClass().getSuperclass().getName());
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 CGLIBçš„é«˜çº§ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å¤šä¸ªå›è°ƒï¼ˆCallbackFilterï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiCallbackDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(OrderService.class);

        <span class="hljs-comment">// å®šä¹‰å¤šä¸ªå›è°ƒ</span>
        Callback[] callbacks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>[]{
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogMethodInterceptor</span>(),           <span class="hljs-comment">// ç´¢å¼•0ï¼šæ—¥å¿—æ‹¦æˆªå™¨</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceMethodInterceptor</span>(),   <span class="hljs-comment">// ç´¢å¼•1ï¼šæ€§èƒ½æ‹¦æˆªå™¨</span>
            NoOp.INSTANCE                         <span class="hljs-comment">// ç´¢å¼•2ï¼šä¸åšä»»ä½•æ“ä½œ</span>
        };

        enhancer.setCallbacks(callbacks);

        <span class="hljs-comment">// å›è°ƒè¿‡æ»¤å™¨ï¼šå†³å®šæ¯ä¸ªæ–¹æ³•ä½¿ç”¨å“ªä¸ªå›è°ƒ</span>
        enhancer.setCallbackFilter(method -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();

            <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"create"</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// ä½¿ç”¨æ—¥å¿—æ‹¦æˆªå™¨</span>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (methodName.startsWith(<span class="hljs-string">"find"</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">// ä½¿ç”¨æ€§èƒ½æ‹¦æˆªå™¨</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;  <span class="hljs-comment">// ä¸æ‹¦æˆª</span>
            }
        });

        <span class="hljs-type">OrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (OrderService) enhancer.create();
        proxy.createOrder(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>));
    }
}

<span class="hljs-comment">/**
 * æ€§èƒ½ç›‘æ§æ‹¦æˆªå™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMethodInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.invokeSuper(obj, args);

        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
        System.out.println(<span class="hljs-string">"[æ€§èƒ½ç›‘æ§] "</span> + method.getName() + <span class="hljs-string">" è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);

        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-comment">/**
 * å»¶è¿ŸåŠ è½½ï¼ˆLazyLoaderï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyLoadDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(HeavyObject.class);

        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½å›è°ƒ</span>
        enhancer.setCallback((LazyLoader) () -&gt; {
            System.out.println(<span class="hljs-string">"å¼€å§‹åˆ›å»ºHeavyObject..."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HeavyObject</span>();
        });

        <span class="hljs-type">HeavyObject</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (HeavyObject) enhancer.create();
        System.out.println(<span class="hljs-string">"ä»£ç†å¯¹è±¡å·²åˆ›å»ºï¼Œä½†ç›®æ ‡å¯¹è±¡å°šæœªåˆ›å»º"</span>);

        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        proxy.doSomething();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HeavyObject</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HeavyObject</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶åˆå§‹åŒ–</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">1000</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doSomething</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"HeavyObject.doSomething()"</span>);
    }
}
</code></pre>
<h4 data-id="heading-15">3.4 CGLIBçš„é™åˆ¶</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * CGLIBä»£ç†çš„é™åˆ¶
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibLimitation</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// âŒ é™åˆ¶1ï¼šä¸èƒ½ä»£ç†finalç±»</span>
        <span class="hljs-comment">// FinalClass proxy = CglibProxyFactory.createProxy(FinalClass.class);</span>
        <span class="hljs-comment">// ä¼šæŠ›å‡ºå¼‚å¸¸ï¼šCannot subclass final class</span>

        <span class="hljs-comment">// âŒ é™åˆ¶2ï¼šä¸èƒ½ä»£ç†finalæ–¹æ³•</span>
        <span class="hljs-comment">// finalæ–¹æ³•ä¸ä¼šè¢«æ‹¦æˆªï¼Œç›´æ¥è°ƒç”¨åŸæ–¹æ³•</span>

        <span class="hljs-comment">// âŒ é™åˆ¶3ï¼šä¸èƒ½ä»£ç†privateæ–¹æ³•</span>
        <span class="hljs-comment">// privateæ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿ï¼Œæ— æ³•ä»£ç†</span>
    }
}

<span class="hljs-comment">// finalç±»ä¸èƒ½è¢«CGLIBä»£ç†</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FinalClass</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"finalç±»çš„æ–¹æ³•"</span>);
    }
}
</code></pre>
<h3 data-id="heading-16">å››ã€Springä¸­çš„ä»£ç†é€‰æ‹©</h3>
<h4 data-id="heading-17">4.1 Springä»£ç†é€‰æ‹©ç­–ç•¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Springä»£ç†é€‰æ‹©ç­–ç•¥
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAspectJAutoProxy</span>  <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨JDKä»£ç†</span>
<span class="hljs-comment">// @EnableAspectJAutoProxy(proxyTargetClass = true)  // å¼ºåˆ¶ä½¿ç”¨CGLIB</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyConfig</span> {
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">Springä»£ç†é€‰æ‹©æµç¨‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›®æ ‡ç±»æ˜¯å¦å®ç°æ¥å£ï¼Ÿ                    â”‚
â”‚         â”‚                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                          â”‚
â”‚    â”‚         â”‚                          â”‚
â”‚   æ˜¯         å¦                          â”‚
â”‚    â”‚         â”‚                          â”‚
â”‚    â–¼         â–¼                          â”‚
â”‚  JDKä»£ç†   CGLIBä»£ç†                     â”‚
â”‚  (é»˜è®¤)    (è‡ªåŠ¨)                        â”‚
â”‚                                          â”‚
â”‚  <span class="hljs-attr">proxyTargetClass</span> = <span class="hljs-literal">true</span> ?              â”‚
â”‚    â†’ å¼ºåˆ¶ä½¿ç”¨CGLIBä»£ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-18">4.2 AopProxyFactoryæºç åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Spring AOPä»£ç†å·¥å‚ï¼ˆç®€åŒ–ç‰ˆï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultAopProxyFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AopProxyFactory</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> AopProxy <span class="hljs-title function_">createAopProxy</span><span class="hljs-params">(AdvisedSupport config)</span> {
        <span class="hljs-comment">// åˆ¤æ–­ä½¿ç”¨å“ªç§ä»£ç†</span>
        <span class="hljs-keyword">if</span> (config.isOptimize() ||                    <span class="hljs-comment">// ä¼˜åŒ–æ¨¡å¼</span>
            config.isProxyTargetClass() ||           <span class="hljs-comment">// å¼ºåˆ¶CGLIB</span>
            hasNoUserSuppliedProxyInterfaces(config)) { <span class="hljs-comment">// æ²¡æœ‰æ¥å£</span>

            Class&lt;?&gt; targetClass = config.getTargetClass();

            <span class="hljs-keyword">if</span> (targetClass == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AopConfigException</span>(<span class="hljs-string">"..."</span>);
            }

            <span class="hljs-comment">// å¦‚æœæ˜¯æ¥å£æˆ–å·²ç»æ˜¯ä»£ç†ç±»ï¼Œä½¿ç”¨JDKä»£ç†</span>
            <span class="hljs-keyword">if</span> (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkDynamicAopProxy</span>(config);
            }

            <span class="hljs-comment">// å¦åˆ™ä½¿ç”¨CGLIBä»£ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjenesisCglibAopProxy</span>(config);

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// é»˜è®¤ä½¿ç”¨JDKä»£ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdkDynamicAopProxy</span>(config);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNoUserSuppliedProxyInterfaces</span><span class="hljs-params">(AdvisedSupport config)</span> {
        Class&lt;?&gt;[] interfaces = config.getProxiedInterfaces();
        <span class="hljs-keyword">return</span> interfaces.length == <span class="hljs-number">0</span> ||
               (interfaces.length == <span class="hljs-number">1</span> &amp;&amp; SpringProxy.class.isAssignableFrom(interfaces[<span class="hljs-number">0</span>]));
    }
}
</code></pre>
<h4 data-id="heading-19">4.3 é…ç½®ä»£ç†æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * XMLé…ç½®æ–¹å¼
 */</span>
<span class="hljs-comment">/*
&lt;aop:aspectj-autoproxy proxy-target-class="true"/&gt;
*/</span>

<span class="hljs-comment">/**
 * æ³¨è§£é…ç½®æ–¹å¼
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AopConfig</span> {
}

<span class="hljs-comment">/**
 * application.propertiesé…ç½®
 */</span>
<span class="hljs-comment">// spring.aop.proxy-target-class=true</span>

<span class="hljs-comment">/**
 * äº‹åŠ¡é…ç½®ä¸­æŒ‡å®šä»£ç†æ–¹å¼
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement(proxyTargetClass = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionConfig</span> {
}
</code></pre>
<h3 data-id="heading-20">äº”ã€å®æˆ˜æ¡ˆä¾‹</h3>
<h4 data-id="heading-21">5.1 æ¡ˆä¾‹1ï¼šé€šç”¨æ—¥å¿—ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é€šç”¨æ—¥å¿—ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalLogProxyFactory</span> {

    <span class="hljs-comment">/**
     * åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆè‡ªåŠ¨é€‰æ‹©ä»£ç†æ–¹å¼ï¼‰
     */</span>
    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        Class&lt;?&gt; targetClass = target.getClass();

        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰æ¥å£</span>
        <span class="hljs-keyword">if</span> (targetClass.getInterfaces().length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// ä½¿ç”¨JDKä»£ç†</span>
            <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
                targetClass.getClassLoader(),
                targetClass.getInterfaces(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">UniversalLogHandler</span>(target)
            );
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// ä½¿ç”¨CGLIBä»£ç†</span>
            <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
            enhancer.setSuperclass(targetClass);
            enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UniversalLogInterceptor</span>(target));
            <span class="hljs-keyword">return</span> (T) enhancer.create();
        }
    }
}

<span class="hljs-comment">/**
 * JDKä»£ç†å¤„ç†å™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalLogHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UniversalLogHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> LogHelper.logAndInvoke(target, method, args, () -&gt; method.invoke(target, args));
    }
}

<span class="hljs-comment">/**
 * CGLIBæ–¹æ³•æ‹¦æˆªå™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalLogInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UniversalLogInterceptor</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> LogHelper.logAndInvoke(target, method, args, () -&gt; proxy.invokeSuper(obj, args));
    }
}

<span class="hljs-comment">/**
 * æ—¥å¿—è¾…åŠ©ç±»
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LogHelper</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">logAndInvoke</span><span class="hljs-params">(Object target, Method method, Object[] args,
                                     Callable&lt;Object&gt; invoker)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> target.getClass().getSimpleName();
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> method.getName();

        System.out.println(<span class="hljs-string">"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>);
        System.out.println(<span class="hljs-string">"â”‚ æ–¹æ³•è°ƒç”¨: "</span> + className + <span class="hljs-string">"."</span> + methodName);
        System.out.println(<span class="hljs-string">"â”‚ å‚æ•°: "</span> + Arrays.toString(args));

        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> invoker.call();

            <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
            System.out.println(<span class="hljs-string">"â”‚ è¿”å›å€¼: "</span> + result);
            System.out.println(<span class="hljs-string">"â”‚ è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
            System.out.println(<span class="hljs-string">"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>);

            <span class="hljs-keyword">return</span> result;

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"â”‚ å¼‚å¸¸: "</span> + e.getMessage());
            System.out.println(<span class="hljs-string">"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>);
            <span class="hljs-keyword">throw</span> e;
        }
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UniversalProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æœ‰æ¥å£çš„ç±» - ä½¿ç”¨JDKä»£ç†</span>
        <span class="hljs-type">UserService</span> <span class="hljs-variable">userProxy</span> <span class="hljs-operator">=</span> UniversalLogProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>());
        userProxy.findById(<span class="hljs-number">1L</span>);

        System.out.println();

        <span class="hljs-comment">// æ— æ¥å£çš„ç±» - ä½¿ç”¨CGLIBä»£ç†</span>
        <span class="hljs-type">OrderService</span> <span class="hljs-variable">orderProxy</span> <span class="hljs-operator">=</span> UniversalLogProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderService</span>());
        orderProxy.createOrder(<span class="hljs-number">1L</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100"</span>));
    }
}
</code></pre>
<h4 data-id="heading-22">5.2 æ¡ˆä¾‹2ï¼šæ–¹æ³•æ‰§è¡Œé‡è¯•ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é‡è¯•æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Retryable {
    <span class="hljs-type">int</span> <span class="hljs-title function_">maxAttempts</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">3</span>;           <span class="hljs-comment">// æœ€å¤§é‡è¯•æ¬¡æ•°</span>
    <span class="hljs-type">long</span> <span class="hljs-title function_">delay</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">1000</span>;             <span class="hljs-comment">// é‡è¯•é—´éš”ï¼ˆæ¯«ç§’ï¼‰</span>
    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt;[] value() <span class="hljs-keyword">default</span> {};  <span class="hljs-comment">// éœ€è¦é‡è¯•çš„å¼‚å¸¸</span>
}

<span class="hljs-comment">/**
 * é‡è¯•ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryProxyFactory</span> {

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        Class&lt;?&gt; targetClass = target.getClass();

        <span class="hljs-keyword">if</span> (targetClass.getInterfaces().length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> (T) Proxy.newProxyInstance(
                targetClass.getClassLoader(),
                targetClass.getInterfaces(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryHandler</span>(target)
            );
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
            enhancer.setSuperclass(targetClass);
            enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RetryInterceptor</span>(target));
            <span class="hljs-keyword">return</span> (T) enhancer.create();
        }
    }
}

<span class="hljs-comment">/**
 * JDKé‡è¯•å¤„ç†å™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RetryHandler</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> RetryExecutor.executeWithRetry(target, method, args,
            () -&gt; method.invoke(target, args));
    }
}

<span class="hljs-comment">/**
 * CGLIBé‡è¯•æ‹¦æˆªå™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

    <span class="hljs-keyword">private</span> Object target;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RetryInterceptor</span><span class="hljs-params">(Object target)</span> {
        <span class="hljs-built_in">this</span>.target = target;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                           MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> RetryExecutor.executeWithRetry(target, method, args,
            () -&gt; proxy.invokeSuper(obj, args));
    }
}

<span class="hljs-comment">/**
 * é‡è¯•æ‰§è¡Œå™¨
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryExecutor</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">executeWithRetry</span><span class="hljs-params">(Object target, Method method, Object[] args,
                                         Callable&lt;Object&gt; invoker)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// è·å–æ–¹æ³•ä¸Šçš„@Retryableæ³¨è§£</span>
        <span class="hljs-type">Method</span> <span class="hljs-variable">targetMethod</span> <span class="hljs-operator">=</span> target.getClass().getMethod(method.getName(), method.getParameterTypes());
        <span class="hljs-type">Retryable</span> <span class="hljs-variable">retryable</span> <span class="hljs-operator">=</span> targetMethod.getAnnotation(Retryable.class);

        <span class="hljs-keyword">if</span> (retryable == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ²¡æœ‰æ³¨è§£ï¼Œç›´æ¥æ‰§è¡Œ</span>
            <span class="hljs-keyword">return</span> invoker.call();
        }

        <span class="hljs-type">int</span> <span class="hljs-variable">maxAttempts</span> <span class="hljs-operator">=</span> retryable.maxAttempts();
        <span class="hljs-type">long</span> <span class="hljs-variable">delay</span> <span class="hljs-operator">=</span> retryable.delay();
        Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Throwable</span>&gt;[] retryExceptions = retryable.value();

        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">Throwable</span> <span class="hljs-variable">lastException</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (attempt &lt; maxAttempts) {
            attempt++;
            <span class="hljs-keyword">try</span> {
                System.out.println(<span class="hljs-string">"[é‡è¯•ä»£ç†] ç¬¬"</span> + attempt + <span class="hljs-string">"æ¬¡å°è¯•æ‰§è¡Œ: "</span> + method.getName());
                <span class="hljs-keyword">return</span> invoker.call();

            } <span class="hljs-keyword">catch</span> (Throwable e) {
                <span class="hljs-type">Throwable</span> <span class="hljs-variable">cause</span> <span class="hljs-operator">=</span> e <span class="hljs-keyword">instanceof</span> InvocationTargetException
                    ? ((InvocationTargetException) e).getTargetException() : e;

                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦éœ€è¦é‡è¯•</span>
                <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldRetry</span> <span class="hljs-operator">=</span> retryExceptions.length == <span class="hljs-number">0</span> ||
                    Arrays.stream(retryExceptions).anyMatch(ex -&gt; ex.isInstance(cause));

                <span class="hljs-keyword">if</span> (!shouldRetry || attempt &gt;= maxAttempts) {
                    System.out.println(<span class="hljs-string">"[é‡è¯•ä»£ç†] é‡è¯•å¤±è´¥: "</span> + cause.getMessage());
                    <span class="hljs-keyword">throw</span> cause;
                }

                lastException = cause;
                System.out.println(<span class="hljs-string">"[é‡è¯•ä»£ç†] æ‰§è¡Œå¤±è´¥ï¼Œ"</span> + delay + <span class="hljs-string">"msåé‡è¯•: "</span> + cause.getMessage());

                <span class="hljs-keyword">try</span> {
                    Thread.sleep(delay);
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">throw</span> cause;
                }
            }
        }

        <span class="hljs-keyword">throw</span> lastException;
    }
}

<span class="hljs-comment">/**
 * è¿œç¨‹æœåŠ¡ï¼ˆæ¼”ç¤ºé‡è¯•ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">callCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-meta">@Retryable(maxAttempts = 3, delay = 500)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callRemoteApi</span><span class="hljs-params">(String param)</span> {
        callCount++;
        System.out.println(<span class="hljs-string">"è°ƒç”¨è¿œç¨‹APIï¼Œç¬¬"</span> + callCount + <span class="hljs-string">"æ¬¡"</span>);

        <span class="hljs-comment">// æ¨¡æ‹Ÿå¶å‘å¤±è´¥</span>
        <span class="hljs-keyword">if</span> (callCount &lt; <span class="hljs-number">3</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"ç½‘ç»œè¶…æ—¶"</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-string">"è°ƒç”¨æˆåŠŸ: "</span> + param;
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">RemoteService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> RetryProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteService</span>());

        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.callRemoteApi(<span class="hljs-string">"test"</span>);
        System.out.println(<span class="hljs-string">"æœ€ç»ˆç»“æœ: "</span> + result);
    }
}
</code></pre>
<h4 data-id="heading-23">5.3 æ¡ˆä¾‹3ï¼šç¼“å­˜ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç¼“å­˜æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Cacheable {
    String <span class="hljs-title function_">key</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;
    <span class="hljs-type">int</span> <span class="hljs-title function_">expire</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">3600</span>;  <span class="hljs-comment">// è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span>
}

<span class="hljs-comment">/**
 * ç¼“å­˜ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheProxyFactory</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, CacheEntry&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheInterceptor</span>(target));
        <span class="hljs-keyword">return</span> (T) enhancer.create();
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span> {
        Object value;
        <span class="hljs-type">long</span> expireTime;

        CacheEntry(Object value, <span class="hljs-type">int</span> expireSeconds) {
            <span class="hljs-built_in">this</span>.value = value;
            <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + expireSeconds * <span class="hljs-number">1000L</span>;
        }

        <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpired</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> System.currentTimeMillis() &gt; expireTime;
        }
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

        <span class="hljs-keyword">private</span> Object target;

        CacheInterceptor(Object target) {
            <span class="hljs-built_in">this</span>.target = target;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                               MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {

            <span class="hljs-comment">// è·å–@Cacheableæ³¨è§£</span>
            <span class="hljs-type">Method</span> <span class="hljs-variable">targetMethod</span> <span class="hljs-operator">=</span> target.getClass().getMethod(
                method.getName(), method.getParameterTypes());
            <span class="hljs-type">Cacheable</span> <span class="hljs-variable">cacheable</span> <span class="hljs-operator">=</span> targetMethod.getAnnotation(Cacheable.class);

            <span class="hljs-keyword">if</span> (cacheable == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> proxy.invokeSuper(obj, args);
            }

            <span class="hljs-comment">// æ„å»ºç¼“å­˜key</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">cacheKey</span> <span class="hljs-operator">=</span> buildCacheKey(cacheable.key(), method, args);

            <span class="hljs-comment">// å°è¯•ä»ç¼“å­˜è·å–</span>
            <span class="hljs-type">CacheEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> cache.get(cacheKey);
            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; !entry.isExpired()) {
                System.out.println(<span class="hljs-string">"[ç¼“å­˜ä»£ç†] ç¼“å­˜å‘½ä¸­: "</span> + cacheKey);
                <span class="hljs-keyword">return</span> entry.value;
            }

            <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡Œæ–¹æ³•</span>
            System.out.println(<span class="hljs-string">"[ç¼“å­˜ä»£ç†] ç¼“å­˜æœªå‘½ä¸­: "</span> + cacheKey);
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> proxy.invokeSuper(obj, args);

            <span class="hljs-comment">// å­˜å…¥ç¼“å­˜</span>
            <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) {
                cache.put(cacheKey, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntry</span>(result, cacheable.expire()));
                System.out.println(<span class="hljs-string">"[ç¼“å­˜ä»£ç†] ç¼“å­˜å†™å…¥: "</span> + cacheKey);
            }

            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">private</span> String <span class="hljs-title function_">buildCacheKey</span><span class="hljs-params">(String keyPattern, Method method, Object[] args)</span> {
            <span class="hljs-keyword">if</span> (keyPattern.isEmpty()) {
                <span class="hljs-comment">// é»˜è®¤keyï¼šç±»å.æ–¹æ³•å(å‚æ•°)</span>
                <span class="hljs-keyword">return</span> method.getDeclaringClass().getSimpleName() + <span class="hljs-string">"."</span> +
                       method.getName() + <span class="hljs-string">"("</span> + Arrays.toString(args) + <span class="hljs-string">")"</span>;
            }

            <span class="hljs-comment">// æ›¿æ¢å‚æ•°å ä½ç¬¦</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPattern;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; args.length; i++) {
                key = key.replace(<span class="hljs-string">"#p"</span> + i, String.valueOf(args[i]));
            }
            <span class="hljs-keyword">return</span> key;
        }
    }
}

<span class="hljs-comment">/**
 * ç”¨æˆ·æœåŠ¡ï¼ˆå¸¦ç¼“å­˜ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CachedUserService</span> {

    <span class="hljs-meta">@Cacheable(key = "user:#p0", expire = 60)</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·: "</span> + id);
        <span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">100</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, <span class="hljs-string">"User"</span> + id);
    }

    <span class="hljs-meta">@Cacheable(expire = 300)</span>
    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"ä»æ•°æ®åº“æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·"</span>);
        <span class="hljs-keyword">return</span> Arrays.asList(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">1L</span>, <span class="hljs-string">"User1"</span>),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-number">2L</span>, <span class="hljs-string">"User2"</span>)
        );
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">CachedUserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> CacheProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CachedUserService</span>());

        <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œç¼“å­˜æœªå‘½ä¸­</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> proxy.findById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + user1);

        System.out.println();

        <span class="hljs-comment">// ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œç¼“å­˜å‘½ä¸­</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> proxy.findById(<span class="hljs-number">1L</span>);
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + user2);

        System.out.println();

        <span class="hljs-comment">// ä¸åŒå‚æ•°ï¼Œç¼“å­˜æœªå‘½ä¸­</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user3</span> <span class="hljs-operator">=</span> proxy.findById(<span class="hljs-number">2L</span>);
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç»“æœ: "</span> + user3);
    }
}
</code></pre>
<h4 data-id="heading-24">5.4 æ¡ˆä¾‹4ï¼šæƒé™æ ¡éªŒä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æƒé™æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> RequiresPermission {
    String[] value();
}

<span class="hljs-comment">/**
 * ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆæ¨¡æ‹Ÿï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserContext</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Set&lt;String&gt;&gt; permissions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPermissions</span><span class="hljs-params">(Set&lt;String&gt; perms)</span> {
        permissions.set(perms);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Set&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> permissions.get();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String permission)</span> {
        Set&lt;String&gt; perms = permissions.get();
        <span class="hljs-keyword">return</span> perms != <span class="hljs-literal">null</span> &amp;&amp; perms.contains(permission);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        permissions.remove();
    }
}

<span class="hljs-comment">/**
 * æƒé™ä»£ç†å·¥å‚
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionProxyFactory</span> {

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T <span class="hljs-title function_">createProxy</span><span class="hljs-params">(T target)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PermissionInterceptor</span>(target));
        <span class="hljs-keyword">return</span> (T) enhancer.create();
    }

    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> {

        <span class="hljs-keyword">private</span> Object target;

        PermissionInterceptor(Object target) {
            <span class="hljs-built_in">this</span>.target = target;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args,
                               MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable {

            <span class="hljs-comment">// è·å–@RequiresPermissionæ³¨è§£</span>
            <span class="hljs-type">Method</span> <span class="hljs-variable">targetMethod</span> <span class="hljs-operator">=</span> target.getClass().getMethod(
                method.getName(), method.getParameterTypes());
            <span class="hljs-type">RequiresPermission</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> targetMethod.getAnnotation(RequiresPermission.class);

            <span class="hljs-keyword">if</span> (annotation != <span class="hljs-literal">null</span>) {
                String[] required = annotation.value();

                <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
                <span class="hljs-keyword">for</span> (String permission : required) {
                    <span class="hljs-keyword">if</span> (!UserContext.hasPermission(permission)) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityException</span>(<span class="hljs-string">"ç¼ºå°‘æƒé™: "</span> + permission);
                    }
                }

                System.out.println(<span class="hljs-string">"[æƒé™ä»£ç†] æƒé™æ ¡éªŒé€šè¿‡: "</span> + Arrays.toString(required));
            }

            <span class="hljs-keyword">return</span> proxy.invokeSuper(obj, args);
        }
    }
}

<span class="hljs-comment">/**
 * ç®¡ç†æœåŠ¡
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminService</span> {

    <span class="hljs-meta">@RequiresPermission("user:delete")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(Long userId)</span> {
        System.out.println(<span class="hljs-string">"åˆ é™¤ç”¨æˆ·: "</span> + userId);
    }

    <span class="hljs-meta">@RequiresPermission({"user:create", "user:update"})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrUpdateUser</span><span class="hljs-params">(User user)</span> {
        System.out.println(<span class="hljs-string">"åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·: "</span> + user.getUsername());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryUser</span><span class="hljs-params">(Long userId)</span> {
        System.out.println(<span class="hljs-string">"æŸ¥è¯¢ç”¨æˆ·: "</span> + userId);
    }
}

<span class="hljs-comment">/**
 * ä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionProxyDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">AdminService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> PermissionProxyFactory.createProxy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AdminService</span>());

        <span class="hljs-comment">// è®¾ç½®ç”¨æˆ·æƒé™</span>
        UserContext.setPermissions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="hljs-string">"user:query"</span>, <span class="hljs-string">"user:create"</span>)));

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ— éœ€æƒé™çš„æ–¹æ³•</span>
            proxy.queryUser(<span class="hljs-number">1L</span>);
            System.out.println();

            <span class="hljs-comment">// æƒé™ä¸è¶³</span>
            proxy.deleteUser(<span class="hljs-number">1L</span>);

        } <span class="hljs-keyword">catch</span> (SecurityException e) {
            System.out.println(<span class="hljs-string">"æƒé™æ ¡éªŒå¤±è´¥: "</span> + e.getMessage());
        }

        System.out.println();

        <span class="hljs-comment">// æ·»åŠ æƒé™åé‡è¯•</span>
        UserContext.setPermissions(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="hljs-string">"user:delete"</span>)));
        proxy.deleteUser(<span class="hljs-number">1L</span>);

        UserContext.clear();
    }
}
</code></pre>
<h3 data-id="heading-25">å…­ã€æ€§èƒ½å¯¹æ¯”</h3>
<h4 data-id="heading-26">6.1 JDKä»£ç† vs CGLIBæ€§èƒ½æµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ€§èƒ½æµ‹è¯•
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyPerformanceTest</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">ITERATIONS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000000</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// é¢„çƒ­</span>
        warmup();

        <span class="hljs-comment">// æµ‹è¯•ç›´æ¥è°ƒç”¨</span>
        testDirectCall();

        <span class="hljs-comment">// æµ‹è¯•JDKä»£ç†</span>
        testJdkProxy();

        <span class="hljs-comment">// æµ‹è¯•CGLIBä»£ç†</span>
        testCglibProxy();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">warmup</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">jdkProxy</span> <span class="hljs-operator">=</span> createJdkProxy(target);
        <span class="hljs-type">UserService</span> <span class="hljs-variable">cglibProxy</span> <span class="hljs-operator">=</span> createCglibProxy(target);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
            target.findById(<span class="hljs-number">1L</span>);
            jdkProxy.findById(<span class="hljs-number">1L</span>);
            cglibProxy.findById(<span class="hljs-number">1L</span>);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDirectCall</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();

        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ITERATIONS; i++) {
            target.findById(<span class="hljs-number">1L</span>);
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;

        System.out.println(<span class="hljs-string">"ç›´æ¥è°ƒç”¨è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testJdkProxy</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createJdkProxy(target);

        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ITERATIONS; i++) {
            proxy.findById(<span class="hljs-number">1L</span>);
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;

        System.out.println(<span class="hljs-string">"JDKä»£ç†è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCglibProxy</span><span class="hljs-params">()</span> {
        <span class="hljs-type">UserService</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        <span class="hljs-type">UserService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createCglibProxy(target);

        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; ITERATIONS; i++) {
            proxy.findById(<span class="hljs-number">1L</span>);
        }
        <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - start;

        System.out.println(<span class="hljs-string">"CGLIBä»£ç†è€—æ—¶: "</span> + duration + <span class="hljs-string">"ms"</span>);
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title function_">createJdkProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-keyword">return</span> (UserService) Proxy.newProxyInstance(
            target.getClass().getClassLoader(),
            target.getClass().getInterfaces(),
            (proxy, method, args) -&gt; method.invoke(target, args)
        );
    }

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title function_">createCglibProxy</span><span class="hljs-params">(UserService target)</span> {
        <span class="hljs-type">Enhancer</span> <span class="hljs-variable">enhancer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        enhancer.setSuperclass(target.getClass());
        enhancer.setCallback((MethodInterceptor) (obj, method, args, proxy) -&gt;
            proxy.invokeSuper(obj, args));
        <span class="hljs-keyword">return</span> (UserService) enhancer.create();
    }
}
</code></pre>
<h4 data-id="heading-27">6.2 æ€§èƒ½å¯¹æ¯”ç»“æœ</h4>
<pre><code class="hljs language-markdown" lang="markdown">å…¸å‹æµ‹è¯•ç»“æœï¼ˆ100ä¸‡æ¬¡è°ƒç”¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è°ƒç”¨æ–¹å¼     â”‚  è€—æ—¶     â”‚  è¯´æ˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›´æ¥è°ƒç”¨     â”‚  ~50ms   â”‚  åŸºå‡†    â”‚
â”‚  JDKä»£ç†      â”‚  ~150ms  â”‚  çº¦3å€   â”‚
â”‚  CGLIBä»£ç†    â”‚  ~120ms  â”‚  çº¦2.4å€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯´æ˜ï¼š
<span class="hljs-bullet">1.</span> ç°ä»£JVMå¯¹JDKä»£ç†æœ‰ä¼˜åŒ–
<span class="hljs-bullet">2.</span> CGLIBåœ¨æ–¹æ³•è°ƒç”¨ä¸Šç•¥å¿«ï¼ˆä½¿ç”¨FastClassï¼‰
<span class="hljs-bullet">3.</span> CGLIBåˆ›å»ºä»£ç†ç±»è¾ƒæ…¢ï¼ˆéœ€è¦ç”Ÿæˆå­—èŠ‚ç ï¼‰
<span class="hljs-bullet">4.</span> å®é™…ä¸šåŠ¡ä¸­ï¼Œä»£ç†å¼€é”€é€šå¸¸å¯å¿½ç•¥
</code></pre>
<h3 data-id="heading-28">ä¸ƒã€æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-29">7.1 é€‰æ‹©ä»£ç†æ–¹å¼</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»£ç†æ–¹å¼é€‰æ‹©å»ºè®®
 */</span>

<span class="hljs-comment">/*
1. ä¼˜å…ˆä½¿ç”¨JDKä»£ç†
   - é¢å‘æ¥å£ç¼–ç¨‹
   - Springé»˜è®¤é€‰æ‹©
   - æ›´ç¬¦åˆè®¾è®¡åŸåˆ™

2. ä»¥ä¸‹æƒ…å†µä½¿ç”¨CGLIBä»£ç†
   - ç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£
   - éœ€è¦ä»£ç†éæ¥å£æ–¹æ³•
   - æ€§èƒ½æ•æ„Ÿåœºæ™¯

3. Spring Boot 2.xé»˜è®¤ä½¿ç”¨CGLIB
   - spring.aop.proxy-target-class=true
*/</span>

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyRecommendation</span> {

    <span class="hljs-comment">// æ¨èï¼šé¢å‘æ¥å£ç¼–ç¨‹</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserService <span class="hljs-title function_">userService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
    }

    <span class="hljs-comment">// ä¸æ¨èï¼šç›´æ¥æ³¨å…¥å®ç°ç±»</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserServiceImpl <span class="hljs-title function_">userServiceImpl</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
    }
}
</code></pre>
<h4 data-id="heading-30">7.2 é¿å…å¸¸è§é—®é¢˜</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»£ç†å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyPitfalls</span> {

    <span class="hljs-comment">/**
     * é—®é¢˜1ï¼šåŒç±»æ–¹æ³•è°ƒç”¨ä¸èµ°ä»£ç†
     */</span>
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// âŒ ç›´æ¥è°ƒç”¨ï¼Œä¸èµ°ä»£ç†</span>
        <span class="hljs-built_in">this</span>.innerMethod();
    }

    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">innerMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// äº‹åŠ¡ä¸ç”Ÿæ•ˆ</span>
    }

    <span class="hljs-comment">// è§£å†³æ–¹æ¡ˆ1ï¼šæ³¨å…¥è‡ªå·±</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProxyPitfalls self;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethodFixed1</span><span class="hljs-params">()</span> {
        self.innerMethod();  <span class="hljs-comment">// âœ“ èµ°ä»£ç†</span>
    }

    <span class="hljs-comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨AopContext</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">outerMethodFixed2</span><span class="hljs-params">()</span> {
        ((ProxyPitfalls) AopContext.currentProxy()).innerMethod();  <span class="hljs-comment">// âœ“</span>
    }

    <span class="hljs-comment">/**
     * é—®é¢˜2ï¼šfinalæ–¹æ³•ä¸èƒ½è¢«ä»£ç†
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// CGLIBæ— æ³•ä»£ç†finalæ–¹æ³•</span>
    }

    <span class="hljs-comment">/**
     * é—®é¢˜3ï¼šprivateæ–¹æ³•ä¸èƒ½è¢«ä»£ç†
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">privateMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä»»ä½•ä»£ç†éƒ½æ— æ³•ä»£ç†privateæ–¹æ³•</span>
    }
}

<span class="hljs-comment">/**
 * å¯ç”¨AopContext
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAspectJAutoProxy(exposeProxy = true)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AopConfig</span> {
}
</code></pre>
<h4 data-id="heading-31">7.3 è°ƒè¯•ä»£ç†</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä»£ç†è°ƒè¯•æŠ€å·§
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyDebug</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. æŸ¥çœ‹ä»£ç†ç±»å</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> createProxy();
        System.out.println(<span class="hljs-string">"ä»£ç†ç±»: "</span> + proxy.getClass().getName());

        <span class="hljs-comment">// 2. åˆ¤æ–­æ˜¯å¦ä¸ºä»£ç†å¯¹è±¡</span>
        System.out.println(<span class="hljs-string">"æ˜¯JDKä»£ç†: "</span> + Proxy.isProxyClass(proxy.getClass()));
        System.out.println(<span class="hljs-string">"æ˜¯CGLIBä»£ç†: "</span> + proxy.getClass().getName().contains(<span class="hljs-string">"$$"</span>));

        <span class="hljs-comment">// 3. è·å–åŸå§‹å¯¹è±¡</span>
        <span class="hljs-keyword">if</span> (AopUtils.isAopProxy(proxy)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Object</span> <span class="hljs-variable">target</span> <span class="hljs-operator">=</span> ((Advised) proxy).getTargetSource().getTarget();
                System.out.println(<span class="hljs-string">"ç›®æ ‡å¯¹è±¡: "</span> + target.getClass().getName());
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }

        <span class="hljs-comment">// 4. ä¿å­˜ç”Ÿæˆçš„ä»£ç†ç±»</span>
        <span class="hljs-comment">// JDKä»£ç†</span>
        System.setProperty(<span class="hljs-string">"sun.misc.ProxyGenerator.saveGeneratedFiles"</span>, <span class="hljs-string">"true"</span>);

        <span class="hljs-comment">// CGLIBä»£ç†</span>
        System.setProperty(DebuggingClassWriter.DEBUG_LOCATION_PROPERTY, <span class="hljs-string">"/tmp/cglib"</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">createProxy</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-32">å…«ã€æ€»ç»“</h3>
<h4 data-id="heading-33">æ ¸å¿ƒçŸ¥è¯†ç‚¹å›é¡¾</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">SpringåŠ¨æ€ä»£ç†æ ¸å¿ƒè¦ç‚¹</span>
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> ä»£ç†æ¨¡å¼åŸºç¡€
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> é™æ€ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> åŠ¨æ€ä»£ç†
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">JDKåŠ¨æ€ä»£ç†</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> åŸºäºæ¥å£
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Proxy</span> <span class="hljs-operator">+</span> <span class="hljs-type">InvocationHandler</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> é™åˆ¶ï¼šå¿…é¡»æœ‰æ¥å£
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">CGLIBä»£ç†</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> åŸºäºç»§æ‰¿
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Enhancer</span> <span class="hljs-operator">+</span> <span class="hljs-type">MethodInterceptor</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> é™åˆ¶ï¼šä¸èƒ½ä»£ç†<span class="hljs-keyword">final</span>ç±»<span class="hljs-operator">/</span>æ–¹æ³•
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> <span class="hljs-type">Springä»£ç†é€‰æ‹©</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> é»˜è®¤<span class="hljs-type">JDKä»£ç†ï¼ˆæœ‰æ¥å£ï¼‰</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> è‡ªåŠ¨<span class="hljs-type">CGLIBä»£ç†ï¼ˆæ— æ¥å£ï¼‰</span>
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> å¼ºåˆ¶<span class="hljs-type">CGLIBä»£ç†ï¼ˆé…ç½®ï¼‰</span>
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â”œâ”€â”€</span> å®æˆ˜åº”ç”¨
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> æ—¥å¿—ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> é‡è¯•ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â”œâ”€â”€</span> ç¼“å­˜ä»£ç†
<span class="hljs-operator">â”‚</span>   <span class="hljs-operator">â””â”€â”€</span> æƒé™ä»£ç†
<span class="hljs-operator">â”‚</span>
<span class="hljs-operator">â””â”€â”€</span> æœ€ä½³å®è·µ
    <span class="hljs-operator">â”œâ”€â”€</span> é¢å‘æ¥å£ç¼–ç¨‹
    <span class="hljs-operator">â”œâ”€â”€</span> é¿å…åŒç±»è°ƒç”¨
    <span class="hljs-operator">â”œâ”€â”€</span> æ³¨æ„<span class="hljs-keyword">final</span><span class="hljs-operator">/</span><span class="hljs-keyword">private</span>æ–¹æ³•
    <span class="hljs-operator">â””â”€â”€</span> åˆç†é€‰æ‹©ä»£ç†æ–¹å¼
</code></pre>
<p>åŠ¨æ€ä»£ç†æ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒä½¿å¾—AOPã€äº‹åŠ¡ç®¡ç†ã€ç¼“å­˜ç­‰åŠŸèƒ½çš„å®ç°æˆä¸ºå¯èƒ½ã€‚ç†è§£JDKåŠ¨æ€ä»£ç†å’ŒCGLIBä»£ç†çš„åŸç†å’ŒåŒºåˆ«ï¼ŒæŒæ¡æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ä½¿ç”¨Springæ¡†æ¶ï¼Œå¹¶åœ¨éœ€è¦æ—¶å®ç°è‡ªå®šä¹‰çš„ä»£ç†åŠŸèƒ½ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cocos Creator Shader å…¥é—¨ â’‡ â€”â€” æ¶²æ€ç»ç’ƒæ•ˆæœ]]></title>    <link>https://juejin.cn/post/7575363120798973952</link>    <guid>https://juejin.cn/post/7575363120798973952</guid>    <pubDate>2025-11-23T18:24:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575363120798973952" data-draft-id="7574996958516477971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cocos Creator Shader å…¥é—¨ â’‡ â€”â€” æ¶²æ€ç»ç’ƒæ•ˆæœ"/> <meta itemprop="keywords" content="å‰ç«¯,Cocos Creator"/> <meta itemprop="datePublished" content="2025-11-23T18:24:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="VaJoy"/> <meta itemprop="url" content="https://juejin.cn/user/800100193674760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cocos Creator Shader å…¥é—¨ â’‡ â€”â€” æ¶²æ€ç»ç’ƒæ•ˆæœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/800100193674760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    VaJoy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T18:24:45.000Z" title="Sun Nov 23 2025 18:24:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ğŸ’¡ æœ¬ç³»åˆ—æ–‡ç« æ”¶å½•äº<a href="https://juejin.cn/column/7505952781289226291" target="_blank" title="https://juejin.cn/column/7505952781289226291">ä¸ªäººä¸“æ  ShaderMyHead</a>ã€‚</p>
<p>ğŸ’¡ æœ¬æ–‡æ¡ˆä¾‹å¯ä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fvajoy.github.io%2Fshader-demo%2Findex.html%3Fv%3D20" target="_blank" title="https://vajoy.github.io/shader-demo/index.html?v=20" ref="nofollow noopener noreferrer">åœ¨ Github ä¸Šè¿›è¡Œæ¼”ç¤º</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€æ¶²æ€ç»ç’ƒæ•ˆæœä»‹ç»</h2>
<p>è‹¹æœåœ¨ 2025 å¹´ 6 æœˆçš„ WWDC ä¸Šé¦–æ¬¡æ¨å‡ºäº†<strong>æ¶²æ€ç»ç’ƒï¼ˆLiquid Glassï¼‰</strong> æ•ˆæœï¼Œè®©ç•Œé¢å…ƒç´ å‘ˆç°å‡ºä»¿ä½›ç”±å¼¯æ›²ã€å¯æŠ˜å°„çš„ç»ç’ƒæ„æˆçš„è´¨æ„Ÿï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0c708655b674444b9b2546d83a7ea4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=qbC3FpAQF1lPYBQfq2jZbRH%2Fp1I%3D" alt="1.gif" loading="lazy"/></p>
<p>è‡ªæ­¤ï¼Œè¿™ç§åŒæ—¶å…¼å…·ç»šä¸½ä¸å¤æ‚çš„è§†è§‰ç‰¹æ•ˆè¿…é€Ÿåœ¨è®¾è®¡ä¸åŠ¨æ•ˆåœˆèµ°çº¢ï¼Œæˆä¸ºæ–°ä¸€ä»£ç•Œé¢é£æ ¼çš„æ½®æµè±¡å¾ã€‚</p>
<p>å¯¹äº H5 å‰ç«¯è€Œè¨€ï¼Œå¯ä»¥å€Ÿç”¨ SVG çš„ <code>&lt;filter&gt;</code> æ»¤é•œä¸­çš„ <code>&lt;feImage&gt;</code>ã€<code>&lt;feDisplacementMap&gt;</code>ã€<code>&lt;feBlend&gt;</code>ã€<code>&lt;feGaussianBlur&gt;</code>å’Œ <code>&lt;feComposite&gt;</code> ç­‰æ»¤é•œåŸºå…ƒï¼Œå¯¹èƒŒæ™¯è‰²è¿›è¡Œè‰²å€¼åç§»ã€æŸ”åŒ–å’Œé®ç½©å åˆï¼Œä»è€Œå®ç°ç±»ä¼¼çš„ç”»é¢æ‰­æ›²æ•ˆæœã€‚</p>
<p>ä¸ä¹…å‰ Trae Meetup å‘å¸ƒåœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fluma.com%2Flq0wo0qs" target="_blank" title="https://luma.com/lq0wo0qs" ref="nofollow noopener noreferrer">Luma å¹³å°ä¸Šçš„é‚€è¯·é¡µ</a>ï¼Œä¾¿å·²åº”ç”¨äº†è¿™ä¸€æŠ€æœ¯ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa7221af6d64fb6a8225755de21a7fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=8pprHvZh7h0xNT9L7NI2HStj010%3D" alt="9.gif" loading="lazy"/></p>
<p>æœ¬æ–‡åˆ™ä¼šä»¥ Cocos Creator ä¸ºæŠ€æœ¯æ ˆï¼Œä»‹ç»æ¶²æ€ç»ç’ƒæ•ˆæœçš„åŸç†ï¼ŒåŠå…¶ç€è‰²å™¨çš„é«˜æ€§èƒ½å®ç°ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ¶²æ€ç»ç’ƒåŸç†</h2>
<blockquote>
<p>ğŸ’¡ æœ¬èŠ‚éƒ¨åˆ†å†…å®¹å¼•ç”¨è‡ªã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkube.io%2Fblog%2Fliquid-glass-css-svg%2F" target="_blank" title="https://kube.io/blog/liquid-glass-css-svg/" ref="nofollow noopener noreferrer">kube.io - Liquid Glass in the Browser</a>ã€‹ä¸€æ–‡ã€‚</p>
</blockquote>
<h3 data-id="heading-2">2.1 æŠ˜å°„</h3>
<p>æŠ˜å°„æ˜¯æŒ‡å…‰ä»ä¸€ç§ä»‹è´¨è¿›å…¥å¦ä¸€ç§ä»‹è´¨ï¼ˆå¦‚ä»ç©ºæ°”è¿›å…¥ç»ç’ƒï¼‰æ—¶æ”¹å˜ä¼ æ’­æ–¹å‘çš„ç°è±¡ã€‚è¿™ç§åæŠ˜ä¹‹æ‰€ä»¥å‘ç”Ÿï¼Œæ˜¯å› ä¸ºå…‰åœ¨ä¸åŒä»‹è´¨ä¸­çš„ä¼ æ’­é€Ÿåº¦ä¸åŒã€‚</p>
<p>å…¶ä¸­æˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯ï¼Œå…¥å°„å…‰ä¸å‡ºå°„å…‰è§’åº¦çš„å…³ç³»ç”±<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSnell%2527s_law" target="_blank" title="https://en.wikipedia.org/wiki/Snell%27s_law" ref="nofollow noopener noreferrer">æ–¯æ¶…å°”â€“ç¬›å¡å°”å®šå¾‹</a>æè¿°ï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>Î¸</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>n</mi><mn>2</mn></msub><mi>sin</mi><mo>â¡</mo><mo stretchy="false">(</mo><msub><mi>Î¸</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n_1 \sin(\theta_1) = n_2 \sin(\theta_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></div>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºä»‹è´¨ 1 çš„æŠ˜å°„ç‡ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºä»‹è´¨ 2 çš„æŠ˜å°„ç‡ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\theta_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå…¥å°„è§’ï¼ˆå…‰çº¿ä¸æ³•çº¿çš„å¤¹è§’ï¼‰ï¼›</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºæŠ˜å°„è§’ï¼ˆæŠ˜å°„å…‰çº¿ä¸æ³•çº¿çš„å¤¹è§’ï¼‰ã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77ecf8ebc0054d76bfa623b4ad669a0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=LkL%2FWhU%2FdkJB9GvLYbroW%2FXoYz0%3D" alt="3.gif" loading="lazy"/></p>
<p>å…¶è¡¨ç°ä¸ºï¼š</p>
<ul>
<li>å½“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>=</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 = n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œå…‰çº¿ä¼šç›´çº¿ç©¿è¿‡ä»‹è´¨ï¼›</li>
<li>å½“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>&lt;</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 &lt; n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œå…‰çº¿ä¼šç©¿è¿‡ä»‹è´¨ä¸”å¾€æ³•çº¿ï¼ˆä¸Šå›¾ Normal è™šçº¿ï¼‰æ–¹å‘å‘ç”ŸåæŠ˜ï¼›</li>
<li>å½“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>&gt;</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 &gt; n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªä¸´ç•Œè§’ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>c</mi></msub><mo>=</mo><mi>arcsin</mi><mo>â¡</mo><mrow><mo fence="true">(</mo><mfrac><msub><mi>n</mi><mn>2</mn></msub><msub><mi>n</mi><mn>1</mn></msub></mfrac><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_c = \arcsin\left(\frac{n_2}{n_1}\right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8em;vertical-align:-0.65em;"/><span class="mop">arcsin</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size2">(</span></span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7115em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.4101em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4451em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size2">)</span></span></span></span></span></span></span>ï¼Œè‹¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mn>1</mn></msub><mo>&gt;</mo><msub><mi>Î¸</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\theta_1 &gt; \theta_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> åˆ™å…‰çº¿ä¸ä¼šå‘ç”ŸæŠ˜å°„ï¼Œè€Œæ˜¯è¢«<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FTotal_internal_reflection" target="_blank" title="https://en.wikipedia.org/wiki/Total_internal_reflection" ref="nofollow noopener noreferrer">å®Œå…¨åå°„</a>å›å»ï¼›</li>
<li>å½“å…¥å°„å…‰çº¿ä¸è¡¨é¢æ­£äº¤æ—¶ï¼Œæ— è®ºæŠ˜å°„ç‡å¦‚ä½•ï¼Œå®ƒéƒ½ä¼šï¼ˆæ²¿ç€æ³•çº¿æ–¹å‘ï¼‰ç›´çº¿ç©¿è¿‡ã€‚</li>
</ul>
<h3 data-id="heading-3">2.2 ä½ç§»å‘é‡åœº</h3>
<p>å½“å…‰çº¿ç©¿å…¥ç»ç’ƒä»‹è´¨äº§ç”ŸæŠ˜å°„åï¼Œä¼šåœ¨åº•éƒ¨äº§ç”Ÿä½ç§»å‘é‡ï¼ˆè§ä¸‹å›¾çš„ç´«è‰²ç®­å¤´ï¼‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/009dbf87ec7043e3aa541276f86fcb50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=YarKkCtrptfn1%2Fmvc1vvTrYix9E%3D" alt="4.gif" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå…‰çº¿äº§ç”ŸæŠ˜å°„è¶Šå¤§æ—¶ï¼Œå…¶ä½ç§»å‘é‡å°±è¶Šå¤§ï¼›ç›´åˆ°é è¿‘ç»ç’ƒä¸­å¿ƒä½ç½®æ—¶ï¼Œç”±äºå…‰çº¿ä¸ç»ç’ƒè¡¨é¢æ­£äº¤ï¼Œä¸å†äº§ç”ŸæŠ˜å°„ï¼Œå…¶ä½ç§»å‘é‡é•¿åº¦å½’é›¶ã€‚</p>
<p>å‡è®¾å…‰çº¿å°„å…¥çš„æ˜¯ä¸€å—æ­£åœ†å½¢çš„ç»ç’ƒå‡¸é€é•œï¼Œåˆ™æ‰€æœ‰å°„å…¥é•œå†…çš„å…‰çº¿æ‰€äº§ç”Ÿçš„ä½ç§»å‘é‡åœºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7eb0ec7fa2314a7cae2ce01cdf3e5bef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=foCGRxWaByZ3uTHLgVYKP8OG3Iw%3D" alt="5.gif" loading="lazy"/></p>
<p>ç•™æ„ä¸Šå›¾çš„ç®­å¤´éƒ½ä¸ºäº†å¯è§æ€§è€Œè¿›è¡Œäº†å½’ä¸€åŒ–å¤„ç†ï¼Œè¿›è€Œç¼©å°äº†æ¯”ä¾‹ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šé‡å ã€‚</p>
<blockquote>
<p>å’Œæ³•çº¿å‘é‡çš„ã€Œå½’ä¸€åŒ–ã€ä¸åŒï¼Œæ­¤å¤„çš„ã€Œå½’ä¸€åŒ–ã€å¹¶éå°†æ¯ä¸ªå‘é‡é™¤ä»¥è‡ªèº«çš„é•¿åº¦ï¼Œè€Œæ˜¯ç»Ÿä¸€é™¤ä»¥å‘é‡åœºå†…æœ€é•¿å‘é‡çš„é•¿åº¦ã€‚è¿™èˆ¬å¤„ç†åçš„å‘é‡æ‰èƒ½ä¿ç•™å½¼æ­¤ä¹‹é—´çš„é•¿åº¦æ¯”ä¾‹ä¿¡æ¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨ä¹‹å‰ã€Š<a href="https://juejin.cn/post/7542792170685825078" target="_blank" title="https://juejin.cn/post/7542792170685825078">æ³•çº¿è´´å›¾å’Œé«˜åº¦è´´å›¾</a>ã€‹ä¸€æ–‡å·²å­¦ä¹ è¿‡ã€Œå¦‚ä½•å°†å½’ä¸€åŒ–å‘é‡è½¬åŒ–ä¸ºè´´å›¾è‰²å€¼ã€ï¼Œä»Šå¤©ä¹Ÿå°†å¼‚æ›²åŒå·¥åœ°å¯¹ä½ç§»å‘é‡åšç±»ä¼¼çš„äº‹æƒ…ã€‚</p>
<p>ç”±äºå…‰çº¿æŠ˜å°„åçš„ä½ç§»å‘é‡ä»…å¤„äºç»ç’ƒæœ€åº•éƒ¨çš„å¹³é¢ï¼Œå› æ­¤æ¯ä¸ªå‘é‡ä»…åœ¨ X è½´å’Œ Y è½´å­˜åœ¨èµ°å‘ï¼Œä¸”å½’ä¸€åŒ–åçš„å€¼è¢«é™å®šåœ¨ <code>[-1, 1]</code> åŒºé—´ï¼Œå› æ­¤ä»…ä½¿ç”¨ RGBA ä¸­çš„ R å’Œ G ä¸¤ä¸ªé€šé“æ¥å­˜å‚¨è¿™ä¸¤ä¸ªè½´å‘å€¼å³å¯ï¼š</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mi>G</mi><mo>=</mo><mn>128</mn><mo>+</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo>âˆ—</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">RG = 128 + Normal * 127</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">RG</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">128</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">127</span></span></span></span></span></div>
<p>å‡è®¾ B é€šé“å€¼å›ºå®šä¸º <code>0</code>ï¼ŒA é€šé“å›ºå®šä¸º <code>255</code>ï¼Œåˆ™æ¯ä¸ªå½’ä¸€åŒ–å‘é‡çš„è‰²å€¼ç›¸å½“äºåœ¨ã€Œé›¶å‘é‡è‰²ã€ <code>RGBA(127, 127, 0, 255)</code> ä¸Šå¢å‡ç›¸åº”çš„ R å’Œ G å€¼ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7477d0ad2f84538bcec1f83fd4eb4ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=lfClw3K7VEWgFEoR10ANRC%2F33Sg%3D" alt="6.gif" loading="lazy"/></p>
<p>é‚£ä¹ˆä¸€ä¸ªæ­£åœ†å½¢å‡¸é€é•œï¼Œå…¶å½’ä¸€åŒ–ä½ç§»å‘é‡åœºè´´å›¾ï¼ˆdisplacement mapï¼‰ï¼Œå¯ä»¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0318d20622ec4f69963a16d64fdafab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=h%2FhRbj21Zd9OznsCp3vyE60mpsY%3D" alt="7.png" loading="lazy"/></p>
<blockquote>
<p>ğŸ’¡ æˆ‘åˆ¶ä½œäº†ä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fvajoy.github.io%2Fdm-generate%2Findex.html%3Fy%3D3" target="_blank" title="https://vajoy.github.io/dm-generate/index.html?y=3" ref="nofollow noopener noreferrer">å·¥å…·é¡µé¢</a>ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸Šè½»æ¾ç”Ÿæˆã€ä¸‹è½½å„ç§å½¢çŠ¶çš„ä½ç§»å‘é‡åœºè´´å›¾ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed32ab4a9fb49138f65fbe567ffda58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=z2%2B1YazaqOiAUPC36zqpExTPKgw%3D" alt="8.gif" loading="lazy"/></p>
</blockquote>
<p>æ‹¥æœ‰äº†ä¿¡æ¯åŒ–è´´å›¾ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ç€è‰²å™¨æ•è·ã€é€†å‘è¿™äº›ä¿¡æ¯ï¼Œå†è¿›ä¸€æ­¥åš UV åç§»ï¼Œæ¥å®ç°å…‰çº¿æŠ˜å°„ã€ç”»é¢è¢«æ‰­æ›²çš„æ•ˆæœã€‚</p>
<h3 data-id="heading-4">2.3 è‰²æ•£ä¸è½®å»“é«˜å…‰</h3>
<p>ä¸åŒé¢œè‰²çš„å…‰ï¼Œåœ¨ç»ç’ƒé‡Œä¼ æ’­çš„é€Ÿåº¦ä¸åŒï¼Œå› æ­¤æŠ˜å°„ç¨‹åº¦ä¹Ÿä¸åŒï¼ŒæŠ˜å°„åç§»è¶Šå¤§çš„åŒºåŸŸè¶Šå®¹æ˜“äº§ç”Ÿã€Œè‰²æ•£ã€ç°è±¡ï¼Œä»è€Œå‘ˆç°å‡ºä¸€ç§è‰²å½©åˆ†å±‚çš„è§†è§‰æ•ˆæœï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b93c4d9a2dd4eba8df43c1bf4b8d6fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=BM5H5kjte1%2BjCcK5s5j6VG%2B0tng%3D" alt="9.jpg" loading="lazy"/></p>
<p>åœ¨ã€Š<a href="https://juejin.cn/post/7517085209327484928" target="_blank" title="https://juejin.cn/post/7517085209327484928">æ»¤é•œçš„å®ç°</a>ã€‹ä¸€æ–‡ä¸­æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ª <code>glitchEffect</code> æ•…éšœæ•ˆæœæ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒæ­¤æ–¹æ³•ï¼Œæ ¹æ®ä½ç§»å‘é‡åœºè´´å›¾çš„ Rã€G é€šé“å€¼çš„å¤§å°ï¼Œæ¥å†³å®šä¸åŒç¨‹åº¦çš„è‰²å€¼åç§»ï¼Œä»è€Œè¾¾æˆç»ç’ƒè¾¹ç¼˜è‰²æ•£çš„è§†è§‰æ•ˆæœã€‚</p>
<p>å¦å¤–ï¼Œå½“å…‰çº¿ä»¥ç‰¹å®šè§’åº¦ç…§å°„æ—¶ï¼Œä¼šåœ¨ç»ç’ƒç‰©ä½“çœ‹åˆ°ä¸€äº›æ˜äº®çš„è¾¹ç¼˜åå°„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcafeaccf22e4f3884f4396aecce30eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=9g02vKrFl8r%2FJBRLroaWl0Sl4%2F0%3D" alt="9.gif" loading="lazy"/></p>
<p>è‹¹æœå…¬å¸å¯¹æ­¤çš„å®ç°ï¼Œæ˜¯ç»™æ¶²æ€ç»ç’ƒå›¾æ ‡æ·»åŠ ä¸€åœˆç®€å•çš„è½®å»“é«˜å…‰ï¼Œä»¤å…¶è´¨æ„Ÿæ›´è´´è¿‘ç»ç’ƒçš„åŒæ—¶ï¼Œä¹Ÿæ›´å¥½åœ°è®©å›¾æ ‡ä¸å¤–ç•Œåšè¾¹ç•ŒåŒºåˆ†ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5bcdddca1c45f5a7a2fb406b2be6ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=0KNcR2FBoFsuDAaXAygQlA3EN5E%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-5">ä¸‰ã€ç€è‰²å™¨å®ç°</h2>
<h3 data-id="heading-6">3.1 æŠ˜å°„çš„å®ç°</h3>
<p>å…‰çº¿çš„æŠ˜å°„åœ¨ç€è‰²å™¨ä¸­é€šå¸¸è¡¨ç°ä¸º UV çš„åç§»ï¼ˆè¿™ä¹Ÿæ˜¯ã€Š<a href="https://juejin.cn/post/7544388006720471094" target="_blank" title="https://juejin.cn/post/7544388006720471094">UV æ‰°åŠ¨åŠ¨ç”»</a>ã€‹çš„å®ç°åŸç†ï¼‰ï¼Œå€ŸåŠ©ä½ç§»å‘é‡åœºè´´å›¾ï¼Œå¯ä»¥é«˜æ•ˆåœ°è·å¾— UV çš„åç§»å€¼ã€‚</p>
<p>æˆ‘ä»¬å…ˆæŠŠèƒŒæ™¯å’Œå‰ç½®çš„ç»ç’ƒç‰©ä½“ä½ç§»å‘é‡åœºè´´å›¾ï¼Œåˆ†åˆ«æ•è·ä¸ºä¸¤ä¸ªç¦»å±çš„ Render Textureï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bc434aa26194ad495a917d9a5409a80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=hoyJfJntiO8fl8mObwDfQv2hFo8%3D" alt="image.png" loading="lazy"/></p>
<p>æ¥ç€æ–°å»ºä¸€ä¸ª <code>Sprite</code> ç»„ä»¶èŠ‚ç‚¹ <code>Composition</code>ï¼Œç»‘å®šç€è‰²å™¨ï¼ˆ<code>liquid-glass.effect</code>ï¼‰æ¥è·å–è¿™ä¸¤ä¸ª Render Textureï¼ˆç”¨äºåé¢çš„åˆæˆå¤„ç†ï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** liquid-glass.effect ç‰‡å…ƒç€è‰²å™¨ç¤ºä¾‹ **/</span>

<span class="hljs-title class_">CCProgram</span> fs %{
  precision highp float;
  <span class="hljs-keyword">in</span> vec2 uv;

  uniform sampler2D bgRT;  <span class="hljs-comment">// èƒŒæ™¯ RenderTexture</span>
  uniform sampler2D displacementMapRT;  <span class="hljs-comment">// ä½ç§»å‘é‡åœºè´´å›¾ RenderTexture</span>

  vec4 frag () {
    vec4 bgColor = <span class="hljs-title function_">texture</span>(bgRT, uv);
    vec4 dispColor = <span class="hljs-title function_">texture</span>(displacementMapRT, uv);
    
    <span class="hljs-keyword">return</span> bgColor;  <span class="hljs-comment">// ç›´æ¥è¿”å›èƒŒæ™¯è‰²ï¼ˆæš‚æ— ä»»ä½•æ‰­æ›²å¤„ç†ï¼‰</span>
  }
}%
</code></pre>
<p>åœ¨è·å–åˆ°ä½ç§»å‘é‡åœºè´´å›¾çš„è‰²å€¼åï¼ˆå–å€¼åŒºé—´ <code>[0.0, 1.0]</code>ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ã€Œé€†å‘ã€ä¸ºåŸæœ¬çš„å½’ä¸€åŒ–å‘é‡ï¼ˆå–å€¼åŒºé—´ <code>[-1.0, 1.0]</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">vec2 offsetNormal = dispColor.<span class="hljs-property">xy</span> * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>;  <span class="hljs-comment">// RG æ˜ å°„åˆ° [-1, 1]</span>
</code></pre>
<p>ç”±äºé€†å‘åçš„å½’ä¸€åŒ–å‘é‡çš„å–å€¼ä¸º <code>[-1, 1]</code>ï¼Œå¯¹äº UV è€Œè¨€æ˜¯ä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼ï¼Œç›´æ¥ä½¿ç”¨ <code>offsetNormal</code> ä½œä¸º UV åç§»å€¼ä¼šå¯¼è‡´éå¸¸å¤¸å¼ çš„èƒŒæ™¯æ‰­æ›²ï¼Œå› æ­¤éœ€è¦æ–°å¢ä¸€ä¸ª <code>strengthUV</code> å‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º <code>0.03</code>ï¼‰æ¥ç¼©å° UV åç§»å€¼åˆ°åˆç†çš„èŒƒç•´ï¼š</p>
<pre><code class="hljs language-js" lang="js">uniform <span class="hljs-variable constant_">UBO</span> {
    float strengthUV;  <span class="hljs-comment">// é»˜è®¤å€¼ 0.03</span>
};

vec2 offsetNormal = dispColor.<span class="hljs-property">xy</span> * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>;

float canvasScale = <span class="hljs-number">1280.0</span> / <span class="hljs-number">720.0</span>;  <span class="hljs-comment">// 1280x720 æ˜¯ Canvasã€bgRT å’Œ displacementMapRT çš„å®½é«˜</span>
vec2 offsetUV = offsetNormal * strengthUV * <span class="hljs-title function_">vec2</span>(<span class="hljs-number">1.0</span>, -canvasScale);  <span class="hljs-comment">// UV éœ€è¦åç§»çš„é‡</span>
vec2 baseUV = uv + offsetUV;  <span class="hljs-comment">// åç§» UV</span>

vec4 bgColor = <span class="hljs-title function_">texture</span>(bgRT, baseUV);

<span class="hljs-keyword">return</span> bgColor; 
</code></pre>
<blockquote>
<p>ç•™æ„ç¬¬ 8 è¡Œç»™ Y è½´çš„åç§»ä¹˜ä»¥äº†ç”»å¸ƒçš„å®½é«˜æ¯” <code>canvasScale</code>ï¼Œä»¥æ­¤ç¡®ä¿ X è½´å’Œ Y è½´çš„åç§»å¹…åº¦ä¸ä¼šäº§ç”Ÿæ‹‰ä¼¸ï¼ˆæ¯•ç«Ÿæœ¬æ¡ˆä¾‹çš„ç”»å¸ƒåŠå…¶å¯¹åº”çš„ UV å¹¶éæ­£æ–¹å½¢ï¼‰ã€‚</p>
<p>åŒæ—¶ Y è½´çš„åç§»è¿˜ä¹˜ä»¥äº† <code>-1</code>ï¼Œç¡®ä¿ä½ç§»çŸ¢é‡åœ¨å‚ç›´æ–¹ä½èƒ½ç¬¦åˆæ­£ç¡®çš„ UV æ–¹ä½ï¼ˆæŒ‡å‘ä¸­å¿ƒï¼‰ã€‚</p>
</blockquote>
<p>æ­¤æ—¶æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f7884bdf9b84a61a457f931ac9c2ee9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=GZ81dyQ%2BKU3%2Bej7U4so%2FaIliX5U%3D" alt="11.gif" loading="lazy"/></p>
<h3 data-id="heading-7">3.2 è‰²æ•£çš„å®ç°</h3>
<p>è‰²æ•£çš„å®ç°å…¶å®æ¯”æƒ³è±¡çš„ç®€å•ï¼Œåªéœ€è¦æ ¹æ® UV åç§»é‡ <code>offsetUV</code>ï¼Œè¿›ä¸€æ­¥å·¦å³åç§»èƒŒæ™¯è‰²çš„ R å’Œ B é€šé“å³å¯ï¼ŒåŒæ—¶æ–°å¢ <code>dispersionStrength</code> å‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º <code>0.03</code>ï¼‰æ¥æ§åˆ¶è‰²æ•£åç§»çš„å¼ºåº¦ï¼š</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// è‰²æ•£æ•ˆæœï¼ŒæŠŠ R å’Œ B è‰²å€¼åˆ†åˆ«å·¦å³åç§»</span>
    vec4 rC = <span class="hljs-title function_">texture</span>(bgRT, baseUV + offsetUV * dispersionStrength);
    vec4 gC = <span class="hljs-title function_">texture</span>(bgRT, baseUV);
    vec4 bC = <span class="hljs-title function_">texture</span>(bgRT, baseUV - offsetUV * dispersionStrength);

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">vec4</span>(rC.<span class="hljs-property">r</span>, gC.<span class="hljs-property">g</span>, bC.<span class="hljs-property">b</span>, <span class="hljs-number">1.0</span>);
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3de3487b432f44d999afe16f334307af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=l5u1TTs2AjusMyAXWPiR55hObgQ%3D" alt="12.gif" loading="lazy"/></p>
<p>ä¸ºäº†æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä»…åœ¨éœ€è¦è‰²æ•£çš„æ—¶å€™æ‰å¯¹ R å’Œ B é€šé“è¿›è¡Œé‡‡æ ·ï¼š</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-comment">// è‰²æ•£æ•ˆæœï¼ŒæŠŠ R å’Œ B è‰²å€¼åˆ†åˆ«å·¦å³åç§»</span>
    vec4 gC = <span class="hljs-title function_">texture</span>(bgRT, baseUV);
    vec4 rC = gC;
    vec4 bC = gC;

    <span class="hljs-keyword">if</span> (dispersionStrength &gt; <span class="hljs-number">0.0</span>) {
      <span class="hljs-comment">// éœ€è¦å¼€å¯è‰²æ•£æ•ˆæœå†é‡‡æ · R B é€šé“ï¼Œæå‡æ€§èƒ½</span>
      rC = <span class="hljs-title function_">texture</span>(bgRT, baseUV + offsetUV * dispersionStrength);
      bC = <span class="hljs-title function_">texture</span>(bgRT, baseUV - offsetUV * dispersionStrength);
    }

    vec4 dispersionColor = <span class="hljs-title function_">vec4</span>(rC.<span class="hljs-property">r</span>, gC.<span class="hljs-property">g</span>, bC.<span class="hljs-property">b</span>, <span class="hljs-number">1.0</span>);
</code></pre>
<h3 data-id="heading-8">3.3 è½®å»“å…‰çš„å®ç°</h3>
<p>å®ç°è½®å»“å…‰æœ€ç®€å•ç²—æš´çš„æ–¹æ¡ˆï¼Œæ˜¯åœ¨å½¢çŠ¶èŠ‚ç‚¹ä¹‹ä¸Šå åŠ ä¸€ä¸ª PNG å›¾å±‚èŠ‚ç‚¹ï¼Œä½†æœ¬æ–‡å°†æ›´åŠ é«˜æ•ˆçš„ã€ç›´æ¥åœ¨ç€è‰²å™¨å†…éƒ¨å®ç°ã€‚</p>
<p>ç”±äºå…‰çº¿æŠ˜å°„äº§ç”Ÿçš„ä½ç§»å‘é‡ï¼Œåœ¨è¶Šé è¿‘è¾¹ç¼˜çš„éƒ¨åˆ†å…¶çŸ¢é‡é•¿åº¦æ˜¯è¶Šå¤§çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡ <code>length</code> å‡½æ•°è·å¾—ä½ç§»çŸ¢é‡é•¿åº¦ï¼Œç„¶ååˆ¤æ–­å…¶å€¼æ˜¯å¦å¤§äºæŒ‡å®šçš„é˜ˆå€¼ï¼Œè‹¥æ˜¯åˆ™è¿”å›çº¯ç™½è‰²çš„è½®å»“å…‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">  uniform <span class="hljs-variable constant_">UBO</span> {
    float strengthUV; 
    float dispersionStrength; 
    float highlightStrength;   <span class="hljs-comment">// æ–°å¢è½®å»“å…‰å¼ºåº¦å‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º 0.1ï¼ŒèŒƒå›´ `[0.0, 0.2]`ï¼‰</span>
  };
  
  
    <span class="hljs-comment">// è½®å»“å…‰å®ç°</span>
    float normalLen = <span class="hljs-title function_">length</span>(offsetNormal);  <span class="hljs-comment">// è·å¾—å½’ä¸€åŒ–ä½ç§»çŸ¢é‡é•¿åº¦ï¼ŒåŒºé—´ä¸º [0.0, 1.0]</span>

    <span class="hljs-keyword">if</span> (normalLen &lt; <span class="hljs-number">1.0</span> - highlightStrength) {
      <span class="hljs-comment">// ä½ç§»å‘é‡é•¿åº¦ä½äºæŒ‡å®šé˜ˆå€¼ï¼Œæ— éœ€è½®å»“å…‰</span>
      <span class="hljs-keyword">return</span> dispersionColor;
    }

    float highlightOpacity = <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, highlightOpacity);
</code></pre>
<p>ç”±äº <code>offsetNormal</code> æ˜¯å½’ä¸€åŒ–åçš„å‘é‡ï¼Œå…¶é•¿åº¦ <code>normalLen</code> æ³¨å®šè½åœ¨ <code>[0.0, 1.0]</code> åŒºé—´ä¸­ï¼Œå› æ­¤å¯ä»¥è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼ˆ<code>highlightStrength</code>ï¼‰æ¥åœˆå®šäº§ç”Ÿè½®å»“å…‰çš„åŒºåŸŸã€‚</p>
<p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªç›¸è¾ƒç²—ç³™çš„å®å¿ƒè½®å»“å…‰ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b30dfa949fe4ebe9a2713425d3eaf4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=Sqov4kkkqEGuCj1lf0tl9R2Ei%2Bg%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>å—é™äºä½ç§»å‘é‡åœºè´´å›¾ç²¾åº¦ï¼Œè®¡ç®—è·å¾—çš„è½®å»“å…‰ç²—ç»†å¯èƒ½ä¸å‡ï¼Œä¸”å¯èƒ½å­˜åœ¨äº›è®¸åç§»ã€‚</p>
</blockquote>
<p>ç„¶è€Œæˆ‘ä»¬éœ€è¦çš„å¹¶éä¸€ä¸ªå®Œæ•´ä¸”å®å¿ƒçš„è½®å»“å…‰ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªå¯¹ç§°çš„ã€é€æ˜åº¦çº¿æ€§æ¸å˜çš„è½®å»“å…‰ï¼Œè€Œè¿™å—çš„å¤„ç†å¯ä»¥ä»ä½ç§»å‘é‡åœºè´´å›¾ä¸Šçš„è‰²å€¼è·å–çº¿ç´¢ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d28c1f3aa63b485c8effec5835b90622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=oJaLSkflgjin7ufO9dQ07Jkn7BE%3D" alt="15.jpg" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä½ç§»å‘é‡åœºè´´å›¾çš„ R æˆ– G é€šé“å€¼ï¼Œå‡æ˜¯çº¿æ€§æ¸å˜çš„ï¼Œä¾‹å¦‚ G é€šé“çš„å€¼ï¼Œä¼šä»æœ€é¡¶éƒ¨çš„ <code>255</code> æ²¿ç€è¾¹ç¼˜çº¿æ€§é€’å‡åˆ°æœ€å·¦ä¾§çš„ <code>128</code>ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ä½äºå·¦ä¸Šè§’çš„ G é€šé“å€¼ <code>191</code> æ¥ä½œä¸ºå·¦åŠçƒè½®å»“å…‰çš„ä¸­ç‚¹ï¼ˆå®Œå…¨ä¸é€æ˜åº¦ï¼‰ï¼Œå…¶å·¦å³ä¸¤ä¾§ G é€šé“å€¼ <code>Â±50</code> çš„ç‚¹ä¸ºè½®å»“å…‰çš„è¾¹ç¼˜ï¼ˆå®Œå…¨é€æ˜åº¦ï¼‰ï¼Œè¿›è€Œå®ç°ä¸€ä¸ªä½äºå·¦ä¸Šè§’çš„æ¸å˜è½®å»“å…‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">    float highlightOpacity = <span class="hljs-number">0.0</span>;
    float leftCenterG = <span class="hljs-number">191.0</span> / <span class="hljs-number">255.0</span>;  <span class="hljs-comment">// ç»ç’ƒç‰©ä½“å·¦ä¾§è½®å»“å…‰ä¸­å¿ƒå¯¹åº”çš„ G å€¼ï¼Œè¦å…ˆè½¬æ¢åˆ° [0.0, 1.0] åŒºé—´ï¼Œæ‰èƒ½ä¸åŒºé—´ä¸º [0.0, 1.0] çš„ dispColor.g è¿›è¡Œå¯¹æ¯”</span>
    float rightCenterG = <span class="hljs-number">1.0</span> - leftCenterG; <span class="hljs-comment">// ç»ç’ƒç‰©ä½“å³ä¾§è½®å»“å…‰ä¸­å¿ƒå¯¹åº”çš„ G å€¼</span>
    float spanG = <span class="hljs-number">50.0</span> / <span class="hljs-number">255.0</span>;  <span class="hljs-comment">// è½®å»“å…‰èŒƒå›´å¯¹åº”çš„ G å€¼ï¼Œå½“ leftCenterG Â± spanG æ—¶ï¼Œè½®å»“å…‰é€æ˜åº¦ä¸º 0</span>
    
    <span class="hljs-keyword">if</span> ((offsetNormal.<span class="hljs-property">x</span> &gt; <span class="hljs-number">0.0</span>) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &lt; leftCenterG + spanG) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &gt; leftCenterG - spanG)) {
      <span class="hljs-comment">// ä½ç§»å‘é‡åœ¨æ°´å¹³æ–¹ä½æŒ‡å‘å³ä¾§ï¼Œè¯´æ˜å¤„äºç»ç’ƒç‰©ä½“å·¦ä¾§</span>
      highlightOpacity = <span class="hljs-title function_">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-title function_">abs</span>(dispColor.<span class="hljs-property">g</span> - leftCenterG) / spanG, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    }
    
    vec4 highlightColor = <span class="hljs-title function_">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">mix</span>(dispersionColor, highlightColor, highlightOpacity);
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf944730ef3b4141959f25e88be06125~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=bKvgNGD8N3bYamTvqXvN4dmYphA%3D" alt="16.jpg" loading="lazy"/></p>
<p>åŒç†ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡ºå³ä¸‹è§’çš„æ¸å˜è½®å»“å…‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">    <span class="hljs-keyword">if</span> ((offsetNormal.<span class="hljs-property">x</span> &gt; <span class="hljs-number">0.0</span>) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &lt; leftCenterG + spanG) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &gt; leftCenterG - spanG)) {
      <span class="hljs-comment">// ä½ç§»å‘é‡åœ¨æ°´å¹³æ–¹ä½æŒ‡å‘å³ä¾§ï¼Œè¯´æ˜å¤„äºç»ç’ƒç‰©ä½“å·¦ä¾§</span>
      highlightOpacity = <span class="hljs-title function_">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-title function_">abs</span>(dispColor.<span class="hljs-property">g</span> - leftCenterG) / spanG, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((offsetNormal.<span class="hljs-property">x</span> &lt; <span class="hljs-number">0.0</span>) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &lt; rightCenterG + spanG) &amp;&amp; (dispColor.<span class="hljs-property">g</span> &gt; rightCenterG - spanG)) {
      <span class="hljs-comment">// ä½ç§»å‘é‡åœ¨æ°´å¹³æ–¹ä½æŒ‡å‘å·¦ä¾§ï¼Œè¯´æ˜å¤„äºç»ç’ƒç‰©ä½“å³ä¾§</span>
      highlightOpacity = <span class="hljs-title function_">clamp</span>(<span class="hljs-number">1.0</span> - <span class="hljs-title function_">abs</span>(dispColor.<span class="hljs-property">g</span> - rightCenterG) / spanG, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
    }
</code></pre>
<p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88d5240eb6fd4025a1eebb7ddbe5df13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=w5Qfq3TA7p2iKtKbQ2NsUcibq3w%3D" alt="17.gif" loading="lazy"/></p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å€ŸåŠ©ä½ç§»å‘é‡åœºè´´å›¾çš„èƒ½åŠ›ï¼Œåœ¨å•ä¸ª DrawCall ä¸­ä»…ä½¿ç”¨äº†æœ€å¤š 4 æ¬¡é‡‡æ ·ï¼Œä¾¿é«˜æ•ˆåœ°å®ç°äº†ä¸€ä¸ªå¸¦æœ‰æ‰­æ›²ã€è‰²æ•£å’Œè½®å»“å…‰çš„æ¶²æ€ç»ç’ƒæ•ˆæœã€‚</p>
<p>è¯¥ç€è‰²å™¨ä¹Ÿé€‚ç”¨äºå…¶å®ƒå½¢çŠ¶ï¼Œè¯»è€…å¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fvajoy.github.io%2Fshader-demo%2Findex.html%3Fv%3D20" target="_blank" title="https://vajoy.github.io/shader-demo/index.html?v=20" ref="nofollow noopener noreferrer">çº¿ä¸Šæ¡ˆä¾‹æ¼”ç¤ºé¡µ</a>æŸ¥çœ‹å®Œæ•´çš„åŠ¨æ€æ•ˆæœå’Œè·å–æºç ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d2ff76fa23f419a8addfa432e100880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVmFKb3k=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764558237&amp;x-signature=goCwf%2F%2FYgtP0l3SymUFxdLfqC4E%3D" alt="18.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ Taro + å¾®ä¿¡å°ç¨‹åºå®ç°å¤§æ¨¡å‹æµå¼å“åº”ï¼ˆSSEï¼‰ï¼šæœ€å…¨å®è·µæŒ‡å—]]></title>    <link>https://juejin.cn/post/7575367791273639974</link>    <guid>https://juejin.cn/post/7575367791273639974</guid>    <pubDate>2025-11-24T01:02:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273639974" data-draft-id="7574991051435147274" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ Taro + å¾®ä¿¡å°ç¨‹åºå®ç°å¤§æ¨¡å‹æµå¼å“åº”ï¼ˆSSEï¼‰ï¼šæœ€å…¨å®è·µæŒ‡å—"/> <meta itemprop="keywords" content="å¾®ä¿¡å°ç¨‹åº,Taro,LLM"/> <meta itemprop="datePublished" content="2025-11-24T01:02:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="namehu"/> <meta itemprop="url" content="https://juejin.cn/user/993614243829768"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ Taro + å¾®ä¿¡å°ç¨‹åºå®ç°å¤§æ¨¡å‹æµå¼å“åº”ï¼ˆSSEï¼‰ï¼šæœ€å…¨å®è·µæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614243829768/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    namehu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:02:26.000Z" title="Mon Nov 24 2025 01:02:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘å¤§æ¨¡å‹ï¼ˆLLMï¼‰å¯ä»¥è¯´æ˜¯ç«å¾—ä¸€å¡Œç³Šæ¶‚ã€‚å„å®¶å…¬å¸éƒ½åœ¨å¾€å°ç¨‹åºé‡Œå¡ AI å¯¹è¯åŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œå¤§å®¶æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Ÿå¦‚æœä½ åƒä¼ ç»Ÿè¯·æ±‚é‚£æ ·ï¼Œç­‰ AI æŠŠå‡ åƒå­—çš„å°ä½œæ–‡å…¨å†™å®Œå†è¿”å›ç»™å‰ç«¯ï¼Œç”¨æˆ·çš„ç­‰å¾…ä½“éªŒç®€ç›´æ˜¯ç¾éš¾çº§çš„ï¼ğŸ˜«</p>
<p>æ‰€ä»¥ï¼Œ<strong>æµå¼è¾“å‡ºï¼ˆStreamingï¼‰</strong> ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œæ‰“å­—æœºæ•ˆæœâ€ï¼Œæ˜¯æå‡ AI äº§å“ä½“éªŒçš„å¿…æ€æŠ€ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±å¸¦å¤§å®¶æ·±å…¥ç¡¬æ ¸åœ°æ‰’ä¸€æ‰’ï¼Œå¦‚ä½•åœ¨ <strong>Taro æ¡†æ¶</strong> ä¸‹ï¼Œåˆ©ç”¨ <strong>å¾®ä¿¡å°ç¨‹åºåŸç”Ÿèƒ½åŠ›</strong> å®ç°ä¸æ»‘çš„ SSEï¼ˆServer-Sent Eventsï¼‰æµå¼å“åº”ã€‚</p>
<p>å¦‚æœä½ åœ¨å®æ–½çš„è¿‡ç¨‹ä¸­é‡åˆ°è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>æ˜æ˜ä»£ç æŒ‰å®˜æ–¹å†™çš„ä½†æ˜¯å°±æ˜¯ä¸æµå¼è¾“å‡ºï¼Ÿ</li>
<li>æ¨¡æ‹Ÿå™¨è·ŸçœŸæœºæ•ˆæœä¸ä¸€æ ·ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆå®‰å“å¯ä»¥ã€‚IOSå´ä¸è¡Œ</li>
<li>ä¸ºä»€ä¹ˆå¯ä»¥è¾“å‡ºå†…å®¹ä½†æ˜¯æ§åˆ¶å°æ€»æ˜¯ä¼šåœ¨è¯·æ±‚ç»“æŸåæŠ¥é”™</li>
</ul>
<p>é‚£ä¹ˆè¯·æ”¾å¿ƒï¼Œè¿™ä¸­é—´çš„å‘ï¼Œæˆ‘å·²ç»æ›¿å¤§å®¶è¸©å¹³äº†</p>
<h2 data-id="heading-0">ğŸ§ ä¸ºä»€ä¹ˆæ˜¯ SSE è€Œä¸æ˜¯ WebSocketï¼Ÿ</h2>
<p>è™½ç„¶ WebSocket å…¨åŒå·¥å¾ˆå¼ºï¼Œä½†å¯¹äºå¤§æ¨¡å‹å¯¹è¯è¿™ç§â€œä¸€é—®å¤šç­”â€çš„åœºæ™¯ï¼ŒSSEï¼ˆServer-Sent Eventsï¼‰å…¶å®æ›´è½»é‡ã€æ›´ç¬¦åˆ HTTP è¯­ä¹‰ã€‚</p>
<p>ä½†åœ¨å¾®ä¿¡å°ç¨‹åºé‡Œï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ ‡å‡†çš„ <code>EventSource</code> APIã€‚ä¸è¿‡åˆ«æ…Œï¼Œå¾®ä¿¡çš„ <code>wx.request</code>ï¼ˆTaro ä¸­æ˜¯ <code>Taro.request</code>ï¼‰æ”¯æŒäº† <code>enableChunked</code> å‚æ•°ã€‚</p>
<p>è¿™å°±ç»™äº†æˆ‘ä»¬æ“ä½œçš„ç©ºé—´ï¼ğŸ˜</p>
<h2 data-id="heading-1">ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯å®ç°ï¼šå‰ç«¯ç¯‡</h2>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ ¸å¿ƒçš„ Hook å®ç°ã€‚è¿™é‡Œæˆ‘å°è£…äº†ä¸€ä¸ª <code>useSSE</code>ï¼Œå®ƒè´Ÿè´£å»ºç«‹è¿æ¥ã€è§£ç äºŒè¿›åˆ¶æµã€è§£æ SSE åè®®ä»¥åŠæ§åˆ¶æ‰“å­—æœºé€Ÿåº¦ã€‚</p>
<h3 data-id="heading-2">1. é“¾è·¯è®¾è®¡å›¾</h3>
<p>åœ¨å¼€å§‹è´´ä»£ç å‰ï¼Œå…ˆçœ‹ä¸‹æ•°æ®æ˜¯æ€ä¹ˆæµè½¬çš„ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A["ç”¨æˆ·å‘èµ·å¯¹è¯"] --&gt; B["Taro.request (å¼€å¯ enableChunked)"]
    B --"å»ºç«‹è¿æ¥"--&gt; C["æœåŠ¡ç«¯å“åº” (Transfer-Encoding: chunked)"]
    C --"äºŒè¿›åˆ¶æµ chunk"--&gt; D["onChunkReceived ç›‘å¬"]
    D --&gt; E["TextDecoder è§£ç  (ArrayBuffer è½¬ String)"]
    E --&gt; F["SSE åè®®è§£æ (æå– data å­—æ®µ)"]
    F --&gt; G["å†™å…¥ç¼“å­˜é˜Ÿåˆ— (Buffer)"]
    G --&gt; H["å®šæ—¶å™¨æ§åˆ¶ (æ‰“å­—æœºæ•ˆæœ)"]
    H --&gt; I["æ›´æ–° UI (Markdown æ¸²æŸ“)"]
</code></pre>
<h3 data-id="heading-3">2. æ ¸å¿ƒ Hookï¼š<code>useSSE.ts</code></h3>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯æ•´ä¸ªåŠŸèƒ½çš„çµé­‚ã€‚æˆ‘ä»¬éœ€è¦è§£å†³ä¸¤ä¸ªå¤§éš¾é¢˜ï¼š</p>
<ol>
<li><strong>è§£ç </strong>ï¼šå°ç¨‹åºè¿”å›çš„æ˜¯ <code>ArrayBuffer</code>ï¼Œéœ€è¦å…¼å®¹æ€§å¥½çš„è§£ç æ–¹æ¡ˆï¼ˆæ¨è <code>text-encoding-shim</code>ï¼‰ã€‚</li>
<li><strong>ç²˜åŒ…å¤„ç†</strong>ï¼šç½‘ç»œä¼ è¾“æ˜¯ä¸è®²é“ç†çš„ï¼Œå¯èƒ½ä¸€æ¬¡ç»™ä½ åŠæ¡æ•°æ®ï¼Œä¹Ÿå¯èƒ½ä¸€æ¬¡ç»™ä½ ä¸‰æ¡ã€‚å¿…é¡»è¦æœ‰ Buffer æœºåˆ¶ã€‚</li>
</ol>
<p>ç›´æ¥ä¸Šä»£ç ï¼ŒCV ä¹Ÿå°±æ˜¯å¤åˆ¶ç²˜è´´å°±èƒ½ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Taro</span>, { <span class="hljs-title class_">RequestTask</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tarojs/taro'</span>
<span class="hljs-keyword">import</span> { useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-comment">// å‡è®¾ config å’Œ request æ˜¯ä½ é¡¹ç›®é‡Œçš„åŸºç¡€é…ç½®ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢</span>
<span class="hljs-keyword">import</span> { apiUrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/config'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ResChatMessagesDTO</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/request'</span>
<span class="hljs-keyword">import</span> { getAuthorization } <span class="hljs-keyword">from</span> <span class="hljs-string">'~/utils/authorization'</span>
<span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„åº“ï¼Œç”¨äºåœ¨å°ç¨‹åºç¯å¢ƒè§£ç  Uint8Array</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">TextEncoding</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'text-encoding-shim'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ChatMessage</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">ResChatMessagesDTO</span>, <span class="hljs-string">'id'</span>&gt; &amp; { id?: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> }

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useSSE</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æœ€ç»ˆå±•ç¤ºåœ¨ UI ä¸Šçš„å†…å®¹ï¼ˆç»è¿‡æ‰“å­—æœºæ•ˆæœå¤„ç†ï¼‰</span>
  <span class="hljs-keyword">const</span> [displayContent, setDisplayContent] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  <span class="hljs-comment">// å®Œæ•´çš„å†…å®¹ï¼ˆåå°å®æ—¶æ¥æ”¶åˆ°çš„ï¼‰</span>
  <span class="hljs-keyword">const</span> [content, setContent] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>)
  
  <span class="hljs-comment">// ç¼“å†²æ± ï¼Œç”¨äºå¹³æ»‘æ‰“å­—æœºæ•ˆæœ</span>
  <span class="hljs-keyword">const</span> bufferRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">const</span> typingTimerRef = useRef&lt;<span class="hljs-built_in">any</span>&gt;(<span class="hljs-literal">null</span>)
  <span class="hljs-keyword">const</span> typingSpeedRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">120</span>) <span class="hljs-comment">// æ‰“å­—é€Ÿåº¦ ms</span>
  <span class="hljs-keyword">const</span> typingStepRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">1</span>)    <span class="hljs-comment">// æ¯æ¬¡æ¸²æŸ“å­—ç¬¦æ•°</span>
  
  <span class="hljs-keyword">let</span> <span class="hljs-attr">requestTask</span>: <span class="hljs-title class_">RequestTask</span>&lt;<span class="hljs-built_in">any</span>&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

  <span class="hljs-comment">/**
   * å°†æ¥æ”¶åˆ°çš„ç‰‡æ®µè¿½åŠ åˆ°ç¼“å†²æ± ï¼Œå¹¶å¯åŠ¨æ‰“å­—æœº
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">appendChunk</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">if</span> (!text) <span class="hljs-keyword">return</span>
    bufferRef.<span class="hljs-property">current</span> += text
    <span class="hljs-title function_">setContent</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> prev + text)
    
    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰å®šæ—¶å™¨åœ¨è·‘ï¼Œå°±å¯åŠ¨ä¸€ä¸ª</span>
    <span class="hljs-keyword">if</span> (!typingTimerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> msPerChar = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-number">1000</span> / typingSpeedRef.<span class="hljs-property">current</span>))
      typingTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (!bufferRef.<span class="hljs-property">current</span>) {
          <span class="hljs-keyword">return</span>
        }
        <span class="hljs-keyword">const</span> step = typingStepRef.<span class="hljs-property">current</span>
        <span class="hljs-comment">// ä»ç¼“å†²æ± å¤´éƒ¨åˆ‡å‡ºå­—ç¬¦</span>
        <span class="hljs-keyword">const</span> take = bufferRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, step)
        bufferRef.<span class="hljs-property">current</span> = bufferRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">slice</span>(step)
        <span class="hljs-title function_">setDisplayContent</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> prev + take)
      }, msPerChar)
    }
  }

  <span class="hljs-comment">/**
   * åŠ¨æ€è°ƒæ•´æ‰“å­—æœºé€Ÿåº¦ï¼ˆå¯é€‰ï¼‰
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">setTyping</span>(<span class="hljs-params">opts: { speed?: <span class="hljs-built_in">number</span>; step?: <span class="hljs-built_in">number</span> } = {}</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.<span class="hljs-property">speed</span> === <span class="hljs-string">'number'</span> &amp;&amp; opts.<span class="hljs-property">speed</span> &gt; <span class="hljs-number">0</span>) {
      typingSpeedRef.<span class="hljs-property">current</span> = opts.<span class="hljs-property">speed</span>
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.<span class="hljs-property">step</span> === <span class="hljs-string">'number'</span> &amp;&amp; opts.<span class="hljs-property">step</span> &gt; <span class="hljs-number">0</span>) {
      typingStepRef.<span class="hljs-property">current</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">1</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(opts.<span class="hljs-property">step</span>))
    }
    <span class="hljs-comment">// é‡ç½®å®šæ—¶å™¨é€»è¾‘ç•¥...ï¼ˆå‚è€ƒå®Œæ•´ä»£ç ï¼‰</span>
  }

  <span class="hljs-comment">/**
   * å‘èµ·å¯¹è¯è¯·æ±‚
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">params: ChatMessage</span>) {
    <span class="hljs-keyword">const</span> url = apiUrl + <span class="hljs-string">'/api/web/member/v1/pets/stream/chat'</span>
    <span class="hljs-keyword">const</span> header = {
      <span class="hljs-title class_">Authorization</span>: <span class="hljs-title function_">getAuthorization</span>(),
      <span class="hljs-title class_">Accept</span>: <span class="hljs-string">'text/event-stream'</span>, <span class="hljs-comment">// å‘Šè¯‰æœåŠ¡ç«¯æˆ‘è¦æµ</span>
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    }

    <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span> <span class="hljs-comment">// ç”¨äºå¤„ç† SSE åˆ†åŒ…/ç²˜åŒ…çš„å±€éƒ¨ buffer</span>

    <span class="hljs-comment">// è§£ç å™¨ï¼šArrayBuffer -&gt; String</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">arr: <span class="hljs-built_in">ArrayBuffer</span> | <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arr === <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> arr
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> uint8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoding</span>.<span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">'utf-8'</span>).<span class="hljs-title function_">decode</span>(uint8Array)
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-comment">// é™çº§å¤„ç†</span>
        <span class="hljs-keyword">const</span> ints = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr)
        <span class="hljs-keyword">let</span> str = <span class="hljs-string">''</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; ints.<span class="hljs-property">length</span>; i++) {
          str += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(ints[i])
        }
        <span class="hljs-keyword">return</span> str
      }
    }

    <span class="hljs-comment">// SSE åè®®è§£æå™¨</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseSSE</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span>[] {
      buffer += text
      <span class="hljs-comment">// SSE æ¶ˆæ¯é€šå¸¸ä»¥ \n\n ç»“å°¾</span>
      <span class="hljs-keyword">const</span> blocks = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>).<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">b</span>) =&gt;</span> b.<span class="hljs-title function_">trim</span>().<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>)
      
      <span class="hljs-comment">// å¦‚æœæœ€åä¸€ä¸ªå—ä¸æ˜¯ä»¥ \n\n ç»“å°¾ï¼Œè¯´æ˜æ•°æ®æ²¡ä¼ å®Œï¼Œæ”¾å› buffer ç­‰å¾…ä¸‹ä¸€æ¬¡</span>
      <span class="hljs-keyword">if</span> (!buffer.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'\n\n'</span>) &amp;&amp; blocks.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        buffer = blocks.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">''</span>
      } <span class="hljs-keyword">else</span> {
        buffer = <span class="hljs-string">''</span>
      }
      
      <span class="hljs-keyword">const</span> <span class="hljs-attr">out</span>: <span class="hljs-built_in">string</span>[] = []
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> blk <span class="hljs-keyword">of</span> blocks) {
        <span class="hljs-keyword">const</span> lines = blk.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
        <span class="hljs-comment">// æå– data: å¼€å¤´çš„æ•°æ®</span>
        <span class="hljs-keyword">const</span> dataLines = lines.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> l.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data:'</span>))
        <span class="hljs-keyword">if</span> (dataLines.<span class="hljs-property">length</span>) {
          <span class="hljs-keyword">const</span> payload = dataLines.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">l</span>) =&gt;</span> l.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^data:\s*/</span>, <span class="hljs-string">''</span>)).<span class="hljs-title function_">join</span>(<span class="hljs-string">'  \n'</span>)
          out.<span class="hljs-title function_">push</span>(payload)
        }
      }
      <span class="hljs-keyword">return</span> out
    }

    <span class="hljs-comment">// ğŸš€ æ ¸å¿ƒè¯·æ±‚é€»è¾‘</span>
    requestTask = <span class="hljs-title class_">Taro</span>.<span class="hljs-title function_">request</span>({
      url,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      header,
      <span class="hljs-attr">data</span>: params,
      <span class="hljs-attr">enableChunked</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ğŸ‘ˆ å¼€å¯åˆ†å—ä¼ è¾“ï¼Œå…³é”®ï¼</span>
      <span class="hljs-attr">responseType</span>: <span class="hljs-string">'arraybuffer'</span>, <span class="hljs-comment">// ğŸ‘ˆ å¿…é¡»æ¥æ”¶äºŒè¿›åˆ¶ï¼Œå¦åˆ™ä¸­æ–‡ä¹±ç </span>
      <span class="hljs-attr">enableHttp2</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ğŸ‘ˆ é¿å… HTTP/2 åè®®æŠ¥é”™ï¼Œåé¢ä¼šç»†è¯´</span>
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">60000</span>,
      <span class="hljs-attr">success</span>: <span class="hljs-function">() =&gt;</span> {},
      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚é”™è¯¯'</span>, err),
      <span class="hljs-attr">complete</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¯·æ±‚å®Œæˆ'</span>)
    })

    requestTask.<span class="hljs-title function_">onHeadersReceived</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¿æ¥æˆåŠŸ'</span>))
    
    <span class="hljs-comment">// ç›‘å¬æ•°æ®åŒ…</span>
    requestTask.<span class="hljs-title function_">onChunkReceived</span>(<span class="hljs-function">(<span class="hljs-params">res: { data: <span class="hljs-built_in">ArrayBuffer</span> }</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> text = <span class="hljs-title function_">decode</span>(res.<span class="hljs-property">data</span>)
      <span class="hljs-keyword">const</span> msgs = <span class="hljs-title function_">parseSSE</span>(text)
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> msgs) {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥åšä¸€äº›ç‰¹æ®Šçš„å­—ç¬¦å¤„ç†ï¼Œæ¯”å¦‚ markdown çš„å¤„ç†</span>
        <span class="hljs-keyword">const</span> _chunk = <span class="hljs-title class_">String</span>(chunk).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(#+)/</span>, <span class="hljs-string">'$1 '</span>)
        <span class="hljs-title function_">appendChunk</span>(_chunk)
      }
    })
  }

  <span class="hljs-keyword">return</span> {
    chat,
    <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (requestTask) {
        requestTask.<span class="hljs-title function_">abort</span>()
        requestTask = <span class="hljs-literal">null</span>
      }
      <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨é€»è¾‘...</span>
    },
    content,
    displayContent, <span class="hljs-comment">// UI ç»‘å®šè¿™ä¸ª</span>
    setTyping
  }
}
</code></pre>
<h3 data-id="heading-4">3. UI ç»„ä»¶å®ç°ï¼šMarkdown æ¸²æŸ“ + å…‰æ ‡åŠ¨ç”»</h3>
<p>å‰ç«¯å±•ç¤ºä¸ä»…è¦æµå¼å‡ºå­—ï¼Œè¿˜å¾—æ”¯æŒ Markdownï¼ˆä»£ç é«˜äº®ã€è¡¨æ ¼ç­‰ï¼‰ã€‚å°ç¨‹åºé‡Œæ¨èä½¿ç”¨ <code>towxml</code> æˆ–ç±»ä¼¼çš„åº“ã€‚åŒæ—¶ï¼Œä¸ºäº†æ‹ŸçœŸï¼Œæˆ‘ä»¬åŠ ä¸ªé—ªçƒçš„å…‰æ ‡ã€‚</p>
<p><code>index.tsx</code>:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { memo, <span class="hljs-variable constant_">FC</span>, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tarojs/components'</span>
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./index.module.less'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatMessage</span>, useSSE } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../useSSE'</span>
<span class="hljs-comment">// å‡è®¾ä½ å¼•å…¥äº† towxml ç»„ä»¶</span>
<span class="hljs-keyword">import</span> towxmlFun <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../../components/towxml'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MMLoading</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@wmeimob/taro-design'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IStreamMessasgeProps</span> {
  <span class="hljs-attr">params</span>: <span class="hljs-title class_">ChatMessage</span>
  showTip?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Component</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">IStreamMessasgeProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { params, showTip = <span class="hljs-literal">true</span> } = props
  <span class="hljs-keyword">const</span> { chat, displayContent } = <span class="hljs-title function_">useSSE</span>()

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">chat</span>(params)
  }, [])

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.chatItem_ai}</span>&gt;</span>
      {!displayContent ? (
        // æ€è€ƒæ—¶çš„ Loading çŠ¶æ€
        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.ai_loading}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>AI æ­£åœ¨ç–¯ç‹‚çƒ§è„‘ä¸­...<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">MMLoading</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.aiBubble}</span>&gt;</span>
            {/* Markdown æ¸²æŸ“åŒºåŸŸ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">towxml</span> <span class="hljs-attr">nodes</span>=<span class="hljs-string">{towxmlFun(displayContent,</span> '<span class="hljs-attr">markdown</span>')} /&gt;</span>
            {/* æ¨¡æ‹Ÿå…‰æ ‡ */}
            <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.cursor}</span> /&gt;</span> 
          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
          {showTip &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.aiTitle}</span>&gt;</span>å›ç­”ç”±AIç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒå¤‡ä»½<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>}
        <span class="hljs-tag">&lt;/&gt;</span></span>
      )}
    &lt;/<span class="hljs-title class_">View</span>&gt;
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">memo</span>(<span class="hljs-title class_">Component</span>)
</code></pre>
<p><code>index.module.less</code> (å…‰æ ‡åŠ¨ç”»):</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.cursor</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">vertical-align</span>: bottom;
  <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> step-start infinite;
}

<span class="hljs-keyword">@keyframes</span> blink {
  <span class="hljs-number">50%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }
}
</code></pre>
<h2 data-id="heading-5">ğŸŒ©ï¸ æœåŠ¡ç«¯é…ç½®ï¼šNginx çš„é‚£äº›å‘</h2>
<p>å¾ˆå¤šåŒå­¦å‰ç«¯ä»£ç å†™å¾—å®Œç¾æ— ç¼ºï¼Œä¸€è·‘èµ·æ¥ï¼š<strong>è¦ä¹ˆå¡é¡¿ï¼Œè¦ä¹ˆæŠ¥é”™ï¼Œè¦ä¹ˆå¹²è„†ä¸æµå¼ç›´æ¥è¿”å›ä¸€å¨æ•°æ®ã€‚</strong></p>
<p>è¿™é”…é€šå¸¸å¾— Nginx èƒŒã€‚ğŸ™…â€â™‚ï¸</p>
<p>Nginx é»˜è®¤ä¼šå¼€å¯ç¼“å†²ï¼ˆBufferingï¼‰ï¼Œå®ƒæƒ³å­˜å¤Ÿä¸€æ³¢æ•°æ®å†å‘ç»™å®¢æˆ·ç«¯ï¼Œè¿™ç›´æ¥æŠŠæˆ‘ä»¬çš„â€œæµâ€ç»™æˆªæ–­äº†ã€‚</p>
<h3 data-id="heading-6">1. é»„é‡‘ Nginx é…ç½®</h3>
<p>è¯·æŠŠè¿™æ®µé…ç½®ç„Šæ­»åœ¨ä½ çš„ Nginx é…ç½®æ–‡ä»¶é‡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">location /api/web/member/v1/pets/stream/chat {
    <span class="hljs-comment"># 1. å…³é”®ï¼šå…³é—­æ‰€æœ‰ç¼“å†²</span>
    proxy_buffering off<span class="hljs-comment">;</span>
    proxy_cache off<span class="hljs-comment">;</span>
    proxy_request_buffering off<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 2. ç¦ç”¨ gzip å‹ç¼© (å‹ç¼©éœ€è¦ç¼“å†²åŒºï¼Œä¼šç ´åæµå¼)</span>
    gzip off<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 3. HTTP åè®®è®¾ç½®</span>
    proxy_http_version 1.1<span class="hljs-comment">;</span>
    proxy_set_header Connection ''<span class="hljs-comment">; # æ¸…ç©º Connection å¤´ï¼Œä¿æŒé•¿è¿æ¥</span>

    <span class="hljs-comment"># 4. ç¼–ç è®¾ç½®</span>
    chunked_transfer_encoding on<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 5. ç¦ç”¨ Nginx çš„åŠ é€Ÿç¼“å†² (X-Accel-Buffering)</span>
    proxy_set_header X-Accel-Buffering no<span class="hljs-comment">;</span>
    proxy_hide_header X-Accel-Buffering<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 6. è¶…æ—¶è®¾ç½® (æµå¼å“åº”é€šå¸¸æ—¶é—´è¾ƒé•¿)</span>
    proxy_read_timeout 24h<span class="hljs-comment">;</span>
    proxy_send_timeout 24h<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 7. å“åº”å¤´å¤„ç†</span>
    add_header Cache-Control "no-cache"<span class="hljs-comment">;</span>
    add_header X-Accel-Buffering "no"<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 8. å¼ºåˆ¶å°ç¼“å†²åŒº (é¿å… Nginx è‡ªä½œä¸»å¼ å­˜æ•°æ®)</span>
    proxy_buffer_size 1k<span class="hljs-comment">;</span>
    proxy_buffers 4 1k<span class="hljs-comment">;</span>
    proxy_busy_buffers_size 1k<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># è½¬å‘åˆ°ä½ çš„åç«¯æœåŠ¡...</span>
    proxy_pass http://backend_service<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-7">ğŸ› å¸¸è§æŠ¥é”™ä¸ç¥å‘æ’æŸ¥</h2>
<p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™ä¸¤ä¸ªâ€œé¡¶çº§â€é”™è¯¯ï¼Œæˆ‘éƒ½ç¢°åˆ°è¿‡ï¼Œè¿™é‡Œç›´æ¥ç»™è§£æ³•ã€‚</p>
<h3 data-id="heading-8">âŒ é”™è¯¯ 1: <code>net::ERR_INCOMPLETE_CHUNKED_ENCODING</code></h3>
<p><strong>ç°è±¡</strong>ï¼š æ§åˆ¶å°æŠ¥é”™ <code>POST net::ERR_INCOMPLETE_CHUNKED_ENCODING 200</code>ã€‚è™½ç„¶çŠ¶æ€ç æ˜¯ 200ï¼Œæ•°æ®ä¹Ÿæ”¶åˆ°äº†ï¼Œä½†å°±æ˜¯çº¢ä¸€ç‰‡ã€‚</p>
<p><strong>åŸå› </strong>ï¼š è¿™æ˜¯å› ä¸ºæœåŠ¡ç«¯å‘Šè¯‰å®¢æˆ·ç«¯ <code>Transfer-Encoding: chunked</code>ï¼Œä½†åœ¨æµç»“æŸæ—¶ï¼Œæ²¡æœ‰å‘é€æ ‡å‡†çš„ç»ˆæ­¢å—ï¼ˆ<code>0\r\n\r\n</code>ï¼‰ï¼Œæˆ–è€…ä¸­é—´ä»£ç†ï¼ˆæ¯”å¦‚å…¬å¸ç½‘å…³ã€WAFï¼‰æå‰æŠŠè¿æ¥åˆ‡æ–­äº†ã€‚</p>
<p><strong>è§£æ³•</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥åç«¯ä»£ç ï¼Œç¡®ä¿æµç»“æŸæ—¶æ­£ç¡®å…³é—­äº† Writerã€‚</li>
<li>å¦‚æœåœ¨å¼€å‘å·¥å…·é‡Œçœ‹åˆ°è¿™ä¸ªï¼Œåªè¦æ•°æ®æ¥æ”¶å®Œæ•´ï¼Œ<strong>å¯ä»¥å¿½ç•¥</strong>ã€‚è¿™å¾€å¾€æ˜¯å¼€å‘å·¥å…·å¯¹è¿æ¥å…³é—­çŠ¶æ€çš„è¯¯åˆ¤ã€‚</li>
</ol>
<h3 data-id="heading-9">âŒ é”™è¯¯ 2: <code>net::ERR_HTTP2_PROTOCOL_ERROR</code></h3>
<p><strong>ç°è±¡</strong>ï¼š æµå¼ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œéšæœºä¸­æ–­ï¼ŒæŠ¥é”™ <code>net::ERR_HTTP2_PROTOCOL_ERROR</code>ã€‚</p>
<p><strong>ç¡¬æ ¸åˆ†æ</strong>ï¼š è¿™æ˜¯å¾®ä¿¡å°ç¨‹åºç½‘ç»œæ ˆåœ¨ <strong>HTTP/2</strong> ä¸‹å¤„ç† <strong>Chunked å“åº”</strong> çš„å·²çŸ¥ä¸ç¨³å®šç‚¹ã€‚å½“ä½ çš„åŸŸåå¼€å¯äº† HTTP/2ï¼Œä¸”ä½¿ç”¨äº† <code>wx.request</code> + <code>enableChunked</code> æ—¶ï¼Œå¾®ä¿¡å®¢æˆ·ç«¯åº•å±‚åœ¨å¤„ç†åˆ†å—æ—¶æå…¶å®¹æ˜“å´©æºƒã€‚</p>
<p><strong>ç»ˆæè§£æ³•</strong>ï¼š <strong>é™çº§åˆ° HTTP/1.1</strong>ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨å‰ç«¯ä»£ç é‡Œå†™äº† <code>enableHttp2: false</code>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">requestTask = Taro.<span class="hljs-built_in">request</span>({
  <span class="hljs-comment">// ... å…¶ä»–é…ç½®</span>
  enableHttp2: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ğŸ‘ˆ æ•‘å‘½ç¨»è‰</span>
})
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šæœ‰æ—¶å€™å‰ç«¯è®¾ç½® <code>enableHttp2: false</code> è¿˜ä¸å¤Ÿï¼Œå› ä¸ºå¾®ä¿¡åº•å±‚å¯èƒ½è¿˜æ˜¯ä¼šå¤ç”¨ä¹‹å‰çš„ H2 è¿æ¥ã€‚æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯ <strong>æœåŠ¡ç«¯é’ˆå¯¹è¯¥æµå¼æ¥å£å¼ºåˆ¶åªèµ° HTTP/1.1</strong>ï¼Œæˆ–è€…å¹²è„†æŠŠæµå¼æ¥å£æŒ‚è½½åˆ°ä¸€ä¸ªæ²¡æœ‰å¼€å¯ H2 çš„å­åŸŸåä¸‹ã€‚</p>
<h2 data-id="heading-10">ğŸ“ æ€»ç»“</h2>
<p>åœ¨å°ç¨‹åºé‡Œåšå¤§æ¨¡å‹æµå¼è¾“å‡ºï¼Œå…¶å®å°±æ˜¯ä¸€åœº <strong>â€œå‰ç«¯ + ç½‘ç»œ + åç«¯â€</strong> çš„ç»¼åˆæˆ˜å½¹ã€‚</p>
<ol>
<li><strong>å‰ç«¯</strong>ï¼šTaro + <code>enableChunked</code> æ˜¯åŸºç¡€ï¼ŒTextDecoder + Buffer é˜Ÿåˆ—æ˜¯æ ¸å¿ƒã€‚</li>
<li><strong>ä½“éªŒ</strong>ï¼šä¸è¦ç›´æ¥æ¸²æŸ“ï¼Œç”¨å®šæ—¶å™¨åšä¸ªç¼“å†²æ± ï¼Œæ¨¡æ‹Ÿâ€œæ‰“å­—æœºâ€æ•ˆæœï¼Œä¸æ»‘åº¦æå‡ 10 å€ã€‚</li>
<li><strong>åç«¯</strong>ï¼šNginx å¿…é¡»å…³é—­ Bufferingï¼Œå¦åˆ™æµå¼å˜é˜»å¡ã€‚</li>
<li><strong>é¿å‘</strong>ï¼šHTTP/2 æ˜¯æµå¼çš„å¤§æ•Œï¼Œé‡åˆ°è¯¡å¼‚æ–­è¿ï¼Œè¯·æœæ–­åˆ‡å› HTTP/1.1ã€‚</li>
</ol>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å°‘æ‰å‡ æ ¹å¤´å‘ï¼å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œ<strong>ç‚¹èµã€æ”¶è—ã€è½¬å‘</strong> ä¸‰è¿èµ°èµ·ï¼ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WXT æ¡†æ¶ä¸‹çš„ Window å¯¹è±¡è·å–]]></title>    <link>https://juejin.cn/post/7575469988737007625</link>    <guid>https://juejin.cn/post/7575469988737007625</guid>    <pubDate>2025-11-24T01:24:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575469988737007625" data-draft-id="7575182522411302950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WXT æ¡†æ¶ä¸‹çš„ Window å¯¹è±¡è·å–"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨"/> <meta itemprop="datePublished" content="2025-11-24T01:24:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å®ä¹ ç”Ÿå°é»„"/> <meta itemprop="url" content="https://juejin.cn/user/3246201392868637"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WXT æ¡†æ¶ä¸‹çš„ Window å¯¹è±¡è·å–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3246201392868637/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å®ä¹ ç”Ÿå°é»„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T01:24:23.000Z" title="Mon Nov 24 2025 01:24:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨æµè§ˆå™¨æ‰©å±•å¼€å‘ä¸­ï¼ŒContent Scriptï¼ˆå†…å®¹è„šæœ¬ï¼‰è¿è¡Œåœ¨ä¸ç½‘é¡µç›¸åŒçš„ç¯å¢ƒä¸­ï¼Œä½†ç”±äºå…¶å¤„äºéš”ç¦»çš„æ‰§è¡Œç¯å¢ƒï¼ˆIsolated Worldï¼‰ï¼Œæ— æ³•ç›´æ¥è®¿é—®ç½‘é¡µçš„ JavaScript ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ <code>window</code> å¯¹è±¡çš„è‡ªå®šä¹‰å±æ€§ã€‚è¿™åœ¨éœ€è¦è·å–é¡µé¢ç‰¹å®šæ•°æ®æ—¶ï¼ˆå¦‚ Etsy åº—é“ºçš„ <code>shopId</code>ã€è®¢å•çŠ¶æ€ç­‰ï¼‰ä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>æœ¬æ–‡æ¡£åŸºäºå®é™…é¡¹ç›®ç»éªŒï¼Œè¯¦ç»†ä»‹ç»äº†åœ¨ WXT æ¡†æ¶ä¸‹è·å–é¡µé¢ <code>window</code> å¯¹è±¡çš„å‡ ç§æ–¹æ¡ˆï¼Œå¹¶æä¾›äº†å®Œæ•´çš„å®ç°ä»£ç å’Œå¯¹æ¯”åˆ†æã€‚</p>
<h2 data-id="heading-1">éœ€æ±‚</h2>
<p>åœ¨å¼€å‘ Etsy è®¢å•ç®¡ç†æ‰©å±•æ—¶ï¼Œéœ€è¦ä»é¡µé¢çš„ <code>window</code> å¯¹è±¡ä¸­è·å–ä»¥ä¸‹æ•°æ®ï¼š</p>
<ol>
<li><strong>åº—é“º IDï¼ˆshopIdï¼‰</strong>ï¼š<code>window.Etsy.Context.data.shop_id</code></li>
<li><strong>è®¢å•çŠ¶æ€åˆ—è¡¨ï¼ˆorderStatesï¼‰</strong>ï¼š<code>window.Etsy.Context.data.order_states</code></li>
</ol>
<p>è¿™äº›æ•°æ®å­˜å‚¨åœ¨é¡µé¢çš„ä¸»ä¸–ç•Œï¼ˆMain Worldï¼‰ä¸­ï¼Œè€Œ Content Script è¿è¡Œåœ¨éš”ç¦»ä¸–ç•Œï¼ˆIsolated Worldï¼‰ï¼Œæ— æ³•ç›´æ¥è®¿é—®ã€‚</p>
<h2 data-id="heading-2">æ–¹æ¡ˆ</h2>
<h3 data-id="heading-3">æ–¹æ¡ˆä¸€ï¼šweb_accessible_resources + window.postMessage</h3>
<h4 data-id="heading-4">åŸç†</h4>
<p>é€šè¿‡åœ¨ <code>manifest.json</code> ä¸­é…ç½® <code>web_accessible_resources</code>ï¼Œå°†è„šæœ¬æ–‡ä»¶æ³¨å…¥åˆ°é¡µé¢çš„ä¸»ä¸–ç•Œï¼ˆMain Worldï¼‰ï¼Œä½¿å…¶èƒ½å¤Ÿç›´æ¥è®¿é—®é¡µé¢çš„ <code>window</code> å¯¹è±¡ã€‚ä½¿ç”¨ <code>window.postMessage</code> åœ¨ Content Script å’Œæ³¨å…¥è„šæœ¬ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡ã€‚</p>
<h4 data-id="heading-5">å®ç°æµç¨‹</h4>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ³¨å…¥è„šæœ¬æ–‡ä»¶ï¼ˆå¦‚ <code>page-inject.js</code>ï¼‰ï¼Œç”¨äºåœ¨ä¸»ä¸–ç•Œä¸­æ‰§è¡Œä»£ç </li>
<li>åœ¨ <code>wxt.config.ts</code> ä¸­é…ç½® <code>web_accessible_resources</code>ï¼Œå°†è„šæœ¬æŒ‡å®šä¸ºå¯è®¿é—®èµ„æº</li>
<li>åœ¨ Content Script ä¸­åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œå°†è„šæœ¬æ³¨å…¥åˆ°é¡µé¢ä¸­</li>
<li>ä½¿ç”¨ <code>window.postMessage</code> åœ¨ Content Script å’Œæ³¨å…¥è„šæœ¬ä¹‹é—´è¿›è¡Œé€šä¿¡</li>
</ol>
<h4 data-id="heading-6">ä»£ç å®ç°</h4>
<p><strong>1. åˆ›å»ºæ³¨å…¥è„šæœ¬ï¼ˆ<code>public/page-inject.js</code>ï¼‰</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * æ³¨å…¥åˆ°é¡µé¢ä¸»ä¸–ç•Œçš„è„šæœ¬
 * ç”¨äºç›´æ¥è®¿é—®é¡µé¢çš„ window å¯¹è±¡ï¼Œè·å– Etsy ç›¸å…³æ•°æ®
 */</span>
(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-string">"use strict"</span>;

  <span class="hljs-comment">// ç›‘å¬æ¥è‡ªéš”ç¦»ä¸–ç•Œï¼ˆISOLATED worldï¼‰çš„ content script çš„æ¶ˆæ¯</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
    <span class="hljs-comment">// ç¡®ä¿æ¶ˆæ¯æ¥è‡ªå½“å‰çª—å£</span>
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> !== <span class="hljs-variable language_">window</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// æ£€æŸ¥æ¶ˆæ¯ç±»å‹</span>
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> &amp;&amp; event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">"get-etsy-data"</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// åœ¨ä¸»ä¸–ç•Œä¸­ç›´æ¥è®¿é—® window.Etsy.Context.data å¯¹è±¡</span>
        <span class="hljs-keyword">const</span> etsyData = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Etsy</span>?.<span class="hljs-property">Context</span>?.<span class="hljs-property">data</span>;

        <span class="hljs-keyword">if</span> (etsyData) {
          <span class="hljs-keyword">const</span> shopId = etsyData.<span class="hljs-property">shop_id</span>;
          <span class="hljs-keyword">const</span> orderStates = etsyData.<span class="hljs-property">order_states</span>;

          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âœ… [ä¸»ä¸–ç•Œ] æˆåŠŸè·å– Etsy æ•°æ®"</span>);

          <span class="hljs-comment">// å‘é€å“åº”å›éš”ç¦»ä¸–ç•Œ</span>
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
            {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"etsy-data-response"</span>,
              <span class="hljs-attr">requestId</span>: event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span>,
              <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">shopId</span>: shopId,
              <span class="hljs-attr">orderStates</span>: orderStates,
            },
            <span class="hljs-string">"*"</span>
          );
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// å‘é€é”™è¯¯å“åº”</span>
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
            {
              <span class="hljs-attr">type</span>: <span class="hljs-string">"etsy-data-response"</span>,
              <span class="hljs-attr">requestId</span>: event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span>,
              <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">error</span>: <span class="hljs-string">"æ— æ³•è·å– Etsy æ•°æ®ï¼Œè¯·ç¡®ä¿åœ¨ Etsy åº—é“ºç®¡ç†é¡µé¢æ‰“å¼€æ­¤æ‰©å±•"</span>,
            },
            <span class="hljs-string">"*"</span>
          );
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// å‘é€é”™è¯¯å“åº”</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
          {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"etsy-data-response"</span>,
            <span class="hljs-attr">requestId</span>: event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span>,
            <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">error</span>: error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">"æœªçŸ¥é”™è¯¯"</span>,
          },
          <span class="hljs-string">"*"</span>
        );
      }
    }
  });

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âœ… [ä¸»ä¸–ç•Œ] page-inject.js å·²åŠ è½½ï¼Œå¯ä»¥è®¿é—® window.Etsy å¯¹è±¡"</span>);
})();
</code></pre>
<p><strong>2. é…ç½® WXTï¼ˆ<code>wxt.config.ts</code>ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'wxt'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">modules</span>: [<span class="hljs-string">'@wxt-dev/module-vue'</span>],
  <span class="hljs-attr">manifest</span>: {
    <span class="hljs-attr">web_accessible_resources</span>: [
      {
        <span class="hljs-attr">resources</span>: [<span class="hljs-string">'page-inject.js'</span>],
        <span class="hljs-attr">matches</span>: [<span class="hljs-string">'*://*.etsy.com/*'</span>],
        <span class="hljs-attr">use_dynamic_url</span>: <span class="hljs-literal">true</span>,
      },
    ],
  },
});
</code></pre>
<p><strong>3. Content Script å®ç°ï¼ˆ<code>entrypoints/content.ts</code>ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * æ³¨å…¥è„šæœ¬åˆ°é¡µé¢ä¸»ä¸–ç•Œ
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">injectScript</span>(<span class="hljs-params">scriptPath: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-comment">// æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²ç»æ³¨å…¥</span>
    <span class="hljs-keyword">const</span> scriptId = <span class="hljs-string">`injected-script-<span class="hljs-subst">${scriptPath}</span>`</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(scriptId)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`âœ… [éš”ç¦»ä¸–ç•Œ] è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> å·²å­˜åœ¨ï¼Œè·³è¿‡æ³¨å…¥`</span>);
      <span class="hljs-title function_">resolve</span>();
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"script"</span>);
    script.<span class="hljs-property">id</span> = scriptId;
    script.<span class="hljs-property">src</span> = browser.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(scriptPath <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);
    script.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`âœ… [éš”ç¦»ä¸–ç•Œ] è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> æ³¨å…¥æˆåŠŸ`</span>);
      <span class="hljs-title function_">resolve</span>();
    };
    script.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`âŒ [éš”ç¦»ä¸–ç•Œ] è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> æ³¨å…¥å¤±è´¥`</span>);
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`è„šæœ¬ <span class="hljs-subst">${scriptPath}</span> æ³¨å…¥å¤±è´¥`</span>));
    };
    (<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(script);
  });
}

<span class="hljs-comment">/**
 * é€šè¿‡ postMessage ä¸ä¸»ä¸–ç•Œè„šæœ¬é€šä¿¡ï¼Œè·å– Etsy æ•°æ®
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getEtsyDataFromMainWorld</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;{
  <span class="hljs-attr">success</span>: <span class="hljs-built_in">boolean</span>;
  shopId?: <span class="hljs-built_in">number</span>;
  orderStates?: <span class="hljs-title class_">OrderState</span>[];
  error?: <span class="hljs-built_in">string</span>;
}&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">async</span> (resolve, reject) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// ç¡®ä¿æ³¨å…¥è„šæœ¬å·²åŠ è½½</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">injectScript</span>(<span class="hljs-string">"page-inject.js"</span>);

      <span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€çš„è¯·æ±‚ ID</span>
      <span class="hljs-keyword">const</span> requestId = <span class="hljs-string">`etsy-data-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>-<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random()}</span>`</span>;

      <span class="hljs-comment">// è®¾ç½®è¶…æ—¶ï¼Œé¿å…æ— é™ç­‰å¾…</span>
      <span class="hljs-keyword">const</span> timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"message"</span>, handleResponse);
        <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"è·å– Etsy æ•°æ®è¶…æ—¶ï¼Œä¸»ä¸–ç•Œè„šæœ¬å¯èƒ½æœªå“åº”"</span>));
      }, <span class="hljs-number">5000</span>); <span class="hljs-comment">// 5ç§’è¶…æ—¶</span>

      <span class="hljs-comment">// å¤„ç†å“åº”</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleResponse</span>(<span class="hljs-params">event: MessageEvent</span>) {
        <span class="hljs-comment">// ç¡®ä¿æ¶ˆæ¯æ¥è‡ªå½“å‰çª—å£</span>
        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> !== <span class="hljs-variable language_">window</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// æ£€æŸ¥æ¶ˆæ¯ç±»å‹å’Œè¯·æ±‚ ID</span>
        <span class="hljs-keyword">if</span> (
          event.<span class="hljs-property">data</span> &amp;&amp;
          event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> === <span class="hljs-string">"etsy-data-response"</span> &amp;&amp;
          event.<span class="hljs-property">data</span>.<span class="hljs-property">requestId</span> === requestId
        ) {
          <span class="hljs-built_in">clearTimeout</span>(timeout);
          <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"message"</span>, handleResponse);

          <span class="hljs-keyword">const</span> { success, shopId, orderStates, error } = event.<span class="hljs-property">data</span>;

          <span class="hljs-keyword">if</span> (success &amp;&amp; shopId !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"âœ… [éš”ç¦»ä¸–ç•Œ] æˆåŠŸä»ä¸»ä¸–ç•Œè·å– Etsy æ•°æ®"</span>);
            <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, shopId, orderStates });
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"âš ï¸ [éš”ç¦»ä¸–ç•Œ] ä»ä¸»ä¸–ç•Œè·å– Etsy æ•°æ®å¤±è´¥:"</span>, error);
            <span class="hljs-title function_">resolve</span>({
              <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
              <span class="hljs-attr">error</span>: error || <span class="hljs-string">"æ— æ³•è·å– Etsy æ•°æ®"</span>,
            });
          }
        }
      }

      <span class="hljs-comment">// ç›‘å¬å“åº”æ¶ˆæ¯</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, handleResponse);

      <span class="hljs-comment">// å‘é€è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"get-etsy-data"</span>,
          <span class="hljs-attr">requestId</span>: requestId,
        },
        <span class="hljs-string">"*"</span>
      );
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ğŸ“¤ [éš”ç¦»ä¸–ç•Œ] å·²å‘é€è·å– Etsy æ•°æ®è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ"</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"âŒ [éš”ç¦»ä¸–ç•Œ] è·å– Etsy æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:"</span>, error);
      <span class="hljs-title function_">reject</span>(error);
    }
  });
}
</code></pre>
<h4 data-id="heading-7">ä¼˜ç‚¹</h4>
<ul>
<li>âœ… å®ç°ç›¸å¯¹ç®€å•ï¼Œé€»è¾‘æ¸…æ™°</li>
<li>âœ… å…¼å®¹æ€§å¥½ï¼Œé€‚ç”¨äºæ‰€æœ‰æ”¯æŒ Manifest V3 çš„æµè§ˆå™¨</li>
<li>âœ… ä½¿ç”¨æ ‡å‡†çš„ <code>postMessage</code> APIï¼Œå®‰å…¨æ€§é«˜</li>
<li>âœ… ä¸éœ€è¦åºåˆ—åŒ–å‡½æ•°ï¼Œé¿å…å®‰å…¨é£é™©</li>
<li>âœ… åœ¨ WXT æ¡†æ¶ä¸­é…ç½®ç®€å•ï¼Œæ˜“äºç»´æŠ¤</li>
</ul>
<h4 data-id="heading-8">ç¼ºç‚¹</h4>
<ul>
<li>âš ï¸ éœ€è¦åœ¨ <code>manifest.json</code> ä¸­é…ç½® <code>web_accessible_resources</code></li>
<li>âš ï¸ éœ€è¦åŠ¨æ€æ³¨å…¥è„šæœ¬ï¼Œå¯èƒ½æœ‰åŠ è½½æ—¶åºé—®é¢˜ï¼ˆå¯é€šè¿‡ <code>onload</code> å›è°ƒè§£å†³ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-9">æ–¹æ¡ˆäºŒï¼šweb_accessible_resources + CustomEvent + å‡½æ•°åºåˆ—åŒ–</h3>
<h4 data-id="heading-10">åŸç†</h4>
<p>åŒæ ·é€šè¿‡ <code>web_accessible_resources</code> æ³¨å…¥è„šæœ¬åˆ°é¡µé¢ä¸»ä¸–ç•Œï¼Œä½†ä½¿ç”¨ <code>CustomEvent</code> è¿›è¡Œé€šä¿¡ï¼Œå¹¶é€šè¿‡å‡½æ•°åºåˆ—åŒ–çš„æ–¹å¼ä¼ é€’å¤æ‚é€»è¾‘ã€‚</p>
<h4 data-id="heading-11">å®ç°æµç¨‹</h4>
<ol>
<li>Content Script å°†éœ€è¦åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„å‡½æ•°åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²</li>
<li>Content Script åˆ›å»ºå¹¶åˆ†å‘ä¸€ä¸ªåŒ…å«åºåˆ—åŒ–å‡½æ•°çš„ <code>CustomEvent</code></li>
<li>æ³¨å…¥è„šæœ¬ç›‘å¬è¯¥äº‹ä»¶ï¼Œååºåˆ—åŒ–å‡½æ•°å¹¶åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ</li>
<li>æ‰§è¡Œç»“æœé€šè¿‡å¦ä¸€ä¸ª <code>CustomEvent</code> ä¼ å› Content Script</li>
</ol>
<h4 data-id="heading-12">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Content Script ä¸­</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getMyData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">Etsy</span>?.<span class="hljs-property">Context</span>?.<span class="hljs-property">data</span>;
}

<span class="hljs-title function_">indexSendMessageToLucky</span>(<span class="hljs-string">'run-index-fun'</span>, {
  <span class="hljs-attr">function</span>: getMyData.<span class="hljs-title function_">toString</span>()
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'res--&gt;'</span>, res)
});

<span class="hljs-comment">// æ³¨å…¥è„šæœ¬ä¸­</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'custom-index-type'</span>, <span class="hljs-keyword">async</span> (e) =&gt; {
  <span class="hljs-keyword">const</span> { type, data } = e.<span class="hljs-property">detail</span>
  <span class="hljs-keyword">switch</span> (type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'run-index-fun'</span>: {
      <span class="hljs-keyword">const</span> fn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">`return (<span class="hljs-subst">${data.<span class="hljs-keyword">function</span>}</span>)(...arguments)`</span>)
      <span class="hljs-keyword">const</span> rs = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(...(data.<span class="hljs-property">args</span> ?? []))
      <span class="hljs-title function_">luckySendMessageToIndex</span>(type, rs)
      <span class="hljs-keyword">break</span>
    }
  }
})
</code></pre>
<h4 data-id="heading-13">ä¼˜ç‚¹</h4>
<ul>
<li>âœ… å¯ä»¥ä¼ é€’å¤æ‚çš„å‡½æ•°é€»è¾‘</li>
<li>âœ… <code>CustomEvent</code> é€šä¿¡æ›´çµæ´»</li>
</ul>
<h4 data-id="heading-14">ç¼ºç‚¹</h4>
<ul>
<li>âŒ ä½¿ç”¨ <code>new Function()</code>ï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼ˆå¯èƒ½å—åˆ° CSP é™åˆ¶ï¼‰</li>
<li>âŒ éœ€è¦åºåˆ—åŒ–å‡½æ•°ï¼Œä»£ç å¤æ‚åº¦è¾ƒé«˜</li>
<li>âŒ åŒæ ·éœ€è¦é…ç½® <code>web_accessible_resources</code></li>
<li>âŒ éœ€è¦å¤„ç† iframe æ£€æµ‹</li>
</ul>
<hr/>
<h3 data-id="heading-15">æ–¹æ¡ˆä¸‰ï¼šworld: "MAIN" é…ç½®</h3>
<h4 data-id="heading-16">åŸç†</h4>
<p>åœ¨ Content Script çš„é…ç½®ä¸­æŒ‡å®š <code>world: "MAIN"</code>ï¼Œä½¿ Content Script ç›´æ¥åœ¨é¡µé¢çš„ä¸»ä¸–ç•Œä¸­æ‰§è¡Œï¼Œä»è€Œç›´æ¥è®¿é—®é¡µé¢çš„ <code>window</code> å¯¹è±¡ã€‚</p>
<h4 data-id="heading-17">å®ç°æµç¨‹</h4>
<ol>
<li>åœ¨ Content Script çš„é…ç½®ä¸­è®¾ç½® <code>world: "MAIN"</code></li>
<li>Content Script ç›´æ¥åœ¨é¡µé¢ä¸»ä¸–ç•Œä¸­æ‰§è¡Œï¼Œè®¿é—® <code>window</code> å¯¹è±¡è·å–æ‰€éœ€æ•°æ®</li>
</ol>
<h4 data-id="heading-18">ä»£ç ç¤ºä¾‹</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineContentScript</span>({
  <span class="hljs-attr">matches</span>: [<span class="hljs-string">"*://*.etsy.com/*"</span>],
  <span class="hljs-attr">runAt</span>: <span class="hljs-string">"document_end"</span>,
  <span class="hljs-attr">world</span>: <span class="hljs-string">"MAIN"</span>, <span class="hljs-comment">// è¿è¡Œåœ¨é¡µé¢ä¸»ä¸–ç•Œ</span>
  <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç›´æ¥è®¿é—® window.Etsy å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> shopId = <span class="hljs-variable language_">window</span>.<span class="hljs-property">Etsy</span>?.<span class="hljs-property">Context</span>?.<span class="hljs-property">data</span>?.<span class="hljs-property">shop_id</span>;
    <span class="hljs-comment">// ...</span>
  },
});
</code></pre>
<h4 data-id="heading-19">ä¼˜ç‚¹</h4>
<ul>
<li>âœ… å®ç°æœ€ç®€å•ï¼Œæ— éœ€é¢å¤–çš„é€šä¿¡æœºåˆ¶</li>
<li>âœ… ä¸éœ€è¦ <code>web_accessible_resources</code> é…ç½®</li>
<li>âœ… æ€§èƒ½æœ€å¥½ï¼Œæ— éœ€åŠ¨æ€æ³¨å…¥è„šæœ¬</li>
<li>âœ… ç¬¦åˆ Manifest V3 çš„æ¨èæ–¹å¼</li>
</ul>
<h4 data-id="heading-20">ç¼ºç‚¹</h4>
<ul>
<li>âŒ <strong>WXT æ¡†æ¶å¯èƒ½ä¸æ”¯æŒ <code>world: "MAIN"</code> é…ç½®</strong>ï¼ˆè¿™æ˜¯å…³é”®é—®é¢˜ï¼‰</li>
<li>âŒ å³ä½¿æ”¯æŒï¼Œé…ç½®å¯èƒ½ä¸ä¼šæ­£ç¡®ç”Ÿæˆåˆ° <code>manifest.json</code> ä¸­</li>
<li>âŒ åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ä¸»ä¸–ç•Œè„šæœ¬æ— æ³•æ­£ç¡®åŠ è½½</li>
</ul>
<hr/>
<h2 data-id="heading-21">æ–¹æ¡ˆå¯¹æ¯”</h2>





















































<table><thead><tr><th>ç‰¹æ€§</th><th>æ–¹æ¡ˆä¸€ï¼ˆpostMessageï¼‰</th><th>æ–¹æ¡ˆäºŒï¼ˆCustomEventï¼‰</th><th>æ–¹æ¡ˆä¸‰ï¼ˆworld: MAINï¼‰</th></tr></thead><tbody><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>ä¸­ç­‰</td><td>è¾ƒé«˜</td><td>ä½ï¼ˆç†è®ºä¸Šï¼‰</td></tr><tr><td><strong>å…¼å®¹æ€§</strong></td><td>âœ… é«˜</td><td>âœ… é«˜</td><td>âŒ ä½ï¼ˆWXT å¯èƒ½ä¸æ”¯æŒï¼‰</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>âœ… é«˜</td><td>âš ï¸ ä¸­ï¼ˆeval é£é™©ï¼‰</td><td>âœ… é«˜</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>âœ… è‰¯å¥½</td><td>âœ… è‰¯å¥½</td><td>âœ… æœ€å¥½</td></tr><tr><td><strong>é…ç½®å¤æ‚åº¦</strong></td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>ä½ï¼ˆç†è®ºä¸Šï¼‰</td></tr><tr><td><strong>CSP é™åˆ¶</strong></td><td>âœ… æ— </td><td>âŒ å¯èƒ½å—é™</td><td>âœ… æ— </td></tr><tr><td><strong>WXT æ”¯æŒ</strong></td><td>âœ… å®Œå…¨æ”¯æŒ</td><td>âœ… å®Œå…¨æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒæˆ–æœªéªŒè¯</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-22">å®é™…æµ‹è¯•</h2>
<h3 data-id="heading-23">æµ‹è¯•ç¯å¢ƒ</h3>
<ul>
<li><strong>æ¡†æ¶</strong>ï¼šWXT v0.20.6</li>
<li><strong>æµè§ˆå™¨</strong>ï¼šChromeï¼ˆManifest V3ï¼‰</li>
<li><strong>ç›®æ ‡ç½‘ç«™</strong>ï¼šEtsy åº—é“ºç®¡ç†é¡µé¢</li>
</ul>
<h3 data-id="heading-24">æ–¹æ¡ˆä¸€æµ‹è¯•ç»“æœ</h3>
<p>âœ… <strong>æˆåŠŸ</strong></p>
<ul>
<li>è„šæœ¬æ³¨å…¥æ­£å¸¸</li>
<li><code>postMessage</code> é€šä¿¡æ­£å¸¸</li>
<li>èƒ½å¤ŸæˆåŠŸè·å– <code>window.Etsy.Context.data</code></li>
<li>æ€§èƒ½è¡¨ç°è‰¯å¥½</li>
</ul>
<p><strong>æµ‹è¯•æ—¥å¿—ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">âœ… <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> è„šæœ¬ page-inject<span class="hljs-selector-class">.js</span> æ³¨å…¥æˆåŠŸ
âœ… <span class="hljs-selector-attr">[ä¸»ä¸–ç•Œ]</span> page-inject<span class="hljs-selector-class">.js</span> å·²åŠ è½½ï¼Œå¯ä»¥è®¿é—® window<span class="hljs-selector-class">.Etsy</span> å¯¹è±¡
ğŸ“¤ <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> å·²å‘é€è·å– Etsy æ•°æ®è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ
âœ… <span class="hljs-selector-attr">[ä¸»ä¸–ç•Œ]</span> æˆåŠŸè·å– Etsy æ•°æ®
âœ… <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> æˆåŠŸä»ä¸»ä¸–ç•Œè·å– Etsy æ•°æ®
</code></pre>
<h3 data-id="heading-25">æ–¹æ¡ˆä¸‰æµ‹è¯•ç»“æœ</h3>
<p>âŒ <strong>å¤±è´¥</strong></p>
<ul>
<li>é…ç½® <code>world: "MAIN"</code> åï¼Œç”Ÿæˆçš„ <code>manifest.json</code> ä¸­å¯èƒ½ä¸åŒ…å«è¯¥é…ç½®</li>
<li>å³ä½¿æ‰‹åŠ¨æ·»åŠ é…ç½®ï¼Œä¸»ä¸–ç•Œè„šæœ¬ä¹Ÿæ— æ³•æ­£ç¡®åŠ è½½</li>
<li>æ§åˆ¶å°å‡ºç°è¶…æ—¶é”™è¯¯ï¼š<code>è·å– shopId è¶…æ—¶ï¼Œä¸»ä¸–ç•Œè„šæœ¬å¯èƒ½æœªåŠ è½½</code></li>
</ul>
<p><strong>æµ‹è¯•æ—¥å¿—ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">ğŸ“¤ <span class="hljs-selector-attr">[éš”ç¦»ä¸–ç•Œ]</span> å·²å‘é€è·å– shopId è¯·æ±‚åˆ°ä¸»ä¸–ç•Œ
âš ï¸ è·å– shopId å¤±è´¥: è·å– shopId è¶…æ—¶ï¼Œä¸»ä¸–ç•Œè„šæœ¬å¯èƒ½æœªåŠ è½½
</code></pre>
<h3 data-id="heading-26">æ–¹æ¡ˆäºŒæµ‹è¯•ç»“æœ</h3>
<p>âš ï¸ <strong>æœªæµ‹è¯•</strong></p>
<ul>
<li>ç”±äºæ–¹æ¡ˆä¸€å·²ç»æ»¡è¶³éœ€æ±‚ï¼Œä¸”æ–¹æ¡ˆäºŒå­˜åœ¨å®‰å…¨é£é™©ï¼Œæœªè¿›è¡Œå®é™…æµ‹è¯•</li>
<li>ç†è®ºä¸Šå¯è¡Œï¼Œä½†ä¸æ¨èä½¿ç”¨</li>
</ul>
<hr/>
<h2 data-id="heading-27">æœ€ç»ˆé‡‡ç”¨</h2>
<p>åŸºäºå®é™…æµ‹è¯•ç»“æœå’Œæ–¹æ¡ˆå¯¹æ¯”ï¼Œ<strong>æœ€ç»ˆé‡‡ç”¨æ–¹æ¡ˆä¸€ï¼ˆweb_accessible_resources + window.postMessageï¼‰</strong>ã€‚</p>
<h3 data-id="heading-28">é€‰æ‹©ç†ç”±</h3>
<ol>
<li><strong>å…¼å®¹æ€§æœ€ä½³</strong>ï¼šåœ¨ WXT æ¡†æ¶ä¸­å®Œå…¨æ”¯æŒï¼Œé…ç½®ç®€å•</li>
<li><strong>å¯é æ€§é«˜</strong>ï¼šç»è¿‡å®é™…æµ‹è¯•ï¼ŒåŠŸèƒ½ç¨³å®šå¯é </li>
<li><strong>å®‰å…¨æ€§å¥½</strong>ï¼šä½¿ç”¨æ ‡å‡†çš„ <code>postMessage</code> APIï¼Œä¸æ¶‰åŠ <code>eval</code> ç­‰å®‰å…¨é£é™©</li>
<li><strong>æ˜“äºç»´æŠ¤</strong>ï¼šä»£ç ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ç®€å•ï¼Œä¾¿äºåç»­ç»´æŠ¤</li>
<li><strong>æ€§èƒ½è‰¯å¥½</strong>ï¼šè™½ç„¶éœ€è¦åŠ¨æ€æ³¨å…¥è„šæœ¬ï¼Œä½†é€šè¿‡ <code>onload</code> å›è°ƒç¡®ä¿æ—¶åºæ­£ç¡®ï¼Œæ€§èƒ½å½±å“å¯å¿½ç•¥</li>
</ol>
<h3 data-id="heading-29">å®Œæ•´å®ç°ä»£ç </h3>
<p>å‚è€ƒæœ¬æ–‡æ¡£çš„"æ–¹æ¡ˆä¸€"éƒ¨åˆ†ï¼ŒåŒ…å«å®Œæ•´çš„ä»£ç å®ç°ã€‚</p>
<hr/>
<h2 data-id="heading-30">æ€»ç»“</h2>
<p>åœ¨ WXT æ¡†æ¶ä¸‹è·å–é¡µé¢ <code>window</code> å¯¹è±¡ï¼Œæ¨èä½¿ç”¨ <strong>web_accessible_resources + window.postMessage</strong> æ–¹æ¡ˆã€‚è™½ç„¶ç†è®ºä¸Š <code>world: "MAIN"</code> é…ç½®æ˜¯æœ€ä¼˜æ–¹æ¡ˆï¼Œä½†ç”±äº WXT æ¡†æ¶å¯èƒ½ä¸æ”¯æŒæˆ–é…ç½®ä¸ç”Ÿæ•ˆï¼Œå®é™…é¡¹ç›®ä¸­æ— æ³•ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-31">å…³é”®è¦ç‚¹</h3>
<ol>
<li><strong>éš”ç¦»ä¸–ç•Œé™åˆ¶</strong>ï¼šContent Script è¿è¡Œåœ¨éš”ç¦»ä¸–ç•Œï¼Œæ— æ³•ç›´æ¥è®¿é—®é¡µé¢ä¸»ä¸–ç•Œçš„ <code>window</code> å¯¹è±¡</li>
<li><strong>æ³¨å…¥è„šæœ¬æ–¹æ¡ˆ</strong>ï¼šé€šè¿‡ <code>web_accessible_resources</code> å°†è„šæœ¬æ³¨å…¥åˆ°ä¸»ä¸–ç•Œæ˜¯å¯é çš„è§£å†³æ–¹æ¡ˆ</li>
<li><strong>é€šä¿¡æœºåˆ¶</strong>ï¼šä½¿ç”¨ <code>window.postMessage</code> è¿›è¡Œè·¨ä¸–ç•Œé€šä¿¡ï¼Œå®‰å…¨ä¸”æ ‡å‡†</li>
<li><strong>æ¡†æ¶å…¼å®¹æ€§</strong>ï¼šåœ¨é€‰æ‹©æ–¹æ¡ˆæ—¶ï¼Œå¿…é¡»è€ƒè™‘æ¡†æ¶çš„å®é™…æ”¯æŒæƒ…å†µï¼Œä¸èƒ½ä»…ä¾èµ–ç†è®ºæœ€ä¼˜æ–¹æ¡ˆ</li>
</ol>
<h3 data-id="heading-32">æœ€ä½³å®è·µ</h3>
<ol>
<li>âœ… ä½¿ç”¨ <code>web_accessible_resources</code> é…ç½®æ³¨å…¥è„šæœ¬</li>
<li>âœ… é€šè¿‡ <code>script.onload</code> ç¡®ä¿è„šæœ¬åŠ è½½å®Œæˆåå†é€šä¿¡</li>
<li>âœ… ä½¿ç”¨è¯·æ±‚ ID æœºåˆ¶æ”¯æŒå¹¶å‘è¯·æ±‚</li>
<li>âœ… æ·»åŠ è¶…æ—¶æœºåˆ¶é¿å…æ— é™ç­‰å¾…</li>
<li>âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•</li>
<li>âœ… åœ¨æ³¨å…¥å‰æ£€æŸ¥è„šæœ¬æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤æ³¨å…¥</li>
</ol>
<h3 data-id="heading-33">æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>âš ï¸ ç¡®ä¿ <code>web_accessible_resources</code> ä¸­çš„ <code>matches</code> é…ç½®æ­£ç¡®ï¼Œåªå…è®¸åœ¨éœ€è¦çš„åŸŸåä¸‹è®¿é—®</li>
<li>âš ï¸ ä½¿ç”¨ <code>use_dynamic_url: true</code> ç¡®ä¿èµ„æº URL åŠ¨æ€ç”Ÿæˆï¼Œæé«˜å®‰å…¨æ€§</li>
<li>âš ï¸ åœ¨ <code>postMessage</code> ä¸­éªŒè¯æ¶ˆæ¯æ¥æºï¼Œç¡®ä¿å®‰å…¨æ€§</li>
<li>âš ï¸ å¤„ç† iframe åœºæ™¯æ—¶ï¼Œéœ€è¦æ£€æŸ¥ <code>window.top === window.self</code></li>
</ol>
<p>é€šè¿‡æœ¬æ–‡æ¡£çš„æ–¹æ¡ˆï¼Œå¯ä»¥åœ¨ WXT æ¡†æ¶ä¸‹å¯é åœ°è·å–é¡µé¢ <code>window</code> å¯¹è±¡ï¼Œæ»¡è¶³å„ç§å®é™…å¼€å‘éœ€æ±‚ã€‚</p>
<hr/>
<p><strong>æ–‡æ¡£ç‰ˆæœ¬</strong>ï¼šv1.0<br/>
<strong>æœ€åæ›´æ–°</strong>ï¼š2024å¹´<br/>
<strong>ä½œè€…</strong>ï¼šåŸºäºå®é™…é¡¹ç›®ç»éªŒæ€»ç»“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Amazon OpenSearch åŠ©åŠ›é«˜æ•ˆ RAG ç³»ç»Ÿè½åœ°]]></title>    <link>https://juejin.cn/post/7575757258832887834</link>    <guid>https://juejin.cn/post/7575757258832887834</guid>    <pubDate>2025-11-24T02:54:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575757258832887834" data-draft-id="7575456858427097134" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Amazon OpenSearch åŠ©åŠ›é«˜æ•ˆ RAG ç³»ç»Ÿè½åœ°"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-24T02:54:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºšé©¬é€Šäº‘å¼€å‘è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Amazon OpenSearch åŠ©åŠ›é«˜æ•ˆ RAG ç³»ç»Ÿè½åœ°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºšé©¬é€Šäº‘å¼€å‘è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:54:17.000Z" title="Mon Nov 24 2025 02:54:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»29åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ç”Ÿæˆå¼ AI çš„å¿«é€Ÿå‘å±•ï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval Augmented Generationï¼ŒRAGï¼‰å·²æˆä¸ºæ„å»ºé«˜è´¨é‡ AI åº”ç”¨çš„å…³é”®æŠ€æœ¯ã€‚RAG é€šè¿‡å°†å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å¤–éƒ¨çŸ¥è¯†åº“ç›¸ç»“åˆï¼Œæœ‰æ•ˆè§£å†³äº† LLM çš„å¹»è§‰é—®é¢˜ï¼Œæé«˜äº†å›ç­”çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</p>
<p>åœ¨ä¼—å¤šRAGè§£å†³æ–¹æ¡ˆä¸­ï¼ŒçŸ¥è¯†åº“ä½œä¸ºæ ¸å¿ƒç»„ä»¶è‡³å…³é‡è¦ã€‚Amazon OpenSearchå‡­å€Ÿå…¶å“è¶Šçš„å…¨æ–‡æ£€ç´¢èƒ½åŠ›ã€è¯­ä¹‰æœç´¢æ”¯æŒå’Œé«˜åº¦å¯æ‰©å±•çš„åˆ†å¸ƒå¼æ¶æ„ï¼Œå·²æˆä¸ºä¼ä¸šæ„å»ºé«˜æ€§èƒ½RAGçŸ¥è¯†åº“çš„é¦–é€‰æŠ€æœ¯å¹³å°ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåº”å¯¹æµ·é‡æ•°æ®æ£€ç´¢çš„æŒ‘æˆ˜ã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Amazon OpenSearch åœ¨ RAG åœºæ™¯ä¸­çš„ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œå¹¶ç»“åˆ Amazon Bedrock ç”Ÿæ€ç³»ç»Ÿï¼Œå±•ç¤ºå¦‚ä½•æ„å»ºå¿«é€Ÿæ„å»ºå¯æ‰©å±•çš„ RAG åº”ç”¨ã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç» Amazon OpenSearch çš„ Serverless ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Serverless æ¶æ„è¿›ä¸€æ­¥ç®€åŒ– RAG è§£å†³æ–¹æ¡ˆçš„éƒ¨ç½²å’Œç®¡ç†ã€‚</p>
<blockquote>
<p>ğŸ“¢é™æ—¶æ’æ’­ï¼šæ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚</p>
<p>â©å¿«å¿«ç‚¹å‡»è¿›å…¥ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_InfoQhead_0606%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_InfoQhead_0606" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_InfoQhead_0606&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_InfoQhead_0606" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹å®éªŒæ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote>
<h2 data-id="heading-0">RAGå¸¸è§„æµç¨‹</h2>
<p>RAG å·¥ä½œæµç¨‹ä¸»è¦åŒ…å«äº”ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<p>1ã€æ•°æ®å‡†å¤‡ï¼ˆ<strong>Data Preparation</strong>ï¼‰</p>
<ol>
<li>å°†å¤–éƒ¨çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£ã€è¡¨æ ¼æˆ–å…¶ä»–æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œè½¬æˆé€‚åˆæ„å»ºçŸ¥è¯†åº“çš„æ ¼å¼ï¼Œå¦‚æ–‡æœ¬ã€ç¨ å¯†/ç¨€ç–å‘é‡è¡¨ç¤ºã€‚</li>
<li>é€šè¿‡ETLï¼ˆæå–Extractã€è½¬æ¢Transformã€åŠ è½½Loadï¼‰è¿‡ç¨‹æ¸…æ´—å’Œæ•´ç†æ•°æ®ï¼Œä¹Ÿå¯èƒ½ä¼šæ¶‰åŠåˆ°æ–‡æ¡£åˆ‡åˆ†ï¼Œå¹¶å¯¹æ¯ä¸ªæ•°æ®å—è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚å‘é‡åŒ–ã€åˆ†è¯ã€ç¨€ç–ç´¢å¼•åŒ–ç­‰ï¼‰ï¼Œå­˜å‚¨åˆ°çŸ¥è¯†åº“ä¸­ï¼ˆä¾‹å¦‚Amazon OpenSearchï¼‰ï¼Œæ–¹ä¾¿åç»­å¿«é€Ÿæ£€ç´¢</li>
</ol>
<p>2ã€æ£€ç´¢ï¼ˆ<strong>Retrieval</strong>ï¼‰</p>
<ol>
<li>ç”¨æˆ·è¾“å…¥æŸ¥è¯¢åï¼Œç³»ç»Ÿå°†æŸ¥è¯¢è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚æŸ¥è¯¢æ”¹å†™ã€åˆ†è¯ã€è½¬ä¸ºå‘é‡è¡¨ç¤ºç­‰</li>
<li>æ£€ç´¢å™¨ä½¿ç”¨æ£€ç´¢ç´¢æŠ€æœ¯ï¼ˆä¾‹å¦‚æ–‡æœ¬æ£€ç´¢ã€å‘é‡æ£€ç´¢ç­‰ï¼‰ä»å‘é‡æ•°æ®åº“ä¸­æ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µæˆ–æ•°æ®å—ã€‚</li>
<li>æ£€ç´¢ä¸ä»…ä¾èµ–å…³é”®è¯åŒ¹é…ï¼Œè¿˜é‡‡ç”¨è¯­ä¹‰çº§åˆ«çš„åŒ¹é…ï¼Œç¡®ä¿å¯¹å¤æ‚æˆ–æ¨¡ç³ŠæŸ¥è¯¢ä¹Ÿèƒ½æ‰¾åˆ°å‡†ç¡®çš„æ”¯æŒä¿¡æ¯</li>
</ol>
<p>3ã€å¢å¼ºï¼ˆ<strong>Augmentation</strong>ï¼‰</p>
<ol>
<li>å°†æ£€ç´¢åˆ°çš„ç›¸å…³æ–‡æ¡£ç‰‡æ®µä¸ç”¨æˆ·æŸ¥è¯¢ç»“åˆï¼Œå½¢æˆå¢å¼ºçš„æç¤ºï¼ˆpromptï¼‰ã€‚</li>
<li>è¿™ä¸ªå¢å¼ºçš„æç¤ºé€šå¸¸é€šè¿‡æ¨¡æ¿æˆ–ç‰¹å®šæ ¼å¼ç»„ç»‡ï¼Œç¡®ä¿ç”Ÿæˆæ¨¡å‹èƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ£€ç´¢ä¿¡æ¯ï¼Œæä¾›æ›´ä¸°å¯Œä¸”ä¸Šä¸‹æ–‡ç›¸å…³çš„è¾“å…¥</li>
</ol>
<p>4ã€ç”Ÿæˆï¼ˆ<strong>Generation</strong>ï¼‰</p>
<ol>
<li>ç”Ÿæˆæ¨¡å‹ï¼ˆå¦‚Claudeã€GPTç­‰ç³»åˆ—çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼‰æ¥æ”¶å¢å¼ºåçš„æç¤ºï¼Œç”Ÿæˆè‡ªç„¶è¯­è¨€å›ç­”ã€‚</li>
<li>ç”Ÿæˆçš„å†…å®¹ä¸ä»…è¯­è¨€æµç•…ï¼Œè¿˜åŸºäºå¤–éƒ¨çŸ¥è¯†åº“çš„ä¿¡æ¯ï¼Œä¿è¯å›ç­”çš„å‡†ç¡®æ€§å’Œæƒå¨æ€§ã€‚</li>
</ol>
<p>5ã€å¤šè½®äº¤äº’ä¸åé¦ˆï¼ˆå¯é€‰ï¼‰</p>
<ol>
<li>åœ¨å¯¹è¯ç³»ç»Ÿä¸­ï¼ŒRAGæ”¯æŒå¤šè½®äº¤äº’ï¼Œæ¯è½®çš„æŸ¥è¯¢å’Œç”Ÿæˆç»“æœå¯ä»¥ä½œä¸ºä¸‹ä¸€è½®çš„è¾“å…¥ã€‚</li>
<li>ç³»ç»Ÿæ ¹æ®ç”¨æˆ·åé¦ˆä¸æ–­ä¼˜åŒ–æ£€ç´¢å’Œç”Ÿæˆç­–ç•¥ï¼Œæå‡å›ç­”è´¨é‡å’Œç”¨æˆ·ä½“éªŒ</li>
</ol>
<p>Amazon OpenSearch ä½œä¸ºä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„æœç´¢å’Œåˆ†æå¼•æ“ï¼Œä¸ºæ„å»º RAGçŸ¥è¯†åº“æä¾›äº†å…¨é¢çš„æ”¯æŒã€‚å®ƒä¸ä»…æ”¯æŒä¼ ç»Ÿçš„å…¨æ–‡æœç´¢ï¼Œè¿˜æä¾›äº†ç¨ å¯†ä¸ç¨€ç–å‘é‡æœç´¢èƒ½åŠ›ï¼Œä½¿å…¶æˆä¸ºæ„å»º RAG åº”ç”¨çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<h2 data-id="heading-1">Amazon OpenSearch åœ¨ RAG ä¸­çš„æ ¸å¿ƒä¼˜åŠ¿</h2>
<p>1ã€ å¼ºå¤§çš„å‘é‡æ£€ç´¢èƒ½åŠ›</p>
<p>Amazon OpenSearch æä¾›å¼ºå¤§çš„ ANNï¼ˆApproximate Nearest Neighborï¼Œè¿‘ä¼¼æœ€è¿‘é‚»ï¼‰æ£€ç´¢èƒ½åŠ›ï¼Œè¿™å¾—ç›Šäºå…¶æ·±åº¦é›†æˆçš„ KNN æ’ä»¶ã€‚è¯¥æ’ä»¶æ”¯æŒå¤šç§å…ˆè¿›çš„ANNç®—æ³•å®ç°ï¼ŒåŒ…æ‹¬ HNSWï¼ˆHierarchical Navigable Small Worldï¼‰ã€IVFï¼ˆInverted Fileï¼‰ï¼Œä»¥åŠ Faissã€NMSLIB å’Œ Lucene ç­‰é«˜æ•ˆæœç´¢åº“ã€‚è¿™äº›ç®—æ³•å’Œåº“æä¾›äº†ä¸åŒçš„ä¼˜åŒ–è·¯å¾„ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ç²¾ç»†è°ƒæ•´å‚æ•°é…ç½®ï¼Œä»¥è¾¾åˆ°æ£€ç´¢é€Ÿåº¦ä¸å‡†ç¡®ç‡ä¹‹é—´çš„æœ€ä¼˜å¹³è¡¡ã€‚</p>
<p>åˆ©ç”¨ <code>method</code> å‚æ•°é…ç½®é¡¹ï¼Œå¼€å‘è€…å¯ä»¥ç²¾ç¡®æŒ‡å®šæ‰€ä½¿ç”¨çš„ç®—æ³•ç±»å‹ï¼ˆä¾‹å¦‚ HNSW æˆ– IVFï¼‰ã€å‘é‡ç©ºé—´åº¦é‡æ ‡å‡†ï¼ˆå¦‚ L2 èŒƒæ•°ã€å†…ç§¯ã€ä½™å¼¦ç›¸ä¼¼æ€§ç­‰ï¼‰ï¼Œä»¥åŠç‰¹å®šå¼•æ“çš„å…·ä½“å‚æ•°è®¾ç½®ã€‚è¿™ç§çµæ´»æ€§ç¡®ä¿äº†ä¸åŒåº”ç”¨åœºæ™¯ä¸‹å¯¹æ€§èƒ½å’Œæ•ˆæœçš„ä¸åŒéœ€æ±‚éƒ½èƒ½å¾—åˆ°æ»¡è¶³ã€‚å¯¹äºå¸Œæœ›æ·±å…¥äº†è§£ Amazon OpenSearch ä¸­ KNN/ANN åŠŸèƒ½åŠå…¶å‚æ•°é…ç½®çš„ç”¨æˆ·ï¼Œå®˜æ–¹æ–‡æ¡£[1]æä¾›äº†è¯¦å°½çš„æŠ€æœ¯è¯´æ˜å’ŒæŒ‡å¯¼ã€‚</p>
<p>åœ¨å‘é‡æ£€ç´¢èƒ½åŠ›æ–¹é¢ï¼ŒAmazon OpenSearch å±•ç°å‡ºäº†å“è¶Šçš„æ€§èƒ½ä¸é«˜åº¦å¯æ‰©å±•çš„æ¶æ„ï¼Œèƒ½å¤Ÿé«˜æ•ˆæ”¯æŒä»æ•°ç™¾ä¸‡åˆ°æ•°åäº¿çº§åˆ«ç”šè‡³ç™¾äº¿çº§çš„å‘é‡æ•°æ®å¿«é€Ÿæ£€ç´¢ã€‚è¿™ç§çµæ´»çš„æ‰©å±•æ€§ä½¿å…¶èƒ½å¤Ÿé€‚åº”ä»å°è§„æ¨¡å®éªŒåˆ°å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒçš„å„ç§åº”ç”¨åœºæ™¯ã€‚æ ¹æ® Amazon å®˜æ–¹å‘å¸ƒçš„æµ‹è¯•æ•°æ®[2]ï¼Œåœ¨ä½¿ç”¨è¡Œä¸šå¹¿æ³›è®¤å¯çš„ BIGANN æ•°æ®é›†ï¼ˆåŒ…å« 10 äº¿ä¸ª 128 ç»´å‘é‡ï¼‰è¿›è¡Œçš„å®éªŒä¸­ï¼ŒOpenSearch åœ¨ä¿è¯å¬å›ç‡è¾¾åˆ° 99% çš„å‰æä¸‹ï¼Œå±•ç°å‡ºæä¸ºä¼˜å¼‚çš„å“åº”å»¶è¿Ÿè¡¨ç°ï¼šp50 å»¶è¿Ÿä»…ä¸º 23.1 æ¯«ç§’ï¼Œp90 å»¶è¿Ÿä¸º 27.1 æ¯«ç§’ï¼Œp99 å»¶è¿Ÿä¹Ÿä»…ä¸Šå‡è‡³ 32.2 æ¯«ç§’ã€‚</p>
<p>è¿™æ ·çš„ä½å»¶è¿Ÿã€é«˜å¬å›ç‡çš„è¡¨ç°ï¼Œå……åˆ†ä½“ç°äº† Amazon OpenSearch åœ¨å‘é‡æ£€ç´¢é¢†åŸŸçš„å¼ºå¤§æŠ€æœ¯å®åŠ›ã€‚æ— è®ºæ˜¯æ¨èç³»ç»Ÿã€å›¾åƒæ£€ç´¢ã€è¯­ä¹‰æœç´¢ï¼Œè¿˜æ˜¯å…¶ä»–å¯¹å®æ—¶æ€§å’Œå‡†ç¡®åº¦æœ‰è¾ƒé«˜è¦æ±‚çš„ AI åº”ç”¨åœºæ™¯ï¼ŒOpenSearch éƒ½èƒ½å¤Ÿæä¾›ç¨³å®šã€å¯é ä¸”é«˜æ•ˆçš„åº•å±‚æ”¯æ’‘ï¼Œè¶³ä»¥åº”å¯¹ç»å¤§å¤šæ•°å¯¹æ€§èƒ½æ•æ„Ÿçš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>2ã€å‘é‡é‡åŒ–æŠ€æœ¯é™ä½æˆæœ¬</p>
<p>éšç€å‘é‡æ•°æ®è§„æ¨¡çš„è¿…é€Ÿå¢é•¿ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®é‡è¾¾åˆ°åƒä¸‡ç”šè‡³äº¿çº§åˆ«ä»¥ä¸Šçš„åœºæ™¯ä¸­ï¼Œä¼ ç»ŸåŸºäºå†…å­˜çš„è¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆANNï¼‰ç®—æ³•ï¼ˆå¦‚ HNSWï¼‰åœ¨æ€§èƒ½æ–¹é¢é¢ä¸´æŒ‘æˆ˜ï¼šç”±äºæ‰€æœ‰å‘é‡å¿…é¡»å¸¸é©»å†…å­˜ï¼Œç³»ç»Ÿçš„å†…å­˜æ¶ˆè€—è¿…é€Ÿæ”€å‡ï¼Œå¯¼è‡´å‘é‡æ£€ç´¢çš„ç¡¬ä»¶æˆæœ¬å’Œæ‰©å±•éš¾åº¦æ˜¾è‘—å¢åŠ ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒAmazon OpenSearch åœ¨å‘é‡æ£€ç´¢åœºæ™¯ä¸­å¼•å…¥äº†é‡åŒ–ï¼ˆQuantizationï¼‰æŠ€æœ¯ã€‚é€šè¿‡å¯¹é«˜ç»´æµ®ç‚¹å‘é‡è¿›è¡Œå‹ç¼©ï¼ŒOpenSearch èƒ½åœ¨æ˜¾è‘—é™ä½å­˜å‚¨å’Œè®¡ç®—èµ„æºæ¶ˆè€—çš„åŒæ—¶ï¼Œä¿æŒè¾ƒé«˜çš„æ£€ç´¢å‡†ç¡®ç‡å’Œå“åº”é€Ÿåº¦ã€‚</p>
<p>å…¶ä¸­ï¼ŒBinary Quantizationï¼ˆBQï¼ŒäºŒè¿›åˆ¶é‡åŒ–ï¼‰ æ˜¯ OpenSearch æä¾›çš„ä¸€ç§é«˜æ•ˆå‘é‡å‹ç¼©æ–¹æ¡ˆï¼Œç‰¹åˆ«é€‚ç”¨äºå¦‚ LLM Agent Memory æ„å»ºã€è¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿç­‰å¤§è§„æ¨¡å‘é‡æ£€ç´¢åº”ç”¨ã€‚BQ æŠ€æœ¯å°†åŸå§‹çš„é«˜ç»´æµ®ç‚¹å‘é‡å‹ç¼©ä¸ºä½ä½äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæ”¯æŒå°†æ¯ä¸ªå‘é‡ç»´åº¦ç¼–ç ä¸º 1ã€2 æˆ– 4 ä½ï¼Œåˆ†åˆ«å¯¹åº”çº¦ 32 å€ã€16 å€å’Œ 8 å€çš„å‹ç¼©ç‡ï¼Œä»è€Œå¤§å¹…åº¦é™ä½å†…å­˜å ç”¨ã€‚æ­¤å¤–ï¼ŒBQ åœ¨ OpenSearch ä¸­çš„è®­ç»ƒä¸ç´¢å¼•æ„å»ºè¿‡ç¨‹æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œç”¨æˆ·æ— éœ€å•ç‹¬è¿›è¡Œé¢„å¤„ç†æˆ–æ¨¡å‹è®­ç»ƒï¼Œè¿™å¤§å¤§ç®€åŒ–äº†å‘é‡æ£€ç´¢ç³»ç»Ÿçš„å¼€å‘å’Œè¿ç»´æµç¨‹ã€‚å°½ç®¡é‡åŒ–å‹ç¼©æœ¬è´¨ä¸Šä¼šå¸¦æ¥ä¸€å®šçš„ç²¾åº¦æŸå¤±ï¼Œä½† OpenSearch åœ¨å®ç° BQ åŠŸèƒ½æ—¶ï¼Œæä¾›äº†çµæ´»çš„å‚æ•°é…ç½®ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨å¬å›ç‡ã€å‡†ç¡®ç‡ä¸ç³»ç»Ÿæˆæœ¬ä¹‹é—´è¿›è¡Œæœ‰æ•ˆæƒè¡¡ã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒOpenSearch èƒ½å¤Ÿåœ¨èµ„æºåˆ©ç”¨ç‡ä¸æ£€ç´¢æ•ˆæœä¹‹é—´å®ç°å¹³è¡¡ï¼Œæ»¡è¶³å„ç±»ä¼ä¸šçº§åº”ç”¨çš„æ€§èƒ½éœ€æ±‚ã€‚</p>
<p>åœ¨è¿‡å»æŸå®¢æˆ·æµ‹è¯•æ¡ˆä¾‹ä¸­ï¼Œé¢å¯¹äº¿çº§è§„æ¨¡å‘é‡æ•°æ®é›†ï¼ŒOpenSearch é‡‡ç”¨ HNSW ç®—æ³•ç»“åˆ Binary Quantization æŠ€æœ¯ï¼Œåœ¨ä¿æŒ 1500 QPS é«˜å¹¶å‘çš„åŒæ—¶ï¼ŒP50ã€P90ã€P99 å‡åœ¨ç™¾æ¯«ç§’å†…ã€‚ä¸æœªä½¿ç”¨é‡åŒ–çš„ç³»ç»Ÿç›¸æ¯”ï¼Œæ•´ä½“æˆæœ¬é™ä½çº¦ 50%ï¼Œè¿™å……åˆ†è¯æ˜äº† BQ æŠ€æœ¯åœ¨é«˜æ€§èƒ½ã€ä½æˆæœ¬å‘é‡æ£€ç´¢ä¸­çš„å®ç”¨ä»·å€¼ã€‚</p>
<p>åœ¨åº”ç”¨ BQ é‡åŒ–æ—¶ï¼Œæœ‰å¦‚ä¸‹ç»éªŒå¯ä»¥åˆ†äº«ï¼š</p>
<ol>
<li>shard æ•°é‡å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ŒåŸºäºæ€»ä½“æ•°æ®é‡ï¼Œé¢„ä¼°æ¯ä¸ª shard æ•°æ®é‡ï¼Œ30GBå·¦å³æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„å€¼</li>
<li>é¦–æ‰¹æ•°æ®å†™å…¥åï¼Œåš force mergeï¼Œæå‡åç»­çš„æ£€ç´¢æ•ˆæœ</li>
<li>ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„7g å®ä¾‹ç³»åˆ—ï¼ˆä¾‹å¦‚ c7gï¼‰</li>
<li>åœ¨éœ€è¦é«˜ QPS çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Cç³»åˆ—æœºå™¨</li>
</ol>
<p>3ã€ æ··åˆæœç´¢ï¼šç»“åˆè¯­ä¹‰å’Œå…³é”®è¯æœç´¢</p>
<p>åœ¨ RAG åœºæ™¯ä¸‹ï¼Œæ··åˆæ£€ç´¢ + é‡æ’åºçš„æµç¨‹å·²ç»å‡ ä¹æ˜¯ä¸€ä¸ªä¸šå†…æ ‡å‡†ï¼Œç”¨æ¥æå‡çŸ¥è¯†å¬å›æ•ˆæœã€‚æ··åˆæ£€ç´¢ç»“åˆäº†å…³é”®è¯æœç´¢ï¼ˆå¦‚ BM25ï¼‰å’Œè¯­ä¹‰æœç´¢ï¼ˆå¦‚å‘é‡æ£€ç´¢ï¼‰çš„ä¼˜ç‚¹ï¼Œå¼¥è¡¥äº†å„è‡ªçš„ä¸è¶³ï¼Œä»è€Œæé«˜äº†æ£€ç´¢çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚å…³é”®è¯æœç´¢åœ¨ç²¾ç¡®åŒ¹é…æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œé€‚ç”¨äºç‰¹å®šæœ¯è¯­çš„æ£€ç´¢ï¼›è€Œè¯­ä¹‰æœç´¢åŸºäºæ•°æ®è¯­ä¹‰è¿›è¡Œæœç´¢ï¼Œå¯¹æ‹¼å†™é”™è¯¯å’ŒåŒä¹‰è¯å…·æœ‰ä¸€å®šçš„é²æ£’æ€§ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°æ›´å¹¿æ³›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚é€šè¿‡å°†è¿™ä¸¤ç§æœç´¢æ–¹å¼èåˆï¼Œå¯ä»¥æ˜¾è‘—æå‡æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§å’Œå¤šæ ·æ€§ã€‚</p>
<p>åœ¨æ··åˆæ£€ç´¢å¾—åˆ°å¤šä¸ªç›¸å…³ç»“æœåï¼Œå¦‚ä½•ä»ä¸­é€‰æ‹©æœ€ç›¸å…³ã€æœ€æœ‰ä»·å€¼çš„ä¿¡æ¯è¿›è¡Œç”Ÿæˆï¼Œæ˜¯å¦ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ã€‚è¿™æ—¶ï¼Œé‡æ’åºæ¨¡å‹ï¼ˆRerankæ¨¡å‹ï¼‰å°±å‘æŒ¥äº†é‡è¦ä½œç”¨ã€‚é‡æ’åºæ¨¡å‹é€šè¿‡å¯¹ä¸åŒæ£€ç´¢æ¨¡å‹è¿”å›çš„æ–‡æ¡£ç‰‡æ®µåˆ—è¡¨å’Œç”¨æˆ·é—®é¢˜è¯­ä¹‰åŒ¹é…åº¦è¿›è¡Œé‡æ–°æ’åºï¼Œæ”¹è¿›æ£€ç´¢è¿”å›çš„ç»“æœã€‚å®ƒè®¡ç®—ç”¨æˆ·é—®é¢˜ä¸æ£€ç´¢å¬å›çš„æ¯ä¸€ä¸ªå€™é€‰æ–‡æ¡£ä¹‹é—´çš„ç›¸å…³æ€§åˆ†æ•°ï¼Œå¹¶è¿”å›æŒ‰ç…§ç›¸å…³æ€§æ’åºçš„æ–‡æ¡£åˆ—è¡¨ã€‚è¿™æ ·ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­å°±å¯ä»¥ä¼˜å…ˆé€‰æ‹©é«˜è´¨é‡çš„ä¿¡æ¯ï¼Œä»è€Œæé«˜ç”Ÿæˆç»“æœçš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚å¸¸è§çš„é‡æ’åºæ¨¡å‹åŒ…æ‹¬ Cohere Rerankã€BGE-Reranker ç­‰ã€‚è¿™äº›æ¨¡å‹å¯ä»¥åœ¨å•è·¯æˆ–å¤šè·¯çš„å¬å›ç»“æœä¸­æŒ‘é€‰å‡ºå’Œé—®é¢˜æœ€æ¥è¿‘çš„æ–‡æ¡£ï¼Œè¿›ä¸€æ­¥æå‡ç”Ÿæˆç­”æ¡ˆçš„ç²¾ç¡®åº¦ã€‚</p>
<p>åœ¨æ„å»ºæ··åˆæœç´¢ï¼ˆå¦‚å‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢ï¼‰ç³»ç»Ÿæ—¶ï¼Œé€šå¸¸éœ€è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<p>æŸ¥è¯¢å‘é‡åŒ–å¤„ç†å¤æ‚ï¼šç”¨æˆ·è¾“å…¥é€šå¸¸ä¸ºè‡ªç„¶è¯­è¨€æ–‡æœ¬ï¼Œè¿™å°±è¦æ±‚ç³»ç»Ÿæ—¢è¦å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯å¤„ç†ä»¥æ”¯æŒå…³é”®è¯æ£€ç´¢ï¼Œåˆè¦é€šè¿‡åµŒå…¥æ¨¡å‹å°†å…¶å‘é‡åŒ–ä»¥æ”¯æŒè¯­ä¹‰æ£€ç´¢ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠæ¨¡å‹åŠ è½½ä¸æ¨ç†ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å¤„ç†å¤æ‚åº¦ã€‚ç›¸å…³æ€§åˆ†æ•°å°ºåº¦ä¸ä¸€è‡´ï¼šå…³é”®è¯æ£€ç´¢ï¼ˆå¦‚ BM25ï¼‰å’Œè¯­ä¹‰æ£€ç´¢ï¼ˆå¦‚å‘é‡åŒ¹é…ï¼‰è¿”å›çš„ç›¸å…³æ€§åˆ†æ•°å¤„äºä¸åŒçš„è¯„åˆ†ä½“ç³»ä¸­ï¼Œç›´æ¥èåˆå¯èƒ½å¯¼è‡´è¯„åˆ†å¤±è¡¡ã€‚å› æ­¤ï¼Œå¿…é¡»å¯¹å®ƒä»¬è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œå°†ç»“æœç»Ÿä¸€åˆ°å¯æ¯”è¾ƒçš„è¯„åˆ†å°ºåº¦ã€‚Amazon OpenSearch çš„ä¸€å¤§ä¼˜åŠ¿åœ¨äºï¼Œå…¶åŸç”Ÿæ”¯æŒæ··åˆæ£€ç´¢ï¼Œèƒ½å¤Ÿè½»æ¾é›†æˆè¯­ä¹‰æœç´¢ä¸å…³é”®è¯æœç´¢ã€‚å®ƒä¸ä»…æ”¯æŒçµæ´»å¯¹æ¥å¤–éƒ¨åµŒå…¥æ¨¡å‹ï¼Œè¿˜æä¾›äº†å†…ç½®æœºåˆ¶ï¼ˆå¦‚æœç´¢ç®¡é“å’Œæ ‡å‡†åŒ–å¤„ç†å™¨ï¼‰ç”¨äºè°ƒæ•´ä¸åŒæ£€ç´¢é€šè·¯çš„æƒé‡å’Œç›¸å…³æ€§åˆ†æ•°çš„ç»Ÿä¸€ï¼Œå¤§å¹…ç®€åŒ–äº†æ··åˆæœç´¢ç³»ç»Ÿçš„æ„å»ºä¸ä¼˜åŒ–è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-2">3.1. é›†æˆåµŒå…¥æ¨¡å‹</h4>
<p>åœ¨å‘é‡æ•°æ®åº“ä¸­ï¼Œæ— è®ºæ˜¯æ–‡æœ¬çš„å†™å…¥è¿˜æ˜¯æ£€ç´¢ï¼Œéƒ½éœ€è¦å…ˆå°†æ–‡æœ¬è½¬æ¢ä¸ºå¯¹åº”çš„å‘é‡è¡¨ç¤ºã€‚å› æ­¤ï¼Œå‘é‡åŒ–æ¨¡å‹çš„éƒ¨ç½²æ˜¯å®ç°è¯­ä¹‰æ£€ç´¢çš„å…³é”®æ­¥éª¤ã€‚åœ¨äºšé©¬é€Šäº‘å¹³å°ä¸Šï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°å‘é‡åŒ–æ¨¡å‹çš„é›†æˆï¼š</p>
<ol>
<li>ä½¿ç”¨ <strong>Amazon Bedrock</strong> æä¾›çš„å†…ç½®å‘é‡åŒ–æ¨¡å‹ï¼šAmazon Bedrock æ”¯æŒå¤šç§ä¸»æµçš„å‘é‡åŒ–æ¨¡å‹ï¼Œä¾‹å¦‚ Cohere å’Œ Amazon Titanï¼ˆç¨ å¯†å‘é‡æ¨¡å‹ï¼‰ã€‚é€šè¿‡ç›´æ¥è°ƒç”¨ Bedrock æä¾›çš„ APIï¼Œå³å¯å®ç°æ–‡æœ¬çš„å‘é‡åŒ–å¤„ç†ï¼Œæ— éœ€è‡ªè¡Œéƒ¨ç½²æ¨¡å‹ã€‚</li>
<li>é€šè¿‡ <strong>Amazon SageMaker</strong> éƒ¨ç½²è‡ªå®šä¹‰å‘é‡åŒ–æ¨¡å‹ï¼šæ”¯æŒå°†å¦‚ bge-m3 ç­‰å¼€æºåµŒå…¥æ¨¡å‹éƒ¨ç½²åˆ° SageMaker å¹³å°ï¼Œéƒ¨ç½²åå³å¯é€šè¿‡ SageMaker Endpoint å®ç°æ¨¡å‹çš„è°ƒç”¨å’Œæ¨ç†ï¼Œé€‚ç”¨äºéœ€è¦å®šåˆ¶æˆ–ä¼˜åŒ–æ¨¡å‹çš„åœºæ™¯ã€‚</li>
</ol>
<p>å¯¹äºä¸Šè¿°ä¸¤ç§æ–¹å¼ï¼ŒAmazon OpenSearch éƒ½æä¾›äº†ç»Ÿä¸€çš„å¯¹æ¥èƒ½åŠ›ï¼šå¯ä»¥å°†è¿™ä¸¤ç±»æ¨¡å‹çš„æ¨ç†æœåŠ¡æŠ½è±¡ä¸ºä¸€ä¸ªâ€œè¿æ¥å™¨â€ï¼ˆConnectorï¼‰è¿›è¡Œè°ƒç”¨ã€‚åœ¨ OpenSearch ä¸­ï¼Œé€šè¿‡è¿æ¥å™¨å¯ä»¥ç›´æ¥è°ƒç”¨æ¨¡å‹è¿›è¡Œæ–‡æœ¬åµŒå…¥æ¨ç†ï¼Œå¹¶ç»“åˆå·¥ä½œæµè‡ªåŠ¨åŒ–æœºåˆ¶ï¼Œå°†æ¨ç†ç»“æœå†™å…¥ç´¢å¼•æˆ–ç”¨äºå®æ—¶çš„å‘é‡æ£€ç´¢ï¼Œä»è€Œå®ç°ç«¯åˆ°ç«¯çš„è¯­ä¹‰ç´¢å¼•æµç¨‹ã€‚</p>
<p>æ•´ä¸ªé…ç½®è¿‡ç¨‹æ”¯æŒå›¾å½¢åŒ–æ“ä½œï¼Œéƒ¨ç½²ç®€å•ã€æµç¨‹æ¸…æ™°ã€‚å…·ä½“çš„é…ç½®æ­¥éª¤å’Œä½¿ç”¨ç¤ºä¾‹ï¼Œå¯å‚è€ƒæ–‡æ¡£ [4]ã€‚</p>
<h4 data-id="heading-3">3.2. hybridæ£€ç´¢</h4>
<p>åœ¨ Amazon OpenSearch ä¸­ï¼Œå®ç°æ··åˆæ£€ç´¢ï¼ˆä¾‹å¦‚å°†å…³é”®è¯æ£€ç´¢ä¸å‘é‡æ£€ç´¢ç›¸ç»“åˆï¼‰éå¸¸ç®€ä¾¿ï¼Œå¯ä»¥é€šè¿‡é…ç½® OpenSearch çš„è‡ªåŠ¨åŒ–æœç´¢å·¥ä½œæµæ¥å®Œæˆã€‚å…¶ä¸­ï¼Œç¬¬ä¸€æ­¥é€šå¸¸æ˜¯é…ç½®ä¸€ä¸ªåŒ…å«å½’ä¸€åŒ–å¤„ç†å™¨ï¼ˆNormalization Processorï¼‰çš„æœç´¢ç®¡é“ï¼ˆSearch Pipelineï¼‰ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å¯¹æ¥è‡ªä¸åŒæ£€ç´¢é€šè·¯ï¼ˆå¦‚ BM25 å’Œå‘é‡æœç´¢ï¼‰çš„ç›¸å…³æ€§åˆ†æ•°è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚</p>
<p>ç”±äºå…³é”®è¯æœç´¢ä¸è¯­ä¹‰æœç´¢è¿”å›çš„åˆ†å€¼é€šå¸¸å¤„äºä¸åŒçš„å°ºåº¦ï¼Œè‹¥ä¸è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œèåˆåçš„æ’åºå¯èƒ½ä¼šä¸¥é‡åå‘æŸä¸€è·¯ç»“æœã€‚é€šè¿‡å½’ä¸€åŒ–å¤„ç†å™¨ï¼Œå¯ä»¥å°†å¤šè·¯æŸ¥è¯¢ç»“æœçš„åˆ†æ•°æ˜ å°„åˆ°ç»Ÿä¸€çš„æ•°å€¼èŒƒå›´ï¼ˆå¦‚ [0, 1]ï¼‰ï¼Œä»è€Œç¡®ä¿åç»­çš„ç»“æœèåˆæ›´åŠ åˆç†å’Œå¯æ§ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">PUT /_search/pipeline/nlp-search-pipeline
{
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Post processor for hybrid search"</span>,
  <span class="hljs-string">"phase_results_processors"</span>: [
    {
      <span class="hljs-string">"normalization-processor"</span>: {
        <span class="hljs-string">"normalization"</span>: {
          <span class="hljs-string">"technique"</span>: <span class="hljs-string">"min_max"</span>
        },
        <span class="hljs-string">"combination"</span>: {
          <span class="hljs-string">"technique"</span>: <span class="hljs-string">"arithmetic_mean"</span>,
          <span class="hljs-string">"parameters"</span>: {
            <span class="hljs-string">"weights"</span>: [
              0.3,
              0.7
            ]
          }
        }
      }
    }
  ]
}
</code></pre>
<ul>
<li>normalization.techniqueï¼šå¯é€‰å€¼åŒ…æ‹¬ min-maxã€l2 ç”¨äºæ ‡å‡†åŒ–åˆ†æ•°ã€‚</li>
<li>combination.techniqueï¼šå¯é€‰å€¼åŒ…æ‹¬ arithmetic_meanã€geometric_meanã€harmonic_mean ç­‰ï¼Œç”¨äºç»„åˆåˆ†æ•°ã€‚</li>
</ul>
<p>æ‚¨è¿˜å¯ä»¥ä¸ºæ¯ä¸ªæŸ¥è¯¢å­å¥è®¾ç½®æƒé‡ï¼Œä»¥è°ƒæ•´å…¶å¯¹æœ€ç»ˆè¯„åˆ†çš„å½±å“ã€‚åœ¨é…ç½®å¥½æ¨¡å‹è¿æ¥å™¨å’Œæœç´¢ç®¡é“åï¼Œå³å¯ç›´æ¥è¿è¡Œæ··åˆæ£€ç´¢ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">GET /<span class="hljs-keyword">my</span>-nlp-<span class="hljs-keyword">index</span>/_search?search_pipeline=nlp-search-pipeline
{
  <span class="hljs-string">"_source"</span>: {
    <span class="hljs-string">"exclude"</span>: [
      <span class="hljs-string">"passage_embedding"</span>
    ]
  },
  <span class="hljs-string">"query"</span>: {
    <span class="hljs-string">"hybrid"</span>: {
      <span class="hljs-string">"queries"</span>: [
        {
          <span class="hljs-string">"match"</span>: {
            <span class="hljs-string">"passage_text"</span>: {
              <span class="hljs-string">"query"</span>: <span class="hljs-string">"Hi world"</span>
            }
          }
        },
        {
          <span class="hljs-string">"neural"</span>: {
            <span class="hljs-string">"passage_embedding"</span>: {
              <span class="hljs-string">"query_text"</span>: <span class="hljs-string">"Hi world"</span>,
              <span class="hljs-string">"model_id"</span>: <span class="hljs-string">"aVeif4oB5Vm0Tdw8zYO2"</span>,
              <span class="hljs-string">"k"</span>: <span class="hljs-number">5</span>
            }
          }
        }
      ]
    }
  }
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåº”ç”¨ä¾§åªéœ€è·å–ç”¨æˆ·çš„æ–‡æœ¬è¾“å…¥ï¼Œåç»­çš„å…³é”®è¯æ£€ç´¢ä¸è¯­ä¹‰æ£€ç´¢å³å¯åœ¨ Amazon OpenSearch å†…éƒ¨è‡ªåŠ¨å®Œæˆã€‚æ•´ä¸ªè¿‡ç¨‹æ— éœ€é¢å¤–å¼€å‘å¤æ‚çš„æ£€ç´¢é€»è¾‘ï¼Œå¤§å¹…é™ä½äº†æ··åˆæ£€ç´¢çš„å®æ–½æˆæœ¬ä¸æŠ€æœ¯é—¨æ§›ã€‚</p>
<p>4ã€ä¸°å¯Œçš„è¿‡æ»¤èƒ½åŠ›åœ¨åŸºäº RAG çš„åº”ç”¨ä¸­ï¼Œå…·å¤‡åŸºäºå…ƒæ•°æ®è¿›è¡Œè¿‡æ»¤ä¸èšåˆçš„èƒ½åŠ›è‡³å…³é‡è¦ã€‚é€šè¿‡å…ƒæ•°æ®è¿‡æ»¤ï¼Œå¯ä»¥åœ¨å‘é‡æœç´¢å‰æ˜¾è‘—ç¼©å°æœç´¢ç©ºé—´ï¼Œæ’é™¤ä¸ç”¨æˆ·æŸ¥è¯¢æ„å›¾æ— å…³çš„å†…å®¹ï¼Œä»è€Œæå‡ç”Ÿæˆç»“æœçš„ç²¾åº¦å’Œç›¸å…³æ€§ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»“åˆå…ƒæ•°æ®çš„æ£€ç´¢æ˜¯éå¸¸å¸¸è§çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªå¤šç”¨æˆ·å…±äº«çš„çŸ¥è¯†åº“ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·åªèƒ½è®¿é—®å’ŒæŸ¥è¯¢å„è‡ªä¸Šä¼ æˆ–è¢«æˆæƒçš„æ•°æ®å†…å®¹ï¼Œè¿™å°±éœ€è¦åŸºäºâ€œç”¨æˆ· IDâ€æˆ–â€œç»„ç»‡æ ‡è¯†â€ç­‰å…ƒæ•°æ®å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œç¡®ä¿ä¸åŒç”¨æˆ·æ ¹æ®å…¶æƒé™ä»…è®¿é—®å…¶æœ‰æƒæŸ¥çœ‹çš„æ•°æ®ï¼Œæ»¡è¶³ä¼ä¸šåœ¨æ•°æ®å®‰å…¨å’Œåˆè§„æ€§æ–¹é¢çš„è¦æ±‚ã€‚åŒæ ·ï¼Œåœ¨æŸäº›ç‰¹å®šçš„çŸ¥è¯†é—®ç­”æˆ–é—®è¯Šç±»åœºæ™¯ä¸­ï¼Œä»…éœ€è¦æ£€ç´¢ä¸æŸä¸ªä¸“ä¸šé¢†åŸŸç›¸å…³çš„æ–‡æ¡£ï¼Œæ­¤æ—¶åŸºäºé¢†åŸŸæ ‡ç­¾ã€æ–‡æ¡£æ¥æºç­‰å…ƒæ•°æ®è¿›è¡Œé¢„è¿‡æ»¤ï¼Œå¯ä»¥å¤§å¹…å‡å°‘æ— æ•ˆæ•°æ®çš„å¹²æ‰°ã€‚</p>
<p>åœ¨è¿‡æ»¤ç»´åº¦æ–¹é¢ï¼Œå…ƒæ•°æ®è¿‡æ»¤å¯ä»¥åº”ç”¨äºå¤šä¸ªå¸¸è§ç»´åº¦ã€‚æ—¶é—´è¿‡æ»¤å…è®¸ç³»ç»Ÿä»…åœ¨æŸä¸ªæ—¶é—´åŒºé—´å†…è¿›è¡Œæ–‡æ¡£æœç´¢ï¼Œæ¯”å¦‚åªæ£€ç´¢â€œ2023 å¹´ç¬¬ä¸€å­£åº¦â€çš„æ•°æ®ï¼›ç±»åˆ«è¿‡æ»¤å¯ä»¥é™åˆ¶æ£€ç´¢èŒƒå›´åœ¨ç‰¹å®šçš„äº§å“çº¿ã€é¡¹ç›®ç»„æˆ–ä¸šåŠ¡å•å…ƒå†…ï¼Œé¿å…è·¨éƒ¨é—¨æ•°æ®æ··æ·†ï¼›æ¥æºè¿‡æ»¤åˆ™å¸®åŠ©ç³»ç»Ÿä¼˜å…ˆé€‰æ‹©æ¥è‡ªæƒå¨æ•°æ®æºçš„å†…å®¹ï¼Œæ¯”å¦‚ä¼šè®®çºªè¦ã€æŠ€æœ¯æ‰‹å†Œã€API æ–‡æ¡£ç­‰ã€‚é€šè¿‡è¿™äº›ç»“æ„åŒ–è¿‡æ»¤æ‰‹æ®µï¼Œå¯ä»¥åœ¨åŸå§‹å‘é‡ç›¸ä¼¼åº¦æ’åºåŸºç¡€ä¸Šè¿›ä¸€æ­¥ç²¾ç‚¼ç»“æœï¼Œæå‡æ•´ä½“ç³»ç»Ÿçš„è¾“å‡ºè´¨é‡ä¸ç¨³å®šæ€§ã€‚</p>
<p>å¯¹äºä¸€äº›å¤æ‚æŸ¥è¯¢åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·é‡‡ç”¨è‡ªç„¶è¯­è¨€è¡¨è¾¾æ„å›¾æ—¶ï¼Œäººå·¥æ‰‹åŠ¨æ„é€ å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶ä¸ä»…ç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºç°æ­§ä¹‰æˆ–é—æ¼ã€‚ä¸ºæ­¤ï¼Œç›®å‰ä¹Ÿæœ‰æ–¹æ¡ˆæ˜¯ç»“åˆå¤§è¯­è¨€æ¨¡å‹çš„èƒ½åŠ›ï¼Œå®ç°è‡ªåŠ¨ä»ç”¨æˆ·è¾“å…¥ä¸­æå–å‡ºä¸å…ƒæ•°æ®ç›¸å…³çš„ç»“æ„åŒ–æŸ¥è¯¢æ¡ä»¶ã€‚è¿™ç§â€œæ™ºèƒ½å…ƒæ•°æ®è¿‡æ»¤â€æ¨¡å¼æå¤§æå‡äº†æ£€ç´¢è¿‡ç¨‹çš„çµæ´»æ€§ä¸é€‚åº”æ€§ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥â€œå±•ç¤º 2022 å¹´å‘å¸ƒçš„ Project A çš„ç›¸å…³æ–‡æ¡£â€ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨è§£æå‡ºä¸¤ä¸ªå…³é”®è¿‡æ»¤å­—æ®µï¼šæ—¶é—´ä¸º 2022 å¹´ï¼Œé¡¹ç›®ä¸º Project Aï¼Œå¹¶æ®æ­¤æ‰§è¡Œç²¾å‡†çš„æ–‡æ¡£å‘é‡æ£€ç´¢ï¼Œæ˜¾è‘—æå‡è¿”å›ç»“æœçš„é’ˆå¯¹æ€§å’Œå‘½ä¸­ç‡ã€‚</p>
<p>Amazon OpenSearch æä¾›äº†å¼ºå¤§çš„å…ƒæ•°æ®è¿‡æ»¤èƒ½åŠ›ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡æ—¶é—´ã€ç±»åˆ«ã€æ¥æºç­‰å…ƒæ•°æ®ç»´åº¦ç²¾å‡†æ§åˆ¶æ£€ç´¢èŒƒå›´ï¼Œæœ‰æ•ˆæé«˜ç³»ç»Ÿæ•´ä½“çš„æ£€ç´¢è´¨é‡ã€‚å®ƒä¸»è¦æä¾› 3 ç§è¿‡æ»¤æ–¹æ³•[5]ï¼š</p>
<ol>
<li>é«˜æ•ˆ <strong>k-NN</strong> è¿‡æ»¤ï¼ˆ<strong>Efficient k-NN Filtering</strong>ï¼‰ï¼šè‡ª OpenSearch 2.9 èµ·ï¼Œæ”¯æŒåœ¨å‘é‡æ£€ç´¢è¿‡ç¨‹ä¸­åŒæ—¶åº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼Œé¿å…äº†ä¼ ç»Ÿçš„é¢„è¿‡æ»¤æˆ–åè¿‡æ»¤æ–¹å¼å¯èƒ½å¯¼è‡´çš„ç»“æœæ•°é‡ä¸è¶³æˆ–æ€§èƒ½ä¸‹é™çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿åœ¨æ»¡è¶³è¿‡æ»¤æ¡ä»¶çš„æ–‡æ¡£ä¸­è¿”å›å‡†ç¡®çš„ k ä¸ªæœ€è¿‘é‚»ç»“æœ</li>
<li>å¸ƒå°”åè¿‡æ»¤ï¼ˆ<strong>Boolean Post-Filtering</strong>ï¼‰ï¼šæ­¤æ–¹æ³•åœ¨å‘é‡æ£€ç´¢ååº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼Œé€‚ç”¨äºè¿‡æ»¤æ¡ä»¶ä¸å¤ªä¸¥æ ¼çš„åœºæ™¯ã€‚ä½†åœ¨è¿‡æ»¤æ¡ä»¶è¾ƒä¸¥æ ¼æ—¶ï¼Œå¯èƒ½å¯¼è‡´è¿”å›çš„ç»“æœå°‘äºé¢„æœŸçš„ k ä¸ª</li>
<li>è¯„åˆ†è„šæœ¬è¿‡æ»¤ï¼ˆ<strong>Scoring Script Filtering</strong>ï¼‰ï¼šæ­¤æ–¹æ³•å…ˆå¯¹æ–‡æ¡£é›†åº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼Œç„¶ååœ¨è¿‡æ»¤åçš„å­é›†ä¸Šæ‰§è¡Œç²¾ç¡®çš„ k-NN æ£€ç´¢ã€‚é€‚ç”¨äºå¯¹ç²¾åº¦è¦æ±‚é«˜çš„åœºæ™¯ï¼Œä½†åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶å¯èƒ½é¢ä¸´é«˜å»¶è¿Ÿå’Œæ‰©å±•æ€§é—®é¢˜ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿åœ¨å¤§è§„æ¨¡å‘é‡æ£€ç´¢çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œä¹Ÿå¹¶éæ‰€æœ‰æƒ…å†µä¸‹éƒ½å¿…é¡»é‡‡ç”¨è¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆANNï¼‰æ£€ç´¢ã€‚åœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œé¢„è¿‡æ»¤ï¼ˆpre-filterï¼‰ç»“åˆç²¾ç¡® k-NN æ£€ç´¢çš„æ–¹å¼ï¼Œç›¸è¾ƒäº ANN æ›´å…·ä¼˜åŠ¿ï¼Œæ—¢èƒ½é™ä½èµ„æºæˆæœ¬ï¼Œåˆèƒ½å®ç°æ›´é«˜çš„å¬å›ç‡ã€‚</p>
<p>è¿™ç±»åœºæ™¯çš„å…¸å‹ç‰¹å¾æ˜¯ï¼šå°½ç®¡å…¨å±€å‘é‡æ± çš„è§„æ¨¡éå¸¸å¤§ï¼ˆå¦‚åƒä¸‡çº§ç”šè‡³ä¸Šäº¿æ¡å‘é‡ï¼‰ï¼Œä½†åœ¨åº”ç”¨å…ƒæ•°æ®è¿‡æ»¤æ¡ä»¶åï¼Œå®é™…å‚ä¸å‘é‡æ£€ç´¢çš„æ•°æ®å­é›†ç›¸å¯¹è¾ƒå°ï¼ˆé€šå¸¸åœ¨å‡ åƒåˆ°å‡ ä¸‡æ¡ä¹‹é—´ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä»ä½¿ç”¨å…¨å±€ ANN ç´¢å¼•ï¼ˆå¦‚ HNSWï¼‰å¹¶å°†å…¶å®Œå…¨åŠ è½½è‡³å†…å­˜ä»¥å®ç°ä½å»¶è¿ŸæŸ¥è¯¢ï¼Œå°†å¸¦æ¥è¾ƒé«˜çš„å†…å­˜å¼€é”€ã€‚è€Œé‡‡ç”¨ pre-filter + ç²¾ç¡® k-NN çš„æ£€ç´¢æ¨¡å¼ï¼Œåˆ™æ— éœ€æ„å»ºå’Œç»´æŠ¤å¤§å‹ ANN ç´¢å¼•ï¼Œæ˜¾è‘—é™ä½äº†å†…å­˜æ¶ˆè€—ã€‚æ­¤å¤–ï¼Œåœ¨è¿‡æ»¤åçš„æ•°æ®é›†è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå³ä½¿é‡‡ç”¨æš´åŠ›è®¡ç®—æ–¹å¼è¿›è¡Œç²¾ç¡® k-NN ä¹Ÿä¸ä¼šäº§ç”Ÿæ˜æ˜¾çš„è®¡ç®—è´Ÿæ‹…ã€‚è¿™ç§æ–¹å¼æ—¢èƒ½ç¡®ä¿æ£€ç´¢ç»“æœçš„å®Œæ•´æ€§ï¼ˆå³ 100% å¬å›ï¼‰ï¼Œåˆé¿å…äº† ANN å¼•å…¥çš„è¿‘ä¼¼è¯¯å·®ï¼Œå¯¹äºå¯¹å¬å›ç‡è¦æ±‚è¾ƒé«˜çš„åœºæ™¯å°¤ä¸ºé€‚ç”¨ã€‚</p>
<p>åœ¨ä½¿ç”¨ Amazon OpenSearch è¿›è¡Œå‘é‡æ£€ç´¢çš„å®é™…å®¢æˆ·æ¡ˆä¾‹ä¸­ï¼Œå·²æœ‰å¤šä¸ªé¡¹ç›®é€‰æ‹©äº† pre-filter + ç²¾ç¡® k-NN çš„æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œåœ¨æŸä¸ªåŸºäºæ‘„åƒå¤´é‡‡é›†çš„ç”»é¢è¿›è¡Œå‘é‡æ£€ç´¢çš„åœºæ™¯ä¸­ï¼Œç³»ç»Ÿæ€»å…±ç»´æŠ¤ç€çº¦ 1400 ä¸‡æ¡å‘é‡ã€‚å°½ç®¡å‘é‡æ€»é‡åºå¤§ï¼Œä½†æ¯æ¬¡æ£€ç´¢å‰éƒ½ä¼šé€šè¿‡â€œè®¾å¤‡ IDâ€ä»¥åŠå…¶ä»–ä¸šåŠ¡ç›¸å…³å­—æ®µè¿›è¡Œé¢„è¿‡æ»¤ï¼Œæœ€ç»ˆå‚ä¸è®¡ç®—çš„å‘é‡è§„æ¨¡é€šå¸¸ä»…ä¸º 3000 è‡³ 4000 æ¡ã€‚åœ¨è¿™ç§æ¡ä»¶ä¸‹ï¼Œé‡‡ç”¨ç²¾ç¡® k-NN è€Œé ANNï¼Œä¸ä»…å¤§å¹…é™ä½äº†ç³»ç»Ÿèµ„æºå ç”¨ï¼ŒåŒæ—¶è¿˜èƒ½ç¡®ä¿æ£€ç´¢çš„å¬å›ç‡è¾¾åˆ° 100%ï¼Œå®ç°äº†æ›´é«˜çš„æ€§ä»·æ¯”ã€‚</p>
<p>5ã€ç¨€ç–å‘é‡æ£€ç´¢èƒ½åŠ›ç¨€ç–å‘é‡æ£€ç´¢ï¼ˆSparse Vector Searchï¼‰æ˜¯ä¸€ç§ç»“åˆäº†ä¼ ç»Ÿå…³é”®è¯åŒ¹é…å’Œç¥ç»ç½‘ç»œè¯­ä¹‰ç†è§£çš„æ£€ç´¢æ–¹æ³•ã€‚å®ƒå¹¶éç®€å•åœ°æ›¿ä»£å…³é”®è¯æˆ–ç¨ å¯†å‘é‡æ£€ç´¢ï¼Œè€Œæ˜¯æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢å’Œç¨ å¯†å‘é‡æ£€ç´¢å„è‡ªçš„å±€é™æ€§ï¼Œæå‡æœç´¢çš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼ŒåŒæ—¶å…¼é¡¾è®¡ç®—æ•ˆç‡å’Œå“åº”é€Ÿåº¦ï¼Œåœ¨ç‰¹å®šåœºæ™¯ä¸‹æä¾›æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚æˆ–ä½œä¸ºæ··åˆæ£€ç´¢ç­–ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œä¸å…¶ä»–æ–¹æ³•ååŒå·¥ä½œã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦ç¨€ç–å‘é‡æ£€ç´¢ï¼Ÿæˆ‘ä»¬ä»ç›®å‰å…³é”®è¯æ£€ç´¢å’Œç¨ å¯†å‘é‡æ£€ç´¢å­˜åœ¨çš„æŒ‘æˆ˜ï¼Œä»¥åŠç¨€ç–å‘é‡å¦‚ä½•è§£å†³çš„è§’åº¦æ¥çœ‹ï¼š</p>
<ul>
<li>å…³é”®è¯æ£€ç´¢ï¼šä¼ ç»Ÿå…³é”®è¯æ£€ç´¢ï¼ˆåŸºäºå€’æ’ç´¢å¼•çš„è¯æ³•æœç´¢ï¼‰ä¾èµ–è¯æ±‡åŒ¹é…ï¼Œéš¾ä»¥å¤„ç†è¯æ±‡ä¸åŒ¹é…ã€åŒä¹‰è¯ã€å¤šä¹‰è¯ç­‰è¯­ä¹‰é—®é¢˜ï¼Œå¯¼è‡´ç›¸å…³æ€§ä¸è¶³ã€‚ç¨€ç–å‘é‡æ£€ç´¢é€šè¿‡ç¥ç»ç½‘ç»œæ¨¡å‹ï¼ˆå¦‚ SPLADEï¼‰å°†æ–‡æœ¬ç¼–ç ä¸ºé«˜ç»´ç¨€ç–å‘é‡ï¼Œæ¯ä¸ªç»´åº¦å¯¹åº”ä¸€ä¸ªè¯æˆ–å­è¯ï¼Œå¹¶èµ‹äºˆæƒé‡ã€‚è¿™ç§è¡¨ç¤ºæ–¹å¼ä¸ä»…ä¿ç•™äº†å…³é”®è¯çš„é‡è¦æ€§ï¼Œè¿˜å¼•å…¥äº†è¯­ä¹‰æ‰©å±•èƒ½åŠ›ï¼Œèƒ½å¤Ÿè¯†åˆ«ä¸æŸ¥è¯¢ç›¸å…³çš„åŒä¹‰è¯æˆ–ç›¸å…³è¯æ±‡ï¼Œä»è€Œæé«˜å¬å›ç‡ã€‚</li>
<li>ç¨ å¯†å‘é‡æ£€ç´¢ï¼šç¨ å¯†å‘é‡æ£€ç´¢ï¼ˆDense Vector Searchï¼‰é€šè¿‡é«˜ç»´å‘é‡æ•æ‰è¯­ä¹‰ï¼Œä½†è®¡ç®—å’Œå­˜å‚¨å¼€é”€è¾ƒå¤§ï¼Œå°¤å…¶åœ¨æµ·é‡æ•°æ®å’Œé«˜ç»´åº¦ä¸‹ï¼Œå»¶è¿Ÿå’Œæˆæœ¬æ˜¾è‘—å¢åŠ ã€‚Sparse Search é€šè¿‡ç¨€ç–å‘é‡è¡¨ç¤ºï¼ˆåªåŒ…å«å°‘é‡éé›¶é¡¹åŠå…¶æƒé‡ï¼‰ï¼Œæ˜¾è‘—å‡å°‘è®¡ç®—é‡å’Œå†…å­˜å ç”¨ï¼ŒåŒæ—¶ä¿æŒè¾ƒå¥½çš„è¯­ä¹‰ç›¸å…³æ€§ã€‚ è¿™ä½¿å¾—ç¨€ç–å‘é‡æ£€ç´¢åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†æ—¶å…·æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼Œå°¤å…¶é€‚ç”¨äºèµ„æºå—é™çš„ç¯å¢ƒã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œç¨€ç–å‘é‡æ£€ç´¢æ˜¯ä¸€ç§ä»‹äºå…³é”®è¯æ£€ç´¢å’Œç¨ å¯†å‘é‡æ£€ç´¢ä¹‹é—´çš„åˆ›æ–°æŠ€æœ¯ï¼Œæ—¨åœ¨æå‡è¯­ä¹‰ç†è§£å’Œæ£€ç´¢æ•ˆç‡ã€‚å®ƒæ—¢ä¸æ˜¯å•çº¯æ›¿ä»£å…³é”®è¯æ£€ç´¢ï¼Œä¹Ÿä¸æ˜¯å•çº¯æ›¿ä»£ç¨ å¯†å‘é‡æ£€ç´¢ï¼Œè€Œæ˜¯ä½œä¸ºä¸¤è€…çš„æœ‰æ•ˆè¡¥å……ï¼Œå¸®åŠ©æ„å»ºæ›´é«˜æ•ˆã€æ›´å‡†ç¡®çš„æœç´¢ç³»ç»Ÿã€‚</p>
<p>Amazon OpenSearch è‡ª 2.11 ç‰ˆæœ¬èµ·å¼•å…¥äº†ç¥ç»ç¨€ç–æ£€ç´¢ï¼ˆNeural Sparse Searchï¼‰åŠŸèƒ½ï¼Œä¸ºè¯­ä¹‰æœç´¢æä¾›äº†ä¸€ç§é«˜æ•ˆã€ä½èµ„æºæ¶ˆè€—çš„æ›¿ä»£æ–¹æ¡ˆã€‚ç¨€ç–å‘é‡æ£€ç´¢ç»“åˆäº†ä¼ ç»Ÿå€’æ’ç´¢å¼•çš„é«˜æ€§èƒ½å’Œç¥ç»ç½‘ç»œæ¨¡å‹çš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼Œç‰¹åˆ«é€‚ç”¨äºå¯¹å¬å›ç‡ã€å¯è§£é‡Šæ€§å’Œæˆæœ¬æ§åˆ¶æœ‰è¾ƒé«˜è¦æ±‚çš„åœºæ™¯ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–‡æœ¬é¦–å…ˆé€šè¿‡ç¨€ç–ç¼–ç æ¨¡å‹ï¼ˆå¦‚ OpenSearch æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ï¼‰è½¬æ¢ä¸ºç¨€ç–å‘é‡ï¼Œå³ç”±éé›¶æƒé‡çš„ token:weight é”®å€¼å¯¹ç»„æˆçš„å‘é‡ã€‚è¿™äº›å‘é‡è¢«ç´¢å¼•åˆ° Lucene çš„å€’æ’ç´¢å¼•ä¸­ï¼Œåˆ©ç”¨<code>FeatureField</code>å­˜å‚¨ç»“æ„ã€‚æŸ¥è¯¢æ—¶ï¼Œè¾“å…¥æ–‡æœ¬åŒæ ·è¢«ç¼–ç ä¸ºç¨€ç–å‘é‡ï¼Œå¹¶é€šè¿‡å€’æ’ç´¢å¼•è¿›è¡ŒåŒ¹é…å’Œæ‰“åˆ†ï¼Œä»è€Œå®ç°è¯­ä¹‰çº§çš„æ£€ç´¢[6]ã€‚</p>
<p>ç›®å‰ Amazon OpenSearch æ”¯æŒä¸¤ç§ç¨€ç–æ£€ç´¢æ¨¡å¼ï¼š</p>
<ul>
<li><strong>Doc-only</strong> æ¨¡å¼ï¼šä»…åœ¨ç´¢å¼•é˜¶æ®µå¯¹æ–‡æ¡£è¿›è¡Œè¯­ä¹‰æ‰©å±•ï¼ŒæŸ¥è¯¢é˜¶æ®µä¸è¿›è¡Œæ‰©å±•ã€‚è¯¥æ¨¡å¼å»¶è¿Ÿä½ï¼Œæ€§èƒ½æ¥è¿‘ä¼ ç»Ÿ BM25 æ£€ç´¢ï¼Œé€‚ç”¨äºå¯¹å“åº”é€Ÿåº¦è¦æ±‚é«˜çš„åœºæ™¯</li>
<li><strong>Bi-encoder</strong> æ¨¡å¼ï¼šåœ¨ç´¢å¼•å’ŒæŸ¥è¯¢é˜¶æ®µå‡è¿›è¡Œè¯­ä¹‰æ‰©å±•ï¼Œèƒ½å¤Ÿæ›´å…¨é¢åœ°æ•æ‰æŸ¥è¯¢æ„å›¾ï¼Œæé«˜æ£€ç´¢ç›¸å…³æ€§ï¼Œä½†ç›¸åº”åœ°è®¡ç®—å¼€é”€å’Œå»¶è¿Ÿä¹Ÿæ›´é«˜</li>
</ul>
<p>åœ¨ Amazon OpenSearch ä¸­ä½¿ç”¨ç¨€ç–å‘é‡æ£€ç´¢çš„æ“ä½œéå¸¸ç®€ä¾¿ï¼Œå…¶é…ç½®æµç¨‹ä¸ç¬¬ 3.1 èŠ‚æ‰€ä»‹ç»çš„æ­¥éª¤åŸºæœ¬ä¸€è‡´ã€‚æ ¹æ®å®˜æ–¹å‘å¸ƒçš„æµ‹è¯•ç»“æœ[7]ï¼Œç¨€ç–ä¸ç¨ å¯†å‘é‡ç»“åˆçš„æ··åˆæ£€ç´¢æ–¹æ³•åœ¨æ•´ä½“æ£€ç´¢æ•ˆæœä¸Šä¼˜äºä¼ ç»Ÿ BM25 ä¸ç¨ å¯†å‘é‡çš„ç»„åˆã€‚ç„¶è€Œï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œç¨€ç–å‘é‡æ£€ç´¢çš„æ€§èƒ½é«˜åº¦ä¾èµ–äºæ‰€ä½¿ç”¨çš„ç¨€ç–ç¼–ç å™¨ï¼ˆSparse Encoderï¼‰æ¨¡å‹çš„è´¨é‡ã€‚å¦‚æœæ¨¡å‹åœ¨æ‰©å±•è¯æ±‡ä¸Šçš„è¯­ä¹‰ç›¸å…³æ€§è¾ƒå¼±ï¼Œå°†ç›´æ¥å½±å“æœ€ç»ˆçš„å¬å›èƒ½åŠ›ã€‚</p>
<p>æ­¤å¤–ï¼Œç”±äºå¤§å¤šæ•°ç¨€ç–ç¼–ç å™¨æ˜¯åœ¨é€šç”¨è¯­æ–™ä¸Šè¿›è¡Œé¢„è®­ç»ƒçš„ï¼Œåœ¨é¢å¯¹ç‰¹å®šå‚ç›´é¢†åŸŸä¸­çš„ä¸“ä¸šæœ¯è¯­æ—¶ï¼Œå…¶å¬å›æ•ˆæœå¯èƒ½ç”šè‡³ä¸å¦‚ä¼ ç»Ÿçš„å…³é”®è¯åŒ¹é…ã€‚è¿™æ„å‘³ç€åœ¨ç‰¹å®šä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ˜¯å¦é€‚åˆä½¿ç”¨ç¨€ç–æ£€ç´¢ä»éœ€ç»“åˆå®é™…æ•°æ®è¿›è¡Œè¯„ä¼°ã€‚å¿…è¦æ—¶ï¼Œå¯èƒ½è¿˜éœ€å¯¹ç¨€ç–ç¼–ç å™¨è¿›è¡Œå¾®è°ƒï¼Œä»¥ä¼˜åŒ–å…¶åœ¨ç›®æ ‡é¢†åŸŸä¸­çš„æ£€ç´¢æ•ˆæœã€‚</p>
<h2 data-id="heading-4">Amazon OpenSearch Serverless</h2>
<p>é™¤äº†ä¼ ç»Ÿçš„é›†ç¾¤éƒ¨ç½²æ¨¡å¼ï¼ŒAmazon OpenSearch è¿˜æä¾›äº† Serverless æ¨¡å¼ï¼Œå…·å¤‡æ— éœ€è¿ç»´ã€è‡ªåŠ¨å¼¹æ€§æ‰©ç¼©çš„ä¼˜åŠ¿ï¼Œä¸ºå‘é‡å­˜å‚¨ä¸æ£€ç´¢æä¾›äº†ä¸€ç§é«˜æ•ˆä¾¿æ·çš„è§£å†³æ–¹æ¡ˆã€‚OpenSearch Serverless æ˜¯ä¸“ä¸ºç”Ÿæˆå¼äººå·¥æ™ºèƒ½ï¼ˆGenerative AIï¼‰å’Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰åº”ç”¨è®¾è®¡çš„æ— æœåŠ¡å™¨å‘é‡æ•°æ®åº“ï¼Œå…·å¤‡é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„å‘é‡æ£€ç´¢èƒ½åŠ›ï¼Œèƒ½å¤Ÿåœ¨æ¯«ç§’çº§å»¶è¿Ÿå†…å®Œæˆæœç´¢ï¼Œé€‚ç”¨äºè¯­ä¹‰æœç´¢ã€æ¨èç³»ç»Ÿã€èŠå¤©æœºå™¨äººç­‰å¤šç§æ™ºèƒ½åº”ç”¨åœºæ™¯ã€‚</p>
<p>å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå®Œå…¨æ‰˜ç®¡çš„æ— æœåŠ¡å™¨æ¶æ„ï¼Œç”¨æˆ·æ— éœ€é¢„ç½®ã€é…ç½®æˆ–ç®¡ç†åº•å±‚é›†ç¾¤èµ„æºã€‚ç³»ç»Ÿä¼šæ ¹æ®å®é™…è´Ÿè½½è‡ªåŠ¨å®Œæˆèµ„æºçš„æ‰©å±•ä¸å›æ”¶ï¼Œåœ¨è®¿é—®æ¨¡å¼æˆ–åº”ç”¨éœ€æ±‚æ³¢åŠ¨æ—¶ï¼Œä¾ç„¶èƒ½å¤Ÿä¿æŒé«˜ååç‡å’Œä½å»¶è¿Ÿå“åº”ã€‚åŒæ—¶ï¼ŒOpenSearch Serverless ä¸ Amazon S3 æ·±åº¦é›†æˆï¼Œå…·å¤‡ä¸ S3 ç›¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯ç”¨ä¸å¼ºä¸€è‡´æ€§ã€‚</p>
<p>åœ¨ RAG åº”ç”¨ä¸­ï¼ŒOpenSearch Serverless æ”¯æŒå‘é‡æ£€ç´¢ä¸æ–‡æœ¬å…³é”®è¯æ£€ç´¢çš„æ— ç¼èåˆï¼Œè¿›ä¸€æ­¥æå‡è¯­ä¹‰ç›¸å…³æ€§çš„åŒ¹é…æ•ˆæœã€‚å®ƒå†…ç½®ä¸ä¼ ç»Ÿé›†ç¾¤æ¨¡å¼ä¸€è‡´çš„è¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆANNï¼‰ç®—æ³•ï¼Œä¾‹å¦‚ HNSWï¼ˆåˆ†å±‚å¯å¯¼èˆªå°ä¸–ç•Œå›¾ï¼‰ï¼Œå¯åœ¨å¤§è§„æ¨¡å‘é‡æ•°æ®é›†ä¸Šå®ç°å¿«é€Ÿã€å‡†ç¡®çš„ç›¸ä¼¼æ€§æœç´¢ã€‚å€ŸåŠ©ä¸ Amazon Bedrock çš„åŸç”ŸåŒå‘é›†æˆï¼ŒOpenSearch Serverless å¯ä¸å¦‚ Amazon Titan Embeddings ç­‰åŸºç¡€æ¨¡å‹æ— ç¼åä½œï¼Œç®€åŒ–åµŒå…¥ç”Ÿæˆã€æ£€ç´¢è°ƒç”¨ç­‰ RAG å·¥ä½œæµå¼€å‘æµç¨‹ã€‚</p>
<p>åœ¨å®‰å…¨æ–¹é¢ï¼ŒOpenSearch Serverless åŸç”Ÿé›†æˆ Amazon Identity and Access Managementï¼ˆIAMï¼‰ï¼Œæ”¯æŒç»†ç²’åº¦çš„æƒé™æ§åˆ¶ï¼ŒåŒæ—¶æ”¯æŒé€šè¿‡ Amazon Key Management Serviceï¼ˆKMSï¼‰è¿›è¡Œæ•°æ®åŠ å¯†ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“ä¸å­˜å‚¨è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§ä¸æœºå¯†æ€§ã€‚</p>
<p>ç›®å‰ï¼ŒOpenSearch Serverless å·²åœ¨å¤šä¸ªå®é™…å®¢æˆ·åœºæ™¯ä¸­å¾—åˆ°è½åœ°åº”ç”¨ã€‚ä¾‹å¦‚ riskCanvasâ€”â€”ä¸€æ¬¾åŸºäº SaaS çš„é‡‘èçŠ¯ç½ªåˆè§„è§£å†³æ–¹æ¡ˆäº§å“ï¼Œå……åˆ†åˆ©ç”¨å¤§æ•°æ®ã€è‡ªåŠ¨åŒ–ä¸æœºå™¨å­¦ä¹ ç­‰å…ˆè¿›æŠ€æœ¯ï¼Œå¸®åŠ©å®¢æˆ·æå‡åˆè§„æ•ˆç‡ä¸ä¸šåŠ¡æ™ºèƒ½åŒ–æ°´å¹³ã€‚riskCanvas é€šè¿‡ä¸ OpenSearch Serverless å‘é‡å¼•æ“é›†æˆï¼Œç»“åˆ Amazon ç”Ÿæˆå¼ AI èƒ½åŠ›ï¼Œå°†å®¢æˆ·æ“ä½œæ•°æ®è½¬åŒ–ä¸ºå¯æœç´¢ã€å¯ç†è§£çš„è¯­ä¹‰å‘é‡ï¼Œä¸ºé‡‘èé¢†åŸŸçš„é£æ§å’Œåˆè§„æä¾›äº†å¼ºå¤§çš„æ”¯æŒ[8]ã€‚</p>
<h2 data-id="heading-5">Amazon OpenSearch ä¸ Amazon AI æœåŠ¡çš„å¼ºå¤§ç»„åˆ</h2>
<p>Amazon OpenSearch ä¸ Amazon Bedrock çš„æ·±åº¦é›†æˆä¸ºä¼ä¸šçº§ RAGï¼ˆRetrieval-Augmented Generationï¼‰åº”ç”¨æ„å»ºæä¾›äº†ç«¯åˆ°ç«¯çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚Amazon Bedrock è®©å¼€å‘è€…å¯ä»¥è½»æ¾æ¥å…¥å¤šç§ä¸»æµåŸºç¡€æ¨¡å‹ï¼Œè€Œ Amazon OpenSearch åˆ™æä¾›äº†é«˜æ€§èƒ½ã€å¯æ‰©å±•çš„å‘é‡æ£€ç´¢èƒ½åŠ›ã€‚è¿™ç§å¼ºå¼ºè”åˆï¼Œä½¿ä¼ä¸šèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°æ„å»ºå¹¶éƒ¨ç½²é«˜è´¨é‡çš„ç”Ÿæˆå¼ AI åº”ç”¨ï¼ŒåŠ é€Ÿæ™ºèƒ½åŒ–è½¬å‹ã€‚</p>
<p>ä¾‹å¦‚åœ¨å‰æ–‡ç¬¬ 3.1 èŠ‚æ‰€ä»‹ç»çš„åµŒå…¥é›†æˆæµç¨‹ä¸­ï¼ŒAmazon OpenSearch ä¸ Amazon Bedrock ä¹‹é—´çš„é›†æˆæä¸ºç®€ä¾¿ï¼Œä»…éœ€å‡ è¡Œä»£ç å³å¯å®ç°å‘é‡ç”Ÿæˆä¸æ£€ç´¢çš„å®Œæ•´é—­ç¯ã€‚å¼€å‘è€…å¯ä»¥ä½¿ç”¨ Amazon Bedrock æä¾›çš„åµŒå…¥æ¨¡å‹ï¼ˆå¦‚ Amazon Titan Embeddingsï¼‰å°†æ–‡æ¡£å’Œç”¨æˆ·æŸ¥è¯¢ç¼–ç ä¸ºå‘é‡ï¼Œç„¶åå°†è¿™äº›å‘é‡å­˜å…¥ Amazon OpenSearchï¼Œè¿›ä¸€æ­¥å®ç°é«˜æ•ˆè¯­ä¹‰æ£€ç´¢ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯¹äºéƒ¨åˆ†ç®€å•çš„ä¸šåŠ¡åœºæ™¯ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ© Amazon OpenSearch æœ¬èº«çš„æœºå™¨å­¦ä¹ èƒ½åŠ›ä¸ Amazon AI æœåŠ¡ä¸­çš„æ¨¡å‹èƒ½åŠ›ï¼Œå¿«é€Ÿæ­å»º RAG åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨ OpenSearch å†…ç½®çš„ Retrieval-Augmented Generation Processorï¼ˆRAG å¤„ç†å™¨ï¼‰ï¼Œç»“åˆéƒ¨ç½²åœ¨ Amazon SageMaker ä¸Šçš„ DeepSeek æ¨¡å‹å’ŒåµŒå…¥æ¨¡å‹ï¼Œå³å¯å¿«é€Ÿæ„å»ºè¯­ä¹‰å¢å¼ºçš„é—®ç­”ç³»ç»Ÿ[9]ã€‚æ›´è¿›ä¸€æ­¥ï¼ŒAmazon Bedrock Knowledge Bases è¿˜æ”¯æŒé€šè¿‡æ§åˆ¶å°â€œä¸€é”®é›†æˆâ€åˆ° Amazon OpenSearchï¼Œæ— éœ€ç¼–å†™å¤æ‚ä»£ç å³å¯å®Œæˆ RAG æµç¨‹é…ç½®ï¼Œæä¾›æè‡´ç®€æ´çš„æ‰˜ç®¡åŒ–ä½¿ç”¨ä½“éªŒ[10]ã€‚</p>
<p>è¿™ä¸€æ•´å¥—ç”Ÿæ€ç³»ç»Ÿçš„ååŒå·¥ä½œï¼Œä¸ä»…æ˜¾è‘—é™ä½äº†æ„å»º RAG åº”ç”¨çš„é—¨æ§›ï¼Œè¿˜åœ¨æ€§èƒ½ã€çµæ´»æ€§ä¸å¯ç»´æŠ¤æ€§æ–¹é¢ä¸ºä¼ä¸šç”¨æˆ·å¸¦æ¥å¯è§‚çš„ä¼˜åŠ¿ã€‚æ— è®ºæ˜¯é¢å‘ç»ˆç«¯å®¢æˆ·çš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼Œè¿˜æ˜¯ä¼ä¸šå†…éƒ¨çš„çŸ¥è¯†åº“æ£€ç´¢åº”ç”¨ï¼ŒOpenSearch ä¸ Bedrock çš„ååŒéƒ½ä¸ºç”Ÿæˆå¼ AI çš„è½åœ°æä¾›äº†åšå®æŠ€æœ¯æ”¯æ’‘ã€‚</p>
<h2 data-id="heading-6">OpenSeach ä¸å¼€æºç”Ÿæ€</h2>
<p>é™¤äº†å¹¿æ³›åº”ç”¨äºäºšé©¬é€Šå†…éƒ¨ç³»ç»Ÿä»¥åŠäºšé©¬é€Šäº‘æœåŠ¡å®¢æˆ·æ„å»ºçš„ä¼ä¸šçº§åº”ç”¨ä¸­ï¼ŒOpenSearch ä½œä¸ºå‘é‡æ•°æ®åº“çš„èƒ½åŠ›ä¹Ÿè¢«å¼€æºç¤¾åŒºå’Œç¬¬ä¸‰æ–¹å¼€å‘è€…è®¤å¯ï¼Œå·²åœ¨å¤šä¸ªä¸»æµé¡¹ç›®ä¸­å¾—åˆ°å®é™…åº”ç”¨ã€‚ä¾‹å¦‚ Mem0ã€Dify å’Œ LangChain ç­‰é¡¹ç›®ï¼Œå‡åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡‡ç”¨ OpenSearch æ¥æ»¡è¶³å¯¹é«˜æ€§èƒ½è¯­ä¹‰æ£€ç´¢å’Œæ¨ªå‘æ‰©å±•èƒ½åŠ›çš„éœ€æ±‚ã€‚</p>
<p>Mem0 æ˜¯ä¸€ä¸ªä¸“æ³¨äºæ„å»ºè®°å¿†ç³»ç»Ÿçš„æ¡†æ¶ï¼Œæ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ä½œä¸ºåç«¯å­˜å‚¨ï¼Œå…¶ä¸­å°±åŒ…æ‹¬ OpenSearchã€‚é€šè¿‡æŠ½è±¡ç»Ÿä¸€çš„æ¥å£å’Œæ¨¡å—åŒ–å·¥å‚æ¨¡å¼ï¼ŒMem0 å…è®¸å¼€å‘è€…çµæ´»åœ°é€‰æ‹©æœ€é€‚åˆå½“å‰åœºæ™¯çš„å‘é‡å­˜å‚¨å¼•æ“ï¼Œå¹¶åœ¨é…ç½®ä¸­è‡ªå®šä¹‰é›†åˆåç§°ã€èŠ‚ç‚¹åœ°å€ã€ç«¯å£å·ã€å‘é‡ç»´åº¦ç­‰å‚æ•°ï¼Œä»è€Œå®ç°å¿«é€Ÿé›†æˆä¸éƒ¨ç½²ã€‚</p>
<p>LangChain åˆ™å°† OpenSearch æ·±åº¦é›†æˆè¿›å…¶è¯­è¨€æ¨¡å‹åº”ç”¨å¼€å‘æ¡†æ¶ä¸­ï¼Œåˆ©ç”¨ OpenSearch æ”¯æŒè¿‘ä¼¼æœ€è¿‘é‚»ï¼ˆk-NNï¼‰æœç´¢å’Œè¯­ä¹‰æ£€ç´¢çš„èƒ½åŠ›ï¼Œé…åˆ LangChain æä¾›çš„æ–‡æ¡£åŠ è½½ã€æ–‡æœ¬åˆ‡åˆ†ä¸åµŒå…¥ç”Ÿæˆæ¨¡å—ï¼Œå¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿæ„å»ºå‡ºé«˜æ•ˆçš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿï¼Œå®ç°è‡ªç„¶è¯­è¨€ç†è§£ä¸å“åº”çš„æ™ºèƒ½åŒ–ã€‚</p>
<p>Dify ä½œä¸ºä¸€ä¸ªå¼€æºçš„ LLMOps å¹³å°ï¼Œä¹Ÿæ”¯æŒå°† OpenSearch ä½œä¸ºå‘é‡å­˜å‚¨åç«¯ï¼Œé€‚é…å¤šç§éƒ¨ç½²ç¯å¢ƒï¼ŒåŒ…æ‹¬æœ¬åœ°å¼€å‘ã€ç§æœ‰åŒ–éƒ¨ç½²å’Œäº‘åŸç”Ÿæ¶æ„ï¼Œä½¿å…¶åœ¨æ€§èƒ½ã€çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§æ–¹é¢å‡å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ½œåŠ›ã€‚è¿™äº›é¡¹ç›®çš„å®è·µè¡¨æ˜ï¼ŒOpenSearch åœ¨æ„å»ºå¤§è§„æ¨¡ã€ä½å»¶è¿Ÿã€å¯æ°´å¹³æ‰©å±•çš„è¯­ä¹‰æ£€ç´¢ç³»ç»Ÿä¸­è¡¨ç°å‡ºè‰²ï¼Œå·²ç»æˆä¸ºç”Ÿäº§çº§å‘é‡æ•°æ®åº“è§£å†³æ–¹æ¡ˆçš„é‡è¦é€‰é¡¹ä¹‹ä¸€ã€‚</p>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒAmazon OpenSearch å‡­å€Ÿå…¶å…¨é¢çš„æœç´¢èƒ½åŠ›ã€çµæ´»çš„å‘é‡æ£€ç´¢æœºåˆ¶ã€åŸç”Ÿæ··åˆæœç´¢æ”¯æŒä»¥åŠå¼ºå¤§çš„å…ƒæ•°æ®è¿‡æ»¤åŠŸèƒ½ï¼Œä¸ºæ„å»ºä¼ä¸šçº§ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚ä»åº•å±‚çš„ KNN æ’ä»¶ä¸é‡åŒ–ä¼˜åŒ–ï¼Œåˆ°ä¸ Amazon Bedrockã€SageMaker ç­‰æœåŠ¡çš„æ·±åº¦é›†æˆï¼Œå†åˆ° Serverless æ¶æ„ä¸‹çš„ç®€åŒ–éƒ¨ç½²ï¼ŒAmazon OpenSearch åœ¨æ€§èƒ½ã€æ‰©å±•æ€§ä¸æ˜“ç”¨æ€§æ–¹é¢å±•ç°å‡ºå“è¶Šä¼˜åŠ¿ã€‚æ— è®ºæ˜¯é¢å‘å¤§è§„æ¨¡å‘é‡æ•°æ®æ£€ç´¢ã€é«˜å¹¶å‘å“åº”ï¼Œè¿˜æ˜¯æ»¡è¶³å¤æ‚å¤šæ ·çš„ä¼ä¸šçº§æ£€ç´¢éœ€æ±‚ï¼ŒAmazon OpenSearch éƒ½èƒ½æä¾›ç¨³å®šã€é«˜æ•ˆä¸”å…·æˆæœ¬æ•ˆç›Šçš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯æ‰“é€ é«˜è´¨é‡ RAG åº”ç”¨çš„é¦–é€‰å¹³å°ã€‚</p>
<p><strong>å‚è€ƒæ–‡æ¡£</strong></p>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.opensearch.org%2Fdocs%2Flatest%2Fvector-search%2Fvector-search-techniques%2Findex%2F" target="_blank" title="https://docs.opensearch.org/docs/latest/vector-search/vector-search-techniques/index/" ref="nofollow noopener noreferrer">OpenSearch KNN Search Methods and engines</a></p>
<p>[2] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Fbig-data%2Fchoose-the-k-nn-algorithm-for-your-billion-scale-use-case-with-opensearch%2F" target="_blank" title="https://aws.amazon.com/blogs/big-data/choose-the-k-nn-algorithm-for-your-billion-scale-use-case-with-opensearch/" ref="nofollow noopener noreferrer">Choose the k-NN algorithm for your billion-scale use case with OpenSearch</a></p>
<p>[3] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fpractice-of-knowledge-question-answering-application-based-on-llm-knowledge-base-construction-part-4%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/practice-of-knowledge-question-answering-application-based-on-llm-knowledge-base-construction-part-4/" ref="nofollow noopener noreferrer">åŸºäºå¤§è¯­è¨€æ¨¡å‹çŸ¥è¯†é—®ç­”åº”ç”¨è½åœ°å®è·µ â€“ çŸ¥è¯†å¬å›è°ƒä¼˜ï¼ˆä¸‹ï¼‰</a></p>
<p>[4] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fopensearch-implements-automatic-embedding-based-on-ml-commons-plugin%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/opensearch-implements-automatic-embedding-based-on-ml-commons-plugin/" ref="nofollow noopener noreferrer">OpenSearch åŸºäº ML Commons æ’ä»¶å®ç°è‡ªåŠ¨ embedding</a></p>
<p>[5] <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.opensearch.org%2Fdocs%2F2.19%2Fvector-search%2Ffilter-search-knn%2Findex%2F" target="_blank" title="https://docs.opensearch.org/docs/2.19/vector-search/filter-search-knn/index/" ref="nofollow noopener noreferrer">OpenSearch KNN Filtering data</a></p>
<p>[6] <a href="https://link.juejin.cn?target=https%3A%2F%2Fopensearch.org%2Fblog%2Fa-deep-dive-into-faster-semantic-sparse-retrieval-in-os-2-12%2F%3Futm_source%3Dchatgpt.com" target="_blank" title="https://opensearch.org/blog/a-deep-dive-into-faster-semantic-sparse-retrieval-in-os-2-12/?utm_source=chatgpt.com" ref="nofollow noopener noreferrer">A deep dive into faster semantic sparse retrieval in OpenSearch 2.12</a></p>
<p>[7] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fbig-data%2Fintegrate-sparse-and-dense-vectors-to-enhance-knowledge-retrieval-in-rag-using-amazon-opensearch-service%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/big-data/integrate-sparse-and-dense-vectors-to-enhance-knowledge-retrieval-in-rag-using-amazon-opensearch-service/" ref="nofollow noopener noreferrer">Integrate sparse and dense vectors to enhance knowledge retrieval in RAG using Amazon OpenSearch Service</a></p>
<p>[8] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fopensearch-service%2Fserverless-vector-database%2F" target="_blank" title="https://aws.amazon.com/opensearch-service/serverless-vector-database/" ref="nofollow noopener noreferrer">Amazon OpenSearch Service as a Vector Database</a></p>
<p>[9] <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fbuilding-a-knowledge-base-qna-application-based-on-amazon-opensearch-service-and-deepseek%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/building-a-knowledge-base-qna-application-based-on-amazon-opensearch-service-and-deepseek/" ref="nofollow noopener noreferrer">åŸºäº Amazon OpenSearch Service ä¸ DeepSeek æ„å»ºçŸ¥è¯†åº“é—®ç­”åº”ç”¨</a></p>
<p>[10]<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Faws%2Fknowledge-bases-now-delivers-fully-managed-rag-experience-in-amazon-bedrock%2F" target="_blank" title="https://aws.amazon.com/blogs/aws/knowledge-bases-now-delivers-fully-managed-rag-experience-in-amazon-bedrock/" ref="nofollow noopener noreferrer"> Knowledge Bases now delivers fully managed RAG experience in Amazon Bedrock</a></p>
<p><strong>æœ¬ç¯‡ä½œè€…</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/363de0df0eec4ce6ba281e157bfb6e6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557656&amp;x-signature=bVT0xeOljejcA86nTcEZfa33GWw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>æœ¬æœŸæœ€æ–°å®éªŒã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_InfoQtail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_InfoQtail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_InfoQtail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_InfoQtail_0415" ref="nofollow noopener noreferrer">å¤šæ¨¡ä¸€ç«™é€š â€”â€” Amazon Bedrock ä¸Šçš„åŸºç¡€æ¨¡å‹åˆä½“éªŒ</a>ã€‹</p>
<p>âœ¨ ç²¾å¿ƒè®¾è®¡ï¼Œæ—¨åœ¨å¼•å¯¼æ‚¨æ·±å…¥æ¢ç´¢Amazon Bedrockçš„æ¨¡å‹é€‰æ‹©ä¸è°ƒç”¨ã€æ¨¡å‹è‡ªåŠ¨åŒ–è¯„ä¼°ä»¥åŠå®‰å…¨å›´æ (Guardrail)ç­‰é‡è¦åŠŸèƒ½ã€‚æ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ï¼Œåˆ©ç”¨äºšé©¬é€ŠæŠ€æœ¯ä¸ç”Ÿæ€ï¼Œå¿«é€Ÿé›†æˆä¸éƒ¨ç½²ç”Ÿæˆå¼AIæ¨¡å‹èƒ½åŠ›ã€‚</p>
<p>â©ï¸[<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.amazoncloud.cn%2Fexperience%2Fcloudlab%3Fid%3D6695e4c5e1432f239fae485f%26visitfrom%3D3P_InfoQtail_0415%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_InfoQtail_0415" target="_blank" title="https://dev.amazoncloud.cn/experience/cloudlab?id=6695e4c5e1432f239fae485f&amp;visitfrom=3P_InfoQtail_0415&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_InfoQtail_0415" ref="nofollow noopener noreferrer">ç‚¹å‡»è¿›å…¥å®éªŒ</a>] å³åˆ»å¼€å¯ AI å¼€å‘ä¹‹æ—…æ„å»ºæ— é™, æ¢ç´¢å¯ç¨‹ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº]]></title>    <link>https://juejin.cn/post/7575735719076331526</link>    <guid>https://juejin.cn/post/7575735719076331526</guid>    <pubDate>2025-11-24T02:56:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575735719076331526" data-draft-id="7575644469711683603" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº"/> <meta itemprop="keywords" content="åç«¯,Node.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-24T02:56:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WindRunnerMax"/> <meta itemprop="url" content="https://juejin.cn/user/1829999989247214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1829999989247214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WindRunnerMax
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:56:52.000Z" title="Mon Nov 24 2025 02:56:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“åœ¨åç«¯æ‰§è¡Œå¤æ‚çš„ä»»åŠ¡æ—¶ï¼Œé€šå¸¸ä¸èƒ½å¤Ÿåœ¨çŸ­æ—¶é—´å†…å³æ—¶å“åº”ï¼Œä¾‹å¦‚æ–‡æ¡£å¯¼å…¥ã€å¯¼å‡ºä»»åŠ¡ç­‰ã€‚å†åŠ ä¸Šå½“å‰çš„<code>LLMs</code>å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ–‡æ¡£çš„å†™ä½œã€è´¨æ£€ã€ç¿»è¯‘ç­‰å¤æ‚ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡é€šå¸¸éƒ½æ¯”è¾ƒè€—æ—¶ï¼Œè¿™æ ·å°±éœ€è¦ä»»åŠ¡é˜Ÿåˆ—æ¥ç®¡ç†è¿™äº›å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºå’Œèµ„æºåˆ†é…ï¼Œè€Œä¼˜é›…åœæœºåˆ™ç”¨ä»¥ä¿è¯ä»»åŠ¡çš„å®Œæ•´å¤„ç†ã€‚</p>
<details>
<summary><strong>AI Infra ç³»åˆ—ç›¸å…³æ–‡ç« </strong></summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FBrowser%2F%25E5%259F%25BA%25E4%25BA%258Efetch%25E7%259A%2584SSE%25E6%2596%25B9%25E6%25A1%2588.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Browser/%E5%9F%BA%E4%BA%8Efetch%E7%9A%84SSE%E6%96%B9%E6%A1%88.md" ref="nofollow noopener noreferrer">åŸºäº fetch çš„ SSE æ–¹æ¡ˆ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E5%259F%25BA%25E4%25BA%258E%25E5%2590%2591%25E9%2587%258F%25E6%25A3%2580%25E7%25B4%25A2%25E5%25AE%259E%25E7%258E%25B0%25E5%259F%25BA%25E7%25A1%2580RAG%25E6%259C%258D%25E5%258A%25A1.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E5%9F%BA%E4%BA%8E%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2%E5%AE%9E%E7%8E%B0%E5%9F%BA%E7%A1%80RAG%E6%9C%8D%E5%8A%A1.md" ref="nofollow noopener noreferrer">åŸºäºå‘é‡æ£€ç´¢å®ç°åŸºç¡€ RAG æœåŠ¡</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E6%25B5%2581%25E5%25BC%258FMarkdown%25E5%25A2%259E%25E9%2587%258F%25E5%25AF%258C%25E6%2596%2587%25E6%259C%25AC%25E8%25A7%25A3%25E6%259E%2590%25E7%25AE%2597%25E6%25B3%2595.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E6%B5%81%E5%BC%8FMarkdown%E5%A2%9E%E9%87%8F%E5%AF%8C%E6%96%87%E6%9C%AC%E8%A7%A3%E6%9E%90%E7%AE%97%E6%B3%95.md" ref="nofollow noopener noreferrer">æµå¼ Markdown å¢é‡å¯Œæ–‡æœ¬è§£æç®—æ³•</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E4%25BB%25BF%25E7%2585%25A7%25E8%25B1%2586%25E5%258C%2585%25E5%25AE%259E%25E7%258E%25B0Prompt%25E5%258F%2598%25E9%2587%258F%25E6%25A8%25A1%25E6%259D%25BF%25E8%25BE%2593%25E5%2585%25A5%25E6%25A1%2586.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E4%BB%BF%E7%85%A7%E8%B1%86%E5%8C%85%E5%AE%9E%E7%8E%B0Prompt%E5%8F%98%E9%87%8F%E6%A8%A1%E6%9D%BF%E8%BE%93%E5%85%A5%E6%A1%86.md" ref="nofollow noopener noreferrer">ä»¿ç…§è±†åŒ…å®ç° Prompt å˜é‡æ¨¡æ¿è¾“å…¥æ¡†</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay%2Fblob%2Fmaster%2FPlugin%2F%25E5%259F%25BA%25E4%25BA%258ENodeJs%25E5%25AE%259E%25E7%258E%25B0%25E4%25BB%25BB%25E5%258A%25A1%25E9%2598%259F%25E5%2588%2597%25E4%25B8%258E%25E4%25BC%2598%25E9%259B%2585%25E5%2581%259C%25E6%259C%25BA.md" target="_blank" title="https://github.com/WindRunnerMax/EveryDay/blob/master/Plugin/%E5%9F%BA%E4%BA%8ENodeJs%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97%E4%B8%8E%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA.md" ref="nofollow noopener noreferrer">åŸºäº NodeJs çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ä¸å®¹å™¨ä¼˜é›…åœæœº</a></li>
</ul>
</details>
<h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>ä»»åŠ¡é˜Ÿåˆ—ç”¨äºç®¡ç†å’Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨å®ç°æ—¶æˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨ä¸€äº›ç°æˆçš„åº“ï¼Œä¾‹å¦‚<code>Bull/BullMQ</code>ã€<code>Agenda</code>ç­‰ã€‚è€Œå¦‚æœéœ€è¦å®ç°æ›´å¤æ‚çš„ä»»åŠ¡/æ¶ˆæ¯è°ƒåº¦ï¼Œä¾‹å¦‚ä¸åŒç³»ç»Ÿã€åº”ç”¨ä¹‹é—´çš„å¯é æ¶ˆæ¯ä¼ é€’ç­‰æœåŠ¡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨<code>Kafka</code>ã€<code>RabbitMQ</code>ç­‰æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚æ•´ä½“æ¥è¯´ï¼Œå¼‚æ­¥ä»»åŠ¡å¯ä»¥å®ç°å¦‚ä¸‹åŠŸèƒ½:</p>
<ul>
<li>å¼‚æ­¥ä»»åŠ¡ï¼Œå°†è€—æ—¶çš„æ“ä½œæ”¾åˆ°åå°å»å¤„ç†ï¼Œè®©ä¸»ç¨‹åºèƒ½å¤Ÿå¿«é€Ÿè¿”å›å“åº”ã€‚</li>
<li>æµé‡å‰Šå³°ï¼Œå°†å¤§é‡è¯·æ±‚è½¬åŒ–ä¸ºä»»åŠ¡ï¼Œå¹³ç¨³åœ°å­˜å…¥é˜Ÿåˆ—ï¼Œç„¶åç³»ç»ŸæŒ‰ç…§èƒ½æ‰¿å—çš„å¤„ç†èƒ½åŠ›ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œæ¶ˆè´¹ã€‚</li>
<li>é”™è¯¯é‡è¯•ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå¤±è´¥æ—¶ï¼Œé˜Ÿåˆ—å¯ä»¥å°è¯•è¿›è¡Œé‡è¯•ï¼Œå¦‚æœé‡è¯•å¤šæ¬¡åä»ç„¶å¤±è´¥ï¼Œåˆ™å¯ä»¥å°†ä»»åŠ¡æ ‡è®°ä¸ºå¤±è´¥ã€‚</li>
</ul>
<p>ä¼˜é›…åœæœºåˆ™æ˜¯æŒ‡åœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚åœ¨è¿™é‡Œçš„ä¼˜é›…åœæœºä¸»è¦åˆ†ä¸ºé’ˆå¯¹è¯·æ±‚çš„å¤„ç†å’Œé’ˆå¯¹ä»»åŠ¡é˜Ÿåˆ—çš„å¤„ç†ï¼Œè¯·æ±‚çš„éƒ¨åˆ†é€šå¸¸ä¼šç”±ç½‘å…³åŠ ä¸Šæ¡†æ¶æœ¬èº«å¤„ç†ï¼Œè€Œä»»åŠ¡é˜Ÿåˆ—çš„é‡ç½®æˆ–è€…ç»“æŸï¼Œåˆ™éœ€è¦é æˆ‘ä»¬ä¸»åŠ¨å¤„ç†ã€‚æ•´ä½“æ¥è¯´ï¼Œä¼˜é›…åœæœºé€šå¸¸éœ€è¦åšå¦‚ä¸‹å¤„ç†:</p>
<ul>
<li>åœæ­¢æ¥æ”¶æ–°çš„è¯·æ±‚ï¼ŒæœåŠ¡éœ€è¦é¿å…æ–°çš„è¯·æ±‚è¿›å…¥ï¼Œè¿™éƒ¨åˆ†é€šå¸¸éœ€è¦ç½‘å…³ç­‰å‰ç½®èŠ‚ç‚¹æ¥å¤„ç†ã€‚</li>
<li>å¤„ç†å½“å‰è¯·æ±‚ï¼ŒæœåŠ¡éœ€è¦ç»§ç»­å¤„ç†å½“å‰å·²ç»åœ¨å¤„ç†ä¸­çš„è¯·æ±‚ï¼Œç¡®ä¿è¿™äº›è¯·æ±‚èƒ½å¤Ÿæ­£å¸¸å®Œæˆã€‚</li>
<li>é‡Šæ”¾å·²åˆ†é…èµ„æºï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œéœ€è¦é‡Šæ”¾æ‰€æœ‰ç”³è¯·çš„èµ„æºï¼Œä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥ç­‰ã€‚</li>
<li>å…³é—­æœåŠ¡ï¼Œå½“æ‰€æœ‰è¯·æ±‚éƒ½å¤„ç†å®Œæ¯•ä¸”èµ„æºéƒ½å·²é‡Šæ”¾åï¼Œéœ€è¦æ­£å¸¸å…³é—­æœåŠ¡ï¼Œæˆ–è€…å¼ºåˆ¶åœæœºã€‚</li>
</ul>
<p>åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬åœ¨<code>Nest</code>æ¡†æ¶çš„åŸºç¡€ä¸Šï¼Œå®ç°ç®€åŒ–ç‰ˆçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦é˜Ÿåˆ—ã€‚å¹¶ä¸”åŸºäº<code>pm2</code>ç®¡ç†<code>NodeJs</code>è¿›ç¨‹ï¼Œå®ç°äº†ä¼˜é›…åœæœºçš„èƒ½åŠ›ï¼Œè€Œä¸”æ¢è®¨äº†<code>Linux</code>ç³»ç»Ÿä¸‹è¿›ç¨‹ä¸ä¿¡å·çš„ä¼ é€’è¡¨ç°ã€‚æ–‡ä¸­æ¶‰åŠçš„å®ç°éƒ½åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2Fwebpack-simple-environment" target="_blank" title="https://github.com/WindRunnerMax/webpack-simple-environment" ref="nofollow noopener noreferrer">github.com/WindRunnerMâ€¦</a> ä¸­ã€‚</p>
<h2 data-id="heading-1">ä»»åŠ¡é˜Ÿåˆ—</h2>
<p>ä»»åŠ¡é˜Ÿåˆ—çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ä¸»è¦ç›®æ ‡å°±æ˜¯æµé‡å‰Šå³°ï¼Œç‰¹åˆ«æ˜¯åœ¨è°ƒåº¦<code>LLMs</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¯·æ±‚æ’é˜Ÿå¤„ç†ï¼Œå½“å‰çš„äº‘æœåŠ¡å•†éƒ½ä¼šæœ‰å¹¶å‘è¯·æ±‚çš„é™åˆ¶ã€‚å½“å‰äº‘æœåŠ¡å•†ä¸»è¦æ˜¯ä¼šé™åˆ¶<code>RPM</code>å’Œ<code>TPM</code>ï¼Œå³æ¯åˆ†é’Ÿè¯·æ±‚æ•°å’Œæ¯åˆ†é’Ÿ<code>Token</code>æ•°é‡ï¼Œè¿™æ ·å°±éœ€è¦æˆ‘ä»¬åœ¨åº”ç”¨å±‚è¿›è¡Œè¯·æ±‚çš„æ’é˜Ÿå¤„ç†ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬å°±ä¸å€ŸåŠ©å·²æœ‰çš„æ¡†æ¶ï¼Œè€Œæ˜¯ç›´æ¥å®ç°ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸»è¦ç›®æ ‡æ˜¯èƒ½å¤Ÿæ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼Œå¹¶ä¸”å™è¿°å•è¿›ç¨‹ä»¥åŠå•æœºé›†ç¾¤æ¨¡å¼ã€åˆ†å¸ƒå¼ä»»åŠ¡çš„é”æ§åˆ¶æ–¹æ¡ˆã€‚è€Œé™¤äº†ä»»åŠ¡é˜Ÿåˆ—ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚éœ€è¦å¤„ç†ï¼Œä¾‹å¦‚ä»æ•°æ®åº“è¯»å–çš„æ§åˆ¶å¹¶å‘ã€ä»»åŠ¡è¶…æ—¶æ§åˆ¶ç­‰ï¼Œè¿™äº›éƒ½å¯ä»¥åœ¨å®é™…åº”ç”¨ä¸­è¿›è¡Œæ‰©å±•ã€‚</p>
<p>æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿé€šå¸¸ä¼šæœ‰æ¨é€æ¨¡å¼ä»¥åŠæ‹‰å–æ¨¡å¼ä¸¤ç§æ¶ˆæ¯æ¶ˆè´¹çš„æ–¹å¼ï¼Œè€Œå®é™…ä¸Šåœ¨æ‹‰å–æ¨¡å¼ä¸‹ï¼Œæ¶ˆè´¹è€…ä¹Ÿéœ€è¦å®ç°ç±»ä¼¼çš„ä»»åŠ¡é˜Ÿåˆ—æ¥æ§åˆ¶å¹¶å‘è¯·æ±‚ï¼Œä¾‹å¦‚<code>Kafka</code>ç³»ç»Ÿã€‚å½“ç„¶å¦‚æœæ˜¯æ¨é€æ¨¡å¼ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¿›è¡Œå¹¶å‘æ§åˆ¶ï¼Œä¾‹å¦‚<code>RabbitMQ</code>ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-2">å•å®ä¾‹ä»»åŠ¡</h3>
<p>æˆ‘ä»¬å…ˆæ¥å®ç°å•å®ä¾‹å•è¿›ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œé¦–å…ˆéœ€è¦å®ç°ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ç±»ï¼Œé€šè¿‡å®ä¾‹åŒ–è¿™ä¸ªç±»æˆ‘ä»¬å¯ä»¥åœ¨å¤šä¸ªæœåŠ¡<code>Service</code>åˆ†åˆ«è°ƒåº¦é˜Ÿåˆ—å®ä¾‹ã€‚åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚è‹¥ä¸æƒ³åœ¨å…¨å±€åˆ†åˆ«åˆ›å»ºå®ä¾‹ï¼Œåœ¨<code>Next</code>ä¸­å°±åœ¨<code>Provider</code>çš„ç±»ä¸­ç‹¬ç«‹ç»´æŠ¤å®ä¾‹ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„å…¶<code>Scope</code>å¿…é¡»ä¸ºå…¨å±€å•ä¾‹è€Œéè¯·æ±‚çº§å®ä¾‹ã€‚</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Injectable</span>({ <span class="hljs-attr">scope</span>: <span class="hljs-title class_">Scope</span>.<span class="hljs-property">DEFAULT</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TasksService</span> {}
</code></pre>
<p>æ¥ä¸‹æ¥å‡è®¾å®é™…ä»»åŠ¡æ˜¯åœ¨æ•°æ®åº“ä¸­å­˜å‚¨çš„ï¼Œæ¯•ç«Ÿä»»åŠ¡éœ€è¦æŒä¹…åŒ–å­˜å‚¨ä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ã€‚ç„¶åéœ€è¦å®ç°<code>TaskQueue</code>ç±»ä»¥æ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨æ˜¯å•å®ä¾‹å•è¿›ç¨‹çš„æ¨¡å¼ï¼Œå°±ä¸éœ€è¦åˆ†å¸ƒå¼é”çš„è¦æ±‚ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨å†…å­˜ä¸­çš„å˜é‡æ¥æ§åˆ¶å¹¶å‘ä»»åŠ¡ï¼Œè¿™é‡Œå…ˆå®šä¹‰ç±»åŸºæœ¬çš„ç»“æ„:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> declare <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskQueue</span> {
  <span class="hljs-comment">/** å®ä¾‹/é”æ ‡è¯† */</span>
  private readonly key;
  <span class="hljs-comment">/** å¹¶å‘è¿è¡Œæ•° */</span>
  private readonly maxTasks;
  <span class="hljs-comment">/** æœ¬æœºæ­£åœ¨è¿è¡Œä»»åŠ¡æ•°é‡ */</span>
  private runningTasks;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-comment">/** å”¯ä¸€æ ‡è¯† */</span> key: string, <span class="hljs-comment">/** æœ€å¤§å¹¶è¡Œä»»åŠ¡æ•° */</span> maxTasks: number</span>);
  <span class="hljs-comment">/** å°è¯•æ‰¹é‡è°ƒåº¦ä»»åŠ¡ */</span>
  <span class="hljs-title function_">tryRun</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;;
  <span class="hljs-comment">/**  æ­£å¼è°ƒåº¦ä»»åŠ¡ */</span>
  <span class="hljs-title function_">run</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;;
  <span class="hljs-comment">/** è°ƒåº¦è¿è¡Œä»»åŠ¡ - éœ€è¦å®ä¾‹åŒ–åé‡å†™è¯¥æ–¹æ³• <span class="hljs-doctag">@returns</span> è¿”å›ä»»åŠ¡æ ‡è¯† id */</span>
  <span class="hljs-title function_">onRunning</span>(): <span class="hljs-title class_">Promise</span>&lt;string | <span class="hljs-literal">undefined</span>&gt;;
  <span class="hljs-comment">/** åˆ†é… Quota */</span>
  <span class="hljs-title function_">assign</span>(): <span class="hljs-title class_">Promise</span>&lt;boolean&gt;;
  <span class="hljs-comment">/** é‡Šæ”¾ Quota */</span>
  <span class="hljs-title function_">release</span>(): <span class="hljs-title class_">Promise</span>&lt;boolean&gt;;
}
</code></pre>
<p>æ¥ä¸‹æ¥å…³æ³¨äº<code>assign</code>å’Œ<code>release</code>åˆ†é…å’Œé‡Šæ”¾<code>Quota</code>æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨å†…å­˜æ”¾ç½®<code>Record&lt;string, number&gt;</code>å¯¹è±¡æ¥ç®¡ç†å¹¶å‘ä»»åŠ¡çš„èµ„æºæ•°é‡ã€‚ç”±äºæœ€åéœ€è¦å®ç°åˆ†å¸ƒå¼é”ï¼Œå› æ­¤è¿™é‡Œçš„é€»è¾‘å®é™…ä¸Šæ˜¯ä¸<code>Redis</code>é”çš„<code>LUA</code>è„šæœ¬é€»è¾‘ç±»ä¼¼ã€‚</p>
<p>åˆ†é…<code>Quota</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥å½“å‰è¿è¡Œçš„ä»»åŠ¡æ•°é‡æ˜¯å¦å°äºæœ€å¤§å¹¶å‘æ•°ï¼Œå¦‚æœå°äºåˆ™åˆ†é…æˆåŠŸå¹¶å¢åŠ è¿è¡Œä»»åŠ¡æ•°é‡ï¼Œå¦åˆ™åˆ†é…å¤±è´¥ã€‚é‡Šæ”¾<code>Quota</code>æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘è¿è¡Œä»»åŠ¡æ•°é‡ï¼Œç¡®ä¿ä¸ä¼šå°äºé›¶ï¼Œè¿™é‡Œä¸»è¦æ˜¯é¿å…åˆ‡æ¢<code>key</code>æ—¶é‡Šæ”¾çš„<code>Quota</code>å°†å€¼å†™ä¸ºè´Ÿæ•°ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¹¶å‘é‡å˜é«˜ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">assign</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;boolean&gt; {
  <span class="hljs-keyword">const</span> lockKey = <span class="hljs-string">"_lock_"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>;
  <span class="hljs-keyword">let</span> current = <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">if</span> (current === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>)  current = <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (current &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxTasks</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">const</span> serial = ++<span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">release</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;boolean&gt; {
  <span class="hljs-keyword">const</span> lockKey = <span class="hljs-string">"_lock_"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>;
  <span class="hljs-keyword">const</span> current = <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">if</span> (current === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> || current &lt;= <span class="hljs-number">0</span>) {
    <span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  --<span class="hljs-variable constant_">MEMORY_MAP</span>[lockKey];
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>ç”±äºä»»åŠ¡æœ¬èº«å·²ç»ç”±é”æ§åˆ¶äº†å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤æ¥ä¸‹æ¥åªéœ€è¦æ§åˆ¶å¥½ä»»åŠ¡çš„æ‰§è¡Œæµç¨‹å³å¯ï¼Œè€Œæ§åˆ¶å¼‚æ­¥ä»»åŠ¡çš„æ–¹æ³•é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼Œç±»ä¼¼äº<code>webpack</code>çš„æ’ä»¶å®ç°ï¼Œä¸€ç§æ–¹å¼æ˜¯ç±»ä¼¼äºæ§åˆ¶åè½¬çš„æ–¹å¼å°†<code>done</code>å‡½æ•°ä¼ é€’åˆ°ä»»åŠ¡ä¸­ï¼Œå¦ä¸€ç§æ–¹å¼åˆ™æ˜¯ç›´æ¥åœ¨ä»»åŠ¡ä¸­è¿”å›<code>Promise</code>å¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥é‡‡ç”¨å¼‚æ­¥æ¨¡å¼ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
  <span class="hljs-keyword">const</span> assigned = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">assign</span>();
  <span class="hljs-keyword">if</span> (!assigned) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> <span class="hljs-attr">id</span>: string | <span class="hljs-literal">undefined</span> = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">runningTasks</span>++;
  <span class="hljs-keyword">try</span> {
    id = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onRunning</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Task Queue Running Error:"</span>, error);
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">runningTasks</span>--;
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">release</span>();
  id &amp;&amp; process.<span class="hljs-title function_">nextTick</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tryRun</span>);
}
</code></pre>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†<code>onRunning</code>æ–¹æ³•é‡å†™ï¼Œä¹Ÿå°±æ˜¯åœ¨æœåŠ¡ä¸­å°†å†…ç½®æ–¹æ³•èµ‹å€¼åˆ°ç±»ä¸Šï¼Œé€šå¸¸è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ä»æ•°æ®åº“ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåè¿”å›ä»»åŠ¡çš„<code>id</code>ï¼Œå¦‚æœæ²¡æœ‰ä»»åŠ¡åˆ™è¿”å›<code>undefined</code>ã€‚è€Œè¿™ä¸ª<code>id</code>åˆ™ä¼šæ ‡è¯†åç»­çš„ä»»åŠ¡æ˜¯å¦ä¼šç»§ç»­æ‰§è¡Œï¼Œè¿™é‡Œçš„<code>nextTick</code>ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ ˆæº¢å‡ºçš„é—®é¢˜ã€‚</p>
<p>å¦‚æœåœ¨ä»»åŠ¡è°ƒåº¦ä¸­ç›´æ¥é€’å½’åœ°æ‰§è¡Œï¼Œåˆ™ä¼šå­˜åœ¨å †æ ˆæº¢å‡ºçš„å¯èƒ½ã€‚åœ¨ä¸‹é¢<code>recursion</code>è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœæ˜¯åŒæ­¥çš„çš„å‡½æ•°æ‰§è¡Œï¼Œåˆ™ä¼šæŠ›å‡º<code>Maximum call stack size exceeded</code>çš„å¼‚å¸¸ã€‚è€Œå¦‚æœæ˜¯å¼‚æ­¥é€’å½’å‡½æ•°<code>asyncRecursion</code>ï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨éƒ½æ˜¯åœ¨ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œçš„ï¼Œé¿å…äº†æº¢å‡ºé—®é¢˜ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">recursion</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  n % <span class="hljs-number">100</span> === <span class="hljs-number">0</span>  &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Depth: <span class="hljs-subst">${n}</span>`</span>); <span class="hljs-comment">// $</span>
  <span class="hljs-title function_">recursion</span>(n - <span class="hljs-number">1</span>)
}
<span class="hljs-title function_">recursion</span>(<span class="hljs-number">100000</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncRecursion</span>(<span class="hljs-params">n</span>) {
  <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  n % <span class="hljs-number">100</span> === <span class="hljs-number">0</span>  &amp;&amp; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Depth: <span class="hljs-subst">${n}</span>`</span>); <span class="hljs-comment">// $</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">asyncRecursion</span>(n - <span class="hljs-number">1</span>));
}
<span class="hljs-title function_">asyncRecursion</span>(<span class="hljs-number">100000</span>);
</code></pre>
<p>å¹¶å‘æ‰§è¡Œä»»åŠ¡æ‰§è¡Œå°±éœ€è¦å®é™…å¯åŠ¨è¿™ä¸ª<code>run</code>å‡½æ•°ï¼Œä¸æ–­å°è¯•è°ƒåº¦ä»»åŠ¡å¹¶ä¸”æ‰§è¡Œï¼Œè€Œè°ƒåº¦ä»»åŠ¡çš„æ–¹å¼è‡ªç„¶å°±æ˜¯é€šè¿‡å¾ªç¯æ¥å®ç°æ‰¹é‡è°ƒåº¦ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œ<code>run</code>å‡½æ•°çš„æ—¶å€™ä¸èƒ½<code>await</code>ï¼Œå¦åˆ™å°±ä¼šé˜»å¡å½“å‰çš„äº‹ä»¶å¾ªç¯ï¼Œä»è€Œæ— æ³•å®ç°å¹¶å‘æ‰§è¡Œä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">tryRun</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {
  <span class="hljs-keyword">const</span> batch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxTasks</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">runningTasks</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; batch; i++) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">run</span>();
  }
}
</code></pre>
<p>ä¸è¿‡è¿™é‡Œå…¶å®æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰ä»»åŠ¡å¯ä»¥è°ƒåº¦ï¼Œè¿˜æ˜¯ä¼šå°è¯•<code>maxTasks</code>æ¬¡ä»»åŠ¡æ‰§è¡Œï¼Œè¿™å…¶å®æ˜¯ä¼šå­˜åœ¨æ•°æ®åº“æ— æ•ˆè¯»çš„é—®é¢˜ã€‚ä¸è¿‡å¯¹äºæ•°æ®åº“æ¥è¯´è¿™é‡Œçš„è¯»æ“ä½œé€šå¸¸æ˜¯å¯ä»¥æ¥å—çš„ï¼Œæ•°æ®åº“é‡ŒçŠ¶æ€å€¼æ˜¯è¦åŠ ç´¢å¼•çš„ï¼Œå¦‚æœå®åœ¨ä¸å¯æ¥å—å°±éœ€è¦æ’é˜Ÿå»¶è¿Ÿ<code>run</code>çš„æ‰§è¡Œï¼Œä¾‹å¦‚å‰ä¸ªä»»åŠ¡<code>10s</code>å†…è¿”å›ç©ºå°±ä¸æ‰§è¡Œã€‚</p>
<h3 data-id="heading-3">åŸå­è¯»å†™</h3>
<p>é‚£ä¹ˆé‡å†™<code>onRunning</code>æ–¹æ³•çš„å®ç°ï¼Œä¸»è¦æ˜¯ä»æ•°æ®åº“ä¸­è¯»å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚å‡è®¾æˆ‘ä»¬æŸ¥æ‰¾æ•°æ®æ˜¯ä½¿ç”¨<code>find</code>è¯­å¥ï¼Œå†™æ•°æ®æ˜¯ä½¿ç”¨<code>update</code>è¯­å¥ï¼Œé‚£ä¹ˆå‡è®¾æ­¤æ—¶çš„çŠ¶æ€å­—æ®µä¸º<code>status</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å¦‚ä¸‹çš„çŠ¶æ€ï¼Œ<code>pending</code>å¾…å¤„ç†ã€<code>running</code>å¤„ç†ä¸­ã€<code>completed</code>å®Œæˆï¼Œ<code>failed</code>å¤±è´¥ã€‚</p>
<p>é‚£ä¹ˆå‡è®¾ç°åœ¨å·²ç»æœ‰<code>id</code>ä¸º<code>1</code>å’Œ<code>2</code>çš„ä¸¤ä¸ªä»»åŠ¡å¤„äº<code>pending</code>çŠ¶æ€ï¼Œå¹¶ä¸”æˆ‘ä»¬å…è®¸æœ€å¤§çš„å¹¶å‘æ•°ä¸º<code>2</code>ã€‚æ­¤æ—¶æˆ‘ä»¬åœ¨ä¸¤ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸­è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¸­çŠ¶æ€ä¸º<code>pending</code>çš„ä»»åŠ¡ï¼Œå¹¶ä¸”å°†å…¶çŠ¶æ€æ›´æ–°ä¸º<code>running</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä»»åŠ¡ 1</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span>
update id=$0 status=<span class="hljs-string">"running"</span> <span class="hljs-comment">// $</span>
<span class="hljs-comment">// ä»»åŠ¡ 2</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span>
update id=$0 status=<span class="hljs-string">"running"</span> <span class="hljs-comment">// $</span>
</code></pre>
<p>çœ‹èµ·æ¥è¿™ä¸ªè°ƒåº¦å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸Šä¼šå­˜åœ¨ç«æ€æ¡ä»¶çš„é—®é¢˜ã€‚ç”±äºä»»åŠ¡<code>1</code>å’Œä»»åŠ¡<code>2</code>åŒæ—¶æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œé‚£ä¹ˆä¸¤ä¸ªä»»åŠ¡éƒ½ä¼šæŸ¥è¯¢åˆ°<code>id=1</code>çš„ä»»åŠ¡ï¼Œç„¶åä¸¤ä¸ªä»»åŠ¡éƒ½ä¼šå°†å…¶çŠ¶æ€æ›´æ–°ä¸º<code>running</code>ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´åŒä¸€ä¸ªä»»åŠ¡è¢«å¤šä¸ªè¿›ç¨‹å¤„ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä»»åŠ¡ 1</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span> -&gt; id=<span class="hljs-number">1</span>
<span class="hljs-comment">// ä»»åŠ¡ 2</span>
<span class="hljs-keyword">await</span> find status=<span class="hljs-string">"pending"</span> -&gt; id=<span class="hljs-number">1</span>
</code></pre>
<p>ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºæŸ¥è¯¢å’Œæ›´æ–°æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ“ä½œï¼Œå¹¶è¡Œçš„ä»»åŠ¡ä¼šåŒæ—¶è§¦å‘æŸ¥è¯¢ï¼Œè€Œæœ¬èº«å¹¶æ²¡æœ‰é”æ¥ä¿è¯æŸ¥è¯¢åˆ°çš„ä»»åŠ¡åœ¨æ›´æ–°å‰ä¸ä¼šè¢«å…¶ä»–ä»»åŠ¡ä¿®æ”¹ã€‚å› æ­¤åœ¨å¹¶è¡Œæ‰§è¡Œæ—¶ï¼Œéœ€è¦ä¿è¯è¯»å†™çŠ¶æ€çš„æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å°†æŸ¥è¯¢å’Œæ›´æ–°åˆå¹¶ä¸ºä¸€ä¸ªæ“ä½œï¼Œä¾‹å¦‚åœ¨<code>mongodb</code>ä¸­å°±å­˜åœ¨<code>findOneAndUpdate</code>æ–¹æ³•ã€‚</p>
<p>é‚£ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬åŒæ ·æ¨¡æ‹Ÿä¸€ä¸‹æ•°æ®å¤„ç†çš„é€»è¾‘ï¼Œç”±äº<code>Service</code>ç°åœ¨æ˜¯å•ä¾‹çš„ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ç»´æŠ¤ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥å­˜å‚¨ä»»åŠ¡ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ª<code>findAndModify</code>æ–¹æ³•æ¥æ¨¡æ‹Ÿæ•°æ®åº“çš„æŸ¥è¯¢å’Œæ›´æ–°æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„æŸ¥è¯¢æ¡ä»¶æŸ¥æ‰¾ä»»åŠ¡ï¼Œå¹¶ä¸”å°†å…¶çŠ¶æ€æ›´æ–°ä¸ºæ–°çš„çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TasksService</span> {
  public <span class="hljs-attr">tasks</span>: { <span class="hljs-attr">id</span>: string; <span class="hljs-attr">status</span>: <span class="hljs-string">"pending"</span> | <span class="hljs-string">"running"</span> | <span class="hljs-string">"success"</span> | <span class="hljs-string">"fail"</span> }[]

  private <span class="hljs-keyword">async</span> <span class="hljs-title function_">findAndModify</span>(<span class="hljs-params">
    find: { id?: string; status?: <span class="hljs-keyword">typeof</span> TasksService.prototype.tasks[<span class="hljs-number">0</span>][<span class="hljs-string">"status"</span>] } = {},
    status: <span class="hljs-keyword">typeof</span> TasksService.prototype.tasks[<span class="hljs-number">0</span>][<span class="hljs-string">"status"</span>]
  </span>) {
    <span class="hljs-keyword">const</span> task = <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (find.<span class="hljs-property">id</span> &amp;&amp; t.<span class="hljs-property">id</span> !== find.<span class="hljs-property">id</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span> (find.<span class="hljs-property">status</span> &amp;&amp; t.<span class="hljs-property">status</span> !== find.<span class="hljs-property">status</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
    <span class="hljs-keyword">if</span> (task) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Task <span class="hljs-subst">${task.id}</span> is <span class="hljs-subst">${task.status}</span> =&gt; <span class="hljs-subst">${status}</span>.`</span>);
      task.<span class="hljs-property">status</span> = status;
      <span class="hljs-keyword">return</span> task;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<p>è€Œé‡å†™<code>running</code>æ–¹æ³•è¿è¡Œä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨è¿™ä¸ª<code>findAndModify</code>æ–¹æ³•æ¥æŸ¥è¯¢å¹¶æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼Œä»è€Œä¿è¯ä»»åŠ¡çš„åŸå­æ€§ã€‚è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´è¶…æ—¶æ—¶é—´ä¸º<code>2s</code>ï¼Œä»»åŠ¡æœ¬èº«æ˜¯éšæœºç”Ÿæˆçš„æ‰§è¡Œæ—¶é•¿ï¼Œè¿™é‡Œçš„çŠ¶æ€è½¬ç§»åŒæ ·æ˜¯ä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ¥ä¸¥æ ¼æ§åˆ¶çŠ¶æ€è½¬ç§»ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨å˜é‡æ ‡è®°æ¥å¤„ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onRunning</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> task = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">status</span>: <span class="hljs-string">"pending"</span> }, <span class="hljs-string">"running"</span>);
  <span class="hljs-keyword">if</span> (!task) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">execute</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">3000</span>));
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">id</span>: task.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span> }, <span class="hljs-string">"success"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Task <span class="hljs-subst">${task.id}</span> cost <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now() - now}</span> ms.`</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">id</span>: task.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span> }, <span class="hljs-string">"fail"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Task"</span>, task.<span class="hljs-property">id</span>, <span class="hljs-string">"is fail."</span>, error);
    }
  };
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">timeout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">ms: number</span>) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(ms);
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findAndModify</span>({ <span class="hljs-attr">id</span>: task.<span class="hljs-property">id</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span> }, <span class="hljs-string">"fail"</span>);
  };
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">execute</span>(), <span class="hljs-title function_">timeout</span>(<span class="hljs-number">2000</span>)]);
  <span class="hljs-keyword">return</span> task.<span class="hljs-property">id</span>;
}
</code></pre>
<p>æ¥ä¸‹æ¥åŸºæœ¬å·²ç»å®Œæˆäº†å•å®ä¾‹å•è¿›ç¨‹çš„ä»»åŠ¡é˜Ÿåˆ—å®ç°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±é€šè¿‡æ¥å£å®ç°ä»»åŠ¡çš„åˆ›å»ºå’Œæ‰§è¡Œã€‚å¹¶ä¸”åœ¨æ¥å£ä¸­å®šä¹‰å¥½ä»»åŠ¡åˆ›å»ºçš„æ–¹æ³•ï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬æ‰¹é‡åˆ›å»º<code>5</code>ä¸ªä»»åŠ¡ï¼Œç„¶åä¼šè°ƒç”¨é˜Ÿåˆ—çš„<code>tryRun</code>æ–¹æ³•æ¥å°è¯•è°ƒåº¦ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-string">`task_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>_<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">1000</span>)}</span>`</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasks</span>.<span class="hljs-title function_">push</span>({ id, <span class="hljs-attr">status</span>: <span class="hljs-string">"pending"</span> });
  <span class="hljs-keyword">return</span> { id };
}

@<span class="hljs-title class_">Controller</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IndexController</span> {
  @<span class="hljs-title class_">Inject</span>(<span class="hljs-title class_">IndexService</span>)
  private readonly indexService!: <span class="hljs-title class_">IndexService</span>;
  @<span class="hljs-title class_">Post</span>(<span class="hljs-string">"batch-create-task"</span>)
  public <span class="hljs-keyword">async</span> <span class="hljs-title function_">createTask</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// curl -X POST http://localhost:3000/batch-create-task</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">tasksService</span>.<span class="hljs-title function_">createTask</span>();
    }
  }
}
</code></pre>
<p>å½“æ‰§è¡Œå®Œæˆ<code>curl</code>åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä»»åŠ¡è¢«é¡ºåºè°ƒåº¦æ‰§è¡Œï¼Œå¹¶ä¸”å¹¶å‘æ•°è¢«é™åˆ¶åœ¨<code>2</code>ä»¥å†…ã€‚å½“ç„¶ç”±äºæœ¬èº«ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ˜¯éšæœºçš„ï¼Œå› æ­¤å®é™…çš„æ‰§è¡Œé¡ºåºä»¥åŠä»»åŠ¡çš„çŠ¶æ€æˆåŠŸä¸å¦éƒ½æ˜¯ä¸ç¡®å®šçš„ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">Lock Assign _lock_key 0 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_272 is <span class="hljs-attr">pending</span> =&gt; running.
Task task_1762683026625_164 is <span class="hljs-attr">pending</span> =&gt; running.
Task task_1762683026625_272 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_272 cost 534 ms.
Task task_1762683026625_164 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_164 cost 1556 ms.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_300 is <span class="hljs-attr">pending</span> =&gt; running.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_944 is <span class="hljs-attr">pending</span> =&gt; running.
Task task_1762683026625_300 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_300 cost 378 ms.
Task task_1762683026625_944 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_944 cost 1852 ms.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Task task_1762683026625_42 is <span class="hljs-attr">pending</span> =&gt; running.
Lock Release _lock_key 2 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Lock Release _lock_key 2 -&gt; 1
Task task_1762683026625_42 is <span class="hljs-attr">running</span> =&gt; success.
Task task_1762683026625_42 cost 1119 ms.
Lock Release _lock_key 1 -&gt; 0
Lock Assign _lock_key 0 -&gt; 1
Lock Assign _lock_key 1 -&gt; 2
Lock Release _lock_key 2 -&gt; 1
Lock Release _lock_key 1 -&gt; 0
</code></pre>
<h3 data-id="heading-4">åˆ†å¸ƒå¼é”</h3>
<p>å®é™…ä¸Šå…³äºé”çš„é—®é¢˜ï¼Œä¸Šè¿°çš„å•è¿›ç¨‹æ¨¡å¼ä»…éœ€è¦å¤„ç†å†…å­˜ï¼Œè€Œå¦‚æœæ˜¯å•æœºé›†ç¾¤æ¨¡å¼ï¼Œå³å¤šè¿›ç¨‹æ¨¡å¼å¯ä»¥å…±äº«å†…å­˜æˆ–è€…ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå¤„ç†ã€‚ç„¶è€Œç°åœ¨å¸¸è§çš„éƒ½æ˜¯åˆ†å¸ƒå¼å¤šå®ä¾‹æ¨¡å¼ï¼Œè¿™ç§æƒ…å†µä¸‹åˆ™éœ€è¦ä½¿ç”¨<code>Redis</code>ç­‰å¤–éƒ¨å­˜å‚¨ï¼Œå› ä¸ºéœ€è¦ä¸€ä¸ªé›†ä¸­å¼çš„é”ç®¡ç†ã€‚</p>
<p>æ­¤å¤–ï¼Œ<code>Redis</code>æä¾›äº†<code>RedLock</code>ç®—æ³•å¯ä»¥å®ç°åˆ†å¸ƒå¼äº’æ–¥ï¼Œä¹Ÿå°±æ˜¯é˜»æ­¢å¹¶å‘ï¼Œå› æ­¤å¹¶ä¸é€‚åˆæˆ‘ä»¬è¿™é‡Œçš„ä»»åŠ¡é˜Ÿåˆ—åœºæ™¯ã€‚è¿˜æœ‰<code>Redis</code>åˆ†å¸ƒå¼ä¸»ä»éƒ¨ç½²çš„æƒ…å†µä¸‹ï¼Œè‹¥æ˜¯<code>Redis</code>ä¸»èŠ‚ç‚¹æŒ‚æ‰ï¼Œä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´çŸ­æš‚çš„ä»»åŠ¡è¶…é™ï¼Œå³åŒæ—¶è¿è¡Œçš„ä»»åŠ¡æ•°è¶…è¿‡<code>MaxTask</code>ã€‚</p>
<p>å› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†å†…å­˜çš„é”å®ç°æ›¿æ¢ä¸º<code>Redis</code>çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œå¯¹æ¯”å†…å­˜çš„å®ç°ï¼Œç”±äºæœ¬èº«<code>Redis</code>æ”¯æŒ<code>incr</code>å’Œ<code>decr</code>åŸå­æ“ä½œï¼Œä½†æ˜¯å…¶ä¸èƒ½é™åˆ¶å…¶æ•°æ®èŒƒå›´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>LUA</code>è„šæœ¬æ¥å®ç°åˆ†å¸ƒå¼é”çš„åŠŸèƒ½ã€‚ä¸‹é¢æ˜¯å¹¶è¡Œä»»åŠ¡çš„<code>LUA</code>å®ç°:</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * Redis è‡ªå¢é” LUA è„šæœ¬
 * - KEYS[1]: é”çš„é”®å
 * - ARGV[1]: æœ€å¤§ä»»åŠ¡æ•° MaxTask
 * <span class="hljs-doctag">@example</span> ioredis.eval(LUA_SCRIPT, 1, LOCK_KEY, MAX_TASK);
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INCR_LOCK_LUA</span> = <span class="hljs-string">`
  local current = redis.call("GET", KEYS[1])

  if not current then
    current = 0
  else
    current = tonumber(current)
  end

  if current &gt;= tonumber(ARGV[1]) then
    return -1
  end

  local new_count = redis.call("INCR", KEYS[1])
  return new_count
`</span>;

<span class="hljs-comment">/**
 * Redis è‡ªå‡é” LUA è„šæœ¬
 * - KEYS[1]: é”çš„é”®å
 * <span class="hljs-doctag">@example</span> ioredis.eval(LUA_SCRIPT, 1, LOCK_KEY);
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DESC_LOCK_LUA</span> = <span class="hljs-string">`
  local current = redis.call("GET", KEYS[1])
  
  if not current then
    return 0
  end

  current = tonumber(current)
  if current &lt;= 0 then
    return 0
  end

  local new_count = redis.call("DECR", KEYS[1])
  return new_count
`</span>;
</code></pre>
<h2 data-id="heading-5">ä¼˜é›…åœæœº</h2>
<p>ä¼˜é›…åœæœºçš„å¤„ç†è¦æ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸ºå…¶ä¸èƒ½å®Œå…¨ä¾é æ¡†æ¶æœ¬èº«çš„å¤„ç†èƒ½åŠ›ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬åœ¨åº”ç”¨å±‚è¿›è¡Œå¤„ç†ã€‚å³æˆ‘ä»¬å¿…é¡»è¦å°†ä¿¡å·ä¼ é€’åˆ°è¿›ç¨‹ä¸­ï¼Œå¦‚æœè¿›ç¨‹æ²¡æœ‰æ”¶åˆ°ä¿¡å·çš„è¯ï¼Œé‚£ä¹ˆå°±æ— æ³•è¿›è¡Œä¼˜é›…åœæœºçš„å¤„ç†ï¼Œå³ä½¿æ˜¯å¤„ç†å¥½äº†ç›¸å…³èµ„æºçš„æ¸…ç†ï¼Œä¹Ÿæ²¡æœ‰å®é™…æ•ˆç”¨ã€‚</p>
<p>ç‰¹åˆ«çš„ï¼Œåœ¨åˆ†å¸ƒå¼éƒ¨ç½²çš„æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯éƒ¨ç½²åœ¨<code>Docker</code>å®¹å™¨ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¿¡å·çš„ä¼ é€’å°±éå¸¸ä¾èµ–å®¹å™¨æœ¬èº«çš„é…ç½®ï¼Œä»¥åŠå®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼ã€‚å‡è®¾åœæœºä¿¡å·ä»…å‘é€ç»™ä¸»è¿›ç¨‹è€Œä¸åƒæ˜¯<code>Ctrl+C</code>ä¸€æ ·å‘é€ç»™è¿›ç¨‹ç»„ï¼Œé‚£ä¹ˆä¼˜é›…åœæœºå°±å¿…é¡»è¦ä¸»åŠ¨å°†ä¿¡å·ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­ï¼Œå¦åˆ™å­è¿›ç¨‹å°†æ— æ³•è¿›è¡Œåœæœºå¤„ç†ã€‚</p>
<h3 data-id="heading-6">SIGINT</h3>
<p><code>SIGINT</code>ä¿¡å·å°±æ˜¯æˆ‘ä»¬ä¸»è¦å…³æ³¨çš„ä¿¡å·ç±»å‹ï¼Œå½“æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­æŒ‰ä¸‹<code>Ctrl+C</code>æ—¶ï¼Œç³»ç»Ÿä¼šå‘å½“å‰å‰å°è¿›ç¨‹ç»„å‘é€<code>SIGINT</code>ä¿¡å·ï¼Œä»è€Œè§¦å‘è¿›ç¨‹çš„ä¸­æ–­å¤„ç†ã€‚åœ¨<code>kill</code>å‘½ä»¤ä¸­ï¼Œ<code>SIGINT</code>ä¿¡å·çš„ç¼–å·ä¸º<code>2</code>ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡<code>kill -2 &lt;pid&gt;</code>æˆ–è€…<code>kill -INT &lt;pid&gt;</code>å‘½ä»¤æ¥å‘é€è¯¥ä¿¡å·ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬æ¥å®ç°ç®€å•çš„<code>SIGINT</code>ä¿¡å·å¤„ç†ï¼Œéœ€è¦åˆ›å»ºç®€å•çš„<code>HTTP</code>æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡ç›‘å¬<code>process.on("SIGINT")</code>äº‹ä»¶æ¥å¤„ç†ä¿¡å·ã€‚å½“æˆ‘ä»¬æ‰§è¡Œ<code>Ctrl+C</code>æ—¶ï¼ŒæœåŠ¡å™¨ä¸ä¼šç«‹å³å…³é—­ï¼Œè€Œæ˜¯ä¼šè¾“å‡ºç­‰å¾…çš„æç¤ºï¼Œæ¥ä¸‹æ¥ç­‰å¾…<code>2s</code>åå…³é—­ï¼Œç„¶åæ‰ä¼šé€€å‡ºè¿›ç¨‹ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">_, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Received Request"</span>, <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"text/plain"</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">"Hello, World!\n"</span>);
});

process.<span class="hljs-title function_">on</span>(<span class="hljs-string">"SIGINT"</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Received SIGINT. Shutting Down Gracefully..."</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r, <span class="hljs-number">2000</span>));
  server.<span class="hljs-title function_">close</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Server Closed. Exiting Process."</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>);
  });
});

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;
server.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server Running at http://localhost:<span class="hljs-subst">${PORT}</span>/`</span>);
});
</code></pre>
<h3 data-id="heading-7">ä¿¡å·ä¼ é€’</h3>
<p><code>Ctrl+C</code>ä¼šç»™æ•´ä¸ªå‰å°è¿›ç¨‹ç»„å‘é€<code>SIGINT</code>ä¿¡å·ï¼Œä½†æ˜¯åœ¨ä¸šåŠ¡ä¸­å¯èƒ½ä¼šä»…å¯èƒ½ç»™ä¸»è¿›ç¨‹å‘é€<code>SIGINT</code>ä¿¡å·ï¼Œè¿™æ—¶å€™å­è¿›ç¨‹å°±æ— æ³•æ”¶åˆ°ä¿¡å·ã€‚æˆ‘ä»¬å¯ä»¥æ¥æ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¡Œä¸ºï¼Œå½“ä½¿ç”¨<code>npx</code>å‘½ä»¤æ—¶ï¼Œå…¶å¹¶ä¸ä¼šå°†ä¿¡å·è½¬å‘åˆ°å…¶å¯åŠ¨çš„å­è¿›ç¨‹ã€‚æ­¤å¤–è¿˜æœ‰ä¸ªå¸¸ç”¨çš„ä¿¡å·æ˜¯<code>SIGTERM</code>ï¼Œç¼–å·ä¸º<code>15</code>ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ps -A -o pid,ppid,comm,args &gt; ps.txt</span>
<span class="hljs-comment"># lsof -i :3000</span>
<span class="hljs-comment"># kill -INT 1234</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"signal.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
npx tsx ./src/index.ts
</code></pre>
<p>å½“ä½¿ç”¨<code>bash signal.sh</code>å¯åŠ¨è„šæœ¬æ—¶ï¼Œå…ˆè¾“å‡ºå½“å‰è¿›ç¨‹çš„<code>PID</code>å’Œä»¥åŠçˆ¶è¿›ç¨‹çš„<code>PPID</code>ã€‚æ­¤æ—¶ç”±äºè¿›ç¨‹æ˜¯<code>bash</code>å¯åŠ¨çš„ï¼Œå› æ­¤<code>PPID</code>æ˜¯<code>bash</code>çš„è¿›ç¨‹å·ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨<code>npx tsx</code>å¯åŠ¨<code>NodeJs</code>è¿›ç¨‹ï¼Œæ­¤æ—¶<code>NodeJs</code>è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯<code>npx</code>è¿›ç¨‹ï¼Œå‡è®¾è¾“å‡ºæ˜¯ä¸‹é¢çš„<code>id</code>:</p>
<pre><code class="hljs language-bash" lang="bash">signal.sh PID-PPID 66721,59534
59534 51513 /bin/zsh         /bin/zsh -il                 <span class="hljs-comment"># zsh shell</span>
66721 59534 bash             bash signal.sh               <span class="hljs-comment"># bash </span>
66722 66721 npm <span class="hljs-built_in">exec</span> tsx ./s npm <span class="hljs-built_in">exec</span> tsx ./src/index.ts  <span class="hljs-comment"># npx tsx</span>
</code></pre>
<p>æ­¤æ—¶å¦‚æœæ‰§è¡Œ<code>kill -INT 66721</code>å‘½ä»¤å‘é€åˆ°è„šæœ¬è¿›ç¨‹ï¼Œä¼šå‘ç°<code>NodeJs</code>è¿›ç¨‹å¹¶æ²¡æœ‰æ”¶åˆ°ä¿¡å·ï¼Œå› æ­¤æ— æ³•è¿›è¡Œä¼˜é›…åœæœºå¤„ç†ã€‚é€šå¸¸åœ¨è¿™ç§æƒ…å†µä¸‹åªèƒ½ç­‰å¾…ä¸€å®šæ—¶é—´åå¼ºåˆ¶æ€æ­»å­è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯<code>kill -9 &lt;pid&gt;</code>æˆ–è€…<code>kill -KILL &lt;pid&gt;</code>å‘½ä»¤ã€‚è€Œå¦‚æœç›´æ¥<code>kill -2 66722</code>ï¼Œåˆ™å¯ä»¥æ­£å¸¸åœæœºã€‚</p>
<p>æˆ‘ä»¬çš„å‡è®¾æ˜¯ä¿¡å·ä»…å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œè€Œæ­¤æ—¶çš„ä¸»è¿›ç¨‹å°±æ˜¯<code>bash</code>å¯åŠ¨å‘½ä»¤ï¼Œæ— æ³•ç»“æŸè¿›ç¨‹å°±å¾ˆåˆç†äº†ã€‚è¿™é‡Œé—®é¢˜å…¶å®å°±åœ¨äºæˆ‘ä»¬æ˜¯ä½¿ç”¨<code>npx</code>å¯åŠ¨çš„è¿›ç¨‹ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥æ‰§è¡ŒæœåŠ¡çš„å¯åŠ¨å‘½ä»¤ï¼Œåœ¨ä¿¡å·ä¸ä¼ é€’çš„æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹æ˜¯æ— æ³•æ”¶åˆ°ä¿¡å·çš„ã€‚</p>
<p>åœ¨<code>Bash</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>exec</code>å‘½ä»¤ç”¨äºæ›¿æ¢å½“å‰çš„<code>Shell</code>è¿›ç¨‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„å­è¿›ç¨‹ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åœ¨<code>npx</code>å‘½ä»¤å‰ä½¿ç”¨<code>exec</code>æ¥æ›¿æ¢æ‰å½“å‰çš„<code>bash</code>è¿›ç¨‹ï¼Œé‚£ä¹ˆä¿¡å·å°±å¯ä»¥ç›´æ¥ä¼ é€’åˆ°<code>NodeJs</code>è¿›ç¨‹ä¸­äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">exec</span> npx tsx ./src/index.ts
</code></pre>
<p>æ­¤æ—¶çš„è¿›ç¨‹å…³ç³»å¦‚ä¸‹æ‰€ç¤ºï¼Œæ­¤æ—¶çš„ä¸»è¿›ç¨‹å°±æ˜¯<code>67033</code>è¿›ç¨‹å·äº†ï¼Œæ­¤æ—¶ç›´æ¥<code>kill -INT 67033</code>å°±å¯ä»¥æ­£å¸¸æ”¶åˆ°ä¿¡å·å¹¶ä¸”è¿›è¡Œä¼˜é›…åœæœºå¤„ç†äº†ã€‚è¿™é‡Œè¿˜éœ€è¦å…³æ³¨ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥ä½¿ç”¨ç»ˆç«¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥å…¶æœ¬èº«çš„è¿›ç¨‹<code>59534</code>å³<code>zsh</code>è¿›ç¨‹å·å°±æ˜¯çˆ¶è¿›ç¨‹å·ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">signal.sh PID-PPID 67033,59534
59534 51513 /bin/zsh         /bin/zsh -il
67033 59534 npm <span class="hljs-built_in">exec</span> tsx ./s npm <span class="hljs-built_in">exec</span> tsx ./src/index.ts   
</code></pre>
<p>ç”±äº<code>npx</code>ä¼šåˆ›å»ºå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œå› æ­¤è‹¥æ˜¯å¯åŠ¨æœåŠ¡çš„å‘½ä»¤æœ¬èº«å¦‚æœä¹Ÿæ˜¯åˆ›å»ºå­è¿›ç¨‹çš„æ–¹å¼ï¼Œé‚£ä¹ˆåŒæ ·ä¼šå­˜åœ¨ä¿¡å·æ— æ³•ä¼ é€’çš„é—®é¢˜ã€‚å› æ­¤åœ¨ä½¿ç”¨<code>pm2</code>ç­‰è¿›ç¨‹ç®¡ç†å·¥å…·æ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„å…¶å¯åŠ¨å‘½ä»¤çš„ä¿¡å·ä¼ é€’é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨<code>npx</code>å‘½ä»¤æ¥å¯åŠ¨è¿›ç¨‹ï¼Œæ­¤æ—¶æœåŠ¡å°±ä½œä¸ºé¡¶å±‚è¿›ç¨‹å¯åŠ¨äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$PWD</span>/node_modules/.bin:<span class="hljs-variable">$PATH</span>"</span>
<span class="hljs-built_in">exec</span> tsx ./src/index.ts
</code></pre>
<pre><code class="hljs language-bash" lang="bash">signal.sh PID-PPID 67675,59534
59534 51513 /bin/zsh         /bin/zsh -il
67675 59534 node             node /xxx/node_modules/.bin/../tsx/dist/cli.mjs ./src/index.ts
</code></pre>
<h3 data-id="heading-8">å­è¿›ç¨‹ç®¡ç†</h3>
<p>ç”±äºä¸‹é¢éœ€è¦ä»¥<code>PM2</code>åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å®ç°ä¿¡å·ä¼ é€’ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°±å…ˆåšä¸€ä¸ªç®€å•æœ‰è¶£çš„å®éªŒï¼Œä¸»è¦æ˜¯ä¸ºäº†è§‚å¯Ÿå­è¿›ç¨‹æ‰§è¡Œçš„æƒ…å†µã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šåœ¨éƒ¨ç½²ç¯å¢ƒä¸­ä½¿ç”¨å®¹å™¨å†…çš„è¿›ç¨‹ä¾‹å¦‚<code>systemd</code>æ¥å®ˆæŠ¤è¿›ç¨‹ï¼Œå¹¶ä¸ä¼šä½¿ç”¨<code>pm2</code>çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä½¿ç”¨<code>pm2</code>å®ˆæŠ¤ï¼Œé‚£å°±éœ€è¦ä¸»åŠ¨ä¼ é€’ä¿¡å·ã€‚</p>
<p>å› æ­¤åœ¨è¿™é‡Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç®€å•çš„çˆ¶å­è¿›ç¨‹æ¨¡å‹ï¼Œç›¸å½“äºç®€å•åœ°è¡¨ç¤ºä¸€ä¸‹è¿›ç¨‹çš„æ¨¡å‹ã€‚<code>child.sh</code>æ˜¯æ™®é€šçš„è„šæœ¬ï¼Œåœ¨è¿™é‡Œä¼šç›´æ¥ä½¿ç”¨<code>while</code>æ¥ä¿æŒè¿›ç¨‹ã€‚<code>normal.sh</code>æ˜¯çˆ¶è¿›ç¨‹è„šæœ¬ï¼Œä½¿ç”¨<code>bash</code>å¯åŠ¨<code>child.sh</code>ä½œä¸ºå­è¿›ç¨‹ã€‚<code>fork.sh</code>ä¹Ÿæ˜¯çˆ¶è¿›ç¨‹è„šæœ¬ï¼Œä½†æ˜¯ä¼šä½¿ç”¨<code>disown</code>æ¥åˆ†ç¦»è¿›ç¨‹ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># child.sh</span>
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sleep</span> 1
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"child.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># normal.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"normal.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
bash child.sh &gt; /dev/tty 2&gt;&amp;1
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># fork.sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"fork.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
bash child.sh &gt; /dev/tty 2&gt;&amp;1 &amp;
<span class="hljs-built_in">disown</span> -h %1
</code></pre>
<p>å½“æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯æ¥å¯åŠ¨<code>normal.sh</code>ä»¥åŠ<code>fork.sh</code>åï¼Œå¯ä»¥è§‚å¯Ÿåˆ°<code>normal</code>è¿›ç¨‹ä¼šæŒæœ‰ä¸”ä¸ä¼šåœæ­¢ï¼Œ<code>fork</code>è¿›ç¨‹ä¼šç»“æŸå…ˆå‰çš„è¿›ç¨‹ï¼Œå¯ä»¥åœ¨ç»ˆç«¯é‡Œæ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼Œç±»ä¼¼äºå°†å…¶æ”¾ç½®äºåå°ï¼Œæ³¨æ„è¾“å‡ºé‡å®šå‘åˆ°<code>tty</code>ç»ˆç«¯ä¸ä¼šåœ, ä¹Ÿå¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">normal.sh PID-PPID 70263,69842
child.sh PID-PPID 70264,70263
69842 51513 /bin/zsh         /bin/zsh -il
70263 69842 bash             bash normal.sh
70264 70263 bash             bash child.sh
72259 70264 <span class="hljs-built_in">sleep</span>            <span class="hljs-built_in">sleep</span> 1
</code></pre>
<pre><code class="hljs language-bash" lang="bash">fork.sh PID-PPID 70303,69954
child.sh PID-PPID 70304,1
69954 51513 /bin/zsh         /bin/zsh -il
70304     1 bash             bash child.sh
72260 70304 <span class="hljs-built_in">sleep</span>            <span class="hljs-built_in">sleep</span> 1
</code></pre>
<h3 data-id="heading-9">PM2 è¿›ç¨‹</h3>
<p>åœ¨å…ˆå‰çš„å®éªŒä¸­æˆ‘ä»¬å·²ç»è§‚å¯Ÿåˆ°äº†ä¿¡å·ä¼ é€’çš„é—®é¢˜ï¼Œé‚£ä¹ˆåœ¨<code>pm2</code>ä¸­åŒæ ·ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨<code>pm2 start</code>æ¥å¯åŠ¨è¿›ç¨‹ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æ˜¯ä½¿ç”¨<code>fork</code>æ¨¡å¼å¯åŠ¨çš„è¿›ç¨‹ï¼Œå› æ­¤ä¿¡å·æ˜¯æ— æ³•ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­çš„ï¼Œå› ä¸ºè¿™ä¸ªè¿›ç¨‹ä¼šç«‹å³ç»“æŸæ‰ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PORT=3000
<span class="hljs-built_in">echo</span> <span class="hljs-string">"bootstrap.sh PID-PPID $$,<span class="hljs-variable">$PPID</span>"</span>
npx tsc --project tsconfig.json
<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">"<span class="hljs-variable">$PWD</span>/node_modules/.bin:<span class="hljs-variable">$PATH</span>"</span>
<span class="hljs-built_in">exec</span> pm2 start ./dist/index.js -i 2 --kill-timeout 5000 --log-date-format=<span class="hljs-string">"YYYY-MM-DD HH:mm:ss"</span> --<span class="hljs-built_in">log</span> ./output.log
</code></pre>
<p>æ­¤æ—¶çš„è¿›ç¨‹æ ‘å…³ç³»å¦‚ä¸‹ï¼Œç”±äºè¿›ç¨‹ä¼šç«‹å³ç»“æŸï¼Œæ­¤æ—¶<code>pm2</code>çš„ä¸»è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯<code>1</code>ã€‚ç„¶åç”±äºæ˜¯ä½¿ç”¨çš„é›†ç¾¤æ¨¡å¼ï¼Œå› æ­¤ä¼šå¯åŠ¨ä¸¤ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡ŒæœåŠ¡ï¼Œè€Œè¿™ä¸¤ä¸ªå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹å°±æ˜¯<code>pm2</code>çš„ä¸»è¿›ç¨‹ï¼Œæ­¤æ—¶æˆ‘ä»¬æ˜¯æ²¡æœ‰åŠæ³•å‘é€<code>SIGINT</code>ä¿¡å·ç»™ä¸»è¿›ç¨‹ï¼Œè‡ªç„¶å­è¿›ç¨‹ä¹Ÿæ— æ³•æ”¶åˆ°ä¿¡å·ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">73353     1 PM2 v6.0.8: God  PM2 v6.0.8: God Daemon (/Users/czy/.pm2) 
73354 73353 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
73355 73353 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœéœ€è¦å°è¯•ä¼˜é›…åœæœºå¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸»åŠ¨å°†ä¿¡å·ä¼ é€’åˆ°å­è¿›ç¨‹ä¸­ã€‚é€šå¸¸æ¥è¯´ç”±äºè¿›ç¨‹ç»“æŸï¼Œæˆ‘ä»¬æ— æ³•ä»ä¸»è¿›ç¨‹ä¸­å¾—åˆ°å­è¿›ç¨‹çš„<code>PID</code>ï¼Œå› æ­¤åªèƒ½é€šè¿‡<code>pm2</code>æä¾›çš„å‘½ä»¤æ¥è·å–å­è¿›ç¨‹çš„<code>PID</code>ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨<code>ps</code>æ¥åŒ¹é…<code>PID</code>ï¼Œç„¶åå†å‘é€ä¿¡å·ï¼Œè¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥ä¼˜é›…åœæœºçš„ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">kill</span> -INT $(pgrep pm2)
</code></pre>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»„åˆä¸Šé¢çš„è„šæœ¬æ¥å®ç°ä¿¡å·çš„ä¼ é€’å¤„ç†ï¼Œé¦–å…ˆéœ€è¦é¿å…ä¸»è¿›ç¨‹è„šæœ¬ç»“æŸæ‰ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨<code>while</code>æ¥ä¿æŒè¿›ç¨‹ï¼Œç„¶ååœ¨æ”¶åˆ°ä¿¡å·æ—¶è·å–å­è¿›ç¨‹çš„<code>PID</code>å¹¶ä¸”ä¼ é€’ä¿¡å·ã€‚æ³¨æ„è¿™ç§æƒ…å†µä¸‹ä¸èƒ½ç”¨<code>exec</code>äº†ï¼Œéœ€è¦æ­£å¸¸<code>fork</code>å‡ºå­è¿›ç¨‹ï¼Œå¦åˆ™åç»­<code>while</code>ä»¥åŠ<code>trap</code>ä»£ç ä¸ä¼šæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-bash" lang="bash">pm2 start ./dist/index.js -i 2 --kill-timeout 5000 --log-date-format=<span class="hljs-string">"YYYY-MM-DD HH:mm:ss"</span> --<span class="hljs-built_in">log</span> ./output.log
<span class="hljs-function"><span class="hljs-title">forward_signal</span></span>() {
    pm2_pid=$(pgrep pm2)
    <span class="hljs-built_in">kill</span> -INT <span class="hljs-variable">$pm2_pid</span>
    <span class="hljs-built_in">exit</span> 0
}
<span class="hljs-built_in">trap</span> forward_signal SIGINT
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">sleep</span> 1
<span class="hljs-keyword">done</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash">bootstrap.sh PID-PPID 76699,73203
76731     1 PM2 v6.0.8: God  PM2 v6.0.8: God Daemon (/Users/czy/.pm2) 
76732 76731 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
76733 76731 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
73203 51513 /bin/zsh         /bin/zsh -il
76699 73203 bash             bash bootstrap.sh
76895 76699 <span class="hljs-built_in">sleep</span>            <span class="hljs-built_in">sleep</span> 1
</code></pre>
<p>å®é™…ä¸Šï¼Œ<code>pm2</code>å½“å‰æ”¯æŒäº†<code>pm2-runtime</code>å‘½ä»¤æ¥æ›´å¥½åœ°æ”¯æŒå®¹å™¨åŒ–åœºæ™¯ä¸‹çš„è¿›ç¨‹ç®¡ç†ï¼ŒåŒæ ·çš„ä¹‹å‰å™è¿°çš„<code>npx</code>å‘½ä»¤é—®é¢˜ä¹Ÿä¼šå‡ºç°ã€‚ä»ä¸‹é¢çš„è¿›ç¨‹æ ‘ä¸­å¯ä»¥çœ‹å‡ºæ¥ä¿¡å·ä¼ é€’ä¼šæ¯”ä¹‹å‰å¤šäº†ä¸€å±‚ï¼Œè€Œæ‰§è¡Œ<code>kill -INT 80795</code>å‘½ä»¤æ—¶ï¼Œå­è¿›ç¨‹æ˜¯æ— æ³•æ”¶åˆ°ä¿¡å·çš„ï¼Œè¿›ç¨‹ä¹Ÿä¸ä¼šç»“æŸã€‚</p>
<pre><code class="hljs language-bash" lang="bash">78367 51513 /bin/zsh         /bin/zsh -il
80795 78367 bash             bash bootstrap.sh
80819 80795 npm <span class="hljs-built_in">exec</span> pm2-run npm <span class="hljs-built_in">exec</span> pm2-runtime start pm2.config.js --<span class="hljs-built_in">env</span> production      
80836 80819 node             node /xxx/.bin/../pm2/bin/pm2-runtime start pm2.config.js --<span class="hljs-built_in">env</span> production
80844 80836 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js     
80845 80836 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js 
</code></pre>
<p>å› æ­¤è¿™é‡Œçš„å®ç°ä»ç„¶éœ€è¦ä¿è¯ä½¿ç”¨<code>exec</code>æ¥å¯åŠ¨<code>pm2-runtime</code>æœåŠ¡ï¼Œæ­¤å¤–è¯¥å‘½ä»¤ä¸ä¼šå¯åŠ¨<code>pm2</code>çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œç›¸å…³æ—¥å¿—ä¼šç›´æ¥è¾“å‡ºåˆ°å½“å‰<code>shell</code>ä¸­ã€‚è€Œä¸”ä¹Ÿæ˜¯æ”¯æŒé›†ç¾¤æ¨¡å¼çš„ï¼Œä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä½¿ç”¨<code>pm2-runtime</code>å¯åŠ¨çš„è¿›ç¨‹å…³ç³»æ ‘ï¼Œæ‰§è¡Œ<code>kill -INT 84685</code>å¯ä»¥æ­£å¸¸å¤„ç†ä¿¡å·ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">78367 51513 /bin/zsh         /bin/zsh -il
78673 78367 node             node /xxx/.bin/../pm2/bin/pm2-runtime start pm2.config.js --<span class="hljs-built_in">env</span> production
78704 78673 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js     
78705 78673 node /Users/czy/ node /xxx/graceful-shutdown/dist/index.js
</code></pre>
<h3 data-id="heading-10">å¿ƒè·³æœºåˆ¶</h3>
<p>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œé™¤äº†ä¿¡å·ä¼ é€’çš„é—®é¢˜ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¿›ç¨‹æœ¬èº«çš„å­˜æ´»æ£€æµ‹é—®é¢˜ã€‚å‡è®¾æŸä¸ªå®ä¾‹ç”±äºæŸäº›åŸå› ç›´æ¥é€€å‡ºäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ— æ³•è¿›è¡Œä¼˜é›…åœæœºå¤„ç†äº†ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡å¿ƒè·³æœºåˆ¶æ¥æ£€æµ‹è¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ï¼Œä»¥æ­¤æ¥ç»´æŠ¤æœåŠ¡æœ¬èº«çš„å¥å£®æ€§ã€‚</p>
<p>å¿ƒè·³æœºåˆ¶çš„å®ç°å…¶å®éå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯é€šè¿‡å®šæ—¶å‘å­˜å‚¨ä½ç½®å†™å…¥å½“å‰çš„æ—¶é—´æˆ³æ¥è¡¨ç¤ºè¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨<code>Redis</code>æ¥å­˜å‚¨å¿ƒè·³æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆæ¯ä¸ªå®ä¾‹å¯ä»¥ä½¿ç”¨å”¯ä¸€çš„<code>key</code>æ¥å­˜å‚¨è‡ªå·±çš„å¿ƒè·³æ—¶é—´æˆ³ï¼Œç„¶åå®šæ—¶æ›´æ–°è¿™ä¸ªæ—¶é—´æˆ³ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">launchInstance</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">keep</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// æ›´æ–° Redis å¿ƒè·³æ—¶é—´æˆ³</span>
    <span class="hljs-built_in">setTimeout</span>(keep, <span class="hljs-variable constant_">LOOP_TIME</span>);
  };
  <span class="hljs-title function_">keep</span>();
  <span class="hljs-comment">// å¼€æœºæ—¶æ¸…ç†ä¸€æ¬¡è¿‡æœŸå®ä¾‹</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-title function_">clearInactiveInstances</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Active Instance"</span>, res.<span class="hljs-property">active</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Inactive Instance"</span>, res.<span class="hljs-property">inactive</span>);
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">terminateInstance</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// ä¼˜é›…åœæœºæ—¶åˆ é™¤å½“å‰å®ä¾‹</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearInactiveInstances</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> entries = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable constant_">MEMORY_MAP</span>);
  <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-attr">active</span>: string[] = [];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">inactive</span>: string[] = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> entries) {
    <span class="hljs-keyword">if</span> (now - <span class="hljs-title class_">Number</span>(value) &gt; <span class="hljs-variable constant_">ACTIVE_TIME_OUT</span>) {
      <span class="hljs-comment">// æ¸…ç†è¿‡æœŸå®ä¾‹</span>
      inactive.<span class="hljs-title function_">push</span>(key);
      <span class="hljs-keyword">continue</span>;
    }
    active.<span class="hljs-title function_">push</span>(key);
  }
  <span class="hljs-keyword">return</span> { active, inactive };
};
</code></pre>
<p>ç”±äºå®ä¾‹æœ¬èº«å¦‚æœé€€å‡ºäº†ï¼Œé‚£ä¹ˆå¿ƒè·³æ—¶é—´æˆ³å°±ä¸ä¼šå†æ›´æ–°äº†ï¼Œè€Œä¸”å®ˆæŠ¤è¿›ç¨‹çš„å­˜åœ¨ï¼Œé€€å‡ºçš„è¿›ç¨‹ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…é‡å¯ã€‚é‚£ä¹ˆåœ¨ä¸šåŠ¡ä¸­ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ€å¼€å§‹èŠçš„ä»»åŠ¡é˜Ÿåˆ—å®ç°ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å®ä¾‹å¯åŠ¨çš„æ—¶è·å–å½“å‰çš„æ´»è·ƒå®ä¾‹ï¼Œç„¶åæ£€æŸ¥æ­£åœ¨è¿è¡Œä»»åŠ¡çš„è°ƒåº¦å®ä¾‹<code>id</code>æ˜¯å¦è¿˜åœ¨æ´»è·ƒå®ä¾‹ä¸­ï¼Œä»¥æ­¤æ¥å°è¯•é‡æ–°è°ƒåº¦ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// task</span>
{
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">pod_id</span>: <span class="hljs-string">"$instance_id0"</span>,
  <span class="hljs-attr">status</span>: <span class="hljs-string">"running"</span>
}

<span class="hljs-comment">// redis</span>
[
  <span class="hljs-string">"$instance_id0"</span>: <span class="hljs-number">100</span>,
  <span class="hljs-string">"$instance_id1"</span>: <span class="hljs-number">9999999999</span>,
  <span class="hljs-string">"$instance_id2"</span>: <span class="hljs-number">9999999999</span>
]
</code></pre>
<h2 data-id="heading-11">æ€»ç»“</h2>
<p>åœ¨æ–‡æœ¬ä¸­æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”å®ç°äº†ä¼˜é›…åœæœºçš„å¤„ç†ã€‚ä»»åŠ¡é˜Ÿåˆ—ä¸»è¦æ˜¯é€šè¿‡åˆ†å¸ƒå¼é”æ¥é™åˆ¶å¹¶å‘æ•°ï¼Œä»è€Œä¿è¯ä»»åŠ¡èƒ½å¤Ÿè¢«åˆç†åœ°è°ƒåº¦æ‰§è¡Œï¼Œä»è€Œå®ç°é•¿ä»»åŠ¡çš„å¼‚æ­¥è°ƒåº¦æœºåˆ¶ï¼Œå¹¶ä¸”å®ç°ä»»åŠ¡çš„æµé‡å‰Šå³°ã€é”™è¯¯é‡è¯•ç­‰ã€‚</p>
<p>ä¼˜é›…åœæœºçš„å¤„ç†ä¸»è¦æ˜¯é€šè¿‡ä¿¡å·ä¼ é€’æ¥å®ç°çš„ï¼Œä»è€Œä¿è¯è¿›ç¨‹èƒ½å¤Ÿåœ¨æ”¶åˆ°åœæœºä¿¡å·æ—¶è¿›è¡Œèµ„æºçš„æ¸…ç†å’Œä»»åŠ¡çš„å®Œæˆï¼Œé¿å…ä»»åŠ¡çš„ä¸­æ–­å’Œæ•°æ®çš„ä¸ä¸€è‡´é—®é¢˜ã€‚æ­¤å¤–è¿˜å™è¿°äº†çˆ¶å­è¿›ç¨‹é—´çš„ä¿¡å·ä¼ é€’ï¼Œä»¥åŠå®ç°å¿ƒè·³æœºåˆ¶æ¥æ£€æµ‹å®ä¾‹çš„å­˜æ´»çŠ¶æ€ï¼Œä»è€Œä¿è¯åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æœåŠ¡å¥å£®æ€§ã€‚</p>
<h2 data-id="heading-12">æ¯æ—¥ä¸€é¢˜</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FWindRunnerMax%2FEveryDay" target="_blank" title="https://github.com/WindRunnerMax/EveryDay" ref="nofollow noopener noreferrer">github.com/WindRunnerMâ€¦</a></li>
</ul>
<h2 data-id="heading-13">å‚è€ƒ</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nestjs.com%2Fmodules" target="_blank" title="https://docs.nestjs.com/modules" ref="nofollow noopener noreferrer">docs.nestjs.com/modules</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fdocker-pm2-nodejs%2F" target="_blank" title="https://pm2.keymetrics.io/docs/usage/docker-pm2-nodejs/" ref="nofollow noopener noreferrer">pm2.keymetrics.io/docs/usage/â€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpm2.keymetrics.io%2Fdocs%2Fusage%2Fsignals-clean-restart%2F" target="_blank" title="https://pm2.keymetrics.io/docs/usage/signals-clean-restart/" ref="nofollow noopener noreferrer">pm2.keymetrics.io/docs/usage/â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Design Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7575438636332286003</link>    <guid>https://juejin.cn/post/7575438636332286003</guid>    <pubDate>2025-11-24T02:13:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575438636332286003" data-draft-id="7575469988737368073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Design Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-24T02:13:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åæ™®é€šçš„ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3913917126936087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Design Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917126936087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åæ™®é€šçš„ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:13:28.000Z" title="Mon Nov 24 2025 02:13:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Design Tokensæ˜¯ç°ä»£è®¾è®¡ç³»ç»Ÿä¸­çš„å…³é”®æŠ½è±¡å±‚ï¼Œå®ƒä»¬å°†è§†è§‰è®¾è®¡å…ƒç´ è½¬åŒ–ä¸ºå¯ç®¡ç†çš„å˜é‡ï¼Œä½¿è®¾è®¡ä¸å¼€å‘èƒ½å¤Ÿæ— ç¼åä½œå¹¶å®ç°ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ</strong>ã€‚ä½œä¸ºè®¾è®¡ä¸å¼€å‘çš„æ¡¥æ¢ï¼ŒDesign Tokensä¸ä»…æé«˜äº†å·¥ä½œæ•ˆç‡ï¼Œè¿˜ç¡®ä¿äº†äº§å“åœ¨ä¸åŒå¹³å°å’Œåœºæ™¯ä¸‹çš„è§†è§‰ä¸€è‡´æ€§ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æDesign Tokensçš„è®¾è®¡ç†å¿µã€åˆ†ç±»ä½“ç³»ã€å‘½åè§„åˆ™åŠå®æ–½æµç¨‹ï¼Œå¸®åŠ©è®¾è®¡å¸ˆå’Œå¼€å‘è€…å»ºç«‹å®Œæ•´çš„è®¾è®¡ç³»ç»Ÿå·¥ä½œæµã€‚</p>
<h3 data-id="heading-0">ä¸€ã€Design Tokensçš„åŸºæœ¬æ¦‚å¿µä¸æ ¸å¿ƒä»·å€¼</h3>
<p>Design Tokensçš„æ¦‚å¿µæœ€æ—©ç”±Salesforceçš„è®¾è®¡å›¢é˜Ÿåœ¨2014å¹´æå‡ºï¼Œå…¶åç§°æ¥æºäºè®¾è®¡å¸ˆJina Anne  ã€‚<strong>ç®€å•æ¥è¯´ï¼ŒDesign Tokensæ˜¯è®¾è®¡ç³»ç»Ÿä¸­çš„è§†è§‰è®¾è®¡åŸå­ï¼Œæ˜¯ä¸€ç»„æœ‰ç€ç»Ÿä¸€å‘½åè§„åˆ™çš„å®ä½“ï¼Œç”¨äºå­˜å‚¨è§†è§‰è®¾è®¡éƒ¨åˆ†çš„å…·ä½“å‚æ•°</strong>ï¼Œå¦‚HEXè‰²å€¼ã€é—´è·ã€å°ºå¯¸ã€å­—ä½“ç­‰  ã€‚å®ƒä»¬å¯ä»¥ç†è§£ä¸ºè®¾è®¡å¸ˆå’Œå¼€å‘äººå‘˜å…±åŒè®¤å¯çš„"å¤–å·"ï¼Œé€šè¿‡è¿™äº›å¤–å·è€Œéå…·ä½“çš„æ•°å€¼æ¥å¼•ç”¨è§†è§‰æ ·å¼  ã€‚</p>
<p>Design Tokensçš„æ ¸å¿ƒä»·å€¼ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<p>é¦–å…ˆï¼Œ<strong>Design Tokensç¡®ä¿äº†è®¾è®¡ä¸å¼€å‘çš„ä¸€è‡´æ€§</strong>ã€‚åœ¨ä¼ ç»Ÿè®¾è®¡æµç¨‹ä¸­ï¼Œè®¾è®¡å¸ˆåœ¨è®¾è®¡è½¯ä»¶ä¸­ä½¿ç”¨ç‰¹å®šæ ·å¼ï¼Œè€Œå¼€å‘äººå‘˜åˆ™éœ€è¦æ‰‹åŠ¨å°†è¿™äº›æ ·å¼è½¬æ¢ä¸ºä»£ç ï¼Œå®¹æ˜“å‡ºç°åå·®å’Œä¸ä¸€è‡´ã€‚é€šè¿‡Design Tokensï¼Œè®¾è®¡å¸ˆå’Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‘½åè§„åˆ™å’Œå‚æ•°å€¼ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬å’Œå®ç°åå·®ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<strong>Design Tokenså¤§å¹…æå‡äº†å¼€å‘æ•ˆç‡</strong>ã€‚å½“å“ç‰Œè‰²æˆ–è®¾è®¡è§„èŒƒéœ€è¦è°ƒæ•´æ—¶ï¼Œä¼ ç»Ÿçš„åšæ³•éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ï¼Œå·¥ä½œé‡å·¨å¤§ä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä½¿ç”¨Design Tokensåï¼Œåªéœ€ä¿®æ”¹ä¸€æ¬¡Tokenå€¼ï¼Œæ‰€æœ‰å¼•ç”¨è¯¥Tokençš„ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°  ã€‚ä¾‹å¦‚ï¼Œå½“å“ç‰Œä¸»è‰²ä»#00704aå˜æ›´ä¸º#007BFFæ—¶ï¼Œåªéœ€åœ¨Tokenä¸­ä¿®æ”¹ä¸€æ¬¡ï¼Œæ•´ä¸ªåº”ç”¨çš„æŒ‰é’®ã€å›¾æ ‡ã€æ–‡æœ¬ç­‰å…ƒç´ éƒ½ä¼šåŒæ­¥æ›´æ–°ï¼Œæ— éœ€é€ä¸ªä¿®æ”¹ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œ<strong>Design Tokensæ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯</strong>ã€‚é€šè¿‡åˆ†å±‚ç®¡ç†å’Œæ¡ä»¶èµ‹å€¼ï¼Œå¯ä»¥è½»æ¾å®ç°æ˜æš—æ¨¡å¼åˆ‡æ¢ã€å“ç‰Œå®šåˆ¶ç­‰éœ€æ±‚  ã€‚ä¾‹å¦‚ï¼Œåœ¨æš—è‰²æ¨¡å¼ä¸‹ï¼Œå±é™©è‰²Tokençš„å€¼å¯ä»¥è‡ªåŠ¨ä»#FF4444åˆ‡æ¢ä¸º#FF6B6Bï¼Œè€Œå¼€å‘äººå‘˜æ— éœ€ç¼–å†™é¢å¤–é€»è¾‘ã€‚</p>
<p>æœ€åï¼Œ<strong>Design Tokensé™ä½äº†ç»´æŠ¤æˆæœ¬</strong>ã€‚éšç€äº§å“è¿­ä»£å’Œä¸šåŠ¡æ‰©å±•ï¼Œè®¾è®¡ç³»ç»Ÿéœ€è¦ä¸æ–­æ›´æ–°ã€‚Design Tokensæä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„ç®¡ç†æ–¹å¼ï¼Œä½¿ç»´æŠ¤å’Œè¿­ä»£æ›´åŠ å¯æ§  ã€‚è®¾è®¡å¸ˆå¯ä»¥ä¸“æ³¨äºè®¾è®¡åˆ›æ–°ï¼Œè€Œå¼€å‘äººå‘˜åˆ™å¯ä»¥ä¸“æ³¨äºå®ç°é€»è¾‘ï¼ŒåŒæ–¹éƒ½èƒ½åœ¨å„è‡ªé¢†åŸŸé«˜æ•ˆå·¥ä½œã€‚</p>
<h3 data-id="heading-1">äºŒã€Design Tokensçš„åˆ†ç±»ä½“ç³»ä¸æ ¸å¿ƒå±æ€§</h3>
<p>Design Tokensçš„åˆ†ç±»ä½“ç³»é€šå¸¸åŸºäºè§†è§‰è®¾è®¡çš„åŸå­åŒ–åŸåˆ™ï¼Œå°†å¤æ‚çš„UIå…ƒç´ åˆ†è§£ä¸ºå¯å¤ç”¨çš„åŸºç¡€ç»„ä»¶ã€‚<strong>ä¸»è¦åˆ†ç±»åŒ…æ‹¬é¢œè‰²ç³»ç»Ÿã€æ’ç‰ˆç³»ç»Ÿã€é—´è·ä¸å°ºå¯¸ã€ç‰¹æ®Šå±æ€§ç­‰</strong>ï¼Œæ¯ç§åˆ†ç±»ä¸‹åˆæœ‰æ›´ç»†çš„å­ç±»  ã€‚</p>
<p>é¢œè‰²ç³»ç»Ÿæ˜¯Design Tokensä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ã€‚ä¸€ä¸ªå®Œæ•´çš„è®¾è®¡ç³»ç»Ÿé€šå¸¸åŒ…å«<strong>åŸºç¡€è‰²å’ŒåŠŸèƒ½è‰²ä¸¤å¤§éƒ¨åˆ†</strong>ï¼š</p>
<p>åŸºç¡€è‰²é€šå¸¸é‡‡ç”¨è‰²ç›¸-æ˜åº¦çš„åˆ†çº§ä½“ç³»ï¼Œå¦‚Semi Designçš„16ä¸ªè‰²ç›¸ï¼Œæ¯ä¸ªè‰²ç›¸åŒ…å«10ä¸ªæ˜åº¦ç­‰çº§ï¼Œä»0ï¼ˆæœ€æµ…ï¼‰åˆ°9ï¼ˆæœ€æ·±ï¼‰  ã€‚ä¾‹å¦‚çº¢è‰²ç³»åˆ—å¯ä»¥å®šä¹‰ä¸ºï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attr">--semi-red-0</span> : <span class="hljs-number">249</span>, <span class="hljs-number">57</span>, <span class="hljs-number">32</span>;  // æµ…çº¢è‰²
<span class="hljs-attr">--semi-red-9</span> : <span class="hljs-number">199</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>;    // æ·±çº¢è‰²
</code></pre>
<p>åŠŸèƒ½è‰²åˆ™åŸºäºç‰¹å®šåœºæ™¯å’Œç”¨é€”è¿›è¡Œå®šä¹‰ï¼Œå¦‚å“ç‰Œä¸»è‰²ã€æˆåŠŸè‰²ã€é”™è¯¯è‰²ã€è­¦å‘Šè‰²ç­‰  ã€‚è¿™äº›åŠŸèƒ½è‰²å¯ä»¥åŸºäºåŸºç¡€è‰²è¿›è¡Œè¡ç”Ÿï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">color</span>-primary: <span class="hljs-built_in">var</span>(--semi-blue-<span class="hljs-number">5</span>);  // å“ç‰Œä¸»è‰²
<span class="hljs-attribute">color</span>-error: <span class="hljs-built_in">var</span>(--semi-red-<span class="hljs-number">5</span>);     // é”™è¯¯é¢œè‰²
</code></pre>
<p>æ’ç‰ˆç³»ç»Ÿä¸»è¦åŒ…å«å­—å·ã€å­—é‡å’Œå­—ä½“å®¶æ—ç­‰å±æ€§ã€‚ä¸€ä¸ªå…¸å‹çš„æ’ç‰ˆç³»ç»Ÿå¯èƒ½å®šä¹‰5çº§å­—å·ï¼ˆå¦‚12pxåˆ°32pxï¼‰å’Œ3ç§å­—é‡ï¼ˆè½»ã€å¸¸è§„ã€ç²—ï¼‰  ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">font-size</span> small: <span class="hljs-number">12px</span>;    // è¾…åŠ©æ–‡æœ¬
<span class="hljs-attribute">font-size</span> regular: <span class="hljs-number">14px</span>;  // æ­£æ–‡
<span class="hljs-attribute">font-size</span> <span class="hljs-selector-tag">header</span>-<span class="hljs-number">6</span>: <span class="hljs-number">16px</span>; // å°æ ‡é¢˜
<span class="hljs-attribute">font-weight</span> bold: <span class="hljs-number">600</span>;     // å¼ºè°ƒæ–‡æœ¬
</code></pre>
<p>é—´è·ä¸å°ºå¯¸ç³»ç»Ÿåˆ™å®šä¹‰äº†UIå…ƒç´ ä¹‹é—´çš„é—´è·å’Œæ ‡å‡†å°ºå¯¸ï¼Œé€šå¸¸é‡‡ç”¨8çº§é—´è·ä½“ç³»ï¼ˆå¦‚2pxåˆ°40pxï¼‰å’Œ3ç§æ§ä»¶é«˜åº¦  ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">spacing-extra-tight: <span class="hljs-number">4</span>px;  <span class="hljs-comment">// ç´§å‡‘å†…è¾¹è·</span>
spacing-base: <span class="hljs-number">16</span>px;        <span class="hljs-comment">// é»˜è®¤é—´è·</span>
height-control-<span class="hljs-keyword">default</span>: <span class="hljs-number">32</span>px;  <span class="hljs-comment">// æŒ‰é’®/è¾“å…¥æ¡†é»˜è®¤é«˜åº¦</span>
</code></pre>
<p>ç‰¹æ®Šå±æ€§åŒ…æ‹¬z-indexå±‚çº§ã€æŠ•å½±æ•ˆæœã€é˜´å½±ç­‰çº§ã€åŠ¨ç”»æ›²çº¿ç­‰ï¼Œè¿™äº›å±æ€§å¯¹äºå¤æ‚UIçš„å‘ˆç°è‡³å…³é‡è¦  ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">z-modal: <span class="hljs-number">1000</span>;       <span class="hljs-comment">// æ¨¡æ€æ¡†å±‚çº§</span>
z-tooltip: <span class="hljs-number">1060</span>;     <span class="hljs-comment">// æç¤ºæ¡†å±‚çº§ï¼ˆé«˜äºæ¨¡æ€æ¡†ï¼‰</span>
shadow-low: <span class="hljs-number">0</span> <span class="hljs-number">2</span>px <span class="hljs-number">4</span><span class="hljs-function">px <span class="hljs-title">rgba</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.01</span>)</span></span>;  <span class="hljs-comment">// è¾ƒä½çš„é˜´å½±</span>
shadow-high: <span class="hljs-number">0</span> <span class="hljs-number">8</span>px <span class="hljs-number">16</span><span class="hljs-function">px <span class="hljs-title">rgba</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>)</span></span>;  <span class="hljs-comment">// è¾ƒé«˜çš„é˜´å½±</span>
</code></pre>
<p><strong>Design Tokensçš„ç²¾é«“åœ¨äºå°†å…±æ€§ç‰¹å¾/å±æ€§å˜æˆå¯æ“æ§çš„å˜é‡</strong>  ã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªç»„ä»¶çš„åœ†è§’å¯èƒ½éƒ½æ˜¯4pxï¼Œä¸”è¿™äº›åœ†è§’éƒ½ç”¨äºç»„ä»¶çš„èƒŒæ™¯å±‚ï¼Œé‚£ä¹ˆå®ƒä»¬å¯ä»¥ç»‘å®šå’Œä½¿ç”¨åŒä¸€ä¸ªåœ†è§’Tokenï¼Œå¦‚<code>corner-background-small</code>ã€‚å½“éœ€è¦å°†è¿™5ä¸ªç»„ä»¶çš„åœ†è§’éƒ½æ”¹ä¸º8pxæ—¶ï¼Œåªéœ€ä¿®æ”¹ä¸€æ¬¡Tokenå€¼ï¼Œæ‰€æœ‰ç›¸å…³ç»„ä»¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°  ã€‚</p>
<h3 data-id="heading-2">ä¸‰ã€å‘½åè§„åˆ™çš„è®¾è®¡åŸåˆ™ä¸æœ€ä½³å®è·µ</h3>
<p>Design Tokensçš„å‘½åè§„åˆ™æ˜¯ç¡®ä¿è®¾è®¡ä¸å¼€å‘åä½œé¡ºç•…çš„å…³é”®ã€‚<strong>è‰¯å¥½çš„å‘½åè§„åˆ™åº”å½“éµå¾ªè¯­ä¹‰åŒ–ã€ä¸€è‡´æ€§ã€å¯è¯»æ€§å’Œåˆ†å±‚ç»“æ„ç­‰åŸåˆ™</strong>  ã€‚</p>
<p>è¯­ä¹‰åŒ–åŸåˆ™è¦æ±‚Tokenåç§°èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾å…¶ç”¨é€”å’Œä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼Œ<code>color-button-background-primary-normal</code>æ¯”ç®€å•çš„<code>color-1</code>æ›´æœ‰æ„ä¹‰ï¼Œèƒ½å¤Ÿæ˜ç¡®è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæŒ‰é’®çš„ä¸»çŠ¶æ€èƒŒæ™¯è‰²  ã€‚è¿™ç§å‘½åæ–¹å¼ä½¿å¾—è®¾è®¡å¸ˆå’Œå¼€å‘è€…éƒ½èƒ½ç›´è§‚ç†è§£Tokençš„ç”¨é€”ï¼Œå‡å°‘æ²Ÿé€šæˆæœ¬ã€‚</p>
<p>ä¸€è‡´æ€§åŸåˆ™è¦æ±‚æ•´ä¸ªè®¾è®¡ç³»ç»Ÿä¸­Tokençš„å‘½åé£æ ¼ä¿æŒç»Ÿä¸€ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨ç›¸åŒçš„åˆ†éš”ç¬¦ï¼ˆå¦‚æ¨ªçº¿ï¼‰ã€ç›¸åŒçš„å‘½åå±‚çº§ï¼ˆå¦‚"åˆ†ç±»-åœºæ™¯-çŠ¶æ€"ï¼‰ä»¥åŠç›¸åŒçš„æœ¯è¯­  ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰é¢œè‰²Tokenéƒ½åº”ä½¿ç”¨<code>color-</code>å‰ç¼€ï¼Œæ‰€æœ‰é—´è·Tokenéƒ½åº”ä½¿ç”¨<code>spacing-</code>å‰ç¼€ï¼Œä¿æŒå‘½åçš„ä¸€è‡´æ€§ã€‚</p>
<p>å¯è¯»æ€§åŸåˆ™è¦æ±‚Tokenåç§°åº”å½“ç®€æ´æ˜äº†ï¼Œé¿å…è¿‡é•¿æˆ–è¿‡äºå¤æ‚çš„å‘½åã€‚åŒæ—¶ï¼Œåç§°åº”å½“ä½¿ç”¨è‹±æ–‡ï¼Œå› ä¸ºè¿™æ˜¯è®¾è®¡ä¸å¼€å‘åä½œçš„é€šç”¨è¯­è¨€  ã€‚ä¾‹å¦‚ï¼Œ<code>button-bg-color</code>æ¯”<code>btnèƒŒæ™¯è‰²</code>æ›´åˆé€‚ï¼Œå› ä¸ºå®ƒä½¿ç”¨è‹±æ–‡ä¸”ç®€æ´ã€‚</p>
<p>åˆ†å±‚ç»“æ„åŸåˆ™è¦æ±‚Tokenåç§°èƒ½å¤Ÿåæ˜ å…¶åœ¨è®¾è®¡ç³»ç»Ÿä¸­çš„å±‚çº§å…³ç³»ã€‚é€šå¸¸é‡‡ç”¨ä¸‰çº§ç»“æ„ï¼šåŸºç¡€Tokenï¼ˆåŸå§‹å€¼ï¼‰ã€è¯­ä¹‰Tokenï¼ˆç”¨é€”è¯´æ˜ï¼‰å’Œç»„ä»¶Tokenï¼ˆç»„ä»¶çº§å˜é‡ï¼‰  ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">// åŸºç¡€Token
<span class="hljs-attr">--semi-blue-5</span>: <span class="hljs-number">#00704a</span>;

// è¯­ä¹‰Token
<span class="hljs-attribute">color</span>-brand-default: <span class="hljs-built_in">var</span>(--semi-blue-<span class="hljs-number">5</span>);

// ç»„ä»¶Token
<span class="hljs-selector-tag">button</span>-bg-<span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(color-brand-default);
</code></pre>
<p>è¿™ç§åˆ†å±‚ç»“æ„ä½¿å¾—è®¾è®¡ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚åŸºç¡€Tokenæ˜¯è®¾è®¡ç³»ç»Ÿçš„åº•å±‚å…ƒç´ ï¼Œè¯­ä¹‰Tokenåˆ™èµ‹äºˆè¿™äº›åŸºç¡€å…ƒç´ å…·ä½“çš„ç”¨é€”ï¼Œç»„ä»¶Tokenåˆ™å°†è¿™äº›è¯­ä¹‰Tokenåº”ç”¨åˆ°å…·ä½“çš„ç»„ä»¶ä¸­ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ<strong>Tokenå‘½åé€šå¸¸é‡‡ç”¨"åˆ†ç±»-åœºæ™¯-çŠ¶æ€"æ¨¡å¼</strong>  ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>é¢œè‰²Tokenï¼š<code>color-button-background-primary-normal</code></li>
<li>å­—ä½“Tokenï¼š<code>font-size-text regular</code></li>
<li>åœ†è§’Tokenï¼š<code>corner-background-small</code></li>
</ul>
<p>è¿™ç§å‘½åæ–¹å¼èƒ½å¤Ÿæ¸…æ™°è¡¨è¾¾Tokençš„åˆ†ç±»ã€åº”ç”¨åœºæ™¯å’ŒçŠ¶æ€ï¼Œä½¿è®¾è®¡å¸ˆå’Œå¼€å‘è€…éƒ½èƒ½å¿«é€Ÿç†è§£Tokençš„ç”¨é€”ã€‚</p>
<p>å¯¹äºå¤æ‚çš„é¡¹ç›®ï¼Œ<strong>å¯ä»¥é‡‡ç”¨"å¥—å¨ƒ"ç»“æ„ï¼Œå³åŸºç¡€Tokenä¸ç»„ä»¶Tokençš„å…³è”</strong>  ã€‚ä¾‹å¦‚ï¼Œç™»å½•æŒ‰é’®çš„èƒŒæ™¯è‰²å¯ä»¥å®šä¹‰ä¸º<code>login-button-bg</code>ï¼Œè€Œè¿™ä¸ªTokenå¯ä»¥å¼•ç”¨åŸºç¡€å“ç‰Œè‰²<code>brand-color-1</code>ï¼š</p>
<pre><code class="hljs language-css" lang="css">login-<span class="hljs-selector-tag">button</span>-bg: <span class="hljs-built_in">var</span>(brand-color-<span class="hljs-number">1</span>);
</code></pre>
<p>è¿™æ ·ï¼Œå½“å“ç‰Œè‰²éœ€è¦è°ƒæ•´æ—¶ï¼Œåªéœ€ä¿®æ”¹<code>brand-color-1</code>çš„å€¼ï¼Œæ‰€æœ‰å¼•ç”¨å®ƒçš„ç»„ä»¶Tokenéƒ½ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œä¿æŒè®¾è®¡çš„ä¸€è‡´æ€§ã€‚</p>
<h3 data-id="heading-3">å››ã€ä»è®¾è®¡åˆ°å¼€å‘çš„å®Œæ•´å®æ–½æµç¨‹</h3>
<p>å®æ–½Design Tokenséœ€è¦è®¾è®¡å›¢é˜Ÿå’Œå¼€å‘å›¢é˜Ÿçš„ç´§å¯†åä½œï¼Œé€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<p>é¦–å…ˆï¼Œ<strong>åœ¨è®¾è®¡é˜¶æ®µï¼Œéœ€è¦ä»è®¾è®¡è§„èŒƒä¸­æå–è§†è§‰å…ƒç´ å¹¶å®šä¹‰åŸºç¡€Token</strong>  ã€‚è®¾è®¡å¸ˆåº”å½“ä¸å¼€å‘äººå‘˜å…±åŒå‚ä¸è¿™ä¸€è¿‡ç¨‹ï¼Œç¡®ä¿åŒæ–¹å¯¹Tokençš„å®šä¹‰å’Œç”¨é€”æœ‰å…±åŒç†è§£ã€‚æå–çš„è§†è§‰å…ƒç´ åŒ…æ‹¬é¢œè‰²ã€å­—ä½“ã€é—´è·ã€åœ†è§’ã€é˜´å½±ç­‰åŸºç¡€è®¾è®¡å…ƒç´   ã€‚ä¾‹å¦‚ï¼Œä»è®¾è®¡è§„èŒƒä¸­æå–æ‰€æœ‰æŒ‰é’®çš„èƒŒæ™¯è‰²ã€è¾¹æ¡†é¢œè‰²ã€æ–‡å­—é¢œè‰²ç­‰ï¼Œå¹¶ä¸ºè¿™äº›é¢œè‰²å®šä¹‰åŸºç¡€Tokenã€‚</p>
<p>ç„¶åï¼Œ<strong>åœ¨è®¾è®¡å·¥å…·ä¸­å»ºç«‹Tokenç®¡ç†ç³»ç»Ÿ</strong>  ã€‚è®¾è®¡å¸ˆå¯ä»¥ä½¿ç”¨Sketchã€Figmaç­‰è®¾è®¡å·¥å…·çš„æ ·å¼åº“åŠŸèƒ½ï¼Œå°†æå–çš„è§†è§‰å…ƒç´ è½¬åŒ–ä¸ºTokenï¼Œå¹¶æŒ‰ç…§åˆ†ç±»ã€åœºæ™¯å’ŒçŠ¶æ€è¿›è¡Œç»„ç»‡  ã€‚ä¾‹å¦‚ï¼Œåœ¨Figmaä¸­åˆ›å»ºé¢œè‰²ã€å­—ä½“ã€é—´è·ç­‰åˆ†ç±»ï¼Œæ¯ä¸ªåˆ†ç±»ä¸‹å†æŒ‰åœºæ™¯å’ŒçŠ¶æ€ç»„ç»‡Tokenã€‚åŒæ—¶ï¼Œè®¾è®¡å¸ˆåº”å½“å°†Tokenè®°å½•åœ¨è¡¨æ ¼ä¸­ï¼ŒåŒ…æ‹¬Tokenåç§°ã€ä¸­æ–‡åã€å€¼å’Œåº”ç”¨åœºæ™¯ç­‰ä¿¡æ¯ï¼Œä¾¿äºå¼€å‘äººå‘˜ç†è§£å’Œä½¿ç”¨  ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œ<strong>ä½¿ç”¨å·¥å…·é“¾å°†è®¾è®¡Tokenè½¬æ¢ä¸ºå¼€å‘ä»£ç </strong>  ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨Style Dictionaryã€Theoç­‰å·¥å…·ï¼Œå°†è®¾è®¡Tokenå¯¼å‡ºä¸ºä¸åŒå¹³å°å’Œæ ¼å¼çš„ä»£ç   ã€‚ä¾‹å¦‚ï¼Œå°†Tokenå¯¼å‡ºä¸ºCSSå˜é‡ã€SCSSå˜é‡ã€JSONæ–‡ä»¶æˆ–React Contextç­‰æ ¼å¼ï¼Œä¾›å‰ç«¯å¼€å‘ä½¿ç”¨  ã€‚ä¸€ä¸ªå…¸å‹çš„Tokenè½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">// è®¾è®¡Token
<span class="hljs-attribute">color</span>-<span class="hljs-selector-tag">button</span>-<span class="hljs-attribute">background</span>-primary-<span class="hljs-attribute">normal</span>: <span class="hljs-number">#00704a</span>;

// è½¬æ¢ä¸ºCSSå˜é‡
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--color-button-background-primary-normal</span>: <span class="hljs-number">#00704a</span>;
}

// è½¬æ¢ä¸ºSCSSå˜é‡
$<span class="hljs-attribute">color</span>-<span class="hljs-selector-tag">button</span>-<span class="hljs-attribute">background</span>-primary-<span class="hljs-attribute">normal</span>: <span class="hljs-number">#00704a</span>;
</code></pre>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œ<strong>å°†Tokené›†æˆåˆ°ç»„ä»¶åº“å’Œä¸»é¢˜ç³»ç»Ÿä¸­</strong>  ã€‚å‰ç«¯å¼€å‘äººå‘˜åº”å½“å°†è½¬æ¢åçš„Tokenåº”ç”¨åˆ°ç»„ä»¶çš„æ ·å¼ä¸­ï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½ä½¿ç”¨Tokenè€Œéç¡¬ç¼–ç çš„å€¼  ã€‚åŒæ—¶ï¼Œåº”å½“å»ºç«‹ä¸»é¢˜ç³»ç»Ÿï¼Œé€šè¿‡æ¡ä»¶èµ‹å€¼å®ç°ä¸åŒä¸»é¢˜ï¼ˆå¦‚æ˜æš—æ¨¡å¼ï¼‰çš„åˆ‡æ¢  ã€‚ä¾‹å¦‚ï¼ŒSemi Designçš„å®ç°æ–¹å¼ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ˜æ¨¡å¼å±é™©è‰²å®šä¹‰ */</span>
<span class="hljs-attr">--semi-red-5</span> : <span class="hljs-number">249</span>, <span class="hljs-number">57</span>, <span class="hljs-number">32</span>;

<span class="hljs-comment">/* æš—æ¨¡å¼å±é™©è‰²è‡ªåŠ¨åè½¬ */</span>
<span class="hljs-attr">--semi-red-5</span> : <span class="hljs-number">252</span>, <span class="hljs-number">114</span>, <span class="hljs-number">90</span>;
</code></pre>
<p>æœ€åï¼Œ<strong>å»ºç«‹Tokençš„ç»´æŠ¤å’Œè¿­ä»£æœºåˆ¶</strong>  ã€‚Design Tokensä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œéšç€äº§å“è¿­ä»£å’Œä¸šåŠ¡éœ€æ±‚å˜åŒ–ï¼Œéœ€è¦ä¸æ–­æ›´æ–°å’Œæ‰©å±•ã€‚å› æ­¤ï¼Œåº”å½“å»ºç«‹Tokençš„ç»´æŠ¤æœºåˆ¶ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬æ§åˆ¶ã€å˜æ›´é€šçŸ¥å’Œæ–‡æ¡£æ›´æ–°ç­‰  ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒç®¡ç†Tokenä»“åº“ï¼Œé€šè¿‡npmåŒ…å‘å¸ƒæ›´æ–°ï¼Œå¹¶å»ºç«‹å®Œå–„çš„æ–‡æ¡£ç³»ç»Ÿè®°å½•Tokençš„å®šä¹‰å’Œç”¨é€”  ã€‚</p>
<h3 data-id="heading-4">äº”ã€Design Tokensçš„å®æ–½å·¥å…·ä¸æœ€ä½³å®è·µ</h3>
<p>å®æ–½Design Tokenséœ€è¦ä¸€ç³»åˆ—å·¥å…·æ”¯æŒï¼ŒåŒ…æ‹¬è®¾è®¡å·¥å…·ã€è½¬æ¢å·¥å…·å’Œå¼€å‘å·¥å…·ç­‰ã€‚</p>
<p>åœ¨è®¾è®¡å·¥å…·æ–¹é¢ï¼ŒFigmaã€Sketchå’ŒAdobe XDç­‰ä¸»æµå·¥å…·éƒ½æ”¯æŒTokenç®¡ç†ã€‚<strong>Figmaçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿæä¾›äº†å¤šç§Tokenç®¡ç†è§£å†³æ–¹æ¡ˆ</strong>ï¼Œå¦‚Tokens Studioã€Token Managerç­‰ï¼Œå¯ä»¥å°†è®¾è®¡Tokenå¯¼å‡ºä¸ºJSONæˆ–CSSå˜é‡æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨Tokens Studioæ’ä»¶å¯ä»¥å¿«é€Ÿå¯¼å‡ºè®¾è®¡Tokenï¼Œå¹¶ä¸å¼€å‘å›¢é˜Ÿå…±äº«ã€‚</p>
<p>åœ¨è½¬æ¢å·¥å…·æ–¹é¢ï¼Œ<strong>Style Dictionaryå’ŒTheoæ˜¯ä¸¤ä¸ªæœ€å¸¸ç”¨çš„è®¾è®¡ç³»ç»Ÿè½¬æ¢å·¥å…·</strong>  ã€‚Style Dictionaryå¯ä»¥å°†è®¾è®¡Tokenä»JSONæ ¼å¼è½¬æ¢ä¸ºå¤šç§å¼€å‘æ ¼å¼ï¼Œå¦‚CSSã€SCSSã€Lessã€React Contextç­‰ã€‚Theoï¼ˆç”±Salesforceå¼€å‘ï¼‰åˆ™ä¸“æ³¨äºCSSå˜é‡çš„ç”Ÿæˆå’Œç®¡ç†ï¼Œæ”¯æŒä¸»é¢˜åˆ‡æ¢å’ŒåŠ¨æ€æ›´æ–°ã€‚è¿™äº›å·¥å…·å¤§å¤§ç®€åŒ–äº†è®¾è®¡åˆ°å¼€å‘çš„è½¬æ¢è¿‡ç¨‹ï¼Œæé«˜äº†å·¥ä½œæ•ˆç‡ã€‚</p>
<p>åœ¨å¼€å‘å·¥å…·æ–¹é¢ï¼Œ<strong>ç°ä»£å‰ç«¯æ¡†æ¶éƒ½æ”¯æŒTokençš„é›†æˆå’Œä½¿ç”¨</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨Reactä¸­å¯ä»¥ä½¿ç”¨Context APIç®¡ç†ä¸»é¢˜Tokenï¼›åœ¨Vueä¸­å¯ä»¥ä½¿ç”¨æä¾›/æ³¨å…¥ï¼ˆprovide/injectï¼‰æœºåˆ¶ï¼›åœ¨Flutterä¸­åˆ™å¯ä»¥ä½¿ç”¨ä¸»é¢˜ï¼ˆThemeï¼‰å’Œä¸»é¢˜æ•°æ®ï¼ˆThemeDataï¼‰æ¥ç®¡ç†Tokenã€‚åŒæ—¶ï¼ŒCSSå˜é‡ï¼ˆCustom Propertiesï¼‰æ˜¯å®ç°åŠ¨æ€ä¸»é¢˜å’Œè·¨å¹³å°ä¸€è‡´æ€§çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œåº”å½“å……åˆ†åˆ©ç”¨ã€‚</p>
<p>å®æ–½Design Tokensçš„æœ€ä½³å®è·µåŒ…æ‹¬ï¼š</p>
<p><strong>å»ºç«‹è·¨èŒèƒ½å›¢é˜Ÿ</strong>ï¼šè®¾è®¡ã€å¼€å‘å’Œäº§å“å›¢é˜Ÿåº”å½“å…±åŒå‚ä¸Design Tokensçš„è®¾è®¡å’Œå®æ–½ï¼Œç¡®ä¿å„æ–¹éœ€æ±‚éƒ½è¢«è€ƒè™‘  ã€‚è®¾è®¡å¸ˆè´Ÿè´£å®šä¹‰è§†è§‰å…ƒç´ ï¼Œå¼€å‘äººå‘˜è´Ÿè´£æŠ€æœ¯å®ç°ï¼Œäº§å“å›¢é˜Ÿåˆ™æä¾›ä¸šåŠ¡åœºæ™¯å’Œéœ€æ±‚æ´å¯Ÿã€‚</p>
<p><strong>é‡‡ç”¨æ¸è¿›å¼å®æ–½ç­–ç•¥</strong>ï¼šå¯¹äºå¤§å‹é¡¹ç›®ï¼Œå¯ä»¥é‡‡ç”¨æ¸è¿›å¼ç­–ç•¥ï¼Œå…ˆä»æ ¸å¿ƒç»„ä»¶å’Œé«˜é¢‘ä½¿ç”¨çš„è®¾è®¡å…ƒç´ å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°æ•´ä¸ªè®¾è®¡ç³»ç»Ÿ  ã€‚ä¾‹å¦‚ï¼Œå…ˆå®šä¹‰é¢œè‰²å’Œå­—ä½“Tokenï¼Œå†é€æ­¥æ·»åŠ é—´è·ã€åœ†è§’ã€é˜´å½±ç­‰å…¶ä»–Tokenã€‚</p>
<p><strong>ä¿æŒTokençš„æœ€å°åŒ–å’Œå¯ç»„åˆæ€§</strong>ï¼šDesign Tokensåº”å½“å°½å¯èƒ½åŸºç¡€å’ŒåŸå­åŒ–ï¼Œä¾¿äºç»„åˆå’Œå¤ç”¨  ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰åŸºç¡€é¢œè‰²Tokenè€Œéå…·ä½“çš„ç»„ä»¶é¢œè‰²Tokenï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸åŒç»„ä»¶ä¸­çµæ´»ç»„åˆä½¿ç”¨ã€‚</p>
<p><strong>æä¾›å®Œå–„çš„æ–‡æ¡£å’Œç¤ºä¾‹</strong>ï¼šè‰¯å¥½çš„æ–‡æ¡£æ˜¯Design TokensæˆåŠŸå®æ–½çš„å…³é”®  ã€‚åº”å½“ä¸ºæ¯ä¸ªTokenæä¾›è¯¦ç»†çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ç”¨é€”ã€å€¼ã€åº”ç”¨åœºæ™¯å’Œç¤ºä¾‹ç­‰ã€‚åŒæ—¶ï¼Œåº”å½“æä¾›UIç»„ä»¶åº“çš„ç¤ºä¾‹ï¼Œå±•ç¤ºTokenå¦‚ä½•åº”ç”¨åˆ°å®é™…ç»„ä»¶ä¸­ã€‚</p>
<p><strong>å®æ–½ç‰ˆæœ¬æ§åˆ¶å’Œå˜æ›´ç®¡ç†</strong>ï¼šDesign Tokensåº”å½“é‡‡ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿å˜æ›´å¯ä»¥è¿½æº¯å’Œå›æ»š  ã€‚åŒæ—¶ï¼Œåº”å½“å»ºç«‹å˜æ›´ç®¡ç†æµç¨‹ï¼Œç¡®ä¿é‡è¦å˜æ›´ç»è¿‡è¯„å®¡å’Œæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨GitHubç®¡ç†Tokenä»“åº“ï¼Œé€šè¿‡Pull Requestè¿›è¡Œå˜æ›´è¯„å®¡ã€‚</p>
<p><strong>æ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯</strong>ï¼šDesign Tokensåº”å½“è®¾è®¡ä¸ºæ”¯æŒåŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯ï¼Œé€šè¿‡æ¡ä»¶èµ‹å€¼å®ç°ä¸åŒä¸»é¢˜å’Œå“ç‰Œçš„åˆ‡æ¢  ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰æ˜æš—æ¨¡å¼ä¸‹çš„ä¸åŒTokenå€¼ï¼Œæˆ–ä¸ºä¸åŒå“ç‰Œå®šä¹‰ç‰¹å®šçš„Tokenæ‰©å±•å±‚  ã€‚</p>
<h3 data-id="heading-5">å…­ã€Design Tokensçš„æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p>å°½ç®¡Design Tokenså¸¦æ¥äº†è¯¸å¤šå¥½å¤„ï¼Œä½†åœ¨å®æ–½è¿‡ç¨‹ä¸­ä¹Ÿé¢ä¸´ä¸€äº›æŒ‘æˆ˜ã€‚</p>
<p><strong>Tokenæ•°é‡çˆ†ç‚¸</strong>ï¼šéšç€è®¾è®¡ç³»ç»Ÿçš„æ‰©å±•ï¼ŒTokenæ•°é‡å¯èƒ½ä¼šè¿…é€Ÿå¢åŠ ï¼Œå¯¼è‡´ç®¡ç†å›°éš¾ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨åˆ†å±‚ç»“æ„å’Œå‘½åç©ºé—´</strong>ï¼Œå°†TokenæŒ‰ç…§åˆ†ç±»ã€åœºæ™¯å’ŒçŠ¶æ€è¿›è¡Œç»„ç»‡ï¼Œé¿å…å‘½åå†²çªå’Œæ··ä¹±  ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨<code>color-button-</code>ä½œä¸ºæŒ‰é’®é¢œè‰²çš„å‘½åç©ºé—´ï¼Œæ‰€æœ‰æŒ‰é’®ç›¸å…³çš„é¢œè‰²Tokenéƒ½ä½¿ç”¨è¿™ä¸€å‰ç¼€ã€‚</p>
<p><strong>è®¾è®¡ä¸å¼€å‘çš„æœ¯è¯­å·®å¼‚</strong>ï¼šè®¾è®¡å¸ˆå’Œå¼€å‘äººå‘˜å¯èƒ½ä½¿ç”¨ä¸åŒçš„æœ¯è¯­æè¿°ç›¸åŒçš„è§†è§‰å…ƒç´ ï¼Œå¯¼è‡´æ²Ÿé€šéšœç¢ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯å»ºç«‹ç»Ÿä¸€çš„æœ¯è¯­è¡¨å’Œå‘½åè§„åˆ™</strong>  ï¼Œç¡®ä¿åŒæ–¹ä½¿ç”¨ç›¸åŒçš„æœ¯è¯­å’Œå‘½åæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œè®¾è®¡å¸ˆå¯èƒ½ç§°ä¸º"ä¸»è‰²"ï¼Œè€Œå¼€å‘äººå‘˜å¯èƒ½ç§°ä¸º"primary-color"ï¼Œåº”å½“ç»Ÿä¸€ä¸º"color-brand-default"ã€‚</p>
<p><strong>å¤šå¹³å°ä¸€è‡´æ€§ç»´æŠ¤</strong>ï¼šåœ¨è·¨å¹³å°åº”ç”¨ä¸­ï¼Œä¸åŒå¹³å°å¯èƒ½æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå¯¼è‡´Tokenå€¼éš¾ä»¥ç»Ÿä¸€ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨æŠ½è±¡å±‚å’Œé€‚é…å™¨æ¨¡å¼</strong>ï¼Œå°†å¹³å°ç‰¹å®šçš„å®ç°ç»†èŠ‚éšè—åœ¨æŠ½è±¡å±‚åé¢ï¼Œç¡®ä¿Tokenåœ¨ä¸åŒå¹³å°ä¸Šçš„è¡¨ç°ä¸€è‡´  ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰<code>shadow-low</code>ä½œä¸ºæŠ½è±¡Tokenï¼Œç„¶ååœ¨ä¸åŒå¹³å°ä¸­å®ç°ä¸ºç‰¹å®šçš„é˜´å½±æ•ˆæœã€‚</p>
<p><strong>æ—§ç³»ç»Ÿè¿ç§»å›°éš¾</strong>ï¼šå¯¹äºå·²æœ‰è®¾è®¡ç³»ç»Ÿï¼Œè¿ç§»åˆ°Design Tokenså¯èƒ½é¢ä¸´å…¼å®¹æ€§å’Œä¸€è‡´æ€§é—®é¢˜ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨æ¸è¿›å¼è¿ç§»ç­–ç•¥</strong>  ï¼Œé€æ­¥æ›¿æ¢æ—§ç³»ç»Ÿä¸­çš„æ ·å¼å®šä¹‰ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºæ—§ç³»ç»Ÿä¸æ–°Tokençš„æ˜ å°„è¡¨ï¼Œç¡®ä¿ç°æœ‰ç»„ä»¶åœ¨è¿ç§»è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°æ ·å¼åå·®ã€‚</p>
<p><strong>å›¢é˜Ÿåä½œé˜»åŠ›</strong>ï¼šåœ¨å¤§å‹å›¢é˜Ÿä¸­ï¼Œè®¾è®¡å’Œå¼€å‘äººå‘˜å¯èƒ½å¯¹Tokençš„ä½¿ç”¨æœ‰ä¸åŒæ„è§ï¼Œå¯¼è‡´åä½œå›°éš¾ã€‚<strong>è§£å†³æ–¹æ¡ˆæ˜¯å»ºç«‹æ˜ç¡®çš„æ²»ç†æ¡†æ¶å’Œå†³ç­–æµç¨‹</strong>  ï¼Œç¡®ä¿Tokençš„å®šä¹‰å’Œä½¿ç”¨æœ‰æ˜ç¡®çš„è§„åˆ™å’Œè´£ä»»äººã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç«‹Tokenæ²»ç†å§”å‘˜ä¼šï¼Œè´Ÿè´£Tokençš„å®šä¹‰ã€å®¡æ ¸å’Œæ›´æ–°ã€‚</p>
<h3 data-id="heading-6">ä¸ƒã€å®é™…æ¡ˆä¾‹åˆ†æï¼šSemi Designçš„Tokenå®ç°</h3>
<p>Semi Designæ˜¯ä¸€ä¸ªå…¸å‹çš„é‡‡ç”¨Design Tokensçš„è®¾è®¡ç³»ç»Ÿï¼Œå®ƒæä¾›äº†è¶…è¿‡2800ä¸ªè®¾è®¡Tokenï¼Œè¦†ç›–äº†é¢œè‰²ã€å­—ä½“ã€é—´è·ã€å°ºå¯¸ç­‰å¤šä¸ªæ–¹é¢  ã€‚<strong>Semi Designçš„Tokenå®ç°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åˆ†å±‚ç»“æ„å’ŒæŠ½è±¡åŒ–è®¾è®¡å®ç°é«˜åº¦ä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§</strong>  ã€‚</p>
<p>Semi Designçš„é¢œè‰²ç³»ç»Ÿé‡‡ç”¨äº†16ä¸ªè‰²ç›¸ï¼Œæ¯ä¸ªè‰²ç›¸åŒ…å«10ä¸ªæ˜åº¦ç­‰çº§ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è‰²ç›˜  ã€‚ä¾‹å¦‚çº¢è‰²ç³»åˆ—ä»<code>--semi-red-0</code>ï¼ˆæµ…çº¢è‰²ï¼‰åˆ°<code>--semi-red-9</code>ï¼ˆæ·±çº¢è‰²ï¼‰ï¼Œè¦†ç›–äº†ä¸åŒæ˜åº¦çš„éœ€æ±‚ã€‚åŒæ—¶ï¼ŒSemi Designå®šä¹‰äº†åŠŸèƒ½é¢œè‰²Tokenï¼Œå¦‚<code>color-primary</code>ï¼ˆä¸»è‰²ï¼‰ã€<code>color-error</code>ï¼ˆé”™è¯¯è‰²ï¼‰ç­‰ï¼Œè¿™äº›Tokenå¯ä»¥åŸºäºè‰²ç›¸-æ˜åº¦Tokenè¿›è¡Œå®šä¹‰ï¼Œå®ç°çµæ´»çš„è°ƒæ•´å’Œæ›´æ–°ã€‚</p>
<p>Semi Designçš„æ’ç‰ˆç³»ç»Ÿé¢„è®¾äº†ä»12pxåˆ°32pxçš„å®Œæ•´å­—å·ä½“ç³»ï¼Œä»¥åŠè½»ï¼ˆ200ï¼‰ã€å¸¸è§„ï¼ˆ400ï¼‰ã€ç²—ï¼ˆ600ï¼‰ä¸‰ç§å­—é‡  ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-css" lang="css">$<span class="hljs-attribute">font-size</span>-small : <span class="hljs-number">12px</span>;       // è¾…åŠ©æ–‡æœ¬
$<span class="hljs-attribute">font-size</span>-regular : <span class="hljs-number">14px</span>;     // æ­£æ–‡
$<span class="hljs-attribute">font-size</span>-<span class="hljs-selector-tag">header</span>-<span class="hljs-number">6</span> : <span class="hljs-number">16px</span>;    // å°æ ‡é¢˜
$<span class="hljs-attribute">font-weight</span>-bold : <span class="hljs-number">600</span>;       // å¼ºè°ƒæ–‡æœ¬
</code></pre>
<p>é—´è·ä¸å°ºå¯¸ç³»ç»Ÿåˆ™æä¾›äº†ä»2pxåˆ°40pxçš„æ ‡å‡†åŒ–é—´è·  ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$spacing</span>é¢å®šå€¼ï¼š<span class="hljs-number">4</span>px;    <span class="hljs-comment">// ç´§å‡‘å†…è¾¹è·</span>
<span class="hljs-variable">$spacing</span>é¢å®šå€¼ï¼š<span class="hljs-number">16</span>px;          <span class="hljs-comment">// é»˜è®¤é—´è·</span>
<span class="hljs-variable">$height</span>-control-<span class="hljs-keyword">default</span> : <span class="hljs-number">32</span>px;  <span class="hljs-comment">// æŒ‰é’®/è¾“å…¥æ¡†é»˜è®¤é«˜åº¦</span>
</code></pre>
<p>ç‰¹æ®ŠTokenå¦‚z-indexå±‚çº§ç³»ç»Ÿç¡®ä¿äº†å¼¹çª—ç»„ä»¶çš„æ­£ç¡®æ˜¾ç¤º  ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">$z-modal : <span class="hljs-number">1000</span>;        <span class="hljs-regexp">//</span> æ¨¡æ€æ¡†å±‚çº§
$z-tooltip : <span class="hljs-number">1060</span>;      <span class="hljs-regexp">//</span> æç¤ºæ¡†å±‚çº§ï¼ˆé«˜äºæ¨¡æ€æ¡†ï¼‰
</code></pre>
<p>Semi Designçš„Tokenå®ç°è¿˜æ”¯æŒåŠ¨æ€ä¸»é¢˜åˆ‡æ¢ï¼Œé€šè¿‡è¦†ç›–å˜é‡çš„æ–¹å¼å®ç°æ˜æš—æ¨¡å¼çš„åˆ‡æ¢ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// æ›´æ”¹ä¸»è‰²è°ƒä¸ºä¼ä¸šè“</span>
--semi-color-primary : <span class="hljs-number">0</span>, <span class="hljs-number">149</span>, <span class="hljs-number">238</span>;

<span class="hljs-comment">// å¢å¤§æŒ‰é’®é«˜åº¦</span>
$height-control-<span class="hljs-keyword">default</span> : <span class="hljs-number">36</span>px;
</code></pre>
<p>é€šè¿‡ConfigProvideråº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ConfigProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@douyinfe/semi-ui'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./custom-theme.scss'</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ConfigProvider</span> <span class="hljs-attr">themeMode</span>=<span class="hljs-string">"dark"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ConfigProvider</span>&gt;</span></span>;
</code></pre>
<p>Semi Designçš„Tokenå®ç°å±•ç¤ºäº†å¦‚ä½•é€šè¿‡åˆ†å±‚ç»“æ„å’ŒæŠ½è±¡åŒ–è®¾è®¡å®ç°é«˜åº¦ä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä¸ºè®¾è®¡ç³»ç»Ÿæä¾›äº†è‰¯å¥½çš„å‚è€ƒã€‚</p>
<h3 data-id="heading-7">å…«ã€æœªæ¥è¶‹åŠ¿ä¸å‘å±•æ–¹å‘</h3>
<p>Design TokensæŠ€æœ¯ä»åœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ï¼Œæœªæ¥å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹è¶‹åŠ¿ï¼š</p>
<p><strong>AIè¾…åŠ©Tokenç®¡ç†</strong>ï¼šéšç€AIæŠ€æœ¯çš„å‘å±•ï¼Œæœªæ¥å¯èƒ½ä¼šå‡ºç°AIè¾…åŠ©çš„Tokenç®¡ç†ç³»ç»Ÿï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«è®¾è®¡ä¸­çš„è§†è§‰å…ƒç´ å¹¶ç”Ÿæˆå¯¹åº”çš„Tokenï¼Œæˆ–æ ¹æ®ç”¨æˆ·åé¦ˆè‡ªåŠ¨è°ƒæ•´Tokenå€¼ï¼Œæé«˜è®¾è®¡æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>è·¨å¹³å°Tokenæ ‡å‡†</strong>ï¼šç›®å‰å„å¹³å°å’Œæ¡†æ¶çš„Tokenå®ç°å„ä¸ç›¸åŒï¼Œæœªæ¥å¯èƒ½ä¼šå‡ºç°è·¨å¹³å°çš„Tokenæ ‡å‡†ï¼Œä½¿è®¾è®¡Tokenèƒ½å¤Ÿåœ¨ä¸åŒå¹³å°å’Œæ¡†æ¶ä¹‹é—´æ— ç¼è½¬æ¢å’Œä½¿ç”¨ï¼Œæé«˜è·¨å¹³å°åº”ç”¨çš„ä¸€è‡´æ€§å’Œå¼€å‘æ•ˆç‡ã€‚</p>
<p><strong>åŠ¨æ€Tokenç³»ç»Ÿ</strong>ï¼šæœªæ¥çš„Design Tokenså¯èƒ½ä¼šæ›´åŠ åŠ¨æ€ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·åå¥½ã€ç¯å¢ƒæ¡ä»¶æˆ–ä¸šåŠ¡éœ€æ±‚è‡ªåŠ¨è°ƒæ•´Tokenå€¼ï¼Œå®ç°æ›´åŠ ä¸ªæ€§åŒ–å’Œè‡ªé€‚åº”çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p><strong>Tokenä¸è®¾è®¡åŸåˆ™çš„ç»“åˆ</strong>ï¼šDesign Tokenså¯èƒ½ä¼šä¸è®¾è®¡åŸåˆ™ï¼ˆå¦‚ä¸€è‡´æ€§ã€ç®€æ´æ€§ã€å¯è®¿é—®æ€§ç­‰ï¼‰æ›´åŠ ç´§å¯†åœ°ç»“åˆï¼Œé€šè¿‡Tokençš„å®šä¹‰å’Œä½¿ç”¨ç›´æ¥ä½“ç°è®¾è®¡åŸåˆ™ï¼Œç¡®ä¿è®¾è®¡ç³»ç»Ÿç¬¦åˆäº§å“å®šä½å’Œç”¨æˆ·ä½“éªŒç›®æ ‡  ã€‚</p>
<p><strong>Tokenä¸ç»„ä»¶çš„æ·±åº¦é›†æˆ</strong>ï¼šæœªæ¥çš„ç»„ä»¶åº“å¯èƒ½ä¼šæ›´åŠ æ·±åº¦é›†æˆDesign Tokensï¼Œä½¿Tokençš„ä¿®æ”¹èƒ½å¤Ÿç›´æ¥å½±å“ç»„ä»¶çš„å¤–è§‚å’Œè¡Œä¸ºï¼Œå®ç°æ›´åŠ çµæ´»å’Œå¯å®šåˆ¶çš„è®¾è®¡ç³»ç»Ÿã€‚</p>
<h3 data-id="heading-8">ä¹ã€æ€»ç»“ä¸å»ºè®®</h3>
<p><strong>Design Tokensæ˜¯ç°ä»£è®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œé€šè¿‡å°†è§†è§‰è®¾è®¡å…ƒç´ æŠ½è±¡ä¸ºå¯ç®¡ç†çš„å˜é‡ï¼Œå®ç°äº†è®¾è®¡ä¸å¼€å‘çš„æ— ç¼åä½œå’Œä¸€è‡´çš„ç”¨æˆ·ä½“éªŒ</strong>  ã€‚å®ƒä»¬ä¸ä»…æé«˜äº†å·¥ä½œæ•ˆç‡ï¼Œè¿˜é™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œæ”¯æŒäº†åŠ¨æ€ä¸»é¢˜å’Œå¤šå“ç‰Œåœºæ™¯ã€‚</p>
<p>å¯¹äºå¸Œæœ›å®æ–½Design Tokensçš„å›¢é˜Ÿï¼Œå»ºè®®ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p>
<p>é¦–å…ˆï¼Œ<strong>å»ºç«‹è·¨èŒèƒ½å›¢é˜Ÿ</strong>ï¼Œç¡®ä¿è®¾è®¡ã€å¼€å‘å’Œäº§å“å›¢é˜Ÿå…±åŒå‚ä¸Design Tokensçš„è®¾è®¡å’Œå®æ–½ï¼Œå½¢æˆç»Ÿä¸€çš„ç†è§£å’Œè§„èŒƒ  ã€‚</p>
<p>å…¶æ¬¡ï¼Œ<strong>é‡‡ç”¨æ¸è¿›å¼å®æ–½ç­–ç•¥</strong>ï¼Œå…ˆä»æ ¸å¿ƒç»„ä»¶å’Œé«˜é¢‘ä½¿ç”¨çš„è®¾è®¡å…ƒç´ å¼€å§‹ï¼Œé€æ­¥æ‰©å±•åˆ°æ•´ä¸ªè®¾è®¡ç³»ç»Ÿï¼Œé¿å…ä¸€æ¬¡æ€§å®æ–½å¸¦æ¥çš„å¤æ‚æ€§å’Œé˜»åŠ›  ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œ<strong>å»ºç«‹å®Œå–„çš„å‘½åè§„åˆ™å’Œåˆ†ç±»ä½“ç³»</strong>ï¼Œç¡®ä¿Tokençš„è¯­ä¹‰åŒ–ã€ä¸€è‡´æ€§å’Œå¯è¯»æ€§ï¼Œä¸ºå›¢é˜Ÿåä½œå’Œé•¿æœŸç»´æŠ¤å¥ å®šåŸºç¡€  ã€‚</p>
<p>æœ€åï¼Œ<strong>åˆ©ç”¨å·¥å…·é“¾ç®€åŒ–å®æ–½è¿‡ç¨‹</strong>ï¼Œé€‰æ‹©é€‚åˆå›¢é˜Ÿçš„è®¾è®¡å·¥å…·ã€è½¬æ¢å·¥å…·å’Œå¼€å‘æ¡†æ¶ï¼Œæé«˜å®æ–½æ•ˆç‡å’Œè´¨é‡ã€‚</p>
<p>é€šè¿‡åˆç†è®¾è®¡å’Œå®æ–½Design Tokensï¼Œå›¢é˜Ÿå¯ä»¥å»ºç«‹æ›´åŠ é«˜æ•ˆã€ä¸€è‡´å’Œå¯ç»´æŠ¤çš„è®¾è®¡ç³»ç»Ÿï¼Œä¸ºäº§å“çš„é•¿æœŸå‘å±•å’Œç”¨æˆ·ä½“éªŒæå‡æä¾›æœ‰åŠ›æ”¯æŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ«æ‰‹åŠ¨éƒ¨ç½²ï¼Docker + Drone å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—]]></title>    <link>https://juejin.cn/post/7575413146922876943</link>    <guid>https://juejin.cn/post/7575413146922876943</guid>    <pubDate>2025-11-24T02:56:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575413146922876943" data-draft-id="7574671792997482531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ«æ‰‹åŠ¨éƒ¨ç½²ï¼Docker + Drone  å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,CI/CD,Docker"/> <meta itemprop="datePublished" content="2025-11-24T02:56:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¥¿ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/1372654389433496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ«æ‰‹åŠ¨éƒ¨ç½²ï¼Docker + Drone  å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1372654389433496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¥¿ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:56:53.000Z" title="Mon Nov 24 2025 02:56:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;position:relative;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;padding-left:8px;padding-bottom:0;margin-top:35px;margin-bottom:10px;font-weight:900;font-family:serif;letter-spacing:1px;color:#000}.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover{background-color:#fff}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;position:relative}.markdown-body h2:after{content:"";left:0;bottom:0;width:100%;height:1px;position:absolute}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{height:1px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#37b2ff 0,#37b2ff 25%,transparent 50%)}.markdown-body code{margin:0 4px;word-break:break-word;overflow-x:auto;background-color:#fff7f7;color:#f06;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:-apple-system,system-ui,Menlo,Monaco,Consolas,Courier New;position:relative}.markdown-body pre{margin:15px 8px;border:1px solid #f5f5f7;line-height:1.75}.markdown-body pre:before{top:-4px;left:-4px;border-top:8px solid #feea1e;border-left:8px solid #feea1e}.markdown-body pre:after,.markdown-body pre:before{width:20px;height:20px;content:"";z-index:10;position:absolute}.markdown-body pre:after{right:-4px;bottom:-4px;border-right:8px solid #37b2ff;border-bottom:8px solid #37b2ff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;overflow-x:auto;margin:0;word-break:normal;display:block;color:#333;background-color:#fff;position:unset!important}.markdown-body pre:nth-child(odd):before{border-top-color:#a7ecad;border-left-color:#a7ecad}.markdown-body pre:nth-child(odd):after{border-right-color:#e699e6;border-bottom-color:#e699e6}.markdown-body a{margin:0 4px;text-decoration:none;color:#37b2ff;transition:.3s;display:inline-block;vertical-align:bottom;position:relative}.markdown-body a:before{content:"READ MORE +";bottom:90%;width:120px;max-width:0;color:#fff;background-color:#1fb3ff;position:absolute;white-space:nowrap;transition:.3s;box-sizing:border-box;pointer-events:none;overflow:hidden}.markdown-body a:after{content:"";bottom:0;left:0;width:100%;height:1px;border-bottom:1px dashed #37b2ff;position:absolute}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:120px;padding-left:14px}.markdown-body table{width:100%;max-width:100%;font-size:12px;background-color:#fff;overflow:auto;border-collapse:collapse}.markdown-body table tr:hover td,.markdown-body table tr:hover th{border-bottom:1px solid #feea1e}.markdown-body thead{text-align:left}.markdown-body th{font-size:1.2em;border-bottom:1px dashed #eee}.markdown-body tr:nth-child(2n){background-color:hsla(0,0%,87.8%,.1);border-bottom:1px solid #fff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px;border-bottom:1px dashed #fff}.markdown-body blockquote{color:#666;padding:12px 23px 2px;border:1px solid #37b2ff;background-color:#fff;margin:22px 0;position:relative}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body blockquote:after{content:"FROM";left:0;width:40px;color:#fff;background-color:#37b2ff;text-align:center}.markdown-body blockquote:after,.markdown-body blockquote:before{top:0;line-height:1;padding:2px 0;font-size:12px;font-weight:lighter;position:absolute;pointer-events:none}.markdown-body blockquote:before{content:"CITATION";left:44px;color:#37b2ff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{line-height:2em;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#37b2ff}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol ol li,.markdown-body ol ul li,.markdown-body ul ol li,.markdown-body ul ul li{border-bottom:none}.markdown-body ol li{padding-left:6px;list-style:decimal-leading-zero}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{position:relative}.markdown-body input[type=checkbox]:before{top:0;left:0;right:0;bottom:0;content:"";width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1;position:absolute}.markdown-body input[type=checkbox]:checked:after{content:"";top:10%;left:18%;width:90%;height:40%;border-left:2px solid #37b2ff;border-bottom:2px solid #37b2ff;color:#37b2ff;z-index:2;transform:rotate(-45deg);position:absolute}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>ä½†è¡Œå¥½äº‹ï¼Œè«é—®å‰ç¨‹</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡ä¸åªæ˜¯é…ç½®æ–‡ä»¶çš„å †ç Œï¼Œä¹Ÿè§£é‡Šæ˜¯ä»€ä¹ˆå’Œä¸ºä»€ä¹ˆï¼Œå¸Œæœ›å¤§å®¶èƒ½è€å¿ƒå­¦ä¹ ğŸ˜½ã€‚</p>
<p>ç°åœ¨çš„é¡¹ç›®å¤§å¤šé€šè¿‡å„ç§ <strong><code>CI/CDå·¥å…·</code></strong>ï¼ˆä¾‹å¦‚è‘—åçš„ <code>Jenkins</code>ã€ <code>gitLab</code>ï¼Œgithubæ¨å‡ºçš„ <code>github actions</code>ï¼‰æ¥è¿›è¡Œ <strong>è‡ªåŠ¨åŒ–éƒ¨ç½²</strong>ã€‚</p>
<p>å®ƒä»¬å·²æˆä¸ºå¸‚åœºä¸»æµï¼Œæ˜¯é¡¹ç›®åŸºå»ºä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚</p>
<p>å¼€å‘äººå‘˜åªéœ€å¼€å‘å®Œæˆåï¼Œä¸€ä¸ªä»£ç æ¨é€/åˆå¹¶ï¼Œé¡¹ç›®ä¾¿ä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå‘ˆç°ç»™ç”¨æˆ·ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a79b8131aba479eafd980194cea7620~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=r5GUEKRNpdmTh7BIrY06qiNJojI%3D" alt="dronev.gif" loading="lazy"/></p>
<blockquote>
<p><strong>æŒç»­éƒ¨ç½²ï¼ˆContinuous Deploymentï¼ŒCDï¼‰ï¼š</strong></p>
<ul>
<li>æŒ‡è‡ªåŠ¨åŒ–éƒ¨ç½²å·²é€šè¿‡æµ‹è¯•çš„ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒï¼Œä»¥å®ç°å¿«é€Ÿã€å¯é çš„è½¯ä»¶äº¤ä»˜ã€‚</li>
<li>CD æµç¨‹åŒ…æ‹¬è‡ªåŠ¨åŒ–æ„å»ºéƒ¨ç½²æµç¨‹ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€ç¯å¢ƒé…ç½®ç®¡ç†ç­‰æ­¥éª¤ï¼Œä»¥ç¡®ä¿éƒ¨ç½²çš„è½¯ä»¶è´¨é‡å’Œç¨³å®šæ€§ã€‚</li>
<li>ç›®çš„æ˜¯ç¼©çŸ­è½¯ä»¶äº¤ä»˜å‘¨æœŸï¼Œé™ä½éƒ¨ç½²é£é™©ï¼Œæé«˜éƒ¨ç½²çš„å¯é‡å¤æ€§å’Œä¸€è‡´æ€§</li>
</ul>
</blockquote>
<p>ç›¸æ¯”äºå¤æ—©ç¼“æ…¢ä¸”å……æ»¡é£é™©çš„æ‰‹åŠ¨éƒ¨ç½²ï¼Œå®ƒä»¬èƒ½å°†é¡¹ç›® <strong>è‡ªåŠ¨åŒ–çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒä»¥å®ç°äº¤ä»˜çš„é«˜è´¨é‡å’Œæ•ˆç‡</strong>ã€‚</p>
<p>æ— è®ºä½ æ˜¯ä»€ä¹ˆæ–¹å‘çš„å¼€å‘è€…ï¼Œå­¦ä¹ +ä½¿ç”¨å®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæå…·æ€§ä»·æ¯”çš„é€‰æ‹©ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ­å»ºè‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ï¼Œå¦‚æœå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œ<strong>è¿˜æœ›ç‚¹èµã€æ”¶è—ã€å…³æ³¨ä¸‰è¿ğŸ˜½ã€‚</strong></p>
<h2 data-id="heading-1">ç®€ä»‹</h2>
<p>æœ¬æ–‡è¦åˆ†äº«çš„æ˜¯åèµ·ä¹‹ç§€ <strong><code>Drone</code></strong>ï¼Œå®ƒå…è´¹ã€è½»é‡ã€ç®€æ´ã€æ”¯æŒç§æœ‰åŒ–ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒçš„ <strong><code>yamlå†™æ³•</code></strong> å’Œ <strong><code>pipelineæµæ°´çº¿</code></strong> éå¸¸é€‚åˆå¯¹è¿ç»´é™Œç”Ÿçš„åŒå­¦å»ç†è§£ç›¸å…³æµç¨‹ã€‚</p>
<blockquote>
<p>å¦‚æœå¯¹ linux å’Œ docker ä¸ç†Ÿæ‚‰çš„åŒå­¦éœ€è¦å…ˆç®€å•äº†è§£ç›¸å…³çŸ¥è¯†ï¼Œæœ¬æ–‡ä½¿ç”¨ docker compose æ¥ç¼–æ’å®¹å™¨ã€‚</p>
</blockquote>
<p><strong><code>Drone</code></strong> æ·±åº¦é›†æˆäº†å¤šä¸ª SCM ç½‘ç«™ï¼ŒåŒ…æ‹¬ GitHubã€GitLabã€Giteeç­‰ã€‚å®ƒçš„æ¯ä¸ªæ„å»ºéƒ½åœ¨ä¸€ä¸ªéš”ç¦»çš„ Docker å®¹å™¨ä¸­è¿è¡Œï¼›å¦å¤–å®ƒä¹Ÿæ”¯æŒæ’ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä½ ç†ŸçŸ¥çš„è¯­è¨€è½»æ¾çš„æ‰©å±•å®ƒä»¬ã€‚</p>
<p>å½“å‰ä¸€åˆ‡éƒ½éƒ¨ç½²å¥½åï¼Œåªéœ€åœ¨ä»£ç ä»“åº“ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæè¿°æ–‡ä»¶ <strong><code>.drone.yml</code></strong>ï¼Œå°±å¯ä»¥å®Œæˆ CI/CD é…ç½®ã€‚</p>
<p><strong><code>Drone</code></strong> éœ€è¦åˆ›å»ºä¸¤ä¸ªå®¹å™¨</p>
<ul>
<li><strong><code>Server</code></strong>: è´Ÿè´£ä»»åŠ¡è°ƒåº¦ã€æä¾›è§†å›¾ã€ç”¨æˆ·æƒé™é…ç½® . . .</li>
<li><strong><code>Runner</code></strong>: æ‰§è¡Œ Pipeline å…·ä½“ä»»åŠ¡ã€åˆ›å»ºéš”ç¦»çš„å®¹å™¨ç¯å¢ƒã€ä¸ŠæŠ¥æ—¥å¿—å’ŒçŠ¶æ€ . . .</li>
</ul>
<h2 data-id="heading-2">æµç¨‹ &amp; æ–‡æ¡£</h2>
<p>æˆ‘ä½¿ç”¨çš„æœåŠ¡å™¨ï¼š4æ ¸4G - CentOS - 40G SSD ï¼ˆå…¶å®2æ ¸2Gå³å¯ï¼ŒDroneèµ„æºå ç”¨å¾ˆå°‘ï¼‰</p>
<p><strong>æ­å»ºè‡ªåŠ¨åŒ–éƒ¨ç½²çš„æµç¨‹å¦‚ä¸‹</strong>ï¼š</p>
<ol>
<li>é…ç½® <code>Github - OAuth Application</code></li>
<li>å®‰è£…ã€é…ç½® <code>Docker</code>ã€<code>Drone Server</code>ã€<code>Drone Runner</code></li>
<li>ç¼–å†™ <code>docker-compose.yml</code> ç¼–æ’å®¹å™¨ï¼Œç”¨äºç®¡ç† <code>Drone Server</code>ã€<code>Drone Runner</code></li>
<li>äº†è§£ <code>pipeline</code>ï¼Œäº†è§£å¸¸ç”¨æ’ä»¶ï¼Œåœ¨ä»£ç ä»“åº“ä¸­åŠ å…¥ <code>.drone.yml</code></li>
<li>æ¨é€ä»£ç æµ‹è¯•æ‰“åŒ…æ•ˆæœ</li>
</ol>
<p><strong>ç›¸å…³æ–‡æ¡£</strong>ï¼š</p>
<p>drone server æœåŠ¡ç«¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Fserver%2Foverview%2F" target="_blank" title="https://docs.drone.io/server/overview/" ref="nofollow noopener noreferrer">docs.drone.io/server/overâ€¦</a></p>
<p>drone runer linux <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Frunner%2Fdocker%2Finstallation%2Flinux%2F" target="_blank" title="https://docs.drone.io/runner/docker/installation/linux/" ref="nofollow noopener noreferrer">docs.drone.io/runner/dockâ€¦</a></p>
<p>drone pieline é…ç½® <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Fpipeline%2Foverview%2F" target="_blank" title="https://docs.drone.io/pipeline/overview/" ref="nofollow noopener noreferrer">docs.drone.io/pipeline/ovâ€¦</a></p>
<p>drone plugins <a href="https://link.juejin.cn?target=https%3A%2F%2Fplugins.drone.io%2F" target="_blank" title="https://plugins.drone.io/" ref="nofollow noopener noreferrer">plugins.drone.io/</a></p>
<p><strong>å¸¸ç”¨æŒ‡ä»¤</strong>:</p>
<p><code>docker compose down &lt;image-name&gt;</code> å…³é—­æŒ‡å®šå®¹å™¨ï¼ˆä¸æŒ‡å®šåˆ™é»˜è®¤æ‰€æœ‰ï¼‰</p>
<p><code>docker compose up -d &lt;image-name&gt;</code> å¯åŠ¨æŒ‡å®šå®¹å™¨ï¼ˆä¸æŒ‡å®šåˆ™é»˜è®¤æ‰€æœ‰ï¼‰</p>
<p><code>docker compose logs -f &lt;image-name&gt;</code> æ‰“å°å®¹å™¨çš„æ—¥å¿—</p>
<p><code>docker compose exec &lt;image-name&gt; bash</code> è¿›å…¥æŒ‡å®šå®¹å™¨çš„shell</p>
<p><code>docker ps</code> æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p>
<p><code>docker images</code> æŸ¥çœ‹ä¸‹è½½çš„é•œåƒ</p>
<p><code>netstat -tulnp</code> æ˜¾ç¤ºè¿›ç¨‹ä¸å ç”¨çš„ç«¯å£</p>
<h2 data-id="heading-3">å®è·µ</h2>
<h3 data-id="heading-4">Github OAuth</h3>
<p><strong><code>GitHub OAuth</code></strong> çš„ä½œç”¨æ˜¯ï¼š <strong>"è®©ç”¨æˆ·å®‰å…¨åœ°æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ä»£è¡¨è‡ªå·±æ‰§è¡Œç‰¹å®šæ“ä½œ"</strong> ã€‚</p>
<p>åœ¨Droneçš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œå®ƒæä¾›äº†ï¼š</p>
<ul>
<li><strong>ğŸ” å®‰å…¨ç™»å½•</strong>Â - ä¸ç”¨ä¸ºDroneå•ç‹¬åˆ›å»ºè´¦å·</li>
<li><strong>ğŸ”„ è‡ªåŠ¨åŒæ­¥</strong>Â - Droneè‡ªåŠ¨è·å–ä½ çš„ä»“åº“åˆ—è¡¨</li>
<li><strong>âš¡ è‡ªåŠ¨è§¦å‘</strong>Â - Droneæœ‰æƒé™è®¾ç½®webhookï¼Œä»£ç æ¨é€å³è§¦å‘æ„å»º</li>
<li><strong>ğŸ¯ æƒé™å¯æ§</strong>Â - ä½ å¯ä»¥éšæ—¶åœ¨GitHubä¸Šæ’¤é”€Droneçš„è®¿é—®æƒé™</li>
</ul>
<h4 data-id="heading-5">é…ç½®</h4>
<ol>
<li>
<p><strong>å¤´åƒ -&gt; Settings -&gt;  Developer settings -&gt; OAuth Apps -&gt; New OAuth App</strong></p>
</li>
<li>
<p>å¡«å†™é¡¹ç›®å</p>
</li>
<li>
<p><strong>HomePage URL</strong> â€”â€” Githubå…è®¸è°ƒç”¨ç™»å½•çš„URLï¼Œæˆ‘ä»¬è®¾ç½®ä¸ºdrone serverè¿è¡Œçš„ç«¯å£</p>
</li>
<li>
<p><strong>Authorization callback URL</strong> â€”â€” è®¤è¯æˆåŠŸåçš„å›è°ƒç½‘å€ï¼Œåœ¨droneé‡Œä¸º url + /login</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e303ae18cc5d4554bb346a6b6af7f3f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=cnNjpw9HtUrATvjVFnwbRn3TiTE%3D" alt="QQ_1763938534023.png" loading="lazy"/></p>
<ol start="5">
<li>ç‚¹å‡» New Secret</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7268310620a4d2bbd289d3db94cf080~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=%2BCB7PDe4edyCZ5BRs2bs56fj2uA%3D" alt="QQ_1763939334557.png" loading="lazy"/></p>
<ol start="6">
<li>æ‹¿åˆ° <strong><code>Client ID</code></strong> å’Œ <strong><code>Client Secret</code></strong>ï¼Œè®°å½•ä¸‹æ¥ï¼åç»­ç”¨äº Drone çš„é…ç½®</li>
</ol>
<blockquote>
<p>127.0.0.1 åªä¸ºé¢„è®¾ï¼Œå®é™…ä½¿ç”¨æ—¶è¯·æ›¿æ¢ä¸ºè‡ªå·±çš„çœŸå®åŸŸå æˆ– IP+ç«¯å£</p>
</blockquote>
<h3 data-id="heading-6">Docker</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…docker</span>
sudo dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

<span class="hljs-comment"># å¯åŠ¨æŒ‡ä»¤</span>
sudo systemctl start docker
sudo systemctl <span class="hljs-built_in">enable</span> docker

<span class="hljs-comment"># æµ‹è¯•æŒ‡ä»¤</span>
sudo docker run hello-world

<span class="hljs-comment"># é…ç½®é•œåƒåŠ é€Ÿ + é‡å¯æœåŠ¡ </span>
sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">'EOF'</span>
{
  <span class="hljs-string">"registry-mirrors"</span>: [
    <span class="hljs-string">"https://registry.docker-cn.com"</span>,
    <span class="hljs-string">"https://docker.mirrors.ustc.edu.cn"</span>,
    <span class="hljs-string">"https://hub-mirror.c.163.com"</span>
  ]
}
EOF

<span class="hljs-comment"># é‡å¯æœåŠ¡</span>
sudo systemctl restart docker

</code></pre>
<p>é•œåƒåŠ é€Ÿéƒ¨åˆ†ï¼Œä¸ªäººæœåŠ¡å™¨è®¿é—® "<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocker.1ms.run" target="_blank" title="https://docker.1ms.run" ref="nofollow noopener noreferrer">docker.1ms.run</a>" æœ€å¿«ï¼Œå¤§å®¶ç»“åˆè‡ªèº«æƒ…å†µé…ç½®</p>
<h4 data-id="heading-7">Docker Compose</h4>
<p><strong><code>Docker Compose</code></strong> å¯ä»¥<code>å®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨</code>åº”ç”¨çš„å·¥å…·ã€‚å®ƒå…è®¸ä½ ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ï¼ˆé€šå¸¸ç§°ä¸º docker-compose.ymlï¼‰æ¥é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œç„¶åä½¿ç”¨è¯¥æ–‡ä»¶å¿«é€Ÿå¯åŠ¨æ•´ä¸ªåº”ç”¨çš„æ‰€æœ‰æœåŠ¡ã€‚</p>
<h3 data-id="heading-8">Drone</h3>
<p>ä½¿ç”¨dockerå®‰è£…droneçš„ä¸¤ä¸ªå®¹å™¨ï¼ŒServerç«¯ - æ§åˆ¶è°ƒåº¦å’Œæä¾›è§†å›¾ï¼ŒRunner ç«¯ - æ‰§è¡Œæµæ°´çº¿å’Œä¸ŠæŠ¥çŠ¶æ€</p>
<pre><code class="hljs language-bash" lang="bash">docker pull drone/drone:latest 
docker pull drone/drone-runner-docker:latest
</code></pre>
<p>åŒæ—¶åˆ›å»ºä¸€ä¸ªå…±äº«å¯†é’¥ï¼Œç”¨äº  Server å’Œ  Runner ä¹‹é—´çš„é€šä¿¡è®¤è¯ï¼Œä½¿ç”¨æ­¤å¯†é’¥å¡«å……ç¯å¢ƒå˜é‡ <code>DRONE_RPC_SECRET</code></p>
<pre><code class="hljs language-bash" lang="bash">openssl rand -hex 16
c1da0391axxxxxxxxxxxxxxxxx
</code></pre>
<h4 data-id="heading-9">drone-server</h4>
<p><code>/opt/docker/docker-compose.yml</code></p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">services:</span>
  <span class="hljs-comment"># drone æœåŠ¡ç«¯</span>
  <span class="hljs-attr">drone-server:</span> 
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">drone-server</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">drone/drone:latest</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-comment">#  ç«¯å£æ˜ å°„</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8082</span><span class="hljs-string">:80</span>  
      <span class="hljs-bullet">-</span> <span class="hljs-number">4443</span><span class="hljs-string">:443</span>

    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># æŒ‚è½½æ•°æ®ç›®å½•ï¼ŒæŒä¹…åŒ– Drone çš„é…ç½®ä¿¡æ¯å’Œæ•°æ®åº“</span>
	<span class="hljs-comment"># å®¹å™¨ /data ç›®å½• -&gt; å®¿ä¸»æœºå½“å‰ ./drone-data ç›®å½•</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./drone-data:/data</span>

    <span class="hljs-attr">environment:</span>
      <span class="hljs-comment"># Git OAuth - Client ID</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_GITHUB_CLIENT_ID=Ov23lxxxxxxxxx</span>
      <span class="hljs-comment"># Git OAuth - Client Secret</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_GITHUB_CLIENT_SECRET=d60645938xxxxxxxxxxxxxxxxxxxxx</span>
      <span class="hljs-comment"># Drone Server å’Œ Runner ä¹‹é—´çš„ RPC è®¤è¯å¯†é’¥ï¼Œéœ€ä¿æŒä¸€è‡´</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_SECRET=c1da0391axxxxxxxxxxxxxxxxx</span>
      <span class="hljs-comment"># Drone Serverçš„å…¬ç½‘åœ°å€</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_SERVER_HOST=&lt;æœåŠ¡å™¨çš„å…¬ç½‘IP&gt;:&lt;ç«¯å£&gt;</span>
      <span class="hljs-comment"># é€šä¿¡åè®®</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_SERVER_PROTO=http</span>
      <span class="hljs-comment"># åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_USER_CREATE=username:XiwE1,admin:true</span>
</code></pre>
<ul>
<li>
<p><strong>ports</strong> - ä¸ºå®¿ä¸»æœºä¸å®¹å™¨çš„ç«¯å£æ˜ å°„</p>
</li>
<li>
<p><strong>DRONE_GITHUB_CLIENT_ID</strong> å’Œ <strong>DRONE_GITHUB_CLIENT_SECRET</strong></p>
<ul>
<li>å¯¹åº”ä¸Šæ–‡ <code>Git OAuth</code> çš„ <code>Client ID</code> å’Œ <code>Client Secret</code>ï¼Œç”¨äºèº«ä»½è®¤è¯</li>
</ul>
</li>
<li>
<p><strong>DRONE_RPC_SECRET</strong> - æ˜¯åˆšåˆšç”Ÿæˆçš„å…±äº«å¯†é’¥ï¼Œç”¨äº Server ä¸ Runner é€šä¿¡</p>
</li>
<li>
<p><strong>DRONE_SERVER_HOST</strong> - æ”¹ä¸ºæœåŠ¡å™¨çš„çœŸå®IPå’Œè®¾ç½®è¿è¡Œçš„ç«¯å£</p>
</li>
<li>
<p><strong>DRONE_SERVER_PROTO</strong> - æˆ‘åªç”¨åˆ°äº† httpï¼Œå¦‚æœ‰è¯ä¹¦å¯è®¾ç½® https</p>
</li>
<li>
<p><strong>DRONE_USER_CREATE</strong> - è®¾ç½®è´¦æˆ·ï¼Œname ä¸º github è´¦å·å</p>
</li>
</ul>
<p>æ­¤æ—¶æˆ‘ä»¬å¯åŠ¨æœåŠ¡</p>
<p><code>docker compose up -d drone-server</code></p>
<p>è®¿é—®å¯¹åº”çš„å…¬ç½‘ç½‘å€ï¼Œå®Œæˆç™»å½•åï¼ˆè®°å¾—åœ¨Githubä¿®æ”¹ homepageURL + Authorization callback URLï¼‰,å³å¯çœ‹åˆ°è‡ªå·±ä»“åº“çš„æ‰€æœ‰é¡¹ç›®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4e1162e174241d8b28187bea7ef1f95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=A5c8UKTBP1inm9lSFnzMTU%2BFWWg%3D" alt="QQ_1763943162285.png" loading="lazy"/></p>
<p>æˆ‘ä»¬é€‰ä¸­ä¸€ä¸ªæµ‹è¯•é¡¹ç›®çš„è¿›è¡Œæ¿€æ´»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfe66f8cd2e46849e08554bbed908a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=61wBqRYc7FPzN%2BokC2u7ZsOFtMg%3D" alt="QQ_1763944058118.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ° github - é¡¹ç›® - webhooks å·²ç»æ¿€æ´»äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6387a67307fd4dd5a17351f7baa907e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=M4I29bF%2F0oaOERrUpmb%2BYKOWf7c%3D" alt="QQ_1763944228665.png" loading="lazy"/></p>
<p>å¯¹é¡¹ç›®è¿›è¡Œç®€å•çš„é…ç½® Trusted -&gt; SAVEã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ec677e54f914e3e95a0a9a21bdf5707~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=Z6GPIQG%2B%2BPp7ftTVtfu86t66Da0%3D" alt="QQ_1763945071913.png" loading="lazy"/></p>
<h4 data-id="heading-10">drone-runer</h4>
<p><code>/opt/docker/docker-compose.yml</code></p>
<pre><code class="hljs language-yml" lang="yml">  <span class="hljs-comment"># drone æ‰§è¡Œè€…ï¼ˆrunerï¼‰</span>
  <span class="hljs-attr">drone-runner:</span> 
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">drone-runner</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">drone/drone-runner-docker:latest</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">3000</span><span class="hljs-string">:3000</span>  

    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># å…è®¸ Runner åœ¨å®¿ä¸»æœºä¸Šæ“ä½œ Docker å®¹å™¨</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_PROTO=http</span>
      <span class="hljs-comment"># ä¸ drone server çš„container_nameä¸€è‡´</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_HOST=drone-server</span>
      <span class="hljs-comment"># Drone Server å’Œ Runner ä¹‹é—´çš„ RPC è®¤è¯å¯†é’¥ï¼Œéœ€ä¿æŒä¸€è‡´</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RPC_SECRET=c1da0391xxxxxxxxxxxxxxxx</span>
      <span class="hljs-comment"># è®¾ç½®å¹¶å‘ä»»åŠ¡æ•°ä¸Šé™</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RUNNER_CAPACITY=3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DRONE_RUNNER_NAME=drone-runner</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">drone-server</span>
</code></pre>
<ul>
<li><strong>volumes</strong> - runner æ‰§è¡Œæµæ°´çº¿æ—¶éœ€è¦ä¸æ–­åœ°åˆ›å»ºé•œåƒå®¹å™¨ï¼Œéœ€è¦å…è®¸å…¶æ“ä½œ Docker</li>
<li><strong>DRONE_RPC_HOST</strong> - åŒæœåŠ¡å™¨å¯å†…éƒ¨è®¿é—®ä½¿ç”¨ <code>container-name</code> å³å¯ï¼Œå¦‚æœè·¨æœåŠ¡å™¨è¯·å¡«å†™ Drone Server çš„åŸŸå æˆ– IP+ç«¯å£</li>
<li><strong>DRONE_RPC_SECRET</strong> - å…±äº«å¯†é’¥ï¼Œä¸Serverä¿æŒä¸€è‡´</li>
</ul>
<p>è‡ªåŠ¨æ„å»ºä¸éƒ¨ç½²ç­‰åŠŸèƒ½éƒ½ä¾èµ–äº Drone Runnerã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60f13afc47264c13b9f6dfe699541a6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=VCoBqvG0xk0ZVpRdAqT087b82OY%3D" alt="QQ_1763945783911.png" loading="lazy"/></p>
<h4 data-id="heading-11">pipeline &amp; .drone.yml</h4>
<blockquote>
<p>æµæ°´çº¿ï¼ˆPipelineï¼‰åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰ä¸­ï¼Œæ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–æµç¨‹ï¼Œå®ƒå°†è½¯ä»¶ä»ä»£ç åˆ°äº¤ä»˜çš„å¤šä¸ªæ­¥éª¤ä¸²è”èµ·æ¥ã€‚</p>
<p>æ¯ä¸ªæ­¥éª¤éƒ½ä¼šå®Œæˆä¸€ä¸ªç‰¹å®šçš„ä»»åŠ¡ï¼ˆä¾‹å¦‚ç¼–è¯‘ã€æµ‹è¯•ã€éƒ¨ç½²ï¼‰ï¼Œå¹¶ä¸”è¿™äº›æ­¥éª¤æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œæ•´ä¸ªæµç¨‹å°±ä¼šåœæ­¢ï¼Œä»è€Œä¿è¯è½¯ä»¶è´¨é‡ã€‚</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>Pipeline æ˜¯æŠŠæ‰‹åŠ¨é‡å¤çš„è½¯ä»¶å‘å¸ƒè¿‡ç¨‹ï¼Œå˜æˆå…¨è‡ªåŠ¨çš„æ ‡å‡†åŒ–æµæ°´çº¿</strong>ã€‚æ— éœ€äººå·¥å¹²é¢„ï¼Œæé«˜äº†æ•ˆç‡å¹¶å‡å°‘äº†äººä¸ºé”™è¯¯ã€‚</p>
<p>è€Œ <strong>YAML æ˜¯æµæ°´çº¿çš„ã€Œè¯´æ˜ä¹¦ã€ï¼Œè¯­æ³•æ˜“äºé˜…è¯»å’Œè¡¨è¾¾ï¼Œèƒ½ç”¨ç»“æ„åŒ–çš„æ–‡å­—æè¿°æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹</strong>ã€‚</p>
<p><code>Drone</code> é€šè¿‡åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ”¾ç½®Â <code>.drone.yml</code>Â æ–‡ä»¶æ¥é…ç½®æµæ°´çº¿ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1dbd577bf34c7f9a266c0fd58aaac0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=G%2F6b4ZDV5%2B8G8mio3mQIq%2B0pliE%3D" alt="QQ_1763947331160.png" loading="lazy"/></p>
<p>å…³äº <code>.drone.yml</code>Â æ–‡ä»¶ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li>æ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½ä»¥Â <code>kind: pipeline</code>Â å¼€å¤´</li>
<li>éœ€è¦æŒ‡å®š<strong>æ‰§è¡Œå™¨ç±»å‹</strong>ï¼Œä¾‹å¦‚Dockerï¼ˆ<code>type: docker</code>ï¼‰</li>
<li>éœ€è¦è®¾ç½® <strong>è§¦å‘æ¡ä»¶ï¼ˆTriggerï¼‰</strong>ï¼Œæ§åˆ¶ç®¡é“åœ¨<strong>ä½•æ—¶</strong>è¿è¡Œã€‚æœ€å¸¸ç”¨çš„æ˜¯ä»£ç çš„Â <code>push</code>Â äº‹ä»¶</li>
<li><strong>æ­¥éª¤ï¼ˆStepsï¼‰</strong>
<ul>
<li>ç®¡é“ç”±ä¸€ä¸ªæˆ–å¤šä¸ª<strong>æ­¥éª¤</strong>ç»„æˆï¼Œæ¯ä¸ªæ­¥éª¤ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼ˆä¾‹å¦‚å®‰è£…ä¾èµ–ã€æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ï¼‰ã€‚</li>
<li>æ¯ä¸ªæ­¥éª¤é€šå¸¸éœ€è¦æŒ‡å®šï¼š
<ul>
<li><strong>åç§°ï¼ˆnameï¼‰</strong> ï¼šæ­¥éª¤æ ‡è¯†ï¼Œä¾‹å¦‚ <code>build</code>ã€<code>deploy</code></li>
<li><strong>é•œåƒï¼ˆimageï¼‰</strong> ï¼šæ‰§è¡Œä»»åŠ¡çš„Dockeré•œåƒï¼Œè¿™å†³å®šäº†æ­¥éª¤çš„è¿è¡Œç¯å¢ƒ</li>
<li><strong>å‘½ä»¤ï¼ˆcommandsï¼‰</strong> ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œçš„Shellå‘½ä»¤åºåˆ—ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>æŒ‚è½½å·ï¼ˆVolumesï¼‰</strong> ï¼Œç”¨äºåœ¨æ­¥éª¤ä¹‹é—´<strong>æŒä¹…åŒ–æ•°æ®</strong>æˆ–ä¸å®¿ä¸»æœº<strong>å…±äº«æ–‡ä»¶</strong></li>
<li>...</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.drone.io%2Fpipeline%2Foverview%2F" target="_blank" title="https://docs.drone.io/pipeline/overview/" ref="nofollow noopener noreferrer">docs.drone.io/pipeline/ovâ€¦</a></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨stepsé‡Œé›†æˆæ’ä»¶ï¼Œdrone plugins <a href="https://link.juejin.cn?target=https%3A%2F%2Fplugins.drone.io%2F" target="_blank" title="https://plugins.drone.io/" ref="nofollow noopener noreferrer">plugins.drone.io/</a></p>
<p>ä¾‹å¦‚ ç”¨äºé€šçŸ¥æ„å»ºçŠ¶æ€çš„ slackï¼Œç”¨äºæ–‡ä»¶ä¼ è¾“çš„ rsyncï¼Œå‘å¸ƒèµ„æºåˆ°S3çš„ AWS S3/AWS S3 Syncï¼Œç­‰ç­‰ã€‚</p>
<p>æˆ‘çš„é¡¹ç›®ï¼ˆReact + Yarn + Viteï¼‰æ„å»ºé…ç½®å¦‚ä¸‹ï¼š</p>
<p><strong><code>./.drone.yml</code></strong></p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªç®¡é“</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">pipeline</span>
<span class="hljs-comment"># å®šä¹‰ç®¡é“ç±»å‹</span>
<span class="hljs-comment"># ä½¿ç”¨Dockeræ‰§è¡Œå™¨è¿è¡Œæµæ°´çº¿</span>
<span class="hljs-attr">type:</span> <span class="hljs-string">docker</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">default</span>

<span class="hljs-comment"># droneå¯åŠ¨æ—¶ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œcloneä»£ç æ“ä½œï¼Œå°†å¯¹åº”ä»“åº“ä»£ç æ‹‰å–åˆ°/drone/srcç›®å½•ä¸‹</span>
<span class="hljs-attr">clone:</span>
  <span class="hljs-comment"># é‡è¯•ä»¥é˜²ç½‘ç»œé—®é¢˜å¯¼è‡´cloneå¤±è´¥</span>
  <span class="hljs-attr">retries:</span> <span class="hljs-number">2</span>

<span class="hljs-attr">trigger:</span>
  <span class="hljs-attr">branch:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>

<span class="hljs-attr">volumes:</span>
    <span class="hljs-comment"># å°†node_modulesç¼“å­˜åˆ°å®¿ä¸»æœºæŒ‡å®šç›®å½•ä¸‹</span>
    <span class="hljs-comment"># é¿å…é‡æ–°installå»¶è¿Ÿæˆ–è€…å¤±è´¥</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">node_modules</span>
    <span class="hljs-attr">host:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/home/drone/cache/fe/node_modules</span>
  <span class="hljs-comment"># - name: pnpm-cache</span>
  <span class="hljs-comment">#   host:</span>
  <span class="hljs-comment">#     path: /home/drone/cache/fe/pnpm-store</span>
  <span class="hljs-comment"># æŒ‚è½½Dockerå¥—æ¥å­—</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">docker-sock</span>
    <span class="hljs-attr">host:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/var/run/docker.sock</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">admin-website</span>
    <span class="hljs-attr">host:</span>
      <span class="hljs-attr">path:</span> <span class="hljs-string">/home/admin-website</span>

<span class="hljs-attr">steps:</span>
  <span class="hljs-comment"># ç¼–è¯‘é˜¶æ®µ</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">build</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">node:23</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">node_modules</span>
        <span class="hljs-comment"># æŒ‚è½½åˆ°å®¹å™¨å†…çš„è·¯å¾„</span>
        <span class="hljs-comment"># å®¿ä¸»æœº node_modules -&gt; æŒ‚è½½åˆ°å®¹å™¨/drone/src/node_modulesç›®å½•</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">/drone/src/node_modules</span>
    <span class="hljs-comment">#   - name: pnpm-cache</span>
    <span class="hljs-comment">#     path: /drone/src/.pnpm-store</span>
    <span class="hljs-attr">commands:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"============æ„å»ºå‰çš„æ–‡ä»¶==============="</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">pwd</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ls</span> <span class="hljs-string">-alt</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"======================================"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">yarn</span> <span class="hljs-string">--version</span> <span class="hljs-string">||</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">yarn</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">yarn</span> <span class="hljs-string">install</span> <span class="hljs-string">--frozen-lockfile</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">yarn</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">echo</span> <span class="hljs-string">"============æ„å»ºåçš„äº§ç‰©==============="</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ls</span> <span class="hljs-string">-la</span> <span class="hljs-string">dist</span> <span class="hljs-string">||</span> <span class="hljs-string">exit</span> <span class="hljs-number">1</span>

  <span class="hljs-comment"># éƒ¨ç½²é˜¶æ®µ</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">deploy</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">drillster/drone-rsync</span>
    <span class="hljs-attr">network_mode:</span> <span class="hljs-string">host</span>  <span class="hljs-comment"># ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span>
    <span class="hljs-attr">settings:</span>
      <span class="hljs-attr">hosts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">localhost</span>
        <span class="hljs-comment"># æˆ–è€…æœåŠ¡å™¨ip</span>
      <span class="hljs-attr">user:</span> <span class="hljs-string">root</span>
      <span class="hljs-attr">key:</span>
        <span class="hljs-attr">from_secret:</span> <span class="hljs-string">deploy_ssh_secret</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">22</span>
      <span class="hljs-attr">source:</span> <span class="hljs-string">dist/</span>
      <span class="hljs-attr">target:</span> <span class="hljs-string">/home/admin-website</span>

  <span class="hljs-comment"># å¦‚æœåœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥æŠŠä»£ç ç›´æ¥ç¼–è¯‘è¿›æŒ‚è½½ç›®å½•æˆ–è€…ç§»å…¥æŒ‚è½½ç›®å½•</span>
  <span class="hljs-comment"># - name: deploy</span>
  <span class="hljs-comment">#   image: alpine:latest</span>
  <span class="hljs-comment">#   volumes:</span>
  <span class="hljs-comment">#     - name: admin-website</span>
  <span class="hljs-comment">#     # åœ¨å®¹å™¨å†…æä¾›targetç›®å½• æŒ‚è½½åˆ°å®¿ä¸»æœºçš„hostç›®å½•ä¸‹</span>
  <span class="hljs-comment">#       path: /target</span>
  <span class="hljs-comment">#   commands:</span>
  <span class="hljs-comment">#     - apk add --no-cache rsync</span>
  <span class="hljs-comment">#     # å°†å®¹å™¨å†…çš„distç›®å½•åŒæ­¥åˆ°targetç›®å½•ï¼Œç»™volumesæŒ‚è½½</span>
  <span class="hljs-comment">#     - rsync -av --delete /drone/src/dist/ /target/</span>
  <span class="hljs-comment">#     # éªŒè¯æ–‡ä»¶æ˜¯å¦å¤åˆ¶æˆåŠŸ</span>
  <span class="hljs-comment">#     - ls -la /target/ || exit 1</span>
</code></pre>
<h2 data-id="heading-12">æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²</h2>
<p>è‡³æ­¤æˆ‘ä»¬å°±å¤§åŠŸå‘Šæˆï¼Œå¯ä»¥è¿›è¡Œæµ‹è¯•äº†ï¼Œç°åœ¨ä¿®æ”¹ä»£ç å push è¿œç¨‹ <code>main</code> åˆ†æ”¯ï¼Œå³å¯è§¦å‘è‡ªåŠ¨æ„å»ºã€‚</p>
<p>æ”¹ä¸€ä¸‹é¡¹ç›®ç‰ˆæœ¬å·è¯•è¯•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17cea6d31322439bbb233da42865776a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=K2ECaGrJeAEVlamrBKQtqt3EM3Q%3D" alt="QQ_1763949105773.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä»»åŠ¡å¾ˆå¿«å°±å®Œæˆäº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd3c15b9917940daaeb5ca23da280ba0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=b3isP6E83TTZTFQp7Rn2dnsWvps%3D" alt="QQ_1763949213983.png" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/033486ca04964d889dcb716caa73ae20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=3UCM3hTMwcGIfsVZp44FnbCNyAo%3D" alt="QQ_1763949144336.png" loading="lazy"/></p>
<p>è®¿é—®ç½‘ç«™ï¼ˆè®°å¾—é…ç½® nginx ä»£ç†ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e92d41c6b4ad428d9fc7347aebf291e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_57u0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557813&amp;x-signature=YFMcFsSqM36C8QIvgQ8veYXd1lc%3D" alt="QQ_1763949190599.png" loading="lazy"/></p>
<h2 data-id="heading-13">ç»“è¯­</h2>
<p>æ•´å¥—æµç¨‹ä¸‹æ¥å¹¶ä¸å›°éš¾ï¼Œä½†éœ€è¦å¼€å‘ç”Ÿæ¶¯ä¸­çš„å¤šç§çŸ¥è¯†ä¸ºåŸºç¡€ï¼Œå¹¶åŠ ä»¥åº”ç”¨ï¼Œç†è§£å®Œæ•´çš„äº§å“å¼€å‘æµç¨‹ã€‚</p>
<p>å¸Œæœ›å‰ç«¯å¼€å‘çš„æ€ç»´ä¸å†å±€é™äºç¼–ç ï¼Œä»å±€éƒ¨åˆ°å…¨å±€ï¼Œä»ç¼–ç åˆ°äº¤ä»˜ï¼Œåšä¸€ä¸ªèƒ½ç‹¬ç«‹äº¤ä»˜äº§å“çš„ç¨‹åºå‘˜ã€‚</p>
<p>å¦‚æœå…¬å¸é‡Œæ­£å¥½ç¼ºå°‘å¯¹åº”çš„åŸºå»ºï¼Œä¾¿æ˜¯ä½ å¤§å±•èº«æ‰‹çš„æœºä¼šã€‚</p>
<p>è¿˜æœ‰å¾ˆå¤šç»†èŠ‚å€¼å¾—æˆ‘ä»¬è®¨è®ºï¼š</p>
<ol>
<li>é•œåƒæ„å»ºæ—¶å¦‚ä½•ç¼“å­˜ï¼Œé¿å…é‡å¤çš„æ— æ•ˆæ„å»º</li>
<li>å¦‚ä½•å°†é¡¹ç›®ç›´æ¥éƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡å™¨è¿è¡Œï¼Œè€Œä¸éœ€è¦å¤šæ¬¡é…ç½®nginx</li>
<li>éƒ¨ç½²åå‡ºç°é—®é¢˜æ€ä¹ˆå¿«é€Ÿå›æ»š</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•</li>
<li>. . .</li>
</ol>
<p>å¤§å®¶æ„Ÿå…´è¶£çš„è¯ï¼Œå†å†™ä¸€æ–‡è®¨è®ºã€‚</p>
<p>ä¸è¦å…‰çœ‹ä¸å®è·µå“¦~ å¸Œæœ›æœ¬æ–‡èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©</p>
<p>æŒç»­æ›´æ–°å‰ç«¯çŸ¥è¯†ï¼Œè„šè¸å®åœ°ä¸æ°´æ–‡ï¼ŒçœŸçš„ä¸å…³æ³¨ä¸€ä¸‹å—~</p>
<p>å†™ä½œä¸æ˜“ï¼Œå¦‚æœæœ‰æ”¶è·è¿˜æœ› ç‚¹èµ+æ”¶è— ğŸŒ¹</p>
<blockquote>
<p>æ‰ç–å­¦æµ…ï¼Œå¦‚æœ‰é—®é¢˜æˆ–å»ºè®®è¿˜æœ›æŒ‡æ•™~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ Flutter + GetX ä¸­å®ç° Design Tokens çš„å®Œæ•´æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7575469988737433609</link>    <guid>https://juejin.cn/post/7575469988737433609</guid>    <pubDate>2025-11-24T02:15:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575469988737433609" data-draft-id="7575533124877795355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ Flutter + GetX ä¸­å®ç° Design Tokens çš„å®Œæ•´æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-11-24T02:15:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€åæ™®é€šçš„ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3913917126936087"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ Flutter + GetX ä¸­å®ç° Design Tokens çš„å®Œæ•´æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917126936087/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€åæ™®é€šçš„ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:15:40.000Z" title="Mon Nov 24 2025 02:15:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç»“åˆ<a href="https://juejin.cn/post/7575438636332286003" target="_blank" title="https://juejin.cn/post/7575438636332286003">ã€ŠDesign Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ï¼šæ„å»ºé«˜æ•ˆè®¾è®¡ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯ã€‹</a>çš„æ ¸å¿ƒæ€æƒ³ï¼Œåœ¨ Flutter é¡¹ç›®ä¸­ä½¿ç”¨ GetX æ¡†æ¶å®ç° Design Tokens éœ€è¦ä»<strong>åˆ†å±‚æ¶æ„ã€ä¸»é¢˜ç®¡ç†ã€çŠ¶æ€æ§åˆ¶å’Œå·¥å…·é“¾é›†æˆ</strong>å››ä¸ªç»´åº¦è¿›è¡Œç³»ç»Ÿæ€§è®¾è®¡ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼š</p>
<h2 data-id="heading-0">ä¸€ã€Design Tokens çš„åˆ†å±‚æ¶æ„è®¾è®¡</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­çš„åˆ†å±‚ç®¡ç†ç»“æ„ï¼ˆåŸºç¡€Token â†’ è¯­ä¹‰Token â†’ ç»„ä»¶Tokenï¼‰ï¼Œåœ¨ Flutter ä¸­åº”å»ºç«‹å¯¹åº”çš„ä¸‰å±‚æ¶æ„ï¼š</p>
<h3 data-id="heading-1">1. åŸºç¡€ Token å±‚ï¼ˆåŸå§‹å€¼å®šä¹‰ï¼‰</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/tokens/foundation/colors.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoundationColors</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Color&gt; palette = {
    <span class="hljs-comment">// åŸºç¡€è‰²ç³» - é‡‡ç”¨è‰²ç›¸-æ˜åº¦åˆ†çº§ä½“ç³»</span>
    <span class="hljs-string">'red-50'</span>: Color(<span class="hljs-number">0xFFF8D7DA</span>),
    <span class="hljs-string">'red-100'</span>: Color(<span class="hljs-number">0xFFF1B3B6</span>),
    <span class="hljs-string">'red-500'</span>: Color(<span class="hljs-number">0xFFD32F2F</span>),
    <span class="hljs-string">'red-700'</span>: Color(<span class="hljs-number">0xFFB71C1C</span>),
    
    <span class="hljs-string">'blue-50'</span>: Color(<span class="hljs-number">0xFFE3F2FD</span>),
    <span class="hljs-string">'blue-100'</span>: Color(<span class="hljs-number">0xFFBBDEFB</span>),
    <span class="hljs-string">'blue-500'</span>: Color(<span class="hljs-number">0xFF2196F3</span>),
    <span class="hljs-string">'blue-700'</span>: Color(<span class="hljs-number">0xFF1976D2</span>),
    
    <span class="hljs-string">'gray-50'</span>: Color(<span class="hljs-number">0xFFF5F5F5</span>),
    <span class="hljs-string">'gray-100'</span>: Color(<span class="hljs-number">0xFFE0E0E0</span>),
    <span class="hljs-string">'gray-300'</span>: Color(<span class="hljs-number">0xFF9E9E9E</span>),
    <span class="hljs-string">'gray-700'</span>: Color(<span class="hljs-number">0xFF616161</span>),
    <span class="hljs-string">'gray-900'</span>: Color(<span class="hljs-number">0xFF212121</span>),
  };
}

<span class="hljs-comment">// lib/tokens/foundation/spacing.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoundationSpacing</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> xs = <span class="hljs-number">4.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> sm = <span class="hljs-number">8.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> md = <span class="hljs-number">16.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> lg = <span class="hljs-number">24.0</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">double</span> xl = <span class="hljs-number">32.0</span>;
}

<span class="hljs-comment">// lib/tokens/foundation/typography.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FoundationTypography</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TextStyle bodySmall = TextStyle(
    fontSize: <span class="hljs-number">12.0</span>,
    fontWeight: FontWeight.w400,
    height: <span class="hljs-number">1.5</span>,
  );
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TextStyle bodyMedium = TextStyle(
    fontSize: <span class="hljs-number">14.0</span>,
    fontWeight: FontWeight.w400,
    height: <span class="hljs-number">1.5</span>,
  );
  
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> TextStyle headlineSmall = TextStyle(
    fontSize: <span class="hljs-number">16.0</span>,
    fontWeight: FontWeight.w600,
    height: <span class="hljs-number">1.4</span>,
  );
}
</code></pre>
<h3 data-id="heading-2">2. è¯­ä¹‰ Token å±‚ï¼ˆç”¨é€”è¯´æ˜ï¼‰</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/tokens/semantic/colors.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemanticColors</span> </span>{
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> primary =&gt; FoundationColors.palette[<span class="hljs-string">'blue-500'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> primaryDark =&gt; FoundationColors.palette[<span class="hljs-string">'blue-700'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> error =&gt; FoundationColors.palette[<span class="hljs-string">'red-500'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> background =&gt; FoundationColors.palette[<span class="hljs-string">'gray-50'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> surface =&gt; Colors.white;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> onSurface =&gt; FoundationColors.palette[<span class="hljs-string">'gray-900'</span>]!;
  <span class="hljs-keyword">static</span> Color <span class="hljs-keyword">get</span> onPrimary =&gt; Colors.white;
}

<span class="hljs-comment">// lib/tokens/semantic/spacing.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemanticSpacing</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> contentPadding =&gt; FoundationSpacing.md;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> buttonSpacing =&gt; FoundationSpacing.sm;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-keyword">get</span> cardPadding =&gt; FoundationSpacing.lg;
}

<span class="hljs-comment">// lib/tokens/semantic/typography.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SemanticTypography</span> </span>{
  <span class="hljs-keyword">static</span> TextStyle <span class="hljs-keyword">get</span> bodyText =&gt; FoundationTypography.bodyMedium;
  <span class="hljs-keyword">static</span> TextStyle <span class="hljs-keyword">get</span> labelText =&gt; FoundationTypography.bodySmall;
  <span class="hljs-keyword">static</span> TextStyle <span class="hljs-keyword">get</span> titleText =&gt; FoundationTypography.headlineSmall;
}
</code></pre>
<h3 data-id="heading-3">3. ç»„ä»¶ Token å±‚ï¼ˆç»„ä»¶çº§å˜é‡ï¼‰</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/tokens/components/button_tokens.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ButtonTokens</span> </span>{
  <span class="hljs-comment">// ä¸»æŒ‰é’®æ ·å¼</span>
  <span class="hljs-keyword">static</span> ButtonStyle primaryButtonStyle = ButtonStyle(
    backgroundColor: MaterialStateProperty.all(SemanticColors.primary),
    foregroundColor: MaterialStateProperty.all(SemanticColors.onPrimary),
    padding: MaterialStateProperty.all(
      EdgeInsets.symmetric(horizontal: SemanticSpacing.md, vertical: SemanticSpacing.sm)
    ),
    textStyle: MaterialStateProperty.all(SemanticTypography.titleText),
    shape: MaterialStateProperty.all(
      RoundedRectangleBorder(borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>))
    ),
  );
  
  <span class="hljs-comment">// æ¬¡è¦æŒ‰é’®æ ·å¼</span>
  <span class="hljs-keyword">static</span> ButtonStyle secondaryButtonStyle = ButtonStyle(
    backgroundColor: MaterialStateProperty.all(Colors.transparent),
    foregroundColor: MaterialStateProperty.all(SemanticColors.onSurface),
    side: MaterialStateProperty.all(
      BorderSide(color: SemanticColors.onSurface, width: <span class="hljs-number">1.0</span>)
    ),
    padding: MaterialStateProperty.all(
      EdgeInsets.symmetric(horizontal: SemanticSpacing.md, vertical: SemanticSpacing.sm)
    ),
    textStyle: MaterialStateProperty.all(SemanticTypography.titleText),
    shape: MaterialStateProperty.all(
      RoundedRectangleBorder(borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>))
    ),
  );
}
</code></pre>
<h2 data-id="heading-4">äºŒã€åŸºäº GetX çš„ä¸»é¢˜çŠ¶æ€ç®¡ç†</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­"åŠ¨æ€ä¸»é¢˜æ”¯æŒï¼šåªéœ€ä¿®æ”¹Tokenå€¼ï¼Œå³å¯å®ç°å…¨å±€ä¸»é¢˜åˆ‡æ¢"çš„ç†å¿µï¼Œä½¿ç”¨ GetX å®ç°ä¸»é¢˜çŠ¶æ€ç®¡ç†ï¼š</p>
<h3 data-id="heading-5">1. åˆ›å»º ThemeService æœåŠ¡å±‚</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/services/theme_service.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:get/get.dart'</span>;

<span class="hljs-keyword">enum</span> AppTheme { light, dark }

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxService</span> </span>{
  <span class="hljs-keyword">final</span> Rx&lt;AppTheme&gt; _currentTheme = AppTheme.light.obs;
  
  AppTheme <span class="hljs-keyword">get</span> currentTheme =&gt; _currentTheme.value;
  Stream&lt;AppTheme&gt; <span class="hljs-keyword">get</span> themeStream =&gt; _currentTheme.stream;
  
  Future&lt;ThemeService&gt; toggleTheme() <span class="hljs-keyword">async</span> {
    _currentTheme.value = _currentTheme.value == AppTheme.light 
        ? AppTheme.dark 
        : AppTheme.light;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }
  
  ThemeData getThemeData() {
    <span class="hljs-keyword">return</span> currentTheme == AppTheme.light 
        ? _lightThemeData 
        : _darkThemeData;
  }
  
  <span class="hljs-comment">// æ˜äº®ä¸»é¢˜æ•°æ®</span>
  ThemeData <span class="hljs-keyword">get</span> _lightThemeData {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.light,
      primaryColor: SemanticColors.primary,
      scaffoldBackgroundColor: SemanticColors.background,
      cardColor: SemanticColors.surface,
      textTheme: TextTheme(
        bodyMedium: SemanticTypography.bodyText,
        labelMedium: SemanticTypography.labelText,
        titleMedium: SemanticTypography.titleText,
      ),
      elevatedButtonTheme: ElevatedButtonThemeData(
        style: ButtonTokens.primaryButtonStyle,
      ),
      outlinedButtonTheme: OutlinedButtonThemeData(
        style: ButtonTokens.secondaryButtonStyle,
      ),
    );
  }
  
  <span class="hljs-comment">// æš—è‰²ä¸»é¢˜æ•°æ® - æ ¹æ®è®ºæ–‡ä¸­çš„åŠ¨æ€ä¸»é¢˜ç†å¿µè°ƒæ•´é¢œè‰²å€¼</span>
  ThemeData <span class="hljs-keyword">get</span> _darkThemeData {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.dark,
      primaryColor: SemanticColors.primary,
      scaffoldBackgroundColor: Color(<span class="hljs-number">0xFF121212</span>), <span class="hljs-comment">// æ·±è‰²èƒŒæ™¯</span>
      cardColor: Color(<span class="hljs-number">0xFF1E1E1E</span>), <span class="hljs-comment">// æ·±è‰²å¡ç‰‡</span>
      textTheme: TextTheme(
        bodyMedium: SemanticTypography.bodyText.copyWith(color: Colors.white70),
        labelMedium: SemanticTypography.labelText.copyWith(color: Colors.white70),
        titleMedium: SemanticTypography.titleText.copyWith(color: Colors.white),
      ),
      elevatedButtonTheme: ElevatedButtonThemeData(
        style: ButtonTokens.primaryButtonStyle.copyWith(
          backgroundColor: MaterialStateProperty.all(SemanticColors.primary),
          foregroundColor: MaterialStateProperty.all(Colors.white),
        ),
      ),
      outlinedButtonTheme: OutlinedButtonThemeData(
        style: ButtonTokens.secondaryButtonStyle.copyWith(
          side: MaterialStateProperty.all(
            BorderSide(color: Colors.white70, width: <span class="hljs-number">1.0</span>)
          ),
          foregroundColor: MaterialStateProperty.all(Colors.white70),
        ),
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-6">2. åˆå§‹åŒ– ThemeService</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/main.dart</span>
<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  WidgetsFlutterBinding.ensureInitialized();
  
  <span class="hljs-comment">// åˆå§‹åŒ–ä¸»é¢˜æœåŠ¡</span>
  <span class="hljs-keyword">await</span> Get.putAsync(() =&gt; ThemeService().then((service) =&gt; service));
  
  runApp(MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> GetMaterialApp(
      title: <span class="hljs-string">'Design Tokens Demo'</span>,
      theme: Get.find&lt;ThemeService&gt;().getThemeData(),
      home: HomePage(),
      <span class="hljs-comment">// ç›‘å¬ä¸»é¢˜å˜åŒ–</span>
      builder: (context, child) {
        <span class="hljs-keyword">return</span> Obx(
          () =&gt; Theme(
            data: Get.find&lt;ThemeService&gt;().getThemeData(),
            child: child!,
          ),
        );
      },
    );
  }
}
</code></pre>
<h2 data-id="heading-7">ä¸‰ã€å¤šå“ç‰Œåœºæ™¯çš„æ‰©å±•å®ç°</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­"å¤šå“ç‰Œåœºæ™¯ï¼šåˆ›å»ºå“ç‰Œæ‰©å±•å±‚Token"çš„å»ºè®®ï¼Œå®ç°å“ç‰Œå®šåˆ¶åŠŸèƒ½ï¼š</p>
<h3 data-id="heading-8">1. å“ç‰Œé…ç½®æ¥å£</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/models/brand_config.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  <span class="hljs-keyword">final</span> Color primaryColor;
  <span class="hljs-keyword">final</span> Color secondaryColor;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> logoAsset;
  
  BrandConfig({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.primaryColor,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.secondaryColor,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.logoAsset,
  });
}

<span class="hljs-comment">// å“ç‰Œé…ç½®ä»“åº“</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BrandRepository</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, BrandConfig&gt; brands = {
    <span class="hljs-string">'default'</span>: BrandConfig(
      name: <span class="hljs-string">'Default'</span>,
      primaryColor: FoundationColors.palette[<span class="hljs-string">'blue-500'</span>]!,
      secondaryColor: FoundationColors.palette[<span class="hljs-string">'red-500'</span>]!,
      logoAsset: <span class="hljs-string">'assets/logos/default_logo.png'</span>,
    ),
    <span class="hljs-string">'brand_a'</span>: BrandConfig(
      name: <span class="hljs-string">'Brand A'</span>,
      primaryColor: Color(<span class="hljs-number">0xFF6200EE</span>), <span class="hljs-comment">// ç´«è‰²ä¸»é¢˜</span>
      secondaryColor: Color(<span class="hljs-number">0xFF03DAC6</span>), <span class="hljs-comment">// é’è‰²ä¸»é¢˜</span>
      logoAsset: <span class="hljs-string">'assets/logos/brand_a_logo.png'</span>,
    ),
    <span class="hljs-string">'brand_b'</span>: BrandConfig(
      name: <span class="hljs-string">'Brand B'</span>,
      primaryColor: Color(<span class="hljs-number">0xFFFF6B35</span>), <span class="hljs-comment">// æ©™è‰²ä¸»é¢˜</span>
      secondaryColor: Color(<span class="hljs-number">0xFF2EC4B6</span>), <span class="hljs-comment">// è“ç»¿è‰²ä¸»é¢˜</span>
      logoAsset: <span class="hljs-string">'assets/logos/brand_b_logo.png'</span>,
    ),
  };
}
</code></pre>
<h3 data-id="heading-9">2. æ‰©å±• ThemeService æ”¯æŒå¤šå“ç‰Œ</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// æ‰©å±• ThemeService</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">GetxService</span> </span>{
  <span class="hljs-keyword">final</span> Rx&lt;AppTheme&gt; _currentTheme = AppTheme.light.obs;
  <span class="hljs-keyword">final</span> Rx&lt;<span class="hljs-built_in">String</span>&gt; _currentBrand = <span class="hljs-string">'default'</span>.obs; <span class="hljs-comment">// å½“å‰å“ç‰Œ</span>
  
  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> currentBrand =&gt; _currentBrand.value;
  AppTheme <span class="hljs-keyword">get</span> currentTheme =&gt; _currentTheme.value;
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; switchBrand(<span class="hljs-built_in">String</span> brandName) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">if</span> (BrandRepository.brands.containsKey(brandName)) {
      _currentBrand.value = brandName;
    }
  }
  
  <span class="hljs-comment">// è·å–å½“å‰å“ç‰Œçš„ä¸»è‰²</span>
  Color getBrandPrimaryColor() {
    <span class="hljs-keyword">return</span> BrandRepository.brands[currentBrand]!.primaryColor;
  }
  
  <span class="hljs-comment">// é‡å†™ä¸»é¢˜æ•°æ®ç”Ÿæˆæ–¹æ³•ï¼ŒåŒ…å«å“ç‰Œå®šåˆ¶</span>
  ThemeData getThemeData() {
    <span class="hljs-keyword">final</span> brandConfig = BrandRepository.brands[currentBrand]!;
    
    <span class="hljs-keyword">return</span> currentTheme == AppTheme.light 
        ? _createLightTheme(brandConfig)
        : _createDarkTheme(brandConfig);
  }
  
  ThemeData _createLightTheme(BrandConfig config) {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.light,
      primaryColor: config.primaryColor,
      scaffoldBackgroundColor: SemanticColors.background,
      <span class="hljs-comment">// ... å…¶ä»–ä¸»é¢˜é…ç½®</span>
    );
  }
  
  ThemeData _createDarkTheme(BrandConfig config) {
    <span class="hljs-keyword">return</span> ThemeData(
      brightness: Brightness.dark,
      primaryColor: config.primaryColor,
      scaffoldBackgroundColor: Color(<span class="hljs-number">0xFF121212</span>),
      <span class="hljs-comment">// ... å…¶ä»–ä¸»é¢˜é…ç½®</span>
    );
  }
}
</code></pre>
<h2 data-id="heading-10">å››ã€ç»„ä»¶å±‚çš„ Token ä½¿ç”¨æœ€ä½³å®è·µ</h2>
<p>æ ¹æ®è®ºæ–‡ä¸­"ç»„ä»¶Tokenï¼šç»„ä»¶çº§å˜é‡"çš„ç†å¿µï¼Œåœ¨ UI ç»„ä»¶ä¸­æ­£ç¡®ä½¿ç”¨ Design Tokensï¼š</p>
<h3 data-id="heading-11">1. åŸºç¡€ç»„ä»¶å°è£…</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/components/app_button.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> text;
  <span class="hljs-keyword">final</span> VoidCallback onPressed;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isPrimary;
  
  <span class="hljs-keyword">const</span> AppButton({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.text,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.onPressed,
    <span class="hljs-keyword">this</span>.isPrimary = <span class="hljs-keyword">true</span>,
  }) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ElevatedButton(
      onPressed: onPressed,
      style: isPrimary 
          ? ButtonTokens.primaryButtonStyle 
          : ButtonTokens.secondaryButtonStyle,
      child: Text(text),
    );
  }
}

<span class="hljs-comment">// lib/components/app_card.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppCard</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Widget child;
  
  <span class="hljs-keyword">const</span> AppCard({Key? key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.child}) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Card(
      margin: EdgeInsets.all(SemanticSpacing.md),
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(<span class="hljs-number">12.0</span>),
      ),
      child: Padding(
        padding: EdgeInsets.all(SemanticSpacing.cardPadding),
        child: child,
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-12">2. åœ¨é¡µé¢ä¸­ä½¿ç”¨ç»„ä»¶</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/views/home_page.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">final</span> themeService = Get.find&lt;ThemeService&gt;();
    
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: Text(<span class="hljs-string">'Design Tokens Demo'</span>),
        actions: [
          IconButton(
            icon: Icon(themeService.currentTheme == AppTheme.light 
                ? Icons.dark_mode 
                : Icons.light_mode),
            onPressed: () =&gt; themeService.toggleTheme(),
          ),
          PopupMenuButton&lt;<span class="hljs-built_in">String</span>&gt;(
            onSelected: (brand) =&gt; themeService.switchBrand(brand),
            itemBuilder: (context) =&gt; BrandRepository.brands.keys.map((brand) {
              <span class="hljs-keyword">return</span> PopupMenuItem(
                value: brand,
                child: Text(BrandRepository.brands[brand]!.name),
              );
            }).toList(),
          ),
        ],
      ),
      body: SingleChildScrollView(
        padding: EdgeInsets.all(SemanticSpacing.contentPadding),
        child: Column(
          children: [
            AppCard(
              child: Column(
                children: [
                  Text(
                    <span class="hljs-string">'Welcome to Design Tokens Demo'</span>,
                    style: SemanticTypography.titleText,
                  ),
                  SizedBox(height: SemanticSpacing.md),
                  Text(
                    <span class="hljs-string">'This demonstrates how to implement Design Tokens in Flutter with GetX.'</span>,
                    style: SemanticTypography.bodyText,
                  ),
                ],
              ),
            ),
            AppButton(
              text: <span class="hljs-string">'Primary Action'</span>,
              onPressed: () {},
              isPrimary: <span class="hljs-keyword">true</span>,
            ),
            SizedBox(height: SemanticSpacing.buttonSpacing),
            AppButton(
              text: <span class="hljs-string">'Secondary Action'</span>,
              onPressed: () {},
              isPrimary: <span class="hljs-keyword">false</span>,
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-13">äº”ã€æ€§èƒ½ä¼˜åŒ–ä¸å·¥å…·é“¾é›†æˆ</h2>
<h3 data-id="heading-14">1. æŒ‰éœ€åŠ è½½ä¸»é¢˜åŒ…</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/services/theme_loader.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeLoader</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; loadThemeJson(<span class="hljs-built_in">String</span> themeName) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> jsonString = <span class="hljs-keyword">await</span> rootBundle.loadString(<span class="hljs-string">'assets/themes/<span class="hljs-subst">$themeName</span>.json'</span>);
    <span class="hljs-keyword">return</span> json.decode(jsonString);
  }
  
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; applyDynamicTheme(<span class="hljs-built_in">String</span> themeName) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> themeData = <span class="hljs-keyword">await</span> loadThemeJson(themeName);
    <span class="hljs-comment">// åŠ¨æ€åº”ç”¨ä¸»é¢˜é€»è¾‘</span>
  }
}
</code></pre>
<h3 data-id="heading-15">2. ç¼–è¯‘æ—¶ä¼˜åŒ–</h3>
<p>åœ¨ <code>pubspec.yaml</code> ä¸­é…ç½®èµ„æºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">assets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/themes/</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/logos/</span>
</code></pre>
<h3 data-id="heading-16">3. å¼€å‘ç¯å¢ƒè°ƒè¯•å·¥å…·</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/utils/token_debugger.dart</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TokenDebugger</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> printAllTokens() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== Foundation Colors ==='</span>);
    FoundationColors.palette.forEach((key, value) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">$key</span>: <span class="hljs-subst">${value.value}</span>'</span>);
    });
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== Semantic Colors ==='</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Primary: <span class="hljs-subst">${SemanticColors.primary.value}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Error: <span class="hljs-subst">${SemanticColors.error.value}</span>'</span>);
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== Spacing ==='</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'XS: <span class="hljs-subst">${FoundationSpacing.xs}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'SM: <span class="hljs-subst">${FoundationSpacing.sm}</span>'</span>);
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'MD: <span class="hljs-subst">${FoundationSpacing.md}</span>'</span>);
  }
}
</code></pre>
<h2 data-id="heading-17">å…­ã€å®æ–½æ•ˆæœä¸ä¼˜åŠ¿æ€»ç»“</h2>
<p>é€šè¿‡ä¸Šè¿°å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬æˆåŠŸå°†ã€ŠDesign Tokensçš„è®¾è®¡ä¸ä½¿ç”¨è¯¦è§£ã€‹ä¸­çš„æ ¸å¿ƒç†å¿µåº”ç”¨åˆ° Flutter + GetX é¡¹ç›®ä¸­ï¼š</p>
<h3 data-id="heading-18">å®ç°æ•ˆæœ</h3>
<ul>
<li><strong>è·¨å¹³å°ä¸€è‡´æ€§</strong>ï¼šæ‰€æœ‰ UI ç»„ä»¶éƒ½ä½¿ç”¨ç»Ÿä¸€çš„ Design Tokensï¼Œç¡®ä¿è§†è§‰ä¸€è‡´æ€§</li>
<li><strong>åŠ¨æ€ä¸»é¢˜æ”¯æŒ</strong>ï¼šé€šè¿‡ GetX çš„å“åº”å¼çŠ¶æ€ç®¡ç†ï¼Œå®ç°ä¸€é”®åˆ‡æ¢æ˜æš—ä¸»é¢˜</li>
<li><strong>å¤šå“ç‰Œæ‰©å±•</strong>ï¼šæ”¯æŒä¸åŒå“ç‰Œçš„å¿«é€Ÿå®šåˆ¶å’Œåˆ‡æ¢</li>
<li><strong>åˆ†å±‚ç®¡ç†</strong>ï¼šæ¸…æ™°çš„ä¸‰å±‚æ¶æ„ï¼ˆåŸºç¡€â†’è¯­ä¹‰â†’ç»„ä»¶ï¼‰ä¾¿äºç»´æŠ¤å’Œæ‰©å±•</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šæŒ‰éœ€åŠ è½½ã€ç¼–è¯‘æ—¶ä¼˜åŒ–ç¡®ä¿åº”ç”¨æ€§èƒ½</li>
</ul>
<h3 data-id="heading-19">æ•ˆç‡æå‡æ•°æ®</h3>
<p>æ ¹æ®è®ºæ–‡ä¸­æåˆ°çš„æ•°æ®ï¼š"é€šè¿‡æ ‡å‡†åŒ–Design Tokenç®¡ç†ï¼Œå›¢é˜Ÿå¯å‡å°‘æ ·å¼å†—ä½™ä»£ç è¾¾40-60%ï¼Œä¸»é¢˜åˆ‡æ¢æ•ˆç‡æå‡300%ä»¥ä¸Š"ï¼Œåœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼š</p>
<ul>
<li><strong>ä»£ç å¤ç”¨ç‡æå‡</strong>ï¼šç»„ä»¶æ ·å¼å®šä¹‰å‡å°‘çº¦50%</li>
<li><strong>ä¸»é¢˜åˆ‡æ¢æ—¶é—´</strong>ï¼šä»åŸæ¥çš„æ•°åˆ†é’Ÿæ‰‹åŠ¨ä¿®æ”¹ï¼Œç¼©çŸ­åˆ°æ¯«ç§’çº§è‡ªåŠ¨åˆ‡æ¢</li>
<li><strong>ç»´æŠ¤æˆæœ¬é™ä½</strong>ï¼šæ ·å¼å˜æ›´åªéœ€ä¿®æ”¹ä¸€å¤„ Token å®šä¹‰</li>
<li><strong>å›¢é˜Ÿåä½œæ•ˆç‡</strong>ï¼šè®¾è®¡å¸ˆå’Œå¼€å‘è€…ä½¿ç”¨åŒä¸€å¥—å‘½åè§„èŒƒï¼Œæ²Ÿé€šæˆæœ¬å¤§å¹…é™ä½</li>
</ul>
<h3 data-id="heading-20">æœªæ¥æ‰©å±•æ–¹å‘</h3>
<ul>
<li><strong>Figma æ’ä»¶é›†æˆ</strong>ï¼šå¼€å‘ Figma æ’ä»¶è‡ªåŠ¨ç”Ÿæˆ Flutter Design Tokens ä»£ç </li>
<li><strong>CI/CD è‡ªåŠ¨åŒ–</strong>ï¼šåœ¨ CI/CD æµç¨‹ä¸­è‡ªåŠ¨ç”Ÿæˆå’ŒéªŒè¯ Design Tokens</li>
<li><strong>è¿è¡Œæ—¶ä¸»é¢˜ç¼–è¾‘å™¨</strong>ï¼šæä¾›å¯è§†åŒ–ç•Œé¢å®æ—¶è°ƒæ•´å’Œé¢„è§ˆä¸»é¢˜æ•ˆæœ</li>
<li><strong>å›½é™…åŒ–æ”¯æŒ</strong>ï¼šç»“åˆ GetX çš„å›½é™…åŒ–åŠŸèƒ½ï¼Œå®ç°å¤šè¯­è¨€+å¤šä¸»é¢˜çš„ç»„åˆ</li>
</ul>
<p>é€šè¿‡è¿™å¥—å®Œæ•´çš„å®ç°æ–¹æ¡ˆï¼ŒFlutter + GetX é¡¹ç›®èƒ½å¤Ÿå……åˆ†å‘æŒ¥ Design Tokens çš„ä¼˜åŠ¿ï¼Œæ„å»ºé«˜æ•ˆã€ä¸€è‡´ã€å¯ç»´æŠ¤çš„è®¾è®¡ç³»ç»Ÿï¼Œä¸ºäº§å“çš„é•¿æœŸå‘å±•å¥ å®šåšå®åŸºç¡€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webpack æ’ä»¶å¼€å‘æŒ‡å—ï¼šæ·±å…¥ç†è§£ Compiler Hooks]]></title>    <link>https://juejin.cn/post/7575488180980678656</link>    <guid>https://juejin.cn/post/7575488180980678656</guid>    <pubDate>2025-11-24T02:42:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575488180980678656" data-draft-id="7575488180980596736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Webpack æ’ä»¶å¼€å‘æŒ‡å—ï¼šæ·±å…¥ç†è§£ Compiler Hooks"/> <meta itemprop="keywords" content="å‰ç«¯,Webpack"/> <meta itemprop="datePublished" content="2025-11-24T02:42:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°‘å¿"/> <meta itemprop="url" content="https://juejin.cn/user/26044010879709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Webpack æ’ä»¶å¼€å‘æŒ‡å—ï¼šæ·±å…¥ç†è§£ Compiler Hooks
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044010879709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°‘å¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:42:03.000Z" title="Mon Nov 24 2025 02:42:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Webpack çš„æµ©ç€šå®‡å®™ä¸­ï¼Œ<strong>Pluginï¼ˆæ’ä»¶ï¼‰</strong> æ˜¯æœ€å¼ºå¤§çš„æ‰©å±•æœºåˆ¶ã€‚å¦‚æœè¯´ Loader åªæ˜¯è´Ÿè´£è½¬æ¢æ–‡ä»¶çš„â€œç¿»è¯‘å®˜â€ï¼Œé‚£ä¹ˆ Plugin å°±æ˜¯èƒ½æ§åˆ¶ Webpack æ•´ä¸ªæ„å»ºç”Ÿå‘½å‘¨æœŸçš„â€œæŒ‡æŒ¥å®˜â€ã€‚</p>
<p>è€Œè¦å¼€å‘ä¸€ä¸ª Pluginï¼Œç¬¬ä¸€æ­¥å°±æ˜¯ææ‡‚ <code>compiler.hooks</code>ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ æ ¸å¿ƒéšå–»ï¼šæµæ°´çº¿ä¸Šçš„â€œä¼ æ„Ÿå™¨â€</h2>
<p>ä¸ºäº†ç†è§£ Webpack çš„æ„å»ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªè¶…çº§å·¥å‚çš„<strong>æµæ°´çº¿</strong>ï¼š</p>
<ol>
<li><strong>Compiler (ç¼–è¯‘å™¨)</strong> ï¼šå°±æ˜¯è¿™ä¸ªå·¥å‚çš„ä¸»æ§ç”µè„‘ã€‚å®ƒåœ¨ Webpack å¯åŠ¨æ—¶è¢«åˆ›å»ºï¼Œå…¨å±€å”¯ä¸€ï¼Œä¿å­˜äº†æ‰€æœ‰çš„é…ç½®ï¼ˆOptions, Loaders, Pluginsï¼‰ã€‚</li>
<li><strong>Hooks (é’©å­)</strong> ï¼šæµæ°´çº¿ä¸Šçš„ä¸€ä¸ªä¸ª<strong>å…³é”®èŠ‚ç‚¹</strong>ã€‚</li>
<li><strong>Tapable</strong>ï¼šWebpack å†…éƒ¨çš„äº‹ä»¶æµæœºåˆ¶ã€‚</li>
</ol>
<p>å½“æˆ‘ä»¬å¼€å‘æ’ä»¶æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šå®‰è£…â€œä¼ æ„Ÿå™¨â€æˆ–â€œæœºæ¢°è‡‚â€ã€‚å½“æµæ°´çº¿è¿è¡Œåˆ°æŸä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚â€œå‡†å¤‡å†™å…¥æ–‡ä»¶â€æ—¶ï¼‰ï¼Œå°±ä¼šè§¦å‘æˆ‘ä»¬çš„é€»è¾‘ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šä¿®æ”¹æ•°æ®ã€å¢åŠ æ–‡ä»¶æˆ–ç›‘æ§çŠ¶æ€ã€‚</p>
<h2 data-id="heading-1">äºŒã€ Compiler Hooks ç”Ÿå‘½å‘¨æœŸå…¨æ™¯å›¾</h2>
<p><code>compiler.hooks</code> åŒ…å«äº†å‡ åä¸ªé’©å­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…¨éƒ¨èƒŒä¸‹æ¥ã€‚æŒ‰ç…§æ„å»ºæµç¨‹ï¼Œæˆ‘ä»¬å°†æœ€æ ¸å¿ƒçš„é’©å­åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p>
<h3 data-id="heading-2">1. åˆå§‹åŒ–é˜¶æ®µ (Initialization)</h3>
<p>å½“ Webpack è¯»å–é…ç½®å¹¶åˆå§‹åŒ–æ’ä»¶æ—¶è§¦å‘ã€‚</p>
<ul>
<li>
<p><strong><code>entryOption</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncBailHook</li>
<li><strong>ä½œç”¨</strong>ï¼šåœ¨å¤„ç† <code>entry</code> é…ç½®é¡¹ä¹‹åè§¦å‘ã€‚å¦‚æœä½ æƒ³åŠ¨æ€ä¿®æ”¹å…¥å£é…ç½®ï¼Œå°±åœ¨è¿™é‡ŒåŠ¨æ‰‹ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>afterPlugins</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ‰€æœ‰æ’ä»¶çš„ <code>apply</code> æ–¹æ³•æ‰§è¡Œå®Œä¹‹åã€‚é€‚åˆåšæ’ä»¶ä¹‹é—´çš„è”åŠ¨æ£€æŸ¥ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">2. ç¼–è¯‘æ„å»ºé˜¶æ®µ (Running &amp; Building)</h3>
<p>è¿™æ˜¯å·¥å‚å¼€å§‹è¿è½¬ï¼Œå¤„ç†æ¨¡å—ä¾èµ–çš„æ ¸å¿ƒé˜¶æ®µã€‚</p>
<ul>
<li>
<p><strong><code>run</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ„å»ºçœŸæ­£å¼€å§‹å‰çš„â€œé¢„çƒ­â€é˜¶æ®µã€‚å¯ä»¥ç”¨äºæ¸…ç†ç¼“å­˜æˆ–è¯»å–å¤–éƒ¨è®°å½•ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>compile</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼šå‘Šè¯‰å¤§å®¶â€œæˆ‘è¦å¼€å§‹åˆ›å»ºç¼–è¯‘å¯¹è±¡äº†â€ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>compilation</code> (â­ æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ)</strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼š<code>compilation</code> å¯¹è±¡åˆ›å»ºå®Œæˆã€‚</li>
<li><strong>è¯¦è§£</strong>ï¼šè¿™æ˜¯ç»å¤§å¤šæ•°æ’ä»¶çš„å…¥å£ã€‚<code>compilation</code> ä»£è¡¨**â€œä»…ä»…è¿™ä¸€æ¬¡æ„å»ºâ€**çš„èµ„æºé›†åˆã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—® <code>compilation.hooks</code> è¿›ä¸€æ­¥æ·±å…¥åˆ°æ¨¡å—ï¼ˆModuleï¼‰å’Œä»£ç å—ï¼ˆChunkï¼‰çš„å¤„ç†ç»†èŠ‚ä¸­ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>make</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncParallelHook</li>
<li><strong>ä½œç”¨</strong>ï¼šç¼–è¯‘è¿‡ç¨‹æ­£å¼å¯åŠ¨ï¼Œå¼€å§‹ä» Entry é€’å½’åˆ†æä¾èµ–ã€‚è¿™æ˜¯æ·»åŠ é¢å¤–æ–‡ä»¶æˆ–æ¨¡å—çš„å¥½æ—¶æœºã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">3. è¾“å‡ºé˜¶æ®µ (Output)</h3>
<p>èµ„æºå·²ç»å¤„ç†å®Œæ¯•ï¼Œå‡†å¤‡æ‰“åŒ…ç”Ÿæˆçš„é˜¶æ®µã€‚</p>
<ul>
<li>
<p><strong><code>emit</code> (â­ æœ€å¸¸ç”¨)</strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šèµ„æºå·²ç»è½¬æ¢å®Œæˆï¼Œæ”¾åœ¨å†…å­˜é‡Œï¼Œä½†<strong>è¿˜æ²¡å†™å…¥ç£ç›˜</strong>ã€‚</li>
<li><strong>å®æˆ˜</strong>ï¼šè¿™æ˜¯ä¿®æ”¹æœ€ç»ˆè¾“å‡ºæ–‡ä»¶çš„æœ€åæœºä¼šã€‚æ¯”å¦‚ï¼šç”Ÿæˆ <code>file-list.md</code>ã€å‹ç¼©å›¾ç‰‡ã€æ·»åŠ ç‰ˆæƒå¤´ä¿¡æ¯ç­‰ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>afterEmit</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ–‡ä»¶å·²ç»å†™å…¥ç£ç›˜ä¹‹åã€‚å¸¸ç”¨äºæ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">4. ç»“æŸé˜¶æ®µ (Termination)</h3>
<ul>
<li>
<p><strong><code>done</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šAsyncSeriesHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ„å»ºå®Œæˆï¼ˆæ— è®ºæˆåŠŸè¿˜æ˜¯æœ‰è­¦å‘Šï¼‰ã€‚å¸¸ç”¨äºæ‰“å°ç»Ÿè®¡ä¿¡æ¯ï¼ˆStatsï¼‰æˆ–å‘é€æ„å»ºå®Œæˆé€šçŸ¥ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>failed</code></strong></p>
<ul>
<li><strong>ç±»å‹</strong>ï¼šSyncHook</li>
<li><strong>ä½œç”¨</strong>ï¼šæ„å»ºå› é”™è¯¯è€Œå¤±è´¥ã€‚ç”¨äºé”™è¯¯ä¸ŠæŠ¥ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€ å®æˆ˜ï¼šå¦‚ä½•â€œæŒ‚è½½â€ä½ çš„é€»è¾‘ï¼Ÿ</h2>
<p>åœ¨æ’ä»¶ç±»çš„ <code>apply</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>.tap</code> ç³»åˆ—æ–¹æ³•æ¥æ³¨å†Œé’©å­ã€‚æ ¹æ®é’©å­çš„ç±»å‹ï¼ˆåŒæ­¥æˆ–å¼‚æ­¥ï¼‰ï¼Œæœ‰ä¸åŒçš„å†™æ³•ã€‚</p>
<h3 data-id="heading-7">1. åŒæ­¥é’©å­ (SyncHook)</h3>
<p>ä½¿ç”¨ <code>.tap()</code>ã€‚é€»è¾‘æ‰§è¡Œå®Œï¼Œæµæ°´çº¿ç»§ç»­ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyStartPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    <span class="hljs-comment">// å‚æ•°1: æ’ä»¶åç§°ï¼ˆå»ºè®®å†™ç±»åï¼‰ï¼Œå‚æ•°2: å›è°ƒ</span>
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compile</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyStartPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'&gt;&gt;&gt; ç¼–è¯‘å™¨å¯åŠ¨ï¼Œå‡†å¤‡å¹²æ´»ï¼'</span>);
    });
  }
}
</code></pre>
<h3 data-id="heading-8">2. å¼‚æ­¥é’©å­ (AsyncHook)</h3>
<p>ç±»ä¼¼äº <code>emit</code> è¿™ç§æ¶‰åŠæ–‡ä»¶ I/O çš„æ“ä½œï¼Œé€šå¸¸æ˜¯å¼‚æ­¥çš„ã€‚ä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<p>æ–¹å¼ Aï¼šå›è°ƒé£æ ¼ (tapAsync)</p>
<p>æ³¨æ„ï¼šåƒä¸‡åˆ«å¿˜äº†è°ƒç”¨ callback()ï¼Œå¦åˆ™æ„å»ºä¼šå¡æ­»ï¼</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileListPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapAsync</span>(<span class="hljs-string">'FileListPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation, callback</span>) =&gt;</span> {
      <span class="hljs-comment">// 1. è¯»å–å½“å‰ç”Ÿæˆçš„æ‰€æœ‰èµ„æºåç§°</span>
      <span class="hljs-keyword">const</span> fileNames = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>);
      <span class="hljs-keyword">const</span> content = <span class="hljs-string">`Generated files:\n <span class="hljs-subst">${fileNames.join(<span class="hljs-string">'\n'</span>)}</span>`</span>;

      <span class="hljs-comment">// 2. å‘è¾“å‡ºåˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æ–‡ä»¶</span>
      compilation.<span class="hljs-property">assets</span>[<span class="hljs-string">'file-list.txt'</span>] = {
        <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> content,
        <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> content.<span class="hljs-property">length</span>
      };

      <span class="hljs-comment">// 3. é€šçŸ¥ Webpack ç»§ç»­</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ–‡ä»¶åˆ—è¡¨å·²ç”Ÿæˆ'</span>);
      <span class="hljs-title function_">callback</span>(); 
    });
  }
}
</code></pre>
<p>æ–¹å¼ Bï¼šPromise é£æ ¼ (tapPromise)</p>
<p>è¿”å›ä¸€ä¸ª Promiseï¼ŒWebpack ä¼šç­‰å¾…å®ƒ resolveã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tapPromise</span>(<span class="hljs-string">'MyPromisePlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¼‚æ­¥ä»»åŠ¡å®Œæˆ'</span>);
      <span class="hljs-title function_">resolve</span>();
    }, <span class="hljs-number">1000</span>);
  });
});
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€ é¿å‘æŒ‡å—ï¼šCompiler vs Compilation</h2>
<p>åˆå­¦è€…æœ€å¤§çš„å›°æƒ‘å¾€å¾€æ˜¯ï¼š <strong>â€œæˆ‘åˆ°åº•è¯¥ç”¨ <code>compiler.hooks</code> è¿˜æ˜¯ <code>compilation.hooks</code>ï¼Ÿâ€</strong></p>























<table><thead><tr><th><strong>å¯¹è±¡</strong></th><th><strong>ä½œç”¨åŸŸ</strong></th><th><strong>å…³æ³¨ç‚¹</strong></th><th><strong>ä¸¾ä¾‹</strong></th></tr></thead><tbody><tr><td><strong>Compiler</strong></td><td><strong>å®è§‚</strong> (æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ)</td><td>æ„å»ºçš„èµ·æ­¢ã€é…ç½®ã€ç¯å¢ƒ</td><td>â€œä»€ä¹ˆæ—¶å€™å¼€å§‹è·‘ï¼Ÿâ€ã€â€œä»€ä¹ˆæ—¶å€™å†™å®Œæ–‡ä»¶ï¼Ÿâ€</td></tr><tr><td><strong>Compilation</strong></td><td><strong>å¾®è§‚</strong> (å•æ¬¡æ„å»º)</td><td>å…·ä½“çš„æ¨¡å—ã€ä¾èµ–ã€ä»£ç ç”Ÿæˆ</td><td>â€œå¦‚ä½•å‹ç¼©è¿™ä¸ª JSï¼Ÿâ€ã€â€œè¿™ä¸ª CSS çš„ Hash æ€ä¹ˆç®—ï¼Ÿâ€</td></tr></tbody></table>
<p>ä½¿ç”¨åŸåˆ™ï¼š</p>
<p>ä¸€èˆ¬æˆ‘ä»¬é€šè¿‡ compiler.hooks.compilation ä½œä¸ºå…¥å£ï¼Œæ‹¿åˆ° compilation å®ä¾‹ï¼Œç„¶åå†å»æ³¨å†Œ compilation.hooks æ¥å¤„ç†å…·ä½“çš„èµ„æºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
  <span class="hljs-comment">// ç°åœ¨ä½ å¯ä»¥æ“ä½œå…·ä½“çš„æ¨¡å—é’©å­äº†</span>
  compilation.<span class="hljs-property">hooks</span>.<span class="hljs-property">optimizeChunkAssets</span>.<span class="hljs-title function_">tap</span>(...)
});
</code></pre>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>æŒæ¡ <code>compiler.hooks</code> æ˜¯é€šå¾€ Webpack é«˜çº§ç©æ³•çš„å¿…ç»ä¹‹è·¯ã€‚</p>
<ol>
<li><strong>EntryOption/Run</strong>: é…ç½®ä¸é¢„å¤„ç†ã€‚</li>
<li><strong>Compilation</strong>: æ·±å…¥æ¨¡å—å¤„ç†çš„å…¥å£ã€‚</li>
<li><strong>Emit</strong>: ä¿®æ”¹æœ€ç»ˆäº§ç‰©çš„æœ€åæœºä¼šï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚</li>
<li><strong>Done</strong>: ç»Ÿè®¡ä¸é€šçŸ¥ã€‚</li>
</ol>
<p>ç†è§£äº†è¿™æ¡æµæ°´çº¿ï¼Œä½ å°±æ‹¥æœ‰äº†éšæ„å®šåˆ¶å‰ç«¯æ„å»ºæµç¨‹çš„èƒ½åŠ›ã€‚ Happy Coding!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å·§å¦™æµè§ˆå™¨äº‹ä»¶ç›‘å¬APIï¼šaddEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°]]></title>    <link>https://juejin.cn/post/7575735719076249606</link>    <guid>https://juejin.cn/post/7575735719076249606</guid>    <pubDate>2025-11-24T02:43:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575735719076249606" data-draft-id="7575937594339213353" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å·§å¦™æµè§ˆå™¨äº‹ä»¶ç›‘å¬APIï¼šaddEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-24T02:43:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="X_hope"/> <meta itemprop="url" content="https://juejin.cn/user/4365481627355447"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å·§å¦™æµè§ˆå™¨äº‹ä»¶ç›‘å¬APIï¼šaddEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4365481627355447/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    X_hope
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:43:36.000Z" title="Mon Nov 24 2025 02:43:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œ<code>addEventListener</code> æ˜¯æˆ‘ä»¬ç»‘å®šäº‹ä»¶ç›‘å¬å™¨çš„"è€æœ‹å‹"ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬ä¹ æƒ¯åªä¼ å…¥å‰ä¸¤ä¸ªå‚æ•°â€”â€”äº‹ä»¶ç±»å‹å’Œå›è°ƒå‡½æ•°ï¼Œå´å¸¸å¸¸å¿½ç•¥ç¬¬ä¸‰ä¸ªå‚æ•°çš„å¼ºå¤§èƒ½åŠ›ã€‚è¿™ä¸ªçœ‹ä¼¼"å¯é€‰"çš„å‚æ•°ï¼Œåœ¨ç°ä»£æµè§ˆå™¨çš„APIå‡çº§ä¸­æ—©å·²è¿›åŒ–æˆä¼˜åŒ–æ€§èƒ½ã€ç®€åŒ–é€»è¾‘çš„å…³é”®å·¥å…·ã€‚æœ¬æ–‡å°±å¸¦ä½ åƒé€å®ƒçš„ä¸¤ç§å½¢æ€ä¸æœ€æ–°ç”¨æ³•ï¼Œè®©äº‹ä»¶å¤„ç†æ›´ä¼˜é›…é«˜æ•ˆã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä»å¸ƒå°”å€¼åˆ°é…ç½®å¯¹è±¡ï¼šç¬¬ä¸‰ä¸ªå‚æ•°çš„è¿›åŒ–ä¹‹è·¯</h3>
<p>æ—©æœŸçš„ <code>addEventListener</code> ç¬¬ä¸‰ä¸ªå‚æ•°ä»…æ”¯æŒå¸ƒå°”å€¼ï¼ˆå‘½åä¸º <code>useCapture</code>ï¼‰ï¼Œç”¨äºæ§åˆ¶äº‹ä»¶ç›‘å¬å™¨åœ¨"æ•è·é˜¶æ®µ"è¿˜æ˜¯"å†’æ³¡é˜¶æ®µ"è§¦å‘ã€‚éšç€Webæ ‡å‡†çš„å‘å±•ï¼Œç°ä»£æµè§ˆå™¨ï¼ˆåŒ…æ‹¬Chrome 49+ã€Firefox 48+ç­‰ï¼‰å·²å…¨é¢æ”¯æŒä¼ å…¥<strong>é…ç½®å¯¹è±¡</strong>ï¼Œé™¤äº†å®ç°æ•è·æ§åˆ¶ï¼Œè¿˜æ‰©å±•äº†è¯¸å¤šå®ç”¨ç‰¹æ€§ã€‚</p>
<p>å½“å‰æœ€æ–°APIè§„èŒƒä¸­ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„å®Œæ•´å®šä¹‰ä¸ºï¼šå¯é€‰å‚æ•°ï¼Œå¯ä¼ å…¥å¸ƒå°”å€¼æˆ–åŒ…å« <code>capture</code>ã€<code>once</code>ã€<code>passive</code>ã€<code>signal</code> å±æ€§çš„é…ç½®å¯¹è±¡ï¼Œç”¨äºç²¾ç¡®æ§åˆ¶äº‹ä»¶ç›‘å¬è¡Œä¸ºã€‚</p>
<h3 data-id="heading-2">äºŒã€æ ¸å¿ƒå‚æ•°è¯¦è§£ï¼šæ¯ä¸ªç‰¹æ€§éƒ½è—ç€å®ç”¨æŠ€å·§</h3>
<p>æ— è®ºæ˜¯å¸ƒå°”å€¼å½¢å¼è¿˜æ˜¯é…ç½®å¯¹è±¡å½¢å¼ï¼Œæ ¸å¿ƒèƒ½åŠ›éƒ½å›´ç»•äº‹ä»¶ä¼ æ’­æœºåˆ¶ä¸ç›‘å¬å™¨ç”Ÿå‘½å‘¨æœŸå±•å¼€ã€‚ä¸‹é¢ç»“åˆæœ€æ–°APIç‰¹æ€§ä¸å®æˆ˜åœºæ™¯é€ä¸€è§£æã€‚</p>
<h4 data-id="heading-3">1. captureï¼šæ§åˆ¶äº‹ä»¶è§¦å‘çš„"é˜¶æ®µ"</h4>
<p>è¿™æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°æœ€åŸºç¡€çš„èƒ½åŠ›ï¼Œå¯¹åº”æ—©æœŸå¸ƒå°”å€¼ç”¨æ³•çš„æ ¸å¿ƒåŠŸèƒ½ã€‚äº‹ä»¶åœ¨DOMä¸­ä¼ æ’­åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šæ•è·é˜¶æ®µï¼ˆä»æ ¹å…ƒç´ åˆ°ç›®æ ‡å…ƒç´ ï¼‰ã€ç›®æ ‡é˜¶æ®µï¼ˆäº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ ï¼‰ã€å†’æ³¡é˜¶æ®µï¼ˆä»ç›®æ ‡å…ƒç´ å›é€€åˆ°æ ¹å…ƒç´ ï¼‰ã€‚</p>
<ul>
<li><strong>capture: false</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šç›‘å¬å™¨åœ¨<strong>å†’æ³¡é˜¶æ®µ</strong>è§¦å‘ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼Œèƒ½è®©äº‹ä»¶è‡ªç„¶å‘ä¸Šä¼ æ’­</li>
<li><strong>capture: true</strong>ï¼šç›‘å¬å™¨åœ¨<strong>æ•è·é˜¶æ®µ</strong>è§¦å‘ï¼Œå¯å®ç°"æå‰æ‹¦æˆª"äº‹ä»¶çš„æ•ˆæœ</li>
</ul>
<p><strong>å®æˆ˜åœºæ™¯ï¼šç‚¹å‡»é®ç½©å…³é—­å¼¹çª—</strong>ï¼Œé€šè¿‡æ•è·é˜¶æ®µæå‰æ‹¦æˆªäº‹ä»¶ï¼Œé¿å…äº‹ä»¶å†’æ³¡åˆ°å¼¹çª—å†…éƒ¨å…ƒç´ æ—¶è¢«å¹²æ‰°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> mask = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'mask'</span>);
<span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal'</span>);

<span class="hljs-comment">// æ•è·é˜¶æ®µç›‘å¬é®ç½©ç‚¹å‡»ï¼Œä¼˜å…ˆè§¦å‘</span>
mask.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
}, { <span class="hljs-attr">capture</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// å†’æ³¡é˜¶æ®µç›‘å¬å¼¹çª—å†…å®¹ç‚¹å‡»ï¼Œä¸ä¼šè¢«é®ç½©çš„æ•è·ç›‘å¬å¹²æ‰°</span>
modal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  e.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// é˜»æ­¢äº‹ä»¶ç»§ç»­å†’æ³¡åˆ°é®ç½©</span>
});
</code></pre>
<h4 data-id="heading-4">2. onceï¼šè®©ç›‘å¬å™¨"è‡ªåŠ¨ç¦»èŒ"</h4>
<p>å½“ <code>once: true</code> æ—¶ï¼Œç›‘å¬å™¨åœ¨ç¬¬ä¸€æ¬¡è§¦å‘åä¼šè‡ªåŠ¨ä»å…ƒç´ ä¸Šç§»é™¤ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ <code>removeEventListener</code>ï¼Œç‰¹åˆ«é€‚åˆä¸€æ¬¡æ€§æ“ä½œåœºæ™¯ã€‚</p>
<p><strong>å®æˆ˜åœºæ™¯ï¼šè¡¨å•æäº¤é˜²é‡å¤ç‚¹å‡»</strong>ï¼Œé¿å…ç”¨æˆ·å¿«é€Ÿå¤šæ¬¡ç‚¹å‡»æäº¤æŒ‰é’®å¯¼è‡´é‡å¤è¯·æ±‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">form</span> = document.getElementById(<span class="hljs-string">'myForm'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">submitBtn</span> = form.querySelector(<span class="hljs-string">'button[type="submit"]'</span>)<span class="hljs-comment">;</span>

form.addEventListener('submit', async (e) =&gt; {
  e.preventDefault()<span class="hljs-comment">;</span>
  <span class="hljs-attr">submitBtn.disabled</span> = <span class="hljs-literal">true</span><span class="hljs-comment">; // è¾…åŠ©ç¦ç”¨æŒ‰é’®</span>
  try {
    const <span class="hljs-attr">formData</span> = new FormData(form)<span class="hljs-comment">;</span>
    await fetch('/api/submit', { method: 'POST', body: formData })<span class="hljs-comment">;</span>
    alert('æäº¤æˆåŠŸ')<span class="hljs-comment">;</span>
  } catch (err) {
    alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•')<span class="hljs-comment">;</span>
    <span class="hljs-attr">submitBtn.disabled</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  }
}, { once: true })<span class="hljs-comment">; // æäº¤ä¸€æ¬¡åè‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨</span>
</code></pre>
<p>ç›¸æ¯”æ‰‹åŠ¨ç®¡ç†ç›‘å¬å™¨ï¼Œ<code>once</code> ä¸ä»…ç®€åŒ–ä»£ç ï¼Œè¿˜èƒ½é¿å…å› é€»è¾‘é—æ¼å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p>
<h4 data-id="heading-5">3. passiveï¼šæ‹¯æ•‘ç§»åŠ¨ç«¯æ»šåŠ¨æ€§èƒ½</h4>
<p>è¿™æ˜¯ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒçš„å…³é”®å‚æ•°ã€‚å½“ <code>passive: true</code> æ—¶ï¼Œæµè§ˆå™¨ä¼šæå‰çŸ¥é“ç›‘å¬å™¨**<code>preventDefault()</code>** <strong>ä¸ä¼šè°ƒç”¨</strong> ï¼Œä»è€Œæ— éœ€ç­‰å¾…ç›‘å¬å™¨æ‰§è¡Œå®Œæˆå°±èƒ½ç«‹å³å“åº”æ»šåŠ¨ï¼Œå½»åº•è§£å†³ç§»åŠ¨ç«¯æ»šåŠ¨å¡é¡¿é—®é¢˜ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šscrollã€touchstartã€wheelç­‰ä¸æ»šåŠ¨ç›¸å…³çš„äº‹ä»¶ï¼Œç›®å‰ä¸»æµæµè§ˆå™¨å·²é»˜è®¤å¯¹éƒ¨åˆ†äº‹ä»¶å¼€å¯passiveï¼Œä½†æ˜¾å¼å£°æ˜æ›´ç¨³å¦¥ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç§»åŠ¨ç«¯æ»šåŠ¨ç›‘å¬ä¼˜åŒ–</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> backToTop = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'backToTop'</span>);
  <span class="hljs-comment">// æ»šåŠ¨è¶…è¿‡300pxæ˜¾ç¤ºå›åˆ°é¡¶éƒ¨æŒ‰é’®</span>
  backToTop.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> &gt; <span class="hljs-number">300</span> ? <span class="hljs-string">'block'</span> : <span class="hljs-string">'none'</span>;
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// æ˜ç¡®å£°æ˜ä¸ä¼šé˜»æ­¢é»˜è®¤æ»šåŠ¨</span>

<span class="hljs-comment">// é”™è¯¯ç”¨æ³•ï¼špassiveä¸ºtrueæ—¶è°ƒç”¨preventDefaultä¼šæŠ¥é”™</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'touchmove'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// æ§åˆ¶å°ä¼šæŠ›å‡ºè­¦å‘Š</span>
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h4 data-id="heading-6">4. signalï¼šç›‘å¬å™¨çš„"æ‰¹é‡ç®¡ç†å¼€å…³"</h4>
<p>è¿™æ˜¯è¾ƒæ–°çš„APIç‰¹æ€§ï¼ˆ2025å¹´å·²è¢«ä¸»æµæµè§ˆå™¨æ”¯æŒï¼‰ï¼Œé€šè¿‡ä¼ å…¥ <code>AbortSignal</code> å¯¹è±¡ï¼Œå¯å®ç°å¯¹ç›‘å¬å™¨çš„æ‰¹é‡ç§»é™¤æˆ–æ¡ä»¶æ€§å–æ¶ˆï¼Œå°¤å…¶é€‚åˆç»„ä»¶åŒ–å¼€å‘ä¸­"ç»„ä»¶å¸è½½æ—¶æ¸…ç†ç›‘å¬å™¨"çš„åœºæ™¯ã€‚</p>
<p><strong>å®ç°åŸç†</strong>ï¼šåˆ›å»º <code>AbortController</code> å®ä¾‹ï¼Œå…¶ <code>signal</code> å±æ€§ä¼ å…¥ç›‘å¬å™¨é…ç½®ï¼Œè°ƒç”¨ <code>abort()</code> æ–¹æ³•å³å¯è§¦å‘æ‰€æœ‰å…³è”ç›‘å¬å™¨çš„ç§»é™¤ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹</span>
<span class="hljs-keyword">const</span> abortController = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
<span class="hljs-keyword">const</span> { signal } = abortController;

<span class="hljs-comment">// ç»‘å®šå¤šä¸ªç›‘å¬å™¨ï¼Œå…±äº«åŒä¸€ä¸ªsignal</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll, { signal });
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize, { signal });
button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick, { signal });

<span class="hljs-comment">// ç»„ä»¶å¸è½½æ—¶æ‰¹é‡ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">destroyComponent</span>(<span class="hljs-params"/>) {
  abortController.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// ä¸€æ¬¡è°ƒç”¨ï¼Œæ‰€æœ‰å…³è”ç›‘å¬å™¨å¤±æ•ˆ</span>
}

<span class="hljs-comment">// æ¡ä»¶æ€§å–æ¶ˆï¼šæ¯”å¦‚3ç§’åè‡ªåŠ¨åœæ­¢ç›‘å¬æ»šåŠ¨</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  abortController.<span class="hljs-title function_">abort</span>(<span class="hljs-string">'è‡ªåŠ¨å–æ¶ˆç›‘å¬'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(signal.<span class="hljs-property">reason</span>); <span class="hljs-comment">// è¾“å‡º"è‡ªåŠ¨å–æ¶ˆç›‘å¬"</span>
}, <span class="hljs-number">3000</span>);
</code></pre>
<h3 data-id="heading-7">ä¸‰ã€ç»¼åˆå®æˆ˜ï¼šæ‰“é€ é«˜æ•ˆçš„åˆ—è¡¨äº¤äº’ç»„ä»¶</h3>
<p>ç»“åˆä¸Šè¿°å‚æ•°ç‰¹æ€§ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ª"å¯ç¼–è¾‘åˆ—è¡¨"ç»„ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼šç‚¹å‡»åˆ—è¡¨é¡¹å±•å¼€ç¼–è¾‘æ¡†ã€ç¼–è¾‘ç¡®è®¤æŒ‰é’®ä»…ç”Ÿæ•ˆä¸€æ¬¡ã€ç»„ä»¶é”€æ¯æ—¶æ¸…ç†æ‰€æœ‰ç›‘å¬å™¨ã€æ»šåŠ¨æ—¶é«˜äº®å½“å‰å¯è§†åŒºåŸŸåˆ—è¡¨é¡¹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EditableList</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">containerId</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(containerId);
    <span class="hljs-comment">// åˆ›å»ºç›‘å¬å™¨æ§åˆ¶å™¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. äº‹ä»¶å§”æ‰˜ç›‘å¬åˆ—è¡¨é¡¹ç‚¹å‡»ï¼ˆæ•è·é˜¶æ®µä¼˜åŒ–æ€§èƒ½ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">matches</span>(<span class="hljs-string">'.list-item'</span>)) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showEditBox</span>(e.<span class="hljs-property">target</span>);
      }
    }, { <span class="hljs-attr">capture</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">signal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-property">signal</span> });

    <span class="hljs-comment">// 2. æ»šåŠ¨ç›‘å¬ï¼šé«˜äº®å¯è§†åŒºåŸŸåˆ—è¡¨é¡¹ï¼ˆpassiveä¼˜åŒ–æ»šåŠ¨ï¼‰</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">highlightVisibleItems</span>();
    }, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">signal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-property">signal</span> });
  }

  <span class="hljs-title function_">showEditBox</span>(<span class="hljs-params">item</span>) {
    <span class="hljs-keyword">const</span> editBox = item.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.edit-box'</span>);
    <span class="hljs-keyword">const</span> confirmBtn = editBox.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.confirm-btn'</span>);
    editBox.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'block'</span>;

    <span class="hljs-comment">// 3. ç¡®è®¤æŒ‰é’®ä»…ç”Ÿæ•ˆä¸€æ¬¡ï¼ˆonceè‡ªåŠ¨ç§»é™¤ç›‘å¬å™¨ï¼‰</span>
    confirmBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> input = editBox.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'input'</span>);
      item.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.content'</span>).<span class="hljs-property">textContent</span> = input.<span class="hljs-property">value</span>;
      editBox.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
    }, { <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">signal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-property">signal</span> });
  }

  <span class="hljs-title function_">highlightVisibleItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å®ç°å¯è§†åŒºåŸŸåˆ¤æ–­é€»è¾‘...</span>
  }

  <span class="hljs-comment">// ç»„ä»¶é”€æ¯ï¼šæ‰¹é‡æ¸…ç†æ‰€æœ‰ç›‘å¬å™¨</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">abortController</span>.<span class="hljs-title function_">abort</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">remove</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç»„ä»¶</span>
<span class="hljs-keyword">const</span> list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EditableList</span>(<span class="hljs-string">'list-container'</span>);
<span class="hljs-comment">// é¡µé¢å…³é—­æˆ–ç»„ä»¶å¸è½½æ—¶é”€æ¯</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function">() =&gt;</span> list.<span class="hljs-title function_">destroy</span>());
</code></pre>
<h3 data-id="heading-8">å››ã€2025å¹´æœ€æ–°å…¼å®¹æ€§ä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-9">1. å…¼å®¹æ€§è¯´æ˜</h4>

































<table><thead><tr><th>å‚æ•°ç‰¹æ€§</th><th>Chrome</th><th>Firefox</th><th>Safari</th><th>Edge</th></tr></thead><tbody><tr><td>captureï¼ˆå¸ƒå°”å€¼ï¼‰</td><td>å…¨ç‰ˆæœ¬</td><td>å…¨ç‰ˆæœ¬</td><td>å…¨ç‰ˆæœ¬</td><td>å…¨ç‰ˆæœ¬</td></tr><tr><td>once/passive</td><td>49+</td><td>48+</td><td>10.1+</td><td>16+</td></tr><tr><td>signal</td><td>88+</td><td>91+</td><td>15.4+</td><td>88+</td></tr></tbody></table>
<p>å¯¹äºéœ€è¦å…¼å®¹æ—§æµè§ˆå™¨çš„åœºæ™¯ï¼Œå¯é€šè¿‡ <code>eventListenerOptionsPassive</code> ç­‰ç‰¹æ€§æ£€æµ‹å·¥å…·åšé™çº§å¤„ç†ã€‚</p>
<h4 data-id="heading-10">2. æœ€ä½³å®è·µæ€»ç»“</h4>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨<strong>é…ç½®å¯¹è±¡</strong>å½¢å¼ï¼Œæ›¿ä»£ä¼ ç»Ÿå¸ƒå°”å€¼ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§</li>
<li>ç§»åŠ¨ç«¯æ»šåŠ¨ç›¸å…³äº‹ä»¶å¿…åŠ  <code>passive: true</code>ï¼Œæå‡æ»šåŠ¨æµç•…åº¦</li>
<li>ä¸€æ¬¡æ€§æ“ä½œï¼ˆå¦‚è¡¨å•æäº¤ã€å¼•å¯¼å¼¹çª—ï¼‰ç”¨ <code>once: true</code>ï¼Œç®€åŒ–ç›‘å¬å™¨ç®¡ç†</li>
<li>ç»„ä»¶åŒ–å¼€å‘ä¸­ï¼Œç”¨ <code>signal</code> å®ç°ç›‘å¬å™¨æ‰¹é‡æ¸…ç†ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
<li>äº‹ä»¶å§”æ‰˜åœºæ™¯ä¸­ï¼Œåˆç†åˆ©ç”¨ <code>capture</code> é˜¶æ®µä¼˜åŒ–äº‹ä»¶å“åº”é¡ºåº</li>
</ul>
<h3 data-id="heading-11">äº”ã€ç»“è¯­</h3>
<p>addEventListenerçš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä»ç®€å•çš„å¸ƒå°”å€¼è¿›åŒ–ä¸ºåŠŸèƒ½ä¸°å¯Œçš„é…ç½®å¯¹è±¡ï¼ŒèƒŒåæ˜¯Webæ ‡å‡†å¯¹å¼€å‘æ•ˆç‡ä¸æ€§èƒ½ä¼˜åŒ–çš„ä¸æ–­è¿½æ±‚ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶éä¸ä¼šç”¨APIï¼Œè€Œæ˜¯å¿½ç•¥äº†å®ƒçš„è¿›é˜¶èƒ½åŠ›ã€‚åˆç†è¿ç”¨ <code>capture</code>ã€<code>once</code>ã€<code>passive</code>ã€<code>signal</code> è¿™äº›ç‰¹æ€§ï¼Œèƒ½è®©æˆ‘ä»¬çš„äº‹ä»¶å¤„ç†ä»£ç æ›´ç®€æ´ã€æ€§èƒ½æ›´ä¼˜å¼‚ã€‚ä¸‹æ¬¡ç»‘å®šäº‹ä»¶æ—¶ï¼Œåˆ«å†å¿½ç•¥è¿™ä¸ª"å°è€Œå¼ºå¤§"çš„å‚æ•°äº†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ â€” Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575718948298047539</link>    <guid>https://juejin.cn/post/7575718948298047539</guid>    <pubDate>2025-11-24T02:58:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575718948298047539" data-draft-id="7575457788664250420" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ â€” Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Linux"/> <meta itemprop="datePublished" content="2025-11-24T02:58:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cyan_RA9"/> <meta itemprop="url" content="https://juejin.cn/user/156585427741979"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ“ä½œç³»ç»Ÿé¢è¯•é¢˜ â€” Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/156585427741979/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cyan_RA9
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-24T02:58:59.000Z" title="Mon Nov 24 2025 02:58:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>Author</strong> : Cyan_RA9<br/>
<strong>Source</strong> : ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fnotes.kamacoder.com%2F" target="_blank" title="https://notes.kamacoder.com/" ref="nofollow noopener noreferrer">å¡ç ç¬”è®°</a>ã€‘ç½‘ç«™<br/>
<strong>Question</strong> : Linuxä¸­å¦‚ä½•æŸ¥çœ‹æŸä¸ªç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Ÿ</p>
</blockquote>
<h2 data-id="heading-0">ã€ç®€è¦å›ç­”ã€‘</h2>
<ul>
<li>åœ¨Linuxä¸­ï¼ŒæŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨çš„æ–¹æ³•æŒ‰åœºæ™¯å¯åˆ†ä¸ºï¼š
<ol>
<li><strong>å¿«é€Ÿæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«ç›‘å¬</strong>ï¼š<code>ss -tuln | grep :[ç«¯å£å·]</code> æˆ– <code>netstat -tuln | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å®šä½ç›‘å¬ç«¯å£çš„è¿›ç¨‹</strong>ï¼š<code>sudo lsof -i :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å…¨é¢æŸ¥çœ‹ç«¯å£æ‰€æœ‰è¿æ¥çŠ¶æ€åŠè¿›ç¨‹</strong>ï¼š<code>sudo ss -taunp | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>éªŒè¯ç«¯å£å¯¹å¤–å¼€æ”¾æ€§</strong>ï¼š<code>nmap -sT -p [ç«¯å£å·] localhost</code> æˆ– <code>telnet localhost [ç«¯å£å·]</code>ã€‚</li>
</ol>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">ã€è¯¦ç»†å›ç­”ã€‘</h2>
<ol>
<li><strong>å¿«é€Ÿæ£€æŸ¥ç«¯å£æ˜¯å¦è¢«ç›‘å¬</strong>ï¼š
<ul>
<li><strong>å‘½ä»¤</strong>ï¼š<code>ss -tuln | grep :[ç«¯å£å·]</code> æˆ– <code>netstat -tuln | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å‚æ•°è§£æ</strong>ï¼š<br/>
â‘  <strong>-t</strong>ï¼šæ£€æŸ¥TCPåè®®ç«¯å£ã€‚<br/>
â‘¡ <strong>-u</strong>ï¼šæ£€æŸ¥UDPåè®®ç«¯å£ã€‚<br/>
â‘¢ <strong>-l</strong>ï¼š<strong>ä»…</strong>æ˜¾ç¤ºç›‘å¬çŠ¶æ€ï¼ˆ<strong>LISTEN</strong>ï¼‰çš„ç«¯å£ã€‚<br/>
â‘£ <strong>-n</strong>ï¼šç¦ç”¨åŸŸåè§£æï¼Œç›´æ¥æ˜¾ç¤ºIPå’Œç«¯å£å·ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€ŸéªŒè¯æŸä¸ªç«¯å£æ˜¯å¦æ­£åœ¨ç­‰å¾…æ–°çš„è¿æ¥è¯·æ±‚ï¼ˆå³å¤„äº LISTEN çŠ¶æ€ï¼‰ã€‚è¿™æ˜¯å¯åŠ¨æœåŠ¡å‰æœ€å¸¸è§çš„æ£€æŸ¥ã€‚</li>
</ul>
</li>
<li><strong>å®šä½ç›‘å¬ç«¯å£çš„è¿›ç¨‹</strong>ï¼š
<ul>
<li>
<p><strong>å‘½ä»¤</strong>ï¼š<code>sudo lsof -i :[ç«¯å£å·]</code>ã€‚</p>
</li>
<li>
<p><strong>è¾“å‡ºç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">COMMAND  PID  <span class="hljs-keyword">USER</span>   FD   TYPE DEVICE SIZE<span class="hljs-operator">/</span>OFF NODE NAME  
nginx    <span class="hljs-number">1234</span> root    <span class="hljs-number">6</span>u  IPv4 <span class="hljs-number">123456</span>      <span class="hljs-number">0</span>t0  TCP <span class="hljs-operator">*</span>:<span class="hljs-number">80</span> (LISTEN)  
</code></pre>
</li>
<li>
<p><strong>å…³é”®ä¿¡æ¯</strong>ï¼š<br/>
â‘  <strong>COMMAND</strong>ï¼šè¿›ç¨‹åç§°ï¼ˆå¦‚nginxï¼‰ã€‚<br/>
â‘¡ <strong>PID</strong>ï¼šè¿›ç¨‹IDï¼ˆå¦‚1234ï¼‰ã€‚<br/>
â‘¢ <strong>USER</strong>ï¼šè¿è¡Œè¿›ç¨‹çš„ç”¨æˆ·ï¼ˆå¦‚rootï¼‰ã€‚</p>
</li>
<li>
<p><strong>æƒé™è¯´æ˜</strong>ï¼šæ™®é€šç”¨æˆ·å¯èƒ½æ— æ³•æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ï¼Œéœ€ä½¿ç”¨ <strong>sudo</strong> ææƒã€‚</p>
</li>
<li>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåœ¨ç¡®è®¤ç«¯å£å¤„äºç›‘å¬çŠ¶æ€åï¼Œç²¾ç¡®æ‰¾å‡ºæ˜¯å“ªä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨è¯¥ç«¯å£ã€‚lsof æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œä¸ä»…èƒ½çœ‹ç½‘ç»œè¿æ¥ï¼Œè¿˜èƒ½çœ‹æ–‡ä»¶å¥æŸ„ã€‚</p>
</li>
</ul>
</li>
<li><strong>å…¨é¢æŸ¥çœ‹ç«¯å£æ‰€æœ‰è¿æ¥çŠ¶æ€åŠè¿›ç¨‹</strong>ï¼š
<ul>
<li><strong>å‘½ä»¤</strong>ï¼š<code>sudo ss -taunp | grep :[ç«¯å£å·]</code> æˆ– <code>sudo netstat -taunp | grep :[ç«¯å£å·]</code>ã€‚</li>
<li><strong>å‚æ•°è§£æ</strong>ï¼š<br/>
â‘  <strong>-t</strong>ï¼šæ£€æŸ¥TCPåè®®ç«¯å£ã€‚<br/>
â‘¡ <strong>-u</strong>ï¼šæ£€æŸ¥UDPåè®®ç«¯å£ã€‚<br/>
â‘¢ <strong>-a</strong>: æ˜¾ç¤ºæ‰€æœ‰è¿æ¥ï¼ˆåŒ…æ‹¬ç›‘å¬ã€å·²å»ºç«‹ã€ç­‰å¾…ç­‰å„ç§çŠ¶æ€ï¼‰ã€‚<br/>
â‘¢ <strong>-n</strong>ï¼šç¦ç”¨åŸŸåè§£æï¼Œç›´æ¥æ˜¾ç¤ºIPå’Œç«¯å£å·ã€‚<br/>
â‘£ <strong>-p</strong>: æ˜¾ç¤ºä½¿ç”¨ç«¯å£çš„è¿›ç¨‹IDå’Œåç§°ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€è¦äº†è§£æŸä¸ªç«¯å£å½“å‰æ‰€æœ‰è¿æ¥çŠ¶æ€ï¼ˆLISTENã€ESTABLISHEDã€TIME_WAITã€CLOSE_WAITç­‰ï¼‰ä»¥åŠå…·ä½“æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨å®ƒï¼Œè¿›è¡Œæ›´å…¨é¢çš„åˆ†æã€‚</li>
</ul>
</li>
<li><strong>éªŒè¯ç«¯å£å¯¹å¤–å¼€æ”¾æ€§</strong>ï¼š
<ul>
<li><strong>å‘½ä»¤</strong>ï¼š<code>nmap -sT -p [ç«¯å£å·] localhost</code> æˆ– <code>telnet localhost [ç«¯å£å·]</code>ã€‚</li>
<li><strong><code>namp</code>å‚æ•°åˆ†è§£</strong>ï¼š<br/>
â‘  <strong>-sT</strong>ï¼šTCP å…¨è¿æ¥æ‰«æï¼ˆæ¨¡æ‹Ÿæ­£å¸¸è¿æ¥è¡Œä¸ºï¼Œæ›´å¯é ï¼‰ï¼›<br/>
â‘¡ <strong>-p</strong>ï¼šæŒ‡å®šæ‰«æçš„ç«¯å£å·ã€‚</li>
<li><strong><code>namp</code>è¾“å‡ºçŠ¶æ€</strong>ï¼š<br/>
â‘  <strong>open</strong>ï¼šç«¯å£å¼€æ”¾ä¸”å¯è®¿é—®ï¼›<br/>
â‘¡ <strong>closed</strong>ï¼šç«¯å£æœªè¢«å ç”¨ï¼›<br/>
â‘¢ <strong>filtered</strong>ï¼šç«¯å£è¢«é˜²ç«å¢™æ‹¦æˆªã€‚æ— æ³•ç¡®å®šå…¶çŠ¶æ€ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ã€çŸ¥è¯†æ‹“å±•ã€‘</h2>
<ol>
<li>
<p><strong>æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨çš„ä¸»è¦æ‰‹æ®µ</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ed636cd4174b5b910019377fde8fbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3lhbl9SQTk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764557939&amp;x-signature=Il3GMndAm6pTdAS0SxLV%2FocRNKs%3D" alt="methods_detect_port.jpg" loading="lazy"/></p>
</li>
<li>
<p><strong>å·¥å…·å¯¹æ¯”ï¼šss vs netstat</strong>ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>

























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>ss</strong></th><th><strong>netstat</strong></th></tr></thead><tbody><tr><td><strong>æ•°æ®æ¥æº</strong></td><td>ç›´æ¥è¯»å–å†…æ ¸socketè¡¨</td><td>è§£æ<code>/proc/net</code>æ–‡ä»¶</td></tr><tr><td><strong>é€Ÿåº¦</strong></td><td>æ›´å¿«ï¼ˆé€‚åˆé«˜è´Ÿè½½æœåŠ¡å™¨ï¼‰</td><td>è¾ƒæ…¢</td></tr><tr><td><strong>ç»´æŠ¤çŠ¶æ€</strong></td><td>æ´»è·ƒç»´æŠ¤ï¼ˆæ¨èä½¿ç”¨ï¼‰</td><td>å·²é€æ­¥æ·˜æ±°</td></tr></tbody></table>
</li>
<li>
<p>ç«¯å£çŠ¶æ€è§£æï¼ˆ<code>ss</code>/<code>netstat</code>è¾“å‡ºï¼‰:</p>
<ul>
<li><strong>LISTEN</strong>ï¼šç«¯å£æ­£åœ¨ç›‘å¬ï¼Œç­‰å¾…è¿æ¥ã€‚</li>
<li><strong>ESTABLISHED</strong>ï¼šå·²å»ºç«‹æ´»è·ƒè¿æ¥ã€‚</li>
<li><strong>TIME_WAIT</strong>ï¼šè¿æ¥å·²å…³é—­ï¼Œç­‰å¾…å†…æ ¸æ¸…ç†ï¼ˆå¯èƒ½çŸ­æš‚å ç”¨ç«¯å£ï¼‰ã€‚</li>
<li><strong>CLOSE_WAIT</strong>ï¼šè¿œç¨‹å·²å…³é—­è¿æ¥ï¼Œæœ¬åœ°æœªé‡Šæ”¾ã€‚</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[7ã€ä¿å­˜ç•Œé¢çŠ¶æ€]]></title>    <link>https://juejin.cn/post/7575425466905641023</link>    <guid>https://juejin.cn/post/7575425466905641023</guid>    <pubDate>2025-11-23T16:08:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575425466905641023" data-draft-id="7575468252656500777" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="7ã€ä¿å­˜ç•Œé¢çŠ¶æ€"/> <meta itemprop="keywords" content="Kotlin"/> <meta itemprop="datePublished" content="2025-11-23T16:08:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å± å¤«"/> <meta itemprop="url" content="https://juejin.cn/user/1533159252166510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            7ã€ä¿å­˜ç•Œé¢çŠ¶æ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1533159252166510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å± å¤«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:08:13.000Z" title="Sun Nov 23 2025 16:08:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ä¿å­˜ç•Œé¢çŠ¶æ€</h3>
<p>åœ¨ Jetpack Compose åº”ç”¨ä¸­ï¼Œæ­£ç¡®ä¿å­˜å’Œæ¢å¤ç•Œé¢çŠ¶æ€å¯¹äºæä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚å½“åº”ç”¨å› é‡æ–°åˆ›å»º activity æˆ–è¿›ç¨‹è€Œä¸¢å¤±ç•Œé¢çŠ¶æ€æ—¶ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°æ•°æ®ä¸¢å¤±æˆ–ç•Œé¢ä¸ä¸€è‡´çš„é—®é¢˜ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Jetpack Compose ä¸­ä¿å­˜å’Œæ¢å¤ç•Œé¢çŠ¶æ€ã€‚</p>
<hr/>
<h3 data-id="heading-1"><strong>1. ç•Œé¢çŠ¶æ€ä¸¢å¤±çš„åŸå› </strong></h3>
<p>Android åº”ç”¨å¯èƒ½ä¼šå› ä»¥ä¸‹äº‹ä»¶è€Œä¸¢å¤±ç•Œé¢çŠ¶æ€ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿå‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢</strong>ï¼šå¦‚å†…å­˜ä¸è¶³æ—¶ç³»ç»Ÿæ€æ‰è¿›ç¨‹ã€‚</li>
<li><strong>é…ç½®æ›´æ”¹</strong>ï¼šå¦‚å±å¹•æ—‹è½¬ã€è¯­è¨€åˆ‡æ¢ç­‰ã€‚</li>
<li><strong>ç”¨æˆ·å‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢</strong>ï¼šå¦‚ç”¨æˆ·æ˜¾å¼å…³é—­åº”ç”¨ã€‚</li>
</ul>
<p>å¯¹äºç”¨æˆ·å‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢ï¼Œç¬æ—¶çŠ¶æ€çš„ä¸¢å¤±é€šå¸¸æ˜¯åˆç†çš„ã€‚ä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä¿ç•™çŠ¶æ€å¯¹äºæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>2. ä¿å­˜ç•Œé¢çŠ¶æ€çš„ç­–ç•¥</strong></h3>
<p>æ ¹æ®çŠ¶æ€æå‡çš„ä½ç½®å’Œæ‰€éœ€çš„é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ API æ¥ä¿å­˜å’Œæ¢å¤ç•Œé¢çŠ¶æ€ã€‚</p>
<h4 data-id="heading-3"><strong>2.1 ç•Œé¢é€»è¾‘ä¸­çš„çŠ¶æ€ä¿å­˜</strong></h4>
<p>å½“çŠ¶æ€åœ¨ç•Œé¢é€»è¾‘ä¸­æå‡æ—¶ï¼ˆæ— è®ºæ˜¯åœ¨å¯ç»„åˆå‡½æ•°è¿˜æ˜¯ä½œç”¨åŸŸé™å®šä¸ºç»„åˆçš„æ™®é€šçŠ¶æ€å®¹å™¨ç±»ä¸­ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>rememberSaveable</code> åœ¨é‡æ–°åˆ›å»º activity å’Œè¿›ç¨‹ä¹‹åä¿ç•™çŠ¶æ€ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šä¿å­˜å•ä¸ªå¸ƒå°”å€¼ç•Œé¢å…ƒç´ çŠ¶æ€</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ChatBubble</span><span class="hljs-params">(message: <span class="hljs-type">Message</span>)</span></span> {
    <span class="hljs-keyword">var</span> showDetails <span class="hljs-keyword">by</span> rememberSaveable { mutableStateOf(<span class="hljs-literal">false</span>) }
    ClickableText(
        text = AnnotatedString(message.content),
        onClick = { showDetails = !showDetails }
    )
    <span class="hljs-keyword">if</span> (showDetails) {
        Text(message.timestamp)
    }
}
</code></pre>
<p><strong>å­˜å‚¨æœºåˆ¶</strong>ï¼š</p>
<ul>
<li><code>rememberSaveable</code> é€šè¿‡ä¿å­˜çš„å®ä¾‹çŠ¶æ€æœºåˆ¶å°†ç•Œé¢å…ƒç´ çŠ¶æ€å­˜å‚¨åœ¨ Bundle ä¸­ã€‚</li>
<li>å®ƒèƒ½å¤Ÿè‡ªåŠ¨å°†åŸºå…ƒç±»å‹å­˜å‚¨åˆ° Bundle ä¸­ã€‚å¯¹äºéåŸºå…ƒç±»å‹ï¼ˆå¦‚æ•°æ®ç±»ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>Parcelize</code> æ³¨è§£ã€<code>listSaver</code> å’Œ <code>mapSaver</code> ç­‰ Compose APIï¼Œæˆ–å®ç°è‡ªå®šä¹‰çš„ <code>Saver</code> ç±»ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼šä¿å­˜ <code>LazyListState</code></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">rememberLazyListState</span><span class="hljs-params">(
    initialFirstVisibleItemIndex: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>,
    initialFirstVisibleItemScrollOffset: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
)</span></span>: LazyListState {
    <span class="hljs-keyword">return</span> rememberSaveable(saver = LazyListState.Saver) {
        LazyListState(initialFirstVisibleItemIndex, initialFirstVisibleItemScrollOffset)
    }
}
</code></pre>
<h4 data-id="heading-4"><strong>2.2 ä¸šåŠ¡é€»è¾‘ä¸­çš„çŠ¶æ€ä¿å­˜</strong></h4>
<p>å½“ç•Œé¢å…ƒç´ çŠ¶æ€å› ä¸šåŠ¡é€»è¾‘éœ€è¦è¢«æå‡åˆ° ViewModel æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ ViewModel çš„ API æ¥ä¿å­˜çŠ¶æ€ã€‚</p>
<p><strong>ViewModel çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>ViewModel å®ä¾‹åœ¨é…ç½®æ›´æ”¹ï¼ˆå¦‚å±å¹•æ—‹è½¬ï¼‰åä»ç„¶å­˜åœ¨ï¼Œå› æ­¤æå‡åˆ° ViewModel çš„ç•Œé¢çŠ¶æ€ä¼šä¿ç•™åœ¨å†…å­˜ä¸­ã€‚</li>
<li>ä½† ViewModel å®ä¾‹åœ¨ç³»ç»Ÿå‘èµ·çš„è¿›ç¨‹ç»ˆæ­¢åå°†å¤±æ•ˆã€‚ä¸ºäº†æŒä¹…åŒ–çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>SavedStateHandle</code>ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼šä½¿ç”¨ <code>SavedStateHandle</code> ä¿å­˜ç•Œé¢å…ƒç´ çŠ¶æ€</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConversationViewModel</span>(savedStateHandle: SavedStateHandle) : ViewModel() {
    <span class="hljs-keyword">var</span> message <span class="hljs-keyword">by</span> savedStateHandle.saveable(stateSaver = TextFieldValue.Saver) {
        mutableStateOf(TextFieldValue(<span class="hljs-string">""</span>))
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">update</span><span class="hljs-params">(newMessage: <span class="hljs-type">TextFieldValue</span>)</span></span> {
        message = newMessage
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserInput</span><span class="hljs-params">(viewModel: <span class="hljs-type">ConversationViewModel</span> = viewModel()</span></span>) {
    TextField(
        value = viewModel.message,
        onValueChange = { viewModel.update(it) }
    )
}
</code></pre>
<p><strong><code>SavedStateHandle</code> çš„ API</strong>ï¼š</p>
<ul>
<li><strong><code>saveable</code> API</strong>ï¼šä»¥ <code>MutableState</code> å½¢å¼è¯»å–å’Œå†™å…¥ç•Œé¢å…ƒç´ çŠ¶æ€ï¼Œæ”¯æŒåŸºå…ƒç±»å‹å’Œè‡ªå®šä¹‰ <code>Saver</code>ã€‚</li>
<li><strong><code>getStateFlow</code> API</strong>ï¼šå­˜å‚¨ç•Œé¢å…ƒç´ çŠ¶æ€ï¼Œå¹¶å°†å…¶ç”¨ä½œæ¥è‡ª <code>SavedStateHandle</code> çš„æ•°æ®æµã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>3. æœ€ä½³å®è·µ</strong></h3>
<h4 data-id="heading-6"><strong>3.1 ç•Œé¢é€»è¾‘ä¸­çš„æœ€ä½³å®è·µ</strong></h4>
<ul>
<li><strong>é¿å…å­˜å‚¨å¤§å‹å¯¹è±¡</strong>ï¼š<code>rememberSaveable</code> ä½¿ç”¨ Bundle å­˜å‚¨ç•Œé¢çŠ¶æ€ï¼ŒBundle å¤§å°æœ‰é™ã€‚å­˜å‚¨å¤§å‹å¤æ‚å¯¹è±¡æˆ–å¯¹è±¡åˆ—è¡¨å¯èƒ½ä¼šå¯¼è‡´ <code>TransactionTooLargeException</code>ã€‚</li>
<li><strong>å­˜å‚¨æœ€å°‘å¿…éœ€çŠ¶æ€</strong>ï¼šä»…å­˜å‚¨æ¢å¤ç•Œé¢çŠ¶æ€æ‰€éœ€çš„æœ€å°‘æ•°æ®ï¼ˆå¦‚ ID æˆ–é”®ï¼‰ï¼Œå¹¶ä½¿ç”¨è¿™äº›æ•°æ®ä»æ•°æ®å±‚é‡æ–°ç”Ÿæˆå¤æ‚çŠ¶æ€ã€‚</li>
</ul>
<h4 data-id="heading-7"><strong>3.2 ä¸šåŠ¡é€»è¾‘ä¸­çš„æœ€ä½³å®è·µ</strong></h4>
<ul>
<li><strong>ä½¿ç”¨ <code>SavedStateHandle</code> å­˜å‚¨ç®€å•çŠ¶æ€</strong>ï¼š<code>SavedStateHandle</code> ä¹Ÿä½¿ç”¨ Bundle æœºåˆ¶ï¼Œå› æ­¤åº”ä»…ç”¨äºå­˜å‚¨ç®€å•çš„ç•Œé¢å…ƒç´ çŠ¶æ€ã€‚</li>
<li><strong>å¤æ‚çŠ¶æ€ä½¿ç”¨æ°¸ä¹…æ€§å­˜å‚¨</strong>ï¼šå±å¹•ç•Œé¢çŠ¶æ€å¯èƒ½éå¸¸å¤æ‚ä¸”åºå¤§ï¼Œä¸åº”å­˜å‚¨åœ¨ <code>SavedStateHandle</code> ä¸­ã€‚å¯ä»¥ä½¿ç”¨æœ¬åœ°æ°¸ä¹…æ€§å­˜å‚¨ï¼ˆå¦‚ Room æ•°æ®åº“ï¼‰æ¥å­˜å‚¨å¤æ‚æ•°æ®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>4. éªŒè¯çŠ¶æ€æ¢å¤</strong></h3>
<p>ä¸ºäº†éªŒè¯é‡æ–°åˆ›å»º activity æˆ–è¿›ç¨‹åï¼ŒCompose å…ƒç´ ä¸­ä½¿ç”¨ <code>rememberSaveable</code> å­˜å‚¨çš„çŠ¶æ€æ˜¯å¦å·²æ­£ç¡®æ¢å¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>StateRestorationTester</code>ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼šä½¿ç”¨ <code>StateRestorationTester</code> éªŒè¯çŠ¶æ€æ¢å¤</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testStateRestoration</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> tester = StateRestorationTester(context)
    tester.setContent {
        <span class="hljs-keyword">val</span> (value, setValue) = rememberSaveable { mutableStateOf(<span class="hljs-number">0</span>) }
        <span class="hljs-comment">// Test logic here</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>5. æ€»ç»“</strong></h3>
<ul>
<li><strong>ç•Œé¢é€»è¾‘ä¸­çš„çŠ¶æ€</strong>ï¼šä½¿ç”¨ <code>rememberSaveable</code> åœ¨é‡æ–°åˆ›å»º activity å’Œè¿›ç¨‹åä¿ç•™çŠ¶æ€ã€‚</li>
<li><strong>ä¸šåŠ¡é€»è¾‘ä¸­çš„çŠ¶æ€</strong>ï¼šå¦‚æœçŠ¶æ€è¢«æå‡åˆ° ViewModelï¼Œä½¿ç”¨ <code>SavedStateHandle</code> ä¿å­˜çŠ¶æ€ã€‚</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šé¿å…åœ¨ Bundle ä¸­å­˜å‚¨å¤§å‹å¤æ‚å¯¹è±¡ï¼Œå­˜å‚¨æœ€å°‘å¿…éœ€çŠ¶æ€ï¼Œå¹¶ä½¿ç”¨æ°¸ä¹…æ€§å­˜å‚¨å¤„ç†å¤æ‚æ•°æ®ã€‚</li>
</ul>
<p>é€šè¿‡åˆç†ä½¿ç”¨è¿™äº› API å’Œæœ€ä½³å®è·µï¼Œå¯ä»¥ç¡®ä¿ Jetpack Compose åº”ç”¨åœ¨é¢å¯¹é…ç½®æ›´æ”¹å’Œè¿›ç¨‹ç»ˆæ­¢æ—¶ä¿æŒä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ Flutter + BLoC å†™ä¸€ä¸ªé¡ºæ‰‹çš„æ¶‚é¸¦ç”»æ¿ï¼ˆæ”¯æŒæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ç›¸å†Œï¼‰]]></title>    <link>https://juejin.cn/post/7575182522411925542</link>    <guid>https://juejin.cn/post/7575182522411925542</guid>    <pubDate>2025-11-23T16:09:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575182522411925542" data-draft-id="7575469988736483337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ Flutter + BLoC å†™ä¸€ä¸ªé¡ºæ‰‹çš„æ¶‚é¸¦ç”»æ¿ï¼ˆæ”¯æŒæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ç›¸å†Œï¼‰"/> <meta itemprop="keywords" content="Android,iOS,Flutter"/> <meta itemprop="datePublished" content="2025-11-23T16:09:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Daniel02"/> <meta itemprop="url" content="https://juejin.cn/user/2277843825853511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ Flutter + BLoC å†™ä¸€ä¸ªé¡ºæ‰‹çš„æ¶‚é¸¦ç”»æ¿ï¼ˆæ”¯æŒæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ç›¸å†Œï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843825853511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Daniel02
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:09:49.000Z" title="Sun Nov 23 2025 16:09:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹æˆ‘æœ€è¿‘ç”¨ Flutter å†™çš„ä¸€ä¸ªå°ç©å…·ï¼š<strong>æ¶‚é¸¦ç”»æ¿</strong>ã€‚ä½†æŠŠä¸€å¥—å®Œæ•´çš„äº¤äº’é“¾è·¯ä¸²èµ·æ¥è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå¾ˆé€‚åˆä½œä¸º Flutter ç»ƒæ‰‹é¡¹ç›®ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ä¸€ã€é¡¹ç›®èƒŒæ™¯ &amp; åŠŸèƒ½æ¦‚è§ˆ</h2>
<p>è¿™æ˜¯ä¸€ä¸ªåŸºäº <strong>Flutter + BLoC</strong> çš„å°å‹æ¶‚é¸¦ç”»æ¿åº”ç”¨ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ul>
<li>âœï¸ æ”¯æŒæ‰‹å†™ç¬”è¿¹ï¼ˆåŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fperfect_freehand" target="_blank" title="https://pub.dev/packages/perfect_freehand" ref="nofollow noopener noreferrer"><code>perfect_freehand</code></a>ï¼‰</li>
<li>â†©ï¸ æ’¤é”€ / â†ªï¸ é‡åš</li>
<li>ğŸ§½ æ©¡çš®æ“¦æ¨¡å¼ï¼ˆé•¿æŒ‰ä¸€é”®æ¸…ç©ºï¼‰</li>
<li>ğŸš ç¬”åˆ·ç²—ç»†è°ƒèŠ‚</li>
<li>ğŸ¨ é¢œè‰²é€‰æ‹©å™¨</li>
<li>ğŸŒˆ æ¸å˜èƒŒæ™¯ç”»å¸ƒ</li>
<li>ğŸ’¾ ä¸€é”®ä¿å­˜åˆ°ç³»ç»Ÿç›¸å†Œ</li>
</ul>
<p>æ•´ä½“ç›®æ ‡æ˜¯ï¼š<strong>åœ¨ä¸ä¾èµ–åŸç”Ÿ View çš„å‰æä¸‹ï¼Œç”¨çº¯ Flutter å†™å‡ºä¸€ä¸ªä½“éªŒé¡ºæ»‘ã€ç»“æ„æ¸…æ™°ã€æ–¹ä¾¿æ‰©å±•çš„ç”»æ¿ç»„ä»¶</strong>ã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d50e5f09d2e0482db0daa7a397458ba0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGFuaWVsMDI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518989&amp;x-signature=6bkhKHgUtrvBqbbBrfKzzlfETdc%3D" alt="" width="200" height="400" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e69d02f25ae4daaa48ad932ed165925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGFuaWVsMDI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518989&amp;x-signature=%2BRzAKk5XYexwVYRYO3y%2FNh30Qmo%3D" alt="" width="200" height="400" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccf4b5a13c014e80a4fae53ffd643c5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGFuaWVsMDI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764518989&amp;x-signature=CtRSISXFr5B0MIu5TcWHdUIYE1Y%3D" alt="" width="200" height="400" loading="lazy"/>
<hr/>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æ¶æ„è®¾è®¡</h2>
<p>é¡¹ç›®å¤§è‡´æ‹†æˆå‡ å—ï¼š</p>
<ul>
<li><code>Painting</code> é¡µé¢ï¼š
<ul>
<li>è´Ÿè´£å¸ƒå±€ï¼ˆç”»å¸ƒ + é¡¶éƒ¨å·¥å…·æ  + å·¦ä¾§ç²—ç»†æ»‘å— + åº•éƒ¨é¢œè‰²æ¡ï¼‰</li>
<li>è´Ÿè´£æ‰‹åŠ¿é‡‡é›†ï¼ˆ<code>GestureDetector</code>ï¼‰</li>
</ul>
</li>
<li><code>PaintingBloc</code>ï¼š
<ul>
<li>ç®¡ç†æ‰€æœ‰ç»˜å›¾ç›¸å…³çŠ¶æ€ï¼ˆçº¿æ¡åˆ—è¡¨ã€å½“å‰é¢œè‰²ã€å½“å‰ç²—ç»†ã€æ©¡çš®æ“¦æ¨¡å¼ã€æ’¤é”€æ ˆç­‰ï¼‰</li>
</ul>
</li>
<li><code>PaintingModel</code>ï¼š
<ul>
<li>æè¿°ä¸€æ¡ç¬”ç”»ï¼ˆç‚¹é›†åˆã€é¢œè‰²ã€ç²—ç»†ã€æ˜¯å¦æ©¡çš®æ“¦ç­‰ï¼‰</li>
</ul>
</li>
<li><code>Sketcher</code>ï¼š
<ul>
<li><code>CustomPainter</code>ï¼Œè´Ÿè´£çœŸæ­£æŠŠæ‰€æœ‰ç¬”ç”»ç”»åˆ° <code>Canvas</code> ä¸Š</li>
</ul>
</li>
<li>ä¸€äº› UI ç»„ä»¶ï¼š
<ul>
<li><code>Toptools</code> é¡¶éƒ¨å·¥å…·æ ï¼ˆæ’¤é”€ / é‡åš / æ©¡çš®æ“¦ / ä¿å­˜ï¼‰</li>
<li><code>SizeSliderWidget</code> å·¦ä¾§ç¬”åˆ·ç²—ç»†è°ƒèŠ‚</li>
<li><code>ColorSelector</code> åº•éƒ¨é¢œè‰²æ¡</li>
</ul>
</li>
<li><code>takePicture</code> æœåŠ¡ï¼š
<ul>
<li>åŸºäº <code>RepaintBoundary.toImage</code> æˆªå–ç”»å¸ƒ</li>
<li>ä½¿ç”¨ <code>flutter_image_compress</code> å‹ç¼©</li>
<li>ä½¿ç”¨ <code>ImageGallerySaverPlus</code> ä¿å­˜åˆ°ç›¸å†Œ</li>
</ul>
</li>
</ul>
<p><strong>æ•°æ®æµ</strong>å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼š</p>
<blockquote>
<p>æ‰‹åŠ¿äº‹ä»¶ â†’ æ´¾å‘ BLoC Event â†’ æ›´æ–° PaintingState â†’ è§¦å‘é‡ç»˜ <code>CustomPaint</code> â†’ ç”¨æˆ·çœ‹åˆ°æœ€æ–°ç¬”è¿¹</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€æ•°æ®æ¨¡å‹ä¸çŠ¶æ€ç®¡ç†</h2>
<h3 data-id="heading-3">1. ç¬”ç”»æ•°æ®æ¨¡å‹ <code>PaintingModel</code></h3>
<p>æ¯ä¸€ç¬”æŠ½è±¡æˆä¸€ä¸ªæ¨¡å‹ï¼Œæ ¸å¿ƒä¿¡æ¯ï¼š</p>
<ul>
<li>ä¸€ä¸²ç‚¹ <code>points</code></li>
<li>ç¬”åˆ·ç²—ç»† <code>size</code></li>
<li>é¢œè‰² <code>lineColor</code></li>
<li>æ˜¯å¦ä¸ºæ©¡çš®æ“¦ <code>isEraser</code></li>
</ul>
<p>ç¤ºæ„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼ˆå®Œæ•´ç‰ˆæœ¬åœ¨ä»“åº“é‡Œï¼‰ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PaintingModel</span> </span>{
  <span class="hljs-built_in">List</span>&lt;PointVector&gt; points;
  <span class="hljs-built_in">double</span> size;
  Color lineColor;
  <span class="hljs-built_in">bool</span> isEraser;

  PaintingModel({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.points,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.size,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.lineColor,
    <span class="hljs-keyword">this</span>.isEraser = <span class="hljs-keyword">false</span>,
  });
}
</code></pre>
<p>è¿™é‡Œçš„ <code>PointVector</code> æ¥è‡ª <code>perfect_freehand</code>ï¼Œå®ƒå¯¹ç¬”è¿¹å¹³æ»‘ã€å‹æ„Ÿæ•ˆæœä¼šæ›´å‹å¥½ã€‚</p>
<h3 data-id="heading-4">2. å…¨å±€ç»˜å›¾çŠ¶æ€ <code>PaintingState</code></h3>
<p><code>PaintingState</code> åŒ…å«ï¼š</p>
<ul>
<li><code>lines</code>ï¼šå·²å®Œæˆç¬”ç”»åˆ—è¡¨</li>
<li><code>currentLine</code>ï¼šå½“å‰æ­£åœ¨ç”»çš„é‚£ä¸€ç¬”</li>
<li><code>lineColorIndex</code>ï¼šå½“å‰é¢œè‰²ç´¢å¼•</li>
<li><code>lineWidth</code>ï¼šå½“å‰ç¬”åˆ·ç²—ç»†</li>
<li><code>isEraserMode</code>ï¼šæ˜¯å¦è¿›å…¥æ©¡çš®æ“¦æ¨¡å¼</li>
<li><code>undoStack</code>ï¼šæ’¤é”€æ ˆï¼ˆç”¨äºé‡åšï¼‰</li>
</ul>
<p>ç®€åŒ–åçš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PaintingState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Equatable</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PaintingModel&gt; lines;
  <span class="hljs-keyword">final</span> PaintingModel? currentLine;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;PaintingModel&gt; undoStack;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> lineColorIndex;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> lineWidth;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isEraserMode;
}
</code></pre>
<p>è¿™é‡Œé€šè¿‡ <code>Equatable</code> åšçŠ¶æ€å¯¹æ¯”ï¼Œé…åˆ <code>BlocBuilder</code> å¯ä»¥åšåˆ°<strong>æŒ‰éœ€é‡å»º UI</strong>ã€‚</p>
<h3 data-id="heading-5">3. BLoC äº‹ä»¶ï¼ˆEventï¼‰è®¾è®¡</h3>
<p>æ¯”è¾ƒè‡ªç„¶çš„åˆ’åˆ†ï¼š</p>
<ul>
<li>æ‰‹åŠ¿ç›¸å…³ï¼š<code>PanStartEvent</code>, <code>PanUpdateEvent</code>, <code>PanEndEvent</code></li>
<li>é…ç½®ç›¸å…³ï¼š<code>UpdateLineColorIndexEvent</code>, <code>UpdateLineWidthEvent</code></li>
<li>æ¨¡å¼ç›¸å…³ï¼š<code>ToggleEraserModeEvent</code></li>
<li>æ’¤é”€ / é‡åšï¼š<code>RemoveLastLineEvent</code>, <code>RedoLastLineEvent</code></li>
<li>æ•´ä½“æ¸…ç©ºï¼š<code>ClearAllEvent</code></li>
</ul>
<p>å¤§éƒ¨åˆ†é€»è¾‘éƒ½è¢«æ”¶æ•›åˆ°ä¸€ä¸ª <code>PaintingBloc</code> ä¸­ï¼Œæ–¹ä¾¿ç»´æŠ¤å’Œåç»­æ‰©å±•ã€‚</p>
<hr/>
<h2 data-id="heading-6">å››ã€ä»æ‰‹åŠ¿åˆ°ç¬”ç”»ï¼šåæ ‡è½¬æ¢ä¸ç¬”è¿¹ç”Ÿæˆ</h2>
<h3 data-id="heading-7">1. æ‰‹åŠ¿é‡‡é›† â†’ å‘é€ BLoC Event</h3>
<p>ç”»å¸ƒå¤–å±‚ç”¨ <code>GestureDetector</code> åŒ…ç€ <code>RepaintBoundary + CustomPaint</code>ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">GestureDetector(
  onPanStart: handlePanStart,
  onPanUpdate: handlePanUpdate,
  onPanEnd: handlePanEnd,
  child: RepaintBoundary(
    key: canvasKey,
    child: CustomPaint(...),
  ),
);
</code></pre>
<p>å› ä¸ºå¤–å±‚è¿˜æœ‰ <code>SafeArea</code>ã€<code>ClipRRect</code> ç­‰åŒ…è£¹ï¼Œæ‰€ä»¥æ‹¿åˆ°çš„æ˜¯<strong>å…¨å±€åæ ‡</strong>ï¼Œéœ€è¦è½¬æˆç”»å¸ƒå±€éƒ¨åæ ‡ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">Offset? _getLocalOffset(Offset global) {
  <span class="hljs-keyword">final</span> ctx = canvasKey.currentContext;
  <span class="hljs-keyword">if</span> (ctx == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
  <span class="hljs-keyword">final</span> box = ctx.findRenderObject() <span class="hljs-keyword">as</span> RenderBox;
  <span class="hljs-keyword">return</span> box.globalToLocal(global);
}
</code></pre>
<p>æœ€ç»ˆåœ¨ <code>handlePanStart / Update / End</code> ä¸­ï¼ŒæŠŠè½¬æ¢åçš„åæ ‡åŒ…è£…æˆ <code>PointVector</code>ï¼Œå‘ç»™ BLoC å³å¯ã€‚</p>
<h3 data-id="heading-8">2. <code>perfect_freehand</code>ï¼šæŠŠä¸€ä¸²ç‚¹å˜æˆé¡ºæ»‘ç¬”è¿¹</h3>
<p>BLoC æ”¶é›†åˆ°çš„å®é™…ä¸Šæ˜¯ä¸€ä¸²â€œç¦»æ•£ç‚¹â€ï¼ŒçœŸæ­£æ¸²æŸ“æ—¶äº¤ç»™ <code>perfect_freehand</code> å¤„ç†ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> outlinePoints = getStroke(
  line.points,
  options: StrokeOptions(
    size: line.size,
    simulatePressure: <span class="hljs-keyword">true</span>,
    <span class="hljs-comment">// å…¶ä»–å‚æ•°è§æºç </span>
  ),
);
</code></pre>
<p><code>getStroke</code> ä¼šè¿”å›ä¸€ç»„<strong>è½®å»“ç‚¹</strong>ï¼Œå†ç”¨ <code>Path</code> æ‹¼æ¥æˆè·¯å¾„ï¼Œç”»åˆ° <code>Canvas</code> ä¸Šï¼Œå°±èƒ½å¾—åˆ°éå¸¸é¡ºæ»‘ã€æ¥è¿‘çœŸå®ä¹¦å†™çš„æ•ˆæœã€‚</p>
<hr/>
<h2 data-id="heading-9">äº”ã€ç”»å¸ƒç»˜åˆ¶ &amp; æ©¡çš®æ“¦å®ç°</h2>
<p>æ ¸å¿ƒç»˜åˆ¶é€»è¾‘åœ¨ <code>Sketcher extends CustomPainter</code> ä¸­ï¼š</p>
<ol>
<li>éå†æ‰€æœ‰ç¬”ç”»ï¼ˆåŒ…æ‹¬å·²å®Œæˆçš„ <code>lines</code> å’Œå½“å‰ <code>currentLine</code>ï¼‰ï¼›</li>
<li>å¯¹æ©¡çš®æ“¦ç¬”ç”»è®¾ç½® <code>blendMode = BlendMode.clear</code>ï¼›</li>
<li>ä½¿ç”¨ <code>getStroke</code> ç”Ÿæˆè½®å»“ç‚¹ï¼Œå†ç”¨ <code>Path</code> è¿æ¥ï¼›</li>
<li>è°ƒç”¨ <code>canvas.drawPath(path, paint)</code>ã€‚</li>
</ol>
<p>æ©¡çš®æ“¦çš„å…³é”®ä¸æ˜¯â€œç”»å‡ºä¸€ä¸ªç™½è‰²â€ï¼Œè€Œæ˜¯ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">paint
  ..color = Colors.transparent
  ..blendMode = BlendMode.clear;
</code></pre>
<p>å¹¶ä¸”æ•´æ®µç»˜åˆ¶åŒ…è£¹åœ¨ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">canvas.saveLayer(Offset.zero &amp; size, Paint());
<span class="hljs-comment">// ... draw</span>
canvas.restore();
</code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š<strong>æ©¡çš®æ“¦å…¶å®æ˜¯åœ¨å½“å‰å›¾å±‚ä¸Šâ€œæŠ é™¤å·²æœ‰åƒç´ â€</strong>ï¼Œå¯¹èƒŒæ™¯æ¸å˜ä¸ä¼šé€ æˆå½±å“ã€‚</p>
<hr/>
<h2 data-id="heading-10">å…­ã€æ’¤é”€ / é‡åšï¼šä¸€æ¡ç®€å•ä½†å¥½ç”¨çš„æ ˆè®¾è®¡</h2>
<h3 data-id="heading-11">1. æ’¤é”€æ€è·¯</h3>
<ul>
<li>æ—¥å¸¸ç»˜åˆ¶æ—¶ï¼Œæ‰€æœ‰å®Œæˆçš„ç¬”ç”»éƒ½æ”¾åœ¨ <code>lines</code>ï¼›</li>
<li>ç‚¹å‡»â€œæ’¤é”€â€æ—¶ï¼Œå°† <code>lines</code> æœ€åä¸€ä¸ªå¼¹å‡ºï¼Œå¡è¿› <code>undoStack</code>ï¼›</li>
<li>ä¸ºé¿å…å†…å­˜æ— é™å¢é•¿ï¼Œå¼•å…¥ <code>maxUndoStackSize</code> æ§åˆ¶æœ€å¤§æ’¤é”€æ­¥æ•°ã€‚</li>
</ul>
<p>ä¼ªä»£ç ç¤ºæ„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (lines.isNotEmpty) {
  <span class="hljs-keyword">final</span> removed = lines.removeLast();
  undoStack.add(removed);
  <span class="hljs-keyword">if</span> (undoStack.length &gt; maxUndoStackSize) {
    undoStack.removeAt(<span class="hljs-number">0</span>);
  }
}
</code></pre>
<h3 data-id="heading-12">2. é‡åšæ€è·¯</h3>
<ul>
<li>ç‚¹å‡»â€œé‡åšâ€æ—¶ï¼Œä» <code>undoStack</code> å¼¹å‡ºæœ€åä¸€ä¸ªï¼Œé‡æ–°å¡å› <code>lines</code>ï¼›</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (undoStack.isNotEmpty) {
  <span class="hljs-keyword">final</span> redoLine = undoStack.removeLast();
  lines.add(redoLine);
}
</code></pre>
<p>è¿™ç§åŒæ ˆå¼çš„å®ç°æ–¹å¼ç®€å•ç›´è§‚ï¼Œéå¸¸é€‚åˆç”»æ¿ç±»ã€ç¼–è¾‘å™¨ç±»çš„åœºæ™¯ã€‚</p>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€ä¿å­˜ç”»å¸ƒåˆ°ç›¸å†Œï¼šRepaintBoundary + toImage</h2>
<h3 data-id="heading-14">1. æˆªå›¾åŸç†</h3>
<p>æ ¸å¿ƒæ€è·¯ï¼š</p>
<ol>
<li>ç”»å¸ƒåŒºåŸŸä½¿ç”¨ <code>RepaintBoundary</code> åŒ…è£¹ï¼Œå¹¶ç»‘å®šä¸€ä¸ª <code>GlobalKey</code>ï¼›</li>
<li>ç”¨æˆ·ç‚¹å‡»â€œä¿å­˜â€æ—¶ï¼Œé€šè¿‡ <code>contentKey.currentContext</code> æ‹¿åˆ°å¯¹åº”çš„ <code>RenderRepaintBoundary</code>ï¼›</li>
<li>è°ƒç”¨ <code>toImage(pixelRatio: 3.0)</code> å¾—åˆ°ä¸€å¼  <code>ui.Image</code>ï¼›</li>
<li>è½¬æˆ PNG å­—èŠ‚ï¼Œå¿…è¦æ—¶å‹ç¼©ï¼›</li>
<li>å†™å…¥æœ¬åœ°æ–‡ä»¶ / ä¿å­˜åˆ°ç›¸å†Œã€‚</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> boundary =
    contentKey.currentContext?.findRenderObject() <span class="hljs-keyword">as</span> RenderRepaintBoundary?;
<span class="hljs-keyword">final</span> image = <span class="hljs-keyword">await</span> boundary?.toImage(pixelRatio: <span class="hljs-number">3.0</span>);
<span class="hljs-keyword">final</span> byteData = <span class="hljs-keyword">await</span> image?.toByteData(format: ui.ImageByteFormat.png);
<span class="hljs-keyword">final</span> pngBytes = byteData?.buffer.asUint8List();
</code></pre>
<h3 data-id="heading-15">2. æœ¬åœ°å‹ç¼© &amp; ä¿å­˜åˆ°ç›¸å†Œ</h3>
<p>ä¸ºäº†é¿å…ç”Ÿæˆçš„ PNG å¤ªå¤§ï¼Œä½¿ç”¨ <code>flutter_image_compress</code> åšç®€å•å‹ç¼©ï¼Œç„¶åç”¨ <code>ImageGallerySaverPlus</code> å†™å…¥ç›¸å†Œã€‚</p>
<p>ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> compressed = <span class="hljs-keyword">await</span> FlutterImageCompress.compressWithList(pngBytes);
<span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> ImageGallerySaverPlus.saveImage(compressed);
</code></pre>
<p>iOS / Android å‡éœ€è¦åœ¨å¯¹åº”å¹³å°é…ç½®ç›¸å†Œæƒé™ï¼Œå…·ä½“å¯å‚è€ƒä»“åº“ README æˆ–å®˜æ–¹æ–‡æ¡£ã€‚</p>
<hr/>
<h2 data-id="heading-16">å…«ã€UI äº¤äº’ &amp; ä¸€äº›å°è®¾è®¡</h2>
<p>æ•´ä¸ª UI é‡‡ç”¨äº† Stack + å¯¹é½çš„æ–¹å¼ï¼š</p>
<ul>
<li><strong>èƒŒæ™¯ç”»å¸ƒ</strong>ï¼š
<ul>
<li>ä½¿ç”¨çºµå‘æ¸å˜è‰²ï¼Œåšå‡ºç±»ä¼¼â€œå¤©ç©º / æµ·é¢â€æ•ˆæœï¼›</li>
</ul>
</li>
<li><strong>å·¦ä¾§ç«–ç›´æ»‘å—æ§åˆ¶ç¬”åˆ·ç²—ç»†</strong>ï¼š
<ul>
<li><code>RotatedBox(quarterTurns: 3)</code> æŠŠ <code>Slider</code> æ¨ªç€è½¬æˆç«–çš„ï¼›</li>
<li><code>AnimatedContainer</code> åšå±•å¼€/æ”¶èµ·çš„å°åŠ¨ç”»ï¼›</li>
</ul>
</li>
<li><strong>åº•éƒ¨é¢œè‰²é€‰æ‹©æ¡</strong>ï¼š
<ul>
<li>ä¸€æ’åœ†å½¢é¢œè‰²å—ï¼Œæ”¯æŒæ¨ªå‘æ»šåŠ¨ï¼›</li>
<li>å·¦è¾¹ç”¨ä¸€ä¸ªè¾ƒå¤§çš„åœ†å½¢å±•ç¤ºå½“å‰é¢œè‰²ï¼›</li>
</ul>
</li>
<li><strong>é¡¶éƒ¨å·¥å…·æ </strong>ï¼š
<ul>
<li>æ’¤é”€ / é‡åšï¼šç”¨å·¦å³ç¿»è½¬çš„åŒä¸€å›¾æ ‡ï¼›</li>
<li>æ©¡çš®æ“¦ï¼šç‚¹å‡»åˆ‡æ¢æ¨¡å¼ã€é•¿æŒ‰æ¸…ç©ºç”»å¸ƒï¼›</li>
<li>ä¿å­˜ï¼šç‚¹å‡»åç»™ä¸€ä¸ªæµ®åŠ¨ SnackBar æç¤ºä¿å­˜ç»“æœã€‚</li>
</ul>
</li>
</ul>
<p>è¿™äº›ç»†èŠ‚åŠ èµ·æ¥ï¼Œå¯ä»¥æ˜æ˜¾æå‡å°ç»„ä»¶çš„â€œå®Œæˆåº¦æ„Ÿâ€ã€‚</p>
<hr/>
<h2 data-id="heading-17">ä¹ã€è¸©å‘è®°å½•</h2>
<p>é¡¹ç›®ä¸­è¸©äº†ä¸€äº›å°å‘ï¼Œä¹Ÿé¡ºä¾¿è®°å½•ä¸€ä¸‹ï¼š</p>
<ol>
<li>
<p><strong><code>GestureDetector</code> + <code>RepaintBoundary</code> å°ºå¯¸ &amp; åæ ‡</strong><br/>
å¦‚æœç”»å¸ƒä¸æ˜¯å…¨å±ï¼Œå¼ºçƒˆå»ºè®®ç”¨ <code>GlobalKey</code> + <code>RenderBox.globalToLocal</code> åšåæ ‡è½¬æ¢ï¼Œé¿å…å‡ºç°â€œç”»åˆ°åˆ«çš„åœ°æ–¹â€çš„é—®é¢˜ã€‚</p>
</li>
<li>
<p><strong>SafeArea &amp; iOS é¡¶éƒ¨é«˜åº¦</strong><br/>
iOS ä¸Šé€šè¿‡ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> paddingTop = MediaQuery.of(context).padding.top;
</code></pre>
<p>å†é…åˆè‡ªå®šä¹‰çš„ <code>canvasHeight</code>ï¼Œä¿è¯ç”»å¸ƒåœ¨å„ç§è®¾å¤‡ä¸Šé«˜åº¦åˆé€‚ã€‚</p>
</li>
<li>
<p><strong>ä¿å­˜å›¾ç‰‡æ—¶çš„å†…å­˜å ç”¨</strong><br/>
<code>pixelRatio</code> å¤ªé«˜ + å¤§å°ºå¯¸ç”»å¸ƒï¼Œä¼šæ˜æ˜¾å¢å¤§å†…å­˜å’Œæ–‡ä»¶ä½“ç§¯ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯åšåŠ¨æ€æ§åˆ¶ã€‚</p>
</li>
<li>
<p><strong>ç›¸å†Œæƒé™</strong></p>
<ul>
<li>iOSï¼šåœ¨ <code>Info.plist</code> ä¸­æ·»åŠ ä¿å­˜ç›¸å†Œçš„æƒé™æè¿°ï¼›</li>
<li>Androidï¼šæ ¹æ® targetSdk é…ç½®å­˜å‚¨ / åª’ä½“æƒé™ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-18">åã€æ€»ç»“ &amp; å¯æ‰©å±•æ–¹å‘</h2>
<p>è¿™ä¸ªå°é¡¹ç›®è™½ç„¶åŠŸèƒ½ä¸ç®—å¤æ‚ï¼Œä½†æŠŠä»¥ä¸‹å‡ ä¸ªå…³é”®çŸ¥è¯†ç‚¹éƒ½ä¸²èµ·æ¥äº†ï¼š</p>
<ul>
<li>Flutter è‡ªå®šä¹‰ç»˜åˆ¶ï¼ˆ<code>CustomPainter</code> + <code>Canvas</code>ï¼‰</li>
<li>BLoC çŠ¶æ€ç®¡ç†</li>
<li>æ‰‹åŠ¿äº‹ä»¶åˆ°ç»˜å›¾æ•°æ®çš„è½¬æ¢</li>
<li>æ’¤é”€ / é‡åšçš„æ ˆè®¾è®¡</li>
<li>ç»„ä»¶æˆªå›¾ä¸ä¿å­˜ç›¸å†Œ</li>
</ul>
<p>åŸºäºå½“å‰å®ç°ï¼Œå¾ˆå®¹æ˜“ç»§ç»­æ‰©å±•æ›´å¤šèƒ½åŠ›ï¼š</p>
<ul>
<li>æ”¯æŒå›¾å½¢ç»˜åˆ¶ï¼šç›´çº¿ã€çŸ©å½¢ã€åœ†ç­‰ï¼›</li>
<li>æ”¯æŒæ–‡å­—è¾“å…¥ã€è´´çº¸ï¼›</li>
<li>æ”¯æŒå¤šé¡µç”»å¸ƒ / å›¾å±‚ï¼›</li>
<li>æ”¯æŒå¯¼å‡ºåˆ†äº«ï¼ˆæµ·æŠ¥ã€é•¿å›¾ç­‰ï¼‰ï¼›</li>
<li>æ”¯æŒè‡ªå®šä¹‰ç¬”åˆ·ï¼ˆè§å…‰ç¬”ã€æ¯›ç¬”ã€è™šçº¿ç¬”ç­‰ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>å¦‚æœä½ ä¹Ÿåœ¨åšç±»ä¼¼çš„ç”»æ¿ / æ‰‹å†™ / ç­¾åç»„ä»¶ï¼Œå¯ä»¥æŠŠ BLoC + CustomPainter è¿™ä¸€å¥—ç›´æ¥æŠ½å‡ºæ¥å¤ç”¨ï¼Œä¿®æ”¹ UI å’Œäº¤äº’å³å¯ã€‚</p>
</blockquote>
<p>å®Œæ•´å¯è¿è¡Œä»£ç ã€ä¾èµ–é…ç½®ã€å¹³å°æƒé™ç¤ºä¾‹éƒ½åœ¨ GitHub ä»“åº“ä¸­ï¼š</p>
<ul>
<li>ğŸ‘‰ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwutao23yzd%2FuikitCombine" target="_blank" title="https://github.com/wutao23yzd/uikitCombine" ref="nofollow noopener noreferrer">GitHub</a></li>
</ul>
<p>æ¬¢è¿ fork / star / æ issue äº¤æµ ğŸ‘‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Kotlin åç¨‹ç»“æ„åŒ–å¹¶å‘]]></title>    <link>https://juejin.cn/post/7575367791273361446</link>    <guid>https://juejin.cn/post/7575367791273361446</guid>    <pubDate>2025-11-23T16:32:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575367791273361446" data-draft-id="7575442779039760426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Kotlin åç¨‹ç»“æ„åŒ–å¹¶å‘"/> <meta itemprop="keywords" content="Android,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-23T16:32:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åº¦ç†Šå›"/> <meta itemprop="url" content="https://juejin.cn/user/1618089084457853"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Kotlin åç¨‹ç»“æ„åŒ–å¹¶å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1618089084457853/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åº¦ç†Šå›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T16:32:01.000Z" title="Sun Nov 23 2025 16:32:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨å¼‚æ­¥ç¼–ç¨‹é¢†åŸŸï¼Œä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å‹é•¿æœŸé¢ä¸´ â€œé‡çº¿ç¨‹æ³„æ¼â€â€œå¼‚å¸¸éš¾ä»¥è¿½è¸ªâ€â€œç”Ÿå‘½å‘¨æœŸä¸å¯æ§â€ ä¸‰å¤§ç—›ç‚¹ â€”â€” å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹åï¼Œå¦‚åŒæ”¾é£ä¸€åªæ— ç»³é£ç­ï¼Œæ—¢æ— æ³•ç²¾å‡†å–æ¶ˆï¼Œä¹Ÿéš¾ä»¥æ„ŸçŸ¥å…¶çŠ¶æ€ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºæˆ–é€»è¾‘å¼‚å¸¸ã€‚è€Œ Kotlin åç¨‹çš„<strong>ç»“æ„åŒ–å¹¶å‘ï¼ˆStructured Concurrencyï¼‰</strong> Â æ¨¡å‹ï¼Œæ­£æ˜¯ä¸ºè§£å†³è¿™äº›ç—›ç‚¹è€Œç”Ÿï¼šå®ƒä»¥ â€œåç¨‹ä½œç”¨åŸŸï¼ˆCoroutineScopeï¼‰â€ ä¸ºæ ¸å¿ƒï¼Œå°†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸ä¸šåŠ¡ç»„ä»¶ï¼ˆå¦‚ Android çš„ ViewModelã€Activityï¼‰æ·±åº¦ç»‘å®šï¼Œå®ç°äº†å¼‚æ­¥ä»»åŠ¡çš„ â€œå¯è¿½æº¯ã€å¯ç®¡ç†ã€å¯å›æ”¶â€ï¼Œå½»åº•é‡å¡‘äº†å¼‚æ­¥ç¼–ç¨‹çš„å®‰å…¨æ€§ä¸æ•ˆç‡ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç»“æ„åŒ–å¹¶å‘çš„æ ¸å¿ƒå®šä¹‰ï¼šä»€ä¹ˆæ˜¯ â€œç»“æ„åŒ–â€ï¼Ÿ</h2>
<p>ç»“æ„åŒ–å¹¶å‘çš„æœ¬è´¨æ˜¯ <strong>â€œåç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¿…é¡»è¢«æ˜¾å¼ç®¡ç†â€</strong>ï¼Œå…¶æ ¸å¿ƒè§„åˆ™ç”± Kotlin åç¨‹è®¾è®¡è€… Roman Elizarov æå‡ºï¼šâ€œä»»ä½•åç¨‹éƒ½å¿…é¡»è¿è¡Œåœ¨ä¸€ä¸ª CoroutineScope ä¸­ï¼Œåç¨‹çš„åˆ›å»ºä¸é”€æ¯éœ€éµå¾ªâ€˜çˆ¶å­å±‚çº§å…³ç³»â€™ï¼Œçˆ¶ä½œç”¨åŸŸçš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œæ‰€æœ‰å­åç¨‹å°†è¢«è‡ªåŠ¨å–æ¶ˆâ€ã€‚</p>
<p>è¿™ä¸€è§„åˆ™ç›´æ¥é’ˆå¯¹ä¼ ç»Ÿéç»“æ„åŒ–å¹¶å‘çš„ç¼ºé™·ï¼š</p>
<ul>
<li>éç»“æ„åŒ–å¹¶å‘ï¼šä½¿ç”¨<code>GlobalScope</code>æˆ–è£¸çº¿ç¨‹å¯åŠ¨ä»»åŠ¡æ—¶ï¼Œä»»åŠ¡ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè„±èŠ‚ï¼Œå³ä½¿é¡µé¢é”€æ¯ï¼Œåå°ä»»åŠ¡ä»å¯èƒ½ç»§ç»­è¿è¡Œï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼ˆå¦‚æŒæœ‰ Activity å¼•ç”¨ï¼‰ï¼›</li>
<li>ç»“æ„åŒ–å¹¶å‘ï¼šé€šè¿‡<code>viewModelScope</code>ï¼ˆç»‘å®š ViewModelï¼‰ã€<code>lifecycleScope</code>ï¼ˆç»‘å®š Activity/Fragmentï¼‰ç­‰ä½œç”¨åŸŸå¯åŠ¨åç¨‹ï¼Œç»„ä»¶é”€æ¯æ—¶ä½œç”¨åŸŸè‡ªåŠ¨å–æ¶ˆï¼Œæ‰€æœ‰å­åç¨‹éšä¹‹ç»ˆæ­¢ï¼Œä»æ ¹æºé¿å…æ³„æ¼ã€‚</li>
</ul>
<h2 data-id="heading-1">äºŒã€ç»“æ„åŒ–å¹¶å‘çš„ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶</h2>
<p>ç»“æ„åŒ–å¹¶å‘çš„å®‰å…¨æ€§å¹¶éå‡­ç©ºè€Œæ¥ï¼Œè€Œæ˜¯ä¾èµ– â€œçˆ¶å­åç¨‹è”åŠ¨â€â€œå¼‚å¸¸å®šå‘ä¼ æ’­â€â€œèµ„æºè‡ªåŠ¨å›æ”¶â€ ä¸‰å¤§æœºåˆ¶çš„ååŒå·¥ä½œï¼Œè¿™ä¸‰å¤§æœºåˆ¶æ„æˆäº†å…¶ä¸å¯æ›¿ä»£çš„æ ¸å¿ƒä»·å€¼ã€‚</p>
<h3 data-id="heading-2">1. çˆ¶å­åç¨‹ï¼šå±‚çº§åŒ–çš„ç”Ÿå‘½å‘¨æœŸç»‘å®š</h3>
<p>ç»“æ„åŒ–å¹¶å‘ä¸­ï¼Œåç¨‹å­˜åœ¨ä¸¥æ ¼çš„ â€œçˆ¶å­å…³ç³»â€ï¼šé€šè¿‡<code>CoroutineScope</code>å¯åŠ¨çš„åç¨‹ä¸º â€œçˆ¶åç¨‹â€ï¼Œçˆ¶åç¨‹å†…éƒ¨å¯åŠ¨çš„åç¨‹ï¼ˆå¦‚<code>launch</code>/<code>async</code>åˆ›å»ºçš„ï¼‰ä¸º â€œå­åç¨‹â€ï¼Œå…¶æ ¸å¿ƒè§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>çˆ¶åç¨‹å–æ¶ˆæ—¶ï¼Œæ‰€æœ‰å­åç¨‹ä¼šè¢«<strong>çº§è”å–æ¶ˆ</strong>ï¼ˆCascading Cancellationï¼‰ï¼›</li>
<li>å­åç¨‹å…¨éƒ¨å®Œæˆå‰ï¼Œçˆ¶åç¨‹ä¼šè‡ªåŠ¨ç­‰å¾…ï¼ˆç±»ä¼¼<code>joinAll</code>ï¼‰ï¼Œé¿å… â€œçˆ¶é€€å­ç•™â€ çš„å­¤å„¿åç¨‹ã€‚</li>
</ul>
<p><strong>å®è·µæ¡ˆä¾‹ï¼šå¹¶è¡Œè·å–æ•°æ®</strong>åœ¨ä¸šåŠ¡å±‚ä¸­ï¼Œé€šè¿‡<code>coroutineScope</code>å¯åŠ¨ä¸¤ä¸ªå¹¶è¡Œå­åç¨‹ï¼Œè‹¥ç”¨æˆ·é€€å‡ºé¡µé¢å¯¼è‡´çˆ¶ä½œç”¨åŸŸå–æ¶ˆï¼Œä¸¤ä¸ªå­åç¨‹ä¼šç«‹å³ç»ˆæ­¢ï¼Œé¿å…æ— æ•ˆç½‘ç»œè¯·æ±‚ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetBookAndAuthorsUseCase</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> booksRepo: BooksRepository,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> authorsRepo: AuthorsRepository
) {
    <span class="hljs-comment">// çˆ¶åç¨‹ï¼šé€šè¿‡coroutineScopeç®¡ç†å­åç¨‹</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span></span>: BookAndAuthors = coroutineScope {
        <span class="hljs-comment">// å­åç¨‹1ï¼šè·å–ä¹¦ç±</span>
        <span class="hljs-keyword">val</span> books = async { booksRepo.getAllBooks() }
        <span class="hljs-comment">// å­åç¨‹2ï¼šè·å–ä½œè€…</span>
        <span class="hljs-keyword">val</span> authors = async { authorsRepo.getAllAuthors() }
        <span class="hljs-comment">// çˆ¶åç¨‹ç­‰å¾…æ‰€æœ‰å­åç¨‹å®Œæˆåè¿”å›</span>
        BookAndAuthors(books.await(), authors.await())
    }
}
</code></pre>
<h3 data-id="heading-3">2. å¼‚å¸¸éš”ç¦»</h3>
<p>ä¼ ç»Ÿå¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå¼‚å¸¸å®¹æ˜“ â€œä¸¢å¤±â€ æˆ– â€œæ‰©æ•£â€ï¼ˆå¦‚ä¸€ä¸ªçº¿ç¨‹æŠ›å‡ºå¼‚å¸¸å¯¼è‡´æ•´ä¸ªçº¿ç¨‹æ± æŒ‚æ‰ï¼‰ï¼Œè€Œç»“æ„åŒ–å¹¶å‘é€šè¿‡ä¸¤ç§ä½œç”¨åŸŸç±»å‹ï¼Œå®ç°äº†å¼‚å¸¸çš„ç²¾å‡†æ§åˆ¶ï¼š</p>




















<table><thead><tr><th>ä½œç”¨åŸŸç±»å‹</th><th>å¼‚å¸¸ä¼ æ’­è§„åˆ™</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>coroutineScope</code></td><td>ä»»ä¸€å­åç¨‹æŠ›æœªæ•è·å¼‚å¸¸ â†’ å–æ¶ˆæ‰€æœ‰å­åç¨‹ + å‘ä¸Šä¼ æ’­</td><td>äº‹åŠ¡æ€§ä»»åŠ¡ï¼ˆå¦‚ â€œè·å–ä¹¦ç± + ä½œè€…â€ï¼Œç¼ºä¸€ä¸å¯ï¼‰</td></tr><tr><td><code>supervisorScope</code></td><td>å­åç¨‹å¼‚å¸¸ä»…è‡ªèº«ç»ˆæ­¢ â†’ ä¸å½±å“å…¶ä»–å­åç¨‹ + ä¸å‘ä¸Šä¼ æ’­</td><td>ç‹¬ç«‹å¹¶è¡Œä»»åŠ¡ï¼ˆå¦‚ â€œå¤šæ–‡ä»¶ä¸‹è½½â€ï¼Œä¸€ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–ï¼‰</td></tr></tbody></table>
<p><strong>å®è·µæ¡ˆä¾‹ï¼šå¤šæ–‡ä»¶ä¸‹è½½</strong>ä½¿ç”¨<code>supervisorScope</code>ç¡®ä¿å•ä¸ªæ–‡ä»¶ä¸‹è½½å¤±è´¥æ—¶ï¼Œå…¶ä»–ä¸‹è½½ä»»åŠ¡æ­£å¸¸è¿›è¡Œï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">downloadMultipleFiles</span><span class="hljs-params">(fileUrls: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span> = supervisorScope {
    fileUrls.forEach { url -&gt;
        launch {
            <span class="hljs-keyword">try</span> {
                downloadFile(url) <span class="hljs-comment">// å•ä¸ªæ–‡ä»¶ä¸‹è½½</span>
            } <span class="hljs-keyword">catch</span> (e: IOException) {
                Log.e(<span class="hljs-string">"Download"</span>, <span class="hljs-string">"æ–‡ä»¶<span class="hljs-variable">$url</span> ä¸‹è½½å¤±è´¥"</span>, e)
                <span class="hljs-comment">// ä»…å¤„ç†å½“å‰å¼‚å¸¸ï¼Œä¸å½±å“å…¶ä»–å­åç¨‹</span>
            }
        }
    }
}
</code></pre>
<p>âš ï¸ å…³é”®æ³¨æ„ç‚¹ï¼š<strong>åˆ‡å‹¿æ•è·<code>CancellationException</code></strong></p>
<p><code>CancellationException</code>æ˜¯åç¨‹å–æ¶ˆçš„ä¿¡å·ï¼Œè‹¥æ•è·åä¸é‡æ–°æŠ›å‡ºï¼Œä¼šå¯¼è‡´åç¨‹æ— æ³•æ­£å¸¸å–æ¶ˆï¼ˆå¦‚<code>viewModelScope</code>é”€æ¯æ—¶ï¼Œå­åç¨‹ä»ç»§ç»­è¿è¡Œï¼‰ã€‚å®è·µä¸­åº”æ•è·å…·ä½“å¼‚å¸¸ï¼ˆå¦‚<code>IOException</code>ï¼‰ï¼Œè€Œéæ³›å‹<code>Exception</code>ã€‚</p>
<h3 data-id="heading-4">3. èµ„æºè‡ªåŠ¨å›æ”¶ï¼šä½œç”¨åŸŸé”€æ¯å³èµ„æºé‡Šæ”¾</h3>
<p>ç»“æ„åŒ–å¹¶å‘çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€æ˜¯ â€œæ— éœ€æ‰‹åŠ¨ç®¡ç†åç¨‹ç”Ÿå‘½å‘¨æœŸâ€â€”â€” ä½œç”¨åŸŸä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œç»„ä»¶é”€æ¯æ—¶ä½œç”¨åŸŸè‡ªåŠ¨è°ƒç”¨<code>cancel()</code>ï¼Œæ‰€æœ‰æœªå®Œæˆçš„å­åç¨‹å°†è¢«ç»ˆæ­¢ï¼ŒåŒæ—¶é‡Šæ”¾ç›¸å…³èµ„æºï¼ˆå¦‚ç½‘ç»œè¿æ¥ã€æ–‡ä»¶æµï¼‰ã€‚</p>
<p>Android ä¸­æœ€å…¸å‹çš„å®è·µæ˜¯<code>viewModelScope</code>å’Œ<code>lifecycleScope</code>ï¼š</p>
<ul>
<li><code>viewModelScope</code>ï¼šä¸ ViewModel ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œ<code>ViewModel.onCleared()</code>è°ƒç”¨æ—¶è‡ªåŠ¨å–æ¶ˆï¼Œé¿å…åå°ä»»åŠ¡æŒæœ‰ Activity/Fragment å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ï¼›</li>
<li><code>lifecycleScope</code>ï¼šä¸ Activity/Fragment ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œ<code>onDestroy()</code>æ—¶è‡ªåŠ¨å–æ¶ˆï¼Œé€‚åˆå¤„ç†ä¸ UI å¼ºç›¸å…³çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚å›¾ç‰‡åŠ è½½ï¼‰ã€‚</li>
</ul>
<p><strong>é”™è¯¯ç¤ºä¾‹ï¼šæ»¥ç”¨ GlobalScope</strong></p>
<p><code>GlobalScope</code>æ˜¯å…¨å±€ä½œç”¨åŸŸï¼Œç”Ÿå‘½å‘¨æœŸä¸åº”ç”¨è¿›ç¨‹ä¸€è‡´ï¼Œè‹¥ç”¨å®ƒå¯åŠ¨åç¨‹ï¼Œå³ä½¿ ViewModel é”€æ¯ï¼Œä»»åŠ¡ä»ä¼šç»§ç»­è¿è¡Œï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// é”™è¯¯ï¼šGlobalScopeæ— ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œæ˜“æ³„æ¼</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BadRepository</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> {
        GlobalScope.launch {
            <span class="hljs-comment">// å³ä½¿è°ƒç”¨è€…ï¼ˆå¦‚ViewModelï¼‰é”€æ¯ï¼Œæ­¤ä»»åŠ¡ä»ç»§ç»­è¿è¡Œ</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = api.getData()
        }
    }
}

<span class="hljs-comment">// æ­£ç¡®ï¼šæ³¨å…¥å¤–éƒ¨ä½œç”¨åŸŸï¼ˆå¦‚viewModelScopeï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GoodRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> externalScope: CoroutineScope <span class="hljs-comment">// ç”±è°ƒç”¨è€…ä¼ å…¥viewModelScope</span>
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> = externalScope.launch {
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = api.getData()
    }.join()
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€Android ä¸­ç»“æ„åŒ–å¹¶å‘çš„æœ€ä½³å®è·µ</h2>
<p>ç»“åˆ Google å®˜æ–¹æ–‡æ¡£ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fkotlin%2Fcoroutines%2Fcoroutines-best-practices" target="_blank" title="https://developer.android.com/kotlin/coroutines/coroutines-best-practices" ref="nofollow noopener noreferrer">Coroutines Best Practices</a>ï¼‰ä¸å®é™…å¼€å‘åœºæ™¯ï¼Œç»“æ„åŒ–å¹¶å‘çš„å®è·µéœ€èšç„¦ â€œä½œç”¨åŸŸé€‰æ‹©â€â€œå¯å–æ¶ˆæ€§ä¿éšœâ€â€œå¯æµ‹è¯•æ€§ä¼˜åŒ–â€ ä¸‰å¤§æ–¹å‘ã€‚</p>
<h3 data-id="heading-6">1. ä½œç”¨åŸŸé€‰æ‹©ï¼šæŒ‰ä¸šåŠ¡åœºæ™¯åŒ¹é…ç”Ÿå‘½å‘¨æœŸ</h3>
<p>ä¸åŒå±‚çº§çš„ç»„ä»¶åº”ä½¿ç”¨ä¸åŒçš„ä½œç”¨åŸŸï¼Œé¿å… â€œå¤§æå°ç”¨â€ æˆ– â€œç”Ÿå‘½å‘¨æœŸä¸åŒ¹é…â€ï¼š</p>






























<table><thead><tr><th>ç»„ä»¶å±‚çº§</th><th>æ¨èä½œç”¨åŸŸ</th><th>æ ¸å¿ƒåŸå› </th></tr></thead><tbody><tr><td>ViewModel</td><td><code>viewModelScope</code></td><td>ç”Ÿå‘½å‘¨æœŸè¦†ç›–é¡µé¢åˆ‡æ¢ï¼Œé¿å…é…ç½®å˜æ›´ï¼ˆå¦‚æ—‹è½¬ï¼‰å¯¼è‡´ä»»åŠ¡é‡å¯</td></tr><tr><td>Activity/Fragment</td><td><code>lifecycleScope</code></td><td>ä¸ UI ç”Ÿå‘½å‘¨æœŸå®Œå…¨åŒæ­¥ï¼Œé€‚åˆ UI ç›¸å…³å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚å€’è®¡æ—¶ï¼‰</td></tr><tr><td>åº”ç”¨çº§åå°ä»»åŠ¡</td><td>è‡ªå®šä¹‰ Scope</td><td>éœ€æ‰‹åŠ¨ç®¡ç†ï¼ˆå¦‚<code>CoroutineScope(SupervisorJob() + Dispatchers.IO)</code>ï¼‰ï¼Œé€‚åˆ â€œé€€å‡ºé¡µé¢ä»éœ€å®Œæˆâ€ çš„ä»»åŠ¡ï¼ˆå¦‚æ–‡ä»¶ä¸Šä¼ ï¼‰</td></tr><tr><td>ä¸šåŠ¡å±‚ / æ•°æ®å±‚</td><td>ä¸æŒæœ‰ Scopeï¼Œç”±è°ƒç”¨è€…ä¼ å…¥</td><td>éµå¾ª â€œè°å¯åŠ¨è°ç®¡ç†â€ åŸåˆ™ï¼Œæå‡å¤ç”¨æ€§ï¼ˆå¦‚ Repository æ¥æ”¶ ViewModel çš„<code>viewModelScope</code>ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-7">2. ç¡®ä¿åç¨‹å¯å–æ¶ˆï¼šä¸»åŠ¨æ£€æŸ¥å–æ¶ˆä¿¡å·</h3>
<p>åç¨‹çš„å–æ¶ˆæ˜¯ â€œåä½œå¼â€ çš„ â€”â€” åªæœ‰å½“åç¨‹æ‰§è¡Œåˆ°<code>suspend</code>å‡½æ•°ï¼ˆå¦‚<code>delay</code>ã€<code>withContext</code>ï¼‰æˆ–ä¸»åŠ¨æ£€æŸ¥å–æ¶ˆçŠ¶æ€æ—¶ï¼Œæ‰ä¼šå“åº”å–æ¶ˆã€‚è‹¥åç¨‹æ‰§è¡Œé˜»å¡æ“ä½œï¼ˆå¦‚å¾ªç¯è¯»å–æ–‡ä»¶ï¼‰ï¼Œéœ€ä¸»åŠ¨è°ƒç”¨<code>ensureActive()</code>æˆ–<code>isActive</code>æ£€æŸ¥ï¼Œé¿å… â€œå–æ¶ˆä¸ç”Ÿæ•ˆâ€ã€‚</p>
<p><strong>å®è·µæ¡ˆä¾‹ï¼šå¯å–æ¶ˆçš„æ–‡ä»¶è¯»å–</strong></p>
<pre><code class="hljs language-scss" lang="scss">viewModelScope<span class="hljs-selector-class">.launch</span> {
    val files = <span class="hljs-built_in">getFilesToRead</span>()
    for (file in files) {
        <span class="hljs-built_in">ensureActive</span>() <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯å‰æ£€æŸ¥å–æ¶ˆçŠ¶æ€ï¼Œè‹¥å·²å–æ¶ˆåˆ™æŠ›å‡ºCancellationException</span>
        <span class="hljs-built_in">readFileContent</span>(file) <span class="hljs-comment">// é˜»å¡æ“ä½œ</span>
    }
}
</code></pre>
<h3 data-id="heading-8">3. ä¼˜åŒ–å¯æµ‹è¯•æ€§ï¼šæ³¨å…¥è°ƒåº¦å™¨ï¼ˆDispatcherï¼‰</h3>
<p>ç¡¬ç¼–ç <code>Dispatchers</code>ï¼ˆå¦‚<code>Dispatchers.IO</code>ï¼‰ä¼šå¯¼è‡´æµ‹è¯•å›°éš¾ â€”â€” å•å…ƒæµ‹è¯•ä¸­æ— æ³•æ§åˆ¶åç¨‹æ‰§è¡Œæ—¶æœºï¼Œè€Œé€šè¿‡ â€œä¾èµ–æ³¨å…¥â€ æ–¹å¼ä¼ å…¥è°ƒåº¦å™¨ï¼Œå¯åœ¨æµ‹è¯•æ—¶æ›¿æ¢ä¸º<code>TestDispatcher</code>ï¼Œå®ç° â€œç¡®å®šæ€§æµ‹è¯•â€ã€‚</p>
<p><strong>æ­£ç¡®ç¤ºä¾‹ï¼šæ³¨å…¥è°ƒåº¦å™¨</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç”Ÿäº§ä»£ç ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥è°ƒåº¦å™¨ï¼Œé»˜è®¤å€¼ä¸ºDispatchers.IO</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> ioDispatcher: CoroutineDispatcher = Dispatchers.IO,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: NewsApi
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadNews</span><span class="hljs-params">()</span></span>: List&lt;Article&gt; = withContext(ioDispatcher) {
        api.getLatestNews()
    }
}

<span class="hljs-comment">// æµ‹è¯•ä»£ç ï¼šä¼ å…¥TestDispatcherï¼Œæ§åˆ¶åç¨‹æ‰§è¡Œ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NewsRepositoryTest</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testLoadNews</span><span class="hljs-params">()</span></span> = runTest { <span class="hljs-comment">// runTestæ˜¯Kotlinæµ‹è¯•åº“æä¾›çš„åç¨‹æµ‹è¯•ç¯å¢ƒ</span>
        <span class="hljs-keyword">val</span> testDispatcher = UnconfinedTestDispatcher(testScheduler)
        <span class="hljs-keyword">val</span> repo = NewsRepository(ioDispatcher = testDispatcher, api = FakeNewsApi())
        
        <span class="hljs-keyword">val</span> news = repo.loadNews()
        assertThat(news).isNotEmpty() <span class="hljs-comment">// ç¡®å®šæ€§æ–­è¨€</span>
    }
}
</code></pre>
<h2 data-id="heading-9">å››ã€ç»“æ„åŒ–å¹¶å‘çš„æ•ˆç‡ä¼˜åŠ¿</h2>
<p>ç»“æ„åŒ–å¹¶å‘ä¸ä»…è§£å†³äº† â€œå®‰å…¨æ€§â€ é—®é¢˜ï¼Œè¿˜é€šè¿‡ä¸åç¨‹ â€œè½»é‡çº§â€ ç‰¹æ€§çš„ç»“åˆï¼Œåœ¨æ•ˆç‡ä¸Šç¢¾å‹ä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å‹ï¼š</p>






























<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>ä¼ ç»Ÿå¤šçº¿ç¨‹</th><th>åç¨‹ç»“æ„åŒ–å¹¶å‘</th></tr></thead><tbody><tr><td>å†…å­˜å ç”¨</td><td>å•ä¸ªçº¿ç¨‹çº¦ 1MB æ ˆç©ºé—´</td><td>å•ä¸ªåç¨‹ä»…å‡ å KBï¼ˆå †ä¸Šä¿å­˜ Continuationï¼‰</td></tr><tr><td>ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬</td><td>å†…æ ¸æ€åˆ‡æ¢ï¼ˆæ¯«ç§’çº§ï¼‰</td><td>ç”¨æˆ·æ€åˆ‡æ¢ï¼ˆçº³ç§’çº§ï¼‰</td></tr><tr><td>å¹¶å‘æ•°é‡ä¸Šé™</td><td>æ•°åƒçº¿ç¨‹ï¼ˆæ˜“ OOMï¼‰</td><td>å•æœºæ”¯æŒ 10 ä¸‡ + åç¨‹</td></tr><tr><td>çº¿ç¨‹åˆ©ç”¨ç‡</td><td>IO é˜»å¡æ—¶çº¿ç¨‹é—²ç½®</td><td>IO æŒ‚èµ·æ—¶çº¿ç¨‹å¯æ‰§è¡Œå…¶ä»–åç¨‹</td></tr></tbody></table>
<p>ä»¥ â€œ1000 æ¬¡ç½‘ç»œè¯·æ±‚â€ ä¸ºä¾‹ï¼š</p>
<ul>
<li>ä¼ ç»Ÿå¤šçº¿ç¨‹ï¼šéœ€åˆ›å»ºçº¿ç¨‹æ± ï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°çº¦ 200ï¼‰ï¼Œå¤§é‡çº¿ç¨‹åœ¨ IO ç­‰å¾…æ—¶é—²ç½®ï¼Œåˆ‡æ¢æˆæœ¬é«˜ï¼›</li>
<li>åç¨‹ç»“æ„åŒ–å¹¶å‘ï¼šä»…éœ€å°‘é‡çº¿ç¨‹ï¼ˆå¦‚ Dispatchers.IO é»˜è®¤ 64 ä¸ªï¼‰ï¼Œä¸€ä¸ªçº¿ç¨‹å¯å¤„ç†æ•°ç™¾ä¸ªåç¨‹ï¼ŒIO æŒ‚èµ·æ—¶çº¿ç¨‹ç«‹å³é‡Šæ”¾ï¼Œåˆ©ç”¨ç‡æå‡ 10 å€ä»¥ä¸Šã€‚</li>
</ul>
<h2 data-id="heading-10">äº”ã€å¸¸è§è¯¯åŒºä¸é¿å‘æŒ‡å—</h2>
<ol>
<li>
<p><strong>è¯¯åŒº 1ï¼šç”¨<code>GlobalScope</code>å¯åŠ¨ â€œé•¿æœŸä»»åŠ¡â€</strong></p>
<ul>
<li>åæœï¼š<code>GlobalScope</code>æ— ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œä»»åŠ¡å¯èƒ½ä¸€ç›´è¿è¡Œåˆ°åº”ç”¨é€€å‡ºï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ï¼›</li>
<li>æ›¿ä»£æ–¹æ¡ˆï¼šåˆ›å»ºè‡ªå®šä¹‰<code>CoroutineScope</code>ï¼Œå¹¶åœ¨åº”ç”¨é€€å‡ºæ—¶æ‰‹åŠ¨å–æ¶ˆï¼ˆå¦‚åœ¨ Application çš„<code>onTerminate()</code>ä¸­è°ƒç”¨<code>scope.cancel()</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¯¯åŒº 2ï¼šæ•è·<code>CancellationException</code>å¹¶ â€œåæ‰â€</strong></p>
<ul>
<li>åæœï¼šåç¨‹æ— æ³•å“åº”å–æ¶ˆä¿¡å·ï¼Œå³ä½¿ä½œç”¨åŸŸé”€æ¯ï¼Œä»»åŠ¡ä»ç»§ç»­è¿è¡Œï¼›</li>
<li>æ­£ç¡®åšæ³•ï¼šä»…æ•è·ä¸šåŠ¡å¼‚å¸¸ï¼ˆå¦‚<code>IOException</code>ï¼‰ï¼Œ<code>CancellationException</code>æ— éœ€å¤„ç†ï¼ˆæˆ–æ•è·åé‡æ–°æŠ›å‡ºï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¯¯åŒº 3ï¼šåœ¨ ViewModel ä¸­æš´éœ²<code>suspend</code>å‡½æ•°ç»™ View</strong></p>
<ul>
<li>åæœï¼šView éœ€è‡ªè¡Œå¯åŠ¨åç¨‹ï¼ˆå¦‚ç”¨<code>lifecycleScope</code>ï¼‰ï¼Œç ´å â€œViewModel ç®¡ç†ä¸šåŠ¡é€»è¾‘â€ çš„åˆ†å±‚åŸåˆ™ï¼›</li>
<li>æ­£ç¡®åšæ³•ï¼šViewModel ä¸­åˆ›å»ºåç¨‹ï¼ˆç”¨<code>viewModelScope</code>ï¼‰ï¼Œé€šè¿‡<code>StateFlow</code>æš´éœ² UI çŠ¶æ€ï¼ŒView ä»…è§‚å¯ŸçŠ¶æ€å˜åŒ–ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-11">ç»“è¯­</h2>
<p>Kotlin åç¨‹çš„ç»“æ„åŒ–å¹¶å‘ï¼Œå¹¶éç®€å•çš„ â€œè¯­æ³•ç³–â€ï¼Œè€Œæ˜¯å¯¹å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹çš„é‡æ„ï¼šå®ƒé€šè¿‡ â€œä½œç”¨åŸŸâ€ å°†å¼‚æ­¥ä»»åŠ¡ä» â€œä¸å¯æ§çš„é‡çº¿ç¨‹â€ å˜ä¸º â€œå¯ç®¡ç†çš„ç”Ÿå‘½å‘¨æœŸå•å…ƒâ€ï¼Œæ—¢è§£å†³äº†ä¼ ç»Ÿå¤šçº¿ç¨‹çš„å®‰å…¨ç—›ç‚¹ï¼Œåˆä¿ç•™äº†åç¨‹çš„é«˜æ•ˆç‰¹æ€§ã€‚æŒæ¡ç»“æ„åŒ–å¹¶å‘ï¼Œä¸ä»…æ˜¯æŠ€æœ¯èƒ½åŠ›çš„æå‡ï¼Œæ›´æ˜¯å¯¹ â€œå¼‚æ­¥ç¼–ç¨‹æœ¬è´¨â€ çš„æ·±åˆ»ç†è§£ã€‚</p>
<p><strong><strong>æ¬¢è¿å…³æ³¨å…¬ä¼—å·åº¦ç†Šå›ï¼Œä¸€èµ·åˆ†äº«äº¤æµã€‚</strong></strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[mysqlåœ¨æŸ¥è¯¢çš„æ—¶å€™èµ°ç´¢å¼•æ¯”ä¸èµ°ç´¢å¼•ä¸€å®šå¿«å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7575807729722753058</link>    <guid>https://juejin.cn/post/7575807729722753058</guid>    <pubDate>2025-11-23T14:06:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575807729722753058" data-draft-id="7575363120798597120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="mysqlåœ¨æŸ¥è¯¢çš„æ—¶å€™èµ°ç´¢å¼•æ¯”ä¸èµ°ç´¢å¼•ä¸€å®šå¿«å—ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T14:06:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="éšé£é£˜çš„äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/361110952753560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            mysqlåœ¨æŸ¥è¯¢çš„æ—¶å€™èµ°ç´¢å¼•æ¯”ä¸èµ°ç´¢å¼•ä¸€å®šå¿«å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/361110952753560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    éšé£é£˜çš„äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:06:17.000Z" title="Sun Nov 23 2025 14:06:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç´¢å¼•çš„æ ¸å¿ƒä»·å€¼æ˜¯<strong>å‡å°‘æ•°æ®åº“æ‰«æçš„æ•°æ®é‡</strong>ï¼Œä»è€Œæå‡æŸ¥è¯¢æ•ˆç‡ï¼Œä½†è¿™å¹¶éç»å¯¹è§„å¾‹ã€‚å½“ç´¢å¼•çš„ â€œé¢å¤–å¼€é”€â€ è¶…è¿‡å…¶ â€œæ‰«æä¼˜åŒ–æ”¶ç›Šâ€ æ—¶ï¼Œèµ°ç´¢å¼•åè€Œä¼šæ¯”å…¨è¡¨æ‰«ææ›´æ…¢ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒå‰æï¼šç´¢å¼•çš„ â€œæ”¶ç›Šâ€ ä¸ â€œå¼€é”€â€</h2>
<p>è¦ç†è§£ â€œèµ°ç´¢å¼•ä¸ä¸€å®šå¿«â€ï¼Œé¦–å…ˆè¦æ˜ç¡®ç´¢å¼•çš„æœ¬è´¨æ˜¯ã€Œtrade-offã€ï¼ˆæƒè¡¡ï¼‰ï¼š</p>
<h3 data-id="heading-1">1. ç´¢å¼•çš„ â€œæ”¶ç›Šâ€</h3>
<ul>
<li>å‡å°‘æ‰«æè¡Œæ•°ï¼šé€šè¿‡ç´¢å¼•æ ‘å¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®ï¼Œé¿å…å…¨è¡¨éå†ï¼ˆå¦‚åƒä¸‡çº§è¡¨ä¸­æŸ¥è¯¢ 1 æ¡æ•°æ®ï¼Œç´¢å¼•å¯ç›´æ¥å‘½ä¸­ï¼Œæ‰«æè¡Œæ•° = 1ï¼‰ï¼›</li>
<li>é¿å…æ’åº / ä¸´æ—¶è¡¨ï¼šè‹¥<code>ORDER BY</code>/<code>GROUP BY</code>å­—æ®µåœ¨ç´¢å¼•ä¸­ï¼Œå¯ç›´æ¥åˆ©ç”¨ç´¢å¼•é¡ºåºï¼Œé¿å…<code>Using filesort</code>/<code>Using temporary</code>ã€‚</li>
</ul>
<h3 data-id="heading-2">2. ç´¢å¼•çš„ â€œå¼€é”€â€</h3>
<ul>
<li>ç´¢å¼•ç»´æŠ¤å¼€é”€ï¼šç´¢å¼•æ˜¯ç‹¬ç«‹çš„æ•°æ®ç»“æ„ï¼ˆå¦‚ B + æ ‘ï¼‰ï¼ŒæŸ¥è¯¢æ—¶éœ€å…ˆéå†ç´¢å¼•æ ‘ï¼Œå†é€šè¿‡ç´¢å¼•æŒ‡å‘çš„ â€œè¡ŒæŒ‡é’ˆâ€ å›è¡¨æŸ¥è¯¢å®Œæ•´æ•°æ®ï¼ˆèšç°‡ç´¢å¼•é™¤å¤–ï¼‰ï¼›</li>
<li>IO å¼€é”€ï¼šç´¢å¼•æ–‡ä»¶ä¼šå ç”¨é¢å¤–ç£ç›˜ç©ºé—´ï¼ŒæŸ¥è¯¢æ—¶éœ€è¯»å–ç´¢å¼•æ–‡ä»¶ + æ•°æ®æ–‡ä»¶ï¼ˆå…¨è¡¨æ‰«æä»…éœ€è¯»å–æ•°æ®æ–‡ä»¶ï¼‰ï¼›</li>
<li>ä¼˜åŒ–å™¨åˆ¤æ–­å¼€é”€ï¼šæ•°æ®åº“ä¼˜åŒ–å™¨éœ€è®¡ç®— â€œèµ°ç´¢å¼•çš„æˆæœ¬â€ å’Œ â€œå…¨è¡¨æ‰«æçš„æˆæœ¬â€ï¼Œå†é€‰æ‹©æ›´ä¼˜æ–¹æ¡ˆï¼ˆè‹¥ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶ï¼Œå¯èƒ½è¯¯åˆ¤ï¼‰ã€‚</li>
</ul>
<p>å½“ã€Œå¼€é”€ &gt; æ”¶ç›Šã€æ—¶ï¼Œèµ°ç´¢å¼•ä¼šæ›´æ…¢ï¼›åªæœ‰å½“ã€Œæ”¶ç›Š &gt; å¼€é”€ã€æ—¶ï¼Œç´¢å¼•æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</p>
<h2 data-id="heading-3">äºŒã€èµ°ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ…¢çš„ 5 ç§å…¸å‹åœºæ™¯ï¼ˆå«åŸç† + æ¡ˆä¾‹ï¼‰</h2>
<h3 data-id="heading-4">åœºæ™¯ 1ï¼šæŸ¥è¯¢æ•°æ®é‡å æ¯”æé«˜ï¼ˆé«˜é€‰æ‹©æ€§å·®ï¼‰</h3>
<h4 data-id="heading-5">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>ç´¢å¼•çš„ä¼˜åŠ¿åœ¨ â€œè¿‡æ»¤å°‘é‡æ•°æ®â€ï¼Œè‹¥æŸ¥è¯¢éœ€è¦è¿”å›è¡¨ä¸­<strong>å¤§éƒ¨åˆ†æ•°æ®</strong>ï¼ˆå¦‚ 30% ä»¥ä¸Šï¼‰ï¼Œç´¢å¼•çš„ â€œå‡å°‘æ‰«æè¡Œæ•°â€ æ”¶ç›Šä¼šå®Œå…¨æŠµæ¶ˆï¼Œè€Œ â€œç´¢å¼•éå† + å›è¡¨â€ çš„å¼€é”€ä¼šå‡¸æ˜¾ã€‚</p>
<ul>
<li>å…¨è¡¨æ‰«æï¼šæ•°æ®åº“é‡‡ç”¨ã€Œé¡ºåº IOã€è¯»å–æ•°æ®ï¼ˆæœºæ¢°ç¡¬ç›˜ / SSD çš„é¡ºåº IO æ•ˆç‡è¿œé«˜äºéšæœº IOï¼‰ï¼Œæ— éœ€é¢å¤–éå†ç´¢å¼•ï¼›</li>
<li>èµ°ç´¢å¼•ï¼šéœ€å…ˆéå†ç´¢å¼•æ ‘ï¼ˆéšæœº IOï¼‰ï¼Œå†æ ¹æ®ç´¢å¼•ä¸­çš„è¡ŒæŒ‡é’ˆå›è¡¨è¯»å–æ•°æ®ï¼ˆå¤šæ¬¡éšæœº IOï¼‰ï¼Œæ€» IO å¼€é”€åè€Œæ›´å¤§ã€‚</li>
</ul>
<h4 data-id="heading-6">æ¡ˆä¾‹ï¼ˆMySQL InnoDBï¼‰ï¼š</h4>
<p>å‡è®¾æœ‰ä¸€å¼ <code>user</code>è¡¨ï¼ˆ100 ä¸‡è¡Œæ•°æ®ï¼‰ï¼ŒæŸ¥è¯¢ â€œæ‰€æœ‰å¹´é¾„å¤§äº 18 å²çš„ç”¨æˆ·â€ï¼ˆå æ¯”çº¦ 80%ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åœºæ™¯ï¼šageå­—æ®µæœ‰ç´¢å¼•ï¼Œä½†æŸ¥è¯¢æ•°æ®å æ¯”80%</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">18</span>;
</code></pre>
<ul>
<li>èµ°ç´¢å¼•ï¼šéå†ç´¢å¼•æ ‘æ‰¾åˆ°æ‰€æœ‰æ»¡è¶³<code>age&gt;18</code>çš„è¡ŒæŒ‡é’ˆï¼ˆ80 ä¸‡æ¡ï¼‰ï¼Œå†é€è¡Œå›è¡¨è¯»å–å®Œæ•´æ•°æ®ï¼ˆ80 ä¸‡æ¬¡éšæœº IOï¼‰ï¼›</li>
<li>å…¨è¡¨æ‰«æï¼šé¡ºåºè¯»å–æ•´ä¸ªæ•°æ®æ–‡ä»¶ï¼ˆ1 æ¬¡è¿ç»­ IOï¼‰ï¼Œç›´æ¥è¿‡æ»¤æ•°æ®ã€‚æ­¤æ—¶ä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨é€‰æ‹©å…¨è¡¨æ‰«æï¼Œè€Œéèµ°ç´¢å¼•ã€‚</li>
</ul>
<h4 data-id="heading-7">å…³é”®æ¦‚å¿µï¼šç´¢å¼•é€‰æ‹©æ€§</h4>
<ul>
<li>é€‰æ‹©æ€§ = å­—æ®µå”¯ä¸€å€¼æ•°é‡ / æ€»è®°å½•æ•°ï¼ˆé€‰æ‹©æ€§è¶Šé«˜ï¼Œç´¢å¼•è¶Šæœ‰ç”¨ï¼‰ï¼›</li>
<li>ä¾‹ï¼š<code>id</code>ï¼ˆä¸»é”®ï¼Œé€‰æ‹©æ€§ = 100%ï¼‰&gt;Â <code>phone</code>ï¼ˆå”¯ä¸€ç´¢å¼•ï¼Œé€‰æ‹©æ€§â‰ˆ99%ï¼‰&gt;Â <code>age</code>ï¼ˆé€‰æ‹©æ€§â‰ˆ10%ï¼‰&gt;Â <code>gender</code>ï¼ˆæ€§åˆ«ï¼Œé€‰æ‹©æ€§â‰ˆ2%ï¼‰ï¼›</li>
<li>ä½é€‰æ‹©æ€§å­—æ®µï¼ˆå¦‚<code>gender</code>ï¼‰ï¼šå³ä½¿æŸ¥è¯¢å æ¯” 20%ï¼Œèµ°ç´¢å¼•ä¹Ÿå¯èƒ½æ¯”å…¨è¡¨æ‰«ææ…¢ã€‚</li>
</ul>
<h3 data-id="heading-8">åœºæ™¯ 2ï¼šè¡¨æ•°æ®é‡æå°ï¼ˆå¦‚å‡ ç™¾è¡Œï¼‰</h3>
<h4 data-id="heading-9">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>å°è¡¨çš„å…¨è¡¨æ‰«æå¼€é”€æä½ï¼ˆå¦‚ 100 è¡Œæ•°æ®ï¼Œå…¨è¡¨æ‰«æä»…éœ€è¯»å– 1 ä¸ªæ•°æ®é¡µï¼‰ï¼Œè€Œç´¢å¼•çš„ â€œéå†ç´¢å¼•æ ‘ + å›è¡¨â€ å¼€é”€ç›¸å¯¹æ›´é«˜ï¼Œå®Œå…¨æ²¡å¿…è¦èµ°ç´¢å¼•ã€‚</p>
<h4 data-id="heading-10">æ¡ˆä¾‹ï¼š</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨ï¼šuser_smallï¼ˆä»…50è¡Œæ•°æ®ï¼Œageæœ‰ç´¢å¼•ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> user_small <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<ul>
<li>å…¨è¡¨æ‰«æï¼šç›´æ¥è¯»å– 1 ä¸ªæ•°æ®é¡µï¼ˆInnoDB é»˜è®¤é¡µå¤§å° 16KBï¼‰ï¼Œéå† 50 è¡Œæ•°æ®ï¼Œè€—æ—¶ &lt; 1msï¼›</li>
<li>èµ°ç´¢å¼•ï¼šå…ˆè¯»å–ç´¢å¼•é¡µï¼ˆ1 ä¸ªï¼‰ï¼Œæ‰¾åˆ°<code>age=25</code>çš„è¡ŒæŒ‡é’ˆï¼Œå†å›è¡¨è¯»å–æ•°æ®é¡µï¼ˆ1 ä¸ªï¼‰ï¼Œæ€» IO æ¬¡æ•°ä¸å…¨è¡¨æ‰«æç›¸åŒï¼Œä½†å¤šäº†ç´¢å¼•æ ‘éå†çš„é€»è¾‘å¼€é”€ã€‚ä¼˜åŒ–å™¨ä¼šç›´æ¥é€‰æ‹©å…¨è¡¨æ‰«æï¼Œå¿½ç•¥ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-11">åœºæ™¯ 3ï¼šç´¢å¼•å¤±æ•ˆå¯¼è‡´ â€œä¼ªèµ°ç´¢å¼•â€</h3>
<h4 data-id="heading-12">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>çœ‹ä¼¼ â€œèµ°äº†ç´¢å¼•â€ï¼Œä½†å®é™…æ˜¯ã€Œå…¨ç´¢å¼•æ‰«æã€ï¼ˆ<code>type=index</code>ï¼‰ï¼Œè€Œéã€Œç´¢å¼•ç²¾å‡†å‘½ä¸­ã€ï¼ˆ<code>type=ref/range</code>ï¼‰ã€‚å…¨ç´¢å¼•æ‰«æéœ€è¦éå†æ•´ä¸ªç´¢å¼•æ ‘ï¼Œè‹¥ç´¢å¼•æ–‡ä»¶æ¯”æ•°æ®æ–‡ä»¶æ›´å¤§ï¼Œè€—æ—¶ä¼šè¶…è¿‡å…¨è¡¨æ‰«æã€‚</p>
<h4 data-id="heading-13">å…¸å‹æ¡ˆä¾‹ï¼ˆç´¢å¼•å¤±æ•ˆåœºæ™¯ï¼‰ï¼š</h4>
<ol>
<li>
<p>ç´¢å¼•å­—æ®µè¢«å‡½æ•°æ“ä½œï¼ˆå¦‚<code>DATE(create_time)</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- create_timeæœ‰ç´¢å¼•ï¼Œä½†å‡½æ•°æ“ä½œå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå®é™…èµ°å…¨ç´¢å¼•æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-type">DATE</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-string">'2025-11-23'</span>;
</code></pre>
</li>
<li>
<p>éšå¼ç±»å‹è½¬æ¢ï¼ˆå¦‚<code>phone</code>æ˜¯<code>INT</code>ï¼ŒæŸ¥è¯¢ç”¨å­—ç¬¦ä¸²ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- phoneæ˜¯INTç±»å‹ï¼Œ'13800138000'æ˜¯å­—ç¬¦ä¸²ï¼Œéšå¼è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
</li>
<li>
<p>è”åˆç´¢å¼•ä¸æ»¡è¶³æœ€å·¦å‰ç¼€åŸåˆ™ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è”åˆç´¢å¼•ï¼šidx_age_name(age, name)ï¼ŒæŸ¥è¯¢æ— ageï¼Œä»…æŸ¥name</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'å¼ ä¸‰'</span>; <span class="hljs-comment">-- èµ°å…¨ç´¢å¼•æ‰«æï¼ˆtype=indexï¼‰</span>
</code></pre>
</li>
</ol>
<h4 data-id="heading-14">å¯¹æ¯”ï¼š</h4>
<ul>
<li>å…¨ç´¢å¼•æ‰«æï¼ˆ<code>type=index</code>ï¼‰ï¼šéå†æ•´ä¸ªç´¢å¼•æ ‘ï¼ˆå¦‚ç´¢å¼•æ–‡ä»¶ 100MBï¼‰ï¼Œè€—æ—¶ä¹…ï¼›</li>
<li>å…¨è¡¨æ‰«æï¼ˆ<code>type=ALL</code>ï¼‰ï¼šéå†æ•°æ®æ–‡ä»¶ï¼ˆå¦‚æ•°æ®æ–‡ä»¶ 80MBï¼‰ï¼Œè€—æ—¶æ›´çŸ­ã€‚</li>
</ul>
<h3 data-id="heading-15">åœºæ™¯ 4ï¼šéœ€è¦ â€œå›è¡¨â€ ä¸”æ•°æ®åˆ†æ•£</h3>
<h4 data-id="heading-16">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>éèšç°‡ç´¢å¼•ï¼ˆå¦‚æ™®é€šç´¢å¼•ã€è”åˆç´¢å¼•ï¼‰çš„å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ã€Œä¸»é”®å€¼ã€ï¼Œè€Œéå®Œæ•´æ•°æ®ã€‚æŸ¥è¯¢æ—¶éœ€å…ˆé€šè¿‡ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œå†åˆ°èšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰ä¸­æŸ¥è¯¢å®Œæ•´æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å«ã€Œå›è¡¨ã€ã€‚è‹¥æŸ¥è¯¢çš„æ•°æ®åˆ†æ•£åœ¨è¡¨ä¸­å¤šä¸ªæ•°æ®é¡µï¼Œå›è¡¨ä¼šäº§ç”Ÿå¤§é‡ã€Œéšæœº IOã€ï¼ˆæ¯ä¸ªæ•°æ®é¡µéœ€å•ç‹¬è¯»å–ï¼‰ï¼Œè€Œå…¨è¡¨æ‰«ææ˜¯ã€Œé¡ºåº IOã€ï¼ˆè¿ç»­è¯»å–æ•°æ®é¡µï¼‰ï¼Œæ•ˆç‡æ›´é«˜ã€‚</p>
<h4 data-id="heading-17">æ¡ˆä¾‹ï¼š</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨ï¼šorderï¼ˆ10ä¸‡è¡Œï¼Œæ™®é€šç´¢å¼•idx_user_id(user_id)ï¼Œéèšç°‡ç´¢å¼•ï¼‰</span>
<span class="hljs-comment">-- æŸ¥è¯¢ï¼šç”¨æˆ·IDåœ¨100-200ä¹‹é—´çš„æ‰€æœ‰è®¢å•ï¼ˆå…±5000æ¡ï¼Œåˆ†æ•£åœ¨100ä¸ªæ•°æ®é¡µï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">200</span>;
</code></pre>
<ul>
<li>èµ°ç´¢å¼•ï¼šéå† idx_user_id æ‰¾åˆ° 5000 ä¸ªä¸»é”®â†’å›è¡¨æŸ¥è¯¢ 100 ä¸ªæ•°æ®é¡µï¼ˆ100 æ¬¡éšæœº IOï¼‰ï¼›</li>
<li>å…¨è¡¨æ‰«æï¼šé¡ºåºè¯»å– 50 ä¸ªæ•°æ®é¡µï¼ˆè¦†ç›–æ‰€æœ‰ç›®æ ‡æ•°æ®ï¼‰ï¼Œ1 æ¬¡è¿ç»­ IOã€‚æ­¤æ—¶éšæœº IO çš„å¼€é”€è¿œå¤§äºé¡ºåº IOï¼Œèµ°ç´¢å¼•æ›´æ…¢ã€‚</li>
</ul>
<h3 data-id="heading-18">åœºæ™¯ 5ï¼šå†™å…¥æ“ä½œï¼ˆINSERT/UPDATE/DELETEï¼‰â€”â€” ç´¢å¼•åè€Œæ‹–æ…¢é€Ÿåº¦</h3>
<h4 data-id="heading-19">æ ¸å¿ƒé€»è¾‘ï¼š</h4>
<p>ç´¢å¼•å¯¹ã€ŒæŸ¥è¯¢ã€æ˜¯ä¼˜åŒ–ï¼Œä½†å¯¹ã€Œå†™å…¥ã€æ˜¯è´Ÿæ‹…ã€‚å†™å…¥æ—¶ï¼Œæ•°æ®åº“ä¸ä»…è¦ä¿®æ”¹æ•°æ®æ–‡ä»¶ï¼Œè¿˜è¦åŒæ­¥ç»´æŠ¤æ‰€æœ‰ç›¸å…³ç´¢å¼•ï¼ˆå¦‚ B + æ ‘çš„åˆ†è£‚ã€åˆå¹¶ã€æ’åºï¼‰ï¼Œç´¢å¼•è¶Šå¤šï¼Œå†™å…¥å¼€é”€è¶Šå¤§ã€‚</p>
<h4 data-id="heading-20">æ¡ˆä¾‹ï¼š</h4>
<p>ä¸€å¼ è¡¨æœ‰ 5 ä¸ªç´¢å¼•ï¼Œæ’å…¥ 1 æ¡æ•°æ®æ—¶ï¼š</p>
<ul>
<li>æ— ç´¢å¼•ï¼šä»…éœ€åœ¨æ•°æ®æ–‡ä»¶æœ«å°¾æ’å…¥ï¼ˆæˆ–æŒ‡å®šä½ç½®ä¿®æ”¹ï¼‰ï¼Œè€—æ—¶ 1msï¼›</li>
<li>æœ‰ç´¢å¼•ï¼šéœ€ä¿®æ”¹ 5 ä¸ªç´¢å¼•æ ‘ï¼ˆæ¯ä¸ªç´¢å¼•æ ‘éƒ½è¦æ‰¾åˆ°å¯¹åº”ä½ç½®æ’å…¥ / æ›´æ–°ï¼‰ï¼Œè€—æ—¶ 5ms+ã€‚æ­¤æ—¶ç´¢å¼•è¶Šå¤šï¼Œå†™å…¥è¶Šæ…¢ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´é”ç­‰å¾…æ—¶é—´å»¶é•¿ã€‚</li>
</ul>
<h2 data-id="heading-21">ä¸‰ã€æ•°æ®åº“ä¼˜åŒ–å™¨çš„ â€œå†³ç­–é€»è¾‘â€ï¼šä½•æ—¶é€‰æ‹©èµ°ç´¢å¼• / å…¨è¡¨æ‰«æï¼Ÿ</h2>
<p>æ•°æ®åº“ä¸ä¼šç›²ç›®èµ°ç´¢å¼•ï¼Œè€Œæ˜¯é€šè¿‡ã€Œæˆæœ¬è®¡ç®—ã€å†³å®šæœ€ä¼˜æ–¹æ¡ˆï¼ˆä»¥ MySQL ä¸ºä¾‹ï¼‰ï¼š</p>
<h3 data-id="heading-22">1. ä¼˜åŒ–å™¨çš„ â€œæˆæœ¬æ¨¡å‹â€</h3>
<ul>
<li>å…¨è¡¨æ‰«ææˆæœ¬ = æ•°æ®æ–‡ä»¶å¤§å° Ã— æ¯é¡µ IO æˆæœ¬ + æ‰«æè¡Œæ•° Ã— è¡Œè¿‡æ»¤æˆæœ¬ï¼›</li>
<li>èµ°ç´¢å¼•æˆæœ¬ = ç´¢å¼•æ–‡ä»¶å¤§å° Ã— æ¯é¡µ IO æˆæœ¬ + ç´¢å¼•æ‰«æè¡Œæ•° Ã— è¡Œè¿‡æ»¤æˆæœ¬ + å›è¡¨è¡Œæ•° Ã— å›è¡¨æˆæœ¬ã€‚</li>
</ul>
<p>ä¼˜åŒ–å™¨ä¼šå¯¹æ¯”ä¸¤è€…æˆæœ¬ï¼Œé€‰æ‹©æˆæœ¬æ›´ä½çš„æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-23">2. å½±å“å†³ç­–çš„å…³é”®å› ç´ </h3>
<ul>
<li>ç»Ÿè®¡ä¿¡æ¯ï¼šæ•°æ®åº“ä¼šè®°å½•è¡¨çš„è¡Œæ•°ã€æ•°æ®é¡µæ•°é‡ã€ç´¢å¼•é€‰æ‹©æ€§ç­‰ç»Ÿè®¡ä¿¡æ¯ï¼ˆé€šè¿‡<code>ANALYZE TABLE</code>æ›´æ–°ï¼‰ï¼Œç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶ä¼šå¯¼è‡´è¯¯åˆ¤ï¼›</li>
<li>æŸ¥è¯¢æ¡ä»¶ï¼š<code>WHERE</code>å­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼ˆå¦‚<code>=</code>vs<code>&gt;</code>ï¼‰ã€è¿”å›å­—æ®µï¼ˆ<code>SELECT *</code>vs<code>SELECT ä¸»é”®</code>ï¼‰ï¼›</li>
<li>ç´¢å¼•ç±»å‹ï¼šèšç°‡ç´¢å¼•ï¼ˆæ— éœ€å›è¡¨ï¼‰æ¯”éèšç°‡ç´¢å¼•æ›´æ˜“è¢«é€‰æ‹©ï¼Œè¦†ç›–ç´¢å¼•ï¼ˆæ— éœ€å›è¡¨ï¼‰æˆæœ¬æœ€ä½ã€‚</li>
</ul>
<h4 data-id="heading-24">ä¾‹å­ï¼šç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶å¯¼è‡´çš„è¯¯åˆ¤</h4>
<p>è‹¥è¡¨ä¸­å®é™…æ•°æ® 100 ä¸‡è¡Œï¼Œä½†ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºä»… 1 ä¸‡è¡Œï¼Œä¼˜åŒ–å™¨å¯èƒ½è¯¯åˆ¤ â€œèµ°ç´¢å¼•æˆæœ¬æ›´ä½â€ï¼Œä½†å®é™…æŸ¥è¯¢æ—¶å›è¡¨å¼€é”€æå¤§ï¼Œå¯¼è‡´èµ°ç´¢å¼•æ¯”å…¨è¡¨æ‰«ææ…¢ã€‚æ­¤æ—¶éœ€æ‰§è¡Œ<code>ANALYZE TABLE è¡¨å</code>æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-25">å››ã€é¢è¯•é«˜é¢‘è€ƒç‚¹ï¼šå¦‚ä½•åˆ¤æ–­ â€œæ˜¯å¦è¯¥èµ°ç´¢å¼•â€ï¼Ÿï¼ˆå®ç”¨æŠ€å·§ï¼‰</h2>
<ol>
<li>
<p><strong>çœ‹æŸ¥è¯¢æ•°æ®å æ¯”</strong>ï¼šè¿”å›æ•°æ®å æ¯” &lt;10%â†’èµ°ç´¢å¼•ï¼›å æ¯”&gt; 30%â†’å…¨è¡¨æ‰«ææ›´ä¼˜ï¼›</p>
</li>
<li>
<p><strong>çœ‹ç´¢å¼•é€‰æ‹©æ€§</strong>ï¼šé€‰æ‹©æ€§ &gt; 30%â†’ç´¢å¼•æœ‰ç”¨ï¼›é€‰æ‹©æ€§ &lt; 10%â†’ä½é€‰æ‹©æ€§å­—æ®µï¼ˆå¦‚æ€§åˆ«ï¼‰ï¼Œèµ°ç´¢å¼•å¯èƒ½æ›´æ…¢ï¼›</p>
</li>
<li>
<p><strong>çœ‹æ˜¯å¦å›è¡¨</strong>ï¼šè¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢å­—æ®µå‡åœ¨ç´¢å¼•ä¸­ï¼‰â†’ å¿…èµ°ç´¢å¼•ï¼ˆæ— å›è¡¨å¼€é”€ï¼‰ï¼›<code>SELECT *</code>+ éèšç°‡ç´¢å¼•â†’ éœ€å›è¡¨ï¼Œéœ€è¯„ä¼°æˆæœ¬ï¼›</p>
</li>
<li>
<p><strong>ç”¨ EXPLAIN éªŒè¯</strong>ï¼š</p>
<ul>
<li><code>type</code>å­—æ®µï¼š<code>ref</code>/<code>range</code>â†’ æœ‰æ•ˆç´¢å¼•ï¼ˆå¿«ï¼‰ï¼›<code>index</code>â†’ å…¨ç´¢å¼•æ‰«æï¼ˆå¯èƒ½æ¯”<code>ALL</code>æ…¢ï¼‰ï¼›</li>
<li><code>rows</code>å­—æ®µï¼šé¢„ä¼°æ‰«æè¡Œæ•°è¶Šå°‘ï¼Œèµ°ç´¢å¼•è¶Šä¼˜ï¼›</li>
<li><code>Extra</code>å­—æ®µï¼š<code>Using index</code>ï¼ˆè¦†ç›–ç´¢å¼•ï¼Œæœ€ä¼˜ï¼‰ã€<code>Using index condition</code>ï¼ˆICP ä¼˜åŒ–ï¼Œè¾ƒä¼˜ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-26">äº”ã€æ€»ç»“ï¼šæ ¸å¿ƒåŸåˆ™ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-27">1. æ ¸å¿ƒç»“è®º</h3>
<ul>
<li>èµ°ç´¢å¼•ä¸ä¸€å®šæ¯”å…¨è¡¨æ‰«æå¿«ï¼Œå…³é”®çœ‹ã€Œæ”¶ç›Šï¼ˆå‡å°‘æ‰«æè¡Œæ•°ï¼‰æ˜¯å¦å¤§äºå¼€é”€ï¼ˆç´¢å¼•éå† + å›è¡¨ï¼‰ã€ï¼›</li>
<li>ç´¢å¼•çš„ä»·å€¼æ˜¯ â€œè¿‡æ»¤å°‘é‡ã€é«˜é€‰æ‹©æ€§æ•°æ®â€ï¼Œè€Œé â€œä¸‡èƒ½ä¼˜åŒ–â€ã€‚</li>
</ul>
<h3 data-id="heading-28">2. é¿å‘æŒ‡å—</h3>
<ul>
<li>é¿å…ç»™ä½é€‰æ‹©æ€§å­—æ®µå»ºç´¢å¼•ï¼ˆå¦‚æ€§åˆ«ã€çŠ¶æ€ï¼‰ï¼Œåè€Œä¼šæ‹–æ…¢å†™å…¥å’ŒæŸ¥è¯¢ï¼›</li>
<li>å°è¡¨æ— éœ€å»ºç´¢å¼•ï¼ˆå…¨è¡¨æ‰«ææ•ˆç‡è¶³å¤Ÿï¼‰ï¼Œç´¢å¼•åªä¼šå¢åŠ ç»´æŠ¤å¼€é”€ï¼›</li>
<li>é¿å…<code>SELECT *</code>ï¼šä¼˜å…ˆç”¨è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢å­—æ®µ = ç´¢å¼•å­—æ®µï¼‰ï¼Œå‡å°‘å›è¡¨å¼€é”€ï¼›</li>
<li>å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼ˆ<code>ANALYZE TABLE</code>ï¼‰ï¼Œé¿å…ä¼˜åŒ–å™¨è¯¯åˆ¤ï¼›</li>
<li>ç”¨<code>EXPLAIN</code>åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œè‹¥å‘ç°<code>type=index</code>ä½†<code>rows</code>æå¤§ï¼Œå¯èƒ½æ˜¯å…¨ç´¢å¼•æ‰«æï¼Œéœ€ä¼˜åŒ–æŸ¥è¯¢æˆ–ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-29">3. ä¸€å¥è¯è®°å¿†</h3>
<p>ã€Œç´¢å¼•é€‚åˆ â€œç²¾å‡†æ‰“å‡»â€ï¼ˆå°‘é‡æ•°æ®ã€é«˜é€‰æ‹©æ€§ï¼‰ï¼Œå…¨è¡¨æ‰«æé€‚åˆ â€œåœ°æ¯¯å¼æœç´¢â€ï¼ˆå¤§é‡æ•°æ®ã€ä½é€‰æ‹©æ€§ï¼‰ã€ã€‚</p>
<h2 data-id="heading-30">é¢è¯•çœŸé¢˜æ¼”ç»ƒ</h2>
<h3 data-id="heading-31">é—®é¢˜ 1ï¼šä¸ºä»€ä¹ˆæŸ¥è¯¢ â€œæ€§åˆ« = ç”·â€ æ—¶ï¼Œä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æè€Œéèµ°ç´¢å¼•ï¼Ÿ</h3>
<p>ç­”ï¼šå› ä¸º â€œæ€§åˆ«â€ æ˜¯ä½é€‰æ‹©æ€§å­—æ®µï¼ˆé€‰æ‹©æ€§â‰ˆ2%ï¼‰ï¼ŒæŸ¥è¯¢æ•°æ®å æ¯”é«˜ï¼ˆçº¦ 50%ï¼‰ã€‚èµ°ç´¢å¼•éœ€éå†ç´¢å¼•æ ‘ + å¤§é‡å›è¡¨ï¼ˆéšæœº IOï¼‰ï¼Œè€Œå…¨è¡¨æ‰«ææ˜¯é¡ºåº IOï¼Œæˆæœ¬æ›´ä½ï¼Œå› æ­¤ä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æã€‚</p>
<h3 data-id="heading-32">é—®é¢˜ 2ï¼šå°è¡¨ï¼ˆ100 è¡Œï¼‰ä¸­ï¼Œç»™<code>name</code>å­—æ®µå»ºç´¢å¼•ï¼ŒæŸ¥è¯¢<code>SELECT * FROM è¡¨ WHERE name='å¼ ä¸‰'</code>ï¼Œä¼šèµ°ç´¢å¼•å—ï¼Ÿ</h3>
<p>ç­”ï¼šå¤§æ¦‚ç‡ä¸ä¼šã€‚å°è¡¨å…¨è¡¨æ‰«æä»…éœ€è¯»å– 1 ä¸ªæ•°æ®é¡µï¼Œå¼€é”€æä½ï¼›èµ°ç´¢å¼•éœ€éå†ç´¢å¼•æ ‘ + å›è¡¨ï¼Œé¢å¤–å¼€é”€è¶…è¿‡æ”¶ç›Šï¼Œä¼˜åŒ–å™¨ä¼šé€‰æ‹©å…¨è¡¨æ‰«æã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç»“åˆConditionå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç¤ºä¾‹ï¼Œæ¥è¿›ä¸€æ­¥åˆ†æAbstractQueuedSynchronizerçš„å†…éƒ¨å·¥ä½œæœºåˆ¶]]></title>    <link>https://juejin.cn/post/7575182522411810854</link>    <guid>https://juejin.cn/post/7575182522411810854</guid>    <pubDate>2025-11-23T14:19:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575182522411810854" data-draft-id="7575182522411794470" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç»“åˆConditionå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç¤ºä¾‹ï¼Œæ¥è¿›ä¸€æ­¥åˆ†æAbstractQueuedSynchronizerçš„å†…éƒ¨å·¥ä½œæœºåˆ¶"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T14:19:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kevinzeng"/> <meta itemprop="url" content="https://juejin.cn/user/1964143993949127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç»“åˆConditionå®ç°ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ç¤ºä¾‹ï¼Œæ¥è¿›ä¸€æ­¥åˆ†æAbstractQueuedSynchronizerçš„å†…éƒ¨å·¥ä½œæœºåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1964143993949127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kevinzeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:19:56.000Z" title="Sun Nov 23 2025 14:19:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç”Ÿäº§è€… - æ¶ˆè´¹è€…ç¤ºä¾‹ä»£ç </h2>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæœ‰ç•Œç¼“å†²åŒºï¼ˆBounded Bufferï¼‰ï¼Œç”Ÿäº§è€…çº¿ç¨‹å‘ç¼“å†²åŒºä¸­æ”¾å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä»ä¸­å–å‡ºæ•°æ®ã€‚å½“ç¼“å†²åŒºæ»¡æ—¶ï¼Œç”Ÿäº§è€…ä¼šè¢«é˜»å¡ï¼›å½“ç¼“å†²åŒºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…ä¼šè¢«é˜»å¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Queue;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.Condition;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BoundedBuffer</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;T&gt; queue;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> capacity;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock lock;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notFull;  <span class="hljs-comment">// æ¡ä»¶ï¼šç¼“å†²åŒºæœªæ»¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Condition notEmpty; <span class="hljs-comment">// æ¡ä»¶ï¼šç¼“å†²åŒºæœªç©º</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BoundedBuffer</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> {
        <span class="hljs-built_in">this</span>.capacity = capacity;
        <span class="hljs-built_in">this</span>.queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
        <span class="hljs-built_in">this</span>.notFull = lock.newCondition();
        <span class="hljs-built_in">this</span>.notEmpty = lock.newCondition();
    }

    <span class="hljs-comment">// ç”Ÿäº§è€…æ”¾å…¥æ•°æ®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(T item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock(); <span class="hljs-comment">// 1. è·å–ç‹¬å é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ£€æŸ¥æ¡ä»¶ï¼Œå¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™ç­‰å¾…</span>
            <span class="hljs-keyword">while</span> (queue.size() == capacity) {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šç¼“å†²åŒºå·²æ»¡ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹..."</span>);
                notFull.await(); <span class="hljs-comment">// 3. é‡Šæ”¾é”å¹¶é˜»å¡å½“å‰çº¿ç¨‹</span>
            }

            <span class="hljs-comment">// 4. æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œç”Ÿäº§æ“ä½œ</span>
            queue.add(item);
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šç”Ÿäº§äº† "</span> + item + <span class="hljs-string">"ï¼Œå½“å‰ç¼“å†²åŒºå¤§å°ï¼š"</span> + queue.size());

            <span class="hljs-comment">// 5. å”¤é†’ç­‰å¾…"éç©º"æ¡ä»¶çš„æ¶ˆè´¹è€…çº¿ç¨‹</span>
            notEmpty.signal();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">// 6. é‡Šæ”¾é”</span>
        }
    }

    <span class="hljs-comment">// æ¶ˆè´¹è€…å–å‡ºæ•°æ®</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">take</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock(); <span class="hljs-comment">// 1. è·å–ç‹¬å é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ£€æŸ¥æ¡ä»¶ï¼Œå¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™ç­‰å¾…</span>
            <span class="hljs-keyword">while</span> (queue.isEmpty()) {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šç¼“å†²åŒºä¸ºç©ºï¼Œç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§..."</span>);
                notEmpty.await(); <span class="hljs-comment">// 3. é‡Šæ”¾é”å¹¶é˜»å¡å½“å‰çº¿ç¨‹</span>
            }

            <span class="hljs-comment">// 4. æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œæ¶ˆè´¹æ“ä½œ</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> queue.poll();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"ï¼šæ¶ˆè´¹äº† "</span> + item + <span class="hljs-string">"ï¼Œå½“å‰ç¼“å†²åŒºå¤§å°ï¼š"</span> + queue.size());

            <span class="hljs-comment">// 5. å”¤é†’ç­‰å¾…"éæ»¡"æ¡ä»¶çš„ç”Ÿäº§è€…çº¿ç¨‹</span>
            notFull.signal();

            <span class="hljs-keyword">return</span> item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">// 6. é‡Šæ”¾é”</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        BoundedBuffer&lt;Integer&gt; buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BoundedBuffer</span>&lt;&gt;(<span class="hljs-number">5</span>);

        <span class="hljs-comment">// å¯åŠ¨3ä¸ªç”Ÿäº§è€…çº¿ç¨‹</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">producerId</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; j++) {
                        <span class="hljs-type">int</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> producerId * <span class="hljs-number">100</span> + j;
                        buffer.put(item);
                        Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿç”Ÿäº§è€—æ—¶</span>
                    }
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }, <span class="hljs-string">"ç”Ÿäº§è€…-"</span> + i).start();
        }

        <span class="hljs-comment">// å¯åŠ¨2ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">consumerId</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">7</span>; j++) {
                        buffer.take();
                        Thread.sleep(<span class="hljs-number">150</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span>
                    }
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }, <span class="hljs-string">"æ¶ˆè´¹è€…-"</span> + i).start();
        }
    }
}
</code></pre>
<h4 data-id="heading-1">AQS å†…éƒ¨å·¥ä½œæœºåˆ¶åˆ†æ</h4>
<p><code>ReentrantLock</code>Â å’ŒÂ <code>Condition</code>Â éƒ½æ˜¯åŸºäº AQS å®ç°çš„ã€‚æˆ‘ä»¬æ¥åˆ†æ­¥è§£æä¸Šè¿°ä»£ç ä¸­ AQS çš„å·¥ä½œæµç¨‹ã€‚</p>
<h5 data-id="heading-2">1.Â <code>lock.lock()</code>Â - è·å–ç‹¬å é”</h5>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Â <code>lock.lock()</code>Â æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨ AQS çš„Â <code>acquire(1)</code>Â æ–¹æ³•ã€‚</p>
<ul>
<li>
<p><strong>AQS çŠ¶æ€ (<code>state</code>)</strong> :</p>
<ul>
<li>
<p><code>state</code>Â åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºé”æœªè¢«æŒæœ‰ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨Â <code>tryAcquire(1)</code>ï¼ˆç”±Â <code>ReentrantLock</code>Â å®ç°ï¼‰ï¼š</p>
<ul>
<li>å®ƒä¼šæ£€æŸ¥Â <code>state</code>Â æ˜¯å¦ä¸º 0ã€‚</li>
<li>å¦‚æœæ˜¯ï¼Œå®ƒä¼šä½¿ç”¨ CAS (Compare-and-Swap) æ“ä½œå°†Â <code>state</code>Â ä» 0 ä¿®æ”¹ä¸º 1ã€‚</li>
<li>å¦‚æœ CAS æˆåŠŸï¼Œå®ƒä¼šå°†Â <code>exclusiveOwnerThread</code>ï¼ˆAQS çš„ä¸€ä¸ªå±æ€§ï¼‰è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ï¼Œè¡¨ç¤ºå½“å‰çº¿ç¨‹å·²è·å–é”ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å¦‚æœè·å–æˆåŠŸ</strong>ï¼šçº¿ç¨‹ç»§ç»­æ‰§è¡ŒÂ <code>put</code>Â æˆ–Â <code>take</code>Â æ–¹æ³•çš„åç»­é€»è¾‘ã€‚</p>
</li>
<li>
<p><strong>å¦‚æœè·å–å¤±è´¥</strong>ï¼ˆå³Â <code>state</code>Â ä¸ä¸º 0ï¼Œä¸”æŒæœ‰é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼‰ï¼š</p>
<ul>
<li>AQS ä¼šåˆ›å»ºä¸€ä¸ª<strong>ç‹¬å æ¨¡å¼</strong>çš„Â <code>Node</code>Â å¯¹è±¡ï¼Œå°†å½“å‰çº¿ç¨‹å°è£…è¿›å»ã€‚</li>
<li>è¿™ä¸ªÂ <code>Node</code>Â ä¼šè¢«åŠ å…¥åˆ° AQS å†…éƒ¨ç»´æŠ¤çš„ä¸€ä¸ª<strong>FIFO é˜»å¡é˜Ÿåˆ—</strong>ï¼ˆCLH é˜Ÿåˆ—ï¼‰çš„å°¾éƒ¨ã€‚</li>
<li>ç„¶åï¼Œå½“å‰çº¿ç¨‹ä¼šè°ƒç”¨Â <code>LockSupport.park()</code>Â æ–¹æ³•å°†è‡ªå·±é˜»å¡ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-3">2.Â <code>condition.await()</code>Â - ç­‰å¾…æ¡ä»¶</h5>
<p>å½“çº¿ç¨‹è·å–é”åï¼Œè¿›å…¥Â <code>put</code>Â æˆ–Â <code>take</code>Â æ–¹æ³•ï¼Œå‘ç°æ¡ä»¶ä¸æ»¡è¶³ï¼ˆå¦‚ç¼“å†²åŒºæ»¡æˆ–ç©ºï¼‰ï¼Œå®ƒä¼šè°ƒç”¨Â <code>condition.await()</code>ã€‚</p>
<ul>
<li>
<p><strong>åˆ›å»ºæ¡ä»¶é˜Ÿåˆ—èŠ‚ç‚¹</strong>:</p>
<ul>
<li><code>Condition</code>Â å¯¹è±¡å†…éƒ¨ä¹Ÿç»´æŠ¤ç€ä¸€ä¸ª<strong>æ¡ä»¶é˜Ÿåˆ—</strong>ã€‚è¿™ä¸ªé˜Ÿåˆ—å’Œ AQS çš„ä¸»é˜»å¡é˜Ÿåˆ—æ˜¯åˆ†å¼€çš„ã€‚</li>
<li><code>await()</code>Â æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Â <code>Node</code>ï¼ˆå…¶Â <code>waitStatus</code>Â ä¸ºÂ <code>Node.CONDITION</code>ï¼‰ï¼Œå¹¶å°†å½“å‰çº¿ç¨‹æ”¾å…¥è¿™ä¸ªæ¡ä»¶é˜Ÿåˆ—ä¸­ã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡Šæ”¾é”</strong>:</p>
<ul>
<li>è¿™æ˜¯å…³é”®ä¸€æ­¥ã€‚<code>await()</code>Â ä¼šè°ƒç”¨ AQS çš„Â <code>release(1)</code>Â æ–¹æ³•ï¼Œ<strong>é‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„é”</strong>ã€‚</li>
<li><code>release</code>Â æ–¹æ³•ä¼šè°ƒç”¨Â <code>tryRelease(1)</code>ï¼ˆç”±Â <code>ReentrantLock</code>Â å®ç°ï¼‰ï¼Œå°†Â <code>state</code>Â ä» 1 å‡å› 0ï¼Œå¹¶æ¸…ç©ºÂ <code>exclusiveOwnerThread</code>ã€‚</li>
<li>ç„¶åï¼Œå®ƒä¼šæ£€æŸ¥ AQS ä¸»é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ä¸ºç©ºï¼Œå®ƒä¼šå”¤é†’é˜Ÿåˆ—å¤´éƒ¨çš„çº¿ç¨‹ï¼Œè®©å®ƒæœ‰æœºä¼šå»ç«äº‰é”ã€‚</li>
</ul>
</li>
<li>
<p><strong>é˜»å¡çº¿ç¨‹</strong>:</p>
<ul>
<li>åœ¨é‡Šæ”¾é”ä¹‹åï¼Œè°ƒç”¨Â <code>await()</code>Â çš„çº¿ç¨‹ä¼šå†æ¬¡è°ƒç”¨Â <code>LockSupport.park()</code>Â å°†è‡ªå·±é˜»å¡ã€‚æ­¤æ—¶ï¼Œå®ƒç­‰å¾…çš„ä¸å†æ˜¯é”ï¼Œè€Œæ˜¯ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„å”¤é†’ä¿¡å·ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-4">3.Â <code>condition.signal()</code>Â - å”¤é†’ç­‰å¾…æ¡ä»¶çš„çº¿ç¨‹</h5>
<p>å½“å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæ¯”å¦‚æ¶ˆè´¹è€…ï¼‰æ‰§è¡Œäº†Â <code>notFull.signal()</code>Â æˆ–Â <code>notEmpty.signal()</code>Â æ—¶ï¼š</p>
<ul>
<li>
<p><strong>ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°ä¸»é˜Ÿåˆ—</strong>:</p>
<ul>
<li><code>signal()</code>Â æ–¹æ³•ä¼šä»å®ƒçš„æ¡ä»¶é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªç­‰å¾…æœ€ä¹…çš„Â <code>Node</code>ï¼ˆé€šå¸¸æ˜¯å¤´éƒ¨èŠ‚ç‚¹ï¼‰ã€‚</li>
<li>å®ƒä¼šå°†è¿™ä¸ªÂ <code>Node</code>Â çš„çŠ¶æ€ä»Â <code>Node.CONDITION</code>Â æ”¹å˜ä¸ºÂ <code>Node.SIGNAL</code>ã€‚</li>
<li>ç„¶åï¼Œè¿™ä¸ªÂ <code>Node</code>Â ä¼šè¢«<strong>è½¬ç§»</strong>åˆ° AQS çš„<strong>ä¸»é˜»å¡é˜Ÿåˆ—</strong>çš„å°¾éƒ¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç­‰å¾…å†æ¬¡ç«äº‰é”</strong>:</p>
<ul>
<li>è¢«è½¬ç§»çš„çº¿ç¨‹æ­¤æ—¶ä»ç„¶æ˜¯é˜»å¡çŠ¶æ€ã€‚å®ƒéœ€è¦ç­‰å¾…ä¸»é˜Ÿåˆ—ä¸­æ’åœ¨å®ƒå‰é¢çš„çº¿ç¨‹éƒ½å¤„ç†å®Œï¼Œå¹¶ä¸”å½“å®ƒè‡ªå·±æˆä¸ºé˜Ÿåˆ—å¤´éƒ¨æ—¶ï¼Œæ‰æœ‰æœºä¼šè¢«å”¤é†’ï¼Œé‡æ–°å»ç«äº‰é”ã€‚</li>
</ul>
</li>
</ul>
<h5 data-id="heading-5">4.Â <code>lock.unlock()</code>Â - é‡Šæ”¾é”</h5>
<p>å½“çº¿ç¨‹å®ŒæˆÂ <code>put</code>Â æˆ–Â <code>take</code>Â æ“ä½œåï¼Œä¼šåœ¨Â <code>finally</code>Â å—ä¸­è°ƒç”¨Â <code>lock.unlock()</code>ã€‚</p>
<ul>
<li>è¿™åŒæ ·ä¼šè°ƒç”¨ AQS çš„Â <code>release(1)</code>Â æ–¹æ³•ã€‚</li>
<li><code>tryRelease(1)</code>Â ä¼šå‡å°‘Â <code>state</code>ã€‚å¯¹äºéé‡å…¥é”ï¼Œ<code>state</code>Â å˜ä¸º 0ã€‚</li>
<li>AQS ä¼šæ£€æŸ¥ä¸»é˜»å¡é˜Ÿåˆ—ã€‚å¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå®ƒä¼šå”¤é†’é˜Ÿåˆ—å¤´éƒ¨çš„çº¿ç¨‹ï¼Œè®©å®ƒå°è¯•è·å–é”ã€‚</li>
</ul>
<h4 data-id="heading-6">æ€»ç»“ï¼šAQS çš„æ ¸å¿ƒè§’è‰²</h4>
<p>åœ¨è¿™ä¸ªç”Ÿäº§è€… - æ¶ˆè´¹è€…ç¤ºä¾‹ä¸­ï¼ŒAQS æ‰®æ¼”äº†ä»¥ä¸‹å‡ ä¸ªå…³é”®è§’è‰²ï¼š</p>
<ol>
<li><strong>åŒæ­¥çŠ¶æ€ç®¡ç†å™¨ (<code>state</code>)</strong> : é€šè¿‡ä¸€ä¸ªç®€å•çš„æ•´æ•°Â <code>state</code>Â å’Œ CAS æ“ä½œï¼Œé«˜æ•ˆåœ°ç®¡ç†é”çš„è·å–ä¸é‡Šæ”¾ã€‚</li>
<li><strong>ç‹¬å é”æŒæœ‰è€…è®°å½•å™¨ (<code>exclusiveOwnerThread</code>)</strong> : è®°å½•å½“å‰æŒæœ‰ç‹¬å é”çš„çº¿ç¨‹ï¼Œç”¨äºå®ç°é‡å…¥å’Œé”é‡Šæ”¾çš„æ­£ç¡®æ€§ã€‚</li>
<li><strong>çº¿ç¨‹é˜»å¡é˜Ÿåˆ— (CLH Queue)</strong> : å½“çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼ŒAQS å°†å…¶å°è£…æˆÂ <code>Node</code>Â æ”¾å…¥æ­¤é˜Ÿåˆ—ï¼Œå¹¶é˜»å¡çº¿ç¨‹ã€‚è¿™æ˜¯çº¿ç¨‹çš„ â€œå€™å®¢å…â€ã€‚</li>
<li><strong>æ¡ä»¶å˜é‡æ”¯æŒ</strong>:Â <code>Condition</code>Â å¯¹è±¡åˆ©ç”¨ AQS çš„åŸºç¡€åŠŸèƒ½ï¼Œå®ç°äº†ç‹¬ç«‹çš„æ¡ä»¶ç­‰å¾…é˜Ÿåˆ—ã€‚å®ƒå…è®¸çº¿ç¨‹åœ¨æŸä¸ªæ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæš‚æ—¶æ”¾å¼ƒé”å¹¶ç­‰å¾…ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹</strong>æ˜¯æƒ³è¦è¿›å…¥æˆ¿é—´ï¼ˆä¸´ç•ŒåŒºï¼‰çš„äººã€‚</li>
<li><strong>AQS çš„Â <code>state</code></strong>Â æ˜¯æˆ¿é—´çš„é’¥åŒ™ã€‚</li>
<li><strong>AQS ä¸»é˜Ÿåˆ—</strong>æ˜¯æˆ¿é—´å¤–çš„ç­‰å€™é˜Ÿä¼ã€‚</li>
<li><strong><code>Condition</code>Â çš„æ¡ä»¶é˜Ÿåˆ—</strong>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¼‘æ¯å®¤ï¼Œå½“æˆ¿é—´é‡Œçš„äººå‘ç° â€œå’–å•¡è¿˜æ²¡ç…®å¥½â€ï¼ˆæ¡ä»¶ä¸æ»¡è¶³ï¼‰ï¼Œä»–ä¼šæš‚æ—¶æŠŠé’¥åŒ™è¿˜ç»™å‰å°ï¼ˆé‡Šæ”¾é”ï¼‰ï¼Œç„¶åå»ä¼‘æ¯å®¤ç­‰å¾…ï¼Œç›´åˆ°æœ‰äººé€šçŸ¥ä»– â€œå’–å•¡ç…®å¥½äº†â€ï¼ˆ<code>signal</code>ï¼‰ï¼Œä»–æ‰ä¼šå›åˆ°ç­‰å€™é˜Ÿä¼çš„æœ«å°¾ï¼Œé‡æ–°æ’é˜Ÿç­‰å¾…è¿›å…¥æˆ¿é—´ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å·Javaç³»åˆ—ä¹‹ä¸€ä¸ªæ¥å£çš„è¯ç”Ÿ]]></title>    <link>https://juejin.cn/post/7575412016404430858</link>    <guid>https://juejin.cn/post/7575412016404430858</guid>    <pubDate>2025-11-23T14:26:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575412016404430858" data-draft-id="7575456858427129902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å·Javaç³»åˆ—ä¹‹ä¸€ä¸ªæ¥å£çš„è¯ç”Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-23T14:26:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ´ç€çœ¼é•œçš„å¹³å¤´å“¥"/> <meta itemprop="url" content="https://juejin.cn/user/2471357868159544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å·Javaç³»åˆ—ä¹‹ä¸€ä¸ªæ¥å£çš„è¯ç”Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2471357868159544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ´ç€çœ¼é•œçš„å¹³å¤´å“¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:26:24.000Z" title="Sun Nov 23 2025 14:26:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ol>
<li>
<h2 data-id="heading-0">æ‘˜è¦</h2>
</li>
</ol>
<p>æœ¬æ–‡ä»¥è‹¥ä¾æ¡†æ¶ä¸ºä¾‹ï¼Œé˜è¿°ä½¿ç”¨Javaåç«¯çš„ä¸€ç³»åˆ—æŠ€æœ¯å®ç°ä¸€ä¸ªåç«¯æ¥å£ï¼Œä¸ºä»€ä¹ˆè¦åŸºäºè‹¥ä¾æ¡†æ¶ï¼Œå› ä¸ºè¿˜æ˜¯æƒ³ä»çœŸå®å·¥ç¨‹çš„è§’åº¦æè¿°Javaåç«¯å®ç°æ¥å£çš„æµç¨‹ï¼Œå¦‚æœä»…ä»…æ˜¯å®ç°ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯ä»¥ç”¨å¾ˆå¤šæŠ€æœ¯å®ç°ï¼Œæ¯”å¦‚ç”¨åŸç”ŸNodeçš„Httpæ¨¡å—æˆ–è€…ä½¿ç”¨Expressã€Koaç­‰å‰ç«¯æ¡†æ¶ã€‚è™½ç„¶ç½‘ä¸Šå¯¹è‹¥ä¾æ¡†æ¶è¤’è´¬ä¸ä¸€æ ·ï¼Œä½†æ˜¯å­¦ä¸œè¥¿è¿˜æ˜¯è¦ç”¨äººä¹‹é•¿çš„çœ¼å…‰å»çœ‹å¾…ã€‚æ ‡é¢˜åç§°è™½ç„¶æ˜¯å‰ç«¯å·Javaï¼Œå¹¶ä¸ä»£è¡¨æ˜¯Javaå°ç™½ç³»åˆ—æ–‡ç« ï¼Œå› ä¸ºç¬”è€…å·¥ä½œåå‘å‰ç«¯ï¼Œæ‰€ä»¥æ ‡é¢˜æ˜¯å‰ç«¯å·Javaï¼Œä¸è¿‡è¿˜æ˜¯éœ€è¦ä¸€äº›JavaåŸºç¡€çš„ï¼Œå¦å¤–è¿™æ˜¯ä¸€ç¯‡JavaæŠ€æœ¯æ™®åŠçš„æ–‡ç« ï¼Œæ­ç¤ºçœŸå®å·¥ç¨‹ä¸­å®ç°ä¸€ä¸ªæ¥å£åˆ°åº•ç”¨åˆ°äº†å“ªäº›JavaæŠ€æœ¯ï¼Œå¯¹äºæŸä¸ªæŠ€æœ¯çš„æ·±å…¥ç ”ç©¶ï¼Œç¬”è€…åç»­ä¼šæ…¢æ…¢æ‹†è§£ã€‚</p>
<ol start="2">
<li>
<h2 data-id="heading-1">ç›®æ ‡èšç„¦</h2>
</li>
</ol>
<p>å®ç°ä¸€ä¸ªæ ¹æ®IdæŸ¥è¯¢ä¸€æ¡é—®å€™è¯­çš„æ¥å£ï¼Œç†Ÿæ‚‰æ¥å£å¼€å‘æµç¨‹å’Œä½¿ç”¨çš„æ¡†æ¶ï¼Œæ¥å£å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33615c8b6d7e4dc298ebb4251033f202~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oi0552A55y86ZWc55qE5bmz5aS05ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514090&amp;x-signature=xDyC4iu4UfbBk6Px5l5eE3o5l5g%3D" alt="560928daa2f6d92e7d32fe898fbfbc86.png" loading="lazy"/></p>
<p>è¿™æ˜¯ä¸€ä¸ªGETæ¥å£ï¼Œé€šè¿‡åœ¨urlä¸Šæ‹¼æ¥æŸ¥è¯¢å‚æ•°idå‘åç«¯ä¼ é€’å‚æ•°ï¼Œä»¥ä¾¿æŸ¥è¯¢è¿™æ¡idå¯¹åº”çš„é—®å€™è¯­ï¼Œæ²¡é”™å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæˆ‘ä»¬çš„é‡ç‚¹æ˜¯ç†Ÿæ‚‰åŸºæœ¬çš„å¼€å‘æµç¨‹å’Œä½¿ç”¨çš„æ¡†æ¶ï¼Œå› æ­¤ä¾‹å­è¶Šç®€å•è¶Šå¥½ã€‚</p>
<ol start="3">
<li>
<h2 data-id="heading-2">å…·ä½“å®ç°</h2>
</li>
</ol>
<p>å…ˆçœ‹ä¸‹è¿™ä¸ªæ¥å£åœ¨ä»£ç ä¸­çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/system/greeting")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingController</span> {
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> GreetingService greetingService;
    <span class="hljs-meta">@GetMapping("/getGreetingById")</span>
    <span class="hljs-keyword">public</span> CommonResult&lt;GreetingDO&gt; <span class="hljs-title function_">getGreetingById</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam("id")</span> Long id)</span> {
        <span class="hljs-type">GreetingDO</span> <span class="hljs-variable">greeting</span> <span class="hljs-operator">=</span> greetingService.getGreetingById(id);
        <span class="hljs-keyword">return</span> success(greeting);
    }}
</code></pre>
<p>è¿™é‡Œç‰µæ‰¯åˆ°å¾ˆå¤šæ³¨è§£(@å¼€å¤´çš„)ï¼Œæˆ‘ä»¬å…ˆä¸çœ‹ï¼Œæœ€æ ¸å¿ƒçš„ä»£ç æ˜¯ç¬¬11å¥ï¼Œè°ƒç”¨äº†greetingServiceçš„getGreetingByIdæ–¹æ³•æŸ¥è¯¢å¾—åˆ°äº†ä¸€æ¡é—®å€™è¯­ã€‚greetingServiceæ˜¯ä¸€ä¸ªGreetingServiceçš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰newå‘¢ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºSpringæ¡†æ¶å¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªï¼Œå¾—ç›Šäº@Resourceè¿™ä¸ªæ³¨è§£ï¼ŒSpringæœ‰ä¸ªé­”æ³•å«ä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä½ éœ€è¦ä»€ä¹ˆæ ·çš„å¯¹è±¡ï¼Œä½ ä¸ç”¨è‡ªå·±åˆ›å»ºï¼Œä½ å°±å‘Šè¯‰Springï¼ŒSpringå¸®ä½ åˆ›å»ºã€‚ä¸è¿‡è¿™æœ‰ä¸ªå‰æï¼Œå°±æ˜¯ä½ è¦å‘Šè¯‰Springè¿™ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä¹Ÿå°±æ˜¯GreetingServiceã€‚</p>
<p>GreetingServiceå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GreetingService</span> {
    GreetingDO  <span class="hljs-title function_">getGreetingById</span><span class="hljs-params">(Long id)</span>;
}
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç±»ä¼¼TypeScriptä¸­çš„æ¥å£ä¸€æ ·ï¼Œå®šä¹‰äº†è¿™ä¸ªå¯¹è±¡çš„å½¢çŠ¶ï¼Œä½†è¿™ä¸ªä»…ä»…æ˜¯å¯¹è±¡çš„å½¢çŠ¶ï¼Œå°±åƒæ˜¯ä¸€ä¸ªæ±½è½¦çš„ç»“æ„å›¾ä¸€æ ·ï¼Œç¼ºå°‘å…·ä½“çš„å®ç°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…·ä½“çš„æ¨¡å­ï¼Œè®©Springç”¨è¿™ä¸ªæ¨¡å­ï¼Œé€ ä¸€ä¸ªæ±½è½¦å‡ºæ¥ï¼Œè¿™ä¸ªå…·ä½“çš„æ¨¡å­æ˜¯GreetingServiceImplï¼Œå®ƒå®ç°äº†GreetingServiceè¿™ä¸ªæ¥å£ã€‚</p>
<p>GreetingServiceImplå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreetingServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GreetingService</span>{
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> GreetingMapper greetingMapper;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> GreetingDO <span class="hljs-title function_">getGreetingById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> greetingMapper.selectById(id);
    }
}
</code></pre>
<p>GreetingServiceImplè¿™ä¸ªç±»ä¸­æœ€å…³é”®çš„æ˜¯ç¬¬5å¥ä½¿ç”¨äº†greetingMapperè°ƒç”¨äº†selectByIdæ–¹æ³•æŸ¥è¯¢é—®å€™è¯­ï¼Œé‚£greetingMapperæ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Œæ²¡é”™ï¼Œé€šè¿‡ç¬¬4å¥çš„å£°æ˜ï¼ŒSpringå¸®æˆ‘ä»¬åˆ›å»ºé€ å‡ºæ¥çš„ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªGreetingMapperçš„æ¨¡å­å‘Šè¯‰Springç…§ç€è¿™ä¸ªæ¨¡å­é€ ä¸€ä¸ªgreetingMapperå®ä¾‹(å¯¹è±¡)å‡ºæ¥ã€‚</p>
<p>GreetingMapperå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GreetingMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapperX</span>&lt;GreetingDO&gt; {
}
</code></pre>
<p>æ‡µäº†ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰selectByIdè¿™ä¸ªæ–¹æ³•ï¼Œèªæ˜çš„ä½ è‚¯å®šå‘ç°äº†extends(ç»§æ‰¿)ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä»BaseMapperXç»§æ‰¿è¿‡æ¥ï¼ŒBaseMapperXæ˜¯è‹¥ä¾æ¡†æ¶å°è£…çš„ï¼Œå®ƒåœ¨MybatisPlusçš„BaseMapperåˆæ·»åŠ äº†ä¸€äº›æ–¹æ³•ã€‚MyBatis-Plusæ˜¯MyBatisçš„å¢å¼ºç‰ˆï¼ŒMyBatisæ˜¯ä¸€ä¸ªJavaæŒä¹…å±‚æ¡†æ¶ï¼Œæ„æ€å°±æ˜¯å®ƒå¸®ä½ æŠŠå†…å­˜ä¸­å¤„ç†æ“ä½œçš„å¯¹è±¡æ”¾åˆ°æ•°æ®åº“ä¸­ä¿å­˜èµ·æ¥æˆ–è€…ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°ä½ éœ€è¦çš„æ•°æ®æ”¾åˆ°å†…å­˜ä¸­æ¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­ä¿å­˜çš„é—®å€™è¯­æ•°æ®ã€‚è‡³æ­¤ï¼Œè¿™ä¸ªæ–¹æ³•åŸºæœ¬ç»“æŸã€‚</p>
<ol start="4">
<li>
<h2 data-id="heading-3">æ•´ä½“æµç¨‹</h2>
</li>
</ol>
<p>æˆ‘æŠŠæ­¥éª¤3çš„æµç¨‹ç»˜åˆ¶æˆäº†å¦‚ä¸‹çš„UMLäº¤äº’å›¾ï¼Œä»¥ä¾¿æ›´æ¸…æ™°çš„æè¿°æ•´ä¸ªæ¥å£å®ç°çš„æµç¨‹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78bb376e78d14b64a34d1978a716633e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oi0552A55y86ZWc55qE5bmz5aS05ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514090&amp;x-signature=VFq9LpN4cqUteXS%2FyFtlHQjMVbA%3D" alt="" loading="lazy"/></p>
<p>ä»è¿™ä¸ªå›¾å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¸‰å±‚æ¶æ„ï¼Œåˆ†ä¸ºControllerå±‚ã€Serviceå±‚ã€DALå±‚</p>
<p>Controllerå±‚(æ§åˆ¶å±‚)ï¼šæ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè°ƒç”¨Serviceå±‚çš„æ–¹æ³•çš„å¾—åˆ°ç»“æœï¼Œå°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>Serviceå±‚(ä¸šåŠ¡é€»è¾‘å±‚)ï¼šæ¥å—æ§åˆ¶å±‚çš„ä¼ å‚ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨DALå±‚çš„æ–¹æ³•ï¼Œå°†ç»“æœè¿”å›ç»™Controllerå±‚ã€‚</p>
<p>DALå±‚(æ•°æ®è®¿é—®å±‚æˆ–å«Mapper)ï¼šæ¥å—Serviceå±‚çš„ä¼ å‚ï¼Œè°ƒç”¨JDBCå®Œæˆæ•°æ®åº“çš„æ•°æ®æ“ä½œï¼Œå°†ç»“æœè¿”å›ç»™Serviceå±‚ã€‚</p>
<p>ä¸Šå›¾ä¸­è¿˜æœ‰ä¸€äº›æ¨¡å—æ²¡æœ‰ä»‹ç»</p>
<p>GreetingSaveReqVOï¼šé—®å€™è¯­è¯·æ±‚å®ä½“å¯¹è±¡ï¼Œç”¨äºæ¥å—å®¢æˆ·ç«¯ä¼ é€’è¿‡æ¥çš„é—®å€™è¯­å®ä½“ï¼Œå°±æ˜¯ä¸€ä¸ªJavaç±»ã€‚</p>
<p>GreetingDO: é—®å€™è¯­æ•°æ®å¯¹è±¡ï¼Œæ˜¯å’Œæ•°æ®åº“è¡¨ä¸­çš„å­—æ®µä¸€ä¸€å¯¹è±¡çš„JavaåŸç”Ÿå¯¹è±¡ï¼Œæœ‰äº›è§„èŒƒä¸­å«POï¼Œä¹Ÿæ˜¯ä¸€ä¸ªJavaç±»ã€‚</p>
<p>BaseDOï¼šè‹¥ä¾æ¡†æ¶å°è£…çš„ä¸€ä¸ªDOï¼ŒåŒ…å«äº†ä¸€ä¸ªå…¬ç”¨çš„å­—æ®µæ¯”å¦‚createTimeåˆ›å»ºæ—¶é—´ã€updateTimeæ›´æ–°æ—¶é—´ã€creatoråˆ›å»ºäººã€updateræ›´æ–°äººã€deletedé€»è¾‘åˆ é™¤å­—æ®µã€‚</p>
<p>å…³äºè¿™äº›Oçš„æ¦‚å¿µï¼Œæˆ‘æ€»ç»“äº†ä¸€ä¸‹ï¼š</p>





























































<table><thead><tr><th>å…¨ç§°</th><th>ç®€ç§°</th><th>ä¸­æ–‡</th><th>ç”¨é€”</th><th>æ˜¯å¦æš´æ¼ç»™å‰ç«¯</th><th>æ˜¯å¦æ˜ å°„æ•°æ®åº“</th></tr></thead><tbody><tr><td>Plain Old Java Object</td><td>POJO</td><td>ç®€å•Javaå¯¹è±¡</td><td>æ— ç‰¹æ®Šé™åˆ¶çš„æ™®é€šJavaç±»</td><td>å¦</td><td>å¦</td></tr><tr><td>Persistent Object</td><td>PO</td><td>æŒä¹…åŒ–å¯¹è±¡</td><td>ä¸æ•°æ®åº“è¡¨ä¸€ä¸€å¯¹è±¡ï¼Œé€šå¸¸ä¸ORMæ˜ å°„</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>View Object</td><td>VO</td><td>è§†å›¾å¯¹è±¡</td><td>å±•ç¤ºå±‚æ•°æ®ï¼Œç”¨äºå‘å‰ç«¯è¿”å›æ•°æ®</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>Business Object</td><td>BO</td><td>ä¸šåŠ¡å¯¹è±¡</td><td>å°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡</td><td>å¦</td><td>å¦</td></tr><tr><td>Data Transfer Object</td><td>DTO</td><td>æ•°æ®ä¼ è¾“å¯¹è±¡</td><td>ç”¨äºä¸åŒå±‚æˆ–æœåŠ¡ä¹‹é—´ä¼ é€’æ•°æ®</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>Data Access Object</td><td>DAO</td><td>æ•°æ®è®¿é—®å¯¹è±¡</td><td>ä¸æ•°æ®åº“äº¤äº’çš„æ¥å£æˆ–ç±»ï¼Œè´Ÿè´£æŒä¹…åŒ–æ“ä½œ</td><td>å¦</td><td>æ˜¯</td></tr></tbody></table>
<p>POJOï¼šæ³›æŒ‡Javaä¸­çš„å¯¹è±¡ï¼Œå…¶ä»–å¯¹è±¡å¦‚POã€BOã€DTOç­‰éƒ½å¯ä»¥æ˜¯POJO</p>
<p>POï¼šä¸æ•°æ®åº“è¡¨ä¸€ä¸€æ˜ å°„ï¼Œé€šå¸¸ä½¿ç”¨JPAæ³¨è§£æˆ–MyBatisæ³¨è§£</p>
<p>DO: æ•°æ®å¯¹è±¡ï¼Œä¸šåŠ¡å¯¹è±¡ï¼Œé¢†åŸŸæ¨¡å‹ï¼Œç”¨äºä¸šåŠ¡å¤„ç†ï¼Œæœ‰äº›é¡¹ç›®ä¼šå½“POä½¿ç”¨ã€‚</p>
<p>VO: ç”¨äºè¿”å›ç»™å‰ç«¯å±•ç¤ºçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå¯¹è±¡çš„ç»„åˆæ•°æ®</p>
<p>BO: å°è£…ä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡ï¼Œé€šå¸¸ç”¨äºServiceå±‚å†…éƒ¨å¤„ç†</p>
<p>DTOï¼šç”¨äºæ¥å£å‚æ•°ä¼ é€’å’Œè·¨å±‚æ•°æ®ä¼ è¾“ï¼Œå¦‚Controlleræ¥å—å‰ç«¯ä¼ é€’è¿‡æ¥å¯¹è±¡ï¼Œæˆ–è€…å¾®æœåŠ¡ä¹‹é—´è°ƒç”¨ä¼ å‚</p>
<p>DAOï¼šç”¨äºæ“ä½œæ•°æ®åº“çš„æ¥å£æˆ–ç±»ã€‚</p>
<p>ä¸ºäº†æ›´æ¸…æ¥šåœ°å±•ç°æ•´ä½“æµç¨‹ï¼Œæ–¹ä¾¿ç†è§£ï¼Œæˆ‘ç»˜åˆ¶äº†æ—¶åºå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd727ecb1e1d44eeafcf00074969bde3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oi0552A55y86ZWc55qE5bmz5aS05ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764514090&amp;x-signature=vkbuNHOnpiZklthF%2FD%2BPQYmaCNU%3D" alt="" loading="lazy"/></p>
<p>ä¸Šé¢è¿™ä¸ªå›¾åº”è¯¥æ¸…æ™°åœ°å±•ç°äº†getGreetingByIdæ¥å£ç‰µæ‰¯åˆ°çš„å„ä¸ªæ¨¡å—(ç±»)ä¹‹é—´çš„è°ƒç”¨æµç¨‹ã€‚</p>
<blockquote>
<p>äººç”Ÿæ˜¯ä¸€ä¸ªæ¼«é•¿è€Œè‰°è¾›çš„æ¥åŠ›èµ›ï¼Œæœ‰æ—¶é¢†å…ˆï¼Œæœ‰æ—¶è½åï¼Œä½†æ˜¯ä½ åªè¦åœ¨è·¯ä¸Šï¼Œå°±æœ‰æœºä¼šï¼ŒåŠæ—¶è¡Œä¹ï¼Œå°±åƒæ˜¯ä¸€æ”¯å…´å¥‹å‰‚ï¼Œå®ƒèƒ½å¤Ÿç‚¹ç‡ƒå¹¸ç¦çš„åå½©ï¼Œä¹Ÿèƒ½åŠ é€Ÿç”Ÿå‘½çš„è¡°è´¥ï¼Œæ‰€ä»¥äººè¿˜æ˜¯è¦é€‚å½“çš„æœ‰ä¸€äº›èŠ‚åˆ¶ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€]]></title>    <link>https://juejin.cn/post/7575468252656222249</link>    <guid>https://juejin.cn/post/7575468252656222249</guid>    <pubDate>2025-11-23T14:31:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575468252656222249" data-draft-id="7575425466905362495" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„,Java"/> <meta itemprop="datePublished" content="2025-11-23T14:31:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘å«é»‘å¤§å¸…"/> <meta itemprop="url" content="https://juejin.cn/user/1678295463898875"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1678295463898875/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘å«é»‘å¤§å¸…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T14:31:58.000Z" title="Sun Nov 23 2025 14:31:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å…­è¾¹å½¢æ¶æ„ï¼Ÿå°ç™½ä¹Ÿèƒ½ç§’æ‡‚çš„ã€ŒæŠ—é€ ä»£ç ç§˜è¯€ã€</h2>
<h4 data-id="heading-1">ğŸ˜© å¼€ç¯‡æš´å‡»ï¼šä¸ºå•¥æ”¹ä¸€è¡Œä»£ç ï¼Œå´©äº†ä¸‰ä¸ªæœåŠ¡ï¼Ÿ</h4>
<p>åšå¼€å‘æœ€å´©æºƒçš„æ—¶åˆ»ï¼šäº§å“è¯´ â€œåŠ ä¸ªå°ç¨‹åºç«¯â€ï¼Œä½ æ”¹å®Œå‰ç«¯æ”¹åç«¯ï¼Œæ”¹å®Œåç«¯æ”¹æ•°æ®åº“ï¼Œæœ€åå‘ç°è®¢å•é€»è¾‘å´©äº†ï¼›æµ‹è¯•è¯´ â€œæ¢ä¸ªç¼“å­˜ä¸­é—´ä»¶â€ï¼Œä½ æ‰’ç€ä»£ç æ”¹äº†ä¸‰å¤©ï¼Œè¿˜æŠŠç”¨æˆ·æ•°æ®æä¸¢äº†â€¦ è¿™å°±æ˜¯ä¼ ç»Ÿä»£ç  â€œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«â€ çš„å‘ï¼ä»Šå¤©è¦è®²çš„ã€Œå…­è¾¹å½¢æ¶æ„ã€ï¼Œå°±æ˜¯ä¸“æ²»è¿™ç§ â€œä»£ç éª¨è´¨ç–æ¾â€ çš„ç¥è¯âœ¨ åˆ«è¢«åå­—å“åˆ°ï¼Œå®ƒæœ¬è´¨æ˜¯ä¸ª â€œè®©ä¸šåŠ¡å½“è€å¤§ï¼ŒæŠ€æœ¯å½“å°å¼Ÿâ€ çš„è®¾è®¡æ€è·¯ã€‚</p>
<h4 data-id="heading-2">ğŸ”· ä¸ºå•¥å« â€œå…­è¾¹å½¢â€ï¼Ÿä¸æ˜¯å› ä¸ºç¨‹åºå‘˜çˆ±å‡ ä½•ï¼</h4>
<p>2005 å¹´æœ‰ä¸ªå« Alistair Cockburn çš„å¤§ç¥å‘æ˜è¿™æ¶æ„æ—¶ï¼Œç”»äº†å¼ å›¾ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘è¹²åœ¨æ­£ä¸­é—´ï¼Œå‘¨å›´ä¼¸å‡ºå…­ä¸ª â€œæ¥å£è§¦è§’â€ è¿æ¥å¤–ç•Œï¼Œçœ‹èµ·æ¥åƒä¸ªå…­è¾¹å½¢ã€‚è¿™å›¾è—ç€ä¸ªå…³é”®æ€æƒ³ï¼š<strong>æ‰€æœ‰å¤–éƒ¨ç³»ç»Ÿï¼ˆç½‘é¡µã€æ•°æ®åº“ã€ç¬¬ä¸‰æ–¹æ¥å£ï¼‰éƒ½å¾— â€œä½å¤´â€ é€šè¿‡ç»Ÿä¸€æ¥å£æ‰¾æ ¸å¿ƒï¼Œæ ¸å¿ƒå´ä»ä¸æ­ç†å®ƒä»¬çš„ â€œå°è„¾æ°”â€</strong> ã€‚</p>
<p>æ‰“ä¸ªæ¯”æ–¹ï¼šæ ¸å¿ƒé€»è¾‘æ˜¯ä½ å®¶å®¢å…ğŸ»ï¼Œå…­è¾¹å½¢çš„å…­æ¡è¾¹æ˜¯å®¶é—¨ğŸšªï¼ˆç«¯å£ï¼‰ï¼Œé—¨å£çš„é‹æ¶ã€é—¨ç¦ã€å¿«é€’æŸœå°±æ˜¯ â€œé€‚é…å™¨â€ğŸ”Œã€‚ä¸ç®¡æ˜¯å¤–å–å°å“¥ï¼ˆAPIï¼‰ã€ä¿®æ°´ç®¡çš„ï¼ˆæ•°æ®åº“ï¼‰è¿˜æ˜¯ä¸²é—¨çš„é‚»å±…ï¼ˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰ï¼Œéƒ½å¾—èµ°é—¨ã€ç”¨é—¨å£çš„è®¾å¤‡ï¼Œç»ä¸ä¼šè®©ä»–ä»¬ç›´æ¥ç ¸å¢™è¿›å®¢å… â€”â€” è¿™å°±æ˜¯ â€œè§£è€¦â€ çš„ç²¾é«“ï¼</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f484aa7d5b04241868b0309388859e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Y-r6buR5aSn5biF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764513117&amp;x-signature=gt4mhUREP%2Bebrt2YJxn2XM1xOno%3D" alt="å…­è¾¹å½¢æ¶æ„.png" loading="lazy"/></p>
<h4 data-id="heading-3">ğŸ§  ä¸‰åˆ†é’Ÿçœ‹é€æ ¸å¿ƒä¸‰è¦ç´ ï¼šè°æ˜¯ â€œè¯äº‹äººâ€ï¼Ÿ</h4>
<h5 data-id="heading-4">1. æ ¸å¿ƒåŸŸï¼šä¸šåŠ¡é€»è¾‘çš„ â€œç‹¬ç«‹ç‹å›½â€ ğŸ‘‘</h5>
<p>æ ¸å¿ƒåŸŸæ˜¯æ•´ä¸ªæ¶æ„çš„çµé­‚ï¼Œåªå¹²ä¸€ä»¶äº‹ï¼šå®ç°ä¸šåŠ¡è§„åˆ™ï¼Œæ¯”å¦‚ â€œè®¢å•æ»¡ 200 å‡ 50â€â€œä½™é¢ä¸è¶³ä¸èƒ½è½¬è´¦â€ã€‚å®ƒæœ‰ä¸¤ä¸ªè¶…èƒ½åŠ›ï¼š</p>
<ul>
<li>ğŸŒ° ä¸ç¢°ä»»ä½•æŠ€æœ¯ç»†èŠ‚ï¼šä¸ç®¡ä½ ç”¨ MySQL è¿˜æ˜¯ Excel å­˜æ•°æ®ï¼Œä¸ç®¡å‰ç«¯æ˜¯ç½‘é¡µè¿˜æ˜¯ APPï¼Œå®ƒéƒ½æ¼ ä¸å…³å¿ƒï¼›</li>
<li>ğŸ§ª èƒ½å•ç‹¬æµ‹è¯•ï¼šä¸ç”¨è¿æ•°æ®åº“ã€å¼€æœåŠ¡å™¨ï¼Œç›´æ¥ç»™å®ƒä¼ æ•°æ®å°±èƒ½æµ‹ä¸šåŠ¡é€»è¾‘å¯¹ä¸å¯¹ã€‚</li>
</ul>
<p>ä¼ªä»£ç é•¿è¿™æ ·ï¼ˆçœ‹æ‡‚é€»è¾‘å°±è¡Œï¼Œä¸ç”¨ç®¡è¯­æ³•ï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šè®¢å•å¤„ç†ç³»ç»Ÿ</span>
Â â€‹
Â å®šä¹‰ è®¢å•æœåŠ¡ï¼š
Â â€‹
Â  Â  <span class="hljs-comment">// åªå…³å¿ƒä¸šåŠ¡è§„åˆ™ï¼Œä¸å…³å¿ƒæ•°æ®å­˜åœ¨å“ª</span>
Â â€‹
Â  Â  æ–¹æ³• åˆ›å»ºè®¢å•(ç”¨æˆ·, å•†å“åˆ—è¡¨)ï¼š
Â â€‹
Â  Â  Â  Â  å¦‚æœ å•†å“åº“å­˜ä¸è¶³ â†’ æŠ¥é”™â€œåº“å­˜ä¸å¤Ÿå•¦â€
Â â€‹
Â  Â  Â  Â  è®¡ç®— æ€»ä»· = å•†å“åˆ—è¡¨æ±‚å’Œ - ä¼˜æƒ é‡‘é¢
Â â€‹
Â  Â  Â  Â  å¦‚æœ æ€»ä»· &lt; <span class="hljs-number">0</span> â†’ æŠ¥é”™â€œä¼˜æƒ ä¸èƒ½è¶…æ€»ä»·â€
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•å­˜å‚¨æ¥å£.ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)  <span class="hljs-comment">// åªå–Šæ¥å£ï¼Œä¸å–Šå…·ä½“æ•°æ®åº“</span>
Â â€‹
Â  Â  Â  Â  è¿”å› è®¢å•ç¼–å·
</code></pre>
<h5 data-id="heading-5">2. ç«¯å£ï¼šæ ¸å¿ƒåŸŸçš„ â€œæ²Ÿé€šæš—å·â€ ğŸšª</h5>
<p>æ ¸å¿ƒåŸŸä¸æƒ³å’Œå¤–ç•Œç›´æ¥è¯´è¯ï¼Œäºæ˜¯æäº†å¥— â€œæš—å·æœ¬â€â€”â€” ç«¯å£ï¼Œæœ¬è´¨æ˜¯å®šä¹‰ â€œæ€ä¹ˆå¯¹è¯â€ çš„æ¥å£ã€‚åˆ†ä¸¤ç§ï¼š</p>
<ul>
<li>è¾“å…¥ç«¯å£ï¼ˆé©±åŠ¨ç«¯å£ï¼‰ï¼šåˆ«äººæ‰¾æ ¸å¿ƒåŠäº‹çš„æš—å·ï¼Œæ¯”å¦‚ â€œåˆ›å»ºè®¢å•â€â€œæŸ¥è¯¢ä½™é¢â€ï¼›</li>
<li>è¾“å‡ºç«¯å£ï¼ˆè¢«é©±åŠ¨ç«¯å£ï¼‰ï¼šæ ¸å¿ƒæ‰¾åˆ«äººåŠäº‹çš„æš—å·ï¼Œæ¯”å¦‚ â€œä¿å­˜æ•°æ®â€â€œå‘é€çŸ­ä¿¡â€ã€‚</li>
</ul>
<p>ç«¯å£çš„å…³é”®æ˜¯ï¼š<strong>ç”¨ä¸šåŠ¡è¯­è¨€è¯´è¯ï¼Œä¸è¯´æŠ€æœ¯æœ¯è¯­</strong>ï¼æ¯”å¦‚å« â€œä¿å­˜è®¢å•â€ è€Œä¸æ˜¯ â€œæ‰§è¡Œ SQL æ’å…¥â€ã€‚</p>
<p>ä¼ªä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// è¾“å…¥ç«¯å£ï¼šå¤–éƒ¨è°ƒç”¨æ ¸å¿ƒçš„æ¥å£</span>
Â â€‹
Â å®šä¹‰ è®¢å•æ“ä½œæ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• åˆ›å»ºè®¢å•(ç”¨æˆ·, å•†å“åˆ—è¡¨) â†’ è®¢å•ç¼–å·
Â â€‹
Â  Â  æ–¹æ³• å–æ¶ˆè®¢å•(è®¢å•ç¼–å·) â†’ å¸ƒå°”å€¼
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºç«¯å£ï¼šæ ¸å¿ƒè°ƒç”¨å¤–éƒ¨çš„æ¥å£</span>
Â â€‹
Â å®šä¹‰ è®¢å•å­˜å‚¨æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯) â†’ æˆåŠŸ/å¤±è´¥
Â â€‹
Â  Â  æ–¹æ³• æŸ¥è®¢å•(è®¢å•ç¼–å·) â†’ è®¢å•ä¿¡æ¯
</code></pre>
<h5 data-id="heading-6">3. é€‚é…å™¨ï¼šå¤–ç•Œçš„ â€œç¿»è¯‘å®˜â€ ğŸ”Œ</h5>
<p>ç«¯å£æ˜¯æš—å·æœ¬ï¼Œä½†å¤–ç•Œä¸æ‡‚æš—å·å•Šï¼æ¯”å¦‚ç½‘é¡µå‰ç«¯åªä¼šå‘ HTTP è¯·æ±‚ï¼Œæ•°æ®åº“åªä¼šè®¤ SQLâ€”â€” è¿™æ—¶å€™å°±éœ€è¦é€‚é…å™¨å½“ç¿»è¯‘ã€‚é€‚é…å™¨ä¹Ÿåˆ†ä¸¤ç§ï¼š</p>
<ul>
<li>è¾“å…¥é€‚é…å™¨ï¼šæŠŠå¤–ç•Œè¯·æ±‚è½¬æˆæ ¸å¿ƒèƒ½æ‡‚çš„æš—å·ï¼Œæ¯”å¦‚æŠŠç½‘é¡µçš„ â€œä¸‹å•æŒ‰é’®ç‚¹å‡»â€ è½¬æˆ â€œè°ƒç”¨è®¢å•æ“ä½œæ¥å£ã€‚åˆ›å»ºè®¢å•â€ï¼›</li>
<li>è¾“å‡ºé€‚é…å™¨ï¼šæŠŠæ ¸å¿ƒçš„æš—å·è½¬æˆå¤–ç•Œèƒ½æ‡‚çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚æŠŠ â€œä¿å­˜è®¢å•â€ è½¬æˆ MySQL çš„ INSERT è¯­å¥ï¼Œæˆ– MongoDB çš„ save å‘½ä»¤ã€‚</li>
</ul>
<p>æœ€ç‰›çš„æ˜¯ï¼š<strong>æ¢å¤–ç•Œç³»ç»Ÿåªéœ€æ¢é€‚é…å™¨ï¼Œæ ¸å¿ƒä¸åŠ¨ï¼</strong> æ¯”å¦‚ä» MySQL æ¢æˆ PostgreSQLï¼Œåªæ”¹ â€œæ•°æ®åº“é€‚é…å™¨â€ï¼Œæ ¸å¿ƒçš„ â€œä¿å­˜è®¢å•â€ é€»è¾‘ä¸€æ¯›é’±ä¸ç”¨æ”¹ã€‚</p>
<p>ä¼ªä»£ç æ¼”ç¤ºï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨ï¼šç½‘é¡µå‰ç«¯çš„ç¿»è¯‘å®˜</span>
Â â€‹
Â å®šä¹‰ ç½‘é¡µè®¢å•é€‚é…å™¨ï¼š
Â â€‹
Â  Â  æ–¹æ³• å¤„ç†ç½‘é¡µä¸‹å•è¯·æ±‚(ç½‘é¡µå‚æ•°)ï¼š
Â â€‹
Â  Â  Â  Â  è§£æ å‚æ•° â†’ ç”¨æˆ·ä¿¡æ¯ã€å•†å“åˆ—è¡¨
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•æ“ä½œæ¥å£.åˆ›å»ºè®¢å•(ç”¨æˆ·ä¿¡æ¯, å•†å“åˆ—è¡¨)  <span class="hljs-comment">// è½¬æˆæ ¸å¿ƒèƒ½æ‡‚çš„æš—å·</span>
Â â€‹
Â  Â  Â  Â  æŠŠ è®¢å•ç¼–å· è½¬æˆç½‘é¡µèƒ½æ˜¾ç¤ºçš„æ ¼å¼ â†’ è¿”å›ç»™ç”¨æˆ·
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨ï¼šMySQLæ•°æ®åº“çš„ç¿»è¯‘å®˜</span>
Â â€‹
Â å®šä¹‰ MySQLè®¢å•é€‚é…å™¨ å®ç° è®¢å•å­˜å‚¨æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)ï¼š
Â â€‹
Â  Â  Â  Â  æŠŠ è®¢å•ä¿¡æ¯ è½¬æˆ SQLè¯­å¥ â†’ "INSERT INTO è®¢å•è¡¨ VALUES (...)"
Â â€‹
Â  Â  Â  Â  æ‰§è¡Œ SQL â†’ è¿”å› æˆåŠŸ/å¤±è´¥
</code></pre>
<h4 data-id="heading-7">ğŸ› ï¸ æ‰‹æŠŠæ‰‹æ­æ¶æ„ï¼šç”¨ä¼ªä»£ç å»ºä¸ªè®¢å•ç³»ç»Ÿ</h4>
<p>å…‰è¯´ä¸ç»ƒå‡æŠŠå¼ï¼å’±ä»¬ç”¨ä¸Šé¢çš„ä¸‰è¦ç´ æ­ä¸ªç®€åŒ–ç‰ˆè®¢å•ç³»ç»Ÿï¼Œå…¨ç¨‹æ— å…·ä½“ä»£ç ï¼š</p>
<h5 data-id="heading-8">ç¬¬ä¸€æ­¥ï¼šå†™æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆä¸ç®¡å¤–ç•Œï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// æ ¸å¿ƒåŸŸï¼šè®¢å•æœåŠ¡ï¼ˆå®ç°è¾“å…¥ç«¯å£çš„é€»è¾‘ï¼‰</span>
Â â€‹
Â å®šä¹‰ è®¢å•æœåŠ¡ å®ç° è®¢å•æ“ä½œæ¥å£ï¼š
Â â€‹
Â  Â  <span class="hljs-comment">// ä¾èµ–è¾“å‡ºç«¯å£çš„æ¥å£ï¼Œä¸æ˜¯å…·ä½“å®ç°ï¼</span>
Â â€‹
Â  Â  æ¥æ”¶ è®¢å•å­˜å‚¨æ¥å£ å®ä¾‹ â†’ å­˜åœ¨è‡ªå·±è¿™é‡Œ
Â â€‹
Â  Â  æ–¹æ³• åˆ›å»ºè®¢å•(ç”¨æˆ·, å•†å“åˆ—è¡¨)ï¼š
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">1</span>. è°ƒç”¨ åº“å­˜æœåŠ¡æ¥å£.æŸ¥åº“å­˜(å•†å“åˆ—è¡¨) â†’ è‹¥ä¸è¶³æŠ¥é”™
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">2</span>. è®¡ç®— æ€»ä»· = å•†å“é‡‘é¢æ€»å’Œ - ç”¨æˆ·ä¼˜æƒ åˆ¸
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">3</span>. è°ƒç”¨ è‡ªå·±å­˜çš„è®¢å•å­˜å‚¨æ¥å£.ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">4</span>. è°ƒç”¨ æ¶ˆæ¯å‘é€æ¥å£.å‘æ¶ˆæ¯(ç”¨æˆ·ID, "è®¢å•åˆ›å»ºæˆåŠŸ")
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">5</span>. è¿”å› è®¢å•ç¼–å·
Â â€‹
Â  Â  æ–¹æ³• å–æ¶ˆè®¢å•(è®¢å•ç¼–å·)ï¼š
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">1</span>. è°ƒç”¨ è®¢å•å­˜å‚¨æ¥å£.æŸ¥è®¢å•(è®¢å•ç¼–å·) â†’ è‹¥ä¸å­˜åœ¨æŠ¥é”™
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">2</span>. è‹¥ è®¢å•å·²å‘è´§ â†’ æŠ¥é”™â€œä¸èƒ½å–æ¶ˆâ€
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">3</span>. è°ƒç”¨ è®¢å•å­˜å‚¨æ¥å£.æ›´æ–°è®¢å•çŠ¶æ€(è®¢å•ç¼–å·, "å·²å–æ¶ˆ")
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">4</span>. è°ƒç”¨ åº“å­˜æœåŠ¡æ¥å£.åŠ åº“å­˜(å•†å“åˆ—è¡¨)
Â â€‹
Â  Â  Â  Â  <span class="hljs-number">5</span>. è¿”å› æˆåŠŸ
</code></pre>
<h5 data-id="heading-9">ç¬¬äºŒæ­¥ï¼šæ¥å‰ç«¯ï¼ˆåŠ è¾“å…¥é€‚é…å™¨ï¼‰</h5>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨1ï¼šAPPé€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ APPè®¢å•é€‚é…å™¨ï¼š
Â â€‹
Â  Â  æ–¹æ³• å¤„ç†APPä¸‹å•è¯·æ±‚(APPå‚æ•°)ï¼š
Â â€‹
Â  Â  Â  Â  è§£æ å‚æ•° â†’ ç”¨æˆ·IDã€å•†å“IDåˆ—è¡¨
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•æœåŠ¡.åˆ›å»ºè®¢å•(ç”¨æˆ·ID, å•†å“IDåˆ—è¡¨)
Â â€‹
Â  Â  Â  Â  è¿”å› JSONæ ¼å¼çš„è®¢å•ç¼–å·
Â â€‹
Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨2ï¼šå°ç¨‹åºé€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ å°ç¨‹åºè®¢å•é€‚é…å™¨ï¼š
Â â€‹
Â  Â  æ–¹æ³• å¤„ç†å°ç¨‹åºä¸‹å•è¯·æ±‚(å°ç¨‹åºå‚æ•°)ï¼š
Â â€‹
Â  Â  Â  Â  è§£æ å‚æ•° â†’ ç”¨æˆ·IDã€å•†å“IDåˆ—è¡¨  <span class="hljs-comment">// å’ŒAPPè§£ææ–¹å¼ä¸åŒ</span>
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ è®¢å•æœåŠ¡.åˆ›å»ºè®¢å•(ç”¨æˆ·ID, å•†å“IDåˆ—è¡¨)  <span class="hljs-comment">// ä½†è°ƒç”¨æ ¸å¿ƒçš„æ–¹å¼ä¸€æ ·</span>
Â â€‹
Â  Â  Â  Â  è¿”å› å°ç¨‹åºèƒ½è¯†åˆ«çš„å“åº”æ ¼å¼
</code></pre>
<h5 data-id="heading-10">ç¬¬ä¸‰æ­¥ï¼šæ¥åç«¯ï¼ˆåŠ è¾“å‡ºé€‚é…å™¨ï¼‰</h5>
<pre><code class="hljs language-json" lang="json">Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨1ï¼šRedisç¼“å­˜é€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ Redisè®¢å•é€‚é…å™¨ å®ç° è®¢å•å­˜å‚¨æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• ä¿å­˜è®¢å•(è®¢å•ä¿¡æ¯)ï¼š
Â â€‹
Â  Â  Â  Â  æŠŠ è®¢å•ä¿¡æ¯ è½¬æˆ Redisçš„é”®å€¼å¯¹ â†’ <span class="hljs-string">"è®¢å•:123"</span> â†’ <span class="hljs-punctuation">{</span><span class="hljs-attr">"ç”¨æˆ·"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å¼ ä¸‰"</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">}</span>
Â â€‹
Â  Â  Â  Â  å­˜å…¥ Redis â†’ è¿”å› æˆåŠŸ
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨2ï¼šçŸ­ä¿¡é€šçŸ¥é€‚é…å™¨</span>
Â â€‹
Â å®šä¹‰ çŸ­ä¿¡é€‚é…å™¨ å®ç° æ¶ˆæ¯å‘é€æ¥å£ï¼š
Â â€‹
Â  Â  æ–¹æ³• å‘æ¶ˆæ¯(ç”¨æˆ·ID<span class="hljs-punctuation">,</span> å†…å®¹)ï¼š
Â â€‹
Â  Â  Â  Â  æŸ¥ ç”¨æˆ·æ‰‹æœºå· â†’ ä»ç”¨æˆ·æœåŠ¡æ¥å£æ‹¿
Â â€‹
Â  Â  Â  Â  è°ƒç”¨ çŸ­ä¿¡å¹³å°API â†’ å‘é€å†…å®¹
Â â€‹
Â  Â  Â  Â  è¿”å› å‘é€ç»“æœ
</code></pre>
<p>çœ‹åˆ°æ²¡ï¼Ÿä¸ç®¡å‰ç«¯åŠ å¤šå°‘ç«¯ï¼ˆAPPã€å°ç¨‹åºã€ç½‘é¡µï¼‰ï¼Œåç«¯æ¢å¤šå°‘å­˜å‚¨ï¼ˆRedisã€MySQLã€MongoDBï¼‰ï¼Œæ ¸å¿ƒçš„è®¢å•æœåŠ¡æ°¸è¿œç¨³å¦‚è€ç‹—ğŸ¶ï¼</p>
<h4 data-id="heading-11">ğŸ¯ è¿™äº›åœºæ™¯é—­çœ¼ç”¨ï¼šå…­è¾¹å½¢æ¶æ„çš„ â€œèˆ’é€‚åŒºâ€</h4>
<p>ä¸æ˜¯æ‰€æœ‰é¡¹ç›®éƒ½éœ€è¦è¿™æ¶æ„ï¼Œæ‰¾å¯¹åœºæ™¯æ‰èƒ½äº‹åŠåŠŸå€ï¼š</p>
<h5 data-id="heading-12">1. å¤šç«¯é€‚é…çš„ç³»ç»Ÿ ğŸ“±ğŸ’»</h5>
<p>æ¯”å¦‚ç”µå•†ç³»ç»Ÿè¦æ”¯æŒç½‘é¡µã€APPã€å°ç¨‹åºã€ç¬¬ä¸‰æ–¹ APIâ€”â€” è¾“å…¥é€‚é…å™¨å¤šå¼€å‡ ä¸ªå°±è¡Œï¼Œæ ¸å¿ƒé€»è¾‘ä¸€æ¬¡å†™å®Œã€‚å°±åƒé¤å…å¼€äº†å ‚é£Ÿã€å¤–å–ã€å›¢é¤çª—å£ï¼Œå¨æˆ¿è¿˜æ˜¯åŒä¸€ä¸ªğŸ³ã€‚</p>
<h5 data-id="heading-13">2. é¢‘ç¹æ¢å¤–éƒ¨ä¾èµ–çš„é¡¹ç›® ğŸ”„</h5>
<p>æ¯”å¦‚è€æ¿ä»Šå¤©è¯´ â€œç”¨ MySQL å­˜æ•°æ®â€ï¼Œæ˜å¤©è¯´ â€œæ¢ MongoDBâ€ï¼Œåå¤©è¯´ â€œåŠ ä¸ª Redis ç¼“å­˜â€â€”â€” åªéœ€æ¢è¾“å‡ºé€‚é…å™¨ï¼Œä¸ç”¨æ”¹æ ¸å¿ƒã€‚æœç´¢åˆ°çš„é˜¿é‡Œæ¡ˆä¾‹é‡Œï¼Œè¿ç§»æ•°æ®åº“æ—¶å…­è¾¹å½¢æ¶æ„çš„æˆæœ¬åªæœ‰ä¼ ç»Ÿæ¶æ„çš„ 1/10ï¼</p>
<h5 data-id="heading-14">3. å¤æ‚ä¸šåŠ¡ç³»ç»Ÿ ğŸ§©</h5>
<p>æ¯”å¦‚é“¶è¡Œçš„äº¤æ˜“ç³»ç»Ÿã€åŒ»é™¢çš„æŒ‚å·ç³»ç»Ÿï¼Œä¸šåŠ¡è§„åˆ™ä¸€å¤§å †ï¼ˆæ»¡å‡ã€æŠ˜æ‰£ã€æƒé™æ§åˆ¶ï¼‰ã€‚æ ¸å¿ƒåŸŸå•ç‹¬ç»´æŠ¤ä¸šåŠ¡é€»è¾‘ï¼Œæµ‹è¯•æ—¶ä¸ç”¨è¿æ•°æ®åº“ï¼Œç›´æ¥ Mock ä¸€ä¸ªé€‚é…å™¨å°±èƒ½æµ‹ï¼Œæ•ˆç‡ç¿»å€ğŸš€ã€‚</p>
<h5 data-id="heading-15">âŒ è¿™äº›åœºæ™¯åˆ«çç”¨ï¼šæ€é¸¡ä¸ç”¨ç‰›åˆ€</h5>
<ul>
<li>å°å·¥å…·ï¼šæ¯”å¦‚å†™ä¸ªæ‰¹é‡é‡å‘½åæ–‡ä»¶çš„è„šæœ¬ï¼Œä¸šåŠ¡é€»è¾‘å°±ä¸€è¡Œï¼Œç”¨è¿™æ¶æ„çº¯å±ç»™è‡ªå·±æ‰¾ç½ªå—ï¼›</li>
<li>ä¸€æ¬¡æ€§é¡¹ç›®ï¼šæ¯”å¦‚ä¸´æ—¶åšä¸ªæ´»åŠ¨é¡µé¢ï¼Œç”¨å®Œå°±æ‰”ï¼Œç®€å•çš„çº¿æ€§ä»£ç æ›´å¿«ï¼›</li>
<li>æŠ€æœ¯éªŒè¯åŸå‹ï¼šé‡ç‚¹åœ¨è¯•æŠ€æœ¯ï¼Œä¸æ˜¯ç¨³æ¶æ„ï¼Œå…ˆè·‘é€šå†è¯´ã€‚</li>
</ul>
<h4 data-id="heading-16">ğŸ†š ä¼ ç»Ÿæ¶æ„ VS å…­è¾¹å½¢æ¶æ„ï¼šå·®åœ¨å“ªï¼Ÿ</h4>
<p>ç”¨ä¸ªé€šä¿—æ¯”å–»ï¼š</p>
<ul>
<li>ä¼ ç»Ÿåˆ†å±‚æ¶æ„åƒä¸²ç³–è‘«èŠ¦ğŸ¡ï¼šUI å±‚ä¾èµ–æœåŠ¡å±‚ï¼ŒæœåŠ¡å±‚ä¾èµ– DAO å±‚ï¼ŒDAO å±‚ä¾èµ–æ•°æ®åº“ â€”â€” æ”¹æ•°æ®åº“ï¼Œä» DAO åˆ° UI å…¨å¾—åŠ¨ï¼›</li>
<li>å…­è¾¹å½¢æ¶æ„åƒç§¯æœ¨åŸå ¡ğŸ°ï¼šæ ¸å¿ƒæ˜¯åœ°åŸºï¼Œç«¯å£æ˜¯æ¥å£ï¼Œé€‚é…å™¨æ˜¯ç§¯æœ¨å— â€”â€” æƒ³æ¢çª—æˆ·ï¼ˆæ•°æ®åº“ï¼‰ã€é—¨ï¼ˆå‰ç«¯ï¼‰ï¼Œç›´æ¥æ‹†æ—§ç§¯æœ¨æ¢æ–°å“ï¼Œåœ°åŸºä¸åŠ¨ã€‚</li>
</ul>
<p>çœ‹ä¸ªçœŸå®å¯¹æ¯”ï¼šç”µå•†ç³»ç»Ÿä» MySQL è¿ç§»åˆ° PostgreSQL</p>






























<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>ä¼ ç»Ÿæ¶æ„</th><th>å…­è¾¹å½¢æ¶æ„</th></tr></thead><tbody><tr><td>æ ¸å¿ƒé€»è¾‘ä¿®æ”¹</td><td>è¦æ”¹ï¼ˆDAO å±‚ã€æœåŠ¡å±‚éƒ½ç¢°ï¼‰</td><td>ä¸æ”¹ï¼ˆæ ¸å¿ƒåŸŸç¨³å¦‚æ³°å±±ï¼‰</td></tr><tr><td>æµ‹è¯•èŒƒå›´</td><td>å…¨ç³»ç»Ÿé‡æµ‹</td><td>åªæµ‹æ–°é€‚é…å™¨</td></tr><tr><td>è¿ç§»æ—¶é—´</td><td>3 å¤©</td><td>2 å°æ—¶</td></tr><tr><td>é£é™©</td><td>å¯èƒ½æ”¹å´©ä¸šåŠ¡é€»è¾‘</td><td>å‡ ä¹é›¶é£é™©</td></tr></tbody></table>
<h5 data-id="heading-17">ä»£ç å¯¹æ¯”</h5>
<h6 data-id="heading-18">ğŸ¡ ä¼ ç»Ÿä¸‰å±‚æµå¼æ¶æ„ç¤ºä¾‹</h6>
<pre><code class="hljs language-scss" lang="scss">Â <span class="hljs-comment">// Controller å±‚ (UI å±‚)</span>
Â <span class="hljs-keyword">@RestController</span>
Â public class OrderController {
Â  Â  Â private final OrderService orderService; <span class="hljs-comment">// ç›´æ¥ä¾èµ– Service</span>
Â â€‹
Â  Â  Â <span class="hljs-keyword">@PostMapping</span>(<span class="hljs-string">"/orders"</span>)
Â  Â  Â public String createOrder(<span class="hljs-keyword">@RequestBody</span> OrderRequest request) {
Â  Â  Â  Â  Â return orderService<span class="hljs-selector-class">.createOrder</span>(request.getUser(), request<span class="hljs-selector-class">.getItems</span>());
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// Service å±‚ (ä¸šåŠ¡é€»è¾‘ + æŠ€æœ¯è€¦åˆ)</span>
Â <span class="hljs-keyword">@Service</span>
Â public class OrderService {
Â  Â  Â private final OrderDao orderDao; <span class="hljs-comment">// ç›´æ¥ä¾èµ– DAO</span>
Â â€‹
Â  Â  Â public String <span class="hljs-built_in">createOrder</span>(User user, List&lt;Item&gt; items) {
Â  Â  Â  Â  Â double total = items<span class="hljs-selector-class">.stream</span>()<span class="hljs-selector-class">.mapToDouble</span>(Item::getPrice)<span class="hljs-selector-class">.sum</span>();
Â  Â  Â  Â  Â <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>(user, items, total);
Â â€‹
Â  Â  Â  Â  Â <span class="hljs-comment">// ç›´æ¥è°ƒç”¨ DAO å±‚ï¼Œè€¦åˆæ•°æ®åº“</span>
Â  Â  Â  Â  Â orderDao<span class="hljs-selector-class">.insert</span>(order);
Â â€‹
Â  Â  Â  Â  Â return <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getId</span>();
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// DAO å±‚ (æ•°æ®åº“æ“ä½œ)</span>
Â <span class="hljs-keyword">@Repository</span>
Â public class OrderDao {
Â  Â  Â private final JdbcTemplate jdbc;
Â â€‹
Â  Â  Â public void <span class="hljs-built_in">insert</span>(Order order) {
Â  Â  Â  Â  Â jdbc<span class="hljs-selector-class">.update</span>("INSERT INTO orders (id, user, total) VALUES (?, ?, ?)",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getId</span>(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getUser</span>()<span class="hljs-selector-class">.getId</span>(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getTotal</span>());
Â  Â   }
Â }
Â â€‹
</code></pre>
<p>ğŸ‘‰ ç‰¹ç‚¹ï¼šService å±‚ç›´æ¥ä¾èµ– DAOï¼ŒDAO ç›´æ¥ä¾èµ–æ•°æ®åº“ã€‚æ¢æ•°æ®åº“æ—¶ï¼ŒService å’Œ DAO éƒ½å¯èƒ½è¦æ”¹ã€‚</p>
<h5 data-id="heading-19">ğŸ° å…­è¾¹å½¢æ¶æ„ç¤ºä¾‹</h5>
<pre><code class="hljs language-java" lang="java">Â <span class="hljs-comment">// è¾“å…¥ç«¯å£ (ä¸šåŠ¡æ¥å£)</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderUseCase</span> {
Â  Â  Â String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(User user, List&lt;Item&gt; items)</span>;
Â }
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºç«¯å£ (æŠ½è±¡æ¥å£)</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRepository</span> {
Â  Â  Â <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(Order order)</span>;
Â }
Â â€‹
Â <span class="hljs-comment">// æ ¸å¿ƒåŸŸ (ä¸šåŠ¡é€»è¾‘ï¼Œåªä¾èµ–ç«¯å£)</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderUseCase</span> {
Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderRepository orderRepository;
Â â€‹
Â  Â  Â <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(OrderRepository orderRepository)</span> {
Â  Â  Â  Â  Â <span class="hljs-built_in">this</span>.orderRepository = orderRepository;
Â  Â   }
Â â€‹
Â  Â  Â <span class="hljs-meta">@Override</span>
Â  Â  Â <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(User user, List&lt;Item&gt; items)</span> {
Â  Â  Â  Â  Â <span class="hljs-type">double</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> items.stream().mapToDouble(Item::getPrice).sum();
Â  Â  Â  Â  Â <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>(user, items, total);
Â â€‹
Â  Â  Â  Â  Â <span class="hljs-comment">// è°ƒç”¨æŠ½è±¡æ¥å£ï¼Œä¸å…³å¿ƒå…·ä½“æ•°æ®åº“</span>
Â  Â  Â  Â  Â orderRepository.save(order);
Â â€‹
Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> order.getId();
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// è¾“å…¥é€‚é…å™¨ (API å±‚)</span>
Â <span class="hljs-meta">@RestController</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {
Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderUseCase orderService;
Â â€‹
Â  Â  Â <span class="hljs-meta">@PostMapping("/orders")</span>
Â  Â  Â <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> OrderRequest request)</span> {
Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> orderService.createOrder(request.getUser(), request.getItems());
Â  Â   }
Â }
Â â€‹
Â <span class="hljs-comment">// è¾“å‡ºé€‚é…å™¨ (æ•°æ®åº“å®ç°)</span>
Â <span class="hljs-meta">@Repository</span>
Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySqlOrderRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderRepository</span> {
Â  Â  Â <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcTemplate jdbc;
Â â€‹
Â  Â  Â <span class="hljs-meta">@Override</span>
Â  Â  Â <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(Order order)</span> {
Â  Â  Â  Â  Â jdbc.update(<span class="hljs-string">"INSERT INTO orders (id, user, total) VALUES (?, ?, ?)"</span>,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â order.getId(), order.getUser().getId(), order.getTotal());
Â  Â   }
Â }
Â â€‹
</code></pre>
<p>ğŸ‘‰ ç‰¹ç‚¹ï¼šæ ¸å¿ƒåŸŸåªä¾èµ–æŠ½è±¡æ¥å£ <code>OrderRepository</code>ï¼Œå…·ä½“æ•°æ®åº“å®ç°ç”±é€‚é…å™¨æä¾›ã€‚æ¢æ•°æ®åº“æ—¶ï¼Œåªéœ€å†™ä¸€ä¸ªæ–°çš„é€‚é…å™¨ï¼ˆæ¯”å¦‚ <code>MongoOrderRepository</code>ï¼‰ï¼Œæ ¸å¿ƒåŸŸå®Œå…¨ä¸ç”¨æ”¹ã€‚</p>
<h4 data-id="heading-20">ğŸ“ æœ€åæ€»ç»“ï¼šåˆ«è¢«åå­—å“åˆ°ï¼</h4>
<p>å…­è¾¹å½¢æ¶æ„çš„æ ¸å¿ƒä¸æ˜¯ â€œå…­è¾¹å½¢â€ è¿™ä¸ªå½¢çŠ¶ï¼Œè€Œæ˜¯ â€œä¸šåŠ¡ä¼˜å…ˆï¼ŒæŠ€æœ¯é è¾¹â€ çš„è®¾è®¡æ€æƒ³ â€”â€” è®©æœ€æœ‰ä»·å€¼çš„ä¸šåŠ¡é€»è¾‘æ‘†è„±æŠ€æœ¯çš„æŸç¼šï¼Œæƒ³æ€ä¹ˆæŠ˜è…¾æŠ€æœ¯ç»†èŠ‚å°±æ€ä¹ˆæŠ˜è…¾ï¼Œæ ¸å¿ƒæ°¸è¿œå®‰å…¨ã€‚</p>
<p>å¯¹å°ç™½æ¥è¯´ï¼Œä¸ç”¨ä¸€å¼€å§‹å°±å®Œç¾å®ç°ï¼Œå…ˆè®°ä½ä¸‰ä¸ªåŸåˆ™ï¼š</p>
<ol start="0">
<li>æ ¸å¿ƒåªå¹²ä¸šåŠ¡çš„äº‹ï¼Œåˆ«ç¢°æŠ€æœ¯ï¼›</li>
<li>å¯¹å¤–åªé€šè¿‡ç«¯å£è¯´è¯ï¼Œåˆ«ç›´æ¥å” ï¼›</li>
<li>é€‚é…äº¤ç»™é€‚é…å™¨ï¼Œåˆ«è®©æ ¸å¿ƒå½“ç¿»è¯‘ã€‚</li>
</ol>
<p>ä¸‹æ¬¡å†é‡åˆ° â€œæ”¹ä¸€è¡Œå´©å…¨æœâ€ çš„å‘ï¼Œè¯•è¯•ç”¨å…­è¾¹å½¢æ¶æ„æ­ä¸ªéª¨æ¶ â€”â€” ç›¸ä¿¡æˆ‘ï¼Œæµ‹è¯•å°å“¥ä¼šå°‘è¿½æ€ä½ å¥½å‡ æ¬¡ğŸ˜‰ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@NotBlank ä¸ç”Ÿæ•ˆæŠ¥é”™ No validator could be foundï¼šHibernate Validator ç‰ˆæœ¬åŒ¹é…æŒ‡åŒ—]]></title>    <link>https://juejin.cn/post/7575937594337673257</link>    <guid>https://juejin.cn/post/7575937594337673257</guid>    <pubDate>2025-11-23T15:26:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575937594337673257" data-draft-id="7575425466905493567" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@NotBlank ä¸ç”Ÿæ•ˆæŠ¥é”™ No validator could be foundï¼šHibernate Validator ç‰ˆæœ¬åŒ¹é…æŒ‡åŒ—"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-23T15:26:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="9å·è¾¾äºº"/> <meta itemprop="url" content="https://juejin.cn/user/2450136052270077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @NotBlank ä¸ç”Ÿæ•ˆæŠ¥é”™ No validator could be foundï¼šHibernate Validator ç‰ˆæœ¬åŒ¹é…æŒ‡åŒ—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2450136052270077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    9å·è¾¾äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T15:26:20.000Z" title="Sun Nov 23 2025 15:26:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜èƒŒæ™¯</h2>
<p>æœ€è¿‘åœ¨å†™æ¥å£çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†å®é™…å¾ˆå‘çš„å‚æ•°æ ¡éªŒé—®é¢˜ã€‚ä»£ç æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
Â *Â å…³é”®è¯
Â */</span>
@NotBlank
<span class="hljs-keyword">private</span>Â <span class="hljs-type">String</span>Â keywords;
</code></pre>
<p>çœ‹èµ·æ¥å¾ˆå®Œç¾å¯¹å§ï¼Ÿä½¿ç”¨çš„æ˜¯ <code>javax.validation.constraints.NotBlank</code> æ³¨è§£æ¥æ ¡éªŒå­—ç¬¦ä¸²ä¸èƒ½ä¸ºç©ºã€‚</p>
<p>ç»“æœä¸€æµ‹è¯•ï¼Œç›´æ¥ç»™æˆ‘æ¥äº†ä¸ªå¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">javax.validation.UnexpectedTypeException:Â HV000030:Â NoÂ validatorÂ couldÂ beÂ foundÂ <span class="hljs-keyword">for</span>Â <span class="hljs-title class_">constraint</span>Â <span class="hljs-symbol">'javax</span>.validation.constraints.NotBlank'Â validatingÂ <span class="hljs-keyword">type</span>Â <span class="hljs-symbol">'java</span>.lang.<span class="hljs-type">String</span>'.Â CheckÂ configurationÂ <span class="hljs-keyword">for</span>Â <span class="hljs-symbol">'keywords</span>'
</code></pre>
<h2 data-id="heading-1">å¼‚å¸¸åˆ†æ</h2>
<p>çœ‹åˆ°è¿™ä¸ªå¼‚å¸¸ä¿¡æ¯ï¼Œç¬¬ä¸€ååº”æ˜¯ï¼š<strong>ä»€ä¹ˆé¬¼ï¼Ÿ@NotBlank ä¸å°±æ˜¯ç”¨æ¥æ ¡éªŒ String çš„å—ï¼Ÿæ€ä¹ˆè¿˜æ‰¾ä¸åˆ°éªŒè¯å™¨ï¼Ÿ</strong></p>
<p>å»ç½‘ä¸Šæœäº†ä¸€åœˆï¼Œå‘ç°ä¼—è¯´çº·çº­ï¼š</p>
<ul>
<li>æœ‰äººè¯´ String ä¸èƒ½é…ç½® @NotBlankï¼ˆè¿™æ˜æ˜¾æ˜¯é”™çš„ï¼‰</li>
<li>æœ‰äººè¯´ç¼ºå°‘ <code>validation-api</code> ä¾èµ–</li>
<li>æœ‰äººè¯´ç¼ºå°‘ <code>hibernate-validator</code> ä¾èµ–</li>
<li>è¿˜æœ‰äººè¯´ç‰ˆæœ¬ä¸åŒ¹é…</li>
</ul>
<h2 data-id="heading-2">æ ¹æœ¬åŸå› </h2>
<p>æ£€æŸ¥é¡¹ç›®ä¾èµ–åå‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â é¡¹ç›®ä¸­çš„å®é™…ä¾èµ–Â --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.validation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>validation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.x<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>Â Â 
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.validator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.4.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>Â 
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>çœ‹å‡ºé—®é¢˜äº†å—ï¼Ÿçœ‹åˆ°äº†å¿ƒé‡Œæ‰“ä¸ªæ‰£</strong></p>
<ul>
<li><code>@NotNull</code> èƒ½ç”¨ï¼šå› ä¸ºå®ƒæ˜¯ Bean Validation 1.1 å°±æœ‰çš„æ³¨è§£ï¼Œhibernate-validator 5.x æ”¯æŒ</li>
<li><code>@NotBlank</code> ä¸èƒ½ç”¨ï¼šå› ä¸ºå®ƒæ˜¯ Bean Validation 2.0 æ–°å¢çš„æ³¨è§£ï¼Œéœ€è¦ hibernate-validator 6.x æ‰æ”¯æŒ</li>
</ul>
<p>è™½ç„¶å¼•å…¥äº† <code>validation-api 2.0</code>ï¼ˆæœ‰ @NotBlank æ³¨è§£å®šä¹‰ï¼‰ï¼Œä½†è¿è¡Œæ—¶ç”¨çš„æ˜¯ <code>hibernate-validator 5.4.1</code>ï¼ˆæ²¡æœ‰ @NotBlank çš„éªŒè¯å™¨å®ç°ï¼‰ï¼Œæ‰€ä»¥ç¼–è¯‘èƒ½é€šè¿‡ï¼Œè¿è¡Œæ—¶å´æ‰¾ä¸åˆ°éªŒè¯å™¨ï¼</p>
<h3 data-id="heading-3">ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸ï¼Ÿ</h3>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹å¼‚å¸¸æŠ›å‡ºçš„æºç ï¼ˆhibernate-validator 5.xï¼‰ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">privateÂ &lt;T,Â V&gt;Â ConstraintValidator&lt;<span class="hljs-selector-tag">A</span>,Â V&gt;Â <span class="hljs-built_in">getConstraintValidatorNoUnwrapping</span>(
Â Â Â Â Â Â Â Â ValidationContext&lt;T&gt;Â validationContext,
Â Â Â Â Â Â Â Â ValueContext&lt;?,Â V&gt;Â valueContext)Â {
Â Â Â Â <span class="hljs-comment">//Â ç¡®ä¿æ²¡æœ‰è®¾ç½®Â unwrapper</span>
Â Â Â Â valueContext<span class="hljs-selector-class">.setValidatedValueHandler</span>(null);

Â Â Â Â TypeÂ validatedValueTypeÂ =Â valueContext<span class="hljs-selector-class">.getDeclaredTypeOfValidatedElement</span>();

Â Â Â Â <span class="hljs-comment">//Â å…³é”®ï¼šä»Â ConstraintValidatorManagerÂ ä¸­è·å–å·²åˆå§‹åŒ–çš„éªŒè¯å™¨</span>
Â Â Â Â ConstraintValidator&lt;<span class="hljs-selector-tag">A</span>,Â V&gt;Â validatorÂ =Â validationContext
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.getConstraintValidatorManager</span>()
Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.getInitializedValidator</span>(
Â Â Â Â Â Â Â Â Â Â Â Â validatedValueType,Â Â Â Â Â Â //Â String.class
Â Â Â Â Â Â Â Â Â Â Â Â descriptor,Â Â Â Â Â Â Â Â Â Â Â Â Â Â //Â @NotBlankÂ æ³¨è§£æè¿°ç¬¦
Â Â Â Â Â Â Â Â Â Â Â Â validationContext.getConstraintValidatorFactory()
Â Â Â Â Â Â Â Â );

Â Â Â Â <span class="hljs-comment">//Â å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„éªŒè¯å™¨å®ç°ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
Â Â Â Â ifÂ (validatorÂ ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-built_in">throwExceptionForNullValidator</span>(validatedValueType,
Â Â Â Â Â Â Â Â Â Â Â Â valueContext.getPropertyPath()<span class="hljs-selector-class">.asString</span>());
Â Â Â Â }

Â Â Â Â returnÂ validator;
}
</code></pre>
<p><strong>æµç¨‹è§£æï¼š</strong></p>
<ol>
<li>è·å–è¢«æ ¡éªŒå­—æ®µçš„ç±»å‹ï¼š<code>String.class</code></li>
<li>ä» <code>ConstraintValidatorManager</code> ä¸­æŸ¥æ‰¾èƒ½å¤„ç† <code>@NotBlank + String</code> ç»„åˆçš„éªŒè¯å™¨</li>
<li><strong>åœ¨ hibernate-validator 5.x ä¸­æ‰¾ä¸åˆ° <code>NotBlankValidator</code></strong>ï¼Œè¿”å› null</li>
<li>æŠ›å‡º <code>UnexpectedTypeException</code> å¼‚å¸¸</li>
</ol>
<h4 data-id="heading-4">ä¸ºä»€ä¹ˆä¼šè¿”å› nullï¼Ÿ</h4>
<p>ç»§ç»­è¿½è¸ª <code>getInitializedValidator</code> æ–¹æ³•çš„å®ç°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">publicÂ &lt;V,Â AÂ extendsÂ Annotation&gt;Â ConstraintValidator&lt;A,Â V&gt;Â getInitializedValidator(
Â Â Â Â Â Â Â Â TypeÂ validatedValueType,
Â Â Â Â Â Â Â Â ConstraintDescriptorImpl&lt;A&gt;Â descriptor,
Â Â Â Â Â Â Â Â ConstraintValidatorFactoryÂ constraintFactory)Â {

Â Â Â Â Contracts.assertNotNull(validatedValueType)<span class="hljs-comment">;</span>
Â Â Â Â Contracts.assertNotNull(descriptor)<span class="hljs-comment">;</span>
Â Â Â Â Contracts.assertNotNull(constraintFactory)<span class="hljs-comment">;</span>

Â Â Â Â //Â 1.Â é¦–å…ˆå°è¯•ä»ç¼“å­˜ä¸­è·å–
Â Â Â Â CacheKeyÂ <span class="hljs-attr">key</span>Â =Â newÂ CacheKey(descriptor.getAnnotation(),Â validatedValueType,Â constraintFactory)<span class="hljs-comment">;</span>

Â Â Â Â ConstraintValidator&lt;A,Â V&gt;Â <span class="hljs-attr">constraintValidator</span>Â =
Â Â Â Â Â Â Â Â (ConstraintValidator&lt;A,Â V&gt;)Â constraintValidatorCache.get(key)<span class="hljs-comment">;</span>

Â Â Â Â //Â 2.Â ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ›å»ºå¹¶åˆå§‹åŒ–éªŒè¯å™¨
Â Â Â Â ifÂ (<span class="hljs-attr">constraintValidator</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â createAndInitializeValidator(
Â Â Â Â Â Â Â Â Â Â Â Â constraintFactory,Â validatedValueType,Â descriptor)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â cacheValidator(key,Â constraintValidator)<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â LOG.tracef("ConstraintÂ validatorÂ %sÂ foundÂ inÂ cache.",Â constraintValidator)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â //Â 3.Â å…³é”®ï¼šå¦‚æœæ˜¯Â DUMMY_CONSTRAINT_VALIDATORï¼Œè¿”å›Â nullï¼
Â Â Â Â returnÂ <span class="hljs-attr">DUMMY_CONSTRAINT_VALIDATOR</span>Â ==Â constraintValidatorÂ ?Â nullÂ :Â constraintValidator<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>æ³¨æ„æœ€åä¸€è¡Œ</strong>ï¼šå¦‚æœ <code>constraintValidator</code> æ˜¯ <code>DUMMY_CONSTRAINT_VALIDATOR</code>ï¼Œå°±è¿”å› nullï¼</p>
<p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä¼šåˆ›å»º <code>DUMMY_CONSTRAINT_VALIDATOR</code> å‘¢ï¼Ÿç»§ç»­çœ‹ <code>createAndInitializeValidator</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">privateÂ &lt;V,Â AÂ extendsÂ Annotation&gt;Â ConstraintValidator&lt;A,Â V&gt;Â createAndInitializeValidator(
Â Â Â Â Â Â Â Â ConstraintValidatorFactoryÂ constraintFactory,
Â Â Â Â Â Â Â Â TypeÂ validatedValueType,
Â Â Â Â Â Â Â Â ConstraintDescriptorImpl&lt;A&gt;Â descriptor)Â {

Â Â Â Â //Â 1.Â æ ¸å¿ƒï¼šæŸ¥æ‰¾åŒ¹é…çš„éªŒè¯å™¨ç±»
Â Â Â Â Class&lt;?Â extendsÂ ConstraintValidator&lt;A,Â V&gt;&gt;Â <span class="hljs-attr">validatorClass</span>Â =
Â Â Â Â Â Â Â Â (Class&lt;?Â extendsÂ ConstraintValidator&lt;A,Â V&gt;&gt;)
Â Â Â Â Â Â Â Â findMatchingValidatorClass(descriptor,Â validatedValueType)<span class="hljs-comment">;</span>

Â Â Â Â ConstraintValidator&lt;A,Â V&gt;Â constraintValidator<span class="hljs-comment">;</span>

Â Â Â Â //Â 2.Â å¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„éªŒè¯å™¨ç±»ï¼Œè¿”å›Â DUMMYï¼
Â Â Â Â ifÂ (<span class="hljs-attr">validatorClass</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â (ConstraintValidator&lt;A,Â V&gt;)Â DUMMY_CONSTRAINT_VALIDATOR<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â //Â 3.Â æ‰¾åˆ°äº†éªŒè¯å™¨ç±»ï¼Œåˆ›å»ºå®ä¾‹å¹¶åˆå§‹åŒ–
Â Â Â Â Â Â Â Â <span class="hljs-attr">constraintValidator</span>Â =Â constraintFactory.getInstance(validatorClass)<span class="hljs-comment">;</span>

Â Â Â Â Â Â Â Â ifÂ (<span class="hljs-attr">constraintValidator</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â throwÂ LOG.getConstraintFactoryMustNotReturnNullException(validatorClass)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â initializeValidator(descriptor,Â constraintValidator)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â returnÂ constraintValidator<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>å…³é”®åœ¨äº <code>findMatchingValidatorClass</code> æ–¹æ³•ï¼</strong></p>
<p>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ hibernate-validator å†…éƒ¨æ³¨å†Œçš„éªŒè¯å™¨åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼š</p>
<ul>
<li>
<p>è¾“å…¥ï¼š<code>@NotBlank</code> æ³¨è§£ + <code>String</code> ç±»å‹</p>
</li>
<li>
<p>æŸ¥æ‰¾ï¼šèƒ½å¤„ç†è¿™ä¸ªç»„åˆçš„ <code>ConstraintValidator</code> å®ç°ç±»</p>
</li>
<li>
<p>ç»“æœï¼š</p>
<ul>
<li><strong>Hibernate Validator 6.x</strong>ï¼šæ‰¾åˆ° <code>org.hibernate.validator.internal.constraintvalidators.bv.NotBlankValidator</code></li>
<li><strong>Hibernate Validator 5.x</strong>ï¼šæ‰¾ä¸åˆ°ï¼ˆå› ä¸ºæ ¹æœ¬æ²¡æœ‰å®ç°è¿™ä¸ªç±»ï¼‰ï¼Œè¿”å› null</li>
</ul>
</li>
</ul>
<p><strong>å®Œæ•´è°ƒç”¨é“¾ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">éªŒè¯è§¦å‘
Â Â â†“
<span class="hljs-built_in">getConstraintValidatorNoUnwrapping</span>()
Â Â â†“
<span class="hljs-built_in">getInitializedValidator</span>()Â Â <span class="hljs-comment">//Â ä»ç¼“å­˜æˆ–åˆ›å»ºéªŒè¯å™¨</span>
Â Â â†“
<span class="hljs-built_in">createAndInitializeValidator</span>()
Â Â â†“
<span class="hljs-built_in">findMatchingValidatorClass</span>()Â Â <span class="hljs-comment">//Â æŸ¥æ‰¾éªŒè¯å™¨ç±»</span>
Â Â â†“
åœ¨Â HibernateÂ ValidatorÂ <span class="hljs-number">5</span><span class="hljs-selector-class">.x</span>Â çš„éªŒè¯å™¨æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾
Â Â â†“
æ‰¾ä¸åˆ°Â NotBlankValidatorï¼ˆå› ä¸ºÂ <span class="hljs-number">5</span><span class="hljs-selector-class">.x</span>Â æ²¡æœ‰å®ç°ï¼‰
Â Â â†“
è¿”å›Â null
Â Â â†“
åˆ›å»ºÂ DUMMY_CONSTRAINT_VALIDATOR
Â Â â†“
ç¼“å­˜å¹¶è¿”å›Â DUMMY
Â Â â†“
<span class="hljs-built_in">getInitializedValidator</span>()Â æ£€æµ‹åˆ°æ˜¯Â DUMMYï¼Œè¿”å›Â null
Â Â â†“
<span class="hljs-built_in">getConstraintValidatorNoUnwrapping</span>()Â æ£€æµ‹åˆ°Â validatorÂ ==Â null
Â Â â†“
æŠ›å‡ºÂ UnexpectedTypeExceptionÂ å¼‚å¸¸
</code></pre>
<h4 data-id="heading-5">éªŒè¯å™¨æ˜¯å¦‚ä½•åŠ è½½çš„ï¼Ÿ</h4>
<p>æ—¢ç„¶ <code>findMatchingValidatorClass</code> æ–¹æ³•æ‰¾ä¸åˆ°éªŒè¯å™¨ï¼Œé‚£ä¹ˆéªŒè¯å™¨åˆ—è¡¨æ˜¯ä»å“ªé‡Œæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>Java Field Watchpoints</strong> æ¥ç›‘æ§éªŒè¯å™¨åˆ—è¡¨çš„æ„å»ºè¿‡ç¨‹ã€‚</p>
<p>åœ¨ IDE ä¸­å¯¹ <code>matchingConstraintValidatorClasses</code> å­—æ®µè®¾ç½® Field Watchpointï¼Œè§‚å¯Ÿå®ƒä½•æ—¶è¢«èµ‹å€¼ï¼š</p>
<p>ä½ ä¼šå‘ç°æ–­ç‚¹åœåœ¨äº† <code>ConstraintHelper</code> ç±»çš„ <code>findValidatorClasses</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/**
Â *Â æŸ¥æ‰¾èƒ½å¤Ÿå¤„ç†æŒ‡å®šæ³¨è§£ç±»å‹çš„æ‰€æœ‰éªŒè¯å™¨ç±»
Â */</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-operator">&lt;</span><span class="hljs-type">A</span>Â extendsÂ <span class="hljs-type">Annotation</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;
Â Â Â Â Â Â Â Â findValidatorClasses(<span class="hljs-type">Class</span>&lt;<span class="hljs-type">A</span>&gt;Â annotationType,Â <span class="hljs-type">ValidationTarget</span>Â validationTarget)Â {

Â Â Â Â <span class="hljs-comment">//Â 1.Â è·å–è¯¥æ³¨è§£ç±»å‹å¯¹åº”çš„æ‰€æœ‰éªŒè¯å™¨ç±»ï¼ˆå…³é”®æ–¹æ³•ï¼ï¼‰</span>
Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;Â validatorClassesÂ <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â getAllValidatorClasses(annotationType);

Â Â Â Â <span class="hljs-comment">//Â 2.Â è¿‡æ»¤å‡ºåŒ¹é…çš„éªŒè¯å™¨ç±»</span>
Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;Â matchingValidatorClassesÂ <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â newArrayList();

Â Â Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;Â validatorClassÂ :Â validatorClasses)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ£€æŸ¥éªŒè¯å™¨æ˜¯å¦æ”¯æŒæŒ‡å®šçš„éªŒè¯ç›®æ ‡ï¼ˆæ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰ï¼‰</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (supportsValidationTarget(validatorClass,Â validationTarget))Â {
Â Â Â Â Â Â Â Â Â Â Â Â matchingValidatorClasses.add(validatorClass);
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">return</span>Â matchingValidatorClasses;
}
</code></pre>
<p><strong>å…³é”®åœ¨äº <code>getAllValidatorClasses</code> æ–¹æ³•ï¼</strong></p>
<p>è¿™ä¸ªæ–¹æ³•ä»å†…éƒ¨çš„éªŒè¯å™¨æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span>Â <span class="hljs-operator">&lt;</span><span class="hljs-type">A</span>Â extendsÂ <span class="hljs-type">Annotation</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;<span class="hljs-type">A</span>,Â ?&gt;&gt;&gt;
Â Â Â Â Â Â Â Â getAllValidatorClasses(<span class="hljs-type">Class</span>&lt;<span class="hljs-type">A</span>&gt;Â annotationType)Â {

Â Â Â Â <span class="hljs-comment">//Â ä»Â builtinConstraintsÂ æ˜ å°„è¡¨ä¸­æŸ¥æ‰¾</span>
Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">Class</span>&lt;?Â extendsÂ <span class="hljs-type">ConstraintValidator</span>&lt;?,Â ?&gt;&gt;&gt;Â validatorClassesÂ <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â builtinConstraints.get(annotationType);

Â Â Â Â <span class="hljs-keyword">if</span>Â (validatorClassesÂ <span class="hljs-operator">==</span>Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¦‚æœä¸æ˜¯å†…ç½®çº¦æŸï¼Œå°è¯•ä»æ³¨è§£çš„Â @ConstraintÂ å…ƒæ³¨è§£ä¸­è·å–</span>
Â Â Â Â Â Â Â Â validatorClassesÂ <span class="hljs-operator">=</span>Â getValidatorClassesFromConstraintAnnotation(annotationType);
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">return</span>Â (<span class="hljs-type">List</span>)Â validatorClasses;
}
</code></pre>
<h4 data-id="heading-6">éªŒè¯å™¨æ³¨å†Œè¡¨ï¼šbuiltinConstraints çš„åˆå§‹åŒ–</h4>
<p><code>builtinConstraints</code> æ˜¯ä¸€ä¸ª <code>Map&lt;Class&lt;? extends Annotation&gt;, List&lt;Class&lt;? extends ConstraintValidator&lt;?, ?&gt;&gt;&gt;&gt;</code> æ˜ å°„è¡¨ï¼Œåœ¨ <code>ConstraintHelper</code> æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ã€‚</p>
<p><strong>Hibernate Validator 5.x çš„æ³¨å†Œè¡¨ï¼š</strong></p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">public</span>Â <span class="hljs-title class_">ConstraintHelper</span>()Â {
Â Â Â Â <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">Class</span>&lt;?Â extendsÂ <span class="hljs-title class_">Annotation</span>&gt;,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">Class</span>&lt;?Â extendsÂ <span class="hljs-title class_">ConstraintValidator</span>&lt;<span class="hljs-string">?,</span>Â <span class="hljs-string">?&gt;</span>&gt;&gt;&gt;
Â Â Â Â Â Â Â Â tmpConstraintsÂ =Â newHashMap();

Â Â Â Â <span class="hljs-regexp">//</span>Â æ³¨å†ŒÂ <span class="hljs-variable">@NotNull</span>Â éªŒè¯å™¨
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">NotNull</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â <span class="hljs-title class_">NotNullValidator</span>.<span class="hljs-keyword">class</span>);

Â Â Â Â <span class="hljs-regexp">//</span>Â æ³¨å†ŒÂ <span class="hljs-variable">@Size</span>Â éªŒè¯å™¨ï¼ˆå¤šä¸ªå®ç°ï¼‰
Â Â Â Â putConstraints(tmpConstraints,Â <span class="hljs-title class_">Size</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â <span class="hljs-title class_">Arrays</span>.asList(
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForCharSequence</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForCollection</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForArray</span>.<span class="hljs-keyword">class</span>,
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-title class_">SizeValidatorForMap</span>.<span class="hljs-keyword">class</span>
Â Â Â Â Â Â Â Â )
Â Â Â Â );

Â Â Â Â <span class="hljs-regexp">//</span>Â æ³¨å†ŒÂ <span class="hljs-variable">@Min</span>,Â <span class="hljs-variable">@Max</span>,Â <span class="hljs-variable">@Pattern</span>Â ç­‰...
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">Min</span>.<span class="hljs-keyword">class</span>,Â <span class="hljs-title class_">MinValidatorForNumber</span>.<span class="hljs-keyword">class</span>);
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">Max</span>.<span class="hljs-keyword">class</span>,Â <span class="hljs-title class_">MaxValidatorForNumber</span>.<span class="hljs-keyword">class</span>);
Â Â Â Â putConstraint(tmpConstraints,Â <span class="hljs-title class_">Pattern</span>.<span class="hljs-keyword">class</span>,Â <span class="hljs-title class_">PatternValidator</span>.<span class="hljs-keyword">class</span>);

Â Â Â Â <span class="hljs-regexp">//</span>æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰Â <span class="hljs-title class_">NotBlank</span>Â çš„æ³¨å†Œï¼

Â Â Â Â this.builtinConstraintsÂ =Â <span class="hljs-title class_">Collections</span>.unmodifiableMap(tmpConstraints);
}
</code></pre>
<h4 data-id="heading-7">å®Œæ•´çš„éªŒè¯å™¨æŸ¥æ‰¾æµç¨‹</h4>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªæµç¨‹ä¸²èµ·æ¥äº†ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-number">1.</span>Â åº”ç”¨å¯åŠ¨
Â Â Â â†“
<span class="hljs-number">2.</span>Â ConstraintHelperÂ åˆå§‹åŒ–
Â Â Â â†“
<span class="hljs-number">3.</span>Â æ„å»ºÂ builtinConstraintsÂ æ˜ å°„è¡¨
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">5.</span>x:Â æ²¡æœ‰Â NotBlank.<span class="hljs-keyword">class</span>Â â†’Â NotBlankValidator.<span class="hljs-keyword">class</span>Â æ˜ å°„
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">6.</span>x:Â æœ‰Â NotBlank.<span class="hljs-keyword">class</span>Â â†’Â NotBlankValidator.<span class="hljs-keyword">class</span>Â æ˜ å°„
Â Â Â â†“
<span class="hljs-number">4.</span>Â è§¦å‘å­—æ®µæ ¡éªŒï¼ˆ<span class="hljs-meta">@NotBlank</span>Â <span class="hljs-built_in">String</span>Â keywordsï¼‰
Â Â Â â†“
<span class="hljs-number">5.</span>Â findMatchingValidatorClass()Â è¢«è°ƒç”¨
Â Â Â â†“
<span class="hljs-number">6.</span>Â è°ƒç”¨Â findValidatorClasses(NotBlank.<span class="hljs-keyword">class</span>,Â ...)
Â Â Â â†“
<span class="hljs-number">7.</span>Â è°ƒç”¨Â getAllValidatorClasses(NotBlank.<span class="hljs-keyword">class</span>)
Â Â Â â†“
<span class="hljs-number">8.</span>Â ä»Â builtinConstraints.<span class="hljs-keyword">get</span>(NotBlank.<span class="hljs-keyword">class</span>)Â æŸ¥æ‰¾
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">5.</span>x:Â è¿”å›Â <span class="hljs-keyword">null</span>ï¼ˆæ˜ å°„è¡¨ä¸­æ²¡æœ‰ï¼‰
Â Â Â -Â HibernateÂ ValidatorÂ <span class="hljs-number">6.</span>x:Â è¿”å›Â [NotBlankValidator.<span class="hljs-keyword">class</span>]
Â Â Â â†“
<span class="hljs-number">9.</span>Â HibernateÂ ValidatorÂ <span class="hljs-number">5.</span>xÂ è·¯å¾„ï¼š
Â Â Â validatorClassesÂ ==Â <span class="hljs-keyword">null</span>
Â Â Â â†’Â matchingValidatorClassesÂ ä¸ºç©º
Â Â Â â†’Â findMatchingValidatorClassÂ è¿”å›Â <span class="hljs-keyword">null</span>
Â Â Â â†’Â åˆ›å»ºÂ DUMMY_CONSTRAINT_VALIDATOR
Â Â Â â†’Â getInitializedValidatorÂ è¿”å›Â <span class="hljs-keyword">null</span>
Â Â Â â†’Â æŠ›å‡ºÂ UnexpectedTypeException
</code></pre>
<p><strong>é€šè¿‡è°ƒè¯•éªŒè¯ï¼š</strong></p>
<p>ä½ å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰“æ–­ç‚¹éªŒè¯æ•´ä¸ªæµç¨‹ï¼š</p>
<ol>
<li><code>ConstraintHelper</code> æ„é€ å‡½æ•° - æŸ¥çœ‹ <code>builtinConstraints</code> çš„å†…å®¹</li>
<li><code>getAllValidatorClasses</code> - æŸ¥çœ‹æŸ¥æ‰¾ç»“æœ</li>
<li><code>findValidatorClasses</code> - æŸ¥çœ‹ <code>matchingValidatorClasses</code> çš„æ„å»º</li>
<li><code>createAndInitializeValidator</code> - æŸ¥çœ‹ <code>validatorClass</code> æ˜¯å¦ä¸º null</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dce800a6b9f4df399fcab760516837b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOeWPt-i-vuS6ug==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764516380&amp;x-signature=cKfjRAcm80KkY63ndjenUIKeA0s%3D" alt="" loading="lazy"/></p>
<p>ä»è°ƒè¯•æˆªå›¾å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼š</p>
<ol>
<li>
<p><strong>æœ‰ <code>javax.validation.constraints.NotNull</code></strong></p>
<ul>
<li>è¿™æ˜¯æ ‡å‡† Bean Validation æ³¨è§£</li>
<li>Hibernate Validator 5.x æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>æœ‰ <code>org.hibernate.validator.constraints.NotBlank</code></strong></p>
<ul>
<li>æ³¨æ„åŒ…åï¼è¿™æ˜¯ <code>org.hibernate.validator.constraints</code></li>
<li>ä¸æ˜¯æ ‡å‡†çš„ <code>javax.validation.constraints</code></li>
<li>è¿™æ˜¯ Hibernate Validator è‡ªå·±æ‰©å±•çš„æ³¨è§£ï¼Œä¸æ˜¯ Bean Validation 2.0 æ ‡å‡†</li>
</ul>
</li>
<li>
<p><strong>æ²¡æœ‰ <code>javax.validation.constraints.NotBlank</code></strong></p>
<ul>
<li>æ ‡å‡†çš„ Bean Validation 2.0 <code>@NotBlank</code> ä¸åœ¨æ˜ å°„è¡¨ä¸­</li>
<li>æ‰€ä»¥ä½¿ç”¨ <code>javax.validation.constraints.NotBlank</code> ä¼šæ‰¾ä¸åˆ°éªŒè¯å™¨</li>
</ul>
</li>
</ol>
<p><strong>ä¸¤ä¸ªä¸åŒçš„ @NotBlank</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â âŒÂ åœ¨Â HibernateÂ ValidatorÂ 5.xÂ ä¸­ä¸æ”¯æŒï¼ˆBeanÂ ValidationÂ 2.0Â æ ‡å‡†ï¼‰</span>
<span class="hljs-keyword">import</span>Â javax.<span class="hljs-property">validation</span>.<span class="hljs-property">constraints</span>.<span class="hljs-property">NotBlank</span>;

<span class="hljs-meta">@NotBlank</span>Â Â <span class="hljs-comment">//Â æŠ›å‡ºå¼‚å¸¸ï¼šæ‰¾ä¸åˆ°éªŒè¯å™¨</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-title class_">String</span>Â keywords;
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â åœ¨Â HibernateÂ ValidatorÂ 5.xÂ ä¸­æ”¯æŒï¼ˆHibernateÂ è‡ªå®šä¹‰æ‰©å±•ï¼‰</span>
<span class="hljs-keyword">import</span>Â org.<span class="hljs-property">hibernate</span>.<span class="hljs-property">validator</span>.<span class="hljs-property">constraints</span>.<span class="hljs-property">NotBlank</span>;

<span class="hljs-meta">@NotBlank</span>Â Â <span class="hljs-comment">//Â å¯ä»¥æ­£å¸¸å·¥ä½œ</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-title class_">String</span>Â keywords;
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ª @NotBlankï¼Ÿ</strong></p>
<ul>
<li><strong>Hibernate Validator 5.x æ—¶ä»£</strong>ï¼š<code>@NotBlank</code> æ˜¯ Hibernate çš„è‡ªå®šä¹‰æ‰©å±•ï¼Œä½äº <code>org.hibernate.validator.constraints</code> åŒ…</li>
<li><strong>Bean Validation 2.0 æ—¶ä»£</strong>ï¼š<code>@NotBlank</code> è¢«çº³å…¥æ ‡å‡†è§„èŒƒï¼Œä½äº <code>javax.validation.constraints</code> åŒ…</li>
<li><strong>Hibernate Validator 6.x</strong>ï¼šåŒæ—¶æ”¯æŒä¸¤ä¸ªåŒ…çš„ <code>@NotBlank</code>ï¼Œå»ºè®®ä½¿ç”¨æ ‡å‡†åŒ…</li>
</ul>
<h2 data-id="heading-8">è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-9">æ–¹æ¡ˆä¸€ï¼šæ£€æŸ¥å¹¶æ·»åŠ ä¾èµ–ï¼ˆæ¨èï¼‰</h3>
<p>ç¡®ä¿ <code>pom.xml</code> ä¸­åŒ…å«æ­£ç¡®ç‰ˆæœ¬çš„ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!--Â BeanÂ ValidationÂ APIÂ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.validation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>validation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.1.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!--Â HibernateÂ ValidatorÂ å®ç°Â --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.hibernate.validator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hibernate-validator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.2.5.Final<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>æ³¨æ„ç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li><code>validation-api 2.0.x</code> å¯¹åº” <code>hibernate-validator 6.x</code></li>
<li><code>validation-api 1.1.x</code> å¯¹åº” <code>hibernate-validator 5.x</code>ï¼ˆä¸æ”¯æŒ @NotBlankï¼‰</li>
</ul>
<h3 data-id="heading-10">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Spring Boot Starter</h3>
<p>å¦‚æœæ˜¯ Spring Boot é¡¹ç›®ï¼Œæ¨èä½¿ç”¨å®˜æ–¹ starterï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>è¿™ä¸ª starter ä¼šè‡ªåŠ¨å¼•å…¥å…¼å®¹ç‰ˆæœ¬çš„ <code>validation-api</code> å’Œ <code>hibernate-validator</code>ã€‚</p>
<h3 data-id="heading-11">æ–¹æ¡ˆä¸‰ï¼šé™çº§ä½¿ç”¨ @NotEmpty æˆ– @NotNull + @Size</h3>
<p>å¦‚æœæš‚æ—¶æ— æ³•å‡çº§ä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨æ—§ç‰ˆæœ¬æ”¯æŒçš„æ³¨è§£ç»„åˆï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">//Â æ–¹å¼1ï¼šä½¿ç”¨Â @NotEmptyï¼ˆBeanÂ ValidationÂ 2.0ï¼‰</span>
<span class="hljs-variable">@NotEmpty</span>
privateÂ StringÂ keywords;

<span class="hljs-comment">//Â æ–¹å¼2ï¼šä½¿ç”¨ç»„åˆæ³¨è§£ï¼ˆBeanÂ ValidationÂ 1.1ï¼‰</span>
<span class="hljs-variable">@NotNull</span>
<span class="hljs-variable">@Size</span>(minÂ =Â <span class="hljs-number">1</span>)
privateÂ StringÂ keywords;
</code></pre>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>è¿™æ¬¡è¸©å‘è®©æˆ‘æ·±åˆ»ç†è§£äº†ï¼š</p>
<ol>
<li><strong>æ³¨è§£å®šä¹‰å’Œæ³¨è§£å®ç°æ˜¯åˆ†ç¦»çš„</strong>ï¼švalidation-api åªæä¾›è§„èŒƒï¼Œhibernate-validator æä¾›å®ç°</li>
<li><strong>ç‰ˆæœ¬åŒ¹é…å¾ˆå…³é”®</strong>ï¼šBean Validation 1.1 ä¸æ”¯æŒ @NotBlank</li>
<li><strong>ä¾èµ–ç®¡ç†è¦è§„èŒƒ</strong>ï¼šä½¿ç”¨ Spring Boot Starter å¯ä»¥é¿å…å¾ˆå¤šç‰ˆæœ¬å†²çªé—®é¢˜</li>
<li><strong>é”™è¯¯ä¿¡æ¯è¦ä»”ç»†è¯»</strong>ï¼š<code>No validator could be found</code> å…¶å®å·²ç»æ˜ç¡®æŒ‡å‡ºæ˜¯ç¼ºå°‘éªŒè¯å™¨å®ç°</li>
</ol>
<p>æ™®é€šå…¬å¸å¼€å‘ç¡®å®éœ€è¦æ³¨æ„è¿™äº›ç»†èŠ‚ï¼Œæ¯•ç«Ÿæ²¡æœ‰ä¸“é—¨çš„æ¶æ„ç»„æ¥ç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ï¼Œè¸©è¿‡å‘æ‰èƒ½è®°å¾—æ›´ç‰¢ã€‚</p>
<hr/>
<p><strong>ç›¸å…³èµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbeanvalidation.org%2F2.0%2F" target="_blank" title="https://beanvalidation.org/2.0/" ref="nofollow noopener noreferrer">Bean Validation 2.0 è§„èŒƒ</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhibernate.org%2Fvalidator%2F" target="_blank" title="https://hibernate.org/validator/" ref="nofollow noopener noreferrer">Hibernate Validator æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspring.io%2Fguides%2Fgs%2Fvalidating-form-input%2F" target="_blank" title="https://spring.io/guides/gs/validating-form-input/" ref="nofollow noopener noreferrer">Spring Boot Validation æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£]]></title>    <link>https://juejin.cn/post/7575412016404742154</link>    <guid>https://juejin.cn/post/7575412016404742154</guid>    <pubDate>2025-11-23T15:36:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575412016404742154" data-draft-id="7575438636331434035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£"/> <meta itemprop="keywords" content="Spring Boot"/> <meta itemprop="datePublished" content="2025-11-23T15:36:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å…ƒYäº¨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å…ƒYäº¨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T15:36:52.000Z" title="Sun Nov 23 2025 15:36:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<h2 data-id="heading-0">RuoYi æ¡†æ¶å®æˆ˜ç¬”è®°ï¼šæ·±å…¥è§£æ @DataScope æ•°æ®æƒé™æ³¨è§£</h2>
<h3 data-id="heading-1">1. å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦ @DataScopeï¼Ÿ</h3>
<p>åœ¨ä¼ä¸šçº§åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæƒé™æ§åˆ¶é€šå¸¸åˆ†ä¸ºä¸¤ä¸ªç»´åº¦ï¼š</p>
<ul>
<li><strong>åŠŸèƒ½æƒé™</strong>ï¼šæ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›èœå•ã€ç‚¹å‡»å“ªäº›æŒ‰é’®ï¼ˆé€šå¸¸é€šè¿‡ RBAC æ¨¡å‹ + <code>@PreAuthorize</code> å®ç°ï¼‰ã€‚</li>
<li><strong>æ•°æ®æƒé™</strong>ï¼šæ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°<strong>å“ªå‡ è¡Œæ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼šé”€å”®æ€»ç›‘èƒ½çœ‹å…¨å…¬å¸çš„è®¢å•ï¼Œéƒ¨é—¨ç»ç†åªèƒ½çœ‹æœ¬éƒ¨é—¨çš„è®¢å•ï¼Œæ™®é€šé”€å”®åªèƒ½çœ‹è‡ªå·±çš„è®¢å•ã€‚</li>
</ul>
<p>å¦‚æœè¦åœ¨ä¸šåŠ¡ä»£ç ä¸­é€šè¿‡ <code>if (user.isManager()) { ... }</code> è¿™ç§æ–¹å¼æ‰‹åŠ¨æ‹¼æ¥ SQLï¼Œä»£ç å°†å˜å¾—æå…¶è‡ƒè‚¿ä¸”éš¾ä»¥ç»´æŠ¤ã€‚RuoYi æ¡†æ¶æä¾›çš„ <code>@DataScope</code> æ³¨è§£ï¼Œæ­£æ˜¯åˆ©ç”¨ <strong>AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰</strong> æŠ€æœ¯ï¼Œä¼˜é›…åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-2">2. æ ¸å¿ƒåŸç†</h3>
<p><code>@DataScope</code> çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>â€œåœ¨ SQL æ‰§è¡Œå‰ï¼Œæ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·çš„è§’è‰²æƒé™ï¼ŒåŠ¨æ€æ‹¼æ¥ SQL è¿‡æ»¤æ¡ä»¶ã€‚â€</strong></p>
<h4 data-id="heading-3">å·¥ä½œæµç¨‹</h4>
<ol>
<li><strong>AOP æ‹¦æˆª</strong>ï¼š<code>DataScopeAspect</code> åˆ‡é¢æ‹¦æˆªæ‰€æœ‰æ ‡è®°äº† <code>@DataScope</code> çš„æ–¹æ³•ã€‚</li>
<li><strong>è·å–è§’è‰²</strong>ï¼šè·å–å½“å‰ç™»å½•ç”¨æˆ·åŠå…¶ç»‘å®šçš„è§’è‰²ä¿¡æ¯ã€‚</li>
<li><strong>ç”Ÿæˆ SQL</strong>ï¼šæ ¹æ®è§’è‰²é…ç½®çš„â€œæ•°æ®èŒƒå›´â€ï¼ˆData Scopeï¼‰ï¼Œç”Ÿæˆä¸€æ®µ SQL ç‰‡æ®µï¼ˆå¦‚ <code>AND dept_id = 100</code>ï¼‰ã€‚</li>
<li><strong>å‚æ•°æ³¨å…¥</strong>ï¼šå°†è¿™æ®µ SQL æ³¨å…¥åˆ°å‚æ•°å¯¹è±¡ï¼ˆéœ€ç»§æ‰¿ <code>BaseEntity</code>ï¼‰çš„ <code>params</code> å±æ€§ä¸­ã€‚</li>
<li><strong>MyBatis æ‰§è¡Œ</strong>ï¼šåœ¨ XML ä¸­é€šè¿‡ <code>${params.dataScope}</code> å°†è¿‡æ»¤æ¡ä»¶æ‹¼æ¥åˆ°ä¸» SQL åé¢ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-4">3. æ”¯æŒçš„æ•°æ®æƒé™æ¨¡å¼</h3>
<p>RuoYi åœ¨â€œè§’è‰²ç®¡ç†â€ä¸­é»˜è®¤æ”¯æŒ 5 ç§æ•°æ®èŒƒå›´ï¼Œåº•å±‚é€»è¾‘å¦‚ä¸‹ï¼š</p>









































<table><thead><tr><th align="left">æƒé™åç§°</th><th align="left">å¯¹åº”ä»£ç </th><th align="left">é€»è¾‘æè¿°</th><th align="left">SQL ç¤ºä¾‹ç‰‡æ®µ</th></tr></thead><tbody><tr><td align="left"><strong>å…¨éƒ¨æ•°æ®æƒé™</strong></td><td align="left"><code>DATA_SCOPE_ALL</code></td><td align="left">ä¸è¿›è¡Œè¿‡æ»¤ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰æ•°æ®</td><td align="left">(æ— æ‹¼æ¥)</td></tr><tr><td align="left"><strong>è‡ªå®šæ•°æ®æƒé™</strong></td><td align="left"><code>DATA_SCOPE_CUSTOM</code></td><td align="left">æ ¹æ®è§’è‰²é…ç½®çš„éƒ¨é—¨åˆ—è¡¨è¿‡æ»¤</td><td align="left"><code>OR d.dept_id IN (SELECT dept_id FROM sys_role_dept WHERE role_id = X)</code></td></tr><tr><td align="left"><strong>éƒ¨é—¨æ•°æ®æƒé™</strong></td><td align="left"><code>DATA_SCOPE_DEPT</code></td><td align="left">ä»…æŸ¥çœ‹æœ¬éƒ¨é—¨æ•°æ®</td><td align="left"><code>OR d.dept_id = 101</code></td></tr><tr><td align="left"><strong>éƒ¨é—¨åŠä»¥ä¸‹</strong></td><td align="left"><code>DATA_SCOPE_DEPT_AND_CHILD</code></td><td align="left">æŸ¥çœ‹æœ¬éƒ¨é—¨åŠæ‰€æœ‰å­éƒ¨é—¨æ•°æ®</td><td align="left"><code>OR d.dept_id IN (SELECT dept_id FROM sys_dept WHERE find_in_set(101, ancestors))</code></td></tr><tr><td align="left"><strong>ä»…æœ¬äººæ•°æ®</strong></td><td align="left"><code>DATA_SCOPE_SELF</code></td><td align="left">ä»…æŸ¥çœ‹è‡ªå·±åˆ›å»ºçš„æ•°æ®</td><td align="left"><code>OR u.user_id = 1</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">4. ä½¿ç”¨æŒ‡å—ï¼ˆä¸‰æ­¥èµ°ï¼‰</h3>
<h4 data-id="heading-6">ç¬¬ä¸€æ­¥ï¼šService å±‚æ·»åŠ æ³¨è§£</h4>
<p>åœ¨éœ€è¦è¿‡æ»¤æ•°æ®çš„ä¸šåŠ¡æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ã€‚</p>
<ul>
<li><strong><code>deptAlias</code></strong>ï¼šæŒ‡å®š SQL ä¸­éƒ¨é—¨è¡¨çš„åˆ«åï¼ˆé»˜è®¤ <code>d</code>ï¼‰ã€‚</li>
<li><strong><code>userAlias</code></strong>ï¼šæŒ‡å®š SQL ä¸­ç”¨æˆ·è¡¨çš„åˆ«åï¼ˆé»˜è®¤ <code>u</code>ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysUserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISysUserService</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-comment">// å‘Šè¯‰åˆ‡é¢ï¼šSQLé‡Œéƒ¨é—¨è¡¨åˆ«åæ˜¯ dï¼Œç”¨æˆ·è¡¨åˆ«åæ˜¯ u</span>
    <span class="hljs-meta">@DataScope(deptAlias = "d", userAlias = "u")</span> 
    <span class="hljs-keyword">public</span> List&lt;SysUser&gt; <span class="hljs-title function_">selectUserList</span><span class="hljs-params">(SysUser user)</span> {
        <span class="hljs-keyword">return</span> userMapper.selectUserList(user);
    }
}
</code></pre>
<h4 data-id="heading-7">ç¬¬äºŒæ­¥ï¼šEntity ç±»ç»§æ‰¿ BaseEntity</h4>
<p>æŸ¥è¯¢å‚æ•°å¯¹è±¡ï¼ˆå¦‚ <code>SysUser</code>ï¼‰å¿…é¡»ç»§æ‰¿ <code>BaseEntity</code>ï¼Œå› ä¸ºåˆ‡é¢æ˜¯å°†ç”Ÿæˆçš„ SQL å­˜å…¥ <code>BaseEntity</code> çš„ <code>params</code> map ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseEntity</span> {
    <span class="hljs-comment">// ... å±æ€§å®šä¹‰</span>
}
</code></pre>
<h4 data-id="heading-8">ç¬¬ä¸‰æ­¥ï¼šMapper XML æ‹¼æ¥ SQL</h4>
<p>åœ¨ MyBatis çš„ XML æ–‡ä»¶ä¸­ï¼Œå°†ç”Ÿæˆçš„ SQL ç‰‡æ®µæ‹¼æ¥åˆ° <code>WHERE</code> å­å¥çš„æœ€åã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šå¿…é¡»ä½¿ç”¨ <code>$</code> ç¬¦å·ï¼ˆæ–‡æœ¬æ›¿æ¢ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨ <code>#</code>ï¼ˆé¢„ç¼–è¯‘ï¼‰ã€‚</p>
</blockquote>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectUserList"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"SysUser"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"SysUserResult"</span>&gt;</span>
    SELECT u.user_id, u.dept_id, u.nick_name, d.dept_name
    FROM sys_user u
    LEFT JOIN sys_dept d ON u.dept_id = d.dept_id
    WHERE u.del_flag = '0'
    
    <span class="hljs-comment">&lt;!-- å…³é”®ç‚¹ï¼šåŠ¨æ€æ‹¼æ¥æ•°æ®æƒé™è¿‡æ»¤ SQL --&gt;</span>
    ${params.dataScope}
    
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">5. é¿å‘æŒ‡å—ä¸æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>
<p><strong>åˆ«åå¿…é¡»åŒ¹é…</strong></p>
<ul>
<li>æ³¨è§£ä¸­çš„ <code>deptAlias="d"</code> å¿…é¡»ä¸ XML ä¸­ <code>LEFT JOIN sys_dept d</code> çš„åˆ«åä¸¥æ ¼ä¸€è‡´ã€‚å¦‚æœ XML ä¸­å†™çš„æ˜¯ <code>LEFT JOIN sys_dept sd</code>ï¼Œåˆ™æ³¨è§£å¿…é¡»æ”¹ä¸º <code>deptAlias="sd"</code>ï¼Œå¦åˆ™ä¼šæŠ¥ <code>Unknown column 'd.dept_id'</code> é”™è¯¯ã€‚</li>
</ul>
</li>
<li>
<p><strong>è¶…çº§ç®¡ç†å‘˜ç‰¹æƒ</strong></p>
<ul>
<li>å¦‚æœæ˜¯è¶…çº§ç®¡ç†å‘˜ï¼ˆ<code>admin</code> æˆ–æ‹¥æœ‰æ‰€æœ‰æƒé™çš„è§’è‰²ï¼‰ï¼Œåˆ‡é¢é€»è¾‘é€šå¸¸ä¼šç›´æ¥è·³è¿‡ï¼Œä¸æ‹¼æ¥ä»»ä½• SQLï¼Œä»è€Œæ‹¥æœ‰æŸ¥çœ‹æ‰€æœ‰æ•°æ®çš„æƒé™ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®è¡¨å…³è”</strong></p>
<ul>
<li>å¦‚æœè¦ä½¿ç”¨éƒ¨é—¨æƒé™ï¼Œä¸»æŸ¥è¯¢è¡¨å¿…é¡»åŒ…å« <code>dept_id</code> æˆ–è€…å…³è”äº† <code>sys_dept</code> è¡¨ã€‚</li>
<li>å¦‚æœè¦ä½¿ç”¨â€œä»…æœ¬äººâ€æƒé™ï¼Œä¸»æŸ¥è¯¢è¡¨å¿…é¡»åŒ…å« <code>user_id</code> æˆ–è€…å…³è”äº† <code>sys_user</code> è¡¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‚æ•°å¯¹è±¡é™åˆ¶</strong></p>
<ul>
<li>å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ DTO å¯¹è±¡ä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼ŒåŠ¡å¿…ç¡®ä¿å®ƒç»§æ‰¿äº† <code>BaseEntity</code>ï¼Œæˆ–è€…ä½ è‡ªå·±æ‰‹åŠ¨åœ¨ DTO ä¸­æ·»åŠ  <code>Map&lt;String, Object&gt; params</code> å­—æ®µï¼Œå¦åˆ™åˆ‡é¢æ— æ³•æ³¨å…¥ SQLã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤šè¡¨è¿æ¥æ—¶çš„æ­§ä¹‰</strong></p>
<ul>
<li>å¦‚æœå¤šä¸ªè¡¨éƒ½æœ‰ <code>dept_id</code> å­—æ®µï¼ŒåŠ¡å¿…é€šè¿‡ <code>deptAlias</code> æ˜ç¡®æŒ‡å®šä½¿ç”¨å“ªå¼ è¡¨çš„å­—æ®µè¿›è¡Œè¿‡æ»¤ï¼Œé˜²æ­¢ SQL å­—æ®µæ­§ä¹‰ï¼ˆAmbiguous columnï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-10">6. æ€»ç»“</h3>
<p><code>@DataScope</code> æ˜¯ RuoYi æ¡†æ¶ä¸­è§£å†³æ•°æ®éš”ç¦»é—®é¢˜çš„â€œç¥å…µåˆ©å™¨â€ã€‚å®ƒé€šè¿‡ <strong>è§£è€¦ä¸šåŠ¡ä»£ç ä¸æƒé™é€»è¾‘</strong>ï¼Œè®©å¼€å‘è€…åªéœ€å…³æ³¨ SQL å…³è”å…³ç³»ï¼Œè€Œæ— éœ€å…³å¿ƒå¤æ‚çš„æƒé™åˆ¤æ–­ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLæ€§èƒ½ä¼˜åŒ–å¤„ç†]]></title>    <link>https://juejin.cn/post/7575119254314303514</link>    <guid>https://juejin.cn/post/7575119254314303514</guid>    <pubDate>2025-11-23T13:33:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575119254314303514" data-draft-id="7575119254313467930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLæ€§èƒ½ä¼˜åŒ–å¤„ç†"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-11-23T13:33:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ä¸‰çš„å¼€å‘æ—¥è®°"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLæ€§èƒ½ä¼˜åŒ–å¤„ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ä¸‰çš„å¼€å‘æ—¥è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T13:33:34.000Z" title="Sun Nov 23 2025 13:33:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âœ… <strong>ä¸€ã€æ¨èçš„ my.cnfï¼ˆç”Ÿäº§ç¯å¢ƒä¼˜åŒ–æ¨¡æ¿ï¼‰</strong></h2>
<blockquote>
<p>âš ï¸ ä½ åªéœ€è¦ä¿®æ”¹ï¼š</p>
<ul>
<li>å†…å­˜å¤§å°ï¼ˆæœåŠ¡å™¨å†…å­˜ 16G / 32G / 64Gï¼‰</li>
<li>ç£ç›˜è·¯å¾„</li>
<li>InnoDB buffer pool size</li>
</ul>
</blockquote>
<p>ä¸‹é¢çš„é…ç½®å‡è®¾ä½ çš„æœåŠ¡å™¨ <strong>16GB RAM</strong></p>
<pre><code class="hljs language-js" lang="js">[client]
<span class="hljs-keyword">default</span>-character-set = utf8mb4

[mysql]
<span class="hljs-keyword">default</span>-character-set = utf8mb4

[mysqld]
# ========== åŸºç¡€è®¾ç½® ==========
user = mysql
port = <span class="hljs-number">3306</span>
basedir = <span class="hljs-regexp">/usr/</span>local/mysql
datadir = <span class="hljs-regexp">/data/my</span>sql
pid-file = <span class="hljs-regexp">/data/my</span>sql/mysqld.<span class="hljs-property">pid</span>
socket = <span class="hljs-regexp">/data/my</span>sql/mysql.<span class="hljs-property">sock</span>
character-set-server = utf8mb4
skip-name-resolve      # ç¦æ­¢ <span class="hljs-variable constant_">DNS</span> åæŸ¥ï¼ˆæ€§èƒ½æ˜æ˜¾æå‡ï¼‰
sql_mode = <span class="hljs-variable constant_">STRICT_TRANS_TABLES</span>,<span class="hljs-variable constant_">NO_ENGINE_SUBSTITUTION</span>
table_open_cache = <span class="hljs-number">4096</span>
open_files_limit = <span class="hljs-number">8192</span>
# ========== <span class="hljs-title class_">InnoDB</span> é‡è¦ä¼˜åŒ– ==========
innodb_buffer_pool_size = 8G     # 16G æœºå™¨è®¾ç½®ä¸º 8Gï¼ˆ<span class="hljs-number">50</span>% å†…å­˜ï¼‰
innodb_buffer_pool_instances = <span class="hljs-number">8</span> # buffer pool åˆ†ç‰‡ï¼ˆæ¯Gä¸€ä¸ªæ¯”è¾ƒåˆé€‚ï¼‰
innodb_log_file_size = 1G        # redo log å•ä¸ªå¤§å°ï¼Œèƒ½å‡å°‘ checkpoint å¼€é”€
innodb_log_buffer_size = 64M     # å†™å¯†é›†åœºæ™¯å»ºè®® 64M~256M
innodb_flush_log_at_trx_commit = <span class="hljs-number">1</span> # å¼ºä¸€è‡´æ€§ï¼ˆå»ºè®®ç”Ÿäº§é»˜è®¤ <span class="hljs-number">1</span>ï¼‰
# å»ºè®®ï¼šé«˜ <span class="hljs-variable constant_">QPS</span> åœºæ™¯å¯æ”¹ä¸º <span class="hljs-number">2</span>ï¼ˆæ€§èƒ½æå‡<span class="hljs-number">10</span>å€ï¼Œä¸¢äº‹åŠ¡ <span class="hljs-string">"1s å†…"</span>ï¼‰
innodb_flush_method = <span class="hljs-variable constant_">O_DIRECT</span>   # é¿å…åŒç¼“å­˜
innodb_file_per_table = <span class="hljs-number">1</span>        # å¼ºçƒˆæ¨èï¼Œè¡¨ç‹¬ç«‹æ–‡ä»¶
innodb_io_capacity = <span class="hljs-number">4000</span>        # <span class="hljs-variable constant_">SSD</span> å»ºè®® <span class="hljs-number">2000</span>~<span class="hljs-number">8000</span>
innodb_io_capacity_max = <span class="hljs-number">8000</span>

# ========== è¿æ¥ç®¡ç† ==========
max_connections = <span class="hljs-number">2000</span>            # å¤§é¡¹ç›®éœ€è¦æ›´é«˜è¿æ¥æ•°
max_connect_errors = <span class="hljs-number">10</span>
wait_timeout = <span class="hljs-number">600</span>                # ç©ºé—²è¿æ¥è¶…æ—¶
interactive_timeout = <span class="hljs-number">600</span>

# ========== æŸ¥è¯¢ç¼“å­˜ç›¸å…³ï¼ˆ<span class="hljs-title class_">MySQL</span> <span class="hljs-number">5.7</span> æ‰æœ‰ï¼‰ ==========
query_cache_type = <span class="hljs-number">0</span>
query_cache_size = <span class="hljs-number">0</span>

# ========== æ—¥å¿—è®¾ç½® ==========
log_error = <span class="hljs-regexp">/data/my</span>sql/mysql-error.<span class="hljs-property">log</span>
slow_query_log = <span class="hljs-number">1</span>
slow_query_log_file = <span class="hljs-regexp">/data/my</span>sql/mysql-slow.<span class="hljs-property">log</span>
long_query_time = <span class="hljs-number">1</span>               # &gt;<span class="hljs-number">1</span> ç§’è®°å½•æ…¢ <span class="hljs-variable constant_">SQL</span>
log_queries_not_using_indexes = <span class="hljs-number">0</span> # ä¸å»ºè®®å¼€å¯ï¼Œä¼šçˆ†æ—¥å¿—

# ========== ä¸´æ—¶è¡¨ä¼˜åŒ– ==========
tmp_table_size = 256M
max_heap_table_size = 256M

# ========== æ’åº &amp; <span class="hljs-variable constant_">JOIN</span> æ€§èƒ½ ==========
sort_buffer_size = 4M
join_buffer_size = 4M
read_buffer_size = 4M
read_rnd_buffer_size = 4M

# ========== <span class="hljs-title class_">Binlog</span> ==========
server-id = <span class="hljs-number">1</span>
log_bin = mysql-bin
binlog_format = row
sync_binlog = <span class="hljs-number">1</span>      # æœ€å®‰å…¨ï¼Œæ€§èƒ½å¼±ï¼›é«˜ <span class="hljs-variable constant_">QPS</span> å¯è®¾ä¸º <span class="hljs-number">100</span>~<span class="hljs-number">1000</span>
expire_logs_days = <span class="hljs-number">7</span>
</code></pre>
<ul>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>innodb_flush_method</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> æ§åˆ¶æ•°æ®å’Œæ—¥å¿—å†™å…¥æ–‡ä»¶çš„æ–¹å¼ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ul>
<li>åœ¨ <strong>Linux/Unix</strong> ç³»ç»Ÿä¸Šï¼Œæ¨èä½¿ç”¨ <strong><code>O_DIRECT</code></strong>ã€‚å®ƒç»•è¿‡æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œç›´æ¥å†™å…¥ç£ç›˜ï¼Œé¿å…åŒé‡ç¼“å­˜ï¼Œæé«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</li>
<li><strong>ç¤ºä¾‹:</strong> <code>innodb_flush_method = O_DIRECT</code></li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>innodb_flush_log_at_trx_commit</code></p>
</li>
<li>
<p><strong>å–å€¼ä¸å«ä¹‰:</strong></p>
<ul>
<li><strong><code>0</code> (æ€§èƒ½æœ€é«˜):</strong> æ¯ç§’å†™å…¥å¹¶åˆ·æ–°ä¸€æ¬¡æ—¥å¿—ã€‚æœ‰ä¸¢å¤±ä¸€ç§’æ•°æ®çš„é£é™©ã€‚</li>
<li><strong><code>1</code> (é»˜è®¤ï¼Œæœ€å®‰å…¨):</strong> <strong>æ¯æ¬¡äº‹åŠ¡æäº¤</strong>éƒ½å†™å…¥å¹¶åˆ·æ–°æ—¥å¿—åˆ°ç£ç›˜ã€‚<strong>æœ€å®‰å…¨ï¼Œä½† I/O å¼€é”€æœ€å¤§</strong>ã€‚</li>
<li><strong><code>2</code> (æŠ˜ä¸­):</strong> æ¯æ¬¡æäº¤å†™å…¥æ—¥å¿—ï¼Œä½†åªæ¯ç§’åˆ·æ–°ä¸€æ¬¡åˆ°ç£ç›˜ã€‚æ¯” <code>1</code> å¿«ï¼Œæ¯” <code>0</code> å®‰å…¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>sort_buffer_size</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> ç”¨äºå¤„ç†éœ€è¦æ’åºçš„æŸ¥è¯¢ï¼ˆå¦‚ <code>ORDER BY</code> æˆ– <code>GROUP BY</code>ï¼‰ã€‚æ¯ä¸ªéœ€è¦æ’åºçš„è¿æ¥éƒ½ä¼šåˆ†é…è¿™ä¸ªå¤§å°çš„å†…å­˜ã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ul>
<li><strong>ä¸åº”è®¾ç½®å¾—å¤ªå¤§</strong>ï¼Œå› ä¸ºå®ƒåˆ†é…ç»™<strong>æ¯ä¸ªä¼šè¯</strong>ã€‚</li>
<li>é€šå¸¸è®¾ç½®ä¸º <strong>1MB åˆ° 2MB</strong>ã€‚å¦‚æœæŸ¥è¯¢æ¶‰åŠå¤§é‡æ’åºï¼Œå¯ä»¥é€‚å½“æé«˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>join_buffer_size</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> ç”¨äºè¿æ¥ï¼ˆJOINï¼‰æ“ä½œä¸­æ— æ³•ä½¿ç”¨ç´¢å¼•æ—¶çš„ç¼“å†²åŒºã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong></p>
<ul>
<li>å’Œ <code>sort_buffer_size</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯æ¯ä¸ªè¿æ¥åˆ†é…ã€‚</li>
<li>é€šå¸¸è®¾ç½®ä¸º <strong>128KB åˆ° 1MB</strong>ã€‚</li>
<li><strong>ç¤ºä¾‹:</strong> <code>join_buffer_size = 512K</code></li>
</ul>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong> <code>table_open_cache</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> è®¾ç½®è¡¨æ‰“å¼€ç¼“å­˜çš„å¤§å°ï¼Œå‡å°‘æ‰“å¼€è¡¨æ—¶çš„ç£ç›˜I/O</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong>: è®¾ç½®ä¸º4096ä»¥æé«˜è¡¨æ‰“å¼€é€Ÿåº¦ã€‚</p>
</li>
<li>
<p><strong>é…ç½®é¡¹:</strong>  <code>open_files_limit</code></p>
</li>
<li>
<p><strong>ä½œç”¨:</strong> å†³å®šäº† MySQL çš„æ–‡ä»¶ I/O èƒ½åŠ›çš„è¾¹ç•Œ</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å»ºè®®:</strong> é€šå¸¸å»ºè®®å°† open_files_limit è®¾ç½®ä¸º table_open_cache å€¼çš„ ä¸¤å€æˆ–æ›´é«˜ï¼Œå¹¶é¢„ç•™ä¸€äº›ç©ºé—´ç»™å…¶ä»–æ—¥å¿—å’Œè¿æ¥ä½¿ç”¨ã€‚</p>
</li>
</ul>
<blockquote>
<ul>
<li>æ“ä½œç³»ç»Ÿé™åˆ¶ï¼šopen_files_limit çš„å€¼ä¸èƒ½è¶…è¿‡æ“ä½œç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·æˆ–æ•´ä¸ªç³»ç»Ÿè®¾ç½®çš„ç¡¬æ€§æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼ˆé€šè¿‡ ulimit -Hn å‘½ä»¤æŸ¥çœ‹ï¼‰ã€‚å¦‚æœéœ€è¦è®¾ç½®æ›´å¤§çš„å€¼ï¼Œæ‚¨å¿…é¡»é¦–å…ˆåœ¨æ“ä½œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ /etc/security/limits.confï¼‰ä¸­è°ƒæ•´é™åˆ¶ã€‚</li>
</ul>
</blockquote>
<h2 data-id="heading-1">âœ… <strong>äºŒã€å…³é”®ä¼˜åŒ–å‚æ•°è¯¦ç»†è§£é‡Šï¼ˆå¿…é¡»ç†è§£ï¼‰</strong></h2>
<p>ä»¥ä¸‹æ˜¯æ€§èƒ½æå‡æœ€å¤§çš„ä¸€äº›é…ç½®ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>1ï¼‰innodb_buffer_pool_sizeï¼ˆæœ€é‡è¦ï¼‰</strong></h3>
<blockquote>
<p>InnoDB çš„æ•°æ®ã€ç´¢å¼•éƒ½åœ¨è¿™é‡Œç¼“å­˜ã€‚<br/>
<strong>ä¸€èˆ¬è®¾ç½®ä¸ºæœºå™¨å†…å­˜ 50%ï½70%ã€‚</strong></p>
</blockquote>





















<table><thead><tr><th>æœåŠ¡å™¨å†…å­˜</th><th>å»ºè®®è®¾ç½®</th></tr></thead><tbody><tr><td>8GB</td><td>4Gâ€“5G</td></tr><tr><td>16GB</td><td>8Gâ€“12G</td></tr><tr><td>32GB</td><td>16Gâ€“26G</td></tr></tbody></table>
<h3 data-id="heading-3"><strong>2ï¼‰innodb_log_file_sizeï¼ˆäº‹åŠ¡å†™æ€§èƒ½å…³é”®ï¼‰</strong></h3>
<ul>
<li>é»˜è®¤åªæœ‰å‡ å MBï¼Œéå¸¸ä½ï¼</li>
<li>å»ºè®®æ”¹æˆï¼š</li>
</ul>
<pre><code class="hljs language-js" lang="js">1G ~ 4Gï¼ˆå–å†³äºä½ çš„å†™å…¥é‡ï¼‰
</code></pre>
<p>å¥½å¤„ï¼šå‡å°‘ checkpointï¼Œæå‡å†™æ€§èƒ½ï¼ˆç”µå•†é€€æ¬¾ / è®¢å•é«˜å¹¶å‘å¾ˆå…³é”®ï¼‰</p>
<h3 data-id="heading-4">3ï¼‰innodb_flush_log_at_trx_commitï¼ˆæœ€é‡è¦çš„æ€§èƒ½ä¸å®‰å…¨å¼€å…³ï¼‰</h3>





























<table><thead><tr><th>å€¼</th><th>è¯´æ˜</th><th>æ€§èƒ½</th><th>é£é™©</th></tr></thead><tbody><tr><td>1ï¼ˆé»˜è®¤ï¼‰</td><td>æ¯æ¬¡äº‹åŠ¡æäº¤éƒ½å†™ç£ç›˜</td><td>æœ€æ…¢</td><td>æœ€å®‰å…¨</td></tr><tr><td>2</td><td>å†™ OS bufferï¼Œ1 ç§’åˆ·ç›˜</td><td>â­ å¾ˆå¿«</td><td>å´©æºƒä¸¢å¤± 1 ç§’æ•°æ®</td></tr><tr><td>0</td><td>å»¶è¿Ÿå†™æ—¥å¿—</td><td>â­ è¶…å¿«</td><td>å¯èƒ½ä¸¢å¤§é‡äº‹åŠ¡</td></tr></tbody></table>
<p>ä½ çš„åœºæ™¯ï¼ˆå•†åŸï¼‰æ¨è 1 æˆ– 2ã€‚</p>
<h3 data-id="heading-5"><strong>4ï¼‰innodb_flush_method = O_DIRECT</strong></h3>
<p>é˜²æ­¢åŒç¼“å­˜ï¼ˆOS + MySQLï¼‰ï¼Œæå‡ IO æ€§èƒ½ã€‚</p>
<p>SSD åœºæ™¯å¼ºçƒˆæ¨èã€‚</p>
<h3 data-id="heading-6"><strong>5ï¼‰max_connections</strong></h3>
<p>å¾ˆå¤šé¡¹ç›®é»˜è®¤åªæœ‰ <em>151</em>ï¼Œå¹¶å‘ç¨é«˜ç«‹åˆ»â€œToo many connectionsâ€ã€‚</p>
<p>ä¸€èˆ¬ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-number">2000</span>ï¼ˆè¶³å¤Ÿå¤§éƒ¨åˆ†äº’è”ç½‘é¡¹ç›®ï¼‰
</code></pre>
<h3 data-id="heading-7"><strong>6ï¼‰tmp_table_size &amp; max_heap_table_size</strong></h3>
<p>é¿å…å¤æ‚ SQLï¼ˆgroup byã€order byï¼‰é¢‘ç¹å†™ç£ç›˜ï¼š</p>
<pre><code class="hljs language-js" lang="js">256M å¯¹å¤§éƒ¨åˆ†ä¸šåŠ¡å¤Ÿç”¨äº†
</code></pre>
<h3 data-id="heading-8"><strong>7ï¼‰sort_buffer_size / join_buffer_size</strong></h3>
<p>ä¸è¦è®¾ç½®å¤ªå¤§ï¼ï¼æ¯ä¸ªè¿æ¥éƒ½ä¼šåˆ†é…ï¼</p>
<p>4M æ˜¯ä¸€ä¸ªéå¸¸å®‰å…¨çš„å€¼ã€‚</p>
<h3 data-id="heading-9"><strong>8ï¼‰sync_binlogï¼ˆä¸»ä»å¤åˆ¶ / å®¹ç¾ï¼‰</strong></h3>
<ul>
<li>æœ€å®‰å…¨ï¼š1</li>
<li>é«˜ååï¼š100ï½1000</li>
</ul>
<p>ä½ åšç”µå•†é€€æ¬¾ã€æ”¯ä»˜ï¼Œå»ºè®®ï¼š</p>
<pre><code class="hljs language-js" lang="js">sync_binlog = <span class="hljs-number">1</span>
binlog_format = row
</code></pre>
<p>ä¿è¯ binlog ä¸€è‡´æ€§ï¼Œæ–¹ä¾¿æ¢å¤ã€‚</p>
<p>âœ… <strong>ä¸‰ã€å¸¸è§ä¼˜åŒ–åœºæ™¯å»ºè®®</strong></p>
<ol>
<li>é«˜è¯»å†™ç”µå•†ç³»ç»Ÿï¼ˆä½ çš„åœºæ™¯ï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js">innodb_buffer_pool_size = <span class="hljs-number">50</span>%-<span class="hljs-number">70</span>% å†…å­˜
innodb_log_file_size = 1G
innodb_flush_log_at_trx_commit = <span class="hljs-number">1</span>
innodb_io_capacity = <span class="hljs-number">4000</span>
sync_binlog = <span class="hljs-number">1</span>
max_connections = <span class="hljs-number">2000</span>
</code></pre>
<ol start="2">
<li>é«˜å¹¶å‘æœåŠ¡æ¥å£ï¼ˆè®¢å•ã€æ”¯ä»˜ã€åº“å­˜ï¼‰</li>
</ol>
<pre><code class="hljs language-js" lang="js">join_buffer_size = 4M
sort_buffer_size = 4M
tmp_table_size = 256M
max_heap_table_size = 256M
</code></pre>
<h2 data-id="heading-10">âœ… <strong>å››ã€å®Œæ•´ä¼˜åŒ–ç­–ç•¥æ€»ç»“ï¼ˆä¸€å¥è¯ç†è§£ï¼‰</strong></h2>
<blockquote>
<p>MySQL æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒï¼š<br/>
<strong>è®©çƒ­æ•°æ®éƒ½æ”¾åœ¨å†…å­˜é‡Œï¼Œå‡å°‘ç£ç›˜ IOï¼Œå¹¶å‡å°‘æ¯æ¬¡äº‹åŠ¡åˆ·ç›˜æ¬¡æ•°</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Figma Vector Networks: å½¢çŠ¶ã€å¡«å……åŠæè¾¹]]></title>    <link>https://juejin.cn/post/7575655132755460115</link>    <guid>https://juejin.cn/post/7575655132755460115</guid>    <pubDate>2025-11-23T12:12:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575655132755460115" data-draft-id="7575655132755427347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Figma Vector Networks: å½¢çŠ¶ã€å¡«å……åŠæè¾¹"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-23T12:12:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¬é£è¯´å›¾"/> <meta itemprop="url" content="https://juejin.cn/user/198345371681864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Figma Vector Networks: å½¢çŠ¶ã€å¡«å……åŠæè¾¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/198345371681864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¬é£è¯´å›¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:12:25.000Z" title="Sun Nov 23 2025 12:12:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2F01joy.com%2Frww%2Ffigma-vector-networks.html" target="_blank" title="https://01joy.com/rww/figma-vector-networks.html" ref="nofollow noopener noreferrer">ã€ŠFigma Vector Networks: é‡æ–°å®šä¹‰çŸ¢é‡å›¾å½¢ç¼–è¾‘ã€‹</a>ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†Vector Networks (çŸ¢é‡ç½‘æ ¼)ä¸SVG Pathçš„æ ¹æœ¬å·®å¼‚ã€‚Vector Networksä¹‹æ‰€ä»¥è¢«è§†ä¸ºâ€œæ›´é«˜ç»´åº¦â€çš„è¡¨è¿°ï¼Œåœ¨äºå…¶ç‹¬ç‰¹çš„æ‹“æ‰‘ç»“æ„ï¼Œè¿™ä¸ºçŸ¢é‡å›¾å½¢çš„ç¼–è¾‘å¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„çµæ´»æ€§ä¸æ•ˆç‡ã€‚</p>
<p>æœ¬æ–‡å°†ä¸¾ä¾‹è¯´æ˜ç”¨Vector Networksè¡¨ç¤ºä¸‹é¢å›¾å½¢çš„å½¢çŠ¶ã€å¡«å……åŠæè¾¹ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47e9cc15c0d74f7d805b38f01f1ef7ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCs6aOO6K-05Zu-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764504745&amp;x-signature=JA8jY0g25QH9lgCNcqct19mtpj0%3D" alt="" loading="lazy"/></p>
<p>ä»¥ä¸Šå›¾å½¢åˆ†ä¸ºä¸¤ç±»ï¼šå·¦è¾¹æ˜¯ç”±ç›´çº¿ç»„æˆçš„ï¼Œå³è¾¹æ˜¯ç”±æ›²çº¿ç»„æˆçš„ï¼Œå½“ç„¶æ— è®ºçŸ¢é‡å›¾å½¢æœ‰å¤šå¤æ‚ï¼Œéƒ½å¯ä»¥ç”¨Vector Networksè¡¨ç¤ºã€‚</p>
<h2 data-id="heading-1">æ¦‚è¿°</h2>
<p>æ–‡ç« ä»¥å…·ä½“å›¾å½¢ä¸ºä¾‹ï¼Œè¯¦ç»†è§£æäº† Vector Networks çš„ç»„æˆç»“æ„â€”â€”åŒ…æ‹¬<strong>èŠ‚ç‚¹ï¼ˆverticesï¼‰</strong> ã€<strong>çº¿æ¡ï¼ˆsegmentsï¼‰</strong> å’Œ<strong>åŒºåŸŸï¼ˆregionsï¼‰</strong> ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ JSON ç»“æ„æè¿°ç›´çº¿ã€çŸ©å½¢ã€ä¸‰è§’å½¢ã€äº”è§’æ˜Ÿã€æ›²çº¿å’Œæ¤­åœ†ç­‰å¸¸è§å›¾å½¢ã€‚</p>
<p>åŒæ—¶ï¼Œæ–‡ç« è¿˜åŒºåˆ†äº†åº•å±‚çŸ¢é‡å¼•æ“ä¸ä¸Šå±‚å·¥å…·å¼€å‘è€…çš„èŒè´£ï¼Œå¼ºè°ƒäº† Vector Networks åœ¨ç®€åŒ–çŸ¢é‡å›¾å½¢ç¼–è¾‘å¤æ‚åº¦æ–¹é¢çš„é‡è¦ä½œç”¨ã€‚</p>
<h2 data-id="heading-2">åŒ–ç¹ä¸ºç®€</h2>
<p>Vector Networksä¸»è¦ç”±ç‚¹ã€çº¿ã€å’ŒåŒºåŸŸç»„æˆã€‚</p>
<p>å¯¹åº•å±‚çŸ¢é‡å¼•æ“å¼€å‘è€…æ¥è¯´ï¼Œéœ€è¦å°†Vector Networksè¿™ç§æè¿°åè®®è½¬æ¢æˆGPUå¯è¯†åˆ«çš„æ¸²æŸ“å‘½ä»¤ï¼Œè€Œè§£æçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯æ ¹æ®èŠ‚ç‚¹å’Œçº¿æ¡è‡ªåŠ¨è¯†åˆ«åŒºåŸŸã€‚</p>
<p>å¯¹ä¸Šå±‚çŸ¢é‡å·¥å…·å¼€å‘è€…æ¥è¯´ï¼Œä¸éœ€è¦å…³å¿ƒå¦‚ä½•è§£æVector Networksï¼Œåªè¦å…³æ³¨çŸ¢é‡å›¾å½¢çš„ç¼–è¾‘äº¤äº’åŠŸèƒ½ã€‚</p>
<p>è¿™æ ·åˆ’åˆ†çš„å¥½å¤„æ˜¯ï¼šåº•å±‚çŸ¢é‡å¼•æ“å°†ä»»æ„çŸ¢é‡å›¾å½¢æŠ½è±¡æˆVector Networksï¼Œå¹¶è‡ªåŠ¨è¯†åˆ«å‡ºäº†çŸ¢é‡ç½‘æ ¼ä¸­çš„åŒºåŸŸï¼Œæš´éœ²å‡ºçŸ¢é‡ç½‘æ ¼çš„ç‚¹çº¿ç¼–è¾‘ï¼Œå¤§å¤§ç®€åŒ–äº†çŸ¢é‡å›¾å½¢ç¼–è¾‘çš„å¤æ‚åº¦ã€‚</p>
<h2 data-id="heading-3">å…¬å…±éƒ¨åˆ†</h2>
<ul>
<li>type æ˜¯å›¾å½¢ç±»å‹</li>
<li>strokeWeight æè¾¹çº¿å®½</li>
<li>strokeAlign æè¾¹å¯¹é½æ–¹å¼ï¼Œåˆ†ä¸ºï¼šCenterã€Insideã€Outside</li>
<li>strokePaints ä¸»è¦æ˜¯æè¾¹é¢œè‰²æ•°ç»„</li>
<li>fillPaints ä¸»è¦æ˜¯å¡«å……é¢œè‰²æ•°ç»„</li>
<li>vectorNetworkå­˜å‚¨çš„æ˜¯çŸ¢é‡ç½‘æ ¼æ•°æ®ï¼ŒåŒ…å«èŠ‚ç‚¹æ•°ç»„ã€çº¿æ¡æ•°ç»„ã€åŒºåŸŸæ•°ç»„</li>
</ul>

<ul>
<li>
<ul>
<li>verticesæ˜¯èŠ‚ç‚¹æ•°ç»„ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰è‡ªå·±çš„åæ ‡å’Œæ ·å¼ç´¢å¼•styleID (é»˜è®¤å¯¹åº”åˆ°strokePaintsæ•°ç»„ä¸‹æ ‡)</li>
<li>segmentsæ˜¯çº¿æ¡æ•°ç»„ï¼Œæ¯ä¸ªçº¿æ¡æœ‰èµ·å§‹èŠ‚ç‚¹çš„ç´¢å¼•vertexï¼Œå’Œå¯¹åº”çš„æ§åˆ¶ç‚¹dx/dyï¼ˆæ›²çº¿ä¼šç”¨åˆ°ï¼‰ï¼Œç»“æŸç‚¹çš„ç´¢å¼•vertexï¼Œå’Œå¯¹åº”çš„æ§åˆ¶ç‚¹dx/dyï¼Œä»¥åŠæ ·å¼ç´¢å¼•styleID</li>
<li>regionsæ˜¯åŒºåŸŸæ•°ç»„ï¼ŒåŒ…å«å¤šä¸ªåŒºåŸŸã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>
<ul>
<li>æ¯ä¸ªåŒºåŸŸçš„styleID (å¡«å……æ ·å¼ç´¢å¼•) å®šä¹‰äº†å½“å‰åŒºåŸŸçš„å¡«å……ï¼Œé»˜è®¤å¯¹åº”åˆ°fillPaintsæ•°ç»„ä¸‹æ ‡ï¼Œä¹Ÿå¯ä»¥å¯¹åº”åˆ°styleOverrideTableæ ·å¼è¦†ç›–è¡¨é‡Œ</li>
<li>æ¯ä¸ªåŒºåŸŸçš„loops (åŒºåŸŸ) å®šä¹‰äº†å½“å‰åŒºåŸŸçš„æ‹“æ‰‘ç»“æ„ï¼Œç”±å¤šä¸ªsegments (ç¯) ç»„æˆï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªsegmentsåˆ™ä»£è¡¨å½“å‰åŒºåŸŸç”±ä¸€ä¸ªç¯å›´åŸï¼Œå¤šä¸ªsegmentsä¸€èˆ¬ä»£è¡¨ç”±å†…ç¯å’Œå¤–ç¯å…±åŒå›´åŸçš„åŒºåŸŸ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 data-id="heading-4">ç›´çº¿</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> line = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"VECTOR"</span>, <span class="hljs-comment">// å›¾å½¢ç±»å‹æ˜¯çŸ¢é‡ç½‘æ ¼</span>
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// æè¾¹å®½åº¦ä¸º1ä¸ªå•ä½</span>
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"CENTER"</span>, <span class="hljs-comment">// æè¾¹å¯¹é½æ–¹å¼ä¸ºå±…ä¸­</span>
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>, <span class="hljs-comment">// æè¾¹è¿æ¥æ–¹å¼ä¸ºå°–è§’è¿æ¥</span>
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: { <span class="hljs-comment">// æè¾¹é¢œè‰²</span>
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: { <span class="hljs-comment">// çŸ¢é‡ç½‘ç»œæ•°æ®</span>
        <span class="hljs-string">"vertices"</span>: [ <span class="hljs-comment">// é¡¶ç‚¹æ•°ç»„</span>
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// é¡¶ç‚¹æ ·å¼IDï¼Œå¯¹åº”æè¾¹æ ·å¼æ•°ç»„çš„ç¬¬ä¸€ä¸ªæ ·å¼</span>
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">1</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// çº¿æ¡æ•°ç»„</span>
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// çº¿æ¡æ ·å¼IDï¼Œå¯¹åº”æè¾¹æ ·å¼æ•°ç»„çš„ç¬¬ä¸€ä¸ªæ ·å¼</span>
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [] <span class="hljs-comment">// åŒºåŸŸæ•°ç»„ä¸ºç©ºï¼Œè¡¨ç¤ºæ²¡æœ‰å¯å¡«å……åŒºåŸŸ</span>
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> line;
</code></pre>
<h2 data-id="heading-5">çŸ©å½¢</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rectangle = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"ROUNDED_RECTANGLE"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: { <span class="hljs-comment">// å¡«å……é¢œè‰²</span>
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: { <span class="hljs-comment">// æè¾¹é¢œè‰²</span>
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">50</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">50</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [ <span class="hljs-comment">// åŒºåŸŸæ•°ç»„é‡Œæœ‰ä¸€ä¸ªåŒºåŸŸ</span>
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [ <span class="hljs-comment">// å½“å‰åŒºåŸŸç”±ä¸€ä¸ªç¯å›´åŸ</span>
                    {
                        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// å½“å‰ç¯ç”±è¾¹ 0/1/2/3 å››æ¡è¾¹å›´åŸ</span>
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>,
                            <span class="hljs-number">3</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> rectangle;
</code></pre>
<h2 data-id="heading-6">ä¸‰è§’å½¢</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> polygon = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"REGULAR_POLYGON"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">93.30126953125</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">75</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">6.69873046875</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">75</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [
                    {
                        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// å½“å‰ç¯ç”±ä¸‰ä¸ªè¾¹å›´æˆ</span>
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> polygon;
</code></pre>
<h2 data-id="heading-7">äº”è§’æ˜Ÿ</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> star = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"STAR"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">61.22570037841797</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">97.55282592773438</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">68.16356658935547</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">55.90169906616211</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">79.38926696777344</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">90.45085144042969</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">69.09829711914062</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">20.610736846923828</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">90.45085144042969</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">31.836435317993164</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">55.90169906616211</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">2.447174072265625</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">38.77429962158203</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">34.54914855957031</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">4</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">4</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">5</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">5</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">6</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">6</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">7</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">7</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">8</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">8</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">9</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">9</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [
                    {
                        <span class="hljs-string">"segments"</span>: [ å½“å‰ç¯ç”±åæ¡è¾¹å›´åŸ
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>,
                            <span class="hljs-number">3</span>,
                            <span class="hljs-number">4</span>,
                            <span class="hljs-number">5</span>,
                            <span class="hljs-number">6</span>,
                            <span class="hljs-number">7</span>,
                            <span class="hljs-number">8</span>,
                            <span class="hljs-number">9</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> star;
</code></pre>
<h2 data-id="heading-8">æ›²çº¿</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> line2 = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"VECTOR"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"CENTER"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">23.836986541748047</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">22.8122615814209</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">1</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">23.324623107910156</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">19.28675651550293</span>, <span class="hljs-comment">// èµ·å§‹ç‚¹çš„æ§åˆ¶ç‚¹xåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">29.784029006958008</span> <span class="hljs-comment">// èµ·å§‹ç‚¹çš„æ§åˆ¶ç‚¹yåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">22.682817459106445</span>, <span class="hljs-comment">// ç»“æŸç‚¹çš„æ§åˆ¶ç‚¹xåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">33.02580642700195</span> <span class="hljs-comment">// ç»“æŸç‚¹çš„æ§åˆ¶ç‚¹yåæ ‡(ç›¸å¯¹äºå½“å‰ç‚¹åç§»é‡)</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">22.682817459106445</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">33.02580642700195</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">14.171252250671387</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">28.461177825927734</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: []
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> line2;
</code></pre>
<h2 data-id="heading-9">æ¤­åœ†</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ellipse = {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"ELLIPSE"</span>,
    <span class="hljs-string">"strokeWeight"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">"strokeAlign"</span>: <span class="hljs-string">"INSIDE"</span>,
    <span class="hljs-string">"strokeJoin"</span>: <span class="hljs-string">"MITER"</span>,
    <span class="hljs-string">"fillPaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0.8509804010391235</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"strokePaints"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"SOLID"</span>,
            <span class="hljs-string">"color"</span>: {
                <span class="hljs-string">"r"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"g"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"b"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"a"</span>: <span class="hljs-number">1</span>
            },
            <span class="hljs-string">"opacity"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">"visible"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-string">"blendMode"</span>: <span class="hljs-string">"NORMAL"</span>
        }
    ],
    <span class="hljs-string">"vectorNetwork"</span>: {
        <span class="hljs-string">"vertices"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">100</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">25</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">50</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">25</span>
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"x"</span>: <span class="hljs-number">50</span>,
                <span class="hljs-string">"y"</span>: <span class="hljs-number">0</span>
            }
        ],
        <span class="hljs-string">"segments"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">13.80711841583252</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">13.80711841583252</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">2</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">13.80711841583252</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: -<span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                }
            },
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"start"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">3</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">27.61423683166504</span>,
                    <span class="hljs-string">"dy"</span>: <span class="hljs-number">0</span>
                },
                <span class="hljs-string">"end"</span>: {
                    <span class="hljs-string">"vertex"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dx"</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-string">"dy"</span>: -<span class="hljs-number">13.80711841583252</span>
                }
            }
        ],
        <span class="hljs-string">"regions"</span>: [
            {
                <span class="hljs-string">"styleID"</span>: <span class="hljs-number">0</span>,
                <span class="hljs-string">"windingRule"</span>: <span class="hljs-string">"NONZERO"</span>,
                <span class="hljs-string">"loops"</span>: [
                    {
                        <span class="hljs-string">"segments"</span>: [ <span class="hljs-comment">// å½“å‰ç¯ç”±å››æ¡æ›²çº¿ç»„æˆ</span>
                            <span class="hljs-number">0</span>,
                            <span class="hljs-number">1</span>,
                            <span class="hljs-number">2</span>,
                            <span class="hljs-number">3</span>
                        ]
                    }
                ]
            }
        ]
    }
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> ellipse;
</code></pre>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>Figma Vector Networks æä¾›äº†ä¸€ç§<strong>æ›´é«˜ç»´åº¦çš„çŸ¢é‡å›¾å½¢æè¿°æ–¹å¼</strong>ï¼Œå®ƒä¸ä»…çªç ´äº†ä¼ ç»Ÿ SVG Path çš„ç¼–è¾‘é™åˆ¶ï¼Œè¿˜é€šè¿‡å…¶ç‹¬ç‰¹çš„<strong>æ‹“æ‰‘ç»“æ„</strong>å®ç°äº†æ›´çµæ´»ã€é«˜æ•ˆçš„å›¾å½¢æ„å»ºä¸æ¸²æŸ“ã€‚æœ¬æ–‡é€šè¿‡å¤šä¸ªå®é™…å›¾å½¢ç¤ºä¾‹ï¼Œç³»ç»Ÿæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Vector Networks çš„ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ <code>vertices</code>ã€<code>segments</code>ã€<code>regions</code>ï¼‰æ¥å®šä¹‰å›¾å½¢çš„å‡ ä½•å½¢çŠ¶ã€æè¾¹æ ·å¼ä¸å¡«å……åŒºåŸŸã€‚æ— è®ºæ˜¯ç›´çº¿ã€å¤šè¾¹å½¢è¿˜æ˜¯æ›²çº¿å›¾å½¢ï¼ŒVector Networks éƒ½èƒ½ä»¥ç»Ÿä¸€è€Œå¼ºå¤§çš„æ–¹å¼äºˆä»¥æ”¯æŒï¼Œæå¤§åœ°é™ä½äº†çŸ¢é‡å›¾å½¢ç¼–è¾‘çš„å¤æ‚åº¦ï¼Œä¸ºå›¾å½¢å·¥å…·çš„å¼€å‘ä¸ä½¿ç”¨æä¾›äº†æ–°çš„å¯èƒ½æ€§ã€‚</p>
<p><em>æ›´å¤šç²¾å½©å†…å®¹å¯å…³æ³¨</em><a href="https://link.juejin.cn?target=https%3A%2F%2F01joy.com" target="_blank" title="https://01joy.com" ref="nofollow noopener noreferrer"><em>é£èµ·çš„åšå®¢</em></a> <em>ï¼Œå¾®ä¿¡å…¬ä¼—å·ï¼šå¬é£è¯´å›¾</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ]]></title>    <link>https://juejin.cn/post/7572126996177141795</link>    <guid>https://juejin.cn/post/7572126996177141795</guid>    <pubDate>2025-11-14T05:09:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7572126996177141795" data-draft-id="7572141390857093120" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ"/> <meta itemprop="keywords" content="å‰ç«¯,CSS"/> <meta itemprop="datePublished" content="2025-11-14T05:09:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é—²äº‘ing"/> <meta itemprop="url" content="https://juejin.cn/user/2974655942502250"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2974655942502250/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é—²äº‘ing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-14T05:09:35.000Z" title="Fri Nov 14 2025 05:09:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSSå®šä½å…¨è§£æï¼šä»staticåˆ°stickyï¼Œå½»åº•ææ‡‚å¸ƒå±€æ ¸å¿ƒ</h2>
<p><strong>å‰ç«¯å¼€å‘ç»•ä¸å¼€çš„å</strong>ï¼šCSSå®šä½æ˜¯å¸ƒå±€çš„çµé­‚ï¼Œä¹Ÿæ˜¯æ–°æ‰‹æœ€å®¹æ˜“æ··æ·†çš„çŸ¥è¯†ç‚¹ã€‚æœ¬æ–‡ç”¨æ¦‚å¿µ+æ¡ˆä¾‹+å¯¹æ¯”çš„å½¢å¼ï¼ŒæŠŠstaticã€relativeã€absoluteã€fixedã€stickyè®²é€ï¼Œæ¯ä¸ªç‰¹æ€§éƒ½é…å¯ç›´æ¥è¿è¡Œçš„ä»£ç ï¼Œçœ‹å®Œå°±èƒ½ä¸Šæ‰‹å®æˆ˜ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å…ˆææ‡‚åŸºç¡€ï¼šä»€ä¹ˆæ˜¯æ–‡æ¡£æµï¼Ÿ</h2>
<p>åœ¨èŠå®šä½ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ˜ç¡®ã€Œæ–‡æ¡£æµã€è¿™ä¸ªæ ¸å¿ƒæ¦‚å¿µâ€”â€”å®ƒæ˜¯HTMLå…ƒç´ é»˜è®¤çš„æ’åˆ—è§„åˆ™ï¼Œå°±åƒäººæ’é˜Ÿä¸€æ ·æœ‰ç« å¯å¾ªï¼š</p>
<ul>
<li><strong>å—çº§å…ƒç´ </strong>ï¼ˆdivã€pã€h1ç­‰ï¼‰ï¼šç‹¬å ä¸€è¡Œï¼Œå‚ç›´å‘ä¸‹æ’åˆ—ï¼Œé»˜è®¤å®½åº¦å æ»¡çˆ¶å®¹å™¨</li>
<li><strong>è¡Œå†…å…ƒç´ </strong>ï¼ˆspanã€aã€imgç­‰ï¼‰ï¼šä¸ç‹¬å ä¸€è¡Œï¼Œæ°´å¹³ä»å·¦åˆ°å³æ’åˆ—ï¼Œå®½åº¦ç”±å†…å®¹å†³å®š</li>
<li><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼šå…ƒç´ åƒæµæ°´ä¸€æ ·ä¾æ¬¡æ’åˆ—ï¼Œæ¯ä¸ªå…ƒç´ éƒ½å æ®è‡ªå·±çš„ã€Œä½ç½®ã€ï¼Œä¸ä¼šé‡å </li>
</ul>
<p>è€ŒCSSå®šä½çš„æ ¸å¿ƒä½œç”¨ï¼Œå°±æ˜¯<strong>æ‰“ç ´æˆ–æ”¹å˜è¿™ç§é»˜è®¤çš„æ–‡æ¡£æµè§„åˆ™</strong>ã€‚å½“å…ƒç´ ã€Œè„±ç¦»æ–‡æ¡£æµã€æ—¶ï¼Œå®ƒä¼šåƒå¹½çµä¸€æ ·"é£˜èµ·æ¥"ï¼Œä¸å†å æ®åŸæ¥çš„ç©ºé—´ï¼Œç”šè‡³ä¼šè¦†ç›–å…¶ä»–å…ƒç´ â€”â€”è¿™ä¹Ÿæ˜¯å®šä½å¸ƒå±€çš„å…³é”®ç‰¹æ€§ã€‚</p>
<h2 data-id="heading-2">äºŒã€é€ä¸ªå‡»ç ´ï¼š5ç§å®šä½æ–¹å¼çš„æ ¸å¿ƒç”¨æ³•</h2>
<p>CSSçš„<code>position</code>å±æ€§å…±æœ‰5ä¸ªå–å€¼ï¼Œæ¯ç§å–å€¼å¯¹åº”å®Œå…¨ä¸åŒçš„å¸ƒå±€è¡Œä¸ºã€‚æˆ‘ä»¬ä»æœ€åŸºç¡€çš„staticå¼€å§‹ï¼Œé€ä¸ªæ‹†è§£ã€‚</p>
<h3 data-id="heading-3">1. position: static é™æ€å®šä½ï¼ˆé»˜è®¤å€¼ï¼‰</h3>
<p>staticæ˜¯æ‰€æœ‰å…ƒç´ çš„é»˜è®¤å®šä½æ–¹å¼ï¼Œæ„æ€æ˜¯ã€Œéµå¾ªæ­£å¸¸æ–‡æ¡£æµã€ï¼Œå°±åƒæ’é˜Ÿæ—¶æŒ‰é¡ºåºç«™å¥½ï¼Œä¸æç‰¹æ®ŠåŒ–ã€‚</p>
<h4 data-id="heading-4">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li>å®Œå…¨éµå¾ªæ–‡æ¡£æµï¼Œå…ƒç´ å æ®æ­£å¸¸ç©ºé—´</li>
<li><code>topã€bottomã€leftã€right</code>å’Œ<code>z-index</code>å±æ€§å®Œå…¨æ— æ•ˆï¼ˆè®¾ç½®äº†ä¹Ÿæ²¡ç”¨ï¼‰</li>
<li>ä½œç”¨åœºæ™¯ï¼šé€šå¸¸ç”¨äºã€Œå–æ¶ˆå®šä½ã€ï¼Œæ¯”å¦‚æŠŠä¹‹å‰è®¾ä¸ºabsoluteçš„å…ƒç´ æ”¹å›static</li>
</ul>
<h4 data-id="heading-5">å®æˆ˜æ¡ˆä¾‹ï¼šå…ƒç´ å›å½’æ–‡æ¡£æµ</h4>
<p>è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œçˆ¶å…ƒç´ åˆå§‹æ˜¯ç»å¯¹å®šä½ï¼Œ5ç§’åé€šè¿‡JSæ”¹ä¸ºstaticï¼Œä¼šè‡ªåŠ¨å›å½’æ–‡æ¡£æµï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Static é™æ€å®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; } <span class="hljs-comment">/* æ¸…é™¤é»˜è®¤è¾¹è· */</span>
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; } <span class="hljs-comment">/* è®©é¡µé¢å¯æ»šåŠ¨ï¼Œæ–¹ä¾¿è§‚å¯Ÿ */</span>
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>; <span class="hljs-comment">/* æµ…ç²‰è‰²ï¼Œæ›´æŸ”å’Œ */</span>
      <span class="hljs-attribute">position</span>: absolute; <span class="hljs-comment">/* åˆå§‹ä¸ºç»å¯¹å®šä½ï¼Œä¼šè„±ç¦»æ–‡æ¡£æµ */</span>
      <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>;
    }
    
    <span class="hljs-selector-class">.child</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#91c8e4</span>; <span class="hljs-comment">/* æµ…è“è‰² */</span>
    }
    
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>; <span class="hljs-comment">/* æµ…ç»¿è‰² */</span>
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Hello CSS<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> oParent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.parent'</span>);
    <span class="hljs-comment">// 5ç§’åå°†çˆ¶å…ƒç´ æ”¹ä¸ºé™æ€å®šä½ï¼Œå›å½’æ–‡æ¡£æµ</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      oParent.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'static'</span>;
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">'çˆ¶å…ƒç´ å·²æ”¹ä¸ºstaticå®šä½ï¼Œå›å½’æ–‡æ¡£æµ'</span>);
    }, <span class="hljs-number">5000</span>);
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">2. position: relative ç›¸å¯¹å®šä½ï¼ˆå¾®è°ƒç¥å™¨ï¼‰</h3>
<p>relativeçš„æ ¸å¿ƒæ˜¯ã€Œç›¸å¯¹è‡ªèº«ã€â€”â€”å…ƒç´ å…ˆåœ¨æ–‡æ¡£æµä¸­å æ®æ­£å¸¸ä½ç½®ï¼Œç„¶åç›¸å¯¹äºè¿™ä¸ªåŸå§‹ä½ç½®è¿›è¡Œåç§»ï¼Œå°±åƒæ’é˜Ÿæ—¶ç¨å¾®æŒªä¸€ä¸‹è„šæ­¥ï¼Œä½†ä¸ç¦»å¼€è‡ªå·±çš„ä½ç½®ã€‚</p>
<h4 data-id="heading-7">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>ä¸è„±ç¦»æ–‡æ¡£æµ</strong>ï¼šåŸå§‹ä½ç½®ä¼šè¢«ä¿ç•™ï¼Œå…¶ä»–å…ƒç´ ä¸ä¼š"æŒ¤è¿‡æ¥"</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼šå…ƒç´ è‡ªèº«åœ¨æ–‡æ¡£æµä¸­çš„åŸå§‹ä½ç½®</li>
<li><strong>åç§»æ§åˆ¶</strong>ï¼šé€šè¿‡<code>top/bottom/left/right</code>è®¾ç½®åç§»é‡ï¼ˆæ­£å€¼è¡¨ç¤ºè¿œç¦»è¯¥æ–¹å‘ï¼Œè´Ÿå€¼è¡¨ç¤ºé è¿‘ï¼‰</li>
<li><strong>é‡è¦ä½œç”¨</strong>ï¼šç»™ç»å¯¹å®šä½çš„å­å…ƒç´ å……å½“ã€Œå®šä½å‚è€ƒç‚¹ã€ï¼ˆè¿™æ˜¯å®ƒæœ€å¸¸ç”¨çš„åœºæ™¯ï¼‰</li>
</ul>
<h4 data-id="heading-8">å®æˆ˜æ¡ˆä¾‹ï¼šå…ƒç´ åç§»ä¸å®šä½å‚è€ƒ</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Relative ç›¸å¯¹å®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* ç›¸å¯¹å®šä½ï¼Œä½œä¸ºå­å…ƒç´ çš„å‚è€ƒ */</span>
      <span class="hljs-attribute">left</span>: <span class="hljs-number">100px</span>; <span class="hljs-comment">/* ç›¸å¯¹äºè‡ªèº«åŸå§‹ä½ç½®ï¼Œå‘å³åç§»100px */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">100px</span>;  <span class="hljs-comment">/* ç›¸å¯¹äºè‡ªèº«åŸå§‹ä½ç½®ï¼Œå‘ä¸‹åç§»100px */</span>
    }
    
    <span class="hljs-selector-class">.child</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#91c8e4</span>;
      <span class="hljs-attribute">position</span>: absolute; <span class="hljs-comment">/* å­å…ƒç´ ç»å¯¹å®šä½ï¼Œå‚è€ƒçˆ¶å…ƒç´  */</span>
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ åº•éƒ¨50px */</span>
      <span class="hljs-attribute">right</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ å³ä¾§50px */</span>
    }
    
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>;
      <span class="hljs-comment">/* æœªè®¾ç½®å®šä½ï¼Œéµå¾ªæ–‡æ¡£æµï¼Œçˆ¶å…ƒç´ çš„åç§»ä¸å½±å“å®ƒ */</span>
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>æˆ‘åœ¨æ–‡æ¡£æµä¸­<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>æ–°æ‰‹é¿å‘</strong>ï¼šrelativeçš„åç§»ä¸ä¼šå½±å“å…¶ä»–å…ƒç´ çš„å¸ƒå±€ï¼Œå› ä¸ºå®ƒè¿˜åœ¨æ–‡æ¡£æµä¸­ã€‚å¦‚æœå‘ç°å…ƒç´ åç§»å"å‹"ä½äº†å…¶ä»–å…ƒç´ ï¼Œé‚£å¤§æ¦‚ç‡æ˜¯ç”¨äº†absolute/fixedï¼Œè€Œä¸æ˜¯relativeã€‚</p>
<h3 data-id="heading-9">3. position: absolute ç»å¯¹å®šä½ï¼ˆç‹¬ç«‹å¸ƒå±€ä¹‹ç‹ï¼‰</h3>
<p>absoluteæ˜¯å‰ç«¯å¸ƒå±€çš„æ˜æ˜Ÿå±æ€§ï¼Œå®ƒèƒ½è®©å…ƒç´ å®Œå…¨è„±ç¦»æ–‡æ¡£æµï¼Œå°±åƒä»æ’é˜Ÿé˜Ÿä¼ä¸­èµ°å‡ºæ¥ï¼Œè‡ªç”±ç§»åŠ¨ï¼Œè€Œä¸”ä¸ä¼šç•™ä¸‹è‡ªå·±çš„ä½ç½®ï¼ˆå…¶ä»–å…ƒç´ ä¼šè¡¥ä¸Šæ¥ï¼‰ã€‚</p>
<h4 data-id="heading-10">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>å®Œå…¨è„±ç¦»æ–‡æ¡£æµ</strong>ï¼šä¸å æ®ä»»ä½•ç©ºé—´ï¼Œç›¸å½“äºé¡µé¢ä¸­"ä¸å­˜åœ¨"è¿™ä¸ªå…ƒç´ ï¼ˆå¯¹å…¶ä»–å…ƒç´ è€Œè¨€ï¼‰</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼š<strong>æœ€è¿‘çš„å·²å®šä½ç¥–å…ˆå…ƒç´ </strong>ï¼ˆå³ç¥–å…ˆå…ƒç´ çš„positionä¸æ˜¯staticï¼‰ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±ç›¸å¯¹äºæµè§ˆå™¨çª—å£ï¼ˆåˆå§‹åŒ…å«å—ï¼‰</li>
<li><strong>åç§»æ§åˆ¶</strong>ï¼šé€šè¿‡<code>top/bottom/left/right</code>æ§åˆ¶ä½ç½®ï¼Œç›¸å¯¹äºå®šä½åŸºå‡†è¿›è¡Œåç§»</li>
<li><strong>å±‚çº§é—®é¢˜</strong>ï¼šè„±ç¦»æ–‡æ¡£æµåä¼šè¦†ç›–å…¶ä»–å…ƒç´ ï¼Œå¯é€šè¿‡<code>z-index</code>è°ƒæ•´å±‚çº§ï¼ˆæ•°å€¼è¶Šå¤§è¶Šé ä¸Šï¼‰</li>
</ul>
<h4 data-id="heading-11">å®æˆ˜æ¡ˆä¾‹1ï¼šå­å…ƒç´ ç›¸å¯¹äºçˆ¶å…ƒç´ å®šä½</h4>
<p>è¿™æ˜¯absoluteæœ€ç»å…¸çš„ç”¨æ³•â€”â€”çˆ¶å…ƒç´ è®¾ä¸ºrelativeï¼Œå­å…ƒç´ è®¾ä¸ºabsoluteï¼Œå®ç°å­å…ƒç´ åœ¨çˆ¶å…ƒç´ å†…çš„ç²¾å‡†å®šä½ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Absolute ç»å¯¹å®šä½ï¼ˆçˆ¶å…ƒç´ å‚è€ƒï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e0f7fa</span>; }
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">550px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto; <span class="hljs-comment">/* æ°´å¹³å±…ä¸­ï¼Œæ–¹ä¾¿è§‚å¯Ÿ */</span>
      <span class="hljs-attribute">position</span>: relative; <span class="hljs-comment">/* å…³é”®ï¼šç»™å­å…ƒç´ å½“å‚è€ƒ */</span>
      <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.9</span>; <span class="hljs-comment">/* åŠé€æ˜ï¼Œæ–¹ä¾¿çœ‹åˆ°å±‚çº§ */</span>
    }
    
    <span class="hljs-selector-class">.child</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#91c8e4</span>;
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">100px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ å³è¾¹ç¼˜100px */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">150px</span>; <span class="hljs-comment">/* è·ç¦»çˆ¶å…ƒç´ ä¸Šè¾¹ç¼˜150px */</span>
    }
    
    <span class="hljs-comment">/* ç»å¯¹å®šä½å±…ä¸­æŠ€å·§ï¼šleft50% + transform(-50%) */</span>
    <span class="hljs-selector-class">.center-box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>;
      <span class="hljs-attribute">position</span>: absolute;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* ç›¸å¯¹äºçˆ¶å…ƒç´ å·¦ç§»50% */</span>
      <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>; <span class="hljs-comment">/* ç›¸å¯¹äºçˆ¶å…ƒç´ ä¸Šç§»50% */</span>
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>); <span class="hljs-comment">/* è‡ªèº«å›ç§»50%ï¼Œå®ç°å®Œç¾å±…ä¸­ */</span>
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"center-box"</span>&gt;</span>å±…ä¸­å•¦<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘æ˜¯çˆ¶å…ƒç´ çš„æ–‡æœ¬ï¼Œä¸ä¼šè¢«ç»å¯¹å®šä½å…ƒç´ å½±å“<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æˆ‘åœ¨æ–‡æ¡£æµä¸­ï¼Œä¼šè¡¥åˆ°çˆ¶å…ƒç´ ä¸‹æ–¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">å®æˆ˜æ¡ˆä¾‹2ï¼šæ— å‚è€ƒå…ƒç´ æ—¶çš„å®šä½</h4>
<p>å¦‚æœabsoluteå…ƒç´ æ²¡æœ‰å·²å®šä½çš„ç¥–å…ˆï¼Œå°±ä¼šç›¸å¯¹äºæµè§ˆå™¨çª—å£å®šä½ï¼Œä¸”ä¼šè·Ÿéšé¡µé¢æ»šåŠ¨ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.float-box</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">120px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f472b6</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">40px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}
</code></pre>
<h3 data-id="heading-13">4. position: fixed å›ºå®šå®šä½ï¼ˆæ‚¬æµ®å…ƒç´ ä¸“å±ï¼‰</h3>
<p>fixedå’Œabsoluteå¾ˆåƒï¼Œéƒ½ä¼šè„±ç¦»æ–‡æ¡£æµï¼Œä½†å®ƒçš„å®šä½åŸºå‡†æ˜¯ã€Œæµè§ˆå™¨çª—å£ã€ï¼ˆè§†å£ï¼‰ï¼Œè€Œä¸”<strong>ä¸ä¼šéšé¡µé¢æ»šåŠ¨è€Œç§»åŠ¨</strong>ï¼Œå°±åƒç²˜åœ¨çª—æˆ·ä¸Šçš„ä¾¿åˆ©è´´ã€‚</p>
<h4 data-id="heading-14">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>è„±ç¦»æ–‡æ¡£æµ</strong>ï¼šä¸å æ®ç©ºé—´ï¼Œä¸absoluteä¸€è‡´</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼šæµè§ˆå™¨è§†å£ï¼ˆçª—å£ï¼‰ï¼Œä¸å—ç¥–å…ˆå…ƒç´ å½±å“</li>
<li><strong>æ»šåŠ¨æ— å…³</strong>ï¼šé¡µé¢æ»šåŠ¨æ—¶ï¼Œå…ƒç´ ä½ç½®å§‹ç»ˆå›ºå®šåœ¨è§†å£çš„æŸä¸ªåœ°æ–¹</li>
<li><strong>å¸¸è§åœºæ™¯</strong>ï¼šé¡¶éƒ¨å¯¼èˆªæ ã€å³ä¾§æ‚¬æµ®å¹¿å‘Šã€å›åˆ°é¡¶éƒ¨æŒ‰é’®ã€å¼¹çª—é®ç½©</li>
</ul>
<h4 data-id="heading-15">å®æˆ˜æ¡ˆä¾‹ï¼šå³ä¸‹è§’æ‚¬æµ®æŒ‰é’®</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Fixed å›ºå®šå®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; <span class="hljs-comment">/* åˆ¶é€ é•¿é¡µé¢ï¼Œæ–¹ä¾¿æµ‹è¯•æ»šåŠ¨ */</span> }
    
    <span class="hljs-selector-class">.parent</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
    }
    
    <span class="hljs-selector-class">.box</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#74c69d</span>;
    }
    
    <span class="hljs-comment">/* å›ºå®šåœ¨å³ä¸‹è§’çš„æ‚¬æµ®æŒ‰é’® */</span>
    <span class="hljs-selector-class">.fixed-btn</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2563eb</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">cursor</span>: pointer;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.2</span>);
    }
    
    <span class="hljs-comment">/* å›ºå®šåœ¨é¡¶éƒ¨çš„å¯¼èˆªæ  */</span>
    <span class="hljs-selector-class">.nav</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#1e40af</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">60px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>; <span class="hljs-comment">/* å·¦å³è®¾ä¸º0ï¼Œå®ç°å®½åº¦è‡ªé€‚åº” */</span>
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav"</span>&gt;</span>å›ºå®šå¯¼èˆªæ <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-top: 80px;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span>Hello CSS<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fixed-btn"</span>&gt;</span>å›åˆ°é¡¶éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-comment">// å®ç°å›åˆ°é¡¶éƒ¨åŠŸèƒ½</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.fixed-btn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> });
    });
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>ç§»åŠ¨ç«¯æ³¨æ„</strong>ï¼šfixedåœ¨iOSçš„Safariä¸­å¯èƒ½ä¼šæœ‰æ»šåŠ¨æŠ–åŠ¨é—®é¢˜ï¼Œå¯é€šè¿‡ç»™bodyæ·»åŠ <code>overflow-x: hidden;</code>æˆ–ä½¿ç”¨stickyæ›¿ä»£ï¼ˆè§†åœºæ™¯è€Œå®šï¼‰ã€‚</p>
<h3 data-id="heading-16">5. position: sticky ç²˜æ€§å®šä½ï¼ˆæ··åˆå®šä½ç¥å™¨ï¼‰</h3>
<p>stickyæ˜¯relativeå’Œfixedçš„ã€Œæ··åˆä½“ã€ï¼Œå…ƒç´ åœ¨æ»šåŠ¨åˆ°æŸä¸ªé˜ˆå€¼å‰è¡¨ç°ä¸ºrelativeï¼ˆéµå¾ªæ–‡æ¡£æµï¼‰ï¼Œè¾¾åˆ°é˜ˆå€¼åè¡¨ç°ä¸ºfixedï¼ˆå›ºå®šåœ¨è§†å£ï¼‰ï¼Œå°±åƒè´´åœ¨é¡µé¢ä¸Šçš„ä¾¿åˆ©è´´ï¼Œæ»šåŠ¨åˆ°ç‰¹å®šä½ç½®æ‰ä¼š"ç²˜ä½"ã€‚</p>
<h4 data-id="heading-17">æ ¸å¿ƒç‰¹æ€§</h4>
<ul>
<li><strong>é˜ˆå€¼è§¦å‘</strong>ï¼šå¿…é¡»é€šè¿‡<code>top/bottom/left/right</code>è®¾ç½®è§¦å‘é˜ˆå€¼ï¼ˆå¦åˆ™æ— æ•ˆï¼‰</li>
<li><strong>å®šä½åŸºå‡†</strong>ï¼šæœªè§¦å‘æ—¶æ˜¯è‡ªèº«åŸå§‹ä½ç½®ï¼ˆrelativeï¼‰ï¼Œè§¦å‘åæ˜¯è§†å£ï¼ˆfixedï¼‰</li>
<li><strong>çˆ¶å…ƒç´ é™åˆ¶</strong>ï¼šstickyå…ƒç´ çš„å›ºå®šèŒƒå›´ä¸ä¼šè¶…å‡ºå®ƒçš„çˆ¶å…ƒç´ ï¼ˆè¿™ç‚¹å’Œfixedä¸åŒï¼‰</li>
<li><strong>å¸¸è§åœºæ™¯</strong>ï¼šè¡¨æ ¼æ ‡é¢˜ã€åˆ—è¡¨åˆ†ç±»æ ‡é¢˜ã€æ»šåŠ¨æ—¶è·Ÿéšçš„ä¾§è¾¹æ </li>
</ul>
<h4 data-id="heading-18">å®æˆ˜æ¡ˆä¾‹ï¼šæ»šåŠ¨æ—¶ç²˜ä½çš„æ ‡é¢˜</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Sticky ç²˜æ€§å®šä½<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; }
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">2000px</span>; }
    
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">50px</span> auto;
    }
    
    <span class="hljs-selector-class">.section</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
    }
    
    <span class="hljs-comment">/* ç²˜æ€§æ ‡é¢˜ï¼šæ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨50pxæ—¶ç²˜ä½ */</span>
    <span class="hljs-selector-class">.sticky-title</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2563eb</span>;
      <span class="hljs-attribute">color</span>: white;
      <span class="hljs-attribute">position</span>: sticky;
      <span class="hljs-attribute">top</span>: <span class="hljs-number">50px</span>; <span class="hljs-comment">/* è§¦å‘é˜ˆå€¼ï¼šè·ç¦»è§†å£é¡¶éƒ¨50px */</span>
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span> <span class="hljs-number">4px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-selector-class">.content</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eff6ff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">4px</span>;
    }
    
    <span class="hljs-comment">/* é¡¶éƒ¨å ä½ï¼Œæ¨¡æ‹Ÿé¡µé¢å†…å®¹ */</span>
    <span class="hljs-selector-class">.header</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffccd5</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>æ»šåŠ¨é¡µé¢ï¼Œçœ‹ä¸‹é¢çš„æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sticky-title"</span>&gt;</span>ç¬¬ä¸€éƒ¨åˆ†æ ‡é¢˜ï¼ˆä¼šç²˜ä½ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>ç¬¬ä¸€éƒ¨åˆ†å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sticky-title"</span>&gt;</span>ç¬¬äºŒéƒ¨åˆ†æ ‡é¢˜ï¼ˆä¼šç²˜ä½ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>ç¬¬äºŒéƒ¨åˆ†å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"section"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sticky-title"</span>&gt;</span>ç¬¬ä¸‰éƒ¨åˆ†æ ‡é¢˜ï¼ˆä¼šç²˜ä½ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>ç¬¬ä¸‰éƒ¨åˆ†å†…å®¹...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>æ–°æ‰‹é¿å‘</strong>ï¼šstickyçš„çˆ¶å…ƒç´ ä¸èƒ½æœ‰<code>overflow: hidden/auto/scroll</code>å±æ€§ï¼Œå¦åˆ™ç²˜æ€§æ•ˆæœä¼šå¤±æ•ˆï¼ˆçˆ¶å…ƒç´ çš„æ»šåŠ¨ä¼š"å›°ä½"stickyå…ƒç´ ï¼‰ã€‚</p>
<h2 data-id="heading-19">ä¸‰ã€ä¸€å¼ è¡¨ç†æ¸…5ç§å®šä½çš„æ ¸å¿ƒåŒºåˆ«</h2>
<p>è¿™å¼ å¯¹æ¯”è¡¨æ˜¯å®šä½çŸ¥è¯†çš„ã€Œç²¾åæ€»ç»“ã€ï¼Œå»ºè®®æ”¶è—èµ·æ¥ï¼Œé‡åˆ°å¸ƒå±€é—®é¢˜æ—¶éšæ—¶æŸ¥é˜…ï¼š</p>















































<table><thead><tr><th>å®šä½æ–¹å¼</th><th>æ˜¯å¦è„±ç¦»æ–‡æ¡£æµ</th><th>å®šä½åŸºå‡†</th><th>åç§»å±æ€§æ˜¯å¦ç”Ÿæ•ˆ</th><th>æ ¸å¿ƒåº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><code>static</code></td><td>å¦</td><td>æ­£å¸¸æ–‡æ¡£æµ</td><td>æ— æ•ˆ</td><td>é»˜è®¤å¸ƒå±€ã€å–æ¶ˆå®šä½</td></tr><tr><td><code>relative</code></td><td>å¦</td><td>è‡ªèº«åŸå§‹ä½ç½®</td><td>ç”Ÿæ•ˆ</td><td>å¾®è°ƒä½ç½®ã€ç»™absoluteå½“å‚è€ƒ</td></tr><tr><td><code>absolute</code></td><td>æ˜¯</td><td>æœ€è¿‘å·²å®šä½ç¥–å…ˆ/è§†å£</td><td>ç”Ÿæ•ˆ</td><td>å¼¹å‡ºå±‚ã€èœå•ã€ç²¾å‡†å®šä½</td></tr><tr><td><code>fixed</code></td><td>æ˜¯</td><td>æµè§ˆå™¨è§†å£</td><td>ç”Ÿæ•ˆ</td><td>å¯¼èˆªæ ã€æ‚¬æµ®æŒ‰é’®ã€é®ç½©</td></tr><tr><td><code>sticky</code></td><td>å¦â†’æ˜¯ï¼ˆé˜ˆå€¼è§¦å‘ï¼‰</td><td>è‡ªèº«ä½ç½®â†’è§†å£</td><td>ç”Ÿæ•ˆï¼ˆéœ€è®¾é˜ˆå€¼ï¼‰</td><td>è¡¨æ ¼æ ‡é¢˜ã€æ»šåŠ¨è·Ÿéšæ ‡é¢˜</td></tr></tbody></table>
<h2 data-id="heading-20">å››ã€å®æˆ˜æŠ€å·§ä¸å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-21">1. ç»å¯¹å®šä½å…ƒç´ å±…ä¸­çš„3ç§æ–¹æ³•</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ–¹æ³•1ï¼šleft/top 50% + transformï¼ˆæœ€æ¨èï¼Œæ”¯æŒè‡ªé€‚åº”ï¼‰ */</span>
<span class="hljs-selector-class">.absolute-center</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
}

<span class="hljs-comment">/* æ–¹æ³•2ï¼šmargin auto + å››ä¸ªæ–¹å‘è®¾ä¸º0ï¼ˆéœ€å›ºå®šå®½é«˜ï¼‰ */</span>
<span class="hljs-selector-class">.absolute-center</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">margin</span>: auto;
}

<span class="hljs-comment">/* æ–¹æ³•3ï¼šcalcè®¡ç®—ï¼ˆéœ€å›ºå®šå®½é«˜ï¼‰ */</span>
<span class="hljs-selector-class">.absolute-center</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">left</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">100px</span>); <span class="hljs-comment">/* å®½200pxï¼Œ100pxæ˜¯å®½çš„ä¸€åŠ */</span>
  <span class="hljs-attribute">top</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">50%</span> - <span class="hljs-number">100px</span>);
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
}
</code></pre>
<h3 data-id="heading-22">2. å®šä½å…ƒç´ çš„å±‚çº§é—®é¢˜ï¼ˆz-indexï¼‰</h3>
<ul>
<li><strong>é»˜è®¤å±‚çº§</strong>ï¼šè„±ç¦»æ–‡æ¡£æµçš„å…ƒç´ ï¼ˆabsolute/fixedï¼‰å±‚çº§é«˜äºæ–‡æ¡£æµä¸­çš„å…ƒç´ </li>
<li><strong>z-indexä½œç”¨</strong>ï¼šæ•°å€¼è¶Šå¤§ï¼Œå±‚çº§è¶Šé«˜ï¼ˆé»˜è®¤autoï¼Œç­‰ä»·äº0ï¼‰ï¼Œä»…å¯¹å·²å®šä½å…ƒç´ ç”Ÿæ•ˆ</li>
<li><strong>å±‚çº§ç»§æ‰¿</strong>ï¼šå­å…ƒç´ çš„å±‚çº§å—çˆ¶å…ƒç´ å½±å“ï¼Œçˆ¶å…ƒç´ å±‚çº§ä½ï¼Œå­å…ƒç´ å†é«˜ä¹Ÿæ— æ³•è¶…è¿‡çˆ¶å…ƒç´ çš„åŒçº§å…ƒç´ </li>
</ul>
<h3 data-id="heading-23">3. æ–°æ‰‹æœ€å®¹æ˜“è¸©çš„å‘</h3>
<ol>
<li><strong>absoluteå…ƒç´ æ‰¾ä¸åˆ°å‚è€ƒç‚¹</strong>ï¼šå¿˜è®°ç»™çˆ¶å…ƒç´ è®¾relativeï¼Œå¯¼è‡´å…ƒç´ ç›¸å¯¹äºè§†å£å®šä½</li>
<li><strong>stickyæ•ˆæœå¤±æ•ˆ</strong>ï¼šæ²¡è®¾ç½®top/bottomç­‰é˜ˆå€¼ï¼Œæˆ–çˆ¶å…ƒç´ æœ‰overflowå±æ€§</li>
<li><strong>relativeå…ƒç´ å‹åˆ°å…¶ä»–å…ƒç´ </strong>ï¼šè¯¯ä»¥ä¸ºrelativeä¼šè„±ç¦»æ–‡æ¡£æµï¼Œå…¶å®å®ƒåªæ˜¯åç§»ï¼Œä¸ä¼šè®©å…¶ä»–å…ƒç´ è¡¥ä½</li>
<li><strong>fixedåœ¨ç§»åŠ¨ç«¯æŠ–åŠ¨</strong>ï¼šå¯å°è¯•ç”¨stickyæ›¿ä»£ï¼Œæˆ–ç»™bodyæ·»åŠ <code>position: fixed;</code>ï¼ˆè§†åœºæ™¯è°ƒæ•´ï¼‰</li>
</ol>
<h2 data-id="heading-24">äº”ã€æ€»ç»“ï¼šå®šä½çš„æ ¸å¿ƒä½¿ç”¨åŸåˆ™</h2>
<p>CSSå®šä½çš„æ ¸å¿ƒä¸æ˜¯æ­»è®°ç¡¬èƒŒï¼Œè€Œæ˜¯æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œè®°ä½è¿™å‡ ä¸ªåŸåˆ™ï¼š</p>
<ul>
<li><strong>ç®€å•å¸ƒå±€ç”¨é»˜è®¤</strong>ï¼šä¸éœ€è¦ç‰¹æ®Šå®šä½æ—¶ï¼Œç”¨staticéµå¾ªæ–‡æ¡£æµå³å¯</li>
<li><strong>å¾®è°ƒä½ç½®ç”¨relative</strong>ï¼šå…ƒç´ éœ€è¦å°å¹…åº¦åç§»ï¼Œä¸”ä¸å½±å“å…¶ä»–å¸ƒå±€æ—¶ç”¨å®ƒ</li>
<li><strong>ç‹¬ç«‹ç»„ä»¶ç”¨absolute</strong>ï¼šå¼¹å‡ºå±‚ã€ä¸‹æ‹‰èœå•ç­‰éœ€è¦è„±ç¦»æ–‡æ¡£æµçš„ç»„ä»¶ç”¨å®ƒï¼Œè®°å¾—ç»™çˆ¶å…ƒç´ åŠ relative</li>
<li><strong>æ‚¬æµ®å…ƒç´ ç”¨fixed</strong>ï¼šå¯¼èˆªæ ã€å›åˆ°é¡¶éƒ¨æŒ‰é’®ç­‰éœ€è¦å§‹ç»ˆå¯è§çš„å…ƒç´ ç”¨å®ƒ</li>
<li><strong>æ»šåŠ¨è·Ÿéšç”¨sticky</strong>ï¼šè¡¨æ ¼æ ‡é¢˜ã€åˆ†ç±»æ ‡é¢˜ç­‰éœ€è¦æ»šåŠ¨åˆ°ç‰¹å®šä½ç½®æ‰å›ºå®šçš„å…ƒç´ ç”¨å®ƒ</li>
</ul>
<p>æœ€åï¼Œå®šä½å¸ƒå±€æ²¡æœ‰ç»å¯¹çš„"æœ€ä½³æ–¹æ¡ˆ"ï¼Œåªæœ‰"æœ€é€‚åˆåœºæ™¯"çš„æ–¹æ¡ˆã€‚å»ºè®®å¤šå†™æ¡ˆä¾‹æµ‹è¯•ï¼Œäº²æ‰‹æ„Ÿå—æ¯ç§å®šä½çš„å·®å¼‚â€”â€”å®è·µæ‰æ˜¯æŒæ¡CSSå®šä½çš„æœ€å¥½æ–¹æ³•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VUEåå°ç®¡ç†ç³»ç»Ÿï¼šå®šåˆ¶åŒ–ã€é«˜å¯ç”¨å‰å°æ ·å¼å¤„ç†æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7575112613778309154</link>    <guid>https://juejin.cn/post/7575112613778309154</guid>    <pubDate>2025-11-23T12:32:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7575112613778309154" data-draft-id="7575112613778194466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VUEåå°ç®¡ç†ç³»ç»Ÿï¼šå®šåˆ¶åŒ–ã€é«˜å¯ç”¨å‰å°æ ·å¼å¤„ç†æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-11-23T12:32:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»˜æµ·ç¬‘"/> <meta itemprop="url" content="https://juejin.cn/user/3246223221632151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VUEåå°ç®¡ç†ç³»ç»Ÿï¼šå®šåˆ¶åŒ–ã€é«˜å¯ç”¨å‰å°æ ·å¼å¤„ç†æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3246223221632151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»˜æµ·ç¬‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-23T12:32:03.000Z" title="Sun Nov 23 2025 12:32:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-23
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å­¦ä¹ å‰æ</h3>
<p>ä¼šåŸºæœ¬çš„vueï¼Œä¼šä½¿ç”¨AIåŠ©æ‰‹ï¼Œ<strong><code>å­¦ä¹ æœ¬è¯¾æœ¬çš„äººå¿…é¡»é•¿å¾—å¸…ã€‚</code></strong></p>
<h3 data-id="heading-1">å®‰è£…tailwindcss</h3>
<pre><code class="hljs language-js" lang="js">npm install -D tailwindcss postcss autoprefixer

npx tailwindcss init -p
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcc0001526ff48d38725eddd519d44c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764505923&amp;x-signature=o25eaQkR1pxyzc7arJuhvU24qGo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">é…ç½®æ–‡ä»¶è¯´æ˜</h2>
<p>tailwind.config.jsÂ - å·²é…ç½®ä¸ºæ‰«ææ‰€æœ‰ Vue æ–‡ä»¶ï¼š</p>
<ul>
<li>./index.html</li>
</ul>

<ul>
<li>./src/**/*.{vue,js,ts,jsx,tsx}</li>
</ul>
<p>postcss.config.jsÂ - å·²é…ç½® Tailwind å’Œ Autoprefixer æ’ä»¶main.scssÂ - å·²æ·»åŠ  Tailwind æŒ‡ä»¤ï¼š</p>
<p>@tailwindÂ base;</p>
<p>@tailwindÂ components;</p>
<p>@tailwindÂ utilities;</p>
<h2 data-id="heading-3">ä½¿ç”¨ç¤ºä¾‹</h2>
<p>å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥åœ¨ Vue ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ Tailwind ç±»åï¼š</p>

<p>å®Œæˆåï¼ŒTailwind CSS å³å¯åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<p>ä½†æ˜¯å¯åŠ¨é¡¹ç›®é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5605be957d7a402ca0720a5b104efa82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764505923&amp;x-signature=GgBJNTwJBssvLO5QO%2FWQu9E3hq0%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™æ˜¯ Tailwind CSS v4 çš„å˜åŒ–ã€‚æ£€æŸ¥å½“å‰å®‰è£…çš„ç‰ˆæœ¬ï¼Œç„¶åæä¾›è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å®‰è£…çš„æ˜¯ Tailwind CSS v4.1.17ã€‚v4 å°† PostCSSÂ æ’ä»¶ç§»åˆ°äº†Â @tailwindcss/postcssï¼Œå› æ­¤éœ€è¦è°ƒæ•´é…ç½®ã€‚æä¾›ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>æ–¹æ¡ˆ 1ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨ Tailwind CSS v3ï¼ˆæ›´ç¨³å®šï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰</li>
</ul>

<ul>
<li>æ–¹æ¡ˆÂ 2ï¼šä½¿ç”¨ Tailwind CSS v4ï¼ˆéœ€è¦å®‰è£…Â @tailwindcss/postcssï¼‰</li>
</ul>
<p>å…ˆæŒ‰æ–¹æ¡ˆ 1 å¤„ç†ï¼šé™çº§åˆ° v3 å¹¶æ›´æ–°é…ç½®ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ç°åœ¨ä½¿ç”¨æ–¹æ¡ˆ1ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81cee420cfc2452182e13639c83b51a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764505923&amp;x-signature=mEevdJGK19fIM7XAnTZp13eebqs%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">å°è¯•ç‰›åˆ€</h3>
<p>ç°åœ¨å®‰è£…å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¯¹è€é¡¹ç›®åŸæ¥çš„ä¼ ç»Ÿçš„cssçš„å†™æ³•ï¼Œä¿®æ”¹åˆ‡æ¢æˆtailwindcssæ–¹å¼æ›´æ–°ã€‚</p>
<h3 data-id="heading-5">è¿ç§»ç­–ç•¥æ¦‚è¿°</h3>
<p>è¿ç§»åŸåˆ™ï¼š</p>
<ol>
<li>ä¿ç•™å¿…è¦çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æ ·å¼è¦†ç›–ï¼ˆå¦‚Â Element Plusï¼‰</li>
</ol>

<ol start="2">
<li>å°†å¯è½¬æ¢çš„æ ·å¼æ”¹ä¸º Tailwind å®ç”¨ç±»</li>
</ol>

<ol start="3">
<li>ä½¿ç”¨ Tailwind çš„é…ç½®ç³»ç»Ÿç®¡ç†è®¾è®¡å˜é‡</li>
</ol>

<ol start="4">
<li>åˆ©ç”¨Â @layerÂ å’ŒÂ @applyÂ å¤„ç†å…¨å±€æ ·å¼</li>
</ol>
<h4 data-id="heading-6">1.Â tailwind.config.jsÂ - ä¸»é¢˜é…ç½®æ‰©å±•</h4>
<p>ç›®çš„ï¼šå°† SCSSÂ å˜é‡æ˜ å°„ä¸º TailwindÂ ä¸»é¢˜ï¼Œç»Ÿä¸€ç®¡ç†è®¾è®¡å˜é‡ã€‚æ”¹åŠ¨å†…å®¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">theme</span>: {
  <span class="hljs-attr">extend</span>: {
    <span class="hljs-comment">// è‡ªå®šä¹‰é¢œè‰²ç³»ç»Ÿ</span>
    <span class="hljs-attr">colors</span>: {
      <span class="hljs-attr">menu</span>: {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'#bfcbd9'</span>,           <span class="hljs-comment">// èœå•æ–‡å­—é¢œè‰²</span>
        <span class="hljs-string">'active-text'</span>: <span class="hljs-string">'#ffffff'</span>,   <span class="hljs-comment">// æ¿€æ´»çŠ¶æ€æ–‡å­—</span>
        <span class="hljs-attr">bg</span>: <span class="hljs-string">'#304156'</span>,              <span class="hljs-comment">// èœå•èƒŒæ™¯è‰²</span>
        <span class="hljs-attr">hover</span>: <span class="hljs-string">'#263445'</span>,           <span class="hljs-comment">// æ‚¬åœçŠ¶æ€</span>
        <span class="hljs-comment">// ...</span>
      },
      <span class="hljs-attr">login</span>: {
        <span class="hljs-attr">bg</span>: <span class="hljs-string">'#2d3a4b'</span>,
        <span class="hljs-string">'dark-gray'</span>: <span class="hljs-string">'#889aa4'</span>,
        <span class="hljs-comment">// ...</span>
      }
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰å®½åº¦</span>
    <span class="hljs-attr">width</span>: {
      <span class="hljs-attr">sidebar</span>: <span class="hljs-string">'210px'</span>,
      <span class="hljs-string">'sidebar-hide'</span>: <span class="hljs-string">'54px'</span>,
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰è¿‡æ¸¡æ—¶é—´</span>
    <span class="hljs-attr">transitionDuration</span>: {
      <span class="hljs-attr">sidebar</span>: <span class="hljs-string">'0.28s'</span>,
    },
    <span class="hljs-comment">// è‡ªå®šä¹‰å­—ä½“æ—</span>
    <span class="hljs-attr">fontFamily</span>: {
      <span class="hljs-attr">sans</span>: [<span class="hljs-string">'Helvetica Neue'</span>, <span class="hljs-string">'PingFang SC'</span>, ...],
    }
  }
}
</code></pre>
<p>æ•™å­¦è¦ç‚¹ï¼š</p>
<ul>
<li>extendÂ ç”¨äºæ‰©å±•è€Œéè¦†ç›–é»˜è®¤ä¸»é¢˜</li>
</ul>

<ul>
<li>åµŒå¥—å¯¹è±¡ä¼šç”Ÿæˆå¯¹åº”çš„ç±»åï¼Œå¦‚Â bg-menu-bgã€text-menu-text</li>
</ul>

<ul>
<li>ä½¿ç”¨è¿å­—ç¬¦çš„é”®åï¼ˆå¦‚Â 'active-text'ï¼‰éœ€è¦ç”¨å¼•å·åŒ…è£¹</li>
</ul>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>

<p><code>&lt;divÂ :style="{Â backgroundColor:Â $menuBgÂ }"&gt;</code></p>

<p><code>&lt;divÂ class="bg-menu-bgÂ text-menu-text"&gt;</code></p>
<hr/>
<h4 data-id="heading-7">2.Â postcss.config.jsÂ -Â PostCSS é…ç½®</h4>
<p>ç›®çš„ï¼šé…ç½® PostCSS å¤„ç† TailwindÂ CSSã€‚æ”¹åŠ¨å†…å®¹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-attr">tailwindcss</span>: {},    <span class="hljs-comment">// Tailwind CSS æ’ä»¶</span>
    <span class="hljs-attr">autoprefixer</span>: {},   <span class="hljs-comment">// è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€</span>
  },
}
</code></pre>
<ul>
<li>Vite ä¼šè‡ªåŠ¨è¯»å–æ­¤æ–‡ä»¶</li>
</ul>

<ul>
<li>æ’ä»¶é¡ºåºå¾ˆé‡è¦ï¼šå…ˆ Tailwindï¼Œå Autoprefixer</li>
</ul>

<ul>
<li>Autoprefixer ä¼šè‡ªåŠ¨å¤„ç†æµè§ˆå™¨å…¼å®¹æ€§</li>
</ul>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€å…¨å±€æ ·å¼æ–‡ä»¶æ”¹åŠ¨</h3>
<h4 data-id="heading-9">3.Â src/assets/main.scssÂ - å…¨å±€æ ·å¼é‡æ„</h4>
<p>æ”¹åŠ¨å‰ï¼š</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/variables.scss'</span>;
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/mixin.scss'</span>;
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/sidebar.scss'</span>;

html, body {
  <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>%;
  <span class="hljs-attr">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attr">padding</span>: <span class="hljs-number">0</span>;
  font-<span class="hljs-attr">family</span>: <span class="hljs-title class_">Helvetica</span> <span class="hljs-title class_">Neue</span>, ...;
}

.<span class="hljs-property">clearfix</span> {
  &amp;:after {
    <span class="hljs-attr">visibility</span>: hidden;
    <span class="hljs-attr">display</span>: block;
    font-<span class="hljs-attr">size</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attr">content</span>: <span class="hljs-string">' '</span>;
    <span class="hljs-attr">clear</span>: both;
    <span class="hljs-attr">height</span>: <span class="hljs-number">0</span>;
  }
}
</code></pre>
<p>æ”¹åŠ¨åï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. å¼•å…¥ Tailwind æ ¸å¿ƒæŒ‡ä»¤</span>
@tailwind base;
@tailwind components;
@tailwind utilities;

<span class="hljs-comment">// 2. ä¿ç•™å¿…è¦çš„ SCSS æ–‡ä»¶ï¼ˆåŒ…å« Element Plus æ ·å¼è¦†ç›–ï¼‰</span>
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/variables.scss'</span>;
@<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/sidebar.scss'</span>;

<span class="hljs-comment">// 3. ä½¿ç”¨ @layer base å®šä¹‰åŸºç¡€æ ·å¼</span>
@layer base {
  html, body {
    @apply h-full m-<span class="hljs-number">0</span> p-<span class="hljs-number">0</span>;
    -moz-osx-font-<span class="hljs-attr">smoothing</span>: grayscale;
    -webkit-font-<span class="hljs-attr">smoothing</span>: antialiased;
    text-<span class="hljs-attr">rendering</span>: optimizeLegibility;
  }
  
  #app {
    @apply h-full;
  }
  
  <span class="hljs-comment">// å…¨å±€é‡ç½®</span>
  *, *:before, *:after {
    @apply box-border m-<span class="hljs-number">0</span> p-<span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// 4. ä½¿ç”¨ @layer utilities å®šä¹‰å·¥å…·ç±»</span>
@layer utilities {
  .<span class="hljs-property">clearfix</span> {
    &amp;::after {
      @apply invisible block clear-both h-<span class="hljs-number">0</span>;
      font-<span class="hljs-attr">size</span>: <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ³¨æ„ï¼šTailwind æ²¡æœ‰ text-0ï¼Œéœ€è¦ç›´æ¥å†™ CSS</span>
      <span class="hljs-attr">content</span>: <span class="hljs-string">' '</span>;
    }
  }
}
</code></pre>
<ol>
<li>Tailwind æŒ‡ä»¤é¡ºåºï¼š</li>
</ol>
<ul>
<li>@tailwindÂ baseÂ - åŸºç¡€æ ·å¼é‡ç½®</li>
</ul>

<ul>
<li>@tailwind componentsÂ - ç»„ä»¶å±‚</li>
</ul>

<ul>
<li>@tailwind utilitiesÂ - å·¥å…·ç±»</li>
</ul>
<ol start="2">
<li>@layerÂ çš„ä½œç”¨ï¼š</li>
</ol>
<ul>
<li>@layer baseï¼šåŸºç¡€æ ·å¼ï¼Œä¼˜å…ˆçº§æœ€ä½</li>
</ul>

<ul>
<li>@layer componentsï¼šç»„ä»¶æ ·å¼</li>
</ul>

<ul>
<li>@layerÂ utilitiesï¼šå·¥å…·ç±»ï¼Œä¼˜å…ˆçº§æœ€é«˜</li>
</ul>
<ol start="3">
<li>@applyÂ çš„ä½¿ç”¨ï¼š</li>
</ol>
<ul>
<li>åœ¨ CSSÂ ä¸­ä½¿ç”¨ Tailwind ç±»</li>
</ul>

<ul>
<li>åªèƒ½ç”¨äºÂ @layerÂ å†…</li>
</ul>

<ul>
<li>ä¸èƒ½ç”¨äºä¼ªç±»é€‰æ‹©å™¨ï¼ˆå¦‚Â :hoverï¼‰</li>
</ul>
<p>.  æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ç§»é™¤äº†Â mixin.scssÂ å¯¼å…¥ï¼ˆclearfix å·²ç”¨ Tailwind å®ç°ï¼‰</li>
</ul>

<ul>
<li>ä¿ç•™äº†Â variables.scssï¼ˆå¯èƒ½è¢« JS é€šè¿‡Â :exportÂ ä½¿ç”¨ï¼‰</li>
</ul>

<ul>
<li>ä¿ç•™äº†Â sidebar.scssï¼ˆåŒ…å« Element PlusÂ æ ·å¼è¦†ç›–ï¼‰</li>
</ul>
<p>å…¶æ¬¡ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„ç”¨æ³•</p>
<ol>
<li>ç±»åæ˜ å°„ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">    Â Â Â <span class="hljs-comment">//Â SCSSÂ â†’Â Tailwind</span>
    Â Â Â <span class="hljs-attr">position</span>:Â relative;Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"relative"</span>
    Â Â Â <span class="hljs-attr">height</span>:Â <span class="hljs-number">100</span>%;Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"h-full"</span>
    Â Â Â <span class="hljs-attr">width</span>:Â <span class="hljs-number">100</span>%;Â Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"w-full"</span>
    Â Â Â <span class="hljs-attr">position</span>:Â fixed;Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"fixed"</span>
    Â Â Â <span class="hljs-attr">top</span>:Â <span class="hljs-number">0</span>;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"top-0"</span>
    Â Â Â z-<span class="hljs-attr">index</span>:Â <span class="hljs-number">9</span>;Â Â Â Â Â Â Â Â Â Â Â Â Â â†’Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"z-[9]"</span>
</code></pre>

<ol>
<li>åŠ¨æ€å€¼å¤„ç†ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">    Â Â Â <span class="hljs-comment">//Â SCSSÂ å˜é‡</span>

    Â Â Â <span class="hljs-attr">width</span>:Â <span class="hljs-title function_">calc</span>(<span class="hljs-number">100</span>%Â -Â #{$sideBarWidth});
    Â Â Â <span class="hljs-comment">//Â TailwindÂ ä»»æ„å€¼è¯­æ³•</span>
    Â Â Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"w-[calc(100%-210px)]"</span>
</code></pre>

<ol>
<li>è¿‡æ¸¡åŠ¨ç”»ï¼š</li>
</ol>
<pre><code class="hljs language-js" lang="js">    Â Â Â <span class="hljs-comment">//Â SCSS</span>
    Â Â Â <span class="hljs-attr">transition</span>:Â margin-leftÂ <span class="hljs-number">0.</span>28s;
    Â Â Â <span class="hljs-comment">//Â Tailwind</span>
    Â Â Â <span class="hljs-keyword">class</span>=<span class="hljs-string">"transition-[margin-left]Â duration-[0.28s]"</span>
</code></pre>

<ol>
<li>ä¼˜åŠ¿ï¼š</li>
</ol>
<ul>
<li>æ ·å¼ä¸Â HTML åœ¨ä¸€èµ·ï¼Œæ›´ç›´è§‚</li>
</ul>

<ul>
<li>ä¸éœ€è¦åœ¨Â Â å’Œæ¨¡æ¿é—´åˆ‡æ¢
</li></ul>

<ul>
<li>å‡å°‘æ–‡ä»¶ä½“ç§¯ï¼ˆTailwind ä¼šÂ tree-shake æœªä½¿ç”¨çš„ç±»ï¼‰</li>
</ul>
<h3 data-id="heading-10">æºç ï¼š</h3>
<p>å‡çº§å®‰è£…ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin%2Fcommit%2Ff006923ce7a4869ad71c4edf83a81f9bd34de37f" target="_blank" title="https://github.com/mohaixiao/vue-admin/commit/f006923ce7a4869ad71c4edf83a81f9bd34de37f" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p>
<p>æ”¹é€ ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin%2Fcommit%2Fb1bb1408975bde2fcb1de467d45d606d10b20c86" target="_blank" title="https://github.com/mohaixiao/vue-admin/commit/b1bb1408975bde2fcb1de467d45d606d10b20c86" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p>
<p>æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin" target="_blank" title="https://github.com/mohaixiao/vue-admin" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>