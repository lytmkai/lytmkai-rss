<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Flutter Zero 是什么？它的出现有什么意义？为什么你需要了解下？]]></title>    <link>https://juejin.cn/post/7603769956976377897</link>    <guid>https://juejin.cn/post/7603769956976377897</guid>    <pubDate>2026-02-08T22:58:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956976377897" data-draft-id="7603895839556796479" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter Zero 是什么？它的出现有什么意义？为什么你需要了解下？"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-02-08T22:58:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter Zero 是什么？它的出现有什么意义？为什么你需要了解下？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T22:58:59.000Z" title="Sun Feb 08 2026 22:58:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><code>flutter_zero</code></strong> 是一个由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fknopp" target="_blank" title="https://github.com/knopp" ref="nofollow noopener noreferrer"><code>knopp</code></a> 发起的实验性项目，它的核心目的是<strong>利用新的 Dart 特性（主要是 FFI）重新构想 Flutter 的架构，将 Flutter 的底层 Engine 从 C++ 迁移到 Dart，并解耦 <code>dart:ui</code></strong> 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00d87ebb0b0f4232b7e864569c1afc2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771196343&amp;x-signature=%2B84MkZ1IoU4b1AnfCUIxPxwv8GM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>如果你对 Knopp 陌生，那么现在认识下，Flutter PC 端和多窗口等功能，不少是他在参与维护。</p>
</blockquote>
<p>对于 <code>flutter_zero</code>， 这个项目的核心目标是：</p>
<ul>
<li>重写和瘦身： <code>flutter_zero</code> 试图通过全新 Dart FFI 等能力来替代原本由 C++ 实现的 Flutter 引擎的大部分功能</li>
<li><strong>解耦 <code>dart:ui</code></strong> ： 目前的 Flutter 中 <code>dart:ui</code> 是一个深度耦合的单体式库，充满了各种抽象层，而<code>flutter_zero</code> 试图将 <code>dart:ui</code> 模块化，让它不再强依赖于底层的 C++ 引擎，<strong>我相信你在看源码和 Debug 问题时，一定经历过 <code>dart:ui</code> 的痛</strong></li>
<li><strong>Dart 优先</strong> ：尽可能用 Dart 代码替换原本的 C++、Objective-C 或 Java 引擎代码，而不是通过传统的 Platform Channels，并且这并不会带来性能问题</li>
</ul>
<p>那为什么会有这样的想法？其实来自很多方面，比如：</p>
<ul>
<li>由于 Flutter 引擎是用 C++ 写的，构建成功高，而且没有 Hot Reload，修改容易崩溃，<strong>这导致引擎层的贡献者远少于框架层</strong>（Framework），而如果引擎逻辑更多地由 Dart 编写，社区开发者就能更容易地贡献代码，并且底层也能享受到 Dart 的 Hot Reload 支持</li>
<li>目前 Dart 生态被分为 “纯 Dart 项目” 和 “Flutter 项目” ，<strong>纯 Dart 包不能使用 Flutter 的类型（如 <code>Listenable</code>），因为它们绑定在 <code>dart:ui</code> 里</strong>，这导致库作者必须维护两套代码（例如 <code>signals_core</code> 和 <code>signals</code>），而如果将核心类型从 SDK 中剥离出来，变成独立的包（如 <code>package:flutter/ui.dart</code>），这样纯 Dart 项目也可以依赖这些基础类型，统一生态</li>
<li><code>dart:ui</code> 为了跨平台，只提供了“最小公分母”的 API，要访问特定平台的 API（如 iOS 的特定视图或输入法），必须使用 Platform Channels，但是写过的知道 ，Channel 麻烦不说，性能还不好，而如果内部直接使用 Dart 通过 FFI 直接与平台 API 交互，甚至是将原本在引擎里的底层功能（如无障碍功能、文本输入）移到 Dart 层来实现，这对性能也是一大提升</li>
</ul>
<p><strong>FFI 对比 Channel 能快多少，如果做过大数据频繁交互的应该有所体会，如果没有，看这个图也可以直观对比</strong> ：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c098f3c2eb164879b2c0d1ac2dc58bab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771196343&amp;x-signature=ZfzDioJ2XxeAjSFSgKNnDHaGz8Q%3D" alt="" loading="lazy"/></p>
<p>能看出区别吗：</p>
<ul>
<li>左边 Channel 模式获取系统电量，启动后可以看到先显示 0， 之后才显示电量</li>
<li>右边 FFI 启动时看到 UI 就是已经获取完电量显示了</li>
</ul>
<p>另外还有一个点，不管是<a href="https://juejin.cn/post/7602512064977207359" target="_blank" title="https://juejin.cn/post/7602512064977207359">小米系统应用切换成 Flutter+Rust</a> ，又或者之前 <a href="https://juejin.cn/post/7456407906634825755?searchId=202602090655257AD22001833CC236D282" target="_blank" title="https://juejin.cn/post/7456407906634825755?searchId=202602090655257AD22001833CC236D282">Oppo 的负一平和灵动岛使用的 Flutter</a> ，甚至<a href="https://juejin.cn/post/7289717829733908539" target="_blank" title="https://juejin.cn/post/7289717829733908539">微信小程序渲染引擎 skyline 使用 Flutter</a> ，它们都不是正常使用，而是各种魔改定制，但是目前的耦合加大了这种定制的成本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6288dc234baa41b7b4f278859e118f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771196343&amp;x-signature=g%2B05xsuh3PWrGDt%2BESpCDg8e4U4%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32d8e8f952bc4582b96750b4e571e26f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771196343&amp;x-signature=5zfnW8%2FcW14Y%2BwrdS%2B3aVutIsrc%3D" alt="" loading="lazy"/></p>
<p>例如嵌入式场景，遇到过一些在嵌入式系统，或者之前的 <a href="https://juejin.cn/post/7392134036845953050" target="_blank" title="https://juejin.cn/post/7392134036845953050">LG 电视 WebOS 使用 Flutter</a> 等场景，它们都是需要一些特殊定制的去嵌入，特别是在一些嵌入式 Linux 设备上，并没有标准的 GPU 或屏幕（单色 OLED 屏或 LED 阵列），这时候完整 Flutter 太重了，<strong>而 <code>flutter_zero</code> 这种“无偏见（un-opinionated）”的构建方式，允许开发者只使用 Dart 的逻辑层，而不必背负完整的图形渲染引擎，非常适合这种特殊的硬件场景</strong>。</p>
<blockquote>
<p>这个 Zero 代表了，引擎只需要处理跨平台的嵌入逻辑，而不必像现在这样作为一个巨大的单体存在。</p>
</blockquote>
<p>这种将 Flutter 剥离成一个极简的“内核”，移除 <code>dart:ui</code> 层和 C++ 的场景，还可以让 Flutter 的跨平台逻辑层面更好被其他框架利用，例如去年底的时候，<strong>Avalonia 久宣布投资 Impeller ， 和 Flutter 团队合作<a href="https://link.juejin.cn?target=https%3A%2F%2Favaloniaui.net%2Fblog%2Favalonia-partners-with-google-s-flutter-t-eam-to-bring-impeller-rendering-to-net" target="_blank" title="https://avaloniaui.net/blog/avalonia-partners-with-google-s-flutter-t-eam-to-bring-impeller-rendering-to-net" ref="nofollow noopener noreferrer">将他们的 GPU 优先渲染器 Impeller 移植到 .NET 平台</a></strong> ，这也是一种需求方向：</p>
<blockquote>
<p>让 Flutter 成为更底层的基建，而为了这样，就必须让 Flutter 有更 Zero 的架构。</p>
</blockquote>
<p>那为什么这个行为只能让社区发起呢？</p>
<p>因为这是一个非常庞大的重构，这种将的将 Flutter 剥离成一个极简的“内核” 的方式，属于是试图将 Flutter "Dart 化"和"模块化"的激进尝试，如果由官方发起，肯定会带来大量的稳定性忧虑的反对声，而由社区发起则不一样，发起人即是 Flutter 的底层维护人员，又是活跃的社区人员，他的尝试既不代表官方，又可以一定程度获得官方的支持。</p>
<p>不过有一点可以明确，<strong>在 Framework 抛弃 Channel 全面走向 FFI 是必然的目标，而 Zero 更多只是一个实验性尝试，但它激发的讨论可能会影响 Flutter 官方未来的架构演进方向，让 Flutter 未来更适合跑在更多非标准硬件上</strong>。</p>
<p>那么，现在你理解为什么 Flutter Zero 值得关注了吧？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[hCaptcha 验证码图像识别 API 对接教程]]></title>    <link>https://juejin.cn/post/7603769956976295977</link>    <guid>https://juejin.cn/post/7603769956976295977</guid>    <pubDate>2026-02-08T16:10:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956976295977" data-draft-id="7603895839556714559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="hCaptcha 验证码图像识别 API 对接教程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T16:10:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            hCaptcha 验证码图像识别 API 对接教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T16:10:50.000Z" title="Sun Feb 08 2026 16:10:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 hCaptcha 图像识别 API 对接说明，它可以通过用户输入识别的内容和 hCaptcha验证码图像，最后返回需要点击的小图像的坐标，完成验证。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fc9a5cc2f-e410-425f-857a-f8700205da6c%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/c9a5cc2f-e410-425f-857a-f8700205da6c?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">hCaptcha 图像识别 API</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fc9a5cc2f-e410-425f-857a-f8700205da6c%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/c9a5cc2f-e410-425f-857a-f8700205da6c?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">platform.acedata.cloud/documents/c…</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入需要处理 hCaptcha验证码图像，便可获得处理后的结果，首先需要简单地传递一个 <code>queries</code> 字段，这个就是具体hCaptcha验证码图像，我们需要去一个有hCaptcha验证码网站中截取这个验证码图片，示例网站链接为： <code>https://democaptcha.com/demo-form-eng/hcaptcha.html</code>，点击复选框即可显示具体的完整验证码图片，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/xryo59.png" width="500" class="m-auto" loading="lazy"/></p>
<p>其中<code>queries</code> 字段是上文中验证码图像的截图，图片大小建议不要超过100kb，还需要对上面图片红色箭头指向的区域进行截图，并且还需要你自行压缩图片大小，并且还需要将它转换为Base64编码，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/g8ikkb.png" width="500" class="m-auto" loading="lazy"/></p>
<p>同时还需要输入跟验证码图像相关的识别内容参数 <code>question</code>，这个支持中英文翻译，可以直接传相关的识别内容，由上文网页图像中黄色箭头执行的内容可以看出 <code>question</code> 输入的应为 <code>Please click on the UNIQUE object among the others.</code>。具体的内容如下：</p>
<p><img src="https://cdn.acedata.cloud/empncr.png" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>queries</code>：Base64编码的验证码图像列表。</li>
<li><code>question</code>：验证码图像相关的识别内容参数，支持直接输入中英文。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/bww9b0.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"solution"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Please click on the UNIQUE object among the others"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"box"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"360"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"276"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"confidences"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6354503631591797</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>solution</code>，此次 hCaptcha验证码图像 任务处理后验证结果。
<ul>
<li><code>label</code>，hCaptcha验证码图像所识别的内容。</li>
<li><code>box</code>，hCaptcha验证码图像识别结果的位置信息，它是由图像的坐标信息构成。</li>
<li><code>confidences</code>，hCaptcha验证码图像识别后满足识别内容的的置信度。</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了处理 hCaptcha验证码图像 的验证结果，我们只需要根据结果中 <code>box</code> 的位置坐标信息对该验证码图像进行模拟点击该区域便可通过验证。</p>
<p>下面将介绍如何通过结果的 <code>box</code> 的位置信息如何来点击，首先是针对上传的验证码图片进行建立直角坐标系，其中中心原点在图像的左下角，360是对应的横坐标，276是对应的纵坐标，我们只需要通过模拟点击验证码对应的坐标进行点击即可，具体的图像信息如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/4ykvbl.png" width="500" class="m-auto" loading="lazy"/></p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/captcha/recognition/hcaptcha' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "question": "Please click on the UNIQUE object among the others.",
  "queries": ["iVBORw0KGgoAAAANSU.....eY+85KVlzKHav28uq/WLVhL2kHUlFMKUcZbL31S8bpd0pEPKxNllXAE2wgu3uEfj+BfAzOGelsQNFAAAAAElFTkSuQmCC"]
}'
}'
</code></pre>
<p>Python 的对接代码如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/captcha/recognition/hcaptcha"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"question"</span>: <span class="hljs-string">"Please click on the UNIQUE object among the others."</span>,
    <span class="hljs-string">"queries"</span>: [<span class="hljs-string">"iVBORw0KGgoAAAANSU.....eY+85KVlzKHav28uq/WLVhL2kHUlFMKUcZbL31S8bpd0pEPKxNllXAE2wgu3uEfj+BfAzOGelsQNFAAAAAElFTkSuQmCC"</span>]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<h2 data-id="heading-2">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-3">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">结论</h2>
<p>通过本文档，您已经了解了如何使用 hCaptcha 图像识别 API 让用户输入识别的内容和 hCaptcha验证码图像，最后返回需要点击的小图像的坐标，完成验证。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP (Model Context Protocol) 技术理解 - 第二篇]]></title>    <link>https://juejin.cn/post/7603721514204495881</link>    <guid>https://juejin.cn/post/7603721514204495881</guid>    <pubDate>2026-02-08T16:46:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603721514204495881" data-draft-id="7604484566803939338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP (Model Context Protocol) 技术理解 - 第二篇"/> <meta itemprop="keywords" content="后端,MCP,AIGC"/> <meta itemprop="datePublished" content="2026-02-08T16:46:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想用offer打牌"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP (Model Context Protocol) 技术理解 - 第二篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想用offer打牌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T16:46:24.000Z" title="Sun Feb 08 2026 16:46:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>我们第一篇讲了MCP的基础概念、MCP解决的问题以及MCP的架构，我相信大家已经对MCP有了一定的了解，那么接下来让我们深入MCP具体是如何实现的，这一篇我们的重点放在通信协议和数据传输上，让我们一起来看看吧</p>
<p>如果你对前面的内容感兴趣，可以点击这里跳转</p>
<p><a href="https://juejin.cn/post/7604037348607082534" target="_blank" title="https://juejin.cn/post/7604037348607082534">MCP (Model Context Protocol) 技术理解 - 第一篇</a></p>
<h2 data-id="heading-1">MCP的层级</h2>
<p>MCP由两层组成：</p>
<ul>
<li><strong>数据层</strong>：定义了基于 JSON-RPC 的客户端-服务器通信协议，包括生命周期管理和核心原语，如工具、资源、提示和通知。</li>
<li><strong>传输层</strong>：定义了客户端和服务器之间进行数据交换的通信机制和通道，包括特定于传输的连接建立、消息帧和授权。</li>
</ul>
<p>从概念上讲，数据层是内层，而传输层是外层。</p>
<h2 data-id="heading-2">MCP的数据层</h2>
<p>数据层实现了基于<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jsonrpc.org%2F" target="_blank" title="https://www.jsonrpc.org/" ref="nofollow noopener noreferrer">JSON-RPC 2.0</a>交换协议，该协议定义了消息结构和语义。该层包括：</p>
<ul>
<li><strong>生命周期管理</strong>：处理客户端和服务器之间的连接初始化、能力协商和连接终止。</li>
<li><strong>服务器功能</strong>：使服务器能够提供核心功能，包括用于 AI 操作的工具、上下文数据资源以及来自客户端和与客户端交互的模板提示。</li>
<li><strong>客户端功能</strong>：使服务器能够请求客户端从主机LLM进行采样、获取用户输入以及向客户端记录消息。</li>
<li><strong>实用功能</strong>：支持实时更新通知和长时间运行操作的进度跟踪等附加功能</li>
</ul>
<p>该协议支持<strong>实时通知</strong>，从而实现服务器和客户端之间的<strong>动态更新</strong>。例如，当服务器的可用工具发生变化时（当新功能上线或现有工具被修改时），服务器可以发送工具更新通知，告知已连接的客户端这些变化。通知以 JSON-RPC 2.0 通知消息的形式发送（无需响应），使 MCP 服务器能够向已连接的客户端提供实时更新。</p>
<p>简单来说，就和我们配置中心Nacos、Apollo通过<strong>订阅-推送机制</strong>实现<strong>配置热更新</strong>差不多</p>
<h2 data-id="heading-3">MCP的传输层</h2>
<p>传输层管理客户端和服务器之间的通信通道和身份验证。它处理连接建立、消息帧构建以及MCP参与者之间的安全通信。MCP支持两种传输机制：</p>
<ul>
<li><strong>Stdio 传输</strong>：使用标准输入/输出流在同一台机器上的本地进程之间进行直接进程通信，提供最佳性能，且无网络开销。</li>
<li><strong>可流式 HTTP 传输</strong>：使用 HTTP POST 请求进行客户端到服务器的消息通信，并可选使用服务器通过SSE来实现流式传输功能。此传输方式支持远程服务器通信，并支持包括持有者令牌、API 密钥和自定义标头在内的标准 HTTP 身份验证方法。MCP 建议使用 OAuth 获取身份验证令牌。</li>
</ul>
<p>传输层将通信细节从协议层中抽象出来，从而实现所有传输机制都采用相同的 JSON-RPC 2.0 消息格式。</p>
<p>ok，这就覆盖到我们上一篇的知识了，为什么MCP可以统一数据格式和传输，同时可以预制模板，原因就在于<strong>传输层抽象成了统一的标准</strong>，无论是什么传输机制，大家只要按照这一标准来传输数据即可实现互通。</p>
<h2 data-id="heading-4">通信协议与数据传输在MCP里面是什么样子的</h2>
<p>我们来一个图来展示通信协议与数据传输在MCP的充当的角色</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbb577bf59e648ea804c649072e498c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771173984&amp;x-signature=IHtI%2FG05uJ5HD75TxEr9uAwACwc%3D" alt="image.png" loading="lazy"/></p>
<p>展示一下数据格式，我们以<strong>STDIO</strong> (标准输入/输出)为例子</p>
<p>连接建立后，客户端可以通过发送<code>tools/list</code>请求来发现可用的工具。此请求是 MCP 工具发现机制的基础——它允许客户端在尝试使用工具之前了解服务器上有哪些工具可用</p>
<p>然后服务端就返回可调用的tools(包括名称、描述、数据格式等)给客户端</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// Request</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tools/list"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment">// Response</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"jsonrpc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"result"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"search_flights"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Search for available flights"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"inputSchema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"origin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"date"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"origin"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"destination"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"date"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">小结</h2>
<p>在这一篇中，我们主要讲解了MCP它实现的通信协议和数据格式，这就给我们前面MCP如何实现的抽象和数据如何传输的问题解了惑。</p>
<p>下一篇我们讲讲MCP的三大核心原语、生命周期等问题</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 视觉连载1：像素]]></title>    <link>https://juejin.cn/post/7603671627004248104</link>    <guid>https://juejin.cn/post/7603671627004248104</guid>    <pubDate>2026-02-08T15:17:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603671627004248104" data-draft-id="7603854784864845864" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 视觉连载1：像素"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-02-08T15:17:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="董章鱼是个攻城狮"/> <meta itemprop="url" content="https://juejin.cn/user/3644206058054766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 视觉连载1：像素
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3644206058054766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    董章鱼是个攻城狮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T15:17:56.000Z" title="Sun Feb 08 2026 15:17:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好啊，我是董章鱼。</p>
<blockquote>
<p>如果让你设计一个可以识别图像的神经网络，你会怎么做？<br/>
我之前问过自己这个问题，思来想去，我的答案是。<br/>
我可能不知道如何下手。<br/>
突然有一天，当我把Resnet50这个网络的所有算法都写完一遍之后，我突然觉得，只要我深入了解了这些算法的原理，或许这个网络我也能设计出来（后知后觉的大话而已）。<br/>
于是，我有了一个大胆的想法。<br/>
接下来，我会从头开始，拆解一个图像识别网络是怎么工作的，以及背景知识，更重要的是，每一步算法的原理。<br/>
你可能会想，看懂这些需要什么知识呢？其实不需要太深奥的数学知识。<br/>
我尽可能把每一步写的通俗易懂，这个过程中我会搜集一些资料，也是一个不断完善自己知识体系的过程。</p>
</blockquote>
<p>第一个网络，就从玩烂的、作为各大AI芯片厂商性能标杆的Resnet50开始。</p>
<p>个人水平有限，文中如有错误，欢迎留言指正。</p>
<h2 data-id="heading-0">像素</h2>
<p>要实现图像识别，最离不开的，就是像素。</p>
<p>其实我们都知道，图像是由像素组成的。</p>
<p>实际上，神经网络计算，算的就是像素之间的关系，以及这些关系背后可能隐藏的图片信息。</p>
<p>相机摄像头像素2000万，拍出来的照片肯定比像素1000万的要清晰。</p>
<p>我们更容易看到图片中的物体是什么？</p>
<p>这是为什么？因为像素越多，像素之间的关系（色彩，轮廓）越丰富，我们所能看到的信息就越多，自然而然获取到的信息就多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f02fc0859b1483b806756db33eb6128~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=QnHPfmLcMYYYp7mdsnJ6DC654P8%3D" alt="" loading="lazy"/></p>
<p>（一张1080p的图片，我们可以更容易辨别出图像中的物体是山还是水。这是因为更多的像素会给眼睛更丰富的图片细节）</p>
<p>但是，你有没有发现。</p>
<p>当我们去看一张图片时，我们绝对不是盯着某一个像素或某几个像素看，而是看了整个图像的大部分区域，或者说，大部分像素！</p>
<p>因为只有看到了大部分的图片，才能知道图中是座山。</p>
<p>正所谓，聚沙成山！</p>
<p>绝不是少了一粒沙，山就不是山，多了一粒沙，就变成了山。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04d87c3ab91b453b92126a9692e8c595~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=3NCuhK9f2BVtKTxjDLe424d6RZs%3D" alt="" loading="lazy"/></p>
<p>上图哆啦A梦，虽然不是很清晰，像素点数也很少，但一眼望去，依然可以分清是哆啦A梦，甚至，用手捂住一半的图像，依然可以。</p>
<h2 data-id="heading-1">像素局部性</h2>
<p>这是因为人们对于图像信息的识别，是建立在对<strong>像素局部性分析的</strong>基础上的。</p>
<p>所谓局部性，通俗点说，就是眼睛或大脑会将相邻的像素或大片的像素连接起来分析，从而组合成嘴巴，然后是耳朵，最后是哆啦A梦。</p>
<p><strong>神经网络识别图片大致就是这样的原理。</strong></p>
<p><strong>它模拟的，就是人们看到图片之后的信息处理过程。</strong></p>
<p>当我们盯着一个图片看时，我们首先会获取到图片的细节特征。</p>
<p>比如哆啦A梦红色的大嘴巴。</p>
<p>但是如果仅仅盯着大嘴巴，又反而让人有一种“只缘身在此山中”的感觉。</p>
<p>因此还需要看一下图像的轮廓。</p>
<p>于是，眼睛看图片大致有以下两个过程：</p>
<ul>
<li>
<p>瞳孔放大，盯着某一处细节（如大嘴巴）看</p>
</li>
<li>
<p>瞳孔缩小，模糊的看一张图片的大致轮廓</p>
</li>
</ul>
<p>两个过程获取的信息叠加。</p>
<p>Bingo，看清楚了，是哆啦A梦！</p>
<p>那么神经网络是否可以模拟这种瞳孔放大、缩小的方式呢？</p>
<p>很幸运，可以！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/047039595be54cefad64db0f3d740081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=VL0yCCZqy7wXarN5KjmvLRS4yJk%3D" alt="" loading="lazy"/></p>
<p>(卷积：convolution）</p>
<p><strong>卷积核</strong>的设计，就可以很直观的模拟这种获取图片信息的方法。</p>
<p>人们通过调整卷积核的大小，来达到瞳孔张开、缩小的目的。</p>
<p>并且大量的实验和论文表明，卷积这一针对图像局部性识别的算法，可以非常有效的模拟人眼识别物体的过程。</p>
<p>关于卷积算法以及卷积核的设计，后面会专门写几篇文章来聊聊。</p>
<p>因为卷积这一算法，在图像处理领域，实在是，太重要了啊！</p>
<h2 data-id="heading-2">色彩分量RGB</h2>
<p>回到像素这一话题。</p>
<p>你有没有想过，为什么一张图片会是彩色的。</p>
<p>学过摄影的小明同学可能这时会回答：因为图片是由RGB三种颜色来表示的，每个像素实际是不同的R/G/B分量的叠加，混合起来，就表示成了不同的颜色。</p>
<p>回答正确。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fa9d319ddcf4fb8ba93baa10b30fcc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=9veiXabS%2FydOZ00NL4d%2FddJn8Z4%3D" alt="" loading="lazy"/></p>
<p>（三张分别表示R/G/B分量的图片，合成一张彩色图片）</p>
<p>我们人眼可以很直观的看到红色和蓝色，可以察觉到一张图片的色彩和轮廓。</p>
<p>那么，如果让计算机来处理图片，他又是如何知道色彩和轮廓的呢？</p>
<p>其实对于计算机来说，一张图片只是一堆数据，计算机是无法知道这堆数据代表的是什么。</p>
<p>这就需要人为的给这堆数据一种表示方法，让计算机知道，哦，这1/3的数据是红色分量，这1/3的是蓝色分量，这些数据（像素）组合起来，可能代表的是个“帽子”。</p>
<h2 data-id="heading-3">怎么做</h2>
<p>数据在计算机的存储中，最常见的存储方式是连续存储的。</p>
<p>比如C语言，定义一个数组，那么数组在内存中的位置是连续的。</p>
<p><code>int data[10] = {0,1,2,3,4,5,6,7,8,9};</code></p>
<p>内存怎么理解，它就是一排连着的门牌号的公寓宿舍。</p>
<p>门牌号为101里面住着的，是data的第一个数据0。门牌号102里面住着的，是data的第二个数据1，...，以此类推。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55b928544fc84e77b2859bfd8dd6d191~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=WcsQTbfYUBa%2FWVZzKPltGuuhEW4%3D" alt="" loading="lazy"/></p>
<p>(女贞路4号）</p>
<p>只不过，在计算机存储器中，没有门牌号，有的都是地址。</p>
<p>这个时候，计算机根本就不关心数据是啥，计算机用到的时候，就把数据从内存对应的地址中取出来用。</p>
<h2 data-id="heading-4">如何取数据？</h2>
<p>这就需要人们为数据存储设计一种格式，告诉计算机，这堆数据大概是什么样的。只有这样，通过这种人为约定的方式，计算机才能正确的取到R分量或者B分量。</p>
<p>对于一张图片来说，最常见的两个参数是长和宽，一般用H（height) 和 W(width) 来表示，那么RGB三个分量，看作是3个通道（channel)，一般用 C 来表示。</p>
<p>如此一来，一张长宽分别是224像素*224像素的RGB图像，就可以用 HWC = [224, 224, 3]来表示。两张类似的图片就用 NHWC = [2, 224, 224, 3]表示，其中N代表图片张数。</p>
<p>（一张图片的抽象数据表示）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08e14ea877454925bc395b2fd8e4d355~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=mw5F5sxQkY6PIHqVzT3HC5VW3yg%3D" alt="" loading="lazy"/></p>
<p>友好的数据表示方法，可以减少大量的计算复杂度。</p>
<p><strong>虽然这样表示不太利于人们的直观理解，但是计算机处理这种数据是十分方便的。</strong></p>
<p>在目前主流的深度学习框架中，对于图片的数据格式，基本都支持了NHWC或NCHW这种数据摆放格式。说到底，都是为了更高效地进行图片数据的处理和运算。</p>
<h2 data-id="heading-5">总结一下</h2>
<p>今天就先开个头，从像素说起，说到了像素具有局部连接性的，人眼识别图像也是通过获取像素的局部连接性信息来完成的。</p>
<p>幸运的是，卷积这一算法，可以很好的模拟这一过程。</p>
<p>最后，为了使计算机更高效的处理图片数据，引出NHWC的图片数据表示方法，</p>
<p>所以，之后我们说图片，不仅仅局限于图片的长和宽，还多了一个维度信息，那就是channel。</p>
<p>下一篇会继续，聊聊图像的色彩空间。</p>
<p>为什么有了RGB，还需要YUV？什么时候用RGB, 什么时候用YUV？</p>
<p>以及图像压缩对于深度学习来说，意味着什么？</p>
<h2 data-id="heading-6">One More Thing</h2>
<p>熟悉OpenCV或者计算机视觉的同学，可能对于上面的RGB分量中的女神很熟悉。没错，在很多的教程中，这位女神不止一次的出场。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3183814dfd51441c897830d03d37f0a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGj56ug6bG85piv5Liq5pS75Z-O54uu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771168677&amp;x-signature=uZrG%2BywOoJMTTdLkIO8EgElkfSc%3D" alt="" loading="lazy"/></p>
<p>这位女士名叫 Lena。</p>
<p>电气电子工程师学会图像处理汇刊 （IEEE Transactions on Image Processing）主编曾在1996年1月出版的一期中解释道，Lena的流行，因为她是一张好的测试图片，其中包含了很多细节，平滑区域，阴影和纹理。</p>
<p>当然，另外一个原因就是漂亮美女的图片自然受到男性居多的研究领域的欢迎。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实用免费的 Short URL 短链接 API 对接说明]]></title>    <link>https://juejin.cn/post/7603673564909436963</link>    <guid>https://juejin.cn/post/7603673564909436963</guid>    <pubDate>2026-02-08T15:27:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603673564909436963" data-draft-id="7603677143215144975" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实用免费的 Short URL 短链接 API 对接说明"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T15:27:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实用免费的 Short URL 短链接 API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T15:27:53.000Z" title="Sun Feb 08 2026 15:27:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>想必大家一定有把长链接转短链接的需求吧，有没有免费好用的 API 呢？有！这里就是。</p>
<p>本文将介绍一种 Short URL API 对接说明，它可将较长的URL转换为短的URL。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fshorturl%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/shorturl?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Short URL API</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fshorturl%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/shorturl?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">platform.acedata.cloud/documents/s…</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入需要转换的较长URL，便可获得处理后的结果，首先需要简单地传递一个 <code>content</code> 字段。我们接下来就可以在界面上填写对应的内容，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/4ascb2.png" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>content</code>：要缩短的URL的内容。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/r3uakb.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://surl.id/1uHCs01xa5"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此处任务是否成功的状态。</li>
<li><code>data</code>，包含了此处转换后的URL。</li>
</ul>
<p>可以看出
原先较长的URL <code>https://platform.acedata.cloud/documents/a2303356-6672-4eb8-9778-75f55c998fe9?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6</code> 已经成功转换为短的URL <code>https://surl.id/1uHCs01xa5</code>。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/shorturl' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "content": "https://platform.acedata.cloud/documents/a2303356-6672-4eb8-9778-75f55c998fe9?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6"
}'
</code></pre>
<p>Python 的对接代码如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/shorturl"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"content"</span>: <span class="hljs-string">"https://platform.acedata.cloud/documents/a2303356-6672-4eb8-9778-75f55c998fe9?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<h2 data-id="heading-2">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-3">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">结论</h2>
<p>通过本文档，您已经了解了如何使用 Short URL API 将较长的URL转换为短的URL。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[完成前端时间处理的另一块版图]]></title>    <link>https://juejin.cn/post/7603671627004264488</link>    <guid>https://juejin.cn/post/7603671627004264488</guid>    <pubDate>2026-02-08T15:34:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603671627004264488" data-draft-id="7603575399256064040" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="完成前端时间处理的另一块版图"/> <meta itemprop="keywords" content="前端,Web Components,GitHub"/> <meta itemprop="datePublished" content="2026-02-08T15:34:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mumuy"/> <meta itemprop="url" content="https://juejin.cn/user/289926798118589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            完成前端时间处理的另一块版图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/289926798118589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mumuy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T15:34:17.000Z" title="Sun Feb 08 2026 15:34:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>之前的文章<a href="https://juejin.cn/post/7462640220032352306" target="_blank" title="https://juejin.cn/post/7462640220032352306">《为了解决时间问题，我开源了两个库》</a>提到了，我为了处理日常中遇到的时间处理问题，针对性的开源了两个库：时间格式化处理库datex和日历转化（万年历）；
这2个库分别解决了我在开发中遇到的时间处理和日历转换的问题，然而这还不够，我在想还有哪些地方遇到不好解决的时间相关问题呢？</p>
<p>有了！时间选择器！之前的万年历仅仅解决日历的展示问题，真正在产品开发中，更多的场景是如何更方便的选取时间。虽然，市面上并不缺少类似的库，可以说比比皆是。可奈何我喜欢造轮子呢~我需要一个属于自己的前端工具库宇宙。当然了，解决开发中实际遇到的问题同样是目的之一。</p>
<p>我认真盘点了下自己的需求：</p>
<ol>
<li>我需要这样一个时间选择器组件，它只有一个文件，可以同时兼容日期选择、时间选择、日期和时间同时选择，同时它还能选择范围。</li>
<li>时间选择器少不了自定义有效选择范围，就是可以在组件中限制你能选择的范围，这样可以减少用户额外的有效值筛选。这个限定可能不是具体的范围，而是重复性的范围，比如具体星期几，周末，工作日，几点到几点。</li>
<li>我需要它可以自定义格式，就是value的值可以自己定义，比如：2026-01-01，2026/01/01，2026年01月01日。我不想每次选择完以后，还要手工转化成自己想要的格式。</li>
</ol>
<p>我从<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmumuy%2Fdatex%2F" target="_blank" title="https://github.com/mumuy/datex/" ref="nofollow noopener noreferrer">时间格式化库datex</a>中移植来了内部需要用的时间处理方法；又从<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmumuy%2Fcalendar%2F" target="_blank" title="https://github.com/mumuy/calendar/" ref="nofollow noopener noreferrer">日历转化库（万年历）</a> 中移植来了日历组件的部分构成；“缝合”成了新的项目 - <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmumuy%2Fwidget-datetime%2F" target="_blank" title="https://github.com/mumuy/widget-datetime/" ref="nofollow noopener noreferrer">日期时间选择器</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e49fb4b3ec343b29792491d72a789c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbXVtdXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=ZwsfOAvMrMXKD9ijiAkRFtnOgYk%3D" alt="QQ_1770444571115.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86e55314e81c4f779daf18482e9b388b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbXVtdXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=jBd40HR3KGjja08WJ13PtsEKyv4%3D" alt="QQ_1770564698027.png" loading="lazy"/></p>
<p>这个组件库的使用也特别简单，只需引入一个脚本库，加一个标签即可。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 日期和时间 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">widget-datetime</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择日期和时间"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2026-01-01"</span> <span class="hljs-attr">range</span>=<span class="hljs-string">"[['09:00','18:00']]"</span> <span class="hljs-attr">limit</span>=<span class="hljs-string">"['weekday']"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">widget-datetime</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 日期 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">widget-date</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择日期"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"2026-01-01"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">widget-date</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 时间 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">widget-time</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择时间"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"09:00"</span> <span class="hljs-attr">range</span>=<span class="hljs-string">"[['09:00','18:00']]"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">widget-time</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 日期和时间范围 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">widget-datetime-range</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择日期和时间"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">""</span> <span class="hljs-attr">range</span>=<span class="hljs-string">"[['09:00','18:00']]"</span> <span class="hljs-attr">limit</span>=<span class="hljs-string">"['weekday']"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">widget-datetime-range</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 日期范围 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">widget-date-range</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择日期"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">""</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">widget-date-range</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 时间范围 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">widget-time-range</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请选择时间"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">""</span> <span class="hljs-attr">range</span>=<span class="hljs-string">"[['09:00','18:00']]"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">widget-time-range</span>&gt;</span>
</code></pre>
<table>
    <thead>
        <tr>
            <th>属性</th>
            <th>参考值</th>
            <th>说明</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>placeholder</td>
            <td>'请选择日期'</td>
            <td>为空时占位提醒</td>
        </tr>
        <tr>
            <td>value</td>
            <td>'2026-01-01'</td>
            <td>默认值</td>
        </tr>
        <tr>
            <td>pattern</td>
            <td>'YYYY年MM月DD日'</td>
            <td>
                <p>格式化值</p>
                <p>YYYY - 年</p>
                <p>MM - 月</p>
                <p>DD - 日</p>
                <p>HH - 小时</p>
                <p>mm - 分钟</p>
                <p>ss - 秒</p>
            </td>
        </tr>
        <tr>
            <td>range</td>
            <td>[['2026-01-01','2026-06-30']]</td>
            <td>
                <p>限制选择范围</p>
                <p>[['2026-01-01','2026-06-30']] - 限制日期</p>
                <p>[['09:00','21:00']] - 限制时间</p>
                <p>[['2026-01-01',null]] - 单向限制</p>
            </td>
        </tr>
        <tr>
            <td>limit</td>
            <td>['weekend']</td>
            <td>
                <p>限制类型</p>
                <p>weekend - 周末</p>
                <p>weekday - 工作日</p>
                <p>sunday/monday/tuesday/wednesday/thursday/friday/saturday - 单向限制</p>
            </td>
        </tr>
    </tbody>
</table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[「2025 年终总结」在所有失去的人中，我最怀念我自己]]></title>    <link>https://juejin.cn/post/7603677143215161359</link>    <guid>https://juejin.cn/post/7603677143215161359</guid>    <pubDate>2026-02-08T15:34:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603677143215161359" data-draft-id="7603854784864780328" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="「2025 年终总结」在所有失去的人中，我最怀念我自己"/> <meta itemprop="keywords" content="后端,年终总结,前端"/> <meta itemprop="datePublished" content="2026-02-08T15:34:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Coredump"/> <meta itemprop="url" content="https://juejin.cn/user/1654082381026734"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            「2025 年终总结」在所有失去的人中，我最怀念我自己
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1654082381026734/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Coredump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T15:34:16.000Z" title="Sun Feb 08 2026 15:34:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 2026 的开始，我并没有许下什么新年愿望，似乎每一年都没有，但每一年都会经历很多难忘的事情。</p>
<p>这一年终究要过去了，我对 2025 的唯一感觉就是：<strong>年费会员快要到期了，该交钱了</strong>。</p>
<p>今年比往年要好很多，烟花凌空绽放，整座城市隆隆作响，极尽所能地宣告新年的到来，往年只有电视机里主持人带着职业假笑，高声呐喊这的倒计时，现在打开窗户，迎面扑来的是久违的焰火气息，让我想起遥远的过去。</p>
<p>尤记得初春，微雨悄然而至，零星的雨滴中，傍晚树下自行车的铃声随风轻轻荡漾，街角的灯光微黄，宛如一位老友向我低语，有些东西，永远的遗留在了过去。可能是在留在了初高中，或者本科，亦或者是研究生，无从知晓。</p>
<p>那时西边红霞满天，我却只顾东行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94923f296f1a4349915c66b32dcd8702~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=kDzZKa%2FLh5qeiiQQib2NDZltctc%3D" alt="7623766c8e19a6e0cbd1497c97a4b53e" loading="lazy"/></p>
<h2 data-id="heading-0">#01 夏</h2>
<p>暑期实习挺不顺利的，人很丧，没自信，没目标，也错过了很多机会...</p>
<p>想回到暑期前重新开始，但没办法，回不去了，这就是人生，只有错过点什么，你才学得会珍惜</p>
<p>就好像我这辈子也回不到大一大二的学习状态一样，或者说，人这一生，都不能走回头路</p>
<p>很多年来，我一直持续在问自己一个问题，怎么就变成这样了呢？</p>
<p>最近，这个问题变成了，害，那又能有什么办法呢 😮‍💨</p>
<p>暑期最有希望也是最想去的华子也泡死在池子里了，那个组的方向我是真感兴趣，可惜最后还是没能等来 offer。</p>
<p>看到一个北大的哥们，比我晚入池，过几天就开奖了，HR 和我说，或许这就是北大的魅力吧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49386daf91f5446c97fc89ed6ce84156~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=l%2F%2FeBTcfTPOM%2FH2%2FhamkLVI43H8%3D" alt="image-20250628032513786" loading="lazy"/></p>
<p>也不知道为什么，这些年，身边的人总会有种觉得我很厉害的错觉，拜托，我要是真厉害，我还用发愁这些毕业、就业的事么，这样我就不用吃生活的苦了</p>
<p>有时候就觉得自己活得很荒谬，三天两头垂头丧气跟失恋似的</p>
<p>朋友问我怎么情绪不对，我总不能告诉他最近暑期挂麻了，看不到未来吧</p>
<p>突然想明白了为什么互联网公司互相称呼同学，国企互相称呼老师，<strong>因为同学会毕业，早晚而已</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fd5898f6d7840e1b3b97e8c242c60a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=G2P%2BAKB31iVv5IXWSVyYbWLk5Xo%3D" alt="94628a820e12dc46f30efd54d788a640" loading="lazy"/></p>
<p><strong>这并不是一份多么值得让人羡慕和追逐的工作</strong></p>
<p><strong>在这里，人也并没有太多的时间想以前和以后</strong></p>
<p>那段颓废在宿舍刷视频的时间，经常刷到蜡笔小新和海绵宝宝，不得不说在那个年代，做得是真好</p>
<p>小学的时候是最应该看蜡笔小新的时候</p>
<p>高中的时候是最应该看斗破苍穹的时候</p>
<p>但我研究生的时候才开始沉迷这俩玩意</p>
<p>不过仔细一想，我现在和高中时候确实有点不一样了，比如高中时候我玩英雄联盟宁死不投，现在我看打不过了 15 分钟就上票了，不能让对面虐菜爽</p>
<p><strong>能打过我的人，我不给他们打</strong> ...</p>
<p>人总应该是有点变化的，但我最近又有些新的理解了，成长是一件很难的事，它甚至意味着从头去修改你的一部分人生意义</p>
<p>打个比方：你连体重都控制不了，怎么能控制自己的人生呢？</p>
<p>朋友说没办法，现在大伙都找着了工作，体重确实不好减</p>
<p>真不好减，最近东子、团子和阿里打外卖价格战，快给我喝出糖尿病了</p>
<p>暑期有个好朋友跑北京实习了，还有一个去了杭州，读书时哥几个总是经常打哈哈，不过一到上班，感受又不一样了</p>
<p>出发前几天，我说了一句“今日一别，小半年又见不到了，不过咱们的学生生涯好像也就一年多了”，他们没说话，也许是我们经历这寻常的分别太多了，本来早就习惯了，这时候突然来了个人对你说：</p>
<p>嘿，你已经和这么多人走散了呀</p>
<p>大多数人分开后就不会再见了，而有些人或许还有再见的机会</p>
<p>回忆会陪你一生，即使再模糊，你还是忘不掉</p>
<p><strong>聚散离合，此乃常态，你要习惯</strong></p>
<p>纵观个人的命运，当然要靠自我奋斗，但也要考虑到历史的行程，但不幸的是，现在历史的进程并不乐观。</p>
<p>在比较小的时候，大约就是初中高中吧，我对自己人生结果充满幻想和期待。但慢慢长大之后，方才意识到生活是如此复杂，我不得不学着对内心的期望放手，曾经的梦想在残酷的现实面前变得褪色。慢慢发现有些事并不是一件需要被解决的事情，而是一件需要被接受的事情，或者说，绝大多数的事情，都只是需要接受的事情，你解决不了。</p>
<p>比如在地球 online 度过的这二十几年来看，改变的话起码要拿年来衡量，或者十年来衡量。</p>
<p>此时，怜悯自己显得很重要，或许你可以对自己说“我也想要做得更好”以及“就让它这样吧，其实这样也好”。</p>
<p>是的，我已经做得足够好了，因为至少现在我还爱着自己｡</p>
<h2 data-id="heading-1">#02 秋</h2>
<p>其实，我从来没想过要如何准备才能在秋招拿到大厂的 offer，或是白菜，或是 SP、SSP</p>
<p>我一直以来去实习，一是想顺道去别的城市看一看，二来，也是一直都想真正的写出一些好的代码，被重视的代码，听起来很理想化，但这也让我阴差阳错的实习了不少段</p>
<p><strong>在我过往的十年中，凡是我努力追逐的事，往往都无法实现，而那些真正实现的，其实都是意料之外</strong></p>
<p>所以我觉得如果一件事有 100% 的把握，就没有去做的兴致了</p>
<p>🧑‍💻面试官：这就是你笔试只做出来一半的原因吗？</p>
<blockquote>
<p>后来看到个段子，很后悔没给面试官发：</p>
<p>“这代码我有三不写”</p>
<ul>
<li>第一：不能复制的我不写，因为别人的轮子写好了我干嘛不用</li>
<li>第二：不让我用 ChatGPT "辅助"的我不写，因为基础的东西我都会，写了没意义</li>
<li>第三：太难写的我不写，因为我还没有到那个境界，写不明白</li>
</ul>
</blockquote>
<p>现实就是这么残酷，还没来得及从暑期实习的失落中走出来，秋招就开始了，比 emo 更难受的事情是，不能 emo 太久。</p>
<p>朋友说，当一个人过得不好时，才会怀念过去。难怪秋天刚开始，我就已经在怀念夏天了。</p>
<blockquote>
<p>这过日子就是问题叠着问题，我唯一能做的，就是迎接这些问题。  ——《士兵突击》</p>
</blockquote>
<p>几十年前，似乎呢群领图灵奖的巨佬总会在领奖的时候很自豪的说，我是一名程序员</p>
<p>但现在提起程序员，我总会想到 CSDN 上那只秃头虚弱无力的猿猴趴在电脑前，用巨大的手敲打着键盘</p>
<p>所以我很不喜欢 CSDN，当然 CSDN 也确实做的很烂，也算没有辜负我的感情</p>
<p>我没那么喜欢互联网，互联网是一种很割裂的存在，特别是在国内，比如互联网的 OKR，很有意思的是，在互联网 OKR 本来就是要完不成的，如果有一天你完成了你的 OKR，不是说你超出预期，而是说明你的 OKR 制定的有问题</p>
<p>我很想说这个行业病了，但其实我也改变不了啥，唯一改变的就是工作越来越难找了，同龄人之间要更卷了而已</p>
<p>没有乌托邦，只有维也纳在等我们</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d0518cc58074c2fad7013ce556698ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=hkJEw%2BsfyewebAV898Zy7s0lFe4%3D" alt="Screenshot 2025-08-10 at 15.42.18" loading="lazy"/></p>
<p>但我喜欢编程，我就想工作得能开心点，从来没想过在互联网待一辈子，<strong>而且即使我想，我的老板可能也不想</strong></p>
<p>面试很短，这几十钟其实是看不出来我的优点的，我每次面完都感觉没有发挥得尽兴，没有展示出来给面试官最好的一面</p>
<p>但我的缺点还是一览无余的</p>
<p>有一次面 HR 面的时候，HR 让我给一个词来形容自己，我说的是重感情</p>
<p>HR 说第一次见到这样的回答，让我举个例子</p>
<p>我想了想，说如果你司招我，那我会先考虑你司</p>
<p>也不知道 HR 满不满意这个回答</p>
<p>想起来本科的老学长，从闲鱼跳去了美团，换了个 base，最近经常加班，有人问是为了什么</p>
<p>学长说是为了爱情，真好，那时候有那么一瞬间，我很羡慕，似乎这一切都和技术没有关系，与世俗的荣誉，权力都没有关系</p>
<p><strong>我喜欢纯粹的东西，面试也是</strong></p>
<p>我如果觉得一个面试官不真诚，我就不会去这家公司，如果我有选择的话</p>
<p>以前觉得做选择时兴趣没有那么重要，但现在看来，那一点平日里微不足道的热爱，会成为在动摇时至关重要的那一份权重</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67e7e3c7c9f94a17ba8327556ffcb6a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=h9zAtINPmlnD%2B%2F21k9CRRSZZVAw%3D" alt="image-20260206171454503" loading="lazy"/></p>
<p>有时候想毕业直接回到老家，又觉得辜负了自己的初心和一身技术</p>
<p>朋友说不对，<strong>你现在没啥技术，谈不上辜负</strong></p>
<p>说的也对，走一步看一步算了😄</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5aa37161c8e40f4af5c03a57b00f122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=Q2X%2FyLFeNWq%2BSeR4d%2BKeAKsxozE%3D" alt="img" loading="lazy"/></p>
<p>不过程序员有一大悲哀就是，成为了程序员就会只把自己当成程序员，因为身在这个环境中，但其实如<strong>果跳出这个环境，发现还是正常生活的人多</strong>。</p>
<p>计算机是严格理性与规范的学科，但我觉得也很浪漫，我们穷尽所有去提高技术，无论是设计模式，还是渐渐的模块化，微服务化，容器化，<strong>都是为了在未来一天，我们可以更好的被取代</strong>，这个工作，在一开始，便注定了悲壮和浪漫。</p>
<p>但有时我会想，这个行业，值不值得我投入如此的热忱，我是个没有梦想也能生存的人，高中的朋友总喜欢找一个梦想中的学校，一个梦想中追赶的人，一个梦想中的行业。但我这些都没有，朋友总觉得我是靠意志力撑过高三那段艰苦的岁月，其实不是，有没有梦想对我来说并不是那么重要。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c44abc56ec824475b0394da7c65bfdeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=4L5eHAFG%2Bn%2BvqhfB7zI7PiilT2w%3D" alt="img" loading="lazy"/></p>
<p>朋友说，假设阳的挂掉一半，全国会失去大概 50% 的人口，不过很快又会恢复如初（生物小知识嗷：种群数量达到环境容纳量一半，即 K / 2 时，种群的增长速率最大），最终无数人的喜怒哀乐，生死离别，成为历史书上的轻如鸿毛的一笔，无论描写的多么惨绝人寰，也只是一笔罢了，而地球上所有惊天动地的大事，也不及宇宙中的一粒尘埃。</p>
<p>有时候在想生命的意义是什么，我想不明白，就像高三老师问我的梦想一样，问我想要当一个什么职业，成为一个什么样的人，我说我不知道，但一定不是以后拿 20w 年薪，30w 年薪，50w 年薪或者 100w 年薪。</p>
<p>因此不想卷了，是因为没有了卷的动力，其实最终不就是为了拿一份高薪的工作，我连对这个结果都没了兴致，又何谈过程，倒不是懒得奋斗，只不过什么时候奋斗渐渐的成了一种贬义词，我只是觉得途中的代价太大，不只是我一个人付出的，而是和我的朋友们一同付出的。</p>
<p><strong>无论是什么样的结果，我都觉得难以配得上这一路走来的失去</strong></p>
<p><strong>人行走江湖，就是不断的相遇和失去，第一次相遇是自己的生命，最后一次失去也是，有始有终</strong></p>
<p>我已经不喜欢再和别人卷了，但是到了一定程度后，身在其中，由不得我，不过，也算是一种磨练心境吧，倒也未必不是好事。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3997647fdc5748358f0b6dc09769e320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=TUJuQmSGxUd4UTv%2B%2BlmQ2njoI64%3D" alt="Screenshot 2025-08-10 at 15.37.42" loading="lazy"/></p>
<p>所以生命的意义是什么，我不知道，但是我会期待下一次和朋友相遇，在大学中遇到新的朋友，新的乒乓球友，我会和以前一样期待，但是不会再像以前一样严格规划我的人生了，比如某个时间点非做某件事不可，非要达到某个成就不可。</p>
<p>在学校的时候，如果不是很忙我就喜欢到外面去吃个鸡锅，如果忙的话就推到明天去吃，明天忙就推到后天，<strong>人总是寄希望于后来，也习惯把这辈子没有得到的人和事寄予到下辈子，总会说我下辈子要怎样怎样。可如果这辈子就是你上辈子说的下辈子，那怎么办呢</strong>？</p>
<p>所以我现在选择想吃鸡锅的时候就直接去吃😋</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c3affdfcf548719d52c7bcf2aea815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=CEaM2ds7%2Bqg5Ifm1jnqL5qiuDKk%3D" alt="image-20260206182133446" loading="lazy"/></p>
<p>那我会呆在哪里呢？HR 也问过我这个问题。</p>
<p>我说大概是厦门吧，我的爱人、挚友都在那里，或者是在那里陪伴过我一段很长很长的时间，比我在杭州西安待的时间加起来还要长很多</p>
<p>面试官笑得有些深意</p>
<blockquote>
<p>几年后被末尾淘汰的那一天，一切都将作废，之前的加班作废，之前从池子中挣扎出来的惊喜作废，之前的领导同事作废，之前的薪资待遇也作废，鼠标也会作废，键盘也会作废，所有的承诺也统统作废。从那一天开始，我不再需要电脑，不再需要八股，我的人生不再有 hello world。我知道是秋招那年的那场大雪覆盖了我前半生的荒唐，覆盖了我本科的学历，我和 985 硕一起进入阿里，我仿佛从其中看到了希望，但生活在无边的大雪中又何尝不是一种荒唐，当我真正走出这片大雪后，我肚子有些饿了，此时我才意识到，原来码农烧烤才是人生的归属。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/898b60f4917546b08c17f4e9c4476c50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=FnQJ1xEu6odF6gBR%2FG1BSSvtj%2F4%3D" alt="IMG_8164" loading="lazy"/></p>
<p>其实我也经常黑厦门的，我很难喜欢上某个城市，比起城市的高低贵贱，电子博弈，我更在意的是我与谁一起经历过什么，到过哪里，见过哪里的风景</p>
<p>我经常说厦门那地方，典型的工资低，物价高</p>
<p>朋友说他不是本地人，每次买海鲜都感觉买的很贵很贵，听厦大的学长说去码头买能便宜很多</p>
<p>我说不是，码头有一定概率买到新鲜的，而且很难买到便宜的</p>
<p>为什么说有概率买到新鲜的，因为那海鲜，你不清楚是刚从海里拉上来的，还是昨天搁市场溜了一圈又拉回去的，反正在人看来，都是刚从船上拉下去，带着新鲜的海水和被折腾的半死不活的鱼</p>
<p>至于价格，人们一般都会吹鼓自己的是野生的，众所周知的道理，野生的更贵，<strong>也没有手段证明它是不是真的野生鱼，除了价格</strong></p>
<h2 data-id="heading-2">#03 厦</h2>
<p>读了好多年书，如果能顺利毕业的话我就要毕业了，<strong>这话看起来没什么信息量，和我读的硕士一样</strong>。</p>
<p>看树洞有人问保研和考研哪个更辛苦，我不用点开都知道评论区铁定开战了</p>
<p>一个老哥说的很有意思，差点看破防了</p>
<p><strong>读研更辛苦</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/507e271cdd05427db7b53d329c40b117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=UgqqDwhKbqJtmscoKv9taTx932A%3D" alt="b1aa7170df5fcb1ed7046ec6c77874fe" loading="lazy"/></p>
<p>记得有一天发研究生补助的时候我还在和朋友聊天</p>
<p>朋友说他感觉人生只剩下了银行卡里的一串串数字，收入和支出，感觉像是把灵魂卖给了社会，照镜子的时候感觉双眼都变得浑浊了</p>
<p>我看了眼屏幕里那一堆减号里面的醒目的“➕600”，还是国家赏饭，我应该是肉身和灵魂都卖给了学校，还是那种 19 世纪美国南方黑哥摘棉花的价格</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb09d2d1fbfb494aac60e52c3f88c57f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=q%2F%2FlsflQJDskCvKXHrwNLLrQ6Nc%3D" alt="IMG_5800" loading="lazy"/></p>
<p>和朋友闲聊，如果能再选一次的话我一定不会读研，哈哈</p>
<p>人就是这样，总会在某个时期觉得自己曾经做的事情不正确，说不定再过几年我又觉得现在做的不正确了</p>
<p>不过话说回来，当年觉得自己能保研可厉害了，现在想想就和网上那种看着小时候一面墙的奖状一样，叹息之墙</p>
<p>人还是不要美化从未走过的那条路，不然就会一直纠结和后悔，然后发现这辈子然后很快就过去了</p>
<p>也慢慢觉得自己老了，因为回过头看，发现自己已经配不上过去的自己了</p>
<p>如果在当年知道未来是这样，或许根本撑不过高考那段时光</p>
<p>多年之后，我又梦到那天，画面遥远，仿佛回到高考那一天</p>
<p>感觉，稍微有点生不逢时罢了</p>
<p>想起来前段时间公司宣讲，说我们赶上了一个很好的时代，因为有 AI，可是 AI 并没有发挥它应有的作用，并没有让工作量减少，工作时长减少，也没有降低生活成本，房价物价，看病还是一样昂贵，大家的压力也都还是很大，甚至更焦虑了，我们并没有因此变得更幸福</p>
<p>长期来讲，我很看好 AI，但此时此刻，并不觉得这是一个多么好的时代，即使见证了从传统 CV、NLP 到大模型的蜕变。大模型发展得太快了，还记得 22 年刚出 GPT-3.5 的时候，有人感慨涌现就像宇宙给的礼物一样神奇，现在已经没有人再发出这种感慨了，默认大模型就存在和人类差不多甚至更强的智力了，没有上古时期 NLP 用 BERT 胡言乱语的折磨</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1677b05db35482cbff65058ee3ae914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=aFQWRG5SOZWhKyHkGeIlNXHZgwU%3D" alt="33d3a6e6a7db04a50aead8040afc78b1" loading="lazy"/></p>
<p>想起个很好笑的事，以前研究生方向不是 CV 就是 NLP，现在 CV 还有点，感觉 NLP 已经绝迹了，虽然大模型也算是一种 NLP 吧，但已经没有哪个老师招生的时候会给你说：同学，我的研究方向是 NLP 🤣</p>
<p>现在已经到 AI Agent 时代了，国内外的 AI 产品层出不穷抢占市场，也不得不感叹国内 AI 大战的朴素，一代人有一代人的鸡蛋要领</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed3c4a7a6b64877b33771be93454380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=COH9R5m2lC0cKBiEK8s8mDdKNqQ%3D" alt="140c831cdcc83abd3e65bf054a050db3" loading="lazy"/></p>
<p>感觉我们的世界对慢节奏的人很不友好，那种田园牧歌的时代早就一去不复返了。我曾经对科研的憧憬完全来自于牛顿和苹果树，康德漫步于小径，梭罗隐居瓦尔登湖，而不是坐在电脑面前，脊柱侧弯、屁股很酸、眼睛散光，和计算机打交道，未来只有吃不完的苦。</p>
<p>我曾经觉得我是会喜欢科研的，在我想出老师也没想出来的课题的时候，提出不一样的见解的时候，在组会分享论文的时候，做出耳目一新的 PPT 的时候。</p>
<p>也许我确实是，但是我连打游戏都没法一天八小时持续一个月，社交不行，跑步不行，吉他也不行，唯一成功坚持过的看似也只有读书，读高中的时候，但也得考虑到咱们学六门课呢，而且真是差点就死了。</p>
<p><strong>我不喜欢科研，至少暂时不喜欢</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7e7d336a8b64f15930f1a65ac44b57b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=dyXiaBhwlP%2BitV%2FVdLPq8BHdFI8%3D" alt="IMG_3128" loading="lazy"/></p>
<p>人擅长什么领域，就会在心中的价值天平上给它加码，以确保自己的价值在自己心中过得去。我想高考之于我几乎所有的意义就在于此了。我确认自己的才能、价值、潜力，我知道我的头脑不会背叛我。</p>
<p>不过我也因此发现，无论一篇论文写得多好，总能挑出来毛病，只要我想挑毛病</p>
<p>不是我有多么丰富的知识和见解，而是我必须得挑，因为组会轮到我分享论文了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72112686cd51449eb92a293a5727dfb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=Y5YxIHa%2BN%2FktYnWRGL7WHLENOC4%3D" alt="IMG_2423" loading="lazy"/></p>
<p>我时常惊叹于我朋友的学习能力和科研水平，也惊叹于我朋友为人处事的八面玲珑。</p>
<p>从小到大我见过的成绩好的人太多了，然而天下英雄如过江之鲫，即使你万里挑一，在这里也有 14 万个，更何况世界不止中国。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42c9c3e34ec244a4bdf95438024619be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=rkfWB8cGme%2F6P04wthQgABm1bK4%3D" alt="Screenshot 2025-08-10 at 15.34.22" loading="lazy"/></p>
<p>然而幸福是一种独立于客观存在的能力，就像物债二分法，所有权的变动无效并不意味着买卖合同无效 —— 你看到什么，听到什么，感受到什么，才是最重要的，跟客观世界是什么样的、跟别人怎么看你无关。</p>
<p>所以幸福不是那种一下被人流推到癫狂的短暂欢乐，而是一种长期平和的满足。就按一线城市人均寿命 80 岁来算，扣除最后几年没有质量的生命，再扣除已经过去的 18 年，以及 4 年本科、3 年硕士占据现有生命的份额，又能剩下多少年的人生呢？</p>
<p>既然人生永远没有岸，你的体验难道就不重要吗？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecd40e9a5c04462fb6af820a73682881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=fYaVwdzeph6QamW9bI8uCen8aAI%3D" alt="Screenshot 2025-08-10 at 15.40.13" loading="lazy"/></p>
<p>有时会想，到底什么样的人生是幸福的人生呢？</p>
<p>有项研究表明，一个人在年老的时候身体和灵魂都很健康，还对自己很满意的话，他的人生就是幸福的。这里既包含了个人对自己的评估，也要考量医生和心理学家的评估。</p>
<p>这个研究的好处是把幸福的人生具体化了。不过，研究也表明，你可能等不及到退休的时候再来评估自己的一生。</p>
<p>所以朋友说他在犹豫交不交养老保险，他感觉活不到退休，即使活到了，按当前生育率推断，也是大概率没人给我们交养老金。</p>
<p>总觉得人生路很长，未来还可以做很多事，我想了想<strong>也未必很长，人很难说什么时候会死</strong>，朝生夕死也并非不可能</p>
<p>我们总是以对未来美好的憧憬，来假释当下的苦难，只是美好一直没有到来，竞争倒是永无止息</p>
<p>我不想这样，但有时候又没得选</p>
<h2 data-id="heading-3">#04 倒带人生</h2>
<p>从我记事起，就记得姥姥家的院子里，种着一颗大银杏树。每年春夏，枝头总是挂着一片绿意。等秋天一到，金灿灿的叶子就在风中招摇。风将落叶带去远方，天空飘着的云很是明亮。我只是安静地看着，邻居家那只爱趴在我家屋檐上，呼呼大睡的猫咪，就能虚度一下午的时光。</p>
<p>我这人很简单</p>
<p>如果有星巴克和瑞幸，我一定会去喝瑞幸，因为我喝不出他们有什么区别</p>
<p>但如果是瑞幸和库迪，我一定会去喝瑞幸，哪怕瑞幸十几块一瓶，因为我喝得出来区别</p>
<p>我喜欢没有意义的东西，或者说纯粹的东西，比如喜剧片或悬疑片，我不喜欢对我说教的，蕴含深刻道理的喜剧，这种还不如让我去看黑马程序员网课和国考 980 系统班</p>
<p>小时候我看了好几次东邪西毒，但当时看不懂，所以更喜欢东成西就这样纯粹的荒谬与欢笑，大话西游这样的刻骨铭心的感情</p>
<p>在王家卫的电影哲学里，武侠、江湖皆成摆设，唯有爱与孤独才是亘古不变的精神主题</p>
<p>父母总说长大后就能看懂，但我已经很久没有再看了，因为我觉得我还是看不懂</p>
<p>有些东西，我并不觉得会随着阅历或者经验的增长而改变</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10bb350ff4784eb4863e17859eb4536c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=G40y4FnA1%2BH%2Fnq7P2IYWJ7occbc%3D" alt="Screenshot 2025-08-10 at 15.39.55" loading="lazy"/></p>
<p>一次偶然，初中同学聊天，他说我变了，其实好多人也说过，到初中之后就开始了</p>
<p>不过他们总会对外貌成绩一类的感兴趣，或者感到惊讶</p>
<p>其实人真正改变的是内心，内心的改变是几乎不会表露在外的</p>
<p>所以我一般都把他们的话当耳旁风</p>
<p><strong>因为从来没有人问过我经历过什么</strong></p>
<p>我有时会想到一个高中时很好的朋友身前，一个和我在大大小小的考试中对于名次较劲的人</p>
<p>我曾经很想问问他，你看我有几分像从前</p>
<p>但是已经觉得有些意兴阑珊，坚如磐石的友谊也会在岁月下磨损，最终消逝</p>
<p>极少数人属于木桶中的美酒，岁月流逝后，反而越发醇香</p>
<p>很明显，即使是他，也属于前者</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c47a5f0abcbe48fc867dbfe9a457c39f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=ID8MIyrzUeL95%2BWRAj%2F75W7xKgA%3D" alt="Screenshot 2025-08-10 at 15.34.59" loading="lazy"/></p>
<p>我一直觉得，我以前和现在，本质上并没有太大的变化，直到我看到曾经自己写的日寄</p>
<p>我需要承认，我和以前不一样了</p>
<p>我不再敢打敢拼，不再义无反顾，我会犹豫，会权衡利弊，会害怕未来，会怀疑自己</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef9a78845f994e47a2ebd458abde97e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=HBoEumVPMucIcdo0ccv44p6TcXU%3D" alt="Screenshot 2025-08-10 at 15.31.15" loading="lazy"/></p>
<p>很久以前看 anlin 老师的文章，记得评论区有句话说，说是如果有一天 anlin 老师不再更新文章了，说不定不是一件坏事，因为这说明 anlin 老师在努力生活，或者过得不错，所以不再写日寄了</p>
<p><strong>可我不是</strong></p>
<p>我想把这句话改改，我的日寄大多数时候都很丧，其中虽然有我个人的原因在，但也有深夜写文章的 buff 加成，我希望有一天，大家都能过得不错，这样就不用看我的文章来找一些什么精神共鸣了，但我还是希望提供一些其他东西在，比如我的失败经历、我的踩坑经验，也希望对你有些帮助</p>
<p>有时候总在想人到底为了什么而活</p>
<p>我问家里一个长辈，他说是为了他女儿，我觉得太俗套</p>
<p>我问还在上高中快要高考的表妹，她说是为了自己，我觉得太热血</p>
<p>我问了不少人，大多说法都很千篇一律</p>
<p>我想到问一个大学时候很中二的朋友，他说我脑子是不是进水了</p>
<p>我说我在思考人生，这是个大事</p>
<p>他说福州有家日料自助打折了，准备找空去吃</p>
<p>我也在看自助，但是自助的价格总是很贵</p>
<p>但是要是能睡前买一张自助餐票，然后睡醒了去坐一段不长不短的地铁，狠狠地吃一顿</p>
<p>这样活着也还不错</p>
<p>但人总会告别这个世界，如果是生病的话，应该会有一个时间周期，如果真有这么一天，我不希望你遇到我时，和我说你有多舍不得我，什么没我不行，什么明明知道没有希望还鼓励我的话，什么没有你日子怎么过，你有什么事情还没有做，等你好了我们一起去怎样怎样...</p>
<p>我更想听的是，你有多么怀念我，我这辈子已经完成了什么，告诉我接下来的日子没有我你们仍然会好好过</p>
<p>这就足够了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f48ccdb5a603468da441529dee154ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=yZQfqXiuvAYkxxvY%2FEqij%2BxBxsk%3D" alt="image-20260207193109269" loading="lazy"/></p>
<p>最近贼有意思，朋友和对象吵架要分手，朋友的对象问：那我们之前的回忆算什么？</p>
<p>TA 说这算你记性好</p>
<p>女生又说：如果未来再相见呢？</p>
<p>TA 说那算你运气好</p>
<p>我的运气就挺点背的，说了再见的人基本没能再见过</p>
<p>有些缘分就像北平的秋雨，不贪心便是落叶轻覆的思念，过分执着就成了望不穿的绵绵水帘</p>
<p><strong>一生很长，很多人不会永远在我的生活里，但会永远在我的故事里</strong></p>
<p>朋友说酒是万能的，配什么都能喝，也没什么忌口</p>
<p>我说也不一定，和头孢就能起反应</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9089c51e340438da5ec47ee465d1a1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=shZO0vPFvhEjwsnVWRxDI7YlN1U%3D" alt="Screenshot 2025-08-10 at 15.38.56" loading="lazy"/></p>
<p>最近快放假了，我朋友说好久没来见过我了，问我有没有空，说是想我了</p>
<p>我发现人可以用懒这个词解释很多事情，特别是在现代社会</p>
<p>比如懒得起了，懒得学了，懒得卷了，懒得见了</p>
<p>摆烂这个词挺好，可以称得上是立体防御</p>
<p>什么时候等我摆明白了，或许就看开了</p>
<p>有时也会想在寒假去见一见多年未见的朋友，有时又觉得不值得</p>
<p>比如舍弃一些实习的机会，科研的时间</p>
<p><strong>为了所谓的正确、成功，人们不断失去</strong></p>
<p>我是那种会因为预料到将来的离别而去珍惜与当下朋友相处时间的人</p>
<p>但不是所有人都这样，所以大多数情况下我都是在浪费感情</p>
<p>这是一个流行离开的世界，但是我们都不擅长告别，时间不会抚平悲伤，只会让人淡然</p>
<p>我是个计划性比较强的人，但唯一不可能计划的便是生命的长度，我们往往在追寻其中忽视了它的宽度，忘记去创造更多的价值，我们不知道自己生命的长短，但我们现在还在这个世界上，就应该好好生活。生命本来就不长，焦虑也是一天，开心也是一天，为何不开开心心的过</p>
<p>最近看过一句话，不知道出自哪里，说是“今天可以死，明天也可以活”，这种境界是很高的</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b974f2769bc4898ae20e8f4e9d96bd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=srEu%2FBsBThNxZA%2FZYuZrLj3FRqg%3D" alt="img" loading="lazy"/></p>
<p>当我在写这篇年终时，正在为学习和生活上的一地鸡毛而烦恼着。</p>
<p>不知你们会不会也像我一样，在过去或未来的某个时刻，也在怀念着那个无忧的年代。</p>
<p><strong>落叶随着风一阵摆动，家乡的银杏树一直都在，可是我已经回不去了</strong></p>
<h2 data-id="heading-4">#05 生活碎片</h2>
<p>人的烦恼就是记性太好，如果可以把所有事都忘掉，以后每一天都是个新开始，你说多好</p>
<p><strong>时间改变了太多东西了</strong></p>
<blockquote>
<p>总要做点什么自己认为正确的事</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aefb24def2154712a20d8df727975885~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=vbp%2BuyG8%2FLbmunxGsFb3zXk84y4%3D" alt="IMG_8178" loading="lazy"/></p>
<blockquote>
<p>依旧 Eason</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1599e47c29245d5892cad8e40881a06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=irh%2BbbnDULwdhqAFA8pFoL1kIGc%3D" alt="IMG_8174" loading="lazy"/></p>
<blockquote>
<p>JayChou 今年倒是听少了</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f3e5001b47649ffa620b4caf928cfd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=gTxB1AKk%2FUB5Cl10%2B9GYvMSSO4A%3D" alt="IMG_8176" loading="lazy"/></p>
<blockquote>
<p>LeetCode 2025</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f7ac0d3e7694c1eaaaa2063cb6c3c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=d1ux2tutaBbSJfW9XyfbDddidXk%3D" alt="IMG_6507" loading="lazy"/></p>
<blockquote>
<p>📷 摄影是我割舍不去的爱好</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cc0127d12d748448da1bfa1ae067bab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=nwnweLSq5hc57DyPfkzMofPA5jc%3D" alt="6fba819e71870abe011e10ee428f6b07" loading="lazy"/></p>
<blockquote>
<p>略懂些游戏</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/725f4bc1dbd6491b91c04ad54ce837a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=SP%2BFLmVVRO%2Fa7XJMibb516hFb60%3D" alt="e8bd49c009317151783585ea76dba568" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bffa5e86e0004c8a99b1a94afa109ba2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=%2FK37sbnfFvskaV7yk7hH8Mdcb0M%3D" alt="858436270d98ea632151263fcf4daf5b" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67bf1e74508b409ea7dba074d54d18f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=R6V2vIB5Qo0vBTWMZR6QX2R1zSU%3D" alt="IMG_8172" loading="lazy"/></p>
<blockquote>
<p>晚霞</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4227ccd5f044f67a3e891165bd824a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=DqFy8wq9gqsON5U6QLkDHkdSrRE%3D" alt="8a743a6c20cd75acedb7908bfd0d1397" loading="lazy"/></p>
<blockquote>
<p>跨年晚会</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/518557190e9d4bd3b75e914eaf0b5ab0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=LhOiEVzC0NTlnwRqK6aIS2WvzAc%3D" alt="P1000439" loading="lazy"/></p>
<p>夜晚有风，但不冷，白天的余温还没散去，风吹来只觉得凉爽</p>
<p>很像大三刚保研完在湖边吹风的那个夜晚，意气风发</p>
<p>不过意气风发这个词仿佛永远都不再适合我了</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b29c54f0a1fe454898e8fbb26242afbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771169660&amp;x-signature=yh94bvTXEsnW5H6l%2BD9eUY1MYL4%3D" alt="2e24ee37470ef4910e30365fd81c4659" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SeeDance Videos Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7603854784864878632</link>    <guid>https://juejin.cn/post/7603854784864878632</guid>    <pubDate>2026-02-08T15:54:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603854784864878632" data-draft-id="7603959423127879680" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SeeDance Videos Generation API 对接说明"/> <meta itemprop="keywords" content="API,AIGC"/> <meta itemprop="datePublished" content="2026-02-08T15:54:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SeeDance Videos Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T15:54:38.000Z" title="Sun Feb 08 2026 15:54:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 SeeDance Videos Generation API 对接说明，它是可以通过输入自定义参数来生成SeeDance官方的视频。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fseedance-videos" target="_blank" title="https://platform.acedata.cloud/documents/seedance-videos" ref="nofollow noopener noreferrer">SeeDance Videos Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d0565ee27074f1fb9f305a542b57322~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771170878&amp;x-signature=2ZzBewf%2Fe1g7TkudgQac7UwLJ6M%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入提示词 <code>content.text</code>、类型<code>content.type=text</code> 以及模型 <code>model</code>，便可获得处理后的结果，具体的内容如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82314d0e61cd41f59155cbbaefa41c1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771170878&amp;x-signature=MkJ2Mj5AdQeIx5I0n68C6oz9H6g%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>model</code>：生成视频的模型，主要有<code>doubao-seedance-1-0-pro-250528</code>、<code>doubao-seedance-1-0-pro-fast-251015</code>,<code>doubao-seedance-1-5-pro-251215</code>,<code>doubao-seedance-1-0-lite-t2v-250428</code>,<code>doubao-seedance-1-0-lite-i2v-250428</code></li>
<li><code>context</code>：content的type可以是text，也可以是image_url, image_url支持图片链接和base64数组两种，image_url和text参数互斥。</li>
<li><code>service_tier</code>：有<code>default</code>和<code>flex</code>两种。</li>
<li><code>return_last_frame</code>：是否返回最后一帧</li>
<li><code>execution_expires_after</code>：执行超时时间。</li>
<li><code>callback_url</code>：需要回调结果的URL。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ce4cb7c015d4bb3991eb504bfc856c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771170878&amp;x-signature=or3bz5Fmdq%2FpOwDCNfOjwVNjdbg%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ec22ae22-0140-4033-8c86-a48b536da595"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1cc87db0-8ee5-4436-969b-35cc571a9fd5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222005129-62fhb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/f592800a-b87c-4705-8796-cbb8018cae35.mp4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时视频生成任务的状态情况。</li>
<li><code>task_id</code>，此时视频生成任务ID。</li>
<li><code>trace_id</code>，此时视频生成跟踪ID。</li>
<li><code>data</code>，此时视频生成任务的结果列表。
<ul>
<li><code>task_id</code>，此时视频生成任务的服务器端ID。</li>
<li><code>video_url</code>，此时视频生成任务的视频链接。</li>
<li><code>status</code>，此时视频生成任务的状态。</li>
<li><code>model</code>，生成视频使用的模型。</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了满意的视频信息，我们只需要根据结果中 <code>data</code> 的视频链接地址获取生成的SeeDance视频即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/seedance/videos' \
-H 'authorization: Bearer ${bearer_token}' \
-H 'accept: application/json' \
-H 'content-type: application/json' \
-d '{
  "content": [{"text":"A kitten yawning at the camera. --rs 720p --rt 16:9 --dur 5 --fps 24 --wm true --seed 11 --cf false","type":"text"}],
  "model": "doubao-seedance-1-0-pro-250528"
}'
</code></pre>
<h2 data-id="heading-2">图生视频首帧</h2>
<p>如果想图生视频任务， 首先<code>context</code>参数需要选择<code>image_url</code>，并在其子节点<code>url</code>必须传入参考图片链接或者base64编码，请遵循此格式data:image/&lt;图片格式&gt;;base64,&lt;Base64编码&gt;，注意 &lt;图片格式&gt; 需小写，如 data:image/png;base64,{base64_image}，就可以指定如下内容：</p>
<ul>
<li>image_url：该图生视频任务采用的参考图链接。</li>
</ul>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/seedance/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"content"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/i2v_foxrgirl.png"</span>
            }
        },
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"A girl holds a fox in her arms. She opens her eyes and gazes tenderly at the camera, while the fox affectionately holds her back. As the camera slowly pulls away, her hair is gently blown by the wind. --ratio adaptive  --dur 5"</span>
        }
    ],
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dc7cceb5-3c12-4de7-a5f4-abcbba3e8e39"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b3b09de3-b7fa-4bb0-88b5-aad4b4a96fd4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222072003-x2259"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/6afb78b8-5ba8-424f-adcd-69423a700b50.mp4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是图生建视频的，结果与上文类似。</p>
<h2 data-id="heading-3">图生视频首尾帧</h2>
<p>如果想图生视频首尾帧， 首先参数<code>content</code>必须传入类型<code>image_url</code>,并且分别设置<code>role</code>为<code>first_frame</code>和<code>last_frame</code>，就可以指定如下内容：</p>
<ul>
<li>role：指定首帧或者尾帧。</li>
<li>image_url
<ul>
<li>url  图片链接
同时 <code>content</code> 还需要输入类型<code>text</code>作为prompt提示词</li>
</ul>
</li>
</ul>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/sora/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
   <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>,
    <span class="hljs-string">"content"</span>: [
         {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"360-degree shot"</span>
        },
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/seepro_first_frame.jpeg"</span>
            },
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"first_frame"</span>
        },
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/seepro_last_frame.jpeg"</span>
            },
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"last_frame"</span>
        }
    ]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f7096c6c-9430-4392-8201-d259632d7afd"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a4a3721-00fb-43d2-aff2-3b516ac01a8a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222073134-54qcw"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/95f9f5f0-fc50-4c71-bc6f-e154582c141e.mp4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是角色生成视频，结果与上文类似。</p>
<h2 data-id="heading-4">异步回调</h2>
<p>由于 SeeDance Videos Generation API生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成视频的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>输入<code>callbacl_url</code>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f7096c6c-9430-4392-8201-d259632d7afd"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>当任务完成的时候，平台会将最后的结果以POST的形式推送到 <code>callback_url</code>的网址</p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f7096c6c-9430-4392-8201-d259632d7afd"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a4a3721-00fb-43d2-aff2-3b516ac01a8a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222073134-54qcw"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/95f9f5f0-fc50-4c71-bc6f-e154582c141e.mp4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-5">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-6">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">结论</h2>
<p>通过本文档，您已经了解了如何使用 SeeDance Videos Generation API 可通过输入提示词以及参考图片来生成视频。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[能力中心 (Agent SkillCenter)：开启AI技能管理新时代]]></title>    <link>https://juejin.cn/post/7603783314713247780</link>    <guid>https://juejin.cn/post/7603783314713247780</guid>    <pubDate>2026-02-08T16:01:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603783314713247780" data-draft-id="7603911453704667179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="能力中心 (Agent SkillCenter)：开启AI技能管理新时代"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-08T16:01:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            能力中心 (Agent SkillCenter)：开启AI技能管理新时代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T16:01:27.000Z" title="Sun Feb 08 2026 16:01:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌟 什么是能力中心？</h2>
<p>能力中心 (Agent SkillCenter) 是一个革命性的AI技能管理平台，为企业和个人用户提供全方位的技能生命周期管理解决方案。它不仅是一个技能市场，更是一个去中心化的AI能力生态系统。</p>
<h2 data-id="heading-1">🎯 核心功能亮点</h2>
<h3 data-id="heading-2">1️⃣ <strong>技能全生命周期管理</strong></h3>
<ul>
<li><strong>智能注册</strong>：自动化技能注册和验证</li>
<li><strong>高效执行</strong>：分布式技能执行引擎</li>
<li><strong>实时监控</strong>：技能执行状态和性能监控</li>
<li><strong>自动扩缩</strong>：根据负载自动调整资源</li>
</ul>
<h3 data-id="heading-3">2️⃣ <strong>去中心化P2P网络</strong></h3>
<ul>
<li><strong>节点发现</strong>：智能P2P节点发现机制</li>
<li><strong>技能分发</strong>：高效的技能分发网络</li>
<li><strong>安全通信</strong>：端到端加密通信</li>
<li><strong>故障容错</strong>：分布式架构确保高可用性</li>
</ul>
<h3 data-id="heading-4">3️⃣ <strong>个人AI中心</strong></h3>
<ul>
<li><strong>隐私保护</strong>：多级隐私控制机制</li>
<li><strong>设备集成</strong>：无缝连接智能设备</li>
<li><strong>数据同步</strong>：安全的数据同步服务</li>
<li><strong>个性化体验</strong>：根据用户习惯智能调整</li>
</ul>
<h3 data-id="heading-5">4️⃣ <strong>技能市场</strong></h3>
<ul>
<li><strong>智能推荐</strong>：基于用户行为的技能推荐</li>
<li><strong>评价系统</strong>：透明的技能评价机制</li>
<li><strong>安全交易</strong>：去中心化的技能交易</li>
<li><strong>版本管理</strong>：技能版本控制和更新</li>
</ul>
<h3 data-id="heading-6">5️⃣ <strong>企业级管理</strong></h3>
<ul>
<li><strong>团队协作</strong>：多人团队技能管理</li>
<li><strong>权限控制</strong>：细粒度的访问权限</li>
<li><strong>审计日志</strong>：完整的操作审计记录</li>
<li><strong>API集成</strong>：丰富的API接口</li>
</ul>
<h2 data-id="heading-7">💼 应用场景</h2>
<h3 data-id="heading-8">🏢 企业应用</h3>
<ul>
<li><strong>自动化工作流</strong>：将重复任务转化为可执行技能</li>
<li><strong>团队协作</strong>：共享和管理企业内部技能</li>
<li><strong>智能客服</strong>：部署专业领域的AI技能</li>
<li><strong>数据分析</strong>：快速构建和执行数据分析技能</li>
</ul>
<h3 data-id="heading-9">🧑‍💻 开发者生态</h3>
<ul>
<li><strong>技能变现</strong>：创建和销售专业技能</li>
<li><strong>快速迭代</strong>：敏捷的技能开发和测试</li>
<li><strong>社区贡献</strong>：参与开源技能生态建设</li>
<li><strong>技术创新</strong>：探索AI技能的新应用场景</li>
</ul>
<h3 data-id="heading-10">🏠 个人用户</h3>
<ul>
<li><strong>智能助手</strong>：个性化的AI生活助手</li>
<li><strong>学习工具</strong>：定制化的学习技能</li>
<li><strong>健康管理</strong>：智能健康监测和建议</li>
<li><strong>娱乐休闲</strong>：个性化的娱乐内容推荐</li>
</ul>
<h2 data-id="heading-11">🔧 技术架构</h2>
<p>能力中心采用现代化的技术架构：</p>
<ul>
<li><strong>后端</strong>：Java 8 + Spring Boot</li>
<li><strong>前端</strong>：HTML5 + JavaScript + CSS3</li>
<li><strong>存储</strong>：多种存储方案支持</li>
<li><strong>网络</strong>：P2P分布式网络</li>
<li><strong>安全</strong>：多层安全防护机制</li>
<li><strong>部署</strong>：支持多种部署模式</li>
</ul>
<h2 data-id="heading-12">📈 为什么选择能力中心？</h2>
<ol>
<li><strong>开放性</strong>：完全开源，支持自定义扩展</li>
<li><strong>去中心化</strong>：P2P网络确保数据安全和隐私</li>
<li><strong>易用性</strong>：直观的Web控制台和API</li>
<li><strong>可扩展性</strong>：模块化设计，易于集成新功能</li>
<li><strong>高性能</strong>：分布式架构，支持高并发</li>
<li><strong>安全性</strong>：多层安全机制保护数据和技能</li>
</ol>
<h2 data-id="heading-13">🚀 快速开始</h2>
<h3 data-id="heading-14">安装部署</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/oodercn/skillcenterdemo.git

<span class="hljs-comment"># 构建项目</span>
mvn clean package

<span class="hljs-comment"># 启动服务</span>
java -jar target/agent-skillcenter.jar
</code></pre>
<h3 data-id="heading-15">访问控制台</h3>
<p>打开浏览器访问：<code>http://localhost:8080/console</code></p>
<h2 data-id="heading-16">🌐 加入生态系统</h2>
<p>能力中心不仅仅是一个软件，更是一个不断成长的生态系统。我们欢迎：</p>
<ul>
<li><strong>开发者</strong>：创建和贡献技能</li>
<li><strong>企业</strong>：集成和定制能力中心</li>
<li><strong>研究人员</strong>：探索AI技能的新可能性</li>
<li><strong>爱好者</strong>：参与社区建设和讨论</li>
</ul>
<h2 data-id="heading-17">📞 联系我们</h2>
<ul>
<li><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foodercn%2Fskillcenterdemo" target="_blank" title="https://github.com/oodercn/skillcenterdemo" ref="nofollow noopener noreferrer">github.com/oodercn/ski…</a></li>
<li><strong>官方网站</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FooderCN" target="_blank" title="https://gitee.com/ooderCN" ref="nofollow noopener noreferrer">gitee.com/ooderCN</a></li>
</ul>
<hr/>
<h2 data-id="heading-18">🎉 开启智能技能新时代</h2>
<p>能力中心正在重新定义AI技能的管理和应用方式。无论您是企业用户、开发者还是个人用户，都能在这个平台上找到属于自己的AI能力解决方案。</p>
<p><strong>加入能力中心，释放AI的无限潜能！</strong></p>
<blockquote>
<p><em>"能力中心 - 连接智能，创造未来"</em></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[墨梅博客 1.4.0 发布与开源动态 | 2026 年第 6 周草梅周报]]></title>    <link>https://juejin.cn/post/7603911453704519723</link>    <guid>https://juejin.cn/post/7603911453704519723</guid>    <pubDate>2026-02-08T14:05:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704519723" data-draft-id="7603673564909338659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="墨梅博客 1.4.0 发布与开源动态 | 2026 年第 6 周草梅周报"/> <meta itemprop="keywords" content="GitHub,开源,AI编程"/> <meta itemprop="datePublished" content="2026-02-08T14:05:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草梅友仁"/> <meta itemprop="url" content="https://juejin.cn/user/3043088413495815"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            墨梅博客 1.4.0 发布与开源动态 | 2026 年第 6 周草梅周报
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3043088413495815/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草梅友仁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:05:45.000Z" title="Sun Feb 08 2026 14:05:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a> 发布和更新，并在多个平台同步发布。如有更新，以博客上的版本为准。您也可以通过文末的 <code>原文链接</code> 查看最新版本。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>欢迎来到草梅周报！这是一个由草梅友仁基于 AI 整理的周报，旨在为您提供最新的博客更新、GitHub 动态、个人动态和其他周刊文章推荐等内容。</p>
<hr/>
<h2 data-id="heading-1">开源动态</h2>
<p>本周依旧在开发 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei" target="_blank" title="https://github.com/CaoMeiYouRen/momei" ref="nofollow noopener noreferrer">墨梅 (Momei)</a> 中。</p>
<blockquote>
<p>您可以前往 Demo 站试用：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.momei.app%2F" target="_blank" title="https://demo.momei.app/" ref="nofollow noopener noreferrer">demo.momei.app/</a></p>
<ul>
<li>您可以通过邮箱 <code>admin@example.com</code>，密码<code>momei123456</code>登录演示用管理员账号。</li>
</ul>
<p>或前往官网注册：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmomei.app%2F" target="_blank" title="https://momei.app/" ref="nofollow noopener noreferrer">momei.app/</a></p>
<p>也可以前往文档站来了解项目整体规划和未来开发路线图：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.momei.app%2F" target="_blank" title="https://docs.momei.app/" ref="nofollow noopener noreferrer">docs.momei.app/</a></p>
</blockquote>
<p>当前墨梅博客已经正式发布了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Freleases%2Ftag%2Fv1.4.0" target="_blank" title="https://github.com/CaoMeiYouRen/momei/releases/tag/v1.4.0" ref="nofollow noopener noreferrer">1.4.0</a> 版本，以下是页面和功能的一些截图。</p>
<p>新增了订阅中心和通知管理页面，可以一键管理订阅和通知。同时，也增加了 Atom 1.0 和 JSON Feed 1.1 格式的订阅支持。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea8ee5b8d5340cf80f297ed9a79b8a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771164345&amp;x-signature=%2B4gtDqGPK5FcCFQbFFFTIGre7wY%3D" alt="image-20260208200813141" loading="lazy"/></p>
<p>新增全局打赏和社交链接支持，及个人打赏和社交链接支持。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bf4206f32254bc3be266ae2360e6f15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771164345&amp;x-signature=VawkUZrE6AIEgJTAi2ETXT068Wk%3D" alt="image-20260208201222647" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fb1da2768de4e239d5d4359f52320e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771164345&amp;x-signature=tp%2BiuBb5v2ojFI0Vp%2F7GVoYOJjA%3D" alt="image-20260208211042923" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4252078c15824e02bcf692e1429629eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5qKF5Y-L5LuB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771164345&amp;x-signature=49xcLAXRf8F5%2BQsG%2FFjPeKV1He0%3D" alt="image-20260208211424622" loading="lazy"/></p>
<p>更多功能和页面可以前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fmomei.app%2F" target="_blank" title="https://momei.app/" ref="nofollow noopener noreferrer">官网</a>体验，也可前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2025-51-caomei-weekly-momei-blog-mvp-caomei-auth-update.html" target="_blank" title="https://blog.cmyr.ltd/archives/2025-51-caomei-weekly-momei-blog-mvp-caomei-auth-update.html" ref="nofollow noopener noreferrer">之前的博客</a>查看截图。</p>
<p>欢迎各位用户体验。并提出意见和建议。</p>
<p>接下来的话还会继续按照路线图和待办进行开发功能，敬请期待。</p>
<p>当然，目前墨梅博客还有很多需要打磨的细节，功能上也还不完善，如有任何意见和建议，都可以在项目的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Fissues" target="_blank" title="https://github.com/CaoMeiYouRen/momei/issues" ref="nofollow noopener noreferrer">GitHub issues</a> 中提出。</p>
<p>如果你也对墨梅博客感兴趣，欢迎参与开发和测试。</p>
<h2 data-id="heading-2">最新 GitHub 仓库</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fcmyr-skills-agents" target="_blank" title="https://github.com/CaoMeiYouRen/cmyr-skills-agents" ref="nofollow noopener noreferrer">cmyr-skills-agents</a> - 2026-02-02 02:21:41</li>
</ul>
<h2 data-id="heading-3">GitHub Release</h2>
<h3 data-id="heading-4">momei</h3>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fmomei%2Freleases%2Ftag%2Fv1.4.0" target="_blank" title="https://github.com/CaoMeiYouRen/momei/releases/tag/v1.4.0" ref="nofollow noopener noreferrer">v1.4.0</a> - 2026-02-07 20:08:32</h4>
<p>摘要:<br/>
版本 1.4.0 更新摘要 (2026-02-07)</p>
<p>新功能：</p>
<ul>
<li>新增翻译聚合功能，支持多语言翻译管理</li>
<li>后端添加用户协议和隐私政策管理功能</li>
<li>实现邮件模板国际化模块</li>
<li>开发 PrimeVue 与 Vue-i18n 动态同步插件</li>
<li>新增社交链接和打赏配置管理组件</li>
<li>扩展用户通知功能，新增通知设置和营销活动实体</li>
<li>添加 PrimeVue 中文语言支持</li>
<li>新增测试邮件发送和营销邮件预览功能</li>
<li>实现管理员通知设置页面，支持邮件和浏览器通知</li>
<li>新增营销中心页面及相关管理功能</li>
<li>添加赞助功能，支持社交链接和打赏管理</li>
</ul>
<p>Bug 修复：</p>
<ul>
<li>修复系统设置页面存储配置问题</li>
<li>优化 CLI 工具导入功能和参数验证</li>
<li>解决多个依赖版本兼容性问题</li>
<li>更新法律声明文本</li>
<li>修复未登录用户访问权限问题</li>
<li>增强设置获取的错误处理</li>
<li>改进国际化支持，添加常用词汇</li>
</ul>
<p>代码重构：</p>
<ul>
<li>优化验证码功能，支持 IP 和 UA 验证</li>
<li>改进 PWA 插件加载逻辑</li>
<li>使用新组件替换 HTML 渲染</li>
<li>更换富文本编辑器增强功能</li>
<li>简化协议和主题配置处理</li>
<li>统一 API 路径命名</li>
<li>优化用户管理界面国际化</li>
<li>简化代码结构，移除冗余组件</li>
</ul>
<h3 data-id="heading-6">eslint-config-cmyr</h3>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.3" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.3" ref="nofollow noopener noreferrer">v2.1.3</a> - 2026-02-08 13:01:42</h4>
<p>摘要:<br/>
版本 2.1.3 (2026-02-08)</p>
<p>主要更新：</p>
<p>Bug 修复：</p>
<ul>
<li>新增 TypeScript ESLint 规则，禁止枚举类型与非枚举成员之间的比较操作</li>
</ul>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.2" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.2" ref="nofollow noopener noreferrer">v2.1.2</a> - 2026-02-05 20:12:46</h4>
<p>摘要:<br/>
版本 2.1.2 (2026-02-05)</p>
<p>主要更新内容：</p>
<p>Bug 修复：</p>
<ul>
<li>允许在代码中使用非空断言操作符(!)来断言非空类型</li>
</ul>
<p>该版本主要解决了类型断言相关的问题，放宽了对非空断言操作符的使用限制。</p>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.1" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.1" ref="nofollow noopener noreferrer">v2.1.1</a> - 2026-02-05 20:06:06</h4>
<p>摘要:<br/>
版本 2.1.1 (2026-02-05) 摘要：</p>
<p>Bug 修复：</p>
<ol>
<li>启用了推荐的类型检查配置并调整了 ESLint 规则</li>
<li>更新了 TypeScript ESLint 规则以增强类型检查和代码质量</li>
</ol>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.1-beta.2" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.1-beta.2" ref="nofollow noopener noreferrer">v2.1.1-beta.2</a> - 2026-02-05 19:50:02</h4>
<p>摘要:<br/>
GitHub Release 摘要：</p>
<p>版本：2.1.1-beta.2<br/>
发布日期：2026-02-05</p>
<p>主要更新内容：</p>
<ul>
<li>Bug 修复：更新了 TypeScript ESLint 规则，增强了类型检查和代码质量</li>
</ul>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Feslint-config-cmyr%2Freleases%2Ftag%2Fv2.1.1-beta.1" target="_blank" title="https://github.com/CaoMeiYouRen/eslint-config-cmyr/releases/tag/v2.1.1-beta.1" ref="nofollow noopener noreferrer">v2.1.1-beta.1</a> - 2026-02-05 19:19:08</h4>
<p>摘要:<br/>
版本 2.1.1-beta.1 摘要 (2026-02-05)</p>
<p>主要更新内容：</p>
<p>Bug 修复：</p>
<ul>
<li>启用了推荐的类型检查配置，并对 ESLint 规则进行了相应调整</li>
</ul>
<h3 data-id="heading-12">cookie-cloudflare</h3>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCaoMeiYouRen%2Fcookie-cloudflare%2Freleases%2Ftag%2Fv1.5.0" target="_blank" title="https://github.com/CaoMeiYouRen/cookie-cloudflare/releases/tag/v1.5.0" ref="nofollow noopener noreferrer">v1.5.0</a> - 2026-02-08 01:41:46</h4>
<p>摘要:<br/>
版本 1.5.0 更新摘要 (2026-02-07)</p>
<p>主要更新内容：</p>
<ol>
<li>新功能</li>
</ol>
<ul>
<li>新增 Cloudflare 缓存刷新功能</li>
<li>更新了配置项以支持新变量</li>
</ul>
<p>本次更新主要增加了对 Cloudflare 缓存刷新的支持，并对相关配置项进行了相应调整以适应新功能。所有变更均可在提交记录 ef69717 中查看详情。</p>
<h2 data-id="heading-14">最新 GitHub 加星仓库</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frainxchzed%2FGithub-Store" target="_blank" title="https://github.com/rainxchzed/Github-Store" ref="nofollow noopener noreferrer">CaoMeiYouRen starred Github-Store</a> - 2026-02-06 15:53:04<br/>
开源 GitHub 应用商店，支持一键浏览、发现和安装应用。基于 Kotlin 和 Compose Multiplatform 开发，兼容 Android 及桌面系统(Linux、MacOS、Windows)。项目主要使用 Kotlin 语言，获得 6438 星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fobra%2Fsuperpowers" target="_blank" title="https://github.com/obra/superpowers" ref="nofollow noopener noreferrer">CaoMeiYouRen starred superpowers</a> - 2026-02-04 14:11:30<br/>
一个有效的自主技能框架和软件开发方法论<br/>
主要使用 Shell 语言<br/>
GitHub 星标数达 47385</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxai-org%2Fx-algorithm" target="_blank" title="https://github.com/xai-org/x-algorithm" ref="nofollow noopener noreferrer">CaoMeiYouRen starred x-algorithm</a> - 2026-02-04 14:11:23<br/>
X 平台的 For You 推荐算法采用 Rust 语言开发，该项目已在 GitHub 获得 15106 颗星标。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcavi-au%2FConsent-O-Matic" target="_blank" title="https://github.com/cavi-au/Consent-O-Matic" ref="nofollow noopener noreferrer">CaoMeiYouRen starred Consent-O-Matic</a> - 2026-02-04 14:11:14<br/>
一款基于 JavaScript 开发的浏览器扩展程序，可自动按用户偏好设置填写网站 cookie 弹窗。该工具已获得 3876 个 GitHub 星标，表明其在开发者社区中受到广泛关注和认可。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F4thfever%2Fcultivation-world-simulator" target="_blank" title="https://github.com/4thfever/cultivation-world-simulator" ref="nofollow noopener noreferrer">CaoMeiYouRen starred cultivation-world-simulator</a> - 2026-02-04 14:10:59<br/>
基于 Python 开发的开源修仙世界模拟器，采用 AI Agent 工作流技术构建动态演化的仙侠世界。该项目已在 GitHub 获得 764 星标，主要特点是通过智能代理系统模拟仙侠世界的开放性和复杂性。</li>
</ul>
<h2 data-id="heading-15">其他博客或周刊推荐</h2>
<h3 data-id="heading-16">阮一峰的网络日志</h3>
<ul>
<li><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2026%2F02%2Fweekly-issue-384.html" target="_blank" title="http://www.ruanyifeng.com/blog/2026/02/weekly-issue-384.html" ref="nofollow noopener noreferrer">科技爱好者周刊（第 384 期）：为什么软件股下跌</a> - 2026-02-06 08:14:20</li>
</ul>
<h3 data-id="heading-17">潮流周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.tw93.fun%2Fposts%2F256%2F" target="_blank" title="https://weekly.tw93.fun/posts/256/" ref="nofollow noopener noreferrer">第 256 期 - 上野天空</a> - 2026-02-02 08:00:00</li>
</ul>
<h3 data-id="heading-18">二丫讲梵的学习周刊</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwiki.eryajf.net%2Fpages%2Fddc309%2F" target="_blank" title="https://wiki.eryajf.net/pages/ddc309/" ref="nofollow noopener noreferrer">学习周刊-总第 249 期-2026 年第 06 周</a> - 2026-02-05 21:49:54</li>
</ul>
<h2 data-id="heading-19">总结</h2>
<p>本周的更新和动态如上所示。感谢您的阅读！<br/>
您可以通过以下方式订阅草梅周报的更新：</p>
<ul>
<li><strong>博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd" target="_blank" title="https://blog.cmyr.ltd" ref="nofollow noopener noreferrer">草梅友仁的博客</a></li>
<li><strong>墨梅博客</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmomei.app" target="_blank" title="https://momei.app" ref="nofollow noopener noreferrer">墨梅博客</a></li>
<li><strong>RSS</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Fweekly.xml" target="_blank" title="https://blog.cmyr.ltd/weekly.xml" ref="nofollow noopener noreferrer">草梅周报</a></li>
<li><strong>公众号</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Foss.cmyr.dev%2Fimages%2F20241025184516839-21n2ctv.png" target="_blank" title="https://oss.cmyr.dev/images/20241025184516839-21n2ctv.png" ref="nofollow noopener noreferrer">草梅友仁的后花园</a></li>
<li><strong>邮箱订阅</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flistmonk.cmyr.dev%2Fsubscription%2Fform" target="_blank" title="https://listmonk.cmyr.dev/subscription/form" ref="nofollow noopener noreferrer">草梅友仁的博客订阅</a></li>
</ul>
<h2 data-id="heading-20">往期回顾</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2026-05-caomei-weekly-momei-1-3-0-release-server-backup-lesson.html" target="_blank" title="https://blog.cmyr.ltd/archives/2026-05-caomei-weekly-momei-1-3-0-release-server-backup-lesson.html" ref="nofollow noopener noreferrer">墨梅博客 1.3.0 发布与服务器数据备份教训 | 2026 年第 5 周草梅周报</a> - 2026-02-01 23:40:42</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2026-04-caomei-weekly-momei-1-2-0-release-ai-development.html" target="_blank" title="https://blog.cmyr.ltd/archives/2026-04-caomei-weekly-momei-1-2-0-release-ai-development.html" ref="nofollow noopener noreferrer">墨梅博客 1.2.0 发布与 AI 开发实践 | 2026 年第 4 周草梅周报</a> - 2026-01-25 22:23:13</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2026-02-caomei-weekly-momei-blog-1-0-release-update.html" target="_blank" title="https://blog.cmyr.ltd/archives/2026-02-caomei-weekly-momei-blog-1-0-release-update.html" ref="nofollow noopener noreferrer">墨梅博客 1.0.0 发布与更新 | 2026 年第 2 周草梅周报</a> - 2026-01-11 18:55:41</li>
</ul>
<p>本文作者：草梅友仁<br/>
本文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmyr.ltd%2Farchives%2F2026-06-caomei-weekly-momei-1-4-0-release-open-source-updates.html" target="_blank" title="https://blog.cmyr.ltd/archives/2026-06-caomei-weekly-momei-1-4-0-release-open-source-updates.html" ref="nofollow noopener noreferrer">blog.cmyr.ltd/archives/20…</a><br/>
版权声明：本文采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-nc-sa%2F4.0%2Fdeed.zh-hans" target="_blank" title="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" ref="nofollow noopener noreferrer">CC BY-NC-SA 4.0 协议</a> 进行分发，转载请注明出处！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【节点】[DiffusionProfile节点]原理解析与实际应用]]></title>    <link>https://juejin.cn/post/7603911453704536107</link>    <guid>https://juejin.cn/post/7603911453704536107</guid>    <pubDate>2026-02-08T14:10:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704536107" data-draft-id="7603781883974090771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【节点】[DiffusionProfile节点]原理解析与实际应用"/> <meta itemprop="keywords" content="游戏开发,图形学,Unity3D"/> <meta itemprop="datePublished" content="2026-02-08T14:10:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SmalBox"/> <meta itemprop="url" content="https://juejin.cn/user/2218166695237532"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【节点】[DiffusionProfile节点]原理解析与实际应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2218166695237532/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SmalBox
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:10:45.000Z" title="Sun Feb 08 2026 14:10:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong></p>
</blockquote>
<p>扩散配置文件节点是高清渲染管线（HDRP）中一个专门用于处理次表面散射效果的重要工具。在Shader Graph中使用此节点，开发者能够轻松地集成和采样扩散配置文件资源，为材质实现逼真的皮肤、蜡、大理石等半透明物体的渲染效果。次表面散射是光线穿透半透明材质表面并在内部散射后从不同位置射出的物理现象，这种效果对于创造真实感渲染至关重要。</p>
<p>在现代实时渲染中，次表面散射效果的实现需要平衡视觉质量和性能消耗。Unity的HDRP通过扩散配置文件提供了一种标准化的方法来处理这种复杂的光学现象。扩散配置文件节点作为Shader Graph与这些配置文件之间的桥梁，使得即使没有深厚图形编程背景的艺术家也能创建出高质量的次表面散射材质。</p>
<h2 data-id="heading-0">节点基础概念与工作原理</h2>
<p>扩散配置文件节点的核心功能是输出一个唯一的浮点标识符，该标识符在着色器执行过程中用于查找对应的扩散配置文件资源。这种设计允许HDRP在渲染时高效地访问复杂的散射参数，而不需要在着色器中直接嵌入大量数据。</p>
<p>当在Shader Graph中创建扩散配置文件节点时，需要为其指定一个扩散配置文件资源。这个资源包含了描述材质如何散射光线的物理参数。节点输出的浮点值实际上是资源在内部数据库中的索引，HDRP使用这个索引在预计算的查找表中找到相应的散射数据。</p>
<p>节点的工作流程可以分为以下几个步骤：</p>
<ul>
<li>在编辑阶段，艺术家或开发者将扩散配置文件资源分配给节点</li>
<li>节点生成对应的唯一标识符（浮点值）</li>
<li>在运行时，着色器使用这个标识符查询散射参数</li>
<li>HDRP根据查询结果应用相应的次表面散射模型</li>
</ul>
<p>这种间接引用机制的优势在于：</p>
<ul>
<li>允许多个材质共享同一扩散配置文件，减少内存占用</li>
<li>简化着色器代码复杂度，提高可读性和维护性</li>
<li>提供统一的参数管理界面，便于调整和优化</li>
</ul>
<h2 data-id="heading-1">创建与配置扩散配置文件节点</h2>
<p>在Shader Graph中添加扩散配置文件节点是一个直观的过程。首先需要在Shader Graph编辑器的创建节点菜单中定位到该节点。可以通过以下步骤完成：</p>
<ul>
<li>在Shader Graph编辑器的空白区域右键点击，打开节点创建菜单</li>
<li>在搜索框中输入"Diffusion Profile"或浏览至HDRP类别下找到该节点</li>
<li>点击节点名称将其添加到图中</li>
</ul>
<p>添加节点后，最重要的步骤是将其与实际的扩散配置文件资源关联起来。在节点的检视面板中，可以看到一个资源引用字段，需要在此处指定一个已创建的扩散配置文件。如果项目中没有合适的扩散配置文件，需要先创建该资源。</p>
<p>创建扩散配置文件资源的过程：</p>
<ul>
<li>在Project视图中右键点击，选择Create &gt; Rendering &gt; HDRP Diffusion Profile</li>
<li>为新资源命名并调整其参数以满足项目需求</li>
<li>返回Shader Graph，将新创建的扩散配置文件资源拖拽到节点的对应字段中</li>
</ul>
<p>配置扩散配置文件资源时，需要理解几个关键参数的意义：</p>
<ul>
<li>散射半径（Scattering Radius）：定义光线在材质内部散射的距离，影响散射效果的柔和度和范围</li>
<li>纹理分辨率（Texture Resolution）：用于散射预积分纹理的尺寸，更高的分辨率提供更精确的结果但增加内存使用</li>
<li>散射颜色（Scattering Color）：影响散射光线的色调，通常设置为材质的主色调或血液颜色（对于皮肤）</li>
<li>权重参数（Weight Parameters）：控制不同类型散射的贡献程度，允许微调散射效果的外观</li>
</ul>
<p>正确配置这些参数对于获得理想的视觉效果至关重要。例如，在创建人类皮肤材质时，通常需要相对较小的散射半径和偏红的散射颜色，以模拟皮肤下血管的效果。</p>
<h2 data-id="heading-2">节点端口详解与数据流</h2>
<p>扩散配置文件节点仅有一个输出端口，标记为"Out"。这个端口的输出类型是浮点数，但其含义远超过普通的数值。理解这个输出值的本质对于正确使用节点至关重要。</p>
<p>输出端口的浮点值实际上是一个经过特殊编码的标识符，它不代表普通的数学值，而是指向内部扩散配置文件数据库的索引。当这个值传递给HDRP的着色器系统时，系统会使用它来查找对应的散射参数集。</p>
<p>由于这个特殊性质，对输出值的数学操作需要格外小心：</p>
<ul>
<li>将输出值乘以0会有效地禁用扩散配置文件，因为结果不再对应任何有效的配置文件索引</li>
<li>将输出值乘以1会保持原样，继续使用关联的扩散配置文件</li>
<li>其他数学操作可能导致未定义行为，因为结果值可能不对应任何已注册的配置文件</li>
</ul>
<p>在Shader Graph中连接扩散配置文件节点时，通常应将其输出直接连接到主节点的Diffusion Profile输入槽。这种直接连接确保标识符不被意外修改，保证HDRP能够正确识别和使用扩散配置文件。</p>
<p>在某些高级用例中，开发者可能需要在不同条件下选择使用不同的扩散配置文件。这种情况下，可以使用条件逻辑来控制使用哪个配置文件的标识符。例如，可以使用分支节点根据距离或其他因素在两个不同的扩散配置文件节点输出之间进行选择。但需要注意，HDRP不支持在同一像素上混合多个扩散配置文件，因此这种切换应该是离散的而非连续的。</p>
<h2 data-id="heading-3">在真实项目中的实际应用</h2>
<p>扩散配置文件节点最常见的应用是创建逼真的皮肤材质。人类皮肤具有复杂的多层结构，每层对光线的散射方式各不相同。使用扩散配置文件可以近似这种效果，而不需要模拟完整的体积散射。</p>
<p>创建真实皮肤材质的步骤：</p>
<ul>
<li>首先创建或获取一个基础皮肤纹理，包含漫反射颜色、法线信息和其他表面细节</li>
<li>在HDRP中创建扩散配置文件资源，设置适合皮肤的参数：
<ul>
<li>设置散射半径约为2-5毫米（取决于角色比例和艺术方向）</li>
<li>调整散射颜色为略带红色或橙色的色调，模拟皮下血液的影响</li>
<li>根据目标平台平衡纹理分辨率和质量需求</li>
</ul>
</li>
<li>在Shader Graph中集成扩散配置文件节点，将其输出连接到主节点</li>
<li>可能需要额外调整材质的光泽度和反射属性，以配合散射效果</li>
</ul>
<p>除了皮肤，扩散配置文件还可用于多种其他材质：</p>
<ul>
<li>蜡质材料：如蜡烛、奶酪等，通常需要中等散射半径和温和的散射颜色</li>
<li>植物材料：树叶、花瓣等，光透射效果可以通过散射模拟</li>
<li>大理石和玉石：这些矿物材料具有独特的半透明特性</li>
<li>塑料和橡胶：某些类型的塑料具有轻微的次表面散射效果</li>
</ul>
<p>在实际项目中，性能考虑是必不可少的。次表面散射是一种计算密集型效果，特别是在高分辨率下。对于移动平台或低端硬件，可能需要减少散射采样次数或使用简化的散射模型。HDRP提供了多种质量设置，允许根据目标平台调整散射计算的精度。</p>
<h2 data-id="heading-4">高级技巧与最佳实践</h2>
<p>掌握扩散配置文件节点的基本用法后，可以探索一些高级技巧来提升材质质量或优化性能。</p>
<p>多层材质技术：</p>
<p>对于特别复杂的材质如真实人类皮肤，单一扩散配置文件可能不足以捕捉所有细节。在这种情况下，可以使用多个材质层，每层使用不同的扩散配置文件。通过精心设计的混合策略，可以创建更加丰富和真实的散射效果。需要注意的是，这种技术会增加渲染成本，应谨慎使用。</p>
<p>性能优化策略：</p>
<ul>
<li>使用适当的纹理分辨率：对于远处可见的物体，可以使用较低分辨率的散射纹理</li>
<li>限制使用散射的物体数量：只为对视觉影响最大的物体启用高质量的次表面散射</li>
<li>利用HDRP的质量设置：根据目标平台调整全局散射质量</li>
<li>考虑使用简化的散射模型：对于某些材质，近似散射效果可能就足够了</li>
</ul>
<p>与其它HDRP功能集成：</p>
<p>扩散配置文件节点可以与其他HDRP特性结合使用，创建更加复杂和真实的效果。例如：</p>
<ul>
<li>与光线追踪结合：HDRP的光线追踪次表面散射可以提供更准确的物理效果，但性能成本更高</li>
<li>与后期处理效果配合：适当的颜色分级和色调映射可以增强散射效果的视觉冲击力</li>
<li>与光照系统协同：正确设置场景光照对于展现散射效果至关重要，特别是背光和边缘光情况</li>
</ul>
<p>调试和问题解决：</p>
<p>当散射效果不如预期时，可以使用以下方法进行调试：</p>
<ul>
<li>检查扩散配置文件资源是否正确分配给了节点</li>
<li>验证节点输出是否正确地连接到了主节点</li>
<li>使用HDRP的调试视图可视化散射效果，如散射 albedo 或散射半径</li>
<li>确保材质使用了正确的着色器类型，某些着色器可能不支持次表面散射</li>
</ul>
<h2 data-id="heading-5">常见问题与解决方案</h2>
<p>在使用扩散配置文件节点时，开发者可能会遇到一些典型问题。了解这些问题及其解决方案可以帮助节省调试时间。</p>
<p>节点输出值为0或无效：</p>
<p>这通常表示节点没有正确配置扩散配置文件资源。检查节点检视面板中的资源引用字段，确保已分配有效的扩散配置文件。如果资源已被删除或移动，需要重新分配。</p>
<p>散射效果不明显或过强：</p>
<p>这通常是由于扩散配置文件参数设置不当造成的。调整散射半径和散射颜色可以显著改变效果的外观。记住，散射半径的单位是米，因此对于小物体（如游戏角色），值通常在0.001到0.01范围内。</p>
<p>性能问题：</p>
<p>如果启用次表面散射后帧率显著下降，考虑以下优化措施：</p>
<ul>
<li>减少散射采样次数（在HDRP资产设置中调整）</li>
<li>降低扩散配置文件的纹理分辨率</li>
<li>只为近距离可见的物体使用高质量散射</li>
<li>使用HDRP的LOD系统，根据距离切换不同质量的散射效果</li>
</ul>
<p>平台兼容性问题：</p>
<p>虽然扩散配置文件节点专为HDRP设计，但在不同平台上可能有不同的表现。特别是在移动设备上，某些高级散射功能可能不可用。使用HDRP的平台特定设置可以确保在所有目标设备上获得一致的行为。</p>
<p>与自定义着色器代码的集成：</p>
<p>对于需要超出Shader Graph功能的高级用例，可能需要将扩散配置文件与自定义HLSL着色器代码结合使用。在这种情况下，需要了解HDRP如何内部处理扩散配置文件标识符，并确保自定义代码与HDRP的散射系统正确交互。</p>
<h2 data-id="heading-6">扩散配置文件节点的未来发展趋势</h2>
<p>随着实时渲染技术的不断进步，扩散配置文件节点和相关的次表面散射功能也在持续演化。了解这些趋势可以帮助开发者更好地规划长期项目。</p>
<p>实时全局光照与散射的集成：</p>
<p>未来的HDRP版本可能会更紧密地集成次表面散射与全局光照系统，允许散射光线影响周围环境，实现更加真实的材质交互。</p>
<p>机器学习加速的散射模型：</p>
<p>机器学习技术正在被越来越多地用于实时渲染的各个领域。未来可能会看到基于神经网络的散射模型，能够在保持高质量的同时大幅降低计算成本。</p>
<p>更高效的混合渲染技术：</p>
<p>随着混合渲染器（如HDRP的Hybrid Renderer）的成熟，次表面散射可能会受益于新的渲染架构，在保持视觉质量的同时提高性能。</p>
<p>艺术家友好的工具改进：</p>
<p>Unity一直在努力使复杂渲染技术更易于艺术家使用。未来可能会看到扩散配置文件节点的改进界面，更直观的参数控制和实时预览功能。</p>
<p>跨管线兼容性：</p>
<p>虽然目前扩散配置文件节点仅适用于HDRP，但未来可能会看到类似功能在URP中的实现，使更多项目能够利用高质量的次表面散射效果。</p>
<hr/>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fchenghai37%2Fcategory_13074589.html%3Ffromshare%3Dblogcolumn%26sharetype%3Dblogcolumn%26sharerId%3D13074589%26sharerefer%3DPC%26sharesource%3Dchenghai37%26sharefrom%3Dfrom_link" target="_blank" title="https://blog.csdn.net/chenghai37/category_13074589.html?fromshare=blogcolumn&amp;sharetype=blogcolumn&amp;sharerId=13074589&amp;sharerefer=PC&amp;sharesource=chenghai37&amp;sharefrom=from_link" ref="nofollow noopener noreferrer">【Unity Shader Graph 使用与特效实现】</a><strong>专栏-直达</strong>
（欢迎<em>点赞留言</em>探讨，更多人加入进来能更加完善这个探索的过程，🙏）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[刷屏全网的“nano-banana”API接入指南！0.1元/张量产高清创意图，开发者必藏]]></title>    <link>https://juejin.cn/post/7603699739224031247</link>    <guid>https://juejin.cn/post/7603699739224031247</guid>    <pubDate>2026-02-08T14:24:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603699739224031247" data-draft-id="7603677143215063055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="刷屏全网的“nano-banana”API接入指南！0.1元/张量产高清创意图，开发者必藏"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T14:24:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            刷屏全网的“nano-banana”API接入指南！0.1元/张量产高清创意图，开发者必藏
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:24:37.000Z" title="Sun Feb 08 2026 14:24:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、nano-banana爆火背景与核心优势</h2>
<p>最近AI圈彻底被“纳米香蕉”承包！X平台16万浏览量的3D手办生成图、网友复刻的《黑神话·钟馗》周边、老照片修复、跨时空合照等玩法刷屏全网。其本质是谷歌Gemini 2.5 Flash Image模型的“隐藏款”，通过API调用可将“创意超能力”植入自有产品或工作流。</p>
<h3 data-id="heading-1">官方API痛点</h3>
<p>官方API存在两大核心问题：① 成本高，0.039美元/张（约0.28元）；② 受网络限制，大规模调用成本压力大。</p>
<h3 data-id="heading-2">ACE Data Platform生态加持优势</h3>
<p>推荐ACE Data Platform的nano-banana API接入方案（专属对接链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F23985a11-d713-41d1-ad84-24b021805b3d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/23985a11-d713-41d1-ad84-24b021805b3d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">ACE Data Platform nano-banana API专属对接页面</a>），核心优势：兼顾低成本（0.1元/张量产）、高稳定、强扩展性，适配个人创作与商业部署全场景。</p>
<h2 data-id="heading-3">二、4大核心能力（碾压同类的硬实力）</h2>
<p>nano-banana API凭以下4大功能成为开发者“生产力利器”：</p>
<ol>
<li><strong>角色一致性拉满</strong>：多次编辑可精准保留人物脸部特征、发型与服装风格，更换场景、调整姿势后主体辨识度仍在线；适配虚拟试衣APP、连贯故事分镜生成等场景，无需反复调整参数。</li>
<li><strong>多图融合自然到离谱</strong>：支持一次性上传13张素材图，智能整合光线、阴影、透视关系，实现“原生融合”而非简单拼接；电商商家可合成产品场景图，设计师可快速组合创意元素，效率提升10倍以上。</li>
<li><strong>多轮编辑像“聊天”一样简单</strong>：支持基于上一轮结果持续微调，如为空房间逐步添加家具、粉刷墙壁，或给生成图换风格、改细节；无需每次重新描述全部需求，对话式操作堪比真人设计师协作。</li>
<li><strong>生成速度快到飞起</strong>：“Flash”命名名副其实，复杂指令下13秒可生成5张风格各异的高清图，单张生成耗时不足3秒，完全满足商业场景高并发需求。</li>
</ol>
<h2 data-id="heading-4">三、4大落地场景（覆盖从创意到商业的全需求）</h2>
<p>nano-banana API适配性极强，个人创作者与企业开发均能找到核心价值：</p>
<ol>
<li><strong>内容创作领域</strong>：自媒体人生成短视频封面、故事板；设计师借助风格迁移功能快速尝试不同创意方向，将1天工作量压缩至1小时。</li>
<li><strong>电商营销场景</strong>：生成多角度产品展示图、将商品自然植入生活场景；无需搭建实景拍摄，即可产出高质量营销素材，大幅降低推广成本。</li>
<li><strong>娱乐应用开发</strong>：开发虚拟试衣、宠物变装、老照片修复等趣味功能；依托强互动性提升产品用户留存率。</li>
<li><strong>企业级创意生产</strong>：品牌方批量生成品牌一致的广告素材，游戏公司制作角色周边可视化图；借助API实现“创意量产”，缩短项目周期。</li>
</ol>
<h2 data-id="heading-5">四、2套接入方案（避坑指南：成本直降+稳定翻倍）</h2>
<p>针对不同需求提供适配方案，规避官方API网络波动、高成本、失败计费等问题：</p>
<h3 data-id="heading-6">1. 个人学习/小规模测试</h3>
<ul>
<li>方案：直接使用网页版（链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.acedata.cloud%2Fnanobanana%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://hub.acedata.cloud/nanobanana?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">nano-banana网页版（无需配置，即开即用）</a>）</li>
<li>优势：无需任何网络配置，联网即可使用，操作便捷。</li>
</ul>
<h3 data-id="heading-7">2. 商业部署/大规模调用（推荐方案）</h3>
<ul>
<li>方案：通过ACE Data Platform接入nano-banana API（专属通道：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F23985a11-d713-41d1-ad84-24b021805b3d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/23985a11-d713-41d1-ad84-24b021805b3d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">ACE Data Platform nano-banana API专属对接页面</a>）</li>
<li>3大核心优势：
① 成本更友好：生态协同降低中转成本，大规模调用享阶梯价，失败调用不计费，比直接对接官方节省30%以上成本；
② 网络更稳定：国内直连节点，无需额外配置代理，API可用性高达99.9%，避免网络波动导致创作或开发中断；
③ 生态更完整：可直接联动ACE Data Platform的其他API和编排系统，实现进一步自动化。</li>
</ul>
<h2 data-id="heading-8">五、3步快速接入流程（即刻解锁创意超能力）</h2>
<ol>
<li>注册ACE Data Platform账号，进入nano-banana API专属对接页面（链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F23985a11-d713-41d1-ad84-24b021805b3d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/23985a11-d713-41d1-ad84-24b021805b3d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">ACE Data Platform nano-banana API专属对接页面</a>），获取专属API Key；</li>
<li>参考平台提供的开发文档（含Python、JavaScript等多语言示例代码），根据需求配置参数（支持图像生成、编辑、风格迁移等多种指令）；</li>
<li>发起调用并对接自有系统，生成的图像可直接存储至ACE Data Platform平台云空间。</li>
</ol>
<h2 data-id="heading-9">六、总结号召</h2>
<p>从网友整活的趣味工具，到开发者追捧的生产力API，nano-banana的爆发绝非偶然。借助ACE Data Platform的生态加持，不仅能低成本接入，更能通过数据联动实现价值升级。无论你是想做创意工具、电商产品，还是企业级营销系统，nano-banana API都是不可错过的核心能力，赶紧领取免费额度，开启创意爆发之旅！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[jwt介绍]]></title>    <link>https://juejin.cn/post/7603895839556583487</link>    <guid>https://juejin.cn/post/7603895839556583487</guid>    <pubDate>2026-02-08T14:26:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603895839556583487" data-draft-id="7603769956975968297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="jwt介绍"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T14:26:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            jwt介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:26:22.000Z" title="Sun Feb 08 2026 14:26:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>很多人不了解 JWT（JSON Web Token）啥意思，甚至jwt、cookie、token(令牌)、session、单点登录是啥搞不清，这篇文章以 JWT 介绍为引，顺便简单区分一下他们之间的关系，总而言之，这篇文章不白看</p>
<h2 data-id="heading-1">介绍</h2>
<p>上面讲的实际上都是单点登录过程中的参与角色之一，这也是统一身份认证环境系统中的一部分</p>
<p><strong>我们从一个角度开始分析他们之间的关系</strong>：</p>
<ol>
<li>我们都知道 http 是无状态协议，那么无状态的情况，服务器作为一个用户管理中心，他怎么知道我们我们用户是谁操作的呢(怎么区分用户呢)</li>
<li>很明显根据用户账号，而我们发现用户并不是每次都登陆，很麻烦，于是我们进一步追溯到了用户注册用户时，会在数据库中生成我们互联网用户的唯一标识，这个标识就是我们的用户id(互联网的身份证号)，早期就是直接使用用户id来区分我们的身份</li>
<li>当使用账号密码登录后，客户端就会获取到用户的id，存放在内存中，后续对于需要确认用户的的操作传递用户id即可</li>
<li>那么问题来了，直接使用用户id不太好，不安全，再加上一些其他常用数据原因，于是出现了session，也就是服务端保存用户常用信息，使用一个session 关联用户，session id发送给用户，用户拿着session 给服务端，服务端确认身份，拿着信息直接操作，可是这样管理 session，用户一多服务端压力还会变大，也衍生出了redis 的操作，现在仍然受用</li>
<li>当然也出现了更加主流的身份令牌，发放一个期限的 token令牌 来代替我们的用户id，也就是身份令牌，这样就算token 泄露了，也不会长期被持有，风险大幅度降低，有条件再加上防篡改操作，这样 jwt 结构就出现了，后续就让用户拿着这些信息访问即可</li>
<li>那还有一个问题，并且我们客户端一旦不小心中途退出，重新进入又要重新输入账号密码，麻烦，需要用户本地保存一下令牌，这也是从session 方案就开始的存储方式了，那么令牌怎么存放呢，浏览器有cookie，localStore 的方式，于是出现了cookie + session 的方式，同时还有移动端的纯token方式，双token等</li>
<li>上面签名令牌后续免认证过程就是单点登录的核心逻辑，是统一身份认证子集，统一身份认证还包含整个签名过程、权限等更复杂功能</li>
</ol>
<p><strong>ps</strong>:当然身份系统打通的话，一个token便可以分别使用到多个平台</p>
<p><strong>那么单点登录解决了什么问题？</strong></p>
<p>答：单点登录，在这个系统中，同一个用户只需要登录一次，后续就可以拿着登录后签发的令牌免认证操作，减少了很多麻烦</p>
<p><strong>cookie 是啥？</strong></p>
<p>答：cookie是浏览器保存服务器令牌的一种方式，可以在浏览器中持久存放，即使用户不小心关闭标签，下次仍然可以在请求中取出它亮出我们的身份，当然如果过期了，就不行了需要重新登录签名</p>
<p><strong>session是啥？</strong></p>
<p>session是服务端的一个缓存，一种key-value结构，key则是生成的sessionid，用于给用户，value是用户信息或者令牌，可以根据用户传递过来的sessionid来直接获取到用户的信息</p>
<h2 data-id="heading-2">jwt</h2>
<p>JWT（JSON Web Token） 实际上就是一种token令牌的生成方式，其主要组成方式如下所示：</p>
<ul>
<li>头部结构，主要保存了加密算法</li>
<li>荷载payload，保存了我们的内容</li>
<li>Signature，加密结果，用于后端对比，避免有人篡改荷载信息</li>
</ul>
<p>看了上面的结构，相信也能知道什么是jwt了，且jwt的内容是接近明文的，只是有了加密串防篡改，相对也安全了不少，且里面也有时间戳，能设置过期时间，算是很方便了</p>
<p>后端可以直接获取jwt，直接验证内容是否串改，里面的token可以直接使用了，一般token和用户信息会有一个对照表，直接使用token对照用户信息操作即可</p>
<h2 data-id="heading-3">最后</h2>
<p>他们之间的关系大致如此，更细的没有多介绍，到了这里更细的只要稍微查一下，就能查到，本篇文章就介绍到这里了</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[富文本编辑器在 AI 时代为什么这么受欢迎]]></title>    <link>https://juejin.cn/post/7604037348607508518</link>    <guid>https://juejin.cn/post/7604037348607508518</guid>    <pubDate>2026-02-08T14:21:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607508518" data-draft-id="7604484566803791882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="富文本编辑器在 AI 时代为什么这么受欢迎 "/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-08T14:21:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            富文本编辑器在 AI 时代为什么这么受欢迎 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:21:27.000Z" title="Sun Feb 08 2026 14:21:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>大家好👋，我是Moment，目前我正在使用 NextJs，NestJs，langchain 开发 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a>，它是一个完整的 AI 全栈协同文档平台。该项目融合了多个技术栈，包括基于 <code>Tiptap</code> 的富文本编辑器、<code>NestJs</code> 后端服务、<code>AI</code> 集成功能和实时协作。在开发过程中，我积累了丰富的实战经验，涵盖了 <code>Tiptap</code> 的深度定制、性能优化和协作功能的实现等核心难点，如果你对这个项目感兴趣，可以添加我微信 <code>yunmz777</code> 了解更多详细的信息，如果觉得不错欢迎 star ⭐️⭐️⭐️。</p>
</blockquote>
<p>在 2026 年的今天，富文本编辑器已经不再是单纯的打字框，它演变成了人类与 AI 协作的核心战场。</p>
<p>如果说过去十年是 Markdown 和纯文本的极客复兴，那么 AI 时代的到来，则让富文本编辑器重新夺回了统治地位。</p>
<h2 data-id="heading-0">AI 就在光标处</h2>
<p>在 AI 普及之前，我们写作是写一段，去 ChatGPT 问一段，再复制回来。这种上下文切换是效率的杀手。</p>
<p>现在的富文本编辑器，如 Notion AI、Lex、WPS AI 等，将 AI 直接植入光标。你只需输入斜杠或空格，AI 就能根据前文自动续写、润色或改变语气。富文本编辑器能够理解文档的层级结构，包括标题、段落、列表，这让 AI 能更精准地执行总结这一段或把这部分转成表格的操作。</p>
<h2 data-id="heading-1">结构化数据的转换站</h2>
<p>AI 最擅长的事情之一，就是将非结构化信息转化为结构化内容。富文本编辑器的块状结构完美适配了这一点。</p>
<p>你丢给 AI 一堆乱七八糟的会议纪要，富文本编辑器能瞬间将其渲染成带有看板、待办列表和甘特图的精美文档。AI 生成的不再只是文字，还有图表、代码块，甚至动态组件。富文本编辑器是承载这些复杂对象的最佳容器。</p>
<h2 data-id="heading-2">终结空白页恐惧症</h2>
<p>对于创作者来说，最痛苦的是面对一张白纸。AI 时代的富文本编辑器变成了半自动驾驶。</p>
<p>AI 不再是取代作者，而是成了最好的二号位。它帮你打草稿，你负责做决策和注入灵魂。输入一个主题，AI 自动生成大纲和初稿，用户的工作从无中生有变成了审阅与精修。当你逻辑断层时，AI 可以在侧边栏提醒你，甚至帮你查找事实数据，省去了反复跳出窗口搜资料的麻烦。</p>
<h2 data-id="heading-3">传统与 AI 原生的分野</h2>
<p>传统富文本编辑器的定位是静态记录工具，核心交互靠键盘输入和顶部工具栏，内容处理停留在简单的字体加粗、颜色修改，逻辑理解仅能识别字符和 HTML 标签，扩展性依赖插件系统。</p>
<p>AI 原生富文本编辑器的定位是动态协作伙伴和内容引擎，核心交互靠自然语言指令和斜杠命令，内容处理涵盖自动排版、风格迁移、跨语言同步翻译，逻辑理解能把握段落意图、自动提取任务项，扩展性支持 AI Agent 接入，可调用外部 API 填充数据。</p>
<h2 data-id="heading-4">协作维度的升华</h2>
<p>以前的协作是人与人在文档里留言。现在的协作是人、AI、人三者联动。</p>
<p>当你打开一份长文档，AI 会为你总结其他人修改了什么。团队中的成员写出的内容风格不一时，AI 可以一键将全篇统一为公司标准公文包风格或互联网黑话风格。</p>
<h2 data-id="heading-5">降低专业感的门槛</h2>
<p>富文本编辑器通过 AI 让普通人也能做出有大片感的内容。</p>
<p>以前需要懂点设计才能排得好看，现在只需说帮我把这个方案做得像麦肯锡的报告，编辑器会自动调整字体间距、引用格式和配色方案。语音转文字、文字转视觉，AI 在富文本背后的各种转换逻辑，让创作变得从未如此简单。</p>
<h2 data-id="heading-6">为什么不是 Word？</h2>
<p>Word 几乎是富文本的代名词，但当我们说 AI 时代富文本编辑器火了时，大家脑子里浮现的通常是 Notion、Lex、Linear 这种现代化的编辑器，而不是那个陪了我们几十年的 Microsoft Word。</p>
<p>原因很简单：Word 是为了打印设计的，而 AI 时代的编辑器是为了信息流动设计的。</p>
<h3 data-id="heading-7">纸张思维与块思维</h3>
<p>Word 的逻辑本质上是在模拟一张 A4 纸。所有的排版，页边距、分页符、行间距，都是为了最终打印出来好看。</p>
<p>AI 时代的逻辑则是原子化的。现代编辑器如 Notion，每一段话、一张图、一个表格都是一个独立的块。AI 很难理解 Word 那种长达 50 页、格式复杂的 XML 结构。但在块状编辑器里，AI 可以精准地知道：我现在的任务是只针对这一个待办事项块进行扩充，或者把这个文本块转化成代码块。这种精细度的控制，Word 很难做到。</p>
<h3 data-id="heading-8">功能堆砌与对话驱动</h3>
<p>Word 拥有成千上万个功能，埋藏在密密麻麻的菜单栏里。在 Word 里用 AI，你得去点插件、点侧边栏。</p>
<p>现代编辑器奉行极简主义。界面通常只有一张白纸，所有的功能都通过一个斜杠指令或 AI 对话框呼出。在 Word 里，你是找功能；在 AI 编辑器里，你是下指令。当 AI 已经能帮你调格式、改语气时，Word 顶端那几百个图标反而成了视觉噪音。</p>
<h3 data-id="heading-9">数据结构的开放性</h3>
<p>Word 是孤岛。docx 文件是一个封装好的压缩包。虽然现在有云端版，但它的数据很难实时与其他工具，如任务管理、数据库、代码库，无缝打通。</p>
<p>现代富文本编辑器往往是 All-in-one。AI 在编辑器里写完一个方案，可以直接将其中的任务转化为看板上的卡片。Word 的数据相对静态，而现代编辑器的内容是活着的，AI 可以轻松地跨页面、跨库调用数据。</p>
<h3 data-id="heading-10">协作的实时性与轻量化</h3>
<p>Word 诞生于离线时代。即便现在的 OneDrive 协作已经进步很大，但其底层的冲突合并机制依然不如原生 Web 编辑器流畅。AI 时代的创作往往是高频次、碎片化、多人多机协作的，现代富文本编辑器原生支持网页访问，AI 可以在你和同事讨论时实时介入，这种流畅度是老牌软件难以企及的。</p>
<p>从设计目标看，Microsoft Word 面向排版与打印，内容单位是页面；AI 原生编辑器如 Notion、Lex 面向思考与协作，内容单位是块或组件。Word 的 AI 角色是辅助插件，Copilot 是外挂；AI 编辑器的 AI 是核心驱动力，是原生系统的一部分。典型动作上，Word 用户设置页边距、调整字体大小；AI 编辑器用户用斜杠总结、空格键续写。视觉感受上，Word 像是一本沉重的精装书，AI 编辑器像是一张无限延伸的草稿纸。</p>
<h3 data-id="heading-11">心理层面的创作压力</h3>
<p>这听起来很玄学，但真实存在。</p>
<p>打开 Word，你会觉得自己在写公文，潜意识里会去纠正格式；打开 Notion 或 Lex，你会觉得自己在记录想法。AI 最强大的地方在于辅助灵感爆发，而现代富文本编辑器那种无负担的界面，比 Word 更适合作为 AI 的载体。</p>
<h2 data-id="heading-12">结语</h2>
<p>当然，Word 也在努力。微软推出的 Microsoft Loop 就在全盘致敬这种块状编辑器逻辑，试图把 Word 的强大功能塞进 AI 时代的瓶子里。</p>
<p>富文本编辑器在 AI 时代受欢迎，是因为它已经从一个容器进化成了一个理解器。它不再只等着你喂数据，而是开始主动帮你处理、组织和美化信息。</p>
<p>当人类与 AI 的边界越来越模糊，那个让我们与智能体并肩写作的编辑器，或许才是这个时代真正的创作伙伴。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比官方便宜一半以上！Midjourney API 申请及使用]]></title>    <link>https://juejin.cn/post/7603721514204315657</link>    <guid>https://juejin.cn/post/7603721514204315657</guid>    <pubDate>2026-02-08T14:42:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603721514204315657" data-draft-id="7603688142005567497" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比官方便宜一半以上！Midjourney API 申请及使用"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T14:42:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比官方便宜一半以上！Midjourney API 申请及使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:42:21.000Z" title="Sun Feb 08 2026 14:42:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Midjourney 是一款非常强大的 AI 绘图工具，只要输入关键字，就能在短短一两分钟生成十分精美的图像。Midjourney 以其出色的绘图能力在业界独树一帜，如今，Midjourney 早已在各个行业和领域广泛应用，其影响力愈发显著。</p>
<p>本文档主要介绍 Midjourney API 中 Imagine 操作的使用流程，利用它我们可以轻松通过文本生成所需要的图像。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 Midjourney Imagine API，首先可以到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fmidjourney-imagine" target="_blank" title="https://platform.acedata.cloud/documents/midjourney-imagine" ref="nofollow noopener noreferrer">Midjourney Imagine API</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fmidjourney-imagine" target="_blank" title="https://platform.acedata.cloud/documents/midjourney-imagine" ref="nofollow noopener noreferrer">platform.acedata.cloud/documents/m…</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
<p><img src="https://cdn.acedata.cloud/nyq0xz.png" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>接下来就可以在界面上填写对应的内容，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/d01h9f.png" alt="" loading="lazy"/></p>
<p>在第一次使用该接口时，我们至少需要填写两个内容，一个是 <code>authorization</code>，直接在下拉列表里面选择即可。另一个参数是 <code>prompt</code>， <code>prompt</code> 就是我们想生成的图片描述内容，建议用英文描述，画的图会更准确效果更好，这里我们用了示例内容 <code>Lamborghini speeds inside a volcano</code>，代表要画一个兰博基尼在火山飞驰。</p>
<p>同时您可以注意到右侧有对应的调用代码生成，您可以复制代码直接运行，也可以直接点击「Try」按钮进行测试。</p>
<p><img src="https://cdn.acedata.cloud/zv3db5.png" width="500" class="m-auto" loading="lazy"/></p>
<p>调用之后，我们发现返回结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234197197067915365/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_f47263b6-ff92-44a3-88ee-51cf0e706aae.png?ex=662fdb36&amp;is=662e89b6&amp;hm=ca9be54907726937ed02517a13466bef2afb2825b7cda4b313de56a3c3310d0d&amp;width=1024&amp;height=1024"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1234197197067915365"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234197197067915365/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_f47263b6-ff92-44a3-88ee-51cf0e706aae.png?ex=662fdb36&amp;is=662e89b6&amp;hm=ca9be54907726937ed02517a13466bef2afb2825b7cda4b313de56a3c3310d0d&amp;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"upscale1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"reroll"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation4"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1bae3bec-3ac4-4180-a148-74ee6cb68b98"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>task_id</code>，生成此图像任务的 ID，用于唯一标识此次图像生成任务。</li>
<li><code>image_id</code>，图片的唯一标识，在下次需要对图片进行变换操作时需要传此参数。</li>
<li><code>image_url</code>，缩略图的 URL，直接打开即可查看生成的效果。</li>
<li><code>image_width</code>：缩略图的像素宽度。</li>
<li><code>image_height</code>：缩略图的像素高度。</li>
<li><code>raw_image_url</code>：原图的 URL，和缩略图内容一样，但相比缩略图更加高清，加载速度会更慢一些。</li>
<li><code>raw_image_width</code>：原图的像素宽度。</li>
<li><code>raw_image_height</code>：原图的像素高度。</li>
<li><code>actions</code>，可以对生成的图片进行的进一步操作列表。这里一共列了 8 个，其中 <code>upscale</code> 代表放大，<code>variation</code> 代表变换。所以 <code>upscale1</code> 代表的就是对左上角第一张图片进行放大操作，<code>variation3</code> 就是代表根据左下角第三张图片进行变换操作。</li>
</ul>
<p>打开 <code>image_url</code> 或者 <code>raw_image_url</code> 所对应的链接，可以发现如图所示。</p>
<p><img src="https://cdn.acedata.cloud/qr2iyj.png" alt="" loading="lazy"/></p>
<p>可以看到，这里生成了一张 2x2 的预览图。到现在为止，第一次 API 调用就完成了。</p>
<h2 data-id="heading-2">图像放大与变换</h2>
<p>下面我们尝试针对当前生成的照片进行进一步的操作，比如我们觉得右上角第二张的图片还不错，但我们想进行一些变换微调，那么就可以进一步将 <code>action</code> 填写为 <code>variation2</code>，同时将 <code>image_id</code> 传递即可：</p>
<p><img src="https://cdn.acedata.cloud/ia7vpw.png" alt="" loading="lazy"/></p>
<p>这时候得到的结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234201336543969401/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_10dc56a7-ec16-4bac-878e-2338f2ae5f5d.png?ex=662fdf10&amp;is=662e8d90&amp;hm=9aec96bca35ae20b6f9ab536101b9c4ea255eb6216cbf7000ac554937da071f3&amp;width=1024&amp;height=1024"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1234201336543969401"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234201336543969401/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_10dc56a7-ec16-4bac-878e-2338f2ae5f5d.png?ex=662fdf10&amp;is=662e8d90&amp;hm=9aec96bca35ae20b6f9ab536101b9c4ea255eb6216cbf7000ac554937da071f3&amp;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"upscale1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"reroll"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation4"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f4961620-1104-409f-9dc1-ba3ed15c2f4d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>打开 <code>image_url</code>，新生成的图片如下所示：</p>
<p><img src="https://cdn.acedata.cloud/4g6r09.png" alt="" loading="lazy"/></p>
<p>可以看到，针对上一张右上角的图片，我们再次得到了四张类似的照片。</p>
<p>这时候我们可以挑选其中一张进行精细化地放大操作，比如选第四张，那就可以 <code>action</code> 传入 <code>upscale4</code>，通过 <code>image_id</code> 再次传入当前图像的 ID 即可。</p>
<p><img src="https://cdn.acedata.cloud/jk9ohl.png" alt="" loading="lazy"/></p>
<blockquote>
<p>注意： <code>upscale</code> 操作相比 <code>variation</code> 来说，Midjourney 的耗时会更短一些。</p>
</blockquote>
<p>返回结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234202545208033400/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_34edc3f5-2bd0-4f5b-a372-03270b02289b.png?ex=662fe031&amp;is=662e8eb1&amp;hm=f8006c4d33a03dfd027dffe4eb46ab0d113a4910aef07497f0b335c8998b7858&amp;width=512&amp;height=512"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">512</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">512</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1234202545208033400"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234202545208033400/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_34edc3f5-2bd0-4f5b-a372-03270b02289b.png?ex=662fe031&amp;is=662e8eb1&amp;hm=f8006c4d33a03dfd027dffe4eb46ab0d113a4910aef07497f0b335c8998b7858&amp;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"upscale_2x"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale_4x"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation_subtle"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation_strong"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"zoom_out_2x"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"zoom_out_1_5x"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pan_left"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pan_right"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pan_up"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pan_down"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"03f62b17-a6f1-4c8e-9b4d-1fc7bd5b1180"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其中 <code>image_url</code> 如图所示：</p>
<p><img src="https://cdn.acedata.cloud/jfndfo.png" alt="" loading="lazy"/></p>
<p>这样我们就成功得到了一张兰博基尼的照片。</p>
<p>同时注意到 <code>actions</code> 里面又包含了几个可进行的操作，介绍如下：</p>
<ul>
<li><code>upscale_2x</code>：对画面放大 2 倍，得到 2 倍高清图。</li>
<li><code>upscale_4x</code>：对画面放大 4 倍，得到 4 倍高清图。</li>
<li><code>zoom_out_2x</code>：对画面进行缩小两倍操作（周围区域填充）。</li>
<li><code>zoom_out_1_5x</code>：对画面进行缩小 1.5 倍操作（周围区域填充）。</li>
<li><code>pan_left</code>：对画面进行左偏移操作。</li>
<li><code>pan_right</code>：对画面进行右便宜操作。</li>
<li><code>pan_up</code>：对画面进行上偏移操作。</li>
<li><code>pan_down</code>：对画面进行下偏移操作。</li>
</ul>
<p>可以继续按照上述流程传入对应的变换指令进行连续生图操作。</p>
<h2 data-id="heading-3">图像改写（垫图）</h2>
<p>该 API 也支持图像改写，俗称垫图，我们可以输入一张图片 URL 以及需要改写的描述文字，该 API 就可以返回改写后的图片。</p>
<blockquote>
<p>注意：输入的图片 URL 需要是一张纯图片，不能是一个网页里面展示一张图片，否则无法进行图像改写。建议使用图床来上传获取图片的 URL。</p>
</blockquote>
<p>例如，我们这里有一张公路落日的图片，公路旁边有一些树木和楼房，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/mq335u.png" alt="" loading="lazy"/></p>
<p>现在我们想在它的基础上改写成海滩旁边，同时放一辆汽车停在路边。我们就可以构造如下的 prompt：</p>
<pre><code class="hljs language-bash" lang="bash">https://cdn.acedata.cloud/v014oc.png an illustration of a car parked on the beach --iw 2
</code></pre>
<p>可以看到，我们的 prompt 的最开头是一个 HTTPS 开头的图片链接，然后接着加一个空格，后面跟上 prompt 文字的内容。这里我们还用了额外的一些高级参数，如 <code>—iw 2</code> 来调整图片的权重。</p>
<p>我们可以将如上内容作为一个整体，传递给 <code>prompt</code> 字段，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/pfcoy1.png" alt="" loading="lazy"/></p>
<p>输出结果如下：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"image_url"</span>: <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234427310434947145/1234539663515975690/atmateosa5693_An_illustration_of_a_car_parked_on_the_beach_id26_cc8650ec-7e4b-4685-8911-78172430d8a7.png?ex=66311a28&amp;is=662fc8a8&amp;hm=c39707a1f22bc7f12874060ea6ed58ba37c188139ccc9a13c61ed9f37e66ea74&amp;width=1456&amp;height=816"</span>,
  <span class="hljs-string">"image_width"</span>: 1456,
  <span class="hljs-string">"image_height"</span>: 816,
  <span class="hljs-string">"image_id"</span>: <span class="hljs-string">"1234539663515975690"</span>,
  <span class="hljs-string">"raw_image_url"</span>: <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234427310434947145/1234539663515975690/atmateosa5693_An_illustration_of_a_car_parked_on_the_beach_id26_cc8650ec-7e4b-4685-8911-78172430d8a7.png?ex=66311a28&amp;is=662fc8a8&amp;hm=c39707a1f22bc7f12874060ea6ed58ba37c188139ccc9a13c61ed9f37e66ea74&amp;"</span>,
  <span class="hljs-string">"raw_image_width"</span>: 2912,
  <span class="hljs-string">"raw_image_height"</span>: 1632,
  <span class="hljs-string">"progress"</span>: 100,
  <span class="hljs-string">"actions"</span>: [
    <span class="hljs-string">"upscale1"</span>,
    <span class="hljs-string">"upscale2"</span>,
    <span class="hljs-string">"upscale3"</span>,
    <span class="hljs-string">"upscale4"</span>,
    <span class="hljs-string">"reroll"</span>,
    <span class="hljs-string">"variation1"</span>,
    <span class="hljs-string">"variation2"</span>,
    <span class="hljs-string">"variation3"</span>,
    <span class="hljs-string">"variation4"</span>
  ],
  <span class="hljs-string">"task_id"</span>: <span class="hljs-string">"24a79e8b-a79d-471a-aef7-089dc0627ee8"</span>,
  <span class="hljs-string">"success"</span>: <span class="hljs-literal">true</span>
}

</code></pre>
<p>这时候我们就得到了如下生成的图片：</p>
<p><img src="https://cdn.acedata.cloud/1vwkuv.png" alt="" loading="lazy"/></p>
<p>可以看到，在原来的图片整体风格和构图不变的前提下，整个场景变成了海滩旁边，同时公路上还出现了汽车，这就是 Prompt with Image。</p>
<h2 data-id="heading-4">图像融合</h2>
<p>该 API 也支持图像融合，我们可以传入多张图片，以实现不同的图片融合效果。</p>
<p>比如说这里我们一共有两张图片，一张是一只玩具熊，另一张是一个电锯，分别如图所示：</p>
<p><img src="https://cdn.acedata.cloud/8fapzl.png" width="300" class="m-auto" loading="lazy"/></p>
<p><img src="https://cdn.acedata.cloud/c1igbw.png" width="300" class="m-auto" loading="lazy"/></p>
<p>现在我们想把二者融合起来，让这只熊拿着这个电锯，怎么做呢？</p>
<p>我们可以构造如下的 prompt：</p>
<pre><code class="hljs language-bash" lang="bash">https://cdn.acedata.cloud/8fapzl.png https://cdn.acedata.cloud/c1igbw.png The bear is holding the chainsaw --iw 2
</code></pre>
<p>可以发现，和 Image with Prompt 类似，我们这里将多张图片 URL 放在了 prompt 开头，并以空格分隔，最后再加上文字 prompt，将如上内容作为一个整体传递给 <code>prompt</code> 参数，运行效果如下：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"image_url"</span>: <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234547236830973972/kcisok_The_bear_is_holding_the_chainsaw_id8873344_ad605bc4-ba19-4807-b94f-367dab672f7a.png?ex=66312136&amp;is=662fcfb6&amp;hm=0fb1e2261c9a30b04de9da9b23b7562eb73677f1bbda1fae52c7243b12d25aac&amp;width=1024&amp;height=1024"</span>,
  <span class="hljs-string">"image_width"</span>: 1024,
  <span class="hljs-string">"image_height"</span>: 1024,
  <span class="hljs-string">"image_id"</span>: <span class="hljs-string">"1234547236830973972"</span>,
  <span class="hljs-string">"raw_image_url"</span>: <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234547236830973972/kcisok_The_bear_is_holding_the_chainsaw_id8873344_ad605bc4-ba19-4807-b94f-367dab672f7a.png?ex=66312136&amp;is=662fcfb6&amp;hm=0fb1e2261c9a30b04de9da9b23b7562eb73677f1bbda1fae52c7243b12d25aac&amp;"</span>,
  <span class="hljs-string">"raw_image_width"</span>: 2048,
  <span class="hljs-string">"raw_image_height"</span>: 2048,
  <span class="hljs-string">"progress"</span>: 100,
  <span class="hljs-string">"actions"</span>: [
    <span class="hljs-string">"upscale1"</span>,
    <span class="hljs-string">"upscale2"</span>,
    <span class="hljs-string">"upscale3"</span>,
    <span class="hljs-string">"upscale4"</span>,
    <span class="hljs-string">"reroll"</span>,
    <span class="hljs-string">"variation1"</span>,
    <span class="hljs-string">"variation2"</span>,
    <span class="hljs-string">"variation3"</span>,
    <span class="hljs-string">"variation4"</span>
  ],
  <span class="hljs-string">"task_id"</span>: <span class="hljs-string">"891f2645-ee15-4c7b-ac24-d98163c8e57e"</span>,
  <span class="hljs-string">"success"</span>: <span class="hljs-literal">true</span>
}

</code></pre>
<p>我们就得到了如下结果：</p>
<p><img src="https://cdn.acedata.cloud/vjtzdo.png" alt="" loading="lazy"/></p>
<p>可以看到，我们就成功实现了图片融合。</p>
<blockquote>
<p>注意：图片融合最多可以支持 5 个图片 URL 作为输入，也就是最多支持 5 张图片融合，输入格式同上。</p>
</blockquote>
<h2 data-id="heading-5">异步回调</h2>
<p>由于 Midjourney 生成图片需要等待一段时间，所以本 API 也默认设计为了长等待模式。但在部分场景下，长等待可能会带来一些额外的资源开销，因此本 API 也提供了异步 Webhook 回调的方式，当图片生成成功或失败时，其结果都会通过 HTTP 请求的方式发送到指定的 Webhook 回调 URL。回调 URL 接收到结果之后可以进行进一步的处理。</p>
<p>下面演示具体的调用流程。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F" title="https://webhook.site/" target="_blank" ref="nofollow noopener noreferrer">webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/srf3tq.png" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F995d0a91-d737-40a7-a3b9-5baf68ed924c" title="https://webhook.site/995d0a91-d737-40a7-a3b9-5baf68ed924c" target="_blank" ref="nofollow noopener noreferrer">webhook.site/995d0a91-d7…</a>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/hclosy.png" alt="" loading="lazy"/></p>
<p>点击测试之后会立即得到一个 <code>task_id</code> 的响应，用于标识当前生成任务的 ID，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/vkr32a.png" width="300" class="m-auto" loading="lazy"/></p>
<p>稍等片刻，等图片生成结束，可以发发现 Webhook URL 收到了一个 HTTP 请求，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/6znvgq.png" alt="" loading="lazy"/></p>
<p>其结果就是当前任务的结果，内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f6e39eaf-652a-4bf5-a15c-79d8b143b80a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234551030549839932/kcisok_A_cat_sitting_on_a_table_id2724480_591c5c85-ec80-42ab-9fe5-9adfbed192e4.png?ex=663124be&amp;is=662fd33e&amp;hm=da725eb74aae375d60beec38b4cd26c5a7b373b1662f222ff838a8ea6fd5e798&amp;width=1024&amp;height=1024"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1234551030549839932"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234551030549839932/kcisok_A_cat_sitting_on_a_table_id2724480_591c5c85-ec80-42ab-9fe5-9adfbed192e4.png?ex=663124be&amp;is=662fd33e&amp;hm=da725eb74aae375d60beec38b4cd26c5a7b373b1662f222ff838a8ea6fd5e798&amp;"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"upscale1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"upscale4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"reroll"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"variation4"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其中 <code>success</code> 字段标识了该任务是否执行成功，如果执行成功，还会有同样的 <code>actions</code>, <code>image_id</code>, <code>image_url</code> 字段，和上文介绍的返回结果是一样的，另外还有 <code>task_id</code> 用于标识任务，以实现 Webhook 结果和最初 API 请求的关联。</p>
<p>如果图片生成失败，Webhook URL 则会收到类似如下内容：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7ba0feaf-d20b-4c22-a35a-31ec30fc7715"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bad_request"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Unrecognized argument(s): `-c`, `x`"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这里的 <code>success</code> 字段会是 <code>false</code>，同时还会有 <code>error.code</code> 和 <code>error.message</code> 字段描述了任务错误的详情信息，Webhook 服务器根据对应的结果进行处理即可。</p>
<h2 data-id="heading-6">流式输出</h2>
<p>Midjourney 官方在生成图片的时候是有进度的，在最开始是一张模糊的照片，然后经过几次迭代之后，图片逐渐变得清晰，最后得到完整的图片。</p>
<p>所以，一张图片的生成过程大约可以分为「发送命令」-&gt;「开始生图（多次迭代逐渐清晰）」-&gt;「生图完毕」的阶段。</p>
<p>在没开启流式输出的情况下，本 API 从发起请求到返回结果，实际上是从上述「发送命令」-&gt;「生图完毕」的全过程，中间生图的过程也全被包含在里面，由于 Midjourney 本身生成图片速度较慢，整个过程大约需要等待一分钟或更久。</p>
<p>所以为了更好的用户体验，本 API 支持流式输出，即当「开始生图」的时候就开始返回结果，每当绘制进度有变化，就会流式将结果输出，直至生图结束。</p>
<p>如果想流式返回响应，可以更改请求头里面的 <code>accept</code> 参数，修改为 <code>application/x-ndjson</code>，不过调用代码需要有对应的更改才能支持流式响应。</p>
<p>Python 样例代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">'https://api.acedata.cloud/midjourney/imagine'</span>
headers = {
    <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/json'</span>,
    <span class="hljs-string">'accept'</span>: <span class="hljs-string">'application/x-ndjson'</span>,
    <span class="hljs-string">'authorization'</span>: <span class="hljs-string">'Bearer {token}'</span>
}
body = {
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"a beautiful cat --v 6"</span>
}
r = requests.post(url, headers=headers, json=body, stream=<span class="hljs-literal">True</span>)
<span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> r.iter_lines():
    <span class="hljs-built_in">print</span>(line.decode())
</code></pre>
<p>运行结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558451443699803/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba7&amp;is=662fda27&amp;hm=4625d5f12158bffc07c4faaf6ce75af6f1396122f148b33b91f3e20b48fecc8b&amp;width=256&amp;height=256"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span><span class="hljs-number">256</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span><span class="hljs-number">256</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1234558451443699803"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558451443699803/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba7&amp;is=662fda27&amp;hm=4625d5f12158bffc07c4faaf6ce75af6f1396122f148b33b91f3e20b48fecc8b&amp;"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span><span class="hljs-number">512</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span><span class="hljs-number">512</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span><span class="hljs-number">35</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"49589d2c-b6b3-4fbf-9f82-93068509c76f"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558458595115149/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba9&amp;is=662fda29&amp;hm=9af53fa645127131a88dfbb3930add7abda710c12a3d6c30c457d6a067b36bab&amp;width=256&amp;height=256"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span><span class="hljs-number">256</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span><span class="hljs-number">256</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1234558458595115149"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558458595115149/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba9&amp;is=662fda29&amp;hm=9af53fa645127131a88dfbb3930add7abda710c12a3d6c30c457d6a067b36bab&amp;"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span><span class="hljs-number">512</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span><span class="hljs-number">512</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span><span class="hljs-number">75</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"49589d2c-b6b3-4fbf-9f82-93068509c76f"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558483408490566/kcisok_A_landscape_painting_of_a_beautiful_sunset_id5963392_eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc.png?ex=66312baf&amp;is=662fda2f&amp;hm=185ea8f130806bf8bd96911bd251808455fd65596edcdb459f9b3cfd7860387c&amp;width=1024&amp;height=1024"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_width"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_height"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1024</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1234558483408490566"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558483408490566/kcisok_A_landscape_painting_of_a_beautiful_sunset_id5963392_eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc.png?ex=66312baf&amp;is=662fda2f&amp;hm=185ea8f130806bf8bd96911bd251808455fd65596edcdb459f9b3cfd7860387c&amp;"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_width"</span><span class="hljs-punctuation">:</span><span class="hljs-number">2048</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"raw_image_height"</span><span class="hljs-punctuation">:</span><span class="hljs-number">2048</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span><span class="hljs-number">100</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"upscale1"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"upscale2"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"upscale3"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"upscale4"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"reroll"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"variation1"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"variation2"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"variation3"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"variation4"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"49589d2c-b6b3-4fbf-9f82-93068509c76f"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，启用流式输出之后，返回结果就是逐行的 JSON 了。</p>
<p>在 Node.js 环境中，实现代码可写为如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">"axios"</span>);

<span class="hljs-keyword">const</span> url = <span class="hljs-string">"https://api.acedata.cloud/midjourney/imagine"</span>;
<span class="hljs-keyword">const</span> headers = {
  <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>,
  <span class="hljs-attr">accept</span>: <span class="hljs-string">"application/x-ndjson"</span>,
  <span class="hljs-attr">authorization</span>: <span class="hljs-string">"Bearer {token}"</span>,
};
<span class="hljs-keyword">const</span> body = {
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">"a beautiful cat --v 6"</span>,
  <span class="hljs-attr">action</span>: <span class="hljs-string">"generate"</span>,
};

axios
  .<span class="hljs-title function_">post</span>(url, body, { <span class="hljs-attr">headers</span>: headers, <span class="hljs-attr">responseType</span>: <span class="hljs-string">"stream"</span> })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">status</span>);
    response.<span class="hljs-property">data</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"data"</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chunk.<span class="hljs-title function_">toString</span>());
    });
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error);
  });
</code></pre>
<p>这些示例运行的结果都是相似的。</p>
<p>请注意，流式输出结果中有一个称为 progress 的字段，表示生成进度，范围从 0 到 100。如果需要，您可以在页面上显示这些信息。</p>
<blockquote>
<p>注意：当生成未完全完成时，<code>actions</code> 字段为空，表示无法对中间图像执行进一步处理操作。生成完成后，在生成过程中生成的 image_url 将被销毁。</p>
</blockquote>
<p>此外，您可以通过指定 <code>accept=application/x-ndjson</code> 的请求头和 callback_url 的请求体，将流式结果与异步回调结合起来，然后 callback_url 可以接收到多个流式结果的 POST 请求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5分钟快速搭建 AI 平台并用它赚钱！]]></title>    <link>https://juejin.cn/post/7603677143215095823</link>    <guid>https://juejin.cn/post/7603677143215095823</guid>    <pubDate>2026-02-08T14:59:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603677143215095823" data-draft-id="7603677143215079439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5分钟快速搭建 AI 平台并用它赚钱！"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T14:59:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5分钟快速搭建 AI 平台并用它赚钱！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T14:59:06.000Z" title="Sun Feb 08 2026 14:59:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAceDataCloud%2FNexior" target="_blank" title="https://github.com/AceDataCloud/Nexior" ref="nofollow noopener noreferrer">Nexior</a> 是 GitHub 上的一个开源项目，利用它我们可以一键部署自己的 AI 应用站点，包括 AI 问答、Midjourney 绘画、知识库问答、艺术二维码等应用，无需自己开发 AI 系统、无需采购 AI 账号、无需关心 API 支持、无需配置支付系统，零启动成本，无风险通过 AI 赚取收益。</p>
<p>本文章会介绍 Nexior 项目在 Vercel 上的部署流程，无需任何编程技巧即可几分钟部署一套属于自己的 AI 站点，并轻松利用该站点获取收益。</p>
<h2 data-id="heading-0">准备</h2>
<p>首先打开 Nexior 的 GitHub 仓库，地址为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAceDataCloud%2FNexior" target="_blank" title="https://github.com/AceDataCloud/Nexior" ref="nofollow noopener noreferrer">github.com/AceDataClou…</a>，然后注册或登录 GitHub 账号，点击 Fork，克隆一份代码到自己的本地仓库，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/3zf2hx.png" alt="" loading="lazy"/></p>
<p>Fork 完毕之后，我们便可以得到如下自己的个人仓库，如下：</p>
<p><img src="https://cdn.acedata.cloud/bcxmlc.png" alt="" loading="lazy"/></p>
<p>这里的示例账号是 Germey，所以可以看到这里我们就 Fork 到了 Germey 这个用户下，同时有一个 forked from <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAceDataCloud%2FNexior" target="_blank" title="https://github.com/AceDataCloud/Nexior" ref="nofollow noopener noreferrer">AceDataCloud/Nexior</a> 的字样，这样准备工作就完成了。</p>
<h2 data-id="heading-1">Vercel 部署</h2>
<p>Vercel 是一个可以帮助快速部署项目网站的平台，我们可以利用它直接和 GitHub 仓库对接，然后把 GitHub 仓库的源代码快速部署到线上，下面介绍下 Vercel 部署 Nexior 项目的流程。</p>
<p>打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2F" target="_blank" title="https://vercel.com/" ref="nofollow noopener noreferrer">vercel.com/</a>，使用 GitHub 登录。</p>
<p>我们便会看到类似如下的页面，这时候点击 Import 按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/jjcnnq.png" width="600" class="m-auto" loading="lazy"/></p>
<p>此时，Vercel 便展示了你的 GitHub 仓库，选择刚才 Fork 的 Nexior 仓库即可，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/38advc.png" width="600" class="m-auto" loading="lazy"/></p>
<p>找到 Nexior 仓库之后，点击 Import 按钮导入。</p>
<p>接着便会弹出一个配置页面，完全保持默认配置，点击 Deploy 按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/6kvz1p.png" width="600" class="m-auto" loading="lazy"/></p>
<p>点击 Deploy 之后，Vercel 便开始构建整个项目并进行部署，我们不需要做任何操作，只需等待 1-2 分钟左右即可，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/1i9ss8.png" alt="" loading="lazy"/></p>
<p>部署完毕之后，Vercel 便会弹出一个页面恭喜你的部署已经完成，此时你就成功把 Nexior 项目部署到你的线上环境了，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/qn8ndd.png" alt="" loading="lazy"/></p>
<p>点击 Continue to Dashboard，我们便可以看到 Vercel 为我们生成的预览域名，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/c9p0r2.png" alt="" loading="lazy"/></p>
<p>此时直接打开这个链接，比如这里的样例地址是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnexior-germeys-projects.vercel.app%2F" target="_blank" title="https://nexior-germeys-projects.vercel.app/" ref="nofollow noopener noreferrer">nexior-germeys-projects.vercel.app/</a>，打开之后，我们便可以看到 Nexior 项目的运行情况了。</p>
<p>打开之后注册登录一下，比如用邮箱、GitHub 登录都是可以的，登录完毕之后便可以看到一个配置页面，比如 Site Configuration，我们可以自行修改该站点的标题、Logo、Favicon、管理员等信息，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/o4fuy6.png" width="600" class="m-auto" loading="lazy"/></p>
<p>同时还有一个比较重要的部分就是分销推广的配置，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/d8c4md.png" width="600" class="m-auto" loading="lazy"/></p>
<p>这里我们可以修改两个信息，一个叫默认邀请人 ID、一个叫强制邀请人 ID，说明如下：</p>
<ul>
<li>默认邀请人 ID：如果只设置了默认邀请人 ID，那么人人都可以分销和推广该站点，谁邀请的客户，客户的消费返利都会给到邀请人。如果站点的 URL 不携带任何推广信息的时候（URL 里面没有 inviter_id）的时候，注册用户默认情况下都会绑定到这个默认邀请人 ID 上。初始状态下这个 ID 就是站长的个人 ID。</li>
<li>强制邀请人 ID：如果设置了强制邀请人 ID，那么除了这个强制邀请人，其他人都无法从该站点获得分销返利，后台也看不到分销推广的入口。该站点所有注册用户都会被绑定到这个强制邀请人上面，所有的消费返利都是强制邀请人的。</li>
</ul>
<p>所以，对于以上两个模式，取决于站长的推广思路，视情况而定。</p>
<p>另外还有一个配置选项就是功能开关，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/zwi7hu.png" width="600" class="m-auto" loading="lazy"/></p>
<p>目前 Nexior 提供了多个功能，站长可以选择性地打开或关闭某些特定功能。</p>
<h2 data-id="heading-2">自定义域名</h2>
<p>现在我们已经成功部署了一个网站，但是域名是 Vercel 为我们分配的二级域名，其实并不利于对外推广，如果能够修改为我们的自定义域名的话就会好很多。</p>
<p>比如说我这边有一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchictem.com" target="_blank" title="https://chictem.com" ref="nofollow noopener noreferrer">chictem.com</a> 的域名，下面介绍下自定义域名的配置。</p>
<blockquote>
<p>如果没有域名，可以到各大域名厂商注册，例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.namecheap.com%2F" target="_blank" title="https://www.namecheap.com/" ref="nofollow noopener noreferrer">namecheap</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgodaddy.com%2F" target="_blank" title="https://godaddy.com/" ref="nofollow noopener noreferrer">Godaddy</a> 等，一些中国境内服务商也可以。</p>
</blockquote>
<p>接下来我们打开 Vercel 的自定义域名配置页面：</p>
<p><img src="https://cdn.acedata.cloud/6mqomk.png" alt="" loading="lazy"/></p>
<p>此处输入你想要配置的自定义域名，比如这里示例配置为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchictem.com" target="_blank" title="https://chictem.com" ref="nofollow noopener noreferrer">chictem.com</a>，就直接填写 chictem.com，不带 <code>https://</code> 前缀，点击 Add：</p>
<p><img src="https://cdn.acedata.cloud/v7idkv.png" alt="" loading="lazy"/></p>
<p>接下来 Vercel 提示要选择域名配置的选项，推荐我们也添加一个 www 开头的域名，这个可加可不加，添加了之后就可以 www 开头的域名也能访问到此网站。这里我们直接选择最后一项直接添加根域名：</p>
<p><img src="https://cdn.acedata.cloud/zmdx31.png" width="600" class="m-auto" loading="lazy"/></p>
<p>确定之后我们就发现这里提示有一个待配置的 DNS：</p>
<p><img src="https://cdn.acedata.cloud/fu7rt7.png" alt="" loading="lazy"/></p>
<p>这里让我们添加一个 A 记录，解析到 76.76.21.21，我们这时候需要转到域名服务商这里配置下 DNS。</p>
<blockquote>
<p>注意：域名服务商取决于你在哪个网站域名买的域名，通常来说你在哪个网站买的域名，网站后台就有配置 DNS 的入口。</p>
</blockquote>
<p>下面是一个 DNS 后台配置样例：</p>
<p><img src="https://cdn.acedata.cloud/isy712.png" alt="" loading="lazy"/></p>
<p>配置完毕之后，我们就能用自定义域名访问刚配置的网站了，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/ui08w3.png" alt="" loading="lazy"/></p>
<blockquote>
<p>注意：配置了新域名之后，注意我们需要进入到站点配置页面重新配置下站点标题、Logo 等选项，因为这个配置是跟域名绑定的，启用了新域名之后需要新配置站点。</p>
</blockquote>
<h2 data-id="heading-3">代码更新</h2>
<p>因为 Nexior 的源代码是在持续更新的，可能不断有新的功能或者 Bug 修复，代码会直接同步到源代码仓库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAceDataCloud%2FNexior" target="_blank" title="https://github.com/AceDataCloud/Nexior" ref="nofollow noopener noreferrer">github.com/AceDataClou…</a> 这里。</p>
<p>那我们部署的站点如果想同步更新最新代码，应该怎么做呢？</p>
<p>其实很简单，回到 GitHub 里面我们 Fork 的代码仓库，这里可以看到我们原本 Fork 的代码仓库已经落后于官方 Nexior 源代码几个版本了，我们可以直接点击 Sync fork 按钮，然后点击 Update branch 就可以了：</p>
<p><img src="https://cdn.acedata.cloud/zs9tgq.png" alt="" loading="lazy"/></p>
<p>点击之后，我们 fork 的仓库的代码就会更新，代码更新之后，Vercel 这边的网站也会自动更新，稍等片刻重新刷新网页就发现网站更新了。</p>
<h2 data-id="heading-4">赚取收益</h2>
<p>现在我们已经有了自定义域名，配置好如上内容之后，就可以把这个站点分享出去赚钱啦</p>
<p>所有的用户只要有付费账单，其中有一部分便会转化为收益到达分销者的账户，到时候添加客服提现即可。</p>
<p>进入分销界面，可以随时查看当前邀请人数、分销总金额、总奖励等，直接添加客服提现即可。</p>
<p><img src="https://cdn.acedata.cloud/zo05gl.png" width="600" class="m-auto" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[css实现一个宽高固定百分比的布局的一个方式]]></title>    <link>https://juejin.cn/post/7603783314712969252</link>    <guid>https://juejin.cn/post/7603783314712969252</guid>    <pubDate>2026-02-08T13:26:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603783314712969252" data-draft-id="7588004376866750499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="css实现一个宽高固定百分比的布局的一个方式"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T13:26:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            css实现一个宽高固定百分比的布局的一个方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:26:08.000Z" title="Sun Feb 08 2026 13:26:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果说要实现一个固定百分比布局，有不少方案，但大多数是针对于一个固定的值进行计算宽高的，搭配js非常的方便，如果要使用纯css的话有什么好的相对简单的办法呢</p>
<p>当然实际不推荐直接这么用，可以根据情况使用最合适的方法，这里只是提供一种思考思路，也就是css的一些特性，能让我们有更多方式实现同一种效果</p>
<p>这里 使用padding-top、padding-bottom 的百分比，相对于<strong>父节点宽度百分比</strong>的思路来实现</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"App"</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>cs效果如下所示</p>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">App</span> {
  padding-<span class="hljs-attr">top</span>: <span class="hljs-number">50</span>%;
  <span class="hljs-attr">height</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>%;
  background-<span class="hljs-attr">color</span>: red;
}
</code></pre>
<p>这样就实现了一个宽高固定百分比的方案，搭配一个简单的reactive、absolute 就可以轻松实现内容百分比展示、</p>
<p>当然有些场景使用 calc 直接计算也行，配合js、css变量更不多说了，方法多得很，看怎么操作</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[css外边距重叠问题]]></title>    <link>https://juejin.cn/post/7603783314712985636</link>    <guid>https://juejin.cn/post/7603783314712985636</guid>    <pubDate>2026-02-08T13:26:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603783314712985636" data-draft-id="7591702898080219151" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="css外边距重叠问题"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T13:26:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            css外边距重叠问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:26:21.000Z" title="Sun Feb 08 2026 13:26:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端开发过程中，是否碰到这样一个场景，同时设置了上部元素下边距和下部元素上边距，发现实际的边距竟然不是两个外边距之和，这就是我们这里讲的css 外边距重叠了</p>
<p>css外边距重叠通常发生在 block 块级元素中(flex、inline不会出现)，且只包括上下边距，左右边距不会重叠</p>
<p>有三种场景会出现边距重叠问题：</p>
<p><strong>场景一：两个子节点同时设置上下边距</strong></p>
<p>出现了两个子节点，分上部元素下边距(margin-bottom)和下部元素上边距（margin-top），此时，两者边距会出现以下合并场景</p>
<ul>
<li>两者均为正、均为负，取绝对值的最大值</li>
<li>两者一正一负，取他们的和</li>
</ul>
<p><strong>场景二：父子节点的元素穿透</strong></p>
<p>父节点没设置margin-top，子节点设置了margin-top，则子节点的margin-top则会穿透到父节点产生间距，当然这种场景一般我们直观感觉不到，确实存在这种场景</p>
<p><strong>场景二：空元素上下边距重叠</strong></p>
<p>一个空元素的存在，且设置了上下边距，一般我们认为就是一个占高的元素，通常我们会直接设置height，如果同时设置了margin-top、margin-bottom，则上下边距会重叠选择最大值，合并成他的占位高度，这个见到的非常少了</p>
<p><strong>ps</strong>：我们正常编写为了避免出现此类问题，可以尽量使用 BFC 场景，例如：我们使用flex布局，子元素就不会出现重叠了</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[js数组之快速组、慢数组、密集数组、稀松数组]]></title>    <link>https://juejin.cn/post/7603911453704421419</link>    <guid>https://juejin.cn/post/7603911453704421419</guid>    <pubDate>2026-02-08T13:26:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704421419" data-draft-id="7592787377657036834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="js数组之快速组、慢数组、密集数组、稀松数组"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T13:26:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            js数组之快速组、慢数组、密集数组、稀松数组
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:26:30.000Z" title="Sun Feb 08 2026 13:26:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>我们大多数只知道数组是一个有序集合，但由于js的数组使用非常灵活，因而衍生出来非常多的疑问，本篇文章会对一些常对其一些场景情况出现的名词和逻辑进行一定程度探讨</p>
<p>实际上有学习过数据结构和算法的基本上都能想到大致可能的场景或者关键字，线性数组、索引、哈希表</p>
<p>另外数组中经常听到的快速组、慢数组、密集数组、稀松数组，也会从这里慢慢带入</p>
<h2 data-id="heading-1">js数组介绍</h2>
<p>集合有很多，js中的数组主要目的是存放有序内容，当然实际也会使用和对象一样</p>
<h3 data-id="heading-2">密集数组与快数组</h3>
<p>密集也就是我们常见的数组使用方式，按照数字索引逐步存放的，按顺序每个索引都存放内容了即使是undefined、null也是如此,这就叫做密集数组</p>
<p>密集数组通常是数组中的快数组，顾名思义，效率高，快</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> list = []
list.<span class="hljs-title function_">push</span>(<span class="hljs-string">'第一个'</span>)
list.<span class="hljs-title function_">push</span>(<span class="hljs-string">'第二个'</span>)
list.<span class="hljs-title function_">push</span>(<span class="hljs-literal">null</span>)
<span class="hljs-comment">//实际上存放的是 ['第一个', '第二个']</span>
</code></pre>
<h3 data-id="heading-3">稀疏数组与慢数组</h3>
<p>了解了密集数组，也很容易想到稀疏数组，并不是索引逐步存放的，中间存在断档，也就是跳过了部分索引赋值</p>
<p>稀疏数组可能会转化为慢数组，顾名思义，效率低，慢</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> list = []
list[<span class="hljs-number">10</span>] = <span class="hljs-number">10</span>
list[<span class="hljs-number">100</span>] = <span class="hljs-number">100</span>
<span class="hljs-comment">//实际上存放了2个元素，长度缺是101，多出来的都是空元素</span>
</code></pre>
<h3 data-id="heading-4">快数组与慢数组</h3>
<p>当我们生成的数组是一个密集数组的时候，我们的数组会生成一个连续的内存结构，用于存放我们的索引，因此访问效率很高,时间复杂度位O(1)，这就是<strong>快速组</strong></p>
<p><strong>连续内存</strong>，可以理解为，一个小区的楼栋分别按照顺序排列，我们知道了第一个只需要加上4个偏移就是第五栋了，在寻址中，知道地址就能快速访问到对应的地址内容了</p>
<p>当我们的数组是一个稀松数组，或者一个类数组时，会转化为慢数组，也就是我们常见的对象结构时，此时就是传说中的慢数组了，访问起来就是一个哈希结构了，这也是为了节省内存，毕竟学过数据结构或者了解过计算机内存分布的都知道，空间是申请好才能用的，且是连续的，不可能上来就乱申请一个巨大的连续空间，然后就为了保存那两个数据，非常不合理</p>
<p>尽管申请的内存块都是连续的，对于索引不连续的储存，一般都是采用哈希表的处理方式，将key转化为索引，处理冲突等，来解决内存映射问题，当然对于哈希结构用的比较多的就是<strong>线性表、树表</strong>了，而对于哈希表尽管优化，但操作、访问效率是不如顺序表的平均来看大约是O(1) ~ O(logn)，并且由于线性表有冲突处理是要高于顺序表的，这里并不多介绍这两者，就介绍这么多x(想多了解的可以翻我以前写的数据结构与算法中的哈希表环节)</p>
<p>那么平时我们怎样做能用到快数组，什么样的场景慢数组呢</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//快数组，索引有序逐步填充</span>
<span class="hljs-keyword">const</span> list = []
list.<span class="hljs-title function_">push</span>(<span class="hljs-string">'第一个'</span>)
list.<span class="hljs-title function_">push</span>(<span class="hljs-string">'第二个'</span>)

<span class="hljs-comment">//慢数组，仍然使用数字的</span>
<span class="hljs-keyword">const</span> list = []
list[<span class="hljs-number">10</span>] = <span class="hljs-number">10</span>
list[<span class="hljs-number">100</span>] = <span class="hljs-number">100</span>

<span class="hljs-comment">//慢数组，直接使用非数字的</span>
<span class="hljs-keyword">const</span> list = [] <span class="hljs-comment">//使用new Array(101)也一样</span>
list[<span class="hljs-string">'name'</span>] = <span class="hljs-number">10</span>
list[name2] = <span class="hljs-number">100</span>
</code></pre>
<p>实际上还有一种密集数组，仍然会转化为慢数组，那就是<strong>数据内容过多</strong>，比如超过1000，可能就会被v8转化为哈希结构的数组的，可能会问为什么，因为一块非常大连续的内存空间申请也是一个技术活，内存申请释放很容易出现<strong>内存碎片</strong>，简单说就是很多申请释放之间的连续内存区域不足够大，这么做也是为了更好使用碎片化内存，毕竟内存不够申请的话，也是一个大问题</p>
<h2 data-id="heading-5">最后</h2>
<p>我们都知道数组实际上也是继承自对象，也有自己的原型，针对于上面的不同结构，我们用的数组操作是js提供给我们的一个统一接口，如果我们使用同一个接口用来转化操作不同结构的对象，我们会怎么处理呢，又会想到哪些设计模式呢？</p>
<p>本篇文章就介绍到这里了，希望大家有点收获😄</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[chrome单页签内存分配上限问题，怎么解决]]></title>    <link>https://juejin.cn/post/7603895839556517951</link>    <guid>https://juejin.cn/post/7603895839556517951</guid>    <pubDate>2026-02-08T13:27:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603895839556517951" data-draft-id="7573892573345906740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="chrome单页签内存分配上限问题，怎么解决"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T13:27:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            chrome单页签内存分配上限问题，怎么解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:27:01.000Z" title="Sun Feb 08 2026 13:27:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>我们都知道 chrome 的单个标签内存占用都是有限制的，平均也就2~4G，32位的只会更少，并且这很多情况下只是理想状态，当桌面应用多开的时候，chrome 单个页签的大小更是会大幅度缩水，那么我们怎样解决chrome的内存分配上限呢</p>
<h2 data-id="heading-1">为什么</h2>
<p>疑问：为何要管这个内存分配上限问题？</p>
<p>答：内存不足时，无论是操作系统还是浏览器都会有一些内存交换或者释放内存的方式，无论是哪一个短时间内都是极度耗费性能的，尤其是单纯的内存占用高的问题，频繁的内存交换，这个只会造成更严重的页面严重卡顿，甚至无响应，也就是说到底内存问题还是会再转化为标注你的性能优化问题</p>
<h2 data-id="heading-2">一般场景</h2>
<p>解决单页签内存分配上限时，我们首先要看问题在哪里，一般会有下面几种场景：</p>
<ul>
<li>页面递归死循环，堆栈溢出，这个属于重大bug，需要及时解决，不多解释</li>
<li>页面出现了循环引用内存泄漏，导致内存没能及时释放，出现内存占用过高，此时我们要想尽办法解决内存泄漏问题，当然这个问题算是中等问题，因为还有垃圾回收，只要不是全局引用的一般都会随着页面资源的释放释放，或者内存不足时统一释放回收</li>
<li>页面出现了海量数据需要展示的数据，但是又无可奈何的时候，只能想尽办法来避免占用过高，常见的：echarts图标大量数据，直播巨量弹幕等</li>
</ul>
<h2 data-id="heading-3">一些解决方案</h2>
<h3 data-id="heading-4">递归死循环</h3>
<p>对于递归死循环的问题，只能说，靠实力或者队友解决此bug，不应该出现</p>
<h3 data-id="heading-5">内存泄漏</h3>
<p>当页面出现内存泄漏的时候，前端一般出现在闭包场景，或者强引用场景，出现了类似的循环引用问题，导致内存无法释放或者无法及时释放，累计起来也是一个不小的数字</p>
<p>对于常规页面内的循环引用，一般会随着页面的释放，那片内存空间会成为无主之物，会成为垃圾回收的养料，一般不管</p>
<p>主要是涉及到模块或者全局场景，这类大对象的强引用问题需要注意，如果不及时释放持有，则可能会长期持有，导致内存居高不不下，成为压死骆驼的最后一根稻草</p>
<h3 data-id="heading-6">海量数据问题</h3>
<p>对于海量的数据问题，常见的就是大屏echart 之类的表格折线图等数据了，这类数据可以通过一些算法，优化尽量减少数据、分段渲染，甚至更改展示区间逻辑，这样内存高占用以及非高占用的卡顿问题能够改善</p>
<p>对于海量数据，还有另外一种情况，就是需要展示海量内容很多，单独一个页面无论怎么处理都是非常麻烦的，此时可以将该页面展示一个概览数据，当需要看详情的时候，直接跳转到另外一个浏览器标签，这样新的把标签的内存占用情况会明显改善，对于新标签页仍然占用过高的情况，仍然使用之前的数据分段减少数据等手段解决</p>
<h2 data-id="heading-7">最后</h2>
<p>从chrome的内存分配上限，到转化为实际的性能瓶颈优化，到bug修复，到内存泄漏问题，再到海量数据优化，再到页面分布改善标签跳转等</p>
<p>解决问题的思路总是随着我们的疑问，一步一步向外延伸，问题和解决的方案上面也只是其中一部分，分析问题实际上也是我们进步的一环</p>
<p>本篇文章也就介绍到这里了，下次见😄</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[生成随机数，Math.random的使用]]></title>    <link>https://juejin.cn/post/7603781883973943315</link>    <guid>https://juejin.cn/post/7603781883973943315</guid>    <pubDate>2026-02-08T13:26:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603781883973943315" data-draft-id="7592094314471751715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="生成随机数，Math.random的使用"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T13:26:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            生成随机数，Math.random的使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:26:41.000Z" title="Sun Feb 08 2026 13:26:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>有时候我们有生成随机数的一些想法，可能会直接想使用 Math.random，但这个Math.random 优缺也很明显，优点简单方便兼容性高，缺点就是算法固定，后续可能会预测，且全是数字，长度也不固定，对于一些场景不太友好</p>
<p>我们可以通过使用码表 + 随机数偏移的方式生成随机数，这样效率实际也不低，且不仅仅是纯数字了，长度也固定了，并且码表也是可以随机变动的，这样上面的一些隐患实际就没了</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//码表可以扩展加乱序，可打乱减少被预测概率，这里就不写码表打乱的算法了，我们就解决数字 + 长度问题，看起来舒服</span>
<span class="hljs-keyword">const</span> mapString = <span class="hljs-string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;

<span class="hljs-comment">//生成随机数，根据随机数生成偏移，取出码表中的一个字符，根据长度取出指定个数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getRandomString</span>(<span class="hljs-params">length</span>) {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">const</span> charactersLength = mapString.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
    <span class="hljs-comment">//当然想进一步提速，也可以转化为数组的访问，这里不多做操作了</span>
    result += mapString[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * charactersLength)];
  }
  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>如果对于码表没有要求的话仅仅是当一个唯一id的话，我们实际上直接将随机数转化成36进制字符串，取出其中一项就行了，实际上转化成36进制，取出其中一项，就是 <strong>[0-9a-z]+</strong> 了，但感觉没上面好</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getRandomString</span>(<span class="hljs-params">length</span>) {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
        result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>(<span class="hljs-number">36</span>).<span class="hljs-title function_">charAt</span>(<span class="hljs-number">2</span>);
    }
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>看了上面的写法，是不是感觉思路更多了，确实如此，我们实际使用的话，就使用第一种方案感觉就挺好的，不管是生成表单的id，还是生成其他地方的随机数，都足够用了😄</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端算法：从 O(n²) 到 O(n)，列表转树的极致优化]]></title>    <link>https://juejin.cn/post/7603769956975984681</link>    <guid>https://juejin.cn/post/7603769956975984681</guid>    <pubDate>2026-02-08T13:34:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956975984681" data-draft-id="7603781883973926931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端算法：从 O(n²) 到 O(n)，列表转树的极致优化"/> <meta itemprop="keywords" content="前端,算法,数据结构"/> <meta itemprop="datePublished" content="2026-02-08T13:34:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端算法：从 O(n²) 到 O(n)，列表转树的极致优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:34:53.000Z" title="Sun Feb 08 2026 13:34:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 引言与业务场景</h2>
<p>在前端开发中，数据结构的转换是一项基础且高频的技能。后端数据库通常以扁平化（Flat List）的形式存储层级数据，每条记录仅保留 id 和 parentId 来标识父子关系。然而，前端组件（如 Ant Design 的 Tree、Cascader，或 Element UI 的 Table 树形模式）往往需要嵌套的树形结构（Tree Structure）来渲染视图。</p>
<p>常见的业务场景包括但不限于：</p>
<ul>
<li><strong>RBAC 权限系统</strong>：后台管理系统的侧边栏菜单。</li>
<li><strong>组织架构图</strong>：展示公司部门与员工的层级关系。</li>
<li><strong>行政区划联动</strong>：省、市、区/县的三级联动选择器。</li>
<li><strong>评论盖楼</strong>：社交平台的多级回复机制。</li>
</ul>
<p>输入数据通常如下所示：</p>
<p>JavaScript</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">const</span> <span class="hljs-string">flatList</span> <span class="hljs-string">=</span> [
  { <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'系统管理'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'用户管理'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'权限配置'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">4</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'用户列表'</span> },
  <span class="hljs-string">//</span> <span class="hljs-string">...</span> <span class="hljs-string">可能有成百上千条数据</span>
]<span class="hljs-string">;</span>
</code></pre>
<p>目标是将其转换为如下的树形结构：</p>
<p>JavaScript</p>
<pre><code class="hljs language-yaml" lang="yaml">[
  {
    <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>,
    <span class="hljs-attr">name:</span> <span class="hljs-string">'系统管理'</span>,
    <span class="hljs-attr">children:</span> [
      {
        <span class="hljs-attr">id:</span> <span class="hljs-number">2</span>,
        <span class="hljs-attr">name:</span> <span class="hljs-string">'用户管理'</span>,
        <span class="hljs-attr">children:</span> [
          { <span class="hljs-attr">id:</span> <span class="hljs-number">4</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'用户列表'</span>, <span class="hljs-attr">children:</span> [] }
        ]
      },
      { <span class="hljs-attr">id:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'权限配置'</span>, <span class="hljs-attr">children:</span> [] }
    ]
  }
]
</code></pre>
<p>本文将从面试官的角度，分析两种主流的实现方案，探讨从递归到哈希映射的思维跃迁，以及如何通过利用 JavaScript 的对象引用(Object Reference)特性实现性能的极致优化。</p>
<hr/>
<h2 data-id="heading-1">2. 基础方案：递归实现 (Recursion)</h2>
<p>递归是处理树形结构最直观的思维方式。其核心逻辑是：对于每一个节点，遍历整个列表，找出所有 parentId 等于当前节点 id 的项，作为其子节点。</p>
<h3 data-id="heading-2">代码实现</h3>
<p>利用 ES6 的数组方法，我们可以写出非常简洁的代码：</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 递归查找，构建树形结构
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>} list 原始列表
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Number</span>} parentId 当前节点的父节点ID，默认为根节点ID 0
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">Array</span>} 树形结构
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">listToTreeRecursive</span>(<span class="hljs-params">list, parentId = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">return</span> list
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">parentId</span> === parentId)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
      ...item,
      <span class="hljs-attr">children</span>: <span class="hljs-title function_">listToTreeRecursive</span>(list, item.<span class="hljs-property">id</span>)
    }));
}
</code></pre>
<h3 data-id="heading-3">深度解析与瓶颈</h3>
<p>这段代码在面试中通常作为“及格”的答案。它逻辑清晰，代码量少，但在工程实践中存在明显的性能隐患。</p>
<p><strong>时间复杂度分析：O(n²)</strong></p>
<p>假设列表长度为 n。</p>
<ol>
<li>函数 listToTreeRecursive 会被调用多次。</li>
<li>每一次调用，filter 都会遍历整个列表（长度为 n）来寻找子节点。</li>
<li>随着递归深度的增加，虽然总调用次数取决于节点数量，但从宏观算法角度来看，这是一个典型的嵌套遍历模型。其时间复杂度接近 <strong>O(n²)</strong> 。</li>
</ol>
<p><strong>性能风险</strong></p>
<ul>
<li><strong>CPU 阻塞</strong>：当数据量达到几千条（例如全国省市区数据）时，计算量将呈指数级增长，可能导致主线程阻塞，页面卡顿。</li>
<li><strong>栈溢出</strong>：虽然在 DOM 树场景下层级通常不会太深，但如果数据层级极深，递归调用栈可能超出浏览器限制（Stack Overflow）。</li>
</ul>
<hr/>
<h2 data-id="heading-4">3. 进阶方案：Map 映射优化 (Iterative Approach)</h2>
<p>为了解决递归带来的性能问题，我们需要打破“每次查找子节点都要遍历整个列表”的限制。</p>
<p><strong>优化思路：空间换时间</strong></p>
<p>通过引入一个哈希表（Hash Map），我们可以将节点的查找时间复杂度从 <strong>O(n)</strong>  降低到 <strong>O(1)</strong> 。在 JavaScript 中，我们可以利用 Map 或原生 Object 来实现。</p>
<h3 data-id="heading-5">核心原理：利用对象引用</h3>
<p>这是面试中的<strong>加分项</strong>，也是容易写错的地方。<br/>
核心在于：JavaScript 中的对象是<strong>引用传递（Pass by Reference）</strong> 。当我们修改 Map 中存储的对象的 children 属性时，所有指向该对象的引用都会同步感知到变化。</p>
<h3 data-id="heading-6">代码实现</h3>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">/**
 * 利用 Map 映射，非递归构建树形结构
 * 时间复杂度 O(n)
 * @param {Array} list 原始列表
 * @return {Array} 树形结构
 */
function listToTreeMap(list) {
  const <span class="hljs-attr">nodeMap</span> = new Map()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tree</span> = []<span class="hljs-comment">;</span>

  // 第一步：初始化 Map，将所有节点以 id 为键存入 Map
  // 关键点：不仅存入，还必须为每个节点初始化 children 数组
  list.forEach(<span class="hljs-attr">item</span> =&gt; {
    nodeMap.set(item.id, { ...item, children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>

  // 第二步：再次遍历，建立父子关系
  list.forEach(<span class="hljs-attr">item</span> =&gt; {
    // 必须获取 Map 中的引用（reference），而不是原始 list 中的 item
    // 只有修改 Map 中的对象，才能通过引用机制同步到 tree 数组中
    const <span class="hljs-attr">node</span> = nodeMap.get(item.id)<span class="hljs-comment">;</span>
    
    // 如果是根节点，直接放入结果数组
    if (<span class="hljs-attr">item.parentId</span> === <span class="hljs-number">0</span>) {
      tree.push(node)<span class="hljs-comment">;</span>
    } else {
      // 在 Map 中查找父节点
      const <span class="hljs-attr">parentNode</span> = nodeMap.get(item.parentId)<span class="hljs-comment">;</span>
      // 如果父节点存在，将当前节点（的引用）推入父节点的 children
      if (parentNode) {
        parentNode.children.push(node)<span class="hljs-comment">;</span>
      }
    }
  })<span class="hljs-comment">;</span>

  return tree<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-7">关键逻辑解析</h3>
<ol>
<li>
<p><strong>Map 初始化</strong>：我们首先遍历一次列表，将所有数据转换为 { id: node } 的映射结构。这一步使得后续查找任意节点的操作变为 O(1)。</p>
</li>
<li>
<p><strong>引用传递的妙用</strong>：</p>
<ul>
<li>当 tree.push(node) 执行时，tree 数组持有的是节点的<strong>内存地址引用</strong>。</li>
<li>当 parentNode.children.push(node) 执行时，parentNode 的 children 数组持有的也是同一个<strong>内存地址引用</strong>。</li>
<li>因此，无论节点层级多深，我们只需要两层平级的遍历即可完成所有连接。</li>
</ul>
</li>
</ol>
<p><strong>时间复杂度分析：O(n)</strong></p>
<ul>
<li>第一次遍历构建 Map：O(n)。</li>
<li>第二次遍历构建关系：O(n)。</li>
<li>总复杂度：O(2n)，即 <strong>O(n)</strong> 。</li>
</ul>
<hr/>
<h2 data-id="heading-8">4. 方案对比与选型建议</h2>
<p>从面试官的角度来看，能够清晰分析出两种方案的优劣，并根据场景选择合适的方案，是高级工程师具备的素质。</p>



































<table><thead><tr><th>维度</th><th>递归方案 (Recursion)</th><th>Map 映射方案 (Iteration)</th></tr></thead><tbody><tr><td><strong>时间复杂度</strong></td><td><strong>O(n²)</strong>  (性能较差)</td><td><strong>O(n)</strong>  (性能极佳)</td></tr><tr><td><strong>空间复杂度</strong></td><td>O(n) (递归栈开销)</td><td>O(n) (Map 存储开销)</td></tr><tr><td><strong>代码可读性</strong></td><td>高，逻辑符合直觉</td><td>中，需要理解引用关系</td></tr><tr><td><strong>适用场景</strong></td><td>数据量小 (&lt;100条)，快速开发</td><td>数据量大 (&gt;1000条)，追求性能</td></tr><tr><td><strong>健壮性</strong></td><td>深度过大可能导致栈溢出</td><td>无栈溢出风险</td></tr></tbody></table>
<p><strong>面试建议</strong>：</p>
<ul>
<li>如果面试要求“写一个转换函数”，先询问数据量级。</li>
<li>默认情况下，优先通过 Map 方案展示你对复杂度和引用的理解。</li>
<li>在编写 Map 方案时，务必注意<strong>不要直接操作原始 list item</strong>，而是操作 Map 中存储的<strong>新对象引用</strong>，这是最常见的逻辑陷阱。</li>
</ul>
<hr/>
<h2 data-id="heading-9">5. 结语</h2>
<p>“扁平列表转树”不仅仅是一道算法题，它深刻体现了前端开发中对<strong>内存引用</strong>和<strong>时间复杂度</strong>的理解。</p>
<ol>
<li><strong>基础层</strong>：理解树形结构，能写出递归。</li>
<li><strong>进阶层</strong>：理解哈希表（Hash Map）在算法优化中的“空间换时间”思想。</li>
<li><strong>专家层</strong>：熟练掌握 JavaScript 的对象引用机制，能够编写出无副作用、高性能的转换代码。</li>
</ol>
<p>在实际业务开发中，面对复杂且庞大的组织架构或菜单数据，使用 O(n) 的 Map 映射方案应是你的首选。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mistral 掀桌子：40亿参数跑本地，Voxtral 2 把延迟压进了200毫秒]]></title>    <link>https://juejin.cn/post/7604012106153689134</link>    <guid>https://juejin.cn/post/7604012106153689134</guid>    <pubDate>2026-02-08T13:37:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604012106153689134" data-draft-id="7603688142005485577" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mistral 掀桌子：40亿参数跑本地，Voxtral 2 把延迟压进了200毫秒"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-08T13:37:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mistral 掀桌子：40亿参数跑本地，Voxtral 2 把延迟压进了200毫秒
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:37:08.000Z" title="Sun Feb 08 2026 13:37:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在语音转文本（STT）这个赛道上，OpenAI 的 Whisper 就像是一座不得不翻的大山。但在 2026 年 2 月初，来自法国的 Mistral AI 似乎找到了绕过这座大山，甚至直接打穿它的方法。</p>
<p>他们正式发布了 <strong>Voxtral Transcribe 2</strong> 系列。如果说以前的模型是在比谁听得更准，Mistral 这次则是把战场拉到了“听得有多快”和“能不能在自己电脑上听”这两个痛点上。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-08_21.29.37-1024x350.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-08_21.29.37-1024x350.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cf7940c24614ddfb3e15fd4d10997fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771162628&amp;x-signature=LJdA%2Boa9oT8fi4hTfcMfAEryawc%3D" alt="iShot_2026-02-08_21.29.37" loading="lazy"/></a></p>
<p>这次发布的不是一个模型，而是一套组合拳：一个是干脏活累活的<strong>批量版（Mini V2）</strong>，一个是追求极致速度的<strong>实时版（Realtime）</strong>。</p>
<h3 data-id="heading-0">告别“尴尬的沉默”</h3>
<p>先说最让开发者兴奋的 <strong>Voxtral Realtime</strong>。</p>
<p>做过实时语音交互的朋友都知道，延迟是最大的敌人。用户说完话，AI 愣住一两秒才开始吐字，这种体验足以毁掉任何智能助手。Mistral 这次通过流式架构设计，把延迟压到了 <strong>200 毫秒以下</strong>。</p>
<p>这是什么概念？人类正常对话的反应间隙通常就在 200 毫秒左右。这意味着，不管是用来做实时翻译字幕，还是在这个大模型爆发的时代做语音 Agent，Voxtral Realtime 都能提供接近真人的插话和响应速度。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-08_21.29.43-1024x522.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-08_21.29.43-1024x522.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30319f8f298f4dfe81c245175a3f82f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771162628&amp;x-signature=ZdzGFTF%2FnrQhi4dAOUmH1LZ1IEg%3D" alt="iShot_2026-02-08_21.29.43" loading="lazy"/></a></p>
<p>更重要的是，它并没有为了速度牺牲智商。这个模型拥有约 <strong>40 亿参数（4B）</strong>。对于只想在云端调用的用户，它有 API；但对于那些对数据隐私有洁癖，或者需要在断网环境下工作的企业来说，这简直是福音——因为 Mistral 直接把这个版本的权重开源了（Apache 2.0 协议）。</p>
<p>你可以把它部署在本地服务器、边缘设备甚至是高性能笔记本上。数据不出域，延迟极低，Hugging Face 和 vLLM 框架已经跟进支持。对于金融、医疗这些对隐私敏感的行业，这比什么跑分都管用。</p>
<h3 data-id="heading-1">便宜大碗的生产力工具</h3>
<p>如果你不需要实时交互，只是想把长达 3 小时的会议录音或者播客转成文字，那么 <strong>Voxtral Mini Transcribe V2</strong> 就是为你准备的。</p>
<p>它的定位非常精准：<strong>高精度、超低成本的批量处理</strong>。</p>
<p>Mistral 在这里解决了一个很实际的工程问题——专业术语识别。以往通用的语音模型遇到“苯丙酮尿症”或者公司内部的项目代号时，往往会听译成一堆乱码。Voxtral Mini 支持<strong>上下文偏置（Context Biasing）</strong>，你可以把产品名、人名或专业术语表（最多 100 个）扔给 API，模型在转写时就会“有的放矢”，大幅提升特定领域的准确率。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-08_21.29.48-1024x615.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-08_21.29.48-1024x615.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6298bdc853dc4956a9b36710cc8a092d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771162628&amp;x-signature=jVrvihmUiNcklMTL%2BZ33%2FwRbOW0%3D" alt="iShot_2026-02-08_21.29.48" loading="lazy"/></a></p>
<p>此外，它还自带了<strong>说话人分离</strong>功能。扔进去一段乱糟糟的会议录音，吐出来的不是一整块文字，而是清晰标注了“发言人A”和“发言人B”的对话稿。</p>
<p>价格方面，API 定价仅为 <strong>0.003 美元/分钟</strong>。简单算一笔账，转写一小时的录音只要不到两毛钱人民币，这几乎是在和主流云服务厂商打价格战。</p>
<h3 data-id="heading-2">为什么这次发布很重要？</h3>
<p>如果你仔细看 Mistral 的这波操作，会发现他们非常懂“差异化竞争”。</p>
<p>目前的红海市场里，Google 和 OpenAI 把持着高精度的云端大门。Mistral 没有选择硬碰硬去拼超大模型的云端跑分，而是切入了一个被很多人忽视的盲区：<strong>本地化的高性能部署</strong>。</p>
<p>支持 13 种核心语言（中、英、法、德、日等），能在噪杂的工厂环境下工作，还能在本地设备上跑起来。这不仅仅是一个技术突破，更是一种商业策略的胜利。对于那些受困于 GDPR（通用数据保护条例）或者不想把核心数据传给美国巨头的欧洲及全球企业来说，Mistral 提供了一个无法拒绝的替代方案。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2FiShot_2026-02-08_21.29.52-1024x558.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/iShot_2026-02-08_21.29.52-1024x558.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/919e9918f87f4e9e96aa32527a901e5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771162628&amp;x-signature=4%2FUiYk%2Bm%2B9AqqC7BMucEA2yO8p8%3D" alt="iShot_2026-02-08_21.29.52" loading="lazy"/></a></p>
<p>总结一下，Voxtral Transcribe 2 系列给了开发者两个极其锋利的武器：</p>
<ol>
<li>用 <strong>Realtime</strong> 模型，在本地设备上构建零延迟的语音交互体验。</li>
<li>用 <strong>Mini V2</strong> 模型，以极低的成本清洗海量的音视频数据。</li>
</ol>
<p>2026 年的语音市场，因为这条来自巴黎的“鲶鱼”，终于又变得有趣起来了。对于正在寻找 Whisper 替代品的你，现在大概是时候去 Hugging Face 下载权重试一试了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI全栈实战：使用 Python+LangChain+Vue3 构建一个 LLM 聊天应用]]></title>    <link>https://juejin.cn/post/7603699739223965711</link>    <guid>https://juejin.cn/post/7603699739223965711</guid>    <pubDate>2026-02-08T13:45:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603699739223965711" data-draft-id="7602811649125941299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI全栈实战：使用 Python+LangChain+Vue3 构建一个 LLM 聊天应用"/> <meta itemprop="keywords" content="后端,前端,AIGC"/> <meta itemprop="datePublished" content="2026-02-08T13:45:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cobyte"/> <meta itemprop="url" content="https://juejin.cn/user/668147376989517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI全栈实战：使用 Python+LangChain+Vue3 构建一个 LLM 聊天应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/668147376989517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cobyte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:45:37.000Z" title="Sun Feb 08 2026 13:45:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 引言</h3>
<p>在大语言模型（LLM）快速发展的今天，几乎所有产品都在借助大模型进行重塑与升级。在过去一段时间，各类旨在提升效率的 AI Agent 如雨后春笋般涌现，尤其是 Coding Agent 的兴起，在一定程度上对前端开发者的职业前景带来了冲击与挑战。一些走在行业前沿的公司甚至开始提倡“前后端再度融合”，这意味着未来开发者可能需要向具备 AI 能力的全栈工程师转型。因此，掌握 AI 全栈相关的知识与技能变得非常重要。</p>
<p>本文将带你通过实战，从零开始搭建一个基于 <strong>Python (FastAPI)</strong> 、<strong>LangChain</strong> 和 <strong>Vue 3</strong> 的全栈 LLM 聊天应用程序。另外我们将使用 DeepSeek 作为底层模型进行学习。</p>
<p>技术栈前瞻</p>
<ul>
<li><strong>后端</strong>: Python 3, FastAPI (Web 框架), LangChain (LLM 编排), Uvicorn (ASGI 服务器)</li>
<li><strong>前端</strong>: Vue 3, TypeScript, Vite (构建工具)</li>
<li><strong>模型</strong>: DeepSeek API (兼容 OpenAI 格式)</li>
</ul>
<p>我是 Cobyte，欢迎添加 v：icobyte，学习 AI 全栈。</p>
<h3 data-id="heading-1">2. 为什么选择 Python ?</h3>
<p>在 AI 领域，Python 无疑是首选的开发语言。因此，如果想通过学习 AI 全栈技术来获得一份理想工作，掌握 Python 几乎是必经之路。这就像在国内想从事后端开发，Java 绝对是不二之选。对于前端背景的同学而言，虽然也可以通过 Node.js 入门 AI 开发，但就整体就业前景和发展空间来看，跟 Node.js 相比 Python 的优势也是断层领先。同时，Python 作为一门入门门槛较低的语言，学习起来相对轻松，所以大家无需过于担心学习难度问题。</p>
<p>最后本人提倡在实战中学习 Python，并且完全可以借助 AI 进行辅导学习。</p>
<h3 data-id="heading-2">2. Python 环境配置</h3>
<p>我们这里只提供 Windows 环境的讲解，其他的环境自行 AI，Python 的环境搭建还是十分简单的。</p>
<ol>
<li>访问官网下载安装包</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2F" target="_blank" title="https://www.python.org/downloads/" ref="nofollow noopener noreferrer">www.python.org/downloads/</a></p>
<p>选择对应的平台版本：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3990a9a5078a4b93b1283f11ec8748bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=0TbvuA4AdQP4Xh0sGT%2Bjy7TsHcw%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>安装时勾选 "Add Python to PATH"</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37440f50429f467f9a3ba8ecc9bca8e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=MfdlBIbNLJYBsIxJDHV6Ga3UPzs%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>验证安装</li>
</ol>
<p>打开终端命令工具输入以下命令行：</p>
<pre><code class="hljs language-css" lang="css">python <span class="hljs-attr">--version</span>
pip <span class="hljs-attr">--version</span>
</code></pre>
<p>出现如下信息则说明安装成功了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/759c6974660f4deab0847079d45164f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=tpMdF%2BB%2BVz2P2JmzA%2FRnAtiCrDM%3D" alt="image.png" loading="lazy"/></p>
<p>最后编辑器我们可以选择 VS Code，只需在拓展中安装以下插件即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2e39c4bbed245adad700731fe6dab04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=IJYiGOPxs%2BecSrQi88qT9Pf7Y0o%3D" alt="image.png" loading="lazy"/></p>
<p>我们前面说到了我们是使用 DeepSeek 作为底层模型进行学习，所以我们需要去 DeepSeek 的 API 开放平台申请一个大模型的 API key。申请地址如下：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.deepseek.com%2Fapi_keys" target="_blank" title="https://platform.deepseek.com/api_keys" ref="nofollow noopener noreferrer">platform.deepseek.com/api_keys</a> 。当然我们需要充一点钱，就充几块也够我们学习用了。</p>
<h3 data-id="heading-3">3. Python 快速入门</h3>
<h4 data-id="heading-4">3.1 Hello World</h4>
<p>我们创建一个 <code>simple-llm-app</code> 的项目目录，然后在根目录创建一个 <code>.env</code> 文件，用于存放项目的<strong>环境变量配置</strong>，跟前端的项目一样。我们这里设置上面申请到的 DeepSeek 开放平台的 API key。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">DEEPSEEK_API_KEY</span>=sk-xxxxxx
</code></pre>
<p>然后我们可以通过 python-dotenv 库读从 <code>.env</code> 文件中读取它，我们创建一个 test.py 的文件，里面的代码如下：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-comment"># 加载环境变量 (读取 .env 中的 DEEPSEEK_API_KEY)</span>
load_dotenv()
<span class="hljs-comment"># 打印</span>
<span class="hljs-built_in">print</span>(os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>))
</code></pre>
<p>其中 <code>dotenv</code> 库需要安装 python-dotenv 依赖，安装方法也跟安装 npm 包类似，命令如下：</p>
<pre><code class="hljs">pip install python-dotenv
</code></pre>
<p>接着执行 test.py 文件，执行命令跟 Node.js 类似：</p>
<pre><code class="hljs">python test.py
</code></pre>
<p>我们就可以在命令终端看到 <code>.env</code> 文件中的  DeepSeek API key 了。这算是成功输出了 Python 的 Hello world。</p>
<h4 data-id="heading-5">3.2 Python 语法入门</h4>
<p>接着我们继续了解 Python 的相关语法。在 Python 中，使用 <code>from ... import ...</code>，在 ES6 JavaScript 中，我们使用 <code>import ... from ...</code>。
所以上述代码的 <code>import os</code> -&gt; 类似于 Node.js 中的 <code>import * as os from 'os'</code>， <code>os</code> 是一个内置库。
<code>from dotenv import load_dotenv</code> 则类似于从 npm 包中导入一个类，比如： <code>import load_dotenv from 'dotenv'</code> 。</p>
<p>Python：没有显式的变量声明关键字，直接通过赋值创建变量。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># Python - 直接赋值，无需关键字</span>
name = <span class="hljs-string">"张三"</span>
AGE = <span class="hljs-number">25</span> <span class="hljs-comment"># 常量（约定）没有内置的常量类型，但通常用全大写变量名表示常量，实际上可以修改</span>
is_student = <span class="hljs-literal">True</span>
</code></pre>
<p>JavaScript：使用 <code>var</code>、<code>let</code> 或 <code>const</code> 声明变量。</p>
<pre><code class="hljs language-ini" lang="ini">// JavaScript - 必须使用关键字
let <span class="hljs-attr">name</span> = <span class="hljs-string">"张三"</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">age</span> = <span class="hljs-number">25</span><span class="hljs-comment">;  // 常量 使用 `const` 声明常量，不可重新赋值。</span>
var <span class="hljs-attr">isStudent</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;  // 旧方式</span>
</code></pre>
<p>注释对比</p>
<p>Python注释：</p>
<ul>
<li>单行注释：以 # 开头</li>
</ul>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 这是一个Python单行注释</span>
name = <span class="hljs-string">"张三"</span>  <span class="hljs-comment"># 这是行尾注释</span>
</code></pre>
<ul>
<li>多行注释：可以使用三个单引号 ''' 或三个双引号 """ 包裹</li>
</ul>
<pre><code class="hljs language-py" lang="py"><span class="hljs-string">'''
这是一个Python多行注释
可以跨越多行
实际上这是字符串，但常用作注释
'''</span>

<span class="hljs-string">"""
双引号三引号也可以
这在Python中通常用作文档字符串（docstring）
"""</span>
</code></pre>
<p>JavaScript 注释：</p>
<ul>
<li>单行注释：以 <code>//</code> 开头</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 这是一个JavaScript单行注释</span>
<span class="hljs-keyword">let</span> name = <span class="hljs-string">"张三"</span>;  <span class="hljs-comment">// 这是行尾注释</span>
</code></pre>
<ul>
<li>多行注释：以 <code>/*</code> 开头，以 <code>*/</code> 结尾</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/*
 这是一个JavaScript多行注释
 可以跨越多行
 这是真正的注释语法
*/</span>


<span class="hljs-comment">/**
 * 用户类，表示系统中的一个用户
 * <span class="hljs-doctag">@class</span>
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
}
</code></pre>
<p>好了我们不贪杯，实战中遇到不同的 Python 语法，我们再针对学习或者借助 AI 通过与 JavaScript 语法进行横向对比，对于有一定编程基础的我们，肯定非常容易理解的。相信通过上述 Python 语法的学习，聪明的你再回头看上述示例的 Python 代码，肯定可以看懂了。</p>
<p>我们这里只是简单介绍上面代码中涉及到的 Python 语法，本人推荐在实战中进行学习。更多 JavaScript 视觉学习 Python：<a href="https://link.juejin.cn?target=https%3A%2F%2Flangshift.dev%2Fzh-cn%2Fdocs%2Fjs2py" target="_blank" title="https://langshift.dev/zh-cn/docs/js2py" ref="nofollow noopener noreferrer">langshift.dev/zh-cn/docs/…</a></p>
<h4 data-id="heading-6">3.3 FastAPI 框架快速入门</h4>
<h5 data-id="heading-7">3.3.1 FastAPI 是什么</h5>
<p>FastAPI 是一个现代、高性能（与 NodeJS 和 Go 相当）的 Web 框架，用于构建 API，基于 Python 3.6+ 并使用了标准的 Python 类型提示。但它本身不提供完整的 Web 服务器功能，而是通过 ASGI（Asynchronous Server Gateway Interface）与服务器进行通信。</p>
<p>Uvicorn 是一个高性能的 ASGI 服务器，它支持异步编程，能够运行 FastAPI 这样的异步 Web 应用。所以 FastAPI 需要配合 Uvicorn 使用，这样才能够充分发挥 FastAPI 的异步特性，提供极高的性能。同时，Uvicorn 在开发和部署时都非常方便。</p>
<p><strong>简单来说</strong>：</p>
<ul>
<li><strong>FastAPI</strong> 负责：路由、验证、序列化、依赖注入等应用逻辑</li>
<li><strong>Uvicorn</strong> 负责：HTTP 协议解析、并发处理、连接管理等服务器功能</li>
</ul>
<p>两者结合形成了现代 Python Web 开发的黄金组合，既能享受 Python 的便捷，又能获得接近 Go、Node.js 的性能。</p>
<h5 data-id="heading-8">3.3.2 基本示例</h5>
<p>我们创建一个 server.py 文件，输入以下示例代码：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI

app = FastAPI()

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">read_root</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"我是 Cobyte，欢迎添加 v：icobyte，学习 AI 全栈。"</span>}

<span class="hljs-comment"># 程序的入口点</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
    uvicorn.run(app, host=<span class="hljs-string">"127.1.1.1"</span>, port=<span class="hljs-number">9527</span>)
</code></pre>
<p>上述代码引用了两个依赖 fastapi 和 uvicorn，我们通过 pip 进行安装一下：</p>
<pre><code class="hljs">pip install fastapi uvicorn
</code></pre>
<p>然后我们在终端启动服务：python server.py，运行结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3a0cf509f3f40e9a61f9cd2bd2059c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=BTUSz8kpwmWS%2FnP2TX3Z55%2F%2B0sE%3D" alt="image.png" loading="lazy"/></p>
<p>接着我们在浏览器打开 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.1.1.1%3A9527" target="_blank" title="http://127.1.1.1:9527" ref="nofollow noopener noreferrer">http://127.1.1.1:9527</a> 显示如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d28c10ffe034455b9960853ce7813fed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=xsFo0N2guBGTjxWTk%2BgFIWNC%2BpM%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-9">3.3.3 路径参数和查询参数</h5>
<p>示例：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/items/{id}"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item</span>(<span class="hljs-params">
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>, 
    limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span>,         <span class="hljs-comment"># 默认值</span>
    q: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>, <span class="hljs-comment"># 可选参数</span>
    short: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,     <span class="hljs-comment"># 默认值</span>
    tags: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = []     <span class="hljs-comment"># 列表参数</span>
</span>):
    item = {<span class="hljs-string">"id"</span>: <span class="hljs-built_in">id</span>, <span class="hljs-string">"limit"</span>: limit, <span class="hljs-string">"tags"</span>: tags}
    <span class="hljs-keyword">if</span> q:
        item.update({<span class="hljs-string">"q"</span>: q})
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> short:
        item.update({<span class="hljs-string">"desc"</span>: <span class="hljs-string">"长说明"</span>})
    <span class="hljs-keyword">return</span> item
</code></pre>
<p>重启服务，在浏览器输入：<a href="https://link.juejin.cn?target=http%3A%2F%2F127.1.1.1%3A9527%2Fitems%2F1%3Fq%3Dcobyte" target="_blank" title="http://127.1.1.1:9527/items/1?q=cobyte" ref="nofollow noopener noreferrer">http://127.1.1.1:9527/items/1?q=cobyte</a> ，结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6edc7a194e0640fb816147aafd66c95c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=%2F5glNtJL30pj%2BQVYf6G%2FVjzrSKQ%3D" alt="image.png" loading="lazy"/></p>
<p>总结</p>
<ul>
<li>路径参数：在路径中声明的参数，如 <code>id</code>。</li>
<li>查询参数：作为函数参数，但不是路径参数，将自动解释为查询参数。</li>
</ul>
<h5 data-id="heading-10">3.3.4 FastAPI 中的模型定义</h5>
<p>在 FastAPI 中，我们经常需要处理来自客户端的请求数据，例如 POST 请求的 JSON 体。为了确保数据的正确性，我们需要验证数据是否符合预期的格式和类型。使用 Pydantic 模型可以让我们以一种声明式的方式定义数据的结构，并自动进行验证。</p>
<p>Pydantic 是一个 Python 库，用于数据验证和设置管理，主要基于 Python 类型提示（type hints）。它可以在运行时提供类型检查，并且当数据无效时提供详细的错误信息。</p>
<p>Pydantic 的核心功能是定义数据的结构（模型），并自动验证传入的数据是否符合这个结构。它非常适用于以下场景：</p>
<ul>
<li>验证用户输入（例如 API 请求的数据）</li>
<li>配置管理</li>
<li>数据序列化和反序列化（例如将 JSON 数据转换为 Python 对象）</li>
</ul>
<p>Pydantic 模型使用 Python 的类来定义，类的属性使用类型注解来指定类型，并且可以设置默认值。</p>
<p>请求体（Request Body）和响应模型（Response Model）的示例如：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, validator, Field
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span>
<span class="hljs-keyword">import</span> re

<span class="hljs-comment"># 请求体（Request Body）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRequest</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    username: <span class="hljs-built_in">str</span> = Field(..., min_length=<span class="hljs-number">3</span>, max_length=<span class="hljs-number">50</span>)
    password: <span class="hljs-built_in">str</span>
    email: <span class="hljs-built_in">str</span>
<span class="hljs-meta">    @validator(<span class="hljs-params"><span class="hljs-string">'username'</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">username_alphanumeric</span>(<span class="hljs-params">cls, v</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">'^[a-zA-Z0-9_]+$'</span>, v):
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'只能包含字母、数字和下划线'</span>)
        <span class="hljs-keyword">return</span> v
    
<span class="hljs-meta">    @validator(<span class="hljs-params"><span class="hljs-string">'email'</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">email_valid</span>(<span class="hljs-params">cls, v</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-string">'@'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> v:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'无效的邮箱地址'</span>)
        <span class="hljs-keyword">return</span> v.lower()  <span class="hljs-comment"># 转换为小写</span>
    
<span class="hljs-meta">    @validator(<span class="hljs-params"><span class="hljs-string">'password'</span></span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">password_strong</span>(<span class="hljs-params">cls, v</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(v) &lt; <span class="hljs-number">6</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">'密码至少6位'</span>)
        <span class="hljs-keyword">return</span> v
<span class="hljs-comment"># 响应模型（Response Model）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserResponse</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    username: <span class="hljs-built_in">str</span>
    email: <span class="hljs-built_in">str</span>

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/user/"</span>, response_model=UserResponse</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserRequest</span>):
    <span class="hljs-comment"># 密码会被过滤，不会出现在响应中</span>
    <span class="hljs-keyword">return</span> user
</code></pre>
<p>FastAPI 会自动从 Pydantic 模型生成 API 文档，我们在 server.py 文件中添加了上述示例之后，重启服务，访问 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.1.1.1%3A9527%2Fdocs" target="_blank" title="http://127.1.1.1:9527/docs" ref="nofollow noopener noreferrer">http://127.1.1.1:9527/docs</a> 可以看到：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba91628cb956434d80923be36bb8b793~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=EKjKnSHGRldc6a3kmVX7Ibb1yLA%3D" alt="image.png" loading="lazy"/></p>
<p>并且我们还可以在文档地址中进行测试，这里就不展开讲了。</p>
<h5 data-id="heading-11">3.3.5 异步和中间件</h5>
<p>示例：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Request

<span class="hljs-meta">@app.middleware(<span class="hljs-params"><span class="hljs-string">"http"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_process_time_header</span>(<span class="hljs-params">request: Request, call_next</span>):
    response = <span class="hljs-keyword">await</span> call_next(request)
    response.headers[<span class="hljs-string">"X-Process-Time"</span>] = <span class="hljs-built_in">str</span>(process_time)
    <span class="hljs-keyword">return</span> response
</code></pre>
<p>我们可以看到 Python 的这个异步语法跟 JavaScript 的 async/await 是一样的语法。</p>
<h5 data-id="heading-12">3.3.6 CORS 配置</h5>
<p>通过设置 CORS 配置允许前端跨域访问。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-comment"># CORS 配置：允许前端跨域访问</span>
app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],  <span class="hljs-comment"># 在生产环境中建议设置为具体的前端域名</span>
    allow_credentials=<span class="hljs-literal">True</span>,
    allow_methods=[<span class="hljs-string">"*"</span>],  <span class="hljs-comment"># 允许的方法</span>
    allow_headers=[<span class="hljs-string">"*"</span>],  <span class="hljs-comment"># 允许的头部</span>
)
</code></pre>
<p>到此本文所用到的 FastAPI 知识就基本介绍完毕了，后续再在实战中进行学习，先上了 AI 全栈的车再说。</p>
<h3 data-id="heading-13">4. LLM 和 OpenAI 接口快速入门</h3>
<h4 data-id="heading-14">4.1 入门示例代码</h4>
<p>让我们从安装依赖开始，借助 DeepSeek 大模型一起探索 OpenAI 接口规范。</p>
<pre><code class="hljs">pip install openai
</code></pre>
<p>接着我们在 test.py 中添加如下代码：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-comment"># 加载环境变量 (读取 .env 中的 DEEPSEEK_API_KEY)</span>
load_dotenv()
<span class="hljs-comment"># 加载 OpenAI 库，从这里也可以看到 Python 的库加载顺序跟 JavaScript ES6 import 是不一样，反而有点像 requrie</span>
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># 初始化客户端</span>
client = OpenAI(
    api_key=os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>), <span class="hljs-comment"># 身份验证凭证，确保你有权访问 API</span>
    base_url=<span class="hljs-string">"https://api.deepseek.com"</span> <span class="hljs-comment"># 将请求重定向到 DeepSeek 的服务器（而非 OpenAI）</span>
)
<span class="hljs-comment"># 构建聊天请求</span>
response = client.chat.completions.create(
  model=<span class="hljs-string">"deepseek-chat"</span>, <span class="hljs-comment"># 指定模型版本</span>
  temperature=<span class="hljs-number">0.5</span>,
  messages=[   <span class="hljs-comment"># 对话消息数组</span>
      {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是谁？"</span>}
  ]
)
<span class="hljs-comment"># 打印结果</span>
<span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].message.content.strip())
</code></pre>
<p>终端输出结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e9dd9783494eca96f1e30a8106fbbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=CBhsJj4xet4ab7MhlYvfK9%2F120A%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到我们成功调用了 DeepSeek 大模型。</p>
<p>在 <code>openai</code> 中，返回的 <code>response</code> 对象是一个 Pydantic 模型，如果我们想详细查看 response 返回的结果，可以使用它自带的 <code>.model_dump_json()</code> 方法。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 使用 model_dump_json 并指定缩进</span>
<span class="hljs-built_in">print</span>(response.model_dump_json(indent=<span class="hljs-number">2</span>))
</code></pre>
<p>可以看到通过上述方式打印大模型响应的信息如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a073fb64131642b1ae07c71e38358675~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=w0GB%2FHBb2yE3J9I8h%2BYK9zCQQt0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-15">4.2 <code>choices</code> 字段详解</h4>
<p>我们从上面打印的结果可以了知道，大模型返回的文本信息是存储在 <code>choices</code> 字段中的，所以我们来了解一下它。</p>
<p>在调用 chat.completions.create 时，如果设置了 n 参数（n&gt;1），那么模型会生成多个输出，此时 <code>choices</code> 字段就会包含多个元素。每个 choice 代表一个可能的响应，我们可以通过遍历 choices 来获取所有响应。</p>
<p>另外，即使 n=1（默认值），choices 也是一个列表，只不过只包含一个元素。所以我们上述例子中才通过 <code>response.choices[0]</code> 来获取大模型的返回结果。</p>
<h4 data-id="heading-16">4.3 流式响应</h4>
<p>因为大模型本质上是一个预测生成器，简单来说就是你输入一句话，大模型就预测下一个字。因此我们希望在模型生成文本的同时就显示给用户，提高交互的实时性。这就是<strong>流式响应</strong>。代码设置如下：</p>
<pre><code class="hljs language-diff" lang="diff"># 构建聊天请求
response = client.chat.completions.create(
  model="deepseek-chat", # 指定模型版本
  temperature=0.5,
  messages=[   # 对话消息数组
      {"role": "user", "content": "你是谁？"}
  ],
<span class="hljs-addition">+  stream=True, # 启用流式传输</span>
)

<span class="hljs-addition">+# response是一个生成器，在Python中，生成器是一种迭代器，每次迭代返回一个值。这里，每次迭代返回一个chunk（部分响应）。</span>
<span class="hljs-addition">+for chunk in response:                           # 1. 遍历响应流</span>
<span class="hljs-addition">+    if chunk.choices[0].delta.content:           # 2. 检查是否有内容</span>
<span class="hljs-addition">+        print(chunk.choices[0].delta.content,    # 3. 打印内容</span>
<span class="hljs-addition">+              end="",                            # 4. 不换行</span>
<span class="hljs-addition">+              flush=True)                        # 5. 立即刷新缓冲区</span>
</code></pre>
<p>输出结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe84124b9d3c4b93bfc6b8ef6a4c04a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=mdWiqULETuG%2B4JMkhRuT85gtRN8%3D" alt="20260207-132313.gif" loading="lazy"/></p>
<h4 data-id="heading-17">4.4 <strong>temperature 参数</strong></h4>
<p>我个人觉得那么多大模型参数中 temperature 参数还是比较重要的，值得我们了解一下。模型在生成每一个词时，都会计算一个所有可能的下一个词的概率分布（例如，“苹果”概率0.3，“香蕉”概率0.5，“水果”概率0.2）。temperature 的值会影响这个概率分布的形状，从而改变模型最终根据这个分布进行“抽样”选择的结果。</p>
<p>一个简单的比喻：选餐厅吃饭</p>
<ul>
<li><strong>Temperature = 0.0</strong>：<strong>永远只去评分最高、去过无数次的那一家最保险的餐厅</strong>。结果最稳定，但永远没有新体验。</li>
<li><strong>Temperature = 1.0</strong>：<strong>大多数时候去那家最好的，但偶尔也会根据评价试试附近其他不错的餐厅</strong>。平衡了可靠性和新鲜感。</li>
<li><strong>Temperature = 1.5</strong>：<strong>经常尝试新餐厅，甚至包括一些评价奇特或小众的地方</strong>。体验非常丰富，但有时会“踩雷”。</li>
</ul>
<p>总结与建议</p>
<ol>
<li><strong>追求确定性时调低 (接近0)</strong> ：当你需要<strong>精确、可靠、可复现</strong>的结果时，如生成代码、数学推导、事实问答、指令严格遵循。</li>
<li><strong>追求创造性和多样性时调高 (&gt;1.0)</strong> ：当你需要<strong>创意、多样化表达、故事生成、诗歌</strong>时。</li>
<li><strong>通用场景用中间值 (0.8-1.2)</strong> ：大多数对话、摘要、分析等任务，这个范围能提供既连贯又有一定灵活性的输出。</li>
</ol>
<h4 data-id="heading-18">4.5 消息角色</h4>
<p>在 OpenAI API 中，<code>messages</code> 数组中的每条消息都有一个 <code>role</code> 字段，它定义了消息的来源和用途。消息角色主要有三种：system、user、assistant。此外，在后续的更新中，还引入了 tool 和 function 等角色，但最基础的是前三种。</p>
<p>1. <strong>system</strong> (系统)</p>
<ul>
<li>
<p><strong>作用</strong>: 设置助手的背景、行为、指令等。</p>
</li>
<li>
<p><strong>特点</strong>:</p>
<ul>
<li>通常作为第一条消息，用于设定对话的上下文和规则。</li>
<li>不是必须的，但可以显著影响助手的行为。</li>
</ul>
</li>
<li>
<p><strong>示例</strong>:</p>
<pre><code class="hljs language-py" lang="py">{<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个专业的翻译助手，只能将中文翻译成英文，其他问题一律不回答。"</span>}
</code></pre>
</li>
</ul>
<p>2. <strong>user</strong> (用户)</p>
<ul>
<li>
<p><strong>作用</strong>: 用户输入的问题或指令</p>
</li>
<li>
<p><strong>特点</strong>:</p>
<ul>
<li>代表对话中的人类用户</li>
<li>每个请求必须至少包含一条 user 消息</li>
<li>通常是最后一条消息（除了流式响应）</li>
</ul>
</li>
<li>
<p><strong>示例</strong>:</p>
<pre><code class="hljs language-py" lang="py">messages = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个有帮助的助手"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"什么是机器学习？"</span>}
]
</code></pre>
</li>
</ul>
<p>3. <strong>assistant</strong> (助手)</p>
<ul>
<li>
<p><strong>作用</strong>: 代表助手之前的回复。</p>
</li>
<li>
<p><strong>特点</strong>:</p>
<ul>
<li>在多轮对话中保存历史回复</li>
<li>帮助模型保持对话连贯性</li>
<li>在单轮对话中不需要此角色</li>
</ul>
</li>
<li>
<p><strong>示例</strong>:</p>
<pre><code class="hljs language-py" lang="py">messages = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个数学老师"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"2+2等于多少？"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"2+2等于4"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"那3+3呢？"</span>}  <span class="hljs-comment"># 模型知道这是新问题</span>
]
</code></pre>
</li>
</ul>
<p>通过合理组合这些角色，你可以构建从简单问答到复杂多轮对话的各种应用场景。记住：清晰的角色定义和恰当的消息组织是获得高质量回复的基础。我们这里先介绍前三种核心角色。</p>
<h3 data-id="heading-19">5. LangChain 入门</h3>
<h4 data-id="heading-20">5.1 怎么理解 LangChain 框架</h4>
<p>从前端的视角来理解，LangChain 就好比是 Vue 或 React 这类框架。在前端开发中，如果没有 Vue 或 React，我们就需要直接编写大量操作浏览器 API 的底层代码；而有了这类框架，它们封装了常见的交互逻辑和状态管理，让开发变得更高效、更结构化。类似地，LangChain 实际上是一套封装了大型语言模型常见操作模式的方案，它帮助开发者更便捷地调用、组合与管理大模型的能力，而无需每次都从头编写复杂的模型交互代码。</p>
<h4 data-id="heading-21">5.2 LangChain 调用 LLM 示例</h4>
<p>接着我们在项目根目录下创建一个 <code>llm-app.py</code> 文件，输入以下内容：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

<span class="hljs-comment"># 1. 加载环境变量 (读取 .env 中的 DEEPSEEK_API_KEY)</span>
load_dotenv()

<span class="hljs-comment"># 2. 创建组件</span>
<span class="hljs-comment"># 相对于上面的使用 OpenAI 的接口，现在经过 LangChain 封装后确实简洁了很多</span>
llm = ChatOpenAI(
    model=<span class="hljs-string">"deepseek-chat"</span>, 
    temperature=<span class="hljs-number">0.7</span>,
    api_key=os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>),
    base_url=<span class="hljs-string">"https://api.deepseek.com/v1"</span>
)

<span class="hljs-comment"># 创建了一个人类角色的提示模板，`from_template` 方法允许我们通过一个字符串模板来定义提示，默认是人类角色。</span>
prompt = ChatPromptTemplate.from_template(<span class="hljs-string">"{question}"</span>)

<span class="hljs-comment"># 创建解析器</span>
parser = StrOutputParser()
<span class="hljs-comment"># 将AI响应转换为字符串，通过前面的知识我们知道大模型返回的数据一般包含很多数据，</span>
<span class="hljs-comment"># 很多时候我们只需要其中的文本内容。`StrOutputParser` 就是用来提取这个文本内容的</span>

<span class="hljs-comment"># 3. 组合链 (LCEL 语法) Python LangChain 常见的链式调用</span>
chain = prompt | llm | parser
<span class="hljs-comment"># 等价于：输入 → 模板填充 → AI处理 → 结果解析</span>

<span class="hljs-comment"># 4. 执行</span>
result = chain.invoke({<span class="hljs-string">"question"</span>: <span class="hljs-string">"你是谁？"</span>})
<span class="hljs-comment"># 内部执行：填充"你是谁？" → 调用API → 解析响应 → 返回字符串</span>

<span class="hljs-comment"># 5. 打印结果</span>
<span class="hljs-built_in">print</span>(result)
</code></pre>
<p>然后在终端安装对应的依赖（这个步骤跟前端也很像，所以学习 Python 是很简单的）：</p>
<pre><code class="hljs">pip install langchain_openai langchain_core dotenv
</code></pre>
<p>接着在终端执行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 跟前端的 node llm-app.js 等价</span>
python llm-app.py
</code></pre>
<p>终端输出结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e9dd9783494eca96f1e30a8106fbbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=CBhsJj4xet4ab7MhlYvfK9%2F120A%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到我们成功执行了一个 Python + LangChain 的应用程序。</p>
<h4 data-id="heading-22">5.2 消息模板系统</h4>
<p>我们上面的注释讲解了 <code>prompt = ChatPromptTemplate.from_template("{question}")</code> 这句代码默认创建了一个人类角色的提示模板，也就是 <code>{"role": "user", "content": "用户输入的内容"}</code>。</p>
<p>LangChain 作为一个强大的 LLM 应用开发框架, 为了让开发者能够精确控制对话的流程和结构，提供了灵活且强大的消息模板系统。LangChain 的消息模板系统基于角色（role）的概念，将对话分解为不同类型的信息单元。目前的类型如下：</p>















































<table><thead><tr><th>类</th><th>角色</th><th>用途</th><th>对应 OpenAI 角色</th></tr></thead><tbody><tr><td><code>SystemMessagePromptTemplate</code></td><td>system</td><td>系统指令、设定</td><td><code>system</code></td></tr><tr><td><code>HumanMessagePromptTemplate</code></td><td>human</td><td>用户输入</td><td><code>user</code></td></tr><tr><td><code>AssistantMessagePromptTemplate</code></td><td>assistant</td><td>AI 回复</td><td><code>assistant</code></td></tr><tr><td><code>AIMessagePromptTemplate</code></td><td>ai</td><td>AI 回复（别名）</td><td><code>assistant</code></td></tr><tr><td><code>ToolMessagePromptTemplate</code></td><td>tool</td><td>工具调用结果</td><td><code>tool</code></td></tr><tr><td><code>FunctionMessagePromptTemplate</code></td><td>function</td><td>函数调用结果</td><td><code>function</code></td></tr></tbody></table>
<p><strong>ChatPromptTemplate</strong> 则是消息系统的核心容器，负责协调各种消息类型：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> (
    SystemMessagePromptTemplate,
    HumanMessagePromptTemplate,
    AssistantMessagePromptTemplate
)
system = SystemMessagePromptTemplate.from_template(...)
human = HumanMessagePromptTemplate.from_template(...)
assistant = AssistantMessagePromptTemplate.from_template(...)
prompt = ChatPromptTemplate.from_messages([system, human, assistant])
</code></pre>
<p>所以上述入门实例代码可以进行以下修改：</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-from langchain_core.prompts import ChatPromptTemplate</span>
<span class="hljs-addition">+from langchain_core.prompts import ChatPromptTemplate,HumanMessagePromptTemplate</span>
# 省略...
<span class="hljs-deletion">-# 创建了一个人类角色的提示模板，`from_template` 方法允许我们通过一个字符串模板来定义提示，默认是人类角色。</span>
<span class="hljs-deletion">-prompt = ChatPromptTemplate.from_template("{question}")</span>
<span class="hljs-addition">+human = HumanMessagePromptTemplate.from_template("{question}")</span>
<span class="hljs-addition">+prompt = ChatPromptTemplate.from_messages([human])</span>
# 省略...
</code></pre>
<p>然后重新在终端执行 <code>python llm-app.py</code> 依然正常输出。</p>
<p>同时通过 LangChain 消息模型来理解大模型的调用过程也变得十分的清晰，所以整个流程是：</p>
<pre><code class="hljs language-json" lang="json">输入 → prompt → llm → parser → 输出
     ↓
<span class="hljs-punctuation">{</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你是谁？"</span><span class="hljs-punctuation">}</span>
     ↓
prompt 处理：创建消息 <span class="hljs-string">"你是谁？"</span>
     ↓
llm 处理：调用 LLM 处理，返回 AIMessage 对象
     ↓
parser 处理：提取文本内容
     ↓
最终结果字符串
</code></pre>
<p>在 LangChain 中还有一个最基础的模板类 <strong>PromptTemplate</strong> 用于构建字符串提示。下面我们也来了解一下它的基本用法。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate

<span class="hljs-comment"># 方式1：使用 from_template 类方法（最常用）</span>
prompt = PromptTemplate.from_template(<span class="hljs-string">"请解释什么是{concept}。"</span>)

<span class="hljs-comment"># 方式2：直接实例化</span>
prompt = PromptTemplate(
    input_variables=[<span class="hljs-string">"concept"</span>], 
    template=<span class="hljs-string">"请解释什么是{concept}。"</span>
)
</code></pre>
<p>综上所述我们通过理解和掌握 LangChain 这些核心概念，才能高效地构建可靠、可维护的 LLM 应用。此外，LangChain 的消息模板系统仍在不断发展当中，我们需要不断地持续关注。</p>
<h4 data-id="heading-23">5.3 LangChain 链式调用（管道操作符）</h4>
<p>在 LangChain 中所谓的链式调用是通过管道操作符 <code>|</code> 来实现的，也就是通过 <code>|</code> 实现将一个函数的输出作为下一个函数的输入。</p>
<p>例如上述的示例代码中的：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># LangChain 中的管道操作</span>
chain = prompt | llm | output_parser
</code></pre>
<ul>
<li>等价于手动执行链的每一步：</li>
</ul>
<pre><code class="hljs language-py" lang="py"><span class="hljs-comment"># 第一步：prompt 处理</span>
messages = prompt.invoke({<span class="hljs-string">"question"</span>: <span class="hljs-string">"你是谁？"</span>})
<span class="hljs-comment"># messages = [HumanMessage(content="你是谁？")]</span>

<span class="hljs-comment"># 第二步：llm 处理</span>
response = llm.invoke(messages)
<span class="hljs-comment"># response = AIMessage(content="我是DeepSeek...")</span>

<span class="hljs-comment"># 第三步：parser 处理</span>
result = parser.invoke(response)
<span class="hljs-comment"># result = "我是DeepSeek..."</span>
</code></pre>
<p>在标准 Python 语法中，<code>|</code> 是<strong>按位或操作符</strong>，用于：</p>
<ul>
<li>整数的按位运算：<code>5 | 3 = 7</code></li>
<li>集合的并集运算：<code>{1, 2} | {2, 3} = {1, 2, 3}</code></li>
<li>从 Python 3.10 开始，用于类型联合：<code>int | str</code></li>
</ul>
<p>但 LangChain 通过 <strong>重载（overload）</strong>  <code>|</code> 操作符，赋予了它新的含义：</p>
<ul>
<li><code>|</code> 在 LangChain 中是一种<strong>语法糖</strong>，让链式操作更直观</li>
<li>它不是 Python 的新语法，而是通过操作符重载实现的框架特定功能</li>
<li>这种设计让 LangChain 的代码更加简洁和易读</li>
</ul>
<h3 data-id="heading-24">6. LLM 聊天应用后端</h3>
<h4 data-id="heading-25">6.1 后端架构设计</h4>
<p>我们遵循单一职责原则（SRP）进行分层架构设计，将系统划分为API层、业务层和数据层，旨在实现高内聚、低耦合，提升代码的可维护性、可测试性和可扩展性。</p>
<p><strong>API层</strong>  专注于处理 HTTP 协议相关的逻辑，包括路由定义、请求验证、响应序列化和跨域处理等。它作为系统的入口点，负责与客户端进行通信，并将业务逻辑委托给下层。这种设计使得我们可以独立地调整 API 暴露方式（如支持 WebSocket）而不影响核心业务逻辑。</p>
<p><strong>业务层</strong>  封装 LLM 的核心应用逻辑，例如与 AI 模型的交互、对话历史管理和流式生成等。这一层独立于 Web 框架，使得业务逻辑可以复用于其他场景（如命令行界面或批处理任务）。同时，业务层的单一职责确保了我们能够针对 LLM 交互进行优化和测试，而无需关心 HTTP 细节。</p>
<p><strong>数据层</strong>  通过 Pydantic 定义系统的数据模型，包括请求、响应结构和内部数据传输对象。通过集中管理数据模型，我们确保了数据格式的一致性，并便于进行数据验证和类型提示。这种分离使得数据结构的变更更加可控，同时也为生成 API 文档提供了便利。</p>
<h4 data-id="heading-26">6.1 实现业务层和数据层</h4>
<p>实现业务层其实就是封装 LLM 的核心应用逻辑。通过将复杂的 LLM 调用逻辑、提示工程和流式处理封装在独立的类中，这样 API 层只需关注请求与响应，而无需了解 LangChain 或特定 API 的细节。这使得底层技术栈的迭代或更换（例如从 LangChain 切换到其他操作大模型的框架或更改 LangChain 最新的 API）变得轻而易举，只需修改封装类内部实现，而对外接口保持不变，实现了有效隔离。</p>
<p>创建 <code>./backend/llm_app.py</code> 文件，内容如下：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Generator
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser

<span class="hljs-comment"># 加载环境变量</span>
load_dotenv()

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LLMApp</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name=<span class="hljs-string">"deepseek-chat"</span>, temperature=<span class="hljs-number">0.7</span></span>):
        <span class="hljs-string">"""
        初始化 LLM 应用程序
        """</span>
        <span class="hljs-comment"># 检查 DeepSeek API 密钥</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>):
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"请在 .env 文件中设置 DEEPSEEK_API_KEY 环境变量"</span>)
        
        <span class="hljs-comment"># 初始化配置</span>
        self.model_name = model_name
        self.temperature = temperature
        self.api_key = os.getenv(<span class="hljs-string">"DEEPSEEK_API_KEY"</span>)
        self.base_url = <span class="hljs-string">"https://api.deepseek.com/v1"</span>
        
        <span class="hljs-comment"># 初始化非流式 LLM (用于普通任务)</span>
        self.llm = self._create_llm(streaming=<span class="hljs-literal">False</span>)
        
        <span class="hljs-comment"># 初始化流式 LLM (用于流式对话)</span>
        self.streaming_llm = self._create_llm(streaming=<span class="hljs-literal">True</span>)
        
        <span class="hljs-comment"># 输出解析器</span>
        self.output_parser = StrOutputParser()
        
        <span class="hljs-comment"># 初始化对话链</span>
        self._setup_chains()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_create_llm</span>(<span class="hljs-params">self, streaming: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
        <span class="hljs-string">"""创建 LLM 实例"""</span>
        <span class="hljs-keyword">return</span> ChatOpenAI(
            model_name=self.model_name,
            temperature=self.temperature,
            api_key=self.api_key,
            base_url=self.base_url,
            streaming=streaming
        )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_setup_chains</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""设置处理链"""</span>
        <span class="hljs-comment"># 带上下文的对话 Prompt</span>
        conversation_prompt = PromptTemplate(
            input_variables=[<span class="hljs-string">"chat_history"</span>, <span class="hljs-string">"user_input"</span>],
            template=<span class="hljs-string">"""你是一个有用的 AI 助手。请根据对话历史回答用户的问题。
            
            对话历史：
            {chat_history}
            
            用户：{user_input}
            助手："""</span>
        )
        <span class="hljs-comment"># 注意：这里我们只定义 prompt，具体执行时再组合</span>
        self.conversation_prompt = conversation_prompt

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format_history</span>(<span class="hljs-params">self, history_list</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""格式化聊天历史"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> history_list:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"无历史对话"</span>
        
        formatted = []
        <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> history_list:
            <span class="hljs-comment"># 兼容 Pydantic model 或 dict</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(msg, <span class="hljs-built_in">dict</span>):
                role = msg.get(<span class="hljs-string">'role'</span>, <span class="hljs-string">'unknown'</span>)
                content = msg.get(<span class="hljs-string">'content'</span>, <span class="hljs-string">''</span>)
            <span class="hljs-keyword">else</span>:
                role = <span class="hljs-built_in">getattr</span>(msg, <span class="hljs-string">'role'</span>, <span class="hljs-string">'unknown'</span>)
                content = <span class="hljs-built_in">getattr</span>(msg, <span class="hljs-string">'content'</span>, <span class="hljs-string">''</span>)
                
            formatted.append(<span class="hljs-string">f"<span class="hljs-subst">{role}</span>: <span class="hljs-subst">{content}</span>"</span>)
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"\n"</span>.join(formatted[-<span class="hljs-number">10</span>:])  <span class="hljs-comment"># 只保留最近 10 条</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stream_chat</span>(<span class="hljs-params">self, user_input: <span class="hljs-built_in">str</span>, chat_history: <span class="hljs-built_in">list</span></span>) -&gt; Generator[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>]:
        <span class="hljs-string">"""流式对话生成器"""</span>
        <span class="hljs-keyword">try</span>:
            history_text = self.format_history(chat_history)
            
            <span class="hljs-comment"># 构建链：Prompt | StreamingLLM | OutputParser</span>
            chain = self.conversation_prompt | self.streaming_llm | self.output_parser
            
            <span class="hljs-comment"># 执行流式生成</span>
            <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chain.stream({
                <span class="hljs-string">"chat_history"</span>: history_text,
                <span class="hljs-string">"user_input"</span>: user_input
            }):
                <span class="hljs-keyword">yield</span> chunk
                
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">yield</span> <span class="hljs-string">f"Error: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>
</code></pre>
<p>接下来我们对上述封装的 LLM 类的功能进行测试，测试前先在 ./backend/.env 文件中添加 DeepSeek 开放平台的 API key。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">DEEPSEEK_API_KEY</span>=sk-xxxxxx
</code></pre>
<p>接着创建 <code>./backend/test.py</code> 文件写上以下测试代码。</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> llm_app <span class="hljs-keyword">import</span> LLMApp

<span class="hljs-comment"># 测试</span>
llmApp = LLMApp()

<span class="hljs-comment"># 模拟聊天历史</span>
chat_history = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好！有什么可以帮助你的吗？"</span>},
]
<span class="hljs-comment"># 模拟用户输入</span>
user_input = <span class="hljs-string">"请介绍一下人工智能"</span>

<span class="hljs-comment"># 收集流式响应</span>
response_chunks = []
<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> llmApp.stream_chat(user_input, chat_history):
    response_chunks.append(chunk)
    <span class="hljs-comment"># 模拟实时显示</span>
    <span class="hljs-built_in">print</span>(chunk, end=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)

<span class="hljs-comment"># 合并响应</span>
full_response = <span class="hljs-string">""</span>.join(response_chunks)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n完整响应: <span class="hljs-subst">{full_response}</span>"</span>)
</code></pre>
<p>测试结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7ecf2ca0b41454385794c6380679a2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=3iI%2FH9FFTa3uw4sSBfxw2JvhDes%3D" alt="20260208-172852.gif" loading="lazy"/></p>
<p>接着我们通过 Pydantic 来定义数据的结构（模型）</p>
<p>创建 ./backend/models.py 文件，内容如下：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatMessage</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""单条聊天消息"""</span>
    role: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># "user" 或 "assistant"</span>
    content: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatRequest</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-string">"""聊天请求模型"""</span>
    message: <span class="hljs-built_in">str</span>
    chat_history: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[ChatMessage]] = []
</code></pre>
<p>修改 <code>./backend/test.py</code> 文件，内容如下：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> llm_app <span class="hljs-keyword">import</span> LLMApp
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> ChatRequest, ChatMessage


<span class="hljs-comment"># 测试</span>
llmApp = LLMApp()

<span class="hljs-comment"># 模拟聊天历史</span>
chat_history = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好！有什么可以帮助你的吗？"</span>},
]
<span class="hljs-comment"># 模拟用户输入</span>
user_input = <span class="hljs-string">"请介绍一下人工智能"</span>
<span class="hljs-comment"># 模拟 SSE 的流式聊天响应</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_stream</span>(<span class="hljs-params">request: ChatRequest</span>):
    <span class="hljs-comment"># 1. 发送开始事件</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'start'</span>}</span>)}\n\n"</span>
    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.01</span>) <span class="hljs-comment"># 让出控制权，以便运行其他任务。</span>
    
    full_response = <span class="hljs-string">""</span>
    
    <span class="hljs-comment"># 2. 生成并发送 token</span>
    <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> llmApp.stream_chat(request.message, request.chat_history):
        full_response += token
        <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'token'</span>, <span class="hljs-string">'content'</span>: token}</span>)}\n\n"</span>
        <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.01</span>)
    
    <span class="hljs-comment"># 3. 发送结束事件</span>
    <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'end'</span>, <span class="hljs-string">'full_response'</span>: full_response}</span>)}\n\n"</span>

<span class="hljs-comment"># 异步测试函数</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_chat_stream</span>():
    <span class="hljs-comment"># 使用 Pydantic 模型实现数据序列化和反序列化（即将JSON数据转换为Python对象）</span>
    request = ChatRequest(message=user_input, chat_history=chat_history)
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chat_stream(request):
        <span class="hljs-built_in">print</span>(chunk)
<span class="hljs-comment"># 在异步编程中，我们使用asyncio.run()来运行一个异步函数（coroutine）作为程序的入口点。</span>
asyncio.run(test_chat_stream())
</code></pre>
<p>打印结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7d03b0851a9472383ad35f6036dba29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=C51GdZMWPkU50khZDDaPt3mp220%3D" alt="image.png" loading="lazy"/></p>
<p>在上述的测试代码中的 chat_stream 函数实现一个基于 Server-Sent Events (SSE) 的流式聊天响应的异步生成器，它接收一个 <code>ChatRequest</code> 对象，然后逐步生成事件流。事件流格式遵循 SSE 规范，每个事件以 "data: " 开头，后跟 JSON 字符串，并以两个换行符结束。</p>
<ol>
<li>首先，发送一个开始事件，通知客户端开始生成响应。</li>
<li>然后，通过调用 <code>llmApp.stream_chat</code> 方法，逐个获取 token，并将每个 token 作为一个事件发送。</li>
<li>在发送每个 token 事件后，使用 <code>await asyncio.sleep(0.01)</code> 来让出控制权，这样其他任务可以运行，避免阻塞。</li>
<li>同时，将每个 token 累加到 <code>full_response</code> 中，以便在最后发送整个响应。</li>
<li>最后，发送一个结束事件，并包含完整的响应内容。</li>
</ol>
<p>这样设计的好处：</p>
<ul>
<li>流式传输：可以逐步将响应发送给客户端，客户端可以实时看到生成的 token，提升用户体验（如打字机效果）。</li>
<li>异步：使用异步生成器，可以在等待模型生成下一个 token 时让出控制权，提高并发性能。</li>
<li>事件驱动：通过定义不同类型的事件（开始、token、结束），客户端可以方便地根据事件类型进行处理。</li>
</ul>
<h4 data-id="heading-27">6.2 实现 API 层</h4>
<p>上面测试代码中实现的 chat_stream 函数，其实就是我们接下来要实现的 <strong>流式对话接口</strong>，即接收用户的消息和聊天历史，通过流式方式返回 LLM 的响应。同时我们再实现一个<strong>健康检查接口</strong>，提供服务器的健康状态，包括 LLM 应用是否初始化成功、模型名称等，便于监控。</p>
<p>根据上面所学的知识，我们实现一个基于 FastAPI 的 LLM 聊天 API 服务。</p>
<p>我们创建 <code>./backend/server.py</code> 文件，内容如下：</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException
<span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> StreamingResponse
<span class="hljs-keyword">from</span> llm_app <span class="hljs-keyword">import</span> LLMApp
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> ChatRequest, HealthResponse

app = FastAPI(title=<span class="hljs-string">"Cobyte LLM Chat API"</span>)

<span class="hljs-comment"># CORS 配置：允许前端跨域访问</span>
app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],  <span class="hljs-comment"># 在生产环境中建议设置为具体的前端域名</span>
    allow_credentials=<span class="hljs-literal">True</span>,
    allow_methods=[<span class="hljs-string">"*"</span>],
    allow_headers=[<span class="hljs-string">"*"</span>],
)

<span class="hljs-comment"># 全局 LLM 应用实例</span>
llm_app = <span class="hljs-literal">None</span>

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup_event</span>():
    <span class="hljs-string">"""应用启动时初始化 LLM"""</span>
    <span class="hljs-keyword">global</span> llm_app
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"正在初始化 LLM 应用..."</span>)
        llm_app = LLMApp()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"✅ LLM 应用初始化成功"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"❌ LLM 应用初始化失败: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/api/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>():
    <span class="hljs-string">"""健康检查接口"""</span>
    <span class="hljs-keyword">return</span> HealthResponse(
        status=<span class="hljs-string">"healthy"</span> <span class="hljs-keyword">if</span> llm_app <span class="hljs-keyword">else</span> <span class="hljs-string">"unhealthy"</span>,
        model=<span class="hljs-string">"deepseek-chat"</span>,
        api_configured=llm_app <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>,
        timestamp=datetime.now().isoformat()
    )

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/api/chat/stream"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_stream</span>(<span class="hljs-params">request: ChatRequest</span>):
    <span class="hljs-string">"""流式对话接口"""</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> llm_app:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">"LLM 服务未就绪"</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>():
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 1. 发送开始事件</span>
            <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'start'</span>}</span>)}\n\n"</span>
            <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.01</span>) <span class="hljs-comment"># 让出控制权</span>
            
            full_response = <span class="hljs-string">""</span>
            
            <span class="hljs-comment"># 2. 生成并发送 token</span>
            <span class="hljs-comment"># 注意：llm_app.stream_chat 是同步生成器，但在 FastAPI 中可以正常工作</span>
            <span class="hljs-comment"># 如果需要完全异步，需要使用 AsyncChatOpenAI，这里为了简单保持同步调用</span>
            <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> llm_app.stream_chat(request.message, request.chat_history):
                full_response += token
                <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'token'</span>, <span class="hljs-string">'content'</span>: token}</span>)}\n\n"</span>
                <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">0.01</span>)
            
            <span class="hljs-comment"># 3. 发送结束事件</span>
            <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'end'</span>, <span class="hljs-string">'full_response'</span>: full_response}</span>)}\n\n"</span>
            
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            error_msg = <span class="hljs-built_in">str</span>(e)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"生成错误: <span class="hljs-subst">{error_msg}</span>"</span>)
            <span class="hljs-keyword">yield</span> <span class="hljs-string">f"data: <span class="hljs-subst">{json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'error'</span>, <span class="hljs-string">'message'</span>: error_msg}</span>)}\n\n"</span>

    <span class="hljs-keyword">return</span> StreamingResponse(generate(), media_type=<span class="hljs-string">"text/event-stream"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> uvicorn
    uvicorn.run(app, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>)
</code></pre>
<p>至此我们基于 FastAPI 实现了 API 层。核心功能就是提供了两个 API：</p>
<ol>
<li>
<p><strong>流式对话接口</strong> <code>/api/chat/stream</code></p>
<ul>
<li>支持 Server-Sent Events (SSE) 流式响应</li>
<li>接收用户消息，实时返回 AI 生成的回复</li>
<li>支持对话历史管理</li>
</ul>
</li>
<li>
<p><strong>健康检查接口</strong> <code>/api/health</code></p>
<ul>
<li>检查服务状态</li>
<li>返回 API 配置信息</li>
</ul>
</li>
</ol>
<h4 data-id="heading-28">6.3 依赖管理</h4>
<p>为了更好地管理我们的依赖，我们可以创建一个 <code>./backend/requirements.txt</code> 文件，将使用到的依赖都设置到这个文件中：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">fastapi&gt;</span><span class="bash">=0.109.0</span>
<span class="hljs-meta prompt_">uvicorn&gt;</span><span class="bash">=0.27.0</span>
<span class="hljs-meta prompt_">python-dotenv&gt;</span><span class="bash">=1.0.0</span>
<span class="hljs-meta prompt_">langchain&gt;</span><span class="bash">=1.2.9</span>
<span class="hljs-meta prompt_">langchain-openai&gt;</span><span class="bash">=0.0.5</span>
<span class="hljs-meta prompt_">pydantic&gt;</span><span class="bash">=2.5.0</span>
</code></pre>
<p>这样我们就可以进行以下方式进行安装依赖了。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装依赖</span>
pip install -r requirements.txt
</code></pre>
<h3 data-id="heading-29">7. 前端聊天界面</h3>
<p>先创建一个 Vue3 + TS 的前端项目，我们在根目录下执行以下命令：</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> vite<span class="hljs-variable">@latest</span> frontend <span class="hljs-comment">--template vue-ts</span>
</code></pre>
<p>接下来我们主要实现以下核心功能：</p>
<ol>
<li>
<p><strong>对话界面</strong></p>
<ul>
<li>消息列表展示（用户消息 + AI 回复）</li>
<li>输入框 + 发送按钮</li>
<li>流式显示 AI 回复（逐字显示效果）</li>
<li>加载状态提示</li>
</ul>
</li>
<li>
<p><strong>交互功能</strong></p>
<ul>
<li>发送消息（Enter 键/点击按钮）</li>
<li>清空对话历史</li>
<li>滚动到最新消息</li>
</ul>
</li>
</ol>
<p>./frontend/src/types/chat.ts 文件如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> interface <span class="hljs-title class_">Message</span> {
  <span class="hljs-attr">id</span>: string
  <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span> | <span class="hljs-string">'assistant'</span>
  <span class="hljs-attr">content</span>: string
  <span class="hljs-attr">timestamp</span>: number
  streaming?: boolean  <span class="hljs-comment">// 是否正在流式生成</span>
}

<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">ChatRequest</span> {
  <span class="hljs-attr">message</span>: string
  <span class="hljs-attr">chat_history</span>: <span class="hljs-title class_">Array</span>&lt;{
    <span class="hljs-attr">role</span>: string
    <span class="hljs-attr">content</span>: string
  }&gt;
}

<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">SSEEvent</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'start'</span> | <span class="hljs-string">'token'</span> | <span class="hljs-string">'end'</span> | <span class="hljs-string">'error'</span>
  content?: string
  full_response?: string
  message?: string
}
</code></pre>
<p>./frontend/src/api/chat.ts 文件内容如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> type { <span class="hljs-title class_">ChatRequest</span>, <span class="hljs-title class_">SSEEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types/chat'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_BASE_URL</span> = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_BASE_URL</span> || <span class="hljs-string">'http://localhost:8000'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatAPI</span> {
  <span class="hljs-comment">/**
   * 流式对话接口
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">streamChat</span>(
    <span class="hljs-attr">payload</span>: <span class="hljs-title class_">ChatRequest</span>,
    <span class="hljs-attr">onToken</span>: <span class="hljs-function">(<span class="hljs-params">token: string</span>) =&gt;</span> <span class="hljs-keyword">void</span>,
    <span class="hljs-attr">onComplete</span>: <span class="hljs-function">(<span class="hljs-params">fullResponse: string</span>) =&gt;</span> <span class="hljs-keyword">void</span>,
    <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">error: string</span>) =&gt;</span> <span class="hljs-keyword">void</span>
  ): <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span> {
    <span class="hljs-comment">// 使用 fetch API 配合 ReadableStream 来处理 POST 请求的流式响应</span>
    <span class="hljs-comment">// 因为标准的 EventSource 不支持 POST 请求</span>
    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>()
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchStream</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span>/api/chat/stream`</span>, {
          <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
          <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
          },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(payload),
          <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span>,
        })

        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>)
        }

        <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>?.<span class="hljs-title function_">getReader</span>()
        <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>()
        
        <span class="hljs-keyword">if</span> (!reader) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Response body is null'</span>)

        <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>

        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
          <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>()
          <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>
          
          <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> })
          buffer += chunk
          
          <span class="hljs-comment">// 处理 buffer 中的每一行</span>
          <span class="hljs-keyword">const</span> lines = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>)
          buffer = lines.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">''</span> <span class="hljs-comment">// 保留最后一个可能不完整的块</span>
          
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
            <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data: '</span>)) {
              <span class="hljs-keyword">const</span> jsonStr = line.<span class="hljs-title function_">slice</span>(<span class="hljs-number">6</span>)
              <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">SSEEvent</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(jsonStr)
                
                <span class="hljs-keyword">switch</span> (data.<span class="hljs-property">type</span>) {
                  <span class="hljs-keyword">case</span> <span class="hljs-string">'start'</span>:
                    <span class="hljs-keyword">break</span>
                  <span class="hljs-keyword">case</span> <span class="hljs-string">'token'</span>:
                    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">content</span>) <span class="hljs-title function_">onToken</span>(data.<span class="hljs-property">content</span>)
                    <span class="hljs-keyword">break</span>
                  <span class="hljs-keyword">case</span> <span class="hljs-string">'end'</span>:
                    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">full_response</span>) <span class="hljs-title function_">onComplete</span>(data.<span class="hljs-property">full_response</span>)
                    <span class="hljs-keyword">return</span> <span class="hljs-comment">// 正常结束</span>
                  <span class="hljs-keyword">case</span> <span class="hljs-string">'error'</span>:
                    <span class="hljs-title function_">onError</span>(data.<span class="hljs-property">message</span> || <span class="hljs-string">'Unknown error'</span>)
                    <span class="hljs-keyword">return</span>
                }
              } <span class="hljs-keyword">catch</span> (e) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'JSON parse error:'</span>, e)
              }
            }
          }
        }
      } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: any) {
        <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">'AbortError'</span>) <span class="hljs-keyword">return</span>
        <span class="hljs-title function_">onError</span>(error.<span class="hljs-property">message</span>)
      }
    }

    <span class="hljs-title function_">fetchStream</span>()

    <span class="hljs-comment">// 返回取消函数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> controller.<span class="hljs-title function_">abort</span>()
  }

  <span class="hljs-comment">/**
   * 健康检查
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">healthCheck</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span>/api/health`</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Health check failed'</span>, error)
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">status</span>: <span class="hljs-string">'error'</span> }
    }
  }
}
</code></pre>
<p>./frontend/src/composables/useChat.ts 文件内容如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { ref, nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">Message</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types/chat'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatAPI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/chat'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useChat</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> messages = ref&lt;<span class="hljs-title class_">Message</span>[]&gt;([])
  <span class="hljs-keyword">const</span> isLoading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">const</span> currentStreamingMessage = ref&lt;<span class="hljs-title class_">Message</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
  
  <span class="hljs-comment">// 用于取消当前的请求</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">cancelStream</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>) | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

  <span class="hljs-comment">/**
   * 滚动到底部
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToBottom</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.message-list'</span>)
      <span class="hljs-keyword">if</span> (container) {
        container.<span class="hljs-title function_">scrollTo</span>({
          <span class="hljs-attr">top</span>: container.<span class="hljs-property">scrollHeight</span>,
          <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
        })
      }
    })
  }

  <span class="hljs-comment">/**
   * 发送消息
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">content: string</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!content.<span class="hljs-title function_">trim</span>() || isLoading.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-comment">// 1. 添加用户消息</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">userMessage</span>: <span class="hljs-title class_">Message</span> = {
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
      <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
      <span class="hljs-attr">content</span>: content.<span class="hljs-title function_">trim</span>(),
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    }
    messages.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(userMessage)
    
    <span class="hljs-comment">// 准备发送给后端的历史记录（去掉刚加的这一条，因为后端只要之前的）</span>
    <span class="hljs-comment">// 或者你可以根据设计决定是否包含当前条，通常 API 设计是：新消息 + 历史</span>
    <span class="hljs-comment">// 我们的后端设计是：message + chat_history</span>
    <span class="hljs-keyword">const</span> historyPayload = messages.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> ({
      <span class="hljs-attr">role</span>: m.<span class="hljs-property">role</span>,
      <span class="hljs-attr">content</span>: m.<span class="hljs-property">content</span>
    }))

    <span class="hljs-comment">// 2. 创建 AI 消息占位符</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">aiMessage</span>: <span class="hljs-title class_">Message</span> = {
      <span class="hljs-attr">id</span>: (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>(),
      <span class="hljs-attr">role</span>: <span class="hljs-string">'assistant'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">streaming</span>: <span class="hljs-literal">true</span>
    }
    messages.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(aiMessage)
    currentStreamingMessage.<span class="hljs-property">value</span> = aiMessage
    isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    
    <span class="hljs-title function_">scrollToBottom</span>()

    <span class="hljs-comment">// 3. 调用流式 API</span>
    cancelStream = <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">streamChat</span>(
      {
        <span class="hljs-attr">message</span>: content.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">chat_history</span>: historyPayload
      },
      <span class="hljs-comment">// onToken</span>
      <span class="hljs-function">(<span class="hljs-params">token</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (currentStreamingMessage.<span class="hljs-property">value</span>) {
          currentStreamingMessage.<span class="hljs-property">value</span>.<span class="hljs-property">content</span> += token
          <span class="hljs-title function_">scrollToBottom</span>()
        }
      },
      <span class="hljs-comment">// onComplete</span>
      <span class="hljs-function">(<span class="hljs-params">fullResponse</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (currentStreamingMessage.<span class="hljs-property">value</span>) {
          <span class="hljs-comment">// 确保内容完整</span>
          <span class="hljs-keyword">if</span> (currentStreamingMessage.<span class="hljs-property">value</span>.<span class="hljs-property">content</span> !== fullResponse &amp;&amp; fullResponse) {
             currentStreamingMessage.<span class="hljs-property">value</span>.<span class="hljs-property">content</span> = fullResponse
          }
          currentStreamingMessage.<span class="hljs-property">value</span>.<span class="hljs-property">streaming</span> = <span class="hljs-literal">false</span>
        }
        currentStreamingMessage.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
        isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
        cancelStream = <span class="hljs-literal">null</span>
        <span class="hljs-title function_">scrollToBottom</span>()
      },
      <span class="hljs-comment">// onError</span>
      <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (currentStreamingMessage.<span class="hljs-property">value</span>) {
          currentStreamingMessage.<span class="hljs-property">value</span>.<span class="hljs-property">content</span> += <span class="hljs-string">`\n[错误: <span class="hljs-subst">${error}</span>]`</span>
          currentStreamingMessage.<span class="hljs-property">value</span>.<span class="hljs-property">streaming</span> = <span class="hljs-literal">false</span>
        }
        currentStreamingMessage.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
        isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
        cancelStream = <span class="hljs-literal">null</span>
        <span class="hljs-title function_">scrollToBottom</span>()
      }
    )
  }

  <span class="hljs-comment">/**
   * 清空历史
   */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearHistory</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (cancelStream) {
      <span class="hljs-title function_">cancelStream</span>()
      cancelStream = <span class="hljs-literal">null</span>
    }
    messages.<span class="hljs-property">value</span> = []
    isLoading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    currentStreamingMessage.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>
  }

  <span class="hljs-keyword">return</span> {
    messages,
    isLoading,
    sendMessage,
    clearHistory
  }
}
</code></pre>
<p>./frontend/src/App.vue 文件内容如下：</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chat-header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>🤖 DeepSeek 对话助手<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"status-badge"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ online: isServerOnline }"</span>&gt;</span>
          {{ isServerOnline ? '在线' : '离线' }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"clearHistory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clear-btn"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"清空对话"</span>&gt;</span>
        🗑️
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"message-list"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"messages.length === 0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"empty-state"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>👋 你好！我是基于 DeepSeek 的 AI 助手。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>请在下方输入问题开始对话。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"msg in messages"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"msg.id"</span> 
        <span class="hljs-attr">class</span>=<span class="hljs-string">"message-wrapper"</span>
        <span class="hljs-attr">:class</span>=<span class="hljs-string">"msg.role"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"avatar"</span>&gt;</span>
          {{ msg.role === 'user' ? '👤' : '🤖' }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"message-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bubble"</span>&gt;</span>
            {{ msg.content }}
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"msg.streaming"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"cursor"</span>&gt;</span>|<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-area"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>
          <span class="hljs-attr">v-model</span>=<span class="hljs-string">"inputContent"</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入消息... (Enter 发送, Shift+Enter 换行)"</span>
          @<span class="hljs-attr">keydown.enter.exact.prevent</span>=<span class="hljs-string">"handleSend"</span>
          <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"isLoading"</span>
          <span class="hljs-attr">rows</span>=<span class="hljs-string">"1"</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">"textareaRef"</span>
        &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
          @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleSend"</span> 
          <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"isLoading || !inputContent.trim()"</span>
          <span class="hljs-attr">class</span>=<span class="hljs-string">"send-btn"</span>
        &gt;</span>
          {{ isLoading ? '...' : '发送' }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, onMounted, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useChat } <span class="hljs-keyword">from</span> <span class="hljs-string">'./composables/useChat'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatAPI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./api/chat'</span>

<span class="hljs-keyword">const</span> { messages, isLoading, sendMessage, clearHistory } = <span class="hljs-title function_">useChat</span>()
<span class="hljs-keyword">const</span> inputContent = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> textareaRef = ref&lt;<span class="hljs-title class_">HTMLTextAreaElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
<span class="hljs-keyword">const</span> isServerOnline = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-comment">// 检查服务器状态</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> health = <span class="hljs-keyword">await</span> <span class="hljs-title class_">ChatAPI</span>.<span class="hljs-title function_">healthCheck</span>()
  isServerOnline.<span class="hljs-property">value</span> = health.<span class="hljs-property">status</span> === <span class="hljs-string">'healthy'</span>
})

<span class="hljs-comment">// 自动调整输入框高度</span>
<span class="hljs-title function_">watch</span>(inputContent, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (textareaRef.<span class="hljs-property">value</span>) {
    textareaRef.<span class="hljs-property">value</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'auto'</span>
    textareaRef.<span class="hljs-property">value</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = textareaRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollHeight</span> + <span class="hljs-string">'px'</span>
  }
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSend</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (inputContent.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>() &amp;&amp; !isLoading.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">sendMessage</span>(inputContent.<span class="hljs-property">value</span>)
    inputContent.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>
    <span class="hljs-comment">// 重置高度</span>
    <span class="hljs-keyword">if</span> (textareaRef.<span class="hljs-property">value</span>) {
      textareaRef.<span class="hljs-property">value</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'auto'</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#4a90e2</span>;
  <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#f5f7fa</span>;
  <span class="hljs-attr">--chat-bg</span>: <span class="hljs-number">#ffffff</span>;
  <span class="hljs-attr">--user-msg-bg</span>: <span class="hljs-number">#e3f2fd</span>;
  <span class="hljs-attr">--bot-msg-bg</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attr">--border-color</span>: <span class="hljs-number">#e0e0e0</span>;
}

* {
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, Oxygen, Ubuntu, Cantarell, <span class="hljs-string">'Open Sans'</span>, <span class="hljs-string">'Helvetica Neue'</span>, sans-serif;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--bg-color);
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.app-container</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--chat-bg);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.05</span>);
}

<span class="hljs-comment">/* Header */</span>
<span class="hljs-selector-class">.chat-header</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10</span>;
}

<span class="hljs-selector-class">.header-content</span> <span class="hljs-selector-tag">h1</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-selector-class">.status-badge</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8rem</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ff5252</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.status-badge</span><span class="hljs-selector-class">.online</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#4caf50</span>;
}

<span class="hljs-selector-class">.clear-btn</span> {
  <span class="hljs-attribute">background</span>: none;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.clear-btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
}

<span class="hljs-comment">/* Message List */</span>
<span class="hljs-selector-class">.message-list</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.empty-state</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#888</span>;
}

<span class="hljs-selector-class">.message-wrapper</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">85%</span>;
}

<span class="hljs-selector-class">.message-wrapper</span><span class="hljs-selector-class">.user</span> {
  <span class="hljs-attribute">align-self</span>: flex-end;
  <span class="hljs-attribute">flex-direction</span>: row-reverse;
}

<span class="hljs-selector-class">.avatar</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">36px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">36px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.bubble</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">word-break</span>: break-word;
}

<span class="hljs-selector-class">.message-wrapper</span><span class="hljs-selector-class">.user</span> <span class="hljs-selector-class">.bubble</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--user-msg-bg);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#0d47a1</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span> <span class="hljs-number">2px</span> <span class="hljs-number">12px</span> <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.message-wrapper</span><span class="hljs-selector-class">.assistant</span> <span class="hljs-selector-class">.bubble</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--bot-msg-bg);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">2px</span> <span class="hljs-number">12px</span> <span class="hljs-number">12px</span> <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.cursor</span> {
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">2px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1em</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">animation</span>: blink <span class="hljs-number">1s</span> infinite;
  <span class="hljs-attribute">vertical-align</span>: middle;
}

<span class="hljs-keyword">@keyframes</span> blink {
  <span class="hljs-number">0%</span>, <span class="hljs-number">100%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  <span class="hljs-number">50%</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}

<span class="hljs-comment">/* Input Area */</span>
<span class="hljs-selector-class">.input-area</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
  <span class="hljs-attribute">background</span>: white;
}

<span class="hljs-selector-class">.input-container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">align-items</span>: flex-end;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f8f9fa</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
}

<span class="hljs-selector-tag">textarea</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">resize</span>: none;
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">150px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
  <span class="hljs-attribute">font-family</span>: inherit;
  <span class="hljs-attribute">outline</span>: none;
}

<span class="hljs-selector-class">.send-btn</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.send-btn</span><span class="hljs-selector-pseudo">:disabled</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
  <span class="hljs-attribute">cursor</span>: not-allowed;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</span></code></pre>
<p>./frontend/src/style.css 文件内容如下：</p>
<pre><code class="hljs language-style" lang="style">:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  display: flex;
  place-items: center;
  min-width: 320px;
  min-height: 100vh;
}

#app {
  width: 100%;
  height: 100vh;
}

.container {
  max-width: 600px;
  margin: 0 auto;
  padding: 2rem;
  background-color: #1a1a1a;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.header {
  text-align: center;
  margin-bottom: 2rem;
}

.header h1 {
  font-size: 2rem;
  color: #ffffff;
  margin: 0;
}

.header p {
  font-size: 1rem;
  color: #bbbbbb;
  margin: 0;
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  color: #ffffff;
  font-size: 0.9rem;
}

.form-group input {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #444;
  border-radius: 6px;
  background-color: #2a2a2a;
  color: #ffffff;
  font-size: 1rem;
}

.form-group textarea {
  width: 100%;
  padding: 0.75rem;
  border: 1px solid #444;
  border-radius: 6px;
  background-color: #2a2a2a;
  color: #ffffff;
  font-size: 1rem;
  resize: vertical;
}

.form-group button {
  width: 100%;
  padding: 0.75rem;
  border: none;
  border-radius: 6px;
  background-color: #4caf50;
  color: #ffffff;
  font-size: 1rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.form-group button:hover {
  background-color: #45a049;
}

.error-message {
  color: #ff4d4d;
  font-size: 0.8rem;
  margin-top: 0.5rem;
  display: none;
}

.success-message {
  color: #4caf50;
  font-size: 0.8rem;
  margin-top: 0.5rem;
  display: none;
}

@media (max-width: 600px) {
  .container {
    padding: 1rem;
  }

  .form-group input,
  .form-group textarea {
    font-size: 0.9rem;
  }

  .form-group button {
    font-size: 0.9rem;
  }
}
</code></pre>
<p>大家都是前端人，前端部分的实现就不进行详细讲解了。</p>
<h3 data-id="heading-30">8. 运行与验证</h3>
<h4 data-id="heading-31">8.1 启动后端</h4>
<p>打开一个终端窗口：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> backend
<span class="hljs-comment"># 1. 安装依赖</span>
pip install -r requirements.txt

<span class="hljs-comment"># 2. 设置 API Key (重要！)</span>
<span class="hljs-comment"># 编辑 .env 文件，填入你的 DeepSeek API Key</span>
<span class="hljs-comment"># DEEPSEEK_API_KEY=sk-... </span>

<span class="hljs-comment"># 3. 启动服务器</span>
python server.py
<span class="hljs-comment"># 服务将运行在 http://0.0.0.0:8000</span>
</code></pre>
<h4 data-id="heading-32">8.2 启动前端</h4>
<p>打开一个新的终端窗口：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> frontend
<span class="hljs-comment"># 1. 安装依赖</span>
npm install

<span class="hljs-comment"># 2. 启动开发服务器</span>
npm run dev
</code></pre>
<p>访问前端地址，你就可以看到一个简洁的聊天界面。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f613b386324345b0b8bff103cc65c2ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29ieXRl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771163145&amp;x-signature=AHAqSIzpNEx%2FO%2FD5NKpk12ldZYo%3D" alt="image.png" loading="lazy"/></p>
<p>当你输入问题并点击发送时，请求会经过： <code>前端</code> -&gt; <code>FastAPI</code> -&gt; <code>LangChain</code> -&gt; <code>DeepSeek API</code> -&gt; <code>返回结果</code>。</p>
<h3 data-id="heading-33">9. 总结</h3>
<p>通过本文，我们完成了一个最小可行性产品（MVP）。从零开始搭建一个基于 <strong>Python (FastAPI)</strong> 、<strong>LangChain</strong> 和 <strong>Vue 3</strong> 的全栈 LLM 聊天应用程序。</p>
<p>这个项目虽然简单，但它包含了一个 AI 应用的完整骨架。你可以在此基础上扩展更多功能，例如添加<strong>对话历史记忆 (Memory)</strong>  或 <strong>RAG (知识库检索)</strong> 。</p>
<p>接下来我将继续输出更多 AI 全栈的相关知识，欢迎大家关注本栏目。我是 Cobyte，欢迎添加 v：icobyte，学习 AI 全栈。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OoderAgent 企业版 2.0 发布的意义：一次生态战略的全面升级]]></title>    <link>https://juejin.cn/post/7603911453704454187</link>    <guid>https://juejin.cn/post/7603911453704454187</guid>    <pubDate>2026-02-08T13:54:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704454187" data-draft-id="7603895839556534335" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OoderAgent 企业版 2.0 发布的意义：一次生态战略的全面升级"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-08T13:54:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OneCodeCN"/> <meta itemprop="url" content="https://juejin.cn/user/1427583415622366"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OoderAgent 企业版 2.0 发布的意义：一次生态战略的全面升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1427583415622366/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OneCodeCN
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T13:54:10.000Z" title="Sun Feb 08 2026 13:54:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本次 ooderAgent 企业版 2.0 的发布，远非一次简单的版本迭代，而是标志着整个 ooderAgent 生态在战略定位、技术治理和社区共建上迈入了全新的阶段。其发布意义可以从以下几个层面进行综合分析：</p>
<p>‌<strong>一、 对生态本身：从“内部工具”到“开放平台”的战略转型</strong>‌</p>
<ol>
<li>‌<strong>统一版本号，实现透明治理</strong>‌：本次发布最核心的意义在于宣布“内部版本号完全统一为 2.0，不再区分内外部版本”。这彻底打破了企业级软件常见的“内外有别”模式，意味着 ooderAgent 从服务于内部项目的工具，正式转型为一个‌<strong>面向全行业、完全透明</strong>‌的开源技术平台。这种透明化治理是构建健康、可信赖开源生态的基石。</li>
<li>‌<strong>确立全开源承诺</strong>‌：“正式进入全开源阶段”的声明，是对生态参与者的强心剂。它承诺了技术路线的稳定性与可持续性，消除了用户对于“核心功能闭源”或“版本分裂”的担忧，鼓励更多企业将 ooderAgent 作为其数字化转型的长期技术底座进行投入和建设。</li>
</ol>
<p>‌<strong>二、 对技术社区与开发者：降低门槛，赋能创新</strong>‌</p>
<ol>
<li>‌<strong>提供开箱即用的企业级套件</strong>‌：ooderAgent 2.0 以“开发套包”形式呈现，集成了从数据存储、缓存、文件服务到物联网、消息通信、向量检索的‌<strong>全栈模块</strong>‌。这极大地降低了企业构建复杂业务系统的启动成本和集成复杂度，开发者无需重复“造轮子”，可以聚焦于业务逻辑创新。</li>
<li>‌<strong>清晰的模块化架构指引</strong>‌：项目文档详细阐述了分层模块化设计（数据层、缓存层、服务层等），为开发者提供了清晰的技术选型和架构参考。这种设计不仅便于理解和使用，也方便社区根据自身需求进行模块化扩展或替换，促进了生态内技术组件的繁荣。</li>
<li>‌<strong>拥抱标准与主流生态</strong>‌：所有模块均已发布至 ‌<strong>Maven Central</strong>‌ 中央仓库，并声明对 Java 8+、Spring Boot、Redis、MySQL/PostgreSQL 等主流技术的支持。这表明 ooderAgent 生态积极融入全球 Java 开源生态，降低了用户的学习和集成成本，也便于与其他流行框架协同工作。</li>
</ol>
<p>‌<strong>三、 对企业用户：提供稳定、安全、可扩展的数字化基石</strong>‌</p>
<ol>
<li>‌<strong>强调企业级核心价值</strong>‌：发布内容重点突出了‌<strong>安全性、高性能、可扩展性、可维护性</strong>‌四大企业级特性。例如，包含权限控制、数据加密、审计日志的安全体系；连接池优化、缓存加速、异步处理的高性能设计；以及多租户支持、配置热更新等运维便利性特性。这直接回应了企业在数字化转型中对稳定性、安全性和效率的刚性需求。</li>
<li>‌<strong>区分版本，明确适用场景</strong>‌：明确提出“企业级应用/大型项目推荐使用企业版 2.0，注重稳定性和兼容性；个人学习/小型项目推荐使用个人版”。这种清晰的定位帮助不同规模和发展阶段的用户做出合适的技术选型，避免了“一刀切”带来的适用性问题，体现了生态建设的成熟度。</li>
<li>‌<strong>覆盖数字化转型核心场景</strong>‌：从传统的组织架构管理（ooder-org-web）、文件协同（ooder-vfs-web），到前沿的物联网（ooder-iot-webclient）、向量检索与AI应用（ooder-index-web），ooderAgent 的模块设计覆盖了企业数字化从基础到创新的广泛场景，使其能够作为一个‌<strong>统一的、支撑未来业务演进的技术平台</strong>‌。</li>
</ol>
<p>‌<strong>四、 基础开源</strong>‌</p>
<ol>
<li>‌<strong>开源仓库地址</strong>‌：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foodercn%2Fcommon%2F" target="_blank" title="https://github.com/oodercn/common/" ref="nofollow noopener noreferrer">github.com/oodercn/com…</a></li>
<li>‌<strong>开源协议</strong>‌：‌<strong>MIT License</strong>‌（非常宽松的许可协议，允许自由使用、修改和分发，包括商业用途）。</li>
<li>‌<strong>发布声明</strong>‌：详细的发布说明可见于项目内的 ‌<strong>RELEASE_STATEMENT.md</strong>‌ 文件。</li>
<li>‌<strong>核心定位</strong>‌：该项目是 ‌<strong>ooderAgent 企业版 2.0</strong>‌，定位为企业级基础应用框架和技术底座，采用模块化设计。</li>
</ol>
<p>‌</p>
<ol>
<li>‌<strong>采用宽松的 MIT 协议</strong>‌：MIT 协议赋予了使用者最大的自由度，允许自由使用、修改、分发甚至商用。这极大地鼓励了企业采纳和二次开发，为生态的快速扩张提供了法律保障。</li>
<li>‌<strong>提供完整的贡献指南</strong>‌：文档中包含了从 Fork、创建分支到提交 Pull Request 的标准流程，明确了社区共建的路径。结合“全开源”的承诺，这旨在吸引更多开发者贡献代码、修复漏洞、开发新模块，推动生态从“项目主导”向“社区驱动”演进。</li>
</ol>
<p>‌<strong>四、 对开源模式：践行真正的社区驱动</strong></p>
<p>‌<strong>总结而言</strong>‌，ooderAgent 企业版 2.0 的发布，是一次‌<strong>生态战略的宣言</strong>‌。它通过“版本统一”和“全开源”确立了透明开放的治理模式；通过“模块化套件”和“企业级特性”交付了即战力强大的技术产品；通过“明确场景定位”和“拥抱主流标准”降低了生态参与门槛。这不仅为寻求可靠技术底座的企业提供了一个强有力的选项，也为中国开源社区贡献了一个目标清晰、架构完整、可持续演进的企业级开源项目范本，其意义在于为整个生态的长期繁荣奠定了坚实的制度和技术基础。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foodercn%2F" title="https://github.com/oodercn/" target="_blank" ref="nofollow noopener noreferrer">github.com/oodercn/</a></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@tdesign/uniapp 图标瘦身]]></title>    <link>https://juejin.cn/post/7604037348607377446</link>    <guid>https://juejin.cn/post/7604037348607377446</guid>    <pubDate>2026-02-08T12:35:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607377446" data-draft-id="7604037348607361062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@tdesign/uniapp 图标瘦身"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T12:35:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Novlan1"/> <meta itemprop="url" content="https://juejin.cn/user/1987523605435432"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @tdesign/uniapp 图标瘦身
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1987523605435432/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Novlan1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T12:35:53.000Z" title="Sun Feb 08 2026 12:35:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 背景</h2>
<p>随着 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftdesign.tencent.com%2Ficons%2F" target="_blank" title="https://tdesign.tencent.com/icons/" ref="nofollow noopener noreferrer">tdesign-icons</a> 图标的不断丰富，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Ftdesign-miniprogram%2Fblob%2Fdevelop%2Fpackages%2Funiapp-components%2Fcommon%2Fstyle%2Ficons.less" target="_blank" title="https://github.com/Tencent/tdesign-miniprogram/blob/develop/packages/uniapp-components/common/style/icons.less" ref="nofollow noopener noreferrer">@tdesign/uniapp</a> 包的图标文件大小也不断变大。但是普通业务一般并不需要同时使用这么多图标，并且小程序等场景图标只能使用 <code>iconfont</code> 等，不支持动态加载，所以需要一种方式减包、瘦身。</p>
<h2 data-id="heading-1">2. 解决方案</h2>
<p>不同于原生小程序，<a href="https://link.juejin.cn?target=https%3A%2F%2Ftdesign.tencent.com%2Funiapp%2Foverview" target="_blank" title="https://tdesign.tencent.com/uniapp/overview" ref="nofollow noopener noreferrer">@tdesign/uniapp</a> 在上传前有构建一步，可以利用插件来减包。</p>
<p>可以使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40novlan%2Fpostcss-plugin-remove-selector%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@novlan/postcss-plugin-remove-selector?activeTab=readme" ref="nofollow noopener noreferrer">postcss-plugin-remove-selector</a> 来在构建时进行无用图标的删减。</p>
<p>点此查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40novlan%2Fpostcss-plugin-remove-selector%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@novlan/postcss-plugin-remove-selector?activeTab=readme" ref="nofollow noopener noreferrer">文档</a>。</p>
<h2 data-id="heading-2">3. 如何使用</h2>
<p>安装</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add @novlan/postcss-plugin-remove-selector -D
</code></pre>
<h3 data-id="heading-3">3.1. 简化模式（推荐）</h3>
<p>通过 <code>mode</code> 指定预设，只需关注 <code>used</code>/<code>unused</code>，无需手动配置 <code>file</code> 和 <code>selectorPattern</code>：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> { postcssPluginRemoveSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">'@novlan/postcss-plugin-remove-selector'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">postcssPluginRemoveSelector</span>({
          <span class="hljs-attr">mode</span>: <span class="hljs-string">'tdesign'</span>,
          <span class="hljs-attr">used</span>: [<span class="hljs-string">'home'</span>, <span class="hljs-string">'chat'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'add'</span>, <span class="hljs-string">'search'</span>, <span class="hljs-string">'close'</span>],
        }),
      ],
    },
  },
});
</code></pre>
<p>使用 <code>customUsed</code> / <code>customUnused</code> 可在预设基础上增量追加，不会覆盖预设中已有的列表：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">postcssPluginRemoveSelector</span>({
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'tdesign'</span>,
  <span class="hljs-comment">// 在 tdesign 预设默认的 used 列表上，额外追加 'star' 和 'heart'</span>
  <span class="hljs-attr">customUsed</span>: [<span class="hljs-string">'star'</span>, <span class="hljs-string">'heart'</span>],
  <span class="hljs-comment">// 从结果中额外移除 'loading'</span>
  <span class="hljs-attr">customUnused</span>: [<span class="hljs-string">'loading'</span>],
})
</code></pre>
<h3 data-id="heading-4">3.2. 标准模式</h3>
<p>通过 <code>list</code> 数组传入完整配置，适用于需要匹配多个文件的复杂场景：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> { postcssPluginRemoveSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">'@novlan/postcss-plugin-remove-selector'</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-variable constant_">TDESIGN_ICON_REMOVE_SELECTOR</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@novlan/postcss-plugin-remove-selector/lib/tdesign-uniapp-icon'</span>;


<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">postcssPluginRemoveSelector</span>(<span class="hljs-variable constant_">TDESIGN_ICON_REMOVE_SELECTOR</span>)],
    },
  },
});
</code></pre>
<h2 data-id="heading-5">4. 类型</h2>
<p>插件支持两种配置方式，传入 <code>SimpleOptions</code>（简化模式）或 <code>Options</code>（标准模式）均可。</p>
<h3 data-id="heading-6">4.1. SimpleOptions（简化模式）</h3>



























































<table><thead><tr><th>属性</th><th>类型</th><th>是否必填</th><th>说明</th></tr></thead><tbody><tr><td><code>mode</code></td><td><code>'tdesign'</code></td><td>否</td><td>预设模式，设置后自动使用对应的 <code>file</code> 和 <code>selectorPattern</code> 默认值</td></tr><tr><td><code>file</code></td><td><code>RegExp | string</code></td><td>否</td><td>文件匹配规则。使用 <code>mode</code> 时可省略</td></tr><tr><td><code>used</code></td><td><code>string[]</code></td><td>否</td><td>正在使用的图标名称列表，这些图标会被保留</td></tr><tr><td><code>unused</code></td><td><code>string[]</code></td><td>否</td><td>未使用的图标名称列表，这些图标会被移除</td></tr><tr><td><code>customUsed</code></td><td><code>string[]</code></td><td>否</td><td>增量追加到 <code>used</code> 列表（不覆盖预设或已有的 <code>used</code>）</td></tr><tr><td><code>customUnused</code></td><td><code>string[]</code></td><td>否</td><td>增量追加到 <code>unused</code> 列表（不覆盖预设或已有的 <code>unused</code>）</td></tr><tr><td><code>selectorPattern</code></td><td><code>RegExp</code></td><td>否</td><td>选择器匹配模式。使用 <code>mode</code> 时可省略</td></tr><tr><td><code>debug</code></td><td><code>boolean</code></td><td>否</td><td>是否开启调试模式</td></tr></tbody></table>
<blockquote>
<p><code>mode</code> 和 <code>file</code> 至少需要指定一个。当 <code>mode</code> 和 <code>file</code>/<code>selectorPattern</code> 同时指定时，<code>file</code>/<code>selectorPattern</code> 优先。</p>
</blockquote>
<h3 data-id="heading-7">4.2. Options（标准模式）</h3>























<table><thead><tr><th>属性</th><th>类型</th><th>是否必填</th><th>说明</th></tr></thead><tbody><tr><td><code>list</code></td><td><code>FileConfig[]</code></td><td>是</td><td>配置列表</td></tr><tr><td><code>debug</code></td><td><code>boolean</code></td><td>否</td><td>是否开启调试模式</td></tr></tbody></table>
<h3 data-id="heading-8">4.3. FileConfig</h3>















































<table><thead><tr><th>属性</th><th>类型</th><th>是否必填</th><th>说明</th></tr></thead><tbody><tr><td><code>file</code></td><td><code>RegExp | string</code></td><td>是</td><td>文件匹配规则，可以是字符串或正则表达式</td></tr><tr><td><code>used</code></td><td><code>string[]</code></td><td>否</td><td>正在使用的图标名称列表，这些图标会被保留</td></tr><tr><td><code>unused</code></td><td><code>string[]</code></td><td>否</td><td>未使用的图标名称列表，这些图标会被移除</td></tr><tr><td><code>customUsed</code></td><td><code>string[]</code></td><td>否</td><td>增量追加到 <code>used</code> 列表（不覆盖已有的 <code>used</code>）</td></tr><tr><td><code>customUnused</code></td><td><code>string[]</code></td><td>否</td><td>增量追加到 <code>unused</code> 列表（不覆盖已有的 <code>unused</code>）</td></tr><tr><td><code>selectorPattern</code></td><td><code>RegExp</code></td><td>否</td><td>选择器匹配模式，只处理匹配该模式的选择器</td></tr></tbody></table>
<h3 data-id="heading-9">4.4. 内置预设</h3>

















<table><thead><tr><th>mode</th><th>说明</th><th>默认 file</th><th>默认 selectorPattern</th></tr></thead><tbody><tr><td><code>tdesign</code></td><td>TDesign UniApp 图标减包</td><td><code>/[@/]tdesign[/]uniapp[/]dist[/]icon[/]icon\.[css|vue]/</code></td><td><code>/^\.t-icon-[\w-]+:before$/</code></td></tr></tbody></table>
<h2 data-id="heading-10">5. 文档</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2F%40novlan%2Fpostcss-plugin-remove-selector%3FactiveTab%3Dreadme" target="_blank" title="https://www.npmjs.com/package/@novlan/postcss-plugin-remove-selector?activeTab=readme" ref="nofollow noopener noreferrer">文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnovlan1.github.io%2Fplugins%2Fchangelog%2Fpostcss-plugin-remove-selector.html" target="_blank" title="https://novlan1.github.io/plugins/changelog/postcss-plugin-remove-selector.html" ref="nofollow noopener noreferrer">更新日志</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTDesignOteam%2Ftdesign-uniapp-starter" target="_blank" title="https://github.com/TDesignOteam/tdesign-uniapp-starter" ref="nofollow noopener noreferrer">示例项目</a></li>
</ol>
<h2 data-id="heading-11">6. 效果</h2>
<p>以 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTDesignOteam%2Ftdesign-uniapp-starter" target="_blank" title="https://github.com/TDesignOteam/tdesign-uniapp-starter" ref="nofollow noopener noreferrer">tdesign-uniapp-starter</a> 为例，使用此插件，可使小程序大小减少<code>138KB</code>，约<code>95.8%</code>。</p>
<p>使用前：</p>
<img src="https://cdn.uwayfly.com/article/2026/2/own_mike_4w2yXDz3tMcaJ2nx.png" width="900" alt="转存失败，建议直接上传图片文件" loading="lazy"/>
<p>使用后：</p>
<img src="https://cdn.uwayfly.com/article/2026/2/own_mike_dsdB5TmAaedmkPr5.png" width="900" alt="转存失败，建议直接上传图片文件" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude4.5+Gemini3 接管电脑桌面，这回是真无敌了..]]></title>    <link>https://juejin.cn/post/7603854784864632872</link>    <guid>https://juejin.cn/post/7603854784864632872</guid>    <pubDate>2026-02-08T12:52:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603854784864632872" data-draft-id="7603673564909289507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude4.5+Gemini3 接管电脑桌面，这回是真无敌了.."/> <meta itemprop="keywords" content="AIGC,人工智能,Windows"/> <meta itemprop="datePublished" content="2026-02-08T12:52:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI袋鼠帝"/> <meta itemprop="url" content="https://juejin.cn/user/2032372037988990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude4.5+Gemini3 接管电脑桌面，这回是真无敌了..
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2032372037988990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI袋鼠帝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T12:52:29.000Z" title="Sun Feb 08 2026 12:52:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是袋鼠帝。</p>
<p>Windows 版的 Cowork 来了，而且这回有点猛，同时支持 Gemini 和 Claude 两大顶尖模型！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90272f2f1afa46e4a37205dbea40a919~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=ynnPl7L6YzB1%2FIPsUPgYkZVK86Q%3D" alt="图片" loading="lazy"/></p>
<p>自从 Claude Cowork 火了之后，桌面端 Agent 赛道瞬间就卷起来了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08876b57cef646d2a7a604c6f0b9987b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=qME4TnXn43BiSeYYB4yYyTfHJUI%3D" alt="图片" loading="lazy"/></p>
<p>毕竟桌面端的Agent大家用起来会更方便，也更贴近大众的用户习惯。</p>
<p>关键是一键安装，而且方便跟本地电脑打通，让AI真正开始接管你的电脑，转变为生产力，比在网页端使用Agent要接地气多了。</p>
<p>这不，昆仑天工刚刚发布了他们最新的天工Skywork桌面版。下面统一就叫Skywork吧</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d237b4e89835488b8744cea24b116af2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=pQ6OHAkSMLN7HJQGdCnjvafK%2FdQ%3D" alt="图片" loading="lazy"/></p>
<p>它是一位能直接入职你 Windows 电脑的全能 AI 助理。</p>
<p>并且在海量且良莠不齐的 Claude Skills 中去芜存菁，内置了 100+ 个真正能干活的精选 Skills，全面覆盖 Office 文档、网页制作及多媒体生成等场景。</p>
<p>比如下面这些，有NanoBanana Pro，以及X，YouTube，Reddit相关的skill，是比较吸引我的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02de40fdbdca4529ae76ae5d67fc1641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=W3eIZC5hqfX7CjQZ1yyQfgwaXOQ%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6e58ccc28d243739d4bc3a89b00abb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=%2BGa6cp7bGmx3EAGyhyLwg9VTEfY%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f35f2ba09393465b80fe9770a3d75598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=VNYg155EVtiUewoaKLkXVgHLGNw%3D" alt="图片" loading="lazy"/></p>
<p>而且，它打破了 Word、Excel、PPT 等各种文件的格式壁垒。</p>
<p>你可以直接把硬盘里的海量文件扔给它，它能在数据不上传云端的前提下（本地虚拟机隔离，安全感拉满），自动帮你归类文档、提炼信息、重命名文件等等..</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3f7492094294577af99591a0658ffca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=678gRsb9KVa%2Fc7SvAb6SylMau%2BY%3D" alt="图片" loading="lazy"/></p>
<p>最让我心动的点是：Skywork集成了 Gemini 3 Pro 和 Claude Opus 4.5 这种世界级顶尖模型，不仅能写文案，还能直接生成高质量的图片、视频以及成套的 PPT 和报表，真正实现一句话搞定复杂工作流。</p>
<p>比如可以用它来省钱</p>
<p>我之前逛某鱼的时候，发现一个很有意思的现象。</p>
<p>有很多看似简单的“Word 批量转 PDF”、“PDF 转图片”、“图片批量加水印”的小工具，销量居然还挺高，评论区一堆人夸“救命神器”、“终于不用一个个点了”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dc6452eb17344738ea392f20ba9166c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=IMbuSlC8zeWu3CXSB%2BXK8y3N8yM%3D" alt="图片" loading="lazy"/></p>
<p>我直接惊了！！</p>
<p>然后又搜了一下别的小工具，什么pdf批量转word，word转图片，图片加水印等等...非常多，还都卖的不错..</p>
<p>emmm，这些工具虽然都可以用AI编程来复刻，但是对于很多小白朋友来说，还是有门槛。</p>
<p>现在用Skywork的话，就是一句话的事儿。</p>
<p>prompt：请帮我处理一下【 mp-article-pdf】这个文件夹里的内容。</p>
<p>里面有里面全是pdf文档，请帮我批量转换成word格式。</p>
<p>转换完成后，给每个word文件的每一页都加上淡灰色的水印，水印文字为：“袋鼠帝AI客栈”。</p>
<p>最后把处理好的文件保存到一个新的文件夹里，命名为“mp-article-word”。</p>
<p>整个过程我录了屏</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5e40172633c477c8255c3421f41a80a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=qV%2FnBuJgIB5RQ6EZOuZxWTQ9x4M%3D" alt="wxv_4369299499953799170" loading="lazy"/></p>
<p>Skywork 迅速识别了文件夹内容，一步步思考，指定计划，最后完成了所有文件的转换，并加上了水印。</p>
<p>一次性搞定，过程中可以去喝杯咖啡。</p>
<p>这不仅省了买小工具的钱，更重要的是，它比那些死板的工具更灵活：</p>
<p>你可以随时加需求，比如“只转换包含‘合同’两个字的文件”，或者“转换后把PDF放到一个新的文件夹里，贼灵活。</p>
<p>而且我发现，Skywork 第一次执行某个任务会稍慢一点，但是第二次就非常快了，几乎是第一次速度的10倍。</p>
<p>然后我这台 Windows 电脑用了 4 年了，桌面贼乱..</p>
<p>有同款桌面吗，评论区举个爪爪😂</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48430b643bf246b599b596354c3cc7a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=bLq33LO5MxlT%2F8zLnwSJbFVI5o0%3D" alt="图片" loading="lazy"/></p>
<p>各种截图、文档、安装包混在一起，每次找文件都得靠搜索，甚至有时候搜索都搜不到。</p>
<p>一直懒得整理，主要是文件太多，手动归类太痛苦。</p>
<p>这次，我决定把这个烂摊子交给 Skywork。</p>
<p>我先选择了桌面作为工作空间，然后给 Skywork 下了个指令：</p>
<p>帮我整理桌面：把图片放进‘图片素材’文件夹，把文档按年份归类，把安装包统一放到‘软件备份’里。对于不同功能的快捷方式，分类到不同的文件夹中（文件夹中文命名）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fdc12000fd14df48c662f7903223270~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=VD%2BHqJxAPo0MHfrIyRupBZyM89s%3D" alt="wxv_4370649876258881555" loading="lazy"/></p>
<p>看着 Skywork 在自动扫描、移动文件的过程，不用自己动手真爽！</p>
<p>2分钟后，原本满屏图标的桌面，变得清清爽爽，只剩下几个整齐的文件夹。</p>
<p>还剩余一些，是属于公共桌面的应用（左图），而我们所选的用户桌面确实已经整理完毕了（右图）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cde5ededdad415183d904c6e8c2188e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=KZNxRcuPf4olTwAe9OAY9FTj6mw%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c91acb7e277413bb7786de70fe3a30e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=LLGogScLbv4AWXv0%2BDnjL02eVdU%3D" alt="图片" loading="lazy"/></p>
<p>然后我花了30秒，手动整理一下现有的桌面（把图标排列整齐）</p>
<p>终于！乱了好几年的桌面终于是清爽了，甚至我女朋友打开我电脑，一度以为我重装了系统🤭</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/100b6e44ad9347e69da171af32e4bcf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=bGMFCl2DUMqeXJ%2Bisk6QVeIDDIA%3D" alt="wxv_4369668014220771330" loading="lazy"/></p>
<p>而且，因为背后有 Gemini 和 Claude 这种顶级模型的加持，它对文件内容的理解非常精准，所以各种归类都非常准确。</p>
<p>作为一个公众号博主，我时不时有把预览链接转成 Word 文档的需求。</p>
<p>以前我得复制粘贴，或者网上各种找工具，但要不付费，要不一堆广告，关键转出来的格式经常乱。</p>
<p>我试着把一条公众号文章的链接丢给 Skywork 帮我处理。</p>
<p>prompt：任务目标： 将指定链接的公众号文章内容提取并转换为排版专业的 Word (.docx) 文档。</p>
<p>核心要求：</p>
<p>内容完整性： 严格保留原文所有文字、标点及图片，不得有任何删减或摘要。</p>
<p>图文顺序： 图片必须严格按照原文的段落位置插入，保持“文-图-文”的原始阅读流。</p>
<p>图片质量： 所有图片需保持原图尺寸和分辨率，禁止压缩或调整为统一缩略图。</p>
<p>排版规范：</p>
<p>层级结构： 准确识别并还原原文的标题层级（H1, H2, H3 等）。</p>
<p>代码块美化： 文中的 Shell 指令或代码片段，请在 Word 中使用等宽字体（如 Courier New）并添加灰色背景或边框，形成标准的“代码块”样式，确保便于阅读和复制。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fd15f3121a549799298229d12097ac5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=2irRlWH0c8MpOJ4eqqwc23Zc1yo%3D" alt="wxv_4370778740914602003" loading="lazy"/></p>
<p>Skywork 直接调用了它的网页解析skill，获取了公众号文章的内容，并将图片全部下载到了本地，最终调用docx skill把图片文字按顺序组装起来并排版。</p>
<p>很快，一个图文并茂的 Word 文档就生成好了。</p>
<p>排版非常干净，标题、正文、图片位置都对，非常nice</p>
<p>有时候我写文章需要上传 GIF 动图，但平台限制 10M 以内，而且帧数还不能超过30帧，手里的素材时常会超出限制，也是个很头疼的问题。</p>
<p>还是丢给Skywork解决：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1eebfd17d82424cb37d3f2490d847cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=nTQK89Zlpuj%2FFi%2BNXx1qPgbK%2Fec%3D" alt="wxv_4369739391829639173" loading="lazy"/></p>
<p>我去，三下五除二就搞定了，贼快，这真的是能解燃眉之急~</p>
<p>接下来我准备给 Skywork 再上点强度。</p>
<p>openclaw最近不是非常火嘛，我就把openclaw的代码下载到了本地，然后以其根目录作为Skywork的工作空间。</p>
<p>并发布了任务：</p>
<p>prompt：读取当前文件夹里的核心代码和readme.md，理解这个项目。然后帮我做2件事：生成一份面向小白的 PPT；3. 制作一段 30 秒的openclaw宣传视频。</p>
<p>这个任务涉及到了跨模态理解和生成，难度还是比较高的。</p>
<p>但 Skywork 的表现我感觉还不错：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/556878f31d8445219d856b757fbf6777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=CItak02Xdpq0VE4Be%2FNuVehbn%2B8%3D" alt="wxv_4370345216277331976" loading="lazy"/></p>
<p>PPT 生成：它提取了openclaw里的核心能力，生成了一份 10 页的 PPT。</p>
<p>结构清晰，逻辑严密，还帮我配好了相关的插图。</p>
<p>视频生成：它根据相关信息，生成了一段30秒演示视频，展示了平台的核心能力，转场丝滑，而且用来做概念演示完全够用了。</p>
<p>如果对初始生成的PPT风格不满意，还可以让它调整，我让它优化成了包豪斯风格，指令遵循也很强，只是换了风格，里面的内容没有变。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e678a6befa84fbe99c2d022cab6885f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnooovpvKDluJ0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771159949&amp;x-signature=j5Tz2E35QTN4VzBxjzybUzGdb68%3D" alt="图片" loading="lazy"/></p>
<p>以前这些事儿，我肯定得折腾老半天。</p>
<p>现在，我口喷需求，Skywork 就帮我把 0 到 1 的工作全干了，我只需要在它的基础上做做微调就行。这就是真正的生产力~</p>
<h3 data-id="heading-0"/>
<h3 data-id="heading-1">「最后」</h3>
<p>体验下来，Skywork 桌面版给我的感觉是比较稳。</p>
<p>它没有那种为了炫技而加的花哨功能，每一个 Skill 都是奔着解决实际痛点去的。</p>
<p>特别是对于 Windows 用户来说，这简直就是及时雨。</p>
<p>要知道，Claude Cowork 目前只支持 Mac，这让广大 Windows 党（包括很多企业用户）只能干瞪眼。</p>
<p>Skywork 优先支持 Windows ，填补了这个巨大的空白。</p>
<p>虽然目前使用还需要“魔法上网”，但我觉得这并不妨碍它成为目前 Windows 平台上最值得尝试的桌面 AI Agent 之一。</p>
<p>特别是它还支持了 Gemini 和 Claude 这种世界顶级大脑，让它们接管你电脑会更放心一些，而且目前应该没有比这更强的组合了。</p>
<p>或许，要不了多久，各种办公软件的入口会变成一个统一的对话框，我们说，AI做。</p>
<p>我是袋鼠帝，一个致力于帮你把 AI 变成生产力的博主。</p>
<p>谢谢你耐心看完我的文章~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[吹爆 OpenClaw！一个人 +6 个 AI 助理，我再也不想招人了]]></title>    <link>https://juejin.cn/post/7604037348607180838</link>    <guid>https://juejin.cn/post/7604037348607180838</guid>    <pubDate>2026-02-08T11:03:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607180838" data-draft-id="7603721514203824137" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="吹爆 OpenClaw！一个人 +6 个 AI 助理，我再也不想招人了"/> <meta itemprop="keywords" content="Agent,OpenAI,AI编程"/> <meta itemprop="datePublished" content="2026-02-08T11:03:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            吹爆 OpenClaw！一个人 +6 个 AI 助理，我再也不想招人了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:03:44.000Z" title="Sun Feb 08 2026 11:03:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p><strong>一个人，6 个 AI 助理，财务、法务、内容、开发、增长全干了。月成本 200 刀（Claude Max 拉满）。</strong></p>
<p>不是画饼，不是概念图，是今天已经在跑的东西。打开我的 Telegram，你会看到 6 个"员工"在线待命——财务助理帮我算账、法务助理审合同、内容助理写文章、开发助理改代码、增长助理盯数据。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19787c597e1546618af534dfe50ae928~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=kqwWbiCASRkSQvIQ2kSfkqmAoOc%3D" alt="" loading="lazy"/></p>
<p>而我，只需要在群里@一下，活就干了。</p>
<p><strong>以前招一个实习生，月薪 5000，还得培训、管理、沟通。现在这 6 位，月成本 200 刀（约 1500 块），7×24 在线，不请假，不摸鱼，不需要团建。</strong></p>
<h2 data-id="heading-0">这不是 ChatGPT 套壳</h2>
<p>很多人一听"AI 助理"就觉得是 ChatGPT 包了层皮。不是的。</p>
<p>ChatGPT 是你问一句答一句的工具。我搭的这套系统，是一个<strong>有记忆、有分工、能主动干活的团队</strong>。</p>
<p>区别在哪？</p>
<ul>
<li>
<p><strong>有记忆</strong>：它记得我上周说了什么，记得我的偏好，记得项目进度</p>
</li>
<li>
<p><strong>有分工</strong>：财务的归财务，法务的归法务，不会串台</p>
</li>
<li>
<p><strong>能主动</strong>：不用我问，它会定时检查邮箱、扫日历、盯数据异常</p>
</li>
<li>
<p><strong>能协作</strong>：内容助理写完初稿，可以自动让增长助理优化标题</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5f70fd0c8f64836b673625841998551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=iqAhX9rsxA%2FOTcDGh5eS1w55RDU%3D" alt="" loading="lazy"/></p>
<p>这套东西叫 <strong>OpenClaw</strong>，一个开源的 AI Agent 框架。你可以理解为——<strong>给 AI 助理搭了一个公司组织架构</strong>。</p>
<h2 data-id="heading-1">6 个"员工"，各司其职</h2>
<p>我现在的团队长这样：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19a08916caf34202932af884be52ccb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=lqh04J%2FlBvJE2gI%2FVoHqJNw5xpY%3D" alt="" loading="lazy"/></p>
<p><strong>🐈⬛ 小墨（总助/ COO ）</strong> 我的核心助理，什么都管。日程、提醒、随手查个东西、帮我想个方案。相当于创业公司的 COO，哪里需要补哪里。</p>
<p><strong>💰 财务助理</strong> 记账、对账、算 ROI。我每个出海产品的收入支出，它帮我按项目分类，月底自动出报表。</p>
<p><strong>✍️ 内容助理</strong> 写公号、写推文、写产品文案。它熟悉我的写作风格，初稿质量已经能到 90 分，我改改就能发。</p>
<p><strong>💻 开发助理</strong> Review 代码、修 Bug、写脚本。我丢一个 GitHub Issue 过去，它能直接开干。</p>
<p><strong>📈 增长助理</strong> 盯 SEO 数据、分析流量、优化关键词。我的 9 个出海站点，每天的排名变化它都在看。</p>
<p><strong>⚖️ 法务助理</strong> 审合同、查条款、出海合规咨询。虽然不能替代律师，但 90%的常规问题它能搞定。</p>
<h2 data-id="heading-2">搭建只花了一天</h2>
<p>没有写一行代码。</p>
<p>OpenClaw 的设计理念就是<strong>配置驱动</strong>——你写一份"人设文件"，定义这个 Agent 是谁、擅长什么、能用什么工具，它就能上岗。</p>
<p>核心就三步：</p>
<ol>
<li>
<p><strong>装好 OpenClaw</strong>（一行命令）</p>
</li>
<li>
<p><strong>定义 Agent</strong>（写一个 Markdown 文件，描述角色和能力）</p>
</li>
<li>
<p><strong>绑定到消息渠道</strong>（Telegram、飞书、企微、QQ 都行）</p>
</li>
</ol>
<p>每个 Agent 有自己的记忆空间、工具权限、对话历史。财务助理看不到开发助理的代码，开发助理碰不到财务数据。<strong>跟真实公司的权限管理一模一样。</strong></p>
<h2 data-id="heading-3">一个真实的工作场景</h2>
<p>昨天下午，我在外面开会。手机上的操作：</p>
<ol>
<li>
<p>给内容助理发了一句：「帮我看看这周 AI 编程圈有什么热点，列 5 个选题」</p>
</li>
<li>
<p>给增长助理发了一句：「kirkify.net 这周流量怎么样？有没有新的关键词机会？」</p>
</li>
<li>
<p>给财务助理发了一句：「把上个月所有产品的 Stripe 收入汇总一下」</p>
</li>
</ol>
<p><strong>等我开完会，三份报告都躺在聊天里了。</strong></p>
<p>以前这些事，要么我自己花 2 小时做，要么找 3 个不同的人分别沟通。现在，30 秒发完消息，回来就看结果。</p>
<p><strong>这就是 杠杆 。不是省了一点时间，是省了一个量级。</strong></p>
<h2 data-id="heading-4">为什么是"一人公司"而不是"一个工具"</h2>
<p>工具是你去用它。</p>
<p><strong>一人公司 是它来找你。</strong></p>
<p>我的小墨每天早上会主动检查：有没有重要邮件？今天日历上有什么？出海站点有没有异常？如果有，它会直接发消息提醒我。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4d2f230126d49b19f3736689adfe69f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=JlDGbX2mLOQYkNvWA4Sia8LG1yw%3D" alt="" loading="lazy"/></p>
<p>增长助理发现某个关键词排名掉了，会主动告警。</p>
<p>内容助理到了发文时间，会主动提醒我该审稿了。</p>
<p><strong>你不是在"使用 AI"，你是在"管理一个团队"。</strong> 只不过这个团队的人力成本约等于零。</p>
<h2 data-id="heading-5">这套体系适合谁？</h2>
<p>说实话，不是所有人都需要这么搞。</p>
<p><strong>适合的人：</strong></p>
<ul>
<li>
<p>独立开发者/一人创业者——身兼数职，分身乏术</p>
</li>
<li>
<p>自由职业者——没有团队但需要团队的产出</p>
</li>
<li>
<p>小团队 Leader——想让 3 个人干出 10 个人的活</p>
</li>
<li>
<p>自媒体人——内容生产、数据分析、粉丝运营全靠自己</p>
</li>
</ul>
<p><strong>不适合的人：</strong></p>
<ul>
<li>
<p>对 AI 完全没感觉、不愿意花时间调试的</p>
</li>
<li>
<p>期望"一键搞定所有事"的——AI 是员工，不是魔法</p>
</li>
</ul>
<h2 data-id="heading-6">想自己搭一套？</h2>
<p>我知道你在想什么：这东西我也能搭吗？</p>
<p>能。</p>
<p>但说实话，从零折腾环境、踩部署的坑、搞通渠道对接、调试记忆系统……自己摸索可能要一两周，还不一定跑通。</p>
<p>所以我和两位搭档（俊哥、波特）一起，<strong>把完整的搭建流程录成了视频课</strong>：</p>
<p><strong>《OpenClaw 实战训练营：7 天打造你的 AI 私人助理》</strong></p>
<p>17 节视频课，从安装到上线，从人格定制到自动化场景，手把手带你跑通。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae9c120e42634b15b9ba8fa8970d8042~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=jWO%2BwVOOaNcdzAkVvTPs0FsOuL8%3D" alt="photo_2026-02-08_12-06-51.jpg" loading="lazy"/></p>
<p>课程亮点：</p>
<ul>
<li>
<p><strong>国内用户专属</strong>：网络问题、国产模型接入、飞书/企微/QQ 对接，全部覆盖</p>
</li>
<li>
<p><strong>纯实操</strong>：每节课都有可跟做的演示，拒绝纯理论</p>
</li>
<li>
<p><strong>三位讲师</strong>：前腾讯/字节/世界 500 强技术负责人，合计 20 年+一线经验</p>
</li>
<li>
<p><strong>永久有效</strong>：买一次，后续更新免费同步</p>
</li>
</ul>
<p>学完你会拥有：</p>
<ul>
<li>
<p>✅ 一个 7×24 在线的 AI 私人助理，手机随时下指令</p>
</li>
<li>
<p>✅ 打通飞书/企微/QQ/Telegram，在你常用的 App 里直接和 AI 对话</p>
</li>
<li>
<p>✅ 跑通至少 3 个自动化场景：定时推送、自动写文档、远程编程</p>
</li>
<li>
<p>✅ 会安装和开发 Skills，无限扩展 AI 的能力边界</p>
</li>
</ul>
<p>课程配套 GitHub 模板仓库、速查手册、FAQ 文档，开箱即用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c976e04b093459b9e30ca20d2700ed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153424&amp;x-signature=SoYNMwyJKnP7WjMVAdUZApHWPDg%3D" alt="" loading="lazy"/></p>
<hr/>
<p><strong>一个人干不过一个团队？那是以前。 现在，一个人 +6 个 AI，就是一个团队。</strong></p>
<p>工具就摆在那里。用不用，是你的事。</p>
<hr/>
<hr/>
<p>如果这篇对你有帮助，欢迎点赞、收藏、关注，你的支持是我持续输出的动力 ✨</p>
<hr/>
<p>我的其他平台账号和开源项目在个人主页中，欢迎交流 🤝</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 异步生存手册：给被 JS async/await 宠坏的全栈工程师]]></title>    <link>https://juejin.cn/post/7603688142005354505</link>    <guid>https://juejin.cn/post/7603688142005354505</guid>    <pubDate>2026-02-08T11:54:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005354505" data-draft-id="7603946518372581414" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 异步生存手册：给被 JS async/await 宠坏的全栈工程师"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-02-08T11:54:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="光头老石"/> <meta itemprop="url" content="https://juejin.cn/user/2963939077135006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 异步生存手册：给被 JS async/await 宠坏的全栈工程师
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939077135006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    光头老石
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:54:31.000Z" title="Sun Feb 08 2026 11:54:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>还记得当初被 JavaScript 的 <code>async/await</code> 惊艳到的时刻吗？一个 <code>await</code>，就把那些繁琐的回调地狱（Callback Hell）变成了优雅的同步代码，让 Web UI 始终保持流畅。你可能心里暗想：“Python 要是有这玩意儿就好了。”</p>
<p>恭喜你，Python 3.5+ 不仅有了，而且在 FastAPI 的加持下，它正以一种前所未有的姿态，挑战着高并发 Web 服务的极限。然而，当你把 JS 里的异步直接平移到 Python，很可能会发现：<strong>“为什么我的 Python 异步，没我想象的那么快？”</strong></p>
<p>别急，这本“生存手册”就是为你准备的。</p>
<h3 data-id="heading-0">1. 语法很像，但“脾气”有点不同</h3>
<p>首先，我们要承认，Python 的 <code>async/await</code> 在语法层面上，和 ES6 简直是双胞胎：</p>
<p><strong>JavaScript (React/Node.js):</strong></p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/users/<span class="hljs-subst">${userId}</span>`</span>); <span class="hljs-comment">// 网络请求</span>
    <span class="hljs-keyword">const</span> orders = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/orders?user=<span class="hljs-subst">${user.id}</span>`</span>); <span class="hljs-comment">// 依赖上一个结果</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">user</span>: <span class="hljs-keyword">await</span> user.<span class="hljs-title function_">json</span>(), <span class="hljs-attr">orders</span>: <span class="hljs-keyword">await</span> orders.<span class="hljs-title function_">json</span>() };
}
</code></pre>
<p><strong>Python (FastAPI):</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> httpx <span class="hljs-comment"># 异步 HTTP 客户端</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_data</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> httpx.AsyncClient() <span class="hljs-keyword">as</span> client:
        user_resp = <span class="hljs-keyword">await</span> client.get(<span class="hljs-string">f"http://api.internal/users/<span class="hljs-subst">{user_id}</span>"</span>) <span class="hljs-comment"># 网络请求</span>
        user_data = user_resp.json()
        orders_resp = <span class="hljs-keyword">await</span> client.get(<span class="hljs-string">f"http://api.internal/orders?user=<span class="hljs-subst">{user_data[<span class="hljs-string">'id'</span>]}</span>"</span>) <span class="hljs-comment"># 依赖上一个结果</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"user"</span>: user_data, <span class="hljs-string">"orders"</span>: orders_resp.json()}
</code></pre>
<p>你看，代码逻辑几乎一模一样。一个 <code>await</code>，就能让你在等待网络请求、数据库查询、文件读写（这些都是 I/O 密集型操作）时，把 CPU 的控制权交出去，让 Event Loop 去处理别的请求。</p>
<p><strong>核心思想：</strong> 异步不是让你的代码跑得更快，而是让你的<strong>服务器在等待 I/O 时不再发呆，从而能同时处理更多的请求。</strong></p>
<h3 data-id="heading-1">2. 警惕“伪异步”：Python 异步的隐形杀手</h3>
<p>当你兴奋地给 FastAPI 的路由加上 <code>async def</code>，并开始调试时，如果发现服务的并发能力并没有显著提升，甚至有时候还会卡顿，那很可能就是你遇到了“伪异步”。</p>
<p><strong>什么是“伪异步”？</strong>
简单来说，就是在异步函数 <code>async def</code> 内部，执行了<strong>同步阻塞</strong>的操作。</p>
<p>比如，如果你在 <code>async def</code> 函数里使用了：</p>
<ul>
<li><code>time.sleep(2)</code>（模拟耗时操作，但它是阻塞的）</li>
<li><code>requests.get('...')</code>（Python 传统同步 HTTP 库）</li>
<li><code>json.dumps(huge_object)</code>（处理超大 JSON 对象的 CPU 密集型操作）</li>
<li>某些数据库 ORM 的同步版本方法（如 <code>session.query().all()</code>）</li>
</ul>
<p>这些操作，无论你外层用多少 <code>async/await</code> 包装，它都会<strong>直接阻塞整个事件循环（Event Loop）</strong>。你可以把它想象成在 JS 的 <code>async</code> 函数里直接调用一个同步的、耗时 5 秒的循环计算——那你的 Node.js 服务也会瞬间卡死。</p>
<p><strong>生存法则一：异步函数中，只用异步库。</strong>
当你在 <code>async def</code> 函数中使用任何可能阻塞的 I/O 操作时，请务必寻找对应的<strong>异步版本库</strong>。例如：</p>
<ul>
<li>用 <code>asyncio.sleep()</code> 替代 <code>time.sleep()</code>。</li>
<li>用 <code>httpx</code> 或 <code>aiohttp</code> 替代 <code>requests</code>。</li>
<li>用 <code>asyncpg</code>、<code>motor</code>（MongoDB）等异步数据库驱动，或者 ORM（如 <code>SQLAlchemy</code> 2.0+）的异步模式。</li>
</ul>
<h3 data-id="heading-2">3. CPU 密集型任务的“逃生舱”</h3>
<p>异步编程擅长处理 I/O 密集型任务，但它对 <strong>CPU 密集型任务</strong>却无能为力。因为 CPU 密集型任务的瓶颈在于 CPU 本身，而不是等待。</p>
<p>如果你在 <code>async def</code> 函数中执行一个长达几秒的复杂计算（比如大量的字符串处理、图像处理、机器学习推理等），它依然会霸占 Event Loop，导致其他等待中的异步任务无法得到调度。</p>
<p><strong>生存法则二：计算任务，交给线程池或进程池。</strong></p>
<p>FastAPI 框架非常聪明。如果你定义的路由函数是普通的 <code>def</code>，FastAPI 会自动将它放到一个独立的<strong>线程池</strong>中运行，这样就不会阻塞主 Event Loop。</p>
<p>但如果你的计算逻辑就在 <code>async def</code> 内部，且你不想让它阻塞 Event Loop，你就需要手动使用 <code>run_in_executor</code> 来将它“卸载”到线程池或进程池中：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor

executor = ThreadPoolExecutor(max_workers=<span class="hljs-number">4</span>) <span class="hljs-comment"># 可以配置线程数</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">very_heavy_cpu_task</span>(<span class="hljs-params">data</span>):
    <span class="hljs-comment"># 模拟耗时计算</span>
    result = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">range</span>(data))
    <span class="hljs-keyword">return</span> result

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/process_data"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-comment"># 将 CPU 密集型任务提交到线程池执行，不阻塞 Event Loop</span>
    result = <span class="hljs-keyword">await</span> asyncio.get_event_loop().run_in_executor(
        executor, very_heavy_cpu_task, data
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"result"</span>: result}
</code></pre>
<h3 data-id="heading-3">4. 从 WSGI 到 ASGI：后端架构的深度进化</h3>
<p>你可能已经用过 Flask 或 Django，它们是基于 <strong>WSGI (Web Server Gateway Interface)</strong> 标准的。WSGI 的设计理念是“请求-响应”模型，通常每个请求会占用一个独立的线程。</p>
<p>而 FastAPI 是基于 <strong>ASGI (Asynchronous Server Gateway Interface)</strong> 标准的。ASGI 允许一个进程内的 Event Loop 高效调度成千上万个轻量级协程。这就像：</p>
<ul>
<li><strong>WSGI：</strong> 每一个订单（请求）都需要一个专属服务员（线程）从头跟到尾。服务员一旦去仓库（数据库 I/O），就得等在仓库门口。</li>
<li><strong>ASGI：</strong> 一个总调度员（Event Loop）同时管理很多订单。当一个订单需要等仓库（I/O）时，调度员会立刻去处理下一个订单，等仓库那边叫他了再回来处理。</li>
</ul>
<p>这种底层架构的演进，让 Python 在处理长连接、流式数据（如 LLM 的流式输出）、高并发 API 等现代 Web 场景时，拥有了和 Node.js 媲美的能力。</p>
<h3 data-id="heading-4">写在最后：别让你的 Python 异步，输在“等待”上</h3>
<p>被 JS 的 <code>async/await</code> 宠坏，是好事。它为你打开了非阻塞编程的大门。当你带着这种直觉来到 Python，并结合 FastAPI 的工程实践，你将发现 Python 在高并发服务领域的巨大潜力。</p>
<p>记住这本“生存手册”的核心：<strong>异步不是让你写代码更酷，而是让你的服务器在面对 I/O 等待时，能够更“聪明”地工作。</strong> 那些被浪费在等待上的 CPU 周期，如今都能被榨取出最大的价值。</p>
<p>现在，是时候在你的 Python 服务里，真正释放异步的力量了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hook 机制实战:让 ClaudeCode 主动通知你]]></title>    <link>https://juejin.cn/post/7603911453704159275</link>    <guid>https://juejin.cn/post/7603911453704159275</guid>    <pubDate>2026-02-08T10:05:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704159275" data-draft-id="7603911453704126507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hook 机制实战:让 ClaudeCode 主动通知你"/> <meta itemprop="keywords" content="Claude,AI编程"/> <meta itemprop="datePublished" content="2026-02-08T10:05:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hook 机制实战:让 ClaudeCode 主动通知你
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:05:40.000Z" title="Sun Feb 08 2026 10:05:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>你有没有遇到过这样的场景?</p>
<blockquote>
<p><strong>场景 1: 多终端协作</strong></p>
<pre><code class="hljs language-makefile" lang="makefile">[你开了 3 个终端,让 AI 并行处理任务]
<span class="hljs-section">终端1: 正在重构用户模块...</span>
<span class="hljs-section">终端2: 正在添加测试...</span>
<span class="hljs-section">终端3: 正在优化性能...</span>

[20分钟后,你回来检查]
<span class="hljs-section">你: "等等,哪个任务完成了?我怎么知道?"</span>
[需要逐个终端查看,效率低下]
</code></pre>
</blockquote>
<blockquote>
<p><strong>场景 2: 需要人工确认的关键操作</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">你: <span class="hljs-string">"帮我部署到生产环境"</span>

<span class="hljs-symbol">AI:</span> [完成打包、测试]
<span class="hljs-symbol">AI:</span> <span class="hljs-string">"所有检查通过,准备部署到生产环境"</span>
<span class="hljs-symbol">AI:</span> ⚠️  [等待用户确认] 请输入 <span class="hljs-comment">'deploy' 继续,或 'abort' 取消</span>

[此时你需要收到通知,而不是一直盯着屏幕]
</code></pre>
</blockquote>
<blockquote>
<p><strong>场景 3: 代码质量保障</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet">你: <span class="hljs-string">"实现用户登录功能"</span>

<span class="hljs-symbol">AI:</span> [生成代码...]
<span class="hljs-symbol">AI:</span> <span class="hljs-string">"✅ 代码已生成"</span>

[你忘记执行代码审查...]
[代码质量有问题,需要返工]
</code></pre>
</blockquote>
<p>这些问题的根源在于:</p>
<ul>
<li><strong>缺少通知机制</strong>: 任务完成后无法及时感知,需要人工盯着</li>
<li><strong>缺少自动化流程</strong>: 重复性工作需要手动执行,容易遗漏</li>
</ul>
<p><strong>答案是</strong>: <strong>Hook 机制</strong></p>
<p>Hook(钩子)是 Claude Code 提供的事件触发机制,允许你在特定事件发生时自动执行自定义脚本或 LLM 评估。Claude Code 支持 12 种 Hook 事件类型,常见的有:</p>
<ul>
<li><strong>Stop</strong>: Claude 完成响应时触发,可用于验证任务完成、自动继续多轮工作</li>
<li><strong>Notification</strong>: 通知发送时触发,可用于桌面/Slack 通知</li>
<li><strong>PreToolUse</strong>: 工具执行前触发,可用于权限控制、参数修改</li>
<li><strong>PostToolUse</strong>: 工具成功执行后触发,可用于自动代码格式化、运行 lint</li>
<li><strong>UserPromptSubmit</strong>: 用户提交提示词前触发,可用于验证/过滤输入</li>
</ul>
<p><strong>核心理念</strong>: <strong>让 AI 在关键时刻主动通知你,而不是被动等待</strong></p>
<p>本文将深入探讨 Claude Code 的 Hook 机制,让你的 AI 辅助开发体验更加自动化和高效。</p>
<p>阅读本文后,你将学会:</p>
<ul>
<li>理解 Hook 的工作原理和配置方式</li>
<li>掌握所有 12 种 Hook 事件类型</li>
<li>配置任务完成自动通知和自动化工作流</li>
<li>掌握 Hook 的最佳实践</li>
</ul>
<hr/>
<h2 data-id="heading-1">一、Hook 机制基础</h2>
<h3 data-id="heading-2">1.1 Hook 的工作原理</h3>
<p>**Hook(钩子)**是 Claude Code 提供的事件触发机制,允许你在特定事件发生时自动执行自定义脚本或 LLM 评估。</p>
<p><strong>核心概念</strong>:</p>
<pre><code class="hljs">事件发生 → 触发 Hook → 执行脚本/LLM评估 → 返回结果 → 继续或中断
</code></pre>
<p><strong>Hook 的生命周期</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 注册 Hook
   ↓
<span class="hljs-bullet">2.</span> 监听事件
   ↓
<span class="hljs-bullet">3.</span> 事件触发
   ↓
<span class="hljs-bullet">4.</span> 执行 Hook 脚本/LLM评估
   ↓
<span class="hljs-bullet">5.</span> 获取返回值
   ↓
<span class="hljs-bullet">6.</span> 根据返回值决定是否继续(可阻止的 Hook)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1973aa18d13243018865d8f634278790~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771149943&amp;x-signature=UX7RGpg%2FRYefp6TS32MfmEN6osk%3D" alt="05-01-hook-lifecycle.png" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 Hook 配置方式</h3>
<p>Hook 可以通过两种方式配置:</p>
<h4 data-id="heading-4">方式 1: 通过 <code>/hooks</code> 命令配置(交互式)</h4>
<p>在 Claude Code 交互式终端中输入:</p>
<pre><code class="hljs language-bash" lang="bash">&gt; /hooks
</code></pre>
<p>这会打开 Hook 管理界面,你可以:</p>
<ul>
<li>查看已配置的 Hook</li>
<li>添加新的 Hook 规则</li>
<li>编辑或删除现有 Hook</li>
</ul>
<h4 data-id="heading-5">方式 2: 通过 JSON 配置文件(推荐)</h4>
<p><strong>全局配置</strong> (<code>~/.claude/settings.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Check if all tasks complete. $ARGUMENTS"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"permission_prompt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"notify-send 'Claude Code' 'Permission needed'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx prettier --write"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>项目级配置</strong> (<code>.claude/settings.json</code> 或 <code>.claude/settings.local.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/validate-bash.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>配置优先级</strong>:</p>
<pre><code class="hljs">项目配置 &gt; 全局配置 &gt; 默认策略
</code></pre>
<h3 data-id="heading-6">1.3 Hook 配置类型</h3>
<p>Hook 支持三种配置类型:</p>

























<table><thead><tr><th align="left">类型</th><th align="left">用途</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left"><strong>command</strong></td><td align="left">执行 shell 脚本</td><td align="left"><code>{"type": "command", "command": "./script.sh"}</code></td></tr><tr><td align="left"><strong>prompt</strong></td><td align="left">快速 LLM 评估</td><td align="left"><code>{"type": "prompt", "prompt": "Check if done"}</code></td></tr><tr><td align="left"><strong>agent</strong></td><td align="left">完整代理验证</td><td align="left"><code>{"type": "agent", "prompt": "Run tests"}</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">二、Hook 事件类型详解</h2>
<p>Claude Code 支持 12 种 Hook 事件类型,以下是完整说明:</p>
<h3 data-id="heading-8">2.1 Hook 类型总览</h3>



















































































<table><thead><tr><th align="left">事件名称</th><th align="left">触发时机</th><th align="center">可阻止</th><th align="left">用途分类</th></tr></thead><tbody><tr><td align="left"><strong>SessionStart</strong></td><td align="left">会话开始/恢复</td><td align="center">否</td><td align="left">初始化/上下文注入</td></tr><tr><td align="left"><strong>UserPromptSubmit</strong></td><td align="left">用户提交提示词前</td><td align="center">是</td><td align="left">验证/过滤</td></tr><tr><td align="left"><strong>PreToolUse</strong></td><td align="left">工具执行前</td><td align="center">是</td><td align="left">权限控制/参数修改</td></tr><tr><td align="left"><strong>PermissionRequest</strong></td><td align="left">权限对话显示时</td><td align="center">是</td><td align="left">自动化权限决策</td></tr><tr><td align="left"><strong>PostToolUse</strong></td><td align="left">工具成功执行后</td><td align="center">否</td><td align="left">格式化/验证</td></tr><tr><td align="left"><strong>PostToolUseFailure</strong></td><td align="left">工具执行失败后</td><td align="center">否</td><td align="left">错误处理/告警</td></tr><tr><td align="left"><strong>Notification</strong></td><td align="left">通知发送时</td><td align="center">否</td><td align="left">桌面/Slack 通知</td></tr><tr><td align="left"><strong>SubagentStart</strong></td><td align="left">子代理生成时</td><td align="center">否</td><td align="left">上下文注入</td></tr><tr><td align="left"><strong>SubagentStop</strong></td><td align="left">子代理完成时</td><td align="center">是</td><td align="left">结果验证</td></tr><tr><td align="left"><strong>Stop</strong></td><td align="left">Claude 完成响应时</td><td align="center">是</td><td align="left">自动继续/验证完成</td></tr><tr><td align="left"><strong>PreCompact</strong></td><td align="left">上下文压缩前</td><td align="center">否</td><td align="left">备份/清理</td></tr><tr><td align="left"><strong>SessionEnd</strong></td><td align="left">会话结束时</td><td align="center">否</td><td align="left">清理/日志</td></tr></tbody></table>
<h3 data-id="heading-9">2.2 详细说明</h3>
<h4 data-id="heading-10">SessionStart</h4>
<p><strong>触发来源</strong>: <code>startup</code>(新建) | <code>resume</code>(恢复) | <code>clear</code>(/clear后) | <code>compact</code>(压缩后)</p>
<p><strong>用途</strong>: 加载开发上下文、设置环境变量、初始化工具链</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SessionStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"echo 'Session started'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-11">UserPromptSubmit</h4>
<p><strong>用途</strong>: 验证提示词、阻止敏感请求、添加动态上下文</p>
<p><strong>输出控制</strong>: 退出码 2 或 <code>"decision": "block"</code> 可阻止提示</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"UserPromptSubmit"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/validate-prompt.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-12">PreToolUse</h4>
<p><strong>支持匹配</strong>: <code>Bash</code> | <code>Edit</code> | <code>Write</code> | <code>Read</code> | <code>Glob</code> | <code>Grep</code> | <code>mcp__*</code></p>
<p><strong>决策类型</strong>: <code>allow</code> | <code>deny</code> | <code>ask</code></p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/validate-bash.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-13">PermissionRequest</h4>
<p><strong>用途</strong>: 在 CI/CD 或无头模式下自动批准/拒绝权限请求</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PermissionRequest"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/auto-permission.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-14">PostToolUse</h4>
<p><strong>用途</strong>: 自动代码格式化、运行 lint、日志记录</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx prettier --write"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-15">PostToolUseFailure</h4>
<p><strong>用途</strong>: 错误日志记录、发送告警、故障诊断</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUseFailure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/log-error.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-16">Notification</h4>
<p><strong>通知类型</strong>: <code>permission_prompt</code> | <code>idle_prompt</code> | <code>auth_success</code> | <code>elicitation_dialog</code></p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"permission_prompt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"notify-send 'Claude Code' 'Permission needed'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-17">SubagentStart</h4>
<p><strong>匹配值</strong>: <code>Bash</code> | <code>Explore</code> | <code>Plan</code> 或自定义代理名</p>
<p><strong>用途</strong>: 为子代理注入安全策略和上下文</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SubagentStart"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/inject-context.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-18">SubagentStop</h4>
<p><strong>用途</strong>: 验证子代理结果,决定是否继续/停止</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SubagentStop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Verify subagent result: $ARGUMENTS"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-19">Stop</h4>
<p><strong>用途</strong>: 验证任务完成、自动继续多轮工作</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Check if all tasks complete. $ARGUMENTS"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-20">PreCompact</h4>
<p><strong>触发器</strong>: <code>manual</code>(/compact命令) | <code>auto</code>(自动压缩)</p>
<p><strong>用途</strong>: 备份重要上下文、清理临时文件</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreCompact"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/backup-context.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-21">SessionEnd</h4>
<p><strong>结束原因</strong>: <code>clear</code> | <code>logout</code> | <code>prompt_input_exit</code> | <code>other</code></p>
<p><strong>用途</strong>: 清理临时文件、保存会话统计</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"SessionEnd"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./.claude/hooks/cleanup.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">三、实战案例</h2>
<h3 data-id="heading-23">3.1 案例 1: 任务完成自动通知</h3>
<p><strong>需求</strong>: 多终端协作时,任务完成自动发送系统通知</p>
<p><strong>实现</strong>: 使用 <code>Stop</code> Hook 触发通知</p>
<p><strong>步骤 1: 创建通知脚本</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ~/.claude/hooks/notify-complete.sh</span>
<span class="hljs-comment">#!/bin/bash</span>

<span class="hljs-comment"># 根据操作系统选择通知方式</span>
OS=$(<span class="hljs-built_in">uname</span> -s)

<span class="hljs-keyword">case</span> <span class="hljs-string">"<span class="hljs-variable">$OS</span>"</span> <span class="hljs-keyword">in</span>
    Darwin)  <span class="hljs-comment"># macOS</span>
        osascript -e <span class="hljs-string">'display notification "任务完成" with title "Claude Code"'</span>
        ;;
    Linux)
        notify-send <span class="hljs-string">"Claude Code"</span> <span class="hljs-string">"✅ 任务完成"</span>
        ;;
    *)
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"Unsupported OS: <span class="hljs-variable">$OS</span>"</span>
        ;;
<span class="hljs-keyword">esac</span>

<span class="hljs-built_in">exit</span> 0
</code></pre>
<p><strong>步骤 2: 赋予执行权限</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x ~/.claude/hooks/notify-complete.sh
</code></pre>
<p><strong>步骤 3: 配置 Hook</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~/.claude/hooks/notify-complete.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-24">3.2 案例 2: 权限请求自动通知</h3>
<p><strong>需求</strong>: 当需要权限确认时,自动发送通知提醒</p>
<p><strong>实现</strong>: 使用 <code>Notification</code> Hook</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Notification"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"permission_prompt"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"notify-send -u critical 'Claude Code' '需要权限确认'"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-25">3.3 案例 3: 代码自动格式化</h3>
<p><strong>需求</strong>: 每次编辑或写入文件后,自动运行格式化工具</p>
<p><strong>实现</strong>: 使用 <code>PostToolUse</code> Hook</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx prettier --write $ARGUMENTS"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>注意</strong>: 使用 <code>"async": true</code> 让格式化在后台执行,不阻塞主流程。</p>
<h3 data-id="heading-26">3.4 案例 4: 任务完成验证</h3>
<p><strong>需求</strong>: 任务完成后自动验证是否所有任务都已完成</p>
<p><strong>实现</strong>: 使用 <code>Stop</code> Hook + <code>prompt</code> 类型</p>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prompt"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"检查以下任务是否全部完成:\n$ARGUMENTS\n如果还有未完成的任务,请继续执行。"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">四、最佳实践</h2>
<h3 data-id="heading-28">4.1 Hook 配置最佳实践</h3>
<p><strong>✅ DO(推荐做法)</strong></p>
<ol>
<li><strong>使用项目级配置</strong>: 项目特定的 Hook 放在 <code>.claude/settings.local.json</code>,不提交到 Git</li>
<li><strong>异步执行耗时操作</strong>: 对于格式化、lint 等耗时操作,使用 <code>"async": true</code></li>
<li><strong>合理使用 matcher</strong>: 精确匹配工具类型,避免不必要的 Hook 触发</li>
<li><strong>错误处理</strong>: Hook 脚本应包含错误处理,避免因 Hook 失败影响主流程</li>
<li><strong>日志记录</strong>: 重要操作记录日志,便于调试和审计</li>
</ol>
<p><strong>❌ DON'T(避免的做法)</strong></p>
<ol>
<li><strong>Hook 执行时间过长</strong>: Hook 脚本应快速执行(建议 &lt; 5 秒),耗时操作使用异步</li>
<li><strong>阻塞关键流程</strong>: 可阻止的 Hook(如 <code>PreToolUse</code>)应谨慎使用,避免误拦截</li>
<li><strong>敏感信息泄露</strong>: Hook 脚本中不要硬编码敏感信息,使用环境变量</li>
<li><strong>过度依赖 Hook</strong>: Hook 是辅助工具,不应替代正常的权限管理和代码审查流程</li>
</ol>
<h3 data-id="heading-29">4.2 Hook 类型选择指南</h3>













































<table><thead><tr><th align="left">场景</th><th align="left">推荐 Hook</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>任务完成通知</strong></td><td align="left"><code>Stop</code></td><td align="left">Claude 完成响应时触发</td></tr><tr><td align="left"><strong>权限请求通知</strong></td><td align="left"><code>Notification</code></td><td align="left">权限对话显示时触发</td></tr><tr><td align="left"><strong>代码自动格式化</strong></td><td align="left"><code>PostToolUse</code></td><td align="left">工具成功执行后触发</td></tr><tr><td align="left"><strong>危险命令拦截</strong></td><td align="left"><code>PreToolUse</code></td><td align="left">工具执行前拦截</td></tr><tr><td align="left"><strong>输入验证</strong></td><td align="left"><code>UserPromptSubmit</code></td><td align="left">用户提交前验证</td></tr><tr><td align="left"><strong>错误告警</strong></td><td align="left"><code>PostToolUseFailure</code></td><td align="left">工具失败时告警</td></tr><tr><td align="left"><strong>会话初始化</strong></td><td align="left"><code>SessionStart</code></td><td align="left">会话开始时加载上下文</td></tr></tbody></table>
<h3 data-id="heading-30">4.3 配置管理最佳实践</h3>
<p><strong>1. 配置文件版本管理</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 项目级配置提交到 Git</span>
git add .claude/settings.json
git commit -m <span class="hljs-string">"feat: add Claude Code hooks config"</span>

<span class="hljs-comment"># 全局配置不提交(个人设置)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"~/.claude/settings.json"</span> &gt;&gt; ~/.gitignore_global
</code></pre>
<p><strong>2. Hook 脚本组织</strong></p>
<pre><code class="hljs language-python" lang="python">.claude/
├── settings.json              <span class="hljs-comment"># 项目配置(提交到 Git)</span>
├── settings.local.json        <span class="hljs-comment"># 本地配置(不提交)</span>
└── hooks/
    ├── notify-complete.sh     <span class="hljs-comment"># 通知脚本</span>
    ├── validate-bash.sh       <span class="hljs-comment"># 验证脚本</span>
    └── auto-<span class="hljs-built_in">format</span>.sh         <span class="hljs-comment"># 格式化脚本</span>
</code></pre>
<p><strong>3. 调试技巧</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试 Hook 脚本独立运行</span>
~/.claude/hooks/notify-complete.sh

<span class="hljs-comment"># 查看 Hook 执行日志</span>
<span class="hljs-built_in">tail</span> -f ~/.claude/logs/hook-execution.log

<span class="hljs-comment"># 使用 shellcheck 检查脚本语法</span>
shellcheck ~/.claude/hooks/*.sh
</code></pre>
<h3 data-id="heading-31">4.4 性能优化</h3>
<p><strong>1. 异步执行</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PostToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Edit|Write"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./format.sh"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"async"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>2. 精确匹配</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"PreToolUse"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matcher"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bash"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 只匹配 Bash,不匹配其他工具</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>3. 快速退出</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># Hook 脚本开头快速检查,不满足条件立即退出</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> != <span class="hljs-string">"important-task"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>
<span class="hljs-comment"># 继续执行...</span>
</code></pre>
<hr/>
<h2 data-id="heading-32">五、常见问题与调试</h2>
<h3 data-id="heading-33">5.1 Hook 未触发</h3>
<p><strong>排查步骤</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查配置文件格式</span>
jq . ~/.claude/settings.json

<span class="hljs-comment"># 2. 检查 Hook 脚本权限</span>
<span class="hljs-built_in">ls</span> -l ~/.claude/hooks/*.sh
<span class="hljs-built_in">chmod</span> +x ~/.claude/hooks/*.sh

<span class="hljs-comment"># 3. 测试脚本独立运行</span>
~/.claude/hooks/notify-complete.sh

<span class="hljs-comment"># 4. 查看 Hook 执行日志</span>
<span class="hljs-built_in">tail</span> -f ~/.claude/logs/hook-execution.log
</code></pre>
<h3 data-id="heading-34">5.2 Hook 执行失败</h3>
<p><strong>调试技巧</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 添加调试输出</span>
<span class="hljs-built_in">set</span> -x
<span class="hljs-comment"># 脚本内容...</span>
<span class="hljs-built_in">set</span> +x

<span class="hljs-comment"># 2. 重定向错误到日志</span>
./hook.sh 2&gt;&gt; ~/.claude/logs/hook-errors.log

<span class="hljs-comment"># 3. 使用 shellcheck 检查语法</span>
shellcheck ~/.claude/hooks/*.sh
</code></pre>
<h3 data-id="heading-35">5.3 性能问题</h3>
<p><strong>优化方法</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 异步执行耗时操作</span>
<span class="hljs-built_in">command</span> &amp;  <span class="hljs-comment"># 后台执行</span>

<span class="hljs-comment"># 2. 添加超时限制</span>
<span class="hljs-built_in">timeout</span> 5s ./slow-script.sh

<span class="hljs-comment"># 3. 快速退出非关键场景</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$condition</span>"</span> != <span class="hljs-string">"important"</span> ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">exit</span> 0
<span class="hljs-keyword">fi</span>
</code></pre>
<hr/>
<h2 data-id="heading-36">六、总结</h2>
<h3 data-id="heading-37">6.1 核心要点回顾</h3>
<p>通过本文,我们深入探讨了 Claude Code 的 Hook 机制:</p>
<p><strong>Hook 机制</strong></p>
<ul>
<li><strong>原理</strong>: 事件驱动,在特定时机自动执行脚本或 LLM 评估</li>
<li><strong>类型</strong>: 12 种 Hook 事件类型,覆盖完整的开发生命周期</li>
<li><strong>配置</strong>: 通过 <code>/hooks</code> 命令或 JSON 配置文件</li>
<li><strong>应用</strong>: 智能通知、自动化 QA、安全拦截、工作流自动化</li>
</ul>
<h3 data-id="heading-38">6.2 快速配置指南</h3>
<p><strong>第 1 步: 创建 Hook 脚本</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/.claude/hooks

<span class="hljs-built_in">cat</span> &gt; ~/.claude/hooks/notify-complete.sh &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
notify-send <span class="hljs-string">"Claude Code"</span> <span class="hljs-string">"✅ 任务完成"</span>
<span class="hljs-built_in">exit</span> 0
EOF

<span class="hljs-built_in">chmod</span> +x ~/.claude/hooks/notify-complete.sh
</code></pre>
<p><strong>第 2 步: 配置 Hook</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"command"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~/.claude/hooks/notify-complete.sh"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>第 3 步: 验证配置</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 Claude Code</span>
claude

<span class="hljs-comment"># 执行一个任务,完成后应该收到通知</span>
&gt; 帮我创建一个 hello.txt 文件
</code></pre>
<hr/>
<h2 data-id="heading-39">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fhooks" target="_blank" title="https://code.claude.com/docs/zh-CN/hooks" ref="nofollow noopener noreferrer">Claude Code Hooks 参考</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fshellguide.html" target="_blank" title="https://google.github.io/styleguide/shellguide.html" ref="nofollow noopener noreferrer">Bash Scripting Best Practices</a></li>
</ul>
<hr/>
<blockquote>
<p>💡 <strong>思考题</strong>: 你的开发流程中,有哪些操作可以通过 Hook 自动化?如果让你设计一个 Hook,你会选择什么触发时机?</p>
</blockquote>
<p>🔗 <strong>相关文章</strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7603219519666749459" target="_blank" title="https://juejin.cn/post/7603219519666749459">上一篇: 权限管理实战</a></li>
</ul>
<hr/>
<p><em>如果这篇文章对你有帮助,欢迎点赞、收藏、分享!有任何问题或建议,欢迎在评论区留言讨论。让我们一起学习,一起成长!</em></p>
<p><em>也欢迎访问我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>发现更多宝藏资源</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MCP (Model Context Protocol) 技术理解 - 第一篇]]></title>    <link>https://juejin.cn/post/7604037348607082534</link>    <guid>https://juejin.cn/post/7604037348607082534</guid>    <pubDate>2026-02-08T10:07:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607082534" data-draft-id="7593171168259571721" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MCP (Model Context Protocol) 技术理解 - 第一篇"/> <meta itemprop="keywords" content="后端,AIGC,MCP"/> <meta itemprop="datePublished" content="2026-02-08T10:07:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想用offer打牌"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MCP (Model Context Protocol) 技术理解 - 第一篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想用offer打牌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:07:19.000Z" title="Sun Feb 08 2026 10:07:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>我一直为网上没有很好且通俗易懂的MCP技术文档而烦恼，所以我通过记录自己查阅官方文档来写一份通俗易懂的MCP技术文档，从架构到实战，既有技术深度，又能让小白一听就懂。这对我是一种挑战，如果笔误可以在评论区指出，谢谢！</p>
<h2 data-id="heading-1">MCP是什么</h2>
<p>Model Context Protocol (MCP) 是 Anthropic 于 2024 年 11 月发布的<strong>开放标准协议</strong>,旨在为 LLM 应用提供统一的方式来连接外部数据源和工具。它被称为"AI 的 type-c接口"。</p>
<p>但是我觉得如果就将它比喻成type-c接口，我觉得太草率。</p>
<p>我们先标出重点，<strong>MCP它是一种协议，一种标准！</strong> MCP是一种协议，MCP是一种协议，MCP是一种协议，重要的事情说三遍。</p>
<p>那么它到底是干了什么？这里直接通俗易懂来说吧，<strong>假如说LLM是大脑，那么LLM可以通过MCP协议长出手脚</strong>，可以做到访问资源，调用工具，预制模板的事情等。</p>
<p>为什么这么说？在古早时期，也就是Chat-GPT横空出世的时候，他也就是一个简单的chatbot，靠着以往的知识库回答问题，而不能实时去访问web上的资源和你自己的知识库，也不能去帮你发邮件，订航班等等。有了MCP，我们就有了一种标准去做这些事。我们只要去实现了标准MCP的接口，数据发送和接收都是解析相同格式的数据，那么按照理论来说，我们就能让AI应用帮我们做任何事情(当前不讨论物理世界的劳动)。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7de8c446fe4c4e9f8572ca5b9ca4a1c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771150068&amp;x-signature=FS2HAhCeUY3J0dcLOin0YMVC5Z8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">MCP到底解决什么问题？</h2>
<p>我们上面讨论了MCP能帮我们实现的事情，那么MCP它本质上到底解决了什么问题？难道我们以前没有MCP就无法查看web上面的资源或者知识库吗？让我们下面一起讨论一下。</p>
<p>传统上，我们也是可以实现MCP的功能，但是这样有个问题，每个企业所创造出来的软件或者说应用程序，它都不是一个统一的接口来进行tool calling的，都是<strong>自成一派</strong>。这样就会导致集成非常繁杂。</p>
<p>上代码来解释一下这种现象？</p>
<p><strong>传统方式的痛点:</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 每个集成都需要自定义代码</span>
<span class="hljs-keyword">if</span> service == <span class="hljs-string">"github"</span>:
    github_client = GitHubClient(token)
    data = github_client.get_issues()
<span class="hljs-keyword">elif</span> service == <span class="hljs-string">"slack"</span>:
    slack_client = SlackClient(token)
    data = slack_client.get_messages()
<span class="hljs-keyword">elif</span> service == <span class="hljs-string">"database"</span>:
    db_client = DatabaseClient(connection_string)
    data = db_client.query(<span class="hljs-string">"SELECT * FROM users"</span>)
<span class="hljs-comment"># ... 每个服务都不同</span>
</code></pre>
<p><strong>使用MCP统一了之后：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 统一接口,标准化协议</span>
mcp_client = McpClient()

<span class="hljs-comment"># 所有服务使用相同的协议</span>
resources = mcp_client.list_resources()  <span class="hljs-comment"># 获取可用资源</span>
tools = mcp_client.list_tools()          <span class="hljs-comment"># 获取可用工具</span>
result = mcp_client.call_tool(<span class="hljs-string">"search"</span>, args)  <span class="hljs-comment"># 调用工具</span>
</code></pre>
<p><strong>这里我们强调一下MCP的三大核心能力吧</strong>，分别是<strong>访问资源，调用工具，预制模板</strong>，下面的表格解释了它各自的特点与作用</p>





























<table><thead><tr><th>能力</th><th>说明</th><th>控制方</th><th>示例</th></tr></thead><tbody><tr><td><strong>Resources</strong></td><td>只读数据源</td><td>Application</td><td>文件内容、数据库记录、API 响应</td></tr><tr><td><strong>Tools</strong></td><td>可执行函数</td><td>Model</td><td>搜索航班、发送消息、创建日历事件</td></tr><tr><td><strong>Prompts</strong></td><td>预制模板</td><td>User</td><td>计划旅行、总结会议、起草邮件</td></tr></tbody></table>
<p>理解三大能力是非常重要的，关乎MCP的开发能力。</p>
<h2 data-id="heading-3">MCP的架构</h2>
<p>现在我们一起来看看MCP的架构是怎么样的。</p>
<p>MCP 采用客户端-服务器架构，其中 MCP 主机（例如Claude Code或Claude Desktop等 AI 应用）与一个或多个 MCP 服务器建立连接。MCP 主机通过为每个 MCP 服务器创建一个 MCP 客户端来实现这一点。每个 MCP 客户端与其对应的 MCP 服务器保持专用连接。使用 STDIO 传输的本地 MCP 服务器通常服务于单个 MCP 客户端，而使用 Streamable HTTP 传输的远程 MCP 服务器通常服务于多个 MCP 客户端。MCP架构的关键参与者包括：</p>
<ul>
<li><strong>MCP 主机</strong>：用于协调和管理一个或多个 MCP 客户端的 AI 应用程序</li>
<li><strong>MCP 客户端</strong>：一个维护与 MCP 服务器连接并从 MCP 服务器获取上下文以供 MCP 主机使用的组件。</li>
<li><strong>MCP 服务器</strong>：一个为 MCP 客户端提供上下文信息的程序</li>
</ul>
<p>这里引用官方文档的例子：</p>
<p><strong>例如</strong>：Visual Studio Code 充当 MCP 主机。当 Visual Studio Code 与 MCP 服务器（例如Sentry MCP 服务器）建立连接时，Visual Studio Code 运行时会实例化一个 MCP 客户端对象来维护与 Sentry MCP 服务器的连接。随后，当 Visual Studio Code 连接到另一个 MCP 服务器（例如本地文件系统服务器）时，Visual Studio Code 运行时会实例化另一个 MCP 客户端对象来维护此连接。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1175bce98b984503942606e4f14729ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771150068&amp;x-signature=TzpnLzD1wWltwmNdRfZ0IFUK5J0%3D" alt="image.png" loading="lazy"/></p>
<p>请注意，<strong>MCP 服务器</strong>指的是提供上下文数据的程序，无论其运行位置如何。MCP 服务器可以本地运行，也可以远程运行。例如，当 Claude Desktop 启动文件系统服务器时，由于它使用 STDIO 传输，因此服务器运行在同一台机器上。这通常被称为“本地”MCP 服务器。官方的 Sentry MCP 服务器运行在 Sentry 平台上，并使用 Streamable HTTP 传输。这通常被称为“远程”MCP 服务器。</p>
<h2 data-id="heading-4">小结</h2>
<p>第一篇我们就先解析MCP的概念，解决的问题，还有架构。接下来我们继续解析通信协议和数据格式等，有兴趣的可以关注此栏目</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第16篇）：Code2Video - 用代码生成高质量教学视频的智能框架]]></title>    <link>https://juejin.cn/post/7603643044035248164</link>    <guid>https://juejin.cn/post/7603643044035248164</guid>    <pubDate>2026-02-08T10:09:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603643044035248164" data-draft-id="7603769956975575081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第16篇）：Code2Video - 用代码生成高质量教学视频的智能框架"/> <meta itemprop="keywords" content="AIGC,音视频开发,开源"/> <meta itemprop="datePublished" content="2026-02-08T10:09:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第16篇）：Code2Video - 用代码生成高质量教学视频的智能框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:09:43.000Z" title="Sun Feb 08 2026 10:09:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果生成教学视频就像写代码一样简单，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第16篇文章。今天带你了解的项目是 <strong>Code2Video</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshowlab%2FCode2Video" target="_blank" title="https://github.com/showlab/Code2Video" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>在AI视频生成领域，大多数模型都是基于像素的文本到视频生成，虽然能产生视觉效果，但在教育场景中往往缺乏清晰度、连贯性和可重现性。Code2Video 提出了一个革命性的代码中心范式：使用可执行的 Manim 代码作为统一媒介，通过多智能体系统自动生成高质量的教学视频。无论是汉诺塔问题、大语言模型原理，还是傅里叶级数，都能通过代码自动生成清晰、美观、可重现的教育视频。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🎬 <strong>代码中心范式</strong>：可执行代码作为视频生成的统一媒介，确保清晰度和可重现性</li>
<li>🤖 <strong>三智能体系统</strong>：Planner（故事板扩展）、Coder（可调试代码合成）、Critic（布局优化）协同工作</li>
<li>📚 <strong>MMMC基准测试</strong>：首个代码驱动视频生成基准，涵盖117个精选学习主题</li>
<li>🎓 <strong>教育场景优化</strong>：专为教学视频设计，参考3Blue1Brown的高质量标准</li>
<li>🏆 <strong>学术认可</strong>：已被NeurIPS 2025的Deep Learning for Code (DL4C) Workshop接受</li>
<li>🧪 <strong>多维度评估</strong>：系统性评估效率、美学和端到端知识传递</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>Code2Video 的代码中心范式和设计理念</li>
<li>三智能体系统（Planner、Coder、Critic）的工作原理</li>
<li>如何使用 Manim 代码生成教学视频</li>
<li>MMMC 基准测试的构建和评估方法</li>
<li>如何配置和使用 Code2Video 生成视频</li>
<li>与其他视频生成方法的对比分析</li>
<li>实际教育场景中的应用案例</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对AI视频生成有基本了解</li>
<li>了解多智能体系统概念</li>
<li>熟悉Python编程（可选，有助于理解代码生成）</li>
<li>对教育视频设计有基本概念（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>Code2Video</strong> 是一个<strong>以代码为中心的智能体框架</strong>，用于从知识点生成高质量的教学视频。与基于像素的文本到视频模型不同，Code2Video 利用可执行的 <strong>Manim 代码</strong>来确保视频的清晰度、连贯性和可重现性。通过三智能体系统（Planner、Coder、Critic）的协同工作，自动将知识点转换为结构化的教学视频。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>传统文本到视频模型生成的教学视频缺乏清晰度和连贯性</li>
<li>视频生成过程不可重现，难以调试和优化</li>
<li>缺乏专门针对教育场景的视频生成工具</li>
<li>视频质量评估缺乏系统性标准</li>
<li>需要大量人工工作来创建高质量教学视频</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>教育工作者和课程设计师</li>
<li>在线教育平台开发者</li>
<li>AI视频生成研究者</li>
<li>需要批量生成教学视频的机构</li>
<li>对代码驱动视频生成感兴趣的技术人员</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>团队：Show Lab @ National University of Singapore</strong></p>
<ul>
<li><strong>主要作者</strong>：
<ul>
<li>Yanzhe Chen（陈彦哲）</li>
<li>Kevin Qinghong Lin（林庆宏）</li>
<li>Mike Zheng Shou（指导教授）</li>
</ul>
</li>
<li><strong>背景</strong>：新加坡国立大学 Show Lab，专注于视频理解和生成研究</li>
<li><strong>项目创建时间</strong>：2025年</li>
<li><strong>学术成果</strong>：已被 NeurIPS 2025 的 Deep Learning for Code (DL4C) Workshop 接受</li>
<li><strong>理念</strong>：用代码创造清晰、美观、可重现的教育视频</li>
</ul>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 1.5k+（持续增长中）</li>
<li>🍴 <strong>Forks</strong>: 203+</li>
<li>📦 <strong>版本</strong>: 持续更新中（95+ commits）</li>
<li>📄 <strong>License</strong>: MIT（完全开源，自由使用）</li>
<li>🌐 <strong>项目网站</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fshowlab.github.io%2FCode2Video%2F" target="_blank" title="https://showlab.github.io/Code2Video/" ref="nofollow noopener noreferrer">showlab.github.io/Code2Video</a></li>
<li>📄 <strong>论文</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2510.01174" target="_blank" title="https://arxiv.org/abs/2510.01174" ref="nofollow noopener noreferrer">arXiv:2510.01174</a></li>
<li>💬 <strong>社区</strong>: GitHub Issues 活跃，1个开放 Issue</li>
<li>👥 <strong>贡献者</strong>: 3位核心贡献者</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2025年9月：项目创建，发布初始版本</li>
<li>2025年9月22日：被 NeurIPS 2025 的 DL4C Workshop 接受</li>
<li>2025年10月2日：发布 arXiv 论文、代码和数据集</li>
<li>2025年10月3日：在 Twitter 上获得广泛关注</li>
<li>2025年10月6日：更新 MMMC 数据集的真实人工制作视频和元数据</li>
<li>2025年10月11日：更新图标收集源（从 IconFinder 到 MMMC）</li>
<li>2025年11月6日：优化 requirements.txt，安装时间减少80-90%</li>
<li>2025年11月25日：达到 1000 stars 里程碑</li>
<li>持续维护：项目持续活跃，社区贡献不断</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>Code2Video 的核心作用是<strong>通过代码自动生成高质量的教学视频</strong>，主要功能包括：</p>
<ol>
<li><strong>知识点到视频的自动转换</strong>：输入知识点，自动生成完整的教学视频</li>
<li><strong>三智能体协同工作</strong>：Planner 规划故事板，Coder 生成 Manim 代码，Critic 优化布局和美学</li>
<li><strong>可执行代码生成</strong>：生成可调试、可修改的 Manim 代码，而非像素级视频</li>
<li><strong>多主题支持</strong>：支持数学、计算机科学、物理等多个领域的教学主题</li>
<li><strong>高质量输出</strong>：参考 3Blue1Brown 的标准，生成清晰、美观的教学视频</li>
<li><strong>系统性评估</strong>：提供知识传递、美学质量、效率等多维度评估</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<p>Code2Video 适用于多种教育场景：</p>
<ol>
<li>
<p><strong>在线课程制作</strong></p>
<ul>
<li>快速为在线课程生成教学视频</li>
<li>批量生成多个知识点的视频内容</li>
<li>保持视频风格的一致性</li>
</ul>
</li>
<li>
<p><strong>教育内容创作</strong></p>
<ul>
<li>教育工作者快速制作教学视频</li>
<li>将复杂概念可视化</li>
<li>创建交互式教学内容</li>
</ul>
</li>
<li>
<p><strong>研究和评估</strong></p>
<ul>
<li>研究代码驱动视频生成方法</li>
<li>评估不同视频生成技术的效果</li>
<li>构建教育视频生成基准测试</li>
</ul>
</li>
<li>
<p><strong>自动化内容生产</strong></p>
<ul>
<li>教育平台批量生成视频内容</li>
<li>将文本课程自动转换为视频课程</li>
<li>多语言教育内容的快速生成</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">安装方式</h4>
<p>Code2Video 的安装需要几个步骤：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆项目</span>
git <span class="hljs-built_in">clone</span> https://github.com/showlab/Code2Video.git
<span class="hljs-built_in">cd</span> Code2Video/src

<span class="hljs-comment"># 2. 安装依赖</span>
pip install -r requirements.txt

<span class="hljs-comment"># 3. 安装 Manim Community v0.19.0</span>
<span class="hljs-comment"># 参考官方安装指南：https://docs.manim.community/en/stable/installation.html</span>
</code></pre>
<p><strong>主要依赖</strong>：</p>
<ul>
<li><code>manim</code>：数学动画引擎（Manim Community v0.19.0）</li>
<li>LLM API：用于 Planner 和 Coder（推荐 Claude-4-Opus）</li>
<li>VLM API：用于 Critic（推荐 gemini-2.5-pro-preview-05-06）</li>
<li>其他 Python 依赖（见 requirements.txt）</li>
</ul>
<h4 data-id="heading-12">配置 API Keys</h4>
<p>在 <code>api_config.json</code> 中配置 API 凭证：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"LLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 或其他 LLM 提供商</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key-here"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-4-opus"</span>  <span class="hljs-comment">// 推荐使用 Claude-4-Opus 获得最佳代码质量</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"VLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-api-key-here"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro-preview-05-06"</span>  <span class="hljs-comment">// 用于布局和美学优化</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"ICONFINDER_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-iconfinder-api-key"</span>  <span class="hljs-comment">// 可选，用于丰富视频图标</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-13">最简单的使用示例</h4>
<p>生成单个知识点的视频：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 run_agent_single.sh 脚本</span>
sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Linear transformations and matrices"</span>
</code></pre>
<p>这个命令会：</p>
<ul>
<li>Planner 智能体规划视频故事板</li>
<li>Coder 智能体生成 Manim 代码</li>
<li>Critic 智能体优化布局和美学</li>
<li>执行 Manim 代码生成视频</li>
<li>保存到 <code>CASES/TEST-single/</code> 目录</li>
</ul>
<h4 data-id="heading-14">常用命令示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成单个知识点视频</span>
sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Hanoi Problem"</span>

<span class="hljs-comment"># 批量生成多个主题（使用 long_video_topics_list.json）</span>
sh run_agent.sh

<span class="hljs-comment"># 在 run_agent.sh 中可以配置的参数：</span>
<span class="hljs-comment"># - API: 指定使用的 LLM</span>
<span class="hljs-comment"># - FOLDER_PREFIX: 输出文件夹前缀（如 TEST-LIST）</span>
<span class="hljs-comment"># - MAX_CONCEPTS: 包含的概念数量（-1 表示全部）</span>
<span class="hljs-comment"># - PARALLEL_GROUP_NUM: 并行运行的组数</span>
</code></pre>
<h3 data-id="heading-15">核心特性</h3>
<p>Code2Video 的核心特性包括：</p>
<ol>
<li>
<p><strong>代码中心范式</strong></p>
<ul>
<li>使用可执行的 Manim 代码作为视频生成媒介</li>
<li>代码可调试、可修改、可重现</li>
<li>确保视频的清晰度和连贯性</li>
</ul>
</li>
<li>
<p><strong>三智能体系统</strong></p>
<ul>
<li><strong>Planner</strong>：将知识点扩展为详细的故事板</li>
<li><strong>Coder</strong>：根据故事板生成可执行的 Manim 代码</li>
<li><strong>Critic</strong>：使用视觉语言模型优化布局和美学</li>
</ul>
</li>
<li>
<p><strong>MMMC 基准测试</strong></p>
<ul>
<li>首个代码驱动视频生成的基准测试</li>
<li>涵盖 117 个精选学习主题</li>
<li>参考 3Blue1Brown 的高质量标准</li>
<li>包含真实人工制作视频作为评估标准</li>
</ul>
</li>
<li>
<p><strong>多维度评估</strong></p>
<ul>
<li><strong>知识传递（TeachQuiz）</strong>：评估视频的教学效果</li>
<li><strong>美学和结构质量（AES）</strong>：评估视频的视觉质量</li>
<li><strong>效率指标</strong>：评估 Token 使用和执行时间</li>
</ul>
</li>
<li>
<p><strong>模块化设计</strong></p>
<ul>
<li>智能体系统可独立使用</li>
<li>支持自定义提示模板</li>
<li>灵活的配置系统</li>
</ul>
</li>
<li>
<p><strong>高质量输出</strong></p>
<ul>
<li>参考 3Blue1Brown 的设计标准</li>
<li>支持图标和视觉资源集成</li>
<li>生成清晰、美观的教学视频</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">项目优势</h3>
<p>与其他视频生成方法相比，Code2Video 的优势：</p>





















































<table><thead><tr><th align="left">对比项</th><th align="left">Code2Video</th><th align="left">传统文本到视频模型</th><th align="left">手动制作视频</th></tr></thead><tbody><tr><td align="left"><strong>清晰度</strong></td><td align="left">高（代码生成）</td><td align="left">中低（像素生成）</td><td align="left">高（人工控制）</td></tr><tr><td align="left"><strong>可重现性</strong></td><td align="left">完全可重现</td><td align="left">不可重现</td><td align="left">可重现但耗时</td></tr><tr><td align="left"><strong>可调试性</strong></td><td align="left">可调试代码</td><td align="left">不可调试</td><td align="left">可编辑但复杂</td></tr><tr><td align="left"><strong>生成速度</strong></td><td align="left">快（自动化）</td><td align="left">快</td><td align="left">慢（人工制作）</td></tr><tr><td align="left"><strong>成本</strong></td><td align="left">低（API调用）</td><td align="left">中（计算资源）</td><td align="left">高（人力成本）</td></tr><tr><td align="left"><strong>一致性</strong></td><td align="left">高（代码控制）</td><td align="left">中低</td><td align="left">取决于制作者</td></tr><tr><td align="left"><strong>教育适用性</strong></td><td align="left">专门优化</td><td align="left">通用但不够清晰</td><td align="left">高质量但耗时</td></tr></tbody></table>
<p><strong>为什么选择 Code2Video？</strong></p>
<ul>
<li>✅ <strong>代码驱动</strong>：生成可执行、可调试的代码，而非像素</li>
<li>✅ <strong>教育优化</strong>：专门为教学视频设计，参考最佳实践</li>
<li>✅ <strong>智能体系统</strong>：三智能体协同，自动化程度高</li>
<li>✅ <strong>系统性评估</strong>：提供完整的评估框架和基准测试</li>
<li>✅ <strong>学术认可</strong>：已被 NeurIPS 2025 接受</li>
<li>✅ <strong>开源免费</strong>：MIT 许可证，完全开源</li>
</ul>
<hr/>
<h2 data-id="heading-17">项目详细剖析</h2>
<h3 data-id="heading-18">架构设计</h3>
<p>Code2Video 的整体架构采用三智能体协同设计：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Planner   │────▶│    Coder    │────▶│   Critic    │
│  (故事板)   │     │  (代码生成) │     │ (布局优化)  │
└─────────────┘     └─────────────┘     └─────────────┘
      │                    │                    │
      ▼                    ▼                    ▼
┌─────────────────────────────────────────────────────┐
│            Manim 代码执行和视频生成                   │
└─────────────────────────────────────────────────────┘
      │
      ▼
┌─────────────┐
│  视频输出   │
└─────────────┘
</code></pre>
<p><strong>核心流程</strong>：</p>
<ol>
<li><strong>Planner 阶段</strong>：将知识点扩展为详细的故事板，包括场景、动画、说明等</li>
<li><strong>Coder 阶段</strong>：根据故事板生成可执行的 Manim 代码</li>
<li><strong>Critic 阶段</strong>：使用视觉语言模型评估和优化代码的布局和美学</li>
<li><strong>执行阶段</strong>：运行 Manim 代码生成最终视频</li>
<li><strong>评估阶段</strong>：使用多维度指标评估视频质量</li>
</ol>
<h3 data-id="heading-19">核心模块分析</h3>
<h4 data-id="heading-20">1. Planner 智能体</h4>
<p>Planner 负责将知识点扩展为详细的故事板：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>分析知识点的核心概念</li>
<li>规划视频的结构和流程</li>
<li>确定需要展示的动画和可视化</li>
<li>生成详细的故事板描述</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>使用 LLM（推荐 Claude-4-Opus）进行故事板扩展</li>
<li>基于提示模板生成结构化故事板</li>
<li>考虑教育视频的最佳实践</li>
</ul>
<h4 data-id="heading-21">2. Coder 智能体</h4>
<p>Coder 负责根据故事板生成 Manim 代码：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>将故事板转换为 Manim 代码</li>
<li>生成可执行的动画代码</li>
<li>确保代码的正确性和可读性</li>
<li>处理复杂的数学和可视化需求</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>使用 LLM 生成 Manim 代码</li>
<li>代码可以直接执行和调试</li>
<li>支持 Manim Community v0.19.0 的语法</li>
</ul>
<p><strong>Manim 代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 生成的 Manim 代码示例（简化版）</span>
<span class="hljs-keyword">from</span> manim <span class="hljs-keyword">import</span> *

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearTransformation</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 创建矩阵</span>
        matrix = Matrix([[<span class="hljs-number">2</span>, <span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]])
        self.play(Create(matrix))
        
        <span class="hljs-comment"># 展示线性变换</span>
        vector = Arrow(ORIGIN, [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], buff=<span class="hljs-number">0</span>)
        self.play(Create(vector))
        
        <span class="hljs-comment"># 应用变换</span>
        transformed = matrix @ vector.get_end()
        self.play(Transform(vector, Arrow(ORIGIN, transformed, buff=<span class="hljs-number">0</span>)))
</code></pre>
<h4 data-id="heading-22">3. Critic 智能体</h4>
<p>Critic 负责优化代码的布局和美学：</p>
<p><strong>功能</strong>：</p>
<ul>
<li>使用视觉语言模型评估生成的代码</li>
<li>优化布局和视觉元素的位置</li>
<li>确保美学质量和视觉清晰度</li>
<li>使用锚点（anchors）进行布局优化</li>
</ul>
<p><strong>实现方式</strong>：</p>
<ul>
<li>使用 VLM（推荐 gemini-2.5-pro-preview-05-06）</li>
<li>分析代码生成的视觉效果</li>
<li>提供布局优化建议</li>
<li>迭代改进代码质量</li>
</ul>
<h4 data-id="heading-23">4. MMMC 基准测试</h4>
<p>MMMC（Manim-based Multi-topic Multi-quality Code）是首个代码驱动视频生成的基准测试：</p>
<p><strong>特点</strong>：</p>
<ul>
<li>涵盖 117 个精选学习主题</li>
<li>参考 3Blue1Brown 的高质量标准</li>
<li>包含真实人工制作视频作为评估标准</li>
<li>涵盖数学、计算机科学、物理等多个领域</li>
</ul>
<p><strong>评估维度</strong>：</p>
<ol>
<li><strong>知识传递（TeachQuiz）</strong>：评估视频的教学效果</li>
<li><strong>美学和结构质量（AES）</strong>：评估视频的视觉质量</li>
<li><strong>效率指标</strong>：Token 使用和执行时间</li>
</ol>
<p><strong>使用方式</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 评估知识传递</span>
python3 eval_TQ.py

<span class="hljs-comment"># 评估美学和结构质量</span>
python3 eval_AES.py
</code></pre>
<h3 data-id="heading-24">关键技术实现</h3>
<h4 data-id="heading-25">1. 代码中心范式</h4>
<p>Code2Video 的核心创新是使用代码作为视频生成的统一媒介：</p>
<p><strong>优势</strong>：</p>
<ul>
<li><strong>可重现性</strong>：代码可以重复执行，生成相同的视频</li>
<li><strong>可调试性</strong>：可以修改代码来调整视频效果</li>
<li><strong>清晰度</strong>：代码生成的视频比像素生成更清晰</li>
<li><strong>可扩展性</strong>：可以轻松添加新的动画和效果</li>
</ul>
<p><strong>实现</strong>：</p>
<ul>
<li>使用 Manim 作为代码执行引擎</li>
<li>生成的代码符合 Manim Community 标准</li>
<li>支持复杂的数学和可视化需求</li>
</ul>
<h4 data-id="heading-26">2. 多智能体协同</h4>
<p>三智能体系统通过模块化设计实现协同工作：</p>
<p><strong>Planner → Coder → Critic 流程</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 简化的工作流程</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_video</span>(<span class="hljs-params">knowledge_point</span>):
    <span class="hljs-comment"># 1. Planner 生成故事板</span>
    storyboard = planner.expand(knowledge_point)
    
    <span class="hljs-comment"># 2. Coder 生成代码</span>
    manim_code = coder.generate(storyboard)
    
    <span class="hljs-comment"># 3. Critic 优化代码</span>
    optimized_code = critic.optimize(manim_code)
    
    <span class="hljs-comment"># 4. 执行代码生成视频</span>
    video = execute_manim(optimized_code)
    
    <span class="hljs-keyword">return</span> video
</code></pre>
<p><strong>智能体间的信息传递</strong>：</p>
<ul>
<li>Planner 输出结构化故事板</li>
<li>Coder 接收故事板，生成代码</li>
<li>Critic 接收代码，提供优化建议</li>
<li>支持迭代优化</li>
</ul>
<h4 data-id="heading-27">3. 提示工程</h4>
<p>Code2Video 使用精心设计的提示模板来指导智能体：</p>
<p><strong>提示模板位置</strong>：<code>prompts/</code> 目录</p>
<p><strong>提示类型</strong>：</p>
<ul>
<li>Planner 提示：指导故事板扩展</li>
<li>Coder 提示：指导代码生成</li>
<li>Critic 提示：指导布局优化</li>
</ul>
<p><strong>提示优化</strong>：</p>
<ul>
<li>基于教育视频最佳实践</li>
<li>参考 3Blue1Brown 的设计标准</li>
<li>支持自定义和扩展</li>
</ul>
<hr/>
<h2 data-id="heading-28">实际使用案例</h2>
<h3 data-id="heading-29">案例1：在线数学课程制作</h3>
<p><strong>场景</strong>：在线教育平台需要为线性代数课程批量生成教学视频。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 准备知识点列表（long_video_topics_list.json）</span>
<span class="hljs-comment"># 包含：线性变换、矩阵运算、特征值等主题</span>

<span class="hljs-comment"># 2. 配置批量生成脚本</span>
sh run_agent.sh

<span class="hljs-comment"># 3. 配置参数</span>
<span class="hljs-comment"># API: claude-4-opus</span>
<span class="hljs-comment"># FOLDER_PREFIX: LinearAlgebra-Course</span>
<span class="hljs-comment"># MAX_CONCEPTS: -1  # 生成所有概念</span>
<span class="hljs-comment"># PARALLEL_GROUP_NUM: 4  # 并行生成4个视频</span>
</code></pre>
<p><strong>效果</strong>：自动生成一系列风格统一、清晰美观的线性代数教学视频，大大减少人工制作时间。</p>
<h3 data-id="heading-30">案例2：计算机科学概念可视化</h3>
<p><strong>场景</strong>：为"大语言模型原理"主题生成教学视频。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成单个知识点视频</span>
sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Large Language Model"</span>

<span class="hljs-comment"># 系统会自动：</span>
<span class="hljs-comment"># 1. Planner 分析LLM的核心概念（注意力机制、Transformer等）</span>
<span class="hljs-comment"># 2. Coder 生成展示LLM架构的Manim代码</span>
<span class="hljs-comment"># 3. Critic 优化布局，确保清晰度</span>
<span class="hljs-comment"># 4. 生成最终视频</span>
</code></pre>
<p><strong>效果</strong>：生成清晰展示LLM工作原理的视频，包括注意力机制的可视化、Transformer架构的动画等。</p>
<h3 data-id="heading-31">案例3：物理概念教学</h3>
<p><strong>场景</strong>：为傅里叶级数生成教学视频。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">sh run_agent_single.sh --knowledge_point <span class="hljs-string">"Pure Fourier Series"</span>

<span class="hljs-comment"># 生成的视频会展示：</span>
<span class="hljs-comment"># - 傅里叶级数的数学公式</span>
<span class="hljs-comment"># - 不同频率分量的叠加过程</span>
<span class="hljs-comment"># - 从方波到正弦波的分解动画</span>
</code></pre>
<p><strong>效果</strong>：通过动画直观展示傅里叶级数的数学原理，帮助学生理解抽象概念。</p>
<h3 data-id="heading-32">案例4：批量课程内容生成</h3>
<p><strong>场景</strong>：教育机构需要为多个学科生成教学视频。</p>
<p><strong>实现步骤</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 准备多学科主题列表</span>
<span class="hljs-comment"># 数学、物理、计算机科学等117个主题</span>

<span class="hljs-comment"># 2. 批量生成</span>
sh run_agent.sh

<span class="hljs-comment"># 3. 使用并行处理加速</span>
PARALLEL_GROUP_NUM=8  <span class="hljs-comment"># 8个并行任务</span>
</code></pre>
<p><strong>效果</strong>：快速生成大量高质量教学视频，保持风格一致性，适合大规模在线课程制作。</p>
<hr/>
<h2 data-id="heading-33">高级配置技巧</h2>
<h3 data-id="heading-34">1. 自定义提示模板</h3>
<p>Code2Video 使用提示模板来指导智能体，你可以自定义这些模板：</p>
<p><strong>提示模板位置</strong>：<code>prompts/</code> 目录</p>
<p><strong>自定义 Planner 提示</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># prompts/planner_prompt.txt</span>
你是一个教育视频规划专家。请为以下知识点创建详细的故事板：

知识点：{knowledge_point}

要求：
<span class="hljs-number">1.</span> 分析知识点的核心概念
<span class="hljs-number">2.</span> 规划视频结构（引言、主体、总结）
<span class="hljs-number">3.</span> 确定需要展示的动画和可视化
<span class="hljs-number">4.</span> 考虑教育视频的最佳实践
<span class="hljs-number">5.</span> 参考3Blue1Brown的风格

请生成详细的故事板...
</code></pre>
<p><strong>自定义 Coder 提示</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># prompts/coder_prompt.txt</span>
你是一个Manim代码生成专家。请根据以下故事板生成Manim代码：

故事板：{storyboard}

要求：
<span class="hljs-number">1.</span> 使用Manim Community v0<span class="hljs-number">.19</span><span class="hljs-number">.0</span>语法
<span class="hljs-number">2.</span> 代码要清晰、可读、可执行
<span class="hljs-number">3.</span> 包含必要的动画和可视化
<span class="hljs-number">4.</span> 遵循Manim最佳实践

请生成完整的Manim代码...
</code></pre>
<h3 data-id="heading-35">2. 优化 API 配置</h3>
<p><strong>选择最佳 LLM</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"LLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-4-opus"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 最佳代码质量</span>
    <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 控制创造性</span>
    <span class="hljs-attr">"max_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span>   <span class="hljs-comment">// 控制输出长度</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>配置 VLM 用于 Critic</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"VLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"google"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-key"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gemini-2.5-pro-preview-05-06"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 最佳视觉理解</span>
    <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span>  <span class="hljs-comment">// 较低温度确保一致性</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-36">3. 批量生成优化</h3>
<p><strong>并行处理配置</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 run_agent.sh 中配置</span>
PARALLEL_GROUP_NUM=8  <span class="hljs-comment"># 根据CPU核心数调整</span>

<span class="hljs-comment"># 限制生成数量（用于测试）</span>
MAX_CONCEPTS=10  <span class="hljs-comment"># 只生成前10个概念</span>
</code></pre>
<p><strong>输出组织</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用有意义的文件夹前缀</span>
FOLDER_PREFIX=<span class="hljs-string">"Math-Course-2026"</span>

<span class="hljs-comment"># 输出结构：</span>
<span class="hljs-comment"># CASES/</span>
<span class="hljs-comment">#   └── Math-Course-2026/</span>
<span class="hljs-comment">#       ├── concept_1/</span>
<span class="hljs-comment">#       │   ├── video.mp4</span>
<span class="hljs-comment">#       │   ├── manim_code.py</span>
<span class="hljs-comment">#       │   └── storyboard.json</span>
<span class="hljs-comment">#       └── concept_2/</span>
<span class="hljs-comment">#           └── ...</span>
</code></pre>
<h3 data-id="heading-37">4. Manim 代码后处理</h3>
<p>生成的 Manim 代码可以进一步优化：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 生成的代码示例</span>
<span class="hljs-keyword">from</span> manim <span class="hljs-keyword">import</span> *

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GeneratedVideo</span>(<span class="hljs-title class_ inherited__">Scene</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 可以手动编辑和优化</span>
        title = Text(<span class="hljs-string">"Linear Transformations"</span>)
        self.play(Write(title))
        <span class="hljs-comment"># ... 更多代码</span>
</code></pre>
<p><strong>优化技巧</strong>：</p>
<ul>
<li>调整动画时长和缓动函数</li>
<li>优化颜色和字体选择</li>
<li>添加更多视觉效果</li>
<li>改进布局和排版</li>
</ul>
<h3 data-id="heading-38">5. 集成到工作流</h3>
<p><strong>Python API 集成</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在你的 Python 项目中使用</span>
<span class="hljs-keyword">from</span> agent <span class="hljs-keyword">import</span> Code2VideoAgent

<span class="hljs-comment"># 初始化智能体</span>
agent = Code2VideoAgent(
    llm_api_key=<span class="hljs-string">"your-key"</span>,
    vlm_api_key=<span class="hljs-string">"your-key"</span>
)

<span class="hljs-comment"># 生成视频</span>
video_path = agent.generate_video(
    knowledge_point=<span class="hljs-string">"Linear transformations and matrices"</span>,
    output_dir=<span class="hljs-string">"./output"</span>
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"视频已生成：<span class="hljs-subst">{video_path}</span>"</span>)
</code></pre>
<p><strong>自动化脚本</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-comment"># auto_generate.py</span>

<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># 读取主题列表</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'long_video_topics_list.json'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
    topics = json.load(f)

<span class="hljs-comment"># 批量生成</span>
<span class="hljs-keyword">for</span> topic <span class="hljs-keyword">in</span> topics[:<span class="hljs-number">10</span>]:  <span class="hljs-comment"># 生成前10个</span>
    knowledge_point = topic[<span class="hljs-string">'name'</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"生成视频：<span class="hljs-subst">{knowledge_point}</span>"</span>)
    
    subprocess.run([
        <span class="hljs-string">'sh'</span>, <span class="hljs-string">'run_agent_single.sh'</span>,
        <span class="hljs-string">'--knowledge_point'</span>, knowledge_point
    ])
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✓ 完成：<span class="hljs-subst">{knowledge_point}</span>\n"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-39">评估方法详解</h2>
<h3 data-id="heading-40">1. 知识传递评估（TeachQuiz）</h3>
<p><strong>目的</strong>：评估视频的教学效果，即学生能否从视频中学习到知识。</p>
<p><strong>评估方法</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行评估脚本</span>
python3 eval_TQ.py
</code></pre>
<p><strong>评估流程</strong>：</p>
<ol>
<li>为每个视频生成测试题目</li>
<li>让学生观看视频后回答问题</li>
<li>计算正确率作为知识传递指标</li>
</ol>
<p><strong>评估指标</strong>：</p>
<ul>
<li><strong>正确率</strong>：学生答题的正确率</li>
<li><strong>理解深度</strong>：学生对概念的理解程度</li>
<li><strong>知识保留</strong>：一段时间后的知识保留率</li>
</ul>
<h3 data-id="heading-41">2. 美学和结构质量评估（AES）</h3>
<p><strong>目的</strong>：评估视频的视觉质量和结构合理性。</p>
<p><strong>评估方法</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 运行评估脚本</span>
python3 eval_AES.py
</code></pre>
<p><strong>评估维度</strong>：</p>
<ul>
<li><strong>视觉清晰度</strong>：文字、图形是否清晰</li>
<li><strong>布局合理性</strong>：元素位置是否合理</li>
<li><strong>动画流畅性</strong>：动画是否流畅自然</li>
<li><strong>整体美观度</strong>：视频整体是否美观</li>
</ul>
<p><strong>评估标准</strong>：</p>
<ul>
<li>参考 3Blue1Brown 的视频质量标准</li>
<li>使用真实人工制作视频作为基准</li>
<li>多维度综合评分</li>
</ul>
<h3 data-id="heading-42">3. 效率指标</h3>
<p><strong>目的</strong>：评估生成过程的效率和成本。</p>
<p><strong>评估指标</strong>：</p>
<ol>
<li>
<p><strong>Token 使用量</strong></p>
<ul>
<li>Planner 使用的 Token 数</li>
<li>Coder 使用的 Token 数</li>
<li>Critic 使用的 Token 数</li>
<li>总 Token 使用量</li>
</ul>
</li>
<li>
<p><strong>执行时间</strong></p>
<ul>
<li>故事板生成时间</li>
<li>代码生成时间</li>
<li>代码执行时间（Manim 渲染）</li>
<li>总生成时间</li>
</ul>
</li>
<li>
<p><strong>成本估算</strong></p>
<ul>
<li>API 调用成本</li>
<li>计算资源成本</li>
<li>总成本</li>
</ul>
</li>
</ol>
<p><strong>优化建议</strong>：</p>
<ul>
<li>使用更高效的 LLM（如 Claude-4-Opus）</li>
<li>优化提示模板减少 Token 使用</li>
<li>并行处理提高效率</li>
<li>缓存中间结果避免重复计算</li>
</ul>
<h3 data-id="heading-43">4. 与基准对比</h3>
<p>Code2Video 在 MMMC 基准测试中与以下方法对比：</p>








































<table><thead><tr><th align="left">方法</th><th align="left">知识传递</th><th align="left">美学质量</th><th align="left">生成速度</th><th align="left">可重现性</th></tr></thead><tbody><tr><td align="left"><strong>Code2Video</strong></td><td align="left">高</td><td align="left">高</td><td align="left">中</td><td align="left">完全可重现</td></tr><tr><td align="left">Veo3</td><td align="left">中</td><td align="left">中</td><td align="left">快</td><td align="left">不可重现</td></tr><tr><td align="left">Wan2.2</td><td align="left">中</td><td align="left">中</td><td align="left">快</td><td align="left">不可重现</td></tr><tr><td align="left">人工制作</td><td align="left">高</td><td align="left">高</td><td align="left">慢</td><td align="left">可重现但耗时</td></tr></tbody></table>
<p><strong>Code2Video 的优势</strong>：</p>
<ul>
<li>在知识传递和美学质量上接近人工制作</li>
<li>生成速度比人工制作快得多</li>
<li>完全可重现，可以调试和优化</li>
<li>成本远低于人工制作</li>
</ul>
<hr/>
<h2 data-id="heading-44">与其他视频生成工具的对比</h2>
<h3 data-id="heading-45">Code2Video vs 传统文本到视频模型</h3>
<p><strong>传统文本到视频模型</strong>（如 Veo3、Wan2.2）：</p>
<p><strong>优势</strong>：</p>
<ul>
<li>生成速度快</li>
<li>支持多种风格</li>
<li>不需要编程知识</li>
</ul>
<p><strong>劣势</strong>：</p>
<ul>
<li>生成视频不可重现</li>
<li>清晰度不够高</li>
<li>不适合教育场景</li>
<li>难以调试和优化</li>
</ul>
<p><strong>Code2Video</strong>：</p>
<p><strong>优势</strong>：</p>
<ul>
<li>生成代码可重现、可调试</li>
<li>清晰度高，适合教育</li>
<li>专门为教学视频优化</li>
<li>可以迭代改进</li>
</ul>
<p><strong>劣势</strong>：</p>
<ul>
<li>需要 Manim 环境</li>
<li>生成速度相对较慢</li>
<li>主要适用于教育场景</li>
</ul>
<h3 data-id="heading-46">Code2Video vs 手动视频制作</h3>
<p><strong>手动制作</strong>（如使用 After Effects、Premiere）：</p>
<p><strong>优势</strong>：</p>
<ul>
<li>完全控制每个细节</li>
<li>可以创建复杂效果</li>
<li>质量最高</li>
</ul>
<p><strong>劣势</strong>：</p>
<ul>
<li>耗时耗力</li>
<li>需要专业技能</li>
<li>成本高</li>
<li>难以批量生产</li>
</ul>
<p><strong>Code2Video</strong>：</p>
<p><strong>优势</strong>：</p>
<ul>
<li>自动化程度高</li>
<li>可以批量生成</li>
<li>成本低</li>
<li>风格一致</li>
</ul>
<p><strong>劣势</strong>：</p>
<ul>
<li>灵活性不如手动制作</li>
<li>复杂效果支持有限</li>
<li>需要调试和优化</li>
</ul>
<h3 data-id="heading-47">适用场景选择</h3>
<p><strong>选择 Code2Video 当</strong>：</p>
<ul>
<li>✅ 需要批量生成教学视频</li>
<li>✅ 要求视频清晰、可重现</li>
<li>✅ 需要快速迭代和优化</li>
<li>✅ 预算有限但需要高质量</li>
</ul>
<p><strong>选择传统文本到视频当</strong>：</p>
<ul>
<li>✅ 需要快速生成通用视频</li>
<li>✅ 不需要可重现性</li>
<li>✅ 非教育场景</li>
</ul>
<p><strong>选择手动制作当</strong>：</p>
<ul>
<li>✅ 需要完全控制细节</li>
<li>✅ 需要复杂特效</li>
<li>✅ 预算充足且时间充裕</li>
</ul>
<hr/>
<h2 data-id="heading-48">常见问题解决</h2>
<h3 data-id="heading-49">问题1：Manim 安装失败</h3>
<p><strong>症状</strong>：安装 Manim Community v0.19.0 时出错。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p><strong>检查系统依赖</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Ubuntu/Debian</span>
sudo apt-get install build-essential python3-dev libcairo2-dev libpango1.0-dev

<span class="hljs-comment"># macOS</span>
brew install cairo pango
</code></pre>
</li>
<li>
<p><strong>使用虚拟环境</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">python3 -m venv venv
<span class="hljs-built_in">source</span> venv/bin/activate  <span class="hljs-comment"># Linux/macOS</span>
<span class="hljs-comment"># 或</span>
venv\Scripts\activate  <span class="hljs-comment"># Windows</span>
pip install manim
</code></pre>
</li>
<li>
<p><strong>参考官方文档</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.manim.community%2Fen%2Fstable%2Finstallation.html" target="_blank" title="https://docs.manim.community/en/stable/installation.html" ref="nofollow noopener noreferrer">Manim 安装指南</a></li>
</ul>
</li>
</ol>
<h3 data-id="heading-50">问题2：API 调用失败</h3>
<p><strong>症状</strong>：LLM 或 VLM API 调用失败。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p><strong>检查 API Key</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"LLM_API"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-actual-api-key"</span>  <span class="hljs-comment">// 确保正确</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>检查网络连接</strong>：</p>
<ul>
<li>确保可以访问 API 服务</li>
<li>检查防火墙设置</li>
</ul>
</li>
<li>
<p><strong>检查 API 配额</strong>：</p>
<ul>
<li>确认 API 账户有足够配额</li>
<li>检查是否有速率限制</li>
</ul>
</li>
</ol>
<h3 data-id="heading-51">问题3：生成的代码执行失败</h3>
<p><strong>症状</strong>：Manim 代码生成后执行出错。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p><strong>检查 Manim 版本</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">manim --version  <span class="hljs-comment"># 应该是 0.19.0</span>
</code></pre>
</li>
<li>
<p><strong>手动调试代码</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 查看生成的代码</span>
<span class="hljs-comment"># CASES/TEST-single/concept_name/manim_code.py</span>

<span class="hljs-comment"># 手动运行测试</span>
manim -pql manim_code.py GeneratedVideo
</code></pre>
</li>
<li>
<p><strong>检查依赖</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">pip install -r requirements.txt
</code></pre>
</li>
</ol>
<h3 data-id="heading-52">问题4：视频质量不理想</h3>
<p><strong>症状</strong>：生成的视频清晰度或美观度不够。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p><strong>使用更好的 LLM</strong>：</p>
<ul>
<li>推荐使用 Claude-4-Opus</li>
<li>确保 API 配置正确</li>
</ul>
</li>
<li>
<p><strong>优化提示模板</strong>：</p>
<ul>
<li>在 <code>prompts/</code> 目录中自定义提示</li>
<li>参考 3Blue1Brown 的风格要求</li>
</ul>
</li>
<li>
<p><strong>使用 Critic 优化</strong>：</p>
<ul>
<li>确保 VLM API 配置正确</li>
<li>使用 gemini-2.5-pro-preview-05-06</li>
</ul>
</li>
<li>
<p><strong>手动后处理</strong>：</p>
<ul>
<li>编辑生成的 Manim 代码</li>
<li>调整颜色、字体、布局等</li>
</ul>
</li>
</ol>
<h3 data-id="heading-53">问题5：生成速度慢</h3>
<p><strong>症状</strong>：视频生成需要很长时间。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p><strong>使用并行处理</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">PARALLEL_GROUP_NUM=8  <span class="hljs-comment"># 增加并行数</span>
</code></pre>
</li>
<li>
<p><strong>优化 Manim 渲染</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用低质量预览</span>
manim -pql  <span class="hljs-comment"># 低质量，快速预览</span>
<span class="hljs-comment"># 高质量渲染</span>
manim -pqh  <span class="hljs-comment"># 高质量，较慢</span>
</code></pre>
</li>
<li>
<p><strong>减少概念数量</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">MAX_CONCEPTS=5  <span class="hljs-comment"># 先测试少量概念</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-54">问题6：内存不足</h3>
<p><strong>症状</strong>：生成大型视频时内存溢出。</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p><strong>减少视频复杂度</strong>：</p>
<ul>
<li>简化故事板</li>
<li>减少同时显示的元素</li>
</ul>
</li>
<li>
<p><strong>分批处理</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分批生成，避免同时处理太多</span>
MAX_CONCEPTS=10
</code></pre>
</li>
<li>
<p><strong>增加系统内存</strong>：</p>
<ul>
<li>如果可能，增加系统 RAM</li>
<li>使用更强大的机器</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-55">项目地址与资源</h2>
<h3 data-id="heading-56">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshowlab%2FCode2Video" target="_blank" title="https://github.com/showlab/Code2Video" ref="nofollow noopener noreferrer">github.com/showlab/Cod…</a></li>
<li>🌐 <strong>项目网站</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fshowlab.github.io%2FCode2Video%2F" target="_blank" title="https://showlab.github.io/Code2Video/" ref="nofollow noopener noreferrer">showlab.github.io/Code2Video</a></li>
</ul>
<hr/>
<h2 data-id="heading-57">适用人群</h2>
<p>Code2Video 适合以下人群：</p>
<h3 data-id="heading-58">1. 教育工作者和课程设计师</h3>
<ul>
<li>✅ 需要快速制作教学视频的教师</li>
<li>✅ 在线课程平台的内容创作者</li>
<li>✅ 希望将复杂概念可视化的教育工作者</li>
</ul>
<h3 data-id="heading-59">2. 在线教育平台开发者</h3>
<ul>
<li>✅ 需要批量生成视频内容的平台</li>
<li>✅ 希望自动化内容生产的团队</li>
<li>✅ 需要保持视频风格一致性的机构</li>
</ul>
<h3 data-id="heading-60">3. AI 视频生成研究者</h3>
<ul>
<li>✅ 研究代码驱动视频生成方法</li>
<li>✅ 评估不同视频生成技术</li>
<li>✅ 构建教育视频生成基准测试</li>
</ul>
<h3 data-id="heading-61">4. 技术爱好者和开发者</h3>
<ul>
<li>✅ 对多智能体系统感兴趣</li>
<li>✅ 希望学习代码生成技术</li>
<li>✅ 想要探索 AI 在教育中的应用</li>
</ul>
<h3 data-id="heading-62">5. 内容创作者</h3>
<ul>
<li>✅ 需要制作教学内容的 YouTuber</li>
<li>✅ 希望提高视频制作效率的创作者</li>
<li>✅ 需要将知识可视化的博主</li>
</ul>
<hr/>
<h2 data-id="heading-63">总结</h2>
<p>Code2Video 是一个创新的代码驱动视频生成框架，它通过可执行的 Manim 代码和多智能体系统，为教育视频生成提供了一个全新的范式。</p>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Go + Gin + Fx 构建工程化后端服务模板（gin-app 实践）]]></title>    <link>https://juejin.cn/post/7603946518372466726</link>    <guid>https://juejin.cn/post/7603946518372466726</guid>    <pubDate>2026-02-08T10:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603946518372466726" data-draft-id="7603688142005190665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Go + Gin + Fx 构建工程化后端服务模板（gin-app 实践）"/> <meta itemprop="keywords" content="后端,Go,前端"/> <meta itemprop="datePublished" content="2026-02-08T10:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="梦想很大很大"/> <meta itemprop="url" content="https://juejin.cn/user/1248673297886535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Go + Gin + Fx 构建工程化后端服务模板（gin-app 实践）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1248673297886535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    梦想很大很大
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:34:07.000Z" title="Sun Feb 08 2026 10:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-…</a></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、写在前面：这是一次真实的工程探索经历</h2>
<p>这篇文章并不是一篇“架构设计说明文档”，而更像是一次<strong>个人工程探索的记录</strong>。</p>
<p>我在使用 Node.js 写后端服务的过程中，一直很喜欢 <strong>NestJS</strong> 那种工程化的代码组织方式：</p>
<ul>
<li>模块化结构清晰</li>
<li>项目层次分明</li>
<li>依赖关系明确</li>
<li>工程规范天然统一</li>
</ul>
<p>当项目规模变大时，这种结构非常“稳”，不容易乱。</p>
<p>后来在转向 Go 做后端项目时，我发现 Go 生态并没有类似 NestJS 这种“开箱即用”的工程型框架。更多是：</p>
<ul>
<li>Gin / Echo / Fiber 解决 Web</li>
<li>各种库组合日志、配置、数据库、鉴权</li>
<li>架构自由，但缺少统一范式</li>
</ul>
<p>一开始我也尝试过很多组合方式，说实话：<strong>项目规模小的时候没问题，一旦项目开始复杂，结构很容易失控</strong>：</p>
<ul>
<li>目录开始变乱</li>
<li>模块边界开始模糊</li>
<li>依赖开始互相引用</li>
<li>测试越来越难写</li>
<li>新人越来越难上手</li>
</ul>
<p>于是我开始有意识地去思考一个问题：</p>
<blockquote>
<p>Go 里能不能也做一套“工程级结构模板”？<br/>
不追求框架能力，而是解决工程组织问题。</p>
</blockquote>
<p>在这个过程中，我也参考过一些优秀项目，比如：<br/>
👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fevrone%2Fgo-clean-template" target="_blank" title="https://github.com/evrone/go-clean-template" ref="nofollow noopener noreferrer">github.com/evrone/go-c…</a></p>
<p>它在分层思想和依赖方向控制上给了我很多启发，但整体更偏理论型架构设计，并不是我想要的那种“工程模板型结构”。</p>
<p>后来逐步尝试将 <strong>Gin + Uber Fx</strong> 组合在一起，一边写项目，一边调整结构，慢慢形成了一套相对稳定的工程组织方式，也就是现在的：</p>
<blockquote>
<p><strong>gin-app</strong><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-…</a></p>
</blockquote>
<p>它不是一个框架项目，更像是：</p>
<blockquote>
<p>我在真实项目中一步步试出来的一套 Go 工程模板结构</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、我想解决的，其实不是“技术问题”</h2>
<p>说实话，这个项目一开始并不是为了追求技术复杂度，而是为了解决几个很现实的问题：</p>
<ul>
<li>项目一大，结构就乱</li>
<li>人一多，风格就乱</li>
<li>模块多了之后，依赖就开始乱</li>
<li>没有统一结构规范，重构成本极高</li>
</ul>
<p>所以 <code>gin-app</code> 的核心目标其实很简单：</p>
<blockquote>
<p>让 Go 项目在规模增长时，依然能保持结构清晰</p>
</blockquote>
<p>而不是：</p>
<blockquote>
<p>写代码更炫、技术更复杂</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">三、为什么选择 Gin + Fx</h2>
<h3 data-id="heading-3">Gin</h3>
<p>这个没什么花哨理由：成熟、稳定、生态好，用起来顺手。</p>
<h3 data-id="heading-4">Fx</h3>
<p>Fx 一开始我也只是当作 DI 工具在用，但真正用到工程里之后发现：</p>
<p>它更像是一个<strong>项目启动调度器</strong>：</p>
<ul>
<li>统一管理组件初始化</li>
<li>统一管理启动流程</li>
<li>统一管理生命周期</li>
<li>自动处理依赖顺序</li>
</ul>
<p>慢慢发现，它更适合做“工程结构工具”，而不只是“依赖注入工具”。</p>
<hr/>
<h2 data-id="heading-5">四、现在的工程结构</h2>
<p>目前项目结构是这样组织的：</p>
<pre><code class="hljs language-csharp" lang="csharp">cmd/
  app/                 <span class="hljs-meta"># 应用启动入口</span>
<span class="hljs-keyword">internal</span>/
  config/              <span class="hljs-meta"># 配置管理</span>
  modules/             <span class="hljs-meta"># 业务模块（user、post、auth 等）</span>
  router/              <span class="hljs-meta"># 路由层</span>
  middleware/          <span class="hljs-meta"># HTTP 中间件（鉴权、日志、跨域等）</span>
  dto/                 <span class="hljs-meta"># 数据传输对象（请求/响应模型）</span>
pkg/
  logger/              <span class="hljs-meta"># 日志模块</span>
  postgres/            <span class="hljs-meta"># PostgreSQL 客户端</span>
  redis/               <span class="hljs-meta"># Redis 客户端</span>
  jwt/                 <span class="hljs-meta"># JWT 工具库</span>
  oauth2/              <span class="hljs-meta"># OAuth2（GitHub / Google 登录）</span>
ent/
  schema/              <span class="hljs-meta"># Ent ORM 模型定义</span>
  migrate/             <span class="hljs-meta"># 数据库迁移文件</span>
docs/                  <span class="hljs-meta"># Swagger 文档</span>
</code></pre>
<p>我现在的核心习惯是：</p>
<ul>
<li>按<strong>业务域拆模块</strong>，而不是按技术拆层</li>
<li>router 只做路由绑定</li>
<li>modules 只做业务逻辑</li>
<li>middleware 独立</li>
<li>dto 单独管理输入输出模型</li>
<li>pkg 放通用基础设施能力</li>
</ul>
<p>模块结构保持类似 NestJS 的风格：</p>
<pre><code class="hljs language-go" lang="go">modules/user
  user.controller.<span class="hljs-keyword">go</span>
  user.service.<span class="hljs-keyword">go</span>
  user.repository.<span class="hljs-keyword">go</span>
  user.module.<span class="hljs-keyword">go</span>
</code></pre>
<p>这种结构的好处很直接：</p>
<blockquote>
<p>找功能 = 找模块，不是翻目录</p>
</blockquote>
<blockquote>
<p><code>user.controller.go</code> 这样的文件命名方式应该是不符合 Go 的开发规范的，但是目前好像也没遇到什么问题，所以...😊</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">五、Fx 在工程里的真实作用</h2>
<p>现在在这个项目里，Fx 更像是：</p>
<blockquote>
<p>一个“工程启动调度器”</p>
</blockquote>
<p>它帮我解决的是：</p>
<ul>
<li>谁先初始化</li>
<li>谁依赖谁</li>
<li>谁什么时候启动</li>
<li>谁什么时候关闭</li>
</ul>
<p>而不是“我怎么 new 一个对象”。</p>
<p>在 <code>gin-app</code> 里，Fx 的使用方式也比较偏工程化，而不是零散注入。</p>
<h3 data-id="heading-7">1. 启动入口统一调度</h3>
<p>整个系统的启动入口集中在 <code>internal/app/app.go</code> 的 <code>Run()</code> 方法中，这里不是简单地 <code>main()</code> + 一堆初始化函数调用，而是通过 <code>fx.New()</code> 作为<strong>系统总调度中心</strong>：</p>
<pre><code class="hljs language-go" lang="go">fx.New(
  fx.Supply(...),
  fx.Provide(
      NewLogger,
      NewPostgresDB,
      NewRedis,
      NewOauth2Client,
      ...
  ),
  modules.APIModule,
  fx.Invoke(startHTTPServer),
).Run()
</code></pre>
<p>这里的结构非常清晰：</p>
<h4 data-id="heading-8">（1）<code>fx.Supply</code> —— 外部配置注入</h4>
<pre><code class="hljs language-go" lang="go">fx.Supply(
  fx.Annotate(cfg, fx.As(<span class="hljs-built_in">new</span>(config.ConfigInterface))),
)
</code></pre>
<p>配置对象作为“外部输入”进入系统容器，而不是在内部到处读取配置文件。</p>
<h4 data-id="heading-9">（2）<code>fx.Provide</code> —— 基础设施统一注册</h4>
<p>包括：</p>
<ul>
<li>Logger</li>
<li>Postgres</li>
<li>Redis</li>
<li>JWT</li>
<li>OAuth2（Github / Google）</li>
<li>Gin Router</li>
<li>API Router</li>
<li>OpenAPI Router</li>
<li>HTTP Server</li>
</ul>
<p>全部集中注册在一个地方，形成：</p>
<blockquote>
<p>基础设施层统一初始化中心</p>
</blockquote>
<p>例如数据库注册：</p>
<pre><code class="hljs language-go" lang="go">fx.Annotate(
  <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(cfg config.ConfigInterface, logger logger.Interface)</span></span> (*postgres.Postgres, <span class="hljs-type">error</span>) {
    pg, err := postgres.New(...)
    ...
    <span class="hljs-keyword">return</span> pg, <span class="hljs-literal">nil</span>
  },
  fx.OnStop(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(logger logger.Interface, pg *postgres.Postgres)</span></span> <span class="hljs-type">error</span> {
    pg.Close()
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
  }),
)
</code></pre>
<p>同时把<strong>生命周期管理</strong>也绑定在注册阶段完成。</p>
<h4 data-id="heading-10">（3）<code>modules.APIModule</code> —— 业务系统整体挂载</h4>
<pre><code class="hljs">modules.APIModule,
</code></pre>
<p>业务模块不是散落注册，而是作为一个完整模块树挂载进系统容器。</p>
<h4 data-id="heading-11">（4）<code>fx.Invoke(startHTTPServer)</code> —— 启动行为声明</h4>
<pre><code class="hljs language-go" lang="go">fx.Invoke(startHTTPServer)
</code></pre>
<p>系统“启动做什么事”通过声明式绑定：</p>
<ul>
<li>不在 <code>main</code> 里写启动逻辑</li>
<li>不在构造函数里启动服务</li>
<li>不靠 init() 隐式行为</li>
</ul>
<p>而是通过 <code>Invoke</code> 显式声明系统启动动作。</p>
<p>配合 <code>Lifecycle</code>：</p>
<pre><code class="hljs language-php" lang="php">lc.<span class="hljs-title function_ invoke__">Append</span>(fx.Hook{
  <span class="hljs-attr">OnStart</span>: ...
  <span class="hljs-attr">OnStop</span>:  ...
})
</code></pre>
<p>形成完整的：</p>
<blockquote>
<p>构建期（Provide） → 装配期（Module） → 启动期（Invoke） → 生命周期管理（Lifecycle）</p>
</blockquote>
<p>这使整个系统从“过程式启动”变成了<strong>声明式启动模型</strong>。</p>
<p>不是“我在 main 里手动控制顺序”，而是：</p>
<blockquote>
<p>系统结构决定启动顺序</p>
</blockquote>
<blockquote>
<p>依赖关系决定初始化顺序</p>
</blockquote>
<p>Fx 在这里更像是一个：<strong>工程启动调度框架</strong>，而不仅是依赖注入工具。</p>
<h3 data-id="heading-12">2. 模块化注册方式（业务模块即路由单元）</h3>
<p>在这个项目里，<strong>模块不仅是业务单元，同时也是路由注册单元</strong>。</p>
<p>每个业务模块都有自己的 <code>module.go</code>，不仅负责依赖注册，也负责路由挂载，例如 <code>user.module.go</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Module = fx.Module(
  <span class="hljs-string">"user"</span>,

  fx.Provide(
    <span class="hljs-comment">// user repository</span>
    fx.Annotate(
      NewUserRepository,
      fx.As(<span class="hljs-built_in">new</span>(UserRepository)),
    ),
    <span class="hljs-comment">// user service</span>
    fx.Annotate(
      NewUserService,
      fx.As(<span class="hljs-built_in">new</span>(UserService)),
    ),
    <span class="hljs-comment">// user controller</span>
    NewUserController,
  ),

  <span class="hljs-comment">// register router</span>
  fx.Invoke(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(
    router api_router.APIRouterParams,
    userController *UserController,
  )</span></span> {
    <span class="hljs-comment">// public routers</span>
    {
      userGroup := router.Public.Group(<span class="hljs-string">"/users"</span>)
      userGroup.POST(<span class="hljs-string">""</span>, userController.CreateOne)
    }

    <span class="hljs-comment">// private routers</span>
    {
      userGroup := router.Private.Group(<span class="hljs-string">"/users"</span>)
      userGroup.GET(<span class="hljs-string">":id"</span>, userController.GetById)
    }
  }),
)
</code></pre>
<p>这里有一个非常重要的设计点：</p>
<blockquote>
<p><strong>路由注册跟着业务模块走，而不是集中在 router 目录统一管理。</strong></p>
</blockquote>
<p>也就是说：</p>
<ul>
<li>一个模块 = 一组业务能力</li>
<li>一个模块 = 一组路由定义</li>
<li>一个模块 = 一组 Controller + Service + Repository</li>
</ul>
<p>模块本身就是一个<strong>完整业务闭环单元</strong>。</p>
<p>这样带来的效果非常直观：</p>
<ul>
<li>新增功能 = 新增模块</li>
<li>删除功能 = 删除模块</li>
<li>查功能 = 查模块</li>
</ul>
<p>而不是在 <code>router.go</code> 里翻几十个路由定义文件。</p>
<p>从工程体验上来说，这种方式非常接近 NestJS 的 Module + Controller 组织模式，只不过是用 Fx 的 Module 机制实现。</p>
<hr/>
<h3 data-id="heading-13">3. 路由系统的初始化解耦设计</h3>
<p><code>internal/router</code> 目录只负责一件事：<strong>Gin 本身的初始化与中间件装配</strong>，不关心任何业务路由。</p>
<h4 data-id="heading-14">Gin 初始化（系统层）</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRouter</span><span class="hljs-params">(
  cfg config.ConfigInterface,
  logger logger.Interface,
)</span></span> *gin.Engine {
  app := gin.Default()

  <span class="hljs-comment">// middlewares</span>
  app.Use(requestid.New())
  app.Use(cors.New(...))
  app.Use(ginzap.GinzapWithConfig(...))
  app.Use(ginzap.RecoveryWithZap(...))
  app.Use(timeout.Timeout(...))
  app.Use(middleware.ErrorHandler(logger))

  <span class="hljs-comment">// Swagger</span>
  <span class="hljs-keyword">if</span> cfg.Swagger().Enabled {
    app.GET(<span class="hljs-string">"/swagger/*any"</span>, ginSwagger.WrapHandler(swaggerfiles.Handler))
  }

  <span class="hljs-keyword">return</span> app
}
</code></pre>
<p>这一层只做系统级能力：</p>
<ul>
<li>中间件装配</li>
<li>日志系统</li>
<li>跨域</li>
<li>超时控制</li>
<li>Swagger</li>
</ul>
<p>完全不出现任何业务路由。</p>
<h4 data-id="heading-15">API Router 抽象层</h4>
<p>通过 Fx 构造 API Router：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> APIRouter <span class="hljs-keyword">struct</span> {
  fx.Out

  Public  *gin.RouterGroup <span class="hljs-string">`name:"api:public"`</span>
  Private *gin.RouterGroup <span class="hljs-string">`name:"api:private"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewAPIRouter</span><span class="hljs-params">(
  cfg config.ConfigInterface,
  jwt jwt.JWTManagerInterface,
  app *gin.Engine,
)</span></span> APIRouter {
  public := app.Group(<span class="hljs-string">"/api/v1"</span>)
  private := public.Group(<span class="hljs-string">"/"</span>)

  private.Use(middleware.APIAuthHandler(jwt, cfg.HTTP().CookieName))

  <span class="hljs-keyword">return</span> APIRouter{
    Public:  public,
    Private: private,
  }
}
</code></pre>
<p>通过 <code>fx.Out</code> + <code>name tag</code>：</p>
<ul>
<li>系统级 Router 负责分组</li>
<li>模块级 Router 只消费分组</li>
</ul>
<p>业务模块只关心：</p>
<pre><code class="hljs language-go" lang="go">router.Public
router.Private
</code></pre>
<p>而不关心：</p>
<ul>
<li>Gin Engine 从哪里来</li>
<li>中间件怎么装</li>
<li>JWT 鉴权怎么挂</li>
</ul>
<p>形成清晰分层：</p>
<blockquote>
<p>系统层：Router 初始化 + 中间件 + 分组策略<br/>
模块层：消费 RouterGroup，注册业务路由</p>
</blockquote>
<p>这让整个系统的路由组织方式变成：</p>
<blockquote>
<p>系统提供“路由能力”<br/>
模块声明“路由行为”</p>
</blockquote>
<p>而不是传统的：</p>
<blockquote>
<p>一个 router 目录管理全世界路由</p>
</blockquote>
<p>每个业务模块都有自己的 <code>module.go</code>，类似：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Module = fx.Module(
  <span class="hljs-string">"user"</span>,
  fx.Provide(
    NewUserService,
    NewUserRepository,
    NewUserController,
  ),
)
</code></pre>
<p>模块只关心：</p>
<ul>
<li>自己提供什么能力</li>
<li>自己依赖什么能力</li>
</ul>
<p>不关心：</p>
<ul>
<li>谁来调用我</li>
<li>谁先启动系统</li>
</ul>
<h3 data-id="heading-16">3. 路由注册解耦</h3>
<p>路由层通过 <code>fx.Invoke</code> 统一注册：</p>
<pre><code class="hljs language-go" lang="go">fx.Invoke(RegisterRouter)
</code></pre>
<p>Router 层只依赖 Controller，不反向依赖业务模块实现，形成清晰依赖方向。</p>
<h3 data-id="heading-17">4. 生命周期统一管理</h3>
<p>通过 Fx 的 <code>Lifecycle</code> 机制统一管理服务生命周期：</p>
<pre><code class="hljs language-go" lang="go">lc.Append(fx.Hook{
  OnStart: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> server.Start()
  },
  OnStop: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> server.Stop()
  },
})
</code></pre>
<p>这让：</p>
<ul>
<li>服务启动顺序可控</li>
<li>资源初始化有序</li>
<li>支持优雅关闭</li>
<li>系统状态统一管理</li>
</ul>
<p>在实际使用中，Fx 带来的最大价值不是“省几行代码”，而是：</p>
<blockquote>
<p>把系统结构从“手动组织”变成“声明式组织”</p>
</blockquote>
<p>系统从“人脑调度”变成“系统调度”。</p>
<hr/>
<h2 data-id="heading-18">六、模块化的真实体验</h2>
<p>模块化之后，一个很直观的感受是：</p>
<ul>
<li>模块边界清晰</li>
<li>改代码不容易误伤其他模块</li>
<li>重构更安全</li>
<li>依赖关系更清楚</li>
</ul>
<p>模块不再是“文件分类”，而是<strong>业务单元</strong>。</p>
<hr/>
<h2 data-id="heading-19">七、这套结构带来的真实变化</h2>
<p>用这套结构写项目之后，最大的变化不是“写得更快”，而是：</p>
<ul>
<li>项目结构更稳</li>
<li>维护压力更小</li>
<li>重构成本更低</li>
<li>新人更容易理解项目</li>
<li>心理负担更小（笑）</li>
</ul>
<hr/>
<h2 data-id="heading-20">八、写在最后</h2>
<p><code>gin-app</code> 对我来说，不是一个“作品”，而更像是：</p>
<blockquote>
<p>一套在真实项目中不断试错、调整、演化出来的工程结构</p>
</blockquote>
<p>它不是标准答案，也不是最佳实践，只是一个：</p>
<blockquote>
<p>当前阶段让我用起来最舒服的一种 Go 工程组织方式</p>
</blockquote>
<p>如果你也在做 Go 项目工程化，可能你也会遇到类似的问题。</p>
<p>这篇文章只是一次个人实践分享，希望能提供一些思路参考，而不是范式标准。</p>
<hr/>
<h2 data-id="heading-21">项目地址</h2>
<p>GitHub：<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1111mp%2Fgin-app" target="_blank" title="https://github.com/1111mp/gin-app" ref="nofollow noopener noreferrer">github.com/1111mp/gin-…</a></p>
<hr/>
<blockquote>
<p>如果你也在做 Go 工程化探索，欢迎交流实践经验 🙌</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[再谈Agent Loop：大模型 “能做事” 的核心机制]]></title>    <link>https://juejin.cn/post/7603643044035330084</link>    <guid>https://juejin.cn/post/7603643044035330084</guid>    <pubDate>2026-02-08T10:39:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603643044035330084" data-draft-id="7603643044035297316" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="再谈Agent Loop：大模型 “能做事” 的核心机制"/> <meta itemprop="keywords" content="Agent,AI编程"/> <meta itemprop="datePublished" content="2026-02-08T10:39:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="周末程序猿"/> <meta itemprop="url" content="https://juejin.cn/user/3245414056989757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            再谈Agent Loop：大模型 “能做事” 的核心机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3245414056989757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    周末程序猿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:39:19.000Z" title="Sun Feb 08 2026 10:39:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上一篇文章介绍了《从0开发大模型之实现Agent（Bash 到 SKILL）》，有些读者反馈文章太长了，所以这篇文章主要介绍 Agent Loop。</p>
<h2 data-id="heading-0">Agent Loop 是什么？</h2>
<p><strong>Agent Loop = 调用模型 → 判断是否要用工具 → 执行工具 → 把结果回喂给模型 → 重复</strong><br/>
直到模型认为信息足够，输出最终答案为止。<br/>
它把大模型从“文本生成器”升级为“能完成任务的执行系统”。</p>
<p>还是用之前最简单执行 Bash 的 Agent 作为样例代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> traceback
<span class="hljs-keyword">from</span> llm_factory <span class="hljs-keyword">import</span> LLMFactory, LLMChatAdapter
<span class="hljs-keyword">from</span> util.mylog <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">from</span> utils <span class="hljs-keyword">import</span> run_bash, BASH_TOOLS

<span class="hljs-comment"># 初始化 API 客户端</span>
<span class="hljs-comment"># 使用 LLMFactory 创建 LLM 实例</span>
llm = LLMFactory.create(
    model_type=<span class="hljs-string">"openai"</span>,
    model_name=<span class="hljs-string">"deepseek-v3.2"</span>, <span class="hljs-comment"># 使用支持的模型</span>
    temperature=<span class="hljs-number">0.0</span>,
    max_tokens=<span class="hljs-number">8192</span>
)
client = LLMChatAdapter(llm)

<span class="hljs-comment"># 系统提示词</span>
SYSTEM = <span class="hljs-string">f"""你是一个位于 <span class="hljs-subst">{os.getcwd()}</span> 的 CLI 代理，系统为 <span class="hljs-subst">{sys.platform}</span>。使用 bash 命令解决问题。

## 规则：
- 优先使用工具而不是文字描述。先行动，后简要解释。
- 读取文件：cat, grep, find, rg, ls, head, tail
- 写入文件：echo '...' &gt; file, sed -i, 或 cat &lt;&lt; 'EOF' &gt; file
- 避免危险操作，如 rm -rf等删除或者清理文件, 或格式化挂载点，或对系统文件进行写操作

## 要求
- 不使用其他工具，仅使用 bash 命令或者 shell 脚本
- 子代理可以通过生成 shell 代码执行
- 如果当前任务超过 bash 的处理范围，则终止不处理
"""</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_bash_commands</span>(<span class="hljs-params">text</span>):
    <span class="hljs-string">"""从 LLM 响应中提取 bash 命令"""</span>
    <span class="hljs-keyword">import</span> re
    pattern = <span class="hljs-string">r'```bash\n(.*?)\n```'</span>
    matches = re.findall(pattern, text, re.DOTALL)
    <span class="hljs-keyword">return</span> [cmd.strip() <span class="hljs-keyword">for</span> cmd <span class="hljs-keyword">in</span> matches <span class="hljs-keyword">if</span> cmd.strip()]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">chat</span>(<span class="hljs-params">prompt, history=<span class="hljs-literal">None</span>, max_steps=<span class="hljs-number">10</span></span>):
    <span class="hljs-keyword">if</span> history isNone:
        history = []
    
    <span class="hljs-comment"># 检查历史记录中是否已有系统提示词（作为系统消息）</span>
    has_system = <span class="hljs-built_in">any</span>(msg.get(<span class="hljs-string">"role"</span>) == <span class="hljs-string">"system"</span><span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> history)
    ifnot has_system:
         <span class="hljs-comment"># 在开头添加系统提示词作为系统消息</span>
         history.insert(<span class="hljs-number">0</span>, {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: SYSTEM})

    history.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt})

    step = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> step &lt; max_steps:
        step += <span class="hljs-number">1</span>
        <span class="hljs-comment"># 1. 调用模型（传递 tools 参数）</span>
        <span class="hljs-comment"># 使用 chat_with_tools 接口，支持 function calling</span>
        response = client.chat_with_tools(
            prompt=prompt,
            messages=history,
            tools=BASH_TOOLS
        )
        <span class="hljs-keyword">if</span> step == <span class="hljs-number">1</span>:
            prompt = <span class="hljs-string">'继续'</span>

        <span class="hljs-comment"># 2. 解析响应内容</span>
        assistant_text = []
        tool_calls = []
        
        logger.info(<span class="hljs-string">f"第 <span class="hljs-subst">{step}</span> 步响应: <span class="hljs-subst">{response}</span>"</span>)

        <span class="hljs-comment"># chat_with_tools 返回的是 Response 对象，包含 content 列表</span>
        <span class="hljs-keyword">for</span> block <span class="hljs-keyword">in</span> response.content:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">getattr</span>(block, <span class="hljs-string">"type"</span>, <span class="hljs-string">""</span>) == <span class="hljs-string">"text"</span>:
                assistant_text.append(block.text)
            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">getattr</span>(block, <span class="hljs-string">"type"</span>, <span class="hljs-string">""</span>) == <span class="hljs-string">"tool_use"</span>:
                tool_calls.append(block)

        <span class="hljs-comment"># 记录助手文本回复</span>
        full_text = <span class="hljs-string">"\n"</span>.join(assistant_text)
        <span class="hljs-keyword">if</span> full_text:
            logger.info(<span class="hljs-string">f"助手: <span class="hljs-subst">{full_text}</span>"</span>)
            history.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: full_text})
        <span class="hljs-keyword">elif</span> tool_calls:
            <span class="hljs-comment"># 如果只有工具调用没有文本，添加一个占位文本到历史，保持对话连贯</span>
            history.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"(Executing tools...)"</span>})
        
        <span class="hljs-comment"># 3. 如果没有工具调用，直接返回内容</span>
        ifnot tool_calls:
            logger.info(<span class="hljs-string">f"第 <span class="hljs-subst">{step}</span> 步结束，无工具调用"</span>)
            <span class="hljs-keyword">if</span> response.stop_reason == <span class="hljs-string">"end_turn"</span>:
                <span class="hljs-keyword">return</span> full_text
            <span class="hljs-comment"># 如果异常结束，也返回</span>
            <span class="hljs-keyword">return</span> full_text o<span class="hljs-string">r"(No response)"</span>

        <span class="hljs-comment"># 4. 执行工具</span>
        logger.info(<span class="hljs-string">f"第 <span class="hljs-subst">{step}</span> 步工具调用: <span class="hljs-subst">{tool_calls}</span>"</span>)
        all_outputs = []
        <span class="hljs-keyword">for</span> tc <span class="hljs-keyword">in</span> tool_calls:
            <span class="hljs-keyword">if</span> tc.name == <span class="hljs-string">"bash"</span>:
                cmd = tc.<span class="hljs-built_in">input</span>.get(<span class="hljs-string">"command"</span>)
                <span class="hljs-keyword">if</span> cmd:
                    logger.info(<span class="hljs-string">f"[使用工具] <span class="hljs-subst">{cmd}</span>"</span>)  <span class="hljs-comment"># 黄色显示命令</span>
                    output = run_bash(cmd)
                    all_outputs.append(<span class="hljs-string">f"$ <span class="hljs-subst">{cmd}</span>\n<span class="hljs-subst">{output}</span>"</span>)
                    <span class="hljs-comment"># 如果输出太长则截断打印</span>
                    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(output) &gt; <span class="hljs-number">200</span>:
                        logger.info(<span class="hljs-string">f"输出: <span class="hljs-subst">{output[:<span class="hljs-number">200</span>]}</span>... (已截断)"</span>)
                    <span class="hljs-keyword">else</span>:
                        logger.info(<span class="hljs-string">f"输出: <span class="hljs-subst">{output}</span>"</span>)
            <span class="hljs-keyword">else</span>:
                logger.warning(<span class="hljs-string">f"Unknown tool: <span class="hljs-subst">{tc.name}</span>"</span>)
        
        <span class="hljs-comment"># 5. 将命令执行结果添加到历史记录中</span>
        <span class="hljs-keyword">if</span> all_outputs:
            combined_output = <span class="hljs-string">"\n"</span>.join(all_outputs)
            history.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">f"执行结果：\n<span class="hljs-subst">{combined_output}</span>\n\n请继续处理。"</span>})
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 有工具调用但没产生输出（可能是解析失败或空命令）</span>
            history.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Error: Tool call failed or produced no output."</span>})

    <span class="hljs-keyword">return</span><span class="hljs-string">"达到最大执行步数限制，停止执行。"</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span>:
        logger.info(chat(sys.argv[<span class="hljs-number">1</span>]))
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 交互模式</span>
        logger.info(<span class="hljs-string">"Bash 代理已启动。输入 'exit' 退出。"</span>)
        history = []
        whileTrue:
            <span class="hljs-keyword">try</span>:
                user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">"&gt; "</span>)
                <span class="hljs-keyword">if</span> user_input.lower() <span class="hljs-keyword">in</span> [<span class="hljs-string">'exit'</span>, <span class="hljs-string">'quit'</span>]:
                    <span class="hljs-keyword">break</span>
                chat(user_input, history)
            <span class="hljs-keyword">except</span> KeyboardInterrupt:
                logger.info(<span class="hljs-string">"\n正在退出..."</span>)
                <span class="hljs-keyword">break</span>
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                logger.info(<span class="hljs-string">f"\n错误: <span class="hljs-subst">{e}</span>"</span>)
                traceback.print_exc()
</code></pre>
<hr/>
<h2 data-id="heading-1">Agent Loop 怎么工作？（核心循环）</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e026af4c1c3b4b62af54fc8fe76bc3f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZGo5pyr56iL5bqP54y_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771151960&amp;x-signature=H3PIAgO3gpowXhvwv8bVgyNZhQU%3D" alt="图片" loading="lazy"/></p>
<p>可以把 Agent Loop 理解成一个递归的工作流（对应上面的代码就是 while 循环，不断将历史数据和执行结果信息输入给LLM）：</p>
<ol>
<li><strong>模型思考</strong>：基于当前上下文理解任务、制定下一步；</li>
<li><strong>选择工具</strong>：如果缺信息或需要执行动作，就发起工具调用请求；</li>
<li><strong>执行工具</strong>：系统根据工具定义（schema）校验参数并运行工具；</li>
<li><strong>结果回传</strong>：把工具结果作为新消息加入对话历史；</li>
<li>回到第 1 步，继续迭代，直到输出最终回答；</li>
</ol>
<p>核心的东西：<strong>上下文会累积</strong>，模型不仅看到用户最初的问题，还能看到自己调用过哪些工具、拿到了哪些结果，从而完成多步推理与决策。</p>
<hr/>
<h2 data-id="heading-2">一个具体例子：扫描代码库安全漏洞</h2>
<p>用户说：“帮我分析这个代码库有没有安全漏洞。”</p>
<p>单次回答不可能完成，因为需要读代码、搜索、归纳，Agent Loop 会这样跑：</p>
<ol>
<li>模型先需要了解项目结构 → 调用<strong>目录列举工具</strong></li>
<li>看到目录结构后，定位入口文件 → 调用<strong>文件读取工具</strong></li>
<li>发现有数据库查询 → 再读数据库模块 → 再次调用<strong>文件读取工具</strong></li>
<li>识别出疑似 SQL 注入（用户输入直接拼接 SQL）→ 为确认影响面，调用<strong>代码搜索工具</strong>找调用点</li>
<li>工具返回 12 处调用 → 模型认为信息足够 → 输出<strong>最终报告</strong>（漏洞说明、位置、修复建议）</li>
</ol>
<p>每一轮都遵循同一个模式：<strong>拿到新信息 → 决定继续行动还是结束输出</strong>，而且这些决定是模型基于当前上下文“自主做的”。</p>
<hr/>
<h2 data-id="heading-3">Agent Loop 里消息长什么样？（对话历史=工作记忆）</h2>
<p>Agent Loop 主要维护一份“对话历史”，它是模型的临时工作记忆。消息通常分两类角色：</p>
<ul>
<li><strong>user</strong>：用户输入、后续指令、以及（常见实现里）工具结果也可能以用户/系统形式注入</li>
<li><strong>assistant</strong>：模型输出，可能是：</li>
<li>
<ul>
<li>给用户的文本回答</li>
<li>工具调用请求（要用哪个工具、参数是什么） -（部分模型支持）推理痕迹</li>
</ul>
</li>
</ul>
<p>对话历史会越积越多，因此通常需要 “对话管理” 策略来避免超出上下文窗口（后面会提到常见问题）。</p>
<hr/>
<h2 data-id="heading-4">工具执行发生了什么？</h2>
<p>当模型请求用工具时，执行系统一般会做这些事：</p>
<ol>
<li>对工具进行：<strong>校验参数</strong>，一般工具遵循如下格式：</li>
</ol>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tool_use"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"toolu_01A09q90qw90lq917835123"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my_function_name"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Latest developments in quantum computing"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>2.  在工具注册表里找到对应工具
3.  <strong>执行工具</strong>，并做好错误处理
4.  把成功结果或失败信息，统一封装成 “工具结果消息” 回传给模型</p>
<p>重点：<strong>工具失败不会直接让循环崩掉</strong>，而是把错误返回给模型，让它有机会调整策略、换工具或重试。</p>
<hr/>
<h2 data-id="heading-5">什么时候结束循环？（Stop Reasons）</h2>
<p>每次调用模型都会带一个 “停止原因”，决定 Loop 下一步怎么走，常见包括：</p>
<ul>
<li><strong>end turn</strong>：模型已完成 → 正常结束并返回最终答案</li>
<li><strong>tool use</strong>：模型要用工具 → 执行工具后继续下一轮</li>
<li><strong>max tokens</strong>：输出被 token 上限截断 → 通常不可恢复，需要报错或拆分任务</li>
<li><strong>stop sequence</strong>：遇到预设停止符 → 正常结束</li>
<li><strong>content filtered / guardrail intervention</strong>：触发安全/策略拦截 → 按产品规则处理</li>
</ul>
<hr/>
<h2 data-id="heading-6">常见坑与解决思路</h2>
<h3 data-id="heading-7">1）上下文窗口耗尽</h3>
<p>循环次数多、工具输出长，会把对话历史撑爆，导致输入过长或模型表现变差。</p>
<p>应对方法：</p>
<ul>
<li>让工具返回<strong>摘要/关键片段</strong>，不要一股脑返回全量</li>
<li>简化工具 schema（复杂嵌套也很吃 token）</li>
<li>用对话管理策略：滑动窗口、总结压缩等</li>
<li>把大任务<strong>拆成多个子任务</strong>，分段跑、分段总结</li>
</ul>
<h3 data-id="heading-8">2）模型老选错工具</h3>
<p>通常是工具描述不清或重叠，模型不知道怎么选。</p>
<p>应对方法：</p>
<ul>
<li>写清楚工具 “适用场景、输入输出、边界”</li>
<li>避免多个工具描述高度相似</li>
</ul>
<h3 data-id="heading-9">3）MaxTokensReached（输出太长）</h3>
<p>可能是回答太长、或上下文太满导致留给输出的空间不够。</p>
<p>应对方法：</p>
<ul>
<li>增加 token 上限（如果可控）</li>
<li>缩短上下文/工具输出</li>
<li>拆分任务为子任务，让子任务执行减少上下文窗口</li>
</ul>
<h3 data-id="heading-10">4）复杂的任务不要全部依赖大模型决策</h3>
<p>可以参考这篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZhc-GDTJSQy69goSDRkfEQ" target="_blank" title="https://mp.weixin.qq.com/s/Zhc-GDTJSQy69goSDRkfEQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Zhc-GDTJS…</a> ，讲的是为什么大模型不能准确执行所有的 skills (这里其实就是对应工具)，主要原因如下：</p>
<ul>
<li>工具太多，会造成噪声，大模型自主决策不一定能按照你想要的方式调用工具链；</li>
<li>没有决策点，大模型会找到最相近的工具，但是有些时候相近的工具不一定是最佳工具；</li>
<li>没有排序，大模型自己决策：A -&gt; B -&gt; C，但是不一定符合你调用的要求；</li>
</ul>
<p><strong>那该怎么做？</strong></p>
<ul>
<li>在提示词或者 rules.md 中增加你当前任务大概需要用到哪些工具，或者强制使用哪些工具；</li>
<li>指出具体任务调用的工具顺序可能是怎么样的？虽然看起来像人工决策，但是往往能有效的解决你想要解决的问题；</li>
</ul>
<hr/>
<h2 data-id="heading-11">参考</h2>
<p>（1）<a href="https://link.juejin.cn?target=https%3A%2F%2Fstrandsagents.com%2Flatest%2Fdocumentation%2Fdocs%2Fuser-guide%2Fconcepts%2Fagents%2Fagent-loop%2F" target="_blank" title="https://strandsagents.com/latest/documentation/docs/user-guide/concepts/agents/agent-loop/" ref="nofollow noopener noreferrer">strandsagents.com/latest/docu…</a><br/>
（2）<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZhc-GDTJSQy69goSDRkfEQ" target="_blank" title="https://mp.weixin.qq.com/s/Zhc-GDTJSQy69goSDRkfEQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/Zhc-GDTJS…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[30岁技术人对职业和生活的思考]]></title>    <link>https://juejin.cn/post/7603688142005256201</link>    <guid>https://juejin.cn/post/7603688142005256201</guid>    <pubDate>2026-02-08T10:43:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005256201" data-draft-id="7603771025855152179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="30岁技术人对职业和生活的思考"/> <meta itemprop="keywords" content="年终总结,前端,后端"/> <meta itemprop="datePublished" content="2026-02-08T10:43:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="元兮"/> <meta itemprop="url" content="https://juejin.cn/user/1433418891795806"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            30岁技术人对职业和生活的思考
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1433418891795806/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    元兮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T10:43:15.000Z" title="Sun Feb 08 2026 10:43:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>按照往年的习惯，2025年的年度思考应该早写完了，可能是由于关键词太多？加班太多没空？找不到落笔处不知从何说起？我想或多或少离不开这些因素。</p>
<p>总的来说，组织变动（裁员）、二次深漂、996常态、拥抱AI、涨薪成为了近一年的关键词，有遗憾，也有惊喜。</p>
<h2 data-id="heading-0">裁员</h2>
<p>上半年我主要在公共支撑组做Go服务端开发，做算法效果的接口支持，也就是基于美图的算法服务，封装一层中间层给业务调用。期间也负责效果方面的服务迁移，包括数据迁移（MySQL -&gt; MongoDB）、接口流量转发，涉及最多的数据达到几个亿，还是存在一个DB一个表中，当时迁移数据都花了一周的时间。</p>
<blockquote>
<p>这时候有人会问：几个亿的数据不进行分表分库？没错，原因有两个：本身逻辑有问题，一个用户只需要生成一个版本记录即可，但实际上生成了多个（升级多次APP版本）。
另外加上频繁的人员、组织变动，估计当时写这个逻辑的人都不在了，所以没人知道这个表数据量一直在猛增，更别说分库分表了。</p>
</blockquote>
<p>说到这个数据、服务迁移，之前没有做过MySQL-&gt;MongoDB数据迁移实践，并且行业的方案也比较少，公司的数据也不允许用第三方的迁移平台，期间心智负担还是蛮大的。最后是通过自己写脚本来实现的，实时性和准确性都得到了保证。</p>
<p>迁移完没几天就迎来了组织架构调整，整个海外部门都需要合并到总部，坑位不够怎么办？财源（裁员）广进嘛！！！</p>
<p>期间大家都没底、内心忐忑，不知道比例，身边的同事做好了重新出去面试的准备。最后是我们组的基本都留了下来，但不少认识的小伙伴都收到了通知，有个关系比较好的，会写Nest和Go，最后也找到了不错的工作，base也涨了，所以这年头多点技能就是比较抗打。</p>
<p>据统计，我们公司只会前端或者后端的开发很少，基本上都是会好几门技术栈的，有些夸张的六边形战士，会6、7个技术栈，然后他们的稳定性也很高。</p>
<h2 data-id="heading-1">二次深漂与996</h2>
<p>第一次深漂应该是我2014年中考毕业的时候，当时进的是工厂，干的是流水线，计件的，一个月3000。被压榨的40天中，有25天都是上夜班，白天早上下班之后，吃完一碗米粉就睡觉下午五六点，起来再吃完饭又继续上夜班，就这样坚持了快一个月，最后拿着4000块去上了大学。</p>
<p>第二次就是2024年接了深圳的offer后，经过一年的产品洗牌，人员流动趋于相对稳定的状态，不会有太大的架构变动，无非是立项多一个新的AI项目，然后把当前项目组的人员all in进去，创新就是如此！</p>
<p>转眼间甜筒也快三岁了，他的户口在南山，以后上学也是在南山。2年前我们从广州搬到佛山新家，我以为那将会是最后一次，有自己的窝以后不用折腾了，但事实是从那之后我几乎是一年一换，过几个月又要搬了，但值得说的是一次比一次住的环境好，这或许是变化带来的福音吧！</p>
<p>计划赶不上变化，其实是生活最原本的模样！后面我去了新的项目组，主要是做Agent修图的，我一个服务端加上六个客户端，996是日常底色，两个多月把iOS赶出来，这得益于AI Coding的威力。多个时候我一天都cover了几个需求，半年下来干了有70+需求，当然这并不值得歌颂，我们在得到相对好绩效同时，也必然意味着会舍弃些陪伴家人的时间、身体的透支，这便是Work Life Balance的矛盾，一个辩证的过程，无论我们如何选择，矛盾并不会消失，它必将转化或升级为另一个矛盾，等着我们再次抉择。</p>
<blockquote>
<p>那达到Work Life Balance的唯一解是什么? 我想应该是在当前平衡被打破时，便需要在更高的水平上重塑新的平衡，以更好的心态、状态和认知维持它。</p>
</blockquote>
<h2 data-id="heading-2">AI带来的焦虑</h2>
<p>最近网上有个名称火了，叫<code>FOMO</code>，意为<code>错失恐惧症</code>，它形容由于担心错过他人正在体验的有趣事物、社交活动或投资机会，而产生的一种持续性焦虑和不安感。</p>
<p>这种心理偏差通常会导致<code>非理性</code>的决策，常见的就是去买各种AI编程课程、Agent开发教程、报名AI知识相关的培训，知识付费没有错，原因在于执行力与期待的ToDo List不匹配，本质上是正反馈缺失。所以，沉浸于自己完成所有Todo List的那种兴奋是虚构的，而实践中那种痛苦、无助才是我们最真实的感受，每当我萌生学了就等于会了的念头，都会想到这句话。</p>
<p>焦虑是正常的，代表着当下我们的状态与预期存在差异，并且在一定时间内无法达到预期，作为人体内在的一种机制，这是实际上在我最忙的几个月中，网上各种概念层出不穷，各厂商LLM的版本迭代日新月异，什么Mcp、langChain、langGraph、手搓ai agent、SDD、Skills、Spec Kit、Open Spec、Open Code等等，我会焦虑每天没有时间了解这些新的变化，但受限于每天带宽有限，了解的程度有限，只能将自身调整为一种新的状态并维持其平衡，让自己处于一种<strong>长期乐观、短期痛苦、当下快乐</strong>的舒适区边缘中，<code>太用力的人反而跑不远</code>。</p>
<p>最近与出版社的编辑在聊天，问我想不想再出多一本书，关于AI编程方面（扣子），实际上站在我的角度这有点为了写而写，因为我在工作中并不会用到这玩意，并且粉丝群体也很少有这方面需求，但写出来之后又不得不为了销量而进行营销，我想这有点背离我写作的本意，也不是真正的利他（或许也是基于我对扣子不够了解）。实际上懂AI Coding，AI Agent开发对于目前的全栈开发来说更能够提升个人价值，我也在<strong>着手准备写<code>AI Coding，AI Agent</code>这两方面的合集</strong>。</p>
<h2 data-id="heading-3">涨薪</h2>
<p>这段时间绩效面谈完收到涨薪的消息，比较意外。原本对于公司是否有涨薪的动作我是不抱任何期待的，可能是因为我上一家经常连工资都发不出，无形之中降低了我的预期，这种低预期管理带来的结果往往是惊喜较多（蚊子腿也是肉）。</p>
<h2 data-id="heading-4">觉醒</h2>
<p>关于成长，重复读了<code>《毛选》、《矛盾论》</code>，解开了很多我职场和生活中的烦恼和疑惑，所以平时我都是躺下就睡，很少因为某件事情而失眠；但也遗憾有些事情是短时间内无法解决的，比如小家庭与大家庭之间的矛盾，但总需要在合适的时间打破当前的平衡，创造合适的条件，让矛盾往有利的方向发展。</p>
<p>如果你想提高自己的认知能力，忘记过去犯过的错误是坚决不行的。新读了<code>《段永平投资问答录》</code>，回想过去几年不管是职场还是生活，我都违背了<code>不懂不做</code>和<code>不margin（杠杆）</code>的原则，所以让我的生活出现的比较大的起伏。</p>
<p>前几年我在没有做任何了解之前贸然背上了房贷，交易大厅坐满了<code>托</code>，这是开发商放的烟雾弹，我不懂，现场就交定金。贷款利率<code>5.88%</code>，我没了解这是什么水平和概念，单纯认为几千块的月供我能够cover。</p>
<p><code>首付贷</code>，我也不了解，只知道有人支付给我20w付首付，<code>10%</code>的利率无所谓，再上杠杆，干就完了！为此，我花了一年半时间才还完这个认知债。</p>
<p>补充了<code>财务知识</code>，前几年离职去all in了其他行业，经历了很多事情，看懂人性冷暖，也重新理解了理财是必不可少的。另外，也理解了命运，我一生中，注定是不平凡的。</p>
<p>近半年为了与<code>邪恶的物业</code>做斗争，交房3年，管理服务缺失，车位迟迟不交，我拒绝缴纳物业费。读完了<code>《物业管理条例》、《物业纠纷一站式法律指引》</code>，我时刻都在准备着。</p>
<h2 data-id="heading-5">总结：人生没有一步是白走的</h2>
<p>人生从来不是一条平滑向上的直线，而是在一次次平衡被打破后，重新建立更高阶的平衡。</p>
<p>最后，贴上一句教员的万能解决问题思路：</p>
<blockquote>
<p>你对于那个问题不能解决吗？那末，你就去调查那个问题的现状和它的历史吧！你完完全全调查明白了，你对那个问题就有解决的办法了</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[虚拟列表：支持“向上加载”的历史消息（Vue 3 & React 双版本）]]></title>    <link>https://juejin.cn/post/7603946518372515878</link>    <guid>https://juejin.cn/post/7603946518372515878</guid>    <pubDate>2026-02-08T11:00:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603946518372515878" data-draft-id="7603946518372450342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="虚拟列表：支持“向上加载”的历史消息（Vue 3 &amp; React 双版本）"/> <meta itemprop="keywords" content="前端,面试,JavaScript"/> <meta itemprop="datePublished" content="2026-02-08T11:00:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            虚拟列表：支持“向上加载”的历史消息（Vue 3 &amp; React 双版本）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T11:00:11.000Z" title="Sun Feb 08 2026 11:00:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在AI聊天产品中，向上滚动加载历史消息是一个经典场景。如果直接渲染万级聊天记录，页面必卡无疑。而使用虚拟列表时，<strong>向上插入数据导致的位置偏移</strong>是最大的技术痛点。本文将分享如何实现一个支持“滚动位置锁定”和“动态高度补偿”的虚拟列表方案。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97bb245233ce41d89a9de7e4c60bd87e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=%2Bkaio29XJ8HeFLo6mXLCcFZ%2FA0Y%3D" alt="react虚拟列表向上加载.gif" loading="lazy"/></p>
<h2 data-id="heading-1">一、 核心困难点：为什么向上加载这么难？</h2>
<ol>
<li><strong>滚动位置丢失</strong>：当你向数组头部插入 5 条新消息时，总高度会增加。如果不处理，浏览器会停留在原来的 <code>scrollTop</code>，导致用户看到的内容被“顶走”。</li>
<li><strong>动态高度计算</strong>：聊天内容（图片、长文本）高度不一，必须在 DOM 渲染后通过 <code>ResizeObserver</code> 实时修正。</li>
<li><strong>索引偏移</strong>：插入数据后，原来的索引全部失效，必须依赖“累计高度数组”和二分查找重新定位。</li>
</ol>
<hr/>
<h2 data-id="heading-2">二、 实现思路</h2>
<h4 data-id="heading-3">1、第一步：搭个“戏台子”（基础结构）</h4>
<p>我们要搭一个三层嵌套的戏台，每一层都有它的“使命”：</p>
<ol>
<li><strong>外层大管家</strong>：固定好高度，别让列表把页面撑坏了。</li>
<li><strong>“虚胖”占位层</strong>：这是个空盒子，高度设为 <code>totalHeight</code>。它的唯一作用是<strong>欺骗浏览器</strong>，让滚动条以为这里有成千上万条数据，从而产生真实的滚动感。</li>
<li><strong>舞台中心（可视区）</strong> ：绝对定位。它会像电梯一样，跟着你的滚动距离通过 <code>translateY</code> 灵活位移，永远保证自己出现在观众视线内。</li>
</ol>
<h4 data-id="heading-4">2、第二步：准备核心数据</h4>
<p>为了让“戏”不演砸，我们需要掌握这些情报：</p>
<ul>
<li><strong>预判值</strong>：<code>MIN_ITEM_HEIGHT</code>（哪怕不知道多高，也得有个保底值）和 <code>BUFFER_SIZE</code>（多渲染几行，别让用户一滑就看到白屏）。</li>
<li><strong>雷达站</strong>：<code>LOAD_THRESHOLD</code>（距离顶部还有多远时，赶紧去后台搬救兵/加载数据）。</li>
<li><strong>记账本</strong>：用一个 <code>Map</code> 记录每个消息的真实高度，再整一个 <code>cumulativeHeights</code>（累计高度数组），记录每一条消息距离顶部的距离。</li>
</ul>
<h4 data-id="heading-5">3、第三步：索引计算</h4>
<ul>
<li><strong>找起点</strong>：用<strong>二分查找</strong>在“记账本”里搜一下，看现在的滚动位置对应哪一行的地盘。</li>
<li><strong>定终点</strong>：起点加上你能看到的行数，再算上“缓冲区”的几位，就是这一幕的结束。</li>
<li><strong>定位置</strong>：算出起点项对应的累计高度，把舞台一推（<code>offsetY</code>），搞定！</li>
</ul>
<h4 data-id="heading-6">4、第四步：时间回溯（向上加载的核心！核心！）</h4>
<p>这是实现向上加载最难的地方：往开头塞了新胶片，怎么保证观众看到的画面不跳动？</p>
<ol>
<li><strong>做标记</strong>：触发加载前，先死死记住现在的 <code>scrollHeight</code>（总高）和 <code>scrollTop</code>（进度）。</li>
<li><strong>塞数据</strong>：把新消息“砰”地一下插到 <code>listData</code> 的最前面。</li>
<li><strong>神操作（高度补偿）</strong> ：数据塞进去后，总高度肯定变了。这时候赶紧算一下：<code>新高度 - 旧高度 = 增加的高度</code>。</li>
<li><strong>瞬间平移</strong>：把滚动条位置强制修改为 <code>旧进度 + 增加的高度</code>。这套动作要在浏览器刷新前完成，用户只会觉得加载了新内容，但眼前的画面纹丝不动。</li>
</ol>
<h4 data-id="heading-7">5、第五步：实时监控（高度纠正）</h4>
<p>万一某条消息里突然蹦出一张大图，高度变了怎么办？</p>
<ul>
<li><strong>派出侦察兵</strong>：子组件自带 <code>ResizeObserver</code>，一旦发现自己长高了，立马报告给父组件。</li>
<li><strong>精准打击</strong>：父组件收到报告，更新账本。如果这个变高的项在观众视线<strong>上方</strong>，还得手动把滚动条再推一推，防止内容在眼皮子底下“乱跳”。</li>
</ul>
<h4 data-id="heading-8">6、终章：开幕仪式（初始化）</h4>
<ol>
<li><strong>一滚到底</strong>：聊天室嘛，进场肯定得看最下面（最新消息）。</li>
<li><strong>双重保险</strong>：调用 <code>scrollToBottom</code> 时，先用 <code>requestAnimationFrame</code> 请浏览器配合，再加个 <code>setTimeout</code> 兜底，确保无论网络多慢，都能准确降落在列表底部。</li>
</ol>
<hr/>
<h2 data-id="heading-9">三、 Vue 3 + TailwindCSS 实现</h2>
<h3 data-id="heading-10">1.  虚拟列表组件：</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    class="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"
  &gt;
    &lt;div
      class="bg-white mt-10 rounded-xl border shadow-lg relative"
      ref="containerRef"
    &gt;
      &lt;div
        ref="virtualListRef"
        class="h-full overflow-auto relative overflow-anchor-none"
        @scroll="handleScroll"
      &gt;
        &lt;!-- 顶部加载提示 --&gt;
        &lt;div
          v-if="isLoading"
          class="sticky top-0 z-10 py-2 flex justify-center items-center text-sm text-gray-500"
        &gt;
          &lt;div class="flex items-center space-x-2"&gt;
            &lt;span&gt;正在加载...&lt;/span&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div :style="{ height: `${totalHeight}px` }"&gt;&lt;/div&gt;
        &lt;div
          class="absolute top-0 left-0 right-0"
          :style="{ transform: `translateY(${offsetY}px)` }"
        &gt;
          &lt;VirtualListItem
            v-for="item in visibleList"
            :key="item.id"
            :item="item"
            @update-height="handleItemHeightUpdate"
          /&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, computed, nextTick, watch } from 'vue';
import VirtualListItem from './listItem.vue';

const MIN_ITEM_HEIGHT = 80; //预设虚拟列表项最小高度
const BUFFER_SIZE = 5; // 缓冲区大小，用于预加载项
const LOAD_THRESHOLD = 50; // 加载消息触发距离

const virtualListRef = ref&lt;HTMLDivElement | null&gt;(null); // 虚拟列表容器引用
const listData = ref&lt;any[]&gt;([]); // 列表数据
const itemHeights = ref&lt;Map&lt;number, number&gt;&gt;(new Map()); // 列表项高度数组：存储每个项的高度
const scrollTop = ref(0); // 滚动位置：当前滚动的垂直偏移量
const isLoading = ref(false); // 是否正在加载更多数据
const isInitialized = ref(false); // 是否已初始化：用于判断是否已加载初始数据
const hasMore = ref(true); // 是否有更多数据可加载
const containerRef = ref&lt;HTMLDivElement | null&gt;(null);

let minId = 10000; // 模拟生成消息ID

// 计算累计高度数组,对应了每个元素在列表中的垂直位置
const cumulativeHeights = computed(() =&gt; {
  const heights: number[] = [0];
  let currentSum = 0;
  for (const item of listData.value) {
    const h = itemHeights.value.get(item.id) || MIN_ITEM_HEIGHT;
    currentSum += h;
    heights.push(currentSum);
  }
  return heights;
});

// 列表总高度：列表所有项的累计高度
const totalHeight = computed(() =&gt; {
  const len = cumulativeHeights.value.length;
  return len &gt; 0 ? cumulativeHeights.value[len - 1] : 0;
});

// 起始索引
const startIndex = computed(() =&gt; {
  let low = 0,
    high = cumulativeHeights.value.length - 1;
  // 核心：根据二分查找法出可视区内第一个可见项的索引!!!!!
  while (low &lt;= high) {
    const mid = Math.floor((low + high) / 2);
    if (cumulativeHeights.value[mid] &lt; scrollTop.value) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }
  return Math.max(0, low - 1 - BUFFER_SIZE);
});

// 结束索引
const endIndex = computed(() =&gt; {
  if (!virtualListRef.value) return 10;
  const t = scrollTop.value + virtualListRef.value.clientHeight; // 可视区底部在列表中的垂直位置`
  let low = 0,
    high = cumulativeHeights.value.length - 1;
  // 核心：根据二分查找法出可视区内最后一个可见项的索引!!!!!
  while (low &lt;= high) {
    const mid = Math.floor((low + high) / 2);
    if (cumulativeHeights.value[mid] &lt; t) {
      low = mid + 1;
    } else {
      high = mid - 1;
    }
  }
  return Math.min(listData.value.length, low + BUFFER_SIZE);
});

// 可见列表项：根据起始索引和结束索引截取列表数据
const visibleList = computed(() =&gt; {
  return listData.value.slice(startIndex.value, endIndex.value);
});

// 偏移量：根据起始索引计算列表项的垂直偏移量
const offsetY = computed(() =&gt; {
  if (startIndex.value === 0) return 0;
  return cumulativeHeights.value[startIndex.value];
});

// mock真实数据
const generateData = (count: number) =&gt; {
  const arr = [];
  for (let i = 0; i &lt; count; i++) {
    minId--;
    arr.push({
      id: minId,
      content: `历史消息 ${minId}`,
      timestamp: new Date().toLocaleTimeString(),
    });
  }
  return arr;
};

// 初始化数据
const initData = async () =&gt; {
  const initialData = await new Promise&lt;any[]&gt;(
    (resolve) =&gt; setTimeout(() =&gt; resolve(generateData(20)), 100) // 模拟异步数据加载，初始加载时加载20条数据防止数据量过少撑不起容器
  );
  listData.value = initialData.reverse();
  await nextTick(); // 等待listData渲染到DOM中
  await nextTick(); // 再次等待子组件完全渲染并计算好实际高度

  isInitialized.value = true;
  scrollToBottom(); // 滚动到底部显示最新消息
};

// 滚动到底
const scrollToBottom = () =&gt; {
  if (!virtualListRef.value) return;
  const scroll = () =&gt; {
    nextTick(() =&gt; {
      if (virtualListRef.value) {
        const scrollHeight = virtualListRef.value.scrollHeight;
        const clientHeight = virtualListRef.value.clientHeight;
        virtualListRef.value.scrollTop = scrollHeight - clientHeight;
        scrollTop.value = virtualListRef.value.scrollTop;
      }
    });
  };

  // 双重保障：先使用requestAnimationFrame等待浏览器完成一次重绘，此时 scrollHeight 和 clientHeight 已正确计算，
  // 再用setTimeout兜底确保即使 requestAnimationFrame 失效也能执行
  requestAnimationFrame(() =&gt; {
    scroll();
    // 兜底方案，确保滚动执行
    setTimeout(() =&gt; {
      scroll();
    }, 100);
  });
};

// 监听totalHeight变化，初始化时确保滚动到底部
watch(
  totalHeight,
  (newVal, oldVal) =&gt; {
    if (isInitialized.value &amp;&amp; oldVal === 0 &amp;&amp; newVal &gt; 0) {
      scrollToBottom();
    }
  },
  { immediate: true }
);

// 加载新消息
const loadNewMessages = async () =&gt; {
  if (isLoading.value || !hasMore.value || !isInitialized.value) return;
  isLoading.value = true;
  try {
    await new Promise((resolve) =&gt; setTimeout(resolve, 1000));    // 模拟1秒延迟
    const newData = generateData(5); // 每次加载5条新消息
    const currentScrollHeight = virtualListRef.value?.scrollHeight || 0;    // 记录当前滚动状态，为未加载前整个列表的高度（含不可见）！！！
    const currentScrollTop = scrollTop.value;
    listData.value = [...newData, ...listData.value];    // 在顶部添加新数据
    await nextTick();    // 等待DOM更新
    // 保持滚动位置，让用户停留在原来的地方
    if (virtualListRef.value) {
      const newScrollHeight = virtualListRef.value.scrollHeight;
      const heightAdded = newScrollHeight - currentScrollHeight;
      virtualListRef.value.scrollTop = currentScrollTop + heightAdded;
      scrollTop.value = virtualListRef.value.scrollTop;
    }
    // 模拟没有更多数据的情况
    if (minId &lt;= 9000) {
      hasMore.value = false;
    }
  } catch (error) {
    console.error('加载消息失败:', error);
  } finally {
    isLoading.value = false;
  }
};

// 处理项目高度更新
const handleItemHeightUpdate = (id: number, realHeight: number) =&gt; {
  const oldHeight = itemHeights.value.get(id) || MIN_ITEM_HEIGHT;
  const diff = realHeight - oldHeight;
  if (Math.abs(diff) &lt; 1) return;

  itemHeights.value.set(id, realHeight);
  // 如果项目在可视区域上方，调整滚动位置
  const index = listData.value.findIndex((item) =&gt; item.id === id);
  if (index &lt; 0) return;

  const itemTop = cumulativeHeights.value[index];
  const viewportTop = scrollTop.value;

  if (itemTop &lt; viewportTop &amp;&amp; virtualListRef.value) {
    virtualListRef.value.scrollTop += diff;
    scrollTop.value = virtualListRef.value.scrollTop;
  }
};

// 处理滚动事件
const handleScroll = (e: Event) =&gt; {
  const target = e.target as HTMLDivElement;
  scrollTop.value = target.scrollTop;

  // 当滚动到距离顶部LOAD_THRESHOLD像素时，加载更多消息
  if (
    scrollTop.value &lt;= LOAD_THRESHOLD &amp;&amp;
    !isLoading.value &amp;&amp;
    hasMore.value &amp;&amp;
    isInitialized.value
  ) {
    loadNewMessages();
  }
};


// 初始化
onMounted(() =&gt; {
  // 计算容器高度：视口高度减去上下边距和标题区域
  if (containerRef.value) {
    const computedHeight = window.innerHeight - 200; // 等价于 calc(100vh - 200px)
    containerRef.value.style.height = `${Math.max(200, computedHeight)}px`; // 防止负数或太小
  }
  // 确保DOM完全挂载后再初始化数据
  nextTick(() =&gt; {
    initData();
  });
});
&lt;/script&gt;

&lt;style scoped&gt;
.overflow-anchor-none {
  overflow-anchor: none;
}
&lt;/style&gt;

</code></pre>
<h3 data-id="heading-11">2. 子组件：</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div
    ref="itemRef"
    class="py-2 px-4 border-b border-gray-200"
    :class="{
      'bg-pink-200': item.id % 2 !== 0,
      'bg-green-200': item.id % 2 === 0,
    }"
    :style="{ height: item.id % 2 === 0 ? '150px' : '100px' }"
  &gt;
    {{ item.content }}
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref, onMounted, onUpdated, onUnmounted, watch, nextTick } from 'vue';

// 定义props：接收父组件传递的item数据
const props = defineProps&lt;{
  item: {
    id: number;
    content: string;
  };
}&gt;();

// 定义emit：向父组件传递高度更新事件
const emit = defineEmits&lt;{
  (e: 'update-height', id: number, height: number): void;
}&gt;();

const itemRef = ref&lt;HTMLDivElement | null&gt;(null);
let resizeObserver: ResizeObserver | null = null;

// 计算并发送当前组件的高度
const sendItemHeight = () =&gt; {
  if (!itemRef.value) return;
  const realHeight = itemRef.value.offsetHeight;
  emit('update-height', props.item.id, realHeight);
};

// 监听组件挂载：首次发送高度 + 监听高度变化
onMounted(() =&gt; {
  // 首次渲染完成后发送高度
  nextTick(() =&gt; {
    sendItemHeight();
  });

  // 监听元素高度变化（适配动态内容导致的高度变化）
  if (window.ResizeObserver) {
    resizeObserver = new ResizeObserver(() =&gt; {
      sendItemHeight();
    });
    if (itemRef.value) {
      resizeObserver.observe(itemRef.value);
    }
  }
});

// 组件更新后重新发送高度（比如内容变化）
onUpdated(() =&gt; {
  nextTick(() =&gt; {
    sendItemHeight();
  });
});

// 组件卸载：清理监听
onUnmounted(() =&gt; {
  if (resizeObserver) {
    resizeObserver.disconnect();
    resizeObserver = null;
  }
});

// 监听item变化：如果item替换，重新计算高度
watch(
  () =&gt; props.item.id,
  () =&gt; {
    nextTick(() =&gt; {
      sendItemHeight();
    });
  }
);
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-12">3. 效果图：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e215fba6c3644a5fb642682382953bb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=OzJ2Deey2TPyP%2FPxvP0KN1S5pj8%3D" alt="vue虚拟列表向上加载.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-13">四、 React + TailwindCSS实现</h2>
<p>在React中我们需要利用 <code>useMemo</code> 优化索引计算，并利用 <code>useLayoutEffect</code> 处理滚动位置，避免视觉闪烁。</p>
<h3 data-id="heading-14">1.  虚拟列表组件：</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useState,
  useRef,
  useEffect,
  useMemo,
  useCallback,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VirtualListItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./VirtualListItem'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span> = <span class="hljs-number">80</span>; <span class="hljs-comment">// 每个列表项的最小高度</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUFFER_SIZE</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// 缓冲区大小，用于预加载</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">LOAD_THRESHOLD</span> = <span class="hljs-number">30</span>; <span class="hljs-comment">// 触发加载的px值</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NEW_DATA_COUNT</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// 每次加载的新数据数量</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRE_LOAD_OFFSET</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 预加载偏移量，用于提前加载部分数据</span>

<span class="hljs-comment">// 列表项类型定义</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItem</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 列表项的唯一标识符</span>
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 列表项的内容</span>
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 列表项的时间戳</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualList</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> virtualListRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 虚拟列表容器引用</span>
  <span class="hljs-keyword">const</span> containerRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 列表容器引用</span>
  <span class="hljs-keyword">const</span> loadTimerRef = useRef&lt;<span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">setTimeout</span>&gt; | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 加载定时器引用</span>
  <span class="hljs-keyword">const</span> initScrollAttemptsRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// 初始化滚动尝试次数引用，最多10次</span>
  <span class="hljs-keyword">const</span> [listData, setListData] = useState&lt;<span class="hljs-title class_">ListItem</span>[]&gt;([]); <span class="hljs-comment">// 列表数据状态，初始为空数组</span>
  <span class="hljs-keyword">const</span> [itemHeights, setItemHeights] = useState&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt;&gt;(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
  ); <span class="hljs-comment">// 列表项高度映射Map</span>
  <span class="hljs-keyword">const</span> [scrollTop, setScrollTop] = useState&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>); <span class="hljs-comment">// 滚动位置状态，初始为0</span>
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 加载状态，初始为false</span>
  <span class="hljs-keyword">const</span> [isInitialized, setIsInitialized] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 初始化状态，初始为false</span>
  <span class="hljs-keyword">const</span> [hasMore, setHasMore] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 是否还有更多数据状态，初始为true</span>

  <span class="hljs-keyword">const</span> minIdRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">10000</span>); <span class="hljs-comment">// 最小ID引用，初始为10000</span>
  <span class="hljs-keyword">const</span> isLoadingRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 正在加载状态</span>
  <span class="hljs-keyword">const</span> hasMoreRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 是否还有更多数据</span>
  <span class="hljs-keyword">const</span> isFirstInitRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 是否第一次初始化</span>
  <span class="hljs-keyword">const</span> scrollStateRef = useRef&lt;{
    <span class="hljs-attr">isManualScroll</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-attr">lastScrollTop</span>: <span class="hljs-built_in">number</span>;
  }&gt;({
    <span class="hljs-attr">isManualScroll</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">lastScrollTop</span>: <span class="hljs-number">0</span>,
  }); <span class="hljs-comment">// 滚动状态引用</span>

  <span class="hljs-comment">// 同步 ref 和 state</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    isLoadingRef.<span class="hljs-property">current</span> = isLoading;
    hasMoreRef.<span class="hljs-property">current</span> = hasMore;
  }, [isLoading, hasMore]);

  <span class="hljs-comment">// 计算累计高度</span>
  <span class="hljs-keyword">const</span> cumulativeHeights = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">heights</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>];
    <span class="hljs-keyword">let</span> currentSum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> listData) {
      <span class="hljs-keyword">const</span> h = itemHeights.<span class="hljs-title function_">get</span>(item.<span class="hljs-property">id</span>) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
      currentSum += h;
      heights.<span class="hljs-title function_">push</span>(currentSum);
    }
    <span class="hljs-keyword">return</span> heights;
  }, [listData, itemHeights]);

  <span class="hljs-comment">// 列表总高度</span>
  <span class="hljs-keyword">const</span> totalHeight = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> cumulativeHeights[cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>] || <span class="hljs-number">0</span>;
  }, [cumulativeHeights]);

  <span class="hljs-comment">// 起始索引</span>
  <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span> || listData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>,
      high = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (low &lt;= high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (cumulativeHeights[mid] &lt; scrollTop) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid - <span class="hljs-number">1</span>;
      }
    }

    <span class="hljs-keyword">const</span> baseIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, low - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, baseIndex - <span class="hljs-variable constant_">BUFFER_SIZE</span>);
  }, [cumulativeHeights, scrollTop, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// 结束索引</span>
  <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span> || listData.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">BUFFER_SIZE</span> * <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> clientHeight = virtualListRef.<span class="hljs-property">current</span>.<span class="hljs-property">clientHeight</span>;
    <span class="hljs-keyword">const</span> t = scrollTop + clientHeight + <span class="hljs-variable constant_">PRE_LOAD_OFFSET</span>;
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>,
      high = cumulativeHeights.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> (low &lt;= high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (cumulativeHeights[mid] &lt; t) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid - <span class="hljs-number">1</span>;
      }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(listData.<span class="hljs-property">length</span>, low + <span class="hljs-variable constant_">BUFFER_SIZE</span>);
  }, [cumulativeHeights, scrollTop, listData.<span class="hljs-property">length</span>]);

  <span class="hljs-comment">// 可见列表项</span>
  <span class="hljs-keyword">const</span> visibleList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> listData.<span class="hljs-title function_">slice</span>(startIndex, endIndex);
  }, [listData, startIndex, endIndex]);

  <span class="hljs-comment">// 偏移量</span>
  <span class="hljs-keyword">const</span> offsetY = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> startIndex === <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : cumulativeHeights[startIndex];
  }, [cumulativeHeights, startIndex]);

  <span class="hljs-comment">// 生成模拟数据</span>
  <span class="hljs-keyword">const</span> generateData = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">count: <span class="hljs-built_in">number</span>, isInitialLoad: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">ListItem</span>[] = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        minIdRef.<span class="hljs-property">current</span>--;
        arr.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">id</span>: minIdRef.<span class="hljs-property">current</span>,
          <span class="hljs-attr">content</span>: <span class="hljs-string">`历史消息 <span class="hljs-subst">${minIdRef.current}</span>`</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toLocaleTimeString</span>(),
        });
      }
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'生成数据:'</span>, arr);
      <span class="hljs-keyword">if</span> (!isInitialLoad) {
        arr.<span class="hljs-title function_">reverse</span>();
      }
      <span class="hljs-keyword">return</span> arr;
    },
    []
  );

  <span class="hljs-comment">// 滚动到底部</span>
  <span class="hljs-keyword">const</span> scrollToBottom = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!virtualListRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;

    <span class="hljs-comment">// 使用多次尝试，直到成功滚动到底部</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">attemptScroll</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> scrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;
        <span class="hljs-keyword">const</span> clientHeight = scrollEl.<span class="hljs-property">clientHeight</span>;

        <span class="hljs-keyword">if</span> (scrollHeight &gt; clientHeight) {
          <span class="hljs-keyword">const</span> targetScrollTop = scrollHeight - clientHeight;
          <span class="hljs-keyword">const</span> currentScrollTop = scrollEl.<span class="hljs-property">scrollTop</span>;

          <span class="hljs-comment">// 如果还没到底部，继续滚动</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(currentScrollTop - targetScrollTop) &gt; <span class="hljs-number">1</span>) {
            scrollEl.<span class="hljs-property">scrollTop</span> = targetScrollTop;
            <span class="hljs-title function_">setScrollTop</span>(targetScrollTop);

            <span class="hljs-comment">// 增加尝试次数</span>
            initScrollAttemptsRef.<span class="hljs-property">current</span>++;

            <span class="hljs-comment">// 最多尝试10次，每次间隔50ms</span>
            <span class="hljs-keyword">if</span> (initScrollAttemptsRef.<span class="hljs-property">current</span> &lt; <span class="hljs-number">10</span>) {
              <span class="hljs-built_in">setTimeout</span>(attemptScroll, <span class="hljs-number">50</span>);
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'初始化滚动到底部完成'</span>);
              isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'已经滚动到底部'</span>);
            isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
          }
        } <span class="hljs-keyword">else</span> {
          isFirstInitRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 内容高度小于容器高度，不需要滚动</span>
        }
      });
    };

    <span class="hljs-comment">// 重置尝试次数并开始滚动</span>
    initScrollAttemptsRef.<span class="hljs-property">current</span> = <span class="hljs-number">0</span>;
    <span class="hljs-title function_">attemptScroll</span>();
  }, []);

  <span class="hljs-comment">// 初始化数据</span>
  <span class="hljs-keyword">const</span> initData = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> initialData = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ListItem</span>[]&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">generateData</span>(<span class="hljs-number">20</span>, <span class="hljs-literal">true</span>)), <span class="hljs-number">100</span>)
      );
      <span class="hljs-title function_">setListData</span>(initialData);
      <span class="hljs-title function_">setIsInitialized</span>(<span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'初始化数据失败:'</span>, error);
    }
  }, [generateData]);

  <span class="hljs-comment">// 核心：加载新消息</span>
  <span class="hljs-keyword">const</span> loadNewMessages = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (isLoadingRef.<span class="hljs-property">current</span> || !hasMoreRef.<span class="hljs-property">current</span> || !isInitialized) <span class="hljs-keyword">return</span>;

    isLoadingRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
      <span class="hljs-keyword">const</span> newData = <span class="hljs-title function_">generateData</span>(<span class="hljs-variable constant_">NEW_DATA_COUNT</span>, <span class="hljs-literal">false</span>);

      <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;
      <span class="hljs-keyword">if</span> (!scrollEl) <span class="hljs-keyword">return</span>;

      <span class="hljs-comment">// 1. 记录加载前的滚动位置</span>
      <span class="hljs-keyword">const</span> beforeScrollTop = scrollEl.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-keyword">const</span> beforeScrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;

      <span class="hljs-comment">// 2. 更新数据</span>
      <span class="hljs-title function_">setListData</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> [...newData, ...prev]);

      <span class="hljs-comment">// 3. 等待DOM更新后调整滚动位置</span>
      <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (scrollEl) {
          <span class="hljs-keyword">const</span> afterScrollHeight = scrollEl.<span class="hljs-property">scrollHeight</span>;
          <span class="hljs-keyword">const</span> heightAdded = afterScrollHeight - beforeScrollHeight;

          <span class="hljs-comment">// 关键修复：检查当前是否仍在顶部附近</span>
          <span class="hljs-keyword">const</span> isStillNearTop = scrollEl.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span> + <span class="hljs-number">50</span>;

          <span class="hljs-comment">// 只有当用户没有手动滚动且仍在顶部时才调整</span>
          <span class="hljs-keyword">if</span> (!scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span> &amp;&amp; isStillNearTop) {
            scrollEl.<span class="hljs-property">scrollTop</span> = beforeScrollTop + heightAdded;
            <span class="hljs-title function_">setScrollTop</span>(scrollEl.<span class="hljs-property">scrollTop</span>);
          }
        }
      });

      <span class="hljs-comment">// 模拟没有更多数据</span>
      <span class="hljs-keyword">if</span> (minIdRef.<span class="hljs-property">current</span> &lt;= <span class="hljs-number">9000</span>) {
        hasMoreRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-title function_">setHasMore</span>(<span class="hljs-literal">false</span>);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'加载消息失败:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      isLoadingRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
    }
  }, [generateData, isInitialized]);

  <span class="hljs-comment">// 处理列表项高度更新</span>
  <span class="hljs-keyword">const</span> handleItemHeightUpdate = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, realHeight: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
      <span class="hljs-title function_">setItemHeights</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> newHeights = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(prev);
        <span class="hljs-keyword">const</span> oldHeight = newHeights.<span class="hljs-title function_">get</span>(id) || <span class="hljs-variable constant_">MIN_ITEM_HEIGHT</span>;
        <span class="hljs-keyword">const</span> diff = realHeight - oldHeight;

        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(diff) &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> prev;

        newHeights.<span class="hljs-title function_">set</span>(id, realHeight);

        <span class="hljs-comment">// 自动调整滚动位置</span>
        <span class="hljs-keyword">if</span> (
          virtualListRef.<span class="hljs-property">current</span> &amp;&amp;
          !isFirstInitRef.<span class="hljs-property">current</span> &amp;&amp;
          !scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span>
        ) {
          <span class="hljs-keyword">const</span> scrollEl = virtualListRef.<span class="hljs-property">current</span>;
          <span class="hljs-keyword">const</span> index = listData.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item.<span class="hljs-property">id</span> === id);

          <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">const</span> itemTop = cumulativeHeights[index];
            <span class="hljs-keyword">const</span> viewportTop = scrollEl.<span class="hljs-property">scrollTop</span>;

            <span class="hljs-comment">// 仅当元素在视口上方时调整</span>
            <span class="hljs-keyword">if</span> (itemTop &lt; viewportTop) {
              scrollEl.<span class="hljs-property">scrollTop</span> += diff;
              <span class="hljs-title function_">setScrollTop</span>(scrollEl.<span class="hljs-property">scrollTop</span>);
            }
          }
        }

        <span class="hljs-keyword">return</span> newHeights;
      });
    },
    [listData, cumulativeHeights]
  );

  <span class="hljs-comment">// 处理滚动事件</span>
  <span class="hljs-keyword">const</span> handleScroll = <span class="hljs-title function_">useCallback</span>(
    <span class="hljs-function">(<span class="hljs-params">e: React.UIEvent&lt;HTMLDivElement&gt;</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLDivElement</span>;
      <span class="hljs-keyword">const</span> currentScrollTop = target.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-title function_">setScrollTop</span>(currentScrollTop);

      <span class="hljs-comment">// 标记手动滚动</span>
      scrollStateRef.<span class="hljs-property">current</span> = {
        <span class="hljs-attr">isManualScroll</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">lastScrollTop</span>: currentScrollTop,
      };

      <span class="hljs-comment">// 检查是否需要加载</span>
      <span class="hljs-keyword">const</span> shouldLoad = currentScrollTop &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span>;

      <span class="hljs-keyword">if</span> (
        shouldLoad &amp;&amp;
        !isLoadingRef.<span class="hljs-property">current</span> &amp;&amp;
        hasMoreRef.<span class="hljs-property">current</span> &amp;&amp;
        isInitialized
      ) {
        <span class="hljs-comment">// 清除之前的防抖计时器</span>
        <span class="hljs-keyword">if</span> (loadTimerRef.<span class="hljs-property">current</span>) {
          <span class="hljs-built_in">clearTimeout</span>(loadTimerRef.<span class="hljs-property">current</span>);
        }

        <span class="hljs-comment">// 防抖处理</span>
        loadTimerRef.<span class="hljs-property">current</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (target.<span class="hljs-property">scrollTop</span> &lt;= <span class="hljs-variable constant_">LOAD_THRESHOLD</span> &amp;&amp; !isLoadingRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">loadNewMessages</span>();
          }
        }, <span class="hljs-number">100</span>);
      }
    },
    [isInitialized, loadNewMessages]
  );

  <span class="hljs-comment">// 初始化</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'组件挂载，开始初始化'</span>);

    <span class="hljs-comment">// 设置容器高度</span>
    <span class="hljs-keyword">if</span> (containerRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> computedHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - <span class="hljs-number">200</span>;
      containerRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">200</span>, computedHeight)}</span>px`</span>;
    }

    <span class="hljs-title function_">initData</span>();

    <span class="hljs-comment">// 清理函数</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'组件卸载，清理定时器'</span>);
      <span class="hljs-keyword">if</span> (loadTimerRef.<span class="hljs-property">current</span>) {
        <span class="hljs-built_in">clearTimeout</span>(loadTimerRef.<span class="hljs-property">current</span>);
      }
    };
  }, [initData]);

  <span class="hljs-comment">// 监听总高度变化，在数据完全渲染后滚动到底部</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isInitialized &amp;&amp; totalHeight &gt; <span class="hljs-number">0</span> &amp;&amp; isFirstInitRef.<span class="hljs-property">current</span>) {
      <span class="hljs-comment">// 延迟一段时间确保DOM完全渲染</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">scrollToBottom</span>();
      }, <span class="hljs-number">300</span>); <span class="hljs-comment">// 增加延迟时间，确保所有列表项都已渲染并测量高度</span>

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [isInitialized, totalHeight, scrollToBottom]);

  <span class="hljs-comment">// 监听列表数据变化，确保在高度测量后滚动</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (listData.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; isInitialized &amp;&amp; isFirstInitRef.<span class="hljs-property">current</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'列表数据更新，当前数据量:'</span>, listData.<span class="hljs-property">length</span>);

      <span class="hljs-comment">// 再给一些时间让所有列表项完成高度测量</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (isFirstInitRef.<span class="hljs-property">current</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'高度测量后尝试滚动'</span>);
          <span class="hljs-title function_">scrollToBottom</span>();
        }
      }, <span class="hljs-number">500</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
    }
  }, [listData.<span class="hljs-property">length</span>, isInitialized, scrollToBottom]);

  <span class="hljs-comment">// 重置手动滚动标记</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      scrollStateRef.<span class="hljs-property">current</span>.<span class="hljs-property">isManualScroll</span> = <span class="hljs-literal">false</span>;
    }, <span class="hljs-number">500</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearTimeout</span>(timer);
  }, [scrollTop]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full bg-gradient-to-br from-indigo-600 to-purple-600 py-10 px-5"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{containerRef}</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-white mt-10 rounded-xl border shadow-lg relative"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{virtualListRef}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"h-full overflow-auto relative"</span>
          <span class="hljs-attr">onScroll</span>=<span class="hljs-string">{handleScroll}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">overflowAnchor:</span> '<span class="hljs-attr">none</span>',
            <span class="hljs-attr">overscrollBehavior:</span> '<span class="hljs-attr">contain</span>',
            <span class="hljs-attr">scrollBehavior:</span> '<span class="hljs-attr">auto</span>',
          }}
        &gt;</span>
          {/* 加载提示（绝对定位，不影响布局） */}
          {isLoading &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0 z-10 py-2 flex justify-center items-center text-sm text-gray-500 "</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex items-center space-x-2"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>正在加载历史消息...<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* 列表占位容器 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">height:</span> `${<span class="hljs-attr">totalHeight</span>}<span class="hljs-attr">px</span>`,
              <span class="hljs-attr">pointerEvents:</span> '<span class="hljs-attr">none</span>',
              <span class="hljs-attr">opacity:</span> <span class="hljs-attr">0</span>,
            }}
          &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 可视区域内容 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute top-0 left-0 right-0"</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">transform:</span> `<span class="hljs-attr">translateY</span>(${<span class="hljs-attr">offsetY</span>}<span class="hljs-attr">px</span>)`,
              <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%',
            }}
          &gt;</span>
            {visibleList.length === 0 ? (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"py-4 text-center text-gray-400"</span>&gt;</span>
                {listData.length === 0
                  ? '正在初始化...'
                  : '加载更多历史消息...'}
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ) : (
              visibleList.map((item) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">VirtualListItem</span>
                  <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>
                  <span class="hljs-attr">item</span>=<span class="hljs-string">{item}</span>
                  <span class="hljs-attr">onUpdateHeight</span>=<span class="hljs-string">{handleItemHeightUpdate}</span>
                /&gt;</span>
              ))
            )}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 没有更多数据的提示 */}
          {!hasMore &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"absolute bottom-0 left-0 right-0 py-2 text-center text-sm text-gray-400 bg-white border-t"</span>&gt;</span>
              没有更多历史消息了
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualList</span>;

</code></pre>
<h3 data-id="heading-15">2. 子组件：</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useEffect,
  useRef,
  forwardRef,
  useImperativeHandle,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListItemProps</span> {
  <span class="hljs-attr">item</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">string</span>;
  };
  <span class="hljs-attr">onUpdateHeight</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">VirtualListItem</span> = forwardRef&lt;<span class="hljs-title class_">HTMLDivElement</span>, <span class="hljs-title class_">ListItemProps</span>&gt;(
  <span class="hljs-function">(<span class="hljs-params">{ item, onUpdateHeight }, ref</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> itemRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> resizeObserverRef = useRef&lt;<span class="hljs-title class_">ResizeObserver</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

    <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
        <span class="hljs-keyword">return</span> itemRef.<span class="hljs-property">current</span>;
      }
      <span class="hljs-comment">// 提供一个安全的默认值</span>
      <span class="hljs-keyword">const</span> emptyDiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
      <span class="hljs-keyword">return</span> emptyDiv;
    });

    <span class="hljs-comment">// 使用 ResizeObserver 监听尺寸变化</span>
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateHeight</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
          <span class="hljs-keyword">const</span> height = itemRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>;
          <span class="hljs-title function_">onUpdateHeight</span>(item.<span class="hljs-property">id</span>, height);
        }
      };

      <span class="hljs-comment">// 立即执行一次初始测量</span>
      <span class="hljs-title function_">updateHeight</span>();

      <span class="hljs-keyword">if</span> (!resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// 防抖处理，避免频繁触发</span>
          <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">requestAnimationFrame</span>(updateHeight);
          }
        });
      }

      <span class="hljs-keyword">if</span> (itemRef.<span class="hljs-property">current</span> &amp;&amp; resizeObserverRef.<span class="hljs-property">current</span>) {
        resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">observe</span>(itemRef.<span class="hljs-property">current</span>);
      }

      <span class="hljs-comment">// 额外的初始延迟测量，确保样式已应用</span>
      <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateHeight</span>();
      }, <span class="hljs-number">10</span>);

      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (resizeObserverRef.<span class="hljs-property">current</span> &amp;&amp; itemRef.<span class="hljs-property">current</span>) {
          resizeObserverRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">unobserve</span>(itemRef.<span class="hljs-property">current</span>);
        }
        <span class="hljs-built_in">clearTimeout</span>(timer);
      };
    }, [item.<span class="hljs-property">id</span>, onUpdateHeight]);

    <span class="hljs-comment">// 模拟不同的内容高度</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">itemStyle</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span> = {
      <span class="hljs-attr">height</span>: item.<span class="hljs-property">id</span> % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'150px'</span> : <span class="hljs-string">'100px'</span>,
    };

    <span class="hljs-keyword">const</span> itemClass = <span class="hljs-string">`<span class="hljs-subst">${item.id % <span class="hljs-number">2</span> !== <span class="hljs-number">0</span> ? <span class="hljs-string">'bg-pink-200'</span> : <span class="hljs-string">'bg-green-200'</span>}</span>`</span>;

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{itemRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{itemClass}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{itemStyle}</span>&gt;</span>
        {item.id}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
);

<span class="hljs-title class_">VirtualListItem</span>.<span class="hljs-property">displayName</span> = <span class="hljs-string">'VirtualListItem'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">VirtualListItem</span>;

</code></pre>
<h3 data-id="heading-16">3. 效果图：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fefe968eb5944d8ebbe117392accb166~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771153211&amp;x-signature=wa5927FGRiU2sQbFSSoCw9Y0hIo%3D" alt="react虚拟列表向上加载.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-17">五、 注意事项</h2>
<ul>
<li>
<p><strong>浏览器干扰</strong>：必须设置 <code>overflow-anchor: none</code>。现代浏览器尝试自动调整滚动位置，这会与我们的手动补偿冲突。</p>
</li>
<li>
<p><strong>索引边界检查</strong>：对切片索引执行 <code>Math.max(0, ...)</code> 与 <code>Math.min(total, ...)</code> 的区间收敛，防止因 <code>startIndex</code> 或 <code>endIndex</code> 越界导致的渲染异常。</p>
</li>
<li>
<p><strong>初始化时机</strong>：首次加载数据后，应调用 <code>scrollToBottom()</code>。为了确保渲染完成，建议采用 <code>requestAnimationFrame</code> + <code>setTimeout</code> 的双重保险。</p>
</li>
<li>
<p><strong>无感加载策略</strong>：执行头部数据插入前，需快照记录当前的 <code>scrollHeight</code>。数据推送至渲染引擎后，通过 <code>newScrollHeight - oldScrollHeight</code> 算得 <strong>空间增量</strong>，并将其累加至当前滚动偏移量上。该补偿逻辑需在渲染刷新前完成，以实现“无感加载”</p>
</li>
<li>
<p><strong>性能瓶颈</strong>：随着 <code>listData</code> 增加到数万条，<code>cumulativeHeights</code> 的计算可能变慢。此时可考虑<strong>分段计算</strong>维护高度。</p>
</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[请求头设置没有生效]]></title>    <link>https://juejin.cn/post/7603688142005026825</link>    <guid>https://juejin.cn/post/7603688142005026825</guid>    <pubDate>2026-02-08T08:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005026825" data-draft-id="7604037348606951462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="请求头设置没有生效"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-02-08T08:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="何中应"/> <meta itemprop="url" content="https://juejin.cn/user/1435305504958535"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            请求头设置没有生效
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1435305504958535/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    何中应
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T08:58:23.000Z" title="Sun Feb 08 2026 08:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>说明：记录一次使用kong.unirest发起http请求，添加请求头的坑。</p>
<h2 data-id="heading-0">场景</h2>
<p>发起一个http请求，需要带上签名等请求头，如下：</p>
<pre><code class="hljs language-java" lang="java">	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">protected</span> String <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
	   <span class="hljs-type">String</span> <span class="hljs-variable">dataString</span> <span class="hljs-operator">=</span> JSON.toJSONString(data);
	   <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> 加密工具，生成签名(signPrivateKey, dataString);
	   <span class="hljs-comment">// 将签名放到请求头中</span>
	   Unirest.config().getDefaultHeaders().add(<span class="hljs-string">"sign"</span>, sign);
	   HttpResponse&lt;String&gt; response = Unirest.post(url.toString())
	           .queryString(<span class="hljs-string">"type"</span>, type)
	           .contentType(ContentType.APPLICATION_JSON.toString())
	           .body(dataString)
	           .asString();
	
	   <span class="hljs-keyword">if</span> (response.isSuccess()) {
	       <span class="hljs-keyword">return</span> <span class="hljs-string">"调用成功"</span>;
	   }
	
	   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"调用失败"</span>);
	}
</code></pre>
<p>我使用 <code>Unirest.config().getDefaultHeaders().add("sign", sign);</code> 的方式，将数据加到请求头上的。然后在调试时，发现首次通过验证后，后面取签名验证，都验证不通过，很疑惑。</p>
<h2 data-id="heading-1">解决</h2>
<p>增加打印日志后，发现除了首次，后面传递过去的签名请求头 <code>sign</code> 都是首次的数据。而看我上面的代码，是需要根据每次的数据内容，产生签名，然后加到请求头上。就是说，后面产生的<code>sign</code>，没有覆盖上一次请求的<code>sign</code>。</p>
<p>不能用上面这种方式，要用下面这种：</p>
<pre><code class="hljs language-java" lang="java">	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">protected</span> String <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
	    <span class="hljs-type">String</span> <span class="hljs-variable">dataString</span> <span class="hljs-operator">=</span> JSON.toJSONString(data);
	    <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> 加密工具，生成签名(signPrivateKey, dataString);
	    HttpResponse&lt;String&gt; response = Unirest.post(url.toString())
	            .queryString(<span class="hljs-string">"type"</span>, type)
	            .contentType(ContentType.APPLICATION_JSON.toString())
	        	.header(<span class="hljs-string">"sign"</span>, sign)
	            .body(dataString)
	            .asString();
	
	    <span class="hljs-keyword">if</span> (response.isSuccess()) {
	        <span class="hljs-keyword">return</span> <span class="hljs-string">"调用成功"</span>;
	    }
	
	    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"调用失败"</span>);
	}
</code></pre>
<p>添加请求头，要放到<code>Unirest.post</code>发起调用时</p>
<h2 data-id="heading-2">首次发布</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhezhongying.blog.csdn.net%2Farticle%2Fdetails%2F144166548" target="_blank" title="https://hezhongying.blog.csdn.net/article/details/144166548" ref="nofollow noopener noreferrer">hezhongying.blog.csdn.net/article/det…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让你的数据成为“操作日志”和“模型饲料”：事件溯源、CQRS与DataFrame漫谈]]></title>    <link>https://juejin.cn/post/7603688142005010441</link>    <guid>https://juejin.cn/post/7603688142005010441</guid>    <pubDate>2026-02-08T08:58:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603688142005010441" data-draft-id="7603651855237021705" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让你的数据成为“操作日志”和“模型饲料”：事件溯源、CQRS与DataFrame漫谈"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-02-08T08:58:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一个骇客"/> <meta itemprop="url" content="https://juejin.cn/user/644760908336608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让你的数据成为“操作日志”和“模型饲料”：事件溯源、CQRS与DataFrame漫谈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/644760908336608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一个骇客
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T08:58:17.000Z" title="Sun Feb 08 2026 08:58:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>聊到数据库类型，你大概熟悉规规矩矩的表格（关系型）或自由散漫的文档（NoSQL）。但今天，我们探访两个更“有性格”的领域：一个让数据成为一本可随时查阅、永不磨灭的“操作日志”，另一个则将数据重塑为机器学习算法最爱的“标准餐”。它们就是 <strong>事件溯源（Event Sourcing）</strong> 与 <strong>DataFrame</strong>。</p>
<h2 data-id="heading-0">第一部分：给数据一本“不可篡改的账簿” —— 事件溯源与 CQRS</h2>
<p>想象你在玩一款策略游戏。优秀的游戏不仅保存最终存档，更会完整记录你的每一步操作：“第3回合，在A地建造了农场”，“第7回合，与B国签署了贸易协定”。凭借这份详尽的“战报”，你不仅能复盘任何时刻的局势，还能深度分析每个决策的优劣。这正是 <strong>事件溯源</strong> 的核心理念。</p>
<p><strong>事件溯源（Event Sourcing, ES）</strong> 主张：<strong>不直接存储系统的当前状态（如账户余额、库存量），而是存储所有导致状态变化的历史事件（Events）</strong>。每个事件都是过去发生的、不可更改的事实，例如 <code>用户注册</code>、<code>账户充值200元</code>、<code>商品出库5件</code>。</p>
<h3 data-id="heading-1">CQRS：让“会计”与“分析师”各司其职</h3>
<p>仅有详细“战报”还不够，我们还需快速回答诸如“我当前有多少资源？”、“上周哪种资源消耗最快？”等问题。这时，它的黄金搭档 <strong>命令查询职责分离（Command Query Responsibility Segregation, CQRS）</strong> 便闪亮登场。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    subgraph ClientLayer [客户层]
        A[Web/移动端] --&gt; B[API网关]
        C[管理后台] --&gt; B
    end

    subgraph CommandSide [命令层]
        B --&gt; D{命令路由器}
        D --&gt; E[账户命令处理器]
        D --&gt; F[交易命令处理器]
        D --&gt; G[订单命令处理器]
        
        E --&gt; H[账户领域模型]
        F --&gt; I[交易领域模型]
        G --&gt; J[订单领域模型]
        
        H --&gt; K[生成事件]
        I --&gt; K
        J --&gt; K
        
        K --&gt; L[(事件存储&lt;br&gt;Event Store)]
    end

    subgraph EventProcessing [事件处理层]
        L --&gt; M[事件总线/消息队列]
        M --&gt; N[账户余额投影]
        M --&gt; O[交易历史投影]
        M --&gt; P[客户画像投影]
        M --&gt; Q[实时仪表盘投影]
    end

    subgraph QuerySide [查询层]
        N --&gt; R[(账户余额视图)]
        O --&gt; S[(交易历史视图)]
        P --&gt; T[(客户画像视图)]
        Q --&gt; U[(实时仪表盘视图)]
        
        R --&gt; V[账户查询服务]
        S --&gt; V
        T --&gt; V
        U --&gt; V
        
        V --&gt; B
    end

    style CommandSide fill:#e1f5fe
    style EventProcessing fill:#fff3e0
    style QuerySide fill:#f3e5f5
</code></pre>
<p>上面的架构展示了CQRS在金融或电商系统中的实际应用：</p>
<ul>
<li><strong>命令端（Command Side）</strong>：作为严谨的"会计部门"，它：
<ul>
<li>通过API网关接收用户的写操作指令（如"转账"、"下单"）</li>
<li>由专门的命令处理器验证业务规则</li>
<li>通过领域模型执行业务逻辑，生成对应的事件</li>
<li>将所有事件持久化到<strong>事件存储（Event Store）</strong> 中</li>
</ul>
</li>
<li><strong>事件处理层（Event Processing）</strong>：这是连接会计部门与分析部门的桥梁：
<ul>
<li>事件存储中的新事件被发布到事件总线或消息队列</li>
<li>多个<strong>投影处理器（Projection Handler）</strong> 监听这些事件</li>
<li>每个处理器负责维护特定用途的物化视图</li>
</ul>
</li>
<li><strong>查询端（Query Side）</strong>：作为灵活的"分析部门"，它：
<ul>
<li>维护着各种优化后的物化视图（如账户余额、交易历史、客户画像）</li>
<li>提供专门的查询服务，响应客户端的读请求</li>
<li>每个视图都可以使用最适合其查询模式的数据存储技术</li>
</ul>
</li>
</ul>
<p><strong>这套“会计+分析师”的架构为何强大？</strong></p>
<ol>
<li><strong>完整的真相之源</strong>：事件日志是系统的唯一事实来源。任何查询结果（物化视图）都可以通过“重播”所有事件来重新计算和验证。当某份“报表”出错时，只需让对应的分析师<strong>根据原始账簿重算一遍</strong>即可。这在复杂的业务系统中提供了“时间旅行”般的调试能力。</li>
<li><strong>职责分离，极致优化</strong>：读写路径完全分离，允许各自独立扩展与优化。写入端可以专注于高吞吐的事件记录，读取端则可以针对不同的查询模式构建最合适的索引与存储结构。</li>
<li><strong>无与伦比的可演进性</strong>：当需要一个新的数据视角（如新的报表）时，你无需修改已有的“记账”逻辑，只需新增一个“分析师”（新的物化视图），让他从历史事件中推导出新报表。系统对业务变化的适应能力极强。</li>
<li><strong>内置的审计线索</strong>：完整的事件序列本身就是最天然的审计日志，满足了金融、医疗等强监管领域的合规性要求。</li>
</ol>
<p><strong>当然，它也不是点石成金的魔法：</strong></p>
<ul>
<li><strong>“重放”的一致性挑战</strong>：如果事件处理逻辑依赖于外部服务（如调用汇率接口），那么“重放”历史事件时必须能获取到<strong>当时</strong>的汇率，否则计算结果会“穿越”。</li>
<li><strong>隐私数据的“橡皮擦”难题</strong>：法规要求删除用户个人数据。但事件不可变，如何“擦除”？这需要精巧的设计，比如只存储数据引用，或在存储时进行加密并保管好密钥（Crypto-Shredding）。</li>
<li><strong>小心“重复通知”</strong>：重放事件时，必须确保不会再次触发发送邮件、短信等外部副作用。</li>
</ul>
<h2 data-id="heading-2">第二部分：把数据做成“机器学习标准餐” —— DataFrame、矩阵与数组</h2>
<p>现在，让我们从记录一切的“历史学家”，切换到为机器学习模型准备“营养餐”的“数据厨师”。</p>
<p>数据科学家和分析师们钟爱的工具 <strong>DataFrame</strong>，可以被看作一个<strong>功能强大的内存中的智能表格</strong>（Python的Pandas、R语言、Apache Spark中的核心概念）。</p>
<p>DataFrame 的核心任务是<strong>数据规整（Data Wrangling）</strong>：如同厨师处理食材，它进行清洗、切片、调味——包括过滤、转换格式、合并、分组聚合等操作，将原始杂乱的“生数据”，烹饪成干净、结构化的“可用数据”。</p>
<h3 data-id="heading-3">从表格到“数字魔方”：矩阵与数组的转换艺术</h3>
<p>DataFrame 最神奇的能力之一，是能轻松地将关系型表格数据，转换成机器学习和数值计算所需的“标准格式”——<strong>矩阵（Matrix）</strong> 和<strong>多维数组（Array）</strong>。</p>
<p>为了更直观地理解这个过程，让我们通过一个"顾客-商品购买记录"的实际例子来看看DataFrame如何将表格数据转换为矩阵：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 原始购买记录表（关系型表示）</span>
purchase_records = [
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C001"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P100"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">2</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C001"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P205"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">1</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C002"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P100"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">1</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C003"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P880"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">5</span>},
    {<span class="hljs-string">"customer_id"</span>: <span class="hljs-string">"C003"</span>, <span class="hljs-string">"product_id"</span>: <span class="hljs-string">"P205"</span>, <span class="hljs-string">"purchase_count"</span>: <span class="hljs-number">3</span>},
]

<span class="hljs-comment"># 转换为DataFrame</span>
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
df = pd.DataFrame(purchase_records)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"原始购买记录表："</span>)
<span class="hljs-built_in">print</span>(df)

<span class="hljs-comment"># 使用pivot操作转换为矩阵形式</span>
matrix_df = df.pivot(index=<span class="hljs-string">'customer_id'</span>, 
                     columns=<span class="hljs-string">'product_id'</span>, 
                     values=<span class="hljs-string">'purchase_count'</span>).fillna(<span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n转换后的顾客-商品矩阵："</span>)
<span class="hljs-built_in">print</span>(matrix_df)
</code></pre>
<p>运行这段代码，你会看到这样的转换结果：</p>
<pre><code class="hljs">原始购买记录表：
  customer_id product_id  purchase_count
0        C001       P100               2
1        C001       P205               1
2        C002       P100               1
3        C003       P880               5
4        C003       P205               3

转换后的顾客-商品矩阵：
product_id   P100  P205  P880
customer_id                  
C001          2.0   1.0   0.0
C002          1.0   0.0   0.0
C003          0.0   3.0   5.0
</code></pre>
<p>在这个矩阵中，<strong>行是顾客，列是商品，单元格的值是购买次数</strong>。这个矩阵通常是<strong>稀疏（Sparse）</strong> 的，因为大多数顾客只购买过少数商品。</p>
<p>为了"喂给"推荐系统等机器学习算法，我们还需将文本类信息（如商品类别"电子产品"、"图书"）转化为数字。常用技巧是<strong>独热编码（One-Hot Encoding）</strong>：为每个类别创建一个新的二进制列。</p>
<p>最终，我们得到一个纯粹的、高维的数值矩阵，这正是协同过滤、分类、聚类等众多机器学习算法可直接消化的"标准输入"。</p>
<h3 data-id="heading-4">专业“冷库”：数组数据库</h3>
<p>当数据天生就是海量、规整的多维数字时（如卫星影像数据、基因序列、金融时间序列），专门的 <strong>数组数据库（Array Database）</strong>，如TileDB，便大显身手。它们如同为特定形状设计的超级冰柜，能极致高效地存储和查询这些庞大的多维数值“数据块”。</p>
<p><strong>DataFrame的魅力在于：</strong>
它是一座<strong>动态的、强大的桥梁</strong>，优雅地连接着存储原始数据的“业务世界”与需要数值化输入的“算法世界”。数据科学家在此桥上完成从数据获取、清洗、转换到模型输入的全流程。</p>
<h2 data-id="heading-5">总结：选择你的“数据超能力”</h2>
<p>我们快速领略了数据模型宇宙的一角：</p>
<ul>
<li><strong>事件溯源 + CQRS</strong> 赋予你 <strong>“完整历史回溯”与“读写解耦优化”</strong> 的超能力。它是复杂业务系统、交易平台、需要强审计追溯场景的利器。</li>
<li><strong>DataFrame与矩阵</strong> 赋予你 <strong>“敏捷数据探索”与“无缝算法对接”</strong> 的超能力。它是数据科学、机器学习流水线上无可替代的核心工具。</li>
</ul>
<p>没有万能的数据模型。关系模型是稳健的基石，文档模型处理树形数据得心应手，图模型擅长挖掘复杂关系。而事件溯源和DataFrame，则在解决“完整历史”与“灵活分析”这两类特定痛点上，展现了其独特而强大的价值。</p>
<p>下次当你设计系统或分析数据时，不妨思考：我的数据，更需要一本可供随时追溯、推演的“永恒日志”，还是一个可以自由塑形、直接喂养智能模型的“数字厨房”？答案将指引你找到最合适的“超能力”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[solidity进阶]]></title>    <link>https://juejin.cn/post/7603769956975509545</link>    <guid>https://juejin.cn/post/7603769956975509545</guid>    <pubDate>2026-02-08T09:23:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956975509545" data-draft-id="7603643044035117092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="solidity进阶"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2026-02-08T09:23:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unturn"/> <meta itemprop="url" content="https://juejin.cn/user/3810252135601915"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            solidity进阶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3810252135601915/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unturn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:23:32.000Z" title="Sun Feb 08 2026 09:23:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读36分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1、函数重载</h3>
<h4 data-id="heading-1">1.1函数重载</h4>
<p>solidity中允许函数进行重载，即名字相同但输入参数类型不同的函数可以同时存在，他们被视为不同的函数，注意，silidity不允许修饰器重载。</p>
<p>我们定义两个都叫saySomething() 的函数，一个没有任何参数，输出Nothing；另一个接收一个string参数，输出这个string</p>
<pre><code class="hljs language-solidity" lang="solidity">function saySomething() public pure returns(string memory){
		return("Nothing")
}
function saySomething(string memory something) public pure returns(string memory){
		return("something")
}
</code></pre>
<p>返回了不同的结果，被区分为不同的函数。</p>
<p>1.2实参匹配</p>
<p>在调用重载函数时，会把输入的实际参数和函数参数的变量类型做匹配。如果出现多个匹配的</p>
<h3 data-id="heading-2">2、库合约</h3>
<p>我们用Strings库合约的toHexString()`来演示两种使用库合约中函数的办法。</p>
<ol>
<li>利用using for指令 指令using A for B;可用于附加库合约（从库 A）到任何类型（B）。添加完指令后，库A中的函数会自动添加为B类型变量的成员，可以直接调用。注意：在调用的时候，这个变量会被当作第一个参数传递给函数：</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">// 利用using for指令
using Strings for uint256;
function getString1(uint256 _number) public pure returns(string memory){
    // 库合约中的函数会自动添加为uint256型变量的成员
    return _number.toHexString();
}
</code></pre>
<p>2.通过库合约名称调用函数</p>
<pre><code class="hljs language-solidity" lang="solidity">// 直接通过库合约名调用
function getString2(uint256 _number) public pure returns(string memory){
    return Strings.toHexString(_number);
}
</code></pre>
<h3 data-id="heading-3">3、Import</h3>
<p>方式 1：相对路径直接导入（最常用，本地文件）</p>
<pre><code class="hljs language-solidity" lang="solidity">// 示例：当前文件在 ./contracts/ 下，导入同目录的 IERC20.sol 接口
import "./IERC20.sol";

// 示例：导入上级目录的 utils/Context.sol
import "../utils/Context.sol";

// 示例：导入子目录的 library/SafeMath.sol
import "./library/SafeMath.sol";

contract MyERC20 is IERC20 { // 直接使用导入的接口
    // ...
}
</code></pre>
<p>方式 2：按需导入指定内容</p>
<pre><code class="hljs language-solidity" lang="solidity">// 示例：从 ERC20.sol 中仅导入 ERC20 合约和 IERC20 接口，其他内容不导入
import { ERC20, IERC20 } from "./ERC20.sol";

// 示例：从公共文件中导入结构体和枚举
import { TokenType, TokenInfo } from "./common/Structs.sol";

contract MyToken is ERC20 { // 直接使用按需导入的合约
    TokenInfo public tokenInfo; // 直接使用导入的结构体
}
</code></pre>
<p>方式 3：npm 包路径导入（生产主流，第三方库）</p>
<pre><code class="hljs language-solidity" lang="solidity">// 示例1：导入 OpenZeppelin 的 ERC20 标准合约（最常用）
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
// 示例2：导入 OpenZeppelin 的安全转账库
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
// 示例3：导入 Uniswap V2 工厂合约接口
import "@uniswap/v2-core/contracts/interfaces/IUniswapV2Factory.sol";

contract MyOpenZeppelinToken is ERC20 {
    constructor() ERC20("OZToken", "OZT") {
        _mint(msg.sender, 1000 * 10 ** decimals());
    }
}
</code></pre>
<h3 data-id="heading-4">4、接收ETH</h3>
<h4 data-id="heading-5">4.1 接收ETH  receive</h4>
<p>receive()函数是合约收到ETH转账时被调用得函数。一个合约最多有一个receive()函数，声明方式与一般函数不一样，不需要function关键字：receive() external payable{...}.receive() 函数不能有任何的参数，不能返回任何值，必须包含external 和 payable.</p>
<p>当合约接收ETH的时候，receive() 会被触发。receive()最后不要执行太多的逻辑因为如果别人用send 和 transfer 方法发送ETH的话，gas会限制在 2300，receive()太复杂可能会触发Out of Gas报错。如果用call就可以自定义gas执行更复杂的逻辑（这三种发送ETH的方法我们之后会讲到）。</p>
<p>我们在receive() 里发送一个event,例如：</p>
<pre><code class="hljs language-solidity" lang="solidity">// 定义事件
event Received(address Sender, uint Value);
// 接收ETH时释放Received事件
receive() external payable {
    emit Received(msg.sender, msg.value);
}
</code></pre>
<h4 data-id="heading-6">4.2 回退函数fallback</h4>
<p>fallback()函数会在调用合约不存在的函数时触发。可用于接收ETH,也可以用于代理合约proxy contract. fallback() 声明时不需要function关键字，必须由external修饰，一般也会用payable修饰，用于接收接收ETH: fallback() external payable{...}.</p>
<p>我们定义一个fallback()函数，被触发时候会释放fallbackCalled事件，并输出msg.sender，msg.value和msg.data:</p>
<pre><code class="hljs language-solidity" lang="solidity">event fallbackCalled(address Sender, uint Value, bytes Data);

// fallback
fallback() external payable{
    emit fallbackCalled(msg.sender, msg.value, msg.data);
}
</code></pre>
<h4 data-id="heading-7">4.3 receive和fallback的区别</h4>
<p>receive和fallback都能够用于接收ETH，他们触发的规则如下：</p>
<pre><code class="hljs language-scss" lang="scss">触发<span class="hljs-built_in">fallback</span>() 还是 <span class="hljs-built_in">receive</span>()?
           接收ETH
              |
         msg<span class="hljs-selector-class">.data</span>是空？
            /  \
          是    否
          /      \
<span class="hljs-built_in">receive</span>()存在?   <span class="hljs-built_in">fallback</span>()
        / \
       是  否
      /     \
<span class="hljs-built_in">receive</span>()   <span class="hljs-built_in">fallback</span>()

</code></pre>
<p>简单来说，合约接收ETH时，msg.data为空且存在receive()时，会触发receive()；msg.data不为空或不存在receive()时，会触发fallback()，此时fallback()必须为payable。</p>
<p>receive()和payable fallback()均不存在的时候，向合约直接发送ETH将会报错（你仍可以通过带有payable的函数向合约发送ETH）。</p>
<p>案例</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

// receive/Fallback  案例
contract ReceiveFallbackTest{
    //记录receive 的触发
    event ReceiveTriggered(address indexed sender, uint256 amount);

    //记录fallback 的触发
    event FaballTriggered(address indexed sender, uint256 amount, bytes data);

    //无calldata的转账
    receive() external payable { 
        emit ReceiveTriggered(msg.sender, msg.value); //触发事件，打印发送者和ETH金额
    }

    fallback() external payable {
        emit FaballTriggered(msg.sender, msg.value, msg.data); //打印发送者、金额、附带的calldata
    }

    function getContractBalance() external view returns (uint256) {
        return address(this).balance;
    }


}
</code></pre>
<h3 data-id="heading-8">5、发送ETH</h3>
<p>call没有gas限制，最为灵活，是最提倡的方法</p>
<p>用法是接收方地址.call{value: 发送ETH数额}("")。
call()没有gas限制，可以支持对方合约fallback()或receive()函数实现复杂逻辑。
call()如果转账失败，不会revert。
call()的返回值是(bool, bytes)，其中bool代表着转账成功或失败，需要额外代码处理一下。</p>
<p>结合接收ETH的案例</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract CallTest{
    //事件: 记录call调用结果
    event CallResult(address indexed target,bool success, uint256 sendAmount, bytes data);

    //场景一：用call纯转ETH(触发目标合约receive)
    //参数：_target 目标合约地址(触发目标合约的receive)
    //参数：_amount 转ETH金额
    function callTransferETH(address payable _target, uint256 _amount) external payable {
        //核心：call纯转ETH,calldata传空字符串
        (bool success, bytes memory data) = _target.call{value:_amount}("");

        //必须判断success,失败则回滚
        require(success,"Call transfer ETH failed");

        //触发事件，记录调用结果
        emit CallResult(_target,success, _amount,data);
    }

    // 场景一：用call纯转ETH(触发目标合约fallback)
    // 参数：_target 目标合约地址；_amount 转ETH金额；_data 自定义calldata（比如0x1234）
    function callTransferETHWithData(address payable _target, uint256 _amount, bytes calldata _data) external payable {
        // 核心：call带calldata转ETH，传入自定义_data
        (bool success, bytes memory data) = _target.call{value: _amount}(_data);
        
        require(success, "Call transfer ETH with data failed");

        emit CallResult(_target, success, _amount, data);
    }

    // 辅助函数：查询当前CallTest合约的ETH余额（测试后验证）
    function getCallContractBalance() external view returns (uint256) {
        return address(this).balance;
    }
}
</code></pre>
<h3 data-id="heading-9">6、调用其他合约</h3>
<p>4个调用合约的例子</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract OtherContract {
    uint256 private _x = 0;
    //收到ETh的事件，记录amount 和 gas
    event Log(uint amount, uint gas);

    //返回合约ETH余额
    function getBalance() view public returns (uint) {
        return address(this).balance;
    }

    //可以调整状态变量_x的函数，并且可以往合约转ETH(payable)
    function setX(uint256 x) external payable {
        _x = x;
        //如果转入ETH, 则释放Log事件
        if(msg.value &gt; 0 ){
            emit Log(msg.value, gasleft());
        }
    }

    //读取_x
    function getX() external view returns(uint x){
        x = _x;
    }
}

contract CallContract{
    //1.传入合约地址
    //复制OtherContract合约的地址，填入callSetX函数的参数中，成功调用后，调用OtherContract合约中的getX验证x变为123
    function callSetX(address _Address,uint256 x) external {
        OtherContract(_Address).setX(x);
    }
    //2.传入合约变量
    //复制OtherContract合约的地址，填入callGetX函数的参数中，调用后成功获取x的值
    function callCetX(OtherContract _Address) external view returns(uint x) {
        x = _Address.getX();
    }
    //3.创建合约变量
    //复制OtherContract合约的地址，填入callGetX2函数的参数中，调用后成功获取x的值
    function callGetX2(address _Address) external view returns (uint x){
        OtherContract oc = OtherContract(_Address);
        x = oc.getX();
    }
    //4.调用合约并发送ETH
    //复制OtherContract合约的地址，填入setXTransferETH函数的参数中，并转入10ETH
    function setXtransferETH(address otherContract,uint256 x) payable external {
        OtherContract(otherContract).setX{value:msg.value}(x);
    }
}
</code></pre>
<p>案例</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
// 被调用合约：简单计算器
contract Calculator {
    function add(uint256 a, uint256 b) external pure returns (uint256) {
        return a + b;
    }
}

contract CalculatorCaller {
    Calculator public calculator;

    constructor(address _calcAddress) {
        calculator = Calculator(_calcAddress);
    }

    // 调用计算器的 add 函数，直接返回结果
    function callAdd(uint256 a, uint256 b) external view returns (uint256) {
        return calculator.add(a, b);
    }
}
</code></pre>
<h3 data-id="heading-10">7、call</h3>
<p>call是address类型的低级成员函数，它用来与其他合约交互。它的返回值为(bool,bytes memory),分别对应call是否成功以及函数的返回值。</p>
<p>​	call是solidity官方推荐通过触发fallback或者receive函数发送ETH的方法。</p>
<p>​	不推荐用call来调用另一个合约，因为当你调用不安全合约的函数时，你就把主动权交给了它。推荐的方法仍是声明合约变量后调用函数。</p>
<p>​	当我们不知道对方合约的源代码或ABI,就没法生成合约变量；这时，我们仍可以通过call调用对方合约的函数。</p>
<h4 data-id="heading-11">call的使用规则</h4>
<pre><code class="hljs language-ini" lang="ini">目标合约地址.call(字节码)<span class="hljs-comment">;</span>
</code></pre>
<p>​    字节码利用结构化编程函数abi.encodeWithSignature获得：</p>
<pre><code class="hljs language-arduino" lang="arduino">abi.<span class="hljs-built_in">encodeWithSignature</span>(<span class="hljs-string">"函数签名"</span>,逗号分隔的具体参数)

函数签名为 “函数名（逗号分隔的参数类型）”。 例如abi.<span class="hljs-built_in">encodeWithSignature</span>(<span class="hljs-string">"f(uint256,address)"</span>,_x,_addr)
</code></pre>
<p>另外call在调用合约时可以指定交易发送的ETH数额和gas数额：</p>
<pre><code class="hljs language-css" lang="css">目标合约地址<span class="hljs-selector-class">.call</span>{value:发送数额，gas:gas数额}(字节码);
</code></pre>
<h4 data-id="heading-12">案例</h4>
<p>目标合约</p>
<pre><code class="hljs language-solidity" lang="solidity">contract OtherContract {
//                    返回值含义                   单位     类型
//msg.value	          调用函数时附带转入的 ETH 数量	   wei	 uint256
//address(this).balance	     合约当前的 ETH 余额	  wei	uint256
//gasleft()         执行到当前行的剩余可使用 Gas 量    gas 	uint256

    uint256 private _x = 0; // 状态变量x
    // 收到eth的事件，记录amount和gas
    event Log(uint amount, uint gas);X
    
    fallback() external payable{}

    // 返回合约ETH余额
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }

    // 可以调整状态变量_x的函数，并且可以往合约转ETH (payable)
    function setX(uint256 x) external payable{
        _x = x;
        // 如果转入ETH，则释放Log事件
        if(msg.value &gt; 0){
            emit Log(msg.value, gasleft());
        }
    }

    // 读取x
    function getX() external view returns(uint x){
        x = _x;
    }
}
</code></pre>
<h4 data-id="heading-13">利用call调用目标合约</h4>
<pre><code class="hljs language-solidity" lang="solidity">contract call {
    // 定义Response事件，输出call返回的结果success和data
    event Response(bool success, bytes data);

    function callSetX(address payable _addr, uint256 x) public payable {
    // call setX()，同时可以发送ETH
    (bool success, bytes memory data) = _addr.call{value: msg.value}(
        abi.encodeWithSignature("setX(uint256)", x)
    );

    emit Response(success, data); //释放事件
}
    function callGetX(address _addr) external returns(uint256){
    // call getX()
    (bool success, bytes memory data) = _addr.call(
        abi.encodeWithSignature("getX()")
    );

    emit Response(success, data); //释放事件
    return abi.decode(data, (uint256));
}

function callNonExist(address _addr) external{
    // call 不存在的函数
    (bool success, bytes memory data) = _addr.call(
        abi.encodeWithSignature("foo(uint256)")
    );

    emit Response(success, data); //释放事件
}

}
</code></pre>
<h5 data-id="heading-14">1.调用setX函数</h5>
<p>调用callSetX把状态变量_x改为5，参数为OtherContract地址和5，由于目标函数setX()没有返回值，因此Response事件输出的data为0x，也就是空。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36c4f63f5c034ab3a687b68688f0396c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW50dXJu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771148048&amp;x-signature=AEYNMbe%2FW5vMwlhgqqWTEigxRwo%3D" alt="22-1" loading="lazy"/></p>
<h5 data-id="heading-15">2.调用getX函数</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b320896f3884d3e820d3c4ad1775b65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW50dXJu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771148048&amp;x-signature=HTboQov9LFNoClQmu7AxIX6%2BRFY%3D" alt="img" loading="lazy"/></p>
<h5 data-id="heading-16">4.调用不存在的函数</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6243fc0a708b40deb9eb9c0684d7cb0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgdW50dXJu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771148048&amp;x-signature=4z%2FdtqGDH96zHO8v46awCayHvMQ%3D" alt="22-3" loading="lazy"/></p>
<p>上面例子中，我们call了不存在的foo函数。call仍能执行成功，并返回success，但其实调用的目标合约fallback函数。</p>
<h3 data-id="heading-17">8、delegatecall</h3>



































<table><thead><tr><th>特性</th><th><code>call</code>（普通外部调用）</th><th><code>delegatecall</code>（委托调用）</th></tr></thead><tbody><tr><td><strong>存储（Storage）</strong></td><td>执行目标合约的代码，读写<strong>目标合约</strong>的存储</td><td>执行目标合约的代码，读写<strong>当前合约</strong>的存储</td></tr><tr><td><strong>上下文（Context）</strong></td><td><code>msg.sender</code> = 当前合约地址；<code>msg.value</code> 传递</td><td><code>msg.sender</code> = 原始调用者地址；<code>msg.value</code> 保留</td></tr><tr><td><strong>代码归属</strong></td><td>执行的是目标合约的代码，逻辑归属目标合约</td><td>执行的是目标合约的代码，逻辑归属当前合约</td></tr><tr><td><strong>核心用途</strong></td><td>普通调用外部合约功能（如调用 ERC20 转账）</td><td>代码复用、可升级合约（代理模式）</td></tr><tr><td><strong>存储布局要求</strong></td><td>无强制要求（目标合约自有存储）</td><td>严格匹配（当前合约与逻辑合约存储槽位需一致）</td></tr></tbody></table>
<h4 data-id="heading-18">1.逻辑合约（被调用方：提供代码逻辑）</h4>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

// 逻辑合约：只提供代码，不存储数据
contract LogicContract {
    // 注意：变量的顺序/类型必须和调用合约完全匹配（存储槽位对应）
    uint public num;       // 存储槽位 0
    address public sender; // 存储槽位 1

    // 修改状态的函数
    function setVars(uint _num) public {
        num = _num;
        // delegatecall 中，msg.sender 是「外部调用者」，而非调用合约地址
        sender = msg.sender;
    }

    // 纯计算函数（无状态修改）
    function add(uint a, uint b) public pure returns (uint) {
        return a + b;
    }
}
</code></pre>
<h4 data-id="heading-19">2.调用合约（调用方：提供存储，借用逻辑）</h4>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

// 调用合约：存储数据，通过 delegatecall 借用 LogicContract 的逻辑
contract CallerContract {
    // 存储布局必须和 LogicContract 完全一致！（顺序、类型）
    uint public num;       // 存储槽位 0
    address public sender; // 存储槽位 1
    address public logicAddr; // 保存逻辑合约地址

    // 设置逻辑合约地址
    function setLogicAddr(address _logic) public {
        logicAddr = _logic;
    }

    // 用 delegatecall 调用 LogicContract 的 setVars 函数
    function delegateSetVars(uint _num) public returns (bool, bytes memory) {
        // delegatecall 语法：目标地址.delegatecall(ABI编码的函数调用)
        (bool success, bytes memory data) = logicAddr.delegatecall(
            abi.encodeWithSignature("setVars(uint256)", _num)
        );
        return (success, data); // 返回调用结果和数据
    }

    // 用 delegatecall 调用 LogicContract 的 add 函数
    function delegateAdd(uint a, uint b) public returns (bool, bytes memory) {
        (bool success, bytes memory data) = logicAddr.delegatecall(
            abi.encodeWithSignature("add(uint256,uint256)", a, b)
        );
        return (success, data);
    }
}
</code></pre>
<h4 data-id="heading-20">3. 测试步骤与效果</h4>
<ol>
<li>部署 <code>LogicContract</code>，记录其地址（如 <code>0x123...</code>）；</li>
<li>部署 <code>CallerContract</code>，调用 <code>setLogicAddr(0x123...)</code> 关联逻辑合约；</li>
<li>调用 <code>delegateSetVars(100)</code>，然后查询 <code>CallerContract</code> 的 <code>num</code> → 结果为 <code>100</code>（数据存在 CallerContract 中）；</li>
<li>查询 <code>CallerContract</code> 的 <code>sender</code> → 结果为<strong>你的钱包地址</strong>（而非 CallerContract 地址，保留了原始上下文）；</li>
<li>调用 <code>delegateAdd(5, 3)</code>，解码返回的 <code>data</code> → 结果为 <code>8</code>（复用了 LogicContract 的计算逻辑）。</li>
</ol>
<h4 data-id="heading-21">4.代理合约案例</h4>
<pre><code class="hljs language-solidity" lang="solidity">contract Proxy{
	address public implementation;
	address public owner;
	
	constructor(address _logic){
		implementation = _logic;
		owner = msg.sender;
	}
	
	modifier onlyOnwner(){
	 	require(msg.sender == owner, "Proxy: not owner");
	 	_;
	}
	
	function upgradeTo(address _newLogic) public onlyOwner{
		implementation = _newLogic;
	}
	
	//回退函数：调用代理合约不存在的函数时，自动转发给逻辑合约
	fallback() external payable {
		(bool success,) implementation.delegatecall(msg.data);
        require(success, "Proxy: delegatecall failed");
	}
	
    // 接收 ETH
    receive() external payable {}
}

pragma solidity ^0.8.20;

// 逻辑合约 V1：实现基础功能
contract LogicV1 {
    // 存储布局必须和 Proxy 完全匹配（新增变量只能加在末尾）
    address public implementation; // 存储槽位 0
    address public owner;          // 存储槽位 1
    uint public count;             // 存储槽位 2（新增状态）

    // 计数+1
    function increment() public {
        count += 1;
    }

    // 获取计数
    function getCount() public view returns (uint) {
        return count;
    }
}

pragma solidity ^0.8.20;

// 逻辑合约 V2：在 V1 基础上新增功能
contract LogicV2 {
    // 存储布局必须和 Proxy/LogicV1 完全一致！
    address public implementation; // 存储槽位 0
    address public owner;          // 存储槽位 1
    uint public count;             // 存储槽位 2

    // 保留 V1 功能
    function increment() public {
        count += 1;
    }

    // 新增功能：计数-1
    function decrement() public {
        require(count &gt; 0, "LogicV2: count is zero");
        count -= 1;
    }

    // 保留 V1 功能
    function getCount() public view returns (uint) {
        return count;
    }
}
</code></pre>
<ol>
<li>部署 <code>LogicV1</code>，得到地址 <code>LogicV1Addr</code>；</li>
<li>部署 <code>Proxy</code>，传入 <code>LogicV1Addr</code> 作为初始逻辑合约；</li>
<li>调用 <code>Proxy.increment()</code> → 调用 <code>Proxy.getCount()</code> 得到 <code>1</code>（状态存在 Proxy 中）；</li>
<li>部署 <code>LogicV2</code>，得到地址 <code>LogicV2Addr</code>；</li>
<li>调用 <code>Proxy.upgradeTo(LogicV2Addr)</code>（仅 owner 可操作），完成升级；</li>
<li>调用 <code>Proxy.decrement()</code> → 调用 <code>Proxy.getCount()</code> 得到 <code>0</code>（新增功能生效，状态未丢失）。</li>
</ol>
<h3 data-id="heading-22">9、在合约中创建新合约（工厂合约）</h3>
<p>工厂合约是<strong>专门用于部署其他合约（称为「子合约 / 目标合约」）的智能合约</strong>，它的核心职责是：</p>
<ol>
<li>封装子合约的部署逻辑（比如用 <code>new</code> 关键字）；</li>
<li>对外提供统一的部署接口；</li>
<li>通常会记录所有已部署的子合约地址（方便管理 / 追溯）。</li>
</ol>
<p>create的用法很简单，就是new一个合约，并传入新合约构造函数所需的参数：</p>
<p>Contract x = new Contract{value: _value}(params)
其中Contract是要创建的合约名，x是合约对象（地址），如果构造函数是payable，可以创建时转入_value数量的ETH，params是新合约构造函数的参数。</p>
<h4 data-id="heading-23">1.目标合约</h4>
<p>核心功能：存储用户名、记录合约部署者（即工厂合约地址），支持修改用户名，无构造函数。</p>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

// 用户信息合约（无构造函数，基础状态读写）
contract UserInfoContract {
    // 状态变量：用户名 + 部署者（工厂合约地址）
    string public userName;
    address public deployer; // 部署该合约的工厂合约地址

    // 初始化函数：设置用户名 + 记录部署者（首次调用）
    function initUser(string memory _userName) public {
        // 仅允许首次初始化（避免重复修改部署者）
        require(deployer == address(0), "UserInfo: already initialized");
        userName = _userName;
        deployer = msg.sender; // msg.sender = 工厂合约地址
    }

    // 修改用户名（任意地址可调用，仅演示基础功能）
    function updateUserName(string memory _newName) public {
        userName = _newName;
    }

    // 批量获取信息（简化调用）
    function getUserInfo() public view returns (string memory, address) {
        return (userName, deployer);
    }
}
</code></pre>
<h4 data-id="heading-24">2.工厂合约</h4>
<p>专门部署 <code>UserInfoContract</code> 的合约</p>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

import "./UserInfoContract.sol";

// 典型的工厂合约结构
contract UserInfoFactory {
    // 特征1：记录所有已部署的子合约地址（可追溯、易管理）
    address[] public deployedUserContracts;

    // 特征2：对外提供统一的部署接口（封装部署逻辑）
    function deployUserContract() public returns (address) {
        // 核心：用 new 部署子合约（工厂合约的核心动作）
        UserInfoContract newUserContract = new UserInfoContract();
        // 特征3：记录新部署的子合约地址
        deployedUserContracts.push(address(newUserContract));
        // 特征4：返回子合约地址（方便调用方直接使用）
        return address(newUserContract);
    }

    // 特征5：辅助管理函数（查看部署数量）
    function getDeployedCount() public view returns (uint) {
        return deployedUserContracts.length;
    }
}
</code></pre>
<p>步骤 1：部署工厂合约</p>
<p>步骤 2：用工厂部署 UserInfoContract</p>
<ol>
<li>在 <code>UserInfoFactory</code> 实例中，找到 <code>deployUserContract</code> 函数，点击「transact」；</li>
<li>交易成功后，复制返回的 <code>UserInfoContract</code> 地址（如 <code>0x8A791620dd6260079BF849Dc5567aDC3F2FdC318</code>）；</li>
<li>验证：调用 <code>UserInfoFactory</code> 的 <code>getDeployedCount()</code>，返回 <code>1</code>（表示已部署 1 个合约）；调用 <code>deployedUserContracts(0)</code>，返回上述复制的地址（验证记录成功）。</li>
</ol>
<p>步骤 3：操作并验证 UserInfoContract</p>
<ol>
<li>在「Deploy &amp; Run Transactions」的「At Address」输入框粘贴步骤 4 复制的地址，「Contract」下拉框选择 <code>UserInfoContract</code>，点击「At Address」加载合约实例；</li>
<li>初始化用户信息
<ul>
<li>调用 <code>initUser</code> 函数，参数输入你的用户名（如 <code>"Alice"</code>），点击「transact」；</li>
<li>调用 <code>getUserInfo</code> 函数，点击「call」，返回结果为 <code>("Alice", 工厂合约地址)</code>（验证部署者和用户名设置成功）；</li>
</ul>
</li>
<li>修改用户名
<ul>
<li>调用 <code>updateUserName</code> 函数，参数输入 <code>"Bob"</code>，点击「transact」；</li>
<li>再次调用 <code>getUserInfo</code>，返回 <code>("Bob", 工厂合约地址)</code>（验证用户名修改成功）；</li>
</ul>
</li>
<li><strong>重复初始化验证</strong>：再次调用 <code>initUser("Charlie")</code>，交易会失败（提示 <code>UserInfo: already initialized</code>，验证初始化仅允许一次）。</li>
</ol>
<h4 data-id="heading-25">3.工厂合约的 5 个核心特征（对应案例）</h4>



































<table><thead><tr><th>特征</th><th>案例中的体现</th><th>实际价值</th></tr></thead><tbody><tr><td>1. 封装部署逻辑</td><td>所有部署 <code>UserInfoContract</code> 的逻辑都在 <code>deployUserContract</code> 中</td><td>调用方无需知道「怎么部署」，只需调用函数即可</td></tr><tr><td>2. 批量部署</td><td>多次调用 <code>deployUserContract</code> 可创建多个 <code>UserInfoContract</code> 实例</td><td>一键批量生成同款合约，无需重复部署工厂</td></tr><tr><td>3. 可追溯</td><td><code>deployedUserContracts</code> 数组记录所有子合约地址</td><td>随时查看 / 管理所有已部署的子合约</td></tr><tr><td>4. 标准化</td><td>所有子合约都基于同一版 <code>UserInfoContract</code> 代码</td><td>避免手动部署时的代码版本不一致</td></tr><tr><td>5. 简化调用</td><td>返回子合约地址，调用方直接用 <code>At Address</code> 加载</td><td>无需手动复制字节码、处理底层部署细节</td></tr></tbody></table>
<h3 data-id="heading-26">10、create2</h3>
<h4 data-id="heading-27">1.CREATE2 vs CREATE（new）核心对比</h4>



































<table><thead><tr><th>特性</th><th><code>CREATE2</code></th><th><code>CREATE</code>（<code>new</code> 底层）</th></tr></thead><tbody><tr><td>地址生成依据</td><td>工厂地址 + salt + 子合约字节码哈希</td><td>工厂地址 + 工厂 nonce（部署次数）</td></tr><tr><td>地址可预测性</td><td>✅ 部署前可精确计算</td><td>❌ 不可预测（nonce 随部署变化）</td></tr><tr><td>Solidity 封装语法</td><td><code>new 合约名{salt: _salt}()</code></td><td><code>new 合约名()</code></td></tr><tr><td>核心优势</td><td>地址确定、提前规划</td><td>简单、无需自定义 salt</td></tr><tr><td>适用场景</td><td>需提前知地址的场景（跨链、DEX）</td><td>普通批量部署（无地址预判需求）</td></tr></tbody></table>
<h4 data-id="heading-28">2.案例</h4>
<ol>
<li>
<p>子合约（保持不变，复用之前的 <code>UserInfoContract</code>）</p>
</li>
<li>
<p><code>CREATE2</code> 工厂合约（核心）</p>
</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">pragma solidity ^0.8.20;

import "./UserInfoContract.sol";

// CREATE2 版本的用户信息合约工厂（支持预计算地址）
contract UserInfoFactoryCreate2 {
    // 记录已部署的子合约（salt =&gt; 合约地址），方便追溯
    mapping(uint256 =&gt; address) public saltToContract;

    // ========== 核心1：用 CREATE2 部署子合约（高级封装方式） ==========
    function deployWithCREATE2(uint256 _salt) public returns (address) {
        // 语法：new 合约名{salt: 盐值}() —— 底层调用 CREATE2
        UserInfoContract newUserContract = new UserInfoContract{salt: bytes(_salt)}();
        address contractAddr = address(newUserContract);
        
        // 记录 salt 和合约地址的映射
        saltToContract[_salt] = contractAddr;
        
        return contractAddr;
    }

    // ========== 核心2：预计算合约地址（部署前就能知道地址） ==========
    function computeContractAddress(uint256 _salt) public view returns (address) {
        // 步骤1：获取子合约的初始化字节码（编译后生成，固定值）
        bytes memory bytecode = type(UserInfoContract).creationCode;
        // 步骤2：计算字节码的 keccak256 哈希
        bytes32 bytecodeHash = keccak256(bytecode);
        
        // 步骤3：按 CREATE2 地址规则计算（核心公式）
        address predictedAddr = address(
            uint160( // 转成 160 位地址格式
                uint256(
                    keccak256(
                        abi.encodePacked(
                            bytes1(0xff), // 固定前缀
                            address(this), // 工厂合约地址
                            _salt, // 盐值
                            bytecodeHash // 子合约字节码哈希
                        )
                    )
                )
            )
        );
        
        return predictedAddr;
    }
}
</code></pre>
<p>步骤 1：部署 <code>CREATE2</code> 工厂合约</p>
<p>步骤 3：预计算子合约地址（核心验证）</p>
<ol>
<li>在工厂合约实例中，找到 <code>computeContractAddress</code> 函数，输入 salt 值 <code>12345</code>，点击「call」；</li>
<li>记录返回的<strong>预计算地址</strong>（比如 <code>0x8626f6940E2eb28930eFb4CeF49B2d1F2C9C1199</code>）；</li>
<li>此时该地址还未部署任何合约（只是预计算结果）。</li>
</ol>
<p>步骤 4：用 <code>CREATE2</code> 部署子合约（验证地址一致）</p>
<ol>
<li>在工厂合约实例中，找到 <code>deployWithCREATE2</code> 函数，输入相同的 salt 值 <code>12345</code>，点击「transact」；</li>
<li>交易成功后，复制返回的<strong>实际部署地址</strong>；</li>
<li>对比「预计算地址」和「实际部署地址」—— 两者完全一致（<code>CREATE2</code> 核心优势体现）。</li>
</ol>
<p>步骤 5：验证子合约功能</p>
<ol>
<li>在「At Address」输入实际部署地址，选择 <code>UserInfoContract</code>，加载合约实例；</li>
<li>调用 <code>initUser("Charlie")</code>，再调用 <code>getUserInfo()</code> → 返回 <code>("Charlie", 工厂合约地址)</code>；</li>
<li>调用 <code>updateUserName("Dave")</code> → 验证用户名修改成功。</li>
</ol>
<h3 data-id="heading-29">11、删除合约</h3>
<h4 data-id="heading-30">1、销毁合约的核心原理（<code>selfdestruct</code>）</h4>
<p>Solidity 中销毁合约的唯一方式是调用 <code>selfdestruct(address payable recipient)</code>（旧称 <code>suicide</code>，已废弃），这是 EVM 级别的低级操作，核心特性如下：</p>
<ol>
<li>核心行为
<ul>
<li>永久销毁当前合约的<strong>代码</strong>和<strong>存储数据</strong>（所有状态变量被清空，无法恢复）；</li>
<li>将合约账户中剩余的所有 ETH 转移到指定的 <code>recipient</code> 地址；</li>
<li>合约地址不会消失，但地址对应的代码 / 存储被清空，后续调用该地址的任何函数都会失败。</li>
</ul>
</li>
<li><strong>权限要求</strong>：仅能由合约<strong>自身</strong>调用（或通过合约内的函数间接调用，需加权限控制）；</li>
<li><strong>不可逆性</strong>：销毁后无法恢复，是永久性操作，需谨慎使用。</li>
</ol>
<h4 data-id="heading-31">2.案例</h4>
<p>可销毁的子合约（<code>DestructibleUserInfo</code>）</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

contract DestructibleUserInfo {
    string public userName;
    address public deployer;
    bool public isDestroyed;

    modifier onlyDeployer() {
        require(msg.sender == deployer, "Only deploy can call");
        _;
    }

    modifier notDestroyed() {
        require(!isDestroyed, "Contract already destroyed");
        _;
    }

    function updateUserName(string memory _newName) public notDestroyed {
        userName = _newName;
    }

    function getUserInfo() public view returns (string memory, address){
        return (userName,deployer);
    }

    function destroyContract(address payable  _recipient) public onlyDeployer notDestroyed {
        isDestroyed = true;
        selfdestruct(_recipient);
    }

    receive() external payable {}
}
</code></pre>
<ol start="2">
<li>管理销毁的工厂合约（<code>DestructibleUserInfoFactory</code>）</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "./DestructibleUserInfo.sol";

// 工厂合约：部署+销毁 可销毁的用户信息合约
contract DestructibleUserInfoFactory {
    // 记录已部署的子合约地址（防止销毁后误操作）
    address[] public deployedContracts;
    // 标记子合约是否已销毁
    mapping(address =&gt; bool) public isContractDestroyed;

      // 部署并初始化子合约（让工厂成为 deployer）
    function deployAndInitContract(string memory _userName) public returns (address) {
        DestructibleUserInfo newContract = new DestructibleUserInfo();
        // 工厂合约调用 initUser → 子合约的 deployer = 工厂地址
        newContract.initUser(_userName); 
        deployedContracts.push(address(newContract));
        return address(newContract);
    }

    // 工厂触发子合约销毁（核心：调用子合约的destroyContract）
    function destroyUserContract(address payable _contractAddr, address payable _recipient) public {
        // 检查合约是否由本工厂部署
        bool isDeployed = false;
        for (uint i = 0; i &lt; deployedContracts.length; i++) {
            if (deployedContracts[i] == _contractAddr) {
                isDeployed = true;
                break;
            }
        }
        require(isDeployed, "Contract not deployed by this factory");
        // 检查合约未被销毁
        require(!isContractDestroyed[_contractAddr], "Contract already destroyed");

        // 现在类型匹配，编译通过
        DestructibleUserInfo(_contractAddr).destroyContract(_recipient);
        // 标记销毁状态
        isContractDestroyed[_contractAddr] = true;
    }

    // 给子合约转ETH（测试销毁时的ETH转移）
    function sendEthToContract(address _contractAddr) public payable {
        require(msg.value &gt; 0, "ETH amount must be &gt; 0");
        (bool success, ) = _contractAddr.call{value: msg.value}("");
        require(success, "ETH transfer failed");
    }
}
</code></pre>
<p>步骤 1：部署工厂合约</p>
<ol>
<li>在 Remix 中选择 <strong>DestructibleUserInfoFactory</strong> 合约</li>
<li>点击「Deploy」按钮部署合约</li>
<li>等待交易确认，获得工厂合约地址</li>
</ol>
<p>步骤 2：调用工厂的 deployAndInitContract</p>
<ol>
<li>在已部署的工厂合约界面，找到 <code>deployAndInitContract</code> 函数</li>
<li>输入参数 <code>_userName: "TestFactory"</code></li>
<li>点击「transact」执行交易</li>
<li>等待交易成功，复制返回的子合约地址</li>
</ol>
<p>步骤 3：验证子合约 deployer</p>
<ol>
<li>在 Remix 的「At Address」输入框中粘贴子合约地址</li>
<li>从下拉菜单中选择 <strong>DestructibleUserInfo</strong> 合约类型</li>
<li>点击「At Address」按钮加载子合约</li>
<li>调用子合约的 <code>deployer()</code> 函数</li>
<li>验证返回的地址是否为工厂合约地址</li>
</ol>
<p>步骤 4：测试工厂销毁子合约</p>
<p>4.1 向子合约发送 ETH</p>
<ol>
<li>调用工厂的 <code>sendEthToContract</code> 函数</li>
<li>参数 <code>_contractAddr</code>: 粘贴子合约地址</li>
<li>在 Value 字段输入 <code>1</code></li>
<li>单位选择 <strong>ether</strong></li>
<li>点击「transact」执行交易</li>
</ol>
<p>4.2 销毁子合约</p>
<ol>
<li>调用工厂的 <code>destroyUserContract</code> 函数</li>
<li>参数 <code>_contractAddr</code>: 子合约地址（payable 类型）</li>
<li>参数 <code>_recipient</code>: 你的钱包地址</li>
<li>点击「transact」执行交易</li>
<li>等待交易成功确认</li>
</ol>
<h3 data-id="heading-32">12、ABI编码解码</h3>
<p><code>ABI</code> (Application Binary Interface，应用二进制接口)是与以太坊智能合约交互的标准。数据基于他们的类型编码；并且由于编码后不包含类型信息，解码时需要注明它们的类型。</p>
<p><code>Solidity</code>中，<code>ABI编码</code>有4个函数：<code>abi.encode</code>, <code>abi.encodePacked</code>, <code>abi.encodeWithSignature</code>, <code>abi.encodeWithSelector</code>。而<code>ABI解码</code>有1个函数：<code>abi.decode</code>，用于解码<code>abi.encode</code>的数据。</p>
<h4 data-id="heading-33">ABI编码</h4>
<p>我们将编码4个变量，他们的类型分别是<code>uint256</code>（别名 uint）, <code>address</code>, <code>string</code>, <code>uint256[2]</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">uint x = 10;
address addr = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
string name = "0xAA";
uint[2] array = [5, 6];
</code></pre>
<h5 data-id="heading-34"><code>abi.encode</code></h5>
<p>将给定参数利用<a href="https://link.juejin.cn?target=https%3A%2F%2Flearnblockchain.cn%2Fdocs%2Fsolidity%2Fabi-spec.html" target="_blank" title="https://learnblockchain.cn/docs/solidity/abi-spec.html" ref="nofollow noopener noreferrer">ABI规则</a>编码。<code>ABI</code>被设计出来跟智能合约交互，他将每个参数填充为32字节的数据，并拼接在一起。如果你要和合约交互，你要用的就是<code>abi.encode</code>。</p>
<pre><code class="hljs language-solidity" lang="solidity">function encode() public view returns(bytes memory result) {
    result = abi.encode(x, addr, name, array);
}
</code></pre>
<p>编码的结果为<code>0x000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>，详细解释下编码的细节：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">000000000000000000000000000000000000000000000000000000000000000</span>a    <span class="hljs-comment">// x</span>
<span class="hljs-number">0000000000000000000000007</span>a58c0be72be218b41c608b7fe7c5bb630736c71    <span class="hljs-comment">// addr</span>
<span class="hljs-number">00000000000000000000000000000000000000000000000000000000000000</span>a0    <span class="hljs-comment">// name 参数的偏移量</span>
<span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000005</span>    <span class="hljs-comment">// array[0]</span>
<span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000006</span>    <span class="hljs-comment">// array[1]</span>
<span class="hljs-number">0000000000000000000000000000000000000000000000000000000000000004</span>    <span class="hljs-comment">// name 参数的长度为4字节</span>
<span class="hljs-number">3078414100000000000000000000000000000000000000000000000000000000</span>    <span class="hljs-comment">// name</span>
</code></pre>
<p>其中 <code>name</code> 参数被转换为UTF-8的字节值 <code>0x30784141</code>，在 abi 编码规范中，string 属于动态类型 ，动态类型的参数需要借助偏移量进行编码，可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Flearnblockchain.cn%2Fdocs%2Fsolidity%2Fabi-spec.html%23id9" target="_blank" title="https://learnblockchain.cn/docs/solidity/abi-spec.html#id9" ref="nofollow noopener noreferrer">动态类型的使用</a>。由于 abi.encode 会将每个参与编码的参数元素（包括偏移量，长度）都填充为32字节（evm字长为32字节），所以可以看到编码后的数据中有很多填充的 0 。</p>
<h5 data-id="heading-35"><code>abi.encodePacked</code></h5>
<p>将给定参数根据其所需最低空间编码。它类似 <code>abi.encode</code>，但是会把其中填充的很多<code>0</code>省略。比如，只用1字节来编码<code>uint8</code>类型。当你想省空间，并且不与合约交互的时候，可以使用<code>abi.encodePacked</code>，例如算一些数据的<code>hash</code>时。需要注意，<code>abi.encodePacked</code>因为不会做填充，所以不同的输入在拼接后可能会产生相同的编码结果，导致冲突，这也带来了潜在的安全风险。</p>
<pre><code class="hljs language-solidity" lang="solidity">function encodePacked() public view returns(bytes memory result) {
    result = abi.encodePacked(x, addr, name, array);
}
</code></pre>
<p>编码的结果为<code>0x000000000000000000000000000000000000000000000000000000000000000a7a58c0be72be218b41c608b7fe7c5bb630736c713078414100000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000006</code>，由于<code>abi.encodePacked</code>对编码进行了压缩，长度比<code>abi.encode</code>短很多。</p>
<h5 data-id="heading-36"><code>abi.encodeWithSignature</code></h5>
<p>与<code>abi.encode</code>功能类似，只不过第一个参数为<code>函数签名</code>，比如<code>"foo(uint256,address,string,uint256[2])"</code>。当调用其他合约的时候可以使用。</p>
<pre><code class="hljs language-solidity" lang="solidity">function encodeWithSignature() public view returns(bytes memory result) {
    result = abi.encodeWithSignature("foo(uint256,address,string,uint256[2])", x, addr, name, array);
}
</code></pre>
<p>编码的结果为<code>0xe87082f1000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>，等同于在<code>abi.encode</code>编码结果前加上了4字节的<code>函数选择器</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wtf.academy%2Fzh%2Fcourse%2Fsolidity102%2FABIEncode%23user-content-fn-%25E8%25AF%25B4%25E6%2598%258E" target="_blank" title="https://www.wtf.academy/zh/course/solidity102/ABIEncode#user-content-fn-%E8%AF%B4%E6%98%8E" ref="nofollow noopener noreferrer">1</a>。</p>
<h5 data-id="heading-37"><code>abi.encodeWithSelector</code></h5>
<p>与<code>abi.encodeWithSignature</code>功能类似，只不过第一个参数为<code>函数选择器</code>，为<code>函数签名</code>Keccak哈希的前4个字节。</p>
<pre><code class="hljs language-solidity" lang="solidity">function encodeWithSelector() public view returns(bytes memory result) {
    result = abi.encodeWithSelector(bytes4(keccak256("foo(uint256,address,string,uint256[2])")), x, addr, name, array);
}
</code></pre>
<p>编码的结果为<code>0xe87082f1000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>，与<code>abi.encodeWithSignature</code>结果一样。</p>
<h4 data-id="heading-38">ABI解码</h4>
<h4 data-id="heading-39"><code>abi.decode</code></h4>
<p><code>abi.decode</code>用于解码<code>abi.encode</code>生成的二进制编码，将它还原成原本的参数。</p>
<pre><code class="hljs language-solidity" lang="solidity">function decode(bytes memory data) public pure returns(uint dx, address daddr, string memory dname, uint[2] memory darray) {
    (dx, daddr, dname, darray) = abi.decode(data, (uint, address, string, uint[2]));
}
</code></pre>
<h4 data-id="heading-40">代码</h4>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.21;

contract ABIEncode{
    uint x = 10;
    address addr = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
    string name = "0xAA";
    uint[2] array = [5, 6]; 

    function encode() public view returns(bytes memory result) {
        result = abi.encode(x, addr, name, array);
    }

    function encodePacked() public view returns(bytes memory result) {
        result = abi.encodePacked(x, addr, name, array);
    }

    function encodeWithSignature() public view returns(bytes memory result) {
        result = abi.encodeWithSignature("foo(uint256,address,string,uint256[2])", x, addr, name, array);
    }

    function encodeWithSelector() public view returns(bytes memory result) {
        result = abi.encodeWithSelector(bytes4(keccak256("foo(uint256,address,string,uint256[2])")), x, addr, name, array);
    }
    function decode(bytes memory data) public pure returns(uint dx, address daddr, string memory dname, uint[2] memory darray) {
        (dx, daddr, dname, darray) = abi.decode(data, (uint, address, string, uint[2]));
    }
}
</code></pre>
<h3 data-id="heading-41">13.选择器</h3>
<h4 data-id="heading-42">1.msg.data</h4>
<p><code>msg.data</code>是<code>Solidity</code>中的一个全局变量，值为完整的<code>calldata</code>（调用函数时传入的数据）。</p>
<p>在下面的代码中，我们可以通过<code>Log</code>事件来输出调用<code>mint</code>函数的<code>calldata</code>：</p>
<pre><code class="hljs language-solidity" lang="solidity">// event 返回msg.data
event Log(bytes data);

function mint(address to) external{
    emit Log(msg.data);
}
</code></pre>
<p>当参数为<code>0x2c44b726ADF1963cA47Af88B284C06f30380fC78</code>时，输出的<code>calldata</code>为</p>
<pre><code class="hljs">0x6a6278420000000000000000000000002c44b726adf1963ca47af88b284c06f30380fc78
</code></pre>
<p>这段很乱的字节码可以分成两部分：</p>
<pre><code class="hljs">前4个字节为函数选择器selector：
0x6a627842

后面32个字节为输入的参数：
0x0000000000000000000000002c44b726adf1963ca47af88b284c06f30380fc78
</code></pre>
<p>其实<code>calldata</code>就是告诉智能合约，我要调用哪个函数，以及参数是什么。</p>
<h4 data-id="heading-43">2.method id、selector和函数签名</h4>
<p><code>method id</code>定义为<code>函数签名</code>的<code>Keccak</code>哈希后的前4个字节，当<code>selector</code>与<code>method id</code>相匹配时，即表示调用该函数，那么<code>函数签名</code>是什么？</p>
<p>函数签名，为<code>"函数名（逗号分隔的参数类型)"</code>举个例子，上面代码中<code>mint</code>的函数签名为<code>"mint(address)"</code>。在同一个智能合约中，不同的函数有不同的函数签名，因此我们可以通过函数签名来确定要调用哪个函数。</p>
<p><strong>注意</strong>，在函数签名中，<code>uint</code>和<code>int</code>要写为<code>uint256</code>和<code>int256</code>。</p>
<p>我们写一个函数，来验证<code>mint</code>函数的<code>method id</code>是否为<code>0x6a627842</code>。大家可以运行下面的函数，看看结果。</p>
<pre><code class="hljs language-solidity" lang="solidity">function mintSelector() external pure returns(bytes4 mSelector){
    return bytes4(keccak256("mint(address)"));
}
</code></pre>
<p>结果正是0x6a627842</p>
<p>由于计算<code>method id</code>时，需要通过函数名和函数的参数类型来计算。在<code>Solidity</code>中，函数的参数类型主要分为：基础类型参数，固定长度类型参数，可变长度类型参数和映射类型参数。</p>
<h5 data-id="heading-44">基础类型参数</h5>
<p><code>solidity</code>中，基础类型的参数有：<code>uint256</code>(<code>uint8</code>, ... , <code>uint256</code>)、<code>bool</code>, <code>address</code>等。在计算<code>method id</code>时，只需要计算<code>bytes4(keccak256("函数名(参数类型1,参数类型2,...)"))</code>。例如，如下函数，函数名为<code>elementaryParamSelector</code>，参数类型分别为<code>uint256</code>和<code>bool</code>。所以，只需要计算<code>bytes4(keccak256("elementaryParamSelector(uint256,bool)"))</code>便可得到此函数的<code>method id</code>。</p>
<pre><code class="hljs language-solidity" lang="solidity">// elementary（基础）类型参数selector
    // 输入：param1: 1，param2: 0
    // elementaryParamSelector(uint256,bool) : 0x3ec37834
    function elementaryParamSelector(uint256 param1, bool param2) external returns(bytes4 selectorWithElementaryParam){
        emit SelectorEvent(this.elementaryParamSelector.selector);
        return bytes4(keccak256("elementaryParamSelector(uint256,bool)"));
    }
</code></pre>
<h5 data-id="heading-45">固定长度类型参数</h5>
<p>固定长度的参数类型通常为固定长度的数组，例如：<code>uint256[5]</code>等。例如，如下函数<code>fixedSizeParamSelector</code>的参数为<code>uint256[3]</code>。因此，在计算该函数的<code>method id</code>时，只需要通过<code>bytes4(keccak256("fixedSizeParamSelector(uint256[3])"))</code>即可。</p>
<pre><code class="hljs language-solidity" lang="solidity">// fixed size（固定长度）类型参数selector
    // 输入： param1: [1,2,3]
    // fixedSizeParamSelector(uint256[3]) : 0xead6b8bd
    function fixedSizeParamSelector(uint256[3] memory param1) external returns(bytes4 selectorWithFixedSizeParam){
        emit SelectorEvent(this.fixedSizeParamSelector.selector);
        return bytes4(keccak256("fixedSizeParamSelector(uint256[3])"));
    }
</code></pre>
<h5 data-id="heading-46">可变长度类型参数</h5>
<p>可变长度参数类型通常为可变长的数组，例如：<code>address[]</code>、<code>uint8[]</code>、<code>string</code>等。例如，如下函数<code>nonFixedSizeParamSelector</code>的参数为<code>uint256[]</code>和<code>string</code>。因此，在计算该函数的<code>method id</code>时，只需要通过<code>bytes4(keccak256("nonFixedSizeParamSelector(uint256[],string)"))</code>即可。</p>
<pre><code class="hljs language-solidity" lang="solidity">// non-fixed size（可变长度）类型参数selector
    // 输入： param1: [1,2,3]， param2: "abc"
    // nonFixedSizeParamSelector(uint256[],string) : 0xf0ca01de
    function nonFixedSizeParamSelector(uint256[] memory param1,string memory param2) external returns(bytes4 selectorWithNonFixedSizeParam){
        emit SelectorEvent(this.nonFixedSizeParamSelector.selector);
        return bytes4(keccak256("nonFixedSizeParamSelector(uint256[],string)"));
    }
</code></pre>
<h5 data-id="heading-47">映射类型参数</h5>
<p>映射类型参数通常有：<code>contract</code>、<code>enum</code>、<code>struct</code>等。在计算<code>method id</code>时，需要将该类型转化成为<code>ABI</code>类型。</p>
<p>例如，如下函数<code>mappingParamSelector</code>中<code>DemoContract</code>需要转化为<code>address</code>，结构体<code>User</code>需要转化为<code>tuple</code>类型<code>(uint256,bytes)</code>，枚举类型<code>School</code>需要转化为<code>uint8</code>。因此，计算该函数的<code>method id</code>的代码为<code>bytes4(keccak256("mappingParamSelector(address,(uint256,bytes),uint256[],uint8)"))</code>。</p>
<pre><code class="hljs language-solidity" lang="solidity">contract DemoContract {
    // empty contract
}

contract Selector{
    // Struct User
    struct User {
        uint256 uid;
        bytes name;
    }
    // Enum School
    enum School { SCHOOL1, SCHOOL2, SCHOOL3 }
    ...
    // mapping（映射）类型参数selector
    // 输入：demo: 0x9D7f74d0C41E726EC95884E0e97Fa6129e3b5E99， user: [1, "0xa0b1"], count: [1,2,3], mySchool: 1
    // mappingParamSelector(address,(uint256,bytes),uint256[],uint8) : 0xe355b0ce
    function mappingParamSelector(DemoContract demo, User memory user, uint256[] memory count, School mySchool) external returns(bytes4 selectorWithMappingParam){
        emit SelectorEvent(this.mappingParamSelector.selector);
        return bytes4(keccak256("mappingParamSelector(address,(uint256,bytes),uint256[],uint8)"));
    }
    ...
}
</code></pre>
<h4 data-id="heading-48">3.使用selector</h4>
<p>我们可以利用<code>selector</code>来调用目标函数。例如我想调用<code>elementaryParamSelector</code>函数，我只需要利用<code>abi.encodeWithSelector</code>将<code>elementaryParamSelector</code>函数的<code>method id</code>作为<code>selector</code>和参数打包编码，传给<code>call</code>函数：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 使用selector来调用函数</span>
    function <span class="hljs-built_in">callWithSignature</span>() external{
	...
        <span class="hljs-comment">// 调用elementaryParamSelector函数</span>
        (bool success1, bytes memory data1) = <span class="hljs-selector-tag">address</span>(this)<span class="hljs-selector-class">.call</span>(abi.encodeWithSelector(<span class="hljs-number">0</span>x3ec37834, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>));
	...
    }
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[corepack 作用]]></title>    <link>https://juejin.cn/post/7603769956975280169</link>    <guid>https://juejin.cn/post/7603769956975280169</guid>    <pubDate>2026-02-08T07:06:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603769956975280169" data-draft-id="7603677143214669839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="corepack 作用"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T07:06:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            corepack 作用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:06:50.000Z" title="Sun Feb 08 2026 07:06:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>corepack</code> 可以把它理解成 <strong>Node.js 自带的“包管理器管理器”</strong> 。<br/>
<strong>corepack 用来管理和锁定项目使用的包管理器（比如 pnpm / yarn），而不是管理依赖本身。</strong></p>
<h2 data-id="heading-0">为什么会有 corepack</h2>
<p>以前的情况很乱：</p>
<ul>
<li>有的人用 <code>npm</code></li>
<li>有的人用 <code>yarn</code></li>
<li>有的人用 <code>pnpm</code></li>
<li>同一个项目里，不同人用的 <strong>包管理器版本还不一样</strong></li>
</ul>
<p>结果就是：</p>
<blockquote>
<p>“我这能跑，你那为啥装不起来？”</p>
</blockquote>
<p><code>corepack</code> 的出现，就是为了解决 <strong>“到底用哪个包管理器、用哪个版本”</strong> 这个问题。</p>
<h2 data-id="heading-1">corepack 能干什么</h2>
<h3 data-id="heading-2">1️⃣ 统一项目使用的包管理器</h3>
<p>在 <code>package.json</code> 里可以写：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"packageManager"</span>: <span class="hljs-string">"pnpm@8.15.4"</span>
}
</code></pre>
<p>含义是：</p>
<blockquote>
<p>这个项目 <strong>必须</strong> 用 <code>pnpm</code>，而且版本是 <code>8.15.4</code></p>
</blockquote>
<p>这时候：</p>
<ul>
<li>你 <code>pnpm install</code></li>
<li>同事 <code>npm install</code></li>
<li>CI 里跑 <code>pnpm install</code></li>
</ul>
<p>👉 <strong>corepack 会自动帮你下载并使用正确版本的 pnpm</strong></p>
<p>不用大家手动装。</p>
<hr/>
<h3 data-id="heading-3">2️⃣ 自动安装 &amp; 切换 yarn / pnpm</h3>
<p>你甚至不需要提前全局装 pnpm：</p>
<pre><code class="hljs language-bash" lang="bash">corepack <span class="hljs-built_in">enable</span>
pnpm install
</code></pre>
<p>如果项目声明的是：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"packageManager"</span>: <span class="hljs-string">"yarn@3.6.1"</span>
</code></pre>
<p>corepack 会：</p>
<ul>
<li>自动下载 yarn 3.6.1</li>
<li>用它来执行命令</li>
</ul>
<p>你本地有没有 yarn 👉 <strong>不重要</strong></p>
<hr/>
<h3 data-id="heading-4">3️⃣ 防止“包管理器版本不一致”的坑</h3>
<p>比如：</p>
<ul>
<li>A 用 pnpm 7</li>
<li>B 用 pnpm 8</li>
<li>lock 文件结构都不一样</li>
</ul>
<p>corepack 可以 <strong>强制版本一致</strong>，从源头避免：</p>
<ul>
<li>lockfile 被反复改</li>
<li>CI 跑不过</li>
<li>“我这没问题啊”的玄学 bug</li>
</ul>
<hr/>
<h2 data-id="heading-5">corepack 和 npm / yarn / pnpm 的关系</h2>
<p>可以这么理解👇</p>
<pre><code class="hljs">corepack
  ├── 管理 pnpm
  ├── 管理 yarn
  └── 管理 npm（间接）
</code></pre>
<ul>
<li><strong>npm / yarn / pnpm</strong>：真正干活的</li>
<li><strong>corepack</strong>：负责“发工具、管版本、做协调”</li>
</ul>
<hr/>
<h2 data-id="heading-6">常用命令速览 🧠</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用 corepack（Node 16+ 自带）</span>
corepack <span class="hljs-built_in">enable</span>

<span class="hljs-comment"># 查看当前 corepack 版本</span>
corepack --version

<span class="hljs-comment"># 指定并激活某个包管理器版本</span>
corepack prepare pnpm@8.15.4 --activate
</code></pre>
<hr/>
<h2 data-id="heading-7">什么时候一定要用 corepack</h2>
<p>非常推荐用在这些场景👇</p>
<ul>
<li>团队协作项目</li>
<li>monorepo（pnpm / yarn workspace）</li>
<li>CI / Docker / 线上构建</li>
<li>你已经被 “lockfile 一直变” 折磨过 😅</li>
</ul>
<hr/>
<h2 data-id="heading-8">一句话总结</h2>
<blockquote>
<p><strong>corepack 不是用来装依赖的，是用来“管包管理器的版本和使用权”的。</strong><br/>
它让“这个项目该用哪个包管理器、哪个版本”变成一件确定的事。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pnpm-workspace.yaml]]></title>    <link>https://juejin.cn/post/7603781883973615635</link>    <guid>https://juejin.cn/post/7603781883973615635</guid>    <pubDate>2026-02-08T07:32:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603781883973615635" data-draft-id="7603644943351955462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pnpm-workspace.yaml"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T07:32:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="code_YuJun"/> <meta itemprop="url" content="https://juejin.cn/user/3615612462441358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pnpm-workspace.yaml
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3615612462441358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    code_YuJun
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:32:43.000Z" title="Sun Feb 08 2026 07:32:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>pnpm-workspace.yaml</code> 是 <strong>pnpm 的“项目组织与调度中枢”</strong>，告诉 pnpm：哪些目录是同一个 workspace，以及这些包之间如何协同工作。</p>
<h2 data-id="heading-0">定义哪些包属于同一个仓库</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">packages/*</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">apps/*</span>
</code></pre>
<ul>
<li><code>packages/*</code> 下面每个有 <code>package.json</code> 的目录，都是一个包</li>
<li><code>apps/*</code> 下面每个 app 也是一个包</li>
</ul>
<h2 data-id="heading-1">Workspace 内包本地互相引用</h2>
<pre><code class="hljs language-js" lang="js">packages/
  utils/
  ui/
apps/
  admin/
</code></pre>
<p>在 <code>apps/admin/package.json</code> 里：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@my/utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"workspace:*"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>效果是：</p>
<ul>
<li>不去 npm 下载</li>
<li>直接 <strong>软链接到本地 packages/utils</strong></li>
<li>改代码立刻生效</li>
</ul>
<p>这是 monorepo 的灵魂能力。</p>
<h2 data-id="heading-2">依赖统一安装、统一锁定</h2>
<p>在根目录执行<code>pnpm install</code><br/>
pnpm 会：</p>
<ul>
<li>扫描 <code>pnpm-workspace.yaml</code> 里的所有包</li>
<li>统一生成 <strong>一份 <code>pnpm-lock.yaml</code></strong></li>
<li>所有包共享同一个依赖树</li>
</ul>
<h2 data-id="heading-3">支持 catalog</h2>
<p>pnpm-workspace.yaml 里可以这样写：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">catalog:</span>
  <span class="hljs-attr">vite:</span> <span class="hljs-string">^5.1.0</span>
  <span class="hljs-attr">vue:</span> <span class="hljs-string">^3.4.0</span>
  <span class="hljs-attr">typescript:</span> <span class="hljs-string">^5.3.3</span>
</code></pre>
<p>子包中：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"catalog:"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"catalog:"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>版本集中管理，企业级工程标配.</p>
<h2 data-id="heading-4">支持 workspace 协议（workspace:*）</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-string">"@my/ui"</span>: <span class="hljs-string">"workspace:*"</span>     <span class="hljs-comment">// 任意版本</span>
<span class="hljs-string">"@my/ui"</span>: <span class="hljs-string">"workspace:^"</span>     <span class="hljs-comment">// 遵循 semver</span>
<span class="hljs-string">"@my/ui"</span>: <span class="hljs-string">"workspace:~"</span>
</code></pre>
<h2 data-id="heading-5">批量执行命令</h2>
<pre><code class="hljs language-js" lang="js">pnpm -r build
pnpm -r test
pnpm -r lint
</code></pre>
<ul>
<li><code>-r</code> = recursive</li>
<li>对 workspace 里的 <strong>所有包</strong> 执行</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Koa.js 教程 | 一份不可多得的 Node.js 的 Web 框架 Koa.js 教程]]></title>    <link>https://juejin.cn/post/7603771025856692275</link>    <guid>https://juejin.cn/post/7603771025856692275</guid>    <pubDate>2026-02-08T07:49:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603771025856692275" data-draft-id="7603721514203136009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Koa.js 教程 | 一份不可多得的 Node.js 的 Web 框架 Koa.js 教程  "/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2026-02-08T07:49:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="千寻girling"/> <meta itemprop="url" content="https://juejin.cn/user/2276467567770442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Koa.js 教程 | 一份不可多得的 Node.js 的 Web 框架 Koa.js 教程  
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2276467567770442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    千寻girling
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:49:56.000Z" title="Sun Feb 08 2026 07:49:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"“";top:4px;left:6px}.markdown-body blockquote:after{content:"”";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第一章 安装和配置 koa</h2>
<p>Koa 是一个轻量级、现代化的框架, 由 Express 原班人马开发</p>
<p>初始化配置文件 package.json</p>
<pre><code class="hljs language-js" lang="js">npm init -y
</code></pre>
<p>配置 package.json (ESM规范)</p>
<pre><code class="hljs language-js" lang="js">{
     <span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>,
     <span class="hljs-string">"name"</span>: <span class="hljs-string">"demo"</span>,
     <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
     <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
     <span class="hljs-string">"scripts"</span>: {
          <span class="hljs-string">"dev"</span>:<span class="hljs-string">"nodemon index.js"</span>,
           <span class="hljs-string">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
     },
     <span class="hljs-string">"keywords"</span>: [],
     <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
     <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>,
     <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>
}
</code></pre>
<p>npm 官网</p>
<p>     <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F" target="_blank" title="https://www.npmjs.com/" ref="nofollow noopener noreferrer">www.npmjs.com</a></p>
<p>安装koa
     </p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> koa
</code></pre>
<blockquote>
<p>     全局安装 nodemon</p>
<p>  .  <code>npm i nodemon -g</code></p>
<p>     当 nodemon 检测到监视的文件发生更改时, 会自动重新启动应用</p>
</blockquote>
<h2 data-id="heading-1">第二章 创建并启动 http 服务器</h2>
<h3 data-id="heading-2">中间件</h3>
<p>中间件是处理 HTTP 请求和响应的函数，它们可以做以下操作：</p>
<ul>
<li>处理请求（例如解析请求体、验证用户身份等）</li>
<li>修改响应（例如设置响应头、发送响应体等）</li>
<li>执行后续中间件</li>
</ul>
<blockquote>
<p>中间件 - 很重要的概念 !!!!!!!</p>
</blockquote>
<p>注意 : app.use() 方法用于注册 <strong>中间件</strong></p>
<blockquote>
<p><strong>中间件</strong> 是处理 http 请求和响应的函数  ,
当一个请求到达服务器时, 会从第一个中间件开始执行, 直到最后一个中间件</p>
</blockquote>
<h3 data-id="heading-3">上下文对象 ctx</h3>
<p>在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaijiao.org%2Fkoa%2F" target="_blank" title="https://caijiao.org/koa/" ref="nofollow noopener noreferrer">Koa</a> 中，<code>ctx</code>（上下文）对象是每个中间件函数的核心，它包含了请求和响应的所有信息。所有的 HTTP 请求和响应都通过 <code>ctx</code> 进行处理。</p>
<blockquote>
<p>上下文对象 ctx ( context ) 包含了与当前 http 请求相关的所有信息</p>
<p>如: http方法、url、请求头、请求体、查询参数等</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span> <span class="hljs-comment">//服务器监听的ip地址</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span> <span class="hljs-comment">//服务器监听的端口号</span>

<span class="hljs-comment">/*
    实例化一个 Koa 对象
    实例化是指根据一个类创建具体对象的过程
*/</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>()

app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> ctx =&gt; {
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">"juejin.cn"</span> <span class="hljs-comment">// 使用 ctx.body 设置响应体的内容</span>
})

<span class="hljs-comment">//启动 http 服务器, 并在指定的ip地址(127.0.0.1)和端口(8008)上监听连接请求</span>
app.<span class="hljs-title function_">listen</span>(port, hostname, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`服务器已启动: http://<span class="hljs-subst">${hostname}</span>:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-4">第三章 洋葱模型</h2>
<h3 data-id="heading-5">洋葱模型</h3>
<p>当你处理一个请求时,</p>
<p>可以想象成是在 "剥洋葱" ,从外向内一层一层地往里剥,直到剥到中心部分</p>
<p>这个过程涉及对 <strong>请求</strong> 的多个层面进行解析、验证、处理</p>
<p>在处理完洋葱(<strong>请求</strong>)后,</p>
<p>构建 <strong>响应</strong> 的过程就像是从精心准备的食材 ( <strong>处理请求</strong> 后得到的数据) 开始,</p>
<p>从内向外逐层添加调料(格式化、封装等),最终形成一道色香味俱佳的菜肴(<strong>响应</strong>)</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1994778ec0f4f0881f16b64bb9298a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2D5a-7Z2lybGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141796&amp;x-signature=i0WpLyNKGUcwji%2B%2FE6Kaq4UvRCs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span> <span class="hljs-comment">//服务器监听的ip地址</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span> <span class="hljs-comment">//服务器监听的端口号</span>

<span class="hljs-comment">/*
    实例化一个 Koa 对象
    实例化是指根据一个类创建具体对象的过程
*/</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>()

<span class="hljs-comment">/*
    app.use() 方法用于注册中间件
    中间件是处理 http 请求和响应的函数
    当一个请求到达服务器时, 会从第一个中间件开始执行, 直到最后一个中间件
    
    上下文对象 ctx(context) 包含了与当前 http 请求相关的所有信息
    如: http方法、url、请求头、请求体、查询参数等
*/</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx,next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>() <span class="hljs-comment">//若中间件调用了next(),会暂停当前中间件的执行,将控制权传递给下一个中间件</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>)
})

app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx,next) =&gt; { 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>)
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">4</span>)
})

<span class="hljs-comment">//当中间件没有再调用next(),则不需要再将控制权传递给下一个中间件,控制权会按照相反的顺序执行</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx,next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">5</span>)
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">"dengruicode.com"</span> <span class="hljs-comment">// 使用 ctx.body 设置响应体的内容</span>
})

<span class="hljs-comment">//启动 http 服务器, 并在指定的ip地址(127.0.0.1)和端口(8008)上监听连接请求</span>
app.<span class="hljs-title function_">listen</span>(port, hostname, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`服务器已启动: http://<span class="hljs-subst">${hostname}</span>:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-6">第四章 安装和配置路由 - get请求</h2>
<p>在 Koa 中，<code>koa-router</code> 是一个轻量级的路由中间件，它可以帮助你定义路由、处理 HTTP 请求并解析请求参数。通过使用 <code>koa-router</code>，你可以创建一个灵活的路由系统，轻松地组织和管理 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaijiao.org%2Fkoa%2F" target="_blank" title="https://caijiao.org/koa/" ref="nofollow noopener noreferrer">Koa</a> 应用的各个部分。</p>
<h3 data-id="heading-7">安装 koa-router</h3>
<p>首先，你需要安装 <code>koa-router</code>：</p>
<pre><code class="hljs language-ruby" lang="ruby">npm install <span class="hljs-variable">@koa</span>/router       <span class="hljs-comment"># 注意：新版 koa-router 包名是 <span class="hljs-doctag">@koa</span>/router</span>
</code></pre>

<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> Koa from <span class="hljs-string">'koa'</span>
<span class="hljs-keyword">import</span> Router from <span class="hljs-string">'@koa/router'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa()
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router() <span class="hljs-comment">//实例化一个 Router 对象</span>

<span class="hljs-comment">//------ get请求</span>
<span class="hljs-comment">//路由是根据客户端发送的请求(包括请求的路径、方法等)调用与之匹配的处理函数</span>
<span class="hljs-comment">//根路由 http://127.0.0.1:8008/</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">async</span> ctx =&gt; { <span class="hljs-comment">//get请求</span>
    ctx.body = <span class="hljs-string">"dengruicode.com"</span>
})

<span class="hljs-comment">//查询参数 http://127.0.0.1:8008/test?id=001&amp;web=dengruicode.com</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/test'</span>, <span class="hljs-keyword">async</span> ctx =&gt; { <span class="hljs-comment">//get请求</span>
    let id = ctx.query.id
    let web = ctx.query.web
    ctx.body = id + <span class="hljs-string">" : "</span> + web
})

<span class="hljs-comment">//路径参数 http://127.0.0.1:8008/test2/id/002/web/www.dengruicode.com</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/test2/id/:id/web/:web'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    let id = ctx.params.id
    let web = ctx.params.web
    ctx.body = id + <span class="hljs-string">" : "</span> + web
})

<span class="hljs-comment">//重定向路由 http://127.0.0.1:8008/test3</span>
router.redirect(<span class="hljs-string">'/test3'</span>, <span class="hljs-string">'https://www.baidu.com'</span>)

app.use(router.routes()) <span class="hljs-comment">//将定义在 router 对象中的路由规则添加到 app 实例中</span>

<span class="hljs-comment">//------ 路由分组</span>
<span class="hljs-comment">//http://127.0.0.1:8008/user/add</span>
<span class="hljs-comment">//http://127.0.0.1:8008/user/del</span>

<span class="hljs-keyword">const</span> userRouter = <span class="hljs-keyword">new</span> Router({ prefix: <span class="hljs-string">'/user'</span> })
userRouter.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/add'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    ctx.body = <span class="hljs-string">"添加用户"</span>
})
userRouter.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/del'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    ctx.body = <span class="hljs-string">"删除用户"</span>
})
app.use(userRouter.routes())

<span class="hljs-comment">// 在所有路由之后添加404处理函数</span>
app.use(<span class="hljs-keyword">async</span> ctx =&gt; {
    <span class="hljs-keyword">if</span> (!ctx.body) { <span class="hljs-comment">//若没有设置 ctx.body, 则说明没有到匹配任何路由</span>
        ctx.status = <span class="hljs-number">404</span>
        ctx.body = <span class="hljs-string">'404 Not Found'</span>
    }
})

app.listen(port, hostname, () =&gt; {
    console.log(`服务器已启动: http:<span class="hljs-comment">//${hostname}:${port}`)</span>
})
</code></pre>
<h2 data-id="heading-8">第五章 post请求</h2>
<h3 data-id="heading-9">安装 koa-body</h3>
<p>Koa 原生不支持解析 POST 请求体，需安装 <code>koa-body</code> 中间件：</p>
<pre><code class="hljs language-css" lang="css">npm install koa-<span class="hljs-selector-tag">body</span>
</code></pre>
<p>POST 请求处理示例</p>
<p>修改 <code>src/index.js</code>，新增 POST 路由：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>;
<span class="hljs-keyword">import</span> { koaBody } <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-body'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 注册 koa-body 中间件：解析 JSON、表单、文件类型的 POST 数据</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaBody</span>({
  <span class="hljs-attr">multipart</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 支持文件上传（后续第八章用）</span>
  <span class="hljs-attr">json</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 解析 JSON 格式</span>
  <span class="hljs-attr">urlencoded</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 解析表单格式（application/x-www-form-urlencoded）</span>
}));

<span class="hljs-comment">// 1. 处理 JSON 格式 POST 请求</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/json'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> { name, age } = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;
  ctx.<span class="hljs-property">body</span> = {       <span class="hljs-comment">// ctx.request.body 是 koa-body 解析后的 POST 数据</span>
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"JSON 数据接收成功"</span>,
    <span class="hljs-attr">data</span>: { name, age }
  };
});

<span class="hljs-comment">// 2. 处理表单格式 POST 请求</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/form'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> { username, password } = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">body</span>;
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"表单数据接收成功"</span>,
    <span class="hljs-attr">data</span>: { username, password }
  };
});

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());

<span class="hljs-comment">// 404 处理</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx) =&gt; {
  ctx.<span class="hljs-property">status</span> = <span class="hljs-number">404</span>;
  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">'404 Not Found'</span>;
});

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`POST 服务器启动：http://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>测试 POST 请求（两种方式）</p>
<p>方式 1：Postman 测试</p>
<ul>
<li>
<p>请求地址：<code>http://localhost:8008/api/json</code></p>
</li>
<li>
<p>请求方法：POST</p>
</li>
<li>
<p>请求体：选择 <code>raw &gt; JSON</code>，输入：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"张三"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span> <span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p>响应：<code>{"code":200,"msg":"JSON 数据接收成功","data":{"name":"张三","age":20}}</code></p>
</li>
</ul>
<p>方式 2：curl 命令测试</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 测试 JSON 格式</span>
curl -X POST -H <span class="hljs-string">"Content-Type: application/json"</span> -d <span class="hljs-string">'{"name":"张三","age":20}'</span> http://localhost:8008/api/json

<span class="hljs-comment"># 测试表单格式</span>
curl -X POST -d <span class="hljs-string">"username=admin&amp;password=123456"</span> http://localhost:8008/api/form
</code></pre>
<h2 data-id="heading-10">第六章 错误处理</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">"127.0.0.1"</span>
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>()
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>()

<span class="hljs-comment">//http://127.0.0.1:8008/</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">async</span> ctx =&gt; {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"测试"</span>)
})

<span class="hljs-comment">/*
    将 '错误处理中间件' 放在 '路由处理中间件' 之前, 当一个请求到达时,
    会先经过 '错误处理中间件', 然后才会进入 '路由处理中间件',
    是为了确保可以捕获错误
*/</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {  <span class="hljs-comment">// 错误处理中间件</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>()
    } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-comment">//console.log('err:', err)</span>
        ctx.<span class="hljs-property">status</span> = <span class="hljs-number">500</span>
        ctx.<span class="hljs-property">body</span> = <span class="hljs-string">'err: '</span> + err.<span class="hljs-property">message</span>
    }
})

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>())   <span class="hljs-comment">// 路由处理中间件</span>

app.<span class="hljs-title function_">listen</span>(port, hostname, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`服务器已启动: http://<span class="hljs-subst">${hostname}</span>:<span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h2 data-id="heading-11">第七章 允许跨域请求</h2>
<p>安装跨域中间件</p>
<pre><code class="hljs language-bash" lang="bash">npm install @koa/cors
</code></pre>
<p>跨域配置示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Cors</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/cors'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Cors</span>()) <span class="hljs-comment">//允许跨域请求</span>

<span class="hljs-comment">// 测试跨域路由</span>
router.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/cors'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"跨域请求成功"</span>
  };
});

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`跨域服务器启动：http://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>测试跨域</p>
<p>在任意前端项目（如 Vue / React / HTML 文件）中发送请求：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 前端代码示例</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:8008/api/cors'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)) <span class="hljs-comment">// 输出 {code:200, msg:"跨域请求成功"}</span>
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<p>无跨域报错即配置成功。</p>
<h2 data-id="heading-12">第八章 上传图片</h2>
<p>依赖准备（复用 koa-body）</p>
<p><code>koa-body</code> 已支持文件上传，无需额外安装依赖，只需确保配置 <code>multipart: true</code>。</p>
<p>图片上传示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>;
<span class="hljs-keyword">import</span> { koaBody } <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-body'</span>;
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 1. 创建上传目录（不存在则创建）</span>
<span class="hljs-keyword">const</span> uploadDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'uploads'</span>);
<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) {
  fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
}

<span class="hljs-comment">// 2. 配置 koa-body 支持文件上传</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">koaBody</span>({
  <span class="hljs-attr">multipart</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启文件上传</span>
  <span class="hljs-attr">formidable</span>: {
    <span class="hljs-attr">uploadDir</span>: uploadDir, <span class="hljs-comment">// 临时存储目录</span>
    <span class="hljs-attr">keepExtensions</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 保留文件扩展名（如 .png/.jpg）</span>
    <span class="hljs-attr">maxFieldsSize</span>: <span class="hljs-number">2</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>, <span class="hljs-comment">// 限制文件大小 2MB</span>
    <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">name, ext, part, form</span>) =&gt;</span> {
      <span class="hljs-comment">// 自定义文件名：时间戳 + 原扩展名，避免重复</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + ext;
    }
  }
}));

<span class="hljs-comment">// 3. 图片上传接口</span>
router.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/upload'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-comment">// ctx.request.files 是上传的文件对象</span>
  <span class="hljs-keyword">const</span> file = ctx.<span class="hljs-property">request</span>.<span class="hljs-property">files</span>.<span class="hljs-property">file</span>; <span class="hljs-comment">// 前端上传的文件字段名需为 file</span>
  <span class="hljs-keyword">if</span> (!file) {
    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">400</span>;
    ctx.<span class="hljs-property">body</span> = { <span class="hljs-attr">code</span>: <span class="hljs-number">400</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">"请选择上传的图片"</span> };
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// 返回文件信息</span>
  ctx.<span class="hljs-property">body</span> = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"图片上传成功"</span>,
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">filename</span>: file.<span class="hljs-property">newFilename</span>, <span class="hljs-comment">// 自定义后的文件名</span>
      <span class="hljs-attr">path</span>: <span class="hljs-string">`/uploads/<span class="hljs-subst">${file.newFilename}</span>`</span>, <span class="hljs-comment">// 访问路径</span>
      <span class="hljs-attr">size</span>: file.<span class="hljs-property">size</span> <span class="hljs-comment">// 文件大小（字节）</span>
    }
  };
});

<span class="hljs-comment">// 4. 静态文件访问：让上传的图片可通过 URL 访问</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
  <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">path</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/uploads/'</span>)) {
    <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(uploadDir, ctx.<span class="hljs-property">path</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'/uploads/'</span>, <span class="hljs-string">''</span>));
    <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(filePath)) {
      ctx.<span class="hljs-property">type</span> = path.<span class="hljs-title function_">extname</span>(filePath).<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 设置响应类型（如 png/jpg）</span>
      ctx.<span class="hljs-property">body</span> = fs.<span class="hljs-title function_">createReadStream</span>(filePath); <span class="hljs-comment">// 读取文件并返回</span>
      <span class="hljs-keyword">return</span>;
    }
    ctx.<span class="hljs-property">status</span> = <span class="hljs-number">404</span>;
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">"文件不存在"</span>;
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
});

app.<span class="hljs-title function_">use</span>(router.<span class="hljs-title function_">routes</span>());

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`图片上传服务器启动：http://localhost:<span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>测试图片上传</p>
<p>方式 1：Postman 测试</p>
<ul>
<li>请求地址：<code>http://localhost:8008/api/upload</code></li>
<li>请求方法：POST</li>
<li>请求体：选择 <code>form-data</code>，Key 为 <code>file</code>，Type 选 <code>File</code>，上传一张图片。</li>
<li>响应：返回文件路径，如 <code>http://localhost:8008/uploads/1738987654321.png</code>，访问该 URL 可查看图片。</li>
</ul>
<p>方式 2：curl 命令测试</p>
<p>终端输入 bash 命令</p>
<pre><code class="hljs language-bash" lang="bash">curl -X POST -F <span class="hljs-string">"file=@/你的图片路径/xxx.png"</span> http://localhost:8008/api/upload
</code></pre>
<h2 data-id="heading-13">第九章 cookie</h2>
<p>Cookie 是存储在客户端浏览器的小型文本数据，Koa 内置 <code>ctx.cookies</code> API 可以操作 Cookie。</p>
<p>Cookie 操作示例</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> Koa from <span class="hljs-string">'koa'</span>
<span class="hljs-keyword">import</span> Router from <span class="hljs-string">'@koa/router'</span>
 
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa();
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> Router();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 1. 设置 Cookie</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/cookie/set'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-comment">// ctx.cookies.set(名称, 值, 配置)</span>
  ctx.cookies.<span class="hljs-keyword">set</span>(
    <span class="hljs-string">'username'</span>, 
    encodeURIComponent(<span class="hljs-string">'张三'</span>), 
    {
      maxAge: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 过期时间 1 天（毫秒）</span>
      httpOnly: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 仅允许服务端访问，防止 XSS 攻击</span>
      secure: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// 开发环境设为 false（HTTPS 环境设为 true）</span>
      path: <span class="hljs-string">'/'</span>, <span class="hljs-comment">// 生效路径（/ 表示全站）</span>
      sameSite: <span class="hljs-string">'lax'</span> <span class="hljs-comment">// 防止 CSRF 攻击</span>
    }
  );
  ctx.body = { code: <span class="hljs-number">200</span>, msg: <span class="hljs-string">"Cookie 设置成功"</span> };
});

<span class="hljs-comment">// 2. 获取 Cookie</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/cookie/get'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> username = ctx.cookies.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>);
  ctx.body = {
    code: <span class="hljs-number">200</span>,
    msg: <span class="hljs-string">"Cookie 获取成功"</span>,
    data: { username }
  };
});

<span class="hljs-comment">// 3. 删除 Cookie</span>
router.<span class="hljs-keyword">get</span>(<span class="hljs-string">'/cookie/delete'</span>, <span class="hljs-keyword">async</span> (ctx) =&gt; {
  ctx.cookies.<span class="hljs-keyword">set</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">''</span>, { maxAge: <span class="hljs-number">0</span> }); <span class="hljs-comment">// 设置 maxAge 为 0 即删除</span>
  ctx.body = { code: <span class="hljs-number">200</span>, msg: <span class="hljs-string">"Cookie 删除成功"</span> };
});

app.use(router.routes());

app.listen(port, () =&gt; {
  console.log(`Cookie 服务器启动：http:<span class="hljs-comment">//localhost:${port}`);</span>
});
</code></pre>
<p>测试 Cookie</p>
<ol>
<li>访问 <code>http://localhost:8008/cookie/set</code> → 设置 Cookie；</li>
<li>访问 <code>http://localhost:8008/cookie/get</code> → 获取 Cookie，输出 <code>{username: "张三"}</code>；</li>
<li>访问 <code>http://localhost:8008/cookie/delete</code> → 删除 Cookie，再次获取则为 <code>undefined</code>。</li>
</ol>
<h2 data-id="heading-14">第十章 session</h2>
<p>安装 Session 中间件</p>
<p>Koa 原生不支持 Session，需安装 <code>koa-session</code>：</p>
<pre><code class="hljs">npm install koa-session
</code></pre>
<p>Session 配置示例</p>
<pre><code class="hljs language-php" lang="php">import Koa <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>
import Router <span class="hljs-keyword">from</span> <span class="hljs-string">'@koa/router'</span>
import session  <span class="hljs-keyword">from</span> <span class="hljs-string">'koa-session'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">app</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">router</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Router</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">port</span> = <span class="hljs-number">8008</span>;

<span class="hljs-comment">// 1. 配置 Session 密钥（生产环境需改为随机字符串）</span>
app.keys = [<span class="hljs-string">'dengruicode_secret_key'</span>];

<span class="hljs-comment">// 2. Session 配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG</span> = {
  key: <span class="hljs-string">'koa:sess'</span>, <span class="hljs-comment">// Session Cookie 名称</span>
  maxAge: <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 过期时间 1 天</span>
  autoCommit: <span class="hljs-literal">true</span>,
  overwrite: <span class="hljs-literal">true</span>,
  httpOnly: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 仅服务端访问</span>
  signed: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 签名 Cookie，防止篡改</span>
  rolling: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 不刷新过期时间</span>
  renew: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 快过期时自动续期</span>
  secure: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 开发环境 false</span>
  sameSite: <span class="hljs-string">'lax'</span>
};

<span class="hljs-comment">// 3. 注册 Session 中间件</span>
app.<span class="hljs-keyword">use</span>(<span class="hljs-title function_ invoke__">session</span>(CONFIG, app));

<span class="hljs-comment">// 4. Session 操作</span>
<span class="hljs-comment">// 设置 Session</span>
router.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/session/set'</span>, <span class="hljs-title function_ invoke__">async</span> (ctx) =&gt; {
  ctx.session.user = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>
  };
  ctx.body = { <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">"Session 设置成功"</span> };
});

<span class="hljs-comment">// 获取 Session</span>
router.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/session/get'</span>, <span class="hljs-title function_ invoke__">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">const</span> user = ctx.session.user;
  ctx.body = {
    <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">msg</span>: <span class="hljs-string">"Session 获取成功"</span>,
    <span class="hljs-attr">data</span>: { user }
  };
});

<span class="hljs-comment">// 删除 Session</span>
router.<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'/session/delete'</span>, <span class="hljs-title function_ invoke__">async</span> (ctx) =&gt; {
  ctx.session = <span class="hljs-literal">null</span>; // 清空 Session
  ctx.body = { <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">msg</span>: <span class="hljs-string">"Session 删除成功"</span> };
});

app.<span class="hljs-keyword">use</span>(router.<span class="hljs-title function_ invoke__">routes</span>());

app.<span class="hljs-title function_ invoke__">listen</span>(port, () =&gt; {
  console.<span class="hljs-title function_ invoke__">log</span>(`Session 服务器启动：<span class="hljs-attr">http</span>://<span class="hljs-attr">localhost</span>:${port}`);
});
</code></pre>
<p>测试 Session</p>
<ol>
<li>访问 <code>http://localhost:8008/session/set</code> → 设置 Session；</li>
<li>访问 <code>http://localhost:8008/session/get</code> → 获取 Session，输出用户信息；</li>
<li>访问 <code>http://localhost:8008/session/delete</code> → 清空 Session，再次获取则为 <code>undefined</code>。</li>
</ol>
<blockquote>
<p>注意：<code>koa-session</code> 是基于 Cookie 的内存 Session，生产环境建议使用 <code>koa-redis</code> 将 Session 存储到 Redis，避免服务重启丢失数据。</p>
</blockquote>
<h2 data-id="heading-15">第十一章 jwt</h2>
<p>安装 JWT 依赖</p>
<pre><code class="hljs">npm install jsonwebtoken koa-jwt
</code></pre>
<ul>
<li><code>jsonwebtoken</code>：生成 / 解析 JWT 令牌；</li>
<li><code>koa-jwt</code>：验证 JWT 令牌的中间件。</li>
</ul>
<p>JWT 完整示例</p>
<pre><code class="hljs language-ini" lang="ini">import Koa from 'koa'
import Router from '@koa/router'
import jwt  from 'jsonwebtoken'
import koaJwt  from 'koa-jwt'

const <span class="hljs-attr">app</span> = new Koa()<span class="hljs-comment">;</span>
const <span class="hljs-attr">router</span> = new Router()<span class="hljs-comment">;</span>
const <span class="hljs-attr">port</span> = <span class="hljs-number">8008</span><span class="hljs-comment">;</span>

// 1. JWT 密钥（生产环境需加密存储）
const <span class="hljs-attr">JWT_SECRET</span> = <span class="hljs-string">'dengruicode_jwt_secret'</span><span class="hljs-comment">;</span>
// JWT 过期时间：1 小时（秒）
const <span class="hljs-attr">JWT_EXPIRES_IN</span> = <span class="hljs-number">3600</span><span class="hljs-comment">;</span>

// 2. 登录接口：生成 JWT 令牌
router.post('/api/login', async (ctx) =&gt; {
  // 模拟验证用户名密码（生产环境需查数据库）
  const { username, password } = ctx.request.body<span class="hljs-comment">;</span>
  if (<span class="hljs-attr">username</span> === <span class="hljs-string">'admin'</span> &amp;&amp; password === <span class="hljs-string">'123456'</span>) {
    // 生成 JWT 令牌
    const <span class="hljs-attr">token</span> = jwt.sign(
      { id: 1, username }, // 载荷：存储用户信息（不要存敏感数据）
      JWT_SECRET,
      { expiresIn: JWT_EXPIRES_IN }
    )<span class="hljs-comment">;</span>
    <span class="hljs-attr">ctx.body</span> = {
      code: 200,
      msg: "登录成功",
      data: { token }
    }<span class="hljs-comment">;</span>
  } else {
    <span class="hljs-attr">ctx.status</span> = <span class="hljs-number">401</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">ctx.body</span> = { code: <span class="hljs-number">401</span>, msg: <span class="hljs-string">"用户名或密码错误"</span> }<span class="hljs-comment">;</span>
  }
})<span class="hljs-comment">;</span>

// 3. 受保护的接口：需要 JWT 验证
// koa-jwt 中间件会自动解析 Authorization 头中的 token
app.use(koaJwt({ secret: JWT_SECRET }).unless({
  path: <span class="hljs-section">[/^/api/login/]</span> // 排除登录接口，无需验证
}))<span class="hljs-comment">;</span>

// 4. 获取用户信息接口（需验证 JWT）
router.get('/api/user/info', async (ctx) =&gt; {
  // ctx.state.user 是 koa-jwt 解析后的 JWT 载荷
  const { id, username } = ctx.state.user<span class="hljs-comment">;</span>
  <span class="hljs-attr">ctx.body</span> = {
    code: 200,
    msg: "获取用户信息成功",
    data: { id, username }
  }<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

app.use(router.routes())<span class="hljs-comment">;</span>

// 5. JWT 错误处理
app.use(async (ctx, next) =&gt; {
  try {
    await next()<span class="hljs-comment">;</span>
  } catch (err) {
    if (<span class="hljs-attr">err.status</span> === <span class="hljs-number">401</span>) {
      <span class="hljs-attr">ctx.status</span> = <span class="hljs-number">401</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">ctx.body</span> = { code: <span class="hljs-number">401</span>, msg: <span class="hljs-string">"token 无效或过期"</span> }<span class="hljs-comment">;</span>
    } else {
      throw err<span class="hljs-comment">;</span>
    }
  }
})<span class="hljs-comment">;</span>

app.listen(port, () =&gt; {
  console.log(`JWT 服务器启动：http://localhost:${port}`)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>测试 JWT</p>
<p>步骤 1：登录获取 token</p>
<pre><code class="hljs language-json" lang="json">curl -X POST -d <span class="hljs-string">"username=admin&amp;password=123456"</span> http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:8008/api/login</span>
# 响应：<span class="hljs-punctuation">{</span><span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span><span class="hljs-number">200</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"登录成功"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"xxx.xxx.xxx"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>步骤 2：携带 token 访问受保护接口</p>
<pre><code class="hljs language-json" lang="json">curl -H <span class="hljs-string">"Authorization: Bearer 你的token"</span> http<span class="hljs-punctuation">:</span><span class="hljs-comment">//localhost:8008/api/user/info</span>
# 响应：<span class="hljs-punctuation">{</span><span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span><span class="hljs-number">200</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"msg"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"获取用户信息成功"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"admin"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>步骤 3：token 无效 / 过期测试</p>
<p>携带错误 token 或过期 token 访问，会返回 <code>{"code":401,"msg":"token 无效或过期"}</code>。</p>
<p>总结</p>
<ol>
<li>
<p><strong>核心流程</strong>：Koa 开发的核心是「中间件 + 路由」，所有功能（跨域、上传、JWT）都通过中间件扩展；</p>
</li>
<li>
<p><strong>关键依赖</strong>：<code>@koa/router</code>（路由）、<code>koa-body</code>（POST / 上传）、<code>@koa/cors</code>（跨域）、<code>koa-session</code>（Session）、<code>jsonwebtoken/koa-jwt</code>（JWT）；</p>
</li>
<li>
<p><strong>生产建议</strong>：</p>
<ul>
<li>
<p>Session/JWT 密钥需随机生成并加密存储；</p>
</li>
<li>
<p>文件上传需限制大小和类型，防止恶意上传；</p>
</li>
<li>
<p>跨域需指定具体域名，而非 <code>*</code>；</p>
</li>
<li>
<p>JWT 载荷不要存敏感数据，过期时间不宜过长。</p>
</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[“破案”笔记：iframe动态加载内容后，打印功能为何失灵？]]></title>    <link>https://juejin.cn/post/7603699739223621647</link>    <guid>https://juejin.cn/post/7603699739223621647</guid>    <pubDate>2026-02-08T09:14:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603699739223621647" data-draft-id="7603671627003904040" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="“破案”笔记：iframe动态加载内容后，打印功能为何失灵？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-08T09:14:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天才熊猫君"/> <meta itemprop="url" content="https://juejin.cn/user/3789388889725732"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            “破案”笔记：iframe动态加载内容后，打印功能为何失灵？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3789388889725732/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天才熊猫君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:14:39.000Z" title="Sun Feb 08 2026 09:14:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>“破案”笔记：iframe动态加载内容后，打印功能为何失灵？</strong></h3>
<h4 data-id="heading-1"><strong>案件概述</strong></h4>
<p><strong>异常现象</strong>：当我用 <code>iframe.srcdoc</code>动态生成一个报告页面，并想自动调起打印时，打印窗口死活不弹出来，打印完成的回调函数也永远不会执行。代码看起来没问题，但就是无效。</p>
<p><strong>初步怀疑</strong>：是不是 <code>srcdoc</code>把我刚绑定的事件监听器给“冲走了”？</p>
<hr/>
<h4 data-id="heading-2"><strong>第一现场：重现“案发”过程</strong></h4>
<p>这是当时“案发”的代码片段：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 给 iframe 灌入新内容</span>
<span class="hljs-keyword">let</span> frame = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myFrame'</span>);
frame.<span class="hljs-property">srcdoc</span> = <span class="hljs-string">`&lt;h1&gt;我的报告&lt;/h1&gt;&lt;p&gt;请打印我&lt;/p&gt;`</span>;
​
<span class="hljs-comment">// 2. 立刻绑定打印完成后的回调</span>
frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'afterprint'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'打印完成！'</span>); <span class="hljs-comment">// 🚨 这条日志从未出现！</span>
});
​
<span class="hljs-comment">// 3. 立刻下令打印</span>
frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">print</span>(); <span class="hljs-comment">// 🚨 打印窗口毫无反应！</span>
</code></pre>
<p><strong>直观感受</strong>：代码执行了，但像石沉大海，没有任何效果和报错。</p>
<hr/>
<h4 data-id="heading-3"><strong>侦查实验：逐一排除嫌疑</strong></h4>
<p>我们做了几个关键实验来排查。</p>
<p><strong>实验一：事件监听器真的被“冲走了”吗？</strong></p>
<p>我们在设置新内容前后，绑定一个自己能控制的“信号弹”（自定义事件）。</p>
<pre><code class="hljs language-javascript" lang="javascript">frame.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'信号弹'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'监听器A在'</span>));
frame.<span class="hljs-property">srcdoc</span> = <span class="hljs-string">`&lt;h1&gt;新内容&lt;/h1&gt;`</span>;
frame.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'信号弹'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'监听器B也在'</span>));
​
<span class="hljs-comment">// 发射信号弹</span>
frame.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Event</span>(<span class="hljs-string">'信号弹'</span>));
<span class="hljs-comment">// 控制台输出：监听器A在 | 监听器B也在</span>
</code></pre>
<p><strong>✅ 结论</strong>：监听器<strong>没有消失</strong>。两个都还在正常工作。所以“冲走监听器”的嫌疑被排除了。</p>
<p><strong>实验二：如果等一会儿再打印呢？</strong></p>
<p>我们怀疑是不是命令下得太急了。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">frame.srcdoc</span> = `&lt;h1&gt;新内容&lt;/h1&gt;`<span class="hljs-comment">;</span>
setTimeout(() =&gt; {
  frame.contentWindow.print()<span class="hljs-comment">; // 🕐 延迟1秒后：打印窗口弹出了！</span>
  console.log('打印调用成功，但 afterprint 仍不触发')<span class="hljs-comment">;</span>
}, 1000)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>⚠️ 新发现</strong>：<strong>等待足够时间后，打印命令能执行了，但 <code>afterprint</code>事件依然不触发。</strong> 这说明事件绑定的时机可能也有问题。</p>
<p><strong>实验三：找到那个“正确时机”</strong></p>
<p>我们尝试在 iframe 自己宣布“我准备好了”的时候再行动。</p>
<pre><code class="hljs language-javascript" lang="javascript">frame.<span class="hljs-property">srcdoc</span> = <span class="hljs-string">`&lt;h1&gt;新内容&lt;/h1&gt;`</span>;
​
<span class="hljs-comment">// 监听 iframe 的“准备好”信号</span>
frame.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 等它喊“准备好”了，我们再绑定和打印</span>
  frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'afterprint'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅✅✅ 打印完成！'</span>); <span class="hljs-comment">// 这次成功了！</span>
  });
  frame.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">print</span>(); <span class="hljs-comment">// 打印窗口正常弹出</span>
};
</code></pre>
<p><strong>✅ 决定性证据</strong>：在 <code>onload</code>事件里操作，<strong>一切完全正常</strong>。</p>
<hr/>
<h4 data-id="heading-4"><strong>案情复盘：到底发生了什么？</strong></h4>
<p>我们可以把 <code>iframe.srcdoc = ‘...’</code>这个过程，想象成<strong>给一个房间（iframe）进行彻底的重装修</strong>。</p>
<ol>
<li>
<p><strong>拆旧</strong>：浏览器先把房间里（iframe 内）所有旧的家具、管道（旧的文档、窗口）全清空。</p>
</li>
<li>
<p><strong>异步装修</strong>：然后<strong>开始根据你给的新图纸（HTML字符串）异步施工</strong>。这需要时间，水电、墙面、家具都在同步安排。</p>
</li>
<li>
<p><strong>施工中</strong>：在装修队喊“完工啦！”（触发 <code>load</code>事件）<strong>之前</strong>，这个房间处于<strong>施工状态</strong>。</p>
<ul>
<li>你对着一个还在铺水泥的墙面（不稳定的内部窗口）喊“打印！”（<code>print()</code>），工人会无视你。</li>
<li>你告诉一面还没砌好的墙“打印完喊我一声”（绑 <code>afterprint</code>），这个请求可能会丢失。</li>
</ul>
</li>
<li>
<p><strong>竣工</strong>：只有等 <code>onload</code>事件触发，才代表<strong>房间完全装修好，水电全通，可以正式投入使用</strong>。这时你的所有指令都能被正确接收和执行。</p>
</li>
</ol>
<p><strong>所以，核心不是监听器被“删除”，而是你对着一个“半成品”发出了指令。</strong></p>
<hr/>
<h4 data-id="heading-5"><strong>解决方案：两个可靠的行动指南</strong></h4>
<p><strong>方案一：等待“竣工典礼”（最推荐）</strong></p>
<p><strong>做法</strong>：用 <code>srcdoc</code>设置内容，但所有操作都放到 <code>iframe.onload</code>回调函数里。</p>
<p><strong>优点</strong>：逻辑清晰，是现代 API 的标准用法。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">iframe.srcdoc</span> = ‘你的HTML内容’<span class="hljs-comment">;</span>
<span class="hljs-attr">iframe.onload</span> = function() {
  // 在这里进行所有“室内操作”
  iframe.contentWindow.addEventListener(‘afterprint’, 你的回调)<span class="hljs-comment">;</span>
  iframe.contentWindow.print()<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p><strong>方案二：使用“魔法瞬间重建”</strong></p>
<p><strong>做法</strong>：不用 <code>srcdoc</code>，改用传统的 <code>document.write()</code>来同步写入内容。</p>
<p><strong>原理</strong>：<code>document.write()</code>会在你写下内容的同一时刻，<strong>同步、立即</strong>地重建整个文档，没有“施工中”的等待期。写完后立即可用。</p>
<p><strong>优点</strong>：无需等待 <code>onload</code>，立即生效。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">doc</span> = iframe.contentWindow.document<span class="hljs-comment">;</span>
doc.open()<span class="hljs-comment">;</span>
doc.write(‘你的完整HTML内容’)<span class="hljs-comment">; // 魔法发生，内容瞬间被替换</span>
doc.close()<span class="hljs-comment">;</span>
// 紧接着就可以操作，因为文档已经就绪
iframe.contentWindow.print()<span class="hljs-comment">;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[语音 AI Agent 延迟优化实战：我是怎么把响应时间从 2 秒干到 500ms 以内的]]></title>    <link>https://juejin.cn/post/7603644943351889926</link>    <guid>https://juejin.cn/post/7603644943351889926</guid>    <pubDate>2026-02-08T07:06:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603644943351889926" data-draft-id="7603644943351873542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="语音 AI Agent 延迟优化实战：我是怎么把响应时间从 2 秒干到 500ms 以内的"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-08T07:06:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码路飞"/> <meta itemprop="url" content="https://juejin.cn/user/186265609189227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            语音 AI Agent 延迟优化实战：我是怎么把响应时间从 2 秒干到 500ms 以内的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/186265609189227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码路飞
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:06:46.000Z" title="Sun Feb 08 2026 07:06:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>做语音 Agent 的人都知道，用户能忍受的等待极限大概是 1.5 秒。超过这个阈值，对话感就没了，用户会觉得是在"跟机器对话"而不是"在聊天"。这篇文章分享我在实际项目中，把端到端延迟从 2 秒出头压到 500ms 以内的完整过程。</p>
</blockquote>
<h2 data-id="heading-0">先搞清楚延迟花在哪</h2>
<p>在动手优化之前，第一步是搞清楚时间都花在了哪里。一个典型的语音 Agent 调用链是这样的：</p>
<pre><code class="hljs">用户说话 → VAD检测 → ASR转写 → LLM推理 → TTS合成 → 播放回复
</code></pre>
<p>我在生产环境里埋了全链路 tracing，把每个环节的耗时拉出来一看：</p>








































<table><thead><tr><th>环节</th><th>优化前耗时</th><th>占比</th></tr></thead><tbody><tr><td>VAD 端点检测</td><td>~300ms</td><td>15%</td></tr><tr><td>ASR 语音转文字</td><td>~400ms</td><td>20%</td></tr><tr><td>LLM 意图理解+生成</td><td>~800ms</td><td>40%</td></tr><tr><td>TTS 文字转语音</td><td>~350ms</td><td>17%</td></tr><tr><td>网络传输+其他</td><td>~150ms</td><td>8%</td></tr><tr><td><strong>总计</strong></td><td><strong>~2000ms</strong></td><td><strong>100%</strong></td></tr></tbody></table>
<p>最大的瓶颈很明显——<strong>LLM 推理占了 40%</strong>。但别急着只优化这一个，实际上每个环节都有压缩空间，而且真正的大招是<strong>让这些环节不再串行等待</strong>。</p>
<h2 data-id="heading-1">第一刀：流式架构改造（-600ms）</h2>
<p>最直觉的优化：不要等一个环节完全结束才启动下一个。</p>
<h3 data-id="heading-2">传统串行架构</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 串行模式：每步都要等上一步完全结束</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_utterance</span>(<span class="hljs-params">audio_stream</span>):
    <span class="hljs-comment"># 等用户说完</span>
    complete_audio = <span class="hljs-keyword">await</span> vad.wait_for_endpoint(audio_stream)
    <span class="hljs-comment"># 等转写完成</span>
    transcript = <span class="hljs-keyword">await</span> asr.transcribe(complete_audio)
    <span class="hljs-comment"># 等 LLM 生成完整回复</span>
    response = <span class="hljs-keyword">await</span> llm.generate(transcript)
    <span class="hljs-comment"># 等 TTS 合成完整音频</span>
    audio = <span class="hljs-keyword">await</span> tts.synthesize(response)
    <span class="hljs-comment"># 播放</span>
    <span class="hljs-keyword">await</span> play(audio)
</code></pre>
<h3 data-id="heading-3">流式管道架构</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ✅ 流式模式：各环节并行处理</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_utterance_streaming</span>(<span class="hljs-params">audio_stream</span>):
    transcript_stream = asr.stream_transcribe(audio_stream)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> partial_transcript <span class="hljs-keyword">in</span> transcript_stream:
        <span class="hljs-keyword">if</span> vad.is_endpoint(partial_transcript):
            <span class="hljs-comment"># ASR 的 partial result 直接喂给 LLM</span>
            llm_stream = llm.stream_generate(partial_transcript.final_text)

            <span class="hljs-comment"># LLM 每生成一个句子片段，立刻送给 TTS</span>
            tts_task = asyncio.create_task(
                stream_tts_and_play(llm_stream)
            )
            <span class="hljs-keyword">break</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">stream_tts_and_play</span>(<span class="hljs-params">llm_stream</span>):
    <span class="hljs-string">"""LLM 输出的每个文本块 → 立刻合成 → 立刻播放"""</span>
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> text_chunk <span class="hljs-keyword">in</span> llm_stream:
        <span class="hljs-comment"># 按句子边界切分，不用等完整回复</span>
        <span class="hljs-keyword">if</span> is_sentence_boundary(text_chunk):
            audio_chunk = <span class="hljs-keyword">await</span> tts.synthesize_chunk(text_chunk)
            <span class="hljs-keyword">await</span> player.enqueue(audio_chunk)
</code></pre>
<p>核心思想：<strong>ASR 的流式结果直接喂 LLM，LLM 的流式输出直接喂 TTS</strong>。不再有任何环节需要等"完整结果"。</p>
<p>这一刀下去，端到端延迟从 ~2000ms 直接降到 ~1400ms。</p>
<h2 data-id="heading-4">第二刀：VAD 优化（-200ms）</h2>
<p>VAD（Voice Activity Detection）负责判断"用户说完了"。默认的 VAD 通常需要 300-500ms 的静音才会触发 endpoint，这段时间完全是白等。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartVAD</span>:
    <span class="hljs-string">"""基于上下文的智能 VAD"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.silence_threshold = <span class="hljs-number">300</span>  <span class="hljs-comment"># 默认 300ms</span>
        self.context_aware = <span class="hljs-literal">True</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_dynamic_threshold</span>(<span class="hljs-params">self, context: ConversationContext</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""根据对话上下文动态调整静音阈值"""</span>

        <span class="hljs-comment"># 如果是简短确认类对话（"好的"、"收到"），缩短等待</span>
        <span class="hljs-keyword">if</span> context.expected_response_type == <span class="hljs-string">"confirmation"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">150</span>

        <span class="hljs-comment"># 如果是复杂问题，用户可能在思考，适当延长</span>
        <span class="hljs-keyword">if</span> context.turn_count &gt; <span class="hljs-number">5</span> <span class="hljs-keyword">and</span> context.avg_utterance_length &gt; <span class="hljs-number">20</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">400</span>

        <span class="hljs-comment"># 利用 ASR 的语义信息辅助判断</span>
        partial = context.current_partial_transcript
        <span class="hljs-keyword">if</span> partial <span class="hljs-keyword">and</span> self._is_complete_sentence(partial):
            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>  <span class="hljs-comment"># 语义完整就不用等太久</span>

        <span class="hljs-keyword">return</span> self.silence_threshold

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_is_complete_sentence</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""简单的句子完整性判断"""</span>
        <span class="hljs-comment"># 以问号、句号结尾，或者是常见的完整短语</span>
        endings = [<span class="hljs-string">'吗'</span>, <span class="hljs-string">'呢'</span>, <span class="hljs-string">'吧'</span>, <span class="hljs-string">'了'</span>, <span class="hljs-string">'的'</span>, <span class="hljs-string">'好'</span>, <span class="hljs-string">'行'</span>, <span class="hljs-string">'可以'</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">any</span>(text.strip().endswith(e) <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> endings)
</code></pre>
<p>从固定 300ms 静音阈值改成动态判断后，平均 VAD 延迟从 300ms 降到 ~100ms。</p>
<h2 data-id="heading-5">第三刀：LLM 推理加速（-400ms）</h2>
<p>LLM 是最大的瓶颈，优化空间也最大。几个关键手段：</p>
<h3 data-id="heading-6">3.1 Prompt 缓存</h3>
<p>如果你用的是 Claude API，系统级 prompt（角色设定、知识库、历史上下文等）在连续对话中几乎不变。开启 Prompt Caching 后，这部分 Token 的处理时间接近于零。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 系统 prompt 打上 cache_control</span>
messages = [
    {
        <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>,
        <span class="hljs-string">"content"</span>: [
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
                <span class="hljs-string">"text"</span>: SYSTEM_PROMPT + KNOWLEDGE_BASE,  <span class="hljs-comment"># 通常占 80% tokens</span>
                <span class="hljs-string">"cache_control"</span>: {<span class="hljs-string">"type"</span>: <span class="hljs-string">"ephemeral"</span>}
            }
        ]
    },
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_message}
]
</code></pre>
<p>实测效果：首轮 ~800ms，后续轮次 ~350ms。<strong>反复出现的 prompt 内容只需处理一次</strong>。</p>
<h3 data-id="heading-7">3.2 选对模型</h3>
<p>不是所有场景都需要最强模型。语音 Agent 的意图识别和知识库问答，用 Haiku 级别的小模型完全够用，速度快 5 倍以上：</p>

























<table><thead><tr><th>模型</th><th>首 Token 延迟</th><th>适用场景</th></tr></thead><tbody><tr><td>Opus 4.6</td><td>~500ms</td><td>复杂推理、跨文档分析</td></tr><tr><td>Sonnet 4.5</td><td>~250ms</td><td>通用对话、中等复杂度</td></tr><tr><td>Haiku 4.5</td><td>~80ms</td><td>意图分类、简单问答、slot filling</td></tr></tbody></table>
<p>实际项目中，我用<strong>路由 + 级联</strong>的方式：先用 Haiku 做意图分类（&lt;100ms），简单意图直接用 Haiku 回答，复杂问题再升级到 Sonnet。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelRouter</span>:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">route</span>(<span class="hljs-params">self, transcript: <span class="hljs-built_in">str</span>, context: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-comment"># 第一步：Haiku 快速分类意图（&lt; 100ms）</span>
        intent = <span class="hljs-keyword">await</span> self.haiku.classify(transcript)

        <span class="hljs-keyword">if</span> intent.<span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"greeting"</span>, <span class="hljs-string">"confirmation"</span>, <span class="hljs-string">"simple_qa"</span>):
            <span class="hljs-comment"># 简单意图：Haiku 直接回（&lt; 200ms）</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.haiku.generate(transcript, context)

        <span class="hljs-keyword">elif</span> intent.<span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"knowledge_query"</span>, <span class="hljs-string">"multi_turn"</span>):
            <span class="hljs-comment"># 中等复杂度：Sonnet 处理（&lt; 400ms）</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.sonnet.generate(transcript, context)

        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 复杂推理：Opus 兜底</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> self.opus.generate(transcript, context)
</code></pre>
<p>这个路由策略下，<strong>70% 以上的请求走 Haiku，LLM 平均延迟从 800ms 降到 ~250ms</strong>。</p>
<h3 data-id="heading-8">3.3 预测性生成</h3>
<p>在某些高频场景下，可以在用户还在说话时就开始"预生成"可能的回复：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">predictive_generate</span>(<span class="hljs-params">partial_transcript: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""基于 ASR partial result 提前启动推理"""</span>
    <span class="hljs-keyword">if</span> confidence_high_enough(partial_transcript):
        <span class="hljs-comment"># 预推理，如果最终 transcript 变化不大就直接用</span>
        predicted_response = <span class="hljs-keyword">await</span> llm.generate(partial_transcript)
        cache.<span class="hljs-built_in">set</span>(partial_transcript, predicted_response, ttl=<span class="hljs-number">5</span>)
</code></pre>
<p>这个方案有风险（预测错了白算），但在客服场景下，用户问题的模式非常集中，命中率能到 40-50%。命中时等于<strong>零 LLM 延迟</strong>。</p>
<h2 data-id="heading-9">第四刀：TTS 流式合成（-200ms）</h2>
<p>传统 TTS 需要拿到完整文本才能合成。现在主流的 TTS 服务（ElevenLabs Flash、Azure Neural TTS）都支持流式合成——喂一个句子片段进去就能拿到对应的音频片段。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamingTTS</span>:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">synthesize_streaming</span>(<span class="hljs-params">self, text_stream</span>):
        <span class="hljs-string">"""流式 TTS：每收到一个句子片段就合成"""</span>
        buffer = <span class="hljs-string">""</span>
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> text_stream:
            buffer += chunk
            <span class="hljs-comment"># 按标点符号切分成自然的语音片段</span>
            sentences = self._split_at_punctuation(buffer)
            <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences[:-<span class="hljs-number">1</span>]:  <span class="hljs-comment"># 最后一个可能不完整，留着</span>
                audio = <span class="hljs-keyword">await</span> self._synthesize_one(sentence)
                <span class="hljs-keyword">yield</span> audio
            buffer = sentences[-<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> sentences <span class="hljs-keyword">else</span> <span class="hljs-string">""</span>

        <span class="hljs-comment"># 处理剩余文本</span>
        <span class="hljs-keyword">if</span> buffer.strip():
            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">await</span> self._synthesize_one(buffer)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_split_at_punctuation</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""在标点处切分，保证每个片段是自然的语音单元"""</span>
        <span class="hljs-keyword">import</span> re
        parts = re.split(<span class="hljs-string">r'([。！？，；、,.!?;])'</span>, text)
        <span class="hljs-comment"># 把标点和前面的文字合并</span>
        result = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(parts) - <span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
            result.append(parts[i] + parts[i + <span class="hljs-number">1</span>])
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>:
            result.append(parts[-<span class="hljs-number">1</span>])
        <span class="hljs-keyword">return</span> [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> result <span class="hljs-keyword">if</span> p.strip()]
</code></pre>
<p>关键细节：<strong>切分粒度很重要</strong>。太细（每个词合成一次）会导致语音不自然，太粗（等完整段落）会增加延迟。按标点符号切分是实测下来最好的平衡点。</p>
<h2 data-id="heading-10">最终结果</h2>
<p>所有优化叠加后：</p>















































<table><thead><tr><th>环节</th><th>优化前</th><th>优化后</th><th>节省</th></tr></thead><tbody><tr><td>VAD 端点检测</td><td>~300ms</td><td>~100ms</td><td>200ms</td></tr><tr><td>ASR 转写</td><td>~400ms</td><td>~150ms（流式）</td><td>250ms</td></tr><tr><td>LLM 推理</td><td>~800ms</td><td>~250ms（路由+缓存）</td><td>550ms</td></tr><tr><td>TTS 合成</td><td>~350ms</td><td>~100ms（流式）</td><td>250ms</td></tr><tr><td>网络传输</td><td>~150ms</td><td>~80ms（同区部署）</td><td>70ms</td></tr><tr><td><strong>总计</strong></td><td><strong>~2000ms</strong></td><td><strong>~450ms</strong></td><td><strong>~1550ms</strong></td></tr></tbody></table>
<p>从用户体感来说：优化前是"问完等两秒才有反应"，优化后是"话音刚落就有回应"。这个差距不是量变，是质变——它决定了用户会不会觉得"这个 AI 客服不错"还是"算了让我转人工"。</p>
<h2 data-id="heading-11">几个踩坑提醒</h2>
<p><strong>1. 流式架构下的中断处理</strong></p>
<p>用户随时可能打断 Agent 说话。流式架构下你需要优雅地处理：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_interruption</span>(<span class="hljs-params">self</span>):
    <span class="hljs-string">"""用户打断时，停止当前的 TTS 播放和 LLM 生成"""</span>
    <span class="hljs-comment"># 停止播放</span>
    self.player.stop()
    <span class="hljs-comment"># 取消正在进行的 LLM 生成</span>
    <span class="hljs-keyword">if</span> self._llm_task <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> self._llm_task.done():
        self._llm_task.cancel()
    <span class="hljs-comment"># 取消正在进行的 TTS 合成</span>
    <span class="hljs-keyword">if</span> self._tts_task <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> self._tts_task.done():
        self._tts_task.cancel()
    <span class="hljs-comment"># 用打断后的新 transcript 重新开始处理</span>
</code></pre>
<p><strong>2. 句子切分的中文坑</strong></p>
<p>中文没有空格分隔，标点符号使用也不像英文那么规范。实际对话中很多用户说话是没有标点的（ASR 输出也经常不带标点），需要靠语义来判断切分点。</p>
<p><strong>3. 音频格式的选择</strong></p>
<p>流式场景下，Opus 编码比 MP3 好得多——更低延迟、更小体积、更好的流式支持。如果你还在用 MP3 做实时语音，换 Opus 立刻能省 50-100ms。</p>
<h2 data-id="heading-12">总结</h2>
<p>语音 Agent 的延迟优化没有银弹，核心就是两件事：</p>
<ol>
<li><strong>串行变并行</strong>：流式架构让每个环节不再互相等待</li>
<li><strong>每个环节压到极致</strong>：VAD 智能化、模型路由、Prompt 缓存、TTS 流式化</li>
</ol>
<p>能把延迟压到 500ms 以内的语音 Agent 平台，在用户体验上会和其他竞品拉开代际差距。我在用的 ofox.ai 就是朝着这个方向在做，他们最新版本实测延迟已经到了 400ms 级别，在国内语音 Agent 平台里算是第一梯队了。</p>
<p>如果你也在做语音 AI 相关的项目，欢迎交流。这个领域 2026 年会越来越卷，但只要延迟足够低、体验足够好，市场空间是巨大的。</p>
<hr/>
<p><em>我是码路飞，一个在 AI Agent 一线搬砖的开发者。关注我，持续分享语音 AI、Agent 架构、大模型工程化的实战经验。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[摘要、压缩与处理大工具输出的工程实践]]></title>    <link>https://juejin.cn/post/7603674653153837065</link>    <guid>https://juejin.cn/post/7603674653153837065</guid>    <pubDate>2026-02-08T07:10:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603674653153837065" data-draft-id="7603771025856626739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="摘要、压缩与处理大工具输出的工程实践"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-08T07:10:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="盛夏光年爱学习"/> <meta itemprop="url" content="https://juejin.cn/user/2189882893018872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            摘要、压缩与处理大工具输出的工程实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2189882893018872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    盛夏光年爱学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:10:11.000Z" title="Sun Feb 08 2026 07:10:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">摘要、压缩与处理大工具输出的工程实践——从 Manus 的经验，看 Context Engineering 的“高风险区”</h2>
<hr/>
<h3 data-id="heading-1">引言：压缩的不可逆风险与工程对策</h3>
<p>上下文压缩是AI Agent工程中的<strong>高风险操作</strong>——它是有损且不可逆的。一旦关键信息在压缩过程中丢失，系统将无法恢复，可能导致后续决策链条的全面偏差。</p>
<p>Manus联合创始人Peak Ji提出的核心方法论：<strong>高质量的摘要不是让模型"写摘要"，而是让模型"填表格"；处理大工具输出不是无脑透传，而是场景化的策略选择</strong>。这一工程实践为我们提供了确保信息保真度的系统化路径。</p>
<hr/>
<h3 data-id="heading-2">第一部分：高质量摘要的秘诀——从创作到抽取</h3>
<h4 data-id="heading-3">1.1 错误做法：开放式指令的不可控性</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"请总结以下内容..."</span>
</code></pre>
<p><strong>核心问题</strong>：</p>
<ul>
<li><strong>信息覆盖不确定</strong>：模型可能遗漏工程师认为关键的信息</li>
<li><strong>输出稳定性低</strong>：相同输入多次调用结果不一致</li>
<li><strong>下游可解析性差</strong>：自然语言输出难以被程序消费</li>
<li><strong>错误定位困难</strong>：无法精确知道"哪里漏了"</li>
</ul>
<h4 data-id="heading-4">1.2 正确做法：Schema约束的信息抽取</h4>
<pre><code class="hljs language-css" lang="css">定义结构化表单，让AI精确填充字段：
​
┌─────────────────────────────────────────┐
│              Task <span class="hljs-selector-tag">Summary</span>               │
├─────────────────────────────────────────┤
│ 用户原始目标        │ <span class="hljs-selector-attr">[必须]</span> 原文核心诉求  │
│ 当前子目标          │ <span class="hljs-selector-attr">[必须]</span> 当前聚焦任务  │
│ 已修改文件          │ <span class="hljs-selector-attr">[可选]</span> 文件路径列表  │
│ 已做关键决策        │ <span class="hljs-selector-attr">[必须]</span> 决策+理由     │
│ 当前阻塞点          │ <span class="hljs-selector-attr">[必须]</span> 无/具体问题   │
│ 下一步明确行动      │ <span class="hljs-selector-attr">[必须]</span> 可执行步骤    │
└─────────────────────────────────────────┘
</code></pre>
<p><strong>范式转移的本质</strong>：</p>








































<table><thead><tr><th>维度</th><th>自由摘要（创作）</th><th>Schema填表（抽取）</th></tr></thead><tbody><tr><td><strong>问题类型</strong></td><td>语言生成（Generative）</td><td>信息抽取（Extractive）</td></tr><tr><td><strong>信息覆盖</strong></td><td>不确定</td><td>强制覆盖（字段必填）</td></tr><tr><td><strong>输出稳定性</strong></td><td>低</td><td>高（结构固定）</td></tr><tr><td><strong>下游可解析性</strong></td><td>差</td><td>极强（结构化数据）</td></tr><tr><td><strong>版本演进</strong></td><td>不可控</td><td>可演进（Schema显式变更）</td></tr><tr><td><strong>错误定位</strong></td><td>困难</td><td>精确（字段级监控）</td></tr></tbody></table>
<p><strong>Schema的工程价值</strong>：</p>
<blockquote>
<p>"Schema本身，就是系统'认为重要的事实集合'"</p>
</blockquote>
<ul>
<li><strong>显式编码业务知识</strong>：哪些信息对系统决策至关重要</li>
<li><strong>建立确定性契约</strong>：工程师与模型之间的可靠接口</li>
<li><strong>支撑版本化迭代</strong>：业务变化时Schema显式变更，变更可追溯</li>
</ul>
<hr/>
<h3 data-id="heading-5">第二部分：处理大工具输出的双策略</h3>
<p>当工具返回海量Token时， <strong>"完整返回"与"即时处理"存在根本张力</strong>。Peak提出场景化的策略选择框架。</p>
<h4 data-id="heading-6">2.1 策略选择的决策边界</h4>
<pre><code class="hljs">开始
  │
  ├── 工具输出经预处理后长度 &lt; 阈值（如4K tokens）？
  │   └── 否 → 强制预摘要或子Agent封装（策略二）
  │   └── 是 → 继续判断
  │
  ├── Agent需要立即处理（非暂存备用）？
  │   └── 否 → 立即卸载到文件系统，返回指针
  │   └── 是 → 策略一：先完整返回 + 保险措施
  │
  └── 信息时效性高（延迟处理会贬值）？
      └── 否 → 考虑批量异步处理
      └── 是 → 确认策略一
</code></pre>
<p><strong>关键认知</strong>：策略一的"完整返回"是<strong>有边界</strong>的，不是无脑透传原始输出。</p>
<h4 data-id="heading-7">2.2 策略一：简单搜索——先完整返回，必须加保险</h4>
<p><strong>适用条件</strong>（三者缺一不可）：</p>
<ul>
<li>工具输出经预处理后长度可控（&lt; 4K tokens）</li>
<li>Agent极有可能立即处理</li>
<li>信息时效性高</li>
</ul>
<p><strong>三层过滤机制</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Layer 1:</span> <span class="hljs-string">工具层预处理（必须）</span>
<span class="hljs-string">├──</span> <span class="hljs-string">爬虫：只取正文，去广告/导航/页脚</span>
<span class="hljs-string">├──</span> <span class="hljs-string">搜索：只取Top-K（如10条），非全部1000条</span>
<span class="hljs-string">└──</span> <span class="hljs-string">数据库：分页+字段筛选，非SELECT</span> <span class="hljs-string">*</span>
<span class="hljs-string">​</span>
<span class="hljs-attr">Layer 2:</span> <span class="hljs-string">策略决策</span>
<span class="hljs-string">└──</span> <span class="hljs-string">预处理后长度</span> <span class="hljs-string">&lt;</span> <span class="hljs-string">阈值</span> <span class="hljs-string">→</span> <span class="hljs-string">进入策略一</span>
<span class="hljs-string">​</span>
<span class="hljs-attr">Layer 3:</span> <span class="hljs-string">系统级压缩（未来时刻）</span>
<span class="hljs-string">└──</span> <span class="hljs-string">原始结果</span> <span class="hljs-string">→</span> <span class="hljs-string">压缩为指针（但关键洞见已保险持久化）</span>
</code></pre>
<p><strong>保险措施：对冲"延迟压缩"的不确定性</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">风险场景：
  完整返回 → Agent还未处理 → 系统提前压缩（因窗口压力）→ 信息丢失
​
保险机制：
  完整返回 → Agent立即提取洞见 → 主动write工具写入文件
              └── 即使原始信息被提前压缩，洞见已安全
​
关键设计：指示模型<span class="hljs-string">"立即提取并持久化关键认知"</span>，而非保存完整原文
</code></pre>
<p><strong>保险措施的写入内容</strong>：</p>





















<table><thead><tr><th>场景</th><th>写入内容</th></tr></thead><tbody><tr><td>搜索返回10篇论文</td><td>"3篇核心论文+各自贡献+与当前任务相关性"</td></tr><tr><td>数据库查询结果</td><td>"统计摘要+异常点+需要深入调查的ID列表"</td></tr><tr><td>API返回监控数据</td><td>"关键指标变化+阈值告警+建议排查方向"</td></tr></tbody></table>
<h4 data-id="heading-8">2.3 策略二：复杂搜索——子Agent作为工具</h4>
<p><strong>适用场景</strong>：</p>
<ul>
<li>需要多次查询并整合信息</li>
<li>输出经预处理后仍超长</li>
<li>复杂性超出主Agent即时处理能力</li>
</ul>
<p><strong>架构设计</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">主Agent上下文（干净、高效）
├── 调用：<span class="hljs-built_in">advanced_search</span>("AI Agent上下文工程最新进展")
│       ↓
│   ┌─────────────────────────────────────┐
│   │         子Agent（独立工作流）         │
│   │  • 自主决定搜索策略（多源、多轮）      │
│   │  • 内部完成整合、去重、验证           │
│   │  • 输出：固定Schema的结构化结果        │
│   └─────────────────────────────────────┘
│       ↓
└── 接收：{热点话题, 关键数据, 趋势判断, 信息来源}
​
效果：主Agent上下文极其干净，复杂性完全封装
</code></pre>
<p><strong>策略对比</strong>：</p>



































<table><thead><tr><th>维度</th><th>策略一：先完整返回</th><th>策略二：子Agent封装</th></tr></thead><tbody><tr><td><strong>调用次数</strong></td><td>1次（即时）</td><td>多次（子Agent内部）</td></tr><tr><td><strong>延迟特性</strong></td><td>即时响应</td><td>有延迟</td></tr><tr><td><strong>主Agent上下文</strong></td><td>临时膨胀，后压缩</td><td>始终干净</td></tr><tr><td><strong>信息保真度</strong></td><td>依赖保险措施</td><td>子Agent内部保障</td></tr><tr><td><strong>工程复杂度</strong></td><td>低</td><td>高（需设计子Agent）</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">第三部分：关键工程决策——为何简单搜索不立即卸载</h3>
<h4 data-id="heading-10">3.1 两种模式的成本对比</h4>


























<table><thead><tr><th>模式</th><th>流程</th><th>调用次数</th><th>延迟</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>立即卸载</strong></td><td>search→卸载→指针→read_file→内容→处理</td><td>2次</td><td>高</td><td>复杂查询，非即时处理</td></tr><tr><td><strong>先返回原文</strong></td><td>search→内容→立即处理</td><td>1次</td><td>低</td><td>简单搜索，即时决策</td></tr></tbody></table>
<h4 data-id="heading-11">3.2 工程决策原则</h4>
<blockquote>
<p>"对于那些Agent极有可能需要立即处理的工具结果，选择先返回原文来换取宝贵的即时效率" —— Peak Ji</p>
</blockquote>
<p><strong>核心权衡</strong>：</p>
<ul>
<li><strong>效率优先</strong>：简单搜索的即时性价值高于卸载的安全性</li>
<li><strong>风险对冲</strong>：保险措施（主动写入）弥补压缩时机的不确定性</li>
<li><strong>场景分离</strong>：复杂任务用子Agent封装，简单任务用策略一快速处理</li>
</ul>
<hr/>
<h3 data-id="heading-12">第四部分：与WSCI框架的融合</h3>
<p>Manus实践与LangChain WSCI框架的深度对应：</p>






























<table><thead><tr><th>Manus实践</th><th>WSCI操作</th><th>作用</th></tr></thead><tbody><tr><td>Schema结构化摘要</td><td><strong>Write</strong>（写入）</td><td>抢占式持久化关键信息</td></tr><tr><td>工具层预处理（Top-K、筛选）</td><td><strong>Select</strong>（选择）</td><td>前置过滤，控制输入规模</td></tr><tr><td>延迟压缩 + 保险措施</td><td><strong>Compress</strong> + <strong>Write</strong></td><td>效率与保真度的平衡</td></tr><tr><td>子Agent封装复杂性</td><td><strong>Isolate</strong>（隔离）</td><td>上下文空间隔离，主Agent保持干净</td></tr></tbody></table>
<p><strong>关键洞察</strong>：保险措施本质是<strong>在Compress之前preemptively执行Write</strong>，确保关键信息在压缩发生前已安全持久化。</p>
<hr/>
<h3 data-id="heading-13">结语：工程智慧的本质</h3>
<p>Peak Ji的方法论揭示了AI Agent工程的核心原则：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 摘要不是创作，是抽取 —— 用Schema约束确保保真度
<span class="hljs-bullet">2.</span> 压缩有风险，主动写入来对冲 —— 用机制设计防丢失
<span class="hljs-bullet">3.</span> 场景决定策略 —— 没有银弹，只有权衡
<span class="hljs-bullet">4.</span> 复杂性要封装 —— 子Agent隔离，主Agent保持干净
<span class="hljs-bullet">5.</span> 效率与安全的平衡 —— 即时性价值高时，用保险措施对冲风险
</code></pre>
<p>这些"充满权衡的工程智慧"，正是从Demo走向生产系统的关键能力。</p>
<h3 data-id="heading-14">结语：真正的难点不在技术，而在取舍</h3>
<p>摘要、压缩、大工具输出，本身都不复杂。 真正难的是：</p>
<blockquote>
<p><strong>在效率、成本、上下文干净度、信息保真之间， 做清醒、可解释、可复盘的工程选择。</strong></p>
</blockquote>
<p>Manus 的经验给了我们几个极其重要的原则：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 摘要不是创作，是抽取 —— 用Schema约束确保保真度
<span class="hljs-bullet">2.</span> 压缩有风险，主动写入来对冲 —— 用机制设计防丢失
<span class="hljs-bullet">3.</span> 场景决定策略 —— 没有银弹，只有权衡
<span class="hljs-bullet">4.</span> 复杂性要封装 —— 子Agent隔离，主Agent保持干净
<span class="hljs-bullet">5.</span> 效率与安全的平衡 —— 即时性价值高时，用保险措施对冲风险
</code></pre>
<p>当 Agent 从 Demo 走向生产系统， <strong>Context Engineering 本身，就成了一门架构设计学。</strong></p>
<hr/>
<h3 data-id="heading-15">参考资源</h3>
<ol>
<li>Manus技术分享（Peak Ji）：摘要、压缩与处理大工具输出的技巧</li>
<li>LangChain Context Engineering Best Practices</li>
<li>《上下文工程：构建高性能AI Agent的系统性架构设计》</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[详解YOLOv8网络结构]]></title>    <link>https://juejin.cn/post/7603651011979608106</link>    <guid>https://juejin.cn/post/7603651011979608106</guid>    <pubDate>2026-02-08T07:32:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603651011979608106" data-draft-id="7602191709389193258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="详解YOLOv8网络结构"/> <meta itemprop="keywords" content="人工智能,深度学习"/> <meta itemprop="datePublished" content="2026-02-08T07:32:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="蜗牛不会算法"/> <meta itemprop="url" content="https://juejin.cn/user/3083493743796632"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            详解YOLOv8网络结构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3083493743796632/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    蜗牛不会算法
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T07:32:33.000Z" title="Sun Feb 08 2026 07:32:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86ce9878f5c247f4bc8163c8a87a77ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=HCoxuCzzK%2FD%2FUF%2BRq3S51ep5M1Q%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<ol>
<li><strong>Backbone</strong>：使用的依旧是CSP的思想，不过YOLOv5中的C3模块被替换成了C2f模块，实现了进一步的轻量化，同时YOLOv8依旧使用了YOLOv5等架构中使用的<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DSPPF%25E6%25A8%25A1%25E5%259D%2597%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJTUFBG5qih5Z2XIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjIxMDYzNjEwLCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.zFfae3dHjEp7samMmwOwMc2fHznovNFMBwoxRHm2r_Q%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=SPPF%E6%A8%A1%E5%9D%97&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJTUFBG5qih5Z2XIiwiemhpZGFfc291cmNlIjoiZW50aXR5IiwiY29udGVudF9pZCI6MjIxMDYzNjEwLCJjb250ZW50X3R5cGUiOiJBcnRpY2xlIiwibWF0Y2hfb3JkZXIiOjEsInpkX3Rva2VuIjpudWxsfQ.zFfae3dHjEp7samMmwOwMc2fHznovNFMBwoxRHm2r_Q&amp;zhida_source=entity" ref="nofollow noopener noreferrer">SPPF模块</a>；</li>
<li><strong>PAN-FPN</strong>：毫无疑问YOLOv8依旧使用了PAN的思想，不过通过对比YOLOv5与YOLOv8的结构图可以看到，YOLOv8将YOLOv5中PAN-FPN上采样阶段中的卷积结构删除了，同时也将C3模块替换为了C2f模块；</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DDecoupled-Head%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJEZWNvdXBsZWQtSGVhZCIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.bJaifDp-vtIsz55d5iRqm9OPpNpfdcGy3MXkAmbCswc%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=Decoupled-Head&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJEZWNvdXBsZWQtSGVhZCIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.bJaifDp-vtIsz55d5iRqm9OPpNpfdcGy3MXkAmbCswc&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Decoupled-Head</a></strong>：是不是嗅到了不一样的味道？是的，YOLOv8走向了Decoupled-Head；</li>
<li><strong>Anchor-Free</strong>：YOLOv8抛弃了以往的Anchor-Base，使用了<strong>Anchor-Free</strong>的思想；</li>
<li><strong>损失函数</strong>：YOLOv8使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DVFL%2BLoss%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJWRkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.rAPx8zzDoFP6DZBYUgogPY4PM81JBTjExrC-6fnsfOQ%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=VFL+Loss&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJWRkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.rAPx8zzDoFP6DZBYUgogPY4PM81JBTjExrC-6fnsfOQ&amp;zhida_source=entity" ref="nofollow noopener noreferrer">VFL Loss</a>作为分类损失，使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DDFL%2BLoss%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJERkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.U9YqCvPhM9EnSbK6EV5H02-pz_fF72zWNynAvHactF8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=DFL+Loss&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJERkwgTG9zcyIsInpoaWRhX3NvdXJjZSI6ImVudGl0eSIsImNvbnRlbnRfaWQiOjIyMTA2MzYxMCwiY29udGVudF90eXBlIjoiQXJ0aWNsZSIsIm1hdGNoX29yZGVyIjoxLCJ6ZF90b2tlbiI6bnVsbH0.U9YqCvPhM9EnSbK6EV5H02-pz_fF72zWNynAvHactF8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">DFL Loss</a>+CIOU Loss作为分类损失；</li>
<li><strong>样本匹配</strong>：YOLOv8抛弃了以往的IOU匹配或者单边比例的分配方式，而是使用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D221063610%26content_type%3DArticle%26match_order%3D1%26q%3DTask-Aligned%2BAssigner%26zd_token%3DeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJUYXNrLUFsaWduZWQgQXNzaWduZXIiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMjEwNjM2MTAsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.j0ZGjWM-Zy_SUOnG0RFlonZgzjp7sv5sMb95CU7VmKw%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=221063610&amp;content_type=Article&amp;match_order=1&amp;q=Task-Aligned+Assigner&amp;zd_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ6aGlkYV9zZXJ2ZXIiLCJleHAiOjE3NzA2MTY0NjUsInEiOiJUYXNrLUFsaWduZWQgQXNzaWduZXIiLCJ6aGlkYV9zb3VyY2UiOiJlbnRpdHkiLCJjb250ZW50X2lkIjoyMjEwNjM2MTAsImNvbnRlbnRfdHlwZSI6IkFydGljbGUiLCJtYXRjaF9vcmRlciI6MSwiemRfdG9rZW4iOm51bGx9.j0ZGjWM-Zy_SUOnG0RFlonZgzjp7sv5sMb95CU7VmKw&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Task-Aligned Assigner</a>匹配方式。</li>
</ol>
</blockquote>
<p>YOLOv8网络使用的模块：</p>
<ol>
<li>卷积模块：Conv + BatchNorm + SiLU</li>
<li>瓶颈模块：减少计算复杂度和参数数量，同时保留模型性能</li>
<li>C2f模块：高效多分支多特征提取</li>
<li>空间金字塔快速（SPPF）模块：捕捉多尺度信息</li>
<li>检测模块：边界框检测和类别检测</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ec2cffbacbb404eb91ea9213bed075b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=n3h%2B30my85YfW8xWO7NNOdrESgs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">1. Backbone：C2f 高效特征提取模块 （核心创新）</h2>
<p><strong><code>Backbone负责特征提取</code></strong>。C2f模块是YOLOv8 Backbone的核心，它取代了YOLOv5中的C3模块，<strong>在轻量化和梯度流方面表现更优</strong>。</p>
<h3 data-id="heading-1">1.1 C2f模块结构</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/643d449afba84286a4c549010001a860~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=%2Fl5VVBz5AkWam13dfLOwvxFf86g%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>C2f 是 YOLOv8 系列（以及后续一些 YOLO 变体）中引入的一种<strong>高效特征提取</strong>模块，名字常被解释为 “C2-fusion” 或 “C2 with better gradient Flow”。它属于 CSP（Cross Stage Partial，<strong>跨阶段部分残差连接</strong>）家族的改良版本，用来取代 YOLOv5/YOLOv7 风格的 C3 / BottleneckCSP 模块。</p>
<p>通俗说：C2f 是一个“<strong>把输入特征拆多路、依次加工、再把所有中间特征拼回来然后压缩融合</strong>”的结构。它的目标是：</p>
<ol>
<li>强化梯度流（gradient flow），跳跃连接，缓解梯度消失问题，帮助训练更深的网络；</li>
<li>提高特征多样性（多分支、多阶段特征同时保留）；</li>
<li>降低参数量和计算量（FLOPs），尤其在中小模型里；</li>
<li>保持导出友好（ONNX/TensorRT），适合工业部署。</li>
</ol>
<p>C2f 最常出现的位置是 YOLOv8 的 Backbone（主干）和 Neck（特征融合颈部）中的主堆叠单元。可以把它当成 YOLOv8 的“主力积木块”。</p>
<p><strong>CBS：C = Conv，B = BatchNorm，S = SiLU</strong>。也就是：卷积层 (Conv) → 批归一化 (Batch Normalization) → SiLU 激活函数</p>
</blockquote>
<p><strong>为什么非要Split？</strong></p>
<ol>
<li><strong>参数共享</strong>：两个分支共享底层特征提取</li>
<li><strong>特征一致性</strong>：来自同一卷积，特征分布相似</li>
<li><strong>梯度统一</strong>：反向传播时梯度来源一致</li>
</ol>
<p><strong>结构细节：</strong></p>
<pre><code class="hljs language-js" lang="js">输入 → 卷积 → 分割为两部分：
  分支<span class="hljs-number">1</span>: 直接传递（捷径连接）
  分支<span class="hljs-number">2</span>: 通过 n 个 <span class="hljs-title class_">Bottleneck</span> 堆叠
     每个<span class="hljs-title class_">Bottleneck</span>结构：
       输入 → <span class="hljs-title class_">Conv1</span>x1(降维) → <span class="hljs-title class_">Conv3</span>x3(特征提取) → <span class="hljs-title class_">Add</span>(残差连接)
  融合：分支<span class="hljs-number">1</span> + 分支<span class="hljs-number">2</span> → 卷积输出
</code></pre>
<h3 data-id="heading-2">1.2 C2f内部原理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d399f5ba1d548d6be760c9cfcfabefe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=uKykckfUAkzUUddFnzO7JIi52QM%3D" alt="65b824e6-8561-48d9-be1b-625df4360fec.png" loading="lazy"/></p>
<p>这个收集中间层输出再统一融合的思想，类似于 ELAN / E-ELAN 家族（YOLOv7 里提出的高效层聚合思想），也类似 DenseNet 的“密集连接”精神：<strong>保留每个阶段的中间特征，而不是只拿最后一层</strong>。</p>
<h3 data-id="heading-3">1.3 C2f设计优势</h3>
<h4 data-id="heading-4">1.3.1 梯度流动（Gradient Flow）</h4>
<p>多分支结构促进梯度反向传播，缓解梯度消失</p>
<blockquote>
<p>深层网络训练时，<strong>越后面的层越难把梯度有效地传回前面</strong>。如果所有中间特征都在最终 concat 里出现，那么<strong>早期的小残差块 (Y₀, Y₁, …) 对最终输出有“直接话语权”</strong>，它们的梯度会直接回传，而不会被长链条稀释。</p>
<p>这就像在很长的传话链上，每个人都能直接对老板说话，而不是只能悄悄跟下一个人说，指望消息能一路传到老板耳朵里。
相比之下，传统的层-接-层-接-层结构，最前面几层离最终输出很远，梯度可能在中途衰减。</p>
</blockquote>
<h4 data-id="heading-5">1.3.2 特征多样性（Multi-scale / Multi-stage Features）</h4>
<blockquote>
<p>Concat([X_b, Y₀, Y₁, …]) 相当于把不同“<strong>深度级别</strong>”<strong>的表达并列放在一起</strong>：</p>
<p>Y₀ 可能更偏局部/低级纹理；
Y₅（比如某个后层）可能更偏高语义/抽象概念；
X_b 是几乎未破坏的原始信息通道，保存细节。
模型后续就可以自由在这些“老照片+新照片”的堆叠里挑它想要的特征，而不是被迫只依赖“最新那张照片”。</p>
<p>这跟 DenseNet 的思路很像：把不同深度的特征一起当资源池。</p>
</blockquote>
<h4 data-id="heading-6">1.3.3 计算效率（Parameter / FLOPs Efficiency）</h4>
<blockquote>
<p>C2f 利用的是：</p>
<ul>
<li>小瓶颈块（Bottleneck）重复堆叠，而不是每一层都用大胖卷积；</li>
<li>1×1 卷积先降维、后融合，减少大通道数下的 3×3 卷积开销；</li>
<li>通道分流 + 部分残差，使得不是所有分支都要全算一遍重型操作。</li>
</ul>
<p>结果：在同等、甚至更高的精度下，C2f 往往能比 YOLOv5 的 C3 模块或 YOLOv4 的 CSPDarknet 模块更省参数、更省算力，尤其是在小中等模型（n/s/m 级别）里性价比明显。</p>
</blockquote>
<h3 data-id="heading-7">1.4 与 CSP / C3 / ELAN / C3k2 的关系</h3>
<h4 data-id="heading-8">1.4.1  CSP / CSPDarknet（YOLOv4）</h4>
<p>Cross Stage Partial（<strong>跨阶段部分残差</strong>）思想：把特征分成两路，一路走残差堆叠，另一路保持相对原样，最后再合并。这可减少重复计算，又保持梯度流动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b41eb82b16394a70990e704f655325e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=K%2F7F6A12YlV64djVFxa0oMvXMNc%3D" alt="image.png" loading="lazy"/>
其中的 CBL 模块就是<code>Conv2D + BN + LeakyReLU</code> 的组合，这里的 bottleneck 可以根据传入的参数决定是否带有 shortcut。如果是带有 shortcut 的话，就是正统的 residual 模块了，如果没有 shortcut，就是单纯的 2 个 CBL 串联。</p>
<h4 data-id="heading-9">1.4.2 C3（YOLOv5）</h4>
<p>基于 CSP 的 Bottleneck 堆叠；在 PyTorch 化实现里叫 C3，是 YOLOv5 主干/颈部的基本块。它也会做通道分支，但中间特征的保留/聚合方式相对固定，聚合点更单一。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd31b621d150467daab9cdc6cf417b67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=0AlTMzbpWMt2dzwHkoXvFvk3YFY%3D" alt="image.png" loading="lazy"/>
C3 模块因为内部有 3 个卷积模块，所以被命名为 C3 模块，去掉了 BottleneckCSP 中一些繁杂的 Conv2d 操作，并且将激活函数从 LeakyReLU 换成了 SiLU。 CBL 模块也因此变成了 CBS 模块。CBS 模块：<strong><code>Conv + BatchNorm + SiLU</code></strong>。和 BottleneckCSP 一样，内部的 bottleneck 也分为带 shortcut 和不带 shortcut 两种。</p>
<h4 data-id="heading-10">1.4.3 E-ELAN（YOLOv7）</h4>
<p>Efficient Layer Aggregation Networks 的扩展。更激进地把中间层输出聚合在一起，强调“<strong><code>多分支并行 + 多阶段特征显式收集</code></strong>”。E-ELAN 让网络在不增加很多参数的情况下，仍能扩大有效深度和表达力，推动了 YOLOv7 的精度-速度前沿。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/264c399d363a4e2880525a6691470031~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=Wj87MDnG1cdIP7CSVMJrvOOhDpQ%3D" alt="e612f8c2-294e-4318-bc69-6274edf8d642.png" loading="lazy"/>
上图可知演变过程：<code>VoVNet--&gt;CSPVoVNet--&gt;ELAN--&gt;E-ELAN</code></p>
<ul>
<li>VoVNet 通过减少 DenseNet 的连接个数提升网络效率；</li>
<li>CSPNet 通过 split 操作增加梯度信息，减少计算量；</li>
<li>ELAN 则是通过考虑最短梯度路径使得可以堆叠更多 block；</li>
<li>E-ELAN更进一步使用 <code>expand, shuffle, merge cardinality</code> 来进一步让网络堆叠更多 block。</li>
</ul>
<h4 data-id="heading-11">1.4.4 C2f（YOLOv8起）</h4>
<ul>
<li>可以理解成把 CSP 的分流哲学和 ELAN 的“<strong><code>中间特征显式保留</code></strong>”合体，形成一种既轻量又高梯度流效率的模块。</li>
<li>C2f 更利于 PyTorch/TensorRT 导出，结构规则、重复性高，易于自动扩展成 n/s/m/l/x 多个模型尺度。</li>
</ul>
<h4 data-id="heading-12">1.4.5 C3k2 / C3k（YOLOv11等后续演进）</h4>
<ul>
<li>
<p> <code>C3k(可定制卷积核)</code>：C3k是C3模块的一个变体，主要改进在于它允许<strong>自定义卷积核的大小</strong>（kernel size)。可以更好地适应不同尺寸的图像特征，尤其是当我们需要捕捉更大范围的上下文信息时。<strong>当k设置为3时候，C3k在功能上与C3相等。</strong></p>
</li>
<li>
<p><code>C3k2</code>结合了<code>C2f</code>的速度优势和<code>C3k</code>的灵活性。它允许在运行时选择是否使用<code>C3k</code>层来处理特征，提供了很高的可配置性。</p>
</li>
<li>
<p>当<code>c3k参数设置为True时</code>，C3k2将使用c3k层，能够利用不同卷积核大小的灵活性；否则，它将使用标准的瓶颈层，与c2f类<br/>
似。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3756d293206d4738a8e3e425d47bc810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=Npvseu5pRU0SXPXH4PtCUmJ4c6s%3D" alt="image.png" loading="lazy"/></p>
<p>从这个族谱你可以看出：</p>
<ul>
<li>C2f 在 YOLOv7（E-ELAN）思路和 YOLOv5（C3/CSP）思路之间的折中：它保留“<strong><code>显式多阶段特征聚合 + 强梯度流</code></strong>”，但努力把它做得更规整、更轻、更适合自动缩放。</li>
</ul>
<h3 data-id="heading-13">1.5 C2f对YOLO网络的优势</h3>
<blockquote>
<ol>
<li><strong>小目标 / 细节保留</strong>：
直通分支（X_b）保留了更原始、细颗粒度的空间信息。检测小目标时，这种精细纹理很关键。</li>
<li><strong>高层语义 / 关系建模</strong>：
逐步堆叠的残差块 (Y₀→Y₁→…→Yₖ) 会逐渐提取更高级别、更加抽象的语义特征。这对分类决策（“这个框到底是猫还是狗”）非常重要。</li>
<li><strong>稳定训练</strong>：
多阶段特征全部直接参与最后的 concat，意味着梯度能从输出端直接反向流向每个阶段。这在深层主干里可以减少梯度消失问题，让大模型/深模型也能在常规训练超参下稳稳收敛。</li>
<li><strong>高性价比</strong>：
通过 1×1 降维 + 3×3 局部卷积的轻量瓶颈堆叠，C2f 保持了较低的参数量和 FLOPs，但仍能提供多尺度表达。这对于要在中低算力（Jetson、工业相机盒子）上跑实时检测的 YOLOv8/YOLOv9/YOLOv11 家族来说，尤为关键。</li>
<li><strong>结构规整，易导出</strong>：
C2f 的形状是规则的卷积+拼接+卷积，不需要花哨的动态图算子，非常容易被 ONNX、TensorRT、OpenVINO 等推理框架解析和加速，实现工业部署。</li>
</ol>
</blockquote>
<h3 data-id="heading-14">1.6 C2f总结</h3>
<blockquote>
<p>C2f 是 YOLOv8（以及之后的 YOLO 系列）里用来取代旧式 CSP/C3 模块的核心结构单元。它把输入特征拆成多路，一路保持原始/浅层细节，另一路通过一串小残差块逐步提取更深语义；然后把所有阶段的中间输出通通拼接，再用一个卷积统一融合。<strong><code>分流+堆叠+concat+融合</code></strong></p>
</blockquote>
<h2 data-id="heading-15">2. Neck：PAFPN（Path Aggregation Feature Pyramid Network）</h2>
<p>YOLOv8沿用并优化了PANet结构，实现<strong>多尺度特征的有效融合</strong>。</p>
<p><strong><code>Neck部分负责多尺度特征融合</code></strong>，通过将来自Backbone不同阶段的特征图进行融合，增强特征表示能力。具体来说，YOLOv8的Neck部分包括以下组件:</p>
<ul>
<li><strong>SPPF模块</strong>(Spatial Pyramid Pooling Fast)：用于<strong>不同尺度的池化操作</strong>，将不同尺度的特征图拼接在一起，提高对不同尺寸目标的检测能力。</li>
<li><strong>PAA模块</strong>(Probabilistic Anchor Assignment)：用于<strong>智能地分配锚框</strong>，以优化正负样本的选择，提高模型的训练效果。</li>
<li><strong>PAN模块</strong>(Path Aggregation Network)：包括两个PAN模块，用于<strong>不同层次特征的路径聚合</strong>，通过自底向上和自顶向下的路径增强特征图的表达能力。</li>
</ul>
<p><strong>结构流程：</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Backbone</span>输出特征图(<span class="hljs-variable constant_">P3</span>,<span class="hljs-variable constant_">P4</span>,<span class="hljs-variable constant_">P5</span>) → 
上采样路径（自顶向下）：
  <span class="hljs-variable constant_">P5</span> → 上采样 → 与<span class="hljs-variable constant_">P4</span>融合 → 卷积 → 上采样 → 与<span class="hljs-variable constant_">P3</span>融合
下采样路径（自底向上）：
  融合后的<span class="hljs-variable constant_">P3</span> → 下采样 → 与<span class="hljs-variable constant_">P4</span>融合 → 下采样 → 与<span class="hljs-variable constant_">P5</span>融合
最终输出三个尺度的特征图
</code></pre>
<h3 data-id="heading-16">2.1  SPPF模块结构</h3>
<p><strong>SPPF模块(Spatial Pyramid Pooling Fast):</strong> 用于不同尺度的池化操作，将不同尺度的特征图拼接在一起，提高对不同尺寸目标的检测能力。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a09a61856ebe464f9ee778d19afb859f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=u%2B6EQjcw9v6H5zfx8FpKiF0OK%2BQ%3D" alt="b1bc51b7-aeaa-43a4-8f42-32e40835f4c7.png" loading="lazy"/></p>
<h4 data-id="heading-17">2.1.1 SPP模块结构</h4>
<p>SPP模块是何凯明大神在2015年的论文 《Spatial Pyramid Pooling in Deep Convolutional Networks for VisualRecognition》中被提出。</p>
<p>SPP为空间金字塔池化结构，主要是为了解决两个问题:</p>
<ol>
<li>有效避免了对图像区域裁剪、缩放操作导致的<strong>图像失真</strong>等问题;</li>
<li>解决了卷积神经网络对图相关<strong>重复特征提取</strong>的问题，大大提高了产生候选框的速度，且节省了计算成本。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdfb218a283449609dc3ccc367466cc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=q4zvhACwCS38mmQ9YyxMmLfCjvc%3D" alt="b7421555-253f-4845-9781-b997e365e982.png" loading="lazy"/></p>
<h4 data-id="heading-18">2.1.2 SPPF模块结构</h4>
<p>这个是YOLOv5 作者Glenn Jocher 基于SPP提出的，速度较SPP快很多，所以叫SPP-Fast。SPPF是空间金字塔池化的快速版本，它是一种在卷积神经网络中用于<strong>处理不同尺寸输入</strong>的技术。SPPF的核心思想是通过<strong>对输入特征图进行不同尺度的池化操作，生成固定长度的特征向量</strong>，从而使得网络能够处理任意尺寸的输入图像。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e4bdff9f03946429af278c59f40aafd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=tXT%2Bg4%2FCGcrsObeoZsZQ%2FGZjVyU%3D" alt="5f651cd5-0a25-42d3-bd96-6d40fc5d65c3.png" loading="lazy"/></p>
<h3 data-id="heading-19">2.2 PAN-FPN模块结构</h3>
<p>YOLOv8 中入了 PAN-FPN (Path Aggregation Network - Feature Pyramid Network) 为其特征金字塔网络，进一步增强了多尺度特征的表示能力。<strong>PAN-FPN 通过双向路径的融合，使得特征图包含更丰富的上下文信息和语义信息，增强了模型对不同尺度目标的检测能力。</strong></p>
<p>相对于YOLOv5或者YOLOv6，YOLOv8将C3模块以及RepBlock替换为了C2f，同时细心可以发现，相对于YOLOv5和YOLOv6，YOLOv8选择将上采样之前的1×1卷积去除了，将Backbone不同阶段输出的特征直接送入了上采样操作。</p>
<p><strong>YOLOv5的Neck</strong>部分的结构图如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3284c93a0812493da205c25b6fb019fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=WduVkhxkMSV%2BqbvqmAic5vrO8AY%3D" alt="image.png" loading="lazy"/></p>
<p>YOLOv6的Neck部分的结构图如下：</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b233a5dbd354cecbb89c24ed352a75f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=qQffFB3JvpBzit%2BSmB096r1OATk%3D" alt="image.png" width="100%" loading="lazy"/>
<p><strong>YOLOv8</strong>的结构图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af574db2816349d09aec6ebed2fec1f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=us7yT6aeXttmh8GU3s6XsNsmR1M%3D" alt="image.png" loading="lazy"/></p>
<p><strong>FPN网络pytorch代码</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FPN</span>(nn.Module):
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, num_blocks, num_classes, back_bone=<span class="hljs-string">'resnet'</span>, pretrained=<span class="hljs-literal">True</span></span>):
        <span class="hljs-built_in">super</span>(FPN, self).__init__()
        self.in_planes = <span class="hljs-number">64</span>
        self.num_classes = num_classes
 
        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">64</span>, kernel_size=<span class="hljs-number">7</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">3</span>, bias=<span class="hljs-literal">False</span>)
        self.bn1 = nn.BatchNorm2d(<span class="hljs-number">64</span>)
 
        BatchNorm = nn.BatchNorm2d
        self.back_bone = build_backbone(back_bone)
 
        <span class="hljs-comment"># Bottom-up layers</span>
        self.layer1 = self._make_layer(Bottleneck,  <span class="hljs-number">64</span>, num_blocks[<span class="hljs-number">0</span>], stride=<span class="hljs-number">1</span>)
        self.layer2 = self._make_layer(Bottleneck, <span class="hljs-number">128</span>, num_blocks[<span class="hljs-number">1</span>], stride=<span class="hljs-number">2</span>)
        self.layer3 = self._make_layer(Bottleneck, <span class="hljs-number">256</span>, num_blocks[<span class="hljs-number">2</span>], stride=<span class="hljs-number">2</span>)
        self.layer4 = self._make_layer(Bottleneck, <span class="hljs-number">512</span>, num_blocks[<span class="hljs-number">3</span>], stride=<span class="hljs-number">2</span>)
 
        <span class="hljs-comment"># Top layer</span>
        self.toplayer = nn.Conv2d(<span class="hljs-number">2048</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)  <span class="hljs-comment"># Reduce channels</span>
 
        <span class="hljs-comment"># Smooth layers</span>
        self.smooth1 = nn.Conv2d(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)
        self.smooth2 = nn.Conv2d(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)
        self.smooth3 = nn.Conv2d(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">1</span>)
 
        <span class="hljs-comment"># Lateral layers</span>
        self.latlayer1 = nn.Conv2d(<span class="hljs-number">1024</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)
        self.latlayer2 = nn.Conv2d( <span class="hljs-number">512</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)
        self.latlayer3 = nn.Conv2d( <span class="hljs-number">256</span>, <span class="hljs-number">256</span>, kernel_size=<span class="hljs-number">1</span>, stride=<span class="hljs-number">1</span>, padding=<span class="hljs-number">0</span>)
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_upsample</span>(<span class="hljs-params">self, x, h, w</span>):    <span class="hljs-comment"># upsample use 'bilinear' interpolate</span>
        <span class="hljs-keyword">return</span> F.interpolate(x, size=(h, w), mode=<span class="hljs-string">'bilinear'</span>, align_corners=<span class="hljs-literal">True</span>)
 
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_layer</span>(<span class="hljs-params">self, Bottleneck, planes, num_blocks, stride</span>):
        strides = [stride] + [<span class="hljs-number">1</span>]*(num_blocks-<span class="hljs-number">1</span>)
        layers = []
        <span class="hljs-keyword">for</span> stride <span class="hljs-keyword">in</span> strides:
            layers.append(Bottleneck(self.in_planes, planes, stride))
            self.in_planes = planes * Bottleneck.expansion
        <span class="hljs-keyword">return</span> nn.Sequential(*layers)
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_upsample_add</span>(<span class="hljs-params">self, x, y</span>):
        <span class="hljs-string">'''Upsample and add two feature maps.
        Args:
          x: (Variable) top feature map to be upsampled.
          y: (Variable) lateral feature map.
        Returns:
          (Variable) added feature map.
        Note in PyTorch, when input size is odd, the upsampled feature map
        with `F.upsample(..., scale_factor=2, mode='nearest')`
        maybe not equal to the lateral feature map size.
        e.g.
        original input size: [N,_,15,15] -&gt;
        conv2d feature map size: [N,_,8,8] -&gt;
        upsampled feature map size: [N,_,16,16]
        So we choose bilinear upsample which supports arbitrary output sizes.
        '''</span>
        _,_,H,W = y.size()
        <span class="hljs-keyword">return</span> F.interpolate(x, size=(H,W), mode=<span class="hljs-string">'bilinear'</span>, align_corners=<span class="hljs-literal">True</span>) + y
 
 
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-comment"># Bottom-up</span>
        c1 = F.relu(self.bn1(self.conv1(x)))
        c1 = F.max_pool2d(c1, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>)
        c2 = self.layer1(c1)
        c3 = self.layer2(c2)
        c4 = self.layer3(c3)
        c5 = self.layer4(c4)

        <span class="hljs-comment"># Top-down</span>
        p5 = self.toplayer(c5)
        p4 = self._upsample_add(p5, self.latlayer1(c4))
        p3 = self._upsample_add(p4, self.latlayer2(c3))
        p2 = self._upsample_add(p3, self.latlayer3(c2))
 
        <span class="hljs-comment"># Smooth</span>
        p4 = self.smooth1(p4)
        p3 = self.smooth2(p3)
        p2 = self.smooth3(p2)
 
        <span class="hljs-keyword">return</span> p2, p3, p4, p5

</code></pre>
<h4 data-id="heading-20">2.2.1 特征金字塔网络(FPN)</h4>
<p><strong>论文：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F1612.03144" target="_blank" title="https://arxiv.org/abs/1612.03144" ref="nofollow noopener noreferrer">[1612.03144] Feature Pyramid Networks for Object Detection</a></p>
<p>FPN 通过结合 ​<strong>​深层语义信息​</strong>​（高层特征）和 ​<strong>​浅层细节信息​</strong>​（低层特征），构建多尺度的特征金字塔，显著提升目标检测模型对不同尺寸目标的检测能力。</p>
<p>在YOLOv8中，FPN主要负责构建<strong>从低层到高层</strong>的<strong>多尺度特征图</strong>。其主要过程如下:</p>
<p><strong>1.自顶向下路径:</strong></p>
<ul>
<li>从深层特征开始，逐层向上采样。</li>
<li>每一层的上采样特征与相应的低层特征进行融合，以补充空间信息和增强语义信息。</li>
</ul>
<p><strong>2.横向连接:</strong></p>
<ul>
<li>利用1x1卷积调整通道数，使得上采样特征与低层特征的通道数一致。</li>
<li>通过逐层相加的方式进行特征融合。</li>
</ul>
<p>FPN网络大致结构如下：<strong>一个自底向上的线路、一个自顶向下的线路、横向连接</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81c3d44184fd436e9c1e7778151c3b9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=YPO8pQKOayeBpNusZAvuPL%2BEBUE%3D" alt="90a4c3d1-52ac-4ab7-b75d-18b22028cde7.png" loading="lazy"/></p>
<p><strong>结来说，FPN = top-down的融合 + 在金字塔各层进行prediction</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edf82e376ef6489bad39ffc195a1c375~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=%2BCm6UKhqikcFzs%2F%2FPAkrCJAQkRU%3D" alt="5bf5c1dd-3c77-4017-bb0f-a43827b27778.png" loading="lazy"/>
<strong>FPN（Feature Pyramid Network）​</strong>​ 通过自顶向下的路径构建特征金字塔，但存在两个关键问题：</p>
<ol>
<li>​<strong>​语义信息稀释​</strong>​：深层特征经过多次上采样传递到浅层时，丢失细节信息。</li>
<li>​<strong>​定位精度不足​</strong>​：小目标依赖浅层特征，但浅层语义信息较弱。</li>
</ol>
<h4 data-id="heading-21">2.2.2 路径聚合网络(PAN)</h4>
<p><strong>论文：2018年在CVPR</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F1803.01534" target="_blank" title="https://arxiv.org/abs/1803.01534" ref="nofollow noopener noreferrer">[1803.01534] Path Aggregation Network for Instance Segmentation</a></p>
<p><strong>PANet的核心创新在于引入了自底向上的路径聚合机制，形成了<code>双向特征融合路径</code></strong>，解决了FPN单向信息传递的局限性。这一改进使得低层的高分辨率特征能够更有效地传递到高层，同时高层的语义信息也能充分影响低层特征，实现了更全面的多尺度特征交互。</p>
<p>PAN是在FPN的基础上，进一步增强特征金字塔网络的结构，具体过程如下:</p>
<p><strong>1.自底向上的路径:</strong></p>
<ul>
<li>从底层特征开始，逐层向上传递特征。</li>
<li>每一层的特征图通过自底向上的路径，与高层特征图进行融合。</li>
</ul>
<p><strong>2.特征融合:</strong></p>
<ul>
<li>在每一层，将自顶向下路径和自底向上路径的特征进行融合，确保每一层的特征都包含不同尺度的信息。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1367cdc558df415d98d76e1f532b455f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JyX54mb5LiN5Lya566X5rOV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771141219&amp;x-signature=TGxQEaJVX7BUgRakbmU%2Bo6%2BvEt0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-22">2.2.3 FPN和PANet区别</h4>
<p><strong>FPN更适合基础目标检测任务和资源受限环境</strong>，例如轻量化移动端部署或实时视频流处理。其简单高效的结构设计使其在计算资源有限的场景下仍能保持良好的检测性能。</p>
<p><strong>PANet则适用于需要高精度的场景</strong>，特别是在处理极小目标或复杂背景环境时。例如在自动驾驶系统中检测车辆周围的小障碍物，或在医学图像分中识别微小病灶时，PANet的双向特征融合和自适应特征池化技术能够显著提升检测和分割的准确性。</p>
<p>FPN的参数量约为25M，FLOPs约为200B；而PANet的参数量增加到32.5M，FLOPs达到235.6B。</p>
<h3 data-id="heading-23">2.3 Neck创新点</h3>
<ol>
<li>
<p><strong>双融合路径</strong>：</p>
<ul>
<li>上采样路径：传播强语义信息（利于分类）</li>
<li>下采样路径：传播强定位信息（利于检测）</li>
</ul>
</li>
<li>
<p><strong>跨尺度连接</strong>：使用Concat而非Add，保留更多特征信息</p>
</li>
<li>
<p><strong>适配不同尺度</strong>：针对80×80（小目标）、40×40（中目标）、20×20（大目标）特征图优化融合策略。</p>
</li>
</ol>
<h3 data-id="heading-24">2.4 PAN-FPN在YOLOv8中的具体实现</h3>
<p>在YOLOv8中，PAN-FPN的实现结合了FPN和PAN的优点，具体如下:</p>
<blockquote>
<p><strong>1. 多尺度特征提取:</strong></p>
<ul>
<li>YOLOv8的主干网络首先提取出不同尺度的特征图。</li>
<li>通过FPN构建自顶向下的特征金字塔，实现多尺度特征的初步融合。</li>
</ul>
<p><strong>1. 双向特征融合:</strong></p>
<ul>
<li>在FPN的基础上，引入PAN的自底向上路径，将低层特征逐层传递到高层，进一步丰富多尺度特征。</li>
<li>通过横向连接，将不同尺度的特征进行融合，确保每一层的特征都包含丰富的上下文信息。</li>
</ul>
<p><strong>2. 增强的特征表示:</strong></p>
<ul>
<li>PAN-FPN通过双向路径的融合，使得特征图包含更丰富的上下文信息和语义信息，增强了模型对不同尺度目标的检测能力。</li>
</ul>
</blockquote>
<h2 data-id="heading-25">3. Head：Decoupled-Head + DFL + CIoU（检测头革新）</h2>
<p>YOLOv8将检测头改为 <strong><code>解耦形式</code></strong>，并引入了先进的损失函数。</p>
<p>在YOLOv8中，Head部分负责将Neck部分输出的特征进行进一步处理，以生成最终的检测结果。Head部分的主要功能是<strong>将特征图转换为目标检测所需的具体信息，包括类别、位置和置信度。</strong></p>
<p>解耦头结构：</p>
<pre><code class="hljs language-js" lang="js">共享特征 → 三个独立分支：
  <span class="hljs-number">1.</span> 分类分支：<span class="hljs-title class_">Conv</span> + <span class="hljs-title class_">Conv</span> → 类别置信度
  <span class="hljs-number">2.</span> 回归分支：<span class="hljs-title class_">Conv</span> + <span class="hljs-title class_">Conv</span> → 边界框坐标
  <span class="hljs-number">3.</span> 分布焦点分支：<span class="hljs-title class_">Conv</span> + <span class="hljs-title class_">Conv</span> → 边界框分布（<span class="hljs-variable constant_">DFL</span>）
</code></pre>
<h3 data-id="heading-26">3.1 卷积层和激活函数</h3>
<p>Head部分通常包括若干卷积层和激活函数。这些卷积层用于进一步处理Neck部分输出的特征图，以提取更多的高级特征。常见的激活函数包括ReLU或Leaky ReLU，能够引入非线性，从而提升特征表达能力。</p>
<h3 data-id="heading-27">3.2 预测层 (Prediction Layers)</h3>
<p>在YOLOv8中，预测层是关键组件，负责生成最终的检测结果。预测层包括三个主要输出:</p>
<ul>
<li><strong>边界框回归(Bounding BoxRegression)</strong>：预测目标的位置和大小。通常输出四个值，分别对应边界框的中心坐标(x,y)和宽度、高度(w,h)。</li>
<li><strong>置信度评分(Confidence Scores)</strong>：预测每个边界框内是否包含目标，以及目标的置信度。</li>
<li><strong>类别概率(Class Probabilities)</strong>：预测目标属于每个类别的概率。</li>
</ul>
<h4 data-id="heading-28">3.2.1 DFL（Distribution Focal Loss）</h4>
<pre><code class="hljs language-js" lang="js">传统：直接回归边界框坐标
<span class="hljs-variable constant_">DFL</span>：将坐标预测建模为离散概率分布
  步骤：
    <span class="hljs-number">1.</span> 预测边界框的分布（如y = Σ[<span class="hljs-title function_">P</span>(i)×i]）
    <span class="hljs-number">2.</span> 使用<span class="hljs-title class_">Focal</span> <span class="hljs-title class_">Loss</span>优化分布
  优势：
    - 更准确的小目标检测
    - 对模糊边界更鲁棒
</code></pre>
<h4 data-id="heading-29">3.2.2 损失函数组合</h4>
<pre><code class="hljs language-js" lang="js">总损失 = 分类损失 + 回归损失 + <span class="hljs-variable constant_">DFL</span>损失

分类损失：<span class="hljs-title class_">BCEWithLogitsLoss</span> 或 <span class="hljs-title class_">VarifocalLoss</span>（可选）
回归损失：<span class="hljs-title class_">CIoU</span> <span class="hljs-title class_">Loss</span>（考虑重叠、中心距离、长宽比）
<span class="hljs-variable constant_">DFL</span>损失：监督边界框分布学习
</code></pre>
<h2 data-id="heading-30">其他优化</h2>
<p>除了上述结构外，YOLOv8还引入了一些新的优化技术，如:</p>
<ol>
<li><strong>Anchor-free机制</strong>:减少了锚框的超参数设置，通过直接预测目标的中心点来简化训练过程。</li>
<li><strong>自适应非大值抑制NMS(Non-Maximum Suppression)</strong>:改进了传统的NMS算法，通过自适应调整阈值，<strong>减少误检和漏检</strong>，提高检测精度。
最终的预测结果会经过非极大值抑制处理，<strong>以去除重复的检测框</strong>。NMS保留置信度最高的边界框，并移除与之重叠度高的其他边界框，确保每个目标只被检测一次。</li>
<li><strong>自动混合精度训练(Automatic Mixed Precision Training)</strong>:通过在训练过程中动态调整计算精度，加快训练速度，同时减少显存占用。</li>
</ol>
<h2 data-id="heading-31">总结复习</h2>
<p>（1）特征金字塔网络是啥？
（2）空间金字塔池化是啥？
（3）C2f是啥？
（4）路径聚合网络是啥？
（5）特征金字塔网络和路径聚合网络区别？
（5）YOLO为什么使用两层特征金字塔结构？
（7）预测层会输出什么？
（8）怎么去除重复的检测框和减少误检和漏检？NMS
（9）为什么检测小物体需要用大的特征图？</p>
<p>（10）为什么要用双分支？</p>
<ol>
<li><strong>丰富特征表示</strong>：不同分支学习不同特征</li>
<li><strong>梯度多样性</strong>：缓解梯度消失，帮助训练</li>
<li><strong>信息冗余</strong>：提升模型鲁棒性</li>
</ol>
<p>（11）连接处的c和a的区别？</p>
<p><strong>连接处的<code>c</code>通常代表"拼接/连接（concatenate）"操作</strong>
<strong>连接处的<code>a</code>是<code>add</code>（加法操作/残差连接）</strong></p>
<p>（12）TD和BU是什么？</p>
<ul>
<li><strong>TD</strong> = <strong>T</strong>op-<strong>D</strong>own = 自上而下 = 语义信息下传</li>
<li><strong>BU</strong> = <strong>B</strong>ottom-<strong>U</strong>p = 自下而上 = 位置信息上传</li>
</ul>
<h2 data-id="heading-32">参考资料</h2>
<p>[1]<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu013172930%2Farticle%2Fdetails%2F154040820" target="_blank" title="https://blog.csdn.net/u013172930/article/details/154040820" ref="nofollow noopener noreferrer">什么是 C2f： YOLOv8 中引入的一种高效特征提取模块_c2f模块</a></p>
<p>[2]<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fshangyanaf%2Farticle%2Fdetails%2F139223155" target="_blank" title="https://blog.csdn.net/shangyanaf/article/details/139223155" ref="nofollow noopener noreferrer">万字详解YOLOv8网络结构Backbone/neck/head以及Conv、Bottleneck、C2f、SPPF、Detect等模块_yolov8网络架构</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[北京回长沙了，简单谈谈感受！]]></title>    <link>https://juejin.cn/post/7603781883973763091</link>    <guid>https://juejin.cn/post/7603781883973763091</guid>    <pubDate>2026-02-08T09:54:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603781883973763091" data-draft-id="7603643044035199012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="北京回长沙了，简单谈谈感受！"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2026-02-08T09:54:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员飞鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            北京回长沙了，简单谈谈感受！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员飞鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:54:37.000Z" title="Sun Feb 08 2026 09:54:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>大家好呀，我是<strong>飞鱼</strong></p>
<p>我今年已经从北京回长沙了，这里谈谈感受。</p>
<blockquote>
<p>❝</p>
<p>首先我回长沙不是逃离，而是换一种更舒服、更可持续的生活方式。</p>
<p>北京给了我视野和能力，长沙给了我生活和归属。</p>
</blockquote>
<p><strong>最直观的变化</strong></p>
<ul>
<li>节奏慢了：不用挤早高峰了，走路不用小跑，回家路更短。</li>
<li>心态稳了：不再天天赶进度、追KPI，人也没那么紧绷了。</li>
</ul>
<p><strong>生活成本：压力明显小了</strong></p>
<blockquote>
<p>❝</p>
<p>房租、通勤、日常开销都降了不少，以前在北京工资高，但大头都被生活成本吃掉了。</p>
<p>现在收入可能少些，但心里踏实很多。</p>
</blockquote>
<p><strong>个人生活：更松弛也更有边界</strong></p>
<blockquote>
<p>❝</p>
<p>回来后作息更规律了，能早点睡、早点起，周内也会留出时间运动或散步。</p>
<p>以前下班只想躺着刷手机，现在会给自己留一点空白时间，用来读书、整理思路或者陪家人聊天。</p>
<p>生活变简单，但心里更笃定，能把注意力放在真正重要的人和事上。</p>
</blockquote>
<p><strong>城市气息：更有生活感</strong></p>
<blockquote>
<p>❝</p>
<p>长沙烟火气足，我现在每周都会去爬一次岳麓山（离得近）。</p>
<p>周末也能随时约上朋友一起吃饭聊天，不用再掐着时间赶路。</p>
</blockquote>
<p><strong>个人成长：从外部驱动到自我驱动</strong></p>
<blockquote>
<p>❝</p>
<p>以前在北京，节奏和环境会推着我走，事情一件接一件，来不及想太多。</p>
<p>回长沙后，外部推力小了，但我开始主动搭自己的节奏：给自己设目标、做复盘、安排学习计划。</p>
<p>慢下来之后，反而更能看清自己擅长什么、缺什么，也更容易把工作和生活都经营得更稳。</p>
</blockquote>
<p><strong>给同样选择的人一点建议</strong></p>
<ul>
<li>先想清楚你想要什么：是离家近、生活压力小，还是职业成长更快？别只因为累了就决定，要有明确的取舍。</li>
<li>提前做资源准备：无论去哪，职业发展都得靠自己，技能储备、作品、圈子都要主动经营。</li>
<li>规划现金流：收入变化要提前算清楚，别让生活压力反过来影响判断。</li>
<li>给自己一个过渡期：回去不是立刻完美适应，给自己几个月调整节奏，别太焦虑。</li>
</ul>
<p><strong>最后想说</strong></p>
<p>适合自己的地方，不一定是机会最多的地方，而是能让你活得更从容、有力量的地方。</p>
<blockquote>
<p>❝</p>
<p>最后想看技术文章的，可以去我的个人网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 响应式布局的诞生历程：从后端渲染到前端响应式]]></title>    <link>https://juejin.cn/post/7604037348607066150</link>    <guid>https://juejin.cn/post/7604037348607066150</guid>    <pubDate>2026-02-08T09:54:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604037348607066150" data-draft-id="7603721514203676681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 响应式布局的诞生历程：从后端渲染到前端响应式"/> <meta itemprop="keywords" content="全栈"/> <meta itemprop="datePublished" content="2026-02-08T09:54:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不会敲代码1"/> <meta itemprop="url" content="https://juejin.cn/user/1927884034804425"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 响应式布局的诞生历程：从后端渲染到前端响应式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927884034804425/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不会敲代码1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T09:54:26.000Z" title="Sun Feb 08 2026 09:54:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 响应式布局的诞生历程：从后端渲染到前端响应式</h2>
<h3 data-id="heading-1">引言</h3>
<p>在 Web 开发的演进过程中，数据与界面的关系经历了多次革命性的变化。从最初的纯后端渲染，到前后端分离，再到现代的响应式数据驱动，每一次变革都让开发更加高效、用户体验更加流畅。本文将结合具体代码示例，带你走完这段历程，理解响应式布局如何诞生并成为现代前端开发的核心。</p>
<hr/>
<h3 data-id="heading-2">第一阶段：纯后端的套模板（MVC 模式）</h3>
<h4 data-id="heading-3">什么是纯后端套模板？</h4>
<p>在这个阶段，服务器负责处理<strong>所有</strong>的页面生成工作。典型的 MVC（Model-View-Controller）架构中：</p>
<ul>
<li><strong>Model</strong>：数据层（如数据库中的数据）</li>
<li><strong>View</strong>：模板层（HTML + 模板语法）</li>
<li><strong>Controller</strong>：业务逻辑层（接收请求、处理数据、渲染模板）</li>
</ul>
<h4 data-id="heading-4">代码示例分析</h4>
<p>在 <code>server.js</code> 中，我们可以看到典型的后端渲染模式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 数据定义在服务器端</span>
<span class="hljs-keyword">const</span> users=[
    {
        <span class="hljs-attr">id</span>:<span class="hljs-number">1</span>,
        <span class="hljs-attr">name</span>:<span class="hljs-string">'张三'</span>,
        <span class="hljs-attr">email</span>:<span class="hljs-string">'zhangsan@qq.com'</span>
    },
    <span class="hljs-comment">// ... 更多用户数据</span>
]

<span class="hljs-comment">// 生成HTML的模板函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateHTML</span>(<span class="hljs-params">users</span>){
    <span class="hljs-keyword">const</span> userRows=users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span>=&gt;</span>
        <span class="hljs-string">`&lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
        &lt;/tr&gt;`</span>
    ).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
    &lt;!DOCTYPE html&gt;
    &lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;!-- 样式和元数据 --&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Users&lt;/h1&gt;
        &lt;table&gt;
            &lt;thead&gt;...&lt;/thead&gt;
            &lt;tbody&gt;
                <span class="hljs-subst">${userRows}</span>  &lt;!-- 动态数据插入 --&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/body&gt;
    &lt;/html&gt;`</span>
}

<span class="hljs-comment">// 服务器处理请求</span>
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req,res</span>)=&gt;</span>{
    <span class="hljs-keyword">if</span>(req.<span class="hljs-property">url</span> === <span class="hljs-string">'/users'</span>){
        res.<span class="hljs-property">statusCode</span>=<span class="hljs-number">200</span>
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>,<span class="hljs-string">'text/html;charset=utf-8'</span>)
        <span class="hljs-keyword">const</span> html=<span class="hljs-title function_">generateHTML</span>(users)  <span class="hljs-comment">// 在服务器生成完整HTML</span>
        res.<span class="hljs-title function_">end</span>(html)  <span class="hljs-comment">// 返回给浏览器</span>
    }
})
</code></pre>
<h4 data-id="heading-5">工作流程</h4>
<ol>
<li>用户访问 <code>http://localhost:1314/users</code></li>
<li>服务器接收到请求，执行对应的控制器逻辑</li>
<li>从数据库（示例中是内存数组）获取用户数据</li>
<li>将数据注入到 HTML 模板中生成完整的页面</li>
<li>返回包含数据的完整 HTML 给浏览器显示</li>
</ol>
<h4 data-id="heading-6">实际运行效果</h4>
<pre><code class="hljs language-xml" lang="xml">浏览器请求: http://localhost:1314/users
↓
服务器响应:
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>zhangsan@qq.com<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>lisi@qq.com<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 所有数据都在HTML中 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">劣势分析</h4>
<ol>
<li><strong>前后端耦合严重</strong>：前端开发者需要了解后端模板语法，无法独立工作</li>
<li><strong>页面刷新频繁</strong>：查看用户详情需要重新加载整个页面</li>
<li><strong>服务器压力大</strong>：高并发时每个请求都需要渲染完整页面</li>
<li><strong>开发效率低</strong>：修改一个按钮样式需要后端重新部署</li>
<li><strong>技术栈限制</strong>：前端无法使用现代框架和工具链</li>
</ol>
<h4 data-id="heading-8">典型问题场景</h4>
<p>假设要添加一个"删除用户"功能：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需要为每个用户添加删除按钮</span>
<span class="hljs-string">`&lt;tr&gt;
    &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
    &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
    &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
    &lt;td&gt;&lt;button onclick="deleteUser(<span class="hljs-subst">${user.id}</span>)"&gt;删除&lt;/button&gt;&lt;/td&gt;
&lt;/tr&gt;`</span>

<span class="hljs-comment">// 删除后需要刷新整个页面才能看到更新后的列表</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">第二阶段：前后端分离 + DOM API 编程</h3>
<h4 data-id="heading-10">什么是前后端分离？</h4>
<p>随着 AJAX（后升级为 Fetch API）技术的成熟，前端可以独立于后端进行开发：</p>
<h4 data-id="heading-11">后端代码变化（API 化）</h4>
<p>后端不再返回 HTML，而是返回 JSON 数据：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// db.json - 纯数据文件</span>
{
    <span class="hljs-string">"users"</span>: [
        {<span class="hljs-string">"id"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"张三"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"zhangsan@qq.com"</span>},
        {<span class="hljs-string">"id"</span>:<span class="hljs-number">2</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">"李四"</span>,<span class="hljs-string">"email"</span>:<span class="hljs-string">"lisi@qq.com"</span>}
    ]
}
</code></pre>
<h4 data-id="heading-12">前端独立开发</h4>
<p><code>index.html</code> 展示了如何独立获取和展示数据：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 独立的前端页面 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Users<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- 初始为空，通过JS动态填充 --&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 主动向后端请求数据</span>
        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/users'</span>)
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
        .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'获取到的数据:'</span>, data)
            
            <span class="hljs-comment">// 手动操作DOM更新界面</span>
            <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
            
            <span class="hljs-comment">// 拼接HTML字符串</span>
            <span class="hljs-keyword">const</span> rowsHTML = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
                <span class="hljs-string">`&lt;tr&gt;
                    &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
                    &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
                    &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
                    &lt;td&gt;
                        &lt;button onclick="deleteUser(<span class="hljs-subst">${user.id}</span>)"&gt;
                            删除
                        &lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;`</span>
            ).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
            
            <span class="hljs-comment">// 更新DOM</span>
            tbody.<span class="hljs-property">innerHTML</span> = rowsHTML
        })
        
        <span class="hljs-comment">// 删除用户的函数</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">id</span>) {
            <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://localhost:3000/users/<span class="hljs-subst">${id}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>
            })
            .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
                <span class="hljs-comment">// 删除成功后，需要重新获取数据并更新DOM</span>
                <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:3000/users'</span>)
                .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
                .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
                    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
                    <span class="hljs-keyword">const</span> rowsHTML = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> 
                        <span class="hljs-string">`&lt;tr&gt;...&lt;/tr&gt;`</span>
                    ).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
                    tbody.<span class="hljs-property">innerHTML</span> = rowsHTML
                })
            })
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">对比前一阶段的优势</h4>
<h5 data-id="heading-14">1. <strong>开发完全解耦</strong></h5>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">前端团队: HTML/CSS/JS独立开发，使用Mock数据</span>
<span class="hljs-section">后端团队: 专注API开发和数据库优化</span>
<span class="hljs-section">测试团队: 可独立测试API和前端功能</span>
</code></pre>
<h5 data-id="heading-15">2. <strong>用户体验提升</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 实现搜索功能而无需刷新页面</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">searchUsers</span>(<span class="hljs-params">keyword</span>) {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://localhost:3000/users?q=<span class="hljs-subst">${keyword}</span>`</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-comment">// 只更新表格内容，页面其他部分保持不变</span>
        <span class="hljs-title function_">updateTable</span>(data)
    })
}
</code></pre>
<h5 data-id="heading-16">3. <strong>技术选型自由</strong></h5>
<ul>
<li>前端可以选择 React、Vue、Angular 或保持原生</li>
<li>后端可以使用 Java、Python、Go 等任意语言</li>
<li>各自独立部署和扩展</li>
</ul>
<h4 data-id="heading-17">劣势分析</h4>
<h5 data-id="heading-18">1. <strong>DOM 操作繁琐且重复</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 每次数据变化都需要这样操作</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTable</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
    tbody.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>
    
    users.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> tr = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'tr'</span>)
        
        <span class="hljs-keyword">const</span> td1 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'td'</span>)
        td1.<span class="hljs-property">textContent</span> = user.<span class="hljs-property">id</span>
        tr.<span class="hljs-title function_">appendChild</span>(td1)
        
        <span class="hljs-keyword">const</span> td2 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'td'</span>)
        td2.<span class="hljs-property">textContent</span> = user.<span class="hljs-property">name</span>
        tr.<span class="hljs-title function_">appendChild</span>(td2)
        
        <span class="hljs-comment">// ... 重复的创建和追加操作</span>
        
        tbody.<span class="hljs-title function_">appendChild</span>(tr)
    })
}

<span class="hljs-comment">// 或者使用innerHTML方式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTable2</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
    <span class="hljs-keyword">const</span> html = users.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-string">`
        &lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${user.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.name}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${user.email}</span>&lt;/td&gt;
        &lt;/tr&gt;
    `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>)
    tbody.<span class="hljs-property">innerHTML</span> = html
}
</code></pre>
<h5 data-id="heading-19">2. <strong>状态管理混乱</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> currentUsers = []
<span class="hljs-keyword">let</span> filteredUsers = []
<span class="hljs-keyword">let</span> selectedUserId = <span class="hljs-literal">null</span>

<span class="hljs-comment">// 数据变化时需要手动同步多个地方</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-comment">// 1. 发送删除请求</span>
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/users/<span class="hljs-subst">${id}</span>`</span>, {<span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>})
    
    <span class="hljs-comment">// 2. 更新当前数据数组</span>
    currentUsers = currentUsers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> !== id)
    filteredUsers = filteredUsers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> !== id)
    
    <span class="hljs-comment">// 3. 如果删除的是选中用户，清空选中状态</span>
    <span class="hljs-keyword">if</span> (selectedUserId === id) {
        selectedUserId = <span class="hljs-literal">null</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.selected'</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'selected'</span>)
    }
    
    <span class="hljs-comment">// 4. 更新DOM显示</span>
    <span class="hljs-title function_">updateTable</span>(filteredUsers)
    
    <span class="hljs-comment">// 5. 更新统计数据</span>
    <span class="hljs-title function_">updateStats</span>(currentUsers)
}
</code></pre>
<h5 data-id="heading-20">3. <strong>性能问题</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 每次更新都重新渲染整个表格</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateTable</span>(<span class="hljs-params">users</span>) {
    <span class="hljs-keyword">const</span> tbody = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'tbody'</span>)
    tbody.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>  <span class="hljs-comment">// 清空所有DOM节点</span>
    
    <span class="hljs-comment">// 重新创建所有节点</span>
    users.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
        <span class="hljs-comment">// 即使只有一项数据变化，也要重绘所有行</span>
    })
}

<span class="hljs-comment">// 1000行数据时会出现明显卡顿</span>
<span class="hljs-title function_">updateTable</span>(largeUserList)  <span class="hljs-comment">// 可能阻塞主线程几毫秒</span>
</code></pre>
<h5 data-id="heading-21">4. <strong>关注点偏离</strong></h5>
<p>开发者花费大量时间在：</p>
<ul>
<li>DOM 选择器的编写和维护</li>
<li>事件委托和冒泡处理</li>
<li>手动处理状态同步</li>
<li>性能优化（防抖、节流、虚拟列表）</li>
</ul>
<p>而不是专注于业务逻辑本身。</p>
<hr/>
<h3 data-id="heading-22">第三阶段：Vue 响应式数据驱动</h3>
<h4 data-id="heading-23">什么是响应式数据驱动？</h4>
<p>响应式编程的核心思想是：<strong>数据变化自动驱动界面更新</strong>。</p>
<h4 data-id="heading-24">完整代码示例</h4>
<p><code>App.vue</code> 展示了 Vue 3 的响应式编程：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 导入响应式API
import { ref, onMounted } from 'vue'

// 创建响应式数据
const users = ref([])
const isLoading = ref(false)
const searchKeyword = ref('')

// 组件挂载后自动执行
onMounted(() =&gt; {
    console.log('组件已挂载，开始获取数据')
    loadUsers()
})

// 加载用户数据
function loadUsers() {
    isLoading.value = true  // 界面自动显示加载状态
    
    fetch('http://localhost:3000/users')
    .then(res =&gt; res.json())
    .then(data =&gt; {
        users.value = data  // 赋值后界面自动更新
        isLoading.value = false
    })
    .catch(error =&gt; {
        console.error('加载失败:', error)
        isLoading.value = false
    })
}

// 删除用户
function deleteUser(id) {
    if (confirm('确定要删除吗？')) {
        // 1. 先从前端移除（立即响应）
        users.value = users.value.filter(user =&gt; user.id !== id)
        
        // 2. 后发送请求到服务器
        fetch(`http://localhost:3000/users/${id}`, {
            method: 'DELETE'
        }).catch(error =&gt; {
            // 如果失败，可以回滚或提示
            console.error('删除失败:', error)
            loadUsers()  // 重新加载数据
        })
    }
}

// 计算属性：过滤后的用户
const filteredUsers = computed(() =&gt; {
    if (!searchKeyword.value) return users.value
    
    return users.value.filter(user =&gt;
        user.name.includes(searchKeyword.value) ||
        user.email.includes(searchKeyword.value)
    )
})
&lt;/script&gt;

&lt;template&gt;
    &lt;div class="user-management"&gt;
        &lt;!-- 搜索框 --&gt;
        &lt;div class="search-box"&gt;
            &lt;input 
                v-model="searchKeyword" 
                placeholder="搜索用户..."
                @input="searchUsers"
            /&gt;
            &lt;span&gt;找到 {{ filteredUsers.length }} 个用户&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;!-- 加载状态 --&gt;
        &lt;div v-if="isLoading" class="loading"&gt;
            加载中...
        &lt;/div&gt;
        
        &lt;!-- 用户表格 --&gt;
        &lt;table v-else&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th&gt;ID&lt;/th&gt;
                    &lt;th&gt;姓名&lt;/th&gt;
                    &lt;th&gt;邮箱&lt;/th&gt;
                    &lt;th&gt;操作&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;!-- 响应式数据绑定 --&gt;
                &lt;tr v-for="user in filteredUsers" :key="user.id"&gt;
                    &lt;td&gt;{{ user.id }}&lt;/td&gt;
                    &lt;td&gt;{{ user.name }}&lt;/td&gt;
                    &lt;td&gt;{{ user.email }}&lt;/td&gt;
                    &lt;td&gt;
                        &lt;button @click="deleteUser(user.id)"&gt;
                            删除
                        &lt;/button&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
        
        &lt;!-- 空状态 --&gt;
        &lt;div v-if="!isLoading &amp;&amp; filteredUsers.length === 0"&gt;
            没有找到用户
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
/* 组件作用域样式 */
.user-management {
    padding: 20px;
}

.search-box {
    margin-bottom: 20px;
}

table {
    width: 100%;
    border-collapse: collapse;
}

tr:hover {
    background-color: #f5f5f5;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-25">核心优势详解</h4>
<h5 data-id="heading-26">1. <strong>声明式编程 vs 命令式编程</strong></h5>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 声明式：告诉框架"要显示什么" --&gt;
&lt;tr v-for="user in users" :key="user.id"&gt;
    &lt;td&gt;{{ user.id }}&lt;/td&gt;
    &lt;td&gt;{{ user.name }}&lt;/td&gt;
&lt;/tr&gt;

&lt;!-- 对比命令式：告诉浏览器"如何显示" --&gt;
// const tbody = document.querySelector('tbody')
// tbody.innerHTML = ''
// users.forEach(user =&gt; {
//     const tr = document.createElement('tr')
//     // ... 手动创建每个元素
// })
</code></pre>
<h5 data-id="heading-27">2. <strong>响应式数据系统</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建响应式数据</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])

<span class="hljs-comment">// 添加新用户（界面自动更新）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addUser</span>(<span class="hljs-params">newUser</span>) {
    users.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(newUser)  <span class="hljs-comment">// 表格自动增加一行</span>
}

<span class="hljs-comment">// 修改用户信息（界面自动更新）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-params">id, newData</span>) {
    <span class="hljs-keyword">const</span> user = users.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === id)
    <span class="hljs-keyword">if</span> (user) {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(user, newData)  <span class="hljs-comment">// 对应行自动更新</span>
    }
}

<span class="hljs-comment">// 无需手动操作DOM！</span>
</code></pre>
<h5 data-id="heading-28">3. <strong>自动依赖跟踪</strong></h5>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
    &lt;div&gt;
        用户总数: {{ totalUsers }}
        活跃用户: {{ activeUsers }}
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
const users = ref([])
const showActiveOnly = ref(false)

// 计算属性：自动追踪依赖
const totalUsers = computed(() =&gt; users.value.length)

const activeUsers = computed(() =&gt; {
    // 自动追踪 users 和 showActiveOnly
    if (!showActiveOnly.value) return users.value.length
    
    return users.value.filter(user =&gt; user.isActive).length
})

// 当 users 或 showActiveOnly 变化时
// totalUsers 和 activeUsers 自动重新计算
// 界面自动更新
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-29">4. <strong>虚拟 DOM 性能优化</strong></h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 内部工作原理：</span>
<span class="hljs-comment">// 1. 数据变化时，创建新的虚拟DOM</span>
<span class="hljs-keyword">const</span> newVNode = <span class="hljs-title function_">createVNode</span>(users.<span class="hljs-property">value</span>)

<span class="hljs-comment">// 2. 与旧的虚拟DOM比较差异</span>
<span class="hljs-keyword">const</span> patches = <span class="hljs-title function_">diff</span>(oldVNode, newVNode)

<span class="hljs-comment">// 3. 只更新有变化的部分</span>
<span class="hljs-title function_">patch</span>(domNode, patches)

<span class="hljs-comment">// 结果：1000行数据中修改1行</span>
<span class="hljs-comment">// 原生DOM: 可能重绘1000行</span>
<span class="hljs-comment">// Vue: 只更新1行</span>
</code></pre>
<h5 data-id="heading-30">5. <strong>组件化开发</strong></h5>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- UserList.vue --&gt;
&lt;script setup&gt;
// 接收父组件传递的数据
const props = defineProps(['users', 'onDelete'])

// 定义向父组件发送的事件
const emit = defineEmits(['user-selected'])
&lt;/script&gt;

&lt;!-- UserItem.vue --&gt;
&lt;script setup&gt;
// 更小组件，更高复用性
const props = defineProps(['user'])
&lt;/script&gt;

&lt;!-- App.vue --&gt;
&lt;template&gt;
    &lt;UserList 
        :users="filteredUsers"
        @user-selected="handleSelect"
    /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-31">实际场景对比</h4>
<p><strong>场景：实现用户列表的搜索、排序、分页</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原生JS实现（约100行代码）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTable</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span> = []
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">filteredUsers</span> = []
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortField</span> = <span class="hljs-string">'id'</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">sortDirection</span> = <span class="hljs-string">'asc'</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentPage</span> = <span class="hljs-number">1</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageSize</span> = <span class="hljs-number">10</span>
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>()
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadData</span>()
    }
    
    <span class="hljs-comment">// 需要手动处理所有状态同步和DOM更新</span>
    <span class="hljs-comment">// 代码复杂，难以维护</span>
}

<span class="hljs-comment">// Vue实现（约30行代码）</span>
<span class="hljs-keyword">const</span> users = <span class="hljs-title function_">ref</span>([])
<span class="hljs-keyword">const</span> searchKeyword = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-keyword">const</span> sortField = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'id'</span>)
<span class="hljs-keyword">const</span> page = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)

<span class="hljs-keyword">const</span> displayedUsers = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> result = [...users.<span class="hljs-property">value</span>]
    
    <span class="hljs-comment">// 筛选</span>
    <span class="hljs-keyword">if</span> (searchKeyword.<span class="hljs-property">value</span>) {
        result = result.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> 
            u.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchKeyword.<span class="hljs-property">value</span>)
        )
    }
    
    <span class="hljs-comment">// 排序</span>
    result.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (sortField.<span class="hljs-property">value</span> === <span class="hljs-string">'name'</span>) {
            <span class="hljs-keyword">return</span> a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>)
        }
        <span class="hljs-keyword">return</span> a.<span class="hljs-property">id</span> - b.<span class="hljs-property">id</span>
    })
    
    <span class="hljs-comment">// 分页</span>
    <span class="hljs-keyword">const</span> start = (page.<span class="hljs-property">value</span> - <span class="hljs-number">1</span>) * <span class="hljs-number">10</span>
    <span class="hljs-keyword">return</span> result.<span class="hljs-title function_">slice</span>(start, start + <span class="hljs-number">10</span>)
})
</code></pre>
<h4 data-id="heading-32">为什么响应式是革命性的？</h4>
<ol>
<li><strong>开发效率提升 3-5 倍</strong>：减少大量重复的 DOM 操作代码</li>
<li><strong>代码可维护性大幅提高</strong>：数据流向清晰，易于调试</li>
<li><strong>性能更优</strong>：智能的更新策略和虚拟 DOM</li>
<li><strong>更好的开发体验</strong>：热重载、TypeScript 支持、DevTools</li>
<li><strong>团队协作更顺畅</strong>：清晰的组件接口和职责划分</li>
</ol>
<hr/>
<h3 data-id="heading-33">发展历程总结</h3>

































<table><thead><tr><th>阶段</th><th>核心技术</th><th>数据流向</th><th>代码量对比</th><th>维护难度</th></tr></thead><tbody><tr><td>纯后端模板</td><td>服务器渲染、模板引擎</td><td>服务器 → HTML</td><td>中等</td><td>高（前后端耦合）</td></tr><tr><td>前后端分离</td><td>Fetch API + DOM操作</td><td>服务器 → JSON → DOM</td><td>多（重复DOM操作）</td><td>中（状态管理复杂）</td></tr><tr><td>响应式驱动</td><td>Vue/React响应式系统</td><td>数据 ↔ 自动更新</td><td>少（专注业务逻辑）</td><td>低（数据驱动）</td></tr></tbody></table>
<h4 data-id="heading-34">性能对比示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 更新1000条用户数据中的1条：</span>

<span class="hljs-comment">// 阶段一：后端模板 - 整个页面刷新（慢）</span>
location.<span class="hljs-title function_">reload</span>()

<span class="hljs-comment">// 阶段二：DOM操作 - 重绘整个表格（中等）</span>
tbody.<span class="hljs-property">innerHTML</span> = newHTML  <span class="hljs-comment">// 可能16ms</span>

<span class="hljs-comment">// 阶段三：响应式 - 只更新1行（快）</span>
users.<span class="hljs-property">value</span>[<span class="hljs-number">5</span>].<span class="hljs-property">name</span> = <span class="hljs-string">'新名字'</span>  <span class="hljs-comment">// &lt;1ms</span>
</code></pre>
<hr/>
<h3 data-id="heading-35">给初学者的学习路径建议</h3>
<h4 data-id="heading-36">第一步：打好基础（2-4周）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 理解原生DOM操作 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"handleClick()"</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 手动更新DOM</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'result'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">'已点击'</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-37">第二步：学习前后端分离（2-3周）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 掌握Fetch API</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    
    <span class="hljs-comment">// 手动更新界面</span>
    <span class="hljs-title function_">renderData</span>(data)
}
</code></pre>
<h4 data-id="heading-38">第三步：拥抱响应式（3-6周）</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 从简单的计数器开始 --&gt;
&lt;script setup&gt;
const count = ref(0)
&lt;/script&gt;

&lt;template&gt;
    &lt;button @click="count++"&gt;
        点击了 {{ count }} 次
    &lt;/button&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-39">第四步：深入理解原理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 尝试自己实现简单的响应式系统</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReactive</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(obj, {
        <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key</span>) {
            <span class="hljs-title function_">track</span>(target, key)  <span class="hljs-comment">// 依赖收集</span>
            <span class="hljs-keyword">return</span> target[key]
        },
        <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, value</span>) {
            target[key] = value
            <span class="hljs-title function_">trigger</span>(target, key)  <span class="hljs-comment">// 触发更新</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        }
    })
}
</code></pre>
<hr/>
<h3 data-id="heading-40">未来展望与趋势</h3>
<h4 data-id="heading-41">1. <strong>编译时优化</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 3 的 `&lt;script setup&gt;` 编译时优化</span>
<span class="hljs-comment">// 更小的打包体积，更好的性能</span>

<span class="hljs-comment">// React Server Components</span>
<span class="hljs-comment">// 服务器端组件，减少客户端代码</span>
</code></pre>
<h4 data-id="heading-42">2. <strong>跨平台统一</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 同一套代码，多端运行 --&gt;
&lt;template&gt;
    &lt;!-- Web、小程序、Native共用 --&gt;
    &lt;view @click="handleClick"&gt;
        {{ message }}
    &lt;/view&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-43">3. <strong>TypeScript 深度集成</strong></h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 完整的类型安全</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>
}

<span class="hljs-keyword">const</span> users = ref&lt;<span class="hljs-title class_">User</span>[]&gt;([])  <span class="hljs-comment">// 类型检查</span>
</code></pre>
<h4 data-id="heading-44">4. <strong>微前端架构</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 大型应用拆分为多个子应用</span>
<span class="hljs-comment">// 每个子应用可以使用不同技术栈</span>
<span class="hljs-comment">// 独立开发、部署、运行</span>
</code></pre>
<hr/>
<h3 data-id="heading-45">结语</h3>
<p>从纯后端模板到响应式数据驱动，Web 开发的演进始终围绕一个核心目标：<strong>让开发者更专注于业务逻辑，而不是技术细节</strong>。</p>
<p><strong>响应式不是银弹，但它是最优雅的解决方案之一。</strong> 它解决了前端开发中最痛苦的问题：数据与视图的同步。通过声明式的编程模型、自动的依赖跟踪、高效的更新策略，响应式框架让我们能够以更少的代码实现更复杂的功能。</p>
<p>作为初学者，理解这一演进历程非常重要。它不仅帮助你理解为什么需要这些工具，更让你明白如何选择合适的工具。记住：最好的技术不是最复杂的，而是让你忘记技术本身，专注于创造价值的那一个。</p>
<p><strong>开始你的响应式之旅吧，从今天开始，让数据驱动你的界面，而不是让 DOM 操作占据你的时间！</strong></p>
<hr/>
<p><em>本文通过详细的代码对比展示了 Web 开发的完整演进历程。建议读者动手运行每个示例代码，亲自体验不同阶段的开发感受。只有真正经历过 DOM 操作的繁琐，才能深刻理解响应式编程的价值。学习之路漫长，但每一步都算数。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建无障碍组件之Alert Dialog Pattern]]></title>    <link>https://juejin.cn/post/7603911453704028203</link>    <guid>https://juejin.cn/post/7603911453704028203</guid>    <pubDate>2026-02-08T08:43:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603911453704028203" data-draft-id="7603911453704011819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建无障碍组件之Alert Dialog Pattern"/> <meta itemprop="keywords" content="前端,HTML,交互设计"/> <meta itemprop="datePublished" content="2026-02-08T08:43:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="anOnion"/> <meta itemprop="url" content="https://juejin.cn/user/553809592722589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建无障碍组件之Alert Dialog Pattern
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/553809592722589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    anOnion
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-08T08:43:54.000Z" title="Sun Feb 08 2026 08:43:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Alert Dialog Pattern 详解：构建无障碍中断式对话框</h2>
<p>Alert Dialog 是 Web 无障碍交互的重要组件。本文详解其 WAI-ARIA 实现要点，涵盖角色声明、键盘交互、最佳实践，助你打造中断式对话框，让关键信息触达每位用户。</p>
<h3 data-id="heading-1">一、Alert Dialog 的定义与核心功能</h3>
<p>Alert Dialog（警告对话框）是一种模态对话框，它会中断用户的工作流程以传达重要信息并获取响应。与普通的 Alert 通知不同，Alert Dialog 需要用户明确与之交互后才能继续其他操作。这种设计适用于需要用户立即关注和做出决定的场景。</p>
<p>在实际应用中，Alert Dialog 广泛应用于各种需要用户确认或紧急通知的场景。例如，删除操作前的确认提示、表单提交失败的错误确认、离开页面时的未保存更改提醒等。这些场景都需要用户明确响应才能继续操作，因此 Alert Dialog 成为最佳选择。</p>
<h3 data-id="heading-2">二、Alert Dialog 的特性与注意事项</h3>
<p>Alert Dialog 组件具有几个重要的特性，这些特性决定了它的适用场景和实现方式。首先，Alert Dialog 会获取键盘焦点，确保用户的注意力集中在对话框上。其次，Alert Dialog 通常会阻止用户与页面的其他部分交互，直到用户关闭对话框。这种模态特性确保了用户必须处理重要信息才能继续操作。</p>
<p>Alert Dialog 组件的设计还需要考虑几个关键因素。首先，Alert Dialog 应该始终包含一个明确的关闭方式，如确认按钮或取消按钮。其次，对话框应该有一个清晰的标题，通过 <code>aria-labelledby</code> 或 <code>aria-label</code> 关联。另外，对话框的内容应该通过 <code>aria-describedby</code> 关联，以便屏幕阅读器能够正确读取完整信息。这些属性的正确使用对于无障碍体验至关重要。</p>
<h3 data-id="heading-3">三、WAI-ARIA 角色、状态和属性</h3>
<p>正确使用 WAI-ARIA 属性是构建无障碍 Alert Dialog 组件的技术基础。Alert Dialog 组件的 ARIA 要求包含多个属性的配合使用。</p>
<p><code>role="alertdialog"</code> 是 Alert Dialog 组件的必需属性，它向辅助技术表明这个元素是一个警告对话框。这个属性使浏览器和辅助技术能够将 Alert Dialog 与其他类型的对话框区分开来，从而提供特殊的处理方式，如播放系统提示音。</p>
<p><code>aria-labelledby</code> 或 <code>aria-label</code> 用于标识对话框的标题。如果对话框有可见的标题标签，应该使用 <code>aria-labelledby</code> 引用该标题元素；如果没有可见标题，则使用 <code>aria-label</code> 提供标签。</p>
<p><code>aria-describedby</code> 用于引用包含警告消息的元素。这确保屏幕阅读器能够朗读完整的对话框内容，包括详细的说明和操作提示。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- Alert Dialog 基本结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm-dialog"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>确认删除<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>您确定要删除这个文件吗？此操作无法撤销。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>确认删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cancel"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<p>值得注意的是，Alert Dialog 与普通 Dialog 的主要区别在于 Alert Dialog 用于紧急或重要信息，并且通常包含确认/取消按钮。用户无法忽略 Alert Dialog，必须做出响应才能继续操作。</p>
<h3 data-id="heading-4">四、键盘交互规范</h3>
<p>Alert Dialog 的键盘交互遵循模态对话框的交互模式。用户可以通过多种方式与 Alert Dialog 进行交互。</p>
<ul>
<li><code>Enter</code> 或 <code>Space</code> 用于激活默认按钮，通常是对话框中的主要操作按钮。</li>
<li><code>Tab</code> 键用于在对话框内的焦点元素之间切换，焦点会循环停留 在对话框内部。</li>
<li><code>Escape</code> 键通常用于关闭对话框，相当于点击取消按钮。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ESC 键关闭对话框示例</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Escape'</span> &amp;&amp; dialog.<span class="hljs-property">open</span>) {
    dialog.<span class="hljs-title function_">close</span>();
  }
});
</code></pre>
<p>焦点管理是 Alert Dialog 的关键部分。当对话框打开时，焦点应该立即移动到对话框内部或默认按钮上。当对话框关闭时，焦点应该返回到打开对话框的元素。这种焦点管理确保了键盘用户能够保持其工作上下文。</p>
<h3 data-id="heading-5">五、完整示例</h3>
<p>以下是一个完整的 Alert Dialog 实现示例，展示了正确的 HTML 结构、ARIA 属性和焦点管理。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm-dialog"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>确认删除<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>您确定要删除这个文件吗？此操作无法撤销。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialog-actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-ghost"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">"cancel"</span>&gt;</span>
        取消
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-error"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>
        删除
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">button</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"delete-btn"</span>
  <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-error"</span>&gt;</span>
  删除文件
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> dialog = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'confirm-dialog'</span>);
  <span class="hljs-keyword">const</span> deleteBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'delete-btn'</span>);
  <span class="hljs-keyword">let</span> previousActiveElement;

  deleteBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    previousActiveElement = <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>;
    dialog.<span class="hljs-title function_">showModal</span>();
  });

  dialog.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'close'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (dialog.<span class="hljs-property">returnValue</span> === <span class="hljs-string">'confirm'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'文件已删除'</span>);
    }
    previousActiveElement.<span class="hljs-title function_">focus</span>();
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">六、最佳实践</h3>
<h4 data-id="heading-7">6.1 实现方式对比</h4>
<p>Alert Dialog 可以通过两种方式实现：使用 <code>div</code> 配合 ARIA 属性，或使用原生 <code>&lt;dialog&gt;</code> 元素。</p>
<h5 data-id="heading-8">传统方式（div + ARIA）</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-modal</span>=<span class="hljs-string">"true"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>确认删除<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>您确定要删除这个文件吗？<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>确认<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>这种方式需要开发者手动处理焦点管理、ESC 键关闭、背景锁定等逻辑。</p>
<h5 data-id="heading-9">推荐方式（原生 dialog）</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>
  <span class="hljs-attr">aria-labelledby</span>=<span class="hljs-string">"dialog-title"</span>
  <span class="hljs-attr">aria-describedby</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-title"</span>&gt;</span>确认删除<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dialog-desc"</span>&gt;</span>您确定要删除这个文件吗？<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"confirm"</span>&gt;</span>确认<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cancel"</span>&gt;</span>取消<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<p>HTML 原生 <code>&lt;dialog&gt;</code> 元素简化了实现，它提供了：</p>
<ul>
<li>自动焦点管理</li>
<li>内置 ESC 键支持</li>
<li>自动模态背景</li>
<li>内置 ARIA 属性</li>
</ul>
<p><code>&lt;dialog&gt;</code> 元素的默认 <code>role</code> 是 <code>dialog</code>，表示普通对话框。对于 Alert Dialog，需要显式设置 <code>role="alertdialog"</code> 来告诉辅助技术这是一个需要紧急处理的对话框，从而获得系统提示音等特殊处理。</p>
<h4 data-id="heading-10">6.2 焦点管理</h4>
<p>正确的焦点管理对于键盘用户和无障碍体验至关重要。打开对话框时，焦点应该移动到对话框内部或默认按钮。关闭对话框时，焦点应该返回到触发对话框的元素。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 焦点管理最佳实践</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">openDialog</span>(<span class="hljs-params">dialog</span>) {
  <span class="hljs-keyword">const</span> previousFocus = <span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span>;
  dialog.<span class="hljs-title function_">showModal</span>();

  <span class="hljs-comment">// 移动焦点到对话框内</span>
  <span class="hljs-keyword">const</span> focusableElements = dialog.<span class="hljs-title function_">querySelectorAll</span>(
    <span class="hljs-string">'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'</span>,
  );
  <span class="hljs-keyword">if</span> (focusableElements.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    focusableElements[<span class="hljs-number">0</span>].<span class="hljs-title function_">focus</span>();
  }

  <span class="hljs-comment">// 保存关闭时的焦点元素</span>
  dialog.<span class="hljs-property">dataset</span>.<span class="hljs-property">previousFocus</span> = previousFocus;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">closeDialog</span>(<span class="hljs-params">dialog</span>) {
  dialog.<span class="hljs-title function_">close</span>();
  <span class="hljs-keyword">const</span> previousFocus = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(
    <span class="hljs-string">`[data-focus-id="<span class="hljs-subst">${dialog.dataset.focusId}</span>"]`</span>,
  );
  <span class="hljs-keyword">if</span> (previousFocus) {
    previousFocus.<span class="hljs-title function_">focus</span>();
  }
  dialog.<span class="hljs-title function_">remove</span>();
}
</code></pre>
<h4 data-id="heading-11">6.3 避免过度使用</h4>
<p>Alert Dialog 会中断用户的工作流程，因此应该谨慎使用。只有在真正需要用户立即响应的情况下才使用 Alert Dialog。对于非紧急信息，应该考虑使用普通的 Alert 或 Toast 通知。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 不推荐：过度使用 Alert Dialog --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">open</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>提示<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您的设置已保存。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"this.closest('dialog').close()"</span>&gt;</span>确定<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 推荐：使用普通 Alert --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">role</span>=<span class="hljs-string">"alert"</span>&gt;</span>您的设置已保存。<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">6.4 屏幕阅读器兼容性</h4>
<p>确保 <code>&lt;dialog&gt;</code> 对屏幕阅读器用户友好。<code>&lt;dialog&gt;</code> 元素内置了无障碍支持，但仍然建议对 Alert Dialog 设置 <code>role="alertdialog"</code> 来区分紧急对话框。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 屏幕阅读器友好的 dialog --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dialog</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">"session-dialog"</span>
  <span class="hljs-attr">role</span>=<span class="hljs-string">"alertdialog"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"dialog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>重要提醒<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>您的会话将在 5 分钟后过期。请尽快保存您的工作。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"actions"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"continue"</span>&gt;</span>继续使用<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"exit"</span>&gt;</span>退出<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dialog</span>&gt;</span>
</code></pre>
<h3 data-id="heading-13">七、Alert 与 Alert Dialog 的区别</h3>
<p>理解 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falert%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alert/" ref="nofollow noopener noreferrer">Alert</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falertdialog%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/" ref="nofollow noopener noreferrer">Alert Dialog</a> 的区别对于正确选择通知组件至关重要。虽然两者都是用于传达重要信息，但它们服务于不同的目的和使用场景。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falert%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alert/" ref="nofollow noopener noreferrer">Alert</a> 是一种被动通知组件，它不需要用户进行任何交互操作。Alert 会在不被中断用户工作流程的前提下自动通知用户重要信息。用户可以继续当前的工作，Alert 只是在视觉和听觉上提供通知。这种设计适用于不紧急、不需要用户立即响应的信息，例如操作成功确认、后台处理完成通知等。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falertdialog%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/" ref="nofollow noopener noreferrer">Alert Dialog</a> 则是一种需要用户主动响应的对话框组件。当用户需要做出决定或者提供确认时，应该使用 Alert Dialog。Alert Dialog 会中断用户的工作流程，获取键盘焦点，要求用户必须与之交互才能继续其他操作。这种设计适用于紧急警告、确认删除操作、放弃更改确认等需要用户明确响应的场景。</p>
<p>选择建议：如果信息需要用户立即响应并做出决定，使用 Alert Dialog；如果只是被动通知信息，使用 Alert。</p>
<h3 data-id="heading-14">八、总结</h3>
<p>构建无障碍的对话框组件需要关注元素选择、焦点管理、键盘交互三个层面的细节。从元素选择角度，推荐优先使用原生 <code>&lt;dialog&gt;</code> 元素，它内置了无障碍支持和焦点管理。从焦点管理角度，需要确保打开和关闭时焦点的正确移动。从用户体验角度，应该避免过度使用对话框，只在真正需要用户响应时使用。</p>
<p>WAI-ARIA <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FWAI%2FARIA%2Fapg%2Fpatterns%2Falertdialog%2F" target="_blank" title="https://www.w3.org/WAI/ARIA/apg/patterns/alertdialog/" ref="nofollow noopener noreferrer">Alert Dialog Pattern</a> 为我们提供了清晰的指导方针，遵循这些规范能够帮助我们创建更加包容和易用的 Web 应用。每一个正确实现的对话框，都是提升用户体验和确保重要信息有效传达的重要一步。</p>
<p>文章同步于 an-Onion 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fan-Onion%2Fan-Onion.github.io" target="_blank" title="https://github.com/an-Onion/an-Onion.github.io" ref="nofollow noopener noreferrer">Github</a>。码字不易，欢迎点赞。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>