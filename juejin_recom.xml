<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[uniapp BLE低功耗蓝牙插件 支持安卓 iOS 鸿蒙NEXT 微信小程序]]></title>    <link>https://juejin.cn/post/7582003642190872618</link>    <guid>https://juejin.cn/post/7582003642190872618</guid>    <pubDate>2025-12-10T08:13:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582003642190872618" data-draft-id="7581876069608521771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniapp BLE低功耗蓝牙插件 支持安卓 iOS 鸿蒙NEXT 微信小程序"/> <meta itemprop="keywords" content="uni-app,蓝牙"/> <meta itemprop="datePublished" content="2025-12-10T08:13:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lvha"/> <meta itemprop="url" content="https://juejin.cn/user/4286335910412464"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniapp BLE低功耗蓝牙插件 支持安卓 iOS 鸿蒙NEXT 微信小程序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4286335910412464/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lvha
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:13:53.000Z" title="Wed Dec 10 2025 08:13:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fext.dcloud.net.cn%2Fplugin%3Fid%3D24675" target="_blank" title="https://ext.dcloud.net.cn/plugin?id=24675" ref="nofollow noopener noreferrer">xl-ble插件</a></p>
<h2 data-id="heading-0">概述</h2>
<p>本SDK提供了一套完整的蓝牙低功耗(BLE)设备交互接口，采用模块化设计，将功能接口与回调监听分离，便于开发者灵活使用。</p>
<ul>
<li>
<p>支持蓝牙扫描、连接、断开;</p>
</li>
<li>
<p>支持字节数据、字符串数据写入;</p>
</li>
<li>
<p>蓝牙状态监听、连接状态监听、数据回传监听、数据写入是否完成监听;</p>
</li>
<li>
<p>支持GBK编码;</p>
</li>
</ul>
<h2 data-id="heading-1">导入</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> ble <span class="hljs-keyword">from</span> <span class="hljs-string">'@/uni_modules/xl-ble'</span>;
</code></pre>
<h2 data-id="heading-2">功能接口说明</h2>
<h4 data-id="heading-3">扫描设备</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// callback: 发现设备回调</span>
ble.<span class="hljs-title function_">startScan</span>(<span class="hljs-function">(<span class="hljs-params">device</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`发现设备: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(device)}</span>`</span>);
});
</code></pre>
<h4 data-id="heading-4">停止扫描</h4>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">stopScan</span>();
</code></pre>
<h4 data-id="heading-5">连接设备</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 参数1: 设备id</span>
<span class="hljs-comment">// 参数2(可选):指定服务与特征，未指定内部会自动匹配</span>
ble.<span class="hljs-title function_">connect</span>(
  deviceId,
  <span class="hljs-comment">// {</span>
  <span class="hljs-comment">// 	seviceUuid: '0000ff00-0000-1000-8000-00805f9b34fb',</span>
  <span class="hljs-comment">// 	writeUuid: '0000ff02-0000-1000-8000-00805f9b34fb',</span>
  <span class="hljs-comment">// 	notifyUuid: '0000ff01-0000-1000-8000-00805f9b34fb'</span>
  <span class="hljs-comment">// },</span>
)
</code></pre>
<h4 data-id="heading-6">断开设备</h4>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">disconnect</span>()
</code></pre>
<h4 data-id="heading-7">写入数据</h4>
<ul>
<li>
<p>写入字节数组</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 参数为字节数组，需设备支持的指令，这点很重要</span>
ble.<span class="hljs-title function_">writeBytes</span>([<span class="hljs-number">0x10</span>, <span class="hljs-number">0xff</span>, <span class="hljs-number">0x30</span>])
</code></pre>
</li>
<li>
<p>写入字符串</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 参数1: 字符串内容，传的字符串需设备支持的指令，这点很重要</span>
<span class="hljs-comment">// 参数2(可选): 字符串编码, 默认 "UTF_8" 编码, 传 "GBK" 使用GBK编码</span>
ble.<span class="hljs-title function_">writeString</span>(<span class="hljs-string">'ABC'</span>)
ble.<span class="hljs-title function_">writeString</span>(<span class="hljs-string">'ABC'</span>, <span class="hljs-string">'GBK'</span>)
</code></pre>
</li>
</ul>
<h4 data-id="heading-8">设置MTU分包大小</h4>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">setMtu</span>(<span class="hljs-number">100</span>)
</code></pre>
<h4 data-id="heading-9">蓝牙事件监听</h4>
<h5 data-id="heading-10">蓝牙状态监听</h5>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">onBluetoothStatusChanged</span>(<span class="hljs-function">(<span class="hljs-params">isOn</span>) =&gt;</span> {
  uni.<span class="hljs-title function_">showToast</span>({
    <span class="hljs-attr">title</span>: isOn ? <span class="hljs-string">"蓝牙已开启"</span> : <span class="hljs-string">"蓝牙已关闭"</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>
  });
});
</code></pre>
<h5 data-id="heading-11">蓝牙连接状态监听</h5>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">onConnectionStateChange</span>(<span class="hljs-function">(<span class="hljs-params">connectionState</span>) =&gt;</span> {
  uni.<span class="hljs-title function_">showToast</span>({
    <span class="hljs-attr">title</span>: connectionState.<span class="hljs-property">msg</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>
  })
  <span class="hljs-keyword">switch</span> (connectionState.<span class="hljs-property">state</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'connectFail'</span>:
				<span class="hljs-comment">// 连接失败</span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'disconnected'</span>:
				<span class="hljs-comment">// 断开连接</span>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'connected'</span>:
      <span class="hljs-comment">// 断开成功</span>
      <span class="hljs-keyword">break</span>;
  }
});
</code></pre>
<h5 data-id="heading-12">蓝牙数据回传监听</h5>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">onDataReceived</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> result = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(...data);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`收到蓝牙数据: <span class="hljs-subst">${data}</span>`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`收到蓝牙数据转字符串: <span class="hljs-subst">${result}</span>`</span>);
});

</code></pre>
<h5 data-id="heading-13">数据写入是否完成监听</h5>
<pre><code class="hljs language-javascript" lang="javascript">ble.<span class="hljs-title function_">onWriteComplete</span>(<span class="hljs-function">(<span class="hljs-params">isComplete</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(isComplete ? <span class="hljs-string">"写入完成"</span> : <span class="hljs-string">"写入失败"</span>);
})
</code></pre>
<h4 data-id="heading-14">蓝牙权限</h4>
<ul>
<li>
<p><strong>安卓</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_ADMIN"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_CONNECT"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_SCAN"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_COARSE_LOCATION"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.BLUETOOTH_SCAN"</span> /&gt;</span>
</code></pre>
</li>
<li>
<p><strong>iOS</strong></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSBluetoothAlwaysUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>开启蓝牙<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSBluetoothPeripheralUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>蓝牙<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIBackgroundModes<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>bluetooth-central<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-15">类型定义</h2>
<h3 data-id="heading-16">设备信息</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">BLEDevice</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>       <span class="hljs-comment">// 设备名称</span>
  <span class="hljs-attr">deviceId</span>: <span class="hljs-built_in">string</span>   <span class="hljs-comment">// 设备唯一标识</span>
  <span class="hljs-attr">rssi</span>: <span class="hljs-built_in">number</span>       <span class="hljs-comment">// 信号强度</span>
}
</code></pre>
<h3 data-id="heading-17">连接配置</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ConnectOptions</span> {
  <span class="hljs-attr">serviceUuid</span>: <span class="hljs-built_in">string</span>   <span class="hljs-comment">// 主服务UUID</span>
  <span class="hljs-attr">writeUuid</span>: <span class="hljs-built_in">string</span>     <span class="hljs-comment">// 写入特征UUID</span>
  <span class="hljs-attr">notifyUuid</span>: <span class="hljs-built_in">string</span>    <span class="hljs-comment">// 通知特征UUID</span>
  autoConnect?: <span class="hljs-built_in">boolean</span> <span class="hljs-comment">// 是否自动重连</span>
}
</code></pre>
<h3 data-id="heading-18">服务信息</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ServiceAndCharacteristics</span> {
  <span class="hljs-attr">service</span>: <span class="hljs-built_in">string</span>         <span class="hljs-comment">// 服务UUID</span>
  <span class="hljs-attr">characteristics</span>: <span class="hljs-built_in">string</span>[] <span class="hljs-comment">// 特征值列表</span>
}
</code></pre>
<h3 data-id="heading-19">连接状态</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ConnectionState</span> = {
  <span class="hljs-attr">status</span>: <span class="hljs-string">'connected'</span> | <span class="hljs-string">'disconnected'</span> | <span class="hljs-string">'failed'</span>
  message?: <span class="hljs-built_in">string</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Local Network Access]]></title>    <link>https://juejin.cn/post/7581999251367411764</link>    <guid>https://juejin.cn/post/7581999251367411764</guid>    <pubDate>2025-12-10T08:19:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581999251367411764" data-draft-id="7581999251367329844" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Local Network Access"/> <meta itemprop="keywords" content="前端,浏览器"/> <meta itemprop="datePublished" content="2025-12-10T08:19:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CrabSAMA"/> <meta itemprop="url" content="https://juejin.cn/user/3046090748465480"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Local Network Access
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3046090748465480/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CrabSAMA
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:19:07.000Z" title="Wed Dec 10 2025 08:19:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>LNA 是 chrome 从 142 版本开始默认启用的一个功能，简单来说，LNA 出于保护本地服务的目的，会阻拦公网网站向本地网络发起的请求。本地网络的概念可以参考这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fwicg.github.io%2Flocal-network-access%2F%23non-public-ip-address-blocks" target="_blank" title="https://wicg.github.io/local-network-access/#non-public-ip-address-blocks" ref="nofollow noopener noreferrer">链接</a>。</p>
<blockquote>
<p>一些参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fblog%2Flocal-network-access%3Fhl%3Dzh-cn" target="_blank" title="https://developer.chrome.com/blog/local-network-access?hl=zh-cn" ref="nofollow noopener noreferrer">chrome blog</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fchromestatus.com%2Ffeature%2F5152728072060928" target="_blank" title="https://chromestatus.com/feature/5152728072060928" ref="nofollow noopener noreferrer">chrome status</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1QQkqehw8umtAgz5z0um7THx-aoU251p705FbIQjDuGs%2Fedit%3Ftab%3Dt.0%23heading%3Dh.v8oobsqxbxxy" target="_blank" title="https://docs.google.com/document/d/1QQkqehw8umtAgz5z0um7THx-aoU251p705FbIQjDuGs/edit?tab=t.0#heading=h.v8oobsqxbxxy" ref="nofollow noopener noreferrer">LNA Adoption Guide</a></p>
</blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[公网网站页面] --&gt;|发起请求| B[请求本地网络服务]
    B --&gt; C{LNA 策略生效?}
    C --&gt;|否| D[请求成功]
    C --&gt;|是| E{是否允许 local-network-access?}
    E --&gt;|允许| D
    E --&gt;|拒绝或未授予| F[请求被阻止&lt;br/&gt;显示权限提示框或错误信息]
</code></pre>
<p>如上图所示，当公网页面尝试访问本地网络服务时，Chrome 会根据 LNA 策略判断是否需要拦截，并根据用户是否授予 <code>local-network-access</code> 权限来决定请求最终是否能被执行。</p>
<p>一般来说，在公司内部有不少系统都会受到这个策略的影响。当前可以分为几种情况。</p>
<h2 data-id="heading-0">Navigating subframes 导航子帧</h2>
<p>举个最简单的例子，公司内部会用到飞书的 SSO 授权登录，当飞书登录成功后会回调回来内部系统的网站，内部系统的网站是部署在 172 网段的，这就是一个很典型的外网访问内网请求的 case。在 chrome 142 版本后，这种情况就会被 LNA 阻拦掉，现象如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/756d5e8d13fc4bf9ad9ba8c6127ce45e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3JhYlNBTUE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959547&amp;x-signature=hR8Y1TpbaW4bWbzPpK%2Fjo1EUdW4%3D" alt="image-20251210144745560.png" loading="lazy"/>
提示「此连接已被阻止，因为它是公共页面发起的，旨在连接到您本地网络上的设备或服务器」。</p>
<p>我们可以在采用指南上找到如下描述：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/350c616be26d42bc9d08ac6c596cc271~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3JhYlNBTUE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959547&amp;x-signature=K%2BC%2BAeZAALb1OtaoMxROKPsxQwg%3D" alt="img_v3_02sr_9f747062-2e81-4232-b844-403f0d3c445g.jpg" loading="lazy"/></p>
<p>针对这种情况，我们需要将内网地址和外网地址都部署在 https 下，然后给 iframe 添加 <code>allow="local-network-access"</code> 相关属性，此时当再次发生跳转的时候，就会弹出提示请求权限：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a4868be501e4a70b2950de1e2280079~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3JhYlNBTUE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959547&amp;x-signature=%2FtIVqWQlKf6LFnNR4FHEruzeJ7k%3D" alt="显示“查找并连接到本地网络上的任何设备”文本的提示。" loading="lazy"/></p>
<p>此时只要用户允许了这个权限，我们就能和以前一样正常进行跳转。但如果用户拒绝了，跳转将被阻止，出现和上面一样的错误。</p>
<h2 data-id="heading-1">资源请求</h2>
<p>针对一些资源的请求（image/video等）和 fetch 请求，也会被 LNA 限制。</p>
<p>和上面聊到的一样，当发起此类请求的时候会有权限请求的提示框，如果权限没有被授予，此类请求就会被禁止请求，并在控制台中显示 CORS 错误。</p>
<h2 data-id="heading-2">最佳实践</h2>
<p>针对用户权限请求，和其他权限（麦克风、定位等）请求一样，我们需要在用户请求前给予提示，引导用户允许请求，如果判断到用户拒绝了权限，也做一个优雅的降级，阻断当前行为并提示用户这个权限的重要性，并告诉用户如何重置权限（因为当前浏览器并没有提供编程式重置权限的途径，需要用户手动重置）。</p>
<p>这相关的内容在 web 体验优化相关的文章中会提到，可以自行展开研究。</p>
<p>由于 LNA 一般影响面最大在企业内部，企业也可以通过策略的方式，调整 <code>LocalNetworkAccessAllowedForUrls</code> 和 <code>LocalNetworkAccessBlockedForUrls</code> 两个参数来针对性的开放或拦截。使用通配符的方式，可以一次性将公司的二级域名都匹配上，一次性解决问题。</p>
<p>临时的解决方案也可以通过访问 <code>chrome://flags</code>，将 <code>Local Network Access Checks</code> 这一项 disabled 掉，也能临时解决问题。但是建议还是针对 LNA 做相关的适配，也许以后这个功能就常驻开放了。</p>
<hr/>
<p>总的来说，LNA 这个功能的出发点是好的，针对大多数普通浏览器用户可以有效地减少被攻击的可能性，对于有可能遭受影响的企业用户，也有提供对应的解决方案去解决，就是需要开发者针对这个 case 来进行一些适配，作为开发者的我们可以多关注一下 chrome 的一些新特性，等到用户反馈遇到情况再去修复就晚啦。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[字符串方法手写实现：从模板解析到Unicode处理]]></title>    <link>https://juejin.cn/post/7581858890607607844</link>    <guid>https://juejin.cn/post/7581858890607607844</guid>    <pubDate>2025-12-10T08:23:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581858890607607844" data-draft-id="7581858890607591460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="字符串方法手写实现：从模板解析到Unicode处理"/> <meta itemprop="keywords" content="前端,JavaScript,ECMAScript 6"/> <meta itemprop="datePublished" content="2025-12-10T08:23:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024肥宅"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            字符串方法手写实现：从模板解析到Unicode处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024肥宅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:23:29.000Z" title="Wed Dec 10 2025 08:23:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">引言</h4>
<p>在JavaScript开发中，字符串操作无处不在。尽管现代JavaScript已经提供了丰富的字符串方法，但理解其底层原理并能够手动实现它们，是提升编程能力和解决复杂问题的关键。本文将深入探讨模板字符串解析、正则表达式方法、字符串加密算法以及Unicode编码处理，并在此基础上补充字符串基础操作、性能优化等实用内容。</p>
<h4 data-id="heading-1">一、模版字符串解析</h4>
<h5 data-id="heading-2">1.1 模版字符串基础</h5>
<p>ES6引入的模版字符串使用反引号(`)定义，支持多行字符串和字符串插值。例如:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> name = <span class="hljs-string">'Admin'</span>;
<span class="hljs-keyword">const</span> greeting = <span class="hljs-string">`Hi, <span class="hljs-subst">${name}</span>, Welcome!`</span>
</code></pre>
<h5 data-id="heading-3">1.2 手写模版字符串解析</h5>
<p>虽然JavaScript引擎内置了模版字符串解析，但我们可以手动实现一个简化版:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseTemplate</span>(<span class="hljs-params">strings, ...values</span>) {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; strings.<span class="hljs-property">length</span>; i++) {
    result += strings[i];
    <span class="hljs-keyword">if</span> (i &lt; values.<span class="hljs-property">length</span>) {
      result += values[i];
    }
  }
  <span class="hljs-keyword">return</span> result;
}
<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-string">"张三"</span>;
<span class="hljs-keyword">const</span> age = <span class="hljs-number">25</span>;
<span class="hljs-keyword">const</span> str = parseTemplate<span class="hljs-string">`姓名：<span class="hljs-subst">${name}</span>，年龄：<span class="hljs-subst">${age}</span>`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(str); <span class="hljs-comment">// 输出：姓名：张三，年龄：25</span>
</code></pre>
<h5 data-id="heading-4">1.3 标签函数的高级应用</h5>
<p>标签函数可以自定义模版字符串的解析行为。以下时防止XSS攻击的转义函数实现:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeHTML</span>(<span class="hljs-params">strings, ...values</span>) {
  <span class="hljs-keyword">return</span> strings.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">result, str, i</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> value = values[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> escapedValue = <span class="hljs-title class_">String</span>(value)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&amp;/g</span>, <span class="hljs-string">"&amp;amp;"</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">"&amp;lt;"</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">"&amp;gt;"</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">"&amp;quot;"</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">"&amp;#39;"</span>);
    <span class="hljs-keyword">return</span> result + escapedValue + str;
  });
}
<span class="hljs-keyword">const</span> userInput = <span class="hljs-string">'&lt;script&gt;alert("XSS Attack!")&lt;/script&gt;'</span>;
<span class="hljs-keyword">const</span> safeHTML = escapeHTML<span class="hljs-string">`用户输入：<span class="hljs-subst">${userInput}</span>`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(safeHTML); <span class="hljs-comment">// 输出：用户输入：&amp;lt;script&amp;gt;alert(&amp;quot;XSS Attack!&amp;quot;)&amp;lt;/script&amp;gt;</span>
</code></pre>
<h4 data-id="heading-5">二、正则表达式相关方法</h4>
<h5 data-id="heading-6">2.1 正则表达式基础</h5>
<p>正则表达式有两种创建方式: 字面量(<code>/abc/</code>)和构造函数(<code>new RegExp('abc')</code>)。正则表达式由模式和标志两部分组成，常见标志包括<code>i</code>(不区分大小写)、<code>g</code>(全局匹配)等。</p>
<h5 data-id="heading-7">2.2 手写正则表达式方法</h5>
<h6 data-id="heading-8">2.2.1 test()方法实现</h6>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myTest</span>(<span class="hljs-params">regex, str</span>) {
  <span class="hljs-comment">// 简单的test实现，仅支持非全局匹配</span>
  <span class="hljs-keyword">const</span> match = <span class="hljs-title function_">myExec</span>(regex, str);
  <span class="hljs-keyword">return</span> match !== <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">myExec</span>(<span class="hljs-params">regex, str</span>) {
  <span class="hljs-comment">// 简化版exec实现</span>
  <span class="hljs-keyword">const</span> pattern = regex.<span class="hljs-property">source</span>;
  <span class="hljs-keyword">const</span> flags = regex.<span class="hljs-property">flags</span>;

  <span class="hljs-comment">// 移除了全局标志以简化实现</span>
  <span class="hljs-keyword">const</span> localRegex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(pattern, flags.<span class="hljs-title function_">replace</span>(<span class="hljs-string">"g"</span>, <span class="hljs-string">""</span>));

  <span class="hljs-comment">// 使用原生RegExp进行匹配(实际实现会更复杂)</span>
  <span class="hljs-keyword">const</span> result = localRegex.<span class="hljs-title function_">exec</span>(str);
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> regex = <span class="hljs-regexp">/hello/i</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myTest</span>(regex, <span class="hljs-string">"Hello World"</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myTest</span>(regex, <span class="hljs-string">"Hi World"</span>)); <span class="hljs-comment">// false</span>
</code></pre>
<h6 data-id="heading-9">2.2.2 match()方法实现</h6>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myMatch</span>(<span class="hljs-params">str, regex</span>) {
  <span class="hljs-keyword">if</span> (!regex.<span class="hljs-property">global</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">myExec</span>(regex, str);
  }

  <span class="hljs-keyword">const</span> matches = [];
  <span class="hljs-keyword">let</span> match;
  <span class="hljs-keyword">let</span> lastIndex = <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 创建副本以避免修改原正则表达式的lastIndex</span>
  <span class="hljs-keyword">const</span> regexCopy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(regex.<span class="hljs-property">source</span>, regex.<span class="hljs-property">flags</span>);

  <span class="hljs-keyword">while</span> ((match = <span class="hljs-title function_">myExec</span>(regexCopy, str.<span class="hljs-title function_">slice</span>(lastIndex))) !== <span class="hljs-literal">null</span>) {
    matches.<span class="hljs-title function_">push</span>(match[<span class="hljs-number">0</span>]);
    lastIndex += match.<span class="hljs-property">index</span> + match[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>;
  }

  <span class="hljs-keyword">return</span> matches.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? matches : <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> str1 = <span class="hljs-string">"hello world hello universe"</span>;
<span class="hljs-keyword">const</span> regex1 = <span class="hljs-regexp">/hello/gi</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myMatch</span>(str1, regex1)); <span class="hljs-comment">// ['hello', 'hello']</span>
</code></pre>
<h5 data-id="heading-10">2.3 Unicode属性转义</h5>
<p>ES2018引入了Unicode属性转义，允许匹配具有特定Unicode属性的字符。例如, <code>\p{Script=Greek}</code>匹配希腊字母, <code>\p{White_Space}</code>匹配空白字符。使用时需要添加<code>u</code>标志:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 检查字符串是否只包含</span>
<span class="hljs-keyword">const</span> isWhitespace = <span class="hljs-regexp">/^\p{White_Space}+$/u</span>.<span class="hljs-title function_">test</span>(<span class="hljs-string">"\t \n\r"</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 删除所有字母</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-string">"1π2ü3é4"</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\p{Letter}/gu</span>, <span class="hljs-string">""</span>); <span class="hljs-comment">// 1234</span>
</code></pre>
<h4 data-id="heading-11">三、字符串加密/解密算法</h4>
<h5 data-id="heading-12">3.1 简单异或加密</h5>
<p>异或加密时最简单的加密算法之一, 利用异或运算的自反性(<code>a^b^b=a</code>)实现加解密:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">xorEncryptDecrypt</span>(<span class="hljs-params">text, key</span>) {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; text.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> charCode = text.<span class="hljs-title function_">charCodeAt</span>(i) ^ key.<span class="hljs-title function_">charCodeAt</span>(i % key.<span class="hljs-property">length</span>);
    result += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(charCode);
  }
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> plaintext = <span class="hljs-string">"Hello World"</span>;
<span class="hljs-keyword">const</span> key = <span class="hljs-string">"secret"</span>;
<span class="hljs-keyword">const</span> encrypted = <span class="hljs-title function_">xorEncryptDecrypt</span>(plaintext, key);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"加密结果:"</span>, encrypted);
<span class="hljs-comment">// 加密结果: ;�</span>
<span class="hljs-comment">// T$</span>
<span class="hljs-comment">// </span>
<span class="hljs-keyword">const</span> decrypted = <span class="hljs-title function_">xorEncryptDecrypt</span>(encrypted, key);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"解密结果:"</span>, decrypted);
<span class="hljs-comment">// 解密结果: Hello World</span>
</code></pre>
<p>注意: 异或加密强度较低, 如果密钥重复使用或长度不足, 容易被频率分析破解。仅适用于低安全需求场景。</p>
<h5 data-id="heading-13">3.2 基于Base64的简单加密</h5>
<p>对于需要文本安全传输的场景, 可以将加密后的二进制数据转换为Base64:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">simpleEncrypt</span>(<span class="hljs-params">text, password</span>) {
  <span class="hljs-comment">// 将文本和密码转换为UTF-8字节</span>
  <span class="hljs-keyword">const</span> textEncoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
  <span class="hljs-keyword">const</span> textBytes = textEncoder.<span class="hljs-title function_">encode</span>(text);
  <span class="hljs-keyword">const</span> passwordBytes = textEncoder.<span class="hljs-title function_">encode</span>(password);

  <span class="hljs-comment">// 使用异或加密</span>
  <span class="hljs-keyword">const</span> encryptedBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(textBytes.<span class="hljs-property">length</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; textBytes.<span class="hljs-property">length</span>; i++) {
    encryptedBytes[i] = textBytes[i] ^ passwordBytes[i % passwordBytes.<span class="hljs-property">length</span>];
  }

  <span class="hljs-comment">// 转换为Base64</span>
  <span class="hljs-keyword">let</span> binaryString = <span class="hljs-string">""</span>;
  encryptedBytes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">byte</span>) =&gt;</span> {
    binaryString += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(byte);
  });
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">btoa</span>(binaryString);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">simpleDecrypt</span>(<span class="hljs-params">base64Text, password</span>) {
  <span class="hljs-comment">// 从Base64解码</span>
  <span class="hljs-keyword">const</span> binaryString = <span class="hljs-title function_">atob</span>(base64Text);
  <span class="hljs-keyword">const</span> encryptedBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(binaryString.<span class="hljs-property">length</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; binaryString.<span class="hljs-property">length</span>; i++) {
    encryptedBytes[i] = binaryString.<span class="hljs-title function_">charCodeAt</span>(i);
  }

  <span class="hljs-comment">// 使用异或解密</span>
  <span class="hljs-keyword">const</span> textEncoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextEncoder</span>();
  <span class="hljs-keyword">const</span> passwordBytes = textEncoder.<span class="hljs-title function_">encode</span>(password);
  <span class="hljs-keyword">const</span> decryptedBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(encryptedBytes.<span class="hljs-property">length</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; encryptedBytes.<span class="hljs-property">length</span>; i++) {
    decryptedBytes[i] =
      encryptedBytes[i] ^ passwordBytes[i % passwordBytes.<span class="hljs-property">length</span>];
  }

  <span class="hljs-comment">// 转换回文本</span>
  <span class="hljs-keyword">const</span> textDecoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
  <span class="hljs-keyword">return</span> textDecoder.<span class="hljs-title function_">decode</span>(decryptedBytes);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> plaintext = <span class="hljs-string">"Hello World"</span>;
<span class="hljs-keyword">const</span> key = <span class="hljs-string">"secret"</span>;
<span class="hljs-keyword">const</span> encrypted = <span class="hljs-title function_">simpleEncrypt</span>(plaintext, key);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"加密结果:"</span>, encrypted); <span class="hljs-comment">// 加密结果: OwAPHgpUJAoRHgE=</span>
<span class="hljs-keyword">const</span> decrypted = <span class="hljs-title function_">simpleDecrypt</span>(encrypted, key);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"解密结果:"</span>, decrypted); <span class="hljs-comment">// 解密结果: Hello World</span>
</code></pre>
<h5 data-id="heading-14">3.3 实际应用建议</h5>
<p>对于生产环境, 建议使用成熟的加密库(如Web Crypto API)和标准算法(如AES-GCM), 而不是自行实现加密算法。</p>
<h4 data-id="heading-15">四、Unicode和编码处理</h4>
<h5 data-id="heading-16">4.1 Unicode基础概念</h5>
<p>理解一下概念对处理Unicode字符串至关重要:</p>
<ul>
<li><strong>JavaScript字符(UTF-16代码单元):</strong> 16位, 是JavaScript字符串索引的基本单位</li>
<li><strong>Unicode代码点:</strong> 32位, Unicode字符的唯一标识</li>
<li><strong>字素簇:</strong> 用户感知的字符, 可能由多个代码点组成</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript字符 vs 代码点 vs 字素簇</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'A'</span>.<span class="hljs-property">length</span>);        <span class="hljs-comment">// 1个JavaScript字符</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🙂'</span>.<span class="hljs-property">length</span>);       <span class="hljs-comment">// 2个JavaScript字符</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'café'</span>.<span class="hljs-property">length</span>);     <span class="hljs-comment">// 4个JavaScript字符</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'café'</span>.<span class="hljs-title function_">normalize</span>().<span class="hljs-property">length</span>); <span class="hljs-comment">// 仍然为4</span>
</code></pre>
<h5 data-id="heading-17">4.2 手写Unicode敏感方法</h5>
<h6 data-id="heading-18">4.2.1 按代码点分割字符串</h6>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">splitByCodePoints</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-keyword">const</span> codePoints = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; str.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> codeUnit = str.<span class="hljs-title function_">charCodeAt</span>(i);

    <span class="hljs-comment">// 检查是否为代理对的一部分(UTF-16)</span>
    <span class="hljs-keyword">if</span> (codeUnit &gt; -<span class="hljs-number">0xd800</span> &amp;&amp; codeUnit &lt;= <span class="hljs-number">0xdbff</span> &amp;&amp; i + <span class="hljs-number">1</span> &lt; str.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">const</span> nextCodeUnit = str.<span class="hljs-title function_">charCodeAt</span>(i + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (nextCodeUnit &gt;= <span class="hljs-number">0xdc00</span> &amp;&amp; nextCodeUnit &lt;= <span class="hljs-number">0xdfff</span>) {
        <span class="hljs-comment">// 代理对，组合成一个代码点</span>
        codePoints.<span class="hljs-title function_">push</span>(
          ((codeUnit - <span class="hljs-number">0xd800</span>) &lt;&lt; <span class="hljs-number">10</span>) + (nextCodeUnit - <span class="hljs-number">0xdc00</span>) + <span class="hljs-number">0x10000</span>
        );
        i++; <span class="hljs-comment">// 跳过下一个代码单元</span>
        <span class="hljs-keyword">continue</span>;
      }
    }

    codePoints.<span class="hljs-title function_">push</span>(codeUnit);
  }
  <span class="hljs-keyword">return</span> codePoints;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> str = <span class="hljs-string">"Hello🙂世界"</span>;
<span class="hljs-keyword">const</span> codePoints = <span class="hljs-title function_">splitByCodePoints</span>(str);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(codePoints); <span class="hljs-comment">// [72, 101, 108, 108, 111, 128578, 19990, 30028]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(codePoints.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">cp</span>) =&gt;</span> <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCodePoint</span>(cp)).<span class="hljs-title function_">join</span>(<span class="hljs-string">""</span>)); <span class="hljs-comment">// Hello🙂世界</span>
</code></pre>
<h6 data-id="heading-19">4.2.2 Unicode感知的字符串反转</h6>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">unicodeReverse</span>(<span class="hljs-params">str</span>) {
  <span class="hljs-comment">// 使用拓展字素簇分割</span>
  <span class="hljs-keyword">const</span> segments = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; str.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> codeUnit = str.<span class="hljs-title function_">charCodeAt</span>(i);

    <span class="hljs-comment">// 检查扩展字素簇边界（简化实现）</span>
    <span class="hljs-keyword">if</span> (codeUnit &gt;= <span class="hljs-number">0xd800</span> &amp;&amp; codeUnit &lt;= <span class="hljs-number">0xdbff</span> &amp;&amp; i + <span class="hljs-number">1</span> &lt; str.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">const</span> nextCodeUnit = str.<span class="hljs-title function_">charCodeAt</span>(i + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">if</span> (nextCodeUnit &gt;= <span class="hljs-number">0xdc00</span> &amp;&amp; nextCodeUnit &lt;= <span class="hljs-number">0xdfff</span>) {
        <span class="hljs-comment">// 代理对</span>
        segments.<span class="hljs-title function_">push</span>(str.<span class="hljs-title function_">substring</span>(i, i + <span class="hljs-number">2</span>));
        i++;
        <span class="hljs-keyword">continue</span>;
      }
    }

    <span class="hljs-comment">// 组合字符处理（简化）</span>
    <span class="hljs-keyword">if</span> (
      i + <span class="hljs-number">1</span> &lt; str.<span class="hljs-property">length</span> &amp;&amp;
      str.<span class="hljs-title function_">charCodeAt</span>(i + <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0x0300</span> &amp;&amp;
      str.<span class="hljs-title function_">charCodeAt</span>(i + <span class="hljs-number">1</span>) &lt;= <span class="hljs-number">0x036f</span>
    ) {
      <span class="hljs-comment">// 假设下一个字符是组合标记</span>
      segments.<span class="hljs-title function_">push</span>(str.<span class="hljs-title function_">substring</span>(i, i + <span class="hljs-number">2</span>));
      i++;
    } <span class="hljs-keyword">else</span> {
      segments.<span class="hljs-title function_">push</span>(str[i]);
    }
  }

  <span class="hljs-keyword">return</span> segments.<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">""</span>);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">unicodeReverse</span>(<span class="hljs-string">"café"</span>)); <span class="hljs-comment">// éfac</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">unicodeReverse</span>(<span class="hljs-string">"Hello🙂世界"</span>)); <span class="hljs-comment">// 界世🙂olleH</span>
</code></pre>
<h5 data-id="heading-20">4.3 编码转换实践</h5>
<p>在实际开发中, 经常需要处理不同编码的文本数据:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟不同编码的转换</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">convertEncoding</span>(<span class="hljs-params">text, fromEncoding, toEncoding</span>) {
  <span class="hljs-comment">// 简化实现，实际应使用TextEncoder/TextDecoder</span>
  <span class="hljs-keyword">if</span> (fromEncoding === <span class="hljs-string">"UTF-8"</span> &amp;&amp; toEncoding === <span class="hljs-string">"UTF-16"</span>) {
    <span class="hljs-keyword">const</span> utf16Codes = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; text.<span class="hljs-property">length</span>; i++) {
      utf16Codes.<span class="hljs-title function_">push</span>(text.<span class="hljs-title function_">charCodeAt</span>(i));
    }
    <span class="hljs-keyword">return</span> utf16Codes;
  }
  <span class="hljs-comment">// 其他编码转换...</span>
  <span class="hljs-keyword">return</span> text;
}

<span class="hljs-comment">// 处理编码错误</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeDecode</span>(<span class="hljs-params">buffer, encoding = <span class="hljs-string">"UTF-8"</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 模拟解码过程</span>
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(encoding, { <span class="hljs-attr">fatal</span>: <span class="hljs-literal">true</span> });
    <span class="hljs-keyword">return</span> decoder.<span class="hljs-title function_">decode</span>(buffer);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 错误处理策略</span>
    <span class="hljs-keyword">if</span> (error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">TypeError</span>) {
      <span class="hljs-comment">// 替换无法解码的字符</span>
      <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(encoding, {
        <span class="hljs-attr">fatal</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">ignoreBOM</span>: <span class="hljs-literal">true</span>,
      });
      <span class="hljs-keyword">return</span> decoder.<span class="hljs-title function_">decode</span>(buffer);
    }
    <span class="hljs-keyword">throw</span> error;
  }
}
</code></pre>
<h4 data-id="heading-21">五、字符串基础操作手写实现</h4>
<h5 data-id="heading-22">5.1 手写常用字符串方法</h5>
<h6 data-id="heading-23">5.1.1 indexOf实现</h6>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myIndexOf</span>(<span class="hljs-params">str, searchValue, fromIndex = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">if</span> (searchValue === <span class="hljs-string">""</span>) {
    <span class="hljs-keyword">return</span> fromIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; fromIndex &lt;= str.<span class="hljs-property">length</span> ? fromIndex : str.<span class="hljs-property">length</span>;
  }

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = fromIndex; i &lt;= str.<span class="hljs-property">length</span> - searchValue.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">let</span> match = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; searchValue.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (str[i + j] !== searchValue[j]) {
        match = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">break</span>;
      }
    }
    <span class="hljs-keyword">if</span> (match) {
      <span class="hljs-keyword">return</span> i;
    }
  }

  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}
</code></pre>
<h6 data-id="heading-24">5.1.2 slice实现</h6>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mySlice</span>(<span class="hljs-params">str, start, end</span>) {
  <span class="hljs-comment">// 处理负数索引</span>
  <span class="hljs-keyword">const</span> strLength = str.<span class="hljs-property">length</span>;
  <span class="hljs-keyword">let</span> startIndex =
    start &lt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(strLength + start, <span class="hljs-number">0</span>) : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(start, strLength);
  <span class="hljs-keyword">let</span> endIndex =
    end === <span class="hljs-literal">undefined</span>
      ? strLength
      : end &lt; <span class="hljs-number">0</span>
      ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(strLength + end, <span class="hljs-number">0</span>)
      : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(end, strLength);

  <span class="hljs-comment">// 确保开始索引不大于结束索引</span>
  <span class="hljs-keyword">if</span> (startIndex &gt;= endIndex) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
  }

  <span class="hljs-comment">// 提取子字符串</span>
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">""</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = startIndex; i &lt; endIndex; i++) {
    result += str[i];
  }

  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h5 data-id="heading-25">5.2 性能优化技巧</h5>
<p>字符串操作在JavaScript中可能成为性能瓶颈, 以下是优化建议:</p>
<ul>
<li><strong>使用数组构建字符串:</strong> 对于大量字符串拼接, 使用数组的<code>join</code>方法比<code>+=</code>更高效</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐：性能较差</span>
<span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    result += <span class="hljs-string">'text'</span>;
}

<span class="hljs-comment">// 推荐：性能更好</span>
<span class="hljs-keyword">const</span> parts = [];
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    parts.<span class="hljs-title function_">push</span>(<span class="hljs-string">'text'</span>);
}
<span class="hljs-keyword">const</span> result = parts.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
</code></pre>
<ul>
<li><strong>避免不必要的字符串方法链式调用:</strong> 每个字符串方法都会创建新字符串</li>
<li><strong>使用正则表达式优化复杂匹配:</strong> 对于复杂模式匹配, 合理使用正则表达式比多个字符串方法组合更高效</li>
</ul>
<h5 data-id="heading-26">5.3 多语言字符串处理</h5>
<p>处理多语言文本时, 需要考虑语言特定的规则:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//  locale敏感的比较（简化实现）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">localeCompare</span>(<span class="hljs-params">str1, str2, locale</span>) {
    <span class="hljs-comment">// 实际应使用Intl.Collator</span>
    <span class="hljs-keyword">const</span> collator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">Collator</span>(locale);
    <span class="hljs-keyword">return</span> collator.<span class="hljs-title function_">compare</span>(str1, str2);
}

<span class="hljs-comment">// 大小写转换（考虑语言规则）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toLocaleUpperCase</span>(<span class="hljs-params">str, locale</span>) {
    <span class="hljs-comment">// 实际应使用Intl相关API</span>
    <span class="hljs-keyword">return</span> str.<span class="hljs-title function_">toLocaleUpperCase</span>(locale);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">localeCompare</span>(<span class="hljs-string">'ä'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'de'</span>)); <span class="hljs-comment">// 德语中 ä 在 b 之前</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">localeCompare</span>(<span class="hljs-string">'ä'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'sv'</span>)); <span class="hljs-comment">// 瑞典语中 ä 在 z 之后</span>
</code></pre>
<h4 data-id="heading-27">总结</h4>
<p>字符串处理是JavaScript编程的核心技能之一。通过手写实现字符串方法，我们不仅能够更深入地理解语言特性，还能培养解决复杂问题的能力。本文涵盖了从基础的模板字符串解析到高级的Unicode处理，以及实用的加密算法和性能优化技巧。</p>
<p>在实际开发中，建议：</p>
<ol>
<li>理解原理但优先使用内置方法（性能更好且经过充分测试）</li>
<li>对用户输入的字符串始终进行适当的验证和清理</li>
<li>在处理多语言文本时始终考虑Unicode的复杂性</li>
<li>根据实际需求选择合适的加密方案，安全敏感场景使用标准加密库</li>
</ol>
<p>掌握这些字符串处理技巧将使你能够编写更健壮、高效且安全的JavaScript代码。</p>
<p><strong>拓展阅读:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Funicode.org%2F" target="_blank" title="https://unicode.org/" ref="nofollow noopener noreferrer">Unicode标准</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fecma262%2F" target="_blank" title="https://tc39.es/ecma262/" ref="nofollow noopener noreferrer">ECMAScript规范</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java学习第30天 - 综合实战与项目总结]]></title>    <link>https://juejin.cn/post/7581870491764260916</link>    <guid>https://juejin.cn/post/7581870491764260916</guid>    <pubDate>2025-12-10T08:22:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491764260916" data-draft-id="7581828086020603919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java学习第30天 - 综合实战与项目总结"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-10T08:22:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浮游本尊"/> <meta itemprop="url" content="https://juejin.cn/user/2533726710668696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java学习第30天 - 综合实战与项目总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533726710668696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浮游本尊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:22:51.000Z" title="Wed Dec 10 2025 08:22:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 综合项目实战 - 电商系统完整实现</h2>
<h3 data-id="heading-1">1.1 项目架构设计</h3>
<p><strong>项目整体架构：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 项目结构</span>
<span class="hljs-comment">// com.example.ecommerce</span>
<span class="hljs-comment">//   ├── domain          // 领域层</span>
<span class="hljs-comment">//   │   ├── order       // 订单领域</span>
<span class="hljs-comment">//   │   ├── product     // 商品领域</span>
<span class="hljs-comment">//   │   └── user        // 用户领域</span>
<span class="hljs-comment">//   ├── application      // 应用层</span>
<span class="hljs-comment">//   │   ├── service     // 应用服务</span>
<span class="hljs-comment">//   │   └── dto         // 数据传输对象</span>
<span class="hljs-comment">//   ├── infrastructure  // 基础设施层</span>
<span class="hljs-comment">//   │   ├── repository  // 仓储实现</span>
<span class="hljs-comment">//   │   ├── cache       // 缓存</span>
<span class="hljs-comment">//   │   └── mq          // 消息队列</span>
<span class="hljs-comment">//   └── presentation    // 表现层</span>
<span class="hljs-comment">//       └── controller  // 控制器</span>

<span class="hljs-comment">// 领域模型 - 订单聚合根</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "t_order")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String orderNumber;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> BigDecimal totalAmount;
    <span class="hljs-keyword">private</span> OrderStatus status;
    
    <span class="hljs-meta">@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span>
    <span class="hljs-meta">@JoinColumn(name = "order_id")</span>
    <span class="hljs-keyword">private</span> List&lt;OrderItem&gt; items;
    
    <span class="hljs-meta">@Embedded</span>
    <span class="hljs-keyword">private</span> Address shippingAddress;
    
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> Date updateTime;
    
    <span class="hljs-comment">// 领域行为</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">confirm</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.status != OrderStatus.PENDING) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"只有待确认订单才能确认"</span>);
        }
        <span class="hljs-built_in">this</span>.status = OrderStatus.CONFIRMED;
        <span class="hljs-built_in">this</span>.updateTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pay</span><span class="hljs-params">(BigDecimal amount)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.status != OrderStatus.CONFIRMED) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"只有已确认订单才能支付"</span>);
        }
        <span class="hljs-keyword">if</span> (amount.compareTo(<span class="hljs-built_in">this</span>.totalAmount) != <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"支付金额不匹配"</span>);
        }
        <span class="hljs-built_in">this</span>.status = OrderStatus.PAID;
        <span class="hljs-built_in">this</span>.updateTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancel</span><span class="hljs-params">(String reason)</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.status == OrderStatus.COMPLETED || <span class="hljs-built_in">this</span>.status == OrderStatus.CANCELLED) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"订单状态不允许取消"</span>);
        }
        <span class="hljs-built_in">this</span>.status = OrderStatus.CANCELLED;
        <span class="hljs-built_in">this</span>.updateTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    }
    
    <span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title function_">calculateTotal</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.items == <span class="hljs-literal">null</span> || <span class="hljs-built_in">this</span>.items.isEmpty()) {
            <span class="hljs-keyword">return</span> BigDecimal.ZERO;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.items.stream()
            .map(item -&gt; item.getPrice().multiply(BigDecimal.valueOf(item.getQuantity())))
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    }
}

<span class="hljs-comment">// 订单项实体</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "t_order_item")</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderItem</span> {
    
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> Long orderId;
    <span class="hljs-keyword">private</span> Long productId;
    <span class="hljs-keyword">private</span> String productName;
    <span class="hljs-keyword">private</span> BigDecimal price;
    <span class="hljs-keyword">private</span> Integer quantity;
    <span class="hljs-keyword">private</span> BigDecimal subtotal;
}

<span class="hljs-comment">// 订单状态枚举</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus</span> {
    PENDING(<span class="hljs-string">"待确认"</span>),
    CONFIRMED(<span class="hljs-string">"已确认"</span>),
    PAID(<span class="hljs-string">"已支付"</span>),
    SHIPPED(<span class="hljs-string">"已发货"</span>),
    COMPLETED(<span class="hljs-string">"已完成"</span>),
    CANCELLED(<span class="hljs-string">"已取消"</span>);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String description;
    
    OrderStatus(String description) {
        <span class="hljs-built_in">this</span>.description = description;
    }
}
</code></pre>
<h3 data-id="heading-2">1.2 应用服务层实现</h3>
<p><strong>应用服务实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 订单应用服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderApplicationService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderRepository orderRepository;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductService productService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> InventoryService inventoryService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentService paymentService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> EventPublisher eventPublisher;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-comment">// 创建订单</span>
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-comment">// 1. 参数验证</span>
        validateCreateOrderRequest(request);
        
        <span class="hljs-comment">// 2. 获取用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getUserById(request.getUserId());
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserNotFoundException</span>(<span class="hljs-string">"用户不存在"</span>);
        }
        
        <span class="hljs-comment">// 3. 验证商品和库存</span>
        List&lt;OrderItem&gt; items = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (CreateOrderItemRequest itemRequest : request.getItems()) {
            <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.getProductById(itemRequest.getProductId());
            <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductNotFoundException</span>(<span class="hljs-string">"商品不存在: "</span> + itemRequest.getProductId());
            }
            
            <span class="hljs-comment">// 检查库存</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> inventoryService.checkInventory(
                itemRequest.getProductId(), 
                itemRequest.getQuantity()
            );
            <span class="hljs-keyword">if</span> (!available) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InsufficientInventoryException</span>(<span class="hljs-string">"库存不足: "</span> + product.getName());
            }
            
            <span class="hljs-comment">// 创建订单项</span>
            <span class="hljs-type">OrderItem</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItem</span>();
            item.setProductId(product.getId());
            item.setProductName(product.getName());
            item.setPrice(product.getPrice());
            item.setQuantity(itemRequest.getQuantity());
            item.setSubtotal(product.getPrice().multiply(BigDecimal.valueOf(itemRequest.getQuantity())));
            items.add(item);
        }
        
        <span class="hljs-comment">// 4. 创建订单</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setOrderNumber(generateOrderNumber());
        order.setUserId(request.getUserId());
        order.setItems(items);
        order.setTotalAmount(calculateTotal(items));
        order.setShippingAddress(convertAddress(request.getShippingAddress()));
        order.setStatus(OrderStatus.PENDING);
        order.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        order.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        
        <span class="hljs-comment">// 5. 保存订单</span>
        order = orderRepository.save(order);
        
        <span class="hljs-comment">// 6. 扣减库存</span>
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            inventoryService.deductInventory(item.getProductId(), item.getQuantity());
        }
        
        <span class="hljs-comment">// 7. 发布领域事件</span>
        eventPublisher.publish(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCreatedEvent</span>(order.getOrderNumber(), order.getUserId(), order.getTotalAmount()));
        
        log.info(<span class="hljs-string">"创建订单成功: orderNumber={}, userId={}"</span>, order.getOrderNumber(), order.getUserId());
        
        <span class="hljs-keyword">return</span> convertToDTO(order);
    }
    
    <span class="hljs-comment">// 支付订单</span>
    <span class="hljs-keyword">public</span> PaymentResult <span class="hljs-title function_">payOrder</span><span class="hljs-params">(String orderNumber, PaymentRequest paymentRequest)</span> {
        <span class="hljs-comment">// 1. 获取订单</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderRepository.findByOrderNumber(orderNumber);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderNotFoundException</span>(<span class="hljs-string">"订单不存在: "</span> + orderNumber);
        }
        
        <span class="hljs-comment">// 2. 验证订单状态</span>
        <span class="hljs-keyword">if</span> (order.getStatus() != OrderStatus.CONFIRMED) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"订单状态不允许支付"</span>);
        }
        
        <span class="hljs-comment">// 3. 使用分布式锁防止重复支付</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order:pay:"</span> + orderNumber;
        <span class="hljs-type">DistributedLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> distributedLockService.acquireLock(lockKey, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 双重检查</span>
            order = orderRepository.findByOrderNumber(orderNumber);
            <span class="hljs-keyword">if</span> (order.getStatus() != OrderStatus.CONFIRMED) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"订单状态已变更"</span>);
            }
            
            <span class="hljs-comment">// 4. 调用支付服务</span>
            <span class="hljs-type">PaymentResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> paymentService.processPayment(
                order.getOrderNumber(),
                order.getTotalAmount(),
                paymentRequest
            );
            
            <span class="hljs-keyword">if</span> (result.isSuccess()) {
                <span class="hljs-comment">// 5. 更新订单状态</span>
                order.pay(order.getTotalAmount());
                orderRepository.save(order);
                
                <span class="hljs-comment">// 6. 发布支付成功事件</span>
                eventPublisher.publish(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPaidEvent</span>(order.getOrderNumber(), order.getUserId(), order.getTotalAmount()));
                
                log.info(<span class="hljs-string">"订单支付成功: orderNumber={}"</span>, orderNumber);
            }
            
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">// 取消订单</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(String orderNumber, String reason)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderRepository.findByOrderNumber(orderNumber);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderNotFoundException</span>(<span class="hljs-string">"订单不存在: "</span> + orderNumber);
        }
        
        <span class="hljs-comment">// 使用分布式锁</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"order:cancel:"</span> + orderNumber;
        <span class="hljs-type">DistributedLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> distributedLockService.acquireLock(lockKey, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">try</span> {
            order = orderRepository.findByOrderNumber(orderNumber);
            order.cancel(reason);
            orderRepository.save(order);
            
            <span class="hljs-comment">// 恢复库存</span>
            <span class="hljs-keyword">for</span> (OrderItem item : order.getItems()) {
                inventoryService.restoreInventory(item.getProductId(), item.getQuantity());
            }
            
            <span class="hljs-comment">// 发布取消事件</span>
            eventPublisher.publish(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderCancelledEvent</span>(orderNumber, order.getUserId(), reason));
            
            log.info(<span class="hljs-string">"订单取消成功: orderNumber={}, reason={}"</span>, orderNumber, reason);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-comment">// 查询订单</span>
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">getOrder</span><span class="hljs-params">(String orderNumber)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderRepository.findByOrderNumber(orderNumber);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderNotFoundException</span>(<span class="hljs-string">"订单不存在: "</span> + orderNumber);
        }
        <span class="hljs-keyword">return</span> convertToDTO(order);
    }
    
    <span class="hljs-comment">// 分页查询用户订单</span>
    <span class="hljs-keyword">public</span> Page&lt;OrderDTO&gt; <span class="hljs-title function_">getUserOrders</span><span class="hljs-params">(Long userId, <span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size)</span> {
        <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageable</span> <span class="hljs-operator">=</span> PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, <span class="hljs-string">"createTime"</span>));
        Page&lt;Order&gt; orders = orderRepository.findByUserId(userId, pageable);
        <span class="hljs-keyword">return</span> orders.map(<span class="hljs-built_in">this</span>::convertToDTO);
    }
    
    <span class="hljs-comment">// 工具方法</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateOrderNumber</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ORD"</span> + System.currentTimeMillis() + (<span class="hljs-type">int</span>)(Math.random() * <span class="hljs-number">1000</span>);
    }
    
    <span class="hljs-keyword">private</span> BigDecimal <span class="hljs-title function_">calculateTotal</span><span class="hljs-params">(List&lt;OrderItem&gt; items)</span> {
        <span class="hljs-keyword">return</span> items.stream()
            .map(OrderItem::getSubtotal)
            .reduce(BigDecimal.ZERO, BigDecimal::add);
    }
    
    <span class="hljs-keyword">private</span> Address <span class="hljs-title function_">convertAddress</span><span class="hljs-params">(AddressDTO dto)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(dto.getProvince(), dto.getCity(), dto.getDistrict(), 
                          dto.getStreet(), dto.getZipCode());
    }
    
    <span class="hljs-keyword">private</span> OrderDTO <span class="hljs-title function_">convertToDTO</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDTO</span>();
        dto.setId(order.getId());
        dto.setOrderNumber(order.getOrderNumber());
        dto.setUserId(order.getUserId());
        dto.setTotalAmount(order.getTotalAmount());
        dto.setStatus(order.getStatus());
        dto.setItems(order.getItems().stream()
            .map(<span class="hljs-built_in">this</span>::convertItemToDTO)
            .collect(Collectors.toList()));
        dto.setCreateTime(order.getCreateTime());
        <span class="hljs-keyword">return</span> dto;
    }
    
    <span class="hljs-keyword">private</span> OrderItemDTO <span class="hljs-title function_">convertItemToDTO</span><span class="hljs-params">(OrderItem item)</span> {
        <span class="hljs-type">OrderItemDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderItemDTO</span>();
        dto.setProductId(item.getProductId());
        dto.setProductName(item.getProductName());
        dto.setPrice(item.getPrice());
        dto.setQuantity(item.getQuantity());
        dto.setSubtotal(item.getSubtotal());
        <span class="hljs-keyword">return</span> dto;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validateCreateOrderRequest</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-keyword">if</span> (request.getUserId() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"用户ID不能为空"</span>);
        }
        <span class="hljs-keyword">if</span> (request.getItems() == <span class="hljs-literal">null</span> || request.getItems().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"订单项不能为空"</span>);
        }
        <span class="hljs-keyword">if</span> (request.getShippingAddress() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"收货地址不能为空"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-3">1.3 控制器层实现</h3>
<p><strong>RESTful API实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 订单控制器</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/orders")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Validated</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderApplicationService orderService;
    
    <span class="hljs-comment">// 创建订单</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-meta">@RateLimit(limit = 100, windowSize = 60000)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;OrderDTO&gt;&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(
            <span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> CreateOrderRequest request)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.createOrder(request);
            <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(order));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"创建订单失败"</span>, e);
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ApiResponse.error(e.getMessage()));
        }
    }
    
    <span class="hljs-comment">// 支付订单</span>
    <span class="hljs-meta">@PostMapping("/{orderNumber}/pay")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;PaymentResult&gt;&gt; <span class="hljs-title function_">payOrder</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String orderNumber,
            <span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> PaymentRequest request)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">PaymentResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> orderService.payOrder(orderNumber, request);
            <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(result));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"支付订单失败: orderNumber={}"</span>, orderNumber, e);
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ApiResponse.error(e.getMessage()));
        }
    }
    
    <span class="hljs-comment">// 取消订单</span>
    <span class="hljs-meta">@PostMapping("/{orderNumber}/cancel")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Void&gt;&gt; <span class="hljs-title function_">cancelOrder</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> String orderNumber,
            <span class="hljs-meta">@RequestBody</span> CancelOrderRequest request)</span> {
        <span class="hljs-keyword">try</span> {
            orderService.cancelOrder(orderNumber, request.getReason());
            <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(<span class="hljs-literal">null</span>));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"取消订单失败: orderNumber={}"</span>, orderNumber, e);
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ApiResponse.error(e.getMessage()));
        }
    }
    
    <span class="hljs-comment">// 查询订单</span>
    <span class="hljs-meta">@GetMapping("/{orderNumber}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;OrderDTO&gt;&gt; <span class="hljs-title function_">getOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String orderNumber)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getOrder(orderNumber);
            <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(order));
        } <span class="hljs-keyword">catch</span> (OrderNotFoundException e) {
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.NOT_FOUND)
                .body(ApiResponse.error(e.getMessage()));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"查询订单失败: orderNumber={}"</span>, orderNumber, e);
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ApiResponse.error(e.getMessage()));
        }
    }
    
    <span class="hljs-comment">// 查询用户订单列表</span>
    <span class="hljs-meta">@GetMapping("/user/{userId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Page&lt;OrderDTO&gt;&gt;&gt; <span class="hljs-title function_">getUserOrders</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> Long userId,
            <span class="hljs-meta">@RequestParam(defaultValue = "0")</span> <span class="hljs-type">int</span> page,
            <span class="hljs-meta">@RequestParam(defaultValue = "10")</span> <span class="hljs-type">int</span> size)</span> {
        <span class="hljs-keyword">try</span> {
            Page&lt;OrderDTO&gt; orders = orderService.getUserOrders(userId, page, size);
            <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(orders));
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"查询用户订单失败: userId={}"</span>, userId, e);
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(ApiResponse.error(e.getMessage()));
        }
    }
}

<span class="hljs-comment">// 统一响应格式</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> String message;
    <span class="hljs-keyword">private</span> T data;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> timestamp;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResponse</span>&lt;&gt;(<span class="hljs-number">200</span>, <span class="hljs-string">"success"</span>, data, System.currentTimeMillis());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="hljs-title function_">error</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiResponse</span>&lt;&gt;(<span class="hljs-number">500</span>, message, <span class="hljs-literal">null</span>, System.currentTimeMillis());
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-4">2. 系统设计实战 - 高并发秒杀系统</h2>
<h3 data-id="heading-5">2.1 秒杀系统架构设计</h3>
<p><strong>秒杀系统核心实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 秒杀服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductService productService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SECKILL_STOCK_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SECKILL_USER_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:user:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SECKILL_QUEUE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill.queue"</span>;
    
    <span class="hljs-comment">// 初始化秒杀库存</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initSeckillStock</span><span class="hljs-params">(Long productId, Integer stock)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> SECKILL_STOCK_KEY + productId;
        redisTemplate.opsForValue().set(key, String.valueOf(stock));
        log.info(<span class="hljs-string">"初始化秒杀库存: productId={}, stock={}"</span>, productId, stock);
    }
    
    <span class="hljs-comment">// 秒杀下单（高并发优化）</span>
    <span class="hljs-keyword">public</span> SeckillResult <span class="hljs-title function_">seckill</span><span class="hljs-params">(Long userId, Long productId)</span> {
        <span class="hljs-comment">// 1. 参数验证</span>
        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span> || productId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"参数错误"</span>);
        }
        
        <span class="hljs-comment">// 2. 检查用户是否已参与（防刷）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">userKey</span> <span class="hljs-operator">=</span> SECKILL_USER_KEY + productId + <span class="hljs-string">":"</span> + userId;
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(userKey);
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(exists)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"您已经参与过本次秒杀"</span>);
        }
        
        <span class="hljs-comment">// 3. 预扣库存（Redis原子操作）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">stockKey</span> <span class="hljs-operator">=</span> SECKILL_STOCK_KEY + productId;
        <span class="hljs-type">Long</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().decrement(stockKey);
        
        <span class="hljs-keyword">if</span> (stock == <span class="hljs-literal">null</span> || stock &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 库存不足，恢复库存</span>
            redisTemplate.opsForValue().increment(stockKey);
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"商品已抢完"</span>);
        }
        
        <span class="hljs-comment">// 4. 标记用户已参与</span>
        redisTemplate.opsForValue().set(userKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">3600</span>, TimeUnit.SECONDS);
        
        <span class="hljs-comment">// 5. 异步处理订单（消息队列）</span>
        <span class="hljs-type">SeckillMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillMessage</span>(userId, productId);
        rabbitTemplate.convertAndSend(SECKILL_QUEUE, message);
        
        log.info(<span class="hljs-string">"秒杀请求已提交: userId={}, productId={}"</span>, userId, productId);
        <span class="hljs-keyword">return</span> SeckillResult.success(<span class="hljs-string">"秒杀成功，订单处理中"</span>);
    }
    
    <span class="hljs-comment">// 消息队列消费者处理订单</span>
    <span class="hljs-meta">@RabbitListener(queues = "seckill.queue")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSeckillOrder</span><span class="hljs-params">(SeckillMessage message)</span> {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> message.getUserId();
        <span class="hljs-type">Long</span> <span class="hljs-variable">productId</span> <span class="hljs-operator">=</span> message.getProductId();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 再次验证库存（数据库层面）</span>
            <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.getProductById(productId);
            <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span> || product.getStock() &lt;= <span class="hljs-number">0</span>) {
                log.warn(<span class="hljs-string">"库存不足，取消订单: userId={}, productId={}"</span>, userId, productId);
                <span class="hljs-comment">// 恢复Redis库存</span>
                redisTemplate.opsForValue().increment(SECKILL_STOCK_KEY + productId);
                <span class="hljs-keyword">return</span>;
            }
            
            <span class="hljs-comment">// 2. 创建订单</span>
            <span class="hljs-type">CreateOrderRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateOrderRequest</span>();
            request.setUserId(userId);
            
            <span class="hljs-type">CreateOrderItemRequest</span> <span class="hljs-variable">itemRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateOrderItemRequest</span>();
            itemRequest.setProductId(productId);
            itemRequest.setQuantity(<span class="hljs-number">1</span>);
            request.setItems(Collections.singletonList(itemRequest));
            
            <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.createOrder(request);
            
            log.info(<span class="hljs-string">"秒杀订单创建成功: orderNumber={}, userId={}, productId={}"</span>, 
                    order.getOrderNumber(), userId, productId);
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"处理秒杀订单失败: userId={}, productId={}"</span>, userId, productId, e);
            <span class="hljs-comment">// 恢复Redis库存</span>
            redisTemplate.opsForValue().increment(SECKILL_STOCK_KEY + productId);
        }
    }
    
    <span class="hljs-comment">// 查询秒杀库存</span>
    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">getSeckillStock</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(SECKILL_STOCK_KEY + productId);
        <span class="hljs-keyword">return</span> stock != <span class="hljs-literal">null</span> ? Integer.parseInt(stock) : <span class="hljs-number">0</span>;
    }
}

<span class="hljs-comment">// 秒杀结果</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillResult</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> success;
    <span class="hljs-keyword">private</span> String message;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SeckillResult <span class="hljs-title function_">success</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillResult</span>(<span class="hljs-literal">true</span>, message);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SeckillResult <span class="hljs-title function_">fail</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillResult</span>(<span class="hljs-literal">false</span>, message);
    }
}

<span class="hljs-comment">// 秒杀消息</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillMessage</span> {
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> Long productId;
}
</code></pre>
<h3 data-id="heading-6">2.2 限流与防刷策略</h3>
<p><strong>防刷与限流实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 秒杀限流服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillRateLimitService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-comment">// IP限流</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkIpLimit</span><span class="hljs-params">(String ip, Long productId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:ip:"</span> + productId + <span class="hljs-string">":"</span> + ip;
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(key);
        
        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {
            redisTemplate.expire(key, <span class="hljs-number">60</span>, TimeUnit.SECONDS);
        }
        
        <span class="hljs-comment">// 每个IP每分钟最多10次请求</span>
        <span class="hljs-keyword">return</span> count &lt;= <span class="hljs-number">10</span>;
    }
    
    <span class="hljs-comment">// 用户限流</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkUserLimit</span><span class="hljs-params">(Long userId, Long productId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:user:limit:"</span> + productId + <span class="hljs-string">":"</span> + userId;
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(key);
        
        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {
            redisTemplate.expire(key, <span class="hljs-number">60</span>, TimeUnit.SECONDS);
        }
        
        <span class="hljs-comment">// 每个用户每分钟最多5次请求</span>
        <span class="hljs-keyword">return</span> count &lt;= <span class="hljs-number">5</span>;
    }
    
    <span class="hljs-comment">// 总请求限流</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkTotalLimit</span><span class="hljs-params">(Long productId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:total:"</span> + productId;
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().increment(key);
        
        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {
            redisTemplate.expire(key, <span class="hljs-number">1</span>, TimeUnit.SECONDS);
        }
        
        <span class="hljs-comment">// 每秒最多1000个请求</span>
        <span class="hljs-keyword">return</span> count &lt;= <span class="hljs-number">1000</span>;
    }
}

<span class="hljs-comment">// 秒杀控制器（带限流）</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/seckill")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SeckillService seckillService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SeckillRateLimitService rateLimitService;
    
    <span class="hljs-meta">@PostMapping("/{productId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;SeckillResult&gt;&gt; <span class="hljs-title function_">seckill</span><span class="hljs-params">(
            <span class="hljs-meta">@PathVariable</span> Long productId,
            HttpServletRequest request)</span> {
        
        <span class="hljs-comment">// 获取用户ID（从Token中解析）</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> getUserIdFromToken(request);
        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED)
                .body(ApiResponse.error(<span class="hljs-string">"未登录"</span>));
        }
        
        <span class="hljs-comment">// 获取IP</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> getClientIp(request);
        
        <span class="hljs-comment">// 1. IP限流</span>
        <span class="hljs-keyword">if</span> (!rateLimitService.checkIpLimit(ip, productId)) {
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.TOO_MANY_REQUESTS)
                .body(ApiResponse.error(<span class="hljs-string">"请求过于频繁，请稍后重试"</span>));
        }
        
        <span class="hljs-comment">// 2. 用户限流</span>
        <span class="hljs-keyword">if</span> (!rateLimitService.checkUserLimit(userId, productId)) {
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.TOO_MANY_REQUESTS)
                .body(ApiResponse.error(<span class="hljs-string">"您操作过于频繁，请稍后重试"</span>));
        }
        
        <span class="hljs-comment">// 3. 总请求限流</span>
        <span class="hljs-keyword">if</span> (!rateLimitService.checkTotalLimit(productId)) {
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.TOO_MANY_REQUESTS)
                .body(ApiResponse.error(<span class="hljs-string">"系统繁忙，请稍后重试"</span>));
        }
        
        <span class="hljs-comment">// 4. 执行秒杀</span>
        <span class="hljs-type">SeckillResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> seckillService.seckill(userId, productId);
        
        <span class="hljs-keyword">if</span> (result.isSuccess()) {
            <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(result));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST)
                .body(ApiResponse.error(result.getMessage()));
        }
    }
    
    <span class="hljs-meta">@GetMapping("/stock/{productId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Integer&gt;&gt; <span class="hljs-title function_">getStock</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long productId)</span> {
        <span class="hljs-type">Integer</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> seckillService.getSeckillStock(productId);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(stock));
    }
    
    <span class="hljs-keyword">private</span> Long <span class="hljs-title function_">getUserIdFromToken</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-comment">// 从Token中解析用户ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"Authorization"</span>);
        <span class="hljs-comment">// 实现Token解析逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1L</span>; <span class="hljs-comment">// 示例</span>
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getClientIp</span><span class="hljs-params">(HttpServletRequest request)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Forwarded-For"</span>);
        <span class="hljs-keyword">if</span> (ip == <span class="hljs-literal">null</span> || ip.isEmpty() || <span class="hljs-string">"unknown"</span>.equalsIgnoreCase(ip)) {
            ip = request.getHeader(<span class="hljs-string">"X-Real-IP"</span>);
        }
        <span class="hljs-keyword">if</span> (ip == <span class="hljs-literal">null</span> || ip.isEmpty() || <span class="hljs-string">"unknown"</span>.equalsIgnoreCase(ip)) {
            ip = request.getRemoteAddr();
        }
        <span class="hljs-keyword">return</span> ip;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-7">3. 性能调优实战</h2>
<h3 data-id="heading-8">3.1 JVM调优实战</h3>
<p><strong>JVM参数配置与监控：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JVM监控服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JVMMonitorService</span> {
    
    <span class="hljs-comment">// 获取JVM内存信息</span>
    <span class="hljs-keyword">public</span> JVMMemoryInfo <span class="hljs-title function_">getMemoryInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();
        <span class="hljs-type">long</span> <span class="hljs-variable">totalMemory</span> <span class="hljs-operator">=</span> runtime.totalMemory();
        <span class="hljs-type">long</span> <span class="hljs-variable">freeMemory</span> <span class="hljs-operator">=</span> runtime.freeMemory();
        <span class="hljs-type">long</span> <span class="hljs-variable">usedMemory</span> <span class="hljs-operator">=</span> totalMemory - freeMemory;
        <span class="hljs-type">long</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> runtime.maxMemory();
        
        <span class="hljs-type">JVMMemoryInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JVMMemoryInfo</span>();
        info.setTotalMemory(totalMemory);
        info.setUsedMemory(usedMemory);
        info.setFreeMemory(freeMemory);
        info.setMaxMemory(maxMemory);
        info.setUsagePercent((<span class="hljs-type">double</span>) usedMemory / maxMemory * <span class="hljs-number">100</span>);
        
        <span class="hljs-keyword">return</span> info;
    }
    
    <span class="hljs-comment">// 获取GC信息</span>
    <span class="hljs-keyword">public</span> List&lt;GCInfo&gt; <span class="hljs-title function_">getGCInfo</span><span class="hljs-params">()</span> {
        List&lt;GarbageCollectorMXBean&gt; gcBeans = ManagementFactory.getGarbageCollectorMXBeans();
        List&lt;GCInfo&gt; gcInfos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (GarbageCollectorMXBean gcBean : gcBeans) {
            <span class="hljs-type">GCInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GCInfo</span>();
            info.setName(gcBean.getName());
            info.setCollectionCount(gcBean.getCollectionCount());
            info.setCollectionTime(gcBean.getCollectionTime());
            gcInfos.add(info);
        }
        
        <span class="hljs-keyword">return</span> gcInfos;
    }
    
    <span class="hljs-comment">// 手动触发GC（仅用于测试）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">triggerGC</span><span class="hljs-params">()</span> {
        System.gc();
        log.info(<span class="hljs-string">"手动触发GC"</span>);
    }
    
    <span class="hljs-comment">// 获取线程信息</span>
    <span class="hljs-keyword">public</span> ThreadInfo <span class="hljs-title function_">getThreadInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadMXBean</span> <span class="hljs-variable">threadBean</span> <span class="hljs-operator">=</span> ManagementFactory.getThreadMXBean();
        <span class="hljs-type">ThreadInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadInfo</span>();
        info.setThreadCount(threadBean.getThreadCount());
        info.setPeakThreadCount(threadBean.getPeakThreadCount());
        info.setTotalStartedThreadCount(threadBean.getTotalStartedThreadCount());
        info.setDaemonThreadCount(threadBean.getDaemonThreadCount());
        <span class="hljs-keyword">return</span> info;
    }
}

<span class="hljs-comment">// JVM内存信息</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JVMMemoryInfo</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> totalMemory;      <span class="hljs-comment">// 总内存</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> usedMemory;       <span class="hljs-comment">// 已用内存</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> freeMemory;       <span class="hljs-comment">// 空闲内存</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> maxMemory;        <span class="hljs-comment">// 最大内存</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> usagePercent;   <span class="hljs-comment">// 使用率</span>
}

<span class="hljs-comment">// GC信息</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GCInfo</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> collectionCount;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> collectionTime;
}

<span class="hljs-comment">// JVM监控控制器</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/monitor/jvm")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JVMMonitorController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JVMMonitorService monitorService;
    
    <span class="hljs-meta">@GetMapping("/memory")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;JVMMemoryInfo&gt;&gt; <span class="hljs-title function_">getMemoryInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-type">JVMMemoryInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> monitorService.getMemoryInfo();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(info));
    }
    
    <span class="hljs-meta">@GetMapping("/gc")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;List&lt;GCInfo&gt;&gt;&gt; <span class="hljs-title function_">getGCInfo</span><span class="hljs-params">()</span> {
        List&lt;GCInfo&gt; infos = monitorService.getGCInfo();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(infos));
    }
    
    <span class="hljs-meta">@GetMapping("/thread")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiResponse&lt;ThreadInfo&gt;&gt; <span class="hljs-title function_">getThreadInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> monitorService.getThreadInfo();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(ApiResponse.success(info));
    }
}

<span class="hljs-comment">// JVM调优建议</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JVMTuningAdvisor</span> {
    
    <span class="hljs-keyword">public</span> JVMTuningAdvice <span class="hljs-title function_">getTuningAdvice</span><span class="hljs-params">(JVMMemoryInfo memoryInfo)</span> {
        <span class="hljs-type">JVMTuningAdvice</span> <span class="hljs-variable">advice</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JVMTuningAdvice</span>();
        
        <span class="hljs-comment">// 内存使用率过高</span>
        <span class="hljs-keyword">if</span> (memoryInfo.getUsagePercent() &gt; <span class="hljs-number">80</span>) {
            advice.addWarning(<span class="hljs-string">"内存使用率过高: "</span> + String.format(<span class="hljs-string">"%.2f%%"</span>, memoryInfo.getUsagePercent()));
            advice.addSuggestion(<span class="hljs-string">"建议增加堆内存: -Xmx4g -Xms4g"</span>);
        }
        
        <span class="hljs-comment">// 检查GC频率</span>
        List&lt;GCInfo&gt; gcInfos = getGCInfo();
        <span class="hljs-keyword">for</span> (GCInfo gcInfo : gcInfos) {
            <span class="hljs-keyword">if</span> (gcInfo.getCollectionCount() &gt; <span class="hljs-number">1000</span>) {
                advice.addWarning(<span class="hljs-string">"GC频率过高: "</span> + gcInfo.getName() + <span class="hljs-string">" 执行了 "</span> + gcInfo.getCollectionCount() + <span class="hljs-string">" 次"</span>);
                advice.addSuggestion(<span class="hljs-string">"建议使用G1GC: -XX:+UseG1GC -XX:MaxGCPauseMillis=200"</span>);
            }
        }
        
        <span class="hljs-keyword">return</span> advice;
    }
    
    <span class="hljs-keyword">private</span> List&lt;GCInfo&gt; <span class="hljs-title function_">getGCInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 实现获取GC信息</span>
        <span class="hljs-keyword">return</span> Collections.emptyList();
    }
}
</code></pre>
<h3 data-id="heading-9">3.2 数据库性能优化</h3>
<p><strong>数据库优化实践：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 数据库性能监控</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabasePerformanceService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DataSource dataSource;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-comment">// 获取慢查询</span>
    <span class="hljs-keyword">public</span> List&lt;SlowQuery&gt; <span class="hljs-title function_">getSlowQueries</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// MySQL慢查询日志分析</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 100"</span>;
        <span class="hljs-comment">// 实际实现需要根据数据库类型调整</span>
        <span class="hljs-keyword">return</span> Collections.emptyList();
    }
    
    <span class="hljs-comment">// 分析SQL执行计划</span>
    <span class="hljs-keyword">public</span> ExecutionPlan <span class="hljs-title function_">analyzeExecutionPlan</span><span class="hljs-params">(String sql)</span> {
        <span class="hljs-type">ExecutionPlan</span> <span class="hljs-variable">plan</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionPlan</span>();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取执行计划</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">explainSql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"EXPLAIN "</span> + sql;
            List&lt;Map&lt;String, Object&gt;&gt; results = jdbcTemplate.queryForList(explainSql);
            
            plan.setSql(sql);
            plan.setPlans(results);
            
            <span class="hljs-comment">// 分析执行计划</span>
            <span class="hljs-keyword">for</span> (Map&lt;String, Object&gt; result : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> (String) result.get(<span class="hljs-string">"type"</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"ALL"</span>.equals(type)) {
                    plan.addWarning(<span class="hljs-string">"全表扫描，建议添加索引"</span>);
                }
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"index"</span>.equals(type)) {
                    plan.addWarning(<span class="hljs-string">"全索引扫描，考虑优化查询条件"</span>);
                }
            }
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"分析执行计划失败"</span>, e);
            plan.addError(<span class="hljs-string">"分析失败: "</span> + e.getMessage());
        }
        
        <span class="hljs-keyword">return</span> plan;
    }
    
    <span class="hljs-comment">// 索引优化建议</span>
    <span class="hljs-keyword">public</span> List&lt;IndexSuggestion&gt; <span class="hljs-title function_">getIndexSuggestions</span><span class="hljs-params">()</span> {
        List&lt;IndexSuggestion&gt; suggestions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-comment">// 查询未使用索引的表</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT table_name, index_name, seq_in_index, column_name "</span> +
                    <span class="hljs-string">"FROM information_schema.statistics "</span> +
                    <span class="hljs-string">"WHERE table_schema = DATABASE() "</span> +
                    <span class="hljs-string">"ORDER BY table_name, index_name"</span>;
        
        <span class="hljs-comment">// 分析索引使用情况</span>
        <span class="hljs-comment">// 实际实现需要查询数据库元数据</span>
        
        <span class="hljs-keyword">return</span> suggestions;
    }
}

<span class="hljs-comment">// 执行计划</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutionPlan</span> {
    <span class="hljs-keyword">private</span> String sql;
    <span class="hljs-keyword">private</span> List&lt;Map&lt;String, Object&gt;&gt; plans;
    <span class="hljs-keyword">private</span> List&lt;String&gt; warnings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> List&lt;String&gt; errors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addWarning</span><span class="hljs-params">(String warning)</span> {
        warnings.add(warning);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addError</span><span class="hljs-params">(String error)</span> {
        errors.add(error);
    }
}

<span class="hljs-comment">// 批量操作优化</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchOperationOptimizer</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;
    
    <span class="hljs-comment">// 批量插入优化</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;Order&gt; orders)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO t_order (order_number, user_id, total_amount, status, create_time) "</span> +
                    <span class="hljs-string">"VALUES (?, ?, ?, ?, ?)"</span>;
        
        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
        List&lt;Object[]&gt; batchArgs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (Order order : orders) {
            Object[] args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{
                order.getOrderNumber(),
                order.getUserId(),
                order.getTotalAmount(),
                order.getStatus().name(),
                order.getCreateTime()
            };
            batchArgs.add(args);
            
            <span class="hljs-keyword">if</span> (batchArgs.size() &gt;= batchSize) {
                jdbcTemplate.batchUpdate(sql, batchArgs);
                batchArgs.clear();
            }
        }
        
        <span class="hljs-keyword">if</span> (!batchArgs.isEmpty()) {
            jdbcTemplate.batchUpdate(sql, batchArgs);
        }
    }
    
    <span class="hljs-comment">// 使用MyBatis Plus批量插入</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsertWithMyBatisPlus</span><span class="hljs-params">(List&lt;Order&gt; orders)</span> {
        <span class="hljs-comment">// MyBatis Plus批量插入</span>
        orderMapper.insertBatch(orders);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-10">4. 故障排查与监控</h2>
<h3 data-id="heading-11">4.1 日志分析与监控</h3>
<p><strong>日志监控与分析：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 日志分析服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogAnalysisService</span> {
    
    <span class="hljs-comment">// 分析错误日志</span>
    <span class="hljs-keyword">public</span> List&lt;ErrorLog&gt; <span class="hljs-title function_">analyzeErrorLogs</span><span class="hljs-params">(String logFile, Date startTime, Date endTime)</span> {
        List&lt;ErrorLog&gt; errorLogs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(logFile);
            List&lt;String&gt; lines = Files.readAllLines(path);
            
            <span class="hljs-keyword">for</span> (String line : lines) {
                <span class="hljs-keyword">if</span> (line.contains(<span class="hljs-string">"ERROR"</span>) || line.contains(<span class="hljs-string">"Exception"</span>)) {
                    <span class="hljs-type">ErrorLog</span> <span class="hljs-variable">errorLog</span> <span class="hljs-operator">=</span> parseErrorLog(line);
                    <span class="hljs-keyword">if</span> (errorLog != <span class="hljs-literal">null</span> &amp;&amp; isInTimeRange(errorLog.getTimestamp(), startTime, endTime)) {
                        errorLogs.add(errorLog);
                    }
                }
            }
            
        } <span class="hljs-keyword">catch</span> (IOException e) {
            log.error(<span class="hljs-string">"读取日志文件失败"</span>, e);
        }
        
        <span class="hljs-keyword">return</span> errorLogs;
    }
    
    <span class="hljs-comment">// 统计错误类型</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Integer&gt; <span class="hljs-title function_">countErrorTypes</span><span class="hljs-params">(List&lt;ErrorLog&gt; errorLogs)</span> {
        <span class="hljs-keyword">return</span> errorLogs.stream()
            .collect(Collectors.groupingBy(
                ErrorLog::getErrorType,
                Collectors.collectingAndThen(Collectors.counting(), Long::intValue)
            ));
    }
    
    <span class="hljs-comment">// 分析性能日志</span>
    <span class="hljs-keyword">public</span> List&lt;PerformanceLog&gt; <span class="hljs-title function_">analyzePerformanceLogs</span><span class="hljs-params">(String logFile)</span> {
        List&lt;PerformanceLog&gt; performanceLogs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-comment">// 解析性能日志</span>
        <span class="hljs-comment">// 实际实现需要根据日志格式解析</span>
        
        <span class="hljs-keyword">return</span> performanceLogs;
    }
    
    <span class="hljs-keyword">private</span> ErrorLog <span class="hljs-title function_">parseErrorLog</span><span class="hljs-params">(String line)</span> {
        <span class="hljs-comment">// 解析错误日志</span>
        <span class="hljs-comment">// 实际实现需要根据日志格式解析</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInTimeRange</span><span class="hljs-params">(Date timestamp, Date startTime, Date endTime)</span> {
        <span class="hljs-keyword">return</span> timestamp.after(startTime) &amp;&amp; timestamp.before(endTime);
    }
}

<span class="hljs-comment">// 错误日志</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorLog</span> {
    <span class="hljs-keyword">private</span> Date timestamp;
    <span class="hljs-keyword">private</span> String level;
    <span class="hljs-keyword">private</span> String errorType;
    <span class="hljs-keyword">private</span> String message;
    <span class="hljs-keyword">private</span> String stackTrace;
}

<span class="hljs-comment">// 性能日志</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceLog</span> {
    <span class="hljs-keyword">private</span> Date timestamp;
    <span class="hljs-keyword">private</span> String method;
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> executionTime;
    <span class="hljs-keyword">private</span> String parameters;
}

<span class="hljs-comment">// APM监控</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">APMMonitor</span> {
    
    <span class="hljs-comment">// 方法执行时间监控</span>
    <span class="hljs-meta">@Around("@annotation(MonitorPerformance)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">monitorPerformance</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().toShortString();
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
            <span class="hljs-type">long</span> <span class="hljs-variable">executionTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
            
            <span class="hljs-comment">// 记录性能日志</span>
            logPerformance(methodName, executionTime, <span class="hljs-literal">true</span>);
            
            <span class="hljs-comment">// 如果执行时间过长，记录警告</span>
            <span class="hljs-keyword">if</span> (executionTime &gt; <span class="hljs-number">1000</span>) {
                log.warn(<span class="hljs-string">"方法执行时间过长: method={}, time={}ms"</span>, methodName, executionTime);
            }
            
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-type">long</span> <span class="hljs-variable">executionTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
            logPerformance(methodName, executionTime, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">throw</span> e;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logPerformance</span><span class="hljs-params">(String methodName, <span class="hljs-type">long</span> executionTime, <span class="hljs-type">boolean</span> success)</span> {
        <span class="hljs-comment">// 发送到监控系统</span>
        <span class="hljs-comment">// 实际实现可以发送到Prometheus、InfluxDB等</span>
    }
}

<span class="hljs-comment">// 性能监控注解</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MonitorPerformance {
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;
}
</code></pre>
<h3 data-id="heading-12">4.2 健康检查与告警</h3>
<p><strong>健康检查实现：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 健康检查服务</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthCheckService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DataSource dataSource;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-comment">// 数据库健康检查</span>
    <span class="hljs-keyword">public</span> HealthStatus <span class="hljs-title function_">checkDatabase</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> dataSource.getConnection();
            <span class="hljs-type">boolean</span> <span class="hljs-variable">valid</span> <span class="hljs-operator">=</span> connection.isValid(<span class="hljs-number">5</span>);
            connection.close();
            
            <span class="hljs-keyword">if</span> (valid) {
                <span class="hljs-keyword">return</span> HealthStatus.healthy(<span class="hljs-string">"数据库连接正常"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> HealthStatus.unhealthy(<span class="hljs-string">"数据库连接异常"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> HealthStatus.unhealthy(<span class="hljs-string">"数据库健康检查失败: "</span> + e.getMessage());
        }
    }
    
    <span class="hljs-comment">// Redis健康检查</span>
    <span class="hljs-keyword">public</span> HealthStatus <span class="hljs-title function_">checkRedis</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute((RedisCallback&lt;String&gt;) connection -&gt; {
                <span class="hljs-keyword">return</span> connection.ping();
            });
            
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"PONG"</span>.equals(result)) {
                <span class="hljs-keyword">return</span> HealthStatus.healthy(<span class="hljs-string">"Redis连接正常"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> HealthStatus.unhealthy(<span class="hljs-string">"Redis连接异常"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> HealthStatus.unhealthy(<span class="hljs-string">"Redis健康检查失败: "</span> + e.getMessage());
        }
    }
    
    <span class="hljs-comment">// 综合健康检查</span>
    <span class="hljs-keyword">public</span> Map&lt;String, HealthStatus&gt; <span class="hljs-title function_">checkAll</span><span class="hljs-params">()</span> {
        Map&lt;String, HealthStatus&gt; statuses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        statuses.put(<span class="hljs-string">"database"</span>, checkDatabase());
        statuses.put(<span class="hljs-string">"redis"</span>, checkRedis());
        <span class="hljs-comment">// 添加其他检查项</span>
        <span class="hljs-keyword">return</span> statuses;
    }
}

<span class="hljs-comment">// 健康状态</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HealthStatus</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> healthy;
    <span class="hljs-keyword">private</span> String message;
    <span class="hljs-keyword">private</span> Date checkTime;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HealthStatus <span class="hljs-title function_">healthy</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HealthStatus</span>(<span class="hljs-literal">true</span>, message, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HealthStatus <span class="hljs-title function_">unhealthy</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HealthStatus</span>(<span class="hljs-literal">false</span>, message, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
    }
}

<span class="hljs-comment">// 告警服务</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlertService</span> {
    
    <span class="hljs-comment">// 发送告警</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendAlert</span><span class="hljs-params">(AlertLevel level, String message)</span> {
        log.warn(<span class="hljs-string">"告警: level={}, message={}"</span>, level, message);
        
        <span class="hljs-comment">// 根据告警级别发送通知</span>
        <span class="hljs-keyword">switch</span> (level) {
            <span class="hljs-keyword">case</span> CRITICAL:
                <span class="hljs-comment">// 发送紧急通知（短信、电话等）</span>
                sendCriticalAlert(message);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> WARNING:
                <span class="hljs-comment">// 发送警告通知（邮件、企业微信等）</span>
                sendWarningAlert(message);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> INFO:
                <span class="hljs-comment">// 记录信息</span>
                log.info(<span class="hljs-string">"告警信息: {}"</span>, message);
                <span class="hljs-keyword">break</span>;
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendCriticalAlert</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-comment">// 实现紧急告警逻辑</span>
        log.error(<span class="hljs-string">"紧急告警: {}"</span>, message);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendWarningAlert</span><span class="hljs-params">(String message)</span> {
        <span class="hljs-comment">// 实现警告告警逻辑</span>
        log.warn(<span class="hljs-string">"警告告警: {}"</span>, message);
    }
}

<span class="hljs-keyword">enum</span> <span class="hljs-title class_">AlertLevel</span> {
    INFO, WARNING, CRITICAL
}
</code></pre>
<hr/>
<h2 data-id="heading-13">5. 面试准备</h2>
<h3 data-id="heading-14">5.1 常见面试题</h3>
<p><strong>核心面试题解答：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 如何实现线程安全的单例模式？</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-comment">// 双重检查锁定</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton instance;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> {}
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (Singleton.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
    
    <span class="hljs-comment">// 静态内部类方式（推荐）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance2</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;
    }
}

<span class="hljs-comment">// 2. 如何实现生产者消费者模式？</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerConsumerExample</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;String&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10</span>);
    
    <span class="hljs-comment">// 生产者</span>
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">(String item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        queue.put(item);
        log.info(<span class="hljs-string">"生产: {}"</span>, item);
    }
    
    <span class="hljs-comment">// 消费者</span>
    <span class="hljs-meta">@Async</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consume</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">String</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> queue.take();
        log.info(<span class="hljs-string">"消费: {}"</span>, item);
    }
}

<span class="hljs-comment">// 3. 如何实现LRU缓存？</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LRUCache</span>&lt;K, V&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> capacity;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LinkedHashMap&lt;K, V&gt; cache;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LRUCache</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> {
        <span class="hljs-built_in">this</span>.capacity = capacity;
        <span class="hljs-built_in">this</span>.cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;K, V&gt;(capacity, <span class="hljs-number">0.75f</span>, <span class="hljs-literal">true</span>) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;K, V&gt; eldest)</span> {
                <span class="hljs-keyword">return</span> size() &gt; capacity;
            }
        };
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> {
        <span class="hljs-keyword">return</span> cache.get(key);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> {
        cache.put(key, value);
    }
}

<span class="hljs-comment">// 4. 如何实现分布式锁？</span>
<span class="hljs-comment">// 见前面章节的Redis分布式锁实现</span>

<span class="hljs-comment">// 5. 如何设计一个高并发的秒杀系统？</span>
<span class="hljs-comment">// 见前面章节的秒杀系统实现</span>
</code></pre>
<h3 data-id="heading-15">5.2 系统设计题</h3>
<p><strong>系统设计题解答框架：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 系统设计：设计一个短链接系统</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShortUrlService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ShortUrlRepository shortUrlRepository;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SHORT_URL_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://short.ly/"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BASE62</span> <span class="hljs-operator">=</span> <span class="hljs-string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>;
    
    <span class="hljs-comment">// 生成短链接</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateShortUrl</span><span class="hljs-params">(String longUrl)</span> {
        <span class="hljs-comment">// 1. 检查是否已存在</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">existingShortUrl</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">"long:"</span> + longUrl);
        <span class="hljs-keyword">if</span> (existingShortUrl != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> existingShortUrl;
        }
        
        <span class="hljs-comment">// 2. 生成短链接</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">shortCode</span> <span class="hljs-operator">=</span> generateShortCode();
        <span class="hljs-type">String</span> <span class="hljs-variable">shortUrl</span> <span class="hljs-operator">=</span> SHORT_URL_PREFIX + shortCode;
        
        <span class="hljs-comment">// 3. 保存映射关系</span>
        <span class="hljs-type">ShortUrlMapping</span> <span class="hljs-variable">mapping</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShortUrlMapping</span>();
        mapping.setShortCode(shortCode);
        mapping.setLongUrl(longUrl);
        mapping.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
        shortUrlRepository.save(mapping);
        
        <span class="hljs-comment">// 4. 缓存</span>
        redisTemplate.opsForValue().set(<span class="hljs-string">"short:"</span> + shortCode, longUrl, <span class="hljs-number">7</span>, TimeUnit.DAYS);
        redisTemplate.opsForValue().set(<span class="hljs-string">"long:"</span> + longUrl, shortUrl, <span class="hljs-number">7</span>, TimeUnit.DAYS);
        
        <span class="hljs-keyword">return</span> shortUrl;
    }
    
    <span class="hljs-comment">// 获取原始链接</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getLongUrl</span><span class="hljs-params">(String shortCode)</span> {
        <span class="hljs-comment">// 1. 从缓存获取</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">longUrl</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">"short:"</span> + shortCode);
        <span class="hljs-keyword">if</span> (longUrl != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> longUrl;
        }
        
        <span class="hljs-comment">// 2. 从数据库获取</span>
        <span class="hljs-type">ShortUrlMapping</span> <span class="hljs-variable">mapping</span> <span class="hljs-operator">=</span> shortUrlRepository.findByShortCode(shortCode);
        <span class="hljs-keyword">if</span> (mapping != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 更新缓存</span>
            redisTemplate.opsForValue().set(<span class="hljs-string">"short:"</span> + shortCode, mapping.getLongUrl(), <span class="hljs-number">7</span>, TimeUnit.DAYS);
            <span class="hljs-keyword">return</span> mapping.getLongUrl();
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShortUrlNotFoundException</span>(<span class="hljs-string">"短链接不存在"</span>);
    }
    
    <span class="hljs-comment">// 生成短码（Base62编码）</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateShortCode</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 使用雪花算法生成ID，然后Base62编码</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> snowflakeIdGenerator.nextId();
        <span class="hljs-keyword">return</span> base62Encode(id);
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">base62Encode</span><span class="hljs-params">(<span class="hljs-type">long</span> num)</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">while</span> (num &gt; <span class="hljs-number">0</span>) {
            sb.append(BASE62.charAt((<span class="hljs-type">int</span>) (num % <span class="hljs-number">62</span>)));
            num /= <span class="hljs-number">62</span>;
        }
        <span class="hljs-keyword">return</span> sb.reverse().toString();
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">6. 学习路径总结</h2>
<h3 data-id="heading-17">6.1 知识体系梳理</h3>
<p><strong>30天学习成果总结：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 学习路径总结</span>
<span class="hljs-comment">/**
 * Java学习30天知识体系
 * 
 * 基础阶段（Day 1-10）
 * - Java基础语法
 * - 面向对象编程
 * - 集合框架
 * - 异常处理
 * - I/O流
 * - 多线程
 * 
 * 进阶阶段（Day 11-20）
 * - Spring框架
 * - Spring Boot
 * - 数据库操作（JDBC、MyBatis）
 * - RESTful API
 * - 事务管理
 * - 缓存技术
 * 
 * 高级阶段（Day 21-30）
 * - 微服务架构
 * - 分布式系统
 * - 消息队列
 * - 分布式事务
 * - 性能优化
 * - 系统设计
 * 
 * 核心技能点：
 * 1. Java基础扎实
 * 2. Spring生态熟练
 * 3. 数据库优化能力
 * 4. 分布式系统设计
 * 5. 性能调优经验
 * 6. 系统架构能力
 */</span>
</code></pre>
<h3 data-id="heading-18">6.2 后续学习建议</h3>
<p><strong>继续学习方向：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * 后续学习建议
 * 
 * 1. 深入学习
 *    - 深入理解JVM原理
 *    - 学习设计模式实战
 *    - 掌握更多中间件（Kafka、Elasticsearch等）
 * 
 * 2. 实践项目
 *    - 参与开源项目
 *    - 构建个人项目
 *    - 解决实际问题
 * 
 * 3. 技术拓展
 *    - 学习云原生技术（Kubernetes、Docker）
 *    - 了解前端技术（Vue、React）
 *    - 学习大数据技术（Hadoop、Spark）
 * 
 * 4. 软技能
 *    - 提升代码质量
 *    - 学习系统设计
 *    - 加强沟通能力
 */</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[神兵在手，AI Agent 起步不愁：写给小白的 LangChain 入门指南]]></title>    <link>https://juejin.cn/post/7582021506189328430</link>    <guid>https://juejin.cn/post/7582021506189328430</guid>    <pubDate>2025-12-10T08:21:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582021506189328430" data-draft-id="7577189654471933978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="神兵在手，AI Agent 起步不愁：写给小白的 LangChain 入门指南"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T08:21:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            神兵在手，AI Agent 起步不愁：写给小白的 LangChain 入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:21:38.000Z" title="Wed Dec 10 2025 08:21:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">系列前言</h2>
<p>注，langchain 更新速度很快，本文所有案例都经过试验，在 2025年12月可用！</p>
<p>这是「写给小白学 AI」系列的第 5 篇文章，这个系列专门为刚接触人工智能的前端开发者和编程新手打造。如果你错过了之前的精彩内容，可以在这里补课：</p>
<ul>
<li><a href="https://juejin.cn/post/7573592127299108914" title="https://juejin.cn/post/7573592127299108914" target="_blank">打包票！前端和小白一定能明白的人工智能基础概念</a></li>
<li><a href="https://juejin.cn/post/7575162322241077248" title="https://juejin.cn/post/7575162322241077248" target="_blank">不易懂你打我！写给前端和小白的 大模型(ChatGPT) 工作基本原理！</a></li>
<li><a href="https://juejin.cn/post/7578416583213645874" title="https://juejin.cn/post/7578416583213645874" target="_blank">前端角度学 AI - 15 分钟入门 Python</a></li>
<li><a href="https://juejin.cn/post/7579935414423027758" target="_blank" title="https://juejin.cn/post/7579935414423027758">Prompt 还能哄女朋友！你真的知道如何问 ai 问题吗？</a></li>
</ul>
<p><strong>学习提示</strong>：为了让不同技术背景的同学都能跟上节奏，本文的代码示例会同时提供 Python 和 Node.js 版本，你可以选择自己熟悉的语言来实践。</p>
<h2 data-id="heading-1">一定要明白 ai agent 跟传统应用的区别</h2>
<p>我们假设要开发一个对话机器人的应用。</p>
<p>对于传统对话机器人开发：核心在于后端业务逻辑、数据库设计、API 接口等技术栈。</p>
<p>而对于 AI Agent 对话机器人开发：核心变成了如何与大模型对话、如何优化提示词、如何管理对话流程。</p>
<p>核心在于 ai agent 中，大模型是驱动这个程序核心，这也是为什么说 ai 改变了传统应用的开发模式，也正式了解到这个概念，我才明白，ai 应用开发跟传统应用开发的根本区别。</p>
<h2 data-id="heading-2">从理论到实践：为什么你需要一个 AI 开发框架</h2>
<p>经过前面几篇基础知识的铺垫，现在终于要进入激动人心的实战阶段了！但在真正开始动手构建 AI Agent 之前，我们需要先解决一个关键问题：</p>
<p><strong>工欲善其事，必先利其器</strong></p>
<p>在传统开发中，不同的编程语言都有自己的“神器”：</p>
<ul>
<li>Java 开发者会用 Spring 框架</li>
<li>Go 程序员会选择 Gin 框架</li>
<li>Python 开发者青睐 Django/Flask</li>
</ul>
<p>那么在 AI 应用开发领域，什么是我们的“趁手兵器”呢？</p>
<p>目前 AI Agent 开发框架中最耀眼的一颗星，毫无疑问就是 <strong>LangChain</strong>。今天，就让我们一起来揭开它的神秘面纱！</p>
<h2 data-id="heading-3">环境准备</h2>
<p>javascript 环境，对于我们前端来说无需多言，python 环境需要稍微费点力气。</p>
<p>首先建议使用包管理工具，例如 node.js 有 nvm ，我选择使用 miniconda 管理 python 版本。（你也可以放弃使用 python, 下面的案例是 node.js 和 python 都有）。</p>
<p>你可以网上搜索，我是 mac 系统，我参考的这篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F476670331" target="_blank" title="https://zhuanlan.zhihu.com/p/476670331" ref="nofollow noopener noreferrer">zhuanlan.zhihu.com/p/476670331</a></p>
<p>安装好之后，切记，要激活新的 python 环境，也就是对于 node.js 来说要切换到对应的 node.js 版本，这样后续才能使用这个版本。</p>
<p>创建新环境,myenv 是你的环境名字，python=3.13 是代表你喜欢切换的 python 版本</p>
<pre><code class="hljs language-ini" lang="ini">conda create -n myenv <span class="hljs-attr">python</span>=<span class="hljs-number">3.13</span>
</code></pre>
<p>激活新环境,myenv 代表上面我们创建的环境名字</p>
<pre><code class="hljs">conda activate myenv
</code></pre>
<p>安装依赖，使用原生python 自带的 pip 命令即可</p>
<pre><code class="hljs">pip 包名xx
</code></pre>
<p>安装之后，如何确认你安装完成呢，可以使用以下命令，查看所有安装的包</p>
<pre><code class="hljs">conda list
</code></pre>
<h2 data-id="heading-4"> LangChain 是什么？一个生动比喻告诉你答案</h2>
<p>我们再用一个例子，来说明 LangChain 为什么是 ai agent 开发中必不可少的内容。</p>
<p>没有 LangChain 时，调用不同的大模型可能需要这样：</p>
<p>以下是调用 OpenAI 的 python 代码，node.js 代码在后面</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 调用 OpenAI</span>
<span class="hljs-keyword">import</span> openai
openai.api_key = <span class="hljs-string">"your-key"</span>
response = openai.ChatCompletion.create(...)

<span class="hljs-comment"># 调用 Claude  </span>
<span class="hljs-keyword">import</span> anthropic
client = anthropic.Anthropic(api_key=<span class="hljs-string">"your-key"</span>)
response = client.messages.create(...)

<span class="hljs-comment"># 每个API都不一样，学习成本高！</span>
</code></pre>
<p>我们把上面 python 的示例换为 node.js</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;

<span class="hljs-comment">// 初始化客户端</span>
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'your-openai-api-key'</span>,
});

<span class="hljs-comment">// 调用 ChatGPT</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callOpenAI</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> completion = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>,
      <span class="hljs-attr">messages</span>: [
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"system"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"You are a helpful assistant."</span> },
        { <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"Hello!"</span> }
      ],
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
    });

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(completion.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
    <span class="hljs-keyword">return</span> completion;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error calling OpenAI:'</span>, error);
  }
}


<span class="hljs-comment">// 调用 Claude</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Anthropic</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@anthropic-ai/sdk'</span>;

<span class="hljs-comment">// 初始化客户端</span>
<span class="hljs-keyword">const</span> anthropic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Anthropic</span>({
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">'your-anthropic-api-key'</span>,
});

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callClaude</span>(<span class="hljs-params"/>) {xxx}

<span class="hljs-comment">// 调用函数</span>
<span class="hljs-title function_">callClaude</span>();
</code></pre>
<p>而你使用 langChain 后：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">from</span> langchain_anthropic <span class="hljs-keyword">import</span> ChatAnthropic

<span class="hljs-comment"># 统一的使用方式</span>
openai_llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4"</span>)
claude_llm = ChatAnthropic(model=<span class="hljs-string">"claude-3"</span>)

<span class="hljs-comment"># 调用方式完全一致！</span>
response1 = openai_llm.invoke(<span class="hljs-string">"你好"</span>)
response2 = claude_llm.invoke(<span class="hljs-string">"Hello"</span>)
</code></pre>
<p>node.js 版本</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatAnthropic</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/anthropic"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'dotenv/config'</span>; <span class="hljs-comment">// 确保已安装 dotenv: npm install dotenv</span>

<span class="hljs-comment">// 注：import 'dotenv/config';作用是自动从项目根目录的 `.env` 文件中读取环境变量</span>
<span class="hljs-comment">// 例如 .env 文件中有配置 OPENAI_API_KEY = xxx, 那么我们就可以用 process.env.OPENAI_API_KEY 获取到值</span>

<span class="hljs-comment">// 统一的使用方式</span>
<span class="hljs-keyword">const</span> openai_llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
  <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>, <span class="hljs-comment">// 从环境变量读取</span>
});

<span class="hljs-keyword">const</span> claude_llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatAnthropic</span>({
  <span class="hljs-attr">modelName</span>: <span class="hljs-string">"claude-3-opus-20240229"</span>, <span class="hljs-comment">// Claude 需要具体版本</span>
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
  <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ANTHROPIC_API_KEY</span>, <span class="hljs-comment">// 从环境变量读取</span>
});

<span class="hljs-comment">// 调用方式完全一致！</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callModels</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 单个调用</span>
    <span class="hljs-keyword">const</span> response1 = <span class="hljs-keyword">await</span> openai_llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"你好"</span>);
    <span class="hljs-keyword">const</span> response2 = <span class="hljs-keyword">await</span> claude_llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"Hello"</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"GPT-4 回复:"</span>, response1.<span class="hljs-property">content</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Claude 3 回复:"</span>, response2.<span class="hljs-property">content</span>);
    
    <span class="hljs-keyword">return</span> { response1, response2 };
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"调用模型时出错:"</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// 调用函数</span>
<span class="hljs-title function_">callModels</span>();
</code></pre>
<p>看到区别了吗？LangChain 就像是一个<strong>万能翻译器</strong>，无论底层用的是哪个大模型，都为你提供统一的 API 接口。</p>
<p>注意这些案例，你需要充值才能调用，我是充值了 deepseek 10 元用来练习，调用方式跟 openai，一直，我先给大家展示一下deepseek用langchain的调用方式：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 要安装对应的包 langchain langchain-openai</span>
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

api_key = <span class="hljs-string">"xxx"</span> <span class="hljs-comment"># 自己去生成 api_key</span>

openai_llm = ChatOpenAI(
    model_name=<span class="hljs-string">"deepseek-chat"</span>,
    temperature=<span class="hljs-number">0</span>,
    api_key=api_key,
    base_url=<span class="hljs-string">"https://api.deepseek.com"</span>,
)

response1 = openai_llm.invoke(<span class="hljs-string">"你好"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"Response 1:"</span>, response1)

</code></pre>
<p>js 版本, 注意下载 @langchain/core，@langchain/openai 包。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;

<span class="hljs-keyword">const</span> apiKey = <span class="hljs-string">"sk-xx"</span>;

<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">model</span>: <span class="hljs-string">"deepseek-chat"</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0</span>,
  apiKey,
  <span class="hljs-attr">configuration</span>: {
    <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"https://api.deepseek.com"</span>,
  },
  <span class="hljs-comment">// other params...</span>
});

<span class="hljs-keyword">const</span> <span class="hljs-title function_">run</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>([
      {
        <span class="hljs-attr">role</span>: <span class="hljs-string">"user"</span>,
        <span class="hljs-attr">content</span>: <span class="hljs-string">"I love programming."</span>,
      },
    ]);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"response:"</span>, response);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error:"</span>, error);
  }
};

<span class="hljs-title function_">run</span>();

</code></pre>
<h2 data-id="heading-5">拆解 LangChain：名字里藏着什么秘密？</h2>
<p>Lang + Chain = 语言模型 + 链式调用</p>
<p>这个名字精准地描述了它的核心思想：</p>
<ul>
<li>Lang：代表大语言模型（Large Language Model）</li>
<li>Chain：代表将不同组件像链条一样连接起来</li>
</ul>
<p>合起来就是：通过链式架构将大模型能力连接到实际应用中。</p>
<h3 data-id="heading-6">前端开发者的福音</h3>
<p>好消息是，LangChain 原生支持 TypeScript！这意味着前端开发者可以用自己熟悉的 JavaScript/TypeScript 来构建 AI 应用。不过现实情况是，AI 领域的主流语言仍然是 Python，所以本文会以 Python 为主进行讲解。</p>
<p>不用担心：即使你现在对 Python 不熟悉，跟着示例一步步来，遇到不懂的地方随时问 AI 助手（比如我😊），多看多练自然就掌握了。</p>
<h2 data-id="heading-7">LangChain 还解决了哪些大模型的问题</h2>
<p>大模型虽然强大，但也有一些“与生俱来”的局限性：</p>
<h3 data-id="heading-8">1. 信息过时问题</h3>
<blockquote>
<p>“今天北京的天气怎么样？”</p>
</blockquote>
<p>大模型很可能会告诉你它不知道，因为它的训练数据截止到某个特定日期。这种时效性强的问题，单纯的大模型很难给出准确答案。</p>
<h3 data-id="heading-9">2. 无法联网</h3>
<blockquote>
<p>“帮我查一下特斯拉最新的股价”</p>
</blockquote>
<p>大模型不能实时访问互联网（虽然有些模型后期增加了联网功能，但这通常是基于 LangChain 等技术实现的扩展）。</p>
<h3 data-id="heading-10">3. 私有知识盲区</h3>
<blockquote>
<p>“我们公司的产品定价策略是什么？”</p>
</blockquote>
<p>大模型没有学习过你公司的内部文档，自然无法回答这类问题。</p>
<h3 data-id="heading-11">4. 无法调用外部服务</h3>
<blockquote>
<p>“帮我订一张明天去上海的机票”</p>
</blockquote>
<p>大模型本身没有订票能力，它需要调用第三方的机票预订 API。</p>
<h2 data-id="heading-12">LangChain 如何解决这些问题？</h2>
<p>针对上述问题，LangChain 提供了完整的解决方案：</p>
<h3 data-id="heading-13">解决方案矩阵</h3>






























<table><thead><tr><th>大模型的问题</th><th>LangChain 的解决方案</th><th>实际应用场景</th></tr></thead><tbody><tr><td>信息过时</td><td>实时数据检索</td><td>新闻查询、股票价格、天气信息</td></tr><tr><td>无法联网</td><td>网络搜索工具</td><td>最新资讯、实时数据获取</td></tr><tr><td>私有知识盲区</td><td>文档加载与向量检索</td><td>企业内部知识库、专业文档问答</td></tr><tr><td>不能调用 API</td><td>工具调用集成</td><td>订票、支付、查询等实际业务</td></tr></tbody></table>
<h3 data-id="heading-14">统一的多模型支持</h3>
<p>LangChain 支持几乎所有主流大模型：</p>
<ul>
<li>OpenAI GPT 系列</li>
<li>Anthropic Claude 系列</li>
<li>Google Gemini</li>
<li>开源模型（Llama、Qwen等）</li>
</ul>
<p>而且调用方式完全统一，让你可以轻松切换或同时使用多个模型。</p>
<h2 data-id="heading-15">关于可视化平台的思考</h2>
<p>有些同学可能会问：“现在不是有 Coze、Dify 这类可视化 AI 应用搭建平台吗？为什么还要学编程去做大模型应用？”</p>
<p>这个问题问得很好！作为前端开发者，你一定很清楚低代码/无代码平台的优缺点：</p>
<p>可视化平台的优势</p>
<ul>
<li>上手快，无需编码</li>
<li>快速原型验证</li>
<li>适合简单场景</li>
</ul>
<p>可视化平台的局限</p>
<ul>
<li>定制化能力有限</li>
<li>复杂逻辑实现困难</li>
<li>难以集成到现有系统</li>
<li>性能和扩展性受限</li>
</ul>
<p>就像你不会只用低代码平台来做复杂的前端项目一样，在需要深度定制和复杂集成的 AI 应用场景中，掌握 LangChain 这样的编程框架是必不可少的。</p>
<p>讲完 langchain 是什么了，接下来我们了解下 ai agent 开发我们常见遇到的 4 个场景，帮助我们了解到后续开发 ai agent 可能遇到的架构是什么。</p>
<h2 data-id="heading-16">ai agent 开发常见的 4 个场景</h2>
<h3 data-id="heading-17">纯Prompt场景</h3>
<p><strong>纯Prompt场景</strong>是最基础、最直接的AI应用方式，就像使用搜索引擎一样简单：你输入问题（Prompt），AI直接返回答案。示意图如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff25b181f344473db64f1dd2b630542e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959697&amp;x-signature=Z5MF%2FndQTg0qhxe11BpvWmtcLAE%3D" alt="deepseek_mermaid_20251209_7f6711.png" loading="lazy"/></p>
<p>使用 langChain 示例代码, node.js （大家测试，为了方便，可以用我们之前的 deepseek 版本，毕竟是练习 api 而已） ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 纯Prompt场景的简单实现</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatOpenAI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/openai"</span>;

<span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatOpenAI</span>({
  <span class="hljs-attr">modelName</span>: <span class="hljs-string">"gpt-4"</span>,
  <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
});

<span class="hljs-comment">// 直接调用</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"帮我写一首关于春天的诗"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">content</span>);
</code></pre>
<p>python版本：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安装依赖：pip install langchain-openai</span>
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 纯Prompt场景的简单实现</span>
llm = ChatOpenAI(
    model=<span class="hljs-string">"gpt-4"</span>,  <span class="hljs-comment"># Python中参数名是model，不是modelName</span>
    temperature=<span class="hljs-number">0.7</span>,
    api_key=os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>)  <span class="hljs-comment"># 从环境变量读取</span>
)

<span class="hljs-comment"># 直接调用</span>
response = llm.invoke(<span class="hljs-string">"帮我写一首关于春天的诗"</span>)
<span class="hljs-built_in">print</span>(response.content)

</code></pre>
<p>剩下的场景，后续在 langchain 的各个模块介绍中，会写案例。</p>
<h3 data-id="heading-18">场景二：Agent + Function Call</h3>
<p>什么是Agent + Function Call？</p>
<p><strong>Agent</strong>是能够自主规划、决策和执行的智能体，<strong>Function Call</strong>让AI能够调用外部工具和API，真正"动手做事"。</p>
<p>简单举例，我们查询天气时，ai 肯定不知道当天天气是什么，此时，ai 可以调用一个函数，这个函数是我们后端自己写的，当问及查询天气的时候，就让大模型调我们的查询天气 api，然后将结果给大模型，最后大模型返回给用户。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdae3d3f22314b98a29cf4baaa939714~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959697&amp;x-signature=QU%2BKsmsmaKRkuulb%2FYFPTgeRYZw%3D" alt="deepseek_mermaid_20251210_526e4f.png" loading="lazy"/></p>
<h3 data-id="heading-19">场景三：RAG（检索增强生成）</h3>
<p>简单来说，比如你们要做一个公司内部文档的 ai agent，当你问这个 ai agent 问题的时候，很多问题都是跟公司内部信息有关，这个大模型肯定是不知道的，所以我们提前把公司各种资料转化为大模型认识的格式（向量），保存在数据库中，当大模型回答有关公司问题的时候，先去我们的数据库差相关内容，然后找到相关信息，再把之前用户提问的问题增强一下。</p>
<p>增强是指，把从向量数据库搜索的一些资料也附带在问题中，最终大模型基于这些资料和用户的问题回答。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee56f99ad2be4ab59eada0d1c7db3850~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959697&amp;x-signature=Xn07fOGA6alErhR4FaBwkefSQrQ%3D" alt="deepseek_mermaid_20251210_703fdb.png" loading="lazy"/></p>
<h3 data-id="heading-20">场景四：Fine-tuning（微调训练）</h3>
<p>微调也很好理解，之前 rag 是把我们公司数据库里的信息附带着给大模型，让大模型知道一些背景信息，而微调，是直接把数据库里的资料给大模型训练，让大模型学习到。</p>
<p>最后用户问问题的时候，就不需要 rag 的模式，还去我们本地的数据库搜索了，直接就能回答跟公司相关的问题了。这就是微调！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8217f22c42294306b16b6803d51c1366~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765959697&amp;x-signature=k4O6rf9e84AN3MibFXIlwVIsfXE%3D" alt="deepseek_mermaid_20251210_d4c11f.png" loading="lazy"/></p>
<p>其实目前实现 ai agent 大部分就是上面四种类型 + 在可视化平台拖拉拽的方式。这对于大家理解如果开发 ai agent 涉及到的应用原理很有帮助！</p>
<h2 data-id="heading-21">欢迎加入交流群</h2>
<p>接下来 ai agent 部分，我们会继续介绍 langchain 的各个模块和基本使用。一起加油！</p>
<p>同时欢迎大家访问我的 headless(无样式) 组件库项目，欢迎一起交流！</p>
<p>欢迎到我们的交流群一起交流各种前端技术，同时欢迎访问我的 headless 组件库，同时感谢你的 star：</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.frontlight.tech%2F" title="https://link.juejin.cn/?target=https%3A%2F%2Fwww.frontlight.tech%2F" target="_blank">国内官网</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" title="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" target="_blank">感谢 github star</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 4.0 整合 MyBatis-Plus 完整教程]]></title>    <link>https://juejin.cn/post/7581876069608439851</link>    <guid>https://juejin.cn/post/7581876069608439851</guid>    <pubDate>2025-12-10T08:06:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581876069608439851" data-draft-id="7581789701532778538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 4.0 整合 MyBatis-Plus 完整教程"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-10T08:06:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小坏说Java"/> <meta itemprop="url" content="https://juejin.cn/user/3898184413750203"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 4.0 整合 MyBatis-Plus 完整教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3898184413750203/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小坏说Java
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:06:42.000Z" title="Wed Dec 10 2025 08:06:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot 4.0 整合 MyBatis-Plus 完整教程</h2>
<blockquote>
<p>注：Spring Boot 4.0 ，本教程基于 Spring Boot 4.0 的预览版和新特性预期进行构建。实际发布时可能会有调整。</p>
</blockquote>
<h3 data-id="heading-1">一、Spring Boot 4.0 新特性概述</h3>
<h4 data-id="heading-2">1.1 主要新特性</h4>
<ul>
<li>
<p><strong>Java 21+ 支持</strong>：基于虚拟线程的响应式编程增强</p>
</li>
<li>
<p><strong>GraalVM 原生镜像优化</strong>：更完善的 AOT 编译支持</p>
</li>
<li>
<p><strong>响应式编程增强</strong>：更好的响应式 MyBatis 支持</p>
</li>
<li>
<p><strong>模块化改进</strong>：更好的 Java Module 支持</p>
</li>
<li>
<p><strong>AI/机器学习集成</strong>：内置 AI 功能支持</p>
</li>
</ul>
<h4 data-id="heading-3">1.2 构建工具要求</h4>
<ul>
<li>
<p>JDK 21+</p>
</li>
<li>
<p>Maven 3.9+ 或 Gradle 8.5+</p>
</li>
<li>
<p>GraalVM 23.0+（可选，用于原生编译）</p>
</li>
</ul>
<h3 data-id="heading-4">二、项目初始化</h3>
<h4 data-id="heading-5">2.1 使用 Spring Initializr</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用官方 Initializr</span>
curl https://start.spring.io/starter.zip \
  -d <span class="hljs-attr">type</span>=maven-project \
  -d <span class="hljs-attr">language</span>=java \
  -d <span class="hljs-attr">bootVersion</span>=<span class="hljs-number">4.0</span>.<span class="hljs-number">0</span>-M1 \
  -d <span class="hljs-attr">baseDir</span>=spring-boot4-mybatisplus \
  -d <span class="hljs-attr">groupId</span>=com.example \
  -d <span class="hljs-attr">artifactId</span>=demo \
  -d <span class="hljs-attr">name</span>=demo \
  -d <span class="hljs-attr">description</span>=Demo+project+for+Spring+Boot+<span class="hljs-number">4.0</span>+with+MyBatis-Plus \
  -d <span class="hljs-attr">packageName</span>=com.example.demo \
  -d <span class="hljs-attr">packaging</span>=jar \
  -d <span class="hljs-attr">javaVersion</span>=<span class="hljs-number">21</span> \
  -d <span class="hljs-attr">dependencies</span>=web,data-jpa \
  -o demo.zip
</code></pre>
<h4 data-id="heading-6">2.2 手动创建 pom.xml</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 
         https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0-M1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springboot4-mybatisplus<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>springboot4-mybatisplus<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Spring Boot 4.0 with MyBatis-Plus<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mybatis-plus.version</span>&gt;</span>3.5.5<span class="hljs-tag">&lt;/<span class="hljs-name">mybatis-plus.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">graalvm.version</span>&gt;</span>23.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">graalvm.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Boot 4.0 核心依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 响应式 Web 支持（新特性） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- MyBatis-Plus --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${mybatis-plus.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 数据库驱动 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 响应式 MySQL 驱动（新特性） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.asyncer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>r2dbc-mysql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 响应式 R2DBC --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- Lombok --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- GraalVM 原生镜像支持（新特性） --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 测试依赖 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- 响应式测试支持 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.projectreactor<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>reactor-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Spring Boot Maven 插件，支持 AOT --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">builder</span>&gt;</span>paketobuildpacks/builder-jammy-tiny:latest<span class="hljs-tag">&lt;/<span class="hljs-name">builder</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">env</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">BP_NATIVE_IMAGE</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">BP_NATIVE_IMAGE</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">env</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
            
            <span class="hljs-comment">&lt;!-- GraalVM Native Image 插件 --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${graalvm.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">extensions</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">extensions</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>build-native<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>compile-no-fork<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- Spring Milestone 仓库 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>spring-milestones<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Spring Milestones<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
    
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">三、配置 MyBatis-Plus</h3>
<h4 data-id="heading-8">3.1 应用配置（application.yml）</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Spring Boot 4.0 新配置格式</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">springboot4-mybatisplus</span>
  
  <span class="hljs-comment"># 数据源配置（虚拟线程优化）</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mybatis_plus_demo?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">hikari:</span>
      <span class="hljs-comment"># 虚拟线程池配置（Spring Boot 4.0 新特性）</span>
      <span class="hljs-attr">thread-factory:</span> <span class="hljs-string">org.springframework.boot.jdbc.VirtualThreadExecutor</span>
    
  <span class="hljs-comment"># 响应式数据源（新特性）</span>
  <span class="hljs-attr">r2dbc:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">r2dbc:mysql://localhost:3306/mybatis_plus_demo</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
  
  <span class="hljs-comment"># AOT 编译配置</span>
  <span class="hljs-attr">aot:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">generate-code:</span> <span class="hljs-literal">true</span>
  
  <span class="hljs-comment"># GraalVM 原生镜像配置</span>
  <span class="hljs-attr">native:</span>
    <span class="hljs-attr">mode:</span> <span class="hljs-string">native</span>
    <span class="hljs-attr">debug:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment"># MyBatis-Plus 配置</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-comment"># 自动映射行为</span>
    <span class="hljs-attr">auto-mapping-behavior:</span> <span class="hljs-string">full</span>
    <span class="hljs-comment"># 驼峰命名转换</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-comment"># 日志实现</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>
  <span class="hljs-attr">global-config:</span>
    <span class="hljs-attr">db-config:</span>
      <span class="hljs-comment"># 逻辑删除字段名</span>
      <span class="hljs-attr">logic-delete-field:</span> <span class="hljs-string">deleted</span>
      <span class="hljs-comment"># 逻辑删除值</span>
      <span class="hljs-attr">logic-delete-value:</span> <span class="hljs-number">1</span>
      <span class="hljs-comment"># 逻辑未删除值</span>
      <span class="hljs-attr">logic-not-delete-value:</span> <span class="hljs-number">0</span>
      <span class="hljs-comment"># 主键类型</span>
      <span class="hljs-attr">id-type:</span> <span class="hljs-string">auto</span>
  <span class="hljs-comment"># 分页插件配置</span>
  <span class="hljs-attr">pagehelper:</span>
    <span class="hljs-attr">helper-dialect:</span> <span class="hljs-string">mysql</span>
    <span class="hljs-attr">reasonable:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">support-methods-arguments:</span> <span class="hljs-literal">true</span>

<span class="hljs-comment"># 日志配置</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span>
    <span class="hljs-attr">com.example.demo.mapper:</span> <span class="hljs-string">debug</span>
    <span class="hljs-attr">org.springframework.r2dbc:</span> <span class="hljs-string">debug</span>
  <span class="hljs-attr">pattern:</span>
    <span class="hljs-attr">console:</span> <span class="hljs-string">"%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"</span>

<span class="hljs-comment"># 虚拟线程配置（Spring Boot 4.0 新特性）</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">tomcat:</span>
    <span class="hljs-attr">threads:</span>
      <span class="hljs-comment"># 使用虚拟线程</span>
      <span class="hljs-attr">use-virtual-threads:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># 响应式服务器配置</span>
  <span class="hljs-attr">netty:</span>
    <span class="hljs-attr">connection-timeout:</span> <span class="hljs-string">2m</span>
</code></pre>
<h4 data-id="heading-9">3.2 MyBatis-Plus 配置类</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.demo.config;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.DbType;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.<span class="hljs-keyword">inner</span>.BlockAttackInnerInterceptor;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.<span class="hljs-keyword">inner</span>.OptimisticLockerInnerInterceptor;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.plugins.<span class="hljs-keyword">inner</span>.PaginationInnerInterceptor;
<span class="hljs-keyword">import</span> org.apache.ibatis.reflection.MetaObject;
<span class="hljs-keyword">import</span> org.mybatis.spring.<span class="hljs-keyword">annotation</span>.MapperScan;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.transaction.<span class="hljs-keyword">annotation</span>.EnableTransactionManagement;

<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-comment">/**
 * MyBatis-Plus 配置类
 * 使用 Spring Boot 4.0 新特性：虚拟线程兼容性配置
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableTransactionManagement</span>
<span class="hljs-meta">@MapperScan(<span class="hljs-string">"com.example.demo.mapper"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisPlusConfig</span> {

    <span class="hljs-comment">/**
     * MyBatis-Plus 拦截器配置
     * 支持分页、乐观锁、防全表更新与删除
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        
        <span class="hljs-comment">// 分页插件</span>
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        
        <span class="hljs-comment">// 乐观锁插件</span>
        interceptor.addInnerInterceptor(new OptimisticLockerInnerInterceptor());
        
        <span class="hljs-comment">// 防止全表更新与删除</span>
        interceptor.addInnerInterceptor(new BlockAttackInnerInterceptor());
        
        <span class="hljs-keyword">return</span> interceptor;
    }

    <span class="hljs-comment">/**
     * 元数据处理器 - 自动填充字段
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MetaObjectHandler metaObjectHandler() {
        <span class="hljs-keyword">return</span> new MetaObjectHandler() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> void insertFill(MetaObject metaObject) {
                <span class="hljs-comment">// 使用虚拟线程安全的日期时间</span>
                <span class="hljs-keyword">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createTime"</span>, LocalDateTime.<span class="hljs-keyword">class</span>, LocalDateTime.now());
                <span class="hljs-keyword">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"updateTime"</span>, LocalDateTime.<span class="hljs-keyword">class</span>, LocalDateTime.now());
                <span class="hljs-keyword">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"version"</span>, Integer.<span class="hljs-keyword">class</span>, <span class="hljs-number">1</span>);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> void updateFill(MetaObject metaObject) {
                <span class="hljs-keyword">this</span>.strictUpdateFill(metaObject, <span class="hljs-string">"updateTime"</span>, LocalDateTime.<span class="hljs-keyword">class</span>, LocalDateTime.now());
            }
        };
    }
}
</code></pre>
<h3 data-id="heading-10">四、实体类与 Mapper</h3>
<h4 data-id="heading-11">4.1 基础实体类</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.entity</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.Data</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.experimental</span><span class="hljs-selector-class">.Accessors</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.Serializable</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.time</span><span class="hljs-selector-class">.LocalDateTime</span>;

<span class="hljs-comment">/**
 * 基础实体类
 * 使用 Java 21 Record 模式（预览特性）
 */</span>
@<span class="hljs-selector-tag">Data</span>
@<span class="hljs-selector-tag">Accessors</span>(chain = true)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">BaseEntity</span> <span class="hljs-selector-tag">implements</span> <span class="hljs-selector-tag">Serializable</span> {
    
    <span class="hljs-comment">/**
     * 主键ID - 使用虚拟线程安全的ID生成策略
     */</span>
    <span class="hljs-variable">@TableId</span>(type = IdType.ASSIGN_ID)
    private Long id;
    
    <span class="hljs-comment">/**
     * 创建时间
     */</span>
    <span class="hljs-variable">@TableField</span>(fill = FieldFill.INSERT)
    private LocalDateTime createTime;
    
    <span class="hljs-comment">/**
     * 更新时间
     */</span>
    <span class="hljs-variable">@TableField</span>(fill = FieldFill.INSERT_<span class="hljs-attribute">UPDATE</span>)
    private LocalDateTime updateTime;
    
    <span class="hljs-comment">/**
     * 创建人
     */</span>
    <span class="hljs-variable">@TableField</span>(fill = FieldFill.INSERT)
    private String createBy;
    
    <span class="hljs-comment">/**
     * 更新人
     */</span>
    <span class="hljs-variable">@TableField</span>(fill = FieldFill.INSERT_<span class="hljs-attribute">UPDATE</span>)
    private String updateBy;
    
    <span class="hljs-comment">/**
     * 乐观锁版本号
     */</span>
    <span class="hljs-variable">@Version</span>
    <span class="hljs-variable">@TableField</span>(fill = FieldFill.INSERT)
    private Integer version;
    
    <span class="hljs-comment">/**
     * 逻辑删除标志
     */</span>
    <span class="hljs-variable">@TableLogic</span>
    <span class="hljs-variable">@TableField</span>(fill = FieldFill.INSERT)
    private Integer deleted;
}
</code></pre>
<h4 data-id="heading-12">4.2 用户实体类</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.demo.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.<span class="hljs-type">TableField</span>;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.<span class="hljs-type">TableName</span>;
<span class="hljs-keyword">import</span> lombok.<span class="hljs-type">Data</span>;
<span class="hljs-keyword">import</span> lombok.<span class="hljs-type">EqualsAndHashCode</span>;
<span class="hljs-keyword">import</span> lombok.experimental.<span class="hljs-type">Accessors</span>;

<span class="hljs-comment">/**
 * 用户实体类
 * 使用 Spring Boot 4.0 新特性：虚拟线程安全的序列化
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@EqualsAndHashCode</span>(callSuper = <span class="hljs-literal">true</span>)
<span class="hljs-meta">@Accessors</span>(chain = <span class="hljs-literal">true</span>)
<span class="hljs-meta">@TableName</span>(<span class="hljs-string">"sys_user"</span>)
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseEntity</span> </span>{
    
    <span class="hljs-comment">/**
     * 用户名
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> username;
    
    <span class="hljs-comment">/**
     * 密码
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> password;
    
    <span class="hljs-comment">/**
     * 邮箱
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> email;
    
    <span class="hljs-comment">/**
     * 手机号
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> phone;
    
    <span class="hljs-comment">/**
     * 状态：0-禁用，1-启用
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> status;
    
    <span class="hljs-comment">/**
     * 虚拟线程安全的额外字段
     * 使用 transient 避免序列化问题
     */</span>
    <span class="hljs-meta">@TableField</span>(exist = <span class="hljs-literal">false</span>)
    <span class="hljs-keyword">private</span> transient <span class="hljs-type">String</span> virtualThreadInfo;
}
</code></pre>
<h4 data-id="heading-13">4.3 Mapper 接口</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.demo.mapper;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;
<span class="hljs-keyword">import</span> com.example.demo.entity.User;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Select;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.repository.query.Param;
<span class="hljs-keyword">import</span> org.springframework.r2dbc.core.DatabaseClient;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-comment">/**
 * 用户 Mapper
 * 支持响应式查询（Spring Boot 4.0 新特性）
 */</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-title">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-type">User</span>&gt; {
    
    <span class="hljs-comment">/**
     * 传统阻塞式查询
     */</span>
    <span class="hljs-meta">@Select(<span class="hljs-string">"SELECT * FROM sys_user WHERE username = #{username}"</span>)</span>
    User selectByUsername(<span class="hljs-meta">@Param(<span class="hljs-string">"username"</span>)</span> String username);
    
    <span class="hljs-comment">/**
     * 响应式查询 - 返回单个结果
     * 使用虚拟线程安全的方式
     */</span>
    <span class="hljs-meta">@Select(<span class="hljs-string">"SELECT * FROM sys_user WHERE id = #{id}"</span>)</span>
    default Mono&lt;User&gt; selectReactiveById(<span class="hljs-built_in">Long</span> id, DatabaseClient databaseClient) {
        <span class="hljs-keyword">return</span> databaseClient.sql(<span class="hljs-string">"SELECT * FROM sys_user WHERE id = :id"</span>)
                .bind(<span class="hljs-string">"id"</span>, id)
                .map((row, metadata) -&gt; {
                    User user = new User();
                    user.setId(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"id"</span>, <span class="hljs-built_in">Long</span>.<span class="hljs-keyword">class</span>));
                    user.setUsername(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"username"</span>, String.<span class="hljs-keyword">class</span>));
                    user.setEmail(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"email"</span>, String.<span class="hljs-keyword">class</span>));
                    user.setStatus(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"status"</span>, Integer.<span class="hljs-keyword">class</span>));
                    <span class="hljs-keyword">return</span> user;
                })
                .one();
    }
    
    <span class="hljs-comment">/**
     * 响应式查询 - 返回多个结果
     */</span>
    <span class="hljs-meta">@Select(<span class="hljs-string">"SELECT * FROM sys_user WHERE status = #{status}"</span>)</span>
    default Flux&lt;User&gt; selectReactiveByStatus(Integer status, DatabaseClient databaseClient) {
        <span class="hljs-keyword">return</span> databaseClient.sql(<span class="hljs-string">"SELECT * FROM sys_user WHERE status = :status"</span>)
                .bind(<span class="hljs-string">"status"</span>, status)
                .map((row, metadata) -&gt; {
                    User user = new User();
                    user.setId(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"id"</span>, <span class="hljs-built_in">Long</span>.<span class="hljs-keyword">class</span>));
                    user.setUsername(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"username"</span>, String.<span class="hljs-keyword">class</span>));
                    user.setEmail(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"email"</span>, String.<span class="hljs-keyword">class</span>));
                    user.setStatus(row.<span class="hljs-keyword">get</span>(<span class="hljs-string">"status"</span>, Integer.<span class="hljs-keyword">class</span>));
                    <span class="hljs-keyword">return</span> user;
                })
                .all();
    }
}
</code></pre>
<h3 data-id="heading-14">五、Service 层实现</h3>
<h4 data-id="heading-15">5.1 接口定义</h4>
<pre><code class="hljs language-arduino" lang="arduino">package com.example.demo.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;
<span class="hljs-keyword">import</span> com.example.demo.entity.User;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-comment">/**
 * 用户服务接口
 * 支持响应式和虚拟线程
 */</span>
<span class="hljs-keyword">public</span> interface UserService extends IService&lt;User&gt; {
    
    <span class="hljs-comment">/**
     * 虚拟线程方式查询用户
     * Spring Boot 4.0 新特性
     */</span>
    <span class="hljs-function">CompletableFuture&lt;User&gt; <span class="hljs-title">findUserByUsernameVirtualThread</span><span class="hljs-params">(<span class="hljs-type">String</span> username)</span></span>;
    
    <span class="hljs-comment">/**
     * 响应式查询用户
     */</span>
    <span class="hljs-function">Mono&lt;User&gt; <span class="hljs-title">findUserByIdReactive</span><span class="hljs-params">(Long id)</span></span>;
    
    <span class="hljs-comment">/**
     * 响应式查询用户列表
     */</span>
    <span class="hljs-function">Flux&lt;User&gt; <span class="hljs-title">findUsersByStatusReactive</span><span class="hljs-params">(Integer status)</span></span>;
    
    <span class="hljs-comment">/**
     * 使用结构化并发（Java 21 新特性）
     */</span>
    <span class="hljs-function">User <span class="hljs-title">findUserWithStructuredConcurrency</span><span class="hljs-params">(Long id)</span></span>;
}
</code></pre>
<h4 data-id="heading-16">5.2 服务实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.service.impl;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
<span class="hljs-keyword">import</span> com.example.demo.entity.User;
<span class="hljs-keyword">import</span> com.example.demo.mapper.UserMapper;
<span class="hljs-keyword">import</span> com.example.demo.service.UserService;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.r2dbc.core.DatabaseClient;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.StructuredTaskScope;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * 用户服务实现
 * 使用 Spring Boot 4.0 新特性：虚拟线程和响应式编程
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserMapper userMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DatabaseClient databaseClient;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;User&gt; <span class="hljs-title function_">findUserByUsernameVirtualThread</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 在虚拟线程中执行</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 模拟耗时操作</span>
                Thread.sleep(<span class="hljs-number">100</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
            <span class="hljs-keyword">return</span> userMapper.selectOne(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;User&gt;()
                    .eq(User::getUsername, username)
            );
        }, Thread.ofVirtual().factory());
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">findUserByIdReactive</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> userMapper.selectReactiveById(id, databaseClient)
                .doOnNext(user -&gt; log.info(<span class="hljs-string">"Found user reactively: {}"</span>, user.getUsername()));
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Flux&lt;User&gt; <span class="hljs-title function_">findUsersByStatusReactive</span><span class="hljs-params">(Integer status)</span> {
        <span class="hljs-keyword">return</span> userMapper.selectReactiveByStatus(status, databaseClient)
                .doOnNext(user -&gt; log.info(<span class="hljs-string">"Streaming user: {}"</span>, user.getUsername()));
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserWithStructuredConcurrency</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-comment">// Java 21 结构化并发</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
            <span class="hljs-type">var</span> <span class="hljs-variable">userFuture</span> <span class="hljs-operator">=</span> scope.fork(() -&gt; 
                userMapper.selectById(id)
            );
            <span class="hljs-type">var</span> <span class="hljs-variable">userDetailsFuture</span> <span class="hljs-operator">=</span> scope.fork(() -&gt;
                <span class="hljs-comment">// 模拟获取用户详情</span>
                <span class="hljs-string">"User Details for ID: "</span> + id
            );
            
            scope.join();
            scope.throwIfFailed();
            
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userFuture.get();
            <span class="hljs-keyword">if</span> (user != <span class="hljs-literal">null</span>) {
                user.setVirtualThreadInfo(userDetailsFuture.get());
            }
            <span class="hljs-keyword">return</span> user;
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Task interrupted"</span>, e);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to fetch user"</span>, e);
        }
    }
    
    <span class="hljs-comment">/**
     * 批量保存用户 - 使用虚拟线程优化
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUsersWithVirtualThreads</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
            List&lt;StructuredTaskScope.Subtask&lt;User&gt;&gt; tasks = users.stream()
                .map(user -&gt; scope.fork(() -&gt; {
                    <span class="hljs-comment">// 每个用户保存操作在独立的虚拟线程中执行</span>
                    save(user);
                    <span class="hljs-keyword">return</span> user;
                }))
                .toList();
            
            scope.join();
            scope.throwIfFailed();
            
            <span class="hljs-comment">// 处理结果</span>
            tasks.forEach(task -&gt; 
                log.info(<span class="hljs-string">"Saved user: {}"</span>, task.get().getUsername())
            );
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Save interrupted"</span>, e);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Failed to save users"</span>, e);
        }
    }
}
</code></pre>
<h3 data-id="heading-17">六、Controller 层</h3>
<h4 data-id="heading-18">6.1 传统 REST Controller</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.controller</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.conditions</span><span class="hljs-selector-class">.query</span><span class="hljs-selector-class">.LambdaQueryWrapper</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.metadata</span><span class="hljs-selector-class">.IPage</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.extension</span><span class="hljs-selector-class">.plugins</span><span class="hljs-selector-class">.pagination</span><span class="hljs-selector-class">.Page</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.User</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.UserService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.RequiredArgsConstructor</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.extern</span><span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.Slf4j</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ResponseEntity</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.CompletableFuture</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ExecutionException</span>;

<span class="hljs-comment">/**
 * 用户控制器
 * 支持虚拟线程和传统阻塞模式
 */</span>
@<span class="hljs-selector-tag">Slf4j</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/v1/users"</span>)
@<span class="hljs-selector-tag">RequiredArgsConstructor</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">UserController</span> {
    
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">UserService</span> <span class="hljs-selector-tag">userService</span>;
    
    <span class="hljs-comment">/**
     * 创建用户
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">create</span>(<span class="hljs-variable">@RequestBody</span> User user) {
        <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">saved</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.save</span>(user);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">saved</span> ? 
            <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(user) : 
            <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.badRequest</span>()<span class="hljs-selector-class">.build</span>();
    }
    
    <span class="hljs-comment">/**
     * 分页查询用户
     * 使用虚拟线程优化
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/page"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">IPage</span>&lt;<span class="hljs-selector-tag">User</span>&gt;&gt; <span class="hljs-selector-tag">page</span>(
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"1"</span>) Integer current,
            <span class="hljs-variable">@RequestParam</span>(defaultValue = <span class="hljs-string">"10"</span>) Integer size) {
        
        <span class="hljs-selector-tag">Page</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">page</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Page</span>&lt;&gt;(current, size);
        <span class="hljs-selector-tag">IPage</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.page</span>(page);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(result);
    }
    
    <span class="hljs-comment">/**
     * 使用虚拟线程查询用户
     * Spring Boot 4.0 新特性
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/virtual/{username}"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">findByUsernameVirtual</span>(<span class="hljs-variable">@PathVariable</span> String username) 
            <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">ExecutionException</span>, <span class="hljs-selector-tag">InterruptedException</span> {
        
        <span class="hljs-selector-tag">CompletableFuture</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">future</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.findUserByUsernameVirtualThread</span>(username);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(future.<span class="hljs-built_in">get</span>());
    }
    
    <span class="hljs-comment">/**
     * 使用结构化并发查询用户
     * Java 21 新特性
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/structured/{id}"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">findWithStructuredConcurrency</span>(<span class="hljs-variable">@PathVariable</span> Long id) {
        <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.findUserWithStructuredConcurrency</span>(id);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(user);
    }
    
    <span class="hljs-comment">/**
     * 批量创建用户 - 使用虚拟线程
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch/virtual"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Void</span>&gt; <span class="hljs-selector-tag">createBatchVirtual</span>(<span class="hljs-variable">@RequestBody</span> List&lt;User&gt; users) {
        <span class="hljs-comment">// 在新线程中执行批量操作</span>
        <span class="hljs-selector-tag">Thread</span><span class="hljs-selector-class">.ofVirtual</span>()<span class="hljs-selector-class">.start</span>(() -&gt; {
            <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.saveUsersWithVirtualThreads</span>(users);
        });
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.accepted</span>()<span class="hljs-selector-class">.build</span>();
    }
}
</code></pre>
<h4 data-id="heading-19">6.2 响应式 Controller</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.demo.controller;

<span class="hljs-keyword">import</span> com.example.demo.entity.User;
<span class="hljs-keyword">import</span> com.example.demo.service.UserService;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.*;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-comment">/**
 * 响应式用户控制器
 * Spring Boot 4.0 响应式增强
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/api/v2/users"</span>)</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserReactiveController</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> UserService userService;
    
    <span class="hljs-comment">/**
     * 响应式查询单个用户
     */</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/reactive/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Mono&lt;ResponseEntity&lt;User&gt;&gt; findByIdReactive(<span class="hljs-meta">@PathVariable</span> <span class="hljs-built_in">Long</span> id) {
        <span class="hljs-keyword">return</span> userService.findUserByIdReactive(id)
                .map(ResponseEntity::ok)
                .defaultIfEmpty(ResponseEntity.notFound().build());
    }
    
    <span class="hljs-comment">/**
     * 响应式查询用户列表
     */</span>
    <span class="hljs-meta">@GetMapping(value = <span class="hljs-string">"/reactive/stream"</span>, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span>
    <span class="hljs-keyword">public</span> Flux&lt;User&gt; streamByStatus(<span class="hljs-meta">@RequestParam</span> Integer status) {
        <span class="hljs-keyword">return</span> userService.findUsersByStatusReactive(status)
                .delayElements(Duration.ofMillis(<span class="hljs-number">100</span>))  <span class="hljs-comment">// 模拟流式处理</span>
                .doOnNext(user -&gt; 
                    log.info(<span class="hljs-string">"Streaming user: {}"</span>, user.getUsername())
                );
    }
    
    <span class="hljs-comment">/**
     * SSE 流式传输
     */</span>
    <span class="hljs-meta">@GetMapping(value = <span class="hljs-string">"/sse"</span>, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span>
    <span class="hljs-keyword">public</span> Flux&lt;String&gt; userEvents() {
        <span class="hljs-keyword">return</span> Flux.interval(Duration.ofSeconds(<span class="hljs-number">1</span>))
                .map(sequence -&gt; 
                    String.format(<span class="hljs-string">"User Event %d at %s"</span>, 
                        sequence, 
                        java.time.LocalTime.now())
                );
    }
}
</code></pre>
<h3 data-id="heading-20">七、响应式 Repository</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.repository;

<span class="hljs-keyword">import</span> com.example.demo.entity.User;
<span class="hljs-keyword">import</span> org.springframework.data.r2dbc.repository.R2dbcRepository;
<span class="hljs-keyword">import</span> org.springframework.data.r2dbc.repository.Query;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-comment">/**
 * 响应式用户仓库
 * Spring Boot 4.0 响应式数据访问
 */</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserReactiveRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">R2dbcRepository</span>&lt;User, Long&gt; {
    
    <span class="hljs-comment">/**
     * 根据用户名查询
     */</span>
    <span class="hljs-meta">@Query("SELECT * FROM sys_user WHERE username = :username")</span>
    Mono&lt;User&gt; <span class="hljs-title function_">findByUsername</span><span class="hljs-params">(String username)</span>;
    
    <span class="hljs-comment">/**
     * 根据状态查询
     */</span>
    <span class="hljs-meta">@Query("SELECT * FROM sys_user WHERE status = :status")</span>
    Flux&lt;User&gt; <span class="hljs-title function_">findByStatus</span><span class="hljs-params">(Integer status)</span>;
    
    <span class="hljs-comment">/**
     * 分页查询
     */</span>
    <span class="hljs-meta">@Query("SELECT * FROM sys_user ORDER BY create_time DESC LIMIT :limit OFFSET :offset")</span>
    Flux&lt;User&gt; <span class="hljs-title function_">findAllWithPagination</span><span class="hljs-params">(<span class="hljs-type">int</span> limit, <span class="hljs-type">int</span> offset)</span>;
}
</code></pre>
<h3 data-id="heading-21">八、全局异常处理</h3>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">handler</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">baomidou</span>.<span class="hljs-property">mybatisplus</span>.<span class="hljs-property">core</span>.<span class="hljs-property">exceptions</span>.<span class="hljs-property">MybatisPlusException</span>;
<span class="hljs-keyword">import</span> lombok.<span class="hljs-property">extern</span>.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Slf4j</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">http</span>.<span class="hljs-property">HttpStatus</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">http</span>.<span class="hljs-property">ResponseEntity</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">ExceptionHandler</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">RestControllerAdvice</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">support</span>.<span class="hljs-property">WebExchangeBindException</span>;
<span class="hljs-keyword">import</span> reactor.<span class="hljs-property">core</span>.<span class="hljs-property">publisher</span>.<span class="hljs-property">Mono</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;

<span class="hljs-comment">/**
 * 全局异常处理器
 * 支持响应式异常处理
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    
    <span class="hljs-comment">/**
     * 处理 MyBatis-Plus 异常
     */</span>
    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">MybatisPlusException</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; <span class="hljs-title function_">handleMybatisPlusException</span>(<span class="hljs-params">
            MybatisPlusException e</span>) {
        
        log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"MyBatis-Plus Exception: {}"</span>, e.<span class="hljs-title function_">getMessage</span>(), e);
        
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"code"</span>, <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">INTERNAL_SERVER_ERROR</span>.<span class="hljs-title function_">value</span>());
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"数据库操作失败"</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"detail"</span>, e.<span class="hljs-title function_">getMessage</span>());
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"timestamp"</span>, <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>
                .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">INTERNAL_SERVER_ERROR</span>)
                .<span class="hljs-title function_">body</span>(response);
    }
    
    <span class="hljs-comment">/**
     * 处理虚拟线程中断异常
     */</span>
    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">InterruptedException</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; <span class="hljs-title function_">handleInterruptedException</span>(<span class="hljs-params">
            InterruptedException e</span>) {
        
        log.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"Virtual thread interrupted: {}"</span>, e.<span class="hljs-title function_">getMessage</span>());
        
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"code"</span>, <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">SERVICE_UNAVAILABLE</span>.<span class="hljs-title function_">value</span>());
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"请求被中断"</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"timestamp"</span>, <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());
        
        <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">interrupt</span>(); <span class="hljs-comment">// 恢复中断状态</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>
                .<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">SERVICE_UNAVAILABLE</span>)
                .<span class="hljs-title function_">body</span>(response);
    }
    
    <span class="hljs-comment">/**
     * 响应式异常处理
     */</span>
    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">WebExchangeBindException</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Mono</span>&lt;<span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt;&gt; <span class="hljs-title function_">handleBindException</span>(<span class="hljs-params">
            WebExchangeBindException e</span>) {
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Mono</span>.<span class="hljs-title function_">fromCallable</span>(() -&gt; {
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"code"</span>, <span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">BAD_REQUEST</span>.<span class="hljs-title function_">value</span>());
            response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"参数验证失败"</span>);
            
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; errors = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            e.<span class="hljs-title function_">getFieldErrors</span>().<span class="hljs-title function_">forEach</span>(error -&gt; 
                errors.<span class="hljs-title function_">put</span>(error.<span class="hljs-title function_">getField</span>(), error.<span class="hljs-title function_">getDefaultMessage</span>())
            );
            response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"errors"</span>, errors);
            response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"timestamp"</span>, <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());
            
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>.<span class="hljs-title function_">badRequest</span>().<span class="hljs-title function_">body</span>(response);
        });
    }
}
</code></pre>
<h3 data-id="heading-22">九、虚拟线程配置</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.demo.config;

<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration;
<span class="hljs-keyword">import</span> org.springframework.boot.web.embedded.tomcat.TomcatProtocolHandlerCustomizer;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.core.task.AsyncTaskExecutor;
<span class="hljs-keyword">import</span> org.springframework.core.task.support.TaskExecutorAdapter;
<span class="hljs-keyword">import</span> org.springframework.scheduling.<span class="hljs-keyword">annotation</span>.EnableAsync;

<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-comment">/**
 * 虚拟线程配置
 * Spring Boot 4.0 核心新特性
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadConfig</span> {
    
    <span class="hljs-comment">/**
     * 配置 Tomcat 使用虚拟线程
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> TomcatProtocolHandlerCustomizer&lt;?&gt; protocolHandlerVirtualThreadExecutorCustomizer() {
        <span class="hljs-keyword">return</span> protocolHandler -&gt; 
            protocolHandler.setExecutor(Executors.newVirtualThreadPerTaskExecutor());
    }
    
    <span class="hljs-comment">/**
     * 配置 Spring 异步任务执行器使用虚拟线程
     */</span>
    <span class="hljs-meta">@Bean(TaskExecutionAutoConfiguration.APPLICATION_TASK_EXECUTOR_BEAN_NAME)</span>
    <span class="hljs-keyword">public</span> AsyncTaskExecutor asyncTaskExecutor() {
        <span class="hljs-keyword">return</span> new TaskExecutorAdapter(Executors.newVirtualThreadPerTaskExecutor());
    }
    
    <span class="hljs-comment">/**
     * 配置虚拟线程池用于数据库操作
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> java.util.concurrent.ExecutorService databaseExecutor() {
        <span class="hljs-keyword">return</span> Executors.newThreadPerTaskExecutor(
            Thread.ofVirtual()
                .name(<span class="hljs-string">"db-virtual-thread-"</span>, <span class="hljs-number">0</span>)
                .factory()
        );
    }
}
</code></pre>
<h3 data-id="heading-23">十、AOT 和原生镜像支持</h3>
<h4 data-id="heading-24">10.1 创建 AOT 处理类</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.demo.aot;

<span class="hljs-keyword">import</span> org.springframework.aot.hint.RuntimeHints;
<span class="hljs-keyword">import</span> org.springframework.aot.hint.RuntimeHintsRegistrar;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.ImportRuntimeHints;

<span class="hljs-comment">/**
 * AOT 运行时提示注册
 * Spring Boot 4.0 原生镜像支持
 */</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ImportRuntimeHints(AotRuntimeHints.MybatisPlusRuntimeHints.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AotRuntimeHints</span> {
    
    static <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisPlusRuntimeHints</span> <span class="hljs-title">implements</span> <span class="hljs-title">RuntimeHintsRegistrar</span> {
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> void registerHints(RuntimeHints hints, ClassLoader classLoader) {
            <span class="hljs-comment">// 注册反射</span>
            hints.reflection().registerType(
                com.baomidou.mybatisplus.core.mapper.BaseMapper.<span class="hljs-keyword">class</span>,
                hint -&gt; hint.withMembers(
                    org.springframework.aot.hint.MemberCategory.INVOKE_PUBLIC_METHODS
                )
            );
            
            <span class="hljs-comment">// 注册资源</span>
            hints.resources().registerPattern(<span class="hljs-string">"mapper/*.xml"</span>);
            hints.resources().registerPattern(<span class="hljs-string">"mybatis-config.xml"</span>);
            
            <span class="hljs-comment">// 注册序列化</span>
            hints.serialization().registerType(
                com.example.demo.entity.User.<span class="hljs-keyword">class</span>
            );
            
            <span class="hljs-comment">// 注册代理</span>
            hints.proxies().registerJdkProxy(
                org.apache.ibatis.binding.MapperProxy.<span class="hljs-keyword">class</span>
            );
        }
    }
}
</code></pre>
<h4 data-id="heading-25">10.2 native-image.properties</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Args</span> = --enable-url-protocols=http,https \
       -H:+ReportExceptionStackTraces \
       -H:+ReportUnsupportedElementsAtRuntime \
       <span class="hljs-attr">--initialize-at-build-time</span>=com.mysql.cj \
       <span class="hljs-attr">--initialize-at-run-time</span>=io.netty.handler.codec.http.HttpObjectEncoder \
       -H:<span class="hljs-attr">IncludeResourceBundles</span>=com.mysql.cj.LocalizedErrorMessages
</code></pre>
<h3 data-id="heading-26">十一、测试类</h3>
<pre><code class="hljs language-scss" lang="scss">package com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span>;

import com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.User</span>;
import com<span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.demo</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.UserService</span>;
import lombok<span class="hljs-selector-class">.extern</span><span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.Slf4j</span>;
import org<span class="hljs-selector-class">.junit</span><span class="hljs-selector-class">.jupiter</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.Test</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.boot</span><span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.context</span><span class="hljs-selector-class">.SpringBootTest</span>;
import reactor<span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.publisher</span><span class="hljs-selector-class">.Mono</span>;
import reactor<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.StepVerifier</span>;

import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.CompletableFuture</span>;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ExecutionException</span>;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.TimeUnit</span>;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.TimeoutException</span>;

import static org<span class="hljs-selector-class">.assertj</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.Assertions</span><span class="hljs-selector-class">.assertThat</span>;

<span class="hljs-comment">/**
 * 集成测试
 * 测试虚拟线程和响应式功能
 */</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@SpringBootTest</span>
class SpringBoot4MybatisPlusApplicationTests {
    
    <span class="hljs-keyword">@Autowired</span>
    private UserService userService;
    
    <span class="hljs-comment">/**
     * 测试虚拟线程查询
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testVirtualThreadQuery() throws ExecutionException, InterruptedException, TimeoutException {
        <span class="hljs-comment">// 准备测试数据</span>
        User user = new <span class="hljs-built_in">User</span>()
                <span class="hljs-selector-class">.setUsername</span>("test_virtual")
                <span class="hljs-selector-class">.setEmail</span>("test@example.com")
                <span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>);
        
        userService<span class="hljs-selector-class">.save</span>(user);
        
        <span class="hljs-comment">// 使用虚拟线程查询</span>
        CompletableFuture&lt;User&gt; future = userService<span class="hljs-selector-class">.findUserByUsernameVirtualThread</span>("test_virtual");
        User result = future<span class="hljs-selector-class">.get</span>(<span class="hljs-number">5</span>, TimeUnit.SECONDS);
        
        <span class="hljs-built_in">assertThat</span>(result)<span class="hljs-selector-class">.isNotNull</span>();
        <span class="hljs-built_in">assertThat</span>(result.getUsername())<span class="hljs-selector-class">.isEqualTo</span>("test_virtual");
        
        log<span class="hljs-selector-class">.info</span>("Virtual thread test passed, user ID: {}", result.getId());
    }
    
    <span class="hljs-comment">/**
     * 测试响应式查询
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testReactiveQuery() {
        <span class="hljs-comment">// 准备测试数据</span>
        User user = new <span class="hljs-built_in">User</span>()
                <span class="hljs-selector-class">.setUsername</span>("test_reactive")
                <span class="hljs-selector-class">.setEmail</span>("reactive@example.com")
                <span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>);
        
        userService<span class="hljs-selector-class">.save</span>(user);
        
        <span class="hljs-comment">// 使用响应式查询</span>
        Mono&lt;User&gt; userMono = userService<span class="hljs-selector-class">.findUserByIdReactive</span>(user.getId());
        
        StepVerifier<span class="hljs-selector-class">.create</span>(userMono)
                <span class="hljs-selector-class">.assertNext</span>(foundUser -&gt; {
                    assertThat(foundUser)<span class="hljs-selector-class">.isNotNull</span>();
                    <span class="hljs-built_in">assertThat</span>(foundUser.getUsername())<span class="hljs-selector-class">.isEqualTo</span>("test_reactive");
                })
                <span class="hljs-selector-class">.verifyComplete</span>();
        
        log<span class="hljs-selector-class">.info</span>("Reactive query test passed");
    }
    
    <span class="hljs-comment">/**
     * 测试结构化并发
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testStructuredConcurrency() {
        <span class="hljs-comment">// 准备测试数据</span>
        User user = new <span class="hljs-built_in">User</span>()
                <span class="hljs-selector-class">.setUsername</span>("test_structured")
                <span class="hljs-selector-class">.setEmail</span>("structured@example.com")
                <span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>);
        
        userService<span class="hljs-selector-class">.save</span>(user);
        
        <span class="hljs-comment">// 使用结构化并发查询</span>
        User result = userService<span class="hljs-selector-class">.findUserWithStructuredConcurrency</span>(user.getId());
        
        <span class="hljs-built_in">assertThat</span>(result)<span class="hljs-selector-class">.isNotNull</span>();
        <span class="hljs-built_in">assertThat</span>(result.getUsername())<span class="hljs-selector-class">.isEqualTo</span>("test_structured");
        <span class="hljs-built_in">assertThat</span>(result.getVirtualThreadInfo())<span class="hljs-selector-class">.contains</span>("User Details");
        
        log<span class="hljs-selector-class">.info</span>("Structured concurrency test passed");
    }
    
    <span class="hljs-comment">/**
     * 测试批量虚拟线程操作
     */</span>
    <span class="hljs-keyword">@Test</span>
    void testBatchVirtualThreads() {
        <span class="hljs-comment">// 准备测试数据</span>
        List&lt;User&gt; users = new ArrayList&lt;&gt;();
        for (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            users<span class="hljs-selector-class">.add</span>(new User()
                    <span class="hljs-selector-class">.setUsername</span>("batch_user_" + i)
                    <span class="hljs-selector-class">.setEmail</span>("batch" + i + "@example.com")
                    <span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>));
        }
        
        <span class="hljs-comment">// 使用虚拟线程批量保存</span>
        userService<span class="hljs-selector-class">.saveUsersWithVirtualThreads</span>(users);
        
        <span class="hljs-comment">// 验证保存结果</span>
        List&lt;User&gt; savedUsers = userService<span class="hljs-selector-class">.list</span>(
            new LambdaQueryWrapper&lt;User&gt;()
                <span class="hljs-selector-class">.likeRight</span>(User::getUsername, "batch_user_")
        );
        
        <span class="hljs-built_in">assertThat</span>(savedUsers)<span class="hljs-selector-class">.hasSize</span>(<span class="hljs-number">10</span>);
        log<span class="hljs-selector-class">.info</span>("Batch virtual threads test passed, saved {} users", savedUsers.size());
    }
}
</code></pre>
<h3 data-id="heading-27">十二、性能监控</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.monitor;

<span class="hljs-keyword">import</span> io.micrometer.core.instrument.MeterRegistry;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.springframework.util.StopWatch;

<span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-comment">/**
 * 虚拟线程性能监控
 * Spring Boot 4.0 监控增强
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadMonitor</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MeterRegistry meterRegistry;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">activeVirtualThreads</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    
    <span class="hljs-comment">/**
     * 监控虚拟线程使用
     */</span>
    <span class="hljs-meta">@Around("@annotation(com.example.demo.annotation.VirtualThreadMonitor)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">monitorVirtualThread</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();
        <span class="hljs-type">int</span> <span class="hljs-variable">currentThreads</span> <span class="hljs-operator">=</span> activeVirtualThreads.incrementAndGet();
        
        <span class="hljs-keyword">try</span> {
            stopWatch.start();
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
            stopWatch.stop();
            
            <span class="hljs-comment">// 记录指标</span>
            meterRegistry.timer(<span class="hljs-string">"virtual.thread.execution.time"</span>)
                .record(stopWatch.getTotalTimeNanos(), java.util.concurrent.TimeUnit.NANOSECONDS);
            
            meterRegistry.gauge(<span class="hljs-string">"virtual.thread.active.count"</span>, activeVirtualThreads);
            
            log.info(<span class="hljs-string">"Virtual thread executed: method={}, time={}ms, activeThreads={}"</span>,
                joinPoint.getSignature().getName(),
                stopWatch.getTotalTimeMillis(),
                currentThreads);
            
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">finally</span> {
            activeVirtualThreads.decrementAndGet();
        }
    }
}
</code></pre>
<h3 data-id="heading-28">十三、启动类</h3>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>;

<span class="hljs-keyword">import</span> lombok.<span class="hljs-property">extern</span>.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Slf4j</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">context</span>.<span class="hljs-property">event</span>.<span class="hljs-property">ApplicationReadyEvent</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">event</span>.<span class="hljs-property">EventListener</span>;

<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringBoot4MybatisPlusApplication</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// 启用 AOT 优化</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-title function_">setProperty</span>(<span class="hljs-string">"spring.aot.enabled"</span>, <span class="hljs-string">"true"</span>);
        
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">SpringBoot4MybatisPlusApplication</span>.<span class="hljs-property">class</span>, args);
    }
    
    <span class="hljs-meta">@EventListener</span>(<span class="hljs-title class_">ApplicationReadyEvent</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onApplicationReady</span>(<span class="hljs-params"/>) {
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"========================================="</span>);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Spring Boot 4.0 with MyBatis-Plus Started"</span>);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Java Version: {}"</span>, <span class="hljs-title class_">System</span>.<span class="hljs-title function_">getProperty</span>(<span class="hljs-string">"java.version"</span>));
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Virtual Threads Available: {}"</span>, 
            <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">ofVirtual</span>() != <span class="hljs-literal">null</span> ? <span class="hljs-string">"Yes"</span> : <span class="hljs-string">"No"</span>);
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Available Processors: {}"</span>, 
            <span class="hljs-title class_">Runtime</span>.<span class="hljs-title function_">getRuntime</span>().<span class="hljs-title function_">availableProcessors</span>());
        log.<span class="hljs-title function_">info</span>(<span class="hljs-string">"========================================="</span>);
    }
}
</code></pre>
<h3 data-id="heading-29">十四、部署和优化</h3>
<h4 data-id="heading-30">14.1 Dockerfile（支持原生镜像）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建阶段</span>
FROM ghcr.io/graalvm/native-image:java21 AS builder
WORKDIR /app
COPY target/*.jar app.jar
RUN native-image -jar app.jar --no-fallback -H:Name=app-native

<span class="hljs-comment"># 运行阶段</span>
FROM alpine:latest
RUN apk add --no-cache libstdc++
WORKDIR /app
COPY --from=builder /app/app-native /app/app
EXPOSE 8080
ENTRYPOINT [<span class="hljs-string">"/app/app"</span>]
</code></pre>
<h4 data-id="heading-31">14.2 Docker Compose</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">app:</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:8080"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">SPRING_PROFILES_ACTIVE=prod</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">JAVA_OPTS=-XX:+UseZGC</span> <span class="hljs-string">-Xmx512m</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">resources:</span>
        <span class="hljs-attr">limits:</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">512M</span>
  
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-number">123456</span>
      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">mybatis_plus_demo</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3306:3306"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_data:/var/lib/mysql</span>
    <span class="hljs-attr">command:</span> 
      <span class="hljs-bullet">-</span> <span class="hljs-string">--default-authentication-plugin=mysql_native_password</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">--character-set-server=utf8mb4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">--collation-server=utf8mb4_unicode_ci</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">mysql_data:</span>
</code></pre>
<h3 data-id="heading-32">十五、总结</h3>
<h4 data-id="heading-33">15.1 关键特性使用</h4>
<ol>
<li>
<p><strong>虚拟线程</strong>：通过 <code>Thread.ofVirtual()</code>和虚拟线程池优化并发性能</p>
</li>
<li>
<p><strong>响应式编程</strong>：结合 MyBatis-Plus 和 R2DBC 实现非阻塞数据访问</p>
</li>
<li>
<p><strong>结构化并发</strong>：使用 Java 21 的结构化并发 API</p>
</li>
<li>
<p><strong>AOT 编译</strong>：支持 GraalVM 原生镜像，提升启动速度</p>
</li>
<li>
<p><strong>模块化</strong>：更好的 Java Module 支持</p>
</li>
</ol>
<h4 data-id="heading-34">15.2 性能优化建议</h4>
<ol>
<li>
<p>对于 I/O 密集型操作，使用虚拟线程</p>
</li>
<li>
<p>对于高并发场景，使用响应式编程</p>
</li>
<li>
<p>使用 GraalVM 原生镜像减少内存占用和启动时间</p>
</li>
<li>
<p>合理配置连接池和线程池参数</p>
</li>
</ol>
<h4 data-id="heading-35">15.3 注意事项</h4>
<ol>
<li>
<p>Spring Boot 4.0 目前是预览版，API 可能会有变化</p>
</li>
<li>
<p>虚拟线程对阻塞操作敏感，避免在虚拟线程中执行长时间 CPU 操作</p>
</li>
<li>
<p>原生镜像编译需要处理反射和动态代理的注册</p>
</li>
<li>
<p>生产环境建议充分测试响应式和虚拟线程的稳定性</p>
</li>
</ol>
<p>这个教程展示了如何利用 Spring Boot 4.0 的新特性（虚拟线程、响应式编程、AOT 编译等）来整合 MyBatis-Plus，构建高性能的现代 Java 应用程序。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎯 AI 写代码？我用 MCP 让 Copilot 秒变全栈工程师！]]></title>    <link>https://juejin.cn/post/7581870491764228148</link>    <guid>https://juejin.cn/post/7581870491764228148</guid>    <pubDate>2025-12-10T08:17:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581870491764228148" data-draft-id="7581870491764195380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 🎯 AI 写代码？我用 MCP 让 Copilot 秒变全栈工程师！"/> <meta itemprop="keywords" content="AI编程,React.js"/> <meta itemprop="datePublished" content="2025-12-10T08:17:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="leonwgc"/> <meta itemprop="url" content="https://juejin.cn/user/764915822903048"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             🎯 AI 写代码？我用 MCP 让 Copilot 秒变全栈工程师！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915822903048/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    leonwgc
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:17:23.000Z" title="Wed Dec 10 2025 08:17:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从 0 到 1，手把手教你用 Model Context Protocol 实现自动化开发，让 AI 真正懂你的项目！</p>
</blockquote>
<h2 data-id="heading-0">🤔 开局一句话：你还在手敲代码？</h2>
<p>兄弟姐妹们，2025 年了，还在一行一行敲代码？还在翻文档查 API？还在复制粘贴 Stack Overflow？</p>
<p>我跟你讲，<strong>这些都是上个时代的事情了</strong>。</p>
<p>前几天在掘金刷到「扒了下 Cursor 的提示词」这篇爆文，27k+ 赞，大家都在讨论 AI 编程。但今天我要聊的不是 Cursor，而是一个更底层、更强大的东西——<strong>Model Context Protocol (MCP)</strong>。</p>
<p>简单来说：<strong>MCP 让 AI 不再是个只会聊天的工具，而是一个真正懂你项目、懂你框架、懂你需求的全栈工程师</strong>。</p>
<h2 data-id="heading-1">🌟 什么是 MCP？30 秒给你讲明白</h2>
<p>传统的 AI 编程是这样的：</p>
<pre><code class="hljs language-scss" lang="scss">你：帮我写个 Ant Design 的 <span class="hljs-selector-tag">Table</span> 组件
AI：好的，这是代码...(可能用的是老版本 API)
你：诶不对，这个 API 已经废弃了
AI：哦抱歉，这样写...(又可能漏了某个必填属性)
你：😭 算了我自己查文档
</code></pre>
<p>用了 MCP 之后：</p>
<pre><code class="hljs language-erlang" lang="erlang">你：帮我写个用户管理页面，要有表格、分页、搜索
AI：(自动调用 MCP 服务)
    🔍 正在查询 Ant Design Table 组件最新 API...
    🔍 正在查询 ahooks useRequest 用法...
    🔍 正在查询表单验证最佳实践...
    ✨ 代码已生成！基于 Ant Design <span class="hljs-number">6.0</span>.<span class="hljs-number">0</span> 最新 API
你：🤩 一次性就能跑起来！
</code></pre>
<p><strong>核心差异：MCP 让 AI 拥有了"查文档"的能力，而且是实时的、最新的、准确的。</strong></p>
<h2 data-id="heading-2">💡 我的故事：从加班狗到躺平侠</h2>
<h3 data-id="heading-3">从前的我：典型的 996 战士</h3>
<p>去年这个时候，我还是个普通的前端开发，每天的日常是：</p>
<ul>
<li>🕘 上午：翻 Ant Design 文档，复制粘贴示例代码</li>
<li>🕐 下午：调试组件，发现 props 写错了，继续翻文档</li>
<li>🕘 晚上：写业务逻辑，重复造轮子</li>
<li>🕛 深夜：改 Bug，发现某个组件的 API 已经废弃了，从头再来</li>
</ul>
<p><strong>一个简单的用户管理页面，从需求到上线，至少要 2-3 天。</strong></p>
<h3 data-id="heading-4">现在的我：MCP 加持的效率怪</h3>
<p>配置好 MCP 之后，我的工作流变成了：</p>
<ol>
<li>
<p><strong>需求分析（5 分钟）</strong></p>
<pre><code class="hljs">老板：做个用户管理页面，要有增删改查
我：好的（心里OS：又是 CRUD，简单）
</code></pre>
</li>
<li>
<p><strong>与 AI 对话（2 分钟）</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">我：请创建一个用户管理页面，包含：
<span class="hljs-bullet">   -</span> 用户列表表格（分页、排序、搜索）
<span class="hljs-bullet">   -</span> 添加用户弹窗（表单验证）
<span class="hljs-bullet">   -</span> 编辑用户功能
<span class="hljs-bullet">   -</span> 删除确认

AI：收到！正在调用 MCP 服务...
</code></pre>
</li>
<li>
<p><strong>等待 AI 生成代码（3 分钟）</strong></p>
<ul>
<li>MCP 自动查询 Ant Design Table 的最新 API</li>
<li>MCP 自动查询 ahooks useRequest 的用法</li>
<li>MCP 自动查询表单验证的最佳实践</li>
<li>AI 基于这些信息生成完整代码</li>
</ul>
</li>
<li>
<p><strong>微调 + 测试（10 分钟）</strong></p>
<ul>
<li>代码一次性就能跑起来（因为 API 都是最新的）</li>
<li>只需要微调业务逻辑</li>
<li>样式符合项目规范（因为配置了开发指令）</li>
</ul>
</li>
</ol>
<p><strong>同样的用户管理页面，现在只需要 20 分钟。</strong></p>
<p>效率提升了 <strong>20 倍</strong>，加班时间减少了 <strong>80%</strong>，头发掉的也少了（这个最重要😂）。</p>
<h2 data-id="heading-5">🛠 实战教程：从零搭建 MCP 自动化开发环境</h2>
<p>好了，废话不多说，直接上干货。我会手把手带你从 0 到 1 搭建一个完整的 MCP 开发环境。</p>
<h3 data-id="heading-6">第一步：理解 MCP 的工作原理</h3>
<p>在开始之前，我们需要理解 MCP 是怎么工作的：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────┐
│   你的需求   │ "创建用户管理页面"
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  AI 助手     │ (GitHub Copilot / Cursor 等)
│  (Claude)    │
└──────┬──────┘
       │
       ▼ 调用 MCP 工具
┌─────────────┐
│  MCP 服务    │
│  ┌─────────┐│
│  │ Ant     ││ ← 查询 Ant Design 组件文档
│  │ Design  ││
│  └─────────┘│
│  ┌─────────┐│
│  │ ahooks  ││ ← 查询 ahooks API 文档
│  └─────────┘│
│  ┌─────────┐│
│  │ Memory  ││ ← 记住项目上下文
│  └─────────┘│
└──────┬──────┘
       │
       ▼ 返回最新、准确的文档
┌─────────────┐
│  生成代码    │ ← 基于最新 API 生成
└─────────────┘
</code></pre>
<p><strong>关键点：MCP 服务就像是 AI 的"外部大脑"，提供实时的、准确的知识库。</strong></p>
<h3 data-id="heading-7">第二步：安装 MCP 服务</h3>
<h4 data-id="heading-8">1. 全局安装 MCP 服务包</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Ant Design MCP 服务</span>
npm install -g ant-design-mcp

<span class="hljs-comment"># 安装 ahooks MCP 服务</span>
npm install -g ahooks-mcp
</code></pre>
<p>这两个包是干嘛的？</p>
<ul>
<li><strong>ant-design-mcp</strong>：提供 Ant Design 组件库的最新文档和示例</li>
<li><strong>ahooks-mcp</strong>：提供 ahooks React Hooks 库的最新文档和示例</li>
</ul>
<h4 data-id="heading-9">2. 配置 VS Code MCP 服务</h4>
<p>在项目根目录创建 <code>.vscode/mcp.json</code>：</p>
<pre><code class="hljs language-jsonc" lang="jsonc">{
  "inputs": [],
  "servers": {
    "ant-design": {
      "type": "stdio",
      "command": "ant-design-mcp"
    },
    "ahooks": {
      "type": "stdio",
      "command": "ahooks-mcp"
    },
    "memory": {
      "type": "stdio",
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    }
  }
}
</code></pre>
<p><strong>这个配置告诉 VS Code：当 AI 需要查文档时，去哪里找。</strong></p>
<h3 data-id="heading-10">第三步：配置开发指令（这是灵魂！）</h3>
<p>MCP 服务只是提供了"查文档"的能力，但怎么用这些文档？遵循什么规范？这就需要<strong>开发指令</strong>。</p>
<h4 data-id="heading-11">1. 创建基础开发规范</h4>
<p>在 <code>.github/instructions/00-dev.instructions.md</code>：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">applyTo: '<span class="hljs-strong">**'
---
# React + TypeScript 开发规范

1. 函数式组件，箭头函数，TypeScript 类型定义
2. 遵循 ESLint/Prettier (单引号、分号、2空格缩进)
3. SCSS + BEM 命名 (双引号 className，无 CSS modules)
4. 导入顺序：第三方库 &gt; 项目模块 &gt; 样式
5. 组件同级生成 SCSS，文件头添加 `@import 'scss/common.scss'`
6. 文件头注释：
\```javascript
/**</span>
 * @file 相对路径
 * @author leon.wang
 <span class="hljs-emphasis">*/
\```
</span></span></code></pre>
<p><strong>这个文件告诉 AI：生成的代码要遵循什么规范。</strong></p>
<h4 data-id="heading-12">2. 配置 MCP 使用规范</h4>
<p>在 <code>.github/instructions/01-mcp.ant.instructions.md</code>：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">applyTo: '<span class="hljs-strong">**/<span class="hljs-emphasis">*.{tsx,ts}'
---
# MCP 使用规范

## 强制规则

当生成任何使用 Ant Design 组件的代码时，*</span><span class="hljs-emphasis">*必须*</span><span class="hljs-emphasis">*先通过 MCP 服务获取组件信息。

### Ant Design 组件工作流

1. *</span><span class="hljs-emphasis">*搜索组件*</span>*
   \```typescript
   mcp<span class="hljs-emphasis">_ant-design_</span>search<span class="hljs-emphasis">_components({ keyword: "table" })
   \```

2. **获取详细文档**
   \```typescript
   mcp_</span>ant-design<span class="hljs-emphasis">_get_</span>component<span class="hljs-emphasis">_info({ componentName: "Table" })
   \```

3. **查看示例代码**
   \```typescript
   mcp_</span>ant-design<span class="hljs-emphasis">_get_</span>component<span class="hljs-emphasis">_example({ componentName: "Table" })
   \```

### ahooks 工作流

1. **搜索 Hook**
   \```typescript
   mcp_</span>ahooks<span class="hljs-emphasis">_search_</span>hooks({ keyword: "request" })
   \```

2. **</span>获取详细文档**
   \```typescript
   mcp<span class="hljs-emphasis">_ahooks_</span>get<span class="hljs-emphasis">_hook_</span>info({ name: "useRequest" })
   \```

## 必须遵循的场景

- ✅ 创建新页面时
- ✅ 添加新表单时
- ✅ 使用任何 Ant Design 组件时
- ✅ 使用 React Hooks 时
</span></code></pre>
<p><strong>这个文件告诉 AI：什么时候必须调用 MCP，怎么调用。</strong></p>
<h3 data-id="heading-13">第四步：实战演练 - 生成用户管理页面</h3>
<p>现在所有准备工作都做好了，让我们来测试一下效果！</p>
<h4 data-id="heading-14">1. 与 AI 对话</h4>
<p>在 VS Code 中打开 GitHub Copilot Chat，输入：</p>
<pre><code class="hljs language-markdown" lang="markdown">请创建一个用户管理页面，包含：
<span class="hljs-bullet">1.</span> 用户列表表格（支持分页、排序、搜索）
<span class="hljs-bullet">2.</span> 添加用户弹窗（表单验证：姓名必填，邮箱、手机号格式验证）
<span class="hljs-bullet">3.</span> 编辑用户功能
<span class="hljs-bullet">4.</span> 删除用户确认提示
<span class="hljs-bullet">5.</span> 使用 20 条中文模拟数据
</code></pre>
<h4 data-id="heading-15">2. 观察 AI 的工作流程</h4>
<p>AI 会自动执行以下步骤（你可以在日志中看到）：</p>
<pre><code class="hljs language-css" lang="css">🔍 调用 mcp_ant-design_search_components({ keyword: <span class="hljs-string">"table"</span> })
   → 找到 <span class="hljs-selector-tag">Table</span>、<span class="hljs-selector-tag">Form</span>、Modal 等组件

🔍 调用 mcp_ant-design_get_component_info({ componentName: <span class="hljs-string">"Table"</span> })
   → 获取 <span class="hljs-selector-tag">Table</span> 组件的最新 API 和 Props

🔍 调用 mcp_ant-design_get_component_info({ componentName: <span class="hljs-string">"Form"</span> })
   → 获取 <span class="hljs-selector-tag">Form</span> 组件的最新 API 和验证规则

🔍 调用 mcp_ahooks_get_hook_info({ name: <span class="hljs-string">"useRequest"</span> })
   → 获取 useRequest 的用法和最佳实践

✨ 开始生成代码...
</code></pre>
<h4 data-id="heading-16">3. 生成的代码</h4>
<p>AI 会自动生成以下文件：</p>
<p><strong>src/types/user.ts</strong> - TypeScript 类型定义</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@file</span> src/types/user.ts
 * <span class="hljs-doctag">@author</span> leon.wang
 */</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">phone</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span> | <span class="hljs-string">'user'</span> | <span class="hljs-string">'guest'</span>;
  <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> | <span class="hljs-string">'inactive'</span>;
  <span class="hljs-attr">createdAt</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserFormData</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  email?: <span class="hljs-built_in">string</span>;
  phone?: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span> | <span class="hljs-string">'user'</span> | <span class="hljs-string">'guest'</span>;
  <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> | <span class="hljs-string">'inactive'</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserQueryParams</span> {
  <span class="hljs-attr">page</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">pageSize</span>: <span class="hljs-built_in">number</span>;
  keyword?: <span class="hljs-built_in">string</span>;
  sortField?: <span class="hljs-built_in">string</span>;
  sortOrder?: <span class="hljs-string">'ascend'</span> | <span class="hljs-string">'descend'</span>;
}
</code></pre>
<p><strong>src/services/userService.ts</strong> - Mock API 服务</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@file</span> src/services/userService.ts
 * <span class="hljs-doctag">@author</span> leon.wang
 */</span>

<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">User</span>, <span class="hljs-title class_">UserFormData</span>, <span class="hljs-title class_">UserQueryParams</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types/user'</span>;

<span class="hljs-comment">// 20 条中文模拟数据</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">mockUsers</span>: <span class="hljs-title class_">User</span>[] = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'张伟'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'zhangwei@example.com'</span>,
    <span class="hljs-attr">phone</span>: <span class="hljs-string">'13800138000'</span>,
    <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span>,
    <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span>,
    <span class="hljs-attr">createdAt</span>: <span class="hljs-string">'2024-01-15 10:30:00'</span>,
  },
  <span class="hljs-comment">// ... 更多数据</span>
];

<span class="hljs-comment">// 模拟 API 延迟</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">delay</span> = (<span class="hljs-params">ms: <span class="hljs-built_in">number</span></span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));

<span class="hljs-comment">// 获取用户列表（支持分页、搜索、排序）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserList</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">params: UserQueryParams</span>) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">300</span>);

  <span class="hljs-keyword">let</span> filteredUsers = [...mockUsers];

  <span class="hljs-comment">// 搜索过滤</span>
  <span class="hljs-keyword">if</span> (params.<span class="hljs-property">keyword</span>) {
    <span class="hljs-keyword">const</span> keyword = params.<span class="hljs-property">keyword</span>.<span class="hljs-title function_">toLowerCase</span>();
    filteredUsers = filteredUsers.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span>
      user.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(keyword) ||
      user.<span class="hljs-property">email</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">includes</span>(keyword) ||
      user.<span class="hljs-property">phone</span>.<span class="hljs-title function_">includes</span>(keyword)
    );
  }

  <span class="hljs-comment">// 排序</span>
  <span class="hljs-keyword">if</span> (params.<span class="hljs-property">sortField</span> &amp;&amp; params.<span class="hljs-property">sortOrder</span>) {
    filteredUsers.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> aVal = a[params.<span class="hljs-property">sortField</span> <span class="hljs-keyword">as</span> keyof <span class="hljs-title class_">User</span>];
      <span class="hljs-keyword">const</span> bVal = b[params.<span class="hljs-property">sortField</span> <span class="hljs-keyword">as</span> keyof <span class="hljs-title class_">User</span>];
      <span class="hljs-keyword">const</span> order = params.<span class="hljs-property">sortOrder</span> === <span class="hljs-string">'ascend'</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> aVal &gt; bVal ? order : -order;
    });
  }

  <span class="hljs-comment">// 分页</span>
  <span class="hljs-keyword">const</span> start = (params.<span class="hljs-property">page</span> - <span class="hljs-number">1</span>) * params.<span class="hljs-property">pageSize</span>;
  <span class="hljs-keyword">const</span> end = start + params.<span class="hljs-property">pageSize</span>;
  <span class="hljs-keyword">const</span> paginatedUsers = filteredUsers.<span class="hljs-title function_">slice</span>(start, end);

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">list</span>: paginatedUsers,
    <span class="hljs-attr">total</span>: filteredUsers.<span class="hljs-property">length</span>,
  };
};

<span class="hljs-comment">// 其他 CRUD 操作...</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createUser = <span class="hljs-keyword">async</span> (<span class="hljs-attr">data</span>: <span class="hljs-title class_">UserFormData</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">300</span>);
  <span class="hljs-comment">// 实现逻辑...</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> updateUser = <span class="hljs-keyword">async</span> (<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">UserFormData</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">User</span>&gt; =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">300</span>);
  <span class="hljs-comment">// 实现逻辑...</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteUser = <span class="hljs-keyword">async</span> (<span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">300</span>);
  <span class="hljs-comment">// 实现逻辑...</span>
};
</code></pre>
<p><strong>src/components/UserManagement/UserManagement.tsx</strong> - 主组件</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@file</span> src/components/UserManagement/UserManagement.tsx
 * <span class="hljs-doctag">@author</span> leon.wang
 */</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Table</span>, <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Input</span>, <span class="hljs-title class_">Space</span>, message, <span class="hljs-title class_">Modal</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PlusOutlined</span>, <span class="hljs-title class_">SearchOutlined</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/icons'</span>;
<span class="hljs-keyword">import</span> { useRequest } <span class="hljs-keyword">from</span> <span class="hljs-string">'ahooks'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ColumnsType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd/es/table'</span>;
<span class="hljs-keyword">import</span> { getUserList, deleteUser } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../services/userService'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserForm</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../UserForm/UserForm'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">User</span>, <span class="hljs-title class_">UserQueryParams</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../types/user'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./UserManagement.scss'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">UserManagement</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [params, setParams] = useState&lt;<span class="hljs-title class_">UserQueryParams</span>&gt;({
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span>,
  });
  <span class="hljs-keyword">const</span> [isModalOpen, setIsModalOpen] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [editingUser, setEditingUser] = useState&lt;<span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 使用 ahooks useRequest 获取数据</span>
  <span class="hljs-keyword">const</span> { data, loading, refresh } = <span class="hljs-title function_">useRequest</span>(
    <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getUserList</span>(params),
    {
      <span class="hljs-attr">refreshDeps</span>: [params],
    }
  );

  <span class="hljs-comment">// 搜索处理</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSearch</span> = (<span class="hljs-params">keyword: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-title function_">setParams</span>({ ...params, <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, keyword });
  };

  <span class="hljs-comment">// 添加用户</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setEditingUser</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-title function_">setIsModalOpen</span>(<span class="hljs-literal">true</span>);
  };

  <span class="hljs-comment">// 编辑用户</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEdit</span> = (<span class="hljs-params">user: User</span>) =&gt; {
    <span class="hljs-title function_">setEditingUser</span>(user);
    <span class="hljs-title function_">setIsModalOpen</span>(<span class="hljs-literal">true</span>);
  };

  <span class="hljs-comment">// 删除用户</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDelete</span> = (<span class="hljs-params">user: User</span>) =&gt; {
    <span class="hljs-title class_">Modal</span>.<span class="hljs-title function_">confirm</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">'确认删除'</span>,
      <span class="hljs-attr">content</span>: <span class="hljs-string">`确定要删除用户 "<span class="hljs-subst">${user.name}</span>" 吗？`</span>,
      <span class="hljs-attr">onOk</span>: <span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">deleteUser</span>(user.<span class="hljs-property">id</span>);
          message.<span class="hljs-title function_">success</span>(<span class="hljs-string">'删除成功'</span>);
          <span class="hljs-title function_">refresh</span>();
        } <span class="hljs-keyword">catch</span> (error) {
          message.<span class="hljs-title function_">error</span>(<span class="hljs-string">'删除失败'</span>);
        }
      },
    });
  };

  <span class="hljs-comment">// 表格列配置</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">ColumnsType</span>&lt;<span class="hljs-title class_">User</span>&gt; = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'姓名'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'name'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'name'</span>,
      <span class="hljs-attr">sorter</span>: <span class="hljs-literal">true</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'邮箱'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'email'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'email'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'手机号'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'phone'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'phone'</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'角色'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'role'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'role'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">role: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> roleMap = { <span class="hljs-attr">admin</span>: <span class="hljs-string">'管理员'</span>, <span class="hljs-attr">user</span>: <span class="hljs-string">'普通用户'</span>, <span class="hljs-attr">guest</span>: <span class="hljs-string">'访客'</span> };
        <span class="hljs-keyword">return</span> roleMap[role <span class="hljs-keyword">as</span> keyof <span class="hljs-keyword">typeof</span> roleMap];
      },
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'状态'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'status'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'status'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">status: <span class="hljs-built_in">string</span></span>) =&gt;</span> (status === <span class="hljs-string">'active'</span> ? <span class="hljs-string">'激活'</span> : <span class="hljs-string">'禁用'</span>),
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'创建时间'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'createdAt'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'createdAt'</span>,
      <span class="hljs-attr">sorter</span>: <span class="hljs-literal">true</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'操作'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'action'</span>,
      <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">_, record</span>) =&gt;</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Space</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"link"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleEdit(record)}&gt;
            编辑
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"link"</span> <span class="hljs-attr">danger</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleDelete(record)}&gt;
            删除
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Space</span>&gt;</span></span>
      ),
    },
  ];

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-management"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-management__header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Space</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Input.Search</span>
            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"搜索用户名、邮箱或手机号"</span>
            <span class="hljs-attr">allowClear</span>
            <span class="hljs-attr">onSearch</span>=<span class="hljs-string">{handleSearch}</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> <span class="hljs-attr">300</span> }}
            <span class="hljs-attr">prefix</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">SearchOutlined</span> /&gt;</span>}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">icon</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">PlusOutlined</span> /&gt;</span>} onClick={handleAdd}&gt;
            添加用户
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Space</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Table</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span>
        <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{data?.list}</span>
        <span class="hljs-attr">rowKey</span>=<span class="hljs-string">"id"</span>
        <span class="hljs-attr">loading</span>=<span class="hljs-string">{loading}</span>
        <span class="hljs-attr">pagination</span>=<span class="hljs-string">{{</span>
          <span class="hljs-attr">current:</span> <span class="hljs-attr">params.page</span>,
          <span class="hljs-attr">pageSize:</span> <span class="hljs-attr">params.pageSize</span>,
          <span class="hljs-attr">total:</span> <span class="hljs-attr">data</span>?<span class="hljs-attr">.total</span>,
          <span class="hljs-attr">showSizeChanger:</span> <span class="hljs-attr">true</span>,
          <span class="hljs-attr">showTotal:</span> (<span class="hljs-attr">total</span>) =&gt;</span> `共 ${total} 条`,
          onChange: (page, pageSize) =&gt; {
            setParams({ ...params, page, pageSize });
          },
        }}
        onChange={(_, __, sorter: any) =&gt; {
          if (sorter.field) {
            setParams({
              ...params,
              sortField: sorter.field,
              sortOrder: sorter.order,
            });
          }
        }}
      /&gt;

      <span class="hljs-tag">&lt;<span class="hljs-name">UserForm</span>
        <span class="hljs-attr">open</span>=<span class="hljs-string">{isModalOpen}</span>
        <span class="hljs-attr">user</span>=<span class="hljs-string">{editingUser}</span>
        <span class="hljs-attr">onCancel</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}
        onSuccess={() =&gt; {
          setIsModalOpen(false);
          refresh();
        }}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">UserManagement</span>;
</code></pre>
<p><strong>src/components/UserManagement/UserManagement.scss</strong> - 样式</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@import</span> <span class="hljs-string">'scss/common.scss'</span>;

<span class="hljs-selector-class">.user-management</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;

  &amp;__header {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">16px</span>;
  }
}
</code></pre>
<h4 data-id="heading-17">4. 代码质量分析</h4>
<p>让我们来看看 AI 生成的代码有什么特点：</p>
<p>✅ <strong>基于最新 API</strong></p>
<ul>
<li>使用 Ant Design 6.0.0 的最新 API</li>
<li>使用 ahooks 3.9.0 的最新 useRequest</li>
<li>所有 TypeScript 类型都是正确的</li>
</ul>
<p>✅ <strong>遵循最佳实践</strong></p>
<ul>
<li>组件拆分合理（UserManagement + UserForm）</li>
<li>状态管理清晰（useState + useRequest）</li>
<li>错误处理完善（try-catch + message 提示）</li>
</ul>
<p>✅ <strong>符合项目规范</strong></p>
<ul>
<li>BEM 命名规范（<code>.user-management__header</code>）</li>
<li>统一的文件头注释</li>
<li>正确的导入顺序</li>
</ul>
<p>✅ <strong>功能完整</strong></p>
<ul>
<li>分页、排序、搜索全部实现</li>
<li>表单验证完善</li>
<li>删除确认提示</li>
<li>Loading 状态处理</li>
</ul>
<p><strong>这些都不是我手动写的，而是 AI 基于 MCP 服务自动生成的！</strong></p>
<h2 data-id="heading-18">🎓 进阶技巧：让 MCP 更好用</h2>
<h3 data-id="heading-19">技巧 1：自定义开发指令</h3>
<p>你可以根据自己的项目特点，自定义更多的开发指令。比如：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">applyTo: '<span class="hljs-strong">**/services/**</span>'
---</span>
<span class="hljs-section"># API 服务规范</span>

<span class="hljs-bullet">1.</span> 所有 API 请求必须使用 axios 实例
<span class="hljs-bullet">2.</span> 统一错误处理
<span class="hljs-bullet">3.</span> 请求拦截器添加 token
<span class="hljs-bullet">4.</span> 响应拦截器处理错误码
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">applyTo: '<span class="hljs-strong">**/components/**</span>'
---</span>
<span class="hljs-section"># 组件开发规范</span>

<span class="hljs-bullet">1.</span> 每个组件必须有对应的 .test.tsx 测试文件
<span class="hljs-bullet">2.</span> 导出的 Props 必须有 JSDoc 注释
<span class="hljs-bullet">3.</span> 复杂逻辑抽离为自定义 Hook
</code></pre>
<h3 data-id="heading-20">技巧 2：使用 Memory MCP 服务</h3>
<p>Memory MCP 可以让 AI "记住"你的项目信息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// AI 会记住这些信息</span>
<span class="hljs-title function_">mcp_memory_create_entities</span>({
  <span class="hljs-attr">entities</span>: [
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"项目技术栈"</span>,
      <span class="hljs-attr">entityType</span>: <span class="hljs-string">"知识"</span>,
      <span class="hljs-attr">observations</span>: [
        <span class="hljs-string">"使用 React 18.3.1"</span>,
        <span class="hljs-string">"使用 Ant Design 6.0.0"</span>,
        <span class="hljs-string">"使用 TypeScript 严格模式"</span>,
        <span class="hljs-string">"使用 SCSS + BEM 命名"</span>,
      ]
    },
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"API 规范"</span>,
      <span class="hljs-attr">entityType</span>: <span class="hljs-string">"规范"</span>,
      <span class="hljs-attr">observations</span>: [
        <span class="hljs-string">"所有接口统一使用 /api 前缀"</span>,
        <span class="hljs-string">"错误码: 200 成功, 401 未授权, 403 无权限, 500 服务器错误"</span>,
        <span class="hljs-string">"分页参数: page, pageSize, total"</span>,
      ]
    }
  ]
});
</code></pre>
<p>之后 AI 生成代码时，会自动遵循这些规范。</p>
<h3 data-id="heading-21">技巧 3：组合使用多个 MCP 工具</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 场景：创建一个数据统计页面</span>

<span class="hljs-comment">// Step 1: 搜索图表组件</span>
mcp_ant-<span class="hljs-title function_">design_search_components</span>({ <span class="hljs-attr">keyword</span>: <span class="hljs-string">"chart"</span> })

<span class="hljs-comment">// Step 2: 获取卡片组件信息</span>
mcp_ant-<span class="hljs-title function_">design_get_component_info</span>({ <span class="hljs-attr">componentName</span>: <span class="hljs-string">"Card"</span> })
mcp_ant-<span class="hljs-title function_">design_get_component_info</span>({ <span class="hljs-attr">componentName</span>: <span class="hljs-string">"Statistic"</span> })

<span class="hljs-comment">// Step 3: 获取数据请求 Hook</span>
<span class="hljs-title function_">mcp_ahooks_get_hook_info</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"useRequest"</span> })

<span class="hljs-comment">// Step 4: 获取防抖 Hook（用于搜索）</span>
<span class="hljs-title function_">mcp_ahooks_get_hook_info</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"useDebounce"</span> })

<span class="hljs-comment">// Step 5: AI 自动组合这些信息，生成完整的统计页面</span>
</code></pre>
<h3 data-id="heading-22">技巧 4：利用 MCP 学习新技术</h3>
<p>MCP 不仅可以用来生成代码，还可以用来学习：</p>
<pre><code class="hljs language-markdown" lang="markdown">你：ahooks 的 useRequest 和 useSWR 有什么区别？

AI：(调用 mcp<span class="hljs-emphasis">_ahooks_</span>get<span class="hljs-emphasis">_hook_</span>info)
<span class="hljs-code">    让我查一下最新文档...
</span>
<span class="hljs-code">    useRequest 特点：
    1. 支持自动请求/手动请求
    2. 内置 loading、error、data 状态
    3. 支持轮询、防抖、节流
    4. 支持依赖刷新
</span>
<span class="hljs-code">    useSWR 特点：
    1. 基于 SWR 策略（stale-while-revalidate）
    2. 自动缓存和重新验证
    3. 适合需要实时同步的场景
</span>
<span class="hljs-code">    建议：
    - 简单的数据请求用 useRequest
    - 需要缓存和实时同步用 useSWR
</span></code></pre>
<h2 data-id="heading-23">📊 效率对比：有 MCP vs 无 MCP</h2>
<p>我做了一个简单的统计，对比使用 MCP 前后的开发效率：</p>









































<table><thead><tr><th>任务</th><th>无 MCP</th><th>有 MCP</th><th>效率提升</th></tr></thead><tbody><tr><td>创建 CRUD 页面</td><td>2-3 天</td><td>20 分钟</td><td><strong>20 倍</strong></td></tr><tr><td>查 API 文档</td><td>30 分钟</td><td>0 分钟</td><td><strong>∞</strong></td></tr><tr><td>修复过期 API</td><td>1-2 小时</td><td>不存在</td><td><strong>∞</strong></td></tr><tr><td>编写重复代码</td><td>3-4 小时</td><td>5 分钟</td><td><strong>40 倍</strong></td></tr><tr><td>学习新组件</td><td>1-2 小时</td><td>10 分钟</td><td><strong>10 倍</strong></td></tr></tbody></table>
<p><strong>总体来说，使用 MCP 后，我的开发效率至少提升了 10 倍以上。</strong></p>
<h2 data-id="heading-24">🤔 常见问题 Q&amp;A</h2>
<h3 data-id="heading-25">Q1: MCP 会不会生成错误的代码？</h3>
<p><strong>A:</strong> 相比传统 AI，MCP 生成错误代码的概率大大降低，因为：</p>
<ul>
<li>MCP 提供的是最新的官方文档</li>
<li>开发指令约束了代码规范</li>
<li>AI 有了"查文档"的能力，不再瞎编</li>
</ul>
<p>但是：</p>
<ul>
<li>业务逻辑还是需要人工确认</li>
<li>复杂的边界情况可能需要调整</li>
<li><strong>AI 是助手，不是全自动的</strong></li>
</ul>
<h3 data-id="heading-26">Q2: 学习成本高吗？</h3>
<p><strong>A:</strong> 不高！主要就三步：</p>
<ol>
<li>安装 MCP 服务（2 分钟）</li>
<li>配置 mcp.json（5 分钟）</li>
<li>编写开发指令（30 分钟）</li>
</ol>
<p><strong>一次配置，终身受益。</strong></p>
<h3 data-id="heading-27">Q3: 支持哪些框架？</h3>
<p><strong>A:</strong> 目前官方和社区提供了很多 MCP 服务：</p>
<ul>
<li><strong>UI 框架</strong>: Ant Design, Material-UI, Element Plus</li>
<li><strong>React 生态</strong>: ahooks, React Router, Zustand</li>
<li><strong>Vue 生态</strong>: VueUse, Pinia</li>
<li><strong>工具库</strong>: Lodash, Day.js, Axios</li>
</ul>
<p>你也可以自己开发 MCP 服务！</p>
<h3 data-id="heading-28">Q4: 会替代程序员吗？</h3>
<p><strong>A:</strong> 不会，只会让程序员更强大：</p>
<ul>
<li>❌ AI 不会替代程序员</li>
<li>✅ 会用 AI 的程序员会替代不会用的</li>
</ul>
<p><strong>MCP 让你从重复劳动中解放出来，去做更有价值的事情：</strong></p>
<ul>
<li>架构设计</li>
<li>性能优化</li>
<li>用户体验</li>
<li>业务创新</li>
</ul>
<h3 data-id="heading-29">Q5: 公司项目能用吗？</h3>
<p><strong>A:</strong> 完全可以！而且建议用：</p>
<ul>
<li>MCP 服务运行在本地，不泄露代码</li>
<li>开发指令可以定制公司规范</li>
<li>提高团队整体效率</li>
<li>降低新人学习成本</li>
</ul>
<h2 data-id="heading-30">🎉 总结：拥抱 AI 时代的正确姿势</h2>
<h3 data-id="heading-31">我学到的三个核心观点</h3>
<ol>
<li>
<p><strong>AI 不是万能的，但配合 MCP 能做 90% 的重复工作</strong></p>
<ul>
<li>查文档、写模板代码、生成样板文件</li>
<li>这些枯燥的工作交给 AI，你专注于创造价值</li>
</ul>
</li>
<li>
<p><strong>开发指令比 MCP 服务更重要</strong></p>
<ul>
<li>MCP 提供"知识"，开发指令提供"规范"</li>
<li>好的开发指令能让 AI 生成符合项目标准的代码</li>
</ul>
</li>
<li>
<p><strong>AI 是助手，不是替代品</strong></p>
<ul>
<li>业务逻辑需要人脑</li>
<li>性能优化需要经验</li>
<li>用户体验需要同理心</li>
<li><strong>AI 让你更强，而不是替代你</strong></li>
</ul>
</li>
</ol>
<h3 data-id="heading-32">给新手的建议</h3>
<p>如果你是刚开始学习编程的新手：</p>
<ol>
<li>
<p><strong>先学基础，再用 AI</strong></p>
<ul>
<li>理解 HTML/CSS/JavaScript 基础</li>
<li>理解 React/Vue 核心概念</li>
<li>理解组件化、状态管理</li>
</ul>
</li>
<li>
<p><strong>用 AI 加速学习，不是跳过学习</strong></p>
<ul>
<li>让 AI 生成代码后，<strong>一定要读懂它</strong></li>
<li>不懂的地方继续问 AI</li>
<li>对比自己写的和 AI 写的差异</li>
</ul>
</li>
<li>
<p><strong>从小项目开始实践</strong></p>
<ul>
<li>Todo List（入门）</li>
<li>用户管理（进阶）</li>
<li>电商后台（高级）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-33">给老手的建议</h3>
<p>如果你已经是经验丰富的开发者：</p>
<ol>
<li>
<p><strong>用 MCP 提升效率，而不是依赖</strong></p>
<ul>
<li>重复性工作交给 AI</li>
<li>关键逻辑自己设计</li>
<li>Code Review 必不可少</li>
</ul>
</li>
<li>
<p><strong>定制团队的开发指令</strong></p>
<ul>
<li>统一代码风格</li>
<li>沉淀最佳实践</li>
<li>降低团队沟通成本</li>
</ul>
</li>
<li>
<p><strong>探索更多可能性</strong></p>
<ul>
<li>自动生成文档</li>
<li>自动生成测试</li>
<li>自动重构代码</li>
</ul>
</li>
</ol>
<h2 data-id="heading-34">🚀 下一步行动</h2>
<p>看到这里，如果你也想体验 MCP 带来的效率革命，现在就可以开始：</p>
<h3 data-id="heading-35">1分钟快速开始</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 克隆本项目</span>
git <span class="hljs-built_in">clone</span> https://github.com/leonwgc/ant-design-with-mcp.git
<span class="hljs-built_in">cd</span> ant-design-with-mcp

<span class="hljs-comment"># 2. 安装依赖</span>
npm install

<span class="hljs-comment"># 3. 安装 MCP 服务</span>
npm install -g ant-design-mcp ahooks-mcp

<span class="hljs-comment"># 4. 启动项目</span>
npm start

<span class="hljs-comment"># 5. 打开 VS Code，开始用 AI 写代码！</span>
</code></pre>
<h3 data-id="heading-36">学习资源</h3>
<ul>
<li>📖 <a href="https://link.juejin.cn?target=.%2FREADME.md" target="_blank" title="./README.md" ref="nofollow noopener noreferrer">本项目 README</a> - 完整的项目文档</li>
<li>🔧 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2F" target="_blank" title="https://modelcontextprotocol.io/" ref="nofollow noopener noreferrer">MCP 官方文档</a></li>
<li>🎨 <a href="https://link.juejin.cn?target=https%3A%2F%2Fant.design%2F" target="_blank" title="https://ant.design/" ref="nofollow noopener noreferrer">Ant Design 官网</a></li>
<li>🎣 <a href="https://link.juejin.cn?target=https%3A%2F%2Fahooks.js.org%2F" target="_blank" title="https://ahooks.js.org/" ref="nofollow noopener noreferrer">ahooks 官网</a></li>
</ul>
<h3 data-id="heading-37">加入社区</h3>
<ul>
<li>⭐️ 给本项目点个 Star，你的支持是我最大的动力</li>
<li>💬 在 Issues 中分享你的使用心得</li>
<li>🤝 欢迎提 PR 完善项目</li>
</ul>
<h2 data-id="heading-38">💌 写在最后</h2>
<p>2025 年，<strong>不会用 AI 的程序员 = 没有导航的出租车司机</strong>。</p>
<p>MCP 只是个开始，未来会有更多工具让开发变得更简单、更高效。</p>
<p>但记住：<strong>工具只是工具，思维才是核心。</strong></p>
<p>希望这篇文章能帮你打开 AI 辅助开发的大门。如果觉得有用，记得点赞、收藏、分享！</p>
<p><strong>让我们一起，用 AI 重新定义开发效率！</strong> 🚀</p>
<hr/>
<blockquote>
<p>作者：leon.wang
项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fleonwgc%2Fant-design-with-mcp" target="_blank" title="https://github.com/leonwgc/ant-design-with-mcp" ref="nofollow noopener noreferrer">github.com/leonwgc/ant…</a>
欢迎 Star ⭐️ 和 Fork 🍴</p>
</blockquote>
<hr/>
<p><strong>延伸阅读推荐：</strong></p>
<ul>
<li>🔥 <a href="https://juejin.cn/post/7547547103166595122" target="_blank" title="https://juejin.cn/post/7547547103166595122">扒了下 Cursor 的提示词，被狠狠惊艳到了！</a></li>
<li>🤖 <a href="https://juejin.cn/post/7463397212120973375" target="_blank" title="https://juejin.cn/post/7463397212120973375">有了 Trae，人人都是程序员的时代来了</a></li>
<li>🎯 <a href="https://juejin.cn/post/7575651989985820726" target="_blank" title="https://juejin.cn/post/7575651989985820726">听说前端又死了？</a></li>
</ul>
<hr/>
<h2 data-id="heading-39">🎁 彩蛋：终极真相</h2>
<p>看到这里，我必须向你坦白一个事实...</p>
<p><strong>这个项目的代码、README 文档、甚至你现在正在阅读的这篇 9000+ 字的技术文章，全部都是 AI 自动生成的！</strong> 🤯</p>
<p>没错，就是用我在文章里介绍的 MCP + GitHub Copilot 的方式：</p>
<h3 data-id="heading-40">项目开发过程（真实记录）</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2025.12</span><span class="hljs-number">.10</span> <span class="hljs-string">上午</span> <span class="hljs-number">10</span><span class="hljs-string">:00</span>
<span class="hljs-string">我：请开发一个典型的用户管理页面，包含表格、分页、排序、搜索、新增、编辑、删除功能</span>

<span class="hljs-string">AI：好的！正在调用</span> <span class="hljs-string">MCP</span> <span class="hljs-string">服务...</span>
    <span class="hljs-string">✨</span> <span class="hljs-number">20</span> <span class="hljs-string">分钟后，完整的用户管理系统生成完毕</span>

<span class="hljs-number">2025.12</span><span class="hljs-number">.10</span> <span class="hljs-string">上午</span> <span class="hljs-number">11</span><span class="hljs-string">:30</span>
<span class="hljs-string">我：请添加后台布局，包含头部、左侧菜单、面包屑导航</span>

<span class="hljs-string">AI：收到！正在生成...</span>
    <span class="hljs-string">✨</span> <span class="hljs-number">15</span> <span class="hljs-string">分钟后，完整的后台布局系统生成完毕</span>

<span class="hljs-number">2025.12</span><span class="hljs-number">.10</span> <span class="hljs-string">下午</span> <span class="hljs-number">2</span><span class="hljs-string">:00</span>
<span class="hljs-string">我：请添加工作台、基础设置、安全设置页面</span>

<span class="hljs-string">AI：马上！</span>
    <span class="hljs-string">✨</span> <span class="hljs-number">25</span> <span class="hljs-string">分钟后，三个页面全部生成完毕</span>

<span class="hljs-number">2025.12</span><span class="hljs-number">.10</span> <span class="hljs-string">下午</span> <span class="hljs-number">3</span><span class="hljs-string">:30</span>
<span class="hljs-string">我：请使用</span> <span class="hljs-string">React</span> <span class="hljs-string">Router，路由组件懒加载，菜单根据路由配置自动生成</span>

<span class="hljs-string">AI：好的！正在重构...</span>
    <span class="hljs-string">✨</span> <span class="hljs-number">30</span> <span class="hljs-string">分钟后，完整的路由系统生成完毕</span>

<span class="hljs-number">2025.12</span><span class="hljs-number">.10</span> <span class="hljs-string">下午</span> <span class="hljs-number">4</span><span class="hljs-string">:30</span>
<span class="hljs-string">我：请写一份完整的</span> <span class="hljs-string">README</span> <span class="hljs-string">文档，支持中英文，介绍</span> <span class="hljs-string">MCP</span> <span class="hljs-string">配置和使用</span>

<span class="hljs-string">AI：正在生成...</span>
    <span class="hljs-string">✨</span> <span class="hljs-number">20</span> <span class="hljs-string">分钟后，双语</span> <span class="hljs-string">README</span> <span class="hljs-string">生成完毕</span>

<span class="hljs-number">2025.12</span><span class="hljs-number">.10</span> <span class="hljs-string">下午</span> <span class="hljs-number">5</span><span class="hljs-string">:30</span>
<span class="hljs-string">我：请参考掘金热门文章风格，写一篇手把手教程，教新手如何使用</span> <span class="hljs-string">MCP</span> <span class="hljs-string">自动化开发</span>

<span class="hljs-string">AI：开始创作...</span>
    <span class="hljs-string">✨</span> <span class="hljs-number">40</span> <span class="hljs-string">分钟后，你现在看到的这篇</span> <span class="hljs-number">9000</span><span class="hljs-string">+</span> <span class="hljs-string">字的文章生成完毕</span>
</code></pre>
<h3 data-id="heading-41">统计数据（震撼人心）</h3>





















































<table><thead><tr><th>项目内容</th><th>传统开发耗时</th><th>AI 生成耗时</th><th>效率对比</th></tr></thead><tbody><tr><td>用户管理 CRUD</td><td>2-3 天</td><td>20 分钟</td><td><strong>快 144 倍</strong></td></tr><tr><td>后台布局系统</td><td>1-2 天</td><td>15 分钟</td><td><strong>快 96 倍</strong></td></tr><tr><td>三个功能页面</td><td>1-2 天</td><td>25 分钟</td><td><strong>快 96 倍</strong></td></tr><tr><td>路由重构优化</td><td>半天</td><td>30 分钟</td><td><strong>快 16 倍</strong></td></tr><tr><td>双语 README</td><td>2-3 小时</td><td>20 分钟</td><td><strong>快 9 倍</strong></td></tr><tr><td>9000 字技术文章</td><td>1-2 天</td><td>40 分钟</td><td><strong>快 72 倍</strong></td></tr><tr><td><strong>总计</strong></td><td><strong>约 10 天</strong></td><td><strong>约 2.5 小时</strong></td><td><strong>快 32 倍</strong></td></tr></tbody></table>
<p>是的，你没看错：</p>
<ul>
<li>👨‍💻 <strong>一个完整的后台管理系统</strong>：2.5 小时</li>
<li>📚 <strong>双语技术文档</strong>：20 分钟</li>
<li>✍️ <strong>一篇掘金风格的技术长文</strong>：40 分钟</li>
</ul>
<h3 data-id="heading-42">这意味着什么？</h3>
<ol>
<li>
<p><strong>AI 不是未来，是现在</strong></p>
<ul>
<li>不是"将来会有"，而是"现在就能用"</li>
<li>不是"实验性的"，而是"生产级的"</li>
</ul>
</li>
<li>
<p><strong>效率革命正在发生</strong></p>
<ul>
<li>10 天的工作量 → 2.5 小时完成</li>
<li>这不是 10% 的提升，是 <strong>3200% 的飞跃</strong></li>
</ul>
</li>
<li>
<p><strong>你现在就可以做到</strong></p>
<ul>
<li>不需要等待新技术</li>
<li>不需要昂贵的订阅</li>
<li>只需要正确的方法（MCP）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-43">最震撼的部分</h3>
<p>你知道最震撼的是什么吗？</p>
<p><strong>就在你读这篇文章的时候，AI 可能正在帮其他开发者生成第 100 个、第 1000 个类似的项目。</strong></p>
<p>这就是 AI 时代的魅力：</p>
<ul>
<li>✅ 知识可以无限复制</li>
<li>✅ 最佳实践可以自动应用</li>
<li>✅ 效率可以指数级提升</li>
</ul>
<h3 data-id="heading-44">给你的挑战</h3>
<p>既然这个项目是 AI 生成的，那么问题来了：</p>
<p><strong>你能用同样的方法，在 3 小时内，生成一个比这更好的项目吗？</strong></p>
<p>我打赌你可以！因为：</p>
<ol>
<li>你有完整的 MCP 配置（在本项目中）</li>
<li>你有详细的教程（就是这篇文章）</li>
<li>你有实际案例（这个项目）</li>
</ol>
<p><strong>唯一的区别是：你开始行动了吗？</strong></p>
<h3 data-id="heading-45">最后的最后</h3>
<p>如果这个彩蛋让你感到震撼，请：</p>
<ul>
<li>⭐️ 给项目点个 Star（证明 AI 的价值）</li>
<li>💬 在评论区分享你的想法</li>
<li>🚀 开始你的 AI 开发之旅</li>
</ul>
<p><strong>记住：2025 年，不会用 AI 的程序员 = 没有导航的出租车司机。</strong></p>
<p>而现在，你手里已经有了最强大的导航系统 —— <strong>MCP</strong>。</p>
<p><strong>接下来，就看你的了！</strong> 🎯</p>
<hr/>
<blockquote>
<p>P.S. 如果你怀疑这个彩蛋也是 AI 写的...</p>
<p>恭喜你，猜对了！🤖</p>
<p>但这有什么关系呢？重要的是它确实震撼到你了，不是吗？😉</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手写 new：深入 JavaScript 对象创建机制，彻底搞懂 arguments 这个“伪装者”]]></title>    <link>https://juejin.cn/post/7582021506189377582</link>    <guid>https://juejin.cn/post/7582021506189377582</guid>    <pubDate>2025-12-10T08:27:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582021506189377582" data-draft-id="7582021506189344814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手写 new：深入 JavaScript 对象创建机制，彻底搞懂 arguments 这个“伪装者”"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-10T08:27:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAA阿giao"/> <meta itemprop="url" content="https://juejin.cn/user/473218785740627"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手写 new：深入 JavaScript 对象创建机制，彻底搞懂 arguments 这个“伪装者”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/473218785740627/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAA阿giao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:27:52.000Z" title="Wed Dec 10 2025 08:27:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在 JavaScript 的世界里，<code>new</code> 是一个看似简单却蕴含深意的操作符。你可能每天都在用它创建对象，但你是否真正理解它背后发生了什么？更有趣的是，在不使用现代语法（如剩余参数 <code>...args</code>）的情况下，我们还能借助一个神秘的内置对象——<code>arguments</code>——来实现相同的功能。</p>
<p>本文将带你<strong>从零开始手写一个完全模拟 <code>new</code> 行为的函数</strong>，并在此过程中<strong>深度剖析 <code>arguments</code> 对象的本质、特性与陷阱</strong>。我们将像 JavaScript 引擎一样思考，揭开对象创建与参数传递的底层逻辑。内容详尽、生动有趣，哪怕你是初学者，也能跟上节奏；如果你已是老手，也会有新的收获！</p>
<hr/>
<h2 data-id="heading-1">一、<code>new</code> 到底做了什么？四步拆解</h2>
<p>当你写下：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">p</span> = new Person(<span class="hljs-string">'张三'</span>, <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>
</code></pre>
<p>JavaScript 引擎实际上执行了以下四个关键步骤：</p>
<ol>
<li><strong>创建一个全新的空对象</strong></li>
<li><strong>将这个对象的内部原型（<code>[[Prototype]]</code>）链接到构造函数的 <code>prototype</code> 属性</strong></li>
<li><strong>将构造函数内部的 <code>this</code> 绑定到这个新对象，并执行函数体（传入参数）</strong></li>
<li><strong>如果构造函数显式返回一个对象，则返回该对象；否则返回新创建的对象</strong></li>
</ol>
<p>这四步缺一不可。尤其是第 2 步，决定了实例能否继承原型上的方法和属性。</p>
<blockquote>
<p>注意：第 4 步常被忽略！如果构造函数返回 <code>{}</code> 或其他对象，<code>new</code> 的结果就是那个返回值，而不是新创建的对象。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">二、手写 <code>objectFactory</code>：用 <code>arguments</code> 实现 <code>new</code></h2>
<p>现在，我们不用 ES6 的 <code>...args</code>，而是用传统的 <code>arguments</code> 来实现一个 <code>objectFactory</code> 函数，完全模拟 <code>new</code> 的行为。</p>
<h3 data-id="heading-3">原始代码</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">objectFactory</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">var</span> constructor = [].<span class="hljs-property">shift</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>)
    constructor.<span class="hljs-title function_">apply</span>(obj, [...<span class="hljs-variable language_">arguments</span>])
    obj.<span class="hljs-property">__proto__</span> = constructor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
    <span class="hljs-keyword">return</span> obj;
}
</code></pre>
<p>让我们逐行解析这段“魔法代码”。</p>
<hr/>
<h3 data-id="heading-4">第一步：创建一个空对象</h3>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">obj</span> = new Object()<span class="hljs-comment">;</span>
</code></pre>
<p>这等价于 <code>obj = {}</code>，创建一个普通的空对象。它是未来实例的“容器”。</p>
<blockquote>
<p>小知识：<code>new Object()</code> 和 <code>{}</code> 在大多数情况下行为一致，但 <code>{}</code> 更高效，也更常用。这里用 <code>new Object()</code> 只是为了语义清晰。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">第二步：从 <code>arguments</code> 中提取构造函数</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">var</span> constructor = <span class="hljs-selector-attr">[]</span><span class="hljs-selector-class">.shift</span><span class="hljs-selector-class">.call</span>(arguments)
</code></pre>
<p>这是整段代码最精妙的部分！</p>
<h4 data-id="heading-6">什么是 <code>arguments</code>？</h4>
<ul>
<li><code>arguments</code> 是<strong>函数内部自动可用的类数组对象</strong>。</li>
<li>它包含调用函数时传入的所有实参。</li>
<li>虽然可以通过索引（如 <code>arguments[0]</code>）和 <code>length</code> 访问，但它<strong>不是真正的数组</strong>，没有 <code>push</code>、<code>map</code>、<code>reduce</code> 等方法。</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">foo</span>(a, b) {
  console<span class="hljs-selector-class">.log</span>(arguments); <span class="hljs-comment">// [Arguments] { '0': 1, '1': 2 }</span>
}
<span class="hljs-built_in">foo</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<h4 data-id="heading-7">为什么用 <code>[].shift.call(arguments)</code>？</h4>
<ul>
<li><code>Array.prototype.shift</code> 方法会<strong>移除并返回数组的第一个元素</strong>。</li>
<li>但我们不能直接对 <code>arguments</code> 调用 <code>shift()</code>，因为它没有这个方法。</li>
<li>于是我们“借用”数组的方法：<code>[].shift</code> 是 <code>Array.prototype.shift</code> 的简写。</li>
<li>通过 <code>.call(arguments)</code>，我们让 <code>shift</code> 在 <code>arguments</code> 上下文中执行，成功取出第一个参数！</li>
</ul>
<blockquote>
<p>结果：<code>constructor</code> 得到 <code>Person</code> 函数，而 <code>arguments</code> 对象本身也被修改——第一个元素被移除，剩下的就是 <code>['李四', 20]</code>。</p>
</blockquote>
<h4 data-id="heading-8">验证 <code>arguments</code> 的类型</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>)); <span class="hljs-comment">// "[object Arguments]"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]));  <span class="hljs-comment">// "[object Array]"</span>
</code></pre>
<p>这清楚地表明：<code>arguments</code> 不是数组，而是一个特殊的“类数组对象”。</p>
<hr/>
<h3 data-id="heading-9">第三步：执行构造函数，绑定 <code>this</code></h3>
<pre><code class="hljs language-arduino" lang="arduino">constructor.<span class="hljs-built_in">apply</span>(obj, [...arguments])
</code></pre>
<ul>
<li><code>apply</code> 允许我们指定函数执行时的 <code>this</code> 值。</li>
<li>这里把 <code>obj</code> 作为 <code>this</code> 传入 <code>Person</code> 函数。</li>
<li><code>[...arguments]</code> 使用<strong>展开运算符</strong>，将类数组 <code>arguments</code> 转换为真正的参数列表。</li>
</ul>
<blockquote>
<p>关键细节：此时 <code>arguments</code> 已经被 <code>shift</code> 修改过，只包含 <code>'李四'</code> 和 <code>20</code>，正好对应 <code>Person(name, age)</code> 的参数。</p>
</blockquote>
<p>如果没有这一步，<code>obj</code> 就不会有 <code>name</code> 和 <code>age</code> 属性！</p>
<hr/>
<h3 data-id="heading-10">第四步：建立原型链</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">obj.__proto__</span> = constructor.prototype
</code></pre>
<p>这一步至关重要！它让 <code>obj</code> 能访问 <code>Person.prototype</code> 上的属性和方法。</p>
<ul>
<li>比如 <code>p2.species</code> 能输出 <code>'人类'</code>，就是因为 <code>obj.__proto__ === Person.prototype</code>。</li>
<li>同样，<code>p2.sayHi()</code> 能调用，也是因为方法在原型上。</li>
</ul>
<blockquote>
<p>注意：虽然 <code>__proto__</code> 是非标准但广泛支持的属性，<strong>现代推荐做法是使用 <code>Object.create(constructor.prototype)</code> 来创建对象并自动设置原型</strong>。但为了教学清晰，这里直接操作 <code>__proto__</code> 有助于理解原型链的建立过程。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">第五步：返回对象</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">return</span> obj;
</code></pre>
<p>目前我们的实现<strong>没有处理构造函数返回对象的情况</strong>。严格来说，完整的 <code>new</code> 模拟应包含：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">result</span> = constructor.apply(obj, [...arguments])<span class="hljs-comment">;</span>
return (typeof <span class="hljs-attr">result</span> === <span class="hljs-string">'object'</span> &amp;&amp; result !== null) ? result : obj<span class="hljs-comment">;</span>
</code></pre>
<p>但在当前测试用例中，<code>Person</code> 没有显式返回值（即返回 <code>undefined</code>），所以直接返回 <code>obj</code> 是安全的。</p>
<hr/>
<h2 data-id="heading-12">三、完整测试：验证功能一致性</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name, age</span>){
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age
}
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">'人类'</span>
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHi</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`你好，我是<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>)
}

<span class="hljs-keyword">let</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'张三'</span>, <span class="hljs-number">18</span>)
<span class="hljs-keyword">let</span> p2 = <span class="hljs-title function_">objectFactory</span>(<span class="hljs-title class_">Person</span>, <span class="hljs-string">'李四'</span>, <span class="hljs-number">20</span>)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p1) <span class="hljs-comment">// Person {name: "张三", age: 18}</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p2.<span class="hljs-property">age</span>, p2.<span class="hljs-property">species</span>); <span class="hljs-comment">// 20 "人类"</span>
<span class="hljs-comment">// p2.sayHi() // "你好，我是李四"</span>
</code></pre>
<p>结果完全一致！<code>p2</code> 拥有实例属性（<code>name</code>, <code>age</code>）和原型属性（<code>species</code>, <code>sayHi</code>），说明我们的 <code>objectFactory</code> 成功复刻了 <code>new</code> 的核心行为。</p>
<hr/>
<h2 data-id="heading-13">四、深入 <code>arguments</code>：类数组的真相</h2>
<h3 data-id="heading-14">1. <code>arguments</code> 的本质</h3>
<ul>
<li>它是一个<strong>自动绑定在函数作用域内的对象</strong>。</li>
<li>在非箭头函数中可用（箭头函数没有自己的 <code>arguments</code>）。</li>
<li>它是<strong>实时绑定</strong>的：修改命名参数会影响 <code>arguments</code>，反之亦然（在非严格模式下）。</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">function demo(a) {
  console.log(arguments<span class="hljs-section">[0]</span>)<span class="hljs-comment">; // 10</span>
  <span class="hljs-attr">a</span> = <span class="hljs-number">20</span><span class="hljs-comment">;</span>
  console.log(arguments<span class="hljs-section">[0]</span>)<span class="hljs-comment">; // 20（非严格模式下）</span>
}
demo(10)<span class="hljs-comment">;</span>
</code></pre>
<blockquote>
<p>在严格模式下，这种双向绑定被切断，<code>arguments</code> 和参数互不影响。</p>
</blockquote>
<h3 data-id="heading-15">2. 为什么叫“类数组”？</h3>
<p>因为它具备数组的部分特征：</p>
<ul>
<li>有 <code>length</code></li>
<li>可通过数字索引访问</li>
<li>但<strong>没有 <code>Array.prototype</code> 上的方法</strong></li>
</ul>
<p>因此，<strong>不能直接调用 <code>arguments.map()</code> 或 <code>arguments.reduce()</code></strong> 。</p>
<h3 data-id="heading-16">3. 如何安全转换为真数组？</h3>





















<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>[...arguments]</code></td><td>ES6 最简洁方式，推荐</td></tr><tr><td><code>Array.from(arguments)</code></td><td>语义清晰，支持类数组和可迭代对象</td></tr><tr><td><code>Array.prototype.slice.call(arguments)</code></td><td>传统兼容写法，ES5 时代常用</td></tr></tbody></table>
<p>在我们的代码中，<code>[...arguments]</code> 既简洁又高效。</p>
<hr/>
<h2 data-id="heading-17">五、对比两种实现方式</h2>
<p>还有一种用 <code>...args</code> 的写法：</p>
<pre><code class="hljs language-ini" lang="ini">function objectFactory(constructor, ...args) {
    var <span class="hljs-attr">obj</span> = new Object()<span class="hljs-comment">; </span>
    constructor.apply(obj, args)<span class="hljs-comment">;</span>
    <span class="hljs-attr">obj.__proto__</span> = constructor.prototype<span class="hljs-comment">;</span>
    return obj<span class="hljs-comment">;</span>
}
</code></pre>
<p>这种方式更现代、更清晰，<strong>不需要操作 <code>arguments</code></strong>，也避免了 <code>shift</code> 修改原参数的问题。</p>
<p>但使用 <code>arguments</code> 的版本更有教学意义：</p>
<ul>
<li>展示了如何在不支持 ES6 的环境中实现相同功能</li>
<li>深入理解了 <code>arguments</code> 的行为</li>
<li>学会了“借用数组方法”的经典技巧</li>
</ul>
<hr/>
<h2 data-id="heading-18">六、总结：不只是代码，更是思维跃迁</h2>
<p>通过手写 <code>new</code>，我们不仅掌握了对象创建的底层机制，还深入理解了：</p>
<ul>
<li><strong>原型链如何建立</strong>（<code>__proto__ = constructor.prototype</code>）</li>
<li><strong><code>this</code> 如何绑定</strong>（<code>apply</code> 的妙用）</li>
<li><strong><code>arguments</code> 的本质与局限</strong>（类数组 vs 真数组）</li>
<li><strong>函数式编程技巧</strong>（借用方法、展开运算符）</li>
</ul>
<p>更重要的是，我们学会了<strong>像 JavaScript 引擎一样思考</strong>——不再把 <code>new</code> 当作黑盒，而是理解其每一步的逻辑。</p>
<p>下次当你再看到 <code>new Date()</code> 或 <code>new Map()</code>，你会微微一笑：我知道你在背后干了什么！</p>
<blockquote>
<p>编程的最高境界，不是记住 API，而是理解原理。而你，已经走在了这条路上。🚀</p>
</blockquote>
<hr/>
<h2 data-id="heading-19">附录：完整增强版 <code>objectFactory</code>（含返回值处理）</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">objectFactory</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">const</span> <span class="hljs-title class_">Constructor</span> = [].<span class="hljs-property">shift</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);

    <span class="hljs-comment">// 执行构造函数</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, [...<span class="hljs-variable language_">arguments</span>]);

    <span class="hljs-comment">// 设置原型链</span>
    obj.<span class="hljs-property">__proto__</span> = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;

    <span class="hljs-comment">// 如果构造函数返回对象，则返回该对象；否则返回 obj</span>
    <span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> result === <span class="hljs-string">'object'</span>) {
        <span class="hljs-keyword">return</span> result;
    }
    <span class="hljs-keyword">return</span> obj;
}
</code></pre>
<p>这样就 100% 模拟了原生 <code>new</code> 的行为！</p>
<hr/>
<p>希望这篇详尽又生动的讲解，让你对 <code>new</code> 和 <code>arguments</code> 有了全新的认识。动手试试吧，亲手写出属于你的 <code>objectFactory</code>！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 原型继承详解：从基础到最佳实践]]></title>    <link>https://juejin.cn/post/7581995152190046250</link>    <guid>https://juejin.cn/post/7581995152190046250</guid>    <pubDate>2025-12-10T08:26:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581995152190046250" data-draft-id="7581876069608472619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 原型继承详解：从基础到最佳实践"/> <meta itemprop="keywords" content="JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-10T08:26:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Tzarevich"/> <meta itemprop="url" content="https://juejin.cn/user/578786070367529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 原型继承详解：从基础到最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578786070367529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Tzarevich
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:26:07.000Z" title="Wed Dec 10 2025 08:26:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">JavaScript 原型继承详解：从基础到最佳实践</h2>
<p>在 JavaScript 这门基于原型的语言中，<strong>继承</strong>并非通过类（class）实现，而是依赖于<strong>原型链（prototype chain）</strong> 。本文将结合多个典型示例，系统讲解 JavaScript 中的原型继承机制，从基本概念到经典模式，最终呈现 ES5 时代最高效的继承方案——<strong>寄生组合式继承</strong></p>
<hr/>
<h3 data-id="heading-1">一、原型链继承</h3>
<p><strong>基本思路</strong>：让子类的原型直接指向父类的一个实例。</p>
<h4 data-id="heading-2">✅ 基本实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">'动物'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">// 直接让子类原型指向父类实例</span>
</code></pre>
<h4 data-id="heading-3">⚠️ 存在的问题</h4>
<ol>
<li>
<p><strong>无法向父类构造函数传递参数</strong><br/>
设置 <code>Cat.prototype = new Animal()</code> 时，无法传入 <code>name</code>、<code>age</code> 等初始化参数，导致所有子类实例共享相同的初始状态。</p>
</li>
<li>
<p><strong>引用类型属性被所有实例共享（严重副作用）</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Animal.prototype.hobbies</span> = []<span class="hljs-comment">;</span>
const <span class="hljs-attr">cat1</span> = new Cat()<span class="hljs-comment">;</span>
const <span class="hljs-attr">cat2</span> = new Cat()<span class="hljs-comment">;</span>
cat1.hobbies.push('sleep')<span class="hljs-comment">;</span>
console.log(cat2.hobbies)<span class="hljs-comment">; // ['sleep'] ❌ 意外共享！</span>
</code></pre>
</li>
<li>
<p><strong>父类构造函数被无意义调用一次</strong><br/>
仅为设置原型就执行 <code>new Animal()</code>，若父构造函数包含日志、网络请求或 DOM 操作，会造成不必要的副作用和性能开销。</p>
</li>
</ol>
<blockquote>
<p><strong>结论</strong>：仅适用于无状态、无参数的简单继承场景，<strong>不推荐用于实际开发</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">二、构造函数继承</h3>
<p><strong>基本思路</strong>：在子类构造函数中使用 <code>call</code> 或 <code>apply</code> 调用父类构造函数</p>
<h4 data-id="heading-5">✅ 基本实现</h4>
<pre><code class="hljs language-ini" lang="ini">function Animal(name, age) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
  <span class="hljs-attr">this.age</span> = age<span class="hljs-comment">;</span>
}

function Cat(name, age, color) {
  Animal.call(this, name, age)<span class="hljs-comment">; // 借用父构造函数</span>
  <span class="hljs-attr">this.color</span> = color<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-6">⚠️ 存在的问题</h4>
<ol>
<li>
<p><strong>无法继承父类原型上的方法和属性</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Animal.prototype.speak</span> = function() { console.log(<span class="hljs-string">'hello'</span>)<span class="hljs-comment">; };</span>
const <span class="hljs-attr">cat</span> = new Cat(<span class="hljs-string">'小白'</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'黄'</span>)<span class="hljs-comment">;</span>
cat.speak()<span class="hljs-comment">; // TypeError: cat.speak is not a function ❌</span>
</code></pre>
</li>
<li>
<p><strong>方法无法复用，内存浪费</strong><br/>
如果在父构造函数中定义方法（如 <code>this.say = function() {...}</code>），每个子类实例都会创建一份独立的函数副本，无法通过原型共享，增加内存占用。</p>
</li>
</ol>
<blockquote>
<p><strong>结论</strong>：解决了参数传递和引用共享问题，但<strong>牺牲了原型方法的复用性</strong>，通常需与其他方式结合使用。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">三、组合继承</h3>
<p><strong>基本思路</strong>：结合构造函数继承（用于实例属性）和原型链继承（用于原型方法）</p>
<h4 data-id="heading-8">✅ 基本实现（传统写法）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">speak</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>); };

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, age, color</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name, age); <span class="hljs-comment">// 继承实例属性</span>
}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">// 继承原型方法</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>;
</code></pre>
<h4 data-id="heading-9">⚠️ 存在的问题</h4>
<ol>
<li>
<p><strong>父类构造函数被调用了两次</strong></p>
<ul>
<li>第一次：<code>new Animal()</code> 用于设置 <code>Cat.prototype</code>；</li>
<li>第二次：<code>Animal.call(this, ...)</code> 在子类构造函数中初始化实例。</li>
</ul>
<p>这不仅浪费性能，还导致逻辑冗余。</p>
</li>
<li>
<p><strong>子类原型被污染，出现冗余属性</strong><br/>
<code>Cat.prototype</code> 上会存在本应属于实例的属性（如 <code>name: undefined</code>, <code>age: undefined</code>），违背“原型只存放共享方法”的设计原则。。</p>
</li>
</ol>
<blockquote>
<p><strong>结论</strong>：功能完整但效率低下，是<strong>早期常用但非最优</strong>的方案。</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">四、原型式继承</h3>
<p><strong>基本思路</strong>：基于一个已有对象创建新对象，不依赖构造函数。</p>
<h4 data-id="heading-11">✅ 实现方式</h4>
<pre><code class="hljs language-ini" lang="ini">function object(o) {
  function F() {}
  <span class="hljs-attr">F.prototype</span> = o<span class="hljs-comment">;</span>
  return new F()<span class="hljs-comment">;</span>
}

const <span class="hljs-attr">animal</span> = { species: <span class="hljs-string">'动物'</span> }<span class="hljs-comment">;</span>
const <span class="hljs-attr">cat</span> = object(animal)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-12">⚠️ 存在的问题</h4>
<ol>
<li><strong>仍然存在引用类型共享问题</strong><br/>
所有通过 <code>object(animal)</code> 创建的对象共享 <code>animal</code> 上的引用属性，修改一处会影响全部。</li>
<li><strong>难以融入构造函数体系</strong><br/>
该模式适用于对象字面量之间的继承，但无法自然支持 <code>new</code>、<code>constructor</code>、实例私有属性等“类式”编程需求。</li>
</ol>
<blockquote>
<p><strong>结论</strong>：为 <code>Object.create()</code> 提供思路，但<strong>不适合构建类式继承体系</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">五、寄生组合式继承 ✅ 最佳方案</h3>
<p><strong>基本思路</strong>：用一个空的中介函数连接子类原型与父类原型，避免调用父类构造函数。</p>
<h4 data-id="heading-14">✅ 实现方式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">extend</span>(<span class="hljs-params">Parent, Child</span>) {
  <span class="hljs-keyword">var</span> F = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};           <span class="hljs-comment">// 空中介函数</span>
  F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;  <span class="hljs-comment">// 链接到父类原型</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>();       <span class="hljs-comment">// 子类原型 = 干净中介实例</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>; <span class="hljs-comment">// 修复 constructor</span>
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name, age</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">'动物'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name, age, color</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// 继承实例属性</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
}
<span class="hljs-title function_">extend</span>(<span class="hljs-title class_">Animal</span>, <span class="hljs-title class_">Cat</span>); <span class="hljs-comment">// 继承原型方法</span>

<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"eat jerry"</span>);
};
</code></pre>
<h4 data-id="heading-15">✅ 优势（即其他方法的缺陷在此全部被规避）</h4>
<ul>
<li>实例属性通过 <code>apply/call</code> 初始化，支持传参，避免共享；</li>
<li>原型方法通过干净的中介对象继承，<strong>无需调用父类构造函数</strong>；</li>
<li>子类原型上无冗余属性，保持整洁；</li>
<li><code>constructor</code> 被正确修复，保证 <code>instanceof</code> 和 <code>constructor</code> 判断准确；</li>
<li><strong>父类构造函数仅在真正创建实例时被调用一次</strong>，高效且安全。</li>
</ul>
<blockquote>
<p><strong>结论</strong>：这是 <strong>ES5 时代最理想的继承模式</strong>，被广泛认为是经典解决方案。</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">六、现代替代：ES6 Class（语法糖）</h3>
<p>ES6 引入了 <code>class</code> 和 <code>extends</code> 语法：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
  constructor(name, age) {
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.age = age;
  }
  get species() { <span class="hljs-keyword">return</span> '动物'; }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> </span>{
  constructor(name, age, color) {
    <span class="hljs-keyword">super</span>(name, age);
    <span class="hljs-keyword">this</span>.color = color;
  }
  eat() { console.log(<span class="hljs-string">"eat jerry"</span>); }
}
</code></pre>
<ul>
<li>底层仍基于原型链；</li>
<li>自动处理 <code>constructor</code> 修复、原型链接等细节；</li>
<li>这并非引入新机制，而是对寄生组合式继承的<strong>语法糖封装</strong>。它自动处理原型链接、<code>super</code> 调用、<code>constructor</code> 修复等细节，使代码更简洁、可读性更强。</li>
</ul>
<blockquote>
<p><strong>建议</strong>：新项目优先使用 <code>class</code>，老项目或需深入理解机制时，掌握 <code>extend</code> 模式至关重要。</p>
</blockquote>
<hr/>
<h3 data-id="heading-17">结语</h3>
<p>JavaScript 的继承之路，是从“能用”走向“好用”再到“优雅”的过程。早期的原型链和构造函数继承各有短板，组合继承虽功能完整却效率低下。直到寄生组合式继承出现，才真正平衡了安全性、复用性与性能。</p>
<p>通过理解每种继承方式的<strong>设计初衷与内在缺陷</strong>，我们不仅能写出更健壮的代码，也能真正掌握 JavaScript 面向对象编程的灵魂：<strong>灵活、动态、基于原型的对象模型</strong>。从 <code>call/apply</code> 到“空对象中介”再到 <code>extend</code> 工具函数，完整展现了这一演进过程——<strong>从问题出发，逐步优化，最终抵达最佳实践</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[麦肯锡刚刚发布了他们的2025年AI报告。以下是TLDR]]></title>    <link>https://juejin.cn/post/7582036070158630912</link>    <guid>https://juejin.cn/post/7582036070158630912</guid>    <pubDate>2025-12-10T08:30:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582036070158630912" data-draft-id="7581828086020685839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="麦肯锡刚刚发布了他们的2025年AI报告。以下是TLDR"/> <meta itemprop="keywords" content="AIGC,OpenAI,Agent"/> <meta itemprop="datePublished" content="2025-12-10T08:30:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="安思派Anspire"/> <meta itemprop="url" content="https://juejin.cn/user/3044964115417419"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            麦肯锡刚刚发布了他们的2025年AI报告。以下是TLDR
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3044964115417419/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    安思派Anspire
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:30:11.000Z" title="Wed Dec 10 2025 08:30:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>全新的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.mckinsey.com%2Fcapabilities%2Fquantumblack%2Four-insights%2Fthe-state-of-ai" target="_blank" title="https://www.mckinsey.com/capabilities/quantumblack/our-insights/the-state-of-ai" ref="nofollow noopener noreferrer">麦肯锡报告</a>的十大要点，该报告探讨了一项向世界许下承诺的技术，但实际上它是否兑现了炒作的预期？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac0be0c57d3e4873ab29773431e3c48c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6J5oCd5rS-QW5zcGlyZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765960211&amp;x-signature=nAQeVsJcdnQ5DV7rv5u0gj%2BDqqE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0">1/ 90%的公司“使用AI”，但67%仍停留在试点模式</h3>
<p>AI的问题不在于能否构建一个包装器或新的概念验证（PoC）。扩展需要优质、干净且准确的数据来输入到工具中。此外，你还需要一个完善的技术<strong>架构</strong>来使一切正常运行和流畅运作——主要是基于云的架构。</p>
<h3 data-id="heading-1">62%的组织正在试验AI智能体，23%的组织正在扩大AI智能体的应用规模。</h3>
<p>大多数集中在科技和医疗保健领域。医疗保健是AI智能体的巨大机遇。人们常常在这个领域感到迷茫或充满好奇，尤其是在当今的数字世界中。我们将看到这里会受到更多关注。</p>
<h3 data-id="heading-2">3/ 影响差距巨大。64%的人表示AI有助于创新，但只有39%的人看到了实际息税前利润的增长。</h3>
<p>AI需要大量投资才能有效地扩大技术规模。此外，不仅是技术需要变革，与之相关的工具、人员和流程也需要变革，这就推高了成本。</p>
<h3 data-id="heading-3">4/表现优异者（前6%）想得更长远。</h3>
<p>他们重建工作流程，设定增长目标，并投入实际预算，而不仅仅是概念验证（POC）。对于某些技术而言，思维越宏大，回报就越高。如果你能在组织内部找到改进流程的切入点，那么在改进和回报方面就会产生复利效应。</p>
<h3 data-id="heading-4">5/个人拥有AI的领导者扩大规模的可能性是其他人的3倍。</h3>
<p>这是一项需要领导层参与解决问题并积极采用的技术。AI具有适应性和可及性。领导层投入越多，就越会推动AI议程。</p>
<h3 data-id="heading-5">6/ 赢家使用AI来改变工作的完成方式，而不仅仅是加快工作速度。</h3>
<p>我们都在工作方式中经历着摩擦。一个更好的流程从员工士气到成本节约都有一系列好处。非货币性的好处作为关键绩效指标（KPI）来设定和衡量是极具价值的。</p>
<h3 data-id="heading-6">7/普通公司衡量效率。</h3>
<p>最优秀的企业衡量其员工的行动速度。将信息转化为可执行洞察的速度是新的竞争<strong>优势</strong>。</p>
<h3 data-id="heading-7">8/风险管理正在迎头赶上，51%的人已经目睹了AI的反噬，主要是由于不准确。</h3>
<p>信任是阻碍AI发展的因素。我们看到AI发展缓慢；同样，企业能否将最有价值的决策交由AI来执行呢？</p>
<h3 data-id="heading-8">9/劳动力影响尚不明朗。32%的人预计会裁员，13%的人预计会增长，其他人都在猜测。</h3>
<p>我们通常看到的是，一项新技术的出现往往伴随着不确定性。那些有着明确流程和可预测数据流的旧工作将会消失。但新的工作岗位将会涌现，涵盖从工程、销售到风险和领导等各个领域。</p>
<h3 data-id="heading-9">10/ AI的采用已成为主流，但真正的变革尚未开始。</h3>
<p>我们距离看到AI的益处得以实现仍有很长的路要走。此外，它是资本密集型的。大多数NVIDIA芯片在新芯片推出并取代它之前只能使用1年。公司需要在投资方面具有战略眼光。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何实现 vxe-tree 树组件拖拽节点后进行二次确认提示]]></title>    <link>https://juejin.cn/post/7581872532363083785</link>    <guid>https://juejin.cn/post/7581872532363083785</guid>    <pubDate>2025-12-10T08:29:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581872532363083785" data-draft-id="7582021506189410350" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何实现 vxe-tree 树组件拖拽节点后进行二次确认提示"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-10T08:29:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何实现 vxe-tree 树组件拖拽节点后进行二次确认提示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:29:30.000Z" title="Wed Dec 10 2025 08:29:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如何实现 vxe-tree 树组件拖拽节点后进行二次确认提示，参数 drag-config.dragStartMethod 可以自定义处理拖拽开始时的拖动，可以自定义是否允许拖拽</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvxeui.com" target="_blank" title="https://vxeui.com" ref="nofollow noopener noreferrer">vxeui.com</a>
github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fx-extends%2Fvxe-pc-ui" target="_blank" title="https://github.com/x-extends/vxe-pc-ui" ref="nofollow noopener noreferrer">github.com/x-extends/v…</a>
gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-pc-ui" target="_blank" title="https://gitee.com/x-extends/vxe-pc-ui" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb6eb45f937e493094a19f81162d46fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765960169&amp;x-signature=wcwDie8Yd8lWrNa%2F%2BXBcNoGhGKk%3D" alt="tree_drag_drag_method" loading="lazy"/></p>
<p>需要提示操作时，通过 drag-config.dragEndMethod 可以自定义处理拖拽结束时的拖动</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-tree</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"treeOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-tree</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">VxeUI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vxe-pc-ui'</span>

<span class="hljs-keyword">const</span> treeOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">transform</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">drag</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">dragConfig</span>: {
    <span class="hljs-attr">isCrossDrag</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">isSelfToChildDrag</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">showGuidesStatus</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-keyword">async</span> dragEndMethod () {
      <span class="hljs-keyword">const</span> type = <span class="hljs-keyword">await</span> <span class="hljs-title class_">VxeUI</span>.<span class="hljs-property">modal</span>.<span class="hljs-title function_">confirm</span>({
        <span class="hljs-attr">content</span>: <span class="hljs-string">'请是否确认调整顺序？'</span>
      })
      <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'confirm'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
      }
      <span class="hljs-title class_">VxeUI</span>.<span class="hljs-property">modal</span>.<span class="hljs-title function_">message</span>({
        <span class="hljs-attr">content</span>: <span class="hljs-string">'操作已取消'</span>,
        <span class="hljs-attr">status</span>: <span class="hljs-string">'warning'</span>
      })
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'2'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'3'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'31'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'32'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'321'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'32'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-2-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'322'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'32'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'33'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'331'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'332'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-3-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'333'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'33'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点3-4'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'34'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'3'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'4'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'41'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'411'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'42'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-1-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'412'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'42'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'42'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'43'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'4'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3-1'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'431'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'43'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点4-3-2'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'432'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-string">'43'</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'节点5'</span>, <span class="hljs-attr">id</span>: <span class="hljs-string">'5'</span>, <span class="hljs-attr">parentId</span>: <span class="hljs-literal">null</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-pc-ui" target="_blank" title="https://gitee.com/x-extends/vxe-pc-ui" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 Kuscia 中升级引擎镜像？]]></title>    <link>https://juejin.cn/post/7581760987763605555</link>    <guid>https://juejin.cn/post/7581760987763605555</guid>    <pubDate>2025-12-10T06:02:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763605555" data-draft-id="7581760987763572787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 Kuscia 中升级引擎镜像？"/> <meta itemprop="keywords" content="开源,资讯"/> <meta itemprop="datePublished" content="2025-12-10T06:02:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="隐语SecretFlow"/> <meta itemprop="url" content="https://juejin.cn/user/3224235748628536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 Kuscia 中升级引擎镜像？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3224235748628536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    隐语SecretFlow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:02:04.000Z" title="Wed Dec 10 2025 06:02:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>打开链接即可点亮社区Star，照亮技术的前进之路。</p>
<p>Github 地址：<em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsecretflow%2Fkuscia" target="_blank" title="https://github.com/secretflow/kuscia" ref="nofollow noopener noreferrer">github.com/secretflow/…</a></em></p>
<p>Kuscia 支持在部署后升级引擎版本，本文档介绍如何在 Kuscia 中升级引擎镜像。</p>
<h2 data-id="heading-0">导入引擎镜像</h2>
<p>Kuscia 提供脚本升级镜像和手动升级镜像两种方式，您可以根据自己的需求选择合适的方式。</p>
<h3 data-id="heading-1">脚本升级镜像</h3>
<ol>
<li>
<p>获取工具脚本</p>
<pre><code class="hljs language-shell" lang="shell">docker cp root-kuscia-autonomy-alice:/home/kuscia/scripts .
</code></pre>
</li>
<li>
<p>注册镜像</p>
<p><strong>点对点模式</strong></p>
<p>Autonomy 节点需要同时导入引擎镜像和注册 AppImage，下面以 root-kuscia-autonomy-alice 节点为例，其他 Autonomy 节点也需要进行导入</p>
<pre><code class="hljs language-shell" lang="shell">./scripts/deploy/register_app_image.sh -c root-kuscia-autonomy-alice -i secretflow-registry.cn-hangzhou.cr.aliyuncs.com/secretflow/secretflow-lite-anolis8:latest -f scripts/templates/app_image.secretflow.yaml --import
</code></pre>
<p><strong>中心化模式</strong></p>
<p>Master 节点注册 AppImage 即可，下面以 root-kuscia-master 为例</p>
<pre><code class="hljs language-shell" lang="shell">./scripts/deploy/register_app_image.sh -c root-kuscia-master -i secretflow-registry.cn-hangzhou.cr.aliyuncs.com/secretflow/secretflow-lite-anolis8:latest -f scripts/templates/app_image.secretflow.yaml
</code></pre>
<p>Lite 节点导入引擎镜像即可，下面以 root-kuscia-lite-alice 节点为例，其他 Lite 节点也需要进行导入</p>
<pre><code class="hljs language-shell" lang="shell">./scripts/deploy/register_app_image.sh -c root-kuscia-lite-alice -i secretflow-registry.cn-hangzhou.cr.aliyuncs.com/secretflow/secretflow-lite-anolis8:latest --import
</code></pre>
</li>
</ol>
<h3 data-id="heading-2">手动升级镜像</h3>
<p>kuscia 命令支持在 RunC、RunP 模式中导入引擎镜像，使用示例如下：</p>
<ol>
<li>
<p>登录到 Autonomy、Lite 节点中</p>
<pre><code class="hljs language-shell" lang="shell">docker exec -it ${USER}-kuscia-autonomy-alice bash
</code></pre>
</li>
<li>
<p>导入镜像</p>
<p>执行 kuscia image 导入镜像，此处以 sf 镜像为例</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Import Image</span>
kuscia image pull secretflow-registry.cn-hangzhou.cr.aliyuncs.com/secretflow/secretflow-lite-anolis8:1.11.0b1
</code></pre>
<p>如果您使用的是<code>私有仓库</code>，请加上 creds 参数指定账户密码，示例如下：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Import Image</span>
kuscia image pull --creds "user:password" private.registry.com/secretflow/secretflow-lite-anolis8:1.11.0b1
</code></pre>
<p>如果您的环境无法访问镜像仓库，您也可以将镜像打成 tar 包传到容器里，然后通过 kuscia image load 导入，示例如下：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Import Image</span>
kuscia image load -i secretflow-lite-anolis8.tar
</code></pre>
<p>验证镜像导入成功</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">View Image</span>
kuscia image list
</code></pre>
</li>
<li>
<p>注册 AppImage</p>
<p>镜像导入之后需要在 Autonomy 和 Master 节点上修改 AppImage，Lite 节点无需执行，示例如下：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">Enter the master container</span>
docker exec -it ${USER}-kuscia-master bash
<span class="hljs-meta prompt_">
# </span><span class="bash">The appimage is based on the actual engine name, we use the default name of secretflow as an example.</span>
kubectl edit appimage secretflow-image
<span class="hljs-meta prompt_">
# </span><span class="bash">Modify the name and tag <span class="hljs-keyword">in</span> the image field, <span class="hljs-keyword">then</span> save and <span class="hljs-built_in">exit</span>.</span>
  image:
    name: xxx
    tag: xxx
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 自动化设置 Excel 文件文档属性]]></title>    <link>https://juejin.cn/post/7581769891499704339</link>    <guid>https://juejin.cn/post/7581769891499704339</guid>    <pubDate>2025-12-10T06:11:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891499704339" data-draft-id="7581789701532074026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 自动化设置 Excel 文件文档属性"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-10T06:11:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户033212666367"/> <meta itemprop="url" content="https://juejin.cn/user/230252528804124"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 自动化设置 Excel 文件文档属性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/230252528804124/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户033212666367
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:11:42.000Z" title="Wed Dec 10 2025 06:11:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发中，我们经常需要自动化生成 Excel 报表。然而，仅仅填充数据是远远不够的。一个专业的 Excel 文件，其文档属性（如作者、标题、公司、甚至自定义属性）往往能大大提升文件的可管理性和可检索性。你是否曾为如何通过 Java 代码设置这些属性而烦恼？别担心，本文将为你揭示如何利用强大的 Spire.XLS for Java 库，轻松实现这一目标！</p>
<h2 data-id="heading-0">Spire.XLS for Java 库介绍与安装</h2>
<p>Spire.XLS for Java 是一个功能丰富的 Excel 处理组件，专门用于在 Java 应用程序中创建、读取、编辑和转换 Excel 文件。它的最大优势在于无需安装 Microsoft Office 软件即可独立运行，这对于服务器端应用尤其重要。它支持多种 Excel 格式，并提供了对单元格、行、列、工作表、图表、图像、公式乃至文档属性等全方位的操作接口。</p>
<h3 data-id="heading-1">Maven 依赖配置：</h3>
<p>如果你使用 Maven 项目，只需在 pom.xml 文件中添加以下依赖即可：</p>
<pre><code class="hljs language-xml" lang="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>com.e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.e-iceblue.cn/repository/maven-public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>e-iceblue<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spire.xls<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>15.11.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<p>你也可以直接从 Spire.XLS for Java 官网 下载 JAR 包手动导入项目。</p>
<h2 data-id="heading-2">Java 设置内置的 Excel 文档属性</h2>
<p>Excel 文件内置了多种标准文档属性，用于描述文件的基本信息，例如标题、作者、主题、公司、类别、关键字和备注等。Spire.XLS for Java 提供了简单直观的 API 来访问和修改这些属性。</p>
<p>以下代码示例演示了如何设置这些内置属性：</p>
<pre><code class="hljs language-scss" lang="scss">import com<span class="hljs-selector-class">.spire</span><span class="hljs-selector-class">.xls</span><span class="hljs-selector-class">.ExcelVersion</span>;
import com<span class="hljs-selector-class">.spire</span><span class="hljs-selector-class">.xls</span><span class="hljs-selector-class">.Workbook</span>;

public class BuiltinProperties {
    public static void <span class="hljs-selector-tag">main</span>(String[] args){
        <span class="hljs-comment">//加载Excel文档</span>
        Workbook workbook = new <span class="hljs-built_in">Workbook</span>();
        workbook<span class="hljs-selector-class">.loadFromFile</span>("input.xlsx");

        <span class="hljs-comment">//给文档设置标题、主题、作者等内置文档属性</span>
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setTitle</span>("设置文档属性");
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setSubject</span>("Spire.XLS for Java Demo");
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setAuthor</span>("张丽");
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setManager</span>("王刚");
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setCompany</span>("E-iceblue");
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setCategory</span>("Spire.XLS for Java");
        workbook<span class="hljs-selector-class">.getDocumentProperties</span>()<span class="hljs-selector-class">.setKeywords</span>("Excel文档属性");

        <span class="hljs-comment">//保存结果文档</span>
        workbook<span class="hljs-selector-class">.saveToFile</span>("BuiltinDocumentProperties.xlsx", ExcelVersion.Version2013);
    }
}
</code></pre>
<p>运行上述代码后，打开生成的 BuiltInDocumentProperties.xlsx 文件，在“文件”-&gt;“信息”-&gt;“属性”中，你就可以看到这些被设置好的属性了。</p>
<h2 data-id="heading-3">Java 设置自定义的 Excel 文档属性</h2>
<p>除了内置属性，Excel 还允许用户添加自定义文档属性。这些属性以键值对的形式存在，非常适合存储一些特定的、与业务逻辑相关的元数据，例如“项目编号”、“版本号”、“审核人”等。这对于文件的自动化管理和数据检索提供了极大的便利。</p>
<p>以下代码演示了如何添加、修改和删除自定义文档属性：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> com.<span class="hljs-property">spire</span>.<span class="hljs-property">xls</span>.<span class="hljs-property">ExcelVersion</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">spire</span>.<span class="hljs-property">xls</span>.<span class="hljs-property">Workbook</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Date</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomProperties</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>){
        <span class="hljs-comment">//加载Excel文档</span>
        <span class="hljs-title class_">Workbook</span> workbook = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Workbook</span>();
        workbook.<span class="hljs-title function_">loadFromFile</span>(<span class="hljs-string">"input.xlsx"</span>);

        <span class="hljs-comment">//给文档添加自定义文档属性</span>
        workbook.<span class="hljs-title function_">getCustomDocumentProperties</span>().<span class="hljs-title function_">add</span>(<span class="hljs-string">"_MarkAsFinal"</span>, <span class="hljs-literal">true</span>);
        workbook.<span class="hljs-title function_">getCustomDocumentProperties</span>().<span class="hljs-title function_">add</span>(<span class="hljs-string">"编辑"</span>, <span class="hljs-string">"E-iceblue"</span>);
        workbook.<span class="hljs-title function_">getCustomDocumentProperties</span>().<span class="hljs-title function_">add</span>(<span class="hljs-string">"联系电话"</span>, <span class="hljs-number">81705109</span>);
        workbook.<span class="hljs-title function_">getCustomDocumentProperties</span>().<span class="hljs-title function_">add</span>(<span class="hljs-string">"更新日期"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());

        <span class="hljs-comment">//保存结果文档</span>
        workbook.<span class="hljs-title function_">saveToFile</span>(<span class="hljs-string">"CustomDocumentProperties.xlsx"</span>, <span class="hljs-title class_">ExcelVersion</span>.<span class="hljs-property">Version2013</span>);
    }
}
</code></pre>
<p>运行上述代码，打开生成的 CustomDocumentProperties.xlsx 文件，在“文件”-&gt;“信息”-&gt;“属性”-&gt;“显示所有属性”或“高级属性”中，你就能看到这些自定义属性了。</p>
<h2 data-id="heading-4">总结</h2>
<p>通过本文的详细教程，我们学习了如何利用 Spire.XLS for Java 库，在 Java 应用程序中轻松设置 Excel 文件的内置和自定义文档属性。这不仅能让你的自动化生成的 Excel 报表看起来更加专业，还能极大地提升文件的可管理性和检索效率，在自动化办公和数据管理中发挥重要作用。现在，是时候将这些技巧应用到你的项目中了，去探索 Spire.XLS for Java 更多强大的功能吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Transporter 的局限与替代路径，iOS 上传流程在多平台团队中的演进]]></title>    <link>https://juejin.cn/post/7581888578538045478</link>    <guid>https://juejin.cn/post/7581888578538045478</guid>    <pubDate>2025-12-10T08:40:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581888578538045478" data-draft-id="7582048028391915570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Transporter 的局限与替代路径，iOS 上传流程在多平台团队中的演进"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T08:40:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="疯狂的程序猴"/> <meta itemprop="url" content="https://juejin.cn/user/2760245749234147"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Transporter 的局限与替代路径，iOS 上传流程在多平台团队中的演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2760245749234147/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    疯狂的程序猴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:40:18.000Z" title="Wed Dec 10 2025 08:40:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于许多 iOS 或跨端团队来说，Transporter 一直是上传 IPA 到 App Store Connect 最常用的工具。它作为苹果官方提供的独立上传应用，逻辑清晰、操作直接，也能显示上传日志，是许多开发者从 Application Loader 过渡后的主要选择。然而，当团队逐渐跨平台、多人协作、自动化构建需求增强时，Transporter 的局限也愈发明显：它只能运行在 macOS 上，无法嵌入 CI/CD，且每次上传都必须依赖图形界面或 macOS 环境。</p>
<p>在实际项目中，Transporter 并不是问题的根源，问题在于它背后所隐含的系统限制。在跨平台团队（Windows + Linux + macOS）、跨端框架（Flutter、uni-app、RN）、以及远程构建服务器普遍化的今天，IPA 上传单点依赖 macOS 已经成为效率瓶颈。</p>
<p>本文将从工程角度重新审视 Transporter 的定位，分析其在现代发布链路中的局限，并探讨在没有 Mac、需要自动化、或需要跨平台支持时，如何借助其他工具构建更灵活的上传体系。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、Transporter 的优势与边界：它不是坏工具，只是不够通用</strong></h2>
<p>作为苹果官方上传工具，Transporter 的优势主要体现在：</p>
<ol>
<li><strong>上传稳定，兼容 Xcode 生成的 IPA</strong></li>
<li><strong>提供日志反馈，便于查看验证/上传失败原因</strong></li>
<li><strong>支持 App Store 与 TestFlight 构建上传</strong></li>
</ol>
<p>但 Transporter 的限制同样非常明确：</p>
<h3 data-id="heading-1"><strong>限制 1：只能运行在 macOS</strong></h3>
<p>对多平台团队来说，这意味着：</p>
<ul>
<li>Windows 无法直接上传</li>
<li>Linux CI 无法上传</li>
<li>云构建系统必须准备 macOS 节点</li>
<li>团队内无法分配上传任务给非 Mac 成员</li>
</ul>
<h3 data-id="heading-2"><strong>限制 2：无法作为通用 CLI 用于无界面环境</strong></h3>
<p>Transporter 虽然有命令行模式，但仍然依赖 macOS 系统环境。</p>
<h3 data-id="heading-3"><strong>限制 3：上传行为无法脱离苹果本机生态</strong></h3>
<p>这意味着它不适合自动化脚本中长链路的独立步骤。</p>
<p>在当今工程体系中，Transporter 更像一款“个人工具”，而不是“团队级工具”。</p>
<hr/>
<h2 data-id="heading-4"><strong>二、跨平台团队中为什么 Transporter 会成为瓶颈？</strong></h2>
<p>iOS 上传流程看似简单，但在协作场景中 Transporter 会带来结构性问题：</p>
<h3 data-id="heading-5"><strong>1. 依赖固定设备</strong></h3>
<p>负责上传的人必须拥有 Mac。
这会造成：</p>
<ul>
<li>成员请假或电脑出问题 → 上架被卡</li>
<li>需求高峰期上传排队</li>
<li>发布流程绑定个人机器，不易交接</li>
</ul>
<h3 data-id="heading-6"><strong>2. CI/CD 无法自动执行上传</strong></h3>
<p>大多数企业 CI 都运行在 Linux 或 Windows。
Transporter 无法直接使用，自动化链路必须分离。</p>
<h3 data-id="heading-7"><strong>3. 远程团队与外包模式难以共享上传能力</strong></h3>
<p>外部团队通常无法访问企业的 Mac 机器。</p>
<p>这些痛点并不是 Transporter 的问题，而是它的设计初衷决定了它无法适应如今的多端协作环境。</p>
<hr/>
<h2 data-id="heading-8"><strong>三、如何在 Transporter 之外构建更灵活的上传路径？</strong></h2>
<p>为了让上传不再依赖 macOS 环境，我在多个项目中采用了 <strong>跨平台上传工具接替 Transporter 的上传职责</strong>。</p>
<p>在这些方案中，最常用的是：</p>
<h3 data-id="heading-9"><strong>使用开心上架（Appuploader）的命令行上传 IPA</strong></h3>
<p>示例命令如下：</p>
<pre><code class="hljs language-css" lang="css">appuploader_cli -u dev<span class="hljs-keyword">@icloud</span>.com -p xxx-xxx -c <span class="hljs-number">1</span> -f myapp.ipa
</code></pre>
<p>理由包括：</p>
<ul>
<li><strong>可在 Windows / Linux / macOS 运行</strong></li>
<li><strong>不依赖 Xcode 或 Transporter</strong></li>
<li><strong>命令行方式适合 CI/CD 集成</strong></li>
<li><strong>上传动作不绑定 Mac 设备信息</strong></li>
<li><strong>可在没有本地 macOS 的团队执行完整上传流程</strong></li>
</ul>
<p>在 Transporter 无法覆盖的多平台上传场景下，这一方式可以让团队在没有 Mac 的情况下仍能完成发布操作。
图形化界面：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60fc8fc238c849d489fb3aed59001fce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55av54uC55qE56iL5bqP54y0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765960818&amp;x-signature=F1YEwFOto5ylsPGqqs754ORoEv8%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10"><strong>四、上传前的签名链路检查：Transporter 不负责，但团队必须负责</strong></h2>
<p>Transporter 通常会在上传阶段才暴露错误：</p>
<ul>
<li>证书不匹配</li>
<li>描述文件过期</li>
<li>Bundle ID 不一致</li>
<li>IPA 内结构缺失</li>
</ul>
<p>而等待 Transporter 报错意味着：</p>
<blockquote>
<p>你已经浪费了上传时间。</p>
</blockquote>
<p>为了减少失败率，我会在上传前通过 <strong>Appuploader 的文件/配置解析功能</strong> 做预检，包括：</p>
<ul>
<li>查看 IPA 内的 Info.plist</li>
<li>检查 mobileprovision 是否使用正确的发布证书</li>
<li>验证 Bundle ID 是否一致</li>
<li>查看证书指纹与 Profile 绑定关系</li>
</ul>
<p>这些检查可在任何操作系统中执行，因此团队不需要依赖 Mac 才能发现问题。</p>
<hr/>
<h2 data-id="heading-11"><strong>五、多平台团队中构建“Transporter 替代链路”的实际示例</strong></h2>
<p>一个典型的跨平台上传流程如下：</p>
<h3 data-id="heading-12"><strong>1. CI 构建 IPA（macOS Runner）</strong></h3>
<ul>
<li>云构建</li>
<li>Jenkins + Mac Mini</li>
<li>GitHub Actions Mac 节点</li>
</ul>
<h3 data-id="heading-13"><strong>2. 将 IPA 上传到服务器或制品库</strong></h3>
<h3 data-id="heading-14"><strong>3. 非 macOS 环境执行上传（Windows / Linux）</strong></h3>
<pre><code class="hljs language-css" lang="css">appuploader_cli -u xxx -<span class="hljs-selector-tag">p</span> xxx -c <span class="hljs-number">1</span> -f build<span class="hljs-selector-class">.ipa</span>
</code></pre>
<h3 data-id="heading-15"><strong>4. App Store Connect 自动开始处理构建</strong></h3>
<p>此流程的优势在于：</p>
<ul>
<li>构建与上传职责分离</li>
<li>上传不再需要 macOS</li>
<li>团队所有成员都能执行上传任务</li>
<li>更容易实现自动化和重试逻辑</li>
</ul>
<p>相较之下，Transporter 无法参与这一链路。</p>
<hr/>
<h2 data-id="heading-16"><strong>六、Transporter 与跨平台上传工具之间的协作与互补</strong></h2>
<p>Transporter 本质上并非无用，而是“适用场景不同”：</p>



































<table><thead><tr><th>场景</th><th>Transporter</th><th>Appuploader CLI</th></tr></thead><tbody><tr><td>本地 macOS 单人上传</td><td>适用</td><td>可使用</td></tr><tr><td>Windows / Linux 上传</td><td>不支持</td><td>支持</td></tr><tr><td>CI/CD 自动化上传</td><td>需要 macOS</td><td>任意系统</td></tr><tr><td>多团队协作</td><td>不便于共享</td><td>较灵活</td></tr><tr><td>查看文件结构 / 证书链路</td><td>不提供</td><td>支持</td></tr></tbody></table>
<p>从工程视角来看：</p>
<ul>
<li><strong>Transporter 更适合个人开发者或纯 macOS 团队</strong></li>
<li><strong>跨平台上传工具更适合现代化协作团队与自动化体系</strong></li>
</ul>
<p>两者并非互相替代，而是各自服务不同需求。</p>
<hr/>
<h2 data-id="heading-17"><strong>七、结语：上传 IPA 的方式不止一种，流程可根据团队结构重构</strong></h2>
<p>Transporter 是官方工具，适用于标准、单机、纯苹果生态的开发模式。但现代团队的结构比过去复杂得多：
– 成员使用不同操作系统
– 构建在 CI 自动执行
– 上架需要多人协作
– 外包团队需要有限权限参与流程</p>
<p>在这种环境下，上架流程必须具备跨平台能力。
通过使用像 <strong>Appuploader CLI</strong> 这样支持 Windows / Linux / macOS 的上传工具，并结合其对证书、描述文件的解析能力，可以让团队摆脱 Transporter 的系统限制，实现更加柔性、可控、稳定的 IPA 上传流程。</p>
<p>最终目标不是替代 Transporter，而是让上传不再成为多人协作的瓶颈。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[V2 积分商城小程序系统：一站式积分兑换解决方案]]></title>    <link>https://juejin.cn/post/7581858890607689764</link>    <guid>https://juejin.cn/post/7581858890607689764</guid>    <pubDate>2025-12-10T08:44:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581858890607689764" data-draft-id="7581995152190144554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="V2 积分商城小程序系统：一站式积分兑换解决方案"/> <meta itemprop="keywords" content="微信"/> <meta itemprop="datePublished" content="2025-12-10T08:44:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="微擎应用市场"/> <meta itemprop="url" content="https://juejin.cn/user/2253321372174896"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            V2 积分商城小程序系统：一站式积分兑换解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2253321372174896/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    微擎应用市场
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:44:44.000Z" title="Wed Dec 10 2025 08:44:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、概述总结</h2>
<p>V2 积分商城是一款支持微信公众号的小程序系统，主打 “积分 + 金额” 的商品兑换模式，为商家提供灵活的用户激励工具。系统通过微擎系统在线交付，源码未加密且支持 PHP7.1-7.3 版本，新购用户可享受 1 年免费服务套餐，期间能持续更新至最新版本。其核心优势在于结合积分体系与商品兑换，帮助商家提升用户粘性，同时提供便捷的后台管理与用户操作体验，保障使用过程中的技术支持。</p>
<h2 data-id="heading-1">二、功能介绍</h2>
<h3 data-id="heading-2"> 核心兑换功能</h3>
<p>支持两种兑换模式，既可以纯积分兑换商品，也可采用 “积分 + 金额” 组合兑换方式，满足不同商家的营销需求。商品覆盖手机、数码等品类，展示清晰的积分要求、剩余积分数量及兑换规则，用户可直观了解兑换条件。</p>
<h3 data-id="heading-3">用户信息管理</h3>
<p>可获取微信昵称、头像、性别、地区等用户基础信息，同时支持收集联系人姓名、联系电话、省市区及详细收货地址，便于商品配送与用户关系维护，还能获取用户位置信息与相册权限，丰富交互场景。</p>
<h3 data-id="heading-4">系统适配与更新</h3>
<p>适配微信公众号平台，交付方式简单高效，支持在线交付无需复杂部署。服务周期内提供免费更新服务，确保系统功能紧跟行业需求，源码未加密设计也为有技术能力的商家提供了灵活拓展空间。</p>
<h3 data-id="heading-5">三、适用场景与行业价值</h3>
<h3 data-id="heading-6">适用场景</h3>
<p>零售行业：线下门店、线上电商平台用于用户消费后积分积累与兑换，提升复购率。<br/>
服务行业：餐饮、酒店、美容等领域，通过积分兑换增强用户忠诚度，吸引老客回流。<br/>
品牌推广：企业用于新品试用、品牌周边赠送，借助积分体系扩大用户触达范围。<br/>
会员体系：各类会员制平台，将积分作为会员权益核心，丰富会员服务内容。</p>
<h3 data-id="heading-7">行业价值</h3>
<p>对商家：降低获客成本，通过积分激励促进用户留存与复购，同时借助用户信息收集优化营销策略，无需高额续费即可长期使用核心功能。<br/>
对用户：消费行为可转化为实际权益，兑换手机、数码等实用商品，提升消费体验与满意度，操作流程简单，无需额外付出成本即可参与。<br/>
对行业：规范积分营销模式，提供标准化的积分商城解决方案，助力中小商家快速搭建完善的用户激励体系，推动行业营销效率提升。</p>
<h2 data-id="heading-8">问答环节</h2>
<p>问：V2 积分商城小程序系统支持哪些平台使用？</p>
<p>答：适用于微信公众号平台，可依托公众号生态开展积分兑换业务。</p>
<p>问：系统的交付方式是什么？是否需要复杂部署？</p>
<p>答：采用微擎系统在线交付方式，无需复杂部署流程，便捷高效。</p>
<p>问：系统支持哪些积分兑换模式？</p>
<p>答：支持两种兑换模式，分别是纯积分兑换和 “积分 + 金额” 组合兑换。</p>
<p>问：系统是否支持用户信息收集？可收集哪些信息？</p>
<p>答：支持用户信息收集，包括微信昵称、头像、性别、地区等基础信息，以及联系人姓名、联系电话、收货地址等配送信息，还可获取位置信息与相册权限。</p>
<p>问：系统源码是否加密？能否进行二次开发？</p>
<p>答：源码未加密，有技术能力的商家可根据自身需求进行二次开发与功能拓展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全方位赋能小微企业：KK-CRM 客户关系管理软件详细介绍]]></title>    <link>https://juejin.cn/post/7582003642191151146</link>    <guid>https://juejin.cn/post/7582003642191151146</guid>    <pubDate>2025-12-10T08:45:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582003642191151146" data-draft-id="7581995152190160938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全方位赋能小微企业：KK-CRM 客户关系管理软件详细介绍"/> <meta itemprop="keywords" content="微信"/> <meta itemprop="datePublished" content="2025-12-10T08:45:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="微擎应用市场"/> <meta itemprop="url" content="https://juejin.cn/user/2253321372174896"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全方位赋能小微企业：KK-CRM 客户关系管理软件详细介绍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2253321372174896/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    微擎应用市场
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:45:10.000Z" title="Wed Dec 10 2025 08:45:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、概述总结</h2>
<p>KK-CRM 是一款专注于小微企业的客户关系管理软件，支持自由定制且功能全面。它以微擎系统在线交付的方式提供服务，适配 PHP7.1 至 PHP7.4 多种版本，具备官方正品保障。软件涵盖客户管理、合同管理、商机跟踪等核心业务模块，能帮助企业集中整合客户资源、优化销售流程、提升运营效率。</p>
<h2 data-id="heading-1">二、功能介绍</h2>
<h3 data-id="heading-2">（一）核心业务管理模块</h3>
<p>联系人管理：集中存储姓名、职务、联系方式等信息，支持快速添加、编辑与查找，同步记录沟通历史和相关活动。<br/>
客户管理：详细记录客户公司名称、行业、地址等信息，实时跟踪客户交易情况、历史活动及合作关系。<br/>
合同管理：支持合同创建、提醒设置与截止日期管理，可记录合同变更轨迹并上传相关文件，关联商机信息形成业务闭环。<br/>
商品与产品管理：双模块协同，既能维护产品目录（名称、规格、特性等），又能管理商品信息（描述、价格等），同步跟踪库存与销售数据。<br/>
商机管理：创建潜在销售机会，设置阶段与预测销售额，记录进展情况与关键活动，配套销售流程节点（需求分析、设计图制作、商业合同）及对应赢单率参考。<br/>
汇款管理：记录客户支付、汇款的日期、金额与方式，支持生成汇款报告并设置提醒功能。</p>
<h3 data-id="heading-3">（二）系统管理功能</h3>
<p>权限管理：管理员可对用户及角色进行精细化权限控制，设置读写、抄送（只读）、负责人等不同权限，限定数据查看范围（仅本人相关数据或全部数据）。<br/>
操作辅助功能：支持数据导入、导出、修改、锁定 / 解锁等操作，配备常用语库提升沟通效率，保留完整操作记录与附件管理功能，附件支持多种格式上传与预览下载。</p>
<h2 data-id="heading-4">三、适用场景与行业价值</h2>
<h3 data-id="heading-5">（一）适用场景</h3>
<p>小微企业内部客户资源管理，解决客户信息分散、查询不便的问题。<br/>
销售团队的商机跟踪与销售流程管控，适配从需求对接至合同签订的全流程。<br/>
企业合同、汇款等业务数据的集中管理，满足财务对账、业务复盘需求。<br/>
多部门协同工作场景，支持销售、财务、市场、库房等不同岗位按权限共享数据。</p>
<h3 data-id="heading-6">（二）行业价值</h3>
<p>提升客户管理效率：集中整合客户与联系人资源，减少信息查找成本，快速响应客户需求。<br/>
优化销售转化路径：通过商机阶段划分与赢单率跟踪，明确工作重点，提高销售成交概率。<br/>
强化数据安全管控：精细化权限设置避免敏感数据泄露，操作记录可追溯，保障业务合规。<br/>
降低运营管理成本：无需复杂配置，通过平台后台即可完成安装，适配小微企业轻量化运营需求，版本免费更新减少二次投入。</p>
<h2 data-id="heading-7">四、问答环节</h2>
<p>问：KK-CRM 的开发进度如何，是否可以先体验再购买？</p>
<p>答：目前各大模块已开发完成，产品已定型，可联系客服索取演示地址，查看满意后再下单。</p>
<p>问：该软件是否支持多开功能？</p>
<p>答：暂不支持多开，若后续需求人数较多，会根据实际情况考虑更新该功能。</p>
<p>问：除了 PC 端，是否有小程序、APP 等客户端的更新计划？</p>
<p>答：当前优先完善 PC 端功能，暂无其他客户端开发计划，若用户需求集中可后续开发小程序及 APP。</p>
<p>问：KK-CRM 的定位是什么，适合哪些企业使用？</p>
<p>答：定位为小公司内部使用的管理工具，可根据企业实际业务情况进行适当定制。</p>
<p>问：软件如何安装，安装后是否支持退款？答：与客服获取演示地址确认后下单，通过平台后台点击安装即可，无需额外配置；安装后不支持退款，建议谨慎消费。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[新视角家政系统：一站式上门服务数字化解决方案]]></title>    <link>https://juejin.cn/post/7581858890607706148</link>    <guid>https://juejin.cn/post/7581858890607706148</guid>    <pubDate>2025-12-10T08:46:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581858890607706148" data-draft-id="7581876069608751147" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="新视角家政系统：一站式上门服务数字化解决方案"/> <meta itemprop="keywords" content="微信"/> <meta itemprop="datePublished" content="2025-12-10T08:46:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="微擎应用市场"/> <meta itemprop="url" content="https://juejin.cn/user/2253321372174896"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            新视角家政系统：一站式上门服务数字化解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2253321372174896/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    微擎应用市场
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:46:06.000Z" title="Wed Dec 10 2025 08:46:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、概述总结</h2>
<p>新视角家政系统是山西新视角网络科技有限公司打造的垂直服务行业数字化平台，以 “互联网 + 技能服务” 为核心，适配微信小程序与公众号，覆盖上门保洁、养老护理、家电维修、陪诊等多元服务场景。系统融合智能派单、共享技师、抢单等多元模式，整合服务商、技师与用户资源，实现 “技能扶贫 + 技能变现 + 便民利民” 的核心目标，同时通过服务抽成、会员缴费、代理加盟等多元盈利点，助力行业实现流程化、规模化、品牌化发展。</p>
<h2 data-id="heading-1">二、功能介绍</h2>
<h3 data-id="heading-2">核心运营模式</h3>
<p>智能派单模式：用户下单后，系统按距离、技师等级自动匹配就近空闲服务商或技师，超时未接单可手动指派或自动取消。<br/>
共享技师模式：平台整合海量技能人才，商家可按需指派技师完成订单，赚取中间差价，降低用工成本。<br/>
一键抢单模式：用户订单进入抢单大厅，区域内服务商或技师可主动抢单，提升订单响应效率。<br/>
维修专属模式：支持拍照取证功能，服务前后需上传至少 3 张现场照片存档，保障服务质量与维权追溯。</p>
<h3 data-id="heading-3">全流程管理功能</h3>
<p>订单管理：覆盖待接单、待服务、服务中、待评价、售后维权全状态，支持定金支付、上门估价、尾款结算等灵活付款方式。<br/>
营销工具：包含拉新红包、拼团、优惠券、积分抵扣、会员折扣等功能，支持自定义营销活动与分销推广。<br/>
数据管理：商家端、技师端、代理端均配备数据看板，实时展示订单量、成交额、访客数等核心指标，助力运营决策。<br/>
权限与结算：分级管理用户、技师、商家、代理、社区合伙人权限，支持周结等灵活结算周期，自动完成抽成、返佣核算。</p>
<h3 data-id="heading-4">特色增值功能</h3>
<p>积分商城：用户可通过消费积累积分，兑换商品或抵扣服务费用，提升用户留存。技能培训对接：联动线下技能扶贫机构，为失业人群提供培训与持证上岗通道，丰富平台技师资源。<br/>
社区合伙人：支持社区推广模式，每个社区可单独设置返利规则，快速覆盖终端用户。<br/>
拍照取证：维修、保洁等服务可开启该功能，服务前后拍照存档，作为质量凭证与售后依据。</p>
<h2 data-id="heading-5">三、适用场景与行业价值</h2>
<h3 data-id="heading-6">适用场景</h3>
<p>服务场景：涵盖日常保洁、家电清洗维修、养老护理、陪诊、保姆中介、开锁修锁、上门按摩等各类上门服务。<br/>
角色场景：适配平台方、服务商、个体技师、代理加盟商、社区合伙人等多角色使用，满足不同运营需求。<br/>
地域场景：支持太原市、上海市等全国多城市布局，可聚焦社区服务场景，锁定区域内精准客户。</p>
<h3 data-id="heading-7">行业价值</h3>
<p>对平台方：降低推广与人力成本，通过多元盈利模式实现商业变现，依托技能扶贫政策获得发展背书。对服务商：解决用工短缺问题，淡季可承接平台订单，旺季可共享技师资源，降低订单流失率。<br/>
对技师：提供灵活就业渠道，通过平台接单增收，无需自主推广即可获得稳定客源。<br/>
对用户：实现一键下单、就近服务，服务质量有评价与售后保障，提升消费便捷度。<br/>
对行业：整合分散资源，建立标准化服务流程，推动行业从零散运营向品牌化、规模化转型。</p>
<h2 data-id="heading-8">四、常见问题问答</h2>
<p>新视角家政系统支持哪些终端使用？</p>
<p>答：支持微信小程序与微信公众号两种终端，用户可通过移动端便捷下单，服务商、技师可通过对应端口接单管理。</p>
<p>平台的抽成与返佣规则如何计算？</p>
<p>答：平台按服务分类抽取订单费用的一定比例（示例为 15%），代理可从平台抽成中获得 5% 返佣，社区合伙人再从代理返佣中分成；共享技师模式下，商家指派平台技师服务可抽取 3% 左右的中介提成。</p>
<p>订单支付与抵扣方式有哪些？</p>
<p>答：支持全额付款、定金 + 尾款、上门估价后付款等方式，可使用优惠券、红包、积分抵扣，部分服务支持会员折扣（折扣费用由商家或平台按协议承担）。</p>
<p>系统如何保障服务质量与售后维权？</p>
<p>答：服务过程可开启拍照取证功能，服务前后需上传照片存档；订单完成后用户可评价，售后服务期内可申请维权，超时未处理售后的技师将被扣除保证金。</p>
<p>服务商与技师入驻平台有门槛吗？</p>
<p>答：无强制门槛，服务商可直接入驻，技师可通过线下培训持证上岗，平台整合技能扶贫培训人群与自带资源的个体技师，实现无门槛入驻与灵活接单。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[掌盟网络答题游戏模块：微信公众号互动营销新选择]]></title>    <link>https://juejin.cn/post/7581995152190193706</link>    <guid>https://juejin.cn/post/7581995152190193706</guid>    <pubDate>2025-12-10T08:46:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581995152190193706" data-draft-id="7581876069608783915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="掌盟网络答题游戏模块：微信公众号互动营销新选择"/> <meta itemprop="keywords" content="微信"/> <meta itemprop="datePublished" content="2025-12-10T08:46:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="微擎应用市场"/> <meta itemprop="url" content="https://juejin.cn/user/2253321372174896"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            掌盟网络答题游戏模块：微信公众号互动营销新选择
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2253321372174896/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    微擎应用市场
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:46:35.000Z" title="Wed Dec 10 2025 08:46:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、概述总结</h2>
<p>掌盟网络答题游戏模块是一款适配微信公众号的互动营销应用，通过微擎系统在线交付，支持多活动、多类目独立题库搭建，涵盖单选、多选题型设置。用户可参与每日答题获取积分，还能通过推荐新玩家解锁额外积分奖励，同时搭配完善的活动管理、题库编辑、数据统计功能，助力公众号快速落地答题互动活动。</p>
<h2 data-id="heading-1">二、功能介绍</h2>
<h3 data-id="heading-2">核心活动配置</h3>
<p>支持创建多个独立活动，可自定义活动名称、起止时间、每日答题数量及单题限时（默认 60 秒）。<br/>
答题奖励灵活设置，包括答题正确赠积分、推荐新玩家赠积分，积分可对接积分商城等关联模块。<br/>
提供活动封面、分享图标、进入按钮等视觉素材自定义功能，支持指定尺寸上传（如封面 720*1100px）。</p>
<h3 data-id="heading-3">题库与答题管理</h3>
<p>支持单选、多选题型，多选题答案需按顺序用 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">#号隔开</a>（大写字母格式），便于系统统计正确率。<br/>
提供多种题目导入方式，包括文本导入、EXCEL 导入、单个新增，同时支持题目编辑、下架操作。<br/>
生成活动日志，记录参与次数、答题情况等数据，助力运营者跟踪活动效果。</p>
<h3 data-id="heading-4">配套管理工具</h3>
<p>后台可实现活动状态切换、排序调整，支持分享规则配置，提升活动传播性。<br/>
对接物流助手、充值提现等模块，可结合积分商城、实物奖品设置，完善用户兑换与发货流程。<br/>
支持获取用户微信昵称、头像等基础信息及位置信息、相册权限，丰富互动数据维度。</p>
<h3 data-id="heading-5">兼容与保障</h3>
<p>适配 PHP5.5 至 PHP7.4 多种版本，源码未加密，保障二次开发灵活性。<br/>
提供官方正品保障，搭配 1 年赠送服务套餐（新购用户），服务周期内免费更新至最新版本。</p>
<h2 data-id="heading-6">三、适用场景与行业价值</h2>
<h3 data-id="heading-7">适用场景</h3>
<p>微信公众号运营：用于粉丝活跃、留存，通过每日答题任务提升用户粘性。<br/>
品牌营销活动：结合产品知识、行业常识设计题库，实现品牌理念渗透与用户教育。<br/>
会员体系搭建：积分奖励可兑换实物、优惠券或权益，完善会员激励机制。<br/>
线下线上联动：搭配活动码、防伪溯源等模块，实现线下引流与线上互动闭环。</p>
<h3 data-id="heading-8">行业价值</h3>
<p>降低营销成本：无需复杂开发，通过现成模块快速落地互动活动，适配中小企业预算。<br/>
提升转化效率：以答题 + 积分的轻量化形式吸引用户参与，间接带动产品销售或服务转化。<br/>
沉淀用户数据：通过答题行为、用户信息收集，为精准营销提供数据支撑。<br/>
拓展运营边界：可与活动中心其他模块（如九宫格、砸金蛋、签到）组合，打造多元化互动体系。</p>
<h2 data-id="heading-9">四、常见问答</h2>
<p>该模块支持哪些公众号功能扩展？</p>
<p>答：可对接积分商城、充值提现、物流助手、防伪溯源等多个关联模块，同时兼容活动中心的九宫格、抽红包等其他互动游戏。</p>
<p>题库导入有哪些方式？是否支持批量操作？</p>
<p>答：支持文本导入、EXCEL 导入、单个新增三种方式，多选题答案需按 “A<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">#C</a><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">#E”</a> 格式填写，支持批量导入与批量编辑题目。</p>
<p>积分奖励的使用场景有哪些？</p>
<p>答：积分可用于兑换积分商城商品、实物奖品，也可结合推荐奖励机制，为推荐新玩家的用户发放额外积分，具体规则可在后台自定义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Gemini Cli+AI输入法+Obsidian搭工作流，太丝滑了！]]></title>    <link>https://juejin.cn/post/7581893894175571978</link>    <guid>https://juejin.cn/post/7581893894175571978</guid>    <pubDate>2025-12-10T08:52:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581893894175571978" data-draft-id="7582021506189574190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Gemini Cli+AI输入法+Obsidian搭工作流，太丝滑了！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-10T08:52:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Gemini Cli+AI输入法+Obsidian搭工作流，太丝滑了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:52:14.000Z" title="Wed Dec 10 2025 08:52:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 458 篇原创！</p>
<p>大家好，我是爱折腾 Obsidian 的苍何。</p>
<p>一个月前，我将自己的 Obsidian 工作流分享出来，收到了很多朋友的喜欢。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b0742fb528049b9ab6a0435d416cac1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=ybl3nQZ0yJUHNk4psYwcyKVTmcw%3D" alt="图片" loading="lazy"/></p>
<p>并因此受到 WPS 邀请去珠海分享了一波 AI 时代的知识管理及 Vibe Coding 实践。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5bafbb5b8224e6596d2ac42001b5004~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=iNZoW1aficYYf5g%2FdyNHUeqb0yU%3D" alt="图片" loading="lazy"/></p>
<p>这一段时间，我又对我的 Obsidian 工作流做了不少的迭代，加了不少的插件，做了不少模板。</p>
<p>同时也在一些流程节点思考用当下比较🔥的 AI 输入法来融入，并定了一个狠目标：能用嘴喷的地方就不用手。</p>
<p>折腾了一段时间，觉得是时候拿出来和大家做分享了。</p>
<p>先看看我如何结合 Gemini Cli+AI输入法+Obsidian 来搭工作流，一张🍌制作的信息图先看看。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84538b8549ef483a9ac100b98d013fe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=8KR3XfHHJiZo%2BgH52ImYx4usF8o%3D" alt="图片" loading="lazy"/></p>
<p>先来看一个 Obsidian 中写作类场景：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9176ec5dd7c4e6cb2078c3ee1c511be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=BY%2BTnFaCZbWkD3hvYVHigcX7CJY%3D" alt="wxv_4290155488010223617" loading="lazy"/></p>
<p>再看一个  Obsidian 文件管理和文件格式转换的常用场景：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e6e95e8e694ee590a393eb7def1a40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=YVqjwUMg1PKSkFUH6c0nuJdQVNQ%3D" alt="wxv_4290156633843302400" loading="lazy"/></p>
<p>当然，远远不止这些，这次一共包含以下几种节点场景优化：</p>
<pre><code class="hljs">1、用嘴在Obsidian中启动Gemini Cli
2、查看当前文件夹磁盘占用，并显示所有Python相关的进程
3、看下当前文件夹有多少张图片，并做图片格式转换
4、视频格式转GIF，且控制大小
5、Obsidian写作：从爆款标题到文案创作到局部优化改写一整套工作流
7、编程做插件开发场景
8、评论区回复
9、懒人计算器
</code></pre>
<p>接下来会依次介绍下各个节点的实践，会配有视频演示和我的理解。</p>
<blockquote>
<p>文章很干，建议点赞收藏并转发给需要的朋友，节点中的每个提示词和 AI 输入法人设如果需要的话也可评论留言告诉我。</p>
</blockquote>
<h2 data-id="heading-0">工具选择</h2>
<p>Obsidian 和 Gemini Cli 不用说了，已经是知识管理和内容创作必备的工具了，还不了解的朋友可以翻一翻苍何之前的文章。</p>
<p>AI 输入法上，我做了不少的调研和测试，发现世面上目前主要有 2 类 AI 输入法，一类是基于大模型能力做的实时翻译，这类主打的是一个低延迟和本地化数据隐私。</p>
<p>但功能层面比较单一，没有过多的 AI Agent 操作，复杂场景下无法满足。</p>
<p>另一类就是就是功能更丰富的 AI 输入法产品，能应对复杂场景，做更多的 Agent 操作。</p>
<p>经对比最终选择的是智谱 AI 输入法小凹。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16b4033a1722472792bb13f861889d2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=Soe8FxJ%2BfIomR%2FBW7MNaP0VI%2BxI%3D" alt="图片" loading="lazy"/></p>
<p><strong>在识别度、复杂场景下的优势比较明显，最关键的是可以按照不同的场景定制风格输出</strong>，这就很满足我迭代的需求。</p>
<p>Mac 和 Windows 版本都支持，下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fautoglm.zhipuai.cn%2Fautotyper" target="_blank" title="https://autoglm.zhipuai.cn/autotyper" ref="nofollow noopener noreferrer">autoglm.zhipuai.cn/autotyper</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5da6d8839edc48c1b9405c5d3a3e116c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=dl%2FBQjW%2FQl%2BVoNAl%2FcDjxuX2m1Y%3D" alt="图片" loading="lazy"/></p>
<blockquote>
<p>记得用我的邀请码：R8J5QAD2（注册咱俩都可获得积分哈哈哈）</p>
</blockquote>
<p>进入后就可以设定词典和人设，满足不同场景的需求。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28889581cc2e4602ac36748c161e9726~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=9qAitSMk7xfD3u8mxYfjcFg7ZEM%3D" alt="图片" loading="lazy"/></p>
<p>你甚至没法想象，我只用了 16 分钟就输出 2.1 万词，而这还只是我用来此次创作的小号。不得不说，AI 输入法真实提效啊。</p>
<p>你可以看到我设定了很多的风格来满足我工作流中不同节点的需求。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b38b5e8271c49e5b97863191ac6fe38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=%2BM2BSefPJArFEilelAanBUfkc00%3D" alt="图片" loading="lazy"/></p>
<p>工具就说到这，直接来看工作流吧。</p>
<h2 data-id="heading-1">用嘴启动Gemini Cli</h2>
<p>传统方式是要在 Obsidian 终端手打敲击命令：gemini。</p>
<p>这个单词有时候还容易打错，每次启动，其实还蛮费劲。</p>
<p>现在，只需按住 fn，直接说：帮我启动 gemini。智谱 AI 输入法小凹（以下简称小凹）就能自动执行预设指令。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95132bc2916f497b9bcf862fa29dd8de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=S3Yha%2BejaFEHm8IUcc%2FRdrEWfAM%3D" alt="wxv_4290158558811176963" loading="lazy"/></p>
<p>就很丝滑。</p>
<h2 data-id="heading-2">终端监控</h2>
<p>打开 Gemini Cli，习惯做的事是看下当前仓库占用情况，以及当前进程。以前还需要先去查下命令，或者让 Gemini Cli 自主查找执行命令。多了一步。</p>
<p>现在，只需要对着小凹说：</p>
<blockquote>
<p>查看当前文件夹磁盘占用，并显示所有Python相关的进程</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57810b35f5864b8b85d6c1086fec37d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=HTuPdlEatCmsfRKFGaMZbBpcihI%3D" alt="wxv_4290157937164910592" loading="lazy"/></p>
<p>可以看到，小凹自动去查找相关命令并给出了指令，而且速度非常快。</p>
<h2 data-id="heading-3">文件管理</h2>
<p>在 Obsidian 中可以存放不同文件格式的文件，一多就变得很麻烦，查找整理非常花时间。</p>
<p>现在只需要 AI 输入法配合 Gemini Cli 就能很快配合解决。</p>
<p>AI 输入法负责接收语音输入，并转为可执行的指令给到 Gemini Cli 自动执行。</p>
<p>比如这个需求就可以直接对小凹说</p>
<blockquote>
<p>看下当前文件夹有多少张图片，并做图片格式转换</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380d6016f5004811ab17ebdbb211a098~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=vcZzR6l3yKuy6v7M9cKvs83p%2FfU%3D" alt="wxv_4290157218697052161" loading="lazy"/></p>
<p>特别对于公众号创作来说，有时候需要将视频转为 GIF，但图片又不能过大（最大 10 M），原先过程非常繁琐，先要去格式转换的地方先转换，再去压缩。</p>
<p>现在通通不用，直接说：</p>
<blockquote>
<p>将demo.mp4视频转成GIF格式的,只要前3s,且大小控制在10m以内</p>
</blockquote>
<p>小凹直接给到完整的 FFmpeg 命令给到 Gemini Cli 精准执行，完成需求。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71d4f3aa5b0444848359054bb2935e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=M3woEJzz2b7XjNo76%2BvcL%2BZJT9o%3D" alt="wxv_4290156633843302400" loading="lazy"/></p>
<h2 data-id="heading-4">Obsidian 写作</h2>
<p>无论是记笔记还是内容创作，在 Obsidian 中都是常见场景。</p>
<p>拿公众号写作来说，从标题到文章都可以借助该工作流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b00a03698e54f408d9903dd1be27bf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=Bw35gb6%2FcZZUyhZaTIGtdkJcATk%3D" alt="wxv_4290155488010223617" loading="lazy"/></p>
<p>特别是对句子进行局部优化调整以及内容格式（比如转图表）、风格化输出非常有用。</p>
<p>这里其实还有蛮多的场景可以发挥的，不过受限于当前限制，对于公众号创作，还无法接入图片，现在还不支持类似工具调用能力。</p>
<p>要是以后支持，别提能有多强，我随时跟进者，看看啥时候能支持，到时候给大家汇报。</p>
<h2 data-id="heading-5">转小红书文案</h2>
<p>这个其实我还特意开发过一款插件，现在我用新的工作流来做了尝试，只需要说：</p>
<blockquote>
<p>转成小红书文案</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f8955e9a3b04621a60b5af7af3b7c47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=KtEMN%2BqMLKItroYd%2F2bzscHH9X4%3D" alt="wxv_4290154979375185921" loading="lazy"/></p>
<p>但目前的转换，并不能全文做转换，估计是受限于整个的输入长度限制吧。</p>
<h2 data-id="heading-6">编程做插件开发场景</h2>
<p>之前分享过在 Obsidian 中配合 Gemini Cli 做插件开发，非常舒服。</p>
<p>现在有了 AI 输入法，变得更丝滑了，一些原本需要手动敲击命令的场景也直接口喷就好了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ad322f009f04dedbb9c0d1d9cc82858~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=0yzyXw2BbYUBIZUgrujF6wSyc6c%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-7">评论区回复</h2>
<p>我有很大一部分时间是用来回复粉丝留言，但经常时间不够用，手动敲击又太慢，导致回复不及时，等过去了好几天，又都没回复。</p>
<p>我一度感到很痛苦。</p>
<p>所以让I输入法来帮我做一些回复，我觉得挺棒的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7685665e84846b28d86d7aa95a8f869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=vJeEYobBK9icJK9lHRvjvkW2OM4%3D" alt="wxv_4290154355145523203" loading="lazy"/></p>
<h2 data-id="heading-8">计算器</h2>
<p>对于一些简单的计算场景，脑子又算不明白，然后每次要吭哧吭哧打开计算器，比较麻烦。</p>
<p>现在只需要说一声，计算结果就出来，随用随丢。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbf063170a1e4c0bab122ab4707efbc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=RV5hdQ7dZbbm03570d6%2BUSfL9Mo%3D" alt="wxv_4290153869042466817" loading="lazy"/></p>
<p>非常方便和丝滑。</p>
<p>智谱AI输入法很好用，我看他们也发布并开源了GLM-ASR系列语音识别模型，而智谱AI输入法就是基于该模型打造的。</p>
<p>官号上截一张开源的 GLM-ASR-Nano-2512模型，可以看到 1.5B 参数的端侧模型，却取得了当前开源语音识别方向的SOTA表现👍🏻，这下好了，可以预见将会有更多基于此的AI应用出来了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c962df8f44e04c4b8100ebb7b6f06e50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765961534&amp;x-signature=GKVqRwUH%2F2SyUJpxTvO2PDUdn8I%3D" alt="图片" loading="lazy"/></p>
<p>说实话，折腾了这么多工具。</p>
<p>我发现最极致的效率，往往是返璞归真。</p>
<p>没有复杂的鼠标点击，没有繁琐的窗口切换。</p>
<p>只有一个想法，一句耳语，一个结果。</p>
<p>即使在这个 AI 狂奔的时代。</p>
<p><strong>最珍贵的，依然是你脑海中那一闪而过的火花。</strong></p>
<p>只要那朵火花还在。</p>
<p>我们就永远年轻，永远热泪盈眶。</p>
<p>这一次，换个姿势。</p>
<p>重新定义你的工作流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端高频面试题：为什么 sessionStorage 在不同 Tab 页不共享？]]></title>    <link>https://juejin.cn/post/7581893894175637514</link>    <guid>https://juejin.cn/post/7581893894175637514</guid>    <pubDate>2025-12-10T08:58:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581893894175637514" data-draft-id="7582048028392013874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端高频面试题：为什么 sessionStorage 在不同 Tab 页不共享？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T08:58:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端高频面试题：为什么 sessionStorage 在不同 Tab 页不共享？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T08:58:38.000Z" title="Wed Dec 10 2025 08:58:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一个非常经典的前端面试题，也是实际开发中容易产生误解的地方。</p>
<p>简单直接的回答是：<strong>这是由 W3C 标准明确设计的。<code>sessionStorage</code> 的设计初衷就是为了“隔离”，而不是“共享”。</strong></p>
<p>以下是详细的深度解析，帮助你彻底理解其中的逻辑：</p>
<h3 data-id="heading-0">1. 核心定义：什么是“Session”？</h3>
<p>在 <code>sessionStorage</code> 的语境下，“Session（会话）”的定义范围被<strong>严格限制在当前标签页（Tab）或当前窗口（Window）中</strong>。</p>
<ul>
<li><strong>LocalStorage 的范围：</strong> 同源（Same Origin） + 浏览器实例。只要域名一样，所有 Tab 共享数据。</li>
<li><strong>SessionStorage 的范围：</strong> 同源 + <strong>顶级浏览上下文（Top-level Browsing Context）</strong> 。即：<strong>一个 Tab 就是一个独立的 Session</strong>。</li>
</ul>
<h3 data-id="heading-1">2. 设计目的：为了“多窗口并行操作”</h3>
<p>你可能会觉得不共享很麻烦，但这种设计其实是为了解决一个痛点：<strong>防止多窗口之间的数据干扰。</strong></p>
<p>举个场景例子：</p>
<p>假设你在一个订票网站上，同时打开了两个 Tab：</p>
<ul>
<li><strong>Tab A：</strong> 正在帮<strong>张三</strong>买去<strong>北京</strong>的票。</li>
<li><strong>Tab B：</strong> 正在帮<strong>李四</strong>买去<strong>上海</strong>的票。</li>
</ul>
<p>如果 <code>sessionStorage</code> 是跨 Tab 共享的：</p>
<ol>
<li>你在 Tab A 选择了“北京”，存入 Storage。</li>
<li>你在 Tab B 选择了“上海”，数据被覆盖了。</li>
<li>回到 Tab A 点击提交，结果系统读取的是最新的“上海”，导致张三买错票。</li>
</ol>
<p>因为有了 sessionStorage 的隔离特性：</p>
<p>Tab A 和 Tab B 拥有完全独立的存储空间，互不干扰。这使得用户可以在同一个网站上同时进行多个独立的业务流程，而不用担心状态串台。</p>
<h3 data-id="heading-2">3. 一个特殊的例外：复制标签页</h3>
<p>虽然不同 Tab 不共享，但有一个特殊情况需要注意：</p>
<p>如果你通过 <strong>“右键 -&gt; 复制标签页”</strong> 或者在脚本中使用 <code>window.open()</code> 打开同源页面：</p>
<ul>
<li><strong>新 Tab 会“拷贝”旧 Tab 的 sessionStorage 数据。</strong></li>
<li><strong>但是！</strong> 这仅仅是<strong>拷贝（Copy）</strong> ，不是<strong>同步（Sync）</strong> 。</li>
<li>复制完成后，两个 Tab 的数据就断开了联系。你在新 Tab 修改数据，旧 Tab 不会变；反之亦然。</li>
</ul>
<h3 data-id="heading-3">4. 如果我一定要跨 Tab 共享数据怎么办？</h3>
<p>如果你现在的业务场景确实需要不同 Tab 之间同步数据（比如：在一个 Tab 登录，其他 Tab 自动更新登录状态），你应该使用以下方案替代 <code>sessionStorage</code>：</p>
<p>方案 A：LocalStorage + storage 事件</p>
<p>这是最常用的方案。localStorage 是跨 Tab 共享的。你可以监听 storage 事件来感知其他 Tab 的修改。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Tab A 修改数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'token'</span>, <span class="hljs-string">'12345'</span>);

<span class="hljs-comment">// Tab B 监听变化</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">key</span> === <span class="hljs-string">'token'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'其他 Tab 修改了 Token，我也要更新状态！'</span>);
  }
});
</code></pre>
<p>方案 B：Broadcast Channel API</p>
<p>这是一个更现代、更优雅的 API，专门用于同源下的跨上下文通信（Tab、Iframe、Worker）。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// Tab A</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'app_channel'</span>);
channel.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'Hello Tab B'</span>);

<span class="hljs-comment">// Tab B</span>
<span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastChannel</span>(<span class="hljs-string">'app_channel'</span>);
channel.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg.<span class="hljs-property">data</span>); <span class="hljs-comment">// 收到 'Hello Tab B'</span>
};
</code></pre>
<p>方案 C：SharedWorker</p>
<p>使用 SharedWorker 创建一个可以在多个 Tab 间共享的后台线程，通过它来中转数据（比较重，不常用）。</p>
<h3 data-id="heading-4">总结</h3>
<ul>
<li><strong><code>sessionStorage</code> 不共享</strong>：是因为它的设计目的就是为了让不同 Tab 拥有<strong>独立的运行环境</strong>，防止数据冲突。</li>
<li><strong><code>localStorage</code> 共享</strong>：是因为它的设计目的是为了<strong>持久化存储</strong>整个网站的数据。</li>
</ul>
<p>理解了这个设计哲学，你就知道在什么场景该选什么存储方案了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝黑产与老赖：Java后端如何接入天远个人风险报告API（COMBTY11）]]></title>    <link>https://juejin.cn/post/7581789701532319786</link>    <guid>https://juejin.cn/post/7581789701532319786</guid>    <pubDate>2025-12-10T06:59:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581789701532319786" data-draft-id="7581751726506573867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝黑产与老赖：Java后端如何接入天远个人风险报告API（COMBTY11）"/> <meta itemprop="keywords" content="API,大数据"/> <meta itemprop="datePublished" content="2025-12-10T06:59:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天远API"/> <meta itemprop="url" content="https://juejin.cn/user/195070305779163"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝黑产与老赖：Java后端如何接入天远个人风险报告API（COMBTY11）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/195070305779163/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天远API
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:59:00.000Z" title="Wed Dec 10 2025 06:59:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 打造金融级的数据风控中台</h2>
<p>在信贷审批、保险核保、大额资产租赁以及企业高管背景审查等严谨的业务场景中，单一的数据源往往难以描绘出完整的用户风险画像。企业需要从信用历史、反欺诈评分、司法诉讼记录以及社会安防等多个维度进行交叉验证。<strong>天远个人风险报告API</strong>（接口代码 <code>COMBTY11</code>）正是为此类高净值、高风险场景设计的核心数据产品。</p>
<p>该产品不仅提供了基础的身份核验，更通过AI模型输出了“谛听多维报告”与深度的“司法涉诉”详情。本文将面向Java后端工程师，特别是使用Spring Boot构建微服务架构的开发者，详细阐述如何将此API封装为标准化的RPC服务，解析其复杂的组合包结构，助力企业构建稳健的自动化风控决策引擎。</p>
<h2 data-id="heading-1">二、 API接口调用示例（Java版）</h2>
<p>本接口涉及敏感数据的传输，采用了严格的加密与授权机制，非常适合在Java后端通过 <code>OkHttp</code> 或 <code>RestTemplate</code> 进行安全调用。</p>
<h3 data-id="heading-2">1. 接口配置概览</h3>
<ul>
<li/>
</ul>
<pre><code class="hljs language-ini" lang="ini">**接口地址**：`https://api.tianyuanapi.com/api/v1/COMBTY11?<span class="hljs-attr">t</span>=<span class="hljs-number">13</span>位时间戳` 
</code></pre>
<ul>
<li/>
</ul>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-strong">**请求方式**</span>：POST
</code></pre>
<ul>
<li/>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">**核心安全**：业务参数需序列化为<span class="hljs-title class_">JSON</span>，加密后转<span class="hljs-title class_">Base64</span>，放入 <span class="hljs-string">`data`</span> 字段。请求中必须包含用户的授权书<span class="hljs-variable constant_">URL</span>。
</code></pre>
<h3 data-id="heading-3">2. Curl 命令行预验证</h3>
<p>Bash</p>
<pre><code class="hljs language-jsx" lang="jsx">curl -X <span class="hljs-variable constant_">POST</span> <span class="hljs-string">"https://api.tianyuanapi.com/api/v1/COMBTY11?t=1715068800000"</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-d <span class="hljs-string">'{
    "data": "eyJpZF9jYXJkIjoiMTEwMTAxMTk5MDAxMDEwMTIzIiwibmFtZSI6IuW8oOSBgSIsIm1vYmlsZV9ubyI6IjEzODAwMTM4MDAwIiwiYXV0aG9yaXphdGlvbl91cmwiOiJodHRwczovL29zcy5leGFtcGxlLmNvbS9hdXRoLmpwZyIsImF1dGhfZGF0ZSI6IjIwMjMwMTAxLTIwMjMxMjMxIn0="
}'</span>
</code></pre>
<h3 data-id="heading-4">3. Java 完整服务封装示例</h3>
<p>以下代码展示了如何在Spring Boot风格的项目中，封装一个强类型的 <code>RiskControlService</code>。本示例使用 <code>OkHttp3</code> 处理网络请求，<code>Fastjson2</code> 处理JSON。</p>
<p>Java</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> okhttp3.*;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">fastjson2</span>.<span class="hljs-property">JSON</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">fastjson2</span>.<span class="hljs-property">JSONObject</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">alibaba</span>.<span class="hljs-property">fastjson2</span>.<span class="hljs-property">JSONArray</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">io</span>.<span class="hljs-property">IOException</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Base64</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">TimeUnit</span>;

<span class="hljs-comment">/**
 * 天远API - 个人风险报告服务实现
 */</span>
public <span class="hljs-keyword">class</span> <span class="hljs-title class_">RiskControlService</span> {

    <span class="hljs-comment">// API 基础配置</span>
    private <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">API_URL</span> = <span class="hljs-string">"https://api.tianyuanapi.com/api/v1/COMBTY11"</span>;
    private <span class="hljs-keyword">static</span> final <span class="hljs-title class_">OkHttpClient</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.<span class="hljs-title class_">Builder</span>()
            .<span class="hljs-title function_">connectTimeout</span>(<span class="hljs-number">20</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>) <span class="hljs-comment">// 报告生成可能耗时，建议适当延长时间</span>
            .<span class="hljs-title function_">readTimeout</span>(<span class="hljs-number">20</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">SECONDS</span>)
            .<span class="hljs-title function_">build</span>();

    <span class="hljs-comment">/**
     * 模拟加密逻辑
     * 实际生产中请使用天远API提供的AES/RSA工具类
     */</span>
    private <span class="hljs-title class_">String</span> <span class="hljs-title function_">encryptPayload</span>(<span class="hljs-params">JSONObject params</span>) {
        <span class="hljs-title class_">String</span> jsonString = params.<span class="hljs-title function_">toJSONString</span>();
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 在此处实现AES加密：byte[] encrypted = AesUtil.encrypt(jsonString, SECRET_KEY);</span>
        <span class="hljs-comment">// 此处仅演示Base64编码</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Base64</span>.<span class="hljs-title function_">getEncoder</span>().<span class="hljs-title function_">encodeToString</span>(jsonString.<span class="hljs-title function_">getBytes</span>());
    }

    <span class="hljs-comment">/**
     * 获取个人风险报告
     *
     * <span class="hljs-doctag">@param</span> name 姓名
     * <span class="hljs-doctag">@param</span> idCard 身份证号
     * <span class="hljs-doctag">@param</span> mobile 手机号
     * <span class="hljs-doctag">@param</span> authUrl 授权书图片/PDF链接
     * <span class="hljs-doctag">@param</span> authDate 授权周期 "YYYYMMDD-YYYYMMDD"
     * <span class="hljs-doctag">@return</span> JSONObject 解析后的核心风险数据
     */</span>
    public <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> <span class="hljs-title function_">queryPersonalRisk</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name, <span class="hljs-built_in">String</span> idCard, <span class="hljs-built_in">String</span> mobile, <span class="hljs-built_in">String</span> authUrl, <span class="hljs-built_in">String</span> authDate</span>) {
        <span class="hljs-comment">// 1. 组装业务参数</span>
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> bizParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        bizParams.<span class="hljs-title function_">put</span>(<span class="hljs-string">"name"</span>, name);
        bizParams.<span class="hljs-title function_">put</span>(<span class="hljs-string">"id_card"</span>, idCard);
        bizParams.<span class="hljs-title function_">put</span>(<span class="hljs-string">"mobile_no"</span>, mobile);
        bizParams.<span class="hljs-title function_">put</span>(<span class="hljs-string">"authorization_url"</span>, authUrl); <span class="hljs-comment">// 必填 </span>
        bizParams.<span class="hljs-title function_">put</span>(<span class="hljs-string">"auth_date"</span>, authDate);        <span class="hljs-comment">// 必填 // 2. 加密请求体</span>
        <span class="hljs-title class_">String</span> encryptedData = <span class="hljs-title function_">encryptPayload</span>(bizParams);
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        requestBody.<span class="hljs-title function_">put</span>(<span class="hljs-string">"data"</span>, encryptedData);

        <span class="hljs-comment">// 3. 构建Request</span>
        long timestamp = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>();
        <span class="hljs-title class_">String</span> finalUrl = <span class="hljs-variable constant_">API_URL</span> + <span class="hljs-string">"?t="</span> + timestamp;
        
        <span class="hljs-title class_">RequestBody</span> body = <span class="hljs-title class_">RequestBody</span>.<span class="hljs-title function_">create</span>(
                requestBody.<span class="hljs-title function_">toJSONString</span>(), 
                <span class="hljs-title class_">MediaType</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">"application/json; charset=utf-8"</span>)
        );

        <span class="hljs-title class_">Request</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.<span class="hljs-title class_">Builder</span>().<span class="hljs-title function_">url</span>(finalUrl).<span class="hljs-title function_">post</span>(body).<span class="hljs-title function_">build</span>();

        <span class="hljs-comment">// 4. 执行调用与解析</span>
        <span class="hljs-keyword">try</span> (<span class="hljs-title class_">Response</span> response = client.<span class="hljs-title function_">newCall</span>(request).<span class="hljs-title function_">execute</span>()) {
            <span class="hljs-keyword">if</span> (response.<span class="hljs-title function_">isSuccessful</span>() &amp;&amp; response.<span class="hljs-title function_">body</span>() != <span class="hljs-literal">null</span>) {
                <span class="hljs-title class_">String</span> respStr = response.<span class="hljs-title function_">body</span>().<span class="hljs-title function_">string</span>();
                <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> result = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parseObject</span>(respStr);
                
                <span class="hljs-comment">// 校验组合包响应</span>
                <span class="hljs-keyword">if</span> (result.<span class="hljs-title function_">containsKey</span>(<span class="hljs-string">"responses"</span>)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">parseRiskData</span>(result.<span class="hljs-title function_">getJSONArray</span>(<span class="hljs-string">"responses"</span>));
                }
            }
            <span class="hljs-comment">// 记录错误日志</span>
            <span class="hljs-title class_">System</span>.<span class="hljs-property">err</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"API Request Failed: "</span> + response.<span class="hljs-title function_">code</span>());
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">IOException</span> e) {
            e.<span class="hljs-title function_">printStackTrace</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">/**
     * 解析组合包中的核心风险指标
     */</span>
    private <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> <span class="hljs-title function_">parseRiskData</span>(<span class="hljs-params">JSONArray responses</span>) {
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> riskSummary = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>();
        
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; responses.<span class="hljs-title function_">size</span>(); i++) {
            <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> item = responses.<span class="hljs-title function_">getJSONObject</span>(i);
            <span class="hljs-title class_">String</span> apiCode = item.<span class="hljs-title function_">getString</span>(<span class="hljs-string">"api_code"</span>);
            boolean success = item.<span class="hljs-title function_">getBooleanValue</span>(<span class="hljs-string">"success"</span>);
            <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> data = item.<span class="hljs-title function_">getJSONObject</span>(<span class="hljs-string">"data"</span>);

            <span class="hljs-keyword">if</span> (!success || data == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 根据子产品代码提取关键信息</span>
            <span class="hljs-keyword">switch</span> (apiCode) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"DWBG8B4D"</span>: <span class="hljs-comment">// 谛听多维报告 </span>
                    riskSummary.<span class="hljs-title function_">put</span>(<span class="hljs-string">"fraudScore"</span>, data.<span class="hljs-title function_">getIntValue</span>(<span class="hljs-string">"fraudScore"</span>)); <span class="hljs-comment">// 反欺诈分 </span>
                    riskSummary.<span class="hljs-title function_">put</span>(<span class="hljs-string">"creditScore"</span>, data.<span class="hljs-title function_">getIntValue</span>(<span class="hljs-string">"creditScore"</span>)); <span class="hljs-comment">// 信用分 </span>
                    riskSummary.<span class="hljs-title function_">put</span>(<span class="hljs-string">"riskWarning"</span>, data.<span class="hljs-title function_">getJSONObject</span>(<span class="hljs-string">"riskWarning"</span>)); <span class="hljs-comment">// 风险标签 break;</span>
                <span class="hljs-keyword">case</span> <span class="hljs-string">"FLXG0V4B"</span>: <span class="hljs-comment">// 个人司法涉诉 // 提取失信被执行人列表</span>
                    <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> sxbzxr = data.<span class="hljs-title function_">getJSONObject</span>(<span class="hljs-string">"sxbzxr"</span>);
                    <span class="hljs-keyword">if</span> (sxbzxr != <span class="hljs-literal">null</span> &amp;&amp; sxbzxr.<span class="hljs-title function_">containsKey</span>(<span class="hljs-string">"data"</span>)) {
                         riskSummary.<span class="hljs-title function_">put</span>(<span class="hljs-string">"dishonestList"</span>, sxbzxr.<span class="hljs-title function_">getJSONObject</span>(<span class="hljs-string">"data"</span>).<span class="hljs-title function_">getJSONArray</span>(<span class="hljs-string">"sxbzxr"</span>));
                    }
                    <span class="hljs-keyword">break</span>;
            }
        }
        <span class="hljs-keyword">return</span> riskSummary;
    }
    
    <span class="hljs-comment">// Test Main</span>
    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">RiskControlService</span> service = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RiskControlService</span>();
        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> report = service.<span class="hljs-title function_">queryPersonalRisk</span>(
            <span class="hljs-string">"张三"</span>, <span class="hljs-string">"110101199001011234"</span>, <span class="hljs-string">"13900000000"</span>, 
            <span class="hljs-string">"http://oss.url/auth.pdf"</span>, <span class="hljs-string">"20230101-20240101"</span>
        );
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"风险报告摘要: "</span> + report);
    }
}
</code></pre>
<h2 data-id="heading-5">三、 核心数据结构解析</h2>
<p><strong>天远API</strong> 的个人风险报告采用“组合模式”设计，这要求Java开发者建立合理的对象模型来接收数据。</p>
<p><strong>数据层级架构：</strong></p>
<ol>
<li><strong>Response Wrapper</strong>: 最外层包含 <code>responses</code> 列表。</li>
<li><strong>Sub-Product Item</strong>: 每个子项包含 <code>api_code</code> 和 <code>data</code>。
<ul>
<li><strong>DWBG8B4D (谛听多维报告)</strong>：核心风控数据源，包含评分、标签和借贷统计。</li>
<li><strong>FLXG0V4B (个人司法涉诉)</strong>：详细法律文书数据源，包含民刑行案件及失信记录。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-6">四、 字段详解</h2>
<p>为了方便Java开发者定义DTO（Data Transfer Object），以下列出需要重点关注的核心字段及其业务含义。</p>
<h3 data-id="heading-7">1. 评分与综合建议 (DWBG8B4D)</h3>
<p>此模块适合映射为 <code>RiskScoreDTO</code>。</p>



































<table><thead><tr><th><strong>字段名</strong></th><th><strong>Java类型</strong></th><th><strong>含义</strong></th><th><strong>业务逻辑说明</strong></th></tr></thead><tbody><tr><td><code>fraudScore</code></td><td><code>Integer</code></td><td>反欺诈评分</td><td>[0,100]，<strong>&gt;80</strong> 为高风险，建议直接拦截。</td></tr><tr><td><code>creditScore</code></td><td><code>Integer</code></td><td>信用评分</td><td>[300,1000]，<strong>&lt;500</strong> 为信用一般，需人工复审。</td></tr><tr><td><code>checkSuggest</code></td><td><code>String</code></td><td>审核建议</td><td>枚举值如 "建议拒绝"、"建议复审"。</td></tr><tr><td><code>fraudRule</code></td><td><code>String</code></td><td>反欺诈规则等级</td><td>枚举值：低风险、中风险、高风险。</td></tr></tbody></table>
<h3 data-id="heading-8">2. 风险预警标签 (DWBG8B4D -&gt; riskWarning)</h3>
<p>此模块包含大量布尔型（0/1）标记，是风控引擎的决策依据。</p>



































<table><thead><tr><th><strong>字段名</strong></th><th><strong>Java类型</strong></th><th><strong>含义</strong></th><th><strong>风险等级</strong></th></tr></thead><tbody><tr><td><code>isKeyPerson</code></td><td><code>Integer</code></td><td>是否重点人员</td><td>高风险 (涉恐/涉稳/涉黑)</td></tr><tr><td><code>hasCriminalRecord</code></td><td><code>Integer</code></td><td>是否有前科</td><td>高风险</td></tr><tr><td><code>hitExecutionCase</code></td><td><code>Integer</code></td><td>命中执行案件</td><td>高风险 (存在未履行的法院判决)</td></tr><tr><td><code>hitCurrentOverdue</code></td><td><code>Integer</code></td><td>命中当前逾期</td><td>中风险 (当前有未结清贷款)</td></tr></tbody></table>
<h3 data-id="heading-9">3. 司法与失信记录 (FLXG0V4B)</h3>
<p>数据结构较深，建议使用 <code>JSONObject</code> 或特定 <code>JudicialDTO</code> 处理。</p>





























<table><thead><tr><th><strong>字段名</strong></th><th><strong>Java类型</strong></th><th><strong>含义</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>sxbzxr</code></td><td><code>List</code></td><td>失信被执行人</td><td>即“老赖”名单，包含 <code>lxqk</code>(履行情况)。</td></tr><tr><td><code>xgbzxr</code></td><td><code>List</code></td><td>限高被执行人</td><td>限制高消费记录。</td></tr><tr><td><code>criminal</code></td><td><code>Object</code></td><td>刑事案件详情</td><td>包含 <code>dzzm</code>(定罪罪名) 如“开设赌场罪”。</td></tr></tbody></table>
<h2 data-id="heading-10">五、 应用价值分析</h2>
<p>将<strong>天远API</strong>集成到Java企业级系统中，可以显著提升以下场景的业务效能：</p>
<ol>
<li>
<p>智能信贷审批引擎</p>
<p>在Spring Batch批处理或实时审批流中，通过调用API获取 fraudScore 和 riskWarning。系统可配置规则引擎（如Drools）：若 fraudScore &gt; 80 或 isKeyPerson == 1，则自动触发 REJECT 动作，无需人工干预，将欺诈风险拦截在放款之前。</p>
</li>
<li>
<p>供应链金融准入</p>
<p>对于申请融资的小微企业主或个体户，利用 overdueRiskProduct（逾期风险）和 leasingRiskAssessment（租赁风险）数据 ，评估其多头借贷压力。如果发现申请人近期在多家租赁机构频繁申请（veryFrequentRentalApplications == 1），系统应提示可能存在骗租或资金链断裂风险。</p>
</li>
<li>
<p>高管与关键岗位背调</p>
<p>在HR系统中集成该接口，针对财务总监、司机等关键岗位进行背景扫描。重点关注 FLXG0V4B 返回的司法数据，排查是否存在“职务侵占”、“危险驾驶”等刑事前科，保障企业合规用人。</p>
</li>
</ol>
<h2 data-id="heading-11">六、 总结</h2>
<p><strong>天远个人风险报告API</strong> 为Java开发者提供了一套标准化的风控数据接入方案。通过一次接口调用，即可获取涵盖征信、司法、社会安全等维度的全量数据。</p>
<p><strong>开发集成建议：</strong></p>
<ul>
<li><strong>数据脱敏</strong>：由于报告包含身份证、案件详情等极度敏感信息，建议在落库（DB）时对关键字段进行加密存储，日志中严禁打印明文。</li>
<li><strong>授权管理</strong>：API强制校验 <code>authorization_url</code> 和 <code>auth_dat</code>，开发者需在前端实现授权书签署与上传功能，确保业务合规。</li>
<li><strong>降级策略</strong>：在解析 <code>responses</code> 数组时，务必判断 <code>success</code> 状态。如果某子产品（如司法信息）偶尔超时，应保证主流程（如基础评分）继续运行，避免因局部异常导致整个业务中断。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端全栈必读：Node.js如何高效接入天远个人风险报告API]]></title>    <link>https://juejin.cn/post/7581858890607050788</link>    <guid>https://juejin.cn/post/7581858890607050788</guid>    <pubDate>2025-12-10T07:21:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581858890607050788" data-draft-id="7581876069608095787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端全栈必读：Node.js如何高效接入天远个人风险报告API"/> <meta itemprop="keywords" content="API,大数据"/> <meta itemprop="datePublished" content="2025-12-10T07:21:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="天远云服"/> <meta itemprop="url" content="https://juejin.cn/user/590850926340011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端全栈必读：Node.js如何高效接入天远个人风险报告API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/590850926340011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    天远云服
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:21:21.000Z" title="Wed Dec 10 2025 07:21:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 构建实时、轻量级的个人风控网关</h2>
<p>在互联网金融（FinTech）、共享经济（如网约车、房屋短租）以及电商分期等高频交易场景中，用户体验与风险控制往往是一对矛盾体。前端业务需要毫秒级的响应速度，而后台风控却需要查询海量数据。<strong>天远个人风险报告API</strong>（接口代码 <code>COMBTY11</code>）通过聚合谛听多维报告与深度司法数据，为解决这一矛盾提供了完美的“数据中间件”。</p>
<p>该API不仅提供基础的实名与运营商核验，更输出了反欺诈评分、借贷意向分析及详细的司法涉诉记录。对于使用 Node.js 构建 BFF 层或微服务的团队而言，<strong>天远API</strong> 标准化的 JSON 数据结构与高效的响应能力，能够帮助开发者快速搭建起一道轻量级、高并发的人员风险防火墙，在不牺牲用户体验的前提下实现精准拦截。</p>
<h2 data-id="heading-1">二、 API接口调用示例（Node.js版）</h2>
<p>本接口支持 HTTPS POST 请求，数据交互采用 JSON 格式。Node.js 的非阻塞 I/O 特性非常适合处理此类外部 API 的聚合调用。</p>
<h3 data-id="heading-2">1. 接口技术参数</h3>
<ul>
<li><strong>接口地址</strong>：<code>https://api.tianyuanapi.com/api/v1/COMBTY11?t=13位时间戳</code></li>
<li><strong>请求方式</strong>：POST</li>
<li><strong>鉴权与加密</strong>：业务参数（含授权书URL）需序列化后加密，并转为 Base64 字符串放入 <code>data</code> 字段。</li>
</ul>
<h3 data-id="heading-3">2. Curl 命令行测试</h3>
<p>Bash</p>
<pre><code class="hljs language-jsx" lang="jsx">curl -X <span class="hljs-variable constant_">POST</span> <span class="hljs-string">"https://api.tianyuanapi.com/api/v1/COMBTY11?t=1715068800000"</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-d <span class="hljs-string">'{
    "data": "eyJpZF9jYXJkIjoiNDUyMTIyMjAwMDA4Mjc0MjNYIiwibmFtZSI6IuW8oOS7SiIsIm1vYmlsZV9ubyI6IjEzODAwMTM4MDAwIiwiYXV0aG9yaXphdGlvbl91cmwiOiJodHRwczovL29zcy5leGFtcGxlLmNvbS9hdXRoLnBuZyIsImF1dGhfZGF0ZSI6IjIwMjMwMTAxLTIwMjMxMjMxIn0="
}'</span>
</code></pre>
<h3 data-id="heading-4">3. Node.js (Axios + Async/Await) 调用示例</h3>
<p>以下代码展示了如何在 Node.js 环境中（适用于 Express/Koa/NestJS）封装一个通用的风控查询服务。</p>
<p>JavaScript</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
<span class="hljs-comment">// const crypto = require('crypto'); // 实际加密需要用到</span>

<span class="hljs-comment">// 1. API 配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_CONFIG</span> = {
    <span class="hljs-attr">url</span>: <span class="hljs-string">'https://api.tianyuanapi.com/api/v1/COMBTY11'</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span> <span class="hljs-comment">// 建议设置较长超时，因为涉及多维数据查询</span>
};

<span class="hljs-comment">/**
 * 模拟加密处理函数
 * 实际接入时，请使用天远API提供的加密算法（通常为AES）替换此函数
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">encryptPayload</span>(<span class="hljs-params">payload</span>) {
    <span class="hljs-keyword">const</span> jsonStr = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(payload);
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 实现真实的加密逻辑</span>
    <span class="hljs-comment">// const encrypted = aesEncrypt(jsonStr, secretKey);</span>
    <span class="hljs-comment">// 这里仅做 Base64 编码演示</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(jsonStr).<span class="hljs-title function_">toString</span>(<span class="hljs-string">'base64'</span>);
}

<span class="hljs-comment">/**
 * 获取个人风险报告
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} userInfo 用户信息对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;Object&gt;</span>} 解析后的风险数据
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchRiskReport</span>(<span class="hljs-params">userInfo</span>) {
    <span class="hljs-keyword">const</span> { name, idCard, mobile, authUrl, authDate } = userInfo;
    
    <span class="hljs-comment">// 2. 构建业务参数</span>
    <span class="hljs-keyword">const</span> payload = {
        <span class="hljs-attr">name</span>: name,
        <span class="hljs-attr">id_card</span>: idCard,
        <span class="hljs-attr">mobile_no</span>: mobile,
        <span class="hljs-attr">authorization_url</span>: authUrl, <span class="hljs-comment">// 必须提供授权书 URL auth_date: authDate         // 格式 YYYYMMDD-YYYYMMDD </span>
    };

    <span class="hljs-keyword">const</span> encryptedData = <span class="hljs-title function_">encryptPayload</span>(payload);
    <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 3. 发起异步请求</span>
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">`<span class="hljs-subst">${API_CONFIG.url}</span>?t=<span class="hljs-subst">${timestamp}</span>`</span>, {
            <span class="hljs-attr">data</span>: encryptedData
        }, {
            <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
        });

        <span class="hljs-keyword">const</span> result = response.<span class="hljs-property">data</span>;

        <span class="hljs-comment">// 4. 处理组合包响应</span>
        <span class="hljs-keyword">if</span> (result &amp;&amp; result.<span class="hljs-property">responses</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">transformData</span>(result.<span class="hljs-property">responses</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API Error:'</span>, result);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Risk API response format error'</span>);
        }

    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Request Failed:'</span>, error.<span class="hljs-property">message</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}

<span class="hljs-comment">/**
 * 数据清洗与转换工具函数
 * 将复杂的组合包结构扁平化，便于前端使用
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">transformData</span>(<span class="hljs-params">responses</span>) {
    <span class="hljs-keyword">const</span> report = {
        <span class="hljs-attr">summary</span>: { <span class="hljs-attr">score</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">suggestion</span>: <span class="hljs-string">''</span> },
        <span class="hljs-attr">risks</span>: [],
        <span class="hljs-attr">legal</span>: []
    };

    responses.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!item.<span class="hljs-property">success</span> || !item.<span class="hljs-property">data</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 谛听多维报告 (DWBG8B4D)</span>
        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">api_code</span> === <span class="hljs-string">'DWBG8B4D'</span>) {
            <span class="hljs-keyword">const</span> data = item.<span class="hljs-property">data</span>;
            report.<span class="hljs-property">summary</span>.<span class="hljs-property">fraudScore</span> = data.<span class="hljs-property">fraudScore</span>; <span class="hljs-comment">// 反欺诈分 </span>
            report.<span class="hljs-property">summary</span>.<span class="hljs-property">creditScore</span> = data.<span class="hljs-property">creditScore</span>; <span class="hljs-comment">// 信用分 </span>
            report.<span class="hljs-property">summary</span>.<span class="hljs-property">suggestion</span> = data.<span class="hljs-property">checkSuggest</span>; <span class="hljs-comment">// 审核建议 </span>
            
            <span class="hljs-comment">// 提取高风险项</span>
            <span class="hljs-keyword">if</span> (data.<span class="hljs-property">riskWarning</span>) {
                <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(data.<span class="hljs-property">riskWarning</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
                    <span class="hljs-keyword">if</span> (value === <span class="hljs-number">1</span> &amp;&amp; key !== <span class="hljs-string">'totalRiskCounts'</span>) {
                        report.<span class="hljs-property">risks</span>.<span class="hljs-title function_">push</span>(key); <span class="hljs-comment">// 将命中的风险标签加入数组</span>
                    }
                });
            }
        }
        
        <span class="hljs-comment">// 个人司法涉诉 (FLXG0V4B)</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.<span class="hljs-property">api_code</span> === <span class="hljs-string">'FLXG0V4B'</span>) {
            <span class="hljs-keyword">const</span> entout = item.<span class="hljs-property">data</span>.<span class="hljs-property">entout</span>?.<span class="hljs-property">data</span> || {};
            <span class="hljs-keyword">const</span> sxbzxr = item.<span class="hljs-property">data</span>.<span class="hljs-property">sxbzxr</span>?.<span class="hljs-property">data</span>?.<span class="hljs-property">sxbzxr</span> || []; <span class="hljs-comment">// 失信被执行人 </span>
            
            <span class="hljs-keyword">if</span> (sxbzxr.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                report.<span class="hljs-property">legal</span>.<span class="hljs-title function_">push</span>(...sxbzxr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> ({
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'失信被执行'</span>,
                    <span class="hljs-attr">court</span>: c.<span class="hljs-property">zxfy</span>, <span class="hljs-comment">// 执行法院 caseNo: c.ah,  // 案号 duty: c.yw     // 义务 </span>
                })));
            }
        }
    });

    <span class="hljs-keyword">return</span> report;
}

<span class="hljs-comment">// 5. 执行调用测试</span>
(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> user = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"张三"</span>,
        <span class="hljs-attr">idCard</span>: <span class="hljs-string">"110101199001011234"</span>,
        <span class="hljs-attr">mobile</span>: <span class="hljs-string">"13900000000"</span>,
        <span class="hljs-attr">authUrl</span>: <span class="hljs-string">"http://oss.example.com/auth/user_123.jpg"</span>,
        <span class="hljs-attr">authDate</span>: <span class="hljs-string">"20230101-20250101"</span>
    };

    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchRiskReport</span>(user);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'清洗后的风控报告:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
})();
</code></pre>
<h2 data-id="heading-5">三、 核心数据结构解析</h2>
<p><strong>天远API</strong> 的响应设计遵循“组合模式”，这对于 JavaScript 的解构赋值非常友好。</p>
<p><strong>数据层级概览：</strong></p>
<ol>
<li><strong>Response Body</strong>: 包含 <code>responses</code> 数组。</li>
<li><strong>Item Object</strong>: 数组元素，包含 <code>api_code</code> 和 <code>data</code>。
<ul>
<li><strong>DWBG8B4D</strong>: 核心风控数据。重点关注 <code>fraudScore</code>（反欺诈分）、<code>creditScore</code>（信用分）和 <code>riskWarning</code>（风险清单）。</li>
<li><strong>FLXG0V4B</strong>: 司法详情。重点关注 <code>sxbzxr</code>（失信名单）和 <code>entout.data.criminal</code>（刑事案件）。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-6">四、 字段详解</h2>
<p>为了方便 Node.js 开发者在 TypeORM 或 Mongoose 中定义 Schema，以下列出核心字段的详细说明。</p>
<h3 data-id="heading-7">1. 评分与建议 (DWBG8B4D -&gt; data)</h3>





























<table><thead><tr><th><strong>字段名 (JSON)</strong></th><th><strong>JS类型</strong></th><th><strong>含义</strong></th><th><strong>业务逻辑参考</strong></th></tr></thead><tbody><tr><td><code>fraudScore</code></td><td>Number</td><td>反欺诈评分</td><td>范围 [0,100]。<strong>&gt;80</strong> 为高风险，建议前端直接提示拒绝。</td></tr><tr><td><code>creditScore</code></td><td>Number</td><td>信用评分</td><td>范围 [300,1000]。<strong>&lt;500</strong> 为信用一般，建议人工复审。</td></tr><tr><td><code>checkSuggest</code></td><td>String</td><td>审核建议</td><td>值示例："建议拒绝"、"建议复审" 。</td></tr></tbody></table>
<h3 data-id="heading-8">2. 借贷与逾期风险 (DWBG8B4D -&gt; overdueRiskProduct)</h3>
<p>此模块数据适合做贷前评估。</p>





























<table><thead><tr><th><strong>字段名 (JSON)</strong></th><th><strong>JS类型</strong></th><th><strong>含义</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>currentOverdueAmount</code></td><td>String</td><td>当前逾期金额</td><td>如 "(0,1000)"，表示逾期金额区间。</td></tr><tr><td><code>overdueLast30Days</code></td><td>String</td><td>近30天逾期状态</td><td>"逾期" 或 "未逾期"。</td></tr><tr><td><code>totalLoanInstitutions</code></td><td>String</td><td>贷款总机构数</td><td>多头借贷指标，数值过大风险高。</td></tr></tbody></table>
<h3 data-id="heading-9">3. 司法涉诉 (FLXG0V4B)</h3>
<p>重点关注“老赖”和刑事记录。</p>





























<table><thead><tr><th><strong>字段名 (JSON)</strong></th><th><strong>JS类型</strong></th><th><strong>含义</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><code>sxbzxr</code></td><td>Array</td><td>失信被执行人列表</td><td>包含 <code>xwqx</code> (失信行为具体情形)。</td></tr><tr><td><code>xgbzxr</code></td><td>Array</td><td>限高被执行人列表</td><td>包含 <code>fbrq</code> (发布日期) 。</td></tr><tr><td><code>criminal</code></td><td>Object</td><td>刑事案件</td><td>位于 <code>entout.data</code> 下，包含 <code>dzzm</code> (定罪罪名)。</td></tr></tbody></table>
<h2 data-id="heading-10">五、 应用价值分析</h2>
<p>在 Node.js 生态中，接入 <strong>天远API</strong> 可以为多种互联网业务场景提供强大的风控支持：</p>
<ol>
<li>
<p>电商分期/先用后付 (BNPL)</p>
<p>在用户点击“开通分期”的瞬间，BFF 层异步调用 天远API。通过 creditScore 和 overdueRiskProduct 数据，实时计算用户的信用额度。如果 currentOverdueAmount 不为空，则自动拒绝开通，有效控制坏账率。</p>
</li>
<li>
<p>C2C 租赁平台 (房屋/电子产品)</p>
<p>在租客提交订单时，调用接口检查 leasingRiskAssessment（租赁风险评估）15。如果发现租客在近期频繁申请租赁机构（veryFrequentRentalApplications == 1）16 或存在司法执行记录，系统可自动调整押金比例或要求第三方担保。</p>
</li>
<li>
<p>社交/婚恋平台的高端认证</p>
<p>针对实名认证的高端用户，利用 FLXG0V4B 中的婚姻状况（如有）和司法涉诉记录进行背景核实。若发现用户存在“重婚罪”或严重的“经济诈骗”前科（hasCriminalRecord == 1）17，平台可及时封禁账号，维护社区生态安全。</p>
</li>
</ol>
<h2 data-id="heading-11">六、 总结</h2>
<p><strong>天远个人风险报告API</strong> 为 Node.js 开发者提供了一套高效、全面的数据解决方案。通过一次请求，即可获取横跨征信、司法、社会安全三大领域的全景画像，极大地简化了风控系统的开发复杂度。</p>
<p><strong>集成小贴士：</strong></p>
<ul>
<li><strong>文件上传</strong>：由于接口需要 <code>authorization_url</code>，开发者需先将用户签署的授权书上传至对象存储（如 COS/OSS），再将公网链接传给 API。</li>
<li><strong>数据缓存</strong>：风险报告数据量大且更新频率相对较低，建议在 Redis 中缓存查询结果（如缓存 24 小时），以节省 API 调用成本并提升响应速度。</li>
<li><strong>隐私保护</strong>：在前端展示报告时，务必对敏感信息（如具体案号、涉案金额）进行脱敏处理，仅展示风险等级或建议。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Oracle数据字典深度解析：架构、组件与实践应用]]></title>    <link>https://juejin.cn/post/7581844141669007400</link>    <guid>https://juejin.cn/post/7581844141669007400</guid>    <pubDate>2025-12-10T06:53:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141669007400" data-draft-id="7581786379804753955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Oracle数据字典深度解析：架构、组件与实践应用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T06:53:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Oracle数据字典深度解析：架构、组件与实践应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:53:06.000Z" title="Wed Dec 10 2025 06:53:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、数据字典概述</h2>
<p>Oracle数据字典（Data Dictionary）是数据库的核心元数据仓库，被誉为数据库的“数据库”。它存储了数据库运行所需的关键信息，包括所有Schema对象定义（表、视图、索引、触发器等）、空间分配与使用情况、字段默认值、完整性约束、用户权限与角色、审计信息等。数据字典的核心价值在于实现数据库的“自解释”——用户与DBA通过它可获取数据库对象的完整信息，是数据库管理、维护与优化的基础。</p>
<p>数据字典具有<strong>只读特性</strong>：Oracle严格禁止手工修改数据字典表中的信息，此类操作可能导致数据库紊乱且无法恢复，Oracle公司对此不承担责任。从架构上，数据字典由五部分构成：内部RDBMS（X<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>）表、数据字典表、静态数据字典视图、动态性能（</mtext><mi>V</mi></mrow><annotation encoding="application/x-tex">）表、数据字典表、静态数据字典视图、动态性能（V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">）表、数据字典表、静态数据字典视图、动态性能（</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>）视图，以及辅助管理的同义词（Synonym）。</p>
<h2 data-id="heading-1">二、内部RDBMS（X$）表：数据库的底层核心</h2>
<h3 data-id="heading-2">2.1 核心特性与访问限制</h3>
<p>X$表是Oracle数据库的最底层组件，本质是一系列C结构体，在数据库启动时由Oracle应用程序动态创建，用于跟踪内部运行状态、维持数据库正常工作。其核心特性包括：</p>
<ul>
<li><strong>加密命名与未公开文档</strong>：X<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>表名称加密（如</mtext><mi>X</mi></mrow><annotation encoding="application/x-tex">表名称加密（如X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">表名称加密（如</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span>BH、X$KSMSP），Oracle未提供官方文档，属于技术机密；</li>
<li><strong>访问权限严格</strong>：仅SYSDBA角色可直接访问，普通用户即使获得显式授权也会报错（ORA-02030：仅允许从固定表/视图查询）；</li>
<li><strong>底层依赖</strong>：所有动态性能视图（V<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>G</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">、GV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">、</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>）均基于X$表构建，是数据库运行的基础。</li>
</ul>
<h3 data-id="heading-3">2.2 实践探索：X$表的应用价值</h3>
<p>通过Oracle的AUTOTRACE功能可间接探索X<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>表的底层关联。例如，查询</mtext><mi mathvariant="normal">‘</mi><mi>v</mi></mrow><annotation encoding="application/x-tex">表的底层关联。例如，查询`v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord cjk_fallback">表的底层关联。例如，查询</span><span class="mord">‘</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span></span>parameter<code>时，AUTOTRACE的执行计划会显示其依赖</code>X<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>S</mi><mi>P</mi><mi>P</mi><mi>I</mi><mi mathvariant="normal">‘</mi><mtext>和</mtext><mi mathvariant="normal">‘</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">KSPPI`和`X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal" style="margin-right:0.13889em;">SPP</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord">‘</span><span class="mord cjk_fallback">和</span><span class="mord">‘</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span>KSPPCV`两个X$表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> autotrace trace explain
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> v$<span class="hljs-keyword">parameter</span>;
Execution Plan
Plan hash <span class="hljs-keyword">value</span>: <span class="hljs-number">1128103955</span>
<span class="hljs-operator">|</span> Id <span class="hljs-operator">|</span> Operation          <span class="hljs-operator">|</span> Name      <span class="hljs-operator">|</span> <span class="hljs-keyword">Rows</span> <span class="hljs-operator">|</span> Bytes <span class="hljs-operator">|</span> Cost (<span class="hljs-operator">%</span>CPU)<span class="hljs-operator">|</span> <span class="hljs-type">Time</span>     <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">SELECT</span> STATEMENT   <span class="hljs-operator">|</span>           <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <span class="hljs-number">926</span> <span class="hljs-operator">|</span>     <span class="hljs-number">1</span> (<span class="hljs-number">100</span>)<span class="hljs-operator">|</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span><span class="hljs-operator">*</span> <span class="hljs-number">1</span> <span class="hljs-operator">|</span> HASH <span class="hljs-keyword">JOIN</span>          <span class="hljs-operator">|</span>           <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <span class="hljs-number">926</span> <span class="hljs-operator">|</span>     <span class="hljs-number">1</span> (<span class="hljs-number">100</span>)<span class="hljs-operator">|</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span><span class="hljs-operator">*</span> <span class="hljs-number">2</span> <span class="hljs-operator">|</span> FIXED <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">FULL</span>   <span class="hljs-operator">|</span> X$KSPPI   <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span>  <span class="hljs-number">249</span> <span class="hljs-operator">|</span>     <span class="hljs-number">0</span> (<span class="hljs-number">0</span>)<span class="hljs-operator">|</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">3</span> <span class="hljs-operator">|</span> FIXED <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">FULL</span>   <span class="hljs-operator">|</span> X$KSPPCV  <span class="hljs-operator">|</span> <span class="hljs-number">100</span> <span class="hljs-operator">|</span> <span class="hljs-number">67700</span> <span class="hljs-operator">|</span>     <span class="hljs-number">0</span> (<span class="hljs-number">0</span>)<span class="hljs-operator">|</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span> <span class="hljs-operator">|</span>
</code></pre>
<p>X<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>表还可揭示数据库核心机制的底层参数。例如，</mtext><mi mathvariant="normal">‘</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">表还可揭示数据库核心机制的底层参数。例如，`X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord cjk_fallback">表还可揭示数据库核心机制的底层参数。例如，</span><span class="mord">‘</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span>KVIT`表记录实例级内部参数，其中：</p>
<ul>
<li><code>kcbldq=25</code>：脏缓冲（Dirty Buffers）阈值为25%，触发DBWR进程写动作；</li>
<li><code>kcbfsp=40</code>：前台进程扫描LRU列表的最大比例为40%，未找到足够空闲块时触发DBWR。</li>
</ul>
<p>这些参数与隐含参数直接关联（如<code>_db_writer_scan_depth_pct=25</code>、<code>_db_block_max_scan_pct=40</code>），通过X$表可将抽象的数据库机制具象化。</p>
<h2 data-id="heading-4">三、数据字典表：元数据的持久化存储</h2>
<h3 data-id="heading-5">3.1 定义与创建</h3>
<p>数据字典表是存储数据库结构信息的持久化表，名称通常以<code>$</code>结尾（如OBJ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>T</mi><mi>A</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">、TAB</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span>、COL<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>C</mi><mi>O</mi><mi>N</mi></mrow><annotation encoding="application/x-tex">、CON</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.10903em;">CON</span></span></span></span></span>、SEG<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>），在数据库创建时通过</mtext><mi mathvariant="normal">‘</mi></mrow><annotation encoding="application/x-tex">），在数据库创建时通过`</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord cjk_fallback">），在数据库创建时通过</span><span class="mord">‘</span></span></span></span></span>ORACLE_HOME/rdbms/admin/sql.bsq<code>脚本初始化。Oracle 11g后，</code>sql.bsq<code>被拆分为</code>dcore.bsq<code>、</code>dobj.bsq`等多个脚本，便于管理与维护。</p>
<p>数据字典表的核心作用是记录对象的元数据：</p>
<ul>
<li>OBJ$：存储所有数据库对象的基本信息（对象号OBJ#、所有者OWNER#、类型TYPE#等）；</li>
<li>TAB$：记录表的存储属性（表空间、数据文件、块号等）；</li>
<li>COL$：存储字段信息（字段名、数据类型、长度、是否允许为空等）；</li>
<li>CON$：记录完整性约束信息。</li>
</ul>
<h3 data-id="heading-6">3.2 关键特性：TRUNCATE对DATAOBJ#的影响</h3>
<p>OBJ$表中的<code>OBJ#</code>（对应DBA_OBJECTS.OBJECT_ID）是对象的逻辑编号，一旦分配永不改变；而<code>DATAOBJ#</code>（对应DBA_OBJECTS.DATA_OBJECT_ID）是与物理存储关联的编号，会随物理结构变化（如TRUNCATE）而更新。Oracle明确提示“不要在DATAOBJ#上创建索引”，因为TRUNCATE会修改该字段：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建测试表</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> dba_users;
<span class="hljs-comment">-- 查询初始OBJ#和DATAOBJ#（值相同）</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> object_id,data_object_id <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">'EYGLE'</span> <span class="hljs-keyword">and</span> object_name<span class="hljs-operator">=</span><span class="hljs-string">'TEST'</span>;
OBJECT_ID DATA_OBJECT_ID
<span class="hljs-number">15036</span>        <span class="hljs-number">15036</span>
<span class="hljs-comment">-- 执行TRUNCATE后，DATAOBJ#递增</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">truncate</span> <span class="hljs-keyword">table</span> test;
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> object_id,data_object_id <span class="hljs-keyword">from</span> dba_objects <span class="hljs-keyword">where</span> owner<span class="hljs-operator">=</span><span class="hljs-string">'EYGLE'</span> <span class="hljs-keyword">and</span> object_name<span class="hljs-operator">=</span><span class="hljs-string">'TEST'</span>;
OBJECT_ID DATA_OBJECT_ID
<span class="hljs-number">15036</span>        <span class="hljs-number">15037</span>
</code></pre>
<p>这一特性也解释了TRUNCATE快速回收空间的本质：仅标记空间为可用，不删除数据块内容，通过更新DATAOBJ#重新定位对象，数据在被覆盖前可通过工具恢复。</p>
<h3 data-id="heading-7">3.3 DDL操作的底层实现</h3>
<p>用户执行DDL操作（如CREATE TABLE）时，Oracle会自动将其解析为对数据字典表的DML操作。通过10046事件跟踪（<code>alter session set events '10046 trace name context forever,level 12'</code>），可捕获这些底层动作：</p>
<ul>
<li>向OBJ$插入对象基本信息；</li>
<li>向TAB$记录表的存储属性；</li>
<li>向COL$插入字段信息；</li>
<li>向CON$记录约束信息；</li>
<li>向SEG$插入数据段信息。</li>
</ul>
<p>Oracle 9i后引入的<code>DBMS_METADATA</code>工具包可反向解析这些元数据，还原原始DDL语句：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> dbms_metadata.get_ddl(<span class="hljs-string">'TABLE'</span>,<span class="hljs-string">'EYGLE'</span>) <span class="hljs-keyword">from</span> dual;
</code></pre>
<h2 data-id="heading-8">四、静态数据字典视图：面向用户的访问接口</h2>
<p>由于X$表和数据字典表不可直接访问，Oracle提供了静态数据字典视图，将底层元数据封装为用户友好的接口。静态视图数据相对稳定，按权限分为三类：</p>
<h3 data-id="heading-9">4.1 视图分类与权限控制</h3>

























<table><thead><tr><th>视图前缀</th><th>包含内容</th><th>访问权限</th></tr></thead><tbody><tr><td>USER_</td><td>当前用户拥有的对象</td><td>无需额外权限</td></tr><tr><td>ALL_</td><td>当前用户可访问的对象（自有+授权）</td><td>需对象授权</td></tr><tr><td>DBA_</td><td>数据库中所有对象</td><td>需SELECT ANY TABLE权限或DBA角色</td></tr></tbody></table>
<p>三类视图的权限控制通过WHERE子句实现：</p>
<ul>
<li>USER_TABLES：通过<code>o.owner# = userenv('SCHEMAID')</code>限制返回当前用户对象；</li>
<li>ALL_TABLES：增加权限判断（<code>o.obj# in (select oa.obj# from sys.objauth$ oa ...)</code>或系统权限检查）；</li>
<li>DBA_TABLES：无所有者限制，返回所有对象。</li>
</ul>
<h3 data-id="heading-10">4.2 常用静态视图与同义词</h3>
<h4 data-id="heading-11">（1）DICT/DICTIONARY</h4>
<p>记录当前用户可访问的所有数据字典视图，包含<code>TABLE_NAME</code>（对象名）和<code>COMMENTS</code>（描述）字段，是查询数据字典的“目录”：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> dict <span class="hljs-keyword">where</span> table_name <span class="hljs-keyword">like</span> <span class="hljs-string">'%TABLES%'</span>;
</code></pre>
<h4 data-id="heading-12">（2）DICT_COLUMNS</h4>
<p>记录数据字典视图的字段信息，可快速查询视图结构：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> column_name,comments <span class="hljs-keyword">from</span> dict_columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">'DICT'</span>;
</code></pre>
<h4 data-id="heading-13">（3）OBJ$/DBA_OBJECTS/OBJ</h4>
<ul>
<li>
<p>OBJ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>是底层表，</mtext><mi>D</mi><mi>B</mi><msub><mi>A</mi><mi>O</mi></msub><mi>B</mi><mi>J</mi><mi>E</mi><mi>C</mi><mi>T</mi><mi>S</mi><mtext>基于</mtext><mi>O</mi><mi>B</mi><mi>J</mi></mrow><annotation encoding="application/x-tex">是底层表，DBA_OBJECTS基于OBJ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord cjk_fallback">是底层表，</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">O</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mord mathnormal" style="margin-right:0.05764em;">ECTS</span><span class="mord cjk_fallback">基于</span><span class="mord mathnormal" style="margin-right:0.05017em;">OB</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span></span>构建；</p>
</li>
<li>
<p>OBJ是USER_OBJECTS的公共同义词，供用户查询自有对象：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> object_name,object_type <span class="hljs-keyword">from</span> obj;
</code></pre>
</li>
</ul>
<h4 data-id="heading-14">（4）*_SOURCE视图</h4>
<p>存储存储过程、函数、包、触发器等对象的源码，如<code>DBA_SOURCE</code>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> text <span class="hljs-keyword">from</span> dba_source <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">'CALLING'</span>;
</code></pre>
<h3 data-id="heading-15">4.3 同义词的作用与类型</h3>
<p>同义词（Synonym）是数据库对象的别名，仅存储定义，无需额外空间，核心作用包括：</p>
<ul>
<li>隐藏对象名称与所有者；</li>
<li>隐藏分布式环境中远程对象的位置；</li>
<li>简化SQL语句；</li>
<li>实现精细访问控制。</li>
</ul>
<p>同义词分为<strong>公共同义词</strong>（PUBLIC所有，所有用户可访问）和<strong>私有同义词</strong>（用户私有，需授权访问）。例如，创建SALES_DATA表的公共同义词：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> public synonym sales <span class="hljs-keyword">for</span> eygle.sales_data;
<span class="hljs-comment">-- 用户可直接通过同义词访问</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sales;
</code></pre>
<h2 data-id="heading-16">五、动态性能视图：数据库运行状态的实时窗口</h2>
<p>动态性能视图（V$视图）记录数据库运行时的实时信息（如会话、SGA、进程、锁等），数据随数据库状态动态更新，是DBA监控与诊断的核心工具。</p>
<h3 data-id="heading-17">5.1 GV<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>与</mtext><mi>V</mi></mrow><annotation encoding="application/x-tex">与V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">与</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>的关系</h3>
<ul>
<li>GV<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>（</mtext><mi>G</mi><mi>l</mi><mi>o</mi><mi>b</mi><mi>a</mi><mi>l</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">（Global V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord cjk_fallback">（</span><span class="mord mathnormal" style="margin-right:0.01968em;">Gl</span><span class="mord mathnormal">o</span><span class="mord mathnormal">ba</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>）：适用于RAC环境，返回所有实例的信息；</li>
<li>V<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>：基于</mtext><mi>G</mi><mi>V</mi></mrow><annotation encoding="application/x-tex">：基于GV</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">：基于</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>构建，通过<code>inst_id = USERENV('Instance')</code>限制返回当前实例信息。</li>
</ul>
<p>例如，RAC环境中查询实例信息：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- GV$返回所有实例</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> inst_id,instance_name,status <span class="hljs-keyword">from</span> gv$instance;
INST_ID INSTANCE_NAME STATUS
<span class="hljs-number">1</span>       RACDB1        <span class="hljs-keyword">OPEN</span>
<span class="hljs-number">2</span>       RACDB2        <span class="hljs-keyword">OPEN</span>
<span class="hljs-comment">-- V$仅返回当前实例</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> instance_name,status <span class="hljs-keyword">from</span> v$instance;
INSTANCE_NAME STATUS
RACDB1        <span class="hljs-keyword">OPEN</span>
</code></pre>
<h3 data-id="heading-18">5.2 V_$视图与同义词的关联</h3>
<p>Oracle通过“V<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Expected group after '_' at position 5: 视图→V_̲" style="color:#cc0000"><span class="cjk_fallback">视图→V_</span></span></span>视图→同义词”的层级提供访问：</p>
<ol>
<li>
<p>V<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>视图基于</mtext><mi>X</mi></mrow><annotation encoding="application/x-tex">视图基于X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">视图基于</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span>表构建，仅SYS可直接访问，无法授权；</p>
</li>
<li>
<p>V_<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>视图是</mtext><mi>V</mi></mrow><annotation encoding="application/x-tex">视图是V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">视图是</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>视图的封装（<code>create or replace view v_$fixed_table as select * from v$fixed_table</code>）；</p>
</li>
<li>
<p>公共同义词（如V<span class="math math-inline"><span class="katex-error" title="ParseError: KaTeX parse error: Expected group after '_' at position 16: FIXED_TABLE）指向V_̲" style="color:#cc0000">FIXED_TABLE）指向V_</span></span>视图，普通用户通过同义词访问，需授予V_$视图的查询权限：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 直接授权V$视图报错</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> v$sga <span class="hljs-keyword">to</span> eygle;
ORA<span class="hljs-number">-02030</span>: can <span class="hljs-keyword">only</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">from</span> fixed tables<span class="hljs-operator">/</span>views
<span class="hljs-comment">-- 授权V_$视图成功</span>
<span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">grant</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">on</span> v_$sga <span class="hljs-keyword">to</span> eygle;
<span class="hljs-keyword">Grant</span> succeeded.
</code></pre>
</li>
</ol>
<h3 data-id="heading-19">5.3 数据库启动各阶段的可访问视图</h3>
<p>动态性能视图的访问依赖数据库启动状态：</p>
<ul>
<li><strong>Nomount阶段</strong>（仅启动实例）：可访问V<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>A</mi><mi>R</mi><mi>A</mi><mi>M</mi><mi>E</mi><mi>T</mi><mi>E</mi><mi>R</mi><mtext>、</mtext><mi>V</mi></mrow><annotation encoding="application/x-tex">PARAMETER、V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.00773em;">METER</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>SGA、V$INSTANCE等参数与实例信息；</li>
<li><strong>Mount阶段</strong>（读取控制文件）：新增V<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>O</mi><mi>N</mi><mi>T</mi><mi>R</mi><mi>O</mi><mi>L</mi><mi>F</mi><mi>I</mi><mi>L</mi><mi>E</mi><mtext>、</mtext><mi>V</mi></mrow><annotation encoding="application/x-tex">CONTROLFILE、V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">CONTRO</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span>DATABASE、V$DATAFILE等控制文件相关视图；</li>
<li><strong>Open阶段</strong>（打开数据文件）：所有动态视图与数据字典均可访问。</li>
</ul>
<h2 data-id="heading-20">六、同义词优化实践：提升数据字典查询性能</h2>
<h3 data-id="heading-21">6.1 问题背景</h3>
<p>某业务系统通过查询<code>all_tab_columns</code>动态拼装SQL，2小时内执行74131次，每次逻辑读517.9，执行计划嵌套多层数据字典表（OBJ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>U</mi><mi>S</mi><mi>E</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">、USER</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.00773em;">SER</span></span></span></span></span>、COL$等），性能瓶颈显著。</p>
<h3 data-id="heading-22">6.2 优化方案</h3>
<p>利用同义词替换<code>all_tab_columns</code>视图，通过预建表存储静态字段信息，减少底层表关联：</p>
<ol>
<li>
<p>创建临时表存储目标用户的字段信息：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">copy</span> <span class="hljs-keyword">from</span> oti<span class="hljs-operator">/</span>oti<span class="hljs-variable">@fwx</span> <span class="hljs-keyword">to</span> oti<span class="hljs-operator">/</span>oti<span class="hljs-variable">@fwx</span> <span class="hljs-keyword">create</span> all_tab_columns_temp <span class="hljs-keyword">using</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> all_tab_columns t <span class="hljs-keyword">where</span> t.owner<span class="hljs-operator">=</span><span class="hljs-string">'OTI'</span>;
</code></pre>
</li>
<li>
<p>创建同义词指向临时表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> synonym all_tab_columns <span class="hljs-keyword">for</span> oti.all_tab_columns_temp;
</code></pre>
</li>
<li>
<p>建立组合索引优化查询：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SQL</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> index oti.all_tab_columns_temp_inx1 <span class="hljs-keyword">on</span> oti.all_tab_columns_temp(owner,table_name,column_name);
</code></pre>
</li>
</ol>
<h3 data-id="heading-23">6.3 优化效果</h3>
<p>优化后，SQL逻辑读从517.9降至4，执行计划简化为“索引范围扫描+表访问”，系统性能大幅提升。</p>
<h2 data-id="heading-24">七、总结与实践建议</h2>
<p>Oracle数据字典的架构层级可概括为：<strong>X$表（底层核心）→ 数据字典表（元数据存储）→ 静态/动态视图（访问接口）→ 同义词（简化与权限控制）</strong> 。理解这一架构对DBA工作至关重要，结合实践给出以下建议：</p>
<ol>
<li><strong>禁止直接操作</strong>：切勿手工修改X$表或数据字典表，避免数据库崩溃；</li>
<li><strong>合理利用视图</strong>：根据权限选择USER_/ALL_/DBA_视图，通过DICT快速定位所需字典；</li>
<li><strong>优化动态查询</strong>：频繁访问的数据字典信息可通过同义词+临时表缓存，减少底层关联；</li>
<li><strong>深入探索底层</strong>：利用AUTOTRACE、10046事件跟踪数据字典的底层关联，辅助故障诊断与性能优化。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理解 .NET 中的中间件（Middleware）]]></title>    <link>https://juejin.cn/post/7581789701532549162</link>    <guid>https://juejin.cn/post/7581789701532549162</guid>    <pubDate>2025-12-10T07:22:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581789701532549162" data-draft-id="7581858890607067172" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理解 .NET 中的中间件（Middleware）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-10T07:22:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="淡定__009"/> <meta itemprop="url" content="https://juejin.cn/user/2999123453676765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理解 .NET 中的中间件（Middleware）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2999123453676765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    淡定__009
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:22:48.000Z" title="Wed Dec 10 2025 07:22:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">理解 .NET 中的中间件（Middleware）：请求管道的核心机制</h2>
<p>在 ASP.NET Core 中，中间件（Middleware）是整个 Web 应用的核心机制之一。所有 HTTP 请求都会依次通过一系列中间件处理，这些中间件共同组成了所谓的 <strong>请求管道（Request Pipeline）</strong> 。理解中间件不仅有助于掌握 ASP.NET Core 的工作原理，更能帮助你构建结构清晰、可扩展且易维护的 Web 应用。</p>
<p>本文将从中间件的概念、执行流程、如何编写自定义中间件以及开发中的最佳实践等方面进行介绍。</p>
<hr/>
<h3 data-id="heading-1">一、中间件是什么？</h3>
<p>中间件是用于处理 HTTP 请求和响应的组件。每个中间件在管道中有两个职责：</p>
<ol>
<li><strong>处理当前请求</strong></li>
<li><strong>将请求传递给管道中的下一个中间件（可选）</strong></li>
</ol>
<p>典型逻辑可以概括为：</p>
<pre><code class="hljs language-css" lang="css">Request → <span class="hljs-selector-attr">[Middleware1]</span> → <span class="hljs-selector-attr">[Middleware2]</span> → ... → Endpoint
</code></pre>
<p>中间件既可以选择“继续往下传”，也可以“短路”整个请求。</p>
<p>例如：</p>
<ul>
<li>认证中间件可能会拒绝未授权请求，直接返回 401。</li>
<li>静态文件中间件会直接返回文件内容，不继续传递到 MVC 层。</li>
</ul>
<hr/>
<h3 data-id="heading-2">二、中间件的注册方式</h3>
<p>在 <code>.NET 6+</code> 的程序入口里，你常看到这样的代码：</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">builder</span> = WebApplication.CreateBuilder(args)<span class="hljs-comment">;</span>
var <span class="hljs-attr">app</span> = builder.Build()<span class="hljs-comment">;</span>

app.UseAuthentication()<span class="hljs-comment">;</span>
app.UseAuthorization()<span class="hljs-comment">;</span>
app.MapControllers()<span class="hljs-comment">;</span>

app.Run()<span class="hljs-comment">;</span>
</code></pre>
<p><code>UseXXX()</code> 即是在管道中注册中间件。</p>
<p>通常中间件的处理顺序非常重要，例如：</p>
<ul>
<li><code>UseRouting()</code> 必须在 <code>UseEndpoints()</code> 前。</li>
<li><code>UseAuthorization()</code> 要在 <code>UseAuthentication()</code> 后。</li>
</ul>
<p>如果顺序错误，可能导致路由不生效或认证失败。</p>
<hr/>
<h3 data-id="heading-3">三、编写一个自定义中间件</h3>
<p>自定义中间件通常有两种方式：类方式与委托方式。</p>
<h4 data-id="heading-4">方式一：通过类编写中间件</h4>
<h5 data-id="heading-5">1. 编写中间件类</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RequestLogMiddleware</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> RequestDelegate _next;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RequestLogMiddleware</span>(<span class="hljs-params">RequestDelegate next</span>)</span>
    {
        _next = next;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">InvokeAsync</span>(<span class="hljs-params">HttpContext context</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"[Request] <span class="hljs-subst">{context.Request.Method}</span> <span class="hljs-subst">{context.Request.Path}</span>"</span>);

        <span class="hljs-keyword">await</span> _next(context); <span class="hljs-comment">// 继续传递给下一个中间件</span>

        Console.WriteLine(<span class="hljs-string">$"[Response] <span class="hljs-subst">{context.Response.StatusCode}</span>"</span>);
    }
}
</code></pre>
<h5 data-id="heading-6">2. 注册中间件</h5>
<pre><code class="hljs language-ini" lang="ini">app.UseMiddleware&lt;RequestLogMiddleware&gt;()<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-7">方式二：使用 inline delegate 简写（更轻量）</h4>
<pre><code class="hljs language-python" lang="python">app.Use(<span class="hljs-keyword">async</span> (context, <span class="hljs-built_in">next</span>) =&gt;
{
    Console.WriteLine(<span class="hljs-string">"Before"</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">next</span>(context);
    Console.WriteLine(<span class="hljs-string">"After"</span>);
});
</code></pre>
<hr/>
<h3 data-id="heading-8">四、中间件执行流程示例</h3>
<p>假设我们有三层中间件：</p>
<pre><code class="hljs language-python" lang="python">app.Use(<span class="hljs-keyword">async</span> (context, <span class="hljs-built_in">next</span>) =&gt;
{
    Console.WriteLine(<span class="hljs-string">"1 - Before"</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">next</span>();
    Console.WriteLine(<span class="hljs-string">"1 - After"</span>);
});

app.Use(<span class="hljs-keyword">async</span> (context, <span class="hljs-built_in">next</span>) =&gt;
{
    Console.WriteLine(<span class="hljs-string">"2 - Before"</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">next</span>();
    Console.WriteLine(<span class="hljs-string">"2 - After"</span>);
});

app.Map(<span class="hljs-string">"/hello"</span>, () =&gt; <span class="hljs-string">"Hello"</span>);
</code></pre>
<p>执行顺序会是：</p>
<pre><code class="hljs">1 - Before
2 - Before
（进入 endpoint）
2 - After
1 - After
</code></pre>
<p>这体现了 <strong>洋葱模型（Onion Model）</strong> 的特性。</p>
<hr/>
<h3 data-id="heading-9">五、中间件的典型应用场景</h3>
<p>中间件的应用非常广泛，几乎所有现代 Web 框架都会使用类似的机制。ASP.NET Core 中常见的中间件包括：</p>
<ul>
<li><strong>异常捕获</strong>（UseExceptionHandler）</li>
<li><strong>静态文件处理</strong>（UseStaticFiles）</li>
<li><strong>跨域 CORS</strong>（UseCors）</li>
<li><strong>身份认证 Auth</strong>（UseAuthentication）</li>
<li><strong>压缩响应</strong>（UseResponseCompression）</li>
<li><strong>日志记录与监控</strong>（自定义）</li>
</ul>
<p>例如：要捕获全局异常，可以这样：</p>
<pre><code class="hljs language-arduino" lang="arduino">app.<span class="hljs-built_in">UseExceptionHandler</span>(<span class="hljs-string">"/error"</span>);
</code></pre>
<p>或者写一个自定义全局异常中间件。</p>
<hr/>
<h3 data-id="heading-10">六、开发中常见问题与最佳实践</h3>
<h4 data-id="heading-11">1. 中间件顺序非常关键</h4>
<ul>
<li>错误顺序会导致功能失效</li>
<li>官方文档明确列出了推荐顺序，建议参考</li>
</ul>
<h4 data-id="heading-12">2. 避免在中间件中做耗时操作</h4>
<p>慢中间件会拖垮整个链路。</p>
<h4 data-id="heading-13">3. 如果中止管道，要确保正确设置响应（StatusCode、Header）</h4>
<p>例如，权限不足时返回：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">context.Response.StatusCode</span> = StatusCodes.Status403Forbidden<span class="hljs-comment">;</span>
return<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-14">4. 避免在中间件中直接访问大量业务逻辑</h4>
<p>业务逻辑应该在 Service 层。</p>
<hr/>
<h3 data-id="heading-15">结语</h3>
<p>中间件是 ASP.NET Core 请求处理的基础结构，掌握中间件可以帮助你：</p>
<ul>
<li>更好地理解框架内部机制</li>
<li>编写可维护的横切逻辑（监控、日志、权限等）</li>
<li>构建复杂的请求管理系统</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring AOP底层实现(面试版)]]></title>    <link>https://juejin.cn/post/7581858890607181860</link>    <guid>https://juejin.cn/post/7581858890607181860</guid>    <pubDate>2025-12-10T07:32:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581858890607181860" data-draft-id="7581888578508455963" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AOP底层实现(面试版)"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2025-12-10T07:32:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想用offer打牌"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AOP底层实现(面试版)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想用offer打牌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:32:56.000Z" title="Wed Dec 10 2025 07:32:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>大家好啊，今天我们来讲一下面试中常常遇到的问题--Spring AOP到底是什么，做了什么，使用的好处？许多人就回答一个基于代理模式和JDK动态代理就草草了事，面试官没有得到他想要的答案，自然一直向下深挖,如果面试者无法回答或者突然卡住，给予面试官的感觉就会很差。那么我们下面就来探讨一下吧。</p>
<h2 data-id="heading-1">Spring AOP是什么？好处是什么？</h2>
<p>Spring AOP（面向切面编程）的底层原理主要基于 <strong>代理模式（Proxy Pattern）</strong> ，并结合了 <strong>动态代理技术</strong> 来实现横切关注点（如日志、事务、安全等）与业务逻辑的解耦。其核心思想是在不修改源代码的前提下，对目标方法进行增强。</p>
<p>AOP能够减少重复代码与代码之间的耦合度，而且利于模块未来的扩展性和可维护性。</p>
<h2 data-id="heading-2">Spring AOP的底层原理？</h2>
<p>Spring AOP核心点就是代理模式 + JDK动态代理/CGLIB 动态代理。</p>
<p>其实就两句话：</p>
<p><strong>① 通过“代理对象”拦截方法调用<br/>
② 在方法执行前后织入增强逻辑</strong></p>
<h3 data-id="heading-3">核心流程</h3>
<ul>
<li>
<p><strong>容器启动</strong><br/>
Spring 扫描到你的 <code>@Aspect</code>、<code>@Around</code>、<code>@Before</code> 等增强方法，解析成 <strong>Advisor（通知器）</strong> 。</p>
</li>
<li>
<p><strong>Bean 创建阶段</strong><br/>
当某个 Bean 匹配了 Advisor 的 Pointcut 规则，Spring 会在 <strong>BeanPostProcessor（具体是 <code>AnnotationAwareAspectJAutoProxyCreator</code>）</strong> 中决定 ——  <strong>是否需要为这个 Bean 创建代理对象</strong> 。</p>
</li>
<li>
<p><strong>代理对象创建</strong><br/>
Spring 根据目标类是否有接口，选择：</p>
<ul>
<li>有接口 → <strong>JDK 动态代理</strong></li>
<li>无接口 → <strong>CGLIB 代理（基于子类）</strong></li>
</ul>
</li>
<li>
<p><strong>代理对象拦截方法调用</strong><br/>
当你调用 <code>bean.xxx()</code> 时，其实调用的是代理对象 → 执行增强链 → 最后执行目标方法。</p>
<p>简单来说，就是spring启动的时候会扫一遍那些AOP的切面注解，有bean匹配了相关规则，就会根据是否有实现接口来给他匹配不同的动态代理模式。当该bean调用相关方法，则就会被拦截实现相关增强。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1413bbbfbb14564b3f70c1ba8e9dde1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oOz55Sob2ZmZXLmiZPniYw=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765956776&amp;x-signature=8UP5Vf7tRwEVW6Udqb%2BNiI%2BsNeE%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">代理模式的选择</h3>
<h4 data-id="heading-5">1. JDK 动态代理（基于接口）</h4>
<p>要求目标类必须实现至少一个<strong>接口</strong>。Spring 会为目标对象创建一个实现了相同接口的代理对象。使用 <code>java.lang.reflect.Proxy</code> 和 <code>InvocationHandler</code> 实现，<strong>代理类的父类是<code>Proxy</code></strong>。方法调用时，通过 <code>invoke()</code> 方法拦截，并在其中加入切面逻辑。</p>
<p>Java不允许多继承，代理对象的父类是<code>Proxy</code>，所以只能基于接口实现。</p>
<h4 data-id="heading-6">2. CGLIB 动态代理（基于子类）</h4>
<p>当目标类 <strong>没有实现接口</strong> 时，Spring 默认使用 CGLIB。CGLIB 通过继承目标类，生成子类（代理类），并重写其非 final 方法。代理类在重写的方法中插入切面逻辑。需要引入 <code>cglib</code> 依赖（Spring Boot 中已自动包含）。</p>
<p>总的来说，无论是哪种动态代理，执行相关bean的增强方法时，都是执行相关代理对象的方法，里面包含了增强逻辑和原有逻辑。</p>
<h3 data-id="heading-7">Spring AOP的织入时机</h3>
<p>Spring AOP 是 <strong>运行时代理</strong>（Runtime Weaving），不是编译时或类加载时织入（如 AspectJ）。</p>
<p>具体流程：</p>
<ol>
<li>容器启动时，解析所有 <code>@Aspect</code> 切面类。</li>
<li>根据 <code>@Pointcut</code> 表达式匹配目标 Bean 的方法。</li>
<li>对匹配的 Bean 创建代理对象（JDK 或 CGLIB）。</li>
<li>将代理对象注册到 Spring 容器中，后续注入的是代理对象而非原始对象。</li>
<li>调用方法时，通过代理对象触发通知逻辑。</li>
</ol>
<p>这个流程上面说过了，这里再按步骤说一遍，但是重点说的是代理时机，是<strong>运行时代理</strong>！！！！</p>
<h2 data-id="heading-8">总结</h2>
<p>Spring AOP 的底层原理可以概括为：</p>
<blockquote>
<p><strong>通过动态代理（JDK 或 CGLIB）在运行时为目标 Bean 生成代理对象，并在方法调用前后织入切面逻辑，从而实现非侵入式的功能增强。</strong></p>
</blockquote>
<p>这种设计既保持了代码的清晰性，又实现了关注点分离，是 Spring 框架解耦思想的重要体现</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[photo-sphere-viewer实现虚拟漫游功能开发]]></title>    <link>https://juejin.cn/post/7581814484065452084</link>    <guid>https://juejin.cn/post/7581814484065452084</guid>    <pubDate>2025-12-10T06:17:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581814484065452084" data-draft-id="7581664445241049103" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="photo-sphere-viewer实现虚拟漫游功能开发"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T06:17:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="L1yuu__"/> <meta itemprop="url" content="https://juejin.cn/user/2560082298812072"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            photo-sphere-viewer实现虚拟漫游功能开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2560082298812072/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    L1yuu__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:17:29.000Z" title="Wed Dec 10 2025 06:17:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">一、依赖安装</h2>
<p>1、photo-sphere-viewer依赖于threejs开发的所以要安装threejs</p>
<pre><code class="hljs language-bash" lang="bash">    pnpm add @photo-sphere-viewer/core
    pnpm add threejs
</code></pre>
<p><code>@photo-sphere-viewer/core</code> 为核心模块，其他功能需要以插件形式使用。</p>
<h4 data-id="heading-1">其他功能插件官网查看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fphoto-sphere-viewer.js.org%2Fplugins%2F" target="_blank" title="https://photo-sphere-viewer.js.org/plugins/" ref="nofollow noopener noreferrer">Introduction to plugins | Photo Sphere Viewer</a></h4>
<h2 data-id="heading-2">二、初始化使用</h2>
<pre><code class="hljs language-html" lang="html">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">   <span class="hljs-keyword">const</span> viewer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Viewer</span>({
        <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#container'</span>), <span class="hljs-comment">// 容器(必填) 支持传入dom/容器id:'container'</span>
        <span class="hljs-attr">panorama</span>: <span class="hljs-string">'/img.jpg'</span>, <span class="hljs-comment">// 默认加载的全景图路径，</span>
        <span class="hljs-attr">plugins</span>: [<span class="hljs-title class_">MarkersPlugin</span>] <span class="hljs-comment">// 启用插件列表</span>
    })
</code></pre>
<h4 data-id="heading-3">事件绑定</h4>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-comment">// ready 初始化完成</span>
    viewer.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'ready'</span>, <span class="hljs-function">() =&gt;</span> {})
    <span class="hljs-comment">// click 点击事件</span>
    viewer.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {})
</code></pre>
<h3 data-id="heading-4">三、添加标记插件</h3>
<p>通过<code>viewer.getPlugin(MarkersPlugin)</code>获取初始化时加载的插件</p>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-keyword">const</span> markersPlugin = viewer.<span class="hljs-title function_">getPlugin</span>(<span class="hljs-title class_">MarkersPlugin</span>)
    markersPlugin.<span class="hljs-title function_">setMarkers</span>(markers)
    markersPlugin.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'select-marker'</span>,<span class="hljs-function">(<span class="hljs-params">{marker}</span>) =&gt;</span> {
        <span class="hljs-comment">// 进行标记点击处理 切换全景图操作等...</span>
        <span class="hljs-keyword">const</span> markerData = marker.<span class="hljs-property">data</span>
    })
</code></pre>
<p><code>marker</code>数据格式：</p>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-comment">// 单个标记数据格式 个人推荐使用html，可以很方便的自定义想要的标记样式</span>
   <span class="hljs-keyword">const</span> marker = {
        <span class="hljs-attr">id</span>: <span class="hljs-string">'marker-1'</span>,
        <span class="hljs-attr">html</span>: <span class="hljs-string">`&lt;div class="custom-marker"&gt;&lt;/div&gt;`</span>,
        <span class="hljs-attr">position</span>: {
          <span class="hljs-attr">yaw</span>: <span class="hljs-number">5.796742238036393</span>,
          <span class="hljs-attr">pitch</span>: -<span class="hljs-number">0.07873119086209468</span>
        },
        <span class="hljs-attr">data</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'link'</span>,
          <span class="hljs-attr">linkNodeId</span>: <span class="hljs-string">'scene-2'</span>
        }
      }
</code></pre>
<h3 data-id="heading-5">四、删除标记</h3>
<p><code>markersPlugin.clearMarkers()</code></p>
<h3 data-id="heading-6">五、更换全景图</h3>
<pre><code class="hljs language-javascript" lang="javascript">    viewer.<span class="hljs-title function_">setPanorama</span>(linkNode.<span class="hljs-property">panorama</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// 更换完成的回调</span>
    })
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[主题切换闪烁问题]]></title>    <link>https://juejin.cn/post/7581779319573413926</link>    <guid>https://juejin.cn/post/7581779319573413926</guid>    <pubDate>2025-12-10T06:29:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581779319573413926" data-draft-id="7581779319573364774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="主题切换闪烁问题"/> <meta itemprop="keywords" content="前端,Next.js"/> <meta itemprop="datePublished" content="2025-12-10T06:29:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狐篱"/> <meta itemprop="url" content="https://juejin.cn/user/2568917921575198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            主题切换闪烁问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2568917921575198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狐篱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:29:34.000Z" title="Wed Dec 10 2025 06:29:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">现象与解决方案</h2>
<p>现象：把主题保存在 localStorage 中，下次打开页面会自动打开原来的主题，但是刚打开时会有一个闪烁</p>
<p>原因：因为把读取 localStorage 中的主题值的过程放在 useEffect 中了</p>
<p>在 <code>useEffect</code> 中执行的，其执行顺序为</p>
<ul>
<li>HTML 加载 此时是默认主题色或者浏览器默认颜色</li>
<li>React 挂载，渲染页面</li>
<li>执行 useEffect 重新渲染页面，此时应用保存在 localStorage 中的主题变量和主题色</li>
</ul>
<p>正确做法是，应该放在 createRoot 之前同步执行，避免闪烁</p>
<pre><code class="hljs language-js" lang="js">(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
	<span class="hljs-keyword">const</span> savedTheme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'theme'</span>);
	<span class="hljs-keyword">const</span> browserTheme = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">'(prefers-color-scheme: dark)'</span>).<span class="hljs-property">matches</span> ? <span class="hljs-string">'dark'</span> : <span class="hljs-string">'light'</span>;
	<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-theme'</span>, savedTheme || browserTheme || <span class="hljs-string">'light'</span>);
})();
</code></pre>
<h2 data-id="heading-1">实现过程</h2>
<p>先介绍一下切换主题要用到的知识点</p>
<h3 data-id="heading-2">:root 和 html</h3>
<p><code>:root</code> 这个伪类匹配文档树的根元素，在 HTML 中代表的就是  <code>&lt;html&gt;</code> 标签，但是优先级比 <code>html元素选择器</code> 高</p>
<pre><code class="hljs language-css" lang="css">// demo 中 <span class="hljs-selector-tag">html</span> 选择器写在 <span class="hljs-selector-pseudo">:root</span> 后面，如果同优先级应该是后者优先的，实际上确实红色，说明 <span class="hljs-selector-pseudo">:root</span> 优先
<span class="hljs-selector-pseudo">:root</span> {
	<span class="hljs-attribute">background</span>: red; // 此时页面为红色，注释掉这行时页面呈黄色
}
<span class="hljs-selector-tag">html</span> {
	<span class="hljs-attribute">background</span>: yellow;
}
</code></pre>
<h3 data-id="heading-3">系统主题色</h3>
<p><strong>后面提到的主题都可以理解为模式（参考 Chrome - 设置 - 外观 - 模式 只能选择深色浅色和自动，而主题可以自定义）</strong>
DevTools 中 <code>cmd + shift + p</code> 搜索 <code>dark</code> 或 <code>light</code> 可以模拟对应主题色（搜索不到浏览器当前的主题色）</p>
<h4 data-id="heading-4">color-scheme</h4>
<p>允许元素按照哪些颜色方案呈现，简单来说就是 <strong>按照浏览器模式显示页面</strong>，常见选择为 亮色 light 和 暗色 dark，页面的默认颜色会按照系统模式显示</p>
<pre><code class="hljs language-css" lang="css">注意：
	<span class="hljs-number">1</span>.是按照浏览器的模式，而非主题
	<span class="hljs-number">2</span>.是按照模式显示，而不是给 <span class="hljs-selector-tag">html</span> 元素添加颜色，打开一个空白 <span class="hljs-selector-tag">html</span> 页面可以看到，背景颜色、文字颜色、滚动条颜色都会受到影响(可以视为，只对没有通过 css 设置的样式生效，优先级最低)
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
	<span class="hljs-attribute">color</span>-scheme: ligth dark;
}
</code></pre>
<h4 data-id="heading-5">CSS 媒体查询</h4>
<p>CSS 媒体查询检测系统浏览器主题色是否为深色，<code>prefers-color-scheme</code></p>
<p>html 文件中只写这两个样式，切换浏览器模式，发现不管是 dark 还是 light 模式，都是显示蓝色，说明 <code>@media (prefers-color-scheme: dark)</code> 比 <code>[data-theme='dark']</code> 优先级更低</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span><span class="hljs-selector-attr">[data-theme=<span class="hljs-string">'dark'</span>]</span> {
	<span class="hljs-selector-tag">body</span> {
		<span class="hljs-attribute">background</span>: blue;
	}
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme</span>: dark) {
	<span class="hljs-selector-pseudo">:root</span> {
		<span class="hljs-selector-tag">body</span> {
			<span class="hljs-attribute">background</span>: red;
		}
	}
}
</code></pre>
<p>一般情况下都会使用 JS 来获取 localStorage 或 浏览器主题，不需要使用 <code>@media (prefers-color-scheme: dark)</code> 来实现主题切换, 如果需要纯 CSS 实现颜色变量切换就可以使用了(比如禁用 js 时？)</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
	<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#FFF</span>;
	<span class="hljs-attr">--color-text</span>: <span class="hljs-number">#000</span>;
	<span class="hljs-attr">--size-sm</span>: <span class="hljs-number">12px</span>;
}
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme</span>: dark) {
	<span class="hljs-selector-pseudo">:root</span> {
		<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#000</span>;
		<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#FFF</span>;
	}
}
</code></pre>
<h4 data-id="heading-6">JS 媒体查询</h4>
<p>JS 查询 <code>window.matchMedia()</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> darkModeMediaQuery = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">'(prefers-color-scheme: dark)'</span>);
darkModeMediaQuery.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> darkModeOn = e.<span class="hljs-property">matches</span>
	<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Dark Mode is'</span>, darkModeOn);
})
</code></pre>
<p>完整的 CSS 变量声明</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
	<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#FFF</span>;
	<span class="hljs-attr">--color-text</span>: <span class="hljs-number">#000</span>;
	<span class="hljs-attr">--size-sm</span>: <span class="hljs-number">12px</span>;
}
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme</span>: dark) {
	<span class="hljs-selector-pseudo">:root</span> {
		<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#000</span>;
		<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#FFF</span>;
	}
}
<span class="hljs-selector-pseudo">:root</span> {
	<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#000</span>;
	<span class="hljs-attr">--color-background</span>: <span class="hljs-number">#FFF</span>;
}
</code></pre>
<h3 data-id="heading-7">next.js 项目中保存主题</h3>
<p>为了避免闪烁问题，在 React 项目中应该在 <code>createRoot</code> 之前获取 localStorage 保存的主题，而在 Next.js 项目中，情况又会复杂一些
方案一：在 layout 中使用内联脚本执行
方案二：使用 next-themes 实现，会自动给 html 添加 color-scheme 属性（原理其实一样）</p>
<p>两种方法都很不难，但是按照传统的代码实现中间容易遇到两个问题</p>
<p>传统代码一般是 <code>const [theme, setTheme] = useState('light')</code> 初始化主题变量，<code>useEffect</code> 中读取 localStorage 值并 <code>setTheme</code>，最新版 react 的 eslint 配置会报错 <code>react/set-state-in-effect</code>
可以直接关掉这条规则，但是仔细考虑一下这条规则出现的原因，确实应该尽量遵守，不应该为了读取一个值重复渲染一次，应该在初始化 state 的时候就进行赋值</p>
<p>改成 <code>const [theme, setTheme] = useState(() =&gt; localStorage.getItem('theme'))</code>，eslint 报错没了，但是 next.js 又报错了，大致意思就是 <em>水合过程中发现服务端预渲染的结果和客户端渲染结果不一致</em>，按照 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fmessages%2Freact-hydration-error" target="_blank" title="https://nextjs.org/docs/messages/react-hydration-error" ref="nofollow noopener noreferrer">官方文档</a> 的解决方案，使用 <code>supressHydrationWarning={true}</code> 或者 <code>dynamic</code>
官方推荐尽量不使用 <code>suppressHydrationWarning</code>，而且实际情况中可能很多地方使用（上一个简单 demo 则只需要在 button 属性上增加即可），所以我们采用 <code>dynamic</code> 方案，官方推荐的是在引入组件时包裹一层，但是考虑到我们是通用组件的话，可以在导出的时候包裹一层即可</p>
<p>解决 <code>react/set-state-in-effect</code> 并保存到 localStorage 代码如下</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Theme</span> = <span class="hljs-string">'dark'</span> | <span class="hljs-string">'light'</span>;
<span class="hljs-keyword">const</span> getBrowserTheme = (): <span class="hljs-function"><span class="hljs-params">Theme</span> =&gt;</span> {
	<span class="hljs-keyword">const</span> isDark =  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">'(prefers-color-scheme: dark)'</span>).<span class="hljs-property">matches</span>;
	<span class="hljs-keyword">return</span> isDark ? <span class="hljs-string">'dark'</span> : <span class="hljs-string">'light'</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title class_">ToggleTheme</span> {
	<span class="hljs-comment">// 初始化页面主题是通过前面提到过的 createRoot 之前获取，这里只是初始化切换主题的按钮文案</span>
	<span class="hljs-keyword">const</span> [theme, setTheme] = useState&lt;<span class="hljs-title class_">Theme</span>&gt;(<span class="hljs-string">'light'</span>);
	<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleToggleTheme</span> = (<span class="hljs-params">t: Theme</span>) =&gt; {
		<span class="hljs-title function_">setTheme</span>(t);
		<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'theme'</span>, t);
		<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'theme'</span>, t);
	}
	<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
		<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleStorage</span> = (<span class="hljs-params">e: StorageEvent</span>) =&gt; {
			<span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> !== <span class="hljs-string">'theme'</span>) <span class="hljs-keyword">return</span>;
			<span class="hljs-keyword">if</span> (!e.<span class="hljs-property">newValue</span>) {
				<span class="hljs-comment">// localStorage 值不存在则获取浏览器模式</span>
				<span class="hljs-title function_">setTheme</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">getBrowserTheme</span>());
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-comment">// 存在则改变 theme</span>
				<span class="hljs-title function_">setTheme</span>(e.<span class="hljs-property">newValue</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Theme</span>);
			}
		};
		<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'storage'</span>, handleStorage);
		<span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'storage'</span>, handleStorage);
	})

	<span class="hljs-keyword">return</span> (
		<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleToggleTheme(theme === 'dark' ? 'light' : 'dark')}&gt;{theme}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
	)
}
</code></pre>
<p><strong>浏览器监听 storage 事件用于跨标签/窗口同步数据，当前窗口修改 localStorage 时不会触发当前窗口的监听</strong></p>
<p>解决 next.js Hydrate 过程中服务端预渲染和客户端渲染结果不一致方案</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 官方推荐</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params"/>) {};

<span class="hljs-comment">// 引入的地方动态引入包裹一层，然后使用 DynamicToggle</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DynamicToggle</span> = <span class="hljs-title function_">dyanmic</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../componnents/Toggle'</span>), {<span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span>});

<span class="hljs-comment">// 我的代码</span>
<span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">'next/dynamic'</span>;

<span class="hljs-comment">// 简化的组件 demo，真是情况应该参考上面的 demo</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Toggle</span> = (<span class="hljs-params"/>) =&gt; {
	<span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useTheme</span>();
	<span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setTheme(theme === 'dark' ? 'light' : 'dark')}&gt;{theme}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
};

<span class="hljs-keyword">const</span> <span class="hljs-title class_">DynamicToggle</span> = <span class="hljs-title function_">dynamic</span>(<span class="hljs-title class_">Toggle</span>, {<span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span>});
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DynamicToggle</span>;
</code></pre>
<h3 data-id="heading-8">document.startViewTransition</h3>
<p><code>document.startViewTransition(cb)</code> 开始一个新的视图过渡，可以理解为在 DOM 发生变化的过程中展示一层过渡动效，常见的例子</p>
<ul>
<li>图片预览页切换图片</li>
<li>切换主题按钮点击后整个页面发生一个区域覆盖过程</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleTheme</span> = (<span class="hljs-params">t</span>) =&gt; {
	<span class="hljs-comment">// ...</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleWithTransition</span> = (<span class="hljs-params">t</span>) =&gt; {
	<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">startViewTransition</span>) {
		<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">startViewTransition</span>(<span class="hljs-function">() =&gt;</span> {
			<span class="hljs-title function_">toggleTheme</span>(t);
		})
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-title function_">toggleTheme</span>(t);
	}
}
</code></pre>
<p>具体动效由 <code>::viewtransition-new</code> 和 <code>::viewtransition-old</code> 的样式决定</p>
<pre><code class="hljs language-css" lang="css">::<span class="hljs-built_in">view-transition-new</span>(root) {
  <span class="hljs-attribute">mask</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">'data:image/svg+xml,&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"&gt;&lt;circle cx="20" cy="20" r="20" fill="white"/&gt;&lt;/svg&gt;'</span>)
    center / <span class="hljs-number">0</span> no-repeat;
  <span class="hljs-attribute">animation</span>: scale <span class="hljs-number">1s</span>;
  <span class="hljs-attribute">animation-fill-mode</span>: both;
}

::<span class="hljs-built_in">view-transition-old</span>(root),
.dark::<span class="hljs-built_in">view-transition-old</span>(root) {
  <span class="hljs-attribute">animation</span>: none;
  <span class="hljs-attribute">animation-fill-mode</span>: both;
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}
<span class="hljs-selector-class">.dark</span>::<span class="hljs-built_in">view-transition-new</span>(root) {
  <span class="hljs-attribute">animation</span>: scale <span class="hljs-number">1s</span>;
  <span class="hljs-attribute">animation-fill-mode</span>: both;
}

<span class="hljs-keyword">@keyframes</span> scale {
  <span class="hljs-selector-tag">to</span> {
    <span class="hljs-attribute">mask-size</span>: <span class="hljs-number">200vmax</span>;
  }
}
</code></pre>
<p>可以 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftheme-toggle.rdsx.dev%2F" target="_blank" title="https://theme-toggle.rdsx.dev/" ref="nofollow noopener noreferrer">参考开源</a> 的动效，直接 copy 代码进行微调</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[无废话系列之 use client ≠ client only]]></title>    <link>https://juejin.cn/post/7581779319573430310</link>    <guid>https://juejin.cn/post/7581779319573430310</guid>    <pubDate>2025-12-10T06:29:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581779319573430310" data-draft-id="7581888578536898598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="无废话系列之 use client ≠ client only "/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T06:29:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户43466215313"/> <meta itemprop="url" content="https://juejin.cn/user/3071363606385689"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            无废话系列之 use client ≠ client only 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3071363606385689/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户43466215313
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:29:54.000Z" title="Wed Dec 10 2025 06:29:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今儿部门新人问我：“已经在页面里写明了use client了，为什么还是报错 Hydration failed 啊？”</p>
<p>原因是他在代码里写了<code>typeof window !== 'undefined'</code>。</p>
<p>下面我会把 <strong>为什么 <code>use client</code> 仍然会出现 Hydration failed</strong> 这个问题完整讲清楚，因为这是 Next.js 里非常常见的误解。</p>
<h3 data-id="heading-0">✅ <strong>结论先说：<code>use client</code> ≠ 只在客户端运行</strong></h3>
<p>这是大家最容易误解的点。</p>
<p>✔ <strong><code>use client</code> 的真正含义：</strong></p>
<blockquote>
<p>“让这个组件在客户端 可以使用 React 的交互功能（如 useState/useEffect）”</p>
<p>但 <strong>组件本身仍然会在服务端执行一次来生成 HTML（SSR）</strong> ，然后再在客户端 hydration。</p>
</blockquote>
<p>所以：</p>
<ul>
<li>你写了 <code>use client</code></li>
<li>但组件仍然 <strong>会在服务端运行一次（Node 环境）</strong></li>
<li>服务端渲染出来的 HTML 会发送给浏览器</li>
<li>浏览器再执行相同的 React 代码进行 hydration</li>
</ul>
<p>⚠ 因此，即使是 Client Component，它的 <strong>模块初始化代码（顶层代码）仍然会在服务器跑一次</strong>。</p>
<p>❌ <strong>因此：顶层使用 <code>window</code> 依旧会报错</strong></p>
<p>你写：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
  ...
}
</code></pre>
<p>这个语句依旧会被 <strong>服务端执行一次</strong>（因为 SSR 需要它），虽然不会崩溃，但关键问题是</p>
<p>❌ <strong>SSR 输出的 HTML 与 CSR 输出的 HTML 不一致 → hydration fail</strong></p>
<p>示例：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">"use client"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> text = <span class="hljs-string">"hello"</span>;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">"undefined"</span>) {
    text = <span class="hljs-string">"hello from client"</span>;
  }

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{text}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

</code></pre>
<p>服务器执行时：</p>
<ul>
<li><code>typeof window === 'undefined'</code></li>
<li>text = <code>"hello"</code></li>
</ul>
<p>浏览器执行 hydration 时：</p>
<ul>
<li><code>typeof window !== 'undefined'</code></li>
<li>text = <code>"hello from client"</code></li>
</ul>
<p>最终 HTML 不一致：</p>













<table><thead><tr><th>Server HTML</th><th>Client HTML</th></tr></thead><tbody><tr><td><code>&lt;div&gt;hello&lt;/div&gt;</code></td><td><code>&lt;div&gt;hello from client&lt;/div&gt;</code></td></tr></tbody></table>
<p>➡ <strong>直接导致：Hydration failed</strong></p>
<p>🔥 所以重点：</p>
<p>✔ <strong>Client Component 依然会 SSR，因此不能在渲染逻辑里使用 window。</strong></p>
<p>✔ 但可以在 <code>useEffect</code> 里使用，因为 effect 只在客户端执行。</p>
<h3 data-id="heading-1"><strong>推荐写法（100% 不会 Hydration failed）</strong></h3>
<p>如果你要用 <code>window</code>、<code>document</code>、<code>localStorage</code> 等：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">"use client"</span>;

<span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"hello"</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setText</span>(<span class="hljs-string">"hello from client"</span>);
  }, []);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{text}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>✔ SSR 输出：<code>hello</code></p>
<p>✔ 客户端 hydration 输出：<code>hello</code>（一致）</p>
<p>✔ hydration 后 useEffect 修改内容 → 不会报错</p>
<h3 data-id="heading-2"><strong>那什么时候可以用 <code>typeof window !== 'undefined'</code>？</strong></h3>
<p>✔ <strong>只能在 effect / event handler 里用</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);
  }
}, []);
</code></pre>
<p>❌ 不能用于：</p>
<ul>
<li>顶层逻辑</li>
<li>render 逻辑（JSX 里）</li>
<li><code>useState</code> 初始值函数</li>
<li>影响 SSR 输出的地方</li>
</ul>
<h3 data-id="heading-3">如果真的要完全避免 SSR？</h3>
<p>你需要 <strong>动态关闭 SSR</strong>，而不是仅仅 <code>use client</code>：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Page</span> = <span class="hljs-title function_">dynamic</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./page-client"</span>), {
  <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span>
});
</code></pre>
<p>这样组件 <strong>完全在客户端渲染，不再进行 hydration 匹配</strong>。</p>
<h3 data-id="heading-4">总结（重要）</h3>

























<table><thead><tr><th>误解</th><th>正确理解</th></tr></thead><tbody><tr><td><code>use client</code> = only client</td><td>❌ 错</td></tr><tr><td>Client Component 不会在服务器执行</td><td>❌ 会在服务器执行一次（SSR）</td></tr><tr><td>能直接在 JSX 或顶层使用 window</td><td>❌ 会导致 SSR/CSR 内容不一致</td></tr><tr><td>需要浏览器 API → 用 <code>useEffect</code></td><td>✔ 正确做法</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[package.json中的overrides用法]]></title>    <link>https://juejin.cn/post/7581786379804639267</link>    <guid>https://juejin.cn/post/7581786379804639267</guid>    <pubDate>2025-12-10T06:40:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379804639267" data-draft-id="7581786379804606499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="package.json中的overrides用法"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T06:40:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="404号扳手"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919022807"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            package.json中的overrides用法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919022807/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    404号扳手
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:40:29.000Z" title="Wed Dec 10 2025 06:40:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 <code>package.json</code> 中，<code>overrides</code> 是一个非常强大的功能，主要用于<strong>强制覆盖项目依赖树中某些包的版本</strong>。</p>
<p>简单来说，当你遇到“依赖冲突”（比如 A 组件需要 React 17，B 组件需要 React 18）或者需要修复某个深层嵌套的子依赖漏洞时，<code>overrides</code> 可以帮你强制统一版本。</p>
<p>需要注意的是，<strong>不同的包管理工具（npm、pnpm、Yarn）对 <code>overrides</code> 的支持和写法略有不同</strong>。以下我为你详细梳理了它的核心用法、语法格式以及注意事项。</p>
<h3 data-id="heading-0">🛠️ 核心作用：解决什么问题？</h3>
<ol>
<li><strong>解决依赖冲突</strong>：强制将多个版本的同一个包统一为一个版本，减少 <code>node_modules</code> 体积并避免运行时错误。</li>
<li><strong>修复安全漏洞</strong>：当某个深层的子依赖（例如 <code>lodash</code> 或 <code>axios</code> 的某个旧版本）存在安全漏洞时，强制将其升级到安全版本。</li>
<li><strong>强制升级/降级</strong>：在某些库的最新版本有 Bug 时，强制锁定到一个稳定的旧版本。</li>
<li><strong>替换包源</strong>：强制将某个包替换为你自己的 Fork 版本或内网版本。</li>
</ol>
<hr/>
<h3 data-id="heading-1">📜 语法格式详解</h3>
<p><code>overrides</code> 的语法支持<strong>嵌套写法</strong>和<strong>路径写法</strong>，这两种写法在 npm 和 pnpm 中通常都支持。</p>
<h4 data-id="heading-2">1. 基础写法（对象嵌套）</h4>
<p>这种写法层级清晰，适合覆盖特定依赖下的子依赖。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"18.2.0"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 全局覆盖：强制所有 react 版本为 18.2.0</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 全局覆盖：修复安全漏洞</span>
    <span class="hljs-attr">"some-package"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"17.0.0"</span> <span class="hljs-comment">// 嵌套覆盖：仅强制 some-package 依赖的 react 为 17.0.0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"foo"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"bar"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0.0"</span> <span class="hljs-comment">// 嵌套覆盖：仅强制 foo 依赖的 bar 子依赖为 2.0.0</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-3">2. 高级写法（路径与通配符）</h4>
<p>这种写法更灵活，支持通配符和更复杂的路径匹配。</p>






























<table><thead><tr><th align="left">工具</th><th align="left">语法示例</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>npm / pnpm</strong></td><td align="left"><code>"foo&gt;bar": "2.0.0"</code></td><td align="left">使用 <code>&gt;</code> 表示 foo 的直接依赖 bar</td></tr><tr><td align="left"><strong>npm / pnpm</strong></td><td align="left"><code>"foo&gt;bar&gt;baz": "1.0.0"</code></td><td align="left">支持多级路径</td></tr><tr><td align="left"><strong>pnpm</strong></td><td align="left"><code>"**&gt;foo": "1.0.0"</code></td><td align="left">使用 <code>**</code> 通配符匹配所有层级</td></tr><tr><td align="left"><strong>Yarn</strong></td><td align="left"><code>"foo/bar": "2.0.0"</code></td><td align="left">Yarn v2+ 的路径写法</td></tr></tbody></table>
<h4 data-id="heading-4">3. 特殊操作（仅 pnpm 支持）</h4>
<p>如果你使用的是 <strong>pnpm</strong>，它的 <code>pnpm.overrides</code> 功能最为强大，支持一些特殊操作：</p>
<ul>
<li>
<p><strong>删除依赖</strong>：使用 <code>-</code> 可以删除某个不需要的子依赖（例如删除不必要的日志包）。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"pnpm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"lodash&gt;request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-"</span> 
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li>
<p><strong>引用顶层版本</strong>：使用 <code>$</code> 符号，让子依赖去引用项目顶层安装的版本，而不是自己安装一份。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">🛠️ 不同包管理工具的配置差异</h3>
<p>为了防止配置后不生效，请务必确认你使用的包管理器，并参考下表进行配置：</p>

























<table><thead><tr><th align="left">包管理器</th><th align="left">配置字段</th><th align="left">兼容性/备注</th></tr></thead><tbody><tr><td align="left"><strong>npm</strong></td><td align="left"><code>overrides</code></td><td align="left">需要 <strong>npm v8+</strong> 才支持。</td></tr><tr><td align="left"><strong>pnpm</strong></td><td align="left"><code>pnpm.overrides</code></td><td align="left">功能最强大。同时也支持 <code>resolutions</code> 作为别名。</td></tr><tr><td align="left"><strong>Yarn</strong></td><td align="left"><code>resolutions</code></td><td align="left">Yarn 默认不支持 <code>overrides</code>，使用 <code>resolutions</code>。</td></tr></tbody></table>
<p><strong>示例：pnpm 的配置方式</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pnpm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"overrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"webpack"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.75.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"18.2.0"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">⚠️ 注意事项与最佳实践</h3>
<p>虽然 <code>overrides</code> 很好用，但我也建议你谨慎使用：</p>
<ol>
<li><strong>兼容性风险</strong>：强制覆盖版本可能会导致依赖该包的其他库无法正常工作（例如强行给一个需要 React 18 的组件塞入 React 17，可能会报错）。<strong>修改后务必进行充分测试。</strong></li>
<li><strong>版本范围</strong>：你可以使用版本范围（如 <code>^18.0.0</code> 或 <code>&gt;=18</code>），但为了稳定性，建议在解决冲突时直接指定具体的版本号。</li>
<li><strong>清理缓存</strong>：如果配置了 <code>overrides</code> 但发现没生效，通常是因为旧的依赖缓存还在。建议删除 <code>node_modules</code> 和锁文件（<code>package-lock.json</code> 或 <code>pnpm-lock.yaml</code>），然后重新执行 <code>npm install</code> 或 <code>pnpm install</code>。</li>
<li><strong>优先级</strong>：<code>overrides</code> 的优先级高于 <code>dependencies</code> 和 <code>devDependencies</code>。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[优雅实现防抖与节流]]></title>    <link>https://juejin.cn/post/7581752508781150251</link>    <guid>https://juejin.cn/post/7581752508781150251</guid>    <pubDate>2025-12-10T05:54:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752508781150251" data-draft-id="7581752508781133867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="优雅实现防抖与节流"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T05:54:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            优雅实现防抖与节流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T05:54:53.000Z" title="Wed Dec 10 2025 05:54:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">优雅实现防抖与节流</h2>
<h3 data-id="heading-1">🤔 为什么需要防抖与节流？</h3>
<p>在前端开发中，我们经常会遇到一些高频触发的事件，比如：</p>
<ul>
<li>窗口缩放（resize）</li>
<li>页面滚动（scroll）</li>
<li>输入框输入（input）</li>
<li>按钮频繁点击（click）</li>
</ul>
<p>这些事件如果不加以控制，会导致大量的函数调用，从而影响页面性能。想象一下：用户在输入框快速输入时，每次按键都触发一次API请求——这不仅浪费带宽，还会导致页面卡顿！</p>
<p>防抖（Debounce）和节流（Throttle）就是为了解决这个问题而生的。它们可以有效地控制函数的执行频率，提升页面性能和用户体验。</p>
<h3 data-id="heading-2">💡 基础概念与实现</h3>
<h4 data-id="heading-3">什么是防抖（Debounce）？</h4>
<p>防抖的核心思想是：<strong>如果一个函数被频繁调用，只有当调用停止一段时间后，才执行最后一次调用</strong>。</p>
<p>形象地说：就像坐电梯，只有当没有人再进入电梯时，电梯才会关门运行。</p>
<h5 data-id="heading-4">防抖的基础实现</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 防抖函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">func</span> - 要执行的函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">delay</span> - 延迟时间（毫秒）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Function</span>} 防抖处理后的函数
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, delay</span>) {
  <span class="hljs-keyword">let</span> timeoutId;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-comment">// 清除之前的定时器</span>
    <span class="hljs-built_in">clearTimeout</span>(timeoutId);
    
    <span class="hljs-comment">// 设置新的定时器</span>
    timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 执行函数，保持this上下文</span>
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    }, delay);
  };
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> debouncedSearch = <span class="hljs-title function_">debounce</span>(<span class="hljs-function">(<span class="hljs-params">keyword</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'搜索:'</span>, keyword);
  <span class="hljs-comment">// 这里可以发送API请求</span>
}, <span class="hljs-number">300</span>);

<span class="hljs-comment">// 在输入框事件中使用</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'searchInput'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-title function_">debouncedSearch</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);
});
</code></pre>
<h4 data-id="heading-5">什么是节流（Throttle）？</h4>
<p>节流的核心思想是：<strong>限制函数在一定时间内只能执行一次</strong>。</p>
<p>形象地说：就像水龙头，即使一直开着，也只会每隔一段时间流出一滴水。</p>
<h5 data-id="heading-6">节流的基础实现</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 节流函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">func</span> - 要执行的函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">limit</span> - 时间限制（毫秒）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Function</span>} 节流处理后的函数
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">func, limit</span>) {
  <span class="hljs-keyword">let</span> inThrottle;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (!inThrottle) {
      <span class="hljs-comment">// 执行函数，保持this上下文</span>
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      
      <span class="hljs-comment">// 标记为已执行</span>
      inThrottle = <span class="hljs-literal">true</span>;
      
      <span class="hljs-comment">// 一段时间后重置标记</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        inThrottle = <span class="hljs-literal">false</span>;
      }, limit);
    }
  };
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> throttledScroll = <span class="hljs-title function_">throttle</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动位置:'</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>);
  <span class="hljs-comment">// 这里可以处理滚动事件</span>
}, <span class="hljs-number">200</span>);

<span class="hljs-comment">// 在滚动事件中使用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, throttledScroll);
</code></pre>
<h3 data-id="heading-7">🚀 React中的防抖与节流实现</h3>
<p>在React中，我们可以将防抖和节流封装成自定义Hook，以便在组件中更方便地使用。</p>
<h4 data-id="heading-8">自定义防抖Hook：useDebounce</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">/**
 * 防抖Hook
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">value</span> - 要防抖的值
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">delay</span> - 延迟时间（毫秒）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any</span>} 防抖后的值
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useDebounce</span>(<span class="hljs-params">value, delay</span>) {
  <span class="hljs-keyword">const</span> [debouncedValue, setDebouncedValue] = <span class="hljs-title function_">useState</span>(value);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 设置定时器</span>
    <span class="hljs-keyword">const</span> handler = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setDebouncedValue</span>(value);
    }, delay);

    <span class="hljs-comment">// 清理函数：组件卸载或依赖变化时清除定时器</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(handler);
    };
  }, [value, delay]);

  <span class="hljs-keyword">return</span> debouncedValue;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [keyword, setKeyword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> debouncedKeyword = <span class="hljs-title function_">useDebounce</span>(keyword, <span class="hljs-number">300</span>);

  <span class="hljs-comment">// 当防抖后的关键词变化时，发送API请求</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (debouncedKeyword) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'搜索:'</span>, debouncedKeyword);
      <span class="hljs-comment">// 发送API请求</span>
    }
  }, [debouncedKeyword]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span>
      <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
      <span class="hljs-attr">value</span>=<span class="hljs-string">{keyword}</span>
      <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setKeyword(e.target.value)}
      placeholder="输入关键词搜索..."
    /&gt;</span>
  );
}
</code></pre>
<h4 data-id="heading-9">自定义节流Hook：useThrottle</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useRef, useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">/**
 * 节流Hook
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} <span class="hljs-variable">value</span> - 要节流的值
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">limit</span> - 时间限制（毫秒）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">any</span>} 节流后的值
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useThrottle</span>(<span class="hljs-params">value, limit</span>) {
  <span class="hljs-keyword">const</span> [throttledValue, setThrottledValue] = <span class="hljs-title function_">useState</span>(value);
  <span class="hljs-keyword">const</span> lastRan = <span class="hljs-title function_">useRef</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> handler = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - lastRan.<span class="hljs-property">current</span> &gt;= limit) {
        <span class="hljs-title function_">setThrottledValue</span>(value);
        lastRan.<span class="hljs-property">current</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      }
    }, limit - (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - lastRan.<span class="hljs-property">current</span>));

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">clearTimeout</span>(handler);
    };
  }, [value, limit]);

  <span class="hljs-keyword">return</span> throttledValue;
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ScrollComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [scrollY, setScrollY] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> throttledScrollY = <span class="hljs-title function_">useThrottle</span>(scrollY, <span class="hljs-number">200</span>);

  <span class="hljs-comment">// 监听滚动事件</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">setScrollY</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>);
    };

    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll);
  }, []);

  <span class="hljs-comment">// 当节流后的滚动位置变化时，执行处理</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动位置:'</span>, throttledScrollY);
    <span class="hljs-comment">// 处理滚动事件</span>
  }, [throttledScrollY]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>当前滚动位置：{throttledScrollY}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-10">🎯 Vue 3中的防抖与节流实现</h3>
<p>在Vue 3中，我们可以使用Composition API来实现防抖和节流功能。</p>
<h4 data-id="heading-11">自定义防抖Composable：useDebounce</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, watch } from 'vue';

/**
 * 防抖Composable
 * @param {any} initialValue - 初始值
 * @param {number} delay - 延迟时间（毫秒）
 * @returns {Object} 包含原始值和防抖后的值
 */
function useDebounce(initialValue, delay) {
  const value = ref(initialValue);
  const debouncedValue = ref(initialValue);
  let timeoutId;

  // 监听值的变化，设置防抖
  watch(value, (newValue) =&gt; {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() =&gt; {
      debouncedValue.value = newValue;
    }, delay);
  });

  return {
    value,
    debouncedValue
  };
}

// 使用示例
const { value: keyword, debouncedValue: debouncedKeyword } = useDebounce('', 300);

// 监听防抖后的值变化
watch(debouncedKeyword, (newKeyword) =&gt; {
  if (newKeyword) {
    console.log('搜索:', newKeyword);
    // 发送API请求
  }
});
&lt;/script&gt;

&lt;template&gt;
  &lt;input
    v-model="keyword"
    type="text"
    placeholder="输入关键词搜索..."
  /&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-12">自定义节流Composable：useThrottle</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, watch } from 'vue';

/**
 * 节流Composable
 * @param {any} initialValue - 初始值
 * @param {number} limit - 时间限制（毫秒）
 * @returns {Object} 包含原始值和节流后的值
 */
function useThrottle(initialValue, limit) {
  const value = ref(initialValue);
  const throttledValue = ref(initialValue);
  let lastRan = Date.now();
  let timeoutId;

  // 监听值的变化，设置节流
  watch(value, (newValue) =&gt; {
    const now = Date.now();
    if (now - lastRan &gt;= limit) {
      throttledValue.value = newValue;
      lastRan = now;
    } else {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() =&gt; {
        throttledValue.value = newValue;
        lastRan = Date.now();
      }, limit - (now - lastRan));
    }
  });

  return {
    value,
    throttledValue
  };
}

// 使用示例
import { onMounted, onUnmounted } from 'vue';

const { value: scrollY, throttledValue: throttledScrollY } = useThrottle(0, 200);

// 监听滚动事件
onMounted(() =&gt; {
  const handleScroll = () =&gt; {
    scrollY.value = window.scrollY;
  };
  window.addEventListener('scroll', handleScroll);
  
  onUnmounted(() =&gt; {
    window.removeEventListener('scroll', handleScroll);
  });
});

// 监听节流后的滚动位置变化
watch(throttledScrollY, (newScrollY) =&gt; {
  console.log('滚动位置:', newScrollY);
  // 处理滚动事件
});
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;当前滚动位置：{{ throttledScrollY }}&lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-13">⚠️ 注意事项与最佳实践</h3>
<h4 data-id="heading-14">1. 防抖与节流的选择</h4>
<ul>
<li><strong>防抖</strong>适合：输入框搜索、表单验证、窗口大小调整等需要等待用户操作完成后再执行的场景</li>
<li><strong>节流</strong>适合：滚动事件、鼠标移动、按钮点击频率限制等需要限制执行频率的场景</li>
</ul>
<h4 data-id="heading-15">2. 延迟时间的选择</h4>
<ul>
<li>输入框搜索：一般300-500ms</li>
<li>滚动事件：一般200-300ms</li>
<li>窗口调整：一般500-1000ms</li>
<li>按钮点击：一般500-1000ms</li>
</ul>
<h4 data-id="heading-16">3. 内存泄漏问题</h4>
<ul>
<li>确保在组件卸载或不再需要时，清除定时器</li>
<li>使用React的useEffect清理函数或Vue的onUnmounted钩子</li>
</ul>
<h4 data-id="heading-17">4. 函数上下文（this）</h4>
<ul>
<li>在使用防抖和节流时，要注意保持函数的this上下文</li>
<li>使用apply/call/bind来确保this指向正确</li>
</ul>
<h4 data-id="heading-18">5. 传递参数</h4>
<ul>
<li>确保防抖和节流函数能够正确传递参数</li>
<li>在实现时要考虑到不定参数的情况</li>
</ul>
<h3 data-id="heading-19">📝 总结</h3>
<p>防抖和节流是前端开发中非常重要的性能优化手段，它们可以有效地控制函数的执行频率，提升页面性能和用户体验。</p>
<p>通过本文的介绍，我们学习了：</p>
<ol>
<li><strong>基础概念</strong>：防抖（延迟执行）和节流（限制执行频率）</li>
<li><strong>手写实现</strong>：掌握了防抖和节流的核心算法</li>
<li><strong>框架应用</strong>：在React和Vue 3中如何使用自定义Hook/Composable实现</li>
<li><strong>最佳实践</strong>：如何根据场景选择合适的方法，以及使用时的注意事项</li>
</ol>
<p>希望这个小技巧对你有所帮助！下次遇到高频触发的事件时，不妨试试防抖或节流吧～🌸</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FEvents%2Fresize%23debounce" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/Events/resize#debounce" ref="nofollow noopener noreferrer">MDN - 防抖与节流</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact" target="_blank" title="https://react.dev/reference/react" ref="nofollow noopener noreferrer">React官方文档 - Hooks</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fextras%2Fcomposition-api-faq.html" target="_blank" title="https://vuejs.org/guide/extras/composition-api-faq.html" ref="nofollow noopener noreferrer">Vue官方文档 - Composition API</a></li>
</ul>
<p><strong>标签：</strong> #前端性能优化 #防抖 #节流 #React #Vue3</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vxe-table如何实现可编辑下拉框限制唯一选择，就是每一行选择一个选项后，其他行将不可再次选择该选择]]></title>    <link>https://juejin.cn/post/7581779319573332006</link>    <guid>https://juejin.cn/post/7581779319573332006</guid>    <pubDate>2025-12-10T06:20:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581779319573332006" data-draft-id="7581772744376582190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vxe-table如何实现可编辑下拉框限制唯一选择，就是每一行选择一个选项后，其他行将不可再次选择该选择"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-10T06:20:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vxe-table如何实现可编辑下拉框限制唯一选择，就是每一行选择一个选项后，其他行将不可再次选择该选择
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:20:31.000Z" title="Wed Dec 10 2025 06:20:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vxe-table如何实现可编辑下拉框限制唯一选择，就是每一行选择一个选项后，其他行将不可再次选择该选择，实现每行唯一选项效果。</p>
<p>查看官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn" target="_blank" title="https://vxetable.cn" ref="nofollow noopener noreferrer">vxetable.cn</a>
gitbub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://github.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">github.com/x-extends/v…</a>
gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://gitee.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p>
<h2 data-id="heading-0">效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5c7f9ebb9c34cf4abab08b16fcf2457~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765952431&amp;x-signature=0%2B%2Bf7JOgDYC9de0L6LMjP%2BIJ3FA%3D" alt="table_edit_unique_select" loading="lazy"/></p>
<p>实现原理就是通过给选项设置 disabled 属性来将已选的设置为禁用状态，也可以直接删除，方式有很多种</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-toolbar</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">buttons</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">vxe-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"insertEvent()"</span>&gt;</span>新增<span class="hljs-tag">&lt;/<span class="hljs-name">vxe-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-toolbar</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-table</span>
      <span class="hljs-attr">border</span>
      <span class="hljs-attr">show-overflow</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"tableRef"</span>
      <span class="hljs-attr">max-height</span>=<span class="hljs-string">"400"</span>
      <span class="hljs-attr">:column-config</span>=<span class="hljs-string">"{resizable: true}"</span>
      <span class="hljs-attr">:data</span>=<span class="hljs-string">"tableData"</span>
      <span class="hljs-attr">:edit-config</span>=<span class="hljs-string">"{trigger: 'click', mode: 'row'}"</span>
      @<span class="hljs-attr">edit-activated</span>=<span class="hljs-string">"editActivatedEvent"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">vxe-column</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"seq"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"60"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-column</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">vxe-column</span> <span class="hljs-attr">field</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Name"</span> <span class="hljs-attr">:edit-render</span>=<span class="hljs-string">"{}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">edit</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">vxe-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"row.name"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-input</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-column</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">vxe-column</span> <span class="hljs-attr">field</span>=<span class="hljs-string">"role"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Role"</span> <span class="hljs-attr">:edit-render</span>=<span class="hljs-string">"{}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ formatRole(row) }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">edit</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">vxe-select</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"row.role"</span> <span class="hljs-attr">clearable</span> <span class="hljs-attr">transfer</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"roleChangeEvent"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">vxe-option</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in roleList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.value"</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.value"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.label"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"item.disabled"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-option</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-column</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">vxe-column</span> <span class="hljs-attr">field</span>=<span class="hljs-string">"date13"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Date"</span> <span class="hljs-attr">:edit-render</span>=<span class="hljs-string">"{}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">edit</span>=<span class="hljs-string">"{ row }"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">vxe-date-picker</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"row.date13"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"date"</span> <span class="hljs-attr">transfer</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-date-picker</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-column</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">vxe-table</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> tableRef = <span class="hljs-title function_">ref</span>()

<span class="hljs-keyword">const</span> tableData = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test1'</span>, <span class="hljs-attr">nickname</span>: <span class="hljs-string">'T1'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shenzhen'</span>, <span class="hljs-attr">date12</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">date13</span>: <span class="hljs-string">''</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test2'</span>, <span class="hljs-attr">nickname</span>: <span class="hljs-string">'T2'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'2'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span>, <span class="hljs-attr">date12</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">date13</span>: <span class="hljs-string">'2020-08-20'</span> }
])

<span class="hljs-keyword">const</span> roleList = <span class="hljs-title function_">ref</span>([
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'前端'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'后端'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'2'</span>, <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'项目经理'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'3'</span>, <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'设计师'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'4'</span>, <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'运维'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'5'</span>, <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span> }
])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">formatRole</span> = (<span class="hljs-params">row</span>) =&gt; {
  <span class="hljs-keyword">const</span> item = roleList.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">value</span> === row.<span class="hljs-property">role</span>)
  <span class="hljs-keyword">return</span> item ? item.<span class="hljs-property">label</span> : row.<span class="hljs-property">role</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">insertEvent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> $table = tableRef.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> ($table) {
    <span class="hljs-keyword">const</span> record = {}
    $table.<span class="hljs-title function_">insert</span>(record)
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateRoleList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> $table = tableRef.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> ($table) {
    <span class="hljs-comment">// 获取表格中的全量数据</span>
    <span class="hljs-keyword">const</span> fullData = $table.<span class="hljs-title function_">getFullData</span>()
    roleList.<span class="hljs-property">value</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (item.<span class="hljs-property">value</span>) {
        <span class="hljs-comment">// 如果当前选项已经被选过，则禁用</span>
        item.<span class="hljs-property">disabled</span> = fullData.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row.<span class="hljs-property">role</span> === item.<span class="hljs-property">value</span>)
      }
    })
  }
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">roleChangeEvent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">updateRoleList</span>()
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">editActivatedEvent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 激活编辑时检查剩余选项是否可选择</span>
  <span class="hljs-title function_">updateRoleList</span>()
}
<span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">updateRoleList</span>()
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://gitee.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">gitee.com/x-extends/v…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再猜this指向！JS动态绑定的底层逻辑与实战]]></title>    <link>https://juejin.cn/post/7581752508781363243</link>    <guid>https://juejin.cn/post/7581752508781363243</guid>    <pubDate>2025-12-10T06:56:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581752508781363243" data-draft-id="7581761825483472932" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再猜this指向！JS动态绑定的底层逻辑与实战"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T06:56:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="闲云ing"/> <meta itemprop="url" content="https://juejin.cn/user/2974655942502250"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再猜this指向！JS动态绑定的底层逻辑与实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2974655942502250/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    闲云ing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:56:36.000Z" title="Wed Dec 10 2025 06:56:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">别再猜this指向！JS动态绑定的底层逻辑与实战</h2>
<p><code>this</code> 是JavaScript中最容易让人困惑的概念之一——它既不是静态绑定，也不遵循词法作用域规则，而是<strong>由函数的调用方式决定</strong>。本文将结合实战代码案例，从自由变量、执行上下文、调用方式三个维度，彻底拆解<code>this</code>的设计逻辑、指向规则和常见陷阱，让你从根源理解<code>this</code>的本质。</p>
<h3 data-id="heading-1">一、先理清：this vs 自由变量（词法作用域）</h3>
<p>在讲<code>this</code>之前，必须先区分自由变量和<code>this</code>的核心差异——这是理解<code>this</code>的关键前提。</p>
<h4 data-id="heading-2">1. 自由变量：遵循词法作用域（编译阶段确定）</h4>
<p>自由变量指“函数内部使用，但既不是参数也不是局部变量”的变量，其查找规则是<strong>沿着词法作用域链（Outer）向上找</strong>，由函数<strong>声明的位置</strong>决定，与调用方式无关。</p>
<h5 data-id="heading-3">实战代码解析：自由变量的查找</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">'use strict'</span>
<span class="hljs-comment">// 全局作用域定义对象bar</span>
<span class="hljs-keyword">var</span> bar = { 
  <span class="hljs-attr">myName</span>: <span class="hljs-string">"time.geekbang.com"</span>,
  <span class="hljs-attr">printName</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">//  自由变量：myName既不是参数，也不是局部变量</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myName); <span class="hljs-comment">// 输出：极客邦（全局作用域的myName）</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar.<span class="hljs-property">myName</span>); <span class="hljs-comment">// 输出：time.geekbang.com（对象属性）</span>
    
    <span class="hljs-comment">//  this：与自由变量无关，由调用方式决定</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myName</span>);
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> myName = <span class="hljs-string">'极客时间'</span> <span class="hljs-comment">// 函数内局部变量</span>
  <span class="hljs-keyword">return</span> bar.<span class="hljs-property">printName</span> <span class="hljs-comment">// 返回函数引用</span>
}

<span class="hljs-comment">// 全局作用域定义自由变量myName</span>
<span class="hljs-keyword">var</span> myName = <span class="hljs-string">'极客邦'</span>
<span class="hljs-keyword">var</span> _printName = <span class="hljs-title function_">foo</span>();

<span class="hljs-comment">// 调用场景1：普通函数调用</span>
<span class="hljs-title function_">_printName</span>(); 
<span class="hljs-comment">// 自由变量myName：找全局的「极客邦」（词法作用域决定）</span>
<span class="hljs-comment">// this：指向window（普通函数调用规则）</span>
<span class="hljs-comment">// this.myName：window.myName → 极客邦</span>

<span class="hljs-comment">// 调用场景2：对象方法调用</span>
bar.<span class="hljs-title function_">printName</span>();
<span class="hljs-comment">// 自由变量myName：依然是全局的「极客邦」（词法作用域不变）</span>
<span class="hljs-comment">// this：指向bar对象（方法调用规则）</span>
<span class="hljs-comment">// this.myName：bar.myName → time.geekbang.com</span>
</code></pre>
<h5 data-id="heading-4">核心结论：</h5>
<ul>
<li>自由变量的查找路径在<strong>编译阶段</strong>就已确定（词法作用域），无论函数怎么调用，查找规则不变；</li>
<li><code>this</code>的指向在<strong>执行阶段</strong>确定，由函数的调用方式决定——这是JS设计上的“特殊点”。</li>
</ul>
<h4 data-id="heading-5">2. this的设计背景：为什么需要this？</h4>
<p>JS早期没有<code>class</code>语法，要实现面向对象（OOP），需要一种机制让“对象的方法能访问对象自身的属性”。<code>this</code>就是这个机制：<strong>在对象方法内部，通过this指向对象本身，从而访问对象属性</strong>。</p>
<p>但JS的设计有个“缺陷”：<code>this</code>的指向不是固定的——它不绑定到函数本身，而是绑定到调用上下文，这也是<code>this</code>容易混乱的根源。</p>
<h3 data-id="heading-6">二、this的核心规则：调用方式决定指向</h3>
<p><code>this</code>的指向只有一个核心原则：<strong>谁调用函数，this就指向谁</strong>。以下是5种常见调用场景，结合代码逐一解析。</p>
<h4 data-id="heading-7">场景1：普通函数调用 → this指向全局对象（非严格模式）</h4>
<p>普通函数调用指“直接调用函数名”，非严格模式下<code>this</code>指向全局对象（浏览器中是<code>window</code>），严格模式下<code>this</code>为<code>undefined</code>。</p>
<h5 data-id="heading-8">代码解析：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 输出：window（非严格模式）</span>
}
<span class="hljs-title function_">foo</span>() <span class="hljs-comment">// 等价于 window.foo() → 全局对象调用</span>

<span class="hljs-comment">// 严格模式下</span>
<span class="hljs-meta">'use strict'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 输出：undefined</span>
}
<span class="hljs-title function_">bar</span>()
</code></pre>
<h5 data-id="heading-9">关键细节：</h5>
<ul>
<li><code>var</code>声明的全局变量会挂载到<code>window</code>上（如<code>var myName = '极客邦'</code> → <code>window.myName = '极客邦'</code>），容易造成全局污染；</li>
<li><code>let/const</code>声明的全局变量不会挂载到<code>window</code>上，这是ES6的优化；</li>
<li>严格模式下禁止“无意义的this指向全局”，直接设为<code>undefined</code>，规避全局污染问题。</li>
</ul>
<h4 data-id="heading-10">场景2：对象方法调用 → this指向调用对象</h4>
<p>当函数作为对象的方法被调用时，<code>this</code>指向该对象（即“调用者”）。</p>
<h5 data-id="heading-11">代码解析：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> myObj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"极客时间"</span>,
  <span class="hljs-attr">showThis</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// 输出：myObj对象</span>
  }
}
myObj.<span class="hljs-title function_">showThis</span>(); <span class="hljs-comment">// myObj调用方法 → this指向myObj</span>

<span class="hljs-comment">// 陷阱：方法被赋值给变量后，变为普通函数调用</span>
<span class="hljs-keyword">var</span> foo = myObj.<span class="hljs-property">showThis</span>;
<span class="hljs-title function_">foo</span>(); <span class="hljs-comment">// 普通函数调用 → this指向window（非严格模式）</span>
</code></pre>
<h5 data-id="heading-12">核心陷阱：</h5>
<ul>
<li>函数的“方法身份”只在调用时生效，一旦将方法赋值给变量，函数就变回“普通函数”，<code>this</code>指向全局；</li>
<li>例：<code>myObj.showThis()</code>是方法调用（this→myObj），<code>foo()</code>是普通调用（this→window）。</li>
</ul>
<h4 data-id="heading-13">场景3：call/apply调用 → this指向第一个参数</h4>
<p><code>call</code>和<code>apply</code>是显式绑定<code>this</code>的方法，第一个参数就是<code>this</code>的指向（若传<code>null/undefined</code>，非严格模式下指向window）。</p>
<h5 data-id="heading-14">代码解析：</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> bar = {
  <span class="hljs-attr">myName</span>: <span class="hljs-string">"极客邦"</span>,
  <span class="hljs-attr">text1</span>: <span class="hljs-number">1</span>
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">myName</span> = <span class="hljs-string">"极客时间"</span> <span class="hljs-comment">// this指向call/apply的第一个参数</span>
}

<span class="hljs-comment">// 显式绑定this为bar</span>
foo.<span class="hljs-title function_">call</span>(bar); 
<span class="hljs-comment">// 等价写法：foo.apply(bar);</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bar); <span class="hljs-comment">// 输出：{myName: '极客时间', text1: 1}</span>
</code></pre>
<h5 data-id="heading-15">call vs apply：</h5>
<ul>
<li>相同点：第一个参数都是<code>this</code>指向，都立即执行函数；</li>
<li>不同点：参数传递方式——<code>call</code>传多个参数（<code>foo.call(bar, 1, 2)</code>），<code>apply</code>传数组（<code>foo.apply(bar, [1, 2])</code>）。</li>
</ul>
<h4 data-id="heading-16">场景4：构造函数调用（new）→ this指向实例对象</h4>
<p><code>new</code>运算符会创建一个新对象，构造函数内的<code>this</code>指向这个新实例（模拟<code>new</code>的代码能更直观理解）。</p>
<h5 data-id="heading-17">代码解析：模拟new的this指向</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">CreateObj</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 手动模拟new的核心逻辑</span>
  <span class="hljs-comment">// 1. 创建空对象</span>
  <span class="hljs-keyword">var</span> temObj = {}
  <span class="hljs-comment">// 2. 绑定this为temObj</span>
  <span class="hljs-title class_">CreateObj</span>.<span class="hljs-title function_">call</span>(temObj)
  <span class="hljs-comment">// 3. 关联原型链</span>
  temObj.<span class="hljs-property">__proto__</span> = <span class="hljs-title class_">CreateObj</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
  <span class="hljs-comment">// 4. 返回实例</span>
  <span class="hljs-keyword">return</span> temObj
  
  <span class="hljs-comment">// 原生new中，构造函数内的this指向新实例</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// new调用时，this→myObj</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'极客时间'</span>
}
<span class="hljs-keyword">var</span> myObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateObj</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myObj.<span class="hljs-property">name</span>); <span class="hljs-comment">// 输出：极客时间</span>
</code></pre>
<h5 data-id="heading-18">原生new的this规则：</h5>
<ul>
<li><code>new Constructor()</code>会创建新对象，构造函数内的<code>this</code>指向该对象；</li>
<li>构造函数无需手动返回对象，<code>new</code>会自动返回这个绑定了<code>this</code>的实例。</li>
</ul>
<h4 data-id="heading-19">场景5：事件处理函数 → this指向绑定元素</h4>
<p>DOM事件处理函数中，<code>this</code>指向触发事件的元素（即事件绑定的DOM节点）。</p>
<h5 data-id="heading-20">代码解析：</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"link"</span>&gt;</span>点击我<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'link'</span>)
      .<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);
      })
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h5 data-id="heading-21">核心逻辑：</h5>
<ul>
<li>事件处理函数由DOM元素触发调用，因此<code>this</code>指向该元素；</li>
<li>若事件处理函数是箭头函数，<code>this</code>会继承外层作用域的<code>this</code>（箭头函数无自身this）。</li>
</ul>
<h3 data-id="heading-22">三、从执行上下文视角理解this</h3>
<p>JS执行代码时会创建「执行上下文」，每个执行上下文包含：</p>
<ul>
<li>变量环境：存储变量、函数声明；</li>
<li>词法环境：存储let/const声明；</li>
<li><code>this</code>绑定：存储this的指向。</li>
</ul>
<h4 data-id="heading-23">执行上下文的this绑定规则：</h4>
<ol>
<li>
<p>全局执行上下文：<code>this</code>指向全局对象（window）；</p>
</li>
<li>
<p>函数执行上下文：<code>this</code>的绑定在<strong>函数调用时</strong>确定，而非创建时；</p>
<ol>
<li>普通调用：this→window（非严格模式）；</li>
<li>方法调用：this→调用对象；</li>
<li>call/apply调用：this→第一个参数；</li>
<li>new调用：this→新实例。</li>
</ol>
</li>
</ol>
<h4 data-id="heading-24">关键对比：</h4>




















<table><thead><tr><th>概念</th><th>确定阶段</th><th>决定因素</th></tr></thead><tbody><tr><td>词法作用域</td><td>编译阶段</td><td>函数声明的位置</td></tr><tr><td>this绑定</td><td>执行阶段</td><td>函数的调用方式</td></tr></tbody></table>
<h3 data-id="heading-25">四、this的常见陷阱与避坑技巧</h3>
<h4 data-id="heading-26">陷阱1：方法赋值后this指向全局</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'极客时间'</span>,
  <span class="hljs-attr">fn</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);
  }
}
<span class="hljs-keyword">var</span> fn = obj.<span class="hljs-property">fn</span>;
<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// 输出：undefined（this→window，window.name为空）</span>
</code></pre>
<p><strong>避坑</strong>：用<code>bind</code>永久绑定this → <code>var fn = obj.fn.bind(obj)</code>。</p>
<h4 data-id="heading-27">陷阱2：嵌套函数的this指向</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> obj = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'极客时间'</span>,
  <span class="hljs-attr">fn</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// this→window</span>
    }
    <span class="hljs-title function_">inner</span>();
  }
}
obj.<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// 输出：undefined</span>
</code></pre>
<p><strong>避坑</strong>：</p>
<ol>
<li>用变量保存外部this → <code>var that = this; inner中用that.name</code>；</li>
<li>用箭头函数（继承外层this）→ <code>const inner = () =&gt; { console.log(this.name) }</code>。</li>
</ol>
<h4 data-id="heading-28">陷阱3：严格模式下的this</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">'use strict'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// undefined</span>
}
<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// 普通调用 → this≠window</span>
</code></pre>
<p><strong>避坑</strong>：严格模式下避免依赖“this指向全局”的逻辑，显式绑定this。</p>
<h3 data-id="heading-29">五、总结：this的核心记忆法则</h3>
<ol>
<li>
<p><strong>核心原则</strong>：谁调用，this指向谁；</p>
</li>
<li>
<p><strong>特殊场景</strong>：</p>
<ol>
<li>普通函数调用：非严格模式→window，严格模式→undefined；</li>
<li>call/apply/bind：显式绑定this，优先级最高；</li>
<li>new调用：this指向新实例；</li>
<li>箭头函数：无自身this，继承外层作用域的this；</li>
</ol>
</li>
<li>
<p><strong>与词法作用域的区别</strong>：</p>
<ol>
<li>自由变量：编译阶段确定，找声明位置的外层作用域；</li>
<li>this：执行阶段确定，看调用方式。</li>
</ol>
</li>
</ol>
<p>理解<code>this</code>的关键是“放弃静态绑定的思维”——不要试图在函数声明时确定<code>this</code>，而是看函数<strong>被调用的那一刻</strong>：谁是调用者，<code>this</code>就指向谁。掌握这一点，就能轻松应对<code>this</code>场景了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【React Native】渐变骨架屏组件SkeletonElement]]></title>    <link>https://juejin.cn/post/7581876069607997483</link>    <guid>https://juejin.cn/post/7581876069607997483</guid>    <pubDate>2025-12-10T07:08:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581876069607997483" data-draft-id="7581789701532434474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【React Native】渐变骨架屏组件SkeletonElement"/> <meta itemprop="keywords" content="React Native"/> <meta itemprop="datePublished" content="2025-12-10T07:08:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冰冷的bin"/> <meta itemprop="url" content="https://juejin.cn/user/3529908468333692"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【React Native】渐变骨架屏组件SkeletonElement
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3529908468333692/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冰冷的bin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:08:50.000Z" title="Wed Dec 10 2025 07:08:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React Native 渐变骨架屏组件 <code>SkeletonElement</code> 使用指南</h2>
<h3 data-id="heading-1">一、前言</h3>
<p>在移动端开发中，数据加载过程中的空白等待会显著降低用户体验。<strong>骨架屏（Skeleton Screen）</strong> 是一种广受推崇的加载策略：它通过渲染与真实内容结构一致的灰色占位块，在数据返回前给予用户明确的视觉反馈。</p>
<p>本文提供一个轻量、高性能、支持自定义样式的 <code>SkeletonElement</code> 组件，适用于任何需要占位展示的 UI 元素。</p>
<hr/>
<h3 data-id="heading-2">二、组件特性</h3>
<ul>
<li><strong>完全自定义样式</strong>：通过 <code>style</code> 属性控制尺寸、方向、间距等</li>
<li><strong>流畅渐变动画</strong>：使用 <code>Animated</code> 实现原生驱动的高帧率闪烁效果</li>
<li><strong>轻量无依赖</strong>：仅基于 React Native 内置模块，零第三方依赖</li>
<li><strong>灵活配色</strong>：支持自定义背景色和高亮色</li>
<li><strong>自动清理</strong>：组件卸载时自动停止动画，防止内存泄漏</li>
</ul>
<hr/>
<h3 data-id="heading-3">三、快速上手</h3>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">View</span>&gt;
  {<span class="hljs-comment">/* 标题骨架 */</span>}
  &lt;<span class="hljs-title class_">SkeletonElement</span> style={{ <span class="hljs-attr">height</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'80%'</span>, <span class="hljs-attr">marginBottom</span>: <span class="hljs-number">16</span> }} /&gt;
  
  {<span class="hljs-comment">/* 多行文本骨架 */</span>}
  &lt;<span class="hljs-title class_">SkeletonElement</span> style={{ <span class="hljs-attr">height</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>, <span class="hljs-attr">marginBottom</span>: <span class="hljs-number">8</span> }} /&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SkeletonElement</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">16</span>, <span class="hljs-attr">width:</span> '<span class="hljs-attr">90</span>%', <span class="hljs-attr">marginBottom:</span> <span class="hljs-attr">8</span> }} /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SkeletonElement</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">16</span>, <span class="hljs-attr">width:</span> '<span class="hljs-attr">95</span>%' }} /&gt;</span></span>
  
  {<span class="hljs-comment">/* 按钮骨架 */</span>}
  &lt;<span class="hljs-title class_">SkeletonElement</span> 
    style={{ 
      <span class="hljs-attr">height</span>: <span class="hljs-number">48</span>, 
      <span class="hljs-attr">width</span>: <span class="hljs-string">'50%'</span>, 
      <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">24</span>, 
      <span class="hljs-attr">alignSelf</span>: <span class="hljs-string">'center'</span>,
      <span class="hljs-attr">marginTop</span>: <span class="hljs-number">20</span> 
    }} 
  /&gt;
&lt;/<span class="hljs-title class_">View</span>&gt;
</code></pre>
<hr/>
<h3 data-id="heading-4">四、API 说明</h3>
<h4 data-id="heading-5">Props</h4>



































<table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>style</code></td><td><code>StyleProp&lt;ViewStyle&gt;</code></td><td><code>undefined</code></td><td>自定义骨架样式（宽高、方向、圆角等）</td></tr><tr><td><code>backgroundColor</code></td><td><code>string</code></td><td><code>#E4E4E4</code></td><td>骨架背景色</td></tr><tr><td><code>highlightColor</code></td><td><code>string</code></td><td><code>#D0D0D0</code></td><td>高亮闪烁色（较背景色稍亮）</td></tr><tr><td><code>speed</code></td><td><code>number</code></td><td><code>1600</code></td><td>完整闪烁周期（毫秒），值越小动画越快</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">五、源码解析</h3>
<h4 data-id="heading-7">核心逻辑</h4>
<ol>
<li><strong>动画驱动</strong>：使用 <code>useRef(new Animated.Value(0.4))</code> 创建不触发重渲染的动画值</li>
<li><strong>循环闪烁</strong>：通过 <code>Animated.loop + Animated.sequence</code> 实现“暗→亮→暗”的循环</li>
<li><strong>性能优化</strong>：启用 <code>useNativeDriver: true</code>，动画在原生线程运行</li>
<li><strong>资源清理</strong>：<code>useEffect</code> 返回清理函数，确保组件卸载时停止动画</li>
</ol>
<h4 data-id="heading-8">关键代码片段</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> opacityValue = <span class="hljs-title function_">useRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animated</span>.<span class="hljs-title class_">Value</span>(<span class="hljs-number">0.4</span>)).<span class="hljs-property">current</span>;

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">loop</span>(
    <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">sequence</span>([
      <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">timing</span>(opacityValue, { <span class="hljs-attr">toValue</span>: <span class="hljs-number">1</span>, ... }),
      <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">timing</span>(opacityValue, { <span class="hljs-attr">toValue</span>: <span class="hljs-number">0.4</span>, ... })
    ])
  ).<span class="hljs-title function_">start</span>();

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> opacityValue.<span class="hljs-title function_">stopAnimation</span>();
}, [opacityValue, speed]);
</code></pre>
<hr/>
<h3 data-id="heading-9">六、完整源码</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {useEffect, useRef} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Animated</span>, <span class="hljs-title class_">Easing</span>, <span class="hljs-title class_">StyleProp</span>, <span class="hljs-title class_">View</span>, <span class="hljs-title class_">ViewStyle</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">SkeletonElementProps</span> {
  style?: <span class="hljs-title class_">StyleProp</span>&lt;<span class="hljs-title class_">ViewStyle</span>&gt;;
  backgroundColor?: <span class="hljs-built_in">string</span>;
  highlightColor?: <span class="hljs-built_in">string</span>;
  speed?: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SkeletonElement</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">SkeletonElementProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  style,
  backgroundColor = <span class="hljs-string">'#E4E4E4'</span>,
  highlightColor = <span class="hljs-string">'#D0D0D0'</span>,
  speed = <span class="hljs-number">1600</span>,
}</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">useSkeletonAnimation</span> = (<span class="hljs-params">speed: <span class="hljs-built_in">number</span></span>) =&gt; {
    <span class="hljs-keyword">const</span> opacityValue = <span class="hljs-title function_">useRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Animated</span>.<span class="hljs-title class_">Value</span>(<span class="hljs-number">0.4</span>)).<span class="hljs-property">current</span>;

    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">loop</span>(
        <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">sequence</span>([
          <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">timing</span>(opacityValue, {
            <span class="hljs-attr">toValue</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">duration</span>: speed / <span class="hljs-number">2</span>,
            <span class="hljs-attr">easing</span>: <span class="hljs-title class_">Easing</span>.<span class="hljs-title function_">inOut</span>(<span class="hljs-title class_">Easing</span>.<span class="hljs-property">ease</span>),
            <span class="hljs-attr">useNativeDriver</span>: <span class="hljs-literal">true</span>,
          }),
          <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">timing</span>(opacityValue, {
            <span class="hljs-attr">toValue</span>: <span class="hljs-number">0.4</span>,
            <span class="hljs-attr">duration</span>: speed / <span class="hljs-number">2</span>,
            <span class="hljs-attr">easing</span>: <span class="hljs-title class_">Easing</span>.<span class="hljs-title function_">inOut</span>(<span class="hljs-title class_">Easing</span>.<span class="hljs-property">ease</span>),
            <span class="hljs-attr">useNativeDriver</span>: <span class="hljs-literal">true</span>,
          }),
        ]),
      ).<span class="hljs-title function_">start</span>();

      <span class="hljs-comment">// 返回清理函数</span>
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
        opacityValue.<span class="hljs-title function_">stopAnimation</span>();
      };
    }, [opacityValue, speed]);

    <span class="hljs-keyword">return</span> opacityValue;
  };

  <span class="hljs-keyword">const</span> opacityValue = <span class="hljs-title function_">useSkeletonAnimation</span>(speed);

  <span class="hljs-comment">// 合并样式</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">skeletonStyle</span>: <span class="hljs-title class_">ViewStyle</span> = {
    backgroundColor,
    <span class="hljs-attr">overflow</span>: <span class="hljs-string">'hidden'</span>,
    <span class="hljs-attr">position</span>: <span class="hljs-string">'relative'</span>,
    ...(style <span class="hljs-keyword">as</span> <span class="hljs-title class_">ViewStyle</span>),
  };

  <span class="hljs-comment">// 添加渐变动画效果</span>
  <span class="hljs-keyword">const</span> highlightOverlay = (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Animated.View</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
        <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>',
        <span class="hljs-attr">top:</span> <span class="hljs-attr">0</span>,
        <span class="hljs-attr">left:</span> <span class="hljs-attr">0</span>,
        <span class="hljs-attr">right:</span> <span class="hljs-attr">0</span>,
        <span class="hljs-attr">bottom:</span> <span class="hljs-attr">0</span>,
        <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">highlightColor</span>,
        <span class="hljs-attr">opacity:</span> <span class="hljs-attr">opacityValue</span>,
      }}
    /&gt;</span></span>
  );

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{skeletonStyle}</span>&gt;</span>{highlightOverlay}<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>;
};
</code></pre>
<blockquote>
<p>💡 <strong>提示</strong>：将此组件与条件渲染结合，即可实现优雅的数据加载过渡：</p>
<pre><code class="hljs language-tsx" lang="tsx">{loading ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SkeletonElement</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">height:</span> <span class="hljs-attr">200</span> }} /&gt;</span></span> : <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">RealContent</span> /&gt;</span></span>}
</code></pre>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 页面缓存机制深度实践：从原理到落地]]></title>    <link>https://juejin.cn/post/7581828086020210703</link>    <guid>https://juejin.cn/post/7581828086020210703</guid>    <pubDate>2025-12-10T07:08:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581828086020210703" data-draft-id="7581844141669040168" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 页面缓存机制深度实践：从原理到落地"/> <meta itemprop="keywords" content="前端,Vue.js,架构"/> <meta itemprop="datePublished" content="2025-12-10T07:08:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大象的鼻子那么长"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 页面缓存机制深度实践：从原理到落地
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大象的鼻子那么长
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 融会贯通" title="VIP.4 融会贯通" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:08:24.000Z" title="Wed Dec 10 2025 07:08:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>日期</strong>: 2025-12-10<br/>
<strong>标签</strong>: Vue3, Keep-Alive, 性能优化, 用户体验, Composition API</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">📖 引言</h2>
<p>在企业级中后台应用中，用户经常需要在列表页和详情页之间频繁切换。每次返回列表页都要重新加载数据、丢失查询条件，这种体验让人抓狂。</p>
<p>本文将深入探讨 Vue 3 的 <code>keep-alive</code> 机制，并分享一套<strong>完整的页面缓存管理方案</strong>，包含：</p>
<ul>
<li>🎯 keep-alive 的工作原理和核心概念</li>
<li>🛠️ 可复用的 Composable 封装</li>
<li>📊 真实项目中的性能收益数据</li>
<li>⚠️ 常见坑点和解决方案</li>
</ul>
<hr/>
<h2 data-id="heading-1">一、是什么：Keep-Alive 核心概念</h2>
<h3 data-id="heading-2">1.1 什么是 Keep-Alive？</h3>
<p><code>&lt;keep-alive&gt;</code> 是 Vue 内置的抽象组件，用于<strong>缓存不活动的组件实例</strong>，而不是销毁它们。</p>
<pre><code class="hljs language-css" lang="css">普通组件切换流程：
┌─────────┐     ┌─────────┐     ┌─────────┐
│ 组件 <span class="hljs-selector-tag">A</span>  │ ──▶ │ 销毁 <span class="hljs-selector-tag">A</span>  │ ──▶ │ 创建 <span class="hljs-selector-tag">B</span>  │
└─────────┘     └─────────┘     └─────────┘

keep-alive 组件切换流程：
┌─────────┐     ┌─────────┐     ┌─────────┐
│ 组件 <span class="hljs-selector-tag">A</span>  │ ──▶ │ 缓存 <span class="hljs-selector-tag">A</span>  │ ──▶ │ 创建 <span class="hljs-selector-tag">B</span>  │
└─────────┘     └─────────┘     └─────────┘
                     │
                     ▼ 返回时
               ┌─────────┐
               │ 恢复 <span class="hljs-selector-tag">A</span>  │  ← 直接从缓存恢复，无需重新创建
               └─────────┘
</code></pre>
<h3 data-id="heading-3">1.2 生命周期变化</h3>
<p>使用 keep-alive 后，组件会获得两个新的生命周期钩子：</p>




















<table><thead><tr><th>钩子</th><th>触发时机</th><th>典型用途</th></tr></thead><tbody><tr><td><code>onActivated</code></td><td>组件被激活（从缓存恢复）</td><td>刷新数据、恢复滚动位置</td></tr><tr><td><code>onDeactivated</code></td><td>组件被停用（进入缓存）</td><td>保存状态、清理定时器</td></tr></tbody></table>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { onActivated, onDeactivated, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 首次挂载</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'组件首次创建'</span>)
  <span class="hljs-title function_">loadData</span>()
})

<span class="hljs-comment">// 从缓存恢复时触发（首次挂载不触发）</span>
<span class="hljs-title function_">onActivated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'页面从缓存恢复'</span>)
})

<span class="hljs-comment">// 进入缓存时触发</span>
<span class="hljs-title function_">onDeactivated</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'页面进入缓存'</span>)
})
</code></pre>
<h3 data-id="heading-4">1.3 include/exclude 匹配机制</h3>
<p><code>keep-alive</code> 通过 <code>include</code> 属性控制哪些组件需要缓存，匹配规则是：<strong>组件的 <code>name</code> 属性</strong>。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 只缓存名为 ListView 和 DetailView 的组件 --&gt;
&lt;keep-alive :include="['ListView', 'DetailView']"&gt;
  &lt;router-view /&gt;
&lt;/keep-alive&gt;
</code></pre>
<p>⚠️ <strong>关键坑点</strong>：Vue 3 <code>&lt;script setup&gt;</code> 组件<strong>默认没有 <code>name</code></strong>，必须使用 <code>defineOptions</code> 显式定义：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ❌ 错误：没有定义 name，keep-alive 无法匹配 --&gt;
&lt;script setup lang="ts"&gt;
// 组件逻辑...
&lt;/script&gt;

&lt;!-- ✅ 正确：使用 defineOptions 定义组件名称 --&gt;
&lt;script setup lang="ts"&gt;
defineOptions({
  name: 'ListView', // 必须与路由 name 一致
})
// 组件逻辑...
&lt;/script&gt;
</code></pre>
<hr/>
<h2 data-id="heading-5">二、为什么：业务痛点与价值分析</h2>
<h3 data-id="heading-6">2.1 用户体验痛点</h3>
<p>在没有页面缓存的情况下，用户会遇到以下问题：</p>






























<table><thead><tr><th>场景</th><th>痛点</th><th>用户感受</th></tr></thead><tbody><tr><td>列表→详情→返回</td><td>列表重新加载，滚动位置丢失</td><td>😤 每次都要重新翻页</td></tr><tr><td>复杂查询条件</td><td>返回后条件全部丢失</td><td>😤 又要重新选一遍</td></tr><tr><td>大数据量表格</td><td>每次进入等待 1-2 秒</td><td>😤 系统好慢</td></tr><tr><td>Tab 切换</td><td>切换后数据重新加载</td><td>😤 明明刚看过</td></tr></tbody></table>
<h3 data-id="heading-7">2.2 性能收益实测</h3>
<p>基于真实项目的测试数据：</p>





























<table><thead><tr><th>指标</th><th>优化前</th><th>优化后</th><th>提升幅度</th></tr></thead><tbody><tr><td>页面切换时间</td><td>800-1200ms</td><td><strong>&lt; 50ms</strong></td><td><strong>95%+</strong></td></tr><tr><td>API 请求次数</td><td>每次进入都请求</td><td>仅首次请求</td><td><strong>70%+</strong></td></tr><tr><td>用户等待感知</td><td>明显等待</td><td><strong>瞬间切换</strong></td><td>体验质变</td></tr></tbody></table>
<h3 data-id="heading-8">2.3 业务价值</h3>
<ul>
<li><strong>效率提升</strong>：操作人员每天处理数百单，减少等待时间直接提升工作效率</li>
<li><strong>服务器压力降低</strong>：减少 70% 的重复 API 请求</li>
<li><strong>用户满意度</strong>：流畅的操作体验提升系统好评度</li>
</ul>
<hr/>
<h2 data-id="heading-9">三、怎么做：完整实现方案</h2>
<h3 data-id="heading-10">3.1 架构设计</h3>
<pre><code class="hljs language-ruby" lang="ruby">┌─────────────────────────────────────────────────────────────┐
│                    页面缓存管理架构                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐ │
│   │   路由配置    │    │ <span class="hljs-title class_">KeepAlive</span>   │    │  usePageCache │ │
│   │ meta.keepAlive│───▶│   <span class="hljs-title class_">Store</span>     │◀───│  <span class="hljs-title class_">Composable</span>   │ │
│   └──────────────┘    └──────────────┘    └──────────────┘ │
│          │                   │                   │         │
│          ▼                   ▼                   ▼         │
│   ┌──────────────────────────────────────────────────────┐ │
│   │                   <span class="hljs-title class_">Layout</span> 组件                         │ │
│   │  &lt;keep-alive <span class="hljs-symbol">:include=<span class="hljs-string">"cachedViews"</span></span> <span class="hljs-symbol">:max=<span class="hljs-string">"15"</span>&gt;</span>       │ │
│   │    &lt;router-view /&gt;                                   │ │
│   │  &lt;<span class="hljs-regexp">/keep-alive&gt;                                       │ │
│   └──────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</span></code></pre>
<p><strong>核心思路</strong>：</p>
<ol>
<li><strong>路由配置</strong>：通过 <code>meta.keepAlive</code> 声明哪些页面需要缓存</li>
<li><strong>Pinia Store</strong>：集中管理缓存列表，支持动态增删</li>
<li><strong>Composable</strong>：封装缓存相关逻辑，提供便捷 API</li>
<li><strong>Layout</strong>：使用 <code>&lt;keep-alive :include&gt;</code> 实现动态缓存</li>
</ol>
<h3 data-id="heading-11">3.2 核心代码实现</h3>
<h4 data-id="heading-12">步骤 1：创建 KeepAlive Store</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/keepAlive.ts</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { computed, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useKeepAliveStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'keep-alive'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">/** 缓存的组件名称列表 */</span>
  <span class="hljs-keyword">const</span> cachedViews = ref&lt;<span class="hljs-built_in">string</span>[]&gt;([])
  
  <span class="hljs-comment">/** 最大缓存数量（防止内存泄漏） */</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_CACHE_SIZE</span> = <span class="hljs-number">15</span>

  <span class="hljs-comment">/**
   * 添加组件到缓存列表
   * <span class="hljs-doctag">@param</span> name 组件名称（需与 defineOptions 中的 name 一致）
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">addCachedView</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (!name || cachedViews.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(name)) <span class="hljs-keyword">return</span>
    
    <span class="hljs-comment">// LRU 策略：超过最大数量时，移除最早的</span>
    <span class="hljs-keyword">if</span> (cachedViews.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> &gt;= <span class="hljs-variable constant_">MAX_CACHE_SIZE</span>) {
      cachedViews.<span class="hljs-property">value</span>.<span class="hljs-title function_">shift</span>()
    }
    cachedViews.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(name)
  }

  <span class="hljs-comment">/**
   * 从缓存列表移除组件
   * <span class="hljs-doctag">@param</span> name 组件名称
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">deleteCachedView</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> index = cachedViews.<span class="hljs-property">value</span>.<span class="hljs-title function_">indexOf</span>(name)
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      cachedViews.<span class="hljs-property">value</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>)
    }
  }

  <span class="hljs-comment">/**
   * 清空所有缓存（用于登出等场景）
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearAllCachedViews</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {
    cachedViews.<span class="hljs-property">value</span> = []
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">cachedViews</span>: <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> cachedViews.<span class="hljs-property">value</span>),
    addCachedView,
    deleteCachedView,
    clearAllCachedViews,
  }
})

<span class="hljs-comment">// 用于在 setup 外部使用（如路由守卫）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useKeepAliveStoreWithOut</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useKeepAliveStore</span>()
}
</code></pre>
<h4 data-id="heading-13">步骤 2：配置 Layout 组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- layouts/default.vue --&gt;
&lt;template&gt;
  &lt;div class="layout"&gt;
    &lt;AppHeader /&gt;
    &lt;AppSidebar /&gt;
    &lt;main class="main-content"&gt;
      &lt;router-view v-slot="{ Component }"&gt;
        &lt;transition name="fade" mode="out-in"&gt;
          &lt;keep-alive :include="cachedViews" :max="15"&gt;
            &lt;component :is="Component" :key="$route.name" /&gt;
          &lt;/keep-alive&gt;
        &lt;/transition&gt;
      &lt;/router-view&gt;
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { computed } from 'vue'
import { useKeepAliveStore } from '@/stores/keepAlive'

const keepAliveStore = useKeepAliveStore()

// 响应式获取缓存列表
const cachedViews = computed(() =&gt; keepAliveStore.cachedViews)
&lt;/script&gt;

&lt;style scoped&gt;
/* 页面切换过渡动画 */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.15s ease;
}
.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-14">步骤 3：路由守卫自动管理</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// router/index.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">RouteLocationNormalized</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { useKeepAliveStoreWithOut } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/keepAlive'</span>

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  <span class="hljs-attr">routes</span>: [
    <span class="hljs-comment">// ... 路由配置</span>
  ],
})

<span class="hljs-comment">// 路由后置守卫：自动管理缓存</span>
router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to: RouteLocationNormalized, <span class="hljs-keyword">from</span>: RouteLocationNormalized</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> keepAliveStore = <span class="hljs-title function_">useKeepAliveStoreWithOut</span>()
  <span class="hljs-keyword">const</span> componentName = to.<span class="hljs-property">name</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>
  
  <span class="hljs-comment">// 根据路由 meta.keepAlive 自动添加到缓存</span>
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>?.<span class="hljs-property">keepAlive</span> &amp;&amp; componentName) {
    keepAliveStore.<span class="hljs-title function_">addCachedView</span>(componentName)
  }
  
  <span class="hljs-comment">// 如果离开的页面配置了 noCache，则清除缓存</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span>.<span class="hljs-property">meta</span>?.<span class="hljs-property">noCache</span> &amp;&amp; <span class="hljs-keyword">from</span>.<span class="hljs-property">name</span>) {
    keepAliveStore.<span class="hljs-title function_">deleteCachedView</span>(<span class="hljs-keyword">from</span>.<span class="hljs-property">name</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)
  }
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<h4 data-id="heading-15">步骤 4：创建 usePageCache Composable</h4>
<p>这是<strong>最核心的封装</strong>，提供了统一的缓存管理 API：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// composables/usePageCache.ts</span>
<span class="hljs-keyword">import</span> { onActivated, onDeactivated, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { useKeepAliveStoreWithOut } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/keepAlive'</span>

<span class="hljs-comment">/** 跨页面刷新标记（详情页操作后通知列表页刷新） */</span>
<span class="hljs-keyword">const</span> refreshMarks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">string</span>&gt;()

<span class="hljs-comment">/**
 * 标记某个页面需要刷新
 * <span class="hljs-doctag">@param</span> pageName 目标页面的组件名称
 * <span class="hljs-doctag">@example</span>
 * // 详情页保存后，标记列表页需要刷新
 * markPageNeedRefresh('UserList')
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">markPageNeedRefresh</span>(<span class="hljs-params">pageName: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span> {
  refreshMarks.<span class="hljs-title function_">add</span>(pageName)
}

<span class="hljs-comment">/**
 * 页面缓存管理选项
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UsePageCacheOptions</span> {
  <span class="hljs-comment">/** 每次激活都刷新（默认 false） */</span>
  refreshOnActivate?: <span class="hljs-built_in">boolean</span>
  <span class="hljs-comment">/** 页面激活时的回调 */</span>
  onActivate?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-comment">/** 页面停用时的回调 */</span>
  onDeactivate?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-comment">/** 需要刷新数据时的回调（被 markPageNeedRefresh 标记后触发） */</span>
  onRefresh?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> | <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;
}

<span class="hljs-comment">/**
 * 页面缓存管理 Composable
 * 
 * <span class="hljs-doctag">@example</span>
 * ```ts
 * // 列表页
 * const { isActive } = usePageCache({
 *   onActivate: () =&gt; console.log('页面激活'),
 *   onRefresh: () =&gt; loadList(), // 被标记刷新时执行
 * })
 * ```
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">usePageCache</span>(<span class="hljs-params">options: UsePageCacheOptions = {}</span>) {
  <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>()
  <span class="hljs-keyword">const</span> keepAliveStore = <span class="hljs-title function_">useKeepAliveStoreWithOut</span>()
  
  <span class="hljs-comment">/** 页面是否处于激活状态 */</span>
  <span class="hljs-keyword">const</span> isActive = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-comment">/** 是否需要刷新数据 */</span>
  <span class="hljs-keyword">const</span> needRefresh = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-comment">/** 当前页面名称 */</span>
  <span class="hljs-keyword">const</span> currentPageName = route.<span class="hljs-property">name</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>

  <span class="hljs-comment">// 页面激活时</span>
  <span class="hljs-title function_">onActivated</span>(<span class="hljs-function">() =&gt;</span> {
    isActive.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    
    <span class="hljs-comment">// 检查是否被其他页面标记需要刷新</span>
    <span class="hljs-keyword">if</span> (currentPageName &amp;&amp; refreshMarks.<span class="hljs-title function_">has</span>(currentPageName)) {
      needRefresh.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
      refreshMarks.<span class="hljs-title function_">delete</span>(currentPageName) <span class="hljs-comment">// 清除标记</span>
    }
    
    <span class="hljs-comment">// 执行刷新回调</span>
    <span class="hljs-keyword">if</span> ((options.<span class="hljs-property">refreshOnActivate</span> || needRefresh.<span class="hljs-property">value</span>) &amp;&amp; options.<span class="hljs-property">onRefresh</span>) {
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(options.<span class="hljs-title function_">onRefresh</span>()).<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>)
      needRefresh.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    }
    
    options.<span class="hljs-property">onActivate</span>?.()
  })

  <span class="hljs-comment">// 页面停用时</span>
  <span class="hljs-title function_">onDeactivated</span>(<span class="hljs-function">() =&gt;</span> {
    isActive.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    options.<span class="hljs-property">onDeactivate</span>?.()
  })

  <span class="hljs-comment">/**
   * 手动从缓存中移除当前页面
   * 适用于表单提交后需要清空状态的场景
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">removeFromCache</span>(<span class="hljs-params"/>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (currentPageName) {
      keepAliveStore.<span class="hljs-title function_">deleteCachedView</span>(currentPageName)
    }
  }

  <span class="hljs-keyword">return</span> { 
    isActive, 
    needRefresh, 
    removeFromCache,
  }
}
</code></pre>
<h3 data-id="heading-16">3.3 业务页面接入示例</h3>
<h4 data-id="heading-17">列表页（需要缓存）</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- views/user/list.vue --&gt;
&lt;template&gt;
  &lt;div class="user-list"&gt;
    &lt;!-- 查询条件 --&gt;
    &lt;el-form :model="queryForm" inline&gt;
      &lt;el-form-item label="用户名"&gt;
        &lt;el-input v-model="queryForm.username" /&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item label="状态"&gt;
        &lt;el-select v-model="queryForm.status"&gt;
          &lt;el-option label="启用" value="active" /&gt;
          &lt;el-option label="禁用" value="inactive" /&gt;
        &lt;/el-select&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item&gt;
        &lt;el-button type="primary" @click="handleSearch"&gt;查询&lt;/el-button&gt;
        &lt;el-button @click="handleRefresh"&gt;刷新&lt;/el-button&gt;
      &lt;/el-form-item&gt;
    &lt;/el-form&gt;

    &lt;!-- 数据表格 --&gt;
    &lt;el-table :data="tableData" v-loading="loading"&gt;
      &lt;!-- 列定义 --&gt;
    &lt;/el-table&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { onMounted, reactive, ref } from 'vue'
import { usePageCache } from '@/composables/usePageCache'

// ⚠️ 关键：必须定义组件名称，与路由 name 保持一致
defineOptions({
  name: 'UserList',
})

// 查询条件（会被缓存保留）
const queryForm = reactive({
  username: '',
  status: '',
})

const tableData = ref([])
const loading = ref(false)

// 集成缓存管理
const { isActive } = usePageCache({
  onActivate: () =&gt; {
    console.log('[UserList] 页面从缓存恢复')
  },
  onRefresh: async () =&gt; {
    // 当被 markPageNeedRefresh 标记时执行
    console.log('[UserList] 收到刷新通知，重新加载数据')
    await loadData()
  },
})

async function loadData() {
  loading.value = true
  try {
    // const res = await api.getUserList(queryForm)
    // tableData.value = res.data
  } finally {
    loading.value = false
  }
}

function handleSearch() {
  loadData()
}

function handleRefresh() {
  loadData()
}

// 首次加载
onMounted(() =&gt; {
  loadData()
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-18">详情页（操作后通知列表刷新）</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- views/user/detail.vue --&gt;
&lt;script setup lang="ts"&gt;
import { useRouter } from 'vue-router'
import { markPageNeedRefresh } from '@/composables/usePageCache'

const router = useRouter()

async function handleSave() {
  // await api.updateUser(form)
  
  // 标记列表页需要刷新
  markPageNeedRefresh('UserList')
  
  // 返回列表页
  router.back()
}

async function handleDelete() {
  // await api.deleteUser(id)
  
  // 标记列表页需要刷新
  markPageNeedRefresh('UserList')
  
  router.back()
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-19">路由配置</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// router/modules/user.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> userRoutes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/list'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserList'</span>, <span class="hljs-comment">// 必须与 defineOptions 中的 name 一致</span>
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/list.vue'</span>),
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'用户列表'</span>,
      <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启缓存</span>
    },
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/detail/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserDetail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/detail.vue'</span>),
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'用户详情'</span>,
      <span class="hljs-comment">// 详情页不缓存</span>
    },
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/create'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'UserCreate'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/user/create.vue'</span>),
    <span class="hljs-attr">meta</span>: {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'创建用户'</span>,
      <span class="hljs-attr">noCache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 离开时清除缓存</span>
    },
  },
]
</code></pre>
<hr/>
<h2 data-id="heading-20">四、常见问题与解决方案</h2>
<h3 data-id="heading-21">4.1 缓存不生效？</h3>
<p><strong>症状</strong>：配置了 <code>keepAlive: true</code>，但页面仍然每次都重新加载</p>
<p><strong>排查清单</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 检查点 1：组件是否定义了 name？</span>
<span class="hljs-title function_">defineOptions</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponent'</span>, <span class="hljs-comment">// 必须有</span>
})

<span class="hljs-comment">// ✅ 检查点 2：组件 name 是否与路由 name 一致？</span>
<span class="hljs-comment">// 路由配置</span>
{ <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponent'</span>, <span class="hljs-attr">meta</span>: { <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> } }
<span class="hljs-comment">// 组件必须有相同的 name</span>
<span class="hljs-title function_">defineOptions</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'MyComponent'</span> })

<span class="hljs-comment">// ✅ 检查点 3：Layout 是否正确配置 include？</span>
&lt;keep-alive :include=<span class="hljs-string">"cachedViews"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span></span>
&lt;/keep-alive&gt;

<span class="hljs-comment">// ✅ 检查点 4：Store 是否正确添加了组件名？</span>
<span class="hljs-comment">// 在 Vue DevTools 中检查 cachedViews 数组</span>
</code></pre>
<h3 data-id="heading-22">4.2 数据过期怎么办？</h3>
<p><strong>场景</strong>：用户在详情页修改了数据，返回列表页希望看到最新数据</p>
<p><strong>解决方案</strong>：使用 <code>markPageNeedRefresh</code> 跨页面通信</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 详情页</span>
<span class="hljs-keyword">import</span> { markPageNeedRefresh } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/usePageCache'</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSave</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveData</span>()
  <span class="hljs-title function_">markPageNeedRefresh</span>(<span class="hljs-string">'ListPage'</span>) <span class="hljs-comment">// 标记列表页需要刷新</span>
  router.<span class="hljs-title function_">back</span>()
}

<span class="hljs-comment">// 列表页</span>
<span class="hljs-title function_">usePageCache</span>({
  <span class="hljs-attr">onRefresh</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">loadList</span>(), <span class="hljs-comment">// 被标记时自动执行</span>
})
</code></pre>
<h3 data-id="heading-23">4.3 表单页数据残留？</h3>
<p><strong>场景</strong>：创建表单页被缓存，用户再次进入看到上次填写的数据</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 方案1：路由配置 noCache</span>
{
  <span class="hljs-attr">meta</span>: { <span class="hljs-attr">noCache</span>: <span class="hljs-literal">true</span> } <span class="hljs-comment">// 离开时自动清除缓存</span>
}

<span class="hljs-comment">// 方案2：提交成功后手动清除</span>
<span class="hljs-keyword">const</span> { removeFromCache } = <span class="hljs-title function_">usePageCache</span>()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">submitForm</span>()
  <span class="hljs-title function_">removeFromCache</span>() <span class="hljs-comment">// 清除当前页面缓存</span>
  router.<span class="hljs-title function_">back</span>()
}
</code></pre>
<h3 data-id="heading-24">4.4 内存泄漏风险？</h3>
<p><strong>风险</strong>：缓存过多页面导致内存占用过高</p>
<p><strong>缓解措施</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 1. 限制最大缓存数 --&gt;
&lt;keep-alive :include="cachedViews" :max="15"&gt;
  &lt;router-view /&gt;
&lt;/keep-alive&gt;

&lt;!-- Store 中也做 LRU 限制 --&gt;
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 2. 登出时清空所有缓存</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
  keepAliveStore.<span class="hljs-title function_">clearAllCachedViews</span>()
  router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
}

<span class="hljs-comment">// 3. 敏感页面不缓存</span>
{
  <span class="hljs-attr">meta</span>: { <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">false</span> }
}
</code></pre>
<hr/>
<h2 data-id="heading-25">五、最佳实践总结</h2>
<h3 data-id="heading-26">✅ 应该做</h3>





























<table><thead><tr><th>实践</th><th>说明</th></tr></thead><tbody><tr><td>列表页开启缓存</td><td>高频访问的列表页配置 <code>keepAlive: true</code></td></tr><tr><td>定义组件名称</td><td>所有缓存页面必须用 <code>defineOptions({ name })</code></td></tr><tr><td>提供刷新入口</td><td>每个缓存页面都应有手动刷新按钮</td></tr><tr><td>详情页触发刷新</td><td>操作后使用 <code>markPageNeedRefresh</code> 通知列表</td></tr><tr><td>限制缓存数量</td><td>使用 <code>:max</code> 和 LRU 策略防止内存泄漏</td></tr></tbody></table>
<h3 data-id="heading-27">❌ 不应该做</h3>

























<table><thead><tr><th>反模式</th><th>原因</th></tr></thead><tbody><tr><td>表单页开启缓存</td><td>用户会看到上次填写的数据</td></tr><tr><td>详情页开启缓存</td><td>数据应始终获取最新</td></tr><tr><td>无限缓存</td><td>导致内存泄漏</td></tr><tr><td>忘记登出清理</td><td>敏感数据可能泄露</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-28">六、API 速查表</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ================== 路由配置 ==================</span>
<span class="hljs-attr">meta</span>: { 
  <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 开启缓存</span>
  <span class="hljs-attr">noCache</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 离开时清除缓存（二选一）</span>
}

<span class="hljs-comment">// ================== usePageCache ==================</span>
<span class="hljs-keyword">import</span> { markPageNeedRefresh, usePageCache } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables/usePageCache'</span>

<span class="hljs-comment">// 列表页使用</span>
<span class="hljs-keyword">const</span> { isActive, needRefresh, removeFromCache } = <span class="hljs-title function_">usePageCache</span>({
  <span class="hljs-attr">refreshOnActivate</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 每次激活都刷新</span>
  <span class="hljs-attr">onActivate</span>: <span class="hljs-function">() =&gt;</span> {},      <span class="hljs-comment">// 激活回调</span>
  <span class="hljs-attr">onDeactivate</span>: <span class="hljs-function">() =&gt;</span> {},    <span class="hljs-comment">// 停用回调</span>
  <span class="hljs-attr">onRefresh</span>: <span class="hljs-function">() =&gt;</span> {},       <span class="hljs-comment">// 被标记刷新时执行</span>
})

<span class="hljs-comment">// 详情页通知列表刷新</span>
<span class="hljs-title function_">markPageNeedRefresh</span>(<span class="hljs-string">'PageName'</span>)

<span class="hljs-comment">// ================== Store 方法 ==================</span>
<span class="hljs-keyword">const</span> keepAliveStore = <span class="hljs-title function_">useKeepAliveStore</span>()

keepAliveStore.<span class="hljs-title function_">addCachedView</span>(name)       <span class="hljs-comment">// 添加缓存</span>
keepAliveStore.<span class="hljs-title function_">deleteCachedView</span>(name)    <span class="hljs-comment">// 移除缓存</span>
keepAliveStore.<span class="hljs-title function_">clearAllCachedViews</span>()     <span class="hljs-comment">// 清空所有</span>
</code></pre>
<hr/>
<h2 data-id="heading-29">七、总结</h2>
<p>本文介绍了 Vue 3 页面缓存的完整实现方案：</p>
<ol>
<li><strong>原理理解</strong>：keep-alive 缓存组件实例，通过 include 匹配组件 name</li>
<li><strong>架构设计</strong>：Store 集中管理 + Composable 封装 + 路由守卫自动化</li>
<li><strong>核心封装</strong>：<code>usePageCache</code> 提供统一的缓存管理 API</li>
<li><strong>跨页通信</strong>：<code>markPageNeedRefresh</code> 实现详情页→列表页的刷新通知</li>
</ol>
<p>通过这套方案，我们在实际项目中实现了：</p>
<ul>
<li><strong>95%+ 的页面切换性能提升</strong></li>
<li><strong>70%+ 的 API 请求减少</strong></li>
<li><strong>用户体验质的飞跃</strong></li>
</ul>
<p>希望本文对你有所帮助，欢迎交流讨论！</p>
<hr/>
<blockquote>
<p>📝 <strong>本文示例代码基于 Vue 3.5+ / Pinia 3.0+ / Vue Router 4.x</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌟 React useState 深入理解与最佳实践]]></title>    <link>https://juejin.cn/post/7581769891499950099</link>    <guid>https://juejin.cn/post/7581769891499950099</guid>    <pubDate>2025-12-10T07:02:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581769891499950099" data-draft-id="7581789701532205098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌟 React useState 深入理解与最佳实践"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-12-10T07:02:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="markyankee101"/> <meta itemprop="url" content="https://juejin.cn/user/71901929541952"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌟 React useState 深入理解与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/71901929541952/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    markyankee101
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:02:46.000Z" title="Wed Dec 10 2025 07:02:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：useState知识要点</h2>
<ol>
<li>
<p><strong>初始状态的传递方式</strong>：useState(initialState) 的参数 initialState 只在组件挂载时（即初次渲染）被使用，之后的状态更新由 setState 函数控制。</p>
<ul>
<li>如果传递的是一个<strong>具体的值</strong>（如数字、字符串、对象等），<strong>React只在初次渲染时使用这个值，后续渲染时忽略。</strong></li>
<li>如果传递的是一个<strong>函数</strong>，React在初次渲染时调用这个函数，并用返回值作为初始状态。但是，如果这个函数是直接在调用useState时定义的，那么每次渲染时都会调用这个函数，不过React只会使用初次渲染时的返回值作为初始状态，后续渲染时虽然调用但会忽略其返回值。但是，如果这个函数是作为惰性初始状态（即函数返回初始状态）的方式传递，那么React只会在初次渲染时调用一次。</li>
<li>如果初始状态来自于 <strong>props</strong>，那么当 props 改变时，useState 的状态不会自动更新，因为它只在初始渲染时使用 props 的值。  也就是说，useState 的状态是独立的，除非你使用 useEffect 来同步 props 的变化，否则状态不会随着 props 的改变而改变。</li>
</ul>
</li>
<li>
<p><strong>状态更新</strong>：</p>
<ul>
<li>调用set函数来更新状态，但要注意，set函数并不会立即改变状态，而是将更新加入队列，等待下一次渲染。</li>
<li>React会批量处理状态更新，这意味着在同一个事件处理函数中多次调用set函数，React会将它们合并，然后进行一次重新渲染。</li>
</ul>
</li>
<li>
<p><strong>状态更新时注意不可变性</strong>：</p>
<ul>
<li>当状态是对象或数组时，应该通过创建新的对象或数组来替换旧的状态，而不是直接修改旧的状态。</li>
</ul>
</li>
<li>
<p><strong>基于先前的状态更新</strong>：</p>
<ul>
<li>如果新的状态依赖于先前的状态，那么应该给set函数传递一个函数，这个函数接收先前的状态，并返回新的状态。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-1">一、初始状态的创建时机</h2>

























<table><thead><tr><th>类型</th><th>创建时机</th><th>性能影响</th></tr></thead><tbody><tr><td>直接值</td><td>只计算一次</td><td>无影响</td></tr><tr><td>函数调用结果</td><td>每次渲染都调用</td><td>可能影响性能</td></tr><tr><td>函数本身</td><td>初次渲染调用</td><td>优化昂贵计算</td></tr></tbody></table>
<h3 data-id="heading-2">1. <strong>值类型初始状态（一次性）</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 只在初次渲染时使用</span>
<span class="hljs-keyword">const</span> [obj, setObj] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> }); <span class="hljs-comment">// 只创建一次</span>
</code></pre>
<h3 data-id="heading-3">2. <strong>函数调用初始状态（每次渲染都调用）</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 每次渲染都会调用 heavyComputation()</span>
<span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-title function_">heavyComputation</span>());

<span class="hljs-comment">// ✅ 使用函数式初始状态，只在初次渲染时调用</span>
<span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">heavyComputation</span>());
</code></pre>
<p><strong>关键区别</strong>：当传递函数本身时，React 只在初次渲染时调用它；当传递函数调用结果时，每次渲染都会执行函数（即使返回值被忽略）。</p>
<h3 data-id="heading-4">3. <strong>props作为初始状态</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">{ initialName, initialAge }</span>) {
  <span class="hljs-comment">// ❌ 问题：props 变化时，状态不会自动更新</span>
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(initialName);
  <span class="hljs-keyword">const</span> [age, setAge] = <span class="hljs-title function_">useState</span>(initialAge);
  
  <span class="hljs-comment">// 如果 initialName 从 "John" 变为 "Jane"，</span>
  <span class="hljs-comment">// name 状态仍会保持 "John"，不会自动更新为 "Jane"</span>
}
</code></pre>
<p><strong>核心原则</strong>：<code>useState</code> 的初始值只在组件<strong>首次挂载时</strong>使用一次，后续 props 变化不会自动更新状态。</p>
<h2 data-id="heading-5">二、状态更新的异步性与批处理</h2>
<h3 data-id="heading-6">1. <strong>更新不会立即生效</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(count); <span class="hljs-comment">// 仍然是旧值，不是立即更新的</span>
  };
}
</code></pre>
<h3 data-id="heading-7">2. <strong>React 18+ 的自动批处理</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 所有更新都会被批处理，只触发一次重渲染</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c + <span class="hljs-number">1</span>);
  <span class="hljs-title function_">setName</span>(<span class="hljs-string">'new name'</span>);
  <span class="hljs-title function_">setFlag</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-comment">// 这三行代码只会导致一次重渲染</span>
};
</code></pre>
<h3 data-id="heading-8">3. <strong>同步上下文中的批处理</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这些场景下更新是批处理的：</span>
<span class="hljs-comment">// - React 事件处理器（onClick、onChange 等）</span>
<span class="hljs-comment">// - useEffect 回调</span>
<span class="hljs-comment">// - useLayoutEffect 回调</span>
<span class="hljs-comment">// - Promise 回调（React 18+）</span>

<span class="hljs-comment">// 这些场景下可能不是批处理的（React 17 及以前）：</span>
<span class="hljs-comment">// - setTimeout、setInterval</span>
<span class="hljs-comment">// - 原生事件监听器</span>
<span class="hljs-comment">// - Promise 回调</span>
</code></pre>
<h2 data-id="heading-9">三、不可变更新的模式</h2>
<h3 data-id="heading-10">1. <strong>对象更新：替换而非修改</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> });

<span class="hljs-comment">// ❌ 错误：直接修改</span>
user.<span class="hljs-property">age</span> = <span class="hljs-number">31</span>;  <span class="hljs-comment">// 不会触发重新渲染</span>

<span class="hljs-comment">// ✅ 正确：创建新对象</span>
<span class="hljs-title function_">setUser</span>({ ...user, <span class="hljs-attr">age</span>: <span class="hljs-number">31</span> });

<span class="hljs-comment">// ✅ 深层更新</span>
<span class="hljs-title function_">setUser</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({
  ...prev,
  <span class="hljs-attr">profile</span>: {
    ...prev.<span class="hljs-property">profile</span>,
    <span class="hljs-attr">address</span>: <span class="hljs-string">'New York'</span>
  }
}));
</code></pre>
<h3 data-id="heading-11">2. <strong>数组更新</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [items, setItems] = <span class="hljs-title function_">useState</span>([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]);

<span class="hljs-comment">// 添加</span>
<span class="hljs-title function_">setItems</span>([...items, <span class="hljs-string">'d'</span>]);
<span class="hljs-title function_">setItems</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, <span class="hljs-string">'d'</span>]);

<span class="hljs-comment">// 删除</span>
<span class="hljs-title function_">setItems</span>(items.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> index !== <span class="hljs-number">0</span>));

<span class="hljs-comment">// 更新</span>
<span class="hljs-title function_">setItems</span>(items.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> 
  index === <span class="hljs-number">1</span> ? <span class="hljs-string">'updated'</span> : item
));
</code></pre>
<h2 data-id="heading-12">四、函数式更新（基于先前状态）</h2>
<h3 data-id="heading-13">1. <strong>为什么需要函数式更新？</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 问题：批量更新时会有问题</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">incrementTwice</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);  <span class="hljs-comment">// 使用当前的 count（比如 0）</span>
  <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);  <span class="hljs-comment">// 仍然使用当前的 count（0）</span>
  <span class="hljs-comment">// 结果：count 变为 1 而不是 2</span>
};

<span class="hljs-comment">// ✅ 解决方案：函数式更新</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">incrementTwice</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);  <span class="hljs-comment">// prev = 0 → 1</span>
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);  <span class="hljs-comment">// prev = 1 → 2</span>
  <span class="hljs-comment">// 结果：count 变为 2</span>
};
</code></pre>
<h3 data-id="heading-14">2. <strong>复杂状态更新的模式</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 计数器队列更新</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleBatchUpdate</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev * <span class="hljs-number">2</span>);
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev - <span class="hljs-number">1</span>);
  <span class="hljs-comment">// React 会依次执行这些更新函数</span>
};

<span class="hljs-comment">// 基于 props 的更新</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Counter</span> = (<span class="hljs-params">{ initialValue }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(initialValue);
  
  <span class="hljs-comment">// 重置计数器</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setCount</span>(initialValue);  <span class="hljs-comment">// ❌ 如果 initialValue 变化，这里不会更新</span>
    
    <span class="hljs-comment">// ✅ 使用函数式更新确保使用最新的 props</span>
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">() =&gt;</span> initialValue);
  };
};
</code></pre>
<h2 data-id="heading-15">五、高级模式和最佳实践</h2>
<h3 data-id="heading-16">1. <strong>状态分割：提高性能</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 将所有状态放在一起</span>
<span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">address</span>: <span class="hljs-string">''</span>
});

<span class="hljs-comment">// ✅ 分割状态，避免不必要的重渲染</span>
<span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> [email, setEmail] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> [age, setAge] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
</code></pre>
<h3 data-id="heading-17">2. <strong>自定义 Hook 封装复杂状态逻辑</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useUndoState</span>(<span class="hljs-params">initialValue</span>) {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initialValue);
  <span class="hljs-keyword">const</span> [history, setHistory] = <span class="hljs-title function_">useState</span>([initialValue]);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">undo</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (history.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      <span class="hljs-title function_">setHistory</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>));
      <span class="hljs-title function_">setState</span>(history[history.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>]);
    }
  };
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateState</span> = (<span class="hljs-params">newValue</span>) =&gt; {
    <span class="hljs-title function_">setState</span>(newValue);
    <span class="hljs-title function_">setHistory</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, newValue]);
  };
  
  <span class="hljs-keyword">return</span> [state, updateState, undo];
}
</code></pre>
<h3 data-id="heading-18">3. <strong>状态依赖更新的优化</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 useCallback 避免函数重新创建</span>
<span class="hljs-keyword">const</span> increment = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);
}, []); <span class="hljs-comment">// 空依赖数组，函数只创建一次</span>

<span class="hljs-comment">// 使用 useMemo 避免昂贵计算</span>
<span class="hljs-keyword">const</span> expensiveValue = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">heavyComputation</span>(count);
}, [count]); <span class="hljs-comment">// 仅当 count 变化时重新计算</span>
</code></pre>
<h2 data-id="heading-19">六、常见陷阱与解决方案</h2>
<h3 data-id="heading-20">1. <strong>闭包陷阱</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Timer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ❌ 总是使用初始的 count（0）</span>
      <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);
    }, <span class="hljs-number">1000</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval);
  }, []); <span class="hljs-comment">// 空依赖数组</span>
  
  <span class="hljs-comment">// ✅ 解决方案1：使用函数式更新</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setCount</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> prev + <span class="hljs-number">1</span>);
    }, <span class="hljs-number">1000</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval);
  }, []);
  
  <span class="hljs-comment">// ✅ 解决方案2：将 count 加入依赖数组</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);
    }, <span class="hljs-number">1000</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval);
  }, [count]); <span class="hljs-comment">// count 变化时重新创建定时器</span>
}
</code></pre>
<h3 data-id="heading-21">2. <strong>状态依赖其他状态的更新</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [firstName, setFirstName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> [lastName, setLastName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> [fullName, setFullName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

<span class="hljs-comment">// ❌ 错误：在事件处理器中直接设置</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFirstNameChange</span> = (<span class="hljs-params">name</span>) =&gt; {
  <span class="hljs-title function_">setFirstName</span>(name);
  <span class="hljs-title function_">setFullName</span>(name + <span class="hljs-string">' '</span> + lastName); <span class="hljs-comment">// 可能使用旧的 lastName</span>
};

<span class="hljs-comment">// ✅ 正确：使用 useEffect 响应状态变化</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setFullName</span>(firstName + <span class="hljs-string">' '</span> + lastName);
}, [firstName, lastName]);

<span class="hljs-comment">// ✅ 或者：使用 useMemo 计算派生状态</span>
<span class="hljs-keyword">const</span> fullName = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> firstName + <span class="hljs-string">' '</span> + lastName;
}, [firstName, lastName]);
</code></pre>
<h2 data-id="heading-22">七、性能优化技巧</h2>
<ol>
<li><strong>惰性初始状态</strong>：对于昂贵的初始计算</li>
<li><strong>状态提升</strong>：将状态移动到最近的公共祖先</li>
<li><strong>状态降级</strong>：使用 useMemo/useCallback 避免向下传递新的引用</li>
<li><strong>状态合并</strong>：将频繁同时更新的状态放在一个对象中</li>
<li><strong>状态分割</strong>：将不常变化的状态拆分出来</li>
</ol>
<h2 data-id="heading-23">总结</h2>
<p><code>useState</code> 的核心原则：</p>
<ul>
<li><strong>初始状态创建</strong>：函数式初始状态只运行一次</li>
<li><strong>不可变性</strong>：总是创建新的值，而不是修改旧值</li>
<li><strong>函数式更新</strong>：当新状态依赖于旧状态时使用</li>
<li><strong>批处理</strong>：React 自动优化多个状态更新</li>
<li><strong>异步性</strong>：状态更新不会立即反映</li>
</ul>
<p>理解这些概念不仅能帮助你写出正确的 React 代码，还能优化应用性能，避免常见的陷阱。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[优雅实现虚拟表格校验：基于 Proxy 的响应式校验状态追踪]]></title>    <link>https://juejin.cn/post/7581761825483767844</link>    <guid>https://juejin.cn/post/7581761825483767844</guid>    <pubDate>2025-12-10T07:14:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581761825483767844" data-draft-id="7581769891499982867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="优雅实现虚拟表格校验：基于 Proxy 的响应式校验状态追踪"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T07:14:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西瓜树枝"/> <meta itemprop="url" content="https://juejin.cn/user/424827408622238"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            优雅实现虚拟表格校验：基于 Proxy 的响应式校验状态追踪
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/424827408622238/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    西瓜树枝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:14:07.000Z" title="Wed Dec 10 2025 07:14:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">虚拟表格校验的核心突破：基于Proxy的响应式校验状态追踪</h2>
<p>在企业级应用开发中，虚拟表格（Virtual Table）是处理海量数据的标配，但校验状态的实时、高效管理始终是技术难点。传统方案中，校验状态需手动更新、批量遍历计算，不仅代码冗余，还极易因虚拟渲染的「按需加载」特性引发性能问题。</p>
<p>本文以「企业客户资质审核明细校验」场景为落地案例，聚焦讲解如何利用 JavaScript Proxy 特性，实现虚拟表格校验状态的<strong>响应式自动管理</strong>——这也是本方案区别于常规实现的核心突破点，结合 React + Ant Design 技术栈特性，从根本上解决校验状态与数据联动的痛点，同时深度整合动态校验规则适配能力，满足复杂业务场景需求。</p>
<h3 data-id="heading-1">虚拟表格校验的核心痛点：状态同步与规则适配难题</h3>
<p>虚拟表格的「可视行仅渲染」特性，让校验状态管理面临双重核心问题：</p>
<ol>
<li><strong>状态计算成本高</strong>：整行校验状态需依赖所有字段的校验结果，传统方案需手动遍历所有字段更新状态，海量数据下易卡顿；</li>
<li><strong>状态同步易出错</strong>：字段校验状态变更后，需手动同步整行状态，易因遗漏更新导致界面展示与实际状态不一致；</li>
<li><strong>规则适配灵活性差</strong>：不同资质类型、地域的校验规则差异大，传统硬编码方式难以适配动态业务场景；</li>
</ol>
<p>而 Proxy 作为 ES6 核心特性，其「拦截对象访问/修改」的能力，恰好能同时解决「状态响应式计算」和「动态规则适配」两大核心问题——让校验状态的计算从「手动触发」变为「按需响应式计算」，让规则适配从「硬编码」变为「动态推导」。</p>
<h3 data-id="heading-2">核心实现：Proxy 驱动的响应式校验状态设计（整合动态规则）</h3>
<h4 data-id="heading-3">1. 基础架构：校验状态与业务数据解耦</h4>
<p>首先为每一行资质数据创建独立的 <code>_validObj</code> 对象，专门存储校验状态（与原始业务数据解耦），这是 Proxy 能精准拦截、动态规则能灵活适配的前提：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 定义校验规则类型（强化 TypeScript 类型安全）</span>
interface <span class="hljs-title class_">ValidationRule</span> {
    required?: string;
    maxLength?: [number, string];
    pattern?: [<span class="hljs-title class_">RegExp</span>, string];
    custom?: <span class="hljs-function">(<span class="hljs-params">value: any, item: any</span>) =&gt;</span> { <span class="hljs-attr">flag</span>: boolean; <span class="hljs-attr">info</span>: string };
    [<span class="hljs-attr">key</span>: string]: string | [number | <span class="hljs-title class_">RegExp</span>, string] | (<span class="hljs-function">(<span class="hljs-params">value: any, item: any</span>) =&gt;</span> { <span class="hljs-attr">flag</span>: boolean; <span class="hljs-attr">info</span>: string }) | <span class="hljs-literal">undefined</span>;
}

<span class="hljs-comment">// 定义校验状态类型</span>
interface <span class="hljs-title class_">DetailValidObj</span> {
    <span class="hljs-attr">key</span>: string;
    <span class="hljs-attr">message</span>: string[]; <span class="hljs-comment">// 错误提示</span>
    <span class="hljs-attr">valid</span>: boolean;    <span class="hljs-comment">// 字段校验结果</span>
    <span class="hljs-attr">validFn</span>: <span class="hljs-function">(<span class="hljs-params">item: any</span>) =&gt;</span> boolean; <span class="hljs-comment">// 字段校验函数</span>
}

<span class="hljs-comment">// 定义资质明细数据类型</span>
interface <span class="hljs-title class_">CertDetailItem</span> {
    <span class="hljs-attr">certName</span>: string;
    <span class="hljs-attr">certCode</span>: string;
    <span class="hljs-attr">certType</span>: string; <span class="hljs-comment">// 资质类型（如金融/医疗/通用）</span>
    <span class="hljs-attr">regionCode</span>: string; <span class="hljs-comment">// 地域编码（如310000=上海，110000=北京）</span>
    <span class="hljs-attr">expireDate</span>: string;
    <span class="hljs-attr">issuer</span>: string;
    <span class="hljs-attr">_validObj</span>: <span class="hljs-title class_">Record</span>&lt;string, <span class="hljs-title class_">DetailValidObj</span>&gt;;
}

<span class="hljs-comment">// 全局校验规则配置（按场景分类）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VALID_RULES</span> = {
    <span class="hljs-comment">// 通用资质规则</span>
    <span class="hljs-attr">normal</span>: {
        <span class="hljs-attr">certName</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'资质名称不能为空'</span>, <span class="hljs-attr">maxLength</span>: [<span class="hljs-number">50</span>, <span class="hljs-string">'资质名称长度不能超过50位'</span>] },
        <span class="hljs-attr">certCode</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'资质编码不能为空'</span>, <span class="hljs-attr">pattern</span>: [<span class="hljs-regexp">/^[A-Z0-9]{10,20}$/</span>, <span class="hljs-string">'资质编码格式错误'</span>] },
        <span class="hljs-attr">expireDate</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'有效期不能为空'</span>, <span class="hljs-attr">custom</span>: <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> ({ <span class="hljs-attr">flag</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(v) &gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-attr">info</span>: <span class="hljs-string">'资质已过期'</span> }) }
    },
    <span class="hljs-comment">// 金融资质专属规则</span>
    <span class="hljs-attr">finance</span>: {
        <span class="hljs-attr">certName</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'金融资质名称不能为空'</span>, <span class="hljs-attr">maxLength</span>: [<span class="hljs-number">80</span>, <span class="hljs-string">'金融资质名称长度不能超过80位'</span>] },
        <span class="hljs-attr">certCode</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'金融资质编码不能为空'</span>, <span class="hljs-attr">pattern</span>: [<span class="hljs-regexp">/^JR[A-Z0-9]{8,18}$/</span>, <span class="hljs-string">'金融资质编码格式错误'</span>] },
        <span class="hljs-attr">expireDate</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'有效期不能为空'</span>, <span class="hljs-attr">custom</span>: <span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> ({ <span class="hljs-attr">flag</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(v) &gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">30</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">1000</span>), <span class="hljs-attr">info</span>: <span class="hljs-string">'金融资质有效期不足30天'</span> }) },
        <span class="hljs-attr">licenseNo</span>: { <span class="hljs-attr">required</span>: <span class="hljs-string">'金融许可证号不能为空'</span> } <span class="hljs-comment">// 金融资质额外字段</span>
    },
    <span class="hljs-comment">// 地域专属规则（以上海为例）</span>
    <span class="hljs-attr">shanghai</span>: {
        <span class="hljs-attr">certCode</span>: { <span class="hljs-attr">pattern</span>: [<span class="hljs-regexp">/^SH[A-Z0-9]{8,18}$/</span>, <span class="hljs-string">'上海地区资质编码需以SH开头'</span>] }
    }
};

<span class="hljs-comment">// 初始化每行的校验状态容器</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initValidObj</span> = (<span class="hljs-params">item: CertDetailItem</span>) =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">validObj</span>: <span class="hljs-title class_">Record</span>&lt;string, <span class="hljs-title class_">DetailValidObj</span>&gt; = {};
    <span class="hljs-comment">// 先获取当前行的基础校验字段（根据资质类型动态调整）</span>
    <span class="hljs-keyword">const</span> baseFields = <span class="hljs-title function_">getValidFieldsByCertType</span>(item.<span class="hljs-property">certType</span>);
    
    baseFields.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
        validObj[field] = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>({ <span class="hljs-comment">// 冻结对象防止意外修改</span>
            <span class="hljs-attr">key</span>: field,
            <span class="hljs-attr">message</span>: [],
            <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">validFn</span>: <span class="hljs-title function_">createFieldValidFn</span>(field, item) <span class="hljs-comment">// 绑定字段专属校验函数（带动态规则）</span>
        });
    });
    <span class="hljs-keyword">return</span> validObj;
};

<span class="hljs-comment">// 根据资质类型获取需校验的字段列表（动态字段适配）</span>
<span class="hljs-keyword">const</span> getValidFieldsByCertType = (<span class="hljs-attr">certType</span>: string): string[] =&gt; {
    <span class="hljs-keyword">switch</span> (certType) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'finance'</span>: <span class="hljs-comment">// 金融资质</span>
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'certName'</span>, <span class="hljs-string">'certCode'</span>, <span class="hljs-string">'expireDate'</span>, <span class="hljs-string">'issuer'</span>, <span class="hljs-string">'licenseNo'</span>];
        <span class="hljs-keyword">case</span> <span class="hljs-string">'medical'</span>: <span class="hljs-comment">// 医疗资质</span>
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'certName'</span>, <span class="hljs-string">'certCode'</span>, <span class="hljs-string">'expireDate'</span>, <span class="hljs-string">'issuer'</span>, <span class="hljs-string">'approvalNo'</span>];
        <span class="hljs-attr">default</span>: <span class="hljs-comment">// 通用资质</span>
            <span class="hljs-keyword">return</span> [<span class="hljs-string">'certName'</span>, <span class="hljs-string">'certCode'</span>, <span class="hljs-string">'expireDate'</span>, <span class="hljs-string">'issuer'</span>];
    }
};
</code></pre>
<p>解耦设计 + 规则配置化的核心价值：既保证原始业务数据的纯净性，也让 Proxy 仅需聚焦校验状态的拦截，同时通过配置化规则实现动态适配。</p>
<h4 data-id="heading-4">2. Proxy 核心拦截逻辑：按需计算 + 动态规则适配</h4>
<p>为 <code>_validObj</code> 创建 Proxy 代理，核心拦截 <code>valid</code> 属性的访问（整行校验状态的核心标识），在计算整行状态时，动态适配当前行的资质类型、地域规则：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 为校验状态对象绑定 Proxy 代理（整合动态规则）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createValidProxy</span> = (<span class="hljs-params">item: CertDetailItem, rawValidObj: Record&lt;string, DetailValidObj&gt;</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(rawValidObj, {
        <span class="hljs-comment">/**
         * 拦截属性访问：核心处理「整行校验状态」的计算 + 动态规则适配
         * <span class="hljs-doctag">@param</span> target 原始校验状态对象
         * <span class="hljs-doctag">@param</span> prop 访问的属性名
         * <span class="hljs-doctag">@returns</span> 按需返回字段状态 / 整行计算后的状态
         */</span>
        <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">target, prop, receiver</span>) {
            <span class="hljs-comment">// 拦截对「整行校验状态」的访问（统一标识为 'valid'）</span>
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'valid'</span>) {
                <span class="hljs-comment">// 第一步：根据当前行资质类型，动态获取需校验的字段列表</span>
                <span class="hljs-keyword">const</span> validFields = <span class="hljs-title function_">getValidFieldsByCertType</span>(item.<span class="hljs-property">certType</span>);
                
                <span class="hljs-comment">// 第二步：遍历动态字段列表，计算整行校验状态</span>
                <span class="hljs-keyword">return</span> validFields.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
                    <span class="hljs-comment">// 兼容虚拟表格行复用导致的字段未初始化场景</span>
                    <span class="hljs-keyword">return</span> target[field]?.<span class="hljs-property">valid</span> ?? <span class="hljs-literal">false</span>;
                });
            }

            <span class="hljs-comment">// 拦截「动态规则获取」请求（供校验函数调用）</span>
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'getDynamicRules'</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">field: string</span>) =&gt;</span> {
                    <span class="hljs-comment">// 基础规则：按资质类型获取</span>
                    <span class="hljs-keyword">let</span> fieldRules = <span class="hljs-variable constant_">VALID_RULES</span>.<span class="hljs-property">normal</span>[field] || {};
                    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">certType</span> === <span class="hljs-string">'finance'</span>) {
                        fieldRules = { ...fieldRules, ...<span class="hljs-variable constant_">VALID_RULES</span>.<span class="hljs-property">finance</span>[field] };
                    }
                    <span class="hljs-comment">// 地域规则：叠加地域专属规则</span>
                    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">regionCode</span> === <span class="hljs-string">'310000'</span>) {
                        fieldRules = { ...fieldRules, ...<span class="hljs-variable constant_">VALID_RULES</span>.<span class="hljs-property">shanghai</span>[field] };
                    }
                    <span class="hljs-keyword">return</span> fieldRules;
                };
            }

            <span class="hljs-comment">// 非整行状态访问：直接返回原始字段状态（如单个字段的 message/valid）</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
        },
        
        <span class="hljs-comment">/**
         * 拦截属性修改，保证状态更新的可控性
         * 例如禁止直接修改整行 valid 状态，强制通过字段状态推导
         */</span>
        <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">target, prop, value, receiver</span>) {
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'valid'</span>) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'整行校验状态禁止手动修改，由字段状态自动推导'</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 拒绝手动修改</span>
            }
            <span class="hljs-comment">// 字段状态修改时，无需额外操作，Proxy 访问时会自动重新计算整行状态</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value, receiver);
        }
    });
};

<span class="hljs-comment">// 生成字段校验函数（整合动态规则）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createFieldValidFn</span> = (<span class="hljs-params">field: string, item: CertDetailItem</span>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable language_">this</span>: DetailValidObj</span>) {
        <span class="hljs-keyword">const</span> value = item[field];
        <span class="hljs-keyword">const</span> validObj = item.<span class="hljs-property">_validObj</span>[field];
        <span class="hljs-comment">// 重置当前字段校验状态</span>
        validObj.<span class="hljs-property">message</span> = [];
        validObj.<span class="hljs-property">valid</span> = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// 第一步：通过 Proxy 获取当前字段的动态规则</span>
        <span class="hljs-keyword">const</span> getDynamicRules = item.<span class="hljs-property">_validObj</span>.<span class="hljs-property">getDynamicRules</span>;
        <span class="hljs-keyword">const</span> fieldRules = <span class="hljs-title function_">getDynamicRules</span>(field);

        <span class="hljs-comment">// 第二步：执行校验逻辑</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> ruleKey <span class="hljs-keyword">in</span> fieldRules) {
            <span class="hljs-keyword">const</span> ruleValue = fieldRules[ruleKey];
            <span class="hljs-keyword">let</span> isValid = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">let</span> errorMsg = <span class="hljs-string">''</span>;

            <span class="hljs-keyword">switch</span> (ruleKey) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">'required'</span>:
                    isValid = !!value &amp;&amp; value.<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>;
                    errorMsg = ruleValue <span class="hljs-keyword">as</span> string;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'maxLength'</span>:
                    <span class="hljs-keyword">const</span> [max, msg] = ruleValue <span class="hljs-keyword">as</span> [number, string];
                    isValid = (value?.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>) &lt;= max;
                    errorMsg = msg;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'pattern'</span>:
                    <span class="hljs-keyword">const</span> [reg, msg] = ruleValue <span class="hljs-keyword">as</span> [<span class="hljs-title class_">RegExp</span>, string];
                    isValid = reg.<span class="hljs-title function_">test</span>(value);
                    errorMsg = msg;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'custom'</span>:
                    <span class="hljs-keyword">const</span> result = (ruleValue <span class="hljs-keyword">as</span> (<span class="hljs-attr">v</span>: any) =&gt; { <span class="hljs-attr">flag</span>: boolean; <span class="hljs-attr">info</span>: string })(value);
                    isValid = result.<span class="hljs-property">flag</span>;
                    errorMsg = result.<span class="hljs-property">info</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-attr">default</span>:
                    isValid = <span class="hljs-literal">true</span>;
            }

            <span class="hljs-keyword">if</span> (!isValid) {
                validObj.<span class="hljs-property">message</span>.<span class="hljs-title function_">push</span>(errorMsg);
                validObj.<span class="hljs-property">valid</span> = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 短路逻辑，提升校验效率</span>
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };
};

<span class="hljs-comment">// 初始化资质数据时绑定 Proxy</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initCertData</span> = (<span class="hljs-params">rawData: CertDetailItem[]</span>) =&gt; {
    <span class="hljs-keyword">return</span> rawData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> rawValidObj = <span class="hljs-title function_">initValidObj</span>(item);
        <span class="hljs-comment">// 为校验对象绑定 Proxy，注入响应式能力 + 动态规则能力</span>
        item.<span class="hljs-property">_validObj</span> = <span class="hljs-title function_">createValidProxy</span>(item, rawValidObj);
        <span class="hljs-keyword">return</span> item;
    });
};
</code></pre>
<h4 data-id="heading-5">3. 关键特性：Proxy 响应式 + 动态规则的核心优势（适配 React + Ant Design）</h4>
<h5 data-id="heading-6">（1）按需计算，适配虚拟表格性能特性</h5>
<p>虚拟表格仅渲染可视行，只有当用户操作某行（如编辑字段、触发校验）时，才会访问该行的 <code>_validObj.valid</code> 属性——此时 Proxy 才执行整行状态计算，且计算时会自动适配当前行的资质类型、地域规则，完全避免「非可视行的无效计算」和「规则硬编码的冗余逻辑」。</p>
<h5 data-id="heading-7">（2）动态规则无缝整合，适配复杂业务场景</h5>
<p>通过 Proxy 暴露 <code>getDynamicRules</code> 方法，校验函数可随时获取当前行的专属规则，无需提前预判所有场景：</p>
<ul>
<li>资质类型适配：金融资质自动加载专属规则和额外校验字段；</li>
<li>地域规则适配：上海地区资质编码自动叠加地域格式校验；</li>
<li>规则扩展便捷：新增资质类型/地域规则时，仅需在 <code>VALID_RULES</code> 中添加配置，无需修改核心校验逻辑。</li>
</ul>
<h5 data-id="heading-8">（3）自动同步状态，无需手动维护</h5>
<p>当某个字段的校验状态变更（如 <code>certCode</code> 校验失败），后续访问 <code>_validObj.valid</code> 时，Proxy 会立即重新计算并返回最新结果，无需手动调用 <code>setState</code> 更新整行状态：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// React 组件中处理字段编辑</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFieldChange</span> = (<span class="hljs-params">record: CertDetailItem, field: string, value: any</span>) =&gt; {
    <span class="hljs-comment">// 更新业务数据</span>
    <span class="hljs-keyword">const</span> newData = certData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (item.<span class="hljs-property">key</span> === record.<span class="hljs-property">key</span>) {
            <span class="hljs-keyword">return</span> { ...item, [field]: value };
        }
        <span class="hljs-keyword">return</span> item;
    });
    <span class="hljs-title function_">setCertData</span>(newData);

    <span class="hljs-comment">// 触发字段校验（仅更新当前字段状态）</span>
    <span class="hljs-keyword">const</span> targetItem = newData.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">key</span> === record.<span class="hljs-property">key</span>);
    targetItem.<span class="hljs-property">_validObj</span>[field].<span class="hljs-property">validFn</span>.<span class="hljs-title function_">call</span>(targetItem.<span class="hljs-property">_validObj</span>[field]);
    
    <span class="hljs-comment">// 无需手动更新整行状态！访问 targetItem._validObj.valid 时会自动计算</span>
};

<span class="hljs-comment">// React 组件中使用：直接访问即可获取最新整行状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">renderTable</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span>
        <span class="hljs-attr">components</span>=<span class="hljs-string">{VirtualTable}</span> // <span class="hljs-attr">Ant</span> <span class="hljs-attr">Design</span> <span class="hljs-attr">虚拟表格配置</span>
        <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{certData}</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{[</span>
            // <span class="hljs-attr">操作列</span>：<span class="hljs-attr">根据整行校验状态禁用提交按钮</span>
            {
                <span class="hljs-attr">title:</span> '<span class="hljs-attr">操作</span>',
                <span class="hljs-attr">render:</span> (<span class="hljs-attr">_</span>, <span class="hljs-attr">record</span>) =&gt;</span> (
                    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> 
                        <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> 
                        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!record._validObj.valid}</span> // <span class="hljs-attr">访问时自动计算</span>（<span class="hljs-attr">含动态规则</span>）
                        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> submitCert(record)}
                    &gt;
                        提交审核
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
                )
            }
        ]}
    /&gt;</span>;
};
</code></pre>
<h5 data-id="heading-9">（4）与 React 响应式生态融合</h5>
<p>Proxy 拦截的是对象属性访问，而非 React 组件状态，因此可完美适配 React 的「状态变更-重新渲染」逻辑：</p>
<ul>
<li>当字段校验状态变更后，组件访问 <code>_validObj.valid</code> 会获取最新值；</li>
<li>结合 React 状态管理（如 useState/useReducer），仅需更新数据引用，即可触发组件精准重渲染；</li>
<li>避免传统方案中「批量更新状态导致的全表重渲染」问题。</li>
</ul>
<h4 data-id="heading-10">4. 完整流程：Proxy 响应式校验 + 动态规则的执行链路</h4>
<p>结合 React + Ant Design 虚拟表格的生命周期，完整执行流程如下：</p>
<ol>
<li><strong>初始化</strong>：遍历原始资质数据，为每行创建 <code>rawValidObj</code>，并基于当前行的资质类型/地域编码绑定 Proxy（注入响应式 + 动态规则能力）；</li>
<li><strong>字段编辑</strong>：用户编辑字段（如修改金融资质编码），触发 <code>handleFieldChange</code> 更新业务数据；</li>
<li><strong>字段校验</strong>：调用该字段的 <code>validFn</code>，通过 Proxy 的 <code>getDynamicRules</code> 获取金融资质 + 地域专属规则，执行校验并更新字段状态；</li>
<li><strong>状态访问</strong>：组件渲染时访问 <code>_validObj.valid</code>（如禁用提交按钮、展示错误提示）；</li>
<li><strong>Proxy 拦截</strong>：自动根据当前行资质类型获取动态字段列表，遍历计算整行状态，返回最新结果；</li>
<li><strong>界面更新</strong>：React 感知到数据变化，仅重渲染当前行（虚拟表格特性），展示最新校验状态。</li>
</ol>
<h3 data-id="heading-11">总结：Proxy 是虚拟表格校验的「响应式+动态规则」核心</h3>
<p>在 React + Ant Design 虚拟表格校验场景中，Proxy 不仅解决了状态响应式计算的核心问题，还成为动态规则适配的「天然载体」：</p>
<ol>
<li><strong>响应式计算</strong>：将整行校验状态从「手动更新」变为「访问时自动推导」，完全适配虚拟表格的按需渲染特性；</li>
<li><strong>动态规则无缝整合</strong>：通过 Proxy 暴露动态规则获取能力，无需硬编码即可适配资质类型、地域等多维度业务场景；</li>
<li><strong>性能最优</strong>：仅在状态被访问时计算，避免非可视行的无效运算，规则缓存进一步降低计算成本；</li>
<li><strong>可维护性提升</strong>：规则配置化、状态管理解耦，新增业务场景仅需扩展配置，无需修改核心逻辑；</li>
<li><strong>React 生态适配</strong>：与 React 响应式理念高度契合，减少 setState 冗余代码，提升组件渲染效率。</li>
</ol>
<p>该方案不仅适用于「客户资质审核」场景，还可无缝迁移至供应链审核、合同管理、设备台账校验等所有虚拟表格校验场景——核心是利用 Proxy 打通「字段校验状态」「整行校验状态」「动态业务规则」三者的响应式联动，这也是企业级 React 应用中虚拟表格校验的最优实践方向。</p>
<h4 data-id="heading-12">最终核心代码（精简版）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 核心：Proxy 响应式校验状态 + 动态规则实现</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createValidProxy</span> = (<span class="hljs-params">item: CertDetailItem, rawValidObj: Record&lt;string, DetailValidObj&gt;</span>) =&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">validCache</span>: boolean | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> <span class="hljs-attr">ruleCache</span>: <span class="hljs-title class_">Record</span>&lt;string, <span class="hljs-title class_">ValidationRule</span>&gt; = {};

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(rawValidObj, {
        <span class="hljs-attr">get</span>: <span class="hljs-function">(<span class="hljs-params">target, prop</span>) =&gt;</span> {
            <span class="hljs-comment">// 整行校验状态：动态字段 + 自动计算</span>
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'valid'</span>) {
                <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
                <span class="hljs-keyword">if</span> (validCache &amp;&amp; now - cacheTime &lt; <span class="hljs-number">100</span>) <span class="hljs-keyword">return</span> validCache;
                <span class="hljs-keyword">const</span> validFields = <span class="hljs-title function_">getValidFieldsByCertType</span>(item.<span class="hljs-property">certType</span>);
                validCache = validFields.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> target[field]?.<span class="hljs-property">valid</span>);
                cacheTime = now;
                <span class="hljs-keyword">return</span> validCache;
            }

            <span class="hljs-comment">// 动态规则获取：适配资质类型/地域</span>
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'getDynamicRules'</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">field: string</span>) =&gt;</span> {
                    <span class="hljs-keyword">if</span> (ruleCache[field]) <span class="hljs-keyword">return</span> ruleCache[field];
                    <span class="hljs-keyword">let</span> rules = <span class="hljs-variable constant_">VALID_RULES</span>.<span class="hljs-property">normal</span>[field] || {};
                    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">certType</span> === <span class="hljs-string">'finance'</span>) rules = { ...rules, ...<span class="hljs-variable constant_">VALID_RULES</span>.<span class="hljs-property">finance</span>[field] };
                    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">regionCode</span> === <span class="hljs-string">'310000'</span>) rules = { ...rules, ...<span class="hljs-variable constant_">VALID_RULES</span>.<span class="hljs-property">shanghai</span>[field] };
                    ruleCache[field] = rules;
                    <span class="hljs-keyword">return</span> rules;
                };
            }

            <span class="hljs-comment">// 错误信息聚合</span>
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'allMessage'</span>) {
                <span class="hljs-keyword">const</span> validFields = <span class="hljs-title function_">getValidFieldsByCertType</span>(item.<span class="hljs-property">certType</span>);
                <span class="hljs-keyword">return</span> validFields.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">msgs, field</span>) =&gt;</span> 
                    target[field]?.<span class="hljs-property">message</span>.<span class="hljs-property">length</span> 
                        ? [...msgs, <span class="hljs-string">`<span class="hljs-subst">${field}</span>: <span class="hljs-subst">${target[field].message.join(<span class="hljs-string">', '</span>)}</span>`</span>] 
                        : msgs, []);
            }

            <span class="hljs-comment">// 字段变更清空缓存</span>
            <span class="hljs-keyword">if</span> (prop !== <span class="hljs-string">'valid'</span> &amp;&amp; prop !== <span class="hljs-string">'getDynamicRules'</span>) {
                validCache = <span class="hljs-literal">null</span>;
                ruleCache = {};
            }
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop);
        },
        <span class="hljs-attr">set</span>: <span class="hljs-function">(<span class="hljs-params">target, prop, value</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (prop === <span class="hljs-string">'valid'</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 禁止手动修改整行状态</span>
            <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, prop, value);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    });
};

<span class="hljs-comment">// React 组件中使用</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CertTable</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> [certData, setCertData] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> 
        <span class="hljs-title function_">initCertData</span>(rawData).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
            ...item,
            <span class="hljs-attr">_validObj</span>: <span class="hljs-title function_">createValidProxy</span>(item, <span class="hljs-title function_">initValidObj</span>(item))
        }))
    );

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFieldChange</span> = (<span class="hljs-params">record, field, value</span>) =&gt; {
        <span class="hljs-keyword">const</span> newData = certData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">key</span> === record.<span class="hljs-property">key</span> ? { ...item, [field]: value } : item);
        <span class="hljs-title function_">setCertData</span>(newData);
        <span class="hljs-comment">// 触发字段校验</span>
        newData.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">key</span> === record.<span class="hljs-property">key</span>).<span class="hljs-property">_validObj</span>[field].<span class="hljs-title function_">validFn</span>();
    };

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Table</span>
            <span class="hljs-attr">components</span>=<span class="hljs-string">{VirtualTable}</span>
            <span class="hljs-attr">dataSource</span>=<span class="hljs-string">{certData}</span>
            <span class="hljs-attr">columns</span>=<span class="hljs-string">{[</span>
                {
                    <span class="hljs-attr">title:</span> '<span class="hljs-attr">资质名称</span>',
                    <span class="hljs-attr">dataIndex:</span> '<span class="hljs-attr">certName</span>',
                    <span class="hljs-attr">editable:</span> <span class="hljs-attr">true</span>,
                    <span class="hljs-attr">onCell:</span> (<span class="hljs-attr">record</span>) =&gt;</span> ({
                        onChange: (e) =&gt; handleFieldChange(record, 'certName', e.target.value)
                    })
                },
                {
                    title: '校验状态',
                    render: (_, record) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">Tag</span> <span class="hljs-attr">color</span>=<span class="hljs-string">{record._validObj.valid</span> ? '<span class="hljs-attr">green</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">red</span>'}&gt;</span>
                            {record._validObj.valid ? '通过' : '失败'}
                        <span class="hljs-tag">&lt;/<span class="hljs-name">Tag</span>&gt;</span>
                    )
                },
                {
                    title: '错误信息',
                    render: (_, record) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> <span class="hljs-attr">title</span>=<span class="hljs-string">{record._validObj.allMessage.join(</span>'\<span class="hljs-attr">n</span>')}&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{record._validObj.valid}</span>&gt;</span>查看错误<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">Tooltip</span>&gt;</span>
                    )
                },
                {
                    title: '操作',
                    render: (_, record) =&gt; (
                        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> 
                            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{!record._validObj.valid}</span>
                            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleSubmit(record)}
                        &gt;
                            提交
                        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
                    )
                }
            ]}
        /&gt;</span>
    );
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 常用数组操作方法完整指南]]></title>    <link>https://juejin.cn/post/7581828086020440079</link>    <guid>https://juejin.cn/post/7581828086020440079</guid>    <pubDate>2025-12-10T07:51:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581828086020440079" data-draft-id="7581814484065861684" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 常用数组操作方法完整指南"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-10T07:51:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="想赚点零花钱"/> <meta itemprop="url" content="https://juejin.cn/user/2885580832641213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 常用数组操作方法完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2885580832641213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    想赚点零花钱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:51:26.000Z" title="Wed Dec 10 2025 07:51:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">📚 核心方法对比总览</h2>





























































<table><thead><tr><th>方法</th><th>功能</th><th>修改原数组</th><th>返回值</th><th>时间复杂度</th><th>记忆技巧</th></tr></thead><tbody><tr><td><strong><code>slice()</code></strong></td><td>切片/提取</td><td>❌ 否</td><td>新数组/字符串</td><td>O(n)</td><td>"切一片蛋糕" - 原蛋糕还在</td></tr><tr><td><strong><code>splice()</code></strong></td><td>剪接/增删改</td><td>✅ 是</td><td>被删除元素数组</td><td>O(n)</td><td>"剪辑电影" - 原片被修改</td></tr><tr><td><strong><code>shift()</code></strong></td><td>移除第一个</td><td>✅ 是</td><td>移除的元素</td><td>O(n)</td><td>"移除队首"</td></tr><tr><td><strong><code>unshift()</code></strong></td><td>前面添加</td><td>✅ 是</td><td>新长度</td><td>O(n)</td><td>"反方向shift"</td></tr><tr><td><strong><code>pop()</code></strong></td><td>移除最后一个</td><td>✅ 是</td><td>移除的元素</td><td>O(1)</td><td>"弹出栈顶"</td></tr><tr><td><strong><code>push()</code></strong></td><td>后面添加</td><td>✅ 是</td><td>新长度</td><td>O(1)</td><td>"推入栈"</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">一、🔪 <code>slice()</code> - 切片方法</h2>
<h3 data-id="heading-2">1.1 基本语法</h3>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-comment">// 数组和字符串都可用</span>
array.<span class="hljs-title function_">slice</span>(startIndex, endIndex)  <span class="hljs-comment">// 包含start，不包含end</span>
string.<span class="hljs-title function_">slice</span>(startIndex, endIndex)
</code></pre>
<h3 data-id="heading-3">1.2 参数详解</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> arr = [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>, <span class="hljs-string">'E'</span>];

<span class="hljs-comment">// 两个参数</span>
arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);    <span class="hljs-comment">// ['B', 'C']     (索引1到3，不含3)</span>
arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);   <span class="hljs-comment">// ['A', 'B', 'C', 'D']  (0到倒数第1个)</span>

<span class="hljs-comment">// 一个参数</span>
arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);       <span class="hljs-comment">// ['C', 'D', 'E']  (从索引2到末尾)</span>
arr.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">2</span>);      <span class="hljs-comment">// ['D', 'E']       (最后2个)</span>

<span class="hljs-comment">// 无参数 - 浅拷贝</span>
<span class="hljs-keyword">const</span> copy = arr.<span class="hljs-title function_">slice</span>();  <span class="hljs-comment">// 完整浅拷贝</span>
</code></pre>
<h3 data-id="heading-4">1.3 实际应用</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 数组浅拷贝</span>
<span class="hljs-keyword">const</span> original = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> }];
<span class="hljs-keyword">const</span> copy = original.<span class="hljs-title function_">slice</span>();
copy[<span class="hljs-number">0</span>] = <span class="hljs-number">999</span>;           <span class="hljs-comment">// 不影响原数组</span>
copy[<span class="hljs-number">2</span>].<span class="hljs-property">name</span> = <span class="hljs-string">'Jane'</span>;   <span class="hljs-comment">// 影响原数组（对象引用相同）</span>

<span class="hljs-comment">// 2. 分页功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">paginate</span>(<span class="hljs-params">items, page = <span class="hljs-number">1</span>, pageSize = <span class="hljs-number">10</span></span>) {
  <span class="hljs-keyword">const</span> start = (page - <span class="hljs-number">1</span>) * pageSize;
  <span class="hljs-keyword">return</span> items.<span class="hljs-title function_">slice</span>(start, start + pageSize);
}

<span class="hljs-comment">// 3. 字符串操作</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-string">'https://api.example.com/users'</span>;
<span class="hljs-keyword">const</span> domain = url.<span class="hljs-title function_">slice</span>(<span class="hljs-number">8</span>, url.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'/'</span>, <span class="hljs-number">8</span>));  <span class="hljs-comment">// 'api.example.com'</span>

<span class="hljs-comment">// 4. 获取数组部分</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getFirstN</span> = (<span class="hljs-params">arr, n</span>) =&gt; arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, n);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getLastN</span> = (<span class="hljs-params">arr, n</span>) =&gt; arr.<span class="hljs-title function_">slice</span>(-n);
</code></pre>
<hr/>
<h2 data-id="heading-5">二、✂️ <code>splice()</code> - 剪接方法</h2>
<h3 data-id="heading-6">2.1 基本语法</h3>
<pre><code class="hljs language-js" lang="js">array.<span class="hljs-title function_">splice</span>(startIndex, deleteCount, item1, item2, ...)
</code></pre>
<h3 data-id="heading-7">2.2 三种主要用途</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fruits = [<span class="hljs-string">'🍎'</span>, <span class="hljs-string">'🍌'</span>, <span class="hljs-string">'🍊'</span>, <span class="hljs-string">'🍇'</span>];

<span class="hljs-comment">// 1. 删除元素</span>
<span class="hljs-keyword">const</span> removed = fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 从索引1删除2个</span>
<span class="hljs-comment">// removed: ['🍌', '🍊']</span>
<span class="hljs-comment">// fruits: ['🍎', '🍇']</span>

<span class="hljs-comment">// 2. 插入元素</span>
fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'🍉'</span>, <span class="hljs-string">'🍓'</span>);  <span class="hljs-comment">// 在索引1插入，不删除</span>
<span class="hljs-comment">// fruits: ['🍎', '🍉', '🍓', '🍇']</span>

<span class="hljs-comment">// 3. 替换元素</span>
fruits.<span class="hljs-title function_">splice</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'🍍'</span>);  <span class="hljs-comment">// 替换索引2的元素</span>
<span class="hljs-comment">// fruits: ['🍎', '🍉', '🍍', '🍇']</span>
</code></pre>
<h3 data-id="heading-8">2.3 实用技巧</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 删除最后一个元素（替代pop）</span>
arr.<span class="hljs-title function_">splice</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);

<span class="hljs-comment">// 2. 删除第一个元素（替代shift）</span>
arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);

<span class="hljs-comment">// 3. 清空数组</span>
arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, arr.<span class="hljs-property">length</span>);

<span class="hljs-comment">// 4. 在指定位置插入多个</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">insertAt</span> = (<span class="hljs-params">arr, index, ...items</span>) =&gt; {
  arr.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, ...items);
  <span class="hljs-keyword">return</span> arr;
};
</code></pre>
<hr/>
<h2 data-id="heading-9">三、🔄 <code>shift()</code> / <code>unshift()</code> - 队列前端操作</h2>
<h3 data-id="heading-10">3.1 <code>shift()</code> - 移除第一个</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> queue = [<span class="hljs-string">'任务1'</span>, <span class="hljs-string">'任务2'</span>, <span class="hljs-string">'任务3'</span>];

<span class="hljs-comment">// 先进先出（FIFO）</span>
<span class="hljs-keyword">const</span> currentTask = queue.<span class="hljs-title function_">shift</span>();
<span class="hljs-comment">// currentTask: '任务1'</span>
<span class="hljs-comment">// queue: ['任务2', '任务3']</span>

<span class="hljs-comment">// 处理任务队列</span>
<span class="hljs-keyword">while</span> (queue.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
  <span class="hljs-keyword">const</span> task = queue.<span class="hljs-title function_">shift</span>();
  <span class="hljs-title function_">processTask</span>(task);
}
</code></pre>
<h3 data-id="heading-11">3.2 <code>unshift()</code> - 前面添加</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> history = [<span class="hljs-string">'页面2'</span>, <span class="hljs-string">'页面3'</span>];

<span class="hljs-comment">// 添加浏览历史（最新在最前）</span>
history.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">'页面1'</span>);
<span class="hljs-comment">// history: ['页面1', '页面2', '页面3']</span>

<span class="hljs-comment">// 添加日志前缀</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addLogPrefix</span>(<span class="hljs-params">logs, prefix</span>) {
  logs.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">`[<span class="hljs-subst">${prefix}</span>]:`</span>);
  <span class="hljs-keyword">return</span> logs;
}
</code></pre>
<h3 data-id="heading-12">3.3 性能注意</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ shift/unshift 在大型数组上性能较差（需要移动所有元素）</span>
<span class="hljs-keyword">const</span> bigArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-string">'item'</span>);

<span class="hljs-comment">// 如果要频繁操作数组前端，考虑使用双向队列</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Deque</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = [];
  }
  
  <span class="hljs-title function_">addFront</span>(<span class="hljs-params">item</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">unshift</span>(item);
  }
  
  <span class="hljs-title function_">removeFront</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">shift</span>();
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-13">四、📌 <code>pop()</code> / <code>push()</code> - 栈/队列后端操作</h2>
<h3 data-id="heading-14">4.1 <code>push()</code> - 后面添加</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> stack = [];

<span class="hljs-comment">// 入栈（LIFO）</span>
stack.<span class="hljs-title function_">push</span>(<span class="hljs-string">'操作1'</span>);
stack.<span class="hljs-title function_">push</span>(<span class="hljs-string">'操作2'</span>);
stack.<span class="hljs-title function_">push</span>(<span class="hljs-string">'操作3'</span>);
<span class="hljs-comment">// stack: ['操作1', '操作2', '操作3']</span>

<span class="hljs-comment">// 构建路径</span>
<span class="hljs-keyword">const</span> path = [];
path.<span class="hljs-title function_">push</span>(<span class="hljs-string">'users'</span>);
path.<span class="hljs-title function_">push</span>(<span class="hljs-string">'documents'</span>);
path.<span class="hljs-title function_">push</span>(<span class="hljs-string">'file.txt'</span>);
<span class="hljs-comment">// path: ['users', 'documents', 'file.txt']</span>
</code></pre>
<h3 data-id="heading-15">4.2 <code>pop()</code> - 移除最后一个</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 出栈</span>
<span class="hljs-keyword">const</span> lastOperation = stack.<span class="hljs-title function_">pop</span>();
<span class="hljs-comment">// lastOperation: '操作3'</span>
<span class="hljs-comment">// stack: ['操作1', '操作2']</span>

<span class="hljs-comment">// 撤销操作实现</span>
<span class="hljs-keyword">const</span> undoStack = [];
<span class="hljs-keyword">const</span> redoStack = [];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">doAction</span>(<span class="hljs-params">action</span>) {
  undoStack.<span class="hljs-title function_">push</span>(action);
  <span class="hljs-title function_">execute</span>(action);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">undo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (undoStack.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> action = undoStack.<span class="hljs-title function_">pop</span>();
    redoStack.<span class="hljs-title function_">push</span>(action);
    <span class="hljs-title function_">revert</span>(action);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">五、🎯 对比总结</h2>
<h3 data-id="heading-17">5.1 读写特性对比</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];

<span class="hljs-comment">// 读操作（不修改原数组）</span>
<span class="hljs-keyword">const</span> sliceResult = arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>);  <span class="hljs-comment">// [2, 3, 4]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);  <span class="hljs-comment">// [1, 2, 3, 4, 5] ✅ 不变</span>

<span class="hljs-comment">// 写操作（修改原数组）</span>
<span class="hljs-keyword">const</span> spliceResult = arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);  <span class="hljs-comment">// [2, 3, 4]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr);  <span class="hljs-comment">// [1, 5] ❌ 已修改</span>
</code></pre>
<h3 data-id="heading-18">5.2 操作位置对比</h3>
<pre><code class="hljs language-text" lang="text">操作位置         前面          中间          后面
-------------------------------------------------
取出/删除     shift()      splice()      pop()
添加/插入     unshift()    splice()      push()
只读切片      slice()      slice()       slice()
</code></pre>
<h3 data-id="heading-19">5.3 返回值对比</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> arr = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>];

arr.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>);   <span class="hljs-comment">// 返回: ['b', 'c']   (新数组)</span>
arr.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 返回: ['b', 'c']   (删除的元素)</span>
arr.<span class="hljs-title function_">shift</span>();       <span class="hljs-comment">// 返回: 'a'          (移除的元素)</span>
arr.<span class="hljs-title function_">unshift</span>(<span class="hljs-string">'x'</span>);  <span class="hljs-comment">// 返回: 4            (新长度)</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">六、🚀 最佳实践</h2>
<h3 data-id="heading-21">6.1 选择指南</h3>



































<table><thead><tr><th>场景</th><th>推荐方法</th><th>原因</th></tr></thead><tbody><tr><td><strong>需要原数组不变</strong></td><td><code>slice()</code></td><td>创建副本，不影响原始数据</td></tr><tr><td><strong>需要修改原数组</strong></td><td><code>splice()</code></td><td>原地操作，节省内存</td></tr><tr><td><strong>队列操作（先进先出）</strong></td><td><code>push()</code> + <code>shift()</code></td><td>符合队列语义</td></tr><tr><td><strong>栈操作（后进先出）</strong></td><td><code>push()</code> + <code>pop()</code></td><td>符合栈语义</td></tr><tr><td><strong>数组前端操作频繁</strong></td><td>考虑双向链表</td><td><code>shift/unshift</code>性能差</td></tr></tbody></table>
<h3 data-id="heading-22">6.2 性能优化</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 避免在大数组上使用 shift/unshift</span>
<span class="hljs-keyword">const</span> largeArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">100000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-string">'item'</span>);

<span class="hljs-comment">// ✅ 如果需要频繁操作两端，使用链表或双端队列</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedArray</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span> = <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-title function_">shift</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span>];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span>++;
    <span class="hljs-comment">// 定期清理前面的空位</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span> &gt; <span class="hljs-number">1000</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontIndex</span> = <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">return</span> item;
  }
}
</code></pre>
<h3 data-id="heading-23">6.3 现代JavaScript替代</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// slice 的现代替代</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> copy1 = arr.<span class="hljs-title function_">slice</span>();          <span class="hljs-comment">// 传统</span>
<span class="hljs-keyword">const</span> copy2 = [...arr];             <span class="hljs-comment">// ES6扩展运算符 ✅</span>
<span class="hljs-keyword">const</span> copy3 = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(arr);      <span class="hljs-comment">// ES6 Array.from</span>

<span class="hljs-comment">// push 的现代替代</span>
arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">6</span>, <span class="hljs-number">7</span>);                     <span class="hljs-comment">// 传统</span>
<span class="hljs-keyword">const</span> newArr = [...arr, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>];      <span class="hljs-comment">// 扩展运算符（不修改原数组）</span>

<span class="hljs-comment">// unshift 的现代替代</span>
arr.<span class="hljs-title function_">unshift</span>(<span class="hljs-number">0</span>);                     <span class="hljs-comment">// 传统  </span>
<span class="hljs-keyword">const</span> newArr2 = [<span class="hljs-number">0</span>, ...arr];        <span class="hljs-comment">// 扩展运算符（不修改原数组）</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">七、📝 记忆口诀</h2>
<h3 data-id="heading-25">7.1 按功能记忆</h3>
<pre><code class="hljs language-text" lang="text">读操作：slice     (只读不写)
写操作：splice    (增删改查)
队列头：shift/unshift
队列尾：pop/push
</code></pre>
<h3 data-id="heading-26">7.2 按名字记忆</h3>
<ul>
<li><strong><code>slice</code></strong> → "切" → 切一片 → 只读</li>
<li><strong><code>splice</code></strong> → "plice"（连接）→ 修改连接</li>
<li><strong><code>shift</code></strong> → 移动 → 移除第一个</li>
<li><strong><code>unshift</code></strong> → 反移动 → 前面添加</li>
<li><strong><code>pop</code></strong> → "砰" → 弹出最后一个</li>
<li><strong><code>push</code></strong> → 推 → 后面推入</li>
</ul>
<h3 data-id="heading-27">7.3 一句话总结</h3>
<blockquote>
<p><strong>slice切，splice改，shift/unshift动头，pop/push动尾</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-28">八、🔧 实用代码片段</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. 安全的数组操作函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ArrayUtils</span> = {
  <span class="hljs-comment">// 安全的slice（处理负数、越界）</span>
  <span class="hljs-attr">safeSlice</span>: <span class="hljs-function">(<span class="hljs-params">arr, start = <span class="hljs-number">0</span>, end = arr.length</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> len = arr.<span class="hljs-property">length</span>;
    start = start &lt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(len + start, <span class="hljs-number">0</span>) : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(start, len);
    end = end &lt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(len + end, <span class="hljs-number">0</span>) : <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(end, len);
    <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">slice</span>(start, end);
  },
  
  <span class="hljs-comment">// 批量删除</span>
  <span class="hljs-attr">removeItems</span>: <span class="hljs-function">(<span class="hljs-params">arr, indices</span>) =&gt;</span> {
    <span class="hljs-comment">// 从大到小排序，避免索引变化</span>
    indices.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b - a);
    indices.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">index</span> =&gt;</span> {
      arr.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
    });
    <span class="hljs-keyword">return</span> arr;
  },
  
  <span class="hljs-comment">// 插入到排序数组的合适位置</span>
  <span class="hljs-attr">insertSorted</span>: <span class="hljs-function">(<span class="hljs-params">arr, item, compareFn = (a, b) =&gt; a - b</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>, high = arr.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">while</span> (low &lt; high) {
      <span class="hljs-keyword">const</span> mid = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((low + high) / <span class="hljs-number">2</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">compareFn</span>(arr[mid], item) &lt; <span class="hljs-number">0</span>) {
        low = mid + <span class="hljs-number">1</span>;
      } <span class="hljs-keyword">else</span> {
        high = mid;
      }
    }
    arr.<span class="hljs-title function_">splice</span>(low, <span class="hljs-number">0</span>, item);
    <span class="hljs-keyword">return</span> arr;
  }
};
</code></pre>
<hr/>
<h2 data-id="heading-29">九、📊 时间复杂度总结</h2>








































<table><thead><tr><th>操作</th><th>时间复杂度</th><th>说明</th></tr></thead><tbody><tr><td><code>slice(start, end)</code></td><td>O(k)</td><td>k = end - start</td></tr><tr><td><code>splice(start, deleteCount, ...items)</code></td><td>O(n)</td><td>需要移动元素</td></tr><tr><td><code>shift()</code></td><td>O(n)</td><td>需要移动所有元素</td></tr><tr><td><code>unshift(...items)</code></td><td>O(n + m)</td><td>n=原长度, m=新增个数</td></tr><tr><td><code>pop()</code></td><td>O(1)</td><td>直接移除最后一个</td></tr><tr><td><code>push(...items)</code></td><td>O(m)</td><td>m=新增个数</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-30">十、✅ 快速参考卡</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 提取部分（不修改原数组）</span>
<span class="hljs-keyword">const</span> part = arr.<span class="hljs-title function_">slice</span>(start, end);

<span class="hljs-comment">// 删除/插入/替换（修改原数组）</span>
<span class="hljs-keyword">const</span> removed = arr.<span class="hljs-title function_">splice</span>(start, deleteCount, ...items);

<span class="hljs-comment">// 队列操作（先进先出）</span>
queue.<span class="hljs-title function_">push</span>(item);          <span class="hljs-comment">// 入队</span>
<span class="hljs-keyword">const</span> item = queue.<span class="hljs-title function_">shift</span>(); <span class="hljs-comment">// 出队</span>

<span class="hljs-comment">// 栈操作（后进先出）</span>
stack.<span class="hljs-title function_">push</span>(item);          <span class="hljs-comment">// 压栈</span>
<span class="hljs-keyword">const</span> item = stack.<span class="hljs-title function_">pop</span>();   <span class="hljs-comment">// 弹栈</span>

<span class="hljs-comment">// 数组前后操作</span>
arr.<span class="hljs-title function_">unshift</span>(...items);     <span class="hljs-comment">// 前面添加</span>
arr.<span class="hljs-title function_">shift</span>();               <span class="hljs-comment">// 移除第一个</span>
arr.<span class="hljs-title function_">push</span>(...items);        <span class="hljs-comment">// 后面添加</span>
arr.<span class="hljs-title function_">pop</span>();                 <span class="hljs-comment">// 移除最后一个</span>
</code></pre>
<hr/>
<p><strong>最后提醒</strong>：</p>
<ul>
<li>✅ 需要<strong>保留原数组</strong>时用 <code>slice()</code></li>
<li>✅ 需要<strong>修改原数组</strong>时用 <code>splice()</code></li>
<li>✅ <strong>队列操作</strong>用 <code>push()</code> + <code>shift()</code></li>
<li>✅ <strong>栈操作</strong>用 <code>push()</code> + <code>pop()</code></li>
<li>❌ 避免在大数组上频繁使用 <code>shift()</code>/<code>unshift()</code></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[javascript面试系列（二）——Promise与async/await]]></title>    <link>https://juejin.cn/post/7581995152189751338</link>    <guid>https://juejin.cn/post/7581995152189751338</guid>    <pubDate>2025-12-10T07:46:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581995152189751338" data-draft-id="7581876069608144939" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="javascript面试系列（二）——Promise与async/await"/> <meta itemprop="keywords" content="JavaScript,面试,前端"/> <meta itemprop="datePublished" content="2025-12-10T07:46:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西瓜树枝"/> <meta itemprop="url" content="https://juejin.cn/user/424827408622238"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            javascript面试系列（二）——Promise与async/await
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/424827408622238/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    西瓜树枝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:46:10.000Z" title="Wed Dec 10 2025 07:46:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端面试的技术环节中，异步编程绝对是绕不开的核心考点，而Promise与async/await作为现代JavaScript异步编程的基石，更是面试官重点考察的内容。从“回调地狱”的痛点出发，到Promise的规范落地，再到async/await的语法优化，这三者的演进脉络不仅体现了JavaScript的发展方向，更藏着前端工程师必备的工程化思维。</p>
<h2 data-id="heading-0">一、为什么需要Promise？—— 从“回调地狱”说起</h2>
<p>在Promise出现之前，JavaScript的异步操作全靠回调函数实现。比如我们需要依次执行“请求用户信息→根据用户ID请求订单→根据订单ID请求商品详情”这一系列异步操作，代码会变成这样：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 回调地狱示例</span>
<span class="hljs-title function_">requestUserInfo</span>(userId, <span class="hljs-keyword">function</span>(<span class="hljs-params">user</span>) {
  <span class="hljs-title function_">requestOrder</span>(user.<span class="hljs-property">orderId</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">order</span>) {
    <span class="hljs-title function_">requestGoods</span>(order.<span class="hljs-property">goodsId</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">goods</span>) {
      <span class="hljs-comment">// 业务逻辑</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(goods);
    }, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求商品失败'</span>, err);
    });
  }, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求订单失败'</span>, err);
  });
}, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求用户失败'</span>, err);
});
</code></pre>
<p>这种嵌套层级不断加深的代码被称为“回调地狱”，它存在三个致命问题：<strong>可读性差</strong>（代码呈“金字塔”结构，难以快速梳理执行流程）、<strong>可维护性低</strong>（修改中间某一步逻辑需要逐层定位）、<strong>错误处理混乱</strong>（每个回调都要单独处理错误，无法统一捕获）。</p>
<p>为了解决这些问题，ES6正式引入了Promise规范，它通过“状态管理”的方式将异步操作的结果与后续逻辑解耦，让异步代码变得线性、清晰。</p>
<h2 data-id="heading-1">二、Promise核心解析：状态、方法与原理</h2>
<p>Promise的本质是一个<strong>异步操作的状态管理器</strong>，它用标准化的API封装异步操作，让开发者可以专注于业务逻辑而非异步流程控制。要掌握Promise，首先要吃透它的“状态机制”。</p>
<h3 data-id="heading-2">1. 三个核心状态与状态不可逆性</h3>
<p>Promise有且只有三个状态，且状态一旦改变就会永久固定，无法再修改：</p>
<ul>
<li><strong>pending（等待中）</strong> ：初始状态，异步操作尚未完成。此时Promise既不成功也不失败。</li>
<li><strong>fulfilled（已成功）</strong> ：异步操作完成且结果有效。状态从pending转为fulfilled后，会触发后续的then回调。</li>
<li><strong>rejected（已失败）</strong> ：异步操作失败或结果无效。状态从pending转为rejected后，会触发后续的catch回调。</li>
</ul>
<p>面试高频考点：Promise状态不可逆的特性。比如“状态从fulfilled转为rejected是否可行？”答案是不行，一旦状态确定就无法变更。曾有面试题用setTimeout模拟异步，考察对状态固定的理解，务必注意。</p>
<h3 data-id="heading-3">2. 基本用法：创建与链式调用</h3>
<p>Promise通过构造函数创建，接收一个 executor 函数作为参数，该函数有两个内置参数resolve和reject，分别用于将状态转为fulfilled和rejected：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Promise基本用法</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-comment">// 模拟异步操作（比如接口请求）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> success = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (success) {
      <span class="hljs-comment">// 成功：传递结果给resolve</span>
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'异步操作成功的结果'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 失败：传递错误信息给reject</span>
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'异步操作失败'</span>));
    }
  }, <span class="hljs-number">1000</span>);
});

<span class="hljs-comment">// 链式调用处理结果</span>
promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'成功接收结果：'</span>, result);
    <span class="hljs-keyword">return</span> result + <span class="hljs-string">'，已处理'</span>; <span class="hljs-comment">// 传递给下一个then</span>
  })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">processedResult</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'处理后的结果：'</span>, processedResult);
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'捕获错误：'</span>, error);
  });
</code></pre>
<p>这里有两个关键知识点：</p>
<ol>
<li><strong>then方法的返回值</strong>：then方法会返回一个新的Promise对象，这是链式调用的核心。如果then中返回一个非Promise值，会自动包装成fulfilled状态的Promise；如果返回一个Promise，则后续then会等待该Promise状态变更。</li>
<li><strong>catch的作用</strong>：catch用于捕获前面所有链式调用中的错误，包括Promise构造函数中reject的错误和then回调中抛出的异常，实现“统一错误处理”。</li>
</ol>
<h3 data-id="heading-4">3. 常用静态方法：all、race、allSettled</h3>
<p>除了实例方法，Promise的静态方法在实际开发和面试中都高频出现，重点掌握以下三个：</p>
<h4 data-id="heading-5">（1）Promise.all(iterable)</h4>
<p>接收一个可迭代对象（如数组），里面包含多个Promise。它的核心特性是“<strong>全部成功才成功，一个失败则整体失败</strong>”：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> promise2 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>);
<span class="hljs-keyword">const</span> promise3 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([promise1, promise2, promise3])
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results); <span class="hljs-comment">// [1, 2, 3]（按传入顺序返回结果）</span>
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error); <span class="hljs-comment">// 若任意一个Promise reject，立即触发catch</span>
  });
</code></pre>
<p>面试考点：如果Promise.all中某个Promise失败，其他Promise还会继续执行吗？答案是会的。因为Promise状态一旦触发就无法中断，all只是“监听”状态，不会干预单个Promise的执行。</p>
<h4 data-id="heading-6">（2）Promise.race(iterable)</h4>
<p>同样接收可迭代对象，核心特性是“<strong>谁先完成谁生效</strong>”——只要有一个Promise状态变更（成功或失败），就立即返回该结果，忽略其他Promise的后续状态：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 模拟接口请求超时控制</span>
<span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'请求成功'</span>), <span class="hljs-number">3000</span>);
});
<span class="hljs-keyword">const</span> timeout = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'请求超时'</span>)), <span class="hljs-number">2000</span>);
});

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([request, timeout])
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error)); <span class="hljs-comment">// 2秒后输出“请求超时”</span>
</code></pre>
<p>实际用途：常见于接口请求超时控制、资源加载竞争等场景。</p>
<h4 data-id="heading-7">（3）Promise.allSettled(iterable)</h4>
<p>ES2020新增方法，与all的“一错全错”不同，它会等待<strong>所有Promise都完成（无论成功或失败）</strong> ，然后返回一个包含所有结果的数组，每个元素包含对应Promise的状态和结果：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> promise1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> promise2 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'失败'</span>));

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([promise1, promise2])
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results);
    <span class="hljs-comment">// 输出：</span>
    <span class="hljs-comment">// [</span>
    <span class="hljs-comment">//   { status: 'fulfilled', value: 1 },</span>
    <span class="hljs-comment">//   { status: 'rejected', reason: Error: 失败 }</span>
    <span class="hljs-comment">// ]</span>
  });
</code></pre>
<p>适用场景：需要获取所有异步操作的完整结果，比如批量请求数据时，即使部分失败也需要知道失败原因。</p>
<h2 data-id="heading-8">三、async/await：Promise的“语法糖”与最佳实践</h2>
<p>虽然Promise解决了回调地狱，但链式调用过多时，代码依然会存在“then链”的冗余。ES2017引入的async/await，通过“同步语法写异步逻辑”的方式，进一步简化了Promise的使用，成为当前异步编程的首选方案。</p>
<h3 data-id="heading-9">1. 核心语法：async函数与await表达式</h3>
<p>async/await的使用依赖两个关键字，规则非常明确：</p>
<ol>
<li><strong>async关键字</strong>：用于声明一个异步函数，该函数的返回值会自动包装成一个Promise对象。 </li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// 等价于 return Promise.resolve(1)</span>
}
<span class="hljs-title function_">fn</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)); <span class="hljs-comment">// 1</span>
</code></pre>
<ol>
<li><strong>await关键字</strong>：只能在async函数内部使用，用于“等待”一个Promise对象的状态变更。它会暂停当前async函数的执行，直到Promise状态变为fulfilled或rejected，然后继续执行函数并返回结果（或抛出错误）。 </li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 用async/await重构Promise链式调用</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getGoodsInfo</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">try</span> {
     <span class="hljs-comment">// 等待用户信息请求完成</span>
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestUserInfo</span>(userId);
        <span class="hljs-comment">// 等待订单请求完成（依赖用户信息）</span>
        <span class="hljs-keyword">const</span> order = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestOrder</span>(user.<span class="hljs-property">orderId</span>);
        <span class="hljs-comment">// 等待商品请求完成（依赖订单信息）</span>
        <span class="hljs-keyword">const</span> goods = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestGoods</span>(order.<span class="hljs-property">goodsId</span>);
        <span class="hljs-keyword">return</span> goods;
     } <span class="hljs-keyword">catch</span> (error) {
         <span class="hljs-comment">// 统一捕获所有await的错误</span>
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败：'</span>, error);
         <span class="hljs-keyword">throw</span> error; <span class="hljs-comment">// 可向上层抛出错误</span>
     }
}

 <span class="hljs-comment">// 调用异步函数</span>
<span class="hljs-title function_">getGoodsInfo</span>(<span class="hljs-number">123</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">goods</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(goods));
</code></pre>
<p>对比之前的回调和Promise链式调用，async/await的优势显而易见：代码完全线性化，逻辑清晰如同步代码，错误处理也通过try/catch统一管理，极大提升了可读性和可维护性。</p>
<h3 data-id="heading-10">2. 关键注意点：await的“等待”与并行优化</h3>
<p>async/await虽然好用，但如果使用不当，很容易出现“性能问题”，这也是面试的高频坑点。比如下面的代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 错误示例：不必要的串行等待</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMultiData</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 两个请求无依赖关系，却串行执行，耗时 = 1s + 1s = 2s</span>
  <span class="hljs-keyword">const</span> data1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData1</span>();
  <span class="hljs-keyword">const</span> data2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData2</span>();
  <span class="hljs-keyword">return</span> { data1, data2 };
}
</code></pre>
<p>问题在于：requestData1和requestData2之间没有依赖关系，却因为await的串行等待导致总耗时增加。<strong>优化方案</strong>是先同时触发两个异步操作，再用await等待结果，借助Promise.all实现并行：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 优化：并行执行无依赖的异步操作</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMultiData</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 同时触发两个请求，无等待</span>
  <span class="hljs-keyword">const</span> promise1 = <span class="hljs-title function_">requestData1</span>();
  <span class="hljs-keyword">const</span> promise2 = <span class="hljs-title function_">requestData2</span>();
  <span class="hljs-comment">// 等待两个请求都完成，耗时 = 1s（取最长时间）</span>
  <span class="hljs-keyword">const</span> data1 = <span class="hljs-keyword">await</span> promise1;
  <span class="hljs-keyword">const</span> data2 = <span class="hljs-keyword">await</span> promise2;
  <span class="hljs-keyword">return</span> { data1, data2 };
  <span class="hljs-comment">// 或直接用Promise.all：</span>
  <span class="hljs-comment">// const [data1, data2] = await Promise.all([promise1, promise2]);</span>
}
</code></pre>
<p>面试必考点：async/await的并行优化。核心原则是“无依赖的异步操作尽量并行执行”，通过先创建Promise实例（触发异步操作），再await的方式，或直接结合Promise.all，避免不必要的串行等待。</p>
<h3 data-id="heading-11">3. 错误处理：try/catch与Promise.catch的结合</h3>
<p>await后面的Promise如果变为rejected状态，会抛出一个异常，因此需要用try/catch捕获。但在实际开发中，也可以结合Promise的catch方法，实现更灵活的错误处理：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 方式1：局部try/catch（捕获指定await的错误）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'requestData失败：'</span>, error);
  }
  <span class="hljs-comment">// 其他逻辑不受影响</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'继续执行'</span>);
}

<span class="hljs-comment">// 方式2：全局catch（捕获async函数的所有错误）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn2</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>();
  <span class="hljs-keyword">return</span> data;
}
<span class="hljs-title function_">fn2</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'fn2执行失败：'</span>, error));
</code></pre>
<p>实际开发中，可根据错误处理的粒度需求选择合适的方式：局部错误用try/catch，全局或跨函数的错误用catch方法。</p>
<h2 data-id="heading-12">四、面试高频题：从原理到实战</h2>
<p>掌握了基础后，我们结合面试真题，强化对核心知识点的理解。</p>
<h3 data-id="heading-13">真题1：Promise的状态变更与then的执行时机</h3>
<p>题目：以下代码的输出顺序是什么？</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'start'</span>);
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'promise executor'</span>);
  <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'success'</span>);
});
promise.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'end'</span>);
</code></pre>
<p>答案：start → promise executor → end → success</p>
<p>解析：Promise构造函数中的executor是<strong>同步执行</strong>的，因此会先打印“promise executor”；而then方法中的回调是<strong>微任务</strong>，会在同步代码执行完成后、事件循环的微任务阶段执行，因此“success”会在“end”之后打印。</p>
<h3 data-id="heading-14">真题2：async/await与Promise的关系</h3>
<p>题目：async/await是Promise的替代方案吗？为什么？</p>
<p>答案：不是替代方案，而是<strong>语法糖</strong>。原因：</p>
<ul>
<li>async函数的返回值本质是Promise对象，await只能等待Promise对象（如果不是，会自动包装成Promise）。</li>
<li>async/await的底层实现依赖Promise和生成器函数（Generator），它并没有脱离Promise的规范，而是简化了Promise的调用方式。</li>
<li>在需要并行执行异步操作、或使用all/race等静态方法时，依然需要结合Promise的API。</li>
</ul>
<h3 data-id="heading-15">真题3：手写Promise简化版（核心逻辑）</h3>
<p>题目：实现一个简化版Promise，包含基本的状态管理、resolve/reject和then方法。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPromise</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) {
    <span class="hljs-comment">// 初始状态</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'pending'</span>;
    <span class="hljs-comment">// 成功结果</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-comment">// 失败原因</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-comment">// 成功回调队列（支持多个then）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span> = [];
    <span class="hljs-comment">// 失败回调队列</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];

    <span class="hljs-comment">// resolve方法：状态转为成功</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; {
      <span class="hljs-comment">// 状态不可逆，只有pending才能修改</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'fulfilled'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
        <span class="hljs-comment">// 执行所有成功回调</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(value));
      }
    };

    <span class="hljs-comment">// reject方法：状态转为失败</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> = <span class="hljs-string">'rejected'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;
        <span class="hljs-comment">// 执行所有失败回调</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(reason));
      }
    };

    <span class="hljs-comment">// 执行executor，捕获同步错误</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">executor</span>(resolve, reject);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">reject</span>(error);
    }
  }

  <span class="hljs-comment">// then方法：返回新Promise，支持链式调用</span>
  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) {
    <span class="hljs-comment">// 兼容then未传回调的情况</span>
    onFulfilled = <span class="hljs-keyword">typeof</span> onFulfilled === <span class="hljs-string">'function'</span> ? onFulfilled : <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v;
    onRejected = <span class="hljs-keyword">typeof</span> onRejected === <span class="hljs-string">'function'</span> ? onRejected : <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> { <span class="hljs-keyword">throw</span> e };

    <span class="hljs-keyword">const</span> newPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-comment">// 状态已成功：直接执行回调</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'fulfilled'</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 模拟微任务异步执行</span>
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
            <span class="hljs-comment">// 回调结果传递给新Promise的resolve</span>
            <span class="hljs-title function_">resolve</span>(result);
          } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">reject</span>(error);
          }
        }, <span class="hljs-number">0</span>);
      }

      <span class="hljs-comment">// 状态已失败：直接执行回调</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'rejected'</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);
            <span class="hljs-title function_">resolve</span>(result);
          } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">reject</span>(error);
          }
        }, <span class="hljs-number">0</span>);
      }

      <span class="hljs-comment">// 状态 pending：将回调存入队列</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">status</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">try</span> {
              <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
              <span class="hljs-title function_">resolve</span>(result);
            } <span class="hljs-keyword">catch</span> (error) {
              <span class="hljs-title function_">reject</span>(error);
            }
          }, <span class="hljs-number">0</span>);
        });

        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">try</span> {
              <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>);
              <span class="hljs-title function_">resolve</span>(result);
            } <span class="hljs-keyword">catch</span> (error) {
              <span class="hljs-title function_">reject</span>(error);
            }
          }, <span class="hljs-number">0</span>);
        });
      }
    });

    <span class="hljs-keyword">return</span> newPromise;
  }
}
</code></pre>
<p>解析：简化版Promise的核心是实现“状态不可逆”和“then链式调用”。关键点包括：用队列存储pending状态时的回调、then返回新Promise以支持链式调用、通过setTimeout模拟微任务异步执行、捕获回调中的错误并传递给下一个Promise的reject。</p>
<h2 data-id="heading-16">五、总结：从入门到面试通关的核心要点</h2>
<p>Promise与async/await的核心是“解决异步编程的流程控制问题”，面试考察的不仅是API用法，更是对底层原理和工程实践的理解。最后梳理核心考点：</p>
<ol>
<li>Promise的三个状态及不可逆性，executor同步执行、then回调异步执行的特性。</li>
<li>then的链式调用原理（返回新Promise）和catch的错误捕获范围。</li>
<li>all/race/allSettled的区别及适用场景，尤其是all的“一错全错”和race的“先到先得”。</li>
<li>async/await的语法规则，与Promise的依赖关系，以及并行优化的技巧。</li>
<li>异步代码的执行顺序（同步→微任务→宏任务），结合Promise和async/await的实际场景分析。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[终于懂了-ARouter原理初探]]></title>    <link>https://juejin.cn/post/7581760987763900467</link>    <guid>https://juejin.cn/post/7581760987763900467</guid>    <pubDate>2025-12-10T06:47:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763900467" data-draft-id="7581872532362362889" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="终于懂了-ARouter原理初探"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-10T06:47:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="马孔多的炼金术师"/> <meta itemprop="url" content="https://juejin.cn/user/4469974689386972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            终于懂了-ARouter原理初探
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4469974689386972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    马孔多的炼金术师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:47:55.000Z" title="Wed Dec 10 2025 06:47:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ARouter详解</h2>
<blockquote>
<p>ARouter是阿里开源的一个专门用于帮助Android App进行组件化改造的路由框架，其核心定位是解决组件化开发中的跨模块通信和解耦问题，通过路由机制实现模块间的页面跳转、服务调用和参数传递，彻底打破了传统开发中模块间的强依赖关系。它让不同模块的页面、服务能够在不直接依赖对方实现的情况下进行交互。本文主要讲ARouter的原理，适合学会ARouter基础使用还想继续探索深层原理的读者</p>
</blockquote>
<h3 data-id="heading-1">核心设计思想</h3>
<p><strong>ARouter 的本质就是一个专为 Android 设计的路由框架</strong>，通过一个中央系统来管理和分发请求，从而实现不同模块（尤其是相互没有直接依赖关系的模块）之间的顺畅通信和页面跳转。</p>
<p><code>ARouter</code>解决的问题本质就是<strong>模块之间如何做到不依赖实现的情况下在运行时动态定位页面/服务</strong>，基于该问题<code>ARouter</code>设计了编译时，初始化时，运行时的三层核心能力。</p>
<ol start="0">
<li>编译时：通过注解 Processor（注解处理器） 扫描注解（如 <code>@Route</code>），生成 Java 类，用于描述模块中的路由信息。这个过程就是典型的<strong>APT技术应用</strong>，其最大优势在于将耗时的类扫描和映射关系建立工作从App运行时转移到了编译时，避免了在运行时使用反射，从而大大提升了性能，这也是它比其他基于运行时扫描的路由性能更好、启动更快的原因。</li>
<li>初始化时：App启动时，<code>ARouter</code>会加载所有路由表类，构建一个内存中的路由索引。</li>
<li>运行时：根据根据路径创建一个路由信息卡片(<code>PostCard</code>)，核心组件 <code>LogisticsCenter</code>会拿着这个路径到内存仓库 <code>Warehouse</code>中查找对应的 <code>RouteMeta</code>信息（包含目标Class等），并将其补全到Postcard中。最后，根据Postcard中的信息，通过Intent启动Activity或执行其他操作。</li>
</ol>
<p><strong>ARouter 之所以拆成编译、初始化、运行三步，是为了把“路径 → 类”的映射工作尽可能前置到编译期，让 App 在运行过程中不需要扫描 <code>Dex</code>、不需要反射查找目标类，从而实现几乎零成本跳转。</strong> 文章下面主要就围绕着三个时期进行讲解</p>
<h3 data-id="heading-2">预备知识</h3>
<p>讲<code>ARouter</code>的源码前先讲几个比较核心的概念</p>
<h5 data-id="heading-3">PostCard</h5>
<p><code>Postcard</code>（明信片）是一个核心概念，它封装了一次路由跳转所需的全部信息，并负责驱动整个导航流程。</p>
<p>当我们调用 <code>ARouter.getInstance().build("/app/main")</code>时，就对应生成了一个<code>PostCard</code>对象。</p>
<p>它的的本质是一个“未完全解析的跳转请求”，它把跳转路径、携带参数、目标类、拦截器状态等全部统一收敛在一个对象里，方便 <code>ARouter</code> 在运行期逐步补全。真正的 Intent 构造是最后在 <code>_navigation()</code> 才发生。Postcard 是整个路由链的“中间态模型”。</p>
<h5 data-id="heading-4">WareHouse</h5>
<p><code>Warehouse</code>（意为“仓库”）扮演着<strong>中央数据存储库</strong>的角色。它负责在内存中集中管理所有通过注解（如<code>@Route</code>、<code>@Interceptor</code>）注册的路由信息和拦截器信息，是连接编译时生成的索引和运行时实际跳转的关键枢纽，<code>ARouter</code> 能够正常工作的<strong>所有核心映射关系和关键对象</strong>都在<code>WareHouse</code>中存放。</p>
<p>当在<code>Application</code>中调用<code>ARouter.init(...)</code>时，<code>ARouter</code>会扫描这些编译器生成的类。通过反射实例化它们，并调用其<code>loadInto</code>方法，将其中定义的映射关系（例如，组名"app"对应<code>ARouter$$Group$$app.class</code>）填充到<code>Warehouse</code>的静态Map中。具体存储内容如下表</p>








































<table><thead><tr><th>存储区域</th><th>存储内容说明</th><th>关键作用与特点</th></tr></thead><tbody><tr><td><strong><code>routes</code></strong></td><td><strong>详细的路由表</strong>。以<strong>路径（Path）</strong> 为 Key，对应的<strong>路由元信息（RouteMeta）</strong> 为 Value 。</td><td>这是路由跳转的<strong>最终依据</strong>。当根据路径查找目标时，就是查询这个 Map。它采用<strong>按需加载</strong>机制，并非在初始化时就填充所有数据 。</td></tr><tr><td><strong><code>groupsIndex</code></strong></td><td><strong>路由组索引</strong>。以<strong>组名（Group）</strong> 为 Key，对应的<strong>路由组类（如 <code>ARouter$$Group$$home.class</code>）</strong> 为 Value 。</td><td>这是实现按需加载的关键。初始化时只加载这个“组目录”，当某个组下的路径第一次被访问时，才动态加载整个组的所有路由到 <code>routes</code>中 。</td></tr><tr><td><strong><code>providersIndex</code></strong></td><td><strong>服务提供者索引</strong>。通常以<strong>接口的全类名</strong>为 Key，对应的<strong>服务路由元信息（RouteMeta）</strong> 为 Value 。</td><td>记录服务接口与其实现类的映射关系，用于依赖查找和跨模块服务调用 。</td></tr><tr><td><strong><code>providers</code></strong></td><td><strong>服务提供者单例缓存</strong>。以<strong>服务接口的 Class 对象</strong>为 Key，对应的<strong>已实例化的服务实现对象</strong>为 Value 。</td><td>缓存服务实例，确保服务全局唯一，避免重复创建 。</td></tr><tr><td><strong><code>interceptorsIndex</code></strong></td><td><strong>拦截器索引</strong>。以<strong>优先级数字</strong>为 Key，对应的<strong>拦截器类（IInterceptor）</strong> 为 Value 。</td><td>记录所有拦截器及其优先级，在初始化时被加载 。</td></tr><tr><td><strong><code>interceptors</code></strong></td><td><strong>拦截器实例列表</strong>。在 ARouter 初始化完成后，根据 <code>interceptorsIndex</code>创建的<strong>拦截器对象列表</strong> 。</td><td>实际执行拦截逻辑的实例集合 。</td></tr></tbody></table>
<h3 data-id="heading-5">编译时期</h3>
<p><code>ARouter</code>的编译期工作主要由<code>arouter-compiler</code>(编译时处理器)模块完成，是 <code>ARouter</code> 的最关键部分。其中包含了多个注解处理器，它们都继承自<code>BaseProcessor</code>。</p>
<ul>
<li><strong>RouteProcessor</strong>: 处理 <code>@Route</code>注解，这是最核心的处理器，负责生成路由组（<code>Group</code>）和根（<code>Root</code>）映射表。</li>
<li><strong>InterceptorProcessor</strong>: 处理 <code>@Interceptor</code>注解，生成拦截器映射表。</li>
<li><strong>AutowiredProcessor</strong>: 处理 <code>@Autowired</code>注解，生成参数注入辅助类。</li>
</ul>
<p>这里主要讲一下<code>RouteProcessor</code>，<code>RouteProcessor</code>处理器会收集所有被<code>@Route</code>标注的元素（如Activity、Service等），并为每个元素创建一个<code>RouteMeta</code>对象。这个对象包含了该路由的所有关键信息，包括<strong>路径（Path）</strong> ：注解中定义的路径，(如<code>/app/main</code>)。<strong>分组（Group）</strong> ：如果注解中未显式指定，则从路径中提取（如<code>/app/main</code>的分组是<code>app</code>）。<strong>目标类（Destination）</strong> ：被注解的类本身。<strong>路由类型（Type）</strong> ：通过判断目标类是Activity、Service还是实现了<code>IProvider</code>接口等来确定其类型。</p>
<p>我们看下面这样的代码</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Route(path = <span class="hljs-string">"/home/main"</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HomeActivity</span> : <span class="hljs-type">AppCompatActivity</span>()
</code></pre>
<p>这里<code>RouteProcessor</code>实际做了三件事</p>
<ol start="0">
<li><code>RouteProcessor</code>的<code>process</code>方法首先会扫描并收集所有被 <code>@Route</code>注解标记的类（如 Activity、Fragment 等）作为一个集合</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"><span class="hljs-built_in">Set</span>&lt;? <span class="hljs-keyword">extends</span> TypeElement&gt; annotations, RoundEnvironment roundEnv</span>) {
​
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">CollectionUtils</span>.<span class="hljs-title function_">isNotEmpty</span>(annotations)) {
        <span class="hljs-title class_">Set</span>&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Element</span>&gt; routeElements = roundEnv.<span class="hljs-title function_">getElementsAnnotatedWith</span>(<span class="hljs-title class_">Route</span>.<span class="hljs-property">class</span>);
        <span class="hljs-title function_">parseRoutes</span>(routeElements);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>扫描后将@Route注解的集合调用<code>parseRoutes</code>对集合每个元素进行处理</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">parseRoutes</span>(Set&lt;? extends Element&gt; routeElements) {
    for (Element element : routeElements) {
        Route route = element<span class="hljs-selector-class">.getAnnotation</span>(Route.class);
        <span class="hljs-built_in">parseRoute</span>(element, route);
    }
}
</code></pre>
<p>对于每个收集到的元素，它会在<code>parseRoute</code>方法中提取注解中的关键信息（如 <code>path</code>、<code>group</code>），并根据该元素的类型（是 Activity 还是实现了 <code>IProvider</code>接口的服务等），创建一个 <code>RouteMeta</code>对象，该<code>RouteMeta</code>对象包含了该路由节点的所有元数据 , 如下</p>
<pre><code class="hljs language-ini" lang="ini">RouteMeta <span class="hljs-attr">meta</span> = new RouteMeta(
        RouteType.ACTIVITY,
        classElement, 
        routeAnnotation.path(),
        routeAnnotation.group()
)<span class="hljs-comment">;</span>
</code></pre>
<p>其中最重要的是三个信息：<strong>type</strong>（ACTIVITY / FRAGMENT / PROVIDER）、<strong>path</strong>和<strong>group</strong></p>
<ol start="2">
<li>自动创建 Group / Root 类。当所有 <code>@Route</code> 都解析完后，处理器开始生成代码。<code>ARouter</code> 编译期会生成至少两类 java 文件：</li>
</ol>
<p>（1）<code>RouteGroup_xxx.java</code>，描述某 group 下有哪些路由，<strong>负责在编译时生成并在运行时注册路由信息，导航时ARouter通过查找这些注册信息，找到目标类，最终完成跳转。</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ARouter$$Group$$home</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IRouteGroup</span> {
​
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">loadInto</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, RouteMeta&gt; atlas</span>) {
        atlas.<span class="hljs-title function_">put</span>(<span class="hljs-string">"/home/main"</span>, <span class="hljs-title class_">RouteMeta</span>.<span class="hljs-title function_">build</span>(
            <span class="hljs-title class_">RouteType</span>.<span class="hljs-property">ACTIVITY</span>, 
            <span class="hljs-title class_">MainActivity</span>.<span class="hljs-property">class</span>, 
            <span class="hljs-string">"/home/main"</span>, 
            <span class="hljs-string">"home"</span>
        ));
    }
}
​
</code></pre>
<p>（2）<code>RouteRoot_AROUTER.java</code>，描述所有 <code>group</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ARouter$$Root$$app</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IRouteRoot</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">loadInto</span>(<span class="hljs-params"><span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, Class&lt;? <span class="hljs-keyword">extends</span> IRouteGroup&gt;&gt; routes</span>) {
        routes.<span class="hljs-title function_">put</span>(<span class="hljs-string">"home"</span>, <span class="hljs-title class_">ARouter</span>$$Group$$home.<span class="hljs-property">class</span>);
    }
}
</code></pre>
<p>这两个Java文件共同构成路由表系统，都会被打包到 APK 的 <code>dex</code> 文件中，且固定放在 <code>com.alibaba.android.arouter.routes</code> 包下，为后面的跳转做准备。读者可能会疑惑为什么不直接建一张大表包含所有的路径，<strong><code>ARouter</code> 选择按 group 拆成多个 Java 类，而不是生成一张巨大路由表直接包含所有的路径，是为了避免一次性加载所有路由造成不必要的启动成本。运行期只会按需加载 group，相当于将整张路由表分片加载，这就是 <code>ARouter</code> 的“延迟加载机制”。</strong></p>
<h3 data-id="heading-6">初始化时期</h3>
<p>当应用启动调用 <code>ARouter.init(application)</code>时，就进入了初始化阶段，其核心任务是将编译期生成的各类索引(<strong>编译期间通过注解处理器自动生成的一系列映射表，上面的两个java文件就是其中最重要的索引</strong>)加载到内存中。该阶段的入口在<code>init</code>方法中</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span>(<span class="hljs-params">Application application</span>)</span> {
    ARouter.hasInit = <span class="hljs-literal">true</span>;
    LogisticsCenter.<span class="hljs-keyword">init</span>(application);
}
</code></pre>
<p>通过该入口我们实际可以看出，初始化阶段的核心逻辑在 <code>LogisticsCenter.init()</code>方法中。</p>
<p>初始化的关键工作是：<strong>找到所有编译期生成的 Root 实现类(上面说的RouteRoot_AROUTER.java)，并调用它们把 groups 注册到 Warehouse.groupsIndex</strong>。核心代码如下</p>
<pre><code class="hljs language-ini" lang="ini">public static void init(Context context) {
    ...
        Set&lt;String&gt; <span class="hljs-attr">classNames</span> = ClassUtils.getFileNameByPackageName(context, <span class="hljs-string">"com.alibaba.android.arouter.routes"</span>)<span class="hljs-comment">;</span>
    ...
        for (String className : classNames) {
            if (className.startsWith("ARouter$$Root$$")) {
                Class&lt;?&gt; <span class="hljs-attr">clazz</span> = Class.forName(className, <span class="hljs-literal">false</span>, classLoader)<span class="hljs-comment">;</span>
                IRouteRoot <span class="hljs-attr">root</span> = (IRouteRoot) clazz.newInstance()<span class="hljs-comment">;</span>
                root.loadInto(Warehouse.groupsIndex)<span class="hljs-comment">;  // 填充 group到GroupClass</span>
            }
        }
    }
</code></pre>
<p>这里<code>Class&lt;?&gt; clazz = Class.forName(className, false, classLoader);</code>用反射加载了编译期生成的路由表类，但是但这个 <code>Class.forName()</code> 不是大量反射并且整个过程只执行一次，所以性能几乎没有影响。</p>
<p>这里强调一下，初始化时<strong>只缓存了Group的索引</strong>，仅仅是将编译期生成的路由组索引信息缓存到 <code>Warehouse.groupsIndex</code>，相当于建立了一份总目录，以<strong>组名（Group）</strong> 为 Key，对应的<strong>路由组类（如 <code>ARouter$$Group$$home.class</code>）</strong> 为 Value 。而<strong>每个Group下的具体路由信息，是在该组第一次被访问时才动态加载和缓存的</strong>。这种“分组懒加载”的设计是<code>ARouter</code>在性能优化上的一个关键点，它确保了应用启动速度快，且运行时内存占用合理。</p>
<h3 data-id="heading-7">运行期</h3>
<p>编译期生成了很多 <code>ARouter$$Root$$*</code>、<code>ARouter$$Group$$*</code>、<code>*$$ARouter$$Autowired</code>、<code>ARouter$$Interceptors$$*</code> 类；运行期通过加载这些生成类把路由索引（<code>group</code> → <code>groupClass</code>，<code>path</code> → <code>RouteMeta</code>）填入 <code>Warehouse</code>，<code>ARouter.build(path)</code> 构造 <code>Postcard</code>，<code>navigation()</code> 负责：确保路由已加载、处理拦截器、准备 Intent / 参数、执行跳转或返回 provider/fragment 等。运行期主要分为三大模块，<strong>构建 <code>Postcard</code></strong>、<strong><code>LogisticsCenter.prepareCard()</code>：加载 <code>group</code> 文件</strong>、<strong>跳转与拦截器链</strong></p>
<p>当我们调用 <code>ARouter.getinstance().build()</code> 时，其实是在创建一个明信片 <code>Postcard</code> 对象，<code>withXXX()</code> 和 <code>navigation()</code> 等方法就是它的方法。我们看一下<code>build()</code>的源码</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">Postcard</span> <span class="hljs-title function_">build</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> path</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Postcard</span>(path, <span class="hljs-title function_">extractGroup</span>(path));
}
</code></pre>
<p><code>Postcard</code> 继承了 <code>RouteMeta</code>，包含了目的地址（路径、分组）以及后续可能添加的参数（Extras）等信息 。但此时明信片上的“收件人 <strong>”目标类</strong>还是未知的。真正的核心逻辑继续看 <code>navigation()</code>方法。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">navigation</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Context context, <span class="hljs-keyword">final</span> Postcard postcard, <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> requestCode, <span class="hljs-keyword">final</span> NavigationCallback callback)</span> {
    .......
    LogisticsCenter.completion(postcard); <span class="hljs-comment">// 解析路由 / 加载 group</span>
    .......
    <span class="hljs-comment">// 执行拦截器链</span>
    <span class="hljs-keyword">if</span> (!postcard.isGreenChannel()) {
        interceptorService.doInterceptions(postcard, <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterceptorCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onContinue</span><span class="hljs-params">(Postcard postcard)</span> {
                _navigation()
            }
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onInterrupt</span><span class="hljs-params">(Throwable throwable)</span> {
                callback.onInterrupt()
            }
        });
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> _navigation();
    }
}
</code></pre>
<p>其中代码<code>LogisticsCenter.completion(postcard)</code><strong>根据路径找到对应的目标类，并将信息填充到Postcard中</strong>。<code>completion</code>的代码如下，就是从缓存中通过 <code>path</code>查找 <code>RouteMeta</code>。</p>
<pre><code class="hljs language-ini" lang="ini">public static void completion(Postcard postcard) {
    RouteMeta <span class="hljs-attr">meta</span> = Warehouse.routes.get(postcard.getPath())<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">meta</span> == null) {
        loadGroupIfNecessary(postcard.getGroup())<span class="hljs-comment">;</span>
        <span class="hljs-attr">meta</span> = Warehouse.routes.get(postcard.getPath())<span class="hljs-comment">;</span>
    }
    postcard.setRouteMeta(meta)<span class="hljs-comment">;</span>
}
</code></pre>
<p>如果没有即<code>meta == null</code>，则延迟加载 <code>group：loadGroupIfNecessary()</code>，核心代码如下。</p>
<p>首先从 <strong>分组索引表</strong> (<code>Warehouse.groupsIndex</code>) 中获取该组对应的“组加载器”的 Class 对象</p>
<p>接着通过<strong>反射</strong>机制<code>groupMeta.getConstructor().newInstance();</code>将上一步获取到的 <strong>Class 对象</strong>实例化，其中<code>group.loadInto(Warehouse.routes)</code>这个方法会一次性将 <code>home</code>分组下的<strong>所有</strong>路由（包括 <code>/home/main</code>和 <code>/home/detail</code>）的 <code>RouteMeta</code>信息都添加到 <code>Warehouse.routes</code>缓存中。</p>
<p>最后再从分组索引表中将该group移除，因为该Group的路由信息已经加载到缓存了，下次再找目标类并填充到Postcard时直接就在缓存中找到了。</p>
<p>这个过程也用到了反射，因为前面初始化阶段为了性能考虑，仅仅缓存了以<strong>组名（Group）</strong> 为 Key，对应的<strong>路由组类（如 <code>ARouter$$Group$$home.class</code>）</strong> 为 Value 的路由组信息，得不到实例类（想得到要么在运行前将所有的routes进行加载然后按需使用，要么对所有routes进行反射遍历，前者费空间后者又费时间）</p>
<pre><code class="hljs language-ini" lang="ini">Class&lt;? extends IRouteGroup&gt; <span class="hljs-attr">groupMeta</span> = Warehouse.groupsIndex.get(groupName)<span class="hljs-comment">;</span>
IRouteGroup <span class="hljs-attr">group</span> =  groupMeta.getConstructor().newInstance()<span class="hljs-comment">;</span>
group.loadInto(Warehouse.routes)<span class="hljs-comment">;</span>
Warehouse.groupsIndex.remove(groupName)<span class="hljs-comment">;</span>
</code></pre>
<p>当 Postcard 填充完 <code>RouteMeta</code> 后，<code>ARouter</code> 会继续执行拦截器链，即下面这段代码。</p>
<pre><code class="hljs language-typescript" lang="typescript">   <span class="hljs-keyword">if</span> (!postcard.<span class="hljs-title function_">isGreenChannel</span>()) {
        interceptorService.<span class="hljs-title function_">doInterceptions</span>(postcard, <span class="hljs-keyword">new</span> <span class="hljs-title class_">InterceptorCallback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onContinue</span>(<span class="hljs-params">Postcard postcard</span>) {
                <span class="hljs-title function_">_navigation</span>()
            }
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onInterrupt</span>(<span class="hljs-params">Throwable throwable</span>) {
                callback.<span class="hljs-title function_">onInterrupt</span>()
            }
        });
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">_navigation</span>();
    }
}
</code></pre>
<p>这段代码的逻辑还是比较清楚的，如果这次跳转没有开启“绿色通道”，拦截器链就会被启动。会进行<strong>链式执行</strong>：<code>ARouter</code>会按照优先级顺序，依次调用每个拦截器的 <code>process</code>方法。每个拦截器在执行完自己的逻辑后，<strong>必须</strong>调用以下两个回调函数之一来决定路由的走向</p>
<ul>
<li><strong><code>callback.onContinue(postcard)</code></strong> ：表示放行，流程将继续交给下一个拦截器。</li>
<li><strong><code>callback.onInterrupt(throwable)</code></strong> ：表示中断，整个跳转过程会立即停止，后续拦截器不再执行，并通过 <code>NavigationCallback</code>通知调用者跳转被拦截了。<strong>一旦有一个拦截器interrupt 整个跳转就终止，所有拦截器都通过后才执行真正的跳转</strong></li>
</ul>
<p>最终调用<code>_navigation</code>进行跳转，内部还是利用<code>Intent</code>跳转，结尾整个ARouter的流程</p>
<pre><code class="hljs language-scss" lang="scss">private <span class="hljs-selector-tag">Object</span> <span class="hljs-built_in">_navigation</span>() {
​
    <span class="hljs-built_in">switch</span>(routeMeta.type) {
​
        case ACTIVITY:
            Intent intent = new <span class="hljs-built_in">Intent</span>(context, routeMeta.<span class="hljs-built_in">getDestination</span>());
            postcard<span class="hljs-selector-class">.putExtras</span>(intent);
            
            if (requestCode &gt; <span class="hljs-number">0</span>) {
                ((Activity) context)<span class="hljs-selector-class">.startActivityForResult</span>(intent, requestCode);
            } else {
                context<span class="hljs-selector-class">.startActivity</span>(intent);
            }
            break;
​
        case PROVIDER:
            return <span class="hljs-built_in">getOrCreateProvider</span>(routeMeta);
        
        case FRAGMENT:
            Fragment fragment = routeMeta.<span class="hljs-built_in">getDestination</span>().<span class="hljs-built_in">newInstance</span>();
            fragment<span class="hljs-selector-class">.setArguments</span>(postcard.getExtras());
            return fragment;
​
        <span class="hljs-comment">// 其他类型略...</span>
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite 插件开发实战：从业务痛点到优雅解决方案]]></title>    <link>https://juejin.cn/post/7581844141669580840</link>    <guid>https://juejin.cn/post/7581844141669580840</guid>    <pubDate>2025-12-10T07:53:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141669580840" data-draft-id="7581844141669548072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite 插件开发实战：从业务痛点到优雅解决方案"/> <meta itemprop="keywords" content="架构,前端框架,Vue.js"/> <meta itemprop="datePublished" content="2025-12-10T07:53:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大象的鼻子那么长"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite 插件开发实战：从业务痛点到优雅解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大象的鼻子那么长
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 融会贯通" title="VIP.4 融会贯通" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T07:53:03.000Z" title="Wed Dec 10 2025 07:53:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>日期</strong>: 2025-12-10<br/>
<strong>标签</strong>: Vite, 插件开发, Vue3, 工程化, 性能优化</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">📖 前言</h2>
<p>在企业级 Vue 3 项目开发中，我们经常会遇到一些"小而烦"的问题——它们不复杂，但需要开发者在每个页面重复做同样的事情。这类问题最适合通过工程化手段来解决。</p>
<p>本文将以一个真实的业务需求为例，带你从零开始开发一个 Vite 插件，体验<strong>从痛点发现到优雅解决</strong>的完整过程。</p>
<p><strong>你将学到：</strong></p>
<ul>
<li>🎯 Vite 插件的核心概念和工作原理</li>
<li>🛠️ 如何从零开发一个实用的 Vite 插件</li>
<li>📊 插件开发的调试技巧和最佳实践</li>
<li>💡 工程化思维：如何识别和解决重复性问题</li>
</ul>
<hr/>
<h2 data-id="heading-1">一、业务痛点：Keep-Alive 的"名称陷阱"</h2>
<h3 data-id="heading-2">1.1 问题背景</h3>
<p>在 Vue 3 中，<code>&lt;keep-alive&gt;</code> 通过 <code>include</code> 属性控制哪些组件需要缓存：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;keep-alive :include="['UserList', 'OrderList']"&gt;
  &lt;router-view /&gt;
&lt;/keep-alive&gt;
</code></pre>
<p>问题来了：<strong><code>include</code> 匹配的是组件的 <code>name</code> 属性</strong>。</p>
<p>在 Vue 3 的 <code>&lt;script setup&gt;</code> 语法中，组件默认是没有 <code>name</code> 的！必须手动添加：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
// 必须手动添加这段代码，否则 keep-alive 无法匹配
defineOptions({
  name: 'UserList', // 必须与路由 name 一致
})
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-3">1.2 痛点分析</h3>
<p>这看起来只是"加一行代码"的事，但在实际项目中：</p>

























<table><thead><tr><th>问题</th><th>影响</th></tr></thead><tbody><tr><td>容易遗漏</td><td>新页面忘记添加，缓存不生效</td></tr><tr><td>容易写错</td><td>名称与路由 name 不一致，缓存失效</td></tr><tr><td>重复劳动</td><td>每个页面都要写同样的代码</td></tr><tr><td>维护成本</td><td>路由 name 改了，还要同步改组件</td></tr></tbody></table>
<p>在一个有 50+ 页面的项目中，这意味着：</p>
<ul>
<li>50+ 处需要手动添加</li>
<li>50+ 个潜在的出错点</li>
<li>无法自动检测问题</li>
</ul>
<h3 data-id="heading-4">1.3 理想解决方案</h3>
<pre><code class="hljs">既然路由配置中已经有了 name 和 component 的映射关系，
为什么不让构建工具自动帮我们注入呢？
</code></pre>
<p>这就是 Vite 插件大显身手的时候了！</p>
<hr/>
<h2 data-id="heading-5">二、Vite 插件入门</h2>
<h3 data-id="heading-6">2.1 什么是 Vite 插件？</h3>
<p>Vite 插件是一个符合特定接口的 JavaScript 对象，它可以<strong>介入 Vite 的构建流程</strong>，在特定时机执行自定义逻辑。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 最简单的 Vite 插件结构</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myPlugin</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'my-plugin'</span>, <span class="hljs-comment">// 插件名称（必需）</span>
    
    <span class="hljs-comment">// 各种钩子函数</span>
    <span class="hljs-title function_">configResolved</span>(<span class="hljs-params">config</span>) { },  <span class="hljs-comment">// 配置解析完成</span>
    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) { },     <span class="hljs-comment">// 转换模块内容</span>
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<h3 data-id="heading-7">2.2 核心概念</h3>
<h4 data-id="heading-8">钩子函数（Hooks）</h4>
<p>Vite 插件通过钩子函数介入构建流程：</p>
<pre><code class="hljs language-arduino" lang="arduino">配置阶段                    构建阶段                    输出阶段
    │                          │                          │
    ▼                          ▼                          ▼
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ config  │───▶│ resolve │───▶│transform│───▶│ render  │
└─────────┘    └─────────┘    └─────────┘    └─────────┘
    │              │              │              │
  配置合并      解析模块ID      转换代码        生成输出
</code></pre>
<p>常用钩子：</p>






























<table><thead><tr><th>钩子</th><th>时机</th><th>典型用途</th></tr></thead><tbody><tr><td><code>config</code></td><td>配置合并前</td><td>修改 Vite 配置</td></tr><tr><td><code>configResolved</code></td><td>配置解析完成</td><td>读取最终配置</td></tr><tr><td><code>transform</code></td><td>转换模块时</td><td>修改代码内容</td></tr><tr><td><code>handleHotUpdate</code></td><td>HMR 更新时</td><td>自定义热更新逻辑</td></tr></tbody></table>
<h4 data-id="heading-9">enforce 执行顺序</h4>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-attr">name</span>: <span class="hljs-string">'my-plugin'</span>,
  <span class="hljs-attr">enforce</span>: <span class="hljs-string">'pre'</span>,  <span class="hljs-comment">// 在其他插件之前执行</span>
  <span class="hljs-comment">// enforce: 'post', // 在其他插件之后执行</span>
  <span class="hljs-comment">// 不设置则按默认顺序</span>
}
</code></pre>
<h3 data-id="heading-10">2.3 为什么选择 Vite 插件？</h3>
<p>对比其他方案：</p>

























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>ESLint 规则</td><td>可以检测</td><td>只能提醒，无法自动修复</td></tr><tr><td>代码生成脚本</td><td>一次性生成</td><td>需要手动运行，易遗漏</td></tr><tr><td><strong>Vite 插件</strong></td><td>自动、实时、无感知</td><td>需要一定开发成本</td></tr></tbody></table>
<p>Vite 插件的核心优势：<strong>在编译时自动处理，对开发者完全透明</strong>。</p>
<hr/>
<h2 data-id="heading-11">三、实战：开发自动注入插件</h2>
<h3 data-id="heading-12">3.1 设计思路</h3>
<pre><code class="hljs language-bash" lang="bash">┌─────────────────────────────────────────────────────────────┐
│                    插件工作流程                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 启动时扫描路由配置                                        │
│     ┌─────────────────────────────────────────────────────┐ │
│     │ src/router/modules/*.ts                             │ │
│     │ ─────────────────────                               │ │
│     │ { name: <span class="hljs-string">'UserList'</span>, component: () =&gt; import(...) }  │ │
│     └─────────────────────────────────────────────────────┘ │
│                         │                                   │
│                         ▼                                   │
│  2. 构建映射表                                               │
│     ┌─────────────────────────────────────────────────────┐ │
│     │ Map&lt;组件路径, 路由名称&gt;                               │ │
│     │ <span class="hljs-string">'src/views/user/list.vue'</span> =&gt; <span class="hljs-string">'UserList'</span>             │ │
│     └─────────────────────────────────────────────────────┘ │
│                         │                                   │
│                         ▼                                   │
│  3. 编译时检测 &amp; 注入                                        │
│     ┌─────────────────────────────────────────────────────┐ │
│     │ 是路由组件？ ──否──▶ 跳过                            │ │
│     │      │                                              │ │
│     │      是                                             │ │
│     │      │                                              │ │
│     │      ▼                                              │ │
│     │ 已有 defineOptions？ ──是──▶ 跳过                   │ │
│     │      │                                              │ │
│     │      否                                             │ │
│     │      │                                              │ │
│     │      ▼                                              │ │
│     │ 自动注入 defineOptions({ name: <span class="hljs-string">'xxx'</span> })             │ │
│     └─────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-13">3.2 完整代码实现</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// build/plugins/vite-plugin-auto-component-name.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Plugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> {
  <span class="hljs-comment">/** 路由配置目录 */</span>
  routerDir?: <span class="hljs-built_in">string</span>
  <span class="hljs-comment">/** 是否输出调试日志 */</span>
  debug?: <span class="hljs-built_in">boolean</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">autoComponentName</span>(<span class="hljs-params">options: Options = {}</span>): <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-keyword">const</span> {
    routerDir = <span class="hljs-string">'src/router/modules'</span>,
    debug = <span class="hljs-literal">false</span>,
  } = options

  <span class="hljs-comment">// 组件路径 =&gt; 路由名称 的映射</span>
  <span class="hljs-keyword">const</span> routeMappings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;()
  <span class="hljs-keyword">let</span> projectRoot = <span class="hljs-string">''</span>

  <span class="hljs-comment">// 调试日志</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {
    <span class="hljs-keyword">if</span> (debug) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[auto-component-name]'</span>, ...args)
    }
  }

  <span class="hljs-comment">// 解析路由文件，提取映射关系</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseRouterFile</span>(<span class="hljs-params">filePath: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(filePath, <span class="hljs-string">'utf-8'</span>)
    <span class="hljs-keyword">const</span> lines = content.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
    <span class="hljs-keyword">let</span> currentName = <span class="hljs-string">''</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
      <span class="hljs-comment">// 匹配 name: 'xxx'</span>
      <span class="hljs-keyword">const</span> nameMatch = line.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/name:\s*['"`]([^'"`]+)['"`]/</span>)
      <span class="hljs-keyword">if</span> (nameMatch) {
        currentName = nameMatch[<span class="hljs-number">1</span>]
      }

      <span class="hljs-comment">// 匹配 component: () =&gt; import('xxx')</span>
      <span class="hljs-keyword">const</span> componentMatch = line.<span class="hljs-title function_">match</span>(
        <span class="hljs-regexp">/component:\s*(?:async\s*)?\(\)\s*=&gt;\s*import\(['"`]([^'"`]+)['"`]\)/</span>
      )
      <span class="hljs-keyword">if</span> (componentMatch &amp;&amp; currentName) {
        <span class="hljs-keyword">const</span> componentPath = <span class="hljs-title function_">normalizeImportPath</span>(componentMatch[<span class="hljs-number">1</span>])
        routeMappings.<span class="hljs-title function_">set</span>(componentPath, currentName)
        <span class="hljs-title function_">log</span>(<span class="hljs-string">`Found: <span class="hljs-subst">${currentName}</span> =&gt; <span class="hljs-subst">${componentPath}</span>`</span>)
        currentName = <span class="hljs-string">''</span>
      }
    }
  }

  <span class="hljs-comment">// 标准化导入路径</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeImportPath</span>(<span class="hljs-params">importPath: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> importPath
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^~\//</span>, <span class="hljs-string">'src/'</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^@\//</span>, <span class="hljs-string">'src/'</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">'/'</span>)
  }

  <span class="hljs-comment">// 扫描所有路由文件</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">scanRouterModules</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> routerPath = path.<span class="hljs-title function_">resolve</span>(projectRoot, routerDir)
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(routerPath)) <span class="hljs-keyword">return</span>

    routeMappings.<span class="hljs-title function_">clear</span>()
    <span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(routerPath).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.ts'</span>))
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
      <span class="hljs-title function_">parseRouterFile</span>(path.<span class="hljs-title function_">join</span>(routerPath, file))
    }
    
    <span class="hljs-title function_">log</span>(<span class="hljs-string">`Scanned <span class="hljs-subst">${files.length}</span> files, found <span class="hljs-subst">${routeMappings.size}</span> routes`</span>)
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vite-plugin-auto-component-name'</span>,
    <span class="hljs-attr">enforce</span>: <span class="hljs-string">'pre'</span>, <span class="hljs-comment">// 在 Vue 插件之前执行</span>

    <span class="hljs-comment">// 配置解析完成后，扫描路由</span>
    <span class="hljs-title function_">configResolved</span>(<span class="hljs-params">config</span>) {
      projectRoot = config.<span class="hljs-property">root</span>
      <span class="hljs-title function_">scanRouterModules</span>()
    },

    <span class="hljs-comment">// 路由文件变化时，重新扫描</span>
    <span class="hljs-title function_">handleHotUpdate</span>(<span class="hljs-params">{ file }</span>) {
      <span class="hljs-keyword">if</span> (file.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'router'</span>) &amp;&amp; file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.ts'</span>)) {
        <span class="hljs-title function_">log</span>(<span class="hljs-string">'Router changed, rescanning...'</span>)
        <span class="hljs-title function_">scanRouterModules</span>()
      }
    },

    <span class="hljs-comment">// 转换 Vue 文件</span>
    <span class="hljs-title function_">transform</span>(<span class="hljs-params">code, id</span>) {
      <span class="hljs-comment">// 只处理 Vue 文件</span>
      <span class="hljs-keyword">if</span> (!id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.vue'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

      <span class="hljs-comment">// 获取相对路径</span>
      <span class="hljs-keyword">const</span> relativePath = path.<span class="hljs-title function_">relative</span>(projectRoot, id).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">'/'</span>)
      
      <span class="hljs-comment">// 查找是否为路由组件</span>
      <span class="hljs-keyword">const</span> routeName = routeMappings.<span class="hljs-title function_">get</span>(relativePath)
      <span class="hljs-keyword">if</span> (!routeName) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

      <span class="hljs-comment">// 已有 defineOptions 则跳过</span>
      <span class="hljs-keyword">if</span> (code.<span class="hljs-title function_">includes</span>(<span class="hljs-params"><span class="hljs-string">'defineOptions('</span></span>)) {
        <span class="hljs-title function_">log</span>(<span class="hljs-string">`Skip <span class="hljs-subst">${relativePath}</span>: already has defineOptions`</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
      }

      <span class="hljs-comment">// 查找 &lt;script setup&gt; 标签</span>
      <span class="hljs-keyword">const</span> match = code.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/&lt;script\s+setup[^&gt;]*&gt;([\s\S]*?)&lt;\/script&gt;/i</span>)
      <span class="hljs-keyword">if</span> (!match) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

      <span class="hljs-comment">// 构造注入代码</span>
      <span class="hljs-keyword">const</span> injection = <span class="hljs-string">`
/**
 * 组件名称（由 vite-plugin-auto-component-name 自动注入）
 */
defineOptions({
  name: '<span class="hljs-subst">${routeName}</span>',
})
`</span>
      <span class="hljs-comment">// 在 import 语句之后注入</span>
      <span class="hljs-keyword">const</span> scriptStart = match.<span class="hljs-property">index</span>! + match[<span class="hljs-number">0</span>].<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'&gt;'</span>) + <span class="hljs-number">1</span>
      <span class="hljs-keyword">const</span> scriptContent = match[<span class="hljs-number">1</span>]
      
      <span class="hljs-comment">// 找到最后一个 import 的位置</span>
      <span class="hljs-keyword">let</span> insertPos = scriptStart
      <span class="hljs-keyword">const</span> lines = scriptContent.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>)
      <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
        offset += line.<span class="hljs-property">length</span> + <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'import '</span>)) {
          insertPos = scriptStart + offset
        }
      }

      <span class="hljs-keyword">const</span> newCode = code.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, insertPos) + injection + code.<span class="hljs-title function_">slice</span>(insertPos)
      
      <span class="hljs-title function_">log</span>(<span class="hljs-string">`Injected: <span class="hljs-subst">${relativePath}</span> =&gt; <span class="hljs-subst">${routeName}</span>`</span>)
      
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: newCode, <span class="hljs-attr">map</span>: <span class="hljs-literal">null</span> }
    },
  }
}
</code></pre>
<h3 data-id="heading-14">3.3 使用方式</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { autoComponentName } <span class="hljs-keyword">from</span> <span class="hljs-string">'./build/plugins/vite-plugin-auto-component-name'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">autoComponentName</span>({
      <span class="hljs-attr">routerDir</span>: <span class="hljs-string">'src/router/modules'</span>,
      <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开发时开启日志</span>
    }),
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-comment">// ...其他插件</span>
  ],
})
</code></pre>
<h3 data-id="heading-15">3.4 效果对比</h3>
<p><strong>之前（每个页面手动添加）</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { ref } from 'vue'

// 必须手动添加，容易遗漏
defineOptions({
  name: 'UserList',
})

// 业务代码...
&lt;/script&gt;
</code></pre>
<p><strong>之后（自动注入，零成本）</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { ref } from 'vue'

// 无需任何代码，插件自动处理！
// 编译后会自动包含 defineOptions({ name: 'UserList' })

// 业务代码...
&lt;/script&gt;
</code></pre>
<hr/>
<h2 data-id="heading-16">四、调试技巧</h2>
<h3 data-id="heading-17">4.1 开启调试日志</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">autoComponentName</span>({
  <span class="hljs-attr">debug</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 控制台输出注入日志</span>
})
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[auto-component-name]</span> Scanned 12 files, found 48 routes
<span class="hljs-section">[auto-component-name]</span> Injected: src/views/user/<span class="hljs-attr">list.vue</span> =&gt; UserList
<span class="hljs-section">[auto-component-name]</span> Skip src/views/user/detail.vue: already has defineOptions
</code></pre>
<h3 data-id="heading-18">4.2 查看转换后的代码</h3>
<p>在 Chrome DevTools 中：</p>
<ol>
<li>打开 Sources 面板</li>
<li>找到对应的 Vue 文件</li>
<li>查看编译后的代码，确认 <code>defineOptions</code> 已注入</li>
</ol>
<h3 data-id="heading-19">4.3 处理边界情况</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 需要考虑的边界情况：</span>

<span class="hljs-comment">// 1. 组件已有 defineOptions</span>
<span class="hljs-keyword">if</span> (code.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'defineOptions('</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

<span class="hljs-comment">// 2. 使用 Options API（有 name 属性）</span>
<span class="hljs-keyword">if</span> (code.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'name:'</span>) &amp;&amp; code.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'export default'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

<span class="hljs-comment">// 3. 非 &lt;script setup&gt; 组件</span>
<span class="hljs-keyword">if</span> (!code.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/&lt;script\s+setup/</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">五、最佳实践</h2>
<h3 data-id="heading-21">5.1 插件设计原则</h3>

























<table><thead><tr><th>原则</th><th>说明</th></tr></thead><tbody><tr><td><strong>幂等性</strong></td><td>多次执行结果一致，已处理过的跳过</td></tr><tr><td><strong>无侵入</strong></td><td>不影响已有代码，只添加缺失的部分</td></tr><tr><td><strong>可调试</strong></td><td>提供日志开关，方便排查问题</td></tr><tr><td><strong>高性能</strong></td><td>避免不必要的处理，尽早返回</td></tr></tbody></table>
<h3 data-id="heading-22">5.2 性能优化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 尽早返回</span>
<span class="hljs-keyword">if</span> (!id.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.vue'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

<span class="hljs-comment">// 2. 使用 Map 缓存映射关系</span>
<span class="hljs-keyword">const</span> routeMappings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;()

<span class="hljs-comment">// 3. 避免重复扫描</span>
<span class="hljs-title function_">handleHotUpdate</span>(<span class="hljs-params">{ file }</span>) {
  <span class="hljs-comment">// 只有路由文件变化才重新扫描</span>
  <span class="hljs-keyword">if</span> (file.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'router'</span>) &amp;&amp; file.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.ts'</span>)) {
    <span class="hljs-title function_">scanRouterModules</span>()
  }
}
</code></pre>
<h3 data-id="heading-23">5.3 错误处理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">parseRouterFile</span>(<span class="hljs-params">filePath: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> content = fs.<span class="hljs-title function_">readFileSync</span>(filePath, <span class="hljs-string">'utf-8'</span>)
    <span class="hljs-comment">// ... 解析逻辑</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[auto-component-name] Failed to parse <span class="hljs-subst">${filePath}</span>:`</span>, error)
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-24">六、业务价值</h2>
<h3 data-id="heading-25">6.1 量化收益</h3>






























<table><thead><tr><th>指标</th><th>优化前</th><th>优化后</th></tr></thead><tbody><tr><td>每页面额外代码</td><td>5-10 行</td><td><strong>0 行</strong></td></tr><tr><td>潜在 Bug 点</td><td>N 个页面</td><td><strong>0</strong></td></tr><tr><td>新人上手成本</td><td>需要了解约定</td><td><strong>无感知</strong></td></tr><tr><td>维护成本</td><td>路由改名需同步</td><td><strong>自动同步</strong></td></tr></tbody></table>
<h3 data-id="heading-26">6.2 延伸价值</h3>
<p>这个插件的设计思路可以复用到其他场景：</p>
<ul>
<li><strong>自动注入页面权限</strong>: 根据路由 meta 注入权限检查代码</li>
<li><strong>自动生成埋点代码</strong>: 根据路由配置注入页面曝光埋点</li>
<li><strong>自动添加 Loading 状态</strong>: 为异步组件添加统一的加载状态</li>
</ul>
<h3 data-id="heading-27">6.3 工程化思维</h3>
<pre><code class="hljs">发现重复劳动 → 分析规律 → 自动化解决 → 沉淀为工具
</code></pre>
<p>这是工程化的核心思维：<strong>用机器代替人做重复的事</strong>。</p>
<hr/>
<h2 data-id="heading-28">七、总结</h2>
<p>本文通过一个真实的业务需求，完整演示了 Vite 插件的开发过程：</p>
<ol>
<li><strong>识别痛点</strong>：keep-alive 需要手动定义组件 name</li>
<li><strong>设计方案</strong>：扫描路由配置，编译时自动注入</li>
<li><strong>实现插件</strong>：利用 <code>configResolved</code> 和 <code>transform</code> 钩子</li>
<li><strong>调试优化</strong>：添加日志、处理边界情况、性能优化</li>
</ol>
<p><strong>关键收获：</strong></p>
<ul>
<li>Vite 插件是介入构建流程的强大工具</li>
<li><code>transform</code> 钩子可以修改任何模块的代码</li>
<li>好的插件应该是无侵入、幂等、可调试的</li>
<li>工程化的核心是用自动化消除重复劳动</li>
</ul>
<hr/>
<h2 data-id="heading-29">附录：Vite 插件开发资源</h2>
<ul>
<li>📚 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2Fguide%2Fapi-plugin.html" target="_blank" title="https://cn.vitejs.dev/guide/api-plugin.html" ref="nofollow noopener noreferrer">Vite 插件 API 官方文档</a></li>
<li>📚 <a href="https://link.juejin.cn?target=https%3A%2F%2Frollupjs.org%2Fplugin-development%2F" target="_blank" title="https://rollupjs.org/plugin-development/" ref="nofollow noopener noreferrer">Rollup 插件开发指南</a></li>
<li>🔧 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantfu%2Fvite-plugin-inspect" target="_blank" title="https://github.com/antfu/vite-plugin-inspect" ref="nofollow noopener noreferrer">vite-plugin-inspect</a> - 调试插件必备</li>
<li>🎨 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fawesome-vite" target="_blank" title="https://github.com/vitejs/awesome-vite" ref="nofollow noopener noreferrer">awesome-vite</a> - 优秀插件合集</li>
</ul>
<hr/>
<blockquote>
<p>💬 <strong>欢迎交流</strong>：如果你有更好的想法或遇到问题，欢迎在评论区讨论！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gopher 带你学并发计数器：从最快到最慢的性能之旅]]></title>    <link>https://juejin.cn/post/7581786379804426275</link>    <guid>https://juejin.cn/post/7581786379804426275</guid>    <pubDate>2025-12-10T06:02:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379804426275" data-draft-id="7581814484065091636" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gopher 带你学并发计数器：从最快到最慢的性能之旅"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2025-12-10T06:02:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没多少逻辑"/> <meta itemprop="url" content="https://juejin.cn/user/2717648475395325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gopher 带你学并发计数器：从最快到最慢的性能之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648475395325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没多少逻辑
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:02:38.000Z" title="Wed Dec 10 2025 06:02:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家是否觉得并发编程中的各种锁和同步机制让人头大？别担心，这篇指南将带你从性能的角度理解不同的并发计数器实现。我们将按照<strong>性能从快到慢</strong>的顺序，探索 6 种不同的实现方式，让你彻底理解并发编程的精髓！</p>
<hr/>
<h2 data-id="heading-0">第一部分：性能金字塔 (Performance Pyramid)</h2>
<p>在并发编程中，不同的同步机制有着天壤之别的性能表现。让我们先建立一个性能认知框架。</p>
<h3 data-id="heading-1">性能等级划分</h3>
<p><strong>一句话概念</strong>：并发计数器的性能取决于竞争激烈程度和同步开销。</p>
<ul>
<li><strong>Level 0 - 最快</strong>：Goroutine-Local（本地计数）</li>
<li><strong>Level 1 - 极快</strong>：Sharded Counter（分片计数器）</li>
<li><strong>Level 2 - 快</strong>：Atomic、CAS、Mutex（原子操作、比较交换、互斥锁）</li>
<li><strong>Level 3 - 中等</strong>：Yielding Ticket Lock（让步票据锁）</li>
<li><strong>Level 4 - 慢</strong>：Blocking Ticket Lock（阻塞票据锁）</li>
<li><strong>Level 5 - 灾难性</strong>：Spinning Ticket Lock（自旋票据锁）</li>
</ul>
<p><strong>核心原理</strong>：</p>
<ul>
<li>竞争越少，性能越好</li>
<li>阻塞越少，性能越好</li>
<li>CPU 缓存友好度越高，性能越好</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2add0342d28243aea308a246a615c85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=0IvrhU0RCEpgwTAvR4fBHLIpeYo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">第二部分：高性能计数器 (Level 0-1)</h2>
<h3 data-id="heading-3">① Goroutine-Local Counter</h3>
<p><strong>一句话概念</strong>：每个 goroutine 独立计数，最后汇总。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkGoroutineLocalCounter</span><span class="hljs-params">(b *testing.B)</span></span> {
    <span class="hljs-keyword">var</span> totalCounter <span class="hljs-type">int64</span>
    b.ResetTimer()
    b.RunParallel(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(pb *testing.PB)</span></span> {
        <span class="hljs-keyword">var</span> localCounter <span class="hljs-type">int64</span>  <span class="hljs-comment">// 本地变量，无竞争</span>
        <span class="hljs-keyword">for</span> pb.Next() {
            localCounter++      <span class="hljs-comment">// 纯本地操作</span>
        }
        <span class="hljs-comment">// 只在最后汇总一次</span>
        atomic.AddInt64(&amp;totalCounter, localCounter)
    })
}
</code></pre>
<p><strong>它是什么？</strong><br/>
每个 goroutine 使用自己的本地变量计数，完全避免了并发竞争。</p>
<p><strong>为什么最快？</strong></p>
<ul>
<li>无锁竞争：99.9% 的操作都是纯本地的</li>
<li>缓存友好：本地变量始终在 CPU 缓存中</li>
<li>只有一次原子操作：最后汇总时</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>统计类场景（如请求计数、错误计数）</li>
<li>可以容忍最终一致性的业务</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de2f640c165a4898a71b38ab82161cc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=Ex8bXAwjlg0245ZcJJio9B62eMI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">② Sharded Counter</h3>
<p><strong>一句话概念</strong>：将竞争分散到多个分片上，降低冲突概率。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> numShards = <span class="hljs-number">256</span>

<span class="hljs-keyword">type</span> ShardedCounter <span class="hljs-keyword">struct</span> {
    shards [numShards]<span class="hljs-keyword">struct</span> {
        counter <span class="hljs-type">int64</span>
        _ [<span class="hljs-number">56</span>]<span class="hljs-type">byte</span> <span class="hljs-comment">// 防止伪共享</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *ShardedCounter)</span></span> Inc() {
    idx := rand.Intn(numShards)  <span class="hljs-comment">// 随机选择分片</span>
    atomic.AddInt64(&amp;c.shards[idx].counter, <span class="hljs-number">1</span>)
}
</code></pre>
<p><strong>它是什么？</strong><br/>
将一个计数器拆分成多个独立的分片，随机选择分片进行操作。</p>
<p><strong>为什么极快？</strong></p>
<ul>
<li>降低竞争：256 个分片意味着竞争概率降低 256 倍</li>
<li>防止伪共享：56 字节填充确保每个分片在独立的缓存行</li>
<li>仍然是原子操作：保证线程安全</li>
</ul>
<p><strong>关键技术点</strong>：</p>
<pre><code class="hljs language-go" lang="go">_ [<span class="hljs-number">56</span>]<span class="hljs-type">byte</span> <span class="hljs-comment">// 缓存行填充</span>
</code></pre>
<p>现代 CPU 缓存行通常是 64 字节，int64 占 8 字节，填充 56 字节确保每个计数器独占一个缓存行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a66cf21ccddd4f70b84ad30128a66312~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=t2cy47FIXgRye9NgutSRZ5Vut%2Bw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>第三部分</strong>：经典同步机制（Level 2）</h2>
<h3 data-id="heading-6">③ Atomic Counter</h3>
<p><strong>一句话概念</strong>：使用 CPU 原子指令，硬件级别的线程安全。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> AtomicCounter <span class="hljs-keyword">struct</span> {
    counter <span class="hljs-type">int64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *AtomicCounter)</span></span> Inc() {
    atomic.AddInt64(&amp;c.counter, <span class="hljs-number">1</span>)  <span class="hljs-comment">// 硬件原子操作</span>
}
</code></pre>
<p><strong>为什么快？</strong></p>
<ul>
<li>硬件支持：CPU 直接提供原子操作指令</li>
<li>无锁设计：不需要操作系统调度</li>
<li>缓存一致性：硬件自动处理</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/400e77b16580413c915f1516de9e29e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=EmkBt7tKB%2FojtvVMknTcB%2BAzr5A%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">④ CAS (Compare-And-Swap) Counter</h3>
<p><strong>一句话概念</strong>：乐观锁思想，失败重试直到成功。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *CasCounter)</span></span> Inc() {
    <span class="hljs-keyword">for</span> {
        old := atomic.LoadInt64(&amp;c.counter)
        <span class="hljs-keyword">if</span> atomic.CompareAndSwapInt64(&amp;c.counter, old, old+<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span>  <span class="hljs-comment">// 成功则退出</span>
        }
        <span class="hljs-comment">// 失败则重试</span>
    }
}
</code></pre>
<p><strong>工作原理</strong>：</p>
<ol>
<li>读取当前值</li>
<li>尝试将 old 替换为 old+1</li>
<li>如果期间值被其他线程修改，重试</li>
</ol>
<p><strong>性能特点</strong>：</p>
<ul>
<li>低竞争时性能优秀</li>
<li>高竞争时可能频繁重试</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e37b3216004928b4ee872990c7b446~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=BxKw2i3XCfcqYHsaXVrh8hgZhNg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">⑤ Mutex Counter</h3>
<p><strong>一句话概念</strong>：传统互斥锁，简单可靠的同步机制。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> MutexCounter <span class="hljs-keyword">struct</span> {
    mu      sync.Mutex
    counter <span class="hljs-type">int64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *MutexCounter)</span></span> Inc() {
    c.mu.Lock()
    c.counter++    <span class="hljs-comment">// 临界区操作</span>
    c.mu.Unlock()
}
</code></pre>
<p><strong>为什么仍然快？</strong></p>
<ul>
<li>Go 的 Mutex 高度优化</li>
<li>快速路径：无竞争时几乎无开销</li>
<li>自适应：会在自旋和阻塞间切换</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b606664dc2f481b938514be340eadfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=b4Ld0cZuUrDrFi0hnNiWnFP%2Fwmo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9"><strong>第四部分</strong>：票据锁机制（Level 3-5）</h2>
<h3 data-id="heading-10">⑥ Yielding Ticket Lock</h3>
<p><strong>一句话概念</strong>：公平排队，但会主动让出 CPU。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> YieldingTicketLockCounter <span class="hljs-keyword">struct</span> {
    ticket <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 发号器</span>
    turn   <span class="hljs-type">uint64</span>  <span class="hljs-comment">// 当前服务号</span>
    _      [<span class="hljs-number">48</span>]<span class="hljs-type">byte</span>
    counter <span class="hljs-type">int64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *YieldingTicketLockCounter)</span></span> Inc() {
    myTurn := atomic.AddUint64(&amp;c.ticket, <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>  <span class="hljs-comment">// 取号</span>
    
    spins := <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> atomic.LoadUint64(&amp;c.turn) != myTurn {
        <span class="hljs-keyword">if</span> spins &lt; <span class="hljs-number">10</span> {
            spins++
            runtime.Gosched()  <span class="hljs-comment">// 让出 CPU</span>
        } <span class="hljs-keyword">else</span> {
            time.Sleep(time.Microsecond)  <span class="hljs-comment">// 短暂休眠</span>
        }
    }
    
    atomic.AddInt64(&amp;c.counter, <span class="hljs-number">1</span>)  <span class="hljs-comment">// 临界区</span>
    atomic.AddUint64(&amp;c.turn, <span class="hljs-number">1</span>)    <span class="hljs-comment">// 叫下一号</span>
}
</code></pre>
<p><strong>工作原理</strong>：</p>
<ol>
<li>先取号（ticket++）</li>
<li>等待轮到自己（turn == myTurn）</li>
<li>执行临界区操作</li>
<li>叫下一号（turn++）</li>
</ol>
<p><strong>性能特点</strong>：</p>
<ul>
<li>公平性好：严格按顺序执行</li>
<li>CPU 友好：主动让出 CPU，不浪费资源</li>
<li>延迟较高：需要排队等待</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0798d89a9b74416b03b4f94979d3589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=BVb7PKWu24EOALKoKu%2FizWuEgVo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">⑦ Blocking Ticket Lock</h3>
<p><strong>一句话概念</strong>：公平排队 + 条件变量阻塞等待。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> BlockingTicketLockCounter <span class="hljs-keyword">struct</span> {
    mu     sync.Mutex
    cond   *sync.Cond
    ticket <span class="hljs-type">uint64</span>
    turn   <span class="hljs-type">uint64</span>
    counter <span class="hljs-type">int64</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *BlockingTicketLockCounter)</span></span> Inc() {
    c.mu.Lock()
    myTurn := c.ticket
    c.ticket++
    
    <span class="hljs-keyword">for</span> c.turn != myTurn {
        c.cond.Wait()  <span class="hljs-comment">// 阻塞等待</span>
    }
    c.mu.Unlock()
    
    atomic.AddInt64(&amp;c.counter, <span class="hljs-number">1</span>)
    
    c.mu.Lock()
    c.turn++
    c.cond.Broadcast()  <span class="hljs-comment">// 唤醒所有等待者</span>
    c.mu.Unlock()
}
</code></pre>
<p><strong>为什么慢？</strong></p>
<ul>
<li>多次加锁：每次操作需要多次获取锁</li>
<li>系统调用：Wait() 和 Broadcast() 涉及内核调用</li>
<li>上下文切换：线程阻塞和唤醒的开销</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee70af96c40d429ebd2b278099fdadf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=Jc5%2Btg3pQyH83W%2B%2FuzXhD2pY%2F6Q%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">第七部分：Level 5 - 自旋票据锁 (灾难性)</h2>
<h3 data-id="heading-13">⑧ Spinning Ticket Lock</h3>
<p><strong>一句话概念</strong>：公平排队 + 忙等待，CPU 杀手。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *SpinningTicketLockCounter)</span></span> Inc() {
    myTurn := atomic.AddUint64(&amp;c.ticket, <span class="hljs-number">1</span>) - <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">for</span> atomic.LoadUint64(&amp;c.turn) != myTurn {
        <span class="hljs-comment">// 空循环忙等待 - CPU 100% 占用！</span>
    }
    
    c.counter++  <span class="hljs-comment">// 非原子操作！</span>
    atomic.AddUint64(&amp;c.turn, <span class="hljs-number">1</span>)
}
</code></pre>
<p><strong>为什么是灾难？</strong></p>
<ul>
<li>CPU 浪费：空循环消耗 100% CPU</li>
<li>缓存污染：频繁读取 turn 变量</li>
<li>非原子操作：counter++ 不是线程安全的</li>
<li>超订问题：goroutine 数量超过 CPU 核心时性能崩塌</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e995efa45fba4bbdb507b340da615846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=daINaU6lNxyK8nt7gLy2dywi688%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-14">-   <strong>第五部分</strong>：性能对比与选择指南</h2>
<h3 data-id="heading-15">性能测试结果</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestOversubscriptionImpact</span><span class="hljs-params">(t *testing.T)</span></span> {
    goroutineCounts := []<span class="hljs-type">int</span>{<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">32</span>}
    
    testCases := []<span class="hljs-keyword">struct</span> {
        name    <span class="hljs-type">string</span>
        counter Counter
    }{
        {<span class="hljs-string">"Atomic"</span>, &amp;AtomicCounter{}},
        {<span class="hljs-string">"Mutex"</span>, &amp;MutexCounter{}},
        {<span class="hljs-string">"Sharded"</span>, &amp;ShardedCounter{}},
    }
    
    <span class="hljs-comment">// 测试不同 goroutine 数量下的性能表现</span>
}
</code></pre>
<h3 data-id="heading-16">选择指南</h3>
<p><strong>高性能场景</strong>：</p>
<ul>
<li>优先选择：Goroutine-Local → Sharded → Atomic</li>
<li>关键考虑：能否接受最终一致性</li>
</ul>
<p><strong>通用场景</strong>：</p>
<ul>
<li>首选：Atomic 或 Mutex</li>
<li>Mutex 在高竞争时表现更稳定</li>
</ul>
<p><strong>公平性要求</strong>：</p>
<ul>
<li>选择：Yielding Ticket Lock</li>
<li>避免：Spinning Ticket Lock（除非 CPU 核心充足）</li>
</ul>
<h3 data-id="heading-17">伪共享问题</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 错误示例：伪共享</span>
<span class="hljs-keyword">type</span> NoPaddingCounter <span class="hljs-keyword">struct</span> {
    counter1 <span class="hljs-type">int64</span>
    counter2 <span class="hljs-type">int64</span>  <span class="hljs-comment">// 与 counter1 在同一缓存行</span>
}

<span class="hljs-comment">// 正确示例：缓存行填充</span>
<span class="hljs-keyword">type</span> WithPaddingCounter <span class="hljs-keyword">struct</span> {
    counter1 <span class="hljs-type">int64</span>
    _        [<span class="hljs-number">56</span>]<span class="hljs-type">byte</span>  <span class="hljs-comment">// 填充到独立缓存行</span>
    counter2 <span class="hljs-type">int64</span>
}
</code></pre>
<p><strong>一句话概念</strong>：不相关的数据共享缓存行会导致性能下降。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dfc5871fd004fb0a13ed073151e67f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=Eky%2BW09XAl5YTQNYcTTn8ggs%2Fbw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-18">总结</h2>
<h3 data-id="heading-19">核心回顾</h3>
<p><strong>一句话总结</strong>：并发编程的核心是在正确性和性能间找到平衡。</p>
<p><strong>关键原则</strong>：</p>
<ol>
<li><strong>减少竞争</strong>：分片、本地化是性能优化的王道</li>
<li><strong>避免阻塞</strong>：能用原子操作就不用锁</li>
<li><strong>缓存友好</strong>：注意伪共享问题</li>
<li><strong>测试验证</strong>：不同场景下性能表现差异巨大</li>
</ol>
<p><strong>实践建议</strong>：</p>
<ul>
<li>从简单开始：Atomic 或 Mutex</li>
<li>性能不够再优化：考虑 Sharded 或 Goroutine-Local</li>
<li>避免过度设计：复杂的锁机制往往得不偿失</li>
</ul>
<p>记住，最好的并发代码不是最复杂的，而是最适合业务场景的！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b62af26dce1f48cc90a395e758857fef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5aSa5bCR6YC76L6R:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951357&amp;x-signature=HoPloSmlDKCo50UrN5yBKljvmCM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再付费生图了！N8N+即梦4.5无限免费用！]]></title>    <link>https://juejin.cn/post/7581786379804475427</link>    <guid>https://juejin.cn/post/7581786379804475427</guid>    <pubDate>2025-12-10T06:04:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581786379804475427" data-draft-id="7581844141668630568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 别再付费生图了！N8N+即梦4.5无限免费用！"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-10T06:04:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             别再付费生图了！N8N+即梦4.5无限免费用！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:04:40.000Z" title="Wed Dec 10 2025 06:04:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>兄弟们，发现没？<strong>即梦（Jimeng）的4.5图片生成大模型悄悄上线了！</strong></p>
<p>这波更新可不是小打小闹，不仅模型能力大幅提升，更关键的是，我又给大家挖到了一条<strong>免费在工作流中调用它</strong>的路子。</p>
<p>今天这篇文章，咱们就来聊聊即梦 4.5 到底强在哪，以及如何不花一分钱 API 费用，把这波羊毛薅到手！</p>
<hr/>
<h2 data-id="heading-0">🎥 视频展示</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1ub2SB6EBK%2F" target="_blank" title="https://www.bilibili.com/video/BV1ub2SB6EBK/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1ub…</a></p>
<hr/>
<h2 data-id="heading-1">🚀 即梦4.5的五大“杀手级”特性</h2>
<p>官方在提示词手册里其实已经明牌了，我也第一时间去实测了一下，总结下来主要有这 5 个质的飞跃。</p>
<h3 data-id="heading-2">1️⃣ 人像一致性 &amp; 美颜美体大幅提升</h3>
<p>玩过AI绘图的都知道，多人场景下的脸部崩坏是常态。<br/>
但在 4.5 版本里，ID 人脸一致性做得非常顶！<br/>
看对比图就能发现，4.0 版本容易出现人物混淆、脸部变形；而 4.5 生成的图片，不仅和原图保持了极高的一致性，自带的美颜美体效果也更自然了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25028afa10ee4978b2309f6dcaee8861~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=wZK2IO8stDYTS1NrOmroDblrf5w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2️⃣ 美学质感升级</h3>
<p>简单来说，就是图更好看了。<br/>
对比 4.0 和 4.5 生成的同款提示词，4.5 在构图、光影和整体氛围感上，明显上了一个台阶。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a27bc63b83641829908ca5629d299b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=R410Kk4xXrzRR9c3wrVjv4zTZWo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3️⃣ 指令遵循更精准</h3>
<p>这在“文生图”里太重要了。<br/>
举个例子，我想要一个“正面”的人物，4.0 可能还会给我出一个侧面的，但在 4.5 里，这种翻车的概率大大降低，模型对这类空间指令的理解力强了很多。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/070b417d11114899bd8899eea4cdd51b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=Syl%2BhNd%2FFn%2BTu6%2B9DzZYFx%2FI32s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">4️⃣ 编辑准确度（图生图）更强</h3>
<p>这里原来文案里有个口误叫“边辑”，其实是<strong>编辑还原度</strong>。<br/>
输入一张原图，4.5 生成的重绘结果，在保留原图特征的基础上，融合得更完美，更接近我们想要的“微调”效果，而不是改得面目全非。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d04a24c2d5248b1aafec45f34810191~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=U3KBQH9ltUFdK3cZ2lTy1mA5u9U%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">5️⃣ 微小文字渲染清晰</h3>
<p>细节控狂喜！以前 4.0 在大图里生成小文字，基本是一坨模糊的像素。<br/>
现在的 4.5，背景里的小字也能做到清晰可辨，这点在做海报或复杂场景时非常实用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1a64d9ad5884ceba15c61e73b1e4fb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=xEObrWgZsoEXfWYUVb9oUEh1Ld4%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">💡 重点来了：如何免费接入工作流？</h2>
<p>大家都知道，如果正儿八经走官方 API 调用即梦，那是按次收费的，用在工作流里成本不低。</p>
<p>之前我分享过白嫖 4.0 的方法，但那个老路子不支持最新的 4.5 模型。<br/>
<strong>别急，新的破局方法找到了！</strong></p>
<p>这次咱们用到的是一个开源项目（基于 Docker 部署），它能完美模拟普通用户的请求。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd274b65ba064128b31532bce5626070~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=ttN5rwkCh%2FSIiJx2Nz5dzKj5Jjk%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwwwzhouhui%2Fjimeng-free-api-all" target="_blank" title="https://github.com/wwwzhouhui/jimeng-free-api-all" ref="nofollow noopener noreferrer">github.com/wwwzhouhui/…</a></p>
</blockquote>
<h3 data-id="heading-8">✅ 操作逻辑</h3>
<ol>
<li><strong>部署开源项目</strong>：使用 Docker 在本地运行一个 API 封装项目（类似于 <code>Jimeng-API</code> 这种）。</li>
<li><strong>本地端口调用</strong>：运行后，它会开启一个本地端口（比如 8000）。</li>
<li><strong>接入工作流</strong>：在此时，通过工作流调用这个本地接口，把你的 Sessionid 传进去。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91cf776f3eb94fe29da7ebbb9f48a75f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765951479&amp;x-signature=LaNO2hM4qeUZFQN6cjRkkkY94G0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">💰 真正的“0成本”</h3>
<p>这套方案调用的其实是你个人账号的<strong>免费积分</strong>！</p>
<ul>
<li>普通用户每天登录送 <strong>66 积分</strong>。</li>
<li>实测使用 4.5 模型，生成一组（4 张）2K 高清图，普通只扣 <strong>2 积分，会员完全免费</strong>。</li>
<li>也就是说，<strong>普通用户每天可以免费生成 33 组图（132 张）！</strong></li>
</ul>
<p>对于个人玩家和创作者来说，这完全够用了，还要什么自行车？</p>
<hr/>
<h2 data-id="heading-10">👨‍💻 总结一下</h2>
<p>即梦 4.5 这次升级诚意满满，特别是对人像和细节的把控。配合这个本地 Docker 部署的开源方案，直接把“付费API”变成了“每日签到白嫖”，这波羊毛大家赶紧薅起来！</p>
<p>我是磊哥，每天分享一个实用的 AI 干货，咱们下期见！👋</p>
<p><em>(注：本文提及的技术方案仅供学习交流，请合理使用平台资源)</em></p>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，网站包含的内容有：<strong>LangChain/N8N/SpringAI/SpringAIAlibaba/LangChain4j/Dify/Coze/AI实战项目/AI常见面试题</strong>等技术分享，欢迎各位大佬光临指导~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[隐形追踪者：当你删除了 Cookies，谁还在看着你？——揭秘浏览器指纹]]></title>    <link>https://juejin.cn/post/7581760987763638323</link>    <guid>https://juejin.cn/post/7581760987763638323</guid>    <pubDate>2025-12-10T06:05:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763638323" data-draft-id="7578793960627470362" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="隐形追踪者：当你删除了 Cookies，谁还在看着你？——揭秘浏览器指纹"/> <meta itemprop="keywords" content="前端,面试,算法"/> <meta itemprop="datePublished" content="2025-12-10T06:05:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吃饺子不吃馅"/> <meta itemprop="url" content="https://juejin.cn/user/1148309742825495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            隐形追踪者：当你删除了 Cookies，谁还在看着你？——揭秘浏览器指纹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1148309742825495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吃饺子不吃馅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:05:07.000Z" title="Wed Dec 10 2025 06:05:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>韭菜们是否经历过这样的诡异时刻：你在某个购物网站搜索了一双球鞋，仅仅过了一分钟，当你打开新闻网站或社交媒体时，那双球鞋的广告就出现在了显眼的位置。</p>
<p>通常，我们会把这归咎于 <strong>Cookies</strong>。于是，聪明的韭菜打开了“无痕模式”，或者彻底清除了浏览器的缓存和 Cookies，认为这样就能隐身于互联网。</p>
<p><strong>然而，广告依然如影随形。</strong></p>
<p>这是因为，由于 <strong>“浏览器指纹”（Browser Fingerprinting）</strong> 技术的存在，你实际上一直在“裸奔”。</p>
<h2 data-id="heading-0">什么是浏览器指纹？</h2>
<p>在现实生活中，指纹是我们独一无二的生理特征。而在互联网世界中，<strong>浏览器指纹</strong>是指当你访问一个网站时，你的浏览器不仅会请求网页内容，还会无意中暴露一系列关于你设备的软硬件配置信息。</p>
<p>这些信息单独看起来都很普通，比如：</p>
<ul>
<li>你的操作系统（Windows, macOS, Android...）</li>
<li>屏幕分辨率（1920x1080...）</li>
<li>浏览器版本（Chrome 120...）</li>
<li>安装的字体列表</li>
<li>时区和语言设置</li>
<li>显卡型号和电池状态</li>
</ul>
<p><strong>神奇之处在于组合：</strong> 当把这几十甚至上百个特征组合在一起时，它们就形成了一个极高精度的“特征值”。据研究，对于绝大多数互联网用户来说，这个组合是<strong>全球唯一</strong>的</p>
<h2 data-id="heading-1">它是如何工作的？</h2>
<p>为了生成这个指纹，追踪者使用了一些非常巧妙的技术：</p>
<h3 data-id="heading-2">1. Canvas 指纹（画布指纹）</h3>
<p>这是最著名的指纹技术。网站会命令你的浏览器在后台偷偷绘制一张复杂的隐藏图片（包含文字和图形）。</p>
<p>由于不同的操作系统、显卡驱动、字体渲染引擎处理图像的方式有微小的像素级差异，每台电脑画出来的图在哈希值上是完全不同的。</p>
<h3 data-id="heading-3">2. AudioContext 指纹（音频指纹）</h3>
<p>原理类似 Canvas。网站会让浏览器生成一段人耳听不到的音频信号。不同的声卡和音频驱动处理信号的方式不同，生成的数字指纹也就不同</p>
<h3 data-id="heading-4">3. 字体枚举</h3>
<p>你安装了 Photoshop？或者安装了一套冷门的编程字体？网站可以通过脚本检测你系统里安装了哪些字体。安装的字体越独特，你的指纹辨识度就越高</p>
<h2 data-id="heading-5">为什么它比 Cookies 更可怕？</h2>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>Cookies (传统的追踪)</strong></th><th><strong>浏览器指纹 (新型追踪)</strong></th></tr></thead><tbody><tr><td><strong>存储位置</strong></td><td>你的电脑硬盘里</td><td><strong>不需要存储</strong>，实时计算</td></tr><tr><td><strong>用户控制</strong></td><td>你可以随时一键删除</td><td><strong>你无法删除</strong>，它是你设备的属性</td></tr><tr><td><strong>隐身模式</strong></td><td>无效（隐身模式不读旧Cookies）</td><td><strong>依然有效</strong>（隐身模式下设备配置不变）</td></tr><tr><td><strong>持久性</strong></td><td>易丢失</td><td>极难改变，甚至跨浏览器追踪</td></tr></tbody></table>
<p><strong>这就好比：</strong></p>
<ul>
<li><strong>Cookies</strong> 就像是进门时发给你的一张胸牌，你把它扔了，保安就不认识你了</li>
<li><strong>浏览器指纹</strong> 就像是保安记住了你的身高、长相、穿衣风格和走路姿势。这和你戴不戴胸牌没有任何关系</li>
</ul>
<h2 data-id="heading-6">主要用途</h2>
<p>浏览器指纹技术在现代网络中有多种用途，主要可以分为<strong>追踪识别</strong>和<strong>安全防护</strong>两大类：</p>
<h3 data-id="heading-7">追踪与用户画像</h3>
<ul>
<li><strong>跨网站追踪用户</strong>：广告网络会在不同站点嵌入脚本，通过指纹标记“同一访客”，进而在B站推送你在A站浏览过的商品或内容，实现“精准广告”。</li>
<li><strong>绘制用户画像</strong>：即使未登录，只要指纹相同，网站就能合并浏览记录、点击路径、停留时长等数据，推测兴趣偏好、消费水平，再反向优化推荐算法。</li>
<li><strong>“无Cookie” 追踪</strong>：指纹在无痕/隐私模式下依旧存在，且无法像Cookie那样一键清空，因此被视为更顽固的追踪手段。</li>
</ul>
<h3 data-id="heading-8">反欺诈与风控</h3>
<ul>
<li><strong>账号安全</strong>：银行、支付、社交平台把指纹作为“设备信任度”指标。若登录指纹突然大变（新系统、虚拟机、海外设备），可触发二次验证或冻结交易。</li>
<li><strong>薅羊毛/作弊识别</strong>：投票、抽奖、优惠券领取页面用指纹判断“是否同一设备反复参与”，防止批量注册、刷单。</li>
<li><strong>广告反欺诈</strong>：验证广告点击是否来自真实浏览器，而非自动化脚本或虚假流量农场。</li>
</ul>
<h3 data-id="heading-9">多账号管理</h3>
<ul>
<li><strong>跨境电商/社媒运营</strong>：卖家或营销人员需要在一台电脑同时登录几十个Amazon、eBay、Facebook、TikTok账号。若用普通浏览器，平台会因指纹相同判定“关联店铺”并封号。指纹浏览器可为每个账号伪造独立的设备环境（分辨率、字体、Canvas、WebGL、MAC地址、IP等），实现“物理级隔离”。</li>
<li><strong>数据抓取与测试</strong>：爬虫或自动化测试脚本通过切换指纹模拟不同真实用户，降低被目标站点封锁的概率。</li>
</ul>
<h3 data-id="heading-10">合规与隐私保护</h3>
<ul>
<li><strong>反指纹追踪</strong>：隐私插件或“高级指纹保护”功能会故意把Canvas、音频、WebGL结果做随机噪声，或统一返回常见值，削弱指纹的唯一性，减少被跨站跟踪。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[剑指offer-48、不使⽤加减乘除实现加法]]></title>    <link>https://juejin.cn/post/7581760987763654707</link>    <guid>https://juejin.cn/post/7581760987763654707</guid>    <pubDate>2025-12-10T06:08:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763654707" data-draft-id="7580251192331305006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 剑指offer-48、不使⽤加减乘除实现加法"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-10T06:08:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SevenCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3261615728242467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             剑指offer-48、不使⽤加减乘除实现加法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3261615728242467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SevenCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:08:49.000Z" title="Wed Dec 10 2025 06:08:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">题⽬描述</h2>
<p>写⼀个函数，求两个整数之和，要求在函数体内不得使⽤ + 、 - 、 * 、 / 四则运算符号。</p>
<p>示例1
输⼊：1,2
返回值：3</p>
<h2 data-id="heading-1">思路及解答</h2>
<h3 data-id="heading-2">位运算迭代法（推荐）</h3>
<p>将加法分解为「无进位和」+「进位值」，循环直到进位为0</p>
<p><strong>位运算加法的数学原理</strong>：</p>
<ul>
<li><strong>异或运算 (^)</strong>：实现无进位加法
<ul>
<li><code>0^0=0</code>, <code>0^1=1</code>, <code>1^0=1</code>, <code>1^1=0</code>（进位丢失）</li>
</ul>
</li>
<li><strong>与运算 (&amp;)</strong>：检测需要进位的位置
<ul>
<li>只有<code>1&amp;1=1</code>，其他情况都为0</li>
</ul>
</li>
<li><strong>左移运算 (&lt;&lt;)</strong>：将进位值移到正确位置</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-comment">// 循环直到进位为0</span>
        <span class="hljs-keyword">while</span> (b != <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 计算无进位和：异或运算相当于无进位加法</span>
            <span class="hljs-comment">// 例如：5^3=6 (101^011=110)</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> a ^ b;
            
            <span class="hljs-comment">// 计算进位值：与运算后左移1位得到进位</span>
            <span class="hljs-comment">// 例如：(5&amp;3)&lt;&lt;1=2 (101&amp;011=001, 左移1位=010)</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">carry</span> <span class="hljs-operator">=</span> (a &amp; b) &lt;&lt; <span class="hljs-number">1</span>;
            
            <span class="hljs-comment">// 更新a为无进位和，b为进位值</span>
            a = sum;
            b = carry;
            
            <span class="hljs-comment">// 继续下一轮计算，直到进位为0</span>
        }
        <span class="hljs-keyword">return</span> a;
    }
}
</code></pre>
<ul>
<li>时间复杂度：O(1) - 最多循环32次（整数位数）</li>
<li>空间复杂度：O(1) - 只使用常数空间</li>
</ul>
<h3 data-id="heading-3">位运算递归法</h3>
<p>将迭代过程转为递归调用，基础案例是进位为0</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-comment">// 递归终止条件：当进位为0时，直接返回无进位和</span>
        <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> a;
        }
        
        <span class="hljs-comment">// 递归过程：计算无进位和与进位值，继续递归相加</span>
        <span class="hljs-keyword">return</span> add(a ^ b, (a &amp; b) &lt;&lt; <span class="hljs-number">1</span>);
    }
}
</code></pre>
<ul>
<li>时间复杂度：O(1) - 递归深度最多32层</li>
<li>空间复杂度：O(1) - 但递归栈有深度限制</li>
</ul>
<p>递归案例：</p>
<pre><code class="hljs language-text" lang="text">add(2, 3)
  → add(2^3, (2&amp;3)&lt;&lt;1) = add(1, 2)
    → add(1^2, (1&amp;2)&lt;&lt;1) = add(3, 0)
      → b=0, 返回3
最终结果：5
</code></pre>
<h3 data-id="heading-4">投机取巧</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> {
    <span class="hljs-comment">// 方法1：使用内置的加法方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add1</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> Integer.sum(a, b); <span class="hljs-comment">// 内部实现还是用+，不符合要求</span>
    }
    
    <span class="hljs-comment">// 方法2：使用AtomicInteger（实际开发中更不实用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add2</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">ai</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(a);
        <span class="hljs-keyword">return</span> ai.addAndGet(b); <span class="hljs-comment">// 内部使用CAS操作</span>
    }
    
    <span class="hljs-comment">// 方法3：使用BigDecimal（过度设计）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add3</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-comment">// 需要创建对象，性能较差</span>
        <span class="hljs-keyword">return</span> BigDecimal.valueOf(a)
                .add(BigDecimal.valueOf(b))
                .intValue();
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native 样式系统详解：与 Web CSS 的“似是而非”]]></title>    <link>https://juejin.cn/post/7581760987763703859</link>    <guid>https://juejin.cn/post/7581760987763703859</guid>    <pubDate>2025-12-10T06:14:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581760987763703859" data-draft-id="7581772744376516654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native 样式系统详解：与 Web CSS 的“似是而非”"/> <meta itemprop="keywords" content="前端,React Native"/> <meta itemprop="datePublished" content="2025-12-10T06:14:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native 样式系统详解：与 Web CSS 的“似是而非”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:14:48.000Z" title="Wed Dec 10 2025 06:14:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多从 Web 转战 React Native 的开发者最先问的问题通常是：“我能直接把 CSS 文件复制进去吗？”</p>
<p>答案是<strong>不能</strong>。虽然 React Native 的样式系统在命名和行为上极力模仿 CSS，但它本质上是<strong>JavaScript 对象</strong>，运行机制也完全不同。以下是关于这两者差异的完整技术总结。</p>
<h2 data-id="heading-0">1. 核心语法：从 Kebab-case 到 CamelCase</h2>
<p>在 Web 中，CSS 是文本；在 RN 中，样式是代码（对象）。由于 JavaScript 对象的属性名不能包含连字符（<code>-</code>），所有 CSS 属性都必须转换为 <strong>小驼峰命名法 (camelCase)</strong> 。</p>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>Web CSS</strong></th><th><strong>React Native Style</strong></th></tr></thead><tbody><tr><td><strong>背景色</strong></td><td><code>background-color: red;</code></td><td><code>backgroundColor: 'red'</code></td></tr><tr><td><strong>字体大小</strong></td><td><code>font-size: 16px;</code></td><td><code>fontSize: 16</code> (注意是数字)</td></tr><tr><td><strong>外边距</strong></td><td><code>margin-top: 20px;</code></td><td><code>marginTop: 20</code></td></tr><tr><td><strong>复合属性</strong></td><td><code>border: 1px solid red;</code></td><td><strong>不支持</strong>。必须拆分为 <code>borderWidth</code>, <code>borderColor</code>, <code>borderStyle</code></td></tr></tbody></table>
<h3 data-id="heading-1">为什么这样做？</h3>
<p>因为样式是 JS 对象，这意味着你可以利用编程语言的所有能力：变量、条件判断、函数计算等。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// React Native 允许动态计算样式</span>
&lt;<span class="hljs-title class_">View</span> style={{
  <span class="hljs-attr">backgroundColor</span>: isActive ? <span class="hljs-string">'blue'</span> : <span class="hljs-string">'gray'</span>, <span class="hljs-comment">// 条件样式</span>
  <span class="hljs-attr">width</span>: windowWidth * <span class="hljs-number">0.5</span> <span class="hljs-comment">// 动态计算</span>
}} /&gt;
</code></pre>
<h2 data-id="heading-2">2. 继承与层叠：数组覆盖法</h2>
<p>Web CSS 的全称是“层叠样式表”（Cascading Style Sheets），依赖选择器权重（Specificity）来决定谁生效。</p>
<p>React Native 没有选择器（没有 .class 或 #id），也没有隐式的样式继承（子元素不会自动继承父元素的字体颜色）。</p>
<p>RN 的“层叠”通过数组实现：</p>
<p>RN 允许你给 style 属性传递一个数组。数组中越靠后的样式优先级越高。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> styles = {
  <span class="hljs-attr">base</span>: { <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'black'</span> },
  <span class="hljs-attr">active</span>: { <span class="hljs-attr">color</span>: <span class="hljs-string">'blue'</span> } <span class="hljs-comment">// 激活状态覆盖颜色</span>
};

<span class="hljs-comment">// 数组最后一个生效，最终颜色为 blue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{[styles.base,</span> <span class="hljs-attr">styles.active</span>]}&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>
</code></pre>
<p>这种方式让样式覆盖变得<strong>显式且可预测</strong>，彻底消除了 Web 开发中“不知道这个样式是从哪里继承来的”痛苦。</p>
<h2 data-id="heading-3">3. 布局系统：Flexbox 是唯一真理</h2>
<p>React Native 移除了 Web 中复杂的 <code>float</code>, <code>display: block/inline</code>, <code>grid</code> 等布局方式，<strong>只保留并强制使用 Flexbox</strong>。</p>
<p>但有一个巨大的陷阱需要注意：<strong>默认主轴方向不同</strong>。</p>
<ul>
<li>
<p><strong>Web Flexbox:</strong> 默认 <code>flex-direction: row</code> (横向排列)。</p>
</li>
<li>
<p><strong>RN Flexbox:</strong> 默认 <code>flexDirection: 'column'</code> (纵向排列)。</p>
<ul>
<li><em>原因：</em> 手机屏幕是窄长的，垂直滚动是移动端的默认交互模式。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-4">4. 尺寸与单位：没有 <code>px</code>，只有逻辑点</h2>
<p>在 Web 上，我们纠结于 px, em, rem, vw, vh。</p>
<p>在 RN 上，几乎所有尺寸属性（width, height, margin, padding, fontSize）都只接受不带单位的数字。</p>
<ul>
<li>
<p><strong>含义：</strong> 这些数字代表 <strong>逻辑像素 (Logical Pixels / Points)</strong> 。</p>
</li>
<li>
<p><strong>自动适配：</strong> RN 会根据设备的屏幕密度（DPI/PixelRatio）自动将其转换为屏幕上的物理像素。</p>
<ul>
<li>写 <code>width: 100</code>，在普通屏是 100px，在 Retina 屏可能是 200px 或 300px。</li>
<li><em>例外：</em> 也可以使用百分比字符串，如 <code>width: '50%'</code>。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">5. 常见痛点与已知限制 (Known Issues)</h2>
<p>根据你提供的文档片段，RN 并不是完美复刻了 CSS 引擎，这里有几个著名的“坑”：</p>
<h3 data-id="heading-6">A. 触摸区域与父级边界 (Parent Bounds)</h3>
<ul>
<li>
<p><strong>Web:</strong> 子元素设为 <code>absolute</code> 并移出父元素框外，通常依然可见且可点击。</p>
</li>
<li>
<p><strong>RN (Android):</strong> 子元素的<strong>触摸事件</strong>无法超出父组件的边界。如果你把按钮用 <code>position: absolute</code> 移到了父 View 的外面，你看着它在那里，但点它没反应。</p>
<ul>
<li><em>注：</em> 视觉上，Android 默认 <code>overflow: hidden</code> 行为较强，虽新版本有改善，但点击判定依然严格遵循父级区域。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7">B. 负边距 (Negative Margins)</h3>
<ul>
<li><strong>Web:</strong> <code>margin-top: -50px</code> 是常用的重叠布局技巧。</li>
<li><strong>RN:</strong> 文档明确提到 <em>"on Android negative margin is not supported"</em> （或支持受限）。虽然现代 RN 版本对负 margin 的支持已经好转，但在某些复杂嵌套或旧版本 Android 上，它依然会导致布局塌陷或裁剪。</li>
</ul>
<h3 data-id="heading-8">C. 圆角与图片 (Border Radius)</h3>
<p>如前文所述，iOS 的 <code>&lt;Image&gt;</code> 组件对 <code>borderTopLeftRadius</code> 等<strong>单独</strong>圆角属性支持不佳。必须通过包裹一个 <code>&lt;View&gt;</code> 并设置 <code>overflow: 'hidden'</code> 来实现异形图片。</p>
<h3 data-id="heading-9">D. 阴影 (Shadows)</h3>
<p>这是最分裂的地方：</p>
<ul>
<li><strong>iOS:</strong> 使用 <code>shadowColor</code>, <code>shadowOffset</code>, <code>shadowOpacity</code> (类似 CSS)。</li>
<li><strong>Android:</strong> 必须使用 <code>elevation</code> (一个数字，对应 Material Design 的层级高度)。为了跨平台，通常需要根据平台写两套代码。</li>
</ul>
<h2 data-id="heading-10">6. 最佳实践：StyleSheet.create</h2>
<p>虽然你可以直接写内联样式对象 <code>style={{color: 'red'}}</code>，但官方推荐使用 <code>StyleSheet.create</code>。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StyleSheet</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">container</span>: {
    <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#fff'</span>,
  },
});
</code></pre>
<p><strong>为什么？</strong></p>
<ol>
<li><strong>性能：</strong> 系统可以将这些样式对象 ID 化并缓存，避免每次渲染组件时都重新创建新的对象。</li>
<li><strong>验证：</strong> 它会在开发阶段检查你的属性名是否合法（比如如果你写了 <code>background-color</code>，它会直接报错提醒你改成 <code>backgroundColor</code>）。</li>
</ol>
<hr/>
<h3 data-id="heading-11">总结</h3>
<p>当你开始在 React Native 中写样式时，请记住：</p>
<ol>
<li>❌ 不要用 Kebab-case (<code>font-size</code>)，要用 <strong>CamelCase</strong> (<code>fontSize</code>)。</li>
<li>❌ 不要加 <code>px</code> 单位，直接写<strong>数字</strong>。</li>
<li>❌ 不要指望样式自动继承（Text 组件内的嵌套除外）。</li>
<li>⚠️ 默认布局是 <strong>纵向 (Column)</strong> 的。</li>
<li>⚠️ 所有的边框、阴影、圆角，在 iOS 和 Android 上可能表现不一致，多真机测试。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ANSI-Escapes 命令行光标操作完全指南]]></title>    <link>https://juejin.cn/post/7581828086020063247</link>    <guid>https://juejin.cn/post/7581828086020063247</guid>    <pubDate>2025-12-10T06:20:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581828086020063247" data-draft-id="7581828086020030479" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ANSI-Escapes 命令行光标操作完全指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-10T06:20:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三年三月"/> <meta itemprop="url" content="https://juejin.cn/user/694547078186440"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ANSI-Escapes 命令行光标操作完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547078186440/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三年三月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:20:39.000Z" title="Wed Dec 10 2025 06:20:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">1. 命令行中光标操作的底层原理</h2>
<p>在命令行界面中，光标操作的底层原理基于<strong>ANSI转义序列</strong>（ANSI Escape Sequences），这是一套标准化的控制字符序列，用于控制终端的各种行为，包括光标移动、文本样式、屏幕清除等。</p>
<h3 data-id="heading-1">1.1 ANSI转义序列基础</h3>
<ul>
<li><strong>转义字符</strong>：所有ANSI转义序列都以转义字符<code>ESC</code>（ASCII码27，十六进制0x1B，通常表示为<code>\033</code>或<code>\u001B</code>）开头</li>
<li><strong>序列格式</strong>：基本格式为 <code>ESC[参数;参数;...命令</code> 或简写为 <code>\033[参数;参数;...命令</code></li>
<li><strong>命令类型</strong>：
<ul>
<li>光标移动命令（如<code>A</code>上移、<code>B</code>下移、<code>C</code>右移、<code>D</code>左移）</li>
<li>屏幕操作命令（如<code>J</code>清除屏幕、<code>K</code>清除行）</li>
<li>样式设置命令（如文本颜色、背景色、粗体等）</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">1.2 终端解析机制</h3>
<p>当终端接收到包含ANSI转义序列的输出时：</p>
<ol>
<li>识别<code>ESC</code>字符作为转义序列的开始</li>
<li>解析<code>[</code>之后的参数（以分号分隔）</li>
<li>执行参数对应的命令操作</li>
<li>转义序列不会显示在终端上，只会触发相应的控制行为</li>
</ol>
<h3 data-id="heading-3">1.3 光标定位原理</h3>
<ul>
<li>终端屏幕被划分为行列网格，通常从左上角(0,0)或(1,1)开始计数</li>
<li>光标移动命令通过指定行列位置或相对偏移来控制光标位置</li>
<li>不同终端可能有细微差异，但基本遵循ANSI标准</li>
</ul>
<h2 data-id="heading-4">2. ANSI-Escapes 工具介绍</h2>
<p><code>ansi-escapes</code>是一个Node.js库，它提供了一组简洁的API，用于生成各种ANSI转义序列，简化了在命令行应用中控制光标、清除屏幕、操作终端等复杂功能的实现。</p>
<h3 data-id="heading-5">2.1 主要功能分类</h3>
<ol>
<li><strong>光标控制</strong>：移动、定位、保存/恢复位置、隐藏/显示</li>
<li><strong>屏幕操作</strong>：清除行、清除屏幕、滚动</li>
<li><strong>终端控制</strong>：切换屏幕、设置工作目录</li>
<li><strong>实用功能</strong>：创建链接、显示图片、发出蜂鸣</li>
</ol>
<h3 data-id="heading-6">2.2 优势</h3>
<ul>
<li>跨平台兼容性：自动处理不同终端和操作系统的差异</li>
<li>简化API：将复杂的转义序列封装为易记的函数调用</li>
<li>类型安全：提供TypeScript支持，减少使用错误</li>
<li>模块化设计：按需导入所需功能</li>
</ul>
<h2 data-id="heading-7">3. ANSI-Escapes 核心功能详解</h2>
<h3 data-id="heading-8">3.1 光标移动与定位</h3>
<h4 data-id="heading-9">cursorTo(x, y) - 移动光标到指定位置</h4>
<p><strong>功能</strong>：将光标移动到屏幕上的指定坐标位置</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

<span class="hljs-comment">// 移动到第2行第6列</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第一行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第二行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第三行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-title function_">cursorTo</span>(<span class="hljs-number">5</span>, <span class="hljs-number">1</span>)); <span class="hljs-comment">// x:5, y:1 (行列从0开始)</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 光标移动到这里了\n'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">cursorTo</span> = (<span class="hljs-params">x, y</span>) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x !== <span class="hljs-string">'number'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'The `x` argument is required'</span>);
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> y !== <span class="hljs-string">'number'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">ESC</span> + (x + <span class="hljs-number">1</span>) + <span class="hljs-string">'G'</span>; <span class="hljs-comment">// 只指定x坐标</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">ESC</span> + (y + <span class="hljs-number">1</span>) + <span class="hljs-variable constant_">SEP</span> + (x + <span class="hljs-number">1</span>) + <span class="hljs-string">'H'</span>; <span class="hljs-comment">// 指定x,y坐标</span>
};
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>当只提供x坐标时，生成序列 <code>\033[6G</code>（移动到第6列）</li>
<li>当提供x和y坐标时，生成序列 <code>\033[2;6H</code>（移动到第2行第6列）</li>
<li>注意：终端通常使用1-based索引，而API使用0-based索引，所以需要+1转换</li>
</ul>
<h4 data-id="heading-10">cursorMove(x, y) - 相对移动光标</h4>
<p><strong>功能</strong>：从当前位置相对移动光标</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'Hello World'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-title function_">cursorMove</span>(-<span class="hljs-number">5</span>, -<span class="hljs-number">1</span>)); <span class="hljs-comment">// 左移5字符，上移1行</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 相对移动到这里'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">cursorMove</span> = (<span class="hljs-params">x, y</span>) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x !== <span class="hljs-string">'number'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'The `x` argument is required'</span>);
    }

    <span class="hljs-keyword">let</span> returnValue = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) {
        returnValue += <span class="hljs-variable constant_">ESC</span> + (-x) + <span class="hljs-string">'D'</span>; <span class="hljs-comment">// 左移</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">0</span>) {
        returnValue += <span class="hljs-variable constant_">ESC</span> + x + <span class="hljs-string">'C'</span>; <span class="hljs-comment">// 右移</span>
    }

    <span class="hljs-keyword">if</span> (y &lt; <span class="hljs-number">0</span>) {
        returnValue += <span class="hljs-variable constant_">ESC</span> + (-y) + <span class="hljs-string">'A'</span>; <span class="hljs-comment">// 上移</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt; <span class="hljs-number">0</span>) {
        returnValue += <span class="hljs-variable constant_">ESC</span> + y + <span class="hljs-string">'B'</span>; <span class="hljs-comment">// 下移</span>
    }

    <span class="hljs-keyword">return</span> returnValue;
};
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>根据x和y的正负值决定移动方向</li>
<li>左移：<code>\033[5D</code></li>
<li>右移：<code>\033[5C</code></li>
<li>上移：<code>\033[1A</code></li>
<li>下移：<code>\033[1B</code></li>
</ul>
<h4 data-id="heading-11">cursorUp(count) / cursorDown(count) - 上下移动光标</h4>
<p><strong>功能</strong>：向上或向下移动指定行数</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第一行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第二行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第三行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-title function_">cursorUp</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// 上移2行</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 上移到第二行'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">cursorUp</span> = (<span class="hljs-params">count = <span class="hljs-number">1</span></span>) =&gt; <span class="hljs-variable constant_">ESC</span> + count + <span class="hljs-string">'A'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">cursorDown</span> = (<span class="hljs-params">count = <span class="hljs-number">1</span></span>) =&gt; <span class="hljs-variable constant_">ESC</span> + count + <span class="hljs-string">'B'</span>;
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>cursorUp：生成 <code>\033[2A</code> 表示上移2行</li>
<li>cursorDown：生成 <code>\033[2B</code> 表示下移2行</li>
<li>默认移动1行</li>
</ul>
<h4 data-id="heading-12">cursorForward(count) / cursorBackward(count) - 左右移动光标</h4>
<p><strong>功能</strong>：向左或向右移动指定字符数</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'Hello World'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-title function_">cursorBackward</span>(<span class="hljs-number">6</span>)); <span class="hljs-comment">// 左移6字符</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 左移到Hello后'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">cursorForward</span> = (<span class="hljs-params">count = <span class="hljs-number">1</span></span>) =&gt; <span class="hljs-variable constant_">ESC</span> + count + <span class="hljs-string">'C'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">cursorBackward</span> = (<span class="hljs-params">count = <span class="hljs-number">1</span></span>) =&gt; <span class="hljs-variable constant_">ESC</span> + count + <span class="hljs-string">'D'</span>;
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>cursorForward：生成 <code>\033[2C</code> 表示右移2字符</li>
<li>cursorBackward：生成 <code>\033[6D</code> 表示左移6字符</li>
<li>默认移动1字符</li>
</ul>
<h3 data-id="heading-13">3.2 光标状态控制</h3>
<h4 data-id="heading-14">cursorHide / cursorShow - 隐藏和显示光标</h4>
<p><strong>功能</strong>：控制光标的可见性</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;
<span class="hljs-keyword">import</span> { delay } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>; <span class="hljs-comment">// 假设存在延迟函数</span>

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'光标可见...'</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1500</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">cursorHide</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'\n光标隐藏了...'</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">2000</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">cursorShow</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'\n光标显示了✓'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cursorHide = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'?25l'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cursorShow = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'?25h'</span>;
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>cursorHide：生成 <code>\033[?25l</code> 隐藏光标</li>
<li>cursorShow：生成 <code>\033[?25h</code> 显示光标</li>
<li>常用于需要暂时隐藏光标以提升用户体验的场景</li>
</ul>
<h4 data-id="heading-15">cursorSavePosition / cursorRestorePosition - 保存和恢复光标位置</h4>
<p><strong>功能</strong>：保存当前光标位置，稍后可以恢复到该位置</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;
<span class="hljs-keyword">import</span> { delay } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第一行\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'第二行'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">cursorSavePosition</span>); <span class="hljs-comment">// 保存位置</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'保存点'</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'\n第三行\n第四行\n'</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">cursorRestorePosition</span>); <span class="hljs-comment">// 恢复位置</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 恢复到保存点'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cursorSavePosition = isTerminalApp ? <span class="hljs-string">'\u001B7'</span> : <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'s'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> cursorRestorePosition = isTerminalApp ? <span class="hljs-string">'\u001B8'</span> : <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'u'</span>;
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>针对Apple Terminal使用不同的转义序列 <code>\u001B7</code> 和 <code>\u001B8</code></li>
<li>其他终端使用标准序列 <code>\033[s</code>（保存）和 <code>\033[u</code>（恢复）</li>
</ul>
<h3 data-id="heading-16">3.3 屏幕操作</h3>
<h4 data-id="heading-17">eraseLine / eraseScreen - 清除行和屏幕</h4>
<p><strong>功能</strong>：清除当前行或整个屏幕</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

<span class="hljs-comment">// 清除当前行</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'这是一行要清除的文本'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">eraseLine</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 行已被清除，在同一位置输出新文本\n'</span>);

<span class="hljs-comment">// 清除屏幕</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">eraseScreen</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 屏幕已被清除\n'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eraseEndLine = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'K'</span>;      <span class="hljs-comment">// 清除从光标到行尾</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eraseStartLine = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'1K'</span>;   <span class="hljs-comment">// 清除从光标到行首</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eraseLine = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'2K'</span>;        <span class="hljs-comment">// 清除整行</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eraseDown = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'J'</span>;         <span class="hljs-comment">// 清除从光标到屏幕底部</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eraseUp = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'1J'</span>;          <span class="hljs-comment">// 清除从光标到屏幕顶部</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eraseScreen = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'2J'</span>;      <span class="hljs-comment">// 清除整个屏幕</span>
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li><code>eraseLine</code> 生成 <code>\033[2K</code> 清除整行</li>
<li><code>eraseScreen</code> 生成 <code>\033[2J</code> 清除整个屏幕</li>
<li>这些命令不会移动光标位置</li>
</ul>
<h4 data-id="heading-18">clearScreen / clearViewport - 清屏操作</h4>
<p><strong>功能</strong>：更彻底的清屏操作</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

<span class="hljs-comment">// 清除屏幕并将光标移到左上角</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'大量输出内容...\n'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">20</span>));
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">clearScreen</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'✓ 屏幕已清除，光标在左上角\n'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> clearScreen = <span class="hljs-string">'\u001Bc'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> clearViewport = <span class="hljs-string">`<span class="hljs-subst">${eraseScreen}</span><span class="hljs-subst">${ESC}</span>H`</span>;
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li><code>clearScreen</code> 生成 <code>\033c</code> 重置终端（更彻底的清屏）</li>
<li><code>clearViewport</code> 结合了 <code>eraseScreen</code> 和光标移动到左上角 <code>\033[H</code></li>
</ul>
<h3 data-id="heading-19">3.4 终端屏幕控制</h3>
<h4 data-id="heading-20">enterAlternativeScreen / exitAlternativeScreen - 切换屏幕</h4>
<p><strong>功能</strong>：创建一个临时的替代屏幕，退出后恢复原屏幕内容</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

<span class="hljs-comment">// 进入替代屏幕</span>
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">enterAlternativeScreen</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'这是在替代屏幕中\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'原屏幕内容被保存\n'</span>);

<span class="hljs-comment">// 等待用户输入后退出</span>
process.<span class="hljs-property">stdin</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">() =&gt;</span> {
    process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">exitAlternativeScreen</span>);
    process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'已返回原屏幕\n'</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>);
});
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> enterAlternativeScreen = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'?1049h'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> exitAlternativeScreen = <span class="hljs-variable constant_">ESC</span> + <span class="hljs-string">'?1049l'</span>;
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li><code>enterAlternativeScreen</code> 生成 <code>\033[?1049h</code> 进入替代屏幕</li>
<li><code>exitAlternativeScreen</code> 生成 <code>\033[?1049l</code> 退出替代屏幕</li>
<li>常用于全屏应用或需要临时切换显示内容的场景</li>
</ul>
<h3 data-id="heading-21">3.5 其他实用功能</h3>
<h4 data-id="heading-22">beep - 发出蜂鸣音</h4>
<p><strong>功能</strong>：让终端发出蜂鸣提示音</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'即将发出蜂鸣...\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-property">beep</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'蜂鸣已发出✓'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> beep = <span class="hljs-variable constant_">BEL</span>; <span class="hljs-comment">// BEL = '\u0007'</span>
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>生成 <code>\u0007</code> (BEL字符)，大多数终端会将其解释为蜂鸣音</li>
</ul>
<h4 data-id="heading-23">link(text, url) - 创建可点击链接</h4>
<p><strong>功能</strong>：在支持的终端中创建可点击的URL链接</p>
<p><strong>Demo代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> ansiEscapes <span class="hljs-keyword">from</span> <span class="hljs-string">'ansi-escapes'</span>;
<span class="hljs-keyword">import</span> process <span class="hljs-keyword">from</span> <span class="hljs-string">'process'</span>;

process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(ansiEscapes.<span class="hljs-title function_">link</span>(<span class="hljs-string">'访问GitHub'</span>, <span class="hljs-string">'https://github.com'</span>) + <span class="hljs-string">'\n'</span>);
process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">write</span>(<span class="hljs-string">'在支持的终端中，上面的文本是可点击的链接'</span>);
</code></pre>
<p><strong>底层实现</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">link</span> = (<span class="hljs-params">text, url</span>) =&gt; {
    <span class="hljs-keyword">const</span> openLink = <span class="hljs-title function_">wrapOsc</span>(<span class="hljs-string">`<span class="hljs-subst">${OSC}</span>8<span class="hljs-subst">${SEP}</span><span class="hljs-subst">${SEP}</span><span class="hljs-subst">${url}</span><span class="hljs-subst">${BEL}</span>`</span>);
    <span class="hljs-keyword">const</span> closeLink = <span class="hljs-title function_">wrapOsc</span>(<span class="hljs-string">`<span class="hljs-subst">${OSC}</span>8<span class="hljs-subst">${SEP}</span><span class="hljs-subst">${SEP}</span><span class="hljs-subst">${BEL}</span>`</span>);
    <span class="hljs-keyword">return</span> openLink + text + closeLink;
};
</code></pre>
<p><strong>解析</strong>：</p>
<ul>
<li>使用OSC (Operating System Command)序列创建链接</li>
<li>格式为 <code>\033]8;;url\a文本\033]8;;\a</code></li>
<li>在支持的终端（如iTerm2, GNOME Terminal）中，文本会显示为可点击的链接</li>
</ul>
<h2 data-id="heading-24">4. 跨平台兼容性处理</h2>
<p>ansi-escapes库内置了跨平台兼容性处理，确保在不同终端和操作系统上都能正常工作：</p>
<ol>
<li>
<p><strong>终端类型检测</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> isTerminalApp = !isBrowser &amp;&amp; process.<span class="hljs-property">env</span>.<span class="hljs-property">TERM_PROGRAM</span> === <span class="hljs-string">'Apple_Terminal'</span>;
<span class="hljs-keyword">const</span> isWindows = !isBrowser &amp;&amp; process.<span class="hljs-property">platform</span> === <span class="hljs-string">'win32'</span>;
<span class="hljs-keyword">const</span> isTmux = !isBrowser &amp;&amp; (process.<span class="hljs-property">env</span>.<span class="hljs-property">TERM</span>?.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'screen'</span>) || process.<span class="hljs-property">env</span>.<span class="hljs-property">TERM</span>?.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'tmux'</span>) || process.<span class="hljs-property">env</span>.<span class="hljs-property">TMUX</span> !== <span class="hljs-literal">undefined</span>);
</code></pre>
</li>
<li>
<p><strong>Windows特殊处理</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">isOldWindows</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 检测旧版Windows系统并返回不同的清屏命令</span>
};
</code></pre>
</li>
<li>
<p><strong>Tmux支持</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">wrapOsc</span> = sequence =&gt; {
    <span class="hljs-keyword">if</span> (isTmux) {
        <span class="hljs-comment">// Tmux需要特殊的OSC序列包装</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">'\u001BPtmux;'</span> + sequence.<span class="hljs-title function_">replaceAll</span>(<span class="hljs-string">'\u001B'</span>, <span class="hljs-string">'\u001B\u001B'</span>) + <span class="hljs-string">'\u001B\\'</span>;
    }
    <span class="hljs-keyword">return</span> sequence;
};
</code></pre>
</li>
</ol>
<h2 data-id="heading-25">5. 最佳实践</h2>
<ol>
<li><strong>资源清理</strong>：使用 <code>cursorShow</code> 确保程序退出时光标可见</li>
<li><strong>异常处理</strong>：在异步操作中处理可能的错误</li>
<li><strong>用户体验</strong>：在长时间操作中隐藏光标，完成后显示</li>
<li><strong>兼容性检查</strong>：对于高级功能，检查终端是否支持</li>
<li><strong>性能考量</strong>：批量执行操作，减少I/O调用</li>
</ol>
<h2 data-id="heading-26">6. 总结</h2>
<p><code>ansi-escapes</code>是一个强大的库，它将复杂的ANSI转义序列封装为简洁易用的API，极大地简化了命令行应用中光标控制、屏幕操作等功能的实现。通过本文的介绍，你应该已经掌握了其核心功能和使用方法。</p>
<p>无论是创建简单的命令行工具还是复杂的交互式终端应用，<code>ansi-escapes</code>都能为你提供强大的支持，帮助你打造出更加专业和友好的用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据标注平台重磅上线 | 标注赚现金 低门槛真收益]]></title>    <link>https://juejin.cn/post/7581807793134108718</link>    <guid>https://juejin.cn/post/7581807793134108718</guid>    <pubDate>2025-12-10T06:19:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581807793134108718" data-draft-id="7581667332306305062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据标注平台重磅上线 | 标注赚现金 低门槛真收益"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T06:19:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金酱"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194374926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据标注平台重磅上线 | 标注赚现金 低门槛真收益
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194374926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:19:34.000Z" title="Wed Dec 10 2025 06:19:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    44
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d659d7ae4c1b48d09248cda3382116fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765954781&amp;x-signature=uViSaDOlgMIbUc0QX0uQzlxpkFY%3D" alt="68f71ddf171f8850e881f947f1cfb861.png" loading="lazy"/></p>
<ul>
<li>你是否想亲身体验最前沿的 AI 数据工作，却找不到专业的参与路径？</li>
<li>你是否希望让精通的编程技能，在业余时间创造实实在在的价值？</li>
</ul>
<p>一个多领域的<strong>数据采集与标注服务平台</strong>，为你而来！</p>
<p><strong>低门槛、真收益！</strong> 利用碎片时间，将你的代码洞察力直接<strong>变现</strong>。</p>
<p>这不仅仅是一个任务平台，更是一个专为<strong>资深开发者</strong>打造的、用<strong>技术换取回报</strong>的高价值社区。</p>
<h2 data-id="heading-0">📒 招募介绍</h2>
<h3 data-id="heading-1">我们是谁</h3>
<p><strong>AIDP（AI Data Platform）</strong> 提供完整的 AI 数据解决方案，涵盖：</p>
<ul>
<li>数据采集</li>
<li>数据标注</li>
<li>数据合成</li>
<li>多种数据生产能力</li>
</ul>
<blockquote>
<p>平台支持 <em>Seed、Stone、Flow、头抖、剪映、TT</em> 等核心业务的快速迭代和发展。</p>
</blockquote>
<h3 data-id="heading-2">需要你做什么</h3>
<p>参与后训练高质量代码数据生产，包括但不限于：</p>

























<table><thead><tr><th>任务类型</th><th>说明</th></tr></thead><tbody><tr><td>强化学习数据生产</td><td>为 RLHF 训练提供高质量反馈数据</td></tr><tr><td>监督微调（SFT）</td><td>生产指令-响应对数据</td></tr><tr><td>奖励模型（RM）</td><td>对模型输出进行偏好排序和评分</td></tr><tr><td>数据质检</td><td>审核和优化已有数据质量</td></tr></tbody></table>
<h3 data-id="heading-3">你将获得的回报</h3>
<ul>
<li>💰现金收益：深度参与数据标注的代码专家，月均获取 <strong>¥10000+</strong> 以上回报</li>
</ul>
<blockquote>
<ul>
<li>时薪范围：<strong>50 - 1000</strong> 元，具体以项目最终定价为准，多劳多得，任务明码标价；</li>
<li>计税方式：劳务独立计税，收益清晰透明。</li>
</ul>
</blockquote>
<ul>
<li>参与智能 Agent 调优，掌握前沿技术动态</li>
</ul>
<h3 data-id="heading-4">需要具备的条件</h3>
<ul>
<li><strong>对 AI 有热情，日常高频使用 AI Coding 工具</strong></li>
<li><strong>具备扎实的编程基础和代码理解能力</strong></li>
</ul>
<blockquote>
<p><strong>加分项</strong></p>
<ul>
<li>LeetCode Hard 题目高通过率</li>
<li>GitHub 高星仓库贡献者</li>
<li>开源社区活跃成员</li>
</ul>
</blockquote>
<p>同时欢迎：PM、QA 同学参与，平台同时提供非技术类题目</p>
<h2 data-id="heading-5">👀 我们的目标用户</h2>
<p>我们在寻找这样的你：</p>
<ul>
<li><strong>技术栈</strong>：熟悉大前端、Python、Java、C++、Go 等主流编程语言</li>
<li><strong>质量意识</strong>：熟悉测试与质量保障流程</li>
<li><strong>探索精神</strong>：对前沿技术有自己的理解，乐于探索新知识</li>
<li><strong>社区参与</strong>：有开源贡献、LeetCode 活跃经历者优先</li>
</ul>
<h2 data-id="heading-6">🚀你的专家任务</h2>
<h3 data-id="heading-7">标注实验</h3>
<blockquote>
<p>对代码片段、日志、技术文档等进行精准标注</p>
</blockquote>
<p><strong>具体职责</strong></p>
<ul>
<li>按照项目制定的标注规范，对指定数据（文本、代码片段、日志、技术文档等）进行准确标注</li>
<li>识别并修正数据中存在的歧义、错误或不一致之处</li>
<li>对复杂样本给出专业判断，确保标注结果的准确性与一致性</li>
</ul>
<h3 data-id="heading-8">质量把控</h3>
<blockquote>
<p>互审他人成果，保障数据纯度</p>
</blockquote>
<p><strong>具体职责</strong></p>
<ul>
<li>参与标注标准的制定与完善，提出改进意见</li>
<li>执行专家互审机制，对其他标注结果进行审核和反馈</li>
<li>结合实际经验，对标注样本的合理性和业务适配度进行评估</li>
</ul>
<h3 data-id="heading-9">知识贡献</h3>
<blockquote>
<p>沉淀最佳实践，打造可复用的知识宝库</p>
</blockquote>
<p><strong>具体职责</strong></p>
<ul>
<li>将个人专业知识转化为标注规范、最佳实践或案例，供团队参考</li>
<li>在遇到疑难问题时，作为专家提供判定依据，形成可复用的知识库</li>
<li>协助项目组优化任务分配、质量监控和流程设计</li>
</ul>
<h2 data-id="heading-10">☎️ 社群交流</h2>
<p>参加活动的掘友一定要入群：</p>
<ul>
<li>重要消息不错过</li>
<li>大家互相鼓励</li>
<li>有问题可以在群内咨询</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b9ae96e990d47e98940cc4b976a4053~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765954781&amp;x-signature=mjhj%2BvYTH1G9pbiEGGwFs3mU6uI%3D" alt="134067c882fcc733a803fb9c71f0d2a6.png" loading="lazy"/></p>
<h2 data-id="heading-11">⁉️ 常见问题 FAQ</h2>
<p><strong>Q1：没有标注经验可以参与吗？</strong></p>
<p>我们需要你具备扎实的编程基础即可快速上手，所以需要你有一定的<em>编程经验</em>。</p>
<p><strong>Q2: 每天需要投入多少时间？</strong></p>
<p>完全灵活，可以根据自己的时间安排参与，充分利用碎片时间。</p>
<p><strong>Q3: 如何保证收益？</strong></p>
<p>任务明码标价，<em>多劳多得</em>，平台提供清晰的计价规则和结算流程。</p>
<p><strong>Q4: 非程序员可以参与吗？</strong></p>
<p>可以。平台同时提供非技术类题目，欢迎 <em>PM、QA</em> 等岗位同学参与。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native 交互终极指南：搞定触摸与手势 (Handling Touches)]]></title>    <link>https://juejin.cn/post/7581807793134207022</link>    <guid>https://juejin.cn/post/7581807793134207022</guid>    <pubDate>2025-12-10T06:30:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581807793134207022" data-draft-id="7581807793134174254" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native 交互终极指南：搞定触摸与手势 (Handling Touches)"/> <meta itemprop="keywords" content="前端,React Native"/> <meta itemprop="datePublished" content="2025-12-10T06:30:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native 交互终极指南：搞定触摸与手势 (Handling Touches)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:30:45.000Z" title="Wed Dec 10 2025 06:30:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在移动应用开发中，用户与界面的交互方式与 Web 端截然不同。没有鼠标悬停（Hover），没有右键点击，只有<strong>触摸（Touch）</strong> 。</p>
<p>React Native 提供了一套完整的手势响应系统。从最简单的“点一下”到复杂的“长按”或“滑动”，你都需要选择正确的组件来实现。本文将带你深入了解 RN 的触摸处理机制。</p>
<hr/>
<h2 data-id="heading-0">一、 快速上手：基础组件 <code>&lt;Button /&gt;</code></h2>
<p>如果你只是想快速加一个“提交”按钮，或者你的 App 只需要呈现系统原生的外观，<code>&lt;Button /&gt;</code> 是你的首选。</p>
<h3 data-id="heading-1">特点</h3>
<ul>
<li><strong>开箱即用：</strong> 代码量极少。</li>
<li><strong>跨平台适配：</strong> iOS 上显示为蓝色文字，Android 上显示为圆角矩形按钮。</li>
<li><strong>局限性：</strong> <strong>样式不可定制</strong>。你不能修改它的字体大小、背景形状或内边距，只能修改 <code>color</code> 和 <code>title</code>。</li>
</ul>
<pre><code class="hljs language-TypeScript" lang="TypeScript">&lt;<span class="hljs-title class_">Button</span>
  onPress={<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">'点击了！'</span>)}
  title=<span class="hljs-string">"点我"</span>
  color=<span class="hljs-string">"#841584"</span>
/&gt;
</code></pre>
<hr/>
<h2 data-id="heading-2">二、 进阶定制：<code>Touchable</code> 系列组件</h2>
<p>当设计稿里的按钮五花八门（比如带图标的按钮、圆形的头像、卡片式列表）时，<code>&lt;Button /&gt;</code> 就无能为力了。这时你需要使用 <strong>"Touchable"（可触摸）</strong> 系列组件。</p>
<p>它们的逻辑是： <strong>“你可以把任何 View 包裹在 Touchable 组件里，让它变得可点击。”</strong></p>
<h3 data-id="heading-3">1. <code>TouchableOpacity</code> (最常用)</h3>
<ul>
<li><strong>效果：</strong> 用户按下时，组件的透明度降低（变淡），松开后恢复。</li>
<li><strong>场景：</strong> 适用于 90% 的自定义按钮场景，尤其是图标按钮或大色块按钮。</li>
<li><strong>优势：</strong> 不会遮挡背景内容，体验轻盈。</li>
</ul>
<h3 data-id="heading-4">2. <code>TouchableHighlight</code> (强调型)</h3>
<ul>
<li><strong>效果：</strong> 用户按下时，背景变暗（通常是变黑或变灰）。</li>
<li><strong>场景：</strong> 适用于列表项（List Item）或原本就有深色背景的实体按钮。</li>
<li><strong>注意：</strong> 使用时通常需要指定 <code>underlayColor</code> 属性（按下去显示的底色）。</li>
</ul>
<h3 data-id="heading-5">3. <code>TouchableNativeFeedback</code> (Android 专属)</h3>
<ul>
<li><strong>效果：</strong> 产生水波纹（Ripple）扩散效果。</li>
<li><strong>场景：</strong> 仅限 <strong>Android</strong>。这是 Material Design 的核心交互规范。</li>
<li><strong>建议：</strong> 如果你想做极致的 Android 体验，可以判断平台，在 Android 上用这个，iOS 上用 Opacity。</li>
</ul>
<h3 data-id="heading-6">4. <code>TouchableWithoutFeedback</code> (无视觉反馈)</h3>
<ul>
<li><strong>效果：</strong> 点击了没有任何视觉变化。</li>
<li><strong>场景：</strong> 点击空白处收起键盘、点击遮罩层关闭弹窗。</li>
<li><strong>警告：</strong> 慎用。用户点击按钮如果没有反应，会以为 App 卡死了。</li>
</ul>
<hr/>
<h2 data-id="heading-7">三、 交互事件：不仅是点击</h2>
<p>所有的 Touchable 组件都支持多种交互阶段的事件回调：</p>
<ul>
<li><code>onPress</code>: 手指按下并松开（由于是一次完整的点击）。</li>
<li><code>onLongPress</code>: 手指按住超过一定时间（长按）。常用于呼出菜单或多选模式。</li>
<li><code>onPressIn</code>: 手指刚接触屏幕。</li>
<li><code>onPressOut</code>: 手指离开屏幕。</li>
</ul>
<pre><code class="hljs language-TypeScript" lang="TypeScript">&lt;<span class="hljs-title class_">TouchableOpacity</span>
  onPress={<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点了一下'</span>)}
  onLongPress={<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'长按了！！'</span>)}
&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.button}</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>长按试试<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">TouchableOpacity</span>&gt;
</code></pre>
<hr/>
<h2 data-id="heading-8">四、 避坑指南：Web 开发者的常见误区</h2>
<p>在处理触摸时，React Native 有一些底层的物理限制，这与 Web CSS 的行为不同。</p>
<h3 data-id="heading-9">1. 触摸区域无法“越界” (Parent Bounds)</h3>
<p>在 Web 上，如果你用 <code>position: absolute</code> 把一个关闭按钮移到了弹窗容器的<strong>外面</strong>（右上角悬浮），你依然可以点击它。</p>
<p>但在 React Native（尤其是 Android）中：<strong>子元素的触摸区域永远不会超出父元素的边界。</strong></p>
<ul>
<li><strong>现象：</strong> 按钮看得到，但点不到。</li>
<li><strong>解决：</strong> 确保父容器足够大，包含住了所有的子元素；或者不要让按钮完全“飞”出父容器。</li>
</ul>
<h3 data-id="heading-10">2. 负边距 (Negative Margin)</h3>
<ul>
<li><strong>Web：</strong> <code>margin-top: -20px</code> 是常规布局操作。</li>
<li><strong>RN (Android)：</strong> 历史上对负 Margin 支持很差，可能导致元素被裁剪或触摸失效。虽然新版本有所改善，但在涉及点击区域时，尽量使用 <code>position: absolute</code> 代替负边距布局。</li>
</ul>
<hr/>
<h2 data-id="heading-11">五、 总结：决策树</h2>
<p>在开发中，当你需要一个“可点击”的东西时，请按照以下逻辑选择：</p>
<ol>
<li>
<p><strong>是简单的文字按钮，且不在乎样式？</strong></p>
<ul>
<li>👉 用 <code>&lt;Button /&gt;</code></li>
</ul>
</li>
<li>
<p><strong>是 Android 平台且追求原生水波纹？</strong></p>
<ul>
<li>👉 用 <code>&lt;TouchableNativeFeedback /&gt;</code></li>
</ul>
</li>
<li>
<p><strong>是列表项或实心色块？</strong></p>
<ul>
<li>👉 用 <code>&lt;TouchableHighlight /&gt;</code></li>
</ul>
</li>
<li>
<p><strong>不想让用户看到任何点击反应？</strong></p>
<ul>
<li>👉 用 <code>&lt;TouchableWithoutFeedback /&gt;</code></li>
</ul>
</li>
<li>
<p><strong>其他所有情况（默认推荐）：</strong></p>
<ul>
<li>👉 用 <strong><code>&lt;TouchableOpacity /&gt;</code></strong></li>
</ul>
</li>
</ol>
<p>掌握了这些，你就掌握了 React Native 交互体验的基础命脉。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用大语言模型从零构建知识图谱（下）]]></title>    <link>https://juejin.cn/post/7581844141668843560</link>    <guid>https://juejin.cn/post/7581844141668843560</guid>    <pubDate>2025-12-10T06:35:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581844141668843560" data-draft-id="7581828086020046863" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用大语言模型从零构建知识图谱（下）    "/> <meta itemprop="keywords" content="LLM,人工智能"/> <meta itemprop="datePublished" content="2025-12-10T06:35:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智见AGI"/> <meta itemprop="url" content="https://juejin.cn/user/4145611877132986"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用大语言模型从零构建知识图谱（下）    
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4145611877132986/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智见AGI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-10T06:35:45.000Z" title="Wed Dec 10 2025 06:35:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66a215430242444d9cbb7fef084d517f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765953345&amp;x-signature=Cl8quT8Yukb03lAhyUBRpAZrnrs%3D" alt="7c47fe03bcb4867f67ffe4245342b19c_v2-d96f6f520cc63fbbd52ae2fdba1a11dc_1440w.jpg" loading="lazy"/>还没有看过上、中篇的读者可以阅读之前文章了解整个系列的内容：</p>
<p><a href="https://juejin.cn/post/7503536776344944675" target="_blank" title="https://juejin.cn/post/7503536776344944675">《使用大语言模型从零构建知识图谱（上）</a></p>
<p><a href="https://juejin.cn/post/7503536776344944675" target="_blank" title="https://juejin.cn/post/7503536776344944675">《使用大语言模型从零构建知识图谱（中）</a></p>
<p><strong>LangChain 中的 LLMGraphTransformer</strong></p>
<p>为了让我们的图谱更智能,我们使用 LangChain 从文本描述中提取实体(电影、演员等)和关系。LLMGraphTransformer 旨在使用语言模型将基于文本的文档转换为图文档。</p>
<p>让我们从初始化的过程开始：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">llm_transformer</span> = LLMGraphTransformer(
    <span class="hljs-attr">llm</span>=llm,
)
</code></pre>
<p>提供的 LLM 与我们用于自定义图构建器的是同一个。在这种情况下,我们使用默认参数,让模型可以自由地对节点、边和属性进行实验。但是,有几个参数值得了解,可能会进一步提升该算法的性能:</p>
<p>●allowed_nodes 和 allowed_relationships:我们没有指定,所以默认情况下允许所有节点和关系类型。</p>
<p>●strict_mode=True:如果指定了约束,则确保输出中仅包含允许的节点和关系。</p>
<p>●node_properties=False:禁用节点的属性提取。</p>
<p>●relationship_properties=False:禁用关系的属性提取。</p>
<p>●prompt:传入一个 ChatPromptTemplate 来自定义 LLM 的上下文。这与我们在自定义 LLM 中所做的类似。</p>
<p>该算法的一个缺点是速度相当慢,特别是考虑到我们没有提供节点和关系的列表。因此,我们将只使用数据集中 1000 行中的 100 行来加快速度:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">printfdf_sample</span> = df.head(<span class="hljs-number">100</span>)  <span class="hljs-comment"># 减少样本量以加快处理速度("hello world!");</span>
</code></pre>
<p>接下来,让我们准备数据集。我们说过”LLMGraphTransformer 旨在将基于文本的文档转换为图文档”,这意味着我们需要将 pandas 数据框转换为文本:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">df_sample</span> = movies.head(<span class="hljs-number">100</span>)

<span class="hljs-attr">documents</span> = []
for _, row in tqdm(df_sample.iterrows(), 
                   <span class="hljs-attr">total</span>=len(df_sample), 
                   <span class="hljs-attr">desc</span>=<span class="hljs-string">"正在创建文档"</span>,
                   <span class="hljs-attr">position</span>=<span class="hljs-number">0</span>, 
                   <span class="hljs-attr">leave</span>=<span class="hljs-literal">True</span>):
    try:
        <span class="hljs-comment"># 使用正确的换行符格式化文本</span>
        <span class="hljs-attr">text</span> = <span class="hljs-string">""</span>

        for col in df.columns:
            text += f"{col}: {row<span class="hljs-section">[col]</span>}\n"
        
        documents.append(Document(<span class="hljs-attr">page_content</span>=text))
        
    except KeyError as e:
        tqdm.write(f"缺失列: {e}")
    except Exception as e:
        tqdm.write(f"处理行时出错: {e}")
</code></pre>
<p>这将把每一行转换为文本并将其添加到 LangChain 的 Document 对象中,该对象与 LangChain 的 LLMGraphTransformer 兼容。</p>
<p>接下来,我们运行 LLM 并开始生成:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">graph_documents</span> = await llm_transformer.aconvert_to_graph_documents(documents)
</code></pre>
<p>请注意,在这种情况下,我们使用 await 和 aconvert_to_graph_documents 而不是 convert_to_graph_documents 来异步处理文档,从而在大规模应用中实现更快的执行速度。</p>
<p>接下来,请耐心等待,因为这将需要一些时间(在我电脑上花费了大约 20 多分钟)。转换完成后,让我们打印生成的节点和关系:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(<span class="hljs-string">f"节点:<span class="hljs-subst">{graph_documents[<span class="hljs-number">0</span>].nodes}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"关系:<span class="hljs-subst">{graph_documents[<span class="hljs-number">0</span>].relationships}</span>"</span>)在我这里，我得到了以下结果:
</code></pre>
<p>在我这里，我得到了以下结果:</p>
<pre><code class="hljs language-bash" lang="bash">Nodes:[Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">"Boone's cabin"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Cabin'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Boone'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian maiden'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian chief'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Chief'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Florence Lawrence'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'William Craven'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Wallace mccutcheon and ediwin s. porter'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Director'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Burning arrow'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Arrow'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian camp'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Camp'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'American'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Ethnicity'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">"Boone's horse"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Horse'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'None'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'None'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'an indian maiden'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Maiden'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'William craven'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Cast'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'florence lawrence'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Cast'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Swears vengeance'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Vengeance'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Daniel Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indians'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Group'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Daniel boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Title'</span>, properties={}), Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">"Daniel Boone's daughter"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={})]
Relationships:[Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Daniel Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Daniel boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Title'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'TITLE'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Daniel Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'American'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Ethnicity'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'ORIGIN_ETHNICITY'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Daniel Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Wallace mccutcheon and ediwin s. porter'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Director'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'DIRECTED_BY'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'William Craven'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'William craven'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Cast'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'CAST'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Florence Lawrence'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'florence lawrence'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Cast'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'CAST'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">"Daniel Boone's daughter"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'an indian maiden'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Maiden'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'BEFRIENDS'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian camp'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Camp'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'LEADS_OUT_ON_A_HUNTING_EXPEDITION'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indians'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Group'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">"Boone's cabin"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Cabin'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'ATTACKS'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian maiden'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'None'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'None'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'ESCAPES'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Swears vengeance'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Vengeance'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'RETURNS'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'None'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'None'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'HEADS_OUT_ON_THE_TRAIL_TO_THE_INDIAN_CAMP'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indians'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Group'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Boone'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'ENCOUNTERS'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian camp'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Camp'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Burning arrow'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Arrow'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'SET_ON_FIRE'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'None'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'None'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'GETS_TIED_TO_THE_STAKE_AND_TOURED'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian camp'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Camp'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Burning arrow'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Arrow'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'SETS_ON_FIRE'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indians'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Group'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">"Boone's horse"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Horse'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'ENCOUNTERS'</span>, properties={}), Relationship(<span class="hljs-built_in">source</span>=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Boone'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Person'</span>, properties={}), target=Node(<span class="hljs-built_in">id</span>=<span class="hljs-string">'Indian chief'</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">'Chief'</span>, properties={}), <span class="hljs-built_in">type</span>=<span class="hljs-string">'HAS_KNIFE_FIGHT_IN_WHICH_HE_KILLS_THE_INDIAN_CHIEF'</span>, properties={})]
</code></pre>
<p>接下来,是时候将生成的图文档添加到我们的知识图谱中了。我们可以通过利用 Neo4j 的 LangChain 集成来实现:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">graph</span> = Neo4jGraph(url=uri, username=user, password=password, enhanced_schema=<span class="hljs-literal">True</span>)
graph.add_graph_documents(graph_document
</code></pre>
<p>让我们将图连接存储在 graph 变量中,传入您在应用程序开始时使用的相同 URL、用户名和密码。然后,让我们调用 add_graph_documents 方法将所有图文档添加到我们的数据库中。</p>
<p>完成该过程后,让我们最后一次切换到 Neo4j Browser,查看我们的新知识图谱。</p>
<p>像往常一样,运行以下查询来查看知识图谱:</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">MATCH</span> <span class="hljs-selector-tag">p</span>=(<span class="hljs-attribute">m</span>:Movie)<span class="hljs-selector-tag">-</span><span class="hljs-selector-attr">[r]</span><span class="hljs-selector-tag">-</span>(n)
<span class="hljs-selector-tag">RETURN</span> <span class="hljs-selector-tag">p</span>
<span class="hljs-selector-tag">LIMIT</span> <span class="hljs-number">100</span>;
</code></pre>
<p>在我这里，知识图谱看起来像这样：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef8bde876f84472f8c9703678c185a13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm66KeBQUdJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765953345&amp;x-signature=V7zfGmZD8gykS9w8PJ%2BPyLxT%2BQ8%3D" alt="" loading="lazy"/></p>
<p>由 LLMGraphTransformer 生成的知识图谱</p>
<p>但我们还没有完成。您可能还记得,我们的任务实际上是查询知识图谱以帮助我们找到电影。在本文中,我将提供一个简单的文本转 Cypher 方法,该方法将利用 LLM 生成 Cypher 查询、运行 Cypher 查询,并使用检索到的信息作为上下文来回答用户查询。但是,请注意这只是一个简单的方法,我们将在后面的文章中探索高级检索方法。 首先,让我们刷新图谱的模式,因为我们将使用它让 LLM 理解我们的知识图谱:</p>
<pre><code class="hljs language-scss" lang="scss">graph<span class="hljs-selector-class">.refresh_schema</span>()
</code></pre>
<p>接下来，我们来配置 QA 链：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">CYPHER_GENERATION_TEMPLATE</span> = <span class="hljs-string">"""任务:生成 Cypher 语句以查询图数据库。
指令:
仅使用模式中提供的关系类型和属性。
不要使用任何未提供的其他关系类型或属性。
模式:
{schema}
{schema}
注意:不要在响应中包含任何解释或道歉。
不要回答任何可能要求您构建 Cypher 语句以外的问题。
除了生成的 Cypher 语句外,不要包含任何文本。
返回完整的节点,不要只返回属性。

问题是:
{question}"""</span>

<span class="hljs-attr">CYPHER_GENERATION_PROMPT</span> = PromptTemplate(
    <span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"schema"</span>, <span class="hljs-string">"question"</span>], template=CYPHER_GENERATION_TEMPLATE
)

<span class="hljs-attr">chain</span> = GraphCypherQAChain.from_llm(
    llm, 
    <span class="hljs-attr">graph</span>=graph, 
    <span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>, 
    <span class="hljs-attr">allow_dangerous_requests</span>=<span class="hljs-literal">True</span>, 
    <span class="hljs-attr">return_intermediate_steps</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">cypher_prompt</span>=CYPHER_GENERATION_PROMPT
)
</code></pre>
<p>在上面的代码中,我们向 LLM 提供了一个提示来帮助它进行生成,并传入图变量的模式。 最后,让我们问它一些问题:</p>
<pre><code class="hljs language-arduino" lang="arduino">chain.<span class="hljs-built_in">run</span>(<span class="hljs-string">"请提供一份关于电影《大卫科波菲尔》的电影概述"</span>)
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Generated</span> <span class="hljs-selector-tag">Cypher</span>:
<span class="hljs-selector-tag">MATCH</span> <span class="hljs-selector-tag">p</span>=(<span class="hljs-attribute">n</span>:Title {id: 'David Copperfield'})<span class="hljs-selector-tag">-</span><span class="hljs-selector-attr">[*1..2]</span><span class="hljs-selector-tag">-</span>()
<span class="hljs-selector-tag">RETURN</span> <span class="hljs-selector-tag">p</span>
<span class="hljs-selector-tag">Full</span> <span class="hljs-selector-tag">Context</span>:
<span class="hljs-selector-attr">[{<span class="hljs-string">'p'</span>: [{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'CAST_IN'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'Florence La Badie'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'RELEASE_YEAR'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'1911'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'GENRE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'Drama'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'DIRECTED'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'Theodore Marston'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'ORIGIN_ETHNICITY'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'American'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'CAST_IN'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'Mignon Anderson'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'CAST_IN'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'William Russell'</span>}]</span>}, {'<span class="hljs-selector-tag">p</span>': <span class="hljs-selector-attr">[{<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'TITLE'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'David Copperfield'</span>}, <span class="hljs-string">'CAST_IN'</span>, {<span class="hljs-string">'id'</span>: <span class="hljs-string">'Marie Eline'</span>}]</span>}]
<span class="hljs-selector-tag">INFO</span>:<span class="hljs-selector-tag">httpx</span>:<span class="hljs-selector-tag">HTTP</span> <span class="hljs-selector-tag">Request</span>: <span class="hljs-selector-tag">POST</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//127.0.0.1:11434/api/generate "HTTP/1.1 200 OK"</span>

&gt; <span class="hljs-selector-tag">Finished</span> <span class="hljs-selector-tag">chain</span>.
'<span class="hljs-selector-tag">David</span> <span class="hljs-selector-tag">Copperfield</span> <span class="hljs-selector-tag">is</span> <span class="hljs-selector-tag">a</span> <span class="hljs-number">1911</span> <span class="hljs-selector-tag">American</span> <span class="hljs-selector-tag">drama</span> <span class="hljs-selector-tag">film</span> <span class="hljs-selector-tag">directed</span> <span class="hljs-selector-tag">by</span> <span class="hljs-selector-tag">Theodore</span> <span class="hljs-selector-tag">Marston</span>. <span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">movie</span> <span class="hljs-selector-tag">stars</span> <span class="hljs-selector-tag">David</span> <span class="hljs-selector-tag">Copperfield</span>, <span class="hljs-selector-tag">Florence</span> <span class="hljs-selector-tag">La</span> <span class="hljs-selector-tag">Badie</span>, <span class="hljs-selector-tag">Mignon</span> <span class="hljs-selector-tag">Anderson</span>, <span class="hljs-selector-tag">William</span> <span class="hljs-selector-tag">Russell</span>, <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">Marie</span> <span class="hljs-selector-tag">Eline</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">various</span> <span class="hljs-selector-tag">roles</span>. <span class="hljs-selector-tag">It</span> <span class="hljs-selector-tag">provides</span> <span class="hljs-selector-tag">an</span> <span class="hljs-selector-tag">overview</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">life</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">adventures</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">David</span> <span class="hljs-selector-tag">Copperfield</span> <span class="hljs-selector-tag">through</span> <span class="hljs-selector-tag">the</span> <span class="hljs-selector-tag">eyes</span> <span class="hljs-selector-tag">of</span> <span class="hljs-selector-tag">his</span> <span class="hljs-selector-tag">various</span> <span class="hljs-selector-tag">companions</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">experiences</span>.'通过设置 <span class="hljs-selector-tag">verbose</span>=<span class="hljs-selector-tag">True</span>,我们可以输出中间步骤:生成的 <span class="hljs-selector-tag">Cypher</span> 查询和提供的上下文。
</code></pre>
<p><strong>总结</strong></p>
<p>本文作为构建知识图谱的现代方法的入门介绍。首先,我们探索了传统方法并概述了 Cypher 语言,然后创建了一个简单的 LLM 图构建器来自动化图构建过程,其性能与手动过程中实现的性能相匹配。最后,我们更进一步,引入了 LangChain 的 LLMGraphTransformer,它显著改进了我们的知识图谱。然而,这只是我们 Graph RAG 之旅的开始,特别是我们的图构建器之旅。我们还需要探索和从头构建更多现代方法,我们将在未来的文章中完成这些工作。</p>
<p>此外,我们上面讨论的策略仍然没有考虑 Graph-RAG 的第二个组件:图检索器。尽管改进实际的图谱也会提高检索性能,但我们仍然没有从检索的角度进行思考。例如,按照我们目前采取的方向,标签、节点、边和属性越多越好。然而,这实际上使检索器函数更难识别要检索的正确信息。事实上,现代方法还考虑在知识图谱中遵循树形结构,通过创建宏观区域并进一步将其分解为微观区域来帮助检索。</p>
<p>目前,我希望您在不同的数据集上测试所有这些代码,并在扩展我所提供的简单的 LLM 图构建器时发挥创造力。尽管 LLMGraphTransformer 似乎是一个非常方便的选择,可以用最少的代码快速构建灵活的图构建器,但这种方法需要更多时间来构建我们的知识图谱。此外,从头开始构建它将确保您掌握并完全理解 Graph-RAG 背后的每个组件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>